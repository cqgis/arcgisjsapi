// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define(["require","exports","./utils"],function(q,g,f){function k(b,a,c){a=f.splitPath(a);if(Array.isArray(a)){for(var e=[],d=0;d<a.length;d++)e.push((new h(a[d],c)).install(b));return new l(e)}b=(new h(a,c)).install(b);return new m(b)}Object.defineProperty(g,"__esModule",{value:!0});var h=function(){function b(a,c){this.path=a;this.callback=c;this.conditional=this.chain=null;if(-1<a.indexOf(".")){if(a=f.parseConditionalPath(a))this.path=a.fullPath,this.conditional=a.conditional;this.chain=f.pathToArray(this.path)}else"?"===
a[a.length-1]&&(this.path=a.slice(0,a.length-1),this.conditional=[!0],this.chain=[this.path]);this.callback=c;return this}b.prototype.install=function(a){a=this.chain?new n(this,a):new p(this,a);return a};b.prototype.notify=function(a){this.callback(a,this.path)};return b}(),p=function(){function b(a,c){this.binding=a;this.target=c;f.getProperties(c).addCursor(this.binding.path,this)}b.prototype.destroy=function(){this.target&&(f.getProperties(this.target).removeCursor(this.binding.path,this),this.target=
this.binding=null)};b.prototype.propertyDestroyed=function(a,c){f.getProperties(this.target).removeCursor(c,this)};b.prototype.propertyInvalidated=function(a,c){this.binding&&this.binding.notify(this.target)};b.prototype.propertyCommitted=function(a,c){this.binding&&this.binding.notify(this.target)};return b}(),n=function(){function b(a,c){this.binding=a;this.target=c;this.stack=[];this.properties=f.getProperties(c);this.stack.push({properties:this.properties,propertyName:a.chain[0]});this.properties.addCursor(a.chain[0],
this);this.moveForward();return this}b.prototype.destroy=function(){for(;;){var a=this.stack.pop();if(null==a)break;a.properties.removeCursor(a.propertyName,this)}this.target=this.binding=null};b.prototype.propertyDestroyed=function(a,c){this.moveBackward(a,c)};b.prototype.propertyInvalidated=function(a,c){this.binding&&this.binding.notify(this.target)};b.prototype.propertyCommitted=function(a,c){this.binding&&(this.moveBackward(a,c),this.moveForward(),this.binding.notify(this.target))};b.prototype.moveBackward=
function(a,c){for(var b=this.stack,d=b[b.length-1];d.properties!==a&&d.propertyName!==c;)d.properties.removeCursor(d.propertyName,this),b.pop(),d=b[b.length-1]};b.prototype.moveForward=function(){var a=this.stack,b=a[a.length-1];if(1!==a.length||!this.binding.conditional||!this.binding.conditional[a.length-1]||b.properties.metadatas[b.propertyName])if(b=b.properties.internalGet(b.propertyName),(b=f.getProperties(b))&&a.length<this.binding.chain.length){var e=this.binding.chain[a.length];this.binding.conditional&&
this.binding.conditional[a.length]&&!b.metadatas[e]||(this.stack.push({properties:b,propertyName:e}),b.addCursor(e,this),this.moveForward())}};return b}(),l=function(){function b(a){this.cursors=a}b.prototype.remove=function(){for(var a=this.cursors;0<a.length;)a.pop().destroy();this.cursors=null};return b}(),m=function(){function b(a){this.cursor=a}b.prototype.remove=function(){this.cursor.destroy();this.cursor=null};return b}();g.create=function(b,a){b=f.splitPath(b);if(Array.isArray(b)){for(var c=
[],e=0;e<b.length;e++)c.push(new h(b[e],a));return function(a){for(var b=[],d=0;d<c.length;d++)b[d]=c[d].install(a);return new l(b)}}var d=new h(b,a);return function(a){return new m(d.install(a))}};g.wire=k;g.default=k});