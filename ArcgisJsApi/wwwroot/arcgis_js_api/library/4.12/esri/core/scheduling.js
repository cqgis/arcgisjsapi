// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define(["require","exports","./nextTick","./now","./requestAnimationFrame"],function(F,b,z,A,B){function C(a){void 0===a&&(a=b.now());b.debug.rafId=null;0<e.length&&(b.debug.rafId=k());0<l&&(q=Math.min(a-l,q));b.debug.executeFrameTasks(a)}function k(){return b.debug.requestNextFrame?b.debug.requestNextFrame(u):u()}function v(){for(var a=0;a<e.length;){var b=e[a];a++;if(b.removed){e.splice(a-1,1);for(var f=0;f<p.length;f++){var g=p[f];if(b.phases[g]){var g=r[g],c=g.indexOf(b);-1!==c&&g.splice(c,1)}}}}}
function w(){for(;m.length;){var a=m.shift();a.isActive&&(a.isActive=!1,a.callback())}b.debug.willDispatch=!1}function u(){return B(C)}Object.defineProperty(b,"__esModule",{value:!0});b.now=A;var D=function(){return function(a){this.phases=a;this.paused=!1;this.pausedAt=0;this.epoch=-1;this.dt=0;this.ticks=-1;this.removed=!1}}(),E=function(){function a(a){this.callback=a;this.isActive=!0}a.prototype.remove=function(){this.isActive=!1};return a}(),l=-1,t=0,q=Number.POSITIVE_INFINITY,n={time:0,deltaTime:0,
elapsedFrameTime:0,frameDuration:0,spendInTask:0},p=["prepare","preRender","render","postRender","update"],m=[],e=[],r={prepare:[],preRender:[],render:[],postRender:[],update:[]},x=function(){function a(a){this._task=a}a.prototype.remove=function(){this._task.removed=!0};a.prototype.pause=function(){this._task.paused||(this._task.paused=!0,this._task.pausedAt=b.now())};a.prototype.resume=function(){this._task.paused&&(this._task.paused=!1,-1!==this._task.epoch&&(this._task.epoch+=b.now()-this._task.pausedAt))};
return a}();b.FrameTaskHandle=x;b.debug={frameTasks:e,rafId:null,requestNextFrame:null,willDispatch:!1,clearFrameTasks:function(a){void 0===a&&(a=!1);for(var b=0;b<e.length;b++)e[b].removed=!0;a&&v()},dispatch:w,executeFrameTasks:function(a){void 0===a&&(a=b.now());0>l&&(l=a);var h=a-l,f=0<t?t:q,g=Math.max(0,h-f);l=a;for(var c=0;c<e.length;c++){var d=e[c];-1!==d.epoch&&(d.dt=h)}for(c=0;c<p.length;c++)for(var h=p[c],k=r[h],m=0;m<k.length;m++)d=k[(m+y)%k.length],d.paused||d.removed||(0===c&&d.ticks++,
-1===d.epoch&&(d.epoch=a),n.time=a,n.deltaTime=d.dt,n.elapsedFrameTime=b.now()-a,n.frameDuration=f-g,n.spendInTask=a-d.epoch,d.phases[h].call(d,n));v();++y}};b.schedule=function(a){a=new E(a);m.push(a);b.debug.willDispatch||(b.debug.willDispatch=!0,z(w));return a};b.addFrameTask=function(a){var h=new D(a);e.push(h);for(var f=0,g=p;f<g.length;f++){var c=g[f];a[c]&&r[c].push(h)}b.debug.rafId||(l=-1,b.debug.rafId=k());return new x(h)};b.setFrameDuration=function(a){t=Math.max(0,a)};var y=0;b.requestNextFrame=
k});