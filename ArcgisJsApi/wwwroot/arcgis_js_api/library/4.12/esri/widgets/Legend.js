// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Legend/LegendViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./support/ActiveLayerInfo".split(" "),function(t,p,g,k,b,a,f,m,n,h){var r=a.ofType(h),v="esri.layers.CSVLayer esri.layers.FeatureLayer esri.layers.HeatmapLayer esri.layers.MapImageLayer esri.layers.PointCloudLayer esri.layers.TileLayer esri.layers.StreamLayer esri.layers.SceneLayer esri.layers.GeoRSSLayer esri.layers.GeoJSONLayer esri.layers.GroupLayer esri.layers.ImageryLayer esri.layers.WMSLayer esri.layers.WMTSLayer".split(" "),
e=["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];return function(b){function a(c){c=b.call(this,c)||this;c._handles=new f;c._layerViewByLayerId={};c._layerInfosByLayerViewId={};c._activeLayerInfosByLayerViewId={};c.activeLayerInfos=new r;c.basemapLegendVisible=!1;c.groundLegendVisible=!1;c.layerInfos=[];c.view=null;return c}g(a,b);a.prototype.initialize=function(){this._handles.add(m.init(this,"view",this._viewHandles),"view")};
a.prototype.destroy=function(){this._destroyViewActiveLayerInfos();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(a.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});a.prototype._viewHandles=function(){this._handles.remove("state");this.view&&this._handles.add(m.init(this,"state",this._stateHandles),"state")};a.prototype._stateHandles=function(){this._resetAll();"ready"===this.state&&this._watchPropertiesAndAllLayerViews()};
a.prototype._resetAll=function(){this._handles.remove(["all-layer-views","legend-properties"]);this._destroyViewActiveLayerInfos();this.activeLayerInfos.removeAll()};a.prototype._destroyViewActiveLayerInfos=function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)};a.prototype._destroyViewActiveLayerInfo=function(c){this._handles.remove(c);delete this._activeLayerInfosByLayerViewId[c]};a.prototype._watchPropertiesAndAllLayerViews=function(){var c=this.view.allLayerViews;
c.length&&this._refresh();this._handles.add(c.on("change",this._allLayerViewsChangeHandle.bind(this)),"all-layer-views");this._handles.add(m.watch(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),"legend-properties")};a.prototype._allLayerViewsChangeHandle=function(c){var l=this;c.removed.forEach(function(c){return l._destroyViewActiveLayerInfo(c.uid)});this._refresh()};a.prototype._propertiesChangeHandle=function(){this._destroyViewActiveLayerInfos();
this._refresh()};a.prototype._refresh=function(){this._layerInfosByLayerViewId={};this.activeLayerInfos.removeAll();this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this);this._sortActiveLayerInfos(this.activeLayerInfos)};a.prototype._sortActiveLayerInfos=function(c){var l={};this.view.allLayerViews.forEach(function(c,a){return l[c.layer.uid]=a});c.sort(function(c,a){return(l[a.layer.uid]||0)-(l[c.layer.uid]||
0)})};a.prototype._generateLayerViews=function(){var c=[];e.filter(this._filterLayerViews,this).map(this.get,this).filter(function(c){return null!=c}).forEach(this._collectLayerViews("layerViews",c));return c};a.prototype._filterLayerViews=function(c){var l=!this.groundLegendVisible&&"view.groundView.layerViews"===c;return!(!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===c||"view.basemapView.referenceLayerViews"===c))&&!l};a.prototype._collectLayerViews=function(c,l){var a=function(b){b&&
b.forEach(function(b){l.push(b);a(b[c])});return l};return a};a.prototype._filterLayerViewsByLayerInfos=function(c){var a=this,b=this.layerInfos;return b&&b.length?b.some(function(l){return a._hasLayerInfo(l,c)}):!0};a.prototype._hasLayerInfo=function(c,a){var l=this._isLayerUIDMatching(c.layer,a.layer.uid);l&&(this._layerInfosByLayerViewId[a.uid]=c);return l};a.prototype._isLayerUIDMatching=function(c,a){return c&&(c.uid===a||this._hasLayerUID(c.layers,a))};a.prototype._hasLayerUID=function(c,a){var l=
this;return c&&c.some(function(c){return l._isLayerUIDMatching(c,a)})};a.prototype._isLayerViewSupported=function(c){return-1<v.indexOf(c.layer.declaredClass)?(this._layerViewByLayerId[c.layer.uid]=c,!0):!1};a.prototype._generateActiveLayerInfo=function(c){var a=this;this._isLayerActive(c)?this._buildActiveLayerInfo(c):(this._handles.remove(c.uid),this._handles.add(m.watch(c,"suspended, layer.legendEnabled",function(){return a._layerActiveHandle(c)}),c.uid))};a.prototype._layerActiveHandle=function(c){this._isLayerActive(c)&&
(this._handles.remove(c.uid),this._buildActiveLayerInfo(c))};a.prototype._isLayerActive=function(c){return!c.suspended&&c.get("layer.legendEnabled")};a.prototype._buildActiveLayerInfo=function(c){var a=this,b=c.layer,e=c.uid,f=this._layerInfosByLayerViewId[e],q=this._activeLayerInfosByLayerViewId[e];q||(q=new h({layer:b,title:f&&void 0!==f.title?f.title:b.title,view:this.view}),this._activeLayerInfosByLayerViewId[e]=q);q.parent||(f=(f=b.parent)&&this._layerViewByLayerId[f.uid],q.parent=f&&this._activeLayerInfosByLayerViewId[f.uid]);
if(!this._handles.has(e)){var f=m.watch(b,"title",function(d){return a._titleHandle(d,q,c)}),u=m.watch(b,"legendEnabled",function(d){return a._legendEnabledHandle(d,q,c)}),b=m.watch(b,"renderer?, opacity",function(){return a._constructLegendElements(q,c)}),d=m.watch(c,"suspended",function(d){return a._suspendedHandle(d,q,c)}),w=m.whenTrue(this.view,"stationary",function(){return a._scaleHandle(q,c)});this._handles.add([f,u,b,d,w],e);this._constructLegendElements(q,c)}this._addActiveLayerInfo(q,c)};
a.prototype._titleHandle=function(c,a,b){a.title=c;this._constructLegendElements(a,b)};a.prototype._legendEnabledHandle=function(c,a,b){c?this._addActiveLayerInfo(a,b):this._removeActiveLayerInfo(a)};a.prototype._suspendedHandle=function(c,a,b){c?this._removeActiveLayerInfo(a):this._addActiveLayerInfo(a,b)};a.prototype._scaleHandle=function(c,a){c.scale!==this.view.scale&&c.isScaleDriven&&this._constructLegendElements(c,a)};a.prototype._addActiveLayerInfo=function(c,a){this._isLayerActive(a)&&-1===
this.activeLayerInfos.indexOf(c)&&((a=c.parent,a)?-1===a.children.indexOf(c)&&(a.children.push(c),this._sortActiveLayerInfos(a.children)):(this.activeLayerInfos.add(c),this._sortActiveLayerInfos(this.activeLayerInfos)))};a.prototype._removeActiveLayerInfo=function(c){var a=c.parent;a?a.children.remove(c):this.activeLayerInfos.remove(c)};a.prototype._constructLegendElements=function(a,b){b=b.layer;a.scale=this.view.scale;b.featureCollections?a.buildLegendElementsForFeatureCollections(b.featureCollections):
b.renderer?a.buildLegendElementsForRenderer():b.url&&a.buildLegendElementsForTools()};k([n.property({type:r})],a.prototype,"activeLayerInfos",void 0);k([n.property()],a.prototype,"basemapLegendVisible",void 0);k([n.property()],a.prototype,"groundLegendVisible",void 0);k([n.property()],a.prototype,"layerInfos",void 0);k([n.property({dependsOn:["view.ready"],readOnly:!0})],a.prototype,"state",null);k([n.property()],a.prototype,"view",void 0);return a=k([n.subclass("esri.widgets.Legend.LegendViewModel")],
a)}(n.declared(b))})},"esri/widgets/Legend/support/ActiveLayerInfo":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../Color ../../../request ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ../../../layers/support/fieldUtils ../../../renderers/support/jsonUtils ../../../symbols/support/gfxUtils ../../../symbols/support/symbolUtils ../../../symbols/support/utils ./colorRampUtils ./heatmapRampUtils ./relationshipRampUtils ./sizeRampUtils @dojo/framework/shim/Promise".split(" "),
function(t,p,g,k,b,a,f,m,n,h,r,v,e,q,u,c,l,z,B,A,x,y,d,w,D,C,E,H,P,I){function J(d){return"esri.renderers.SimpleRenderer"===d.declaredClass}function G(d){return"esri.renderers.ClassBreaksRenderer"===d.declaredClass}function Q(d){return"esri.renderers.UniqueValueRenderer"===d.declaredClass}function X(d){return"esri.renderers.HeatmapRenderer"===d.declaredClass}function L(d){return"esri.renderers.PointCloudClassBreaksRenderer"===d.declaredClass}function N(d){return"esri.renderers.PointCloudStretchRenderer"===
d.declaredClass}function M(d){return"esri.renderers.PointCloudUniqueValueRenderer"===d.declaredClass}var F=u.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),O=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,K=new h.SimpleMarkerSymbol({size:6,outline:{color:[128,128,128,.5],width:.5}}),T=new h.SimpleMarkerSymbol({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",outline:{width:1,color:[85,85,85,1]}});return function(u){function h(d){d=u.call(this,d)||this;d._handles=new q;d._hasColorRamp=!1;d._hasOpacityRamp=
!1;d._hasSizeRamp=!1;d._legendResponse={};d._webStyleSymbolCache=new Map;d._dotDensityUrlCache=new Map;d.children=new e;d.layer=null;d.legendElements=[];d.parent=null;d.scale=null;d.title=null;d.view=null;return d}k(h,u);h.prototype.initialize=function(){var d=this,a=function(){return d.notifyChange("ready")};this._handles.add([B.on(this,"children","change",function(c){var b=c.removed,l=d._handles;c.added.map(function(d){var c="activeLayerInfo-ready-watcher-"+d.layer.uid;l.add(B.init(d,"ready",a),
c)});b.forEach(function(d){return l.remove(d.layer.uid)});a()})])};h.prototype.destroy=function(){this._handles.destroy();this._dotDensityUrlCache=this._webStyleSymbolCache=this._legendResponse=this._handles=null};Object.defineProperty(h.prototype,"ready",{get:function(){return null===this.layer?!0:0<this.children.length?this._isGroupActive():0<this.legendElements.length},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isScaleDriven",{get:function(){var d=this,a=this.layer;if(null===
a)return!1;if("renderer"in a&&a.renderer){if("dot-density"===a.renderer.type)return!0;var c=a.get("renderer.valueExpression");return O.test(c)?!0:(a=a.get("renderer.visualVariables"))&&a.some(function(a){return d._isScaleDrivenSizeVariable(a)})}return!0},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"version",{get:function(){return this._get("version")+1},enumerable:!0,configurable:!0});h.prototype.buildLegendElementsForFeatureCollections=function(a){var c=this;this.legendElements=
[];a.forEach(function(a){if("esri.layers.FeatureLayer"===a.declaredClass)c._buildRendererLegendElements(a.renderer,a.title,"append");else if(a.featureSet&&a.featureSet.features.length){var b=a.layerDefinition;(b=(b=b&&b.drawingInfo)&&d.fromJSON(b.renderer))?c._buildRendererLegendElements(b,a.name,"append"):F.warn("drawingInfo not available!")}})};h.prototype.buildLegendElementsForRenderer=function(){this._buildRendererLegendElements("renderer"in this.layer&&this.layer.renderer,null,"replace")};h.prototype.buildLegendElementsForTools=
function(){return a(this,void 0,void 0,function(){var d,a=this;return f(this,function(c){switch(c.label){case 0:d=this.layer;if("esri.layers.WMTSLayer"!==d.declaredClass)return[3,1];this._constructLegendElementsForWMTSlayer();return[3,6];case 1:if("esri.layers.WMSLayer"!==d.declaredClass)return[3,2];this._constructLegendElementsForWMSSublayers();return[3,6];case 2:return"esri.layers.MapImageLayer"!==d.declaredClass?[3,4]:[4,this._constructLegendElementsForSublayers()];case 3:return c.sent(),[3,6];
case 4:return this._handles.remove("imageryLayers-watcher"),[4,this._getLegendLayers().then(function(c){a.legendElements=[];c.forEach(function(c){if("esri.layers.ImageryLayer"===a.layer.declaredClass){var b=d.watch("renderingRule, bandIds",function(){a._legendResponse["default"]=null;a.buildLegendElementsForTools()});a._handles.add(b,"imageryLayers-watcher")}(c=a._generateSymbolTableElementForLegendLayer(c))&&c.infos.length&&a.legendElements.push(c);a.notifyChange("ready")});a.notifyChange("ready")}).catch(function(d){F.warn("Request to server for legend has failed!",
d)})];case 5:c.sent(),c.label=6;case 6:return[2]}})})};h.prototype._isGroupActive=function(){var d=this.children;return d.length?d.some(function(d){return d.ready}):!1};h.prototype._isScaleDrivenSizeVariable=function(d){if(d&&"size"!==d.type)return!1;var a=d.minSize,c=d.maxSize;return"object"===typeof a&&a?this._isScaleDrivenSizeVariable(a):"object"===typeof c&&c?this._isScaleDrivenSizeVariable(c):!!d.expression||O.test(d.valueExpression)};h.prototype._buildRendererLegendElements=function(d,a,c){var b=
this;this._getRendererLegendElements(d,a).then(function(d){"append"===c?Array.prototype.push.apply(b.legendElements,d):b.legendElements=d;b.notifyChange("ready")}).catch(function(d){F.warn("error while building legend for layer!",d)})};h.prototype._constructLegendElementsForWMTSlayer=function(){this.legendElements=[];this._handles.remove("wmts-activeLayer-watcher");var d=this.layer,a=d.activeLayer;this._handles.add(B.watch(this.layer,"activeLayer",this._constructLegendElementsForWMTSlayer.bind(this)),
"wmts-activeLayer-watcher");if(a.styleId&&a.styles){var c=null;a.styles.some(function(d){if(a.styleId===d.id)return c=d.legendUrl,!0});c&&(this.legendElements=[{type:"symbol-table",title:a.title,infos:[{src:c,opacity:d.opacity}]}])}this.notifyChange("ready")};h.prototype._constructLegendElementsForWMSSublayers=function(){this.legendElements=[];this._handles.remove("wms-sublayers-watcher");var d=this.layer,a=null;if(d.customParameters||d.customLayerParameters)a=g({},d.customParameters,d.customLayerParameters);
this._handles.add(B.watch(this.layer,"sublayers",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");this.legendElements=this._generateLegendElementsForWMSSublayers(d.sublayers,a);this.notifyChange("ready")};h.prototype._generateLegendElementsForWMSSublayers=function(d,a){var c=this,b=[];this._handles.add(d.on("change",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");d.forEach(function(d){var l=d.watch("title, visible, legendEnabled",
function(){return c._constructLegendElementsForWMSSublayers()});c._handles.add(l,"wms-sublayers-watcher");d.visible&&d.legendEnabled&&(d=c._generateSymbolTableElementForWMSSublayer(d,a))&&d.infos.length&&b.unshift(d)});return b};h.prototype._generateSymbolTableElementForWMSSublayer=function(d,a){return!d.legendUrl&&d.sublayers?(a=this._generateLegendElementsForWMSSublayers(d.sublayers,a).filter(function(d){return d}),{type:"symbol-table",title:d.title,infos:a}):this._generateSymbolTableElementForLegendUrl(d,
a)};h.prototype._generateSymbolTableElementForLegendUrl=function(d,a){var c=d.legendUrl;if(c){var b={type:"symbol-table",title:d.title||d.name||d.id&&d.id+"",infos:[]};a&&(c+="?"+z.objectToQuery(a));b.infos.push({src:c,opacity:d.layer&&d.layer.opacity});return b}};h.prototype._getLegendLayers=function(d){var a=this,c=(d=d&&d.hasDynamicLayers?d.dynamicLayers:null)||"default",b=this._legendResponse&&this._legendResponse[c];return b?l.resolve(b):this._legendRequest(d).then(function(d){d=d.layers;return a._legendResponse[c]=
d})};h.prototype._legendRequest=function(d){var a=this.layer;d={f:"json",dynamicLayers:d};"esri.layers.ImageryLayer"===a.declaredClass&&("renderingRule"in a&&a.renderingRule&&(d.renderingRule=JSON.stringify(a.renderingRule.toJSON())),"bandIds"in a&&a.bandIds&&(d.bandIds=a.bandIds.join()));var c=a.url.replace(/(\/)+$/,"");"version"in a&&10.01<=a.version?(a=c.indexOf("?"),c=-1<a?c.substring(0,a)+"/legend"+c.substring(a):c+"/legend"):(a=c.toLowerCase().indexOf("/rest/"),c=c.substring(0,a)+c.substring(a+
5,c.length),c="https://utility.arcgis.com/sharing/tools/legend?soapUrl\x3d"+encodeURI(c)+"\x26returnbytes\x3dtrue");return n(c,{query:d}).then(function(d){return d.data})};h.prototype._constructLegendElementsForSublayers=function(){var d=this;this.legendElements=[];this._handles.remove("sublayers-watcher");var a=this.layer,c=new x.ExportImageParameters({layer:a});return this._getLegendLayers(c).then(function(c){var b={};c.forEach(function(d){b[d.layerId]=d});d._handles.add(B.watch(a,"sublayers",d._constructLegendElementsForSublayers.bind(d)),
"sublayers-watcher");d.legendElements=d._generateLegendElementsForSublayers(a.sublayers,b,a.opacity);d.notifyChange("ready")}).catch(function(d){F.warn("Request to server for legend has failed!",d)}).then(function(){return c.destroy()})};h.prototype._generateLegendElementsForSublayers=function(d,a,c){var b=this,l=[];this._handles.add(d.on("change",this._constructLegendElementsForSublayers.bind(this)),"sublayers-watcher");d.forEach(function(d){var e=d.watch("renderer, opacity, title, visible",function(){return b._constructLegendElementsForSublayers()});
b._handles.add(e,"sublayers-watcher");d.visible&&d.legendEnabled&&(e=d&&null!=d.opacity?d.opacity:null,(d=b._generateSymbolTableElementForSublayer(d,a,null!=e?e*c:c))&&d.infos.length&&l.unshift(d))});return l};h.prototype._generateSymbolTableElementForSublayer=function(d,a,c){var b=a[d.id];return!b&&d.sublayers?(a=this._generateLegendElementsForSublayers(d.sublayers,a,c).filter(function(d){return d}),{type:"symbol-table",title:d.title,infos:a}):this._generateSymbolTableElementForLegendLayer(b,d,c)};
h.prototype._generateSymbolTableElementForLegendLayer=function(d,a,c){var b=this;if(d){var l=a&&a.renderer,e=a&&a.title||d.layerName;l&&(l=a&&a.title||this._getRendererTitle(l,a))&&(e&&(l.title=e),e=l);e={type:"symbol-table",title:e,infos:[]};d.legendType&&(e.legendType=d.legendType);d.legend&&this._isLegendLayerInScale(d,a)&&(a=a?this._sanitizeLegendForSublayer(d.legend.slice(),a):d.legend,e.infos=a.map(function(a){var l=a.url;if(a.imageData&&0<a.imageData.length)l="data:image/png;base64,"+a.imageData;
else if(0!==l.indexOf("http"))l=z.addTokenParameter(b.layer.url+"/"+d.layerId+"/images/"+l);else return null;return{label:a.label,src:l,opacity:c,width:a.width,height:a.height}}).filter(function(d){return!!d}));return e.infos.length?e:null}};h.prototype._isLegendLayerInScale=function(d,a){a=a||this.layer;var c=null,b=null,l=!0;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0===d.minScale&&a.tileInfo&&(c=a.tileInfo.lods[0].scale),0===d.maxScale&&a.tileInfo&&(b=a.tileInfo.lods[a.tileInfo.lods.length-
1].scale)):(c=Math.min(a.minScale,d.minScale)||a.minScale||d.minScale,b=Math.max(a.maxScale,d.maxScale));if(0<c&&c<this.scale||b>this.scale)l=!1;return l};h.prototype._sanitizeLegendForSublayer=function(d,a){if("version"in this.layer&&10.1>this.layer.version||0===d.length)return d;a=a.renderer;var c=null,b=null;d.some(function(d){return d.values})&&d.some(function(d,a){d.values||(c=a,b=d,b.label||(b.label="others"));return null!=b});a?"unique-value"===a.type?b&&(d.splice(c,1),d.push(b)):"class-breaks"===
a.type&&(b&&d.splice(c,1),d.reverse(),b&&d.push(b)):b&&(d.splice(c,1),d.push(b));return d};h.prototype._getRendererLegendElements=function(d,c){return a(this,void 0,void 0,function(){return f(this,function(a){return J(d)||G(d)||Q(d)||X(d)||L(d)||N(d)||M(d)||"esri.renderers.DotDensityRenderer"===d.declaredClass?L(d)||N(d)||M(d)||"esri.renderers.PointCloudRGBRenderer"===d.declaredClass?[2,this._constructPointCloudRendererLegendElements(d,c)]:"dot-density"===d.type?[2,this._constructDotDensityRendererLegendElements(d)]:
[2,this._constructRendererLegendElements(d,c)]:(F.warn("Renderer not supported!"),[2,[]])})})};h.prototype._getPointCloudRendererTitle=function(d){return d.legendOptions&&d.legendOptions.title||d.field};h.prototype._constructPointCloudRendererLegendElements=function(d,a){var c=this,b=[],e=null,f=null;if(L(d))e={type:"symbol-table",title:a||this._getPointCloudRendererTitle(d),infos:[]},d.colorClassBreakInfos.forEach(function(d){e.infos.unshift({label:d.label||d.minValue+" - "+d.maxValue,value:[d.minValue,
d.maxValue],symbol:c._getAppliedCloneSymbol(K,d.color)})});else if(N(d)){var f=d.stops,q=null;if(f.length&&(1===f.length&&(q=f[0].color),!q)){var u=f[0].value,h=f[f.length-1].value;null!=u&&null!=h&&(q=E.getColorFromPointCloudStops(u+(h-u)/2,f))}e={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(K,q||K.color)}]};f={type:"color-ramp",title:a||this._getPointCloudRendererTitle(d),borderColor:w.getStroke(K).color,overlayColor:E.getRampOverlayColor(this.layer.opacity),
infos:E.getRampStopsForPointCloud(d.stops)}}else M(d)&&(e={type:"symbol-table",title:a||this._getPointCloudRendererTitle(d),infos:[]},d.colorUniqueValueInfos.forEach(function(d){e.infos.push({label:d.label||d.values.join(", "),value:d.values.join(", "),symbol:c._getAppliedCloneSymbol(K,d.color)})}));e&&e.infos.length&&b.push(e);f&&f.infos.length&&b.push(f);d=b.reduce(function(d,a){return d.concat(a.infos)},[]).filter(function(d){return!!d.symbol}).map(function(d){return c._getSymbolPreview(d)});return l.eachAlways(d).then(function(){return b})};
h.prototype._getElementInfoForDotDensity=function(d,a){var c=d.outline,c=d.dotSize+"-"+a+"-"+d.backgroundColor+"-"+(c&&JSON.stringify(c.toJSON())),b=this._dotDensityUrlCache;d=b.has(c)?b.get(c):D.renderDotDensityPreview(d,a);b.set(c,d);return{opacity:1,src:d.src,preview:d,width:d.width,height:d.height}};h.prototype._constructDotDensityRendererLegendElements=function(d){var a=this,c=d.calculateDotValue(this.view.scale),b={type:"symbol-table",title:{value:c&&Math.round(c),unit:d.legendOptions&&d.legendOptions.unit||
""},infos:[]};d.attributes.forEach(function(c){var l=a._getElementInfoForDotDensity(d,c.color);l.label=c.label||c.valueExpressionTitle||c.field;b.infos.push(l)});return l.resolve([b])};h.prototype._constructRendererLegendElements=function(d,c){return a(this,void 0,void 0,function(){var a,b,e,q,u,h,w,m,z,n,y,B,x,r,g,A,D,k,v,C,L,p,U,E,t,Z,N,I=this;return f(this,function(f){switch(f.label){case 0:return[4,this._loadRenderer(d)];case 1:return a=f.sent(),this._hasSizeRamp=this._hasOpacityRamp=this._hasColorRamp=
!1,[4,this._getVisualVariableLegendElements(a)];case 2:b=f.sent()||[];e={type:"symbol-table",title:c||this._getRendererTitle(a),infos:[]};q=null;u=!1;if(X(a))b.push({type:"heatmap-ramp",title:c,infos:H.getHeatmapRampStops(a)});else if(Q(a)){if(w=(h=a&&a.authoringInfo)&&"relationship"===h.type){if(m=h.focus,z=h.numClasses,n=h.field1,y=h.field2,z&&n&&y){B=this.layer;x=[n,y];r=P.getRotationAngleForFocus(m)||0;g=0;for(A=x;g<A.length;g++)D=A[g],k=D.field,v=D.normalizationField,C={field:this._getFieldAlias(k,
B),normField:v&&this._getFieldAlias(v,B)},L=T.clone(),L.angle=r,e.infos.push({label:C,symbol:L}),r+=90;p=P.getRelationshipRampElement({focus:m,numClasses:z,infos:a.uniqueValueInfos});b.unshift(p)}}else U=a.field,a.uniqueValueInfos.forEach(function(d){d.symbol&&e.infos.push({label:d.label||I._getDomainName(U,d.value)||d.value,value:d.value,symbol:d.symbol})});a.defaultSymbol&&(e.infos.push({label:a.defaultLabel||"others",symbol:a.defaultSymbol}),u=!0)}else if(G(a)){q=this._isUnclassedRenderer(a);if(E=
!q||!this._hasSizeRamp)a.classBreakInfos.forEach(function(d){d.symbol&&e.infos.unshift({label:d.label||(q?null:d.minValue+" - "+d.maxValue),value:[d.minValue,d.maxValue],symbol:d.symbol})}),q&&(e.title=null),this._updateInfosforClassedSizeRenderer(a,e.infos);a.defaultSymbol&&!q&&(e.infos.push({label:a.defaultLabel||"others",symbol:a.defaultSymbol}),u=!0)}else J(a)&&a.symbol&&!this._hasSizeRamp&&e.infos.push({label:a.label,symbol:a.symbol});t=a.defaultSymbol;!t||u||J(a)||q&&!this._hasColorRamp&&!this._hasSizeRamp&&
!this._hasOpacityRamp||b.push({type:"symbol-table",infos:[{label:a.defaultLabel||"others",symbol:t}]});e.infos.length&&b.unshift(e);Z=this._getSymbolConfig("visualVariables"in a&&a.visualVariables);N=b.reduce(function(d,a){return d.concat(a.infos)},[]).filter(function(d){return!(!d||!d.symbol)}).map(function(d){return I._getSymbolPreview(d,Z)});a=null;return[4,l.eachAlways(N)];case 3:return f.sent(),[2,b]}})})};h.prototype._updateInfosforClassedSizeRenderer=function(d,a){var c=d.authoringInfo&&"class-breaks-size"===
d.authoringInfo.type,b=d.classBreakInfos.some(function(d){return C.isVolumetricSymbol(d.symbol)});if(c&&b){var e=I.REAL_WORLD_MAX_SIZE;d=d.classBreakInfos.length;var l=(e-I.REAL_WORLD_MIN_SIZE)/(1<d?d-1:d);a.forEach(function(d,a){d.size=e-l*a})}};h.prototype._getSymbolConfig=function(d){var a=!1,c=!1;if(d)for(var b=0;b<d.length&&(!a||!c);b++){var e=d[b];"size"===e.type&&("height"===e.axis&&(a=!0),"width-and-depth"===e.axis&&(c=!0))}return a&&c?"tall":null};h.prototype._getSymbolPreview=function(d,
a){return D.renderPreviewHTML(d.symbol,{size:d.size,opacity:this.layer.opacity,symbolConfig:a,rotation:d.symbol.angle}).then(function(a){d.preview=a;return d}).catch(function(){d.preview=null;return d})};h.prototype._loadRenderer=function(d){return a(this,void 0,void 0,function(){var a,c,b,e,q=this;return f(this,function(f){switch(f.label){case 0:return a=[],d=d.clone(),[4,this._getMedianColor(d)];case 1:c=f.sent();if(G(d)||Q(d))b=d.classBreakInfos||d.uniqueValueInfos,e=b.map(function(d){return q._fetchSymbol(d.symbol,
c).then(function(a){d.symbol=a}).catch(function(){d.symbol=null})}),Array.prototype.push.apply(a,e);a.push(this._fetchSymbol(d.symbol||d.defaultSymbol,d.defaultSymbol?null:c).then(function(a){q._applySymbolToRenderer(d,a,J(d))}).catch(function(){q._applySymbolToRenderer(d,null,J(d))}));return[2,l.eachAlways(a).then(function(){return d})]}})})};h.prototype._applySymbolToRenderer=function(d,a,c){c?d.symbol=a:d.defaultSymbol=a};h.prototype._getMedianColor=function(d){return a(this,void 0,void 0,function(){var a,
c,b,e,l;return f(this,function(f){switch(f.label){case 0:if(!("visualVariables"in d&&d.visualVariables))return[2,null];a=v.find(d.visualVariables,function(d){return"color"===d.type});if(!a)return[2,null];b=c=null;if(a.stops){if(1===a.stops.length)return[2,a.stops[0].color];c=a.stops[0].value;b=a.stops[a.stops.length-1].value}e=c+(b-c)/2;return[4,new Promise(function(d,a){t(["../../../renderers/visualVariables/support/visualVariableUtils"],d,a)})];case 1:return l=f.sent().getColor,[2,l(a,e)]}})})};
h.prototype._fetchSymbol=function(d,a){var c=this;if(!d)return l.reject();if("web-style"===d.type){var b=d.portal,b=d.name+"-"+d.styleName+"-"+d.styleUrl+"-"+(b&&b.url)+"-"+(b&&b.user&&b.user.username),e=this._webStyleSymbolCache;e.has(b)||e.set(b,d.fetchSymbol());return e.get(b).then(function(d){return c._getAppliedCloneSymbol(d,a)}).catch(function(){F.warn("Fetching web-style failed!");return l.reject()})}return l.resolve(this._getAppliedCloneSymbol(d,a))};h.prototype._getAppliedCloneSymbol=function(d,
a){if(!d)return d;d=d.clone();var c=-1<d.type.indexOf("3d");a=a&&a.toRgba();c?this._applyColorTo3dSymbol(d,a):d.color&&(d.color=new m(a||d.color));return d};h.prototype._applyColorTo3dSymbol=function(d,a){a&&d.symbolLayers.forEach(function(d){d&&(d.material||(d.material={}),d.material.color=new m(a))})};h.prototype._getVisualVariableLegendElements=function(d){return a(this,void 0,void 0,function(){var b,e,q,u,h,w,m,z,n,B,x,r=this;return f(this,function(g){switch(g.label){case 0:if(!("visualVariables"in
d&&d.visualVariables))return[2,null];b=d.visualVariables;e=[];q=[];u=[];h=this.layer;w=h.opacity;b.forEach(function(d){"color"===d.type?e.push(d):"size"===d.type?q.push(d):"opacity"===d.type&&u.push(d)});m=e.concat(q,u);0===e.length&&G(d)&&d.classBreakInfos&&1===d.classBreakInfos.length&&(z=(B=d.classBreakInfos[0])&&B.symbol);0===e.length&&J(d)&&(z=d.symbol);z&&(-1<z.type.indexOf("3d")?(x=z.symbolLayers.getItemAt(0),"water"===x.type?c.isSome(x.color)&&(n=x.color):c.isSome(x.material)&&c.isSome(x.material.color)&&
(n=x.material.color)):z.url||(n=z.color),n&&(n=n.toRgba()));return[4,l.all(m.map(function(c){return a(r,void 0,void 0,function(){var a,b,e,l,q,u,m,z,x,B,r;return f(this,function(f){switch(f.label){case 0:if(c.legendOptions&&!1===c.legendOptions.showLegend)return[3,8];a=this._getRampTitle(c,h);b=E.getRampBorderColor(d);e=E.getRampOverlayColor(w);l=null;if("color"!==c.type)return[3,2];q={type:"color-ramp",title:a,borderColor:b,overlayColor:e};return[4,E.getRampStops(d,c)];case 1:return l=(q.infos=f.sent(),
q),this._hasColorRamp||(this._hasColorRamp=!(null==l.infos||!l.infos.length)),[3,7];case 2:if("size"!==c.type)return[3,5];m=(u="getField"in h&&h.getField&&h.getField(c.field))&&y.isDateField(u);z={type:"size-ramp",title:a};x=I.getRampStops;B=[d,c];return[4,this._getMedianColor(d)];case 3:return[4,x.apply(void 0,B.concat([f.sent(),this.scale,this.view,m]))];case 4:return l=(z.infos=f.sent(),z),this._hasSizeRamp||(this._hasSizeRamp=!(null==l.infos||!l.infos.length)),[3,7];case 5:if("opacity"!==c.type)return[3,
7];r={type:"opacity-ramp",title:a,borderColor:b,overlayColor:e};return[4,E.getRampStops(d,c,n)];case 6:l=(r.infos=f.sent(),r),this._hasOpacityRamp||(this._hasOpacityRamp=!(null==l.infos||!l.infos.length)),f.label=7;case 7:return[2,l.infos&&l];case 8:return[2]}})})}))];case 1:return[2,g.sent().filter(function(d){return!!d})]}})})};h.prototype._getDomainName=function(d,a){if(d&&"function"!==typeof d){var c=this.layer;return(c=(d=c.getField&&c.getField(d))&&c.getFieldDomain?c.getFieldDomain(d.name):
null)&&c.codedValues?c.getName(a):null}return null};h.prototype._getRampTitle=function(d,a){var c=d.field,b=d.normalizationField,e=!1,l=!1,f=!1,q=null,c="function"===typeof c?null:c,b="function"===typeof b?null:b;if(null!=(d.legendOptions&&d.legendOptions.title))q=d.legendOptions.title;else if(d.valueExpressionTitle)q=d.valueExpressionTitle;else{if("renderer"in a&&a.renderer&&"authoringInfo"in a.renderer&&a.renderer.authoringInfo&&a.renderer.authoringInfo.visualVariables)for(d=a.renderer.authoringInfo.visualVariables,
q=0;q<d.length;q++){var u=d[q];if("color"===u.type){if("ratio"===u.style){e=!0;break}if("percent"===u.style){l=!0;break}if("percent-of-total"===u.style){f=!0;break}}}q={field:c&&this._getFieldAlias(c,a),normField:b&&this._getFieldAlias(b,a),ratio:e,ratioPercent:l,ratioPercentTotal:f}}return q};h.prototype._getRendererTitle=function(d,a){if(d.legendOptions&&d.legendOptions.title)return d.legendOptions.title;if(d.valueExpressionTitle)return d.valueExpressionTitle;var c=this.layer,b=d.field,e=null,l=
null;G(d)&&(e=d.normalizationField,l="percent-of-total"===d.normalizationType);b="function"===typeof b?null:b;e="function"===typeof e?null:e;d=null;if(b||e)d={field:a?b:b&&this._getFieldAlias(b,c),normField:a?e:e&&this._getFieldAlias(e,c),normByPct:l};return d};h.prototype._getFieldAlias=function(d,a){var c="popupTemplate"in a&&a.popupTemplate,c=c&&c.fieldInfos;a="function"===typeof d?null:"getField"in a&&a.getField&&a.getField(d);var b=null;c&&c.some(function(a){if(d===a.fieldName)return b=a,!0});
var c=b||a,e=null;c&&(e=b&&b.label||a&&a.alias||"name"in c&&c.name||"fieldName"in c&&c.fieldName);return e};h.prototype._isUnclassedRenderer=function(d){var a=d.visualVariables,c=!1;G(d)&&d.classBreakInfos&&1===d.classBreakInfos.length&&a&&(c=d.field?a.some(function(a){return!(!a||d.field!==a.field||(d.normalizationField||a.normalizationField)&&d.normalizationField!==a.normalizationField)}):!!a.length);return c};b([A.property()],h.prototype,"children",void 0);b([A.property()],h.prototype,"layer",
void 0);b([A.property()],h.prototype,"legendElements",void 0);b([A.property()],h.prototype,"parent",void 0);b([A.property({readOnly:!0})],h.prototype,"ready",null);b([A.property()],h.prototype,"scale",void 0);b([A.property({dependsOn:["layer.renderer?.valueExpression?","layer.renderer?.visualVariables?"],readOnly:!0})],h.prototype,"isScaleDriven",null);b([A.property()],h.prototype,"title",void 0);b([A.property({dependsOn:["ready"],readOnly:!0,value:0})],h.prototype,"version",null);b([A.property()],
h.prototype,"view",void 0);return h=b([A.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],h)}(A.declared(r))})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./sublayerUtils ./timeUtils ../../views/View".split(" "),function(t,p,g,k,b,a,f,m,n,h){Object.defineProperty(p,"__esModule",{value:!0});
var r={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};t=function(a){function e(){var b=null!==a&&a.apply(this,arguments)||this;b._scale=null;b.view=null;return b}k(e,a);Object.defineProperty(e.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var a=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});
return a.length?JSON.stringify(a):null},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasDynamicLayers",{get:function(){return m.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"layer",{set:function(a){var b=this;this._get("layer")!==a&&(this._set("layer",a),this._layerHandles&&(this._layerHandles.forEach(function(a){return a.remove()}),this._layerHandles.length=0),a&&(this._layerHandles=
[a.allSublayers.on("change",function(){return b.notifyChange("visibleSublayers")}),a.on("sublayer-update",function(a){return b.notifyChange(r[a.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"layers",{get:function(){var a=this.visibleSublayers;return a?a.length?"show:"+a.map(function(a){return a.id}).join(","):"show:-1":null},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"layerDefs",{get:function(){var a=this.visibleSublayers.filter(function(a){return null!=
a.definitionExpression});return a.length?JSON.stringify(a.reduce(function(a,c){a[c.id]=c.definitionExpression;return a},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"scale",{get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(a){this.view||(this._scale=a,this.notifyChange("scale"))},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"version",{get:function(){this.layers;this.layerDefs;this.dynamicLayers;this.timeExtent;
var a=this.layer;a.dpi;a.imageFormat;a.imageTransparency;a.gdbVersion;return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"visibleSublayers",{get:function(){var a=this,b=this.layer.sublayers,c=[],e=function(b){var l=a.scale,f=0===b.minScale||l<=b.minScale,q=0===b.maxScale||l>=b.maxScale;b.visible&&(0===l||f&&q)&&(b.sublayers?b.sublayers.forEach(e):c.unshift(b))};b&&b.forEach(e);b=this._get("visibleSublayers");
return!b||b.length!==c.length||b.some(function(a,b){return c[b]!==a})?c:b},enumerable:!0,configurable:!0});e.prototype.toJSON=function(){var a=this.layer,a={dpi:a.dpi,format:a.imageFormat,transparent:a.imageTransparency,gdbVersion:a.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?a.dynamicLayers=this.dynamicLayers:a=g({},a,{layers:this.layers,layerDefs:this.layerDefs});return a};b([f.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],e.prototype,"dynamicLayers",
null);b([f.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],e.prototype,"hasDynamicLayers",null);b([f.property()],e.prototype,"layer",null);b([f.property({readOnly:!0,dependsOn:["visibleSublayers"]})],e.prototype,"layers",null);b([f.property({readOnly:!0,dependsOn:["visibleSublayers"]})],e.prototype,"layerDefs",null);b([f.property({type:Number,dependsOn:["view.scale"]})],e.prototype,"scale",null);b([f.property(n.combinedViewLayerTimeExtentProperty)],
e.prototype,"timeExtent",void 0);b([f.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion timeExtent".split(" ")})],e.prototype,"version",null);b([f.property({type:h})],e.prototype,"view",void 0);b([f.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],e.prototype,"visibleSublayers",null);return e=b([f.subclass("esri.layers.mixins.ExportImageParameters")],e)}(f.declared(a));p.ExportImageParameters=t})},"esri/layers/support/sublayerUtils":function(){define(["require",
"exports","./layerSourceUtils"],function(t,p,g){function k(b,a){function f(a){var b=a.sublayers;m.unshift(a.id);b&&b.forEach(f)}if(!b||!b.length)return!0;var m=[];a.forEach(f);if(b.length>m.length)return!1;a=0;for(var n=m.length,h=0;h<b.length;h++){for(var r=b[h].id;a<n&&m[a]!==r;)a++;if(a>=n)return!1}return!0}Object.defineProperty(p,"__esModule",{value:!0});p.isExportDynamic=function(b,a,f){return b.some(function(a){var b=a.source;return!(!b||b.type===g.MAPLAYER&&b.mapLayerId===a.id&&(!b.gdbVersion||
b.gdbVersion===f.gdbVersion))||null!=a.renderer||null!=a.labelingInfo||a.hasOwnProperty("opacity")&&null!=a.opacity||a.hasOwnProperty("labelsVisible")&&null!=a.labelsVisible})?!0:!k(b,a)};p.sameStructureAsService=function(b,a){return a.flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray().reverse().every(function(a,m){return(m=b[m])&&a.id===m.id&&(null==a.sublayers&&null==m.sublayers||null!=a.sublayers&&null!=m.sublayers&&a.sublayers.map(function(a){return a.id}).join(",")===
m.sublayers.map(function(a){return a.id}).join(","))})}})},"esri/symbols/support/gfxUtils":function(){define("require exports ../../core/tsSupport/assignHelper ../../Color ../../request ../../core/ItemCache ../../core/promiseUtils ../../core/screenUtils".split(" "),function(t,p,g,k,b,a,f,m){function n(a){if(!a)return null;var c,b=m.pt2px(a.width);switch(a.type){case "simple-fill":case "picture-fill":case "simple-marker":c=n(a.outline);break;case "simple-line":"none"!==a.style&&0!==b&&(c={color:a.color,
style:u(a.style),width:b,cap:a.cap,join:"miter"===a.join?m.pt2px(a.miterLimit):a.join});break;default:c=null}return c}Object.defineProperty(p,"__esModule",{value:!0});var h=t.toUrl("../../symbols/patterns/"),r={type:"pattern",x:0,y:0,width:0,height:0,src:""},v={left:"start",center:"middle",right:"end",justify:"start"},e={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},q=new a(1E3);p.getSVGAlign=function(a){return a=(a=a.horizontalAlignment)&&v[a.toLowerCase()]||
"middle"};p.getSVGBaseline=function(a){return(a=a.verticalAlignment)&&e[a.toLowerCase()]||"alphabetic"};p.getSVGBaselineShift=function(a){return"bottom"===a.verticalAlignment?"super":null};p.getFill=function(a){var c=a.style,b=null;if(a)switch(a.type){case "simple-marker":"cross"!==c&&"x"!==c&&(b=a.color);break;case "simple-fill":"solid"===c?b=a.color:"none"!==c&&(b=g({},r,{src:h+c+".png",width:8,height:8}));break;case "picture-fill":b=g({},r,{src:a.url,width:m.pt2px(a.width)*a.xscale,height:m.pt2px(a.height)*
a.yscale,x:m.pt2px(a.xoffset),y:m.pt2px(a.yoffset)});break;case "text":b=a.color}return b};p.getPatternUrlWithColor=function(a,e){var c=a+"-"+e;return void 0!==q.get(c)?f.resolve(q.get(c)):b(a,{responseType:"image"}).then(function(a){a=a.data;var b=a.naturalWidth,l=a.naturalHeight,f=document.createElement("canvas");f.width=b;f.height=l;var d=f.getContext("2d");d.fillStyle=e;d.fillRect(0,0,b,l);d.globalCompositeOperation="destination-in";d.drawImage(a,0,0);a=f.toDataURL();q.put(c,a);return a})};p.getStroke=
n;p.create2DColorRamp=function(a){var b=a.colors,c=a.numClasses,e=a.size;a=a.surface.createGroup();for(var e=(e||75)/c,f=0;f<c;f++)for(var q=f*e,u=0;u<c;u++){var d=b[f][u];a.createRect({x:u*e,y:q,width:e,height:e}).setFill(d).setStroke(null)}return a};var u=function(){var a={};return function(b){if(a[b])return a[b];var c=b.replace(/-/g,"");return a[b]=c}}();p.defaultThematicColor=new k([128,128,128])})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(t,p,g){return function(){function k(b,
a){this._storage=new g.MemCacheStorage;this._storage.maxSize=b;a&&this._storage.registerRemoveFunc("",a)}k.prototype.put=function(b,a){this._storage.put(b,a,1,1)};k.prototype.pop=function(b){return this._storage.pop(b)};k.prototype.get=function(b){return this._storage.get(b)};k.prototype.clear=function(){this._storage.clearAll()};k.prototype.destroy=function(){this._storage.clearAll()};return k}()})},"esri/core/MemCache":function(){define(["require","exports","./iteratorUtils","./PooledArray","./string"],
function(t,p,g,k,b){Object.defineProperty(p,"__esModule",{value:!0});t=function(){function a(a,b,n){this._namespace=a;this._storage=b;this._removeFunc=!1;this._miss=this._hit=0;this._storage.register(this);this._namespace+=":";n&&(this._storage.registerRemoveFunc(this._namespace,n),this._removeFunc=!0)}Object.defineProperty(a.prototype,"namespace",{get:function(){return this._namespace.slice(0,-1)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hitRate",{get:function(){return this._hit/
(this._hit+this._miss)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._storage.size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxSize",{get:function(){return this._storage.maxSize},enumerable:!0,configurable:!0});a.prototype.resetHitRate=function(){this._hit=this._miss=0};a.prototype.destroy=function(){this._storage.clear(this._namespace);this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace);this._storage.deregister(this)};
a.prototype.put=function(a,b,n,h){void 0===h&&(h=1);this._storage.put(this._namespace+a,b,n,h)};a.prototype.get=function(a){a=this._storage.get(this._namespace+a);void 0===a?++this._miss:++this._hit;return a};a.prototype.pop=function(a){a=this._storage.pop(this._namespace+a);void 0===a?++this._miss:++this._hit;return a};a.prototype.clear=function(){this._storage.clear(this._namespace)};a.prototype.clearAll=function(){this._storage.clearAll()};a.prototype.getStats=function(){return this._storage.getStats()};
a.prototype.resetStats=function(){this._storage.resetStats()};return a}();p.MemCache=t;t=function(){function a(a){void 0===a&&(a=10485760);this._maxSize=a;this._db=new Map;this._miss=this._hit=this._size=0;this._removeFuncs=[];this._users=new k}a.prototype.register=function(a){this._users.push(a)};a.prototype.deregister=function(a){this._users.removeUnordered(a)};a.prototype.registerRemoveFunc=function(a,b){this._removeFuncs.push([a,b])};a.prototype.deregisterRemoveFunc=function(a){this._removeFuncs=
this._removeFuncs.filter(function(b){return b[0]!==a})};Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxSize",{get:function(){return this._maxSize},set:function(a){this._maxSize=Math.max(a,0);this._size>this._maxSize&&this._removeEntries()},enumerable:!0,configurable:!0});a.prototype.put=function(a,b,n,h){if(this._db.has(a)){var f=this._db.get(a);this._size-=f.size;this._db.delete(a);this._notifyRemoved(a,
f.entry)}n>this._maxSize?this._notifyRemoved(a,b):void 0===b?console.warn("Refusing to cache undefined entry "):!n||0>n?console.warn("Refusing to cache entry with invalid size "+n):(this._db.set(a,{entry:b,size:n,lifetime:h,lives:h}),this._size+=n,this._size>this._maxSize&&this._removeEntries())};a.prototype.pop=function(a){if(this._db.has(a)){var b=this._db.get(a);this._size-=b.size;this._db.delete(a);++this._hit;return b.entry}++this._miss};a.prototype.get=function(a){var b=this._db.get(a);if(void 0===
b)++this._miss;else return this._db.delete(a),b.lives=b.lifetime,this._db.set(a,b),++this._hit,b.entry};a.prototype.getStats=function(){var a=this,m={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},n={},h=[];this._db.forEach(function(e,f){var c=e.lifetime;h[c]=(h[c]||0)+1;a._users.forEach(function(a){a=a.namespace;if(b.startsWith(f,a))return n[a]=(n[a]||0)+e.size,!1})});var r={};this._users.forEach(function(a){var b=
a.namespace;!isNaN(a.hitRate)&&0<a.hitRate?(n[b]=n[b]||0,r[b]=Math.round(100*a.hitRate)+"%"):r[b]="0%"});var g=Object.keys(n);g.forEach(function(b){return n[b]=n[b]/a._size*100});g.sort(function(a,b){return n[b]-n[a]});g.forEach(function(a){return m[a]=Math.round(n[a])+"% / "+r[a]});for(g=0;g<h.length;++g){var e=h[g];e&&(m["Lifetime "+g]=Math.round(e/this._db.size*100)+"%")}return m};a.prototype.resetStats=function(){this._hit=this._miss=0;this._users.forEach(function(a){return a.resetHitRate()})};
a.prototype.clear=function(a){var f=this;this._db.forEach(function(n,h){b.startsWith(h,a)&&(f._size-=n.size,f._db.delete(h),f._notifyRemoved(h,n.entry))})};a.prototype.clearAll=function(){var a=this;this._db.forEach(function(b,f){a._notifyRemoved(f,b.entry)});this._size=0;this._db.clear()};a.prototype._getHitRate=function(){return this._hit/(this._hit+this._miss)};a.prototype._notifyRemoved=function(a,m){this._removeFuncs.forEach(function(f){if(b.startsWith(a,f[0]))f[1](m)})};a.prototype._removeEntries=
function(){var a=this;g.everyMap(this._db,function(b,f){a._db.delete(f);1>=b.lives?(a._size-=b.size,a._notifyRemoved(f,b.entry)):(--b.lives,a._db.set(f,b));return a._size>.9*a.maxSize})};return a}();p.MemCacheStorage=t})},"esri/core/iteratorUtils":function(){define(["require","exports"],function(t,p){Object.defineProperty(p,"__esModule",{value:!0});p.everyMap=Map.prototype.entries?function(g,k){g=g.entries();for(var b=g.next();!b.done;b=g.next())if(!1===k(b.value[1],b.value[0]))return!1;return!0}:
function(g,k){var b=!0;g.forEach(function(a,f){b&&(b=!1!==k(a,f))});return b}})},"esri/core/PooledArray":function(){define(["require","exports","./tsSupport/generatorHelper","./arrayUtils","./HeapSort"],function(t,p,g,k,b){return function(){function a(a){var b=this;this.data=[];this._length=0;this._allocator=null;this._deallocator=function(){};this._shrink=function(){};this._hint=new k.RemoveHint;a&&(a.initialSize&&(this.data=Array(a.initialSize)),a.allocator?(this._allocator=a.allocator,this._deallocator=
a.deallocator):"deallocator"in a&&(this._deallocator=a.deallocator),a.shrink&&(this._shrink=function(){b.data.length>1.5*b.length&&(b.data.length=Math.floor(1.1*b.length))}))}a.prototype.toArray=function(){return this.data.slice(0,this.length)};Object.defineProperty(a.prototype,"length",{get:function(){return this._length},set:function(a){if(a>this._length)if(this._allocator)for(;this._length<a;)this.data[this._length++]=this._allocator(this.data[this._length]);else this._length=a;else{if(this._deallocator)for(var b=
a;b<this._length;++b)this.data[b]=this._deallocator(this.data[b]);this._length=a;this._shrink()}},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.length=0};a.prototype.prune=function(){this.clear();this.data=[]};a.prototype.equal=function(a){return k.equals(this.data,a.data)};a.prototype.push=function(a){return this.data[this._length++]=a};a.prototype.pushArray=function(a,b){void 0===b&&(b=a.length);for(var f=0;f<b;f++)this.data[this._length++]=a[f];return this.back()};a.prototype.pushNew=
function(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));++this._length;return this.back()};a.prototype.pop=function(){if(0!==this.length){var a=this.data[this.length-1];--this.length;this._shrink();return a}};a.prototype.removeMany=function(a){var b=this,f=[];this.data=this.data.filter(function(h,n){if(n>=b.length)return!1;if(0>a.indexOf(h))return!0;f.push(h);return!1});this._length=this.data.length;return f};a.prototype.iterableRemoveMany=function(a,b){var f,
h;return g(this,function(n){switch(n.label){case 0:f=[],h=0,n.label=1;case 1:if(!(h<this.length)||h>=this.length)return[3,4];0>a.indexOf(this.data[h])&&f.push(this.data[h]);return b()?[4]:[3,3];case 2:n.sent(),n.label=3;case 3:return++h,[3,1];case 4:return this.data=f,this._length=this.data.length,[2]}})};a.prototype.removeUnordered=function(a){a=k.removeUnordered(this.data,a,this.length,this._hint);void 0!==a&&--this.length;return a};a.prototype.removeUnorderedIndex=function(a){if(!(a>=this.length||
0>a))return this.swapElements(a,this.length-1),this.pop()};a.prototype.removeUnorderedMany=function(a,b,n){void 0===b&&(b=a.length);this.length=k.removeUnorderedMany(this.data,a,this.length,b,this._hint,n)};a.prototype.front=function(){if(0!==this.length)return this.data[0]};a.prototype.back=function(){if(0!==this.length)return this.data[this.length-1]};a.prototype.swapElements=function(a,b){var f;a>=this.length||b>=this.length||a===b||(f=[this.data[b],this.data[a]],this.data[a]=f[0],this.data[b]=
f[1])};a.prototype.sort=function(a){b.sort(this.data,0,this.length,a)};a.prototype.iterableSort=function(a,m){return b.iterableSort(this.data,0,this.length,a,m)};a.prototype.some=function(a,b){for(var f=0;f<this.length;++f)if(a.call(b,this.data[f],f,this.data))return!0;return!1};a.prototype.find=function(a,b){for(var f=0;f<this.length;++f){var h=this.data[f];if(a.call(b,h,f,this.data))return h}};a.prototype.filterInPlace=function(a,b){for(var f=0,h=0;h<this._length;++h){var g=this.data[h];a.call(b,
g,h,this.data)&&(this.data[h]=this.data[f],this.data[f]=g,f++)}if(this._deallocator)for(h=f;h<this._length;h++)this.data[h]=this._deallocator(this.data[h]);this._length=f;return this};a.prototype.forEach=function(a,b){for(var f=this.length,h=0;h<Math.min(this.length,f);++h)a.call(b,this.data[h],h,this.data)};a.prototype.iterableForEach=function(){var a;return g(this,function(b){switch(b.label){case 0:a=0,b.label=1;case 1:return a<this.length?[4,this.data[a]]:[3,4];case 2:b.sent(),b.label=3;case 3:return++a,
[3,1];case 4:return[2]}})};a.prototype.map=function(a,b){for(var f=Array(this.length),h=0;h<this.length;++h)f[h]=a.call(b,this.data[h],h,this.data);return f};return a}()})},"esri/core/HeapSort":function(){define(["require","exports","./tsSupport/generatorHelper"],function(t,p,g){var k;(function(b){function a(a,b,h,f){for(var g=b,e=h>>>1,q=a[g-1];b<=e;){b=g<<1;b<h&&0>f(a[b-1],a[b])&&++b;var u=a[b-1];if(0>=f(u,q))break;a[g-1]=u;g=b}a[g-1]=q}function f(a,b){return a<b?-1:a>b?1:0}b.sort=function(b,g,
h,r){void 0===g&&(g=0);void 0===h&&(h=b.length);void 0===r&&(r=f);for(var n=h>>>1;n>g;n--)a(b,n,h,r);for(var e=g+1,n=h-1;n>g;n--)h=b[g],b[g]=b[n],b[n]=h,a(b,e,n,r)};b.iterableSort=function(b,n,h,r,k){var e,q,u;return g(this,function(c){switch(c.label){case 0:void 0===n&&(n=0),void 0===h&&(h=b.length),void 0===r&&(r=f),e=h>>>1,c.label=1;case 1:if(!(e>n))return[3,4];a(b,e,h,r);return k&&k()?[4]:[3,3];case 2:c.sent(),c.label=3;case 3:return e--,[3,1];case 4:q=n+1,e=h-1,c.label=5;case 5:if(!(e>n))return[3,
8];u=b[n];b[n]=b[e];b[e]=u;a(b,q,e,r);return k&&k()?[4]:[3,7];case 6:c.sent(),c.label=7;case 7:return e--,[3,5];case 8:return[2]}})}})(k||(k={}));return k})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/compilerUtils ../../core/maybe ../../core/promiseUtils ./previewSymbol2D ./previewSymbol3D ./previewWebStyleSymbol ./utils".split(" "),function(t,p,g,k,b,a,f,m,n,h,r){function v(a,c){switch(a.type){case "web-style":return h.previewWebStyleSymbol(a,
v,c);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return n.previewSymbol3D(a,c);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":case "cim":return m.previewSymbol2D(a,c);default:b.neverReached(a)}}function e(a){return a&&"opacity"in a?a.opacity*e(a.parent):1}Object.defineProperty(p,"__esModule",{value:!0});var q=null;p.renderDotDensityPreview=function(a,b,e){var c=a.backgroundColor,l=a.outline;a=a.dotSize;
var h=e&&e.swatchSize||22,f=Math.round(h*h/Math.pow(a,2)*.8),u=window.devicePixelRatio;e=document.createElement("canvas");var d=h*u;e.width=d;e.height=d;e.style.width=e.width/u+"px";e.style.height=e.height/u+"px";var w=e.getContext("2d");c&&(w.fillStyle=c.toCss(!0),w.fillRect(0,0,d,d),w.fill());w.fillStyle=b.toCss(!0);if(q&&q.length/2===f)for(b=0;b<2*f;b+=2){var c=q[b],g=q[b+1];w.fillRect(c,g,a*u,a*u);w.fill()}else for(q=[],b=0;b<2*f;b+=2)c=Math.floor(Math.random()*(d-0+1)+0),g=Math.floor(Math.random()*
(d-0+1)+0),q.push(c,g),w.fillRect(c,g,a*u,a*u),w.fill();l&&(l.color&&(w.strokeStyle=l.color.toCss(!0)),w.lineWidth=l.width,w.strokeRect(0,0,d,d));l=new Image(h,h);l.src=e.toDataURL();return l};p.renderPreviewHTML=v;p.getDisplayedSymbol=function(b,c){return k(this,void 0,void 0,function(){var l,h,q,u,x,y,d,w,n,m,k,v,p,I,J,G;return g(this,function(g){switch(g.label){case 0:if(!b)return[2];l=e(b.layer||b.sourceLayer);if(a.isSome(b.symbol))return h=b.symbol.clone(),r.applyColorToSymbol(h,null,l),[2,h];
q=b.get("layer.renderer")||b.get("sourceLayer.renderer");return[4,q.getSymbolAsync(b)];case 1:u=g.sent();if(!u)return[2];u=u.clone();return!("visualVariables"in q)||"visualVariables"in q&&!q.visualVariables||"visualVariables"in q&&q.visualVariables&&!q.visualVariables.length?[2,u]:[4,f.create(function(a){return t(["../../renderers/visualVariables/support/visualVariableUtils"],a)})];case 2:x=g.sent();y=[];d=[];w=[];n=[];m=0;for(k=q.visualVariables;m<k.length;m++)switch(v=k[m],v.type){case "color":y.push(v);
break;case "opacity":d.push(v);break;case "rotation":n.push(v);break;case "size":w.push(v)}I=(p=!!y.length&&y[y.length-1])?x.getColor(p,b,c):null;G=(J=!!d.length&&d[d.length-1])?x.getOpacity(J,b,c):null;null!=l&&(G=null!=G?G*l:l);r.applyColorToSymbol(u,I,G);w.forEach(function(a){return r.applySizeToSymbol(u,x.getSize(a,b,c),a.axis)});n.forEach(function(a){return r.applyRotationToSymbol(u,x.getRotationAngle(a,b,c),a.axis)});return[2,u]}})})}})},"esri/symbols/support/previewSymbol2D":function(){define("require exports ../../core/Error ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils".split(" "),
function(t,p,g,k,b,a,f,m){function n(a,b){var c=r.getContext("2d"),e=[];b&&(b.weight&&e.push(b.weight),b.size&&e.push(b.size+"px"),b.family&&e.push(b.family));c.font=e.join(" ");return c.measureText(a).width}function h(a){if(0===a.length)return 0;if(2<a.length){var h=b.px2pt(1),c=parseFloat(a);switch(a.slice(-2)){case "px":return c;case "pt":return c*h;case "in":return 72*c*h;case "pc":return 12*c*h;case "mm":return c*v*h;case "cm":return c*e*h}}return parseFloat(a)}Object.defineProperty(p,"__esModule",
{value:!0});var r=document.createElement("canvas"),v=7.2/2.54,e=72/2.54;p.previewSymbol2D=function(e,u){var c=u&&u.size?b.pt2px(u.size):null,l=u&&u.maxSize?b.pt2px(u.maxSize):null,q=u&&null!=u.opacity?u.opacity:null,r=u&&null!=u.rotation?u.rotation:null,A=a.getStroke(e),x={shape:null,fill:null,stroke:A};A&&A.width&&(A.width=Math.min(A.width,80));var y=0,d=0,w=A&&A.width||0,D=!1;switch(e.type){case "simple-marker":A=e.style;d=y=c=Math.min(c||b.pt2px(e.size),l||120);switch(A){case "circle":x.shape=
{type:"circle",cx:0,cy:0,r:.5*c};break;case "cross":x.shape={type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[y,.5*d]},{command:"M",values:[.5*y,0]},{command:"L",values:[.5*y,d]},{command:"E",values:[]}]};break;case "diamond":x.shape={type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[.5*y,0]},{command:"L",values:[y,.5*d]},{command:"L",values:[.5*y,d]},{command:"Z",values:[]}]};break;case "square":x.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",
values:[y,0]},{command:"L",values:[y,d]},{command:"L",values:[0,d]},{command:"Z",values:[]}]};break;case "triangle":x.shape={type:"path",path:[{command:"M",values:[.5*y,0]},{command:"L",values:[y,d]},{command:"L",values:[0,d]},{command:"Z",values:[]}]};break;case "x":x.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[y,d]},{command:"M",values:[y,0]},{command:"L",values:[0,d]},{command:"E",values:[]}]};break;case "path":D=!0,x.shape={type:"path",path:e.path||""}}break;case "simple-line":w=
Math.min(c||w,l||80);y=22<w?2*w:40;d=w;A.width=w;w=0;x.shape={type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[y,.5*d]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":d=y=c=Math.min(c,l||120);D=!0;x.shape=f.shapes.fill[0];break;case "picture-marker":var l=l||120,A=b.pt2px(e.width),C=b.pt2px(e.height),c=Math.min(c||Math.max(A,C),l),C=A/C,A=1>=C?Math.ceil(c*C):c,C=1>=C?c:Math.ceil(c/C),y=A,d=C;x.shape={type:"image",x:-Math.round(A/2),y:-Math.round(C/2),width:A,
height:C,src:e.url||""};break;case "text":var A=e.text||"Aa",C=e.font,c=Math.min(c||b.pt2px(C.size),l||120),v=n(A,{weight:C.weight,size:c,family:C.family}),y=(l=/[\uE600-\uE6FF]/.test(A))?c:v,d=c,v=.25*h((C?c:0).toString());l&&(v+=5);x.shape={type:"text",text:A,x:0,y:v,align:"middle",decoration:C&&C.decoration,rotated:e.rotated,kerning:e.kerning};x.font=C&&{size:c,style:C.style,decoration:C.decoration,weight:C.weight,family:C.family}}if(!x.shape)return k.reject(new g("symbolPreview: renderPreviewHTML2D",
"symbol not supported."));var y=(y||22)+w+1,d=(d||22)+w+1,p=a.getFill(e),w=e.color,c=null;p&&"pattern"===p.type&&w&&"picture-fill"!==e.type?c=a.getPatternUrlWithColor(p.src,w.toCss(!0)).then(function(a){p.src=a;x.fill=p;return x}):(x.fill=p,c=k.resolve(x));return c.then(function(a){return m.renderSymbol([[a]],[y,d],{node:u&&u.node,scale:D,opacity:q,rotation:r})})}})},"esri/symbols/support/previewUtils":function(){define(["require","exports"],function(t,p){Object.defineProperty(p,"__esModule",{value:!0});
p.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",
path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",
path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},
{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};p.getPathSymbolShapes=function(g){var k=22,b=22;1>g?k*=.75:1<g&&(b*=1.25);return[{type:"path",path:[{command:"M",values:[22,0]},{command:"L",values:[19.25,0]},{command:"L",values:[0,b-11]},{command:"L",values:[k-11,b-11]},{command:"Z",
values:[]}]},{type:"path",path:[{command:"M",values:[22,0]},{command:"L",values:[22,2.75]},{command:"L",values:[k-11,22]},{command:"L",values:[k-11,b-11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[k-11,b-11]},{command:"L",values:[0,b-11]},{command:"L",values:[0,22]},{command:"L",values:[k-11,22]},{command:"Z",values:[]}]}]};p.getExtrudeSymbolShapes=function(g){g*=.5;return[{type:"path",path:[{command:"M",values:[0,.7*11]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[6.6,
22*.7+g]},{command:"L",values:[0,22*.7+g-.7*11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+g]},{command:"L",values:[22,g]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[0,.7*11]},{command:"Z",values:[]}]}]};p.getWaterSymbolShapes=function(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},
{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},
{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]};
p.getCubeShapes=function(g,k){var b=k?20:g,a=k?4:6,a=b=22>=b?b-.5*a:b-a;k=k?.35*b:.5*b;return[{type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[a,.5*k]},{command:"L",values:[.5*a,k]},{command:"L",values:[0,.5*k]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*k]},{command:"L",values:[.5*a,k]},{command:"L",values:[.5*a,g]},{command:"L",values:[0,g-.5*k]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*a,k]},{command:"L",values:[.5*a,
g]},{command:"L",values:[a,g-.5*k]},{command:"L",values:[a,.5*k]},{command:"Z",values:[]}]}]};p.getCylinderShapes=function(g,k){var b=k?20:g;k=k?4:6;b=22>=b?b-.5*k:b-k;k=.5*b;var a=.15*b;g-=a;return[{type:"ellipse",cx:.5*b,cy:g,rx:k,ry:a},{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,g]},{command:"L",values:[b,g]},{command:"L",values:[b,a]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*b,cy:a,rx:k,ry:a}]};p.getConeShapes=function(g,k){var b=k?20:g;k=k?4:6;b=22>=b?b-.5*k:b-
k;k=.15*b;var a=b;g-=k;return[{type:"ellipse",cx:.5*b,cy:g,rx:.5*b,ry:k},{type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[a,g]},{command:"L",values:[0,g]},{command:"Z",values:[]}]}]};p.getInvertedConeShapes=function(g){var k=g,k=22>k?k-3:k-6,b=.15*k,a=k;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,0]},{command:"L",values:[.5*a,g-b]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*k,cy:0,rx:.5*k,ry:b}]};p.getDiamondShapes=function(g){var k=g,k=22>
k?k-2:k-4,b=Math.floor(g/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*k,0]},{command:"L",values:[k,.5*g-b]},{command:"L",values:[.45*k-b,.5*g+b]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*k,0]},{command:"L",values:[.45*k-b,.5*g+b]},{command:"L",values:[0,.5*g-b]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*g-b]},{command:"L",values:[.45*k-b,.5*g+b]},{command:"L",values:[.45*k,g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",
values:[.45*k,g]},{command:"L",values:[k,.5*g-b]},{command:"L",values:[.45*k-b,.5*g+b]},{command:"Z",values:[]}]}]};p.getTetrahedronShapes=function(g){var k=g,k=22>k?k-1:k-2;return[{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",values:[g,k]},{command:"L",values:[.45*g,.6*k]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",values:[.45*g,.6*k]},{command:"L",values:[0,k]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,k]},
{command:"L",values:[.45*g,.6*k]},{command:"L",values:[g,k]},{command:"Z",values:[]}]}]}})},"esri/symbols/support/renderUtils":function(){define("require exports dojox/gfx dojox/gfx/matrix ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/has ../../core/promiseUtils".split(" "),function(t,p,g,k,b,a,f,m,n,h){function r(a){return a.map(function(a){return a.command+" "+a.values.join(",")}).join(" ").trim()}function v(a,b,c,e){var l=e&&e.node||document.createElement("div"),
h=g.createSurface(l,b,c);null!=e.opacity&&(l.style.opacity=e.opacity.toString());try{a.forEach(function(a){var l=h.createGroup(),f=0;a.forEach(function(a){var d=a.shape,b=a.fill,c=a.stroke;f+=c&&c.width||0;var e=null;d&&("path"===d.type&&"string"!==typeof d.path&&(d.path=r(d.path)),e=l.createShape(d).setFill(b).setStroke(c?c:{width:0}),"text"===d.type&&e.setFont(a.font))});a=b/2;var d=c/2,w=l.getBoundingBox(),q=w.width,u=w.height,g=!1;if(e.scale&&0!==w.width&&0!==w.height){var z=w.width/w.height,
g=(b>c?b:c)-2*f,n=1,B=1;isNaN(g)||(1<z?(n=g/w.width,B=g/z/w.height):(B=g/w.height,n=g*z/w.width));l.applyTransform(k.scaleAt(n,B,a,d));g=!0}z=w.x+q/2;w=w.y+u/2;l.applyTransform(k.translate(a-z,d-w));!g&&(q>b||u>c)&&(g=q/b>u/c,q=((g?b:c)-5)/(g?q:u),l.applyTransform(k.scaleAt(q,q,a,d)));e.rotation&&l.applyTransform(k.rotategAt(e.rotation,z,w))})}catch(A){return h.clear(),h.destroy(),null}return l}function e(b,e,c){return b?a(b,{responseType:"image"}).then(function(a){a=a.data;var b=a.width,l=a.height,
h=b/l,f=e;c&&(f=Math.min(f,Math.max(b,l)));return{image:a,width:1>=h?Math.ceil(f*h):f,height:1>=h?f:Math.ceil(f/h)}}):h.reject(new m("renderUtils: imageDataSize","href not provided."))}Object.defineProperty(p,"__esModule",{value:!0});p.renderSymbol=function(a,b,c){var e=Math.ceil(b[0]);b=Math.ceil(b[1]);return a.some(function(a){return!!a.length})?v(a,e,b,c):null};p.tintImageWithColor=function(a,h,c,l,g){return e(a,h,g).then(function(e){var q=e.width?e.width:h,u=e.height?e.height:h,g;if(g=e.image)g=
c&&"ignore"!==l?"multiply"===l&&255===c.r&&255===c.g&&255===c.b&&1===c.a?!1:!0:!1;if(g){var d=e.image.width,w=e.image.height;(n("edge")||n("ie"))&&/\.svg$/i.test(a)&&(--d,--w);var z,r;z=Math.ceil(q);r=Math.ceil(u);g=document.createElement("canvas");g.width=z;g.height=r;g.style.width=z+"px";g.style.height=r+"px";g=g.getContext("2d");g.clearRect(0,0,z,r);g.drawImage(e.image,0,0,d,w,0,0,q,u);e=g.getImageData(0,0,q,u);d=[c.r/255,c.g/255,c.b/255,c.a];w=f.toHSV(c);for(z=0;z<e.data.length;z+=4){r=e.data;
var m=z,k=d,B=w;switch(l){case "multiply":r[m+0]*=k[0];r[m+1]*=k[1];r[m+2]*=k[2];r[m+3]*=k[3];break;default:var v=f.toHSV({r:r[m+0],g:r[m+1],b:r[m+2]});v.h=B.h;v.s=B.s;v.v=v.v/100*B.v;B=f.toRGB(v);r[m+0]=B.r;r[m+1]=B.g;r[m+2]=B.b;r[m+3]*=k[3]}}g.putImageData(e,0,0);a=g.canvas.toDataURL("image/png")}else(g=b.id&&b.id.findCredential(a))&&g.token&&(e=-1===a.indexOf("?")?"?":"\x26",a=""+a+e+"token\x3d"+g.token);return{url:a,width:q,height:u}}).catch(function(){return{url:a,width:h,height:h}})}})},"dojox/gfx":function(){define(["dojo/_base/lang",
"./gfx/_base","./gfx/renderer!"],function(t,p,g){p.switchTo(g);return p})},"dojox/gfx/_base":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/Color dojo/_base/sniff dojo/_base/window dojo/_base/array dojo/dom dojo/dom-construct dojo/dom-geometry".split(" "),function(t,p,g,k,b,a,f,m,n){var h=p.getObject("dojox.gfx",!0),r=h._base={};h._hasClass=function(a,b){return(a=a.getAttribute("className"))&&0<=(" "+a+" ").indexOf(" "+b+" ")};h._addClass=function(a,b){var c=a.getAttribute("className")||
"";(!c||0>(" "+c+" ").indexOf(" "+b+" "))&&a.setAttribute("className",c+(c?" ":"")+b)};h._removeClass=function(a,b){var c=a.getAttribute("className");c&&a.setAttribute("className",c.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)"),"$1$2"))};r._getFontMeasurements=function(){var a={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0},c,e;k("ie")&&(e=b.doc.documentElement.style.fontSize||"",e||(b.doc.documentElement.style.fontSize="100%"));
var h=m.create("div",{style:{position:"absolute",left:"0",top:"-100px",width:"30px",height:"1000em",borderWidth:"0",margin:"0",padding:"0",outline:"none",lineHeight:"1",overflow:"hidden"}},b.body());for(c in a)h.style.fontSize=c,a[c]=16*Math.round(12*h.offsetHeight/16)/12/1E3;k("ie")&&(b.doc.documentElement.style.fontSize=e);b.body().removeChild(h);return a};var v=null;r._getCachedFontMeasurements=function(a){if(a||!v)v=r._getFontMeasurements();return v};var e=null,q={};r._getTextBox=function(a,c,
h){var l,f,g=arguments.length,d;e||(e=m.create("div",{style:{position:"absolute",top:"-10000px",left:"0",visibility:"hidden"}},b.body()));l=e;l.className="";f=l.style;f.borderWidth="0";f.margin="0";f.padding="0";f.outline="0";if(1<g&&c)for(d in c)d in q||(f[d]=c[d]);2<g&&h&&(l.className=h);l.innerHTML=a;l.getBoundingClientRect?(f=l.getBoundingClientRect(),f={l:f.left,t:f.top,w:f.width||f.right-f.left,h:f.height||f.bottom-f.top}):f=n.getMarginBox(l);l.innerHTML="";return f};r._computeTextLocation=
function(a,b,c,e){var l={};switch(a.align){case "end":l.x=a.x-b;break;case "middle":l.x=a.x-b/2;break;default:l.x=a.x}l.y=a.y-c*(e?.75:1);return l};r._computeTextBoundingBox=function(a){if(!h._base._isRendered(a))return{x:0,y:0,width:0,height:0};var b;b=a.getShape();var c=a.getFont()||h.defaultFont;a=a.getTextWidth();c=h.normalizedLength(c.size);b=r._computeTextLocation(b,a,c,!0);return{x:b.x,y:b.y,width:a,height:c}};r._isRendered=function(a){for(a=a.parent;a&&a.getParent;)a=a.parent;return null!==
a};var u=0;r._getUniqueId=function(){var a;do a=t._scopeName+"xUnique"+ ++u;while(f.byId(a));return a};var c=k("pointer-events")?"touchAction":null;r._fixMsTouchAction=c?function(a){a.rawNode.style[c]="none"}:function(){};p.mixin(h,{defaultPath:{type:"path",path:""},defaultPolyline:{type:"polyline",points:[]},defaultRect:{type:"rect",x:0,y:0,width:100,height:100,r:0},defaultEllipse:{type:"ellipse",cx:0,cy:0,rx:200,ry:100},defaultCircle:{type:"circle",cx:0,cy:0,r:100},defaultLine:{type:"line",x1:0,
y1:0,x2:100,y2:100},defaultImage:{type:"image",x:0,y:0,width:0,height:0,src:""},defaultText:{type:"text",x:0,y:0,text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultTextPath:{type:"textpath",text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultStroke:{type:"stroke",color:"black",style:"solid",width:1,cap:"butt",join:4},defaultLinearGradient:{type:"linear",x1:0,y1:0,x2:100,y2:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultRadialGradient:{type:"radial",
cx:0,cy:0,r:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultPattern:{type:"pattern",x:0,y:0,width:0,height:0,src:""},defaultFont:{type:"font",style:"normal",variant:"normal",weight:"normal",size:"10pt",family:"serif"},getDefault:function(){var a={};return function(b){var c=a[b];if(c)return new c;c=a[b]=new Function;c.prototype=h["default"+b];return new c}}(),normalizeColor:function(a){return a instanceof g?a:new g(a)},normalizeParameters:function(a,b){var c;if(b){var e={};for(c in a)c in
b&&!(c in e)&&(a[c]=b[c])}return a},makeParameters:function(a,b){var c=null;if(!b)return p.delegate(a);var e={};for(c in a)c in e||(e[c]=p.clone(c in b?b[c]:a[c]));return e},formatNumber:function(a,b){var c=a.toString();if(0<=c.indexOf("e"))c=a.toFixed(4);else{var e=c.indexOf(".");0<=e&&5<c.length-e&&(c=a.toFixed(4))}return 0>a?c:b?" "+c:c},makeFontString:function(a){return a.style+" "+a.variant+" "+a.weight+" "+a.size+" "+a.family},splitFontString:function(a){var b=h.getDefault("Font");a=a.split(/\s+/);
if(!(5>a.length)){b.style=a[0];b.variant=a[1];b.weight=a[2];var c=a[3].indexOf("/");b.size=0>c?a[3]:a[3].substring(0,c);var e=4;0>c&&("/"==a[4]?e=6:"/"==a[4].charAt(0)&&(e=5));e<a.length&&(b.family=a.slice(e).join(" "))}return b},cm_in_pt:72/2.54,mm_in_pt:7.2/2.54,px_in_pt:function(){return h._base._getCachedFontMeasurements()["12pt"]/12},pt2px:function(a){return a*h.px_in_pt()},px2pt:function(a){return a/h.px_in_pt()},normalizedLength:function(a){if(0===a.length)return 0;if(2<a.length){var b=h.px_in_pt(),
c=parseFloat(a);switch(a.slice(-2)){case "px":return c;case "pt":return c*b;case "in":return 72*c*b;case "pc":return 12*c*b;case "mm":return c*h.mm_in_pt*b;case "cm":return c*h.cm_in_pt*b}}return parseFloat(a)},pathVmlRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,pathSvgRegExp:/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,equalSources:function(a,b){return a&&b&&a===b},switchTo:function(b){var c="string"==typeof b?h[b]:b;c&&(a.forEach("Group Rect Ellipse Circle Line Polyline Image Text Path TextPath Surface createSurface fixTarget".split(" "),
function(a){h[a]=c[a]}),"string"==typeof b?h.renderer=b:a.some(["svg","vml","canvas","canvasWithEvents","silverlight"],function(a){return h.renderer=h[a]&&h[a].Surface===h.Surface?a:null}))}});return h})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],function(t,p,g,k,b){var a=null;g.add("vml",function(a,b,g){g.innerHTML='\x3cv:shape adj\x3d"1"/\x3e';a="adj"in g.firstChild;g.innerHTML="";return a});return{load:function(f,
m,n){function h(){m(["dojox/gfx/"+r],function(b){t.renderer=r;a=b;n(b)})}if(a&&"force"!=f)n(a);else{var r=b.forceGfxRenderer;f=!r&&(p.isString(b.gfxRenderer)?b.gfxRenderer:"svg,vml,canvas,silverlight").split(",");for(var v,e;!r&&f.length;)switch(f.shift()){case "svg":"SVGAngle"in k.global&&(r="svg");break;case "vml":g("vml")&&(r="vml");break;case "silverlight":try{g("ie")?(v=new ActiveXObject("AgControl.AgControl"),v.IsVersionSupported("1.0"))&&(e=!0):navigator.plugins["Silverlight Plug-In"]&&(e=
!0)}catch(q){e=!1}finally{v=null}e&&(r="silverlight");break;case "canvas":k.global.CanvasRenderingContext2D&&(r="canvas")}"canvas"===r&&!1!==b.canvasEvents&&(r="canvasWithEvents");b.isDebug&&console.log("gfx renderer \x3d "+r);"svg"==r&&"undefined"!=typeof window.svgweb?window.svgweb.addOnLoad(h):h()}}}})},"dojox/gfx/matrix":function(){define(["./_base","dojo/_base/lang"],function(t,p){var g=t.matrix={},k={};g._degToRad=function(b){return k[b]||(k[b]=Math.PI*b/180)};g._radToDeg=function(b){return b/
Math.PI*180};g.Matrix2D=function(b){if(b)if("number"==typeof b)this.xx=this.yy=b;else if(b instanceof Array){if(0<b.length){for(var a=g.normalize(b[0]),f=1;f<b.length;++f){var m=a,n=g.normalize(b[f]),a=new g.Matrix2D;a.xx=m.xx*n.xx+m.xy*n.yx;a.xy=m.xx*n.xy+m.xy*n.yy;a.yx=m.yx*n.xx+m.yy*n.yx;a.yy=m.yx*n.xy+m.yy*n.yy;a.dx=m.xx*n.dx+m.xy*n.dy+m.dx;a.dy=m.yx*n.dx+m.yy*n.dy+m.dy}p.mixin(this,a)}}else p.mixin(this,b)};p.extend(g.Matrix2D,{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0});p.mixin(g,{identity:new g.Matrix2D,
flipX:new g.Matrix2D({xx:-1}),flipY:new g.Matrix2D({yy:-1}),flipXY:new g.Matrix2D({xx:-1,yy:-1}),translate:function(b,a){return 1<arguments.length?new g.Matrix2D({dx:b,dy:a}):new g.Matrix2D({dx:b.x,dy:b.y})},scale:function(b,a){return 1<arguments.length?new g.Matrix2D({xx:b,yy:a}):"number"==typeof b?new g.Matrix2D({xx:b,yy:b}):new g.Matrix2D({xx:b.x,yy:b.y})},rotate:function(b){var a=Math.cos(b);b=Math.sin(b);return new g.Matrix2D({xx:a,xy:-b,yx:b,yy:a})},rotateg:function(b){return g.rotate(g._degToRad(b))},
skewX:function(b){return new g.Matrix2D({xy:Math.tan(b)})},skewXg:function(b){return g.skewX(g._degToRad(b))},skewY:function(b){return new g.Matrix2D({yx:Math.tan(b)})},skewYg:function(b){return g.skewY(g._degToRad(b))},reflect:function(b,a){1==arguments.length&&(a=b.y,b=b.x);var f=b*b,m=a*a,n=f+m,h=2*b*a/n;return new g.Matrix2D({xx:2*f/n-1,xy:h,yx:h,yy:2*m/n-1})},project:function(b,a){1==arguments.length&&(a=b.y,b=b.x);var f=b*b,m=a*a,n=f+m,h=b*a/n;return new g.Matrix2D({xx:f/n,xy:h,yx:h,yy:m/n})},
normalize:function(b){return b instanceof g.Matrix2D?b:new g.Matrix2D(b)},isIdentity:function(b){return 1==b.xx&&0==b.xy&&0==b.yx&&1==b.yy&&0==b.dx&&0==b.dy},clone:function(b){var a=new g.Matrix2D,f;for(f in b)"number"==typeof b[f]&&"number"==typeof a[f]&&a[f]!=b[f]&&(a[f]=b[f]);return a},invert:function(b){b=g.normalize(b);var a=b.xx*b.yy-b.xy*b.yx;return b=new g.Matrix2D({xx:b.yy/a,xy:-b.xy/a,yx:-b.yx/a,yy:b.xx/a,dx:(b.xy*b.dy-b.yy*b.dx)/a,dy:(b.yx*b.dx-b.xx*b.dy)/a})},_multiplyPoint:function(b,
a,f){return{x:b.xx*a+b.xy*f+b.dx,y:b.yx*a+b.yy*f+b.dy}},multiplyPoint:function(b,a,f){b=g.normalize(b);return"number"==typeof a&&"number"==typeof f?g._multiplyPoint(b,a,f):g._multiplyPoint(b,a.x,a.y)},multiplyRectangle:function(b,a){var f=g.normalize(b);a=a||{x:0,y:0,width:0,height:0};if(g.isIdentity(f))return{x:a.x,y:a.y,width:a.width,height:a.height};b=g.multiplyPoint(f,a.x,a.y);var m=g.multiplyPoint(f,a.x,a.y+a.height),n=g.multiplyPoint(f,a.x+a.width,a.y);a=g.multiplyPoint(f,a.x+a.width,a.y+a.height);
var f=Math.min(b.x,m.x,n.x,a.x),h=Math.min(b.y,m.y,n.y,a.y);return{x:f,y:h,width:Math.max(b.x,m.x,n.x,a.x)-f,height:Math.max(b.y,m.y,n.y,a.y)-h}},multiply:function(b){for(var a=g.normalize(b),f=1;f<arguments.length;++f){var m=a,n=g.normalize(arguments[f]),a=new g.Matrix2D;a.xx=m.xx*n.xx+m.xy*n.yx;a.xy=m.xx*n.xy+m.xy*n.yy;a.yx=m.yx*n.xx+m.yy*n.yx;a.yy=m.yx*n.xy+m.yy*n.yy;a.dx=m.xx*n.dx+m.xy*n.dy+m.dx;a.dy=m.yx*n.dx+m.yy*n.dy+m.dy}return a},_sandwich:function(b,a,f){return g.multiply(g.translate(a,
f),b,g.translate(-a,-f))},scaleAt:function(b,a,f,m){switch(arguments.length){case 4:return g._sandwich(g.scale(b,a),f,m);case 3:return"number"==typeof f?g._sandwich(g.scale(b),a,f):g._sandwich(g.scale(b,a),f.x,f.y)}return g._sandwich(g.scale(b),a.x,a.y)},rotateAt:function(b,a,f){return 2<arguments.length?g._sandwich(g.rotate(b),a,f):g._sandwich(g.rotate(b),a.x,a.y)},rotategAt:function(b,a,f){return 2<arguments.length?g._sandwich(g.rotateg(b),a,f):g._sandwich(g.rotateg(b),a.x,a.y)},skewXAt:function(b,
a,f){return 2<arguments.length?g._sandwich(g.skewX(b),a,f):g._sandwich(g.skewX(b),a.x,a.y)},skewXgAt:function(b,a,f){return 2<arguments.length?g._sandwich(g.skewXg(b),a,f):g._sandwich(g.skewXg(b),a.x,a.y)},skewYAt:function(b,a,f){return 2<arguments.length?g._sandwich(g.skewY(b),a,f):g._sandwich(g.skewY(b),a.x,a.y)},skewYgAt:function(b,a,f){return 2<arguments.length?g._sandwich(g.skewYg(b),a,f):g._sandwich(g.skewYg(b),a.x,a.y)}});t.Matrix2D=g.Matrix2D;return g})},"esri/core/colorUtils":function(){define(["require",
"exports"],function(t,p){function g(a,b){var e=[],h,f;if(a[0].length!==b.length)throw"dimensions do not match";var c=a.length,l=a[0].length,g=0;for(h=0;h<c;h++){for(f=g=0;f<l;f++)g+=a[h][f]*b[f];e.push(g)}return e}function k(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=g(n,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}}function b(a){a=g(h,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,
1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function a(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}}function f(a){var b=a.l;a=[(b+16)/116+a.a/500,(b+16)/116,(b+16)/116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function m(a){if("r"in
a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var h=a.c,e=a.h;return b(f({l:a.l,a:h*Math.cos(e),b:h*Math.sin(e)}))}if("l"in a&&"a"in a&&"b"in a)return b(f(a));if("x"in a&&"y"in a&&"z"in a)return b(a);if("h"in a&&"s"in a&&"v"in a){e=(a.h+360)%360/60;h=a.v/100*255;a=a.s/100*h;var g=a*(1-Math.abs(e%2-1));switch(Math.floor(e)){case 0:e={r:a,g:g,b:0};break;case 1:e={r:g,g:a,b:0};break;case 2:e={r:0,g:a,b:g};break;case 3:e={r:0,g:g,b:a};break;case 4:e={r:g,g:0,b:a};break;case 5:case 6:e={r:a,
g:0,b:g};break;default:e={r:0,g:0,b:0}}e.r=Math.round(e.r+h-a);e.g=Math.round(e.g+h-a);e.b=Math.round(e.b+h-a);return e}}Object.defineProperty(p,"__esModule",{value:!0});var n=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],h=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];p.toRGB=m;p.toHSV=function(a){if("h"in a&&"s"in a&&"v"in a)return a;var b=m(a);a=b.r;var e=b.g,b=b.b,h=Math.max(a,e,b),f=h-Math.min(a,e,b),c;0===f?c=0:h===a?c=(e-b)/f%6:h===e?c=(b-a)/f+2:h===b&&
(c=(a-e)/f+4);0>c&&(c+=6);return{h:60*c,s:100*(0===f?0:f/h),v:100/255*h}};p.toLAB=function(b){return"l"in b&&"a"in b&&"b"in b?b:a(k(m(b)))};p.toLCH=function(b){if(!("l"in b&&"c"in b&&"h"in b)){var h=a(k(m(b)));b=h.l;var e=h.a,f=h.b,h=Math.sqrt(e*e+f*f),e=Math.atan2(f,e),e=0<e?e:e+2*Math.PI;b={l:b,c:h,h:e}}return b};p.toXYZ=function(a){return"x"in a&&"y"in a&&"z"in a?a:k(m(a))}})},"esri/symbols/support/previewSymbol3D":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/colorUtils ../../core/compilerUtils ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./styleUtils ./utils".split(" "),
function(t,p,g,k,b,a,f,m,n,h,r,v,e,q,u,c,l){function z(a){var d=a.outline,b=m.isSome(a.material)?a.material.color:null,b=m.isSome(b)?b.toRgba().toString():null;if(m.isNone(d))return"fill"===a.type&&"255,255,255,1"===b?{color:"#bdc3c7",width:.75}:null;a=h.pt2px(d.size)||0;return{color:"rgba("+(m.isSome(d.color)?d.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function B(a,d){var b=d&&d.resource,b=b&&b.href;return a.thumbnail&&a.thumbnail.url?n.resolve(a.thumbnail.url):b&&"object"!==d.type?
n.resolve(l.getIconHref(a,d)):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?c.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal},"webRef").catch(function(a){return a}).then(function(a){return a&&a.thumbnail&&a.thumbnail.url||G}):n.resolve(G)}function A(a,d){void 0===d&&(d=1);var b=a.a;a=k.toHSV(a);d=k.toRGB({h:a.h,s:a.s/d,v:100-(100-a.v)/d});return[d.r,d.g,d.b,b]}function x(a,d){return Math.round(Math.min(Math.max(a+191.25*d,0),255))}function y(a){return"water"===
a.type?m.isNone(a.color)?null:a.color:m.isNone(a.material)||m.isNone(a.material.color)?null:a.material.color}function d(a,d){void 0===d&&(d=0);a=y(a);if(!a)return d=x(r.defaultThematicColor.r,d),[d,d,d,100];a=a.toRgba();for(var b=0;3>b;b++)a[b]=x(a[b],d);return a}function w(a){return a.outline?z(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function D(a,d){a=y(a);if(!a)return null;var b;b="rgba("+(x(a.r,d)+",");b+=x(a.g,d)+",";b+=x(a.b,d)+",";return b+a.a+");"}function C(a,d){d=D(a,d);if(!d)return{};a=
Math.min(a.size?h.pt2px(a.size):.75,80);return{color:d,width:a}}function E(a,d,b){b*=.75;return{type:"linear",x1:b?.25*b:0,y1:b?.5*b:0,x2:b||4,y2:b?.5*b:4,colors:[{color:a,offset:0},{color:d,offset:1}]}}function H(a){var d=a.depth,b=a.height;return(a=a.width)&&d&&b&&a===d&&a<b}function P(a,c,h){var f=[];if(!a)return f;switch(a.type){case "icon":var g=a.resource&&a.resource.primitive||v.defaultPrimitive;switch(g){case "circle":f.push({shape:{type:"circle",cx:0,cy:0,r:.5*c},fill:d(a,0),stroke:z(a)});
break;case "square":f.push({shape:{type:"path",path:[{command:"M",values:[0,c]},{command:"L",values:[0,0]},{command:"L",values:[c,0]},{command:"L",values:[c,c]},{command:"Z",values:[]}]},fill:d(a,0),stroke:z(a)});break;case "triangle":f.push({shape:{type:"path",path:[{command:"M",values:[0,c]},{command:"L",values:[.5*c,0]},{command:"L",values:[c,c]},{command:"Z",values:[]}]},fill:d(a,0),stroke:z(a)});break;case "cross":f.push({shape:{type:"path",path:[{command:"M",values:[.5*c,0]},{command:"L",values:[.5*
c,c]},{command:"M",values:[0,.5*c]},{command:"L",values:[c,.5*c]},{command:"E",values:[]}]},stroke:w(a)});break;case "x":f.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[c,c]},{command:"M",values:[c,0]},{command:"L",values:[0,c]},{command:"E",values:[]}]},stroke:w(a)});break;case "kite":f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[.5*c,0]},{command:"L",values:[c,.5*c]},{command:"L",values:[.5*c,c]},{command:"Z",values:[]}]},fill:d(a,
0),stroke:z(a)});break;default:b.neverReached(g)}break;case "object":switch(g=a.resource&&a.resource.primitive||e.defaultPrimitive,g){case "cone":g=d(a,0);a=d(a,-.6);a=E(g,a,h?20:c);c=q.getConeShapes(c,h);f.push({shape:c[0],fill:a});f.push({shape:c[1],fill:a});break;case "inverted-cone":h=d(a,0);a=d(a,-.6);a=E(h,a,c);c=q.getInvertedConeShapes(c);f.push({shape:c[0],fill:a});f.push({shape:c[1],fill:h});break;case "cube":c=q.getCubeShapes(c,h);f.push({shape:c[0],fill:d(a,0)});f.push({shape:c[1],fill:d(a,
-.3)});f.push({shape:c[2],fill:d(a,-.5)});break;case "cylinder":var g=d(a,0),l=d(a,-.6),g=E(g,l,h?20:c);c=q.getCylinderShapes(c,h);f.push({shape:c[0],fill:g});f.push({shape:c[1],fill:g});f.push({shape:c[2],fill:d(a,0)});break;case "diamond":c=q.getDiamondShapes(c);f.push({shape:c[0],fill:d(a,-.3)});f.push({shape:c[1],fill:d(a,0)});f.push({shape:c[2],fill:d(a,-.3)});f.push({shape:c[3],fill:d(a,-.7)});break;case "sphere":h=d(a,0);a=d(a,-.6);a=E(h,a);a.x1=0;a.y1=0;a.x2=.25*c;a.y2=.25*c;f.push({shape:{type:"circle",
cx:0,cy:0,r:.5*c},fill:a});break;case "tetrahedron":c=q.getTetrahedronShapes(c);f.push({shape:c[0],fill:d(a,-.3)});f.push({shape:c[1],fill:d(a,0)});f.push({shape:c[2],fill:d(a,-.6)});break;default:b.neverReached(g)}}return f}function I(a,d){var b=d&&d.size?h.pt2px(d.size):null,c=d&&d.maxSize?h.pt2px(d.maxSize):null,e=d&&d.disableUpsampling,f=a.symbolLayers,g=[],w=0,l=0,q=f.getItemAt(f.length-1),m;q&&"icon"===q.type&&(m=q.size&&h.pt2px(q.size));f.forEach(function(f,q){if("icon"===f.type||"object"===
f.type){q="icon"===f.type?f.size&&h.pt2px(f.size):0;var y=b||q?Math.ceil(Math.min(b||q,c||120)):22,k="icon"===f.type?z(f):null,x=k?k.width:0;f&&f.resource&&f.resource.href?(q=B(a,f).then(function(a){var d=f.get("material.color"),b;b="icon"===f.type?"multiply":"tint";return u.tintImageWithColor(a,y,d,b,e)}).then(function(a){var d=a.width,b=a.height;w=Math.max(w,d+x+1);l=Math.max(l,b+x+1);return[{shape:{type:"image",x:0,y:0,width:d,height:b,src:a.url},fill:null,stroke:null}]}),g.unshift(q)):(k=y,"icon"===
f.type&&m&&b&&(k=q/m*y),q=d&&"tall"===d.symbolConfig||("object"===f.type?H(f):!1),w=Math.max(w,q?20:k+x+1),l=Math.max(l,k+x+1),g.unshift(n.resolve(P(f,k,q))))}});return n.eachAlways(g).then(function(a){var b=[];a.forEach(function(a){a.value?b.push(a.value):a.error&&Q.warn("error while building swatchInfo!",a.error)});return u.renderSymbol(b,[w,l],{node:d&&d.node,scale:!1,opacity:d&&d.opacity})})}function J(a,b){var c=a.symbolLayers,e=[];a=l.isVolumetricSymbol(a);var f=b&&b.size?h.pt2px(b.size):null,
w=(b&&b.maxSize?h.pt2px(b.maxSize):null)||80,m=0,k=0,y;c.forEach(function(a,b){if(a&&("line"===a.type||"path"===a.type)){var c=[];switch(a.type){case "line":var h=C(a,0),l=h&&h.width||0;0===b&&(y=l);var u=Math.min(f||l,w);b=0===b?u:f?l/y*u:u;k=Math.max(k,b);m=Math.max(m,22<b?b+1:40);h.width=b;c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*k]},{command:"L",values:[m,.5*k]},{command:"E",values:[]}]},stroke:h});break;case "path":b=Math.min(f||22,w);l=d(a,0);u=d(a,-.2);h=(h=D(a,-.4))?{color:h,
width:1}:{};if("quad"===a.profile){var n=a.width||a.size;a=a.height||a.size;a=q.getPathSymbolShapes(n&&a?n/a:1);n=g({},h,{join:"bevel"});c.push({shape:a[0],fill:u,stroke:n});c.push({shape:a[1],fill:u,stroke:n});c.push({shape:a[2],fill:l,stroke:n})}else c.push({shape:q.shapes.pathSymbol3DLayer[0],fill:u,stroke:h}),c.push({shape:q.shapes.pathSymbol3DLayer[1],fill:l,stroke:h});m=k=Math.max(k,b+(h.width||0)+1)}e.push(c)}});return n.resolve(u.renderSymbol(e,[m,k],{node:b&&b.node,scale:a,opacity:b&&b.opacity}))}
Object.defineProperty(p,"__esModule",{value:!0});var G=t.toUrl("../../images/Legend/legend3dsymboldefault.png"),Q=f.getLogger("esri.symbols.support.previewSymbol3D");p.getSymbolLayerFill=d;p.previewSymbol3D=function(b,c){if(0===b.symbolLayers.length)return n.reject(new a("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var e=null;switch(b.type){case "point-3d":e=I(b,c);break;case "line-3d":e=J(b,c);break;case "polygon-3d":case "mesh-3d":e="mesh-3d"===b.type;b=b.symbolLayers;
for(var f=c&&c.size?h.pt2px(c.size):null,l=c&&c.maxSize?h.pt2px(c.maxSize):null,f=f||22,w=[],m=0,k=0,x=!1,D=0;D<b.length;D++){var p=b.getItemAt(D),r=[];if(!e||"fill"===p.type){var B=q.shapes.fill[0];switch(p.type){case "fill":var v=z(p),x=v&&v.width||0,t=Math.min(f,l||120),m=Math.max(m,t+x),k=Math.max(k,t+x),x=!0;r.push({shape:B,fill:d(p,0),stroke:v});break;case "line":p=(v=C(p,0))&&v.width||0;B={stroke:v,shape:B};m=Math.max(m,22+p);k=Math.max(k,22+p);r.push(B);break;case "extrude":var v=g({join:"round"},
C(p,-.4)),B=d(p,0),p=d(p,-.2),t=Math.min(f,l||120),E=q.getExtrudeSymbolShapes(t);v.width=1;r.push({shape:E[0],fill:p,stroke:v});r.push({shape:E[1],fill:p,stroke:v});r.push({shape:E[2],fill:B,stroke:v});B=22*.7+.5*t;m=Math.max(m,22+v.width+1);k=Math.max(k,B+v.width+1);break;case "water":x=y(p),B=A(x),p=A(x,2),v=A(x,3),t=q.getWaterSymbolShapes(),x=!0,r.push({shape:t[0],fill:B}),r.push({shape:t[1],fill:p}),r.push({shape:t[2],fill:v}),t=Math.min(f,l||120),m=Math.max(m,t),k=Math.max(k,t)}w.push(r)}}e=
n.resolve(u.renderSymbol(w,[m,k],{node:c&&c.node,scale:x,opacity:c&&c.opacity}))}return e?e:n.reject(new a("symbolPreview: swatchInfo3D","symbol not supported."))}})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/compilerUtils ../../core/has ../../core/Logger ../../core/maybe ../../core/screenUtils ./gfxUtils ./Symbol3DMaterial".split(" "),function(t,p,g,k,b,a,f,m,n,h,r){function v(a,b){if(null==b)return a;a=a.toRgba();a[3]*=b;return new g(a)}
function e(a,b,c){if(a=a.symbolLayers){var e=function(a){a=m.isSome(a)?a:null;b=b||a||null!=c&&l;return v(b,c)};a.forEach(function(a){if("water"===a.type)a.color=e(a.color);else{var d=m.isSome(a.material)?a.material.color:null,d=e(d);m.isNone(a.material)?a.material=new r.default({color:d}):a.material.color=d;null!=c&&"outline"in a&&m.isSome(a.outline)&&m.isSome(a.outline.color)&&(a.outline.color=v(a.outline.color,c))}})}}function q(a,b,c){(a=a.symbolLayers)&&a.forEach(function(a){if(a)switch(a.type){case "icon":case "line":case "path":case "extrude":case "text":a.size=
b;break;case "object":switch(c){case "width":a.width=b;break;case "depth":a.depth=b;break;case "height":a.height=b;break;case "width-and-depth":a.width=b;a.depth=b;break;default:a.width=b,a.depth=b,a.height=b}break;default:u.warn("symbolUtils: applySizeToSymbol","symbolLayer not supported")}})}Object.defineProperty(p,"__esModule",{value:!0});var u=f.getLogger("esri.symbols.support.utils"),c=/\/resource\/(.*?)\.svg$/,l=new g("white");p.getSymbolOutlineSize=function(a){if(!a)return 0;if(k.isSymbol3D(a)){var b=
a.symbolLayers&&a.symbolLayers.length;b?(a=a.symbolLayers.getItemAt(b-1),a="outline"in a?m.get(a,"outline","size"):void 0):a=void 0;return m.isSome(a)?a:0}return(a=h.getStroke(a))&&n.px2pt(a.width)||0};p.isVolumetricSymbol=function(a){if(!a||!a.symbolLayers)return!1;switch(a.type){case "point-3d":return a.symbolLayers.some(function(a){return"object"===a.type});case "line-3d":return a.symbolLayers.some(function(a){return"path"===a.type});case "polygon-3d":return a.symbolLayers.some(function(a){return"object"===
a.type||"extrude"===a.type});default:return!1}};p.getIconHref=function(b,e){e=e.resource.href;return!a("esri-canvas-svg-support")&&b.styleOrigin&&c.test(e)?e.replace(c,"/resource/png/$1.png"):e};p.applyOpacityToColor=v;p.applyColorToSymbol=function(a,b,c){if(a&&(b||null!=c))if(b&&(b=new g(b)),k.isSymbol3D(a))e(a,b,c);else if(k.isSymbol2D(a)){if(b=b||a.color)a.color=v(b,c);null!=c&&"outline"in a&&a.outline&&a.outline.color&&(a.outline.color=v(a.outline.color,c))}};p.applySizeToSymbol=function(a,c,
e){if(a&&null!=c)if(k.isSymbol3D(a))q(a,c,e);else if(k.isSymbol2D(a))switch(a.type){case "simple-marker":a.size=c;break;case "picture-marker":e=a.width/a.height;1<e?(a.width=c,a.height=c*e):(a.width=c*e,a.height=c);break;case "simple-line":a.width=c;break;case "text":a.font.size=c;break;case "simple-fill":case "picture-fill":break;case "cim":break;default:b.neverReached(a)}};p.applyRotationToSymbol=function(a,b,c){a&&null!=b&&(k.isSymbol3D(a)?(a=a.symbolLayers)&&a.forEach(function(a){if(a&&"object"===
a.type)switch(c){case "tilt":a.tilt=b;break;case "roll":a.roll=b;break;default:a.heading=b}}):!k.isSymbol2D(a)||"simple-marker"!==a.type&&"picture-marker"!==a.type&&"text"!==a.type||(a.angle=b))}})},"esri/symbols/support/previewWebStyleSymbol":function(){define(["require","exports","../../request","../../core/screenUtils"],function(t,p,g,k){Object.defineProperty(p,"__esModule",{value:!0});p.previewWebStyleSymbol=function(b,a,f){var m=b.thumbnail&&b.thumbnail.url;return m?g(m,{responseType:"image"}).then(function(a){a=
a.data;var b=!/\\.svg$/i.test(a.src)&&f&&f.disableUpsampling,g=Math.max(a.width,a.height),m=f&&null!=f.maxSize?k.pt2px(f.maxSize):120;b&&(m=Math.min(g,m));b=Math.min(m,f&&null!=f.size?k.pt2px(f.size):g);b!==g&&(g=0!==a.width&&0!==a.height?a.width/a.height:1,1<=g?(a.width=b,a.height=b/g):(a.width=b*g,a.height=b));return f&&f.node?(f.node.appendChild(a),f.node):a}):b.fetchSymbol().then(function(b){return a(b,f)})}})},"esri/widgets/Legend/support/colorRampUtils":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../Color ../../../core/promiseUtils ../../../renderers/support/numberUtils ../../../symbols/support/gfxUtils ./utils @dojo/framework/shim/Promise".split(" "),
function(t,p,g,k,b,a,f,m,n){function h(a,c,f){void 0===f&&(f=e);return g(this,void 0,void 0,function(){var e,h;return k(this,function(g){switch(g.label){case 0:return e=new b(f),[4,new Promise(function(a,b){t(["../../../renderers/visualVariables/support/visualVariableUtils"],a,b)})];case 1:return h=g.sent().getOpacity(c,a),null!=h&&(e.a=h),[2,e]}})})}function r(a,c){a=v(a,c);var e=a.startIndex,f=a.endIndex;if(e===f)return c[e].color;c=b.blendColors(c[e].color,c[f].color,a.weight);return new b(c)}
function v(a,b){var c=0,e=b.length-1;b.some(function(b,f){if(a<b.value)return e=f,!0;c=f;return!1});return{startIndex:c,endIndex:e,weight:(a-b[c].value)/(b[e].value-b[c].value)}}Object.defineProperty(p,"__esModule",{value:!0});var e=[64,64,64],q=[255,255,255];p.getRampBorderColor=function(a){var b=null;if("simple"===a.type)b=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)b=(a=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&a.symbol;return(a=(a=b&&-1===b.type.indexOf("line-symbol")?
m.getStroke(b):null)&&a.color)&&0<a.a&&!(240<=a.r&&240<=a.g&&240<=a.b)?a:null};p.getRampOverlayColor=function(a){var c=new b(q);c.a=1-a;return c};p.getRampStops=function(b,c,e){return g(this,void 0,void 0,function(){var b,l,q,m,u,d,w,D,p=this;return k(this,function(y){switch(y.label){case 0:b=!1;l=[];q=[];c.stops&&(m=c.stops,l=m.map(function(a){return a.value}),(b=m.some(function(a){return!!a.label}))&&(q=m.map(function(a){return a.label})));u=l[0];d=l[l.length-1];if(null==u&&null==d)return[2,null];
w=d-u;return[4,a.all(l.map(function(a,d){return g(p,void 0,void 0,function(){var g,m,y;return k(this,function(k){switch(k.label){case 0:return"opacity"!==c.type?[3,2]:[4,h(a,c,e)];case 1:return m=k.sent(),[3,4];case 2:return[4,new Promise(function(a,d){t(["../../../renderers/visualVariables/support/visualVariableUtils"],a,d)})];case 3:m=k.sent().getColor(c,a),k.label=4;case 4:return g=m,y=b?q[d]:n.getLabelPrefix(d,l.length-1)+f.format(a),[2,{value:a,color:g,label:y,offset:w?1-(a-u)/w:1}]}})})}))];
case 1:return D=y.sent(),[2,D.reverse()]}})})};p.getRampStopsForPointCloud=function(a){var b=!1,e=[],h=[],e=a.map(function(a){return a.value});(b=a.some(function(a){return!!a.label}))&&(h=a.map(function(a){return a.label}));var g=e[0],q=e[e.length-1];if(null==g&&null==q)return null;var m=q-g;return e.map(function(c,d){var w=r(c,a);d=b?h[d]:n.getLabelPrefix(d,e.length-1)+f.format(c);return{value:c,color:w,label:d,offset:m?1-(c-g)/m:1}}).reverse()};p.getColorFromPointCloudStops=r})},"esri/widgets/Legend/support/utils":function(){define(["require",
"exports"],function(t,p){Object.defineProperty(p,"__esModule",{value:!0});p.getLabelPrefix=function(g,k){return 0===g?"\x3c ":g===k?"\x3e ":""}})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["require","exports","../../../renderers/support/HeatmapColorStop"],function(t,p,g){Object.defineProperty(p,"__esModule",{value:!0});p.getHeatmapRampStops=function(k){k=k.colorStops;var b=k.length-1;if(k&&k[0]){var a=k[b];a&&1!==a.ratio&&(k=k.slice(0),k.push(new g.HeatmapColorStop({ratio:1,
color:a.color})),b++)}return k.map(function(a,g){var f="";0===g?f="low":g===b&&(f="high");return{color:a.color,label:f,ratio:a.ratio,offset:1-a.ratio}}).reverse()}})},"esri/widgets/Legend/support/relationshipRampUtils":function(){define("require exports dojox/gfx dojox/gfx/matrix ../../../symbols/support/gfxUtils ../../../symbols/support/previewSymbol3D".split(" "),function(t,p,g,k,b,a){function f(e){if(e){var f=e.type;return-1<f.indexOf("3d")?a.getSymbolLayerFill(e.symbolLayers.getItemAt(0)):"simple-line"===
f||"simple-marker"===e.type&&("x"===e.style||"cross"===e.style)?(e=b.getStroke(e))&&e.color:b.getFill(e)}}function m(a,b){var c=b.HH.label,e=b.LL.label,f=b.HL.label;b=b.LH.label;switch(a){case "HH":return{top:c,bottom:e,left:f,right:b};case "HL":return{top:f,bottom:b,left:e,right:c};case "LL":return{top:e,bottom:c,left:b,right:f};case "LH":return{top:b,bottom:f,left:c,right:e};default:return{top:c,bottom:e,left:f,right:b}}}function n(a){var b=v[a];a&&null==b&&(b=v.HH);return b||0}function h(a,b,c,
e){var f=e+"_arrowStart";e+="_arrowEnd";b="left"===b;switch(c){case "HL":a.setAttribute(b?"marker-start":"marker-end","url(#"+(b?e:f)+")");break;case "LL":a.setAttribute("marker-start","url(#"+e+")");break;case "LH":a.setAttribute(b?"marker-end":"marker-start","url(#"+(b?f:e)+")");break;default:a.setAttribute("marker-end","url(#"+f+")")}}function r(a,b,c){var e="start"===b;b=e?c+"_arrowStart":c+"_arrowEnd";c=e?"0,0 5,5 0,10":"5,0 0,5 5,10";var f=e?"5":"0",e=document.createElementNS("http://www.w3.org/2000/svg",
"marker");e.setAttribute("id",b);e.setAttribute("markerWidth","10");e.setAttribute("markerHeight","10");e.setAttribute("refX",f);e.setAttribute("refY","5");e.setAttribute("markerUnits","strokeWidth");e.setAttribute("orient","auto");b=document.createElementNS("http://www.w3.org/2000/svg","polyline");b.setAttribute("points",c);b.setAttribute("fill","none");b.setAttribute("stroke","#555555");b.setAttribute("stroke-width","1");e.appendChild(b);a.appendChild(e)}Object.defineProperty(p,"__esModule",{value:!0});
var v={HH:315,HL:45,LL:135,LH:225},e={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};p.getRelationshipRampElement=function(a){var b=a.focus,c=a.numClasses,h=e[c],g={};a.infos.forEach(function(a){g[a.value]={label:a.label,fill:f(a.symbol)}});a=[];for(var q=0;q<c;q++){for(var k=[],x=0;x<c;x++)k.push(g[h[q][x]].fill);a.push(k)}h=m(b,g);return{type:"relationship-ramp",
numClasses:c,focus:b,colors:a,labels:h,rotation:n(b)}};p.getRotationAngleForFocus=n;p.renderRamp=function(a,e,c,f){void 0===f&&(f=60);var l=a.focus,q=a.numClasses,m=a.colors,n=a.rotation;a=!!l;var u=Math.sqrt(Math.pow(f,2)+Math.pow(f,2))+(a?0:5),d=document.createElement("div"),w=g.createSurface(d,u,u);null!=c&&(d.style.opacity=c.toString());var D=b.create2DColorRamp({surface:w,colors:m,numClasses:q,size:f});c=(u-f)/2;u=(u-f)/2;D.applyTransform(k.translate(c,u));q=f/2;m=f/2;D.applyTransform(k.rotategAt(n,
q,m));var n=w.createGroup(),D={width:1,color:"#555555"},p=w.defNode;r(p,"start",e);r(p,"end",e);p=n.createLine({x1:-10,y1:f-15,x2:-10,y2:15}).setStroke(D);f=n.createLine({x1:15,y1:f+10,x2:f-15,y2:f+10}).setStroke(D);h(p.rawNode,"left",l,e);h(f.rawNode,"right",l,e);n.applyTransform(k.translate(c,u));a?n.applyTransform(k.rotategAt(-45,q,m)):w.rawNode.style.margin="-15px -15px -18px -15px";return d}})},"esri/widgets/Legend/support/sizeRampUtils":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../symbols ../../../core/promiseUtils ../../../intl/date ../../../renderers/support/numberUtils ../../../symbols/support/utils ./utils @dojo/framework/shim/Promise".split(" "),
function(t,p,g,k,b,a,f,m,n,h){function r(a,b){var d=null,c=null;if("simple"===a.type)d=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)d=(d=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&d.symbol,c=1<a.length;if(!d||v(d))return null;d=d.clone();if(b||c)-1<d.type.indexOf("3d")?e(d):(b=d,-1!==b.type.indexOf("line")?b.color=x:(b.color=B,"simple-marker"===b.type&&(b.outline={color:x,width:1.5})));return d}function v(a){if(a)return b.isSymbol3D(a)?a.symbolLayers?a.symbolLayers.some(function(a){return a&&
"fill"===a.type}):!1:-1!==a.type.indexOf("fill")}function e(a){n.isVolumetricSymbol(a)||("line-3d"===a.type?a.symbolLayers.forEach(function(a){a.material={color:x}}):a.symbolLayers.forEach(function(a){"icon"!==a.type||a.resource&&a.resource.href?a.material={color:A}:(a.material={color:B},a.outline={color:x,size:1.5})}))}function q(a,b,e,f,h){return g(this,void 0,void 0,function(){var d,g,w,l,q;return k(this,function(k){switch(k.label){case 0:return[4,new Promise(function(a,b){t(["../../../renderers/visualVariables/support/visualVariableUtils"],
a,b)})];case 1:g=(d=k.sent().getSizeRangeAtScale(b,f,h))&&u(d);if(!d&&!g)return[2];w=g.map(function(a){var c=d.minSize,e=d.maxSize,f=b.minDataValue,h=b.maxDataValue;return a<=c?f:a>=e?h:(a-c)/(e-c)*(h-f)+f});w=m.round(w);l=1;k.label=2;case 2:return l<w.length-1?[4,c(a,b,e,w[l],w[l-1],f,h)]:[3,5];case 3:if(q=k.sent())w[l]=q[0],g[l]=q[1];k.label=4;case 4:return l++,[3,2];case 5:return[2,w]}})})}function u(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var c=[],e=0;5>e;e++)c.push(b+a*e);return c}function c(a,
b,c,e,f,h,q){return g(this,void 0,void 0,function(){var d,g,w,n,u,x,p,D,r,v,y,C,t,E,z,A,B,H,V,aa,R,S;return k(this,function(k){switch(k.label){case 0:return[4,l(a,b,c,e,h,q)];case 1:return g=k.sent(),[4,l(a,b,c,f,h,q)];case 2:w=k.sent(),n=m.numDigits(e),u=n.fractional,x=20,p=n.integer,r=D=null,0<e&&1>e&&(D=Math.pow(10,u),e*=D,p=m.numDigits(e).integer),v=p-1,k.label=3;case 3:if(!(0<=v))return[3,8];y=Math.pow(10,v);C=Math.floor(e/y)*y;t=Math.ceil(e/y)*y;null!=D&&(C/=D,t/=D);E=(C+t)/2;d=m.round([C,E,
t],{indexes:[1]});E=d[1];return[4,l(a,b,c,C,h,q)];case 4:return z=k.sent(),[4,l(a,b,c,t,h,q)];case 5:return A=k.sent(),[4,l(a,b,c,E,h,q)];case 6:B=k.sent();H=m.percentChange(g,z,w,null);V=m.percentChange(g,A,w,null);aa=m.percentChange(g,B,w,null);R=H.previous<=x;S=V.previous<=x;R&&S&&(H.previous<=V.previous?(R=!0,S=!1):(S=!0,R=!1));R?r=[C,z]:S?r=[t,A]:aa.previous<=x&&(r=[E,B]);if(r)return[3,8];k.label=7;case 7:return v--,[3,3];case 8:return[2,r]}})})}function l(a,b,c,e,f,h){return g(this,void 0,void 0,
function(){var a;return k(this,function(d){switch(d.label){case 0:return[4,new Promise(function(a,b){t(["../../../renderers/visualVariables/support/visualVariableUtils"],a,b)})];case 1:return a=d.sent().getSize,[2,a(b,e,{scale:f,view:h,shape:-1!==c.type.indexOf("marker-symbol")?c.style:null})]}})})}function z(a,d){a=a.clone();if(b.isSymbol3D(a))n.isVolumetricSymbol(a)||a.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=d)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=
d;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){var c=a.width,e=a.height;a.height=d;a.width=c/e*d}else"esri.symbols.SimpleLineSymbol"===a.declaredClass?a.width=d:"esri.symbols.TextSymbol"===a.declaredClass&&a.font&&(a.font.size=d);return a}Object.defineProperty(p,"__esModule",{value:!0});p.REAL_WORLD_MAX_SIZE=30;p.REAL_WORLD_MIN_SIZE=12;var B=[255,255,255],A=[200,200,200],x=[128,128,128];p.getRampStops=function(b,d,c,e,u,x){return g(this,void 0,void 0,function(){var w,D,v,C,t,y,E,
A,B,M,F,O,K,T,W,Y,U=this;return k(this,function(H){switch(H.label){case 0:D=(w=d.legendOptions)&&w.customValues;v=r(b,c);C=!!v;t=!!D;y=null!=d.minSize&&null!=d.maxSize;E=d.stops&&1<d.stops.length;A=!!d.target;if(!C||!(t||y||E&&!A))return[2];B=n.isVolumetricSymbol(v);O=F=M=null;if(!B||E)return[3,1];F=m.round([d.minDataValue,d.maxDataValue]);return[3,4];case 1:return(K=D)?[3,3]:[4,q(b,d,v,e,u)];case 2:K=H.sent(),H.label=3;case 3:F=K,H.label=4;case 4:!F&&E&&(F=d.stops.map(function(a){return a.value}),
(M=d.stops.some(function(a){return!!a.label}))&&(O=d.stops.map(function(a){return a.label})));B&&F&&2<F.length&&(F=[F[0],F[F.length-1]]);if(!F)return[2,null];T=[p.REAL_WORLD_MIN_SIZE,p.REAL_WORLD_MAX_SIZE];W=n.getSymbolOutlineSize(v);return[4,a.all(F.map(function(a,c){return g(U,void 0,void 0,function(){var g,w,q,n;return k(this,function(k){switch(k.label){case 0:if(!B)return[3,1];q=T[c];return[3,3];case 1:return[4,l(b,d,v,a,e,u)];case 2:q=k.sent(),k.label=3;case 3:return g=q,w=z(v,g),n=M?O[c]:h.getLabelPrefix(c,
F.length-1)+(x?f.formatDate(a):m.format(a)),[2,{value:a,symbol:w,label:n,size:g,outlineSize:W}]}})})}))];case 5:return Y=H.sent(),[2,Y.reverse()]}})})}})},"esri/widgets/Legend/styles/Card":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper dojo/i18n!../../../nls/common dojo/i18n!../../Legend/nls/Legend dojox/gfx ../../../intl ../../../core/Handles ../../../core/screenUtils ../../../core/accessorSupport/decorators ../../Widget ./support/utils ../support/styleUtils ../../support/colorUtils ../../support/widget".split(" "),
function(t,p,g,k,b,a,f,m,n,h,r,v,e,q,u,c,l){var z=window.devicePixelRatio;return function(b){function e(a){a=b.call(this)||this;a._handles=new h;a._hasIndicators=!1;a._selectedSectionName=null;a._sectionNames=[];a._sectionMap=new Map;a.activeLayerInfos=null;a.layout="stack";a.type="card";a.view=null;return a}g(e,b);e.prototype.postInitialize=function(){var a=this;this.own([this.watch("activeLayerInfos",function(b){a._handles.removeAll();a._watchForSectionChanges(b)})])};e.prototype.destroy=function(){this._handles.destroy();
this._handles=null};e.prototype.render=function(){var b=this,c;this._hasIndicators="auto"===this.layout&&768>=this.view.container.clientWidth||"stack"===this.layout;var d=this.activeLayerInfos,e=d&&d.toArray().map(function(a){return b._renderLegendForLayer(a)}).filter(function(a){return!!a});this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;
var h=this._sectionNames.length,d=this._sectionNames.map(function(d,c){var e;c=n.substitute(a.pagination.pageText,{index:c+1,total:h});return l.tsx("div",{key:d,"aria-label":c,title:c,tabIndex:0,onclick:b._selectSection,onkeydown:b._selectSection,bind:b,class:b.classes("esri-legend--card__carousel-indicator",(e={},e["esri-legend--card__carousel-indicator--activated"]=b._selectedSectionName===d,e)),"data-section-name":d})}),d=this._hasIndicators&&1<h?l.tsx("div",{class:"esri-legend--card__carousel-indicator-container",
key:"carousel-navigation"},d):null,e=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):e&&e.length?e:null,g=(c={},c["esri-legend--stacked"]=this._hasIndicators,c);return l.tsx("div",{class:this.classes("esri-legend--card esri-widget",g)},d,e?e:l.tsx("div",{class:"esri-legend--card__message"},f.noLegend))};e.prototype._selectSection=function(a){if(a=a.target.getAttribute("data-section-name"))this._selectedSectionName=a};e.prototype._watchForSectionChanges=function(a){var b=this;this._generateSectionNames();
a&&(a.forEach(function(a){var d="activeLayerInfo-"+a.layer.uid+"-version-change";b._handles.remove(d);b._watchForSectionChanges(a.children);b._handles.add(a.watch("version",function(){return b._generateSectionNames()}),d)}),this._handles.remove("activeLayerInfos-collection-change"),this._handles.add(a.on("change",function(){return b._watchForSectionChanges(a)}),"activeLayerInfos-collection-change"))};e.prototype._generateSectionNames=function(){this._sectionNames.length=0;this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,
this)};e.prototype._generateSectionNamesForActiveLayerInfo=function(a){var b=this;a.children.forEach(this._generateSectionNamesForActiveLayerInfo,this);a.legendElements&&a.legendElements.forEach(function(d,c){b._sectionNames.push("esri-legend--card__"+a.layer.uid+"-type-"+d.type+"-"+c)})};e.prototype._renderLegendForLayer=function(a){var b=this,d;if(!a.ready)return null;if(a.children.length)return d=a.children.map(function(a){return b._renderLegendForLayer(a)}).toArray(),l.tsx("div",{key:a.layer.uid,
class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},l.tsx("div",{class:"esri-legend--card__service-caption-container"},a.title),d);var c=a.legendElements;if(c&&!c.length)return null;var e=c.some(function(a){return"relationship-ramp"===a.type}),c=c.map(function(d,c){return b._renderLegendForElement(d,a,c,e)}).filter(function(a){return!!a});if(!c.length)return null;var f=(d={},d["esri-legend--card__group-layer-child"]=!!a.parent,d);return l.tsx("div",{key:a.layer.uid,
class:this.classes("esri-legend--card__service",f)},l.tsx("div",{class:"esri-legend--card__service-caption-container"},l.tsx("div",{class:"esri-legend--card__service-caption-text"},a.title)),l.tsx("div",{class:"esri-legend--card__service-content"},c))};e.prototype._renderLegendForElement=function(a,b,d,c){var e=this;void 0===c&&(c=!1);var f,h="color-ramp"===a.type,g="opacity-ramp"===a.type,w="size-ramp"===a.type,m=b.layer,k=a.title,n=null;"string"===typeof k?n=k:k&&(n=u.getTitle(k,h||g),n=k.title?
k.title+" ("+n+")":n);d="esri-legend--card__"+m.uid+"-type-"+a.type+"-"+d;k=this._hasIndicators?l.tsx("div",null,l.tsx("h3",{class:this.classes("esri-widget__heading","esri-legend--card__carousel-title")},b.title),l.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},n)):n?l.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},n):null;n=null;"symbol-table"===a.type?(w=a.infos.map(function(d,c){return e._renderLegendForElementInfo(d,
b,a.legendType,c)}).filter(function(a){return!!a}),w.length&&(m=w[0].properties.classes&&w[0].properties.classes["esri-legend--card__symbol-row"],c=(f={},f["esri-legend--card__label-container"]=!m&&!c,f["esri-legend--card__relationship-label-container"]=c,f),n=l.tsx("div",{key:d,class:"esri-legend--card__section"},k,l.tsx("div",{class:this.classes(c)},w)))):"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?n=l.tsx("div",{key:d,class:"esri-legend--card__section"},k,this._renderLegendForRamp(a,
m.opacity)):w?n=l.tsx("div",{key:d,class:"esri-legend--card__section"},k,this._renderSizeRamps(a,m.opacity)):"relationship-ramp"===a.type&&(n=l.tsx("div",{key:d,class:this.classes("esri-legend--card__section","esri-legend--card__relationship-section")},k,q.renderRelationshipRamp(a,this.id,m.opacity)));if(!n)return null;this._sectionMap.set(d,n);return n};e.prototype._renderLegendForElementInfo=function(a,b,d,e){var f,h,g,w=b.layer;if(a.type)return this._renderLegendForElement(a,b,e);b=u.isImageryStretchedLegend(w,
d);if(a.symbol&&a.preview){if(-1===a.symbol.type.indexOf("simple-fill")){if(!a.label)return l.tsx("div",{key:e,bind:a.preview,afterCreate:u.attachToNode});w=(f={},f["esri-legend--card__symbol-cell"]=this._hasIndicators,f);return l.tsx("div",{key:e,class:this.classes("esri-legend--card__layer-row",(h={},h["esri-legend--card__symbol-row"]=this._hasIndicators,h))},l.tsx("div",{class:this.classes(w),bind:a.preview,afterCreate:u.attachToNode}),l.tsx("div",{class:this.classes("esri-legend--card__image-label",
(g={},g["esri-legend--card__label-cell"]=this._hasIndicators,g))},u.getTitle(a.label,!1)||""))}g=h=f=255;b=0;var q=d=255,k=255,m=0,n=a.symbol.color&&a.symbol.color.a,p=a.symbol.outline&&a.symbol.outline.color.a;n&&(f=a.symbol.color.r,h=a.symbol.color.g,g=a.symbol.color.b,b=a.symbol.color.a*w.opacity);p&&(d=a.symbol.outline.color.r,q=a.symbol.outline.color.g,k=a.symbol.outline.color.b,m=a.symbol.outline.color.a*w.opacity);var v=(w=a.symbol.color?c.isBright(a.symbol.color):!0)?"rgba(255, 255, 255, .6)":
"rgba(0, 0, 0, .6)";return l.tsx("div",{key:e,class:"esri-legend--card__layer-row"},l.tsx("div",{class:"esri-legend--card__label-element",styles:{background:n?"rgba("+f+", "+h+", "+g+", "+b+")":"none",color:w?"black":"white",textShadow:"-1px -1px 0 "+v+",\n                                              1px -1px 0 "+v+",\n                                              -1px 1px 0 "+v+",\n                                              1px 1px 0 "+v,border:p?"1px solid rgba("+d+", "+q+", "+k+", "+m+")":
"none"}}," ",a.label," "))}if(a.src)return w=this._renderImage(a,w,b),l.tsx("div",{key:e,class:"esri-legend--card__layer-row"},w,l.tsx("div",{class:"esri-legend--card__image-label"},a.label||""))};e.prototype._renderImage=function(a,b,d){var c,e=a.label,f=a.src,h=a.opacity;d=(c={},c["esri-legend--card__imagery-layer-image--stretched"]=d,c["esri-legend--card__symbol"]=!d,c);b={opacity:""+(null!=h?h:b.opacity)};return l.tsx("img",{alt:e,src:f,border:0,width:a.width,height:a.height,class:this.classes(d),
styles:b})};e.prototype._drawImageOnSizeRamp=function(a,b,d){var c=d.x,e=d.y,f=d.width,h=d.height,g=new Image;g.src=b;g.onload=function(){a.drawImage(g,c,e,f,h);URL.revokeObjectURL(b)}};e.prototype._attachSizeRampToNode=function(a){var b=a["data-layer-opacity"];null!=b&&(a.style.opacity=b.toString());var b=a["data-legend-element"].infos,d=b[0],c=b[b.length-1],e=d.symbol,f=c.symbol,h="picture-marker"===e.type;e?-1<e.type.indexOf("3d")?(b=e.symbolLayers&&e.symbolLayers.length)?(b=e.symbolLayers.getItemAt(b-
1).get("resource.primitive"),b="triangle"===b||"cone"===b||"tetrahedron"===b):b=void 0:b="triangle"===e.style:b=void 0;var g;e?-1<e.type.indexOf("3d")?(g=e.symbolLayers&&e.symbolLayers.length)?(g=e.symbolLayers.getItemAt(g-1),g=g.resource&&g.resource.primitive,g="circle"===g||"cross"===g||"kite"===g||"sphere"===g||"cube"===g||"diamond"===g):g=void 0:(g=e.style,g="circle"===g||"diamond"===g||"cross"===g):g=void 0;var q,l;h?(q=e.url,l=f.url):(d.preview&&(d.preview.firstChild.setAttributeNS("http://www.w3.org/2000/xmlns/",
"xmlns","http://www.w3.org/2000/svg"),q=new Blob([d.preview.innerHTML],{type:"image/svg+xml"}),q=URL.createObjectURL(q)),c.preview&&(c.preview.firstChild.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg"),l=new Blob([c.preview.innerHTML],{type:"image/svg+xml"}),l=URL.createObjectURL(l)));var k=r.pt2px(d.size+d.outlineSize)*z,e=r.pt2px(c.size+c.outlineSize)*z,f=this._hasIndicators?k:k+100*z,h=this._hasIndicators?f+50*z:k,d=document.createElement("canvas");d.width=
f;d.height=h;d.style.width=d.width/z+"px";d.style.height=d.height/z+"px";c=d.getContext("2d");this._hasIndicators?(this._drawImageOnSizeRamp(c,q,{x:0,y:0,width:k,height:k}),this._drawImageOnSizeRamp(c,l,{x:f/2-e/2,y:h-e,width:e,height:e}),c.beginPath(),q=f/2-e/2,l=h-(b?0:g?e/2:e),c.moveTo(0,g?f/2:f),c.lineTo(q,l),q=f/2+e/2,b=h-(b?0:g?e/2:e),c.moveTo(f,g?f/2:f),c.lineTo(q,b)):(this._drawImageOnSizeRamp(c,q,{x:f-k,y:0,width:k,height:k}),this._drawImageOnSizeRamp(c,l,{x:0,y:h/2-e/2,width:e,height:e}),
c.beginPath(),q=f-(g||b?k/2:k),c.moveTo(e-(g||b?e/2:0),h/2-e/2),c.lineTo(q,0),b=f-(g?k/2:k),c.moveTo(e-(g?e/2:0),h/2+e/2),c.lineTo(b,h));c.strokeStyle="#ddd";c.stroke();a.appendChild(d)};e.prototype._renderSizeRamps=function(a,b){var d,c=a.infos,e=c[0].label,c=c[c.length-1].label;return l.tsx("div",{class:this.classes("esri-legend--card__layer-row",(d={},d["esri-legend--card__size-ramp-row"]=this._hasIndicators,d))},l.tsx("div",{class:"esri-legend--card__ramp-label"},this._hasIndicators?e:c),l.tsx("div",
{class:"esri-legend--card__size-ramp-container"},l.tsx("div",{bind:this,"data-layer-opacity":b,"data-legend-element":a,afterCreate:this._attachSizeRampToNode})),l.tsx("div",{class:"esri-legend--card__ramp-label"},this._hasIndicators?c:e))};e.prototype._renderLegendForRamp=function(a,b){var d=a.infos,c="heatmap-ramp"===a.type,e=d.length-1,h=2<e&&!c?25*e:100,g=h+20;a=document.createElement("div");a.style.width=g+"px";null!=b&&(a.style.opacity=b.toString());b=m.createSurface(a,g,25);var q=d.slice(0).reverse();
try{q.forEach(function(a,b){a.offset=c?a.ratio:b/e}),c||b.createPath("M0 12.5 L10 0 L10 25 Z").setFill(q[0].color).setStroke(null),b.createRect({x:10,y:0,width:h,height:25}).setFill({type:"linear",x1:10,y1:0,x2:h+10,y2:0,colors:q}).setStroke(null),c||b.createPath("M"+(h+10)+" 0 L"+g+" 12.5 L"+(h+10)+" 25 Z").setFill(q[q.length-1].color).setStroke(null)}catch(P){b.clear(),b.destroy()}if(!b)return null;b=q.filter(function(a,b){return!!a.label&&0!==b&&b!==q.length-1}).map(function(a){return l.tsx("div",
{class:"esri-legend--card__interval-separators-container"},l.tsx("div",{class:"esri-legend--card__interval-separator"},"|"),l.tsx("div",{class:"esri-legend--card__ramp-label"},a.label))});h=d[d.length-1].label;d=d[0].label;return l.tsx("div",{class:"esri-legend--card__layer-row"},l.tsx("div",{class:"esri-legend--card__ramp-label"},c?f[h]:h),l.tsx("div",{class:"esri-legend--card__symbol-container"},l.tsx("div",{bind:a,afterCreate:u.attachToNode}),b),l.tsx("div",{class:"esri-legend--card__ramp-label"},
c?f[d]:d))};k([l.renderable(),v.property()],e.prototype,"activeLayerInfos",void 0);k([v.property()],e.prototype,"layout",void 0);k([v.property({readOnly:!0})],e.prototype,"type",void 0);k([v.property()],e.prototype,"view",void 0);k([l.accessibleHandler()],e.prototype,"_selectSection",null);return e=k([v.subclass("esri.widgets.Legend.styles.Card")],e)}(v.declared(e))})},"esri/widgets/Legend/styles/support/utils":function(){define(["require","exports","../../support/relationshipRampUtils","../../support/styleUtils",
"../../../support/widget"],function(t,p,g,k,b){Object.defineProperty(p,"__esModule",{value:!0});p.renderRelationshipRamp=function(a,f,m){var n=a.labels,h=!!a.focus;a=g.renderRamp(a,f,m);return h?b.tsx("div",{class:"esri-relationship-ramp--diamond__container"},b.tsx("div",{class:"esri-relationship-ramp--diamond__left-column"},n.left),b.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column"},b.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},n.top),b.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--ramp",
bind:a,afterCreate:k.attachToNode}),b.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},n.bottom)),b.tsx("div",{class:"esri-relationship-ramp--diamond__right-column"},n.right)):b.tsx("div",{class:"esri-relationship-ramp--square__table"},b.tsx("div",{class:"esri-relationship-ramp--square__table-row"},b.tsx("div",{class:b.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-bottom")},
n.left),b.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),b.tsx("div",{class:b.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-bottom")},n.top)),b.tsx("div",{class:"esri-relationship-ramp--square__table-row"},b.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),b.tsx("div",{class:"esri-relationship-ramp--square__table-cell",bind:a,afterCreate:k.attachToNode}),b.tsx("div",
{class:"esri-relationship-ramp--square__table-cell"})),b.tsx("div",{class:"esri-relationship-ramp--square__table-row"},b.tsx("div",{class:b.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-top")},n.bottom),b.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),b.tsx("div",{class:b.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-top")},
n.right)))}})},"esri/widgets/Legend/support/styleUtils":function(){define(["require","exports","dojo/i18n!../../Legend/nls/Legend","../../../intl"],function(t,p,g,k){Object.defineProperty(p,"__esModule",{value:!0});p.attachToNode=function(b){b.appendChild(this)};p.getTitle=function(b,a){if(b){if("string"===typeof b)return b;if("value"in b||"unit"in b)return k.substitute(g.dotValue,b);var f=null;a?f=b.ratioPercentTotal?"showRatioPercentTotal":b.ratioPercent?"showRatioPercent":b.ratio?"showRatio":b.normField?
"showNormField":b.field?"showField":null:a||(f=b.normField?"showNormField":b.normByPct?"showNormPct":b.field?"showField":null);return f?k.substitute("showField"===f?"{field}":g[f],{field:b.field,normField:b.normField}):null}};p.isRendererTitle=function(b,a){return!a};p.isImageryStretchedLegend=function(b,a){return!!(a&&"Stretched"===a&&10.3<=b.version&&"esri.layers.ImageryLayer"===b.declaredClass)}})},"esri/widgets/support/colorUtils":function(){define(["require","exports","../../Color"],function(t,
p,g){function k(a){return new g(a)}function b(a){return!!a&&4===a.length&&h.test(a)}function a(a){return!!a&&7===a.length&&r.test(a)}function f(a){return 127<=.299*a.r+.587*a.g+.114*a.b}function m(a,b){void 0===b&&(b=1);b=Math.pow(.7,b);return new g([Math.round(a.r*b),Math.round(a.g*b),Math.round(a.b*b),a.a])}function n(a,b){void 0===b&&(b=1);b=Math.pow(.7,b);var e=a.r,f=a.g,c=a.b;30>e&&(e=30);30>f&&(f=30);30>c&&(c=30);return new g([Math.min(255,Math.round(e/b)),Math.min(255,Math.round(f/b)),Math.min(255,
Math.round(c/b)),a.a])}Object.defineProperty(p,"__esModule",{value:!0});var h=/^#[0-9A-F]{3}$/i,r=/^#[0-9A-F]{6}$/i;p.equal=function(a,b){return a&&b&&a.r===b.r&&a.g===b.g&&a.b===b.b&&a.a===b.a};p.normalizeHex=function(a){return a?"#"+a.trim().replace(/#/g,"").substr(0,6):""};p.normalizeColor=k;p.isValidHex=function(f){return b(f)||a(f)};p.isShorthandHex=b;p.isLonghandHex=a;p.toHex=function(a){return k(a).toHex()};p.getContrastingColor=function(a){return f(a)?m(a):n(a,3)};p.isBright=f;p.darker=m;
p.brighter=n})},"esri/widgets/Legend/styles/Classic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/i18n!../../Legend/nls/Legend dojox/gfx ../../../core/accessorSupport/decorators ../../Widget ./support/utils ../support/styleUtils ../../support/widget".split(" "),function(t,p,g,k,b,a,f,m,n,h,r){return function(m){function e(a){a=m.call(this)||this;a.activeLayerInfos=null;a.type="classic";return a}g(e,m);e.prototype.render=
function(){var a=this,e=this.activeLayerInfos,c=this.classes("esri-legend esri-widget--panel","esri-widget"),e=e&&e.toArray().map(function(b){return a._renderLegendForLayer(b)}).filter(function(a){return!!a});return r.tsx("div",{class:c},e&&e.length?e:r.tsx("div",{class:"esri-legend__message"},b.noLegend))};e.prototype._renderLegendForLayer=function(a){var b=this,c;if(!a.ready)return null;var e=!!a.children.length,f="esri-legend__"+a.layer.uid+"-version-"+a.version,h=a.title?r.tsx("h3",{class:this.classes("esri-widget__heading",
"esri-legend__service-label")},a.title):null;if(e)return c=a.children.map(function(a){return b._renderLegendForLayer(a)}).toArray(),r.tsx("div",{key:f,class:this.classes("esri-legend__service","esri-legend__group-layer")},h,c);if((e=a.legendElements)&&!e.length)return null;e=e.map(function(c){return b._renderLegendForElement(c,a.layer)}).filter(function(a){return!!a});if(!e.length)return null;var g=(c={},c["esri-legend__group-layer-child"]=!!a.parent,c);return r.tsx("div",{key:f,class:this.classes("esri-legend__service",
g)},h,r.tsx("div",{class:"esri-legend__layer"},e))};e.prototype._renderLegendForElement=function(a,b,c){var e=this,f,g="color-ramp"===a.type,k="opacity-ramp"===a.type,m="size-ramp"===a.type,q=null;if("symbol-table"===a.type||m){var d=a.infos.map(function(d){return e._renderLegendForElementInfo(d,b,m,a.legendType)}).filter(function(a){return!!a});d.length&&(q=r.tsx("div",{class:"esri-legend__layer-body"},d))}else"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?q=this._renderLegendForRamp(a,
b.opacity):"relationship-ramp"===a.type&&(q=n.renderRelationshipRamp(a,this.id,b.opacity));if(!q)return null;var d=a.title,w=null;"string"===typeof d?w=d:d&&(w=h.getTitle(d,g||k),w=h.isRendererTitle(d,g||k)&&d.title?d.title+" ("+w+")":w);g=c?"esri-legend__layer-child-table":"esri-legend__layer-table";k=w?r.tsx("div",{class:"esri-legend__layer-caption"},w):null;c=(f={},f["esri-legend__layer-table--size-ramp"]=m||!c,f);return r.tsx("div",{class:this.classes(g,c)},k,q)};e.prototype._renderLegendForRamp=
function(e,f){var c=e.infos,g="opacity-ramp"===e.type,k="heatmap-ramp"===e.type,m=c.length-1;e=document.createElement("div");e.className="esri-legend__color-ramp "+(g?"esri-legend__opacity-ramp":"");e.style.height="75px";null!=f&&(e.style.opacity=f.toString());f=a.createSurface(e,"100%",75);try{k||c.forEach(function(a,b){a.offset=b/m}),f.createRect({x:0,y:0,width:"100%",height:75}).setFill({type:"linear",x1:0,y1:0,x2:0,y2:75,colors:c}).setStroke(null)}catch(A){f.clear(),f.destroy()}if(!f)return null;
c=c.filter(function(a){return!!a.label}).map(function(a){return r.tsx("div",{class:"esri-legend__ramp-label"},k?b[a.label]:a.label)});return r.tsx("div",{class:"esri-legend__layer-row"},r.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--symbols",styles:{width:"24px"}},r.tsx("div",{class:"esri-legend__ramps",bind:e,afterCreate:h.attachToNode})),r.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},r.tsx("div",{class:"esri-legend__ramp-labels",styles:{height:"75px"}},
c)))};e.prototype._renderLegendForElementInfo=function(a,b,c,e){var f,g;if(a.type)return this._renderLegendForElement(a,b,!0);var k=null;e=h.isImageryStretchedLegend(b,e);a.symbol&&a.preview?k=r.tsx("div",{class:"esri-legend__symbol",bind:a.preview,afterCreate:h.attachToNode}):a.src&&(k=this._renderImage(a,b,e));if(!k)return null;b=(f={},f["esri-legend__imagery-layer-info--stretched"]=e,f);c=(g={},g["esri-legend__imagery-layer-info--stretched"]=e,g["esri-legend__size-ramp"]=!e&&c,g);return r.tsx("div",
{class:"esri-legend__layer-row"},r.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--symbols",c)},k),r.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--info",b)},h.getTitle(a.label,!1)||""))};e.prototype._renderImage=function(a,b,c){var e,f=a.label,h=a.src,g=a.opacity;c=(e={},e["esri-legend__imagery-layer-image--stretched"]=c,e["esri-legend__symbol"]=!c,e);b={opacity:""+(null!=g?g:b.opacity)};return r.tsx("img",{alt:f,src:h,border:0,width:a.width,
height:a.height,class:this.classes(c),styles:b})};k([r.renderable(),f.property()],e.prototype,"activeLayerInfos",void 0);k([f.property({readOnly:!0})],e.prototype,"type",void 0);return e=k([f.subclass("esri.widgets.Legend.styles.Classic")],e)}(f.declared(m))})},"dojox/gfx/svg":function(){define("dojo/_base/lang dojo/_base/sniff dojo/_base/window dojo/dom dojo/_base/declare dojo/_base/array dojo/dom-geometry dojo/dom-attr dojo/_base/Color ./_base ./shape ./path".split(" "),function(t,p,g,k,b,a,f,m,
n,h,r,v){function e(a,b){return g.doc.createElementNS?g.doc.createElementNS(a,b):g.doc.createElement(b)}function q(a,b,c,e){return a.setAttributeNS?a.setAttributeNS(b,c,e):a.setAttribute(c,e)}function u(a){return c.useSvgWeb?g.doc.createTextNode(a,!0):g.doc.createTextNode(a)}var c=h.svg={};c.useSvgWeb="undefined"!=typeof window.svgweb;var l=navigator.userAgent,z=p("ios"),B=p("chrome")?"auto":"optimizeLegibility";c.xmlns={xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"};c.getRef=
function(a){return a&&"none"!=a?a.match(/^url\(#.+\)$/)?k.byId(a.slice(5,-1)):a.match(/^#dojoUnique\d+$/)?k.byId(a.slice(1)):null:null};c.dasharray={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};var A=0;c.Shape=b("dojox.gfx.svg.Shape",r.Shape,{destroy:function(){if(this.fillStyle&&"type"in this.fillStyle){var a=this.rawNode.getAttribute("fill");
(a=c.getRef(a))&&a.parentNode.removeChild(a)}this.clip&&(a=this.rawNode.getAttribute("clip-path"))&&(a=k.byId(a.match(/gfx_clip[\d]+/)[0]))&&a.parentNode.removeChild(a);r.Shape.prototype.destroy.apply(this,arguments)},setFill:function(b){if(!b)return this.fillStyle=null,this.rawNode.setAttribute("fill","none"),this.rawNode.setAttribute("fill-opacity",0),this;var d,c=function(a){this.setAttribute(a,d[a].toFixed(8))};if("object"==typeof b&&"type"in b){switch(b.type){case "linear":d=h.makeParameters(h.defaultLinearGradient,
b);b=this._setFillObject(d,"linearGradient");a.forEach(["x1","y1","x2","y2"],c,b);break;case "radial":d=h.makeParameters(h.defaultRadialGradient,b);b=this._setFillObject(d,"radialGradient");a.forEach(["cx","cy","r"],c,b);break;case "pattern":d=h.makeParameters(h.defaultPattern,b),b=this._setFillObject(d,"pattern"),a.forEach(["x","y","width","height"],c,b)}this.fillStyle=d;return this}this.fillStyle=d=h.normalizeColor(b);this.rawNode.setAttribute("fill",d.toCss());this.rawNode.setAttribute("fill-opacity",
d.a);this.rawNode.setAttribute("fill-rule","evenodd");return this},setStroke:function(a){var b=this.rawNode;if(!a)return this.strokeStyle=null,b.setAttribute("stroke","none"),b.setAttribute("stroke-opacity",0),this;if("string"==typeof a||t.isArray(a)||a instanceof n)a={color:a};a=this.strokeStyle=h.makeParameters(h.defaultStroke,a);a.color=h.normalizeColor(a.color);if(a){var d=0>a.width?0:a.width;b.setAttribute("stroke",a.color.toCss());b.setAttribute("stroke-opacity",a.color.a);b.setAttribute("stroke-width",
d);b.setAttribute("stroke-linecap",a.cap);"number"==typeof a.join?(b.setAttribute("stroke-linejoin","miter"),b.setAttribute("stroke-miterlimit",a.join)):b.setAttribute("stroke-linejoin",a.join);var e=a.style.toLowerCase();e in c.dasharray&&(e=c.dasharray[e]);if(e instanceof Array){var e=t._toArray(e),f;for(f=0;f<e.length;++f)e[f]*=d;if("butt"!=a.cap){for(f=0;f<e.length;f+=2)e[f]-=d,1>e[f]&&(e[f]=1);for(f=1;f<e.length;f+=2)e[f]+=d}e=e.join(",")}b.setAttribute("stroke-dasharray",e);b.setAttribute("dojoGfxStrokeStyle",
a.style)}return this},_getParentSurface:function(){for(var a=this.parent;a&&!(a instanceof h.Surface);a=a.parent);return a},_setFillObject:function(a,b){var d=c.xmlns.svg;this.fillStyle=a;var f=this._getParentSurface().defNode,g=this.rawNode.getAttribute("fill");if(g=c.getRef(g))if(g.tagName.toLowerCase()!=b.toLowerCase()){var k=g.id;g.parentNode.removeChild(g);g=e(d,b);g.setAttribute("id",k);f.appendChild(g)}else for(;g.childNodes.length;)g.removeChild(g.lastChild);else g=e(d,b),g.setAttribute("id",
h._base._getUniqueId()),f.appendChild(g);if("pattern"==b)g.setAttribute("patternUnits","userSpaceOnUse"),d=e(d,"image"),d.setAttribute("x",0),d.setAttribute("y",0),d.setAttribute("width",(0>a.width?0:a.width).toFixed(8)),d.setAttribute("height",(0>a.height?0:a.height).toFixed(8)),q(d,c.xmlns.xlink,"xlink:href",a.src),g.appendChild(d);else for(g.setAttribute("gradientUnits","userSpaceOnUse"),b=0;b<a.colors.length;++b){var f=a.colors[b],k=e(d,"stop"),m=f.color=h.normalizeColor(f.color);k.setAttribute("offset",
f.offset.toFixed(8));k.setAttribute("stop-color",m.toCss());k.setAttribute("stop-opacity",m.a);g.appendChild(k)}this.rawNode.setAttribute("fill","url(#"+g.getAttribute("id")+")");this.rawNode.removeAttribute("fill-opacity");this.rawNode.setAttribute("fill-rule","evenodd");return g},_applyTransform:function(){if(this.matrix){var a=this.matrix;this.rawNode.setAttribute("transform","matrix("+a.xx.toFixed(8)+","+a.yx.toFixed(8)+","+a.xy.toFixed(8)+","+a.yy.toFixed(8)+","+a.dx.toFixed(8)+","+a.dy.toFixed(8)+
")")}else this.rawNode.removeAttribute("transform");return this},setRawNode:function(a){a=this.rawNode=a;"image"!=this.shape.type&&a.setAttribute("fill","none");a.setAttribute("fill-opacity",0);a.setAttribute("stroke","none");a.setAttribute("stroke-opacity",0);a.setAttribute("stroke-width",1);a.setAttribute("stroke-linecap","butt");a.setAttribute("stroke-linejoin","miter");a.setAttribute("stroke-miterlimit",4);a.__gfxObject__=this},setShape:function(a){this.shape=h.makeParameters(this.shape,a);for(var b in this.shape)if("type"!=
b){a=this.shape[b];if("width"===b||"height"===b)a=0>a?0:a;this.rawNode.setAttribute(b,a)}this.bbox=null;return this},_moveToFront:function(){this.rawNode.parentNode.appendChild(this.rawNode);return this},_moveToBack:function(){this.rawNode.parentNode.insertBefore(this.rawNode,this.rawNode.parentNode.firstChild);return this},setClip:function(a){this.inherited(arguments);var b=a?"width"in a?"rect":"cx"in a?"ellipse":"points"in a?"polyline":"d"in a?"path":null:null;if(a&&!b)return this;"polyline"===
b&&(a=t.clone(a),a.points=a.points.join(","));var d,f=m.get(this.rawNode,"clip-path");f&&(d=k.byId(f.match(/gfx_clip[\d]+/)[0]))&&d.removeChild(d.childNodes[0]);a?(d?(b=e(c.xmlns.svg,b),d.appendChild(b)):(f="gfx_clip"+ ++A,this.rawNode.setAttribute("clip-path","url(#"+f+")"),d=e(c.xmlns.svg,"clipPath"),b=e(c.xmlns.svg,b),d.appendChild(b),this.rawNode.parentNode.insertBefore(d,this.rawNode),m.set(d,"id",f)),m.set(b,a)):(this.rawNode.removeAttribute("clip-path"),d&&d.parentNode.removeChild(d));return this},
_removeClipNode:function(){var a,b=m.get(this.rawNode,"clip-path");b&&(a=k.byId(b.match(/gfx_clip[\d]+/)[0]))&&a.parentNode.removeChild(a);return a}});c.Group=b("dojox.gfx.svg.Group",c.Shape,{constructor:function(){r.Container._init.call(this)},setRawNode:function(a){this.rawNode=a;this.rawNode.__gfxObject__=this},destroy:function(){this.clear(!0);c.Shape.prototype.destroy.apply(this,arguments)}});c.Group.nodeType="g";c.Rect=b("dojox.gfx.svg.Rect",[c.Shape,r.Rect],{setShape:function(a){this.shape=
h.makeParameters(this.shape,a);this.bbox=null;for(var b in this.shape)if("type"!=b&&"r"!=b){a=this.shape[b];if("width"===b||"height"===b)a=0>a?0:a;this.rawNode.setAttribute(b,a)}null!=this.shape.r&&(this.rawNode.setAttribute("ry",this.shape.r),this.rawNode.setAttribute("rx",this.shape.r));return this}});c.Rect.nodeType="rect";c.Ellipse=b("dojox.gfx.svg.Ellipse",[c.Shape,r.Ellipse],{});c.Ellipse.nodeType="ellipse";c.Circle=b("dojox.gfx.svg.Circle",[c.Shape,r.Circle],{});c.Circle.nodeType="circle";
c.Line=b("dojox.gfx.svg.Line",[c.Shape,r.Line],{});c.Line.nodeType="line";c.Polyline=b("dojox.gfx.svg.Polyline",[c.Shape,r.Polyline],{setShape:function(a,b){a&&a instanceof Array?(this.shape=h.makeParameters(this.shape,{points:a}),b&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.shape=h.makeParameters(this.shape,a);this.bbox=null;this._normalizePoints();a=[];b=this.shape.points;for(var d=0;d<b.length;++d)a.push(b[d].x.toFixed(8),b[d].y.toFixed(8));this.rawNode.setAttribute("points",
a.join(" "));return this}});c.Polyline.nodeType="polyline";c.Image=b("dojox.gfx.svg.Image",[c.Shape,r.Image],{setShape:function(a){this.shape=h.makeParameters(this.shape,a);this.bbox=null;a=this.rawNode;for(var b in this.shape)if("type"!=b&&"src"!=b){var d=this.shape[b];if("width"===b||"height"===b)d=0>d?0:d;a.setAttribute(b,d)}a.setAttribute("preserveAspectRatio","none");q(a,c.xmlns.xlink,"xlink:href",this.shape.src);a.__gfxObject__=this;return this}});c.Image.nodeType="image";c.Text=b("dojox.gfx.svg.Text",
[c.Shape,r.Text],{setShape:function(a){this.shape=h.makeParameters(this.shape,a);this.bbox=null;a=this.rawNode;var b=this.shape;a.setAttribute("x",b.x);a.setAttribute("y",b.y);a.setAttribute("text-anchor",b.align);a.setAttribute("text-decoration",b.decoration);a.setAttribute("rotate",b.rotated?90:0);a.setAttribute("kerning",b.kerning?"auto":0);a.setAttribute("text-rendering",B);a.firstChild?a.firstChild.nodeValue=b.text:a.appendChild(u(b.text));return this},getTextWidth:function(){var a=this.rawNode,
b=a.parentNode,a=a.cloneNode(!0);a.style.visibility="hidden";var c=0,e=a.firstChild.nodeValue;b.appendChild(a);if(""!=e)for(;!c;)c=a.getBBox?parseInt(a.getBBox().width):68;b.removeChild(a);return c},getBoundingBox:function(){var a=null;if(this.getShape().text)try{a=this.rawNode.getBBox()}catch(w){a={x:0,y:0,width:0,height:0}}return a}});c.Text.nodeType="text";c.Path=b("dojox.gfx.svg.Path",[c.Shape,v.Path],{_updateWithSegment:function(a){this.inherited(arguments);"string"==typeof this.shape.path&&
this.rawNode.setAttribute("d",this.shape.path)},setShape:function(a){this.inherited(arguments);this.shape.path?this.rawNode.setAttribute("d",this.shape.path):this.rawNode.removeAttribute("d");return this}});c.Path.nodeType="path";c.TextPath=b("dojox.gfx.svg.TextPath",[c.Shape,v.TextPath],{_updateWithSegment:function(a){this.inherited(arguments);this._setTextPath()},setShape:function(a){this.inherited(arguments);this._setTextPath();return this},_setTextPath:function(){if("string"==typeof this.shape.path){var a=
this.rawNode;if(!a.firstChild){var b=e(c.xmlns.svg,"textPath"),f=u("");b.appendChild(f);a.appendChild(b)}b=(b=a.firstChild.getAttributeNS(c.xmlns.xlink,"href"))&&c.getRef(b);if(!b&&(f=this._getParentSurface())){var f=f.defNode,b=e(c.xmlns.svg,"path"),g=h._base._getUniqueId();b.setAttribute("id",g);f.appendChild(b);q(a.firstChild,c.xmlns.xlink,"xlink:href","#"+g)}b&&b.setAttribute("d",this.shape.path)}},_setText:function(){var a=this.rawNode;if(!a.firstChild){var b=e(c.xmlns.svg,"textPath"),f=u("");
b.appendChild(f);a.appendChild(b)}a=a.firstChild;b=this.text;a.setAttribute("alignment-baseline","middle");switch(b.align){case "middle":a.setAttribute("text-anchor","middle");a.setAttribute("startOffset","50%");break;case "end":a.setAttribute("text-anchor","end");a.setAttribute("startOffset","100%");break;default:a.setAttribute("text-anchor","start"),a.setAttribute("startOffset","0%")}a.setAttribute("baseline-shift","0.5ex");a.setAttribute("text-decoration",b.decoration);a.setAttribute("rotate",
b.rotated?90:0);a.setAttribute("kerning",b.kerning?"auto":0);a.firstChild.data=b.text}});c.TextPath.nodeType="text";var x=534<function(){var a=/WebKit\/(\d*)/.exec(l);return a?a[1]:0}();c.Surface=b("dojox.gfx.svg.Surface",r.Surface,{constructor:function(){r.Container._init.call(this)},destroy:function(){r.Container.clear.call(this,!0);this.defNode=null;this.inherited(arguments)},setDimensions:function(a,b){if(!this.rawNode)return this;a=0>a?0:a;b=0>b?0:b;this.rawNode.setAttribute("width",a);this.rawNode.setAttribute("height",
b);x&&(this.rawNode.style.width=a,this.rawNode.style.height=b);return this},getDimensions:function(){return this.rawNode?{width:h.normalizedLength(this.rawNode.getAttribute("width")),height:h.normalizedLength(this.rawNode.getAttribute("height"))}:null}});c.createSurface=function(a,b,f){var d=new c.Surface;d.rawNode=e(c.xmlns.svg,"svg");d.rawNode.setAttribute("overflow","hidden");b&&d.rawNode.setAttribute("width",0>b?0:b);f&&d.rawNode.setAttribute("height",0>f?0:f);b=e(c.xmlns.svg,"defs");d.rawNode.appendChild(b);
d.defNode=b;d._parent=k.byId(a);d._parent.appendChild(d.rawNode);h._base._fixMsTouchAction(d);return d};p={_setFont:function(){var a=this.fontStyle;this.rawNode.setAttribute("font-style",a.style);this.rawNode.setAttribute("font-variant",a.variant);this.rawNode.setAttribute("font-weight",a.weight);this.rawNode.setAttribute("font-size",a.size);this.rawNode.setAttribute("font-family",a.family)}};var y=r.Container;b=c.Container={openBatch:function(){if(!this._batch){var a;a=c.useSvgWeb?g.doc.createDocumentFragment(!0):
g.doc.createDocumentFragment();this.fragment=a}++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this.fragment&&!this._batch&&(this.rawNode.appendChild(this.fragment),delete this.fragment);return this},add:function(a){this!=a.getParent()&&(this.fragment?this.fragment.appendChild(a.rawNode):this.rawNode.appendChild(a.rawNode),y.add.apply(this,arguments),a.setClip(a.clip));return this},remove:function(a,b){this==a.getParent()&&(this.rawNode==a.rawNode.parentNode&&
this.rawNode.removeChild(a.rawNode),this.fragment&&this.fragment==a.rawNode.parentNode&&this.fragment.removeChild(a.rawNode),a._removeClipNode(),y.remove.apply(this,arguments));return this},clear:function(){for(var a=this.rawNode;a.lastChild;)a.removeChild(a.lastChild);var b=this.defNode;if(b){for(;b.lastChild;)b.removeChild(b.lastChild);a.appendChild(b)}return y.clear.apply(this,arguments)},getBoundingBox:y.getBoundingBox,_moveChildToFront:y._moveChildToFront,_moveChildToBack:y._moveChildToBack};
v=c.Creator={createObject:function(a,b){if(!this.rawNode)return null;var d=new a;a=e(c.xmlns.svg,a.nodeType);d.setRawNode(a);d.setShape(b);this.add(d);return d}};t.extend(c.Text,p);t.extend(c.TextPath,p);t.extend(c.Group,b);t.extend(c.Group,r.Creator);t.extend(c.Group,v);t.extend(c.Surface,b);t.extend(c.Surface,r.Creator);t.extend(c.Surface,v);c.fixTarget=function(a,b){a.gfxTarget||(a.gfxTarget=z&&a.target.wholeText?a.target.parentElement.__gfxObject__:a.target.__gfxObject__);return!0};c.useSvgWeb&&
(c.createSurface=function(a,b,g){var d=new c.Surface;b=0>b?0:b;g=0>g?0:g;if(!b||!g){var m=f.position(a);b=b||m.w;g=g||m.h}a=k.byId(a);var m=a.id?a.id+"_svgweb":h._base._getUniqueId(),l=e(c.xmlns.svg,"svg");l.id=m;l.setAttribute("width",b);l.setAttribute("height",g);svgweb.appendChild(l,a);l.addEventListener("SVGLoad",function(){d.rawNode=this;d.isLoaded=!0;var a=e(c.xmlns.svg,"defs");d.rawNode.appendChild(a);d.defNode=a;if(d.onLoad)d.onLoad(d)},!1);d.isLoaded=!1;return d},c.Surface.extend({destroy:function(){var a=
this.rawNode;svgweb.removeChild(a,a.parentNode)}}),p={connect:function(a,b,c){"on"===a.substring(0,2)&&(a=a.substring(2));c=2==arguments.length?b:t.hitch(b,c);this.getEventSource().addEventListener(a,c,!1);return[this,a,c]},disconnect:function(a){this.getEventSource().removeEventListener(a[1],a[2],!1);delete a[0]}},t.extend(c.Shape,p),t.extend(c.Surface,p));return c})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),
function(t,p,g,k,b,a,f,m,n,h){function r(a,b){for(var e=a.length-1;b<e;)a[b]=a[++b];a.length=e}var v=t.shape={};v.Shape=g("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(b("gfxRegistry")){var a=v.register(this);this.getUID=function(){return a}}},destroy:function(){b("gfxRegistry")&&v.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=
null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var a=this.getBoundingBox();if(!a)return null;var b=this._getRealMatrix();return[h.multiplyPoint(b,a.x,a.y),h.multiplyPoint(b,a.x+a.width,a.y),h.multiplyPoint(b,a.x+
a.width,a.y+a.height),h.multiplyPoint(b,a.x,a.y+a.height)]},getEventSource:function(){return this.rawNode},setClip:function(a){this.clip=a},getClip:function(){return this.clip},setShape:function(a){this.shape=t.makeParameters(this.shape,a);this.bbox=null;return this},setFill:function(a){if(!a)return this.fillStyle=null,this;var b=null;if("object"==typeof a&&"type"in a)switch(a.type){case "linear":b=t.makeParameters(t.defaultLinearGradient,a);break;case "radial":b=t.makeParameters(t.defaultRadialGradient,
a);break;case "pattern":b=t.makeParameters(t.defaultPattern,a)}else b=t.normalizeColor(a);this.fillStyle=b;return this},setStroke:function(a){if(!a)return this.strokeStyle=null,this;if("string"==typeof a||p.isArray(a)||a instanceof n)a={color:a};a=this.strokeStyle=t.makeParameters(t.defaultStroke,a);a.color=t.normalizeColor(a.color);return this},setTransform:function(a){this.matrix=h.clone(a?h.normalize(a):h.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var a=
this.getParent();a&&(a._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var a=this.getParent();a&&(a._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(a){return a?this.setTransform([this.matrix,a]):this},applyLeftTransform:function(a){return a?this.setTransform([a,this.matrix]):this},applyTransform:function(a){return a?this.setTransform([this.matrix,a]):this},removeShape:function(a){this.parent&&
this.parent.remove(this,a);return this},_setParent:function(a,b){this.parent=a;return this._updateParentMatrix(b)},_updateParentMatrix:function(a){this.parentMatrix=a?h.clone(a):null;return this._applyTransform()},_getRealMatrix:function(){for(var a=this.matrix,b=this.parent;b;)b.matrix&&(a=h.multiply(b.matrix,a)),b=b.parent;return a}});v._eventsProcessing={on:function(b,f){return a(this.getEventSource(),b,v.fixCallback(this,t.fixTarget,f))},connect:function(a,b,f){"on"==a.substring(0,2)&&(a=a.substring(2));
return this.on(a,f?p.hitch(b,f):b)},disconnect:function(a){return a.remove()}};v.fixCallback=function(a,b,f,c){c||(c=f,f=null);if(p.isString(c)){f=f||k.global;if(!f[c])throw['dojox.gfx.shape.fixCallback: scope["',c,'"] is null (scope\x3d"',f,'")'].join("");return function(e){return b(e,a)?f[c].apply(f,arguments||[]):void 0}}return f?function(e){return b(e,a)?c.apply(f,arguments||[]):void 0}:function(e){return b(e,a)?c.apply(f,arguments):void 0}};p.extend(v.Shape,v._eventsProcessing);v.Container={_init:function(){this.children=
[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(a){var b=a.getParent();b&&b.remove(a,!0);this.children.push(a);return a._setParent(this,this._getRealMatrix())},remove:function(a,b){for(var e=0;e<this.children.length;++e)if(this.children[e]==a){b||(a.parent=null,a.parentMatrix=null);r(this.children,e);break}return this},clear:function(a){for(var b,e=0;e<this.children.length;++e)b=this.children[e],b.parent=null,b.parentMatrix=null,a&&b.destroy();this.children=
[];return this},getBoundingBox:function(){if(this.children){var a=null;f.forEach(this.children,function(b){var e=b.getBoundingBox();e&&((b=b.getTransform())&&(e=h.multiplyRectangle(b,e)),a?(a.x=Math.min(a.x,e.x),a.y=Math.min(a.y,e.y),a.endX=Math.max(a.endX,e.x+e.width),a.endY=Math.max(a.endY,e.y+e.height)):a={x:e.x,y:e.y,endX:e.x+e.width,endY:e.y+e.height})});a&&(a.width=a.endX-a.x,a.height=a.endY-a.y);return a}return null},_moveChildToFront:function(a){for(var b=0;b<this.children.length;++b)if(this.children[b]==
a){r(this.children,b);this.children.push(a);break}return this},_moveChildToBack:function(a){for(var b=0;b<this.children.length;++b)if(this.children[b]==a){r(this.children,b);this.children.unshift(a);break}return this}};v.Surface=g("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){f.forEach(this._nodes,m.destroy);this._nodes=[];f.forEach(this._events,function(a){a&&a.remove()});this._events=[];this.rawNode=null;
if(b("ie"))for(;this._parent.lastChild;)m.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(a){},whenLoaded:function(b,f){var e=p.hitch(b,f);if(this.isLoaded)e(this);else a.once(this,"load",function(a){e(a)})}});p.extend(v.Surface,v._eventsProcessing);v.Rect=g("dojox.gfx.shape.Rect",v.Shape,{constructor:function(a){this.shape=t.getDefault("Rect");this.rawNode=
a},getBoundingBox:function(){return this.shape}});v.Ellipse=g("dojox.gfx.shape.Ellipse",v.Shape,{constructor:function(a){this.shape=t.getDefault("Ellipse");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-a.rx,y:a.cy-a.ry,width:2*a.rx,height:2*a.ry}}return this.bbox}});v.Circle=g("dojox.gfx.shape.Circle",v.Shape,{constructor:function(a){this.shape=t.getDefault("Circle");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-
a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r}}return this.bbox}});v.Line=g("dojox.gfx.shape.Line",v.Shape,{constructor:function(a){this.shape=t.getDefault("Line");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:Math.min(a.x1,a.x2),y:Math.min(a.y1,a.y2),width:Math.abs(a.x2-a.x1),height:Math.abs(a.y2-a.y1)}}return this.bbox}});v.Polyline=g("dojox.gfx.shape.Polyline",v.Shape,{constructor:function(a){this.shape=t.getDefault("Polyline");this.rawNode=a},setShape:function(a,
b){a&&a instanceof Array?(this.inherited(arguments,[{points:a}]),b&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[a]);return this},_normalizePoints:function(){var a=this.shape.points,b=a&&a.length;if(b&&"number"==typeof a[0]){for(var f=[],c=0;c<b;c+=2)f.push({x:a[c],y:a[c+1]});this.shape.points=f}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var a=this.shape.points,b=a.length,f=a[0],c=f.x,h=f.y,g=f.x,k=f.y,m=1;m<b;++m)f=
a[m],c>f.x&&(c=f.x),g<f.x&&(g=f.x),h>f.y&&(h=f.y),k<f.y&&(k=f.y);this.bbox={x:c,y:h,width:g-c,height:k-h}}return this.bbox}});v.Image=g("dojox.gfx.shape.Image",v.Shape,{constructor:function(a){this.shape=t.getDefault("Image");this.rawNode=a},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});v.Text=g(v.Shape,{constructor:function(a){this.fontStyle=null;this.shape=t.getDefault("Text");this.rawNode=a},getFont:function(){return this.fontStyle},
setFont:function(a){this.fontStyle="string"==typeof a?t.splitFontString(a):t.makeParameters(t.defaultFont,a);this._setFont();return this},getBoundingBox:function(){var a=null;this.getShape().text&&(a=t._base._computeTextBoundingBox(this));return a}});v.Creator={createShape:function(a){switch(a.type){case t.defaultPath.type:return this.createPath(a);case t.defaultRect.type:return this.createRect(a);case t.defaultCircle.type:return this.createCircle(a);case t.defaultEllipse.type:return this.createEllipse(a);
case t.defaultLine.type:return this.createLine(a);case t.defaultPolyline.type:return this.createPolyline(a);case t.defaultImage.type:return this.createImage(a);case t.defaultText.type:return this.createText(a);case t.defaultTextPath.type:return this.createTextPath(a)}return null},createGroup:function(){return this.createObject(t.Group)},createRect:function(a){return this.createObject(t.Rect,a)},createEllipse:function(a){return this.createObject(t.Ellipse,a)},createCircle:function(a){return this.createObject(t.Circle,
a)},createLine:function(a){return this.createObject(t.Line,a)},createPolyline:function(a){return this.createObject(t.Polyline,a)},createImage:function(a){return this.createObject(t.Image,a)},createText:function(a){return this.createObject(t.Text,a)},createPath:function(a){return this.createObject(t.Path,a)},createTextPath:function(a){return this.createObject(t.TextPath,{}).setText(a)},createObject:function(a,b){return null}};return v})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang",
"dojo/_base/declare","./matrix","./shape"],function(t,p,g,k,b){b=g("dojox.gfx.path.Path",b.Shape,{constructor:function(a){this.shape=p.clone(t.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=a;this.segmented=!1},setAbsoluteMode:function(a){this._confirmSegmented();this.absolute="string"==typeof a?"absolute"==a:a;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&
"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var a=this.bbox,b=this._getRealMatrix();this.bbox=null;for(var g=0,k=this.segments.length;g<k;++g)this._updateWithSegment(this.segments[g],b);b=this.bbox;this.bbox=a;return this.tbbox=b?[{x:b.l,y:b.t},{x:b.r,y:b.t},{x:b.r,y:b.b},{x:b.l,y:b.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in
this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(a,b,g){g&&(b=k.multiplyPoint(g,a,b),a=b.x,b=b.y);this.bbox&&"l"in this.bbox?(this.bbox.l>a&&(this.bbox.l=a),this.bbox.r<a&&(this.bbox.r=a),this.bbox.t>b&&(this.bbox.t=b),this.bbox.b<b&&(this.bbox.b=b)):this.bbox={l:a,b:b,r:a,t:b}},_updateWithSegment:function(a,b){var f=a.args,g=f.length,h;switch(a.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(h=0;h<g;h+=2)this._updateBBox(f[h],
f[h+1],b);this.last.x=f[g-2];this.last.y=f[g-1];this.absolute=!0;break;case "H":for(h=0;h<g;++h)this._updateBBox(f[h],this.last.y,b);this.last.x=f[g-1];this.absolute=!0;break;case "V":for(h=0;h<g;++h)this._updateBBox(this.last.x,f[h],b);this.last.y=f[g-1];this.absolute=!0;break;case "m":h=0;"x"in this.last||(this._updateBBox(this.last.x=f[0],this.last.y=f[1],b),h=2);for(;h<g;h+=2)this._updateBBox(this.last.x+=f[h],this.last.y+=f[h+1],b);this.absolute=!1;break;case "l":case "t":for(h=0;h<g;h+=2)this._updateBBox(this.last.x+=
f[h],this.last.y+=f[h+1],b);this.absolute=!1;break;case "h":for(h=0;h<g;++h)this._updateBBox(this.last.x+=f[h],this.last.y,b);this.absolute=!1;break;case "v":for(h=0;h<g;++h)this._updateBBox(this.last.x,this.last.y+=f[h],b);this.absolute=!1;break;case "c":for(h=0;h<g;h+=6)this._updateBBox(this.last.x+f[h],this.last.y+f[h+1],b),this._updateBBox(this.last.x+f[h+2],this.last.y+f[h+3],b),this._updateBBox(this.last.x+=f[h+4],this.last.y+=f[h+5],b);this.absolute=!1;break;case "s":case "q":for(h=0;h<g;h+=
4)this._updateBBox(this.last.x+f[h],this.last.y+f[h+1],b),this._updateBBox(this.last.x+=f[h+2],this.last.y+=f[h+3],b);this.absolute=!1;break;case "A":for(h=0;h<g;h+=7)this._updateBBox(f[h+5],f[h+6],b);this.last.x=f[g-2];this.last.y=f[g-1];this.absolute=!0;break;case "a":for(h=0;h<g;h+=7)this._updateBBox(this.last.x+=f[h+5],this.last.y+=f[h+6],b);this.absolute=!1}a=[a.action];for(h=0;h<g;++h)a.push(t.formatNumber(f[h],!0));if("string"==typeof this.shape.path)this.shape.path+=a.join("");else for(h=
0,g=a.length;h<g;++h)this.shape.path.push(a[h])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(a,b){this.tbbox=null;var f=this._validSegments[a.toLowerCase()];"number"==typeof f&&(f?b.length>=f&&(a={action:a,args:b.slice(0,b.length-b.length%f)},this.segments.push(a),this._updateWithSegment(a)):(a={action:a,args:[]},this.segments.push(a),this._updateWithSegment(a)))},_collectArgs:function(a,b){for(var f=0;f<b.length;++f){var g=b[f];"boolean"==typeof g?a.push(g?1:0):
"number"==typeof g?a.push(g):g instanceof Array?this._collectArgs(a,g):"x"in g&&"y"in g&&a.push(g.x,g.y)}},moveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"M":"m",a);return this},lineTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"L":"l",a);return this},hLineTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?
"H":"h",a);return this},vLineTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"V":"v",a);return this},curveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"C":"c",a);return this},smoothCurveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"S":"s",a);return this},qCurveTo:function(){this._confirmSegmented();var a=
[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"Q":"q",a);return this},qSmoothCurveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"T":"t",a);return this},arcTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"A":"a",a);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var a=
this.shape.path;this.shape.path=[];this._setPath(a);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(a){a=p.isArray(a)?a:a.match(t.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(a){for(var b="",g=[],k=a.length,h=0;h<k;++h){var r=a[h],v=parseFloat(r);isNaN(v)?(b&&this._pushSegment(b,g),g=[],b=r):g.push(v)}this._pushSegment(b,g)}},setShape:function(a){this.inherited(arguments,["string"==typeof a?{path:a}:a]);this.segmented=!1;this.segments=
[];t.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});g=g("dojox.gfx.path.TextPath",b,{constructor:function(a){"text"in this||(this.text=p.clone(t.defaultTextPath));"fontStyle"in this||(this.fontStyle=p.clone(t.defaultFont))},getText:function(){return this.text},setText:function(a){this.text=t.makeParameters(this.text,"string"==typeof a?{text:a}:a);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(a){this.fontStyle="string"==typeof a?
t.splitFontString(a):t.makeParameters(t.defaultFont,a);this._setFont();return this}});return t.path={Path:b,TextPath:g}})},"*now":function(t){t(['dojo/i18n!*preload*esri/widgets/nls/Legend*["ar","bs","ca","cs","da","de","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Legend/nls/Legend ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/decorators/cast ./Widget ./Legend/LegendViewModel ./Legend/styles/Card ./Legend/styles/Classic ./support/widget".split(" "),function(t,p,g,k,b,a,f,m,n,h,r,v,e,q,u){return function(c){function l(b){b=c.call(this)||this;b._handles=new f;b.activeLayerInfos=
null;b.basemapLegendVisible=!1;b.groundLegendVisible=!1;b.iconClass="esri-icon-layer-list";b.label=a.widgetLabel;b.layerInfos=null;b.style=new q;b.view=null;b.viewModel=new v;return b}k(l,c);l.prototype.postInitialize=function(){var a=this;this.own(m.on(this,"activeLayerInfos","change",function(){return a._refreshActiveLayerInfos(a.activeLayerInfos)}),m.init(this,"style",function(b,c){c&&b!==c&&c.destroy();b&&(b.activeLayerInfos=a.activeLayerInfos,"card"===b.type&&(b.view=a.view))}))};l.prototype.destroy=
function(){this._handles.destroy();this._handles=null};l.prototype.castStyle=function(a){if(a instanceof e||a instanceof q)return a;if("string"===typeof a)return"card"===a?new e:new q;if(a&&"string"===typeof a.type){var b=g({},a);delete b.type;return new ("card"===a.type?e:q)(b)}return new q};l.prototype.render=function(){return this.style.render()};l.prototype._refreshActiveLayerInfos=function(a){var b=this;this._handles.removeAll();a.forEach(function(a){return b._renderOnActiveLayerInfoChange(a)});
this.scheduleRender()};l.prototype._renderOnActiveLayerInfoChange=function(a){var b=this,c=m.init(a,"version",function(){return b.scheduleRender()});this._handles.add(c,"version_"+a.layer.uid);a.children.forEach(function(a){return b._renderOnActiveLayerInfoChange(a)})};b([n.aliasOf("viewModel.activeLayerInfos"),u.renderable()],l.prototype,"activeLayerInfos",void 0);b([n.aliasOf("viewModel.basemapLegendVisible"),u.renderable()],l.prototype,"basemapLegendVisible",void 0);b([n.aliasOf("viewModel.groundLegendVisible"),
u.renderable()],l.prototype,"groundLegendVisible",void 0);b([n.property()],l.prototype,"iconClass",void 0);b([n.property()],l.prototype,"label",void 0);b([n.aliasOf("viewModel.layerInfos"),u.renderable()],l.prototype,"layerInfos",void 0);b([n.property(),u.renderable()],l.prototype,"style",void 0);b([h.cast("style")],l.prototype,"castStyle",null);b([n.aliasOf("viewModel.view"),u.renderable()],l.prototype,"view",void 0);b([n.property(),u.renderable(["view.size"])],l.prototype,"viewModel",void 0);return l=
b([n.subclass("esri.widgets.Legend")],l)}(n.declared(r))});