// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../symbols ../../../core/promiseUtils ../../../intl/date ../../../renderers/support/numberUtils ../../../symbols/support/utils ./utils @dojo/framework/shim/Promise".split(" "),function(J,t,u,G,N,Q,R,v,K,S){function T(a,b){var c=null,d=null;if("simple"===a.type)c=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)c=(c=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&c.symbol,
d=1<a.length;if(!c||U(c))return null;c=c.clone();if(b||d)-1<c.type.indexOf("3d")?V(c):(b=c,-1!==b.type.indexOf("line")?b.color=C:(b.color=O,"simple-marker"===b.type&&(b.outline={color:C,width:1.5})));return c}function U(a){if(a)return N.isSymbol3D(a)?a.symbolLayers?a.symbolLayers.some(function(a){return a&&"fill"===a.type}):!1:-1!==a.type.indexOf("fill")}function V(a){K.isVolumetricSymbol(a)||("line-3d"===a.type?a.symbolLayers.forEach(function(a){a.material={color:C}}):a.symbolLayers.forEach(function(a){"icon"!==
a.type||a.resource&&a.resource.href?a.material={color:W}:(a.material={color:O},a.outline={color:C,size:1.5})}))}function X(a,b,c,d,w){return u(this,void 0,void 0,function(){var k,h,e,f,l;return G(this,function(m){switch(m.label){case 0:return[4,new Promise(function(a,b){J(["../../../renderers/visualVariables/support/visualVariableUtils"],a,b)})];case 1:h=(k=m.sent().getSizeRangeAtScale(b,d,w))&&Y(k);if(!k&&!h)return[2];e=h.map(function(a){var c=k.minSize,d=k.maxSize,f=b.minDataValue,e=b.maxDataValue;
return a<=c?f:a>=d?e:(a-c)/(d-c)*(e-f)+f});e=v.round(e);f=1;m.label=2;case 2:return f<e.length-1?[4,Z(a,b,c,e[f],e[f-1],d,w)]:[3,5];case 3:if(l=m.sent())e[f]=l[0],h[f]=l[1];m.label=4;case 4:return f++,[3,2];case 5:return[2,e]}})})}function Y(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var c=[],d=0;5>d;d++)c.push(b+a*d);return c}function Z(a,b,c,d,w,k,h){return u(this,void 0,void 0,function(){var e,f,l,m,t,x,D,p,r,g,y,n,z,B,E,u,A,L,M,P,H,I;return G(this,function(q){switch(q.label){case 0:return[4,F(a,
b,c,d,k,h)];case 1:return f=q.sent(),[4,F(a,b,c,w,k,h)];case 2:l=q.sent(),m=v.numDigits(d),t=m.fractional,x=20,D=m.integer,r=p=null,0<d&&1>d&&(p=Math.pow(10,t),d*=p,D=v.numDigits(d).integer),g=D-1,q.label=3;case 3:if(!(0<=g))return[3,8];y=Math.pow(10,g);n=Math.floor(d/y)*y;z=Math.ceil(d/y)*y;null!=p&&(n/=p,z/=p);B=(n+z)/2;e=v.round([n,B,z],{indexes:[1]});B=e[1];return[4,F(a,b,c,n,k,h)];case 4:return E=q.sent(),[4,F(a,b,c,z,k,h)];case 5:return u=q.sent(),[4,F(a,b,c,B,k,h)];case 6:A=q.sent();L=v.percentChange(f,
E,l,null);M=v.percentChange(f,u,l,null);P=v.percentChange(f,A,l,null);H=L.previous<=x;I=M.previous<=x;H&&I&&(L.previous<=M.previous?(H=!0,I=!1):(I=!0,H=!1));H?r=[n,E]:I?r=[z,u]:P.previous<=x&&(r=[B,A]);if(r)return[3,8];q.label=7;case 7:return g--,[3,3];case 8:return[2,r]}})})}function F(a,b,c,d,w,k){return u(this,void 0,void 0,function(){var a;return G(this,function(e){switch(e.label){case 0:return[4,new Promise(function(a,b){J(["../../../renderers/visualVariables/support/visualVariableUtils"],a,
b)})];case 1:return a=e.sent().getSize,[2,a(b,d,{scale:w,view:k,shape:-1!==c.type.indexOf("marker-symbol")?c.style:null})]}})})}function aa(a,b){a=a.clone();if(N.isSymbol3D(a))K.isVolumetricSymbol(a)||a.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=b)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=b;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){var c=a.width,d=a.height;a.height=b;a.width=c/d*b}else"esri.symbols.SimpleLineSymbol"===a.declaredClass?
a.width=b:"esri.symbols.TextSymbol"===a.declaredClass&&a.font&&(a.font.size=b);return a}Object.defineProperty(t,"__esModule",{value:!0});t.REAL_WORLD_MAX_SIZE=30;t.REAL_WORLD_MIN_SIZE=12;var O=[255,255,255],W=[200,200,200],C=[128,128,128];t.getRampStops=function(a,b,c,d,w,k){return u(this,void 0,void 0,function(){var h,e,f,l,m,C,x,D,p,r,g,y,n,z,B,E,J=this;return G(this,function(A){switch(A.label){case 0:e=(h=b.legendOptions)&&h.customValues;f=T(a,c);l=!!f;m=!!e;C=null!=b.minSize&&null!=b.maxSize;
x=b.stops&&1<b.stops.length;D=!!b.target;if(!l||!(m||C||x&&!D))return[2];p=K.isVolumetricSymbol(f);y=g=r=null;if(!p||x)return[3,1];g=v.round([b.minDataValue,b.maxDataValue]);return[3,4];case 1:return(n=e)?[3,3]:[4,X(a,b,f,d,w)];case 2:n=A.sent(),A.label=3;case 3:g=n,A.label=4;case 4:!g&&x&&(g=b.stops.map(function(a){return a.value}),(r=b.stops.some(function(a){return!!a.label}))&&(y=b.stops.map(function(a){return a.label})));p&&g&&2<g.length&&(g=[g[0],g[g.length-1]]);if(!g)return[2,null];z=[t.REAL_WORLD_MIN_SIZE,
t.REAL_WORLD_MAX_SIZE];B=K.getSymbolOutlineSize(f);return[4,Q.all(g.map(function(c,e){return u(J,void 0,void 0,function(){var h,m,l,q;return G(this,function(n){switch(n.label){case 0:if(!p)return[3,1];l=z[e];return[3,3];case 1:return[4,F(a,b,f,c,d,w)];case 2:l=n.sent(),n.label=3;case 3:return h=l,m=aa(f,h),q=r?y[e]:S.getLabelPrefix(e,g.length-1)+(k?R.formatDate(c):v.format(c)),[2,{value:c,symbol:m,label:q,size:h,outlineSize:B}]}})})}))];case 5:return E=A.sent(),[2,E.reverse()]}})})}});