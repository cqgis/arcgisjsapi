// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Graphic ../../core/Accessor ../../core/Error ../../core/Evented ../../core/geolocationUtils ../../core/promiseUtils ../../core/accessorSupport/decorators ../../symbols/PictureMarkerSymbol ./GoTo".split(" "),function(l,v,m,e,n,p,q,r,h,k,d,t,u){return function(g){function b(){var a=null!==g&&g.apply(this,arguments)||this;a._geolocationUsable=!0;a._iconPath=l.toUrl("../../images/support/sdk_gps_location.png");
a.geolocationOptions=null;a.goToLocationEnabled=!0;a.graphic=new n({symbol:new t({url:a._iconPath,width:21,height:21})});a.scale=null;a.useHeadingEnabled=!0;a.view=null;return a}m(b,g);b.prototype.initialize=function(){h.supported()||(this._geolocationUsable=!1)};b.prototype.destroy=function(){this._clear();this.view=null};b.prototype._clear=function(){this.view&&this.view.graphics.remove(this.graphic)};b.prototype._getScaleWithinConstraints=function(a,c){return c?"2d"===c.type?(c=c.constraints,Math.min(c.effectiveMinScale,
Math.max(c.effectiveMaxScale,a))):a:a};b.prototype._getScale=function(a){var c=this.scale;return this._getScaleWithinConstraints("number"===typeof c?c:2500,a)};b.prototype._getHeading=function(a,c){c=c.spatialReference;a=a.coords&&a.coords.heading;if(!(!c||!c.isWebMercator&&!c.isGeographic||"number"!==typeof a||isNaN(a)||0>a||360<a))return a};b.prototype._addHeading=function(a){var c=a.heading,b=a.target;(a=a.view)&&"number"===typeof c&&!isNaN(c)&&("3d"===a.type?b.heading=c:"2d"===a.type&&(b.rotation=
360-c))};b.prototype._animatePoint=function(a,c,b,d){if(!this.goToLocationEnabled)return k.resolve(c);var e=this.view,f=this.useHeadingEnabled?this._getHeading(c,e):void 0;a={target:a,scale:b};this._addHeading({heading:f,target:a,view:e});return this.callGoTo({target:a,options:d}).then(function(){return c})};b.prototype._setPosition=function(a,c){var b=this;return h.positionToPoint({position:a,view:this.view},c).then(function(e){var d=b.graphic,f=a.coords,f={timestamp:a.timestamp,accuracy:f.accuracy,
altitude:f.altitude,altitudeAccuracy:f.altitudeAccuracy,heading:f.heading,latitude:f.latitude,longitude:f.longitude,speed:f.speed};d&&(d.geometry=e,d.attributes=f);d=b._getScale(b.view);return b._animatePoint(e,a,d,c)}).catch(function(){return k.reject(new q("positioning:invalid-point","Cannot position invalid point"))})};e([d.property()],b.prototype,"_geolocationUsable",void 0);e([d.property()],b.prototype,"geolocationOptions",void 0);e([d.property()],b.prototype,"goToLocationEnabled",void 0);e([d.property()],
b.prototype,"graphic",void 0);e([d.property()],b.prototype,"scale",void 0);e([d.property()],b.prototype,"useHeadingEnabled",void 0);e([d.property()],b.prototype,"view",void 0);return b=e([d.subclass("esri.widgets.support.GeolocationPositioning")],b)}(d.declared(p,r,u))});