// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../views/3d/terrain/terrainUtils ../../../views/3d/terrain/TilingScheme ../../../views/support/spatialReferenceSupport".split(" "),function(q,g,k,e,f,h,l,m){function n(d,a){var b=d.basemap,f=d.view;return b.load(a).then(function(){if(0!==b.baseLayers.length){var c=b.baseLayers.concat(b.referenceLayers),c=p(c);if(c.length)throw c[0];return k.typeCast(b.baseLayers.getItemAt(0))().load(a).then(function(a){var b=
a.tileInfo;if(b){var c=f.get("viewingMode");if(c){if(!m.isSpatialReferenceSupported(b.spatialReference,c))throw new e("basemapgalleryitem:spatial-reference-unsupported-"+c,"Basemap spatial reference is unsupported in "+c+" mode");if("global"===c){var d=h.checkIfTileInfoSupportedForView(b,a.fullExtent,null,c);d&&a.compatibleTileInfo256&&!h.checkIfTileInfoSupportedForView(a.compatibleTileInfo256,a.fullExtent,null,c)&&(d=null);if(d)throw new e("basemapgalleryitem:tiling-scheme-unsupported-"+(b.spatialReference.isWebMercator?
"web-mercator":"wgs84")+"-global","Basemap tiling scheme is unsupported in global mode",{error:d});}else if(l.checkUnsupported(b))throw new e("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");c=f.get("basemapTerrain.tilingScheme");if(!(!c||c.compatibleWith(b)||a.compatibleTileInfo256&&c.compatibleWith(a.compatibleTileInfo256)))throw new e("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");
}}})}}).catch(function(a){var b=a.name,c=a.message;throw new e(void 0===b?"basemap-compatibility:unknown-error":b,void 0===c?"Unknown basemap compatibility error":c,a.details);})}function p(d){var a=["ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return d.toArray().filter(function(b){return-1===a.indexOf(b.operationalLayerType)}).map(function(a){return new e("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",
{layer:a,operationalLayerType:a.operationalLayerType||"unknown"})})}Object.defineProperty(g,"__esModule",{value:!0});g.default3DCompatibility=function(d,a){void 0===a&&(a={});return n(d,a).then(function(){return f.throwIfAborted(a)})};g.default2DCompatibility=function(d,a){void 0===a&&(a={});var b=d.basemap,g=d.view;return b.load(a).then(function(){f.throwIfAborted(a);if(0!==b.baseLayers.length){var c=b.baseLayers.getItemAt(0);return c.load(a).then(function(){f.throwIfAborted(a);var b=(c.get("supportedSpatialReferences")||
[c.get("tileInfo.spatialReference")]).filter(Boolean);if(0!==b.length&&b.every(function(a){return!g.spatialReference.equals(a)}))return f.reject(new e("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view"))})}})}});