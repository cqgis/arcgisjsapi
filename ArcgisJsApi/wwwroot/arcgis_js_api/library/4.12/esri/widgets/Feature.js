// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Graphic ../../intl ../../core/asyncUtils ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/throttle ../../core/watchUtils ../../core/accessorSupport/decorators ../../intl/date ../../intl/number ../../layers/support/fieldUtils ../../popup/content/TextContent ../../popup/content/support/ChartMediaInfoValueSeries ../../popup/support/FieldInfoFormat ../../tasks/support/AttachmentQuery ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(C,m,h,e,A,r,w,D,p,t,G,v,E,x,F,k,z,q,f,c,a,b,d,n,y,B,K){function O(){return w(this,void 0,void 0,function(){return r(this,function(a){return[2,x.create(function(a){C(["../../support/arcadeUtils"],function(g){a(g)})})]})})}function H(a,b){return a&&"function"===typeof a.getField?a.getField(b):null}function I(a){return a.replace(/[\u00A0-\u9999<>\&]/gim,function(a){return"\x26#"+a.charCodeAt(0)+";"})}var P=["$datastore","$map","$layer"],J=E.getLogger("esri.widgets.FeatureViewModel"),L=/^\s*expression\//i,
M=q.convertDateFormatToIntlOptions("short-date-short-time");return function(B){function l(a){var g=B.call(this)||this;g._handles=new G;g._featureAbortController=null;g._graphicChangedThrottled=F.throttle(g._graphicChanged,1,g);g._effectivePopupTemplate=null;g._contentResponse=null;g._graphic=null;g.content=null;g.defaultPopupTemplateEnabled=!1;g.formattedAttributes=null;g.graphic=null;g.lastEditInfo=null;g.title="";g.view=null;g._handles.add(k.init(g,"graphic graphic.sourceLayer.popupTemplate.title graphic.sourceLayer.popupTemplate.content graphic.sourceLayer.popupTemplate.fieldInfos graphic.sourceLayer.popupTemplate.lastEditInfoEnabled graphic.popupTemplate.title graphic.popupTemplate.content graphic.popupTemplate.fieldInfos graphic.popupTemplate.lastEditInfoEnabled".split(" "),
function(){return g._graphicChangedThrottled()}));return g}h(l,B);l.prototype.destroy=function(){this._clear();this._cancelFeatureQuery();this._handles.destroy();this._graphic=this.graphic=this._handles=null};Object.defineProperty(l.prototype,"spatialReference",{get:function(){return this.get("view.spatialReference")||null},set:function(a){void 0===a?this._clearOverride("spatialReference"):this._override("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"map",
{get:function(){return this.get("view.map")||null},set:function(a){void 0===a?this._clearOverride("map"):this._override("map",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"waitingForContent",{get:function(){return!!this._featureAbortController},enumerable:!0,configurable:!0});l.prototype._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};l.prototype._graphicChanged=function(){return w(this,void 0,void 0,function(){var a,
b,N,d;return r(this,function(g){switch(g.label){case 0:this._cancelFeatureQuery();this._clear();this._graphic=b=(a=this.graphic)?a.clone():null;if(!b)return[2];this._featureAbortController=N=x.createAbortController();g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._queryFeature({signal:N.signal})];case 2:return g.sent(),[3,4];case 3:return d=g.sent(),J.error("error","error loading template",d),[3,4];case 4:return this._featureAbortController=null,[2]}})})};l.prototype._cancelFeatureQuery=function(){var a=
this._featureAbortController;a&&a.abort();this._featureAbortController=null};l.prototype._compileContent=function(g,b){var u=this;if(g&&(g.nodeName||g&&K.isWidgetBase(g)||K.isWidget(g)))return g;if("string"===typeof g)return this._compileText(new a({text:g})).text;if(Array.isArray(g))return g.map(function(a,g){g=(g=b&&b[g])&&g.value;if("attachments"===a.type)return u._compileAttachments(a,g);if("fields"===a.type)return u._compileFields(a);if("media"===a.type)return u._compileMedia(a);if("text"===
a.type)return u._compileText(a)});g&&J.warn("invalid content type.")};l.prototype._compileFields=function(a){var g=this,b=this._effectivePopupTemplate;a=v.clone(a);var d=b&&b.expressionInfos,b=a.fieldInfos?void 0:b&&b.fieldInfos,b=a.fieldInfos||v.clone(b),c=[];b&&b.forEach(function(a){var b=a.fieldName.toLowerCase();if(!a.hasOwnProperty("visible")||a.visible)b=g._isExpressionField(b)?g._getExpressionInfo(d,b):null,a.label=b?b.title:a.label,c.push(a)});a.fieldInfos=c;return a};l.prototype._setImageValue=
function(a){var g=a.value,b=a.formattedAttributes;a=a.layer;var d=g.linkURL,c=g.sourceURL;c&&(c=this._fixTokens(c,a),g.sourceURL=this._substituteAttributes(b,c));d&&(a=this._fixTokens(d,a),g.linkURL=this._substituteAttributes(b,a))};l.prototype._compileMedia=function(a){var g=this,b=this._graphic;a=v.clone(a);var d=a.mediaInfos,c=b.attributes,f=y.getSourceLayer(b),n=this.formattedAttributes.global;a.mediaInfos=d&&d.map(function(a){if(a=v.clone(a)){var b=a.title?g._processFieldsInLinks(a.title,c):
"",u=a.caption?g._processFieldsInLinks(a.caption,c):"";a.title=b?g._substituteAttributes(n,b):"";a.caption=u?g._substituteAttributes(n,u):"";if("image"===a.type)return b=a.value,g._setImageValue({value:b,formattedAttributes:n,layer:f}),a.value.sourceURL?a:void 0;if("pie-chart"===a.type||"line-chart"===a.type||"column-chart"===a.type||"bar-chart"===a.type)return b=a.value,g._setChartValue({value:b,attributes:c,formattedAttributes:n,layer:f}),a}}).filter(Boolean);return a};l.prototype._substituteAttributes=
function(a,b){return(""+this._removeEmptyHref(p.substitute(b,a))).trim()};l.prototype._compileText=function(a){if((a=v.clone(a))&&a.text){var g=this.formattedAttributes.global,b=this._processFieldsInLinks(a.text,this._graphic.attributes);a.text=this._substituteAttributes(g,b)}return a};l.prototype._formatEditInfo=function(a,b){var g=a.creatorField,u=a.creationDateField,d=a.editorField;if(b){a=b[a.editDateField];if("number"===typeof a)return b=b[d],g=p.formatDate(a,M),{type:"edit",date:g,user:b};u=
b[u];if("number"===typeof u)return b=b[g],g=p.formatDate(u,M),{type:"create",date:g,user:b}}};l.prototype._compileLastEditInfo=function(){var a=this._effectivePopupTemplate,b=this._graphic;if(a){var a=a.lastEditInfoEnabled,d=b.get("sourceLayer.editFieldsInfo");if(a&&d)return this._formatEditInfo(d,b.attributes)}};l.prototype._compileTitle=function(){var a=this._effectivePopupTemplate,b=this._graphic,d=a&&a.title,c=b.attributes,a=this.formattedAttributes.global;return"function"===typeof d?d.call(null,
{graphic:b}):"string"===typeof d&&d?(b=this._processFieldsInLinks(d,c),this._substituteAttributes(a,b)):""};l.prototype._getExpressionInfo=function(a,b){if(this._isExpressionField(b)){var g=b.replace(L,"").toLowerCase(),d;a.some(function(a){if(a.name.toLowerCase()===g)return d=a,!0});return d}};l.prototype._fixTokens=function(a,b){return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,g,d){return(a=H(b,d))?"{"+a.name+"}":g})};l.prototype._encodeAttributes=function(a){var b=a?v.clone(a):{};Object.keys(b).forEach(function(a){var g=
b[a];"string"===typeof g&&(g=encodeURIComponent(g).replace(/\'/g,"\x26apos;"),b[a]=g)});return b};l.prototype._formatAttributesToFieldInfos=function(a,b,d){var g=this;a.forEach(function(c){var u=g._getFixedFieldName(c.fieldName,b);c.fieldName=u;d[u]=g._formatValue(d[u],{fieldInfos:a,fieldName:u,layer:b})})};l.prototype._formatAttributes=function(a){var b=this,g=this._graphic,d=y.getSourceLayer(g),c=v.clone(g.attributes);this.addRelatedFeatureAttributes(c);Object.keys(c).forEach(function(a){var g=
c[a];if(null!=g){var d;(d=b._getDomainName(a,g)||b._getTypeName(a))||(d=/(\n)/gi,d="string"===typeof g?g.replace(d,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):g);c[a]=d}});a&&this._formatAttributesToFieldInfos(a,d,c);return c};l.prototype._formatValue=function(a,b){var g=b.fieldName,c=this._getFieldInfo(b.fieldInfos,g),u=v.clone(c),c=b.preventPlacesFormatting;(b=H(b.layer,g))&&"date"===b.type&&(b=u.format||new d,b.dateFormat=b.dateFormat||"short-date-short-time",u.format=b);u=u&&u.format;return"string"===
typeof a||null==a||null==u?a:c?f.formatNumber(a,A({},f.convertNumberFormatToIntlOptions(u),{minimumFractionDigits:0,maximumFractionDigits:20})):u.format(a)};l.prototype._getDomainName=function(a,b){if(this.isRelatedField(a))return null;var g=this._graphic,d=y.getSourceLayer(g);return d&&"function"===typeof d.getFieldDomain?(a=d.getFieldDomain(a,{feature:g}))&&"coded-value"===a.type?a.getName(b):null:null};l.prototype._getFieldInfo=function(a,b){if(a&&a.length&&b){var g=b.toLowerCase(),d=void 0;a.some(function(a){if(a.fieldName&&
a.fieldName.toLowerCase()===g)return d=a,!0});return d}};l.prototype._getTypeName=function(a){if(this.isRelatedField(a))return null;var b=this._graphic,g=y.getSourceLayer(b);if(!g||"function"!==typeof g.getFeatureType)return null;var d=g.typeIdField;return d&&a===d?(a=g.getFeatureType(b))?a.name:null:null};l.prototype._removeEmptyHref=function(a){return a.replace(/href=(""|'')/gi,"")};l.prototype._processFieldsInLinks=function(a,b){var g=this.get("_graphic.layer");a=this._fixTokens(a,g);var d=this._encodeAttributes(b),
g=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;return a?a.replace(g,function(a,g,c){g=(""+(g||c)).trim();return p.substitute(a,g&&"{"===g[0]?b:d)}):a};l.prototype._compileAttachments=function(a,b){a=v.clone(a);if(!b||b&&0===b.length)return a;a.attachmentInfos=b;return a};l.prototype._queryAttachments=function(){var a=this._graphic,b=y.getSourceLayer(a);if(!b)return x.resolve([]);if((b="scene"===b.type&&b.associatedLayer?b.associatedLayer:b)&&"function"===typeof b.queryAttachments){var d=b.objectIdField,
c=(a=a.attributes)&&a[d],a=new n({objectIds:[c],returnMetadata:!0});return b.queryAttachments(a).then(function(a){return a[c]||[]})}return x.resolve([])};l.prototype._queryContentElements=function(a){var b=this;if(!Array.isArray(a))return x.resolve();var g={};a.forEach(function(a,d){"attachments"===a.type&&(a=b._queryAttachments())&&(g[d]=a)});return Object.keys(g).length?x.eachAlways(g):x.resolve()};l.prototype._getContent=function(){var a=this._effectivePopupTemplate,b=this._graphic,a=a&&a.content,
b="function"===typeof a?a.call(null,{graphic:b}):a;return x.isThenable(b)?b:x.resolve(b)};l.prototype._querySourceLayer=function(a,b){var g=a.layer,d=a.outFields;a=a.objectIds;var c=g.createQuery();c.objectIds=a;c.outFields=d;c.returnGeometry=!0;return g.queryFeatures(c,b).then(function(a){return a.features[0]})};l.prototype._queryRequiredFieldsFeature=function(a){var b=this,g=this._graphic,d=this._effectivePopupTemplate,f=g.sourceLayer;return f&&"function"===typeof f.queryFeatures&&d?("function"===
typeof f.load?f.load(a):x.resolve()).then(function(){var n=g.attributes[f.objectIdField];return t.safeCast(d.getRequiredFields(f.fields)).then(function(d){return c.featureHasFields(d,g)||"number"!==typeof n?null:b._querySourceLayer({layer:f,outFields:d,objectIds:[n]},a)})}):x.resolve(null)};l.prototype._queryFeature=function(a){var b=this,d=this._graphic;this._effectivePopupTemplate=d&&d.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled);return this._getContent().then(function(g){var c=b._checkForRelatedFeatures(g,
a),f=b._createFormattedExpressions().then(function(a){d.attributes=A({},d.attributes,a)}),n=b._queryContentElements(g).then(function(a){return b._contentResponse=a}),e=b._queryRequiredFieldsFeature(a).then(function(a){a&&(d.geometry=a.geometry,d.attributes=A({},d.attributes,a.attributes))});return x.eachAlways([c,f,n,e]).then(function(){b._set("formattedAttributes",b._createFormattedAttributes(g));b._set("title",b._compileTitle());var a=b._compileLastEditInfo();b._set("lastEditInfo",a||null);a=b._compileContent(g,
b._contentResponse);b._set("content",a||null);return a})})};l.prototype._isExpressionField=function(a){return L.test(a)};l.prototype._formatArcadeArray=function(a){return'\x3cul class\x3d"esri-widget__list"\x3e'+a.map(function(a){return"\x3cli\x3e"+("string"===typeof a?I(a):a)+"\x3c/li\x3e"}).join("")+"\x3c/ul\x3e"};l.prototype._formatArcadeDictionary=function(a){return'\x3ctable class\x3d"esri-widget__table"\x3e'+a.keys().map(function(b){var d=a.field(b),d="string"===typeof d?I(d):d;return"\x3ctr\x3e\x3cth\x3e"+
b+"\x3c/th\x3e\x3ctd\x3e"+d+"\x3c/td\x3e\x3c/tr\x3e"}).join("")+"\x3c/table\x3e"};l.prototype._createFormattedExpressions=function(){return w(this,void 0,void 0,function(){var a,b,d,c,f,n,e,l,y,k,B,h=this;return r(this,function(g){switch(g.label){case 0:return a=this,b=a._effectivePopupTemplate,d=a._graphic,c=b&&b.expressionInfos,f=[],n={},c&&c.length?[4,O()]:[2,n];case 1:e=g.sent();l=function(a){var b="expression/"+a.name,g=e.createSyntaxTree(a.expression),c=P.filter(function(a){return e.hasVariable(g,
a)});a=e.loadScriptDependencies(g,!0,c).then(function(){return w(h,void 0,void 0,function(){var a,f,y,l,k=this;return r(this,function(u){a=this.spatialReference;f=e.getViewInfo({spatialReference:a});y=e.createExecContext(d,f);y.useAsync=!0;this._addVarsToContext(e,c,y,f);l=e.createFunction(g,y);return[2,e.executeAsyncFunction(l,y).then(function(a){n[b]="string"===typeof a?I(a):Array.isArray(a)?k._formatArcadeArray(a):a&&"esri.arcade.Dictionary"===a.declaredClass?k._formatArcadeDictionary(a):a},function(a){return J.error("arcade-execution-error",
a)})]})})});f.push(a)};y=0;for(k=c;y<k.length;y++)B=k[y],l(B);return[2,x.eachAlways(f).then(function(){return n})]}})})};l.prototype._addVarsToContext=function(a,b,d,c){var g=this.graphic,f=this.map;b.forEach(function(b){b=b.toLowerCase();var n={map:f,spatialReference:c.sr};"$map"===b&&(d.vars[b]=a.convertMapToFeatureSetCollection(n));"$layer"===b&&(d.vars[b]=a.convertFeatureLayerToFeatureSet(g.sourceLayer,c.sr));"$datastore"===b&&(d.vars[b]=a.convertServiceUrlToWorkspace(g.sourceLayer.url,c.sr))})};
l.prototype._createFormattedAttributes=function(a){var b=this,d=this._effectivePopupTemplate,g={global:this._formatAttributes(d&&d.fieldInfos),content:[]};Array.isArray(a)&&a.forEach(function(a,d){"fields"===a.type&&a.fieldInfos&&(g.content[d]=b._formatAttributes(a.fieldInfos))});return g};l.prototype._getAllFieldInfos=function(a){var b=this._effectivePopupTemplate,d=[];(b=b&&b.fieldInfos)&&d.push.apply(d,b);if(!a||!Array.isArray(a))return d;a.forEach(function(a){"fields"===a.type&&d.push.apply(d,
a&&a.fieldInfos)});return d};l.prototype._checkForRelatedFeatures=function(a,b){var d=this._graphic;a=this._getAllFieldInfos(a);return this.queryRelatedInfos(d,a,b)};l.prototype._getChartOption=function(a){var d=a.value,c=a.attributes,g=a.formattedAttributes,f=a.fieldName,n=a.relatedFieldName,e=a.fieldInfos,l=a.index;a=y.getSourceLayer(this._graphic);var k=d.normalizeField,d=d.tooltipField,k=k?this.isRelatedField(k)?c[this.getRelatedFieldInfo(k).fieldName]:c[k]:null,B=n&&void 0!==c[n]?c[n]:void 0!==
c[f]?c[f]:g[f],B=void 0===B?null:B&&k?B/k:B,l=new b({x:l,y:B});if(this.isRelatedField(f))return g=this.getRelatedFieldInfo(f),f=(f=this.getRelatedFieldInfo(d))?f.fieldName:null,e=this._formatValue(B,{fieldInfos:e,fieldName:n,layer:a,preventPlacesFormatting:!!k}),n=g?g.label||g.fieldName:n,l.tooltip=(f&&void 0!==c[f]?c[f]:n)+": "+e,l;c=this._getFieldInfo(e,f);n=this._getFixedFieldName(f,a);c=c?c.label||c.fieldName:f;l.tooltip=(d&&void 0!==g[d]?g[d]:c)+": "+g[n];return l};l.prototype._getFixedFieldName=
function(a,b){return(b=H(b,a))?b.name:a};l.prototype._getFixedFieldNames=function(a,b){var d=this;return a&&a.map(function(a){return d._getFixedFieldName(a,b)})};l.prototype._setChartValue=function(a){var b=this,d=a.value,c=a.attributes,g=a.formattedAttributes;a=a.layer;var f=this._effectivePopupTemplate,n=this.relatedInfoCount,e=d.fields,l=d.normalizeField;d.fields=this._getFixedFieldNames(e,a);l&&(d.normalizeField=this._getFixedFieldName(l,a));if(e.some(function(a){return!!(null!=g[a]||b.isRelatedField(a)&&
n)})){var k=f&&f.fieldInfos;e.forEach(function(a,f){b.isRelatedField(a)?d.series=d.series.concat(b._getRelatedChartInfos({fieldInfos:k,fieldName:a,formattedAttributes:g,value:d})):(a=b._getChartOption({value:d,index:f,attributes:c,formattedAttributes:g,fieldName:a,fieldInfos:k}),d.series.push(a))})}};l.prototype._getRelatedChartInfos=function(a){var b=this,d=a.fieldInfos,c=a.fieldName,g=a.formattedAttributes,f=a.value,n=[];a=this.getRelatedFieldInfo(c);var e=a.fieldName,l=this.getRelatedInfo(a.layerId);
if(!l)return n;a=l.relatedFeatures;l=l.relation;if(!l||!a)return n;l=l.cardinality;a.forEach(function(a,l){var k=a.attributes;k&&Object.keys(k).forEach(function(a){a===e&&n.push(b._getChartOption({value:f,index:l,attributes:k,formattedAttributes:g,fieldName:c,relatedFieldName:a,fieldInfos:d}))})});return"one-to-many"===l||"many-to-many"===l?n:[n[0]]};e([z.property()],l.prototype,"_featureAbortController",void 0);e([z.property({readOnly:!0})],l.prototype,"content",void 0);e([z.property({type:Boolean})],
l.prototype,"defaultPopupTemplateEnabled",void 0);e([z.property({readOnly:!0})],l.prototype,"formattedAttributes",void 0);e([z.property({type:D})],l.prototype,"graphic",void 0);e([z.property({readOnly:!0})],l.prototype,"lastEditInfo",void 0);e([z.property({dependsOn:["view"]})],l.prototype,"spatialReference",null);e([z.property({readOnly:!0})],l.prototype,"title",void 0);e([z.property({dependsOn:["view"]})],l.prototype,"map",null);e([z.property({readOnly:!0,dependsOn:["_featureAbortController"]})],
l.prototype,"waitingForContent",null);e([z.property()],l.prototype,"view",void 0);return l=e([z.subclass("esri.widgets.FeatureViewModel")],l)}(z.declared(B))})},"esri/core/throttle":function(){define(["require","exports"],function(C,m){function h(e,h,m,w){var D=null,p=1E3;"number"===typeof h?(p=h,w=m):(D=h,p=m);var t=0,r,v=function(){t=0;e.apply(w,r)};h=function(){for(var e=[],h=0;h<arguments.length;h++)e[h]=arguments[h];D&&D.apply(w,e);r=e;p?t||(t=setTimeout(v,p)):v()};h.remove=function(){t&&(clearTimeout(t),
t=0)};h.forceUpdate=function(){t&&(clearTimeout(t),v())};h.hasPendingUpdates=function(){return!!t};return h}Object.defineProperty(m,"__esModule",{value:!0});m.throttle=h;m.default=h})},"esri/widgets/Feature/support/featureUtils":function(){define(["require","exports"],function(C,m){Object.defineProperty(m,"__esModule",{value:!0});m.getSourceLayer=function(h){if(h)return h.get("sourceLayer")||h.get("layer")}})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),
function(C,m,h,e,A,r,w,D,p,t,G,v,E,x){var F=new Map,k=D.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(m){function q(f){f=m.call(this)||this;f.relatedInfoCount=null;f.relatedInfos=new Map;return f}h(q,m);q.prototype.destroy=function(){this.relatedInfos.clear()};q.prototype.addRelatedFeatureAttributes=function(f){var c=this;this.relatedInfos.forEach(function(a){return c._addRelatedFeatureAttribute(f,a)})};q.prototype.getRelatedFieldInfo=function(f){if(-1===f.indexOf("relationships/"))return null;
f=f.split("/").slice(1);return{layerId:f[0],fieldName:f[1]}};q.prototype.getRelatedInfo=function(f){return this.relatedInfos.get(f.toString())};q.prototype.isRelatedField=function(f){void 0===f&&(f="");return f?-1!==f.indexOf("relationships/"):!1};q.prototype.queryRelatedInfos=function(f,c,a){var b=this;this.relatedInfos.clear();var d=x.getSourceLayer(f);if(!d)return p.resolve();var n=c.filter(function(a){return a&&b.isRelatedField(a.fieldName)});if(!n||!n.length)return p.resolve();this._createRelatedInfos(c,
d);return this._queryLayerInfos(d,a).then(function(d){b._updateRelatedInfoLayerInfos(d);return b._queryRelatedFeatureMap(f,a).then(function(a){Object.keys(a).forEach(function(d){b._setRelatedFeatures(a[d],d.toString())});return a})})};q.prototype._addRelatedFeatureAttribute=function(f,c){var a=this;f&&c&&(c.relatedFeatures&&c.relatedFeatures&&c.relatedFeatures.forEach(function(b){return a._addAttributesFromFeature(f,b,c)}),c.relatedStatsFeatures&&c.relatedStatsFeatures&&c.relatedStatsFeatures.forEach(function(b){return a._addAttributesFromFeature(f,
b,c)}))};q.prototype._updateRelatedInfoLayerInfo=function(f,c){if(f=f.value)this.getRelatedInfo(c).layerInfo=f.data};q.prototype._updateRelatedInfoLayerInfos=function(f){var c=this;Object.keys(f).forEach(function(a){return c._updateRelatedInfoLayerInfo(f[a],a.toString())})};q.prototype._addAttributesFromFeature=function(f,c,a){var b=this;f&&c&&a&&Object.keys(c.attributes).forEach(function(d){var n=b._relatedFieldInfoToString({layerId:a.relation.id.toString(),fieldName:d});f[n]=c.attributes[d]})};
q.prototype._relatedFieldInfoToString=function(f){return f?"relationships/"+f.layerId+"/"+f.fieldName:""};q.prototype._createRelatedInfoForFieldInfo=function(f,c){var a=this.getRelatedFieldInfo(f.fieldName);if(a){var b=a.layerId,a=a.fieldName;b&&(c=this.getRelatedInfo(b)||this._createRelatedInfo(b,c))&&(c.relatedFields.push(a),f.statisticType&&(f=new E({statisticType:f.statisticType,onStatisticField:a,outStatisticFieldName:a}),c.outStatistics.push(f)))}};q.prototype._createRelatedInfos=function(f,
c){var a=this;f.forEach(function(b){return a._createRelatedInfoForFieldInfo(b,c)})};q.prototype._queryRelatedFeatureMap=function(f,c){var a=this,b={};this.relatedInfos.forEach(function(d,n){d.layerInfo&&(b[n]=a._queryRelatedLayerFeatures(f,d,c))});return p.eachAlways(b)};q.prototype._queryLayerInfos=function(f,c){var a=this,b={};this.relatedInfos.forEach(function(d,n){d=d.relation;if(!d)return n=new w("relation-required","A relation is required on a layer to retrieve related records."),k.error(n),
p.reject(n);d=d.relatedTableId;if(!d)return n=new w("A related table ID is required on a layer to retrieve related records."),k.error(n),p.reject(n);d=f.url+"/"+d;var e=F.get(d),h=e?e:a._queryLayerInfo(d,c);e||F.set(d,h);b[n]=h});return p.eachAlways(b)};q.prototype._queryLayerInfo=function(f,c){return A(f,{query:{f:"json"},signal:c&&c.signal})};q.prototype._queryRelatedLayerFeatures=function(f,c,a){var b=x.getSourceLayer(f).layerId.toString(),d=c.layerInfo,n=c.queryTask,e=c.relation;if(b=this._getDestinationRelation(d,
b)){var e=e.keyField,k=b.keyField,b="string"===this._getDestinationFieldType(d,b)?k+"\x3d'"+f.attributes[e]+"'":k+"\x3d"+f.attributes[e];f=n.execute(new v({where:b,outFields:c.relatedFields}),a);c=c.outStatistics&&0<c.outStatistics.length&&d.supportsStatistics?n.execute(new v({where:b,outFields:c.relatedFields,outStatistics:c.outStatistics}),a):null;return p.eachAlways({features:f,statsFeatures:c?c:p.resolve()})}return p.resolve()};q.prototype._setRelatedFeatures=function(f,c){if(c=this.getRelatedInfo(c)){var a=
f.value;a&&(f=a.features,a=a.statsFeatures,f=f&&f.value,c.relatedFeatures=f?f.features:[],f=a&&a.value,c.relatedStatsFeatures=f?f.features:[])}};q.prototype._getRelation=function(f,c){if(!c.relationships)return null;var a=null;c.relationships.some(function(b){if(b.id===parseInt(f,10))return a=b,!0});return a};q.prototype._createRelatedInfo=function(f,c){var a=this._getRelation(f,c);if(a){c=c.url+"/"+a.relatedTableId;var b=new G({url:c}),a={url:c,queryTask:b,relation:a,relatedFields:[],outStatistics:[]};
this.relatedInfos.set(f,a);return a}};q.prototype._getDestinationRelation=function(f,c){var a;f&&f.relationships&&f.relationships.some(function(b){if(""+b.relatedTableId===c)return a=b,!0});return a};q.prototype._getDestinationFieldType=function(f,c){var a=void 0;f.fields.some(function(b){if(b.name===c.keyField)return a=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(b.type)?"number":"string",!0});return a};e([t.aliasOf("relatedInfos.size")],
q.prototype,"relatedInfoCount",void 0);e([t.property()],q.prototype,"relatedInfos",void 0);return q=e([t.subclass("esri.widgets.Popup.support.RelatedFeatures")],q)}(t.declared(r))})},"esri/widgets/Feature/support/attachmentUtils":function(){define(["require","exports"],function(C,m){Object.defineProperty(m,"__esModule",{value:!0});var h=C.toUrl("../../../themes/base/images/files/");m.isSupportedImage=function(e){e=e.toLowerCase();return"image/bmp"===e||"image/emf"===e||"image/exif"===e||"image/gif"===
e||"image/x-icon"===e||"image/jpeg"===e||"image/png"===e||"image/tiff"===e||"image/x-wmf"===e};m.getIconPath=function(e){return e?"text/plain"===e?h+"text-32.svg":"application/pdf"===e?h+"pdf-32.svg":"text/csv"===e?h+"csv-32.svg":"application/gpx+xml"===e?h+"gpx-32.svg":"application/x-dwf"===e?h+"cad-32.svg":"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?h+"code-32.svg":"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===
e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?h+"zip-32.svg":-1!==e.indexOf("image/")?h+"image-32.svg":-1!==e.indexOf("audio/")?h+"sound-32.svg":-1!==e.indexOf("video/")?h+"video-32.svg":-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?h+"excel-32.svg":-1!==e.indexOf("msword")||
-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?h+"word-32.svg":-1!==e.indexOf("powerpoint")||-1!==e.indexOf("presentationml")?h+"report-32.svg":h+"generic-32.svg":h+"generic-32.svg"}})},"esri/widgets/support/chartUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper dojo/_base/kernel @dojo/framework/shim/object @dojo/framework/shim/Promise".split(" "),function(C,m,h,e,A){function r(){var e=A.locale;if(!e)return"en_US";var h;
if(!(h=m.locales[e])){e=e.split("-")[0].toLowerCase();h=null;for(var w=0,v=Object.keys(m.locales);w<v.length;w++){var r=v[w];if(-1<r.indexOf(e)){h=m.locales[r];break}}}return h||"en_US"}Object.defineProperty(m,"__esModule",{value:!0});m.locales={ar:"ar","bs-ba":"bs_BA","ca-es":"ca_ES","cs-cz":"cs_CZ","da-dk":"da_DK","de-ch":"de_CH","de-de":"de_DE","el-gr":"el_GR","en-ca":"en_CA","en-us":"en_US","es-es":"es_ES","et-ee":"et_EE","fi-fi":"fi_FI","fr-fr":"fr_FR","he-il":"he_IL","hi-in":"hi_IN","hr-hr":"hr_HR",
"hu-hu":"hu_HU","id-id":"id_ID","it-it":"it_IT","ja-jp":"ja_JP","ko-kr":"ko_KR","lt-lt":"lt_LT","lv-lv":"lv_LV","nb-no":"nb_NO","nl-nl":"nl_NL","pl-pl":"pl_PL","pt-br":"pt_BR","pt-pt":"pt_PT","ro-ro":"ro_RO","ru-ru":"ru_RU","sl-sl":"sl_SL","sr-rs":"sr_RS","sv-se":"sv_SE","th-th":"th_TH","tr-tr":"tr_TR","uk-ua":"uk_UA","vi-vn":"vi_VN","zh-cn":"zh_Hans","zh-hk":"zh_Hant","zh-tw":"zh_Hant"};m.getChartLocale=r;var w,D=null;m.loadChartsModule=function(p){void 0===p&&(p=r());return e(this,void 0,void 0,
function(){var e,m,r,A;return h(this,function(h){switch(h.label){case 0:if(p===w)return[2,D];w=p;return[4,Promise.all([new Promise(function(e,k){C(["../../libs/amcharts4/index"],e,k)}),new Promise(function(e,k){C(["../../libs/amcharts4/lang/"+p],e,k)})])];case 1:return e=h.sent(),m=e[0],r=e[1],A=m.am4core,p===w&&(A.options.defaultLocale=r.default),D=m,[2,m]}})})}})},"esri/widgets/support/uriUtils":function(){define(["require","exports","dojo/i18n!./nls/uriUtils","../../core/string"],function(C,m,
h,e){function A(e){var h=null;r.some(function(p){p.pattern.test(e)&&(h=p);return!!h});return h}Object.defineProperty(m,"__esModule",{value:!0});var r=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:h.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"App Studio Player"},
{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,
label:h.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:h.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Microsoft Power Bi"}];
m.autoLink=function(h){if("string"!==typeof h||!h)return h;var m=A(h);if(!m)return h;var p=h.match(m.pattern),p=e.replace(m.label,{appName:m.appName,hierPart:p&&p[2]});return h.replace(m.pattern,"\x3ca "+(m.target?'target\x3d"'+m.target+'"':"")+'" href\x3d"$1"\x3e'+p+"\x3c/a\x3e")}})},"*now":function(C){C(['dojo/i18n!*preload*esri/widgets/nls/Feature*["ar","bs","ca","cs","da","de","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/i18n!./Feature/nls/Feature ../intl ../core/events ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Feature/FeatureViewModel ./Feature/support/attachmentUtils ./support/chartUtils ./support/uriUtils ./support/widget ./support/widgetUtils".split(" "),function(C,m,h,e,A,r,w,D,p,t,G,v,E,x,F,k,z){var q={title:!0,content:!0,lastEditedInfo:!0};return function(f){function c(a){a=
f.call(this)||this;a._chartMap=new Map;a._activeMediaMap=new Map;a._refreshTimers=new Map;a._mediaInfo=new Map;a.graphic=null;a.defaultPopupTemplateEnabled=!1;a.spatialReference=null;a.title=null;a.visibleElements=A({},q);a.map=null;a.view=null;a.viewModel=new v;return a}h(c,f);c.prototype.postInitialize=function(){var a=this;this.own(p.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))};c.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();
this._activeMediaMap=null;this._destroyCharts()};c.prototype.castVisibleElements=function(a){return A({},q,a)};c.prototype.render=function(){var a=k.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},k.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})),b=this.visibleElements,d=this.viewModel,c=d.waitingForContent,d=d.title,d=b.title?k.tsx("h4",{class:"esri-feature__title",innerHTML:d}):null,b=b.content?k.tsx("div",
{class:"esri-feature__main-container"},[this._renderContent(),this._renderLastEditInfo()]):null;return k.tsx("div",{class:this.classes("esri-feature","esri-widget")},k.tsx("div",{class:"esri-feature__size-container"},d,c?a:b))};c.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};c.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};c.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};c.prototype._buildKey=function(a){for(var b=
[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];d=this.get("viewModel.graphic.uid")||"0";b=b.join("-");return a+"__"+d+"-"+b};c.prototype._destroyCharts=function(){this._chartMap.forEach(function(a){return a.dispose()});this._chartMap.clear()};c.prototype._renderContent=function(){var a=this.viewModel.content;if(!a)return null;if("string"===typeof a)return k.tsx("div",{key:"content-string",innerHTML:a});if(k.isWidget(a))return k.tsx("div",{key:"content-widget"},a.render());if(a instanceof HTMLElement)return k.tsx("div",
{key:"content-html-element",bind:a,afterCreate:this._attachToNode});if(k.isWidgetBase(a))return k.tsx("div",{key:"content-dijit",bind:a.domNode,afterCreate:this._attachToNode});if(Array.isArray(a))return a.length?k.tsx("div",{key:"content-content-elements"},a.map(this._renderContentElement,this)):null};c.prototype._renderContentElement=function(a,b){var d=this.visibleElements;if("boolean"!==typeof d.content&&!d.content[a.type])return null;switch(a.type){case "attachments":return this._renderAttachments(a,
b);case "fields":return this._renderFields(a,b);case "media":return this._renderMedia(a,b);case "text":return this._renderText(a,b);default:return null}};c.prototype._renderAttachmentInfo=function(a){var b,d,c=a.attachmentInfo,f=a.supportsResizeAttachments,e=c.contentType,h=c.orientationInfo,m=c.name,p=c.url;a="preview"===a.contentElement.displayType?128:48;var h=(h=h?[h.rotation?"rotate("+h.rotation+"deg)":"",h.mirrored?"scaleX(-1)":""].join(" "):"")?{transform:h}:{},q=f&&E.isSupportedImage(e),t=
-1===p.indexOf("?")?"?":"\x26",e=q?""+p+t+"w\x3d"+a:E.getIconPath(e);a=(b={},b["esri-feature__attachment-item-mask--icon"]=!q,b);b=(d={},d["esri-feature__attachments-image--resizable"]=f,d);return k.tsx("li",{class:"esri-feature__attachments-item",key:c},k.tsx("a",{class:"esri-feature__attachments-item-link",href:p,target:"_blank"},k.tsx("div",{class:this.classes(a,"esri-feature__attachment-item-mask")},k.tsx("img",{styles:h,alt:"",class:this.classes(b,"esri-feature__attachments-image"),src:e}),k.tsx("span",
{class:"esri-feature__attachments-image-overlay"},k.tsx("span",{"aria-hidden":"true",class:"esri-feature__attachments-link-icon esri-icon-link-external"}))),k.tsx("span",{class:"esri-feature__attachments-filename"},m||r.noTitle)))};c.prototype._renderAttachments=function(a,b){var d=this,c,e=a.displayType,f=(b=a.attachmentInfos)&&b.length,h=this.get("graphic.layer.capabilities.operations.supportsResizeAttachments"),e=(c={},c["esri-feature__attachments--list"]="preview"!==e,c["esri-feature__attachments--preview"]=
"preview"===e,c);return f?k.tsx("div",{key:"attachments-element",class:this.classes("esri-feature__attachments","esri-feature__content-element",e)},k.tsx("div",{class:"esri-feature__attachments-title"},r.attach),k.tsx("ul",{class:"esri-feature__attachments-items"},b.map(function(b,c){return d._renderAttachmentInfo({attachmentInfo:b,attachmentInfoIndex:c,supportsResizeAttachments:h,contentElement:a})}))):null};c.prototype._forceLTR=function(a){return"\x26lrm;"+a};c.prototype._renderFieldInfo=function(a,
b){var d,c=this.viewModel.formattedAttributes,e=c?c.content[b]||c.global:null,f=a.fieldName,c=a.label||f,e=e?null==e[f]?"":e[f]:"";a=!(!a.format||!a.format.dateFormat);e="number"!==typeof e||a?F.autoLink(e):this._forceLTR(e);a=(d={},d["esri-feature__field-data--date"]=a,d);return k.tsx("tr",{key:this._buildKey("fields-element-info-row",b)},k.tsx("th",{key:this._buildKey("fields-element-info-row-header",b),class:"esri-feature__field-header",innerHTML:c}),k.tsx("td",{key:this._buildKey("fields-element-info-row-data",
b),class:this.classes("esri-feature__field-data",a),innerHTML:e}))};c.prototype._renderFields=function(a,b){var d=this;return(a=a.fieldInfos)?k.tsx("div",{key:this._buildKey("fields-element",b),class:this.classes("esri-feature__fields","esri-feature__content-element")},k.tsx("table",{class:"esri-widget__table",summary:r.fieldsSummary,key:this._buildKey("fields-element-table",b)},k.tsx("tbody",{key:this._buildKey("fields-element-table-body",b)},a.map(function(a){return d._renderFieldInfo(a,b)})))):
null};c.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");if(a)return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};c.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};c.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};c.prototype._getImageSource=function(a,b){var d=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var c=
a[1],c=void 0===c?"":c;return""+a[0]+d+"timestamp\x3d"+b+(c?"#":"")+c};c.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var d=this._activeMediaMap.get(a);isNaN(d)&&(d=0);(b=b.mediaInfos[d])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}};c.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,
c){return a._setupMediaRefreshTimer(c)})};c.prototype._updateMediaInfoTimestamp=function(a,b){var d=Date.now();this._mediaInfo.set(b,{timestamp:d,sourceURL:this._getImageSource(a,d)});this.scheduleRender()};c.prototype._setRefreshTimeout=function(a,b){var d=this,c=b.refreshInterval,e=b.value;c&&(b=6E4*c,this._updateMediaInfoTimestamp(e.sourceURL,a),b=setInterval(function(){d._updateMediaInfoTimestamp(e.sourceURL,a)},b),this._refreshTimers.set(a,b))};c.prototype._renderMediaInfoType=function(a){var b=
a.mediaInfo,d=a.contentElementIndex;a=a.activeMediaIndex;var c=b.title,c=void 0===c?"":c;if("image"===b.type){var e=b.value,f=b.refreshInterval,h=e.sourceURL,b=e.linkURL,e=this._shouldOpenInNewTab(b)?"_blank":"_self",h=(f=f?this._mediaInfo.get(d):null)?f.sourceURL:h,d=k.tsx("img",{alt:c,key:this._buildKey("media-image",d,a,f?f.timestamp:0),src:h});return(a=b?k.tsx("a",{title:c,href:b,target:e},d):null)?a:d}if(-1!==b.type.indexOf("chart"))return k.tsx("div",{key:this._buildKey("media-chart",d,a),bind:this,
"data-media-info":b,"data-content-element-index":d,class:"esri-feature__media-chart",afterCreate:this._getChartDependencies})};c.prototype._getChartDependencies=function(a){var b=this,d=a["data-media-info"],c=a["data-content-element-index"],e=d.value,f=d.type;x.loadChartsModule().then(function(d){b._renderChart({chartDiv:a,contentElementIndex:c,type:f,value:e,chartsModule:d})})};c.prototype._createPieChart=function(a){var b=a.chartsModule,d=b.am4charts;a=b.am4core.create(a.chartDiv,d.PieChart);a.rtl=
z.isRTL();d=a.series.push(new d.PieSeries);d.labels.template.disabled=!0;d.ticks.template.disabled=!0;d.dataFields.value="y";d.dataFields.category="x";d.tooltip.label.wrap=!0;d.tooltip.label.maxWidth=150;d.tooltip.label.rtl=a.rtl;return a};c.prototype._createXYChart=function(a){var b=a.type,d=a.value,c=a.chartsModule,e=c.am4core,c=c.am4charts;a=e.create(a.chartDiv,c.XYChart);a.rtl=z.isRTL();d=15<d.series.length;if("column-chart"===b){var f=a.xAxes.push(new c.CategoryAxis);f.dataFields.category="x";
f.renderer.labels.template.disabled=!0;f.tooltip.label.wrap=!0;f.tooltip.label.maxWidth=125;f.tooltip.label.rtl=a.rtl;f.tooltip.events.on("sizechanged",function(){f.tooltip.dy=-f.tooltip.contentHeight});a.yAxes.push(new c.ValueAxis);var h=a.series.push(new c.ColumnSeries);h.dataFields.valueY="y";h.dataFields.categoryX="x";a.cursor=new c.XYCursor;d&&(a.scrollbarX=new e.Scrollbar)}if("bar-chart"===b){var k=a.yAxes.push(new c.CategoryAxis);k.dataFields.category="x";k.renderer.inversed=!0;k.renderer.labels.template.disabled=
!0;k.tooltip.label.wrap=!0;k.tooltip.label.maxWidth=125;k.tooltip.label.rtl=a.rtl;k.tooltip.events.on("sizechanged",function(){k.tooltip.dx=k.tooltip.contentWidth});a.xAxes.push(new c.ValueAxis);h=a.series.push(new c.ColumnSeries);h.dataFields.valueX="y";h.dataFields.categoryY="x";a.cursor=new c.XYCursor;d&&(a.scrollbarY=new e.Scrollbar)}if("line-chart"===b){var m=a.xAxes.push(new c.CategoryAxis);m.dataFields.category="x";m.renderer.labels.template.disabled=!0;m.tooltip.label.wrap=!0;m.tooltip.label.maxWidth=
125;m.tooltip.label.rtl=a.rtl;m.tooltip.events.on("sizechanged",function(){m.tooltip.dy=-m.tooltip.contentHeight});a.yAxes.push(new c.ValueAxis);h=a.series.push(new c.LineSeries);h.dataFields.categoryX="x";h.dataFields.valueY="y";a.cursor=new c.XYCursor;d&&(a.scrollbarX=new e.Scrollbar)}return a};c.prototype._renderChart=function(a){var b=a.contentElementIndex,c=a.type,e=a.value,f=a.chartsModule;f.am4core.useTheme(f.am4themes_animated);a="pie-chart"===c?this._createPieChart(a):this._createXYChart(a);
a.data=e.series.map(function(a){return{x:a.tooltip,y:a.y}});this._chartMap.set(b,a)};c.prototype._renderMediaInfo=function(a){var b=a.mediaInfo,c=a.contentElementIndex;a=this._renderMediaInfoType({mediaInfo:b,contentElementIndex:c,activeMediaIndex:a.activeMediaIndex});var e=b.title?k.tsx("div",{key:this._buildKey("media-title",c),class:"esri-feature__media-item-title",innerHTML:b.title}):null,b=b.caption?k.tsx("div",{key:this._buildKey("media-caption",c),class:"esri-feature__media-item-caption",innerHTML:b.caption}):
null;return k.tsx("div",{key:this._buildKey("media-container",c),class:"esri-feature__media-item-container"},k.tsx("div",{key:this._buildKey("media-item-container",c),class:"esri-feature__media-item"},a),e,b)};c.prototype._renderMediaPageButton=function(a,b){var c=(a="previous"===a)?r.previous:r.next,e=a?this.classes("esri-feature__button","esri-feature__media-previous"):this.classes("esri-feature__button","esri-feature__media-next"),f=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon",
"esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),h=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),m=a?this._previousClick:this._nextClick;return k.tsx("div",{key:this._buildKey(a?"media-previous":"media-next",b),title:c,tabIndex:0,role:"button",class:e,
"data-content-element-index":b,bind:this,onkeydown:m,onclick:m},k.tsx("span",{"aria-hidden":"true",class:f}),k.tsx("span",{"aria-hidden":"true",class:h}),k.tsx("span",{class:"esri-icon-font-fallback-text"},c))};c.prototype._handleMediaKeyup=function(a){var b=a.currentTarget["data-content-element-index"],c=D.eventKey(a);"ArrowLeft"===c&&(a.stopPropagation(),this.previousMedia(b));"ArrowRight"===c&&(a.stopPropagation(),this.nextMedia(b))};c.prototype._renderMedia=function(a,b){var c,e=(a=a.mediaInfos)&&
a.length||0,f=(c={},c["esri-feature--media-pagination-visible"]=1<e,c);c=this._renderMediaPageButton("previous",b);var h=this._renderMediaPageButton("next",b),m=this._activeMediaMap.get(b);isNaN(m)&&(this._activeMediaMap.set(b,0),m=0);return e?k.tsx("div",{key:this._buildKey("media-element",b),"data-content-element-index":b,bind:this,onkeyup:this._handleMediaKeyup,class:this.classes("esri-feature__media","esri-feature__content-element",f)},k.tsx("div",{key:this._buildKey("media-element-container",
b),class:"esri-feature__media-container"},c,this._renderMediaInfo({mediaInfo:a[m],contentElementIndex:b,activeMediaIndex:m}),h)):null};c.prototype._renderLastEditInfo=function(){var a=this.visibleElements,b=this.viewModel.lastEditInfo;if(!b||!a.lastEditedInfo)return null;a=b.user;b=w.substitute("edit"===b.type?a?r.lastEditedByUser:r.lastEdited:a?r.lastCreatedByUser:r.lastCreated,{date:b.date,user:a});return k.tsx("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},
b)};c.prototype._renderText=function(a,b){return a.text?k.tsx("div",{key:this._buildKey("text-element",b),innerHTML:a.text,class:this.classes("esri-feature__text","esri-feature__content-element")}):null};c.prototype._attachToNode=function(a){a.appendChild(this)};c.prototype._setContentElementMedia=function(a,b){this._clearMediaRefreshTimer(a);var c=this.viewModel.content;(c=(c=c&&c[a])&&c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};
c.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};c.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};c.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};e([t.aliasOf("viewModel.graphic")],c.prototype,"graphic",void 0);e([t.aliasOf("viewModel.defaultPopupTemplateEnabled")],c.prototype,"defaultPopupTemplateEnabled",
void 0);e([t.aliasOf("viewModel.spatialReference")],c.prototype,"spatialReference",void 0);e([t.aliasOf("viewModel.title")],c.prototype,"title",void 0);e([t.property(),k.renderable()],c.prototype,"visibleElements",void 0);e([t.cast("visibleElements")],c.prototype,"castVisibleElements",null);e([t.aliasOf("viewModel.map")],c.prototype,"map",void 0);e([t.aliasOf("viewModel.view")],c.prototype,"view",void 0);e([t.property({type:v}),k.renderable(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo"])],
c.prototype,"viewModel",void 0);e([k.accessibleHandler()],c.prototype,"_previousClick",null);e([k.accessibleHandler()],c.prototype,"_nextClick",null);return c=e([t.subclass("esri.widgets.Feature")],c)}(t.declared(G))});