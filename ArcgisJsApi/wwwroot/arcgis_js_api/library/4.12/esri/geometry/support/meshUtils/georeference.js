// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./projection ../../../views/3d/support/projectionUtils".split(" "),function(G,n,D,p,u,v,q,E,w,r){function x(b,a,c,d){void 0===d&&(d=0);return y(b,a,3,c,d)}function z(b,a,c,d){void 0===d&&(d=0);b=y(b,a,4,c,d);if(a)for(c=3;c<a.length;c+=4)b[c]=a[c];return b}function y(b,a,c,d,e){void 0===
e&&(e=0);if(!d.isWebMercator||!a)return a;d=new Float32Array(a.length);for(var l=b.length/3,g=0;g<l;g+=1){var f=r.webMercator.y2lat(b[3*g+1]),f=Math.cos(f);1===e&&(f=1/f);k[0]=a[g*c+0]*f;k[1]=a[g*c+1]*f;k[2]=a[g*c+2];q.vec3.normalize(k,k);for(f=0;3>f;f++)d[g*c+f]=k[f]}return d}function A(b,a,c){r.computeLinearTransformation(b.spatialReference,[b.x,b.y,b.z||0],c,r.SphericalECEFSpatialReference);b=t(a?a.unit:null,b.spatialReference);a=b.horizontal;u.mat4.scale(c,c,[a,a,b.vertical]);return c}function B(b,
a){b=b.spatialReference;return b.isWGS84||b.isWebMercator&&(!a||!1!==a.geographic)}function t(b,a){if(D.isNone(b))return F;var c=a.isWGS84?1:p.getMetersPerUnit(a);a=a.isWGS84?1:p.getMetersPerVerticalUnitForSR(a);b=p.convertUnit(1,b,"meters");return{horizontal:b*c,vertical:b*a}}Object.defineProperty(n,"__esModule",{value:!0});n.georeference=function(b,a,c){if(B(a,c)){var d=a.spatialReference;A(a,c,m);var e;e=b.position;var l=m,g=a.spatialReference,f=new Float64Array(e.length);for(a=0;a<e.length;a+=
3){for(c=0;3>c;c++)k[c]=e[a+c];q.vec3.transformMat4(k,k,l);for(c=0;3>c;c++)f[a+c]=k[c]}e=new Float64Array(e.length);e=w.projectFromECEF(f,e,g);l=x(e,b.normal,d);b=z(e,b.tangent,d);b={position:e,normal:l,tangent:b}}else{d=new Float64Array(b.position.length);e=b.position;l=a.x;g=a.y;f=a.z||0;c=t(c?c.unit:null,a.spatialReference);a=c.horizontal;c=c.vertical;for(var h=0;h<e.length;h+=3)d[h+0]=e[h+0]*a+l,d[h+1]=e[h+1]*a+g,d[h+2]=e[h+2]*c+f;b={position:d,normal:b.normal,tangent:b.tangent}}return b};n.ungeoreference=
function(b,a,c){if(B(a,c)){var d=a.spatialReference;A(a,c,m);u.mat4.invert(C,m);for(var e=b.position,l=C,g=w.projectToECEF(e,d,new Float64Array(e.length)),f=0;f<e.length;f+=3){for(a=0;3>a;a++)k[a]=g[f+a];q.vec3.transformMat4(k,k,l);for(a=0;3>a;a++)g[f+a]=k[a]}e=x(b.position,b.normal,d,1);b=z(b.position,b.tangent,d,1);b={position:g,normal:e,tangent:b}}else{d=new Float64Array(b.position.length);g=b.position;e=a.x;l=a.y;f=a.z||0;c=t(c?c.unit:null,a.spatialReference);a=c.horizontal;c=c.vertical;for(var h=
0;h<g.length;h+=3)d[h+0]=(g[h+0]-e)/a,d[h+1]=(g[h+1]-l)/a,d[h+2]=(g[h+2]-f)/c;b={position:d,normal:b.normal,tangent:b.tangent}}return b};var m=v.mat4f64.create(),C=v.mat4f64.create(),k=E.vec3f64.create(),F={horizontal:1,vertical:1}});