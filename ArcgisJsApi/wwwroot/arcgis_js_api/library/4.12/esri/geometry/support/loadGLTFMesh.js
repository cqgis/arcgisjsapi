// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../core/maybe ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f64 ./MeshMaterial ./MeshTexture ./meshUtils/georeference ../../views/3d/glTF/DefaultLoadingContext ../../views/3d/glTF/loader ../../views/3d/glTF/internal/indexUtils ../../views/3d/support/buffer/BufferView ../../views/3d/support/buffer/math ../../views/3d/support/buffer/utils ../../views/3d/webgl-engine/materials/DefaultMaterial".split(" "),
function(L,u,z,A,B,e,v,w,C,D,E,F,G,n,f,k,g,H){function I(b,a,x,d,p){var h=g.createBuffer(f.BufferViewVec3f64,d.attributes.position.count);k.vec3.transformMat4(h,d.attributes.position,d.transform);var l=e.applySome(d.attributes.normal,function(c){var a=g.createBuffer(f.BufferViewVec3f,c.count),b=v.mat3.normalFromMat4(w.mat3f64.create(),d.transform);k.vec3.transformMat3(a,c,b);return a.typedBuffer}),q=e.applySome(d.attributes.tangent,function(c){var a=g.createBuffer(f.BufferViewVec4f,c.count),b=v.mat3.normalFromMat4(w.mat3f64.create(),
d.transform);k.vec4.transformMat3(a,c,b);return a.typedBuffer}),r=e.applySome(d.attributes.texCoord0,function(c){var a=g.createBuffer(f.BufferViewVec2f,c.count);g.vec2.normalizeIntegerBuffer(a,c);return a.typedBuffer}),t=e.applySome(d.attributes.color,function(c){var a=g.createBuffer(f.BufferViewVec4u8,c.count);if(4===c.elementCount)c instanceof f.BufferViewVec4f?k.vec4.scale(a,c,255):c instanceof f.BufferViewVec4u8?g.vec4.copy(a,c):c instanceof f.BufferViewVec4u16&&k.vec4.scale(a,c,1/255);else{g.vec4.fill(a,
255,255,255,255);var b=new f.BufferViewVec3u8(a.buffer,0,4);c instanceof f.BufferViewVec3f?k.vec3.scale(b,c,255):c instanceof f.BufferViewVec3u8?g.vec3.copy(b,c):c instanceof f.BufferViewVec3u16&&k.vec3.scale(b,c,1/255)}return a.typedBuffer}),l=E.georeference({position:h.typedBuffer,normal:e.unwrap(l),tangent:e.unwrap(q)},b,B({},p,{unit:"meters"}));p=J(d.indices||d.attributes.position.count,d.primitiveType);a=a.materials.get(d.material);var h=H.COLOR_GAMMA,h=[255*Math.pow(a.color[0],1/h),255*Math.pow(a.color[1],
1/h),255*Math.pow(a.color[2],1/h),a.opacity],r={position:l.position,normal:l.normal,tangent:l.tangent,uv:e.unwrap(r),color:e.unwrap(t)},t=C.default,l=e.unwrap(e.applySome(a.textureColor,function(a){return x.get(a)})),q=e.unwrap(e.applySome(a.textureNormal,function(a){return x.get(a)})),m;a:{switch(a.alphaMode){case "OPAQUE":m="opaque";break a;case "MASK":m="mask";break a;case "BLEND":m="blend";break a}m=void 0}return{vertexAttributes:r,components:[{faces:p,material:new t({color:h,colorTexture:l,normalTexture:q,
alphaMode:m,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided}),trustSourceNormals:!0}],spatialReference:b.spatialReference}}function J(b,a){switch(a){case 4:return n.trianglesToTriangles(b);case 5:return n.triangleStripToTriangles(b);case 6:return n.triangleFanToTriangles(b)}}function K(b){return{horizontal:y(b.s),vertical:y(b.t)}}function y(b){switch(b){case 33071:return"clamp";case 33648:return"mirror";case 10497:return"repeat"}}Object.defineProperty(u,"__esModule",{value:!0});u.loadGLTFMesh=
function(b,a,e){return A(this,void 0,void 0,function(){var d,f,h,l,g;return z(this,function(k){switch(k.label){case 0:return d=new F.DefaultLoadingContext,[4,G.load(d,a,e)];case 1:return f=k.sent(),h=f.model,l=h.lods.shift(),g=new Map,h.textures.forEach(function(a,b){g.set(b,new D({data:a.data,wrap:K(a.parameters.wrap)}))}),[2,l.parts.map(function(a){return I(b,h,g,a,e)})]}})})}});