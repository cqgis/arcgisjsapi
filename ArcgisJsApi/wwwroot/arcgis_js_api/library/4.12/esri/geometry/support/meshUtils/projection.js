// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/Logger ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../views/3d/support/projectionUtils ../../../views/3d/support/buffer/BufferView".split(" "),function(z,h,w,q,x,y,p,v,k,f){function r(c,b,d,e,a,f){if(b){var h=d.count;if(a.isWGS84)for(a=0;a<h;a++)e.getVec(a,l),b.getVec(a,m),k.computeLinearTransformation(k.SphericalECEFSpatialReference,
l,t,k.SphericalECEFSpatialReference),q.mat3.fromMat4(g,t),1===c&&q.mat3.transpose(g,g),p.vec3.transformMat3(m,m,g),f.setVec(a,m);else for(a=0;a<h;a++){e.getVec(a,l);b.getVec(a,m);k.computeLinearTransformation(k.SphericalECEFSpatialReference,l,t,k.SphericalECEFSpatialReference);q.mat3.fromMat4(g,t);var n=k.webMercator.y2lat(d.get(a,1)),n=Math.cos(n);0===c&&(n=1/n);g[0]*=n;g[1]*=n;g[2]*=n;g[3]*=n;g[4]*=n;g[5]*=n;1===c&&q.mat3.transpose(g,g);p.vec3.transformMat3(m,m,g);p.vec3.normalize(m,m);f.setVec(a,
m)}return f}}Object.defineProperty(h,"__esModule",{value:!0});var u=w.getLogger("esri.geometry.support.meshUtils.normalProjection");h.projectNormalToECEF=function(c,b,d,e,a){if(!e.isWebMercator&&!e.isWGS84)return u.error("Cannot convert PCS spatial reference buffer to ECEF"),a;r(0,new f.BufferViewVec3f(c.buffer,c.byteOffset),new f.BufferViewVec3f64(b.buffer,b.byteOffset),new f.BufferViewVec3f64(d.buffer,d.byteOffset),e,new f.BufferViewVec3f(a.buffer,a.byteOffset));return a};h.projectNormalFromECEF=
function(c,b,d,e,a){if(!e.isWebMercator&&!e.isWGS84)return u.error("Cannot convert to PCS spatial reference buffer from ECEF"),a;r(1,new f.BufferViewVec3f(c.buffer,c.byteOffset),new f.BufferViewVec3f64(b.buffer,b.byteOffset),new f.BufferViewVec3f64(d.buffer,d.byteOffset),e,new f.BufferViewVec3f(a.buffer,a.byteOffset));return a};h.projectToECEF=function(c,b,d){k.bufferToBuffer(c,b,0,d,k.SphericalECEFSpatialReference,0,c.length/3);return d};h.projectFromECEF=function(c,b,d){k.bufferToBuffer(c,k.SphericalECEFSpatialReference,
0,b,d,0,c.length/3);return b};h.transformBufferInPlace=function(c,b,d){void 0===d&&(d=!1);if(c)for(var e=0;e<c.length;e+=3){for(var a=0;3>a;a++)l[a]=c[e+a];p.vec3.transformMat4(l,l,b);d&&p.vec3.normalize(l,l);for(a=0;3>a;a++)c[e+a]=l[a]}};h.projectTangentToECEF=function(c,b,d,e,a){if(!e.isWebMercator&&!e.isWGS84)return u.error("Cannot convert PCS spatial reference buffer to ECEF"),a;r(0,new f.BufferViewVec3f(c.buffer,c.byteOffset,16),new f.BufferViewVec3f64(b.buffer,b.byteOffset),new f.BufferViewVec3f64(d.buffer,
d.byteOffset),e,new f.BufferViewVec3f(a.buffer,a.byteOffset,16));for(b=3;b<c.length;b+=4)a[b]=c[b];return a};h.projectTangentFromECEF=function(c,b,d,e,a){if(!e.isWebMercator&&!e.isWGS84)return u.error("Cannot convert to PCS spatial reference buffer from ECEF"),a;r(1,new f.BufferViewVec3f(c.buffer,c.byteOffset,16),new f.BufferViewVec3f64(b.buffer,b.byteOffset),new f.BufferViewVec3f64(d.buffer,d.byteOffset),e,new f.BufferViewVec3f(a.buffer,a.byteOffset,16));for(b=3;b<c.length;b+=4)a[b]=c[b];return a};
var l=v.vec3f64.create(),m=v.vec3f64.create(),t=y.mat4f64.create(),g=x.mat3f64.create()});