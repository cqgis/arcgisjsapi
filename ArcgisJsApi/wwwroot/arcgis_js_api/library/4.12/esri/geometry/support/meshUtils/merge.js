// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/Logger","../MeshComponent"],function(x,q,t,u){function v(a,c,e){if(a.components)for(var d=0,f=a.components;d<f.length;d++){for(var b=f[d],g=b.cloneWithSharedTextures(),b=0;b<g.faces.length;b++)g.faces[b]+=c.position/3;b=g;0<c.normal&&!a.vertexAttributes.normal&&"source"===b.shading&&(b.shading="flat");e.push(g)}else if(a.vertexAttributes&&a.vertexAttributes.position){d=a.vertexAttributes.position.length/3;f=new Uint32Array(d);for(b=0;b<d;b++)f[b]=b+c.position;
d=b=new u({faces:f});0<c.normal&&!a.vertexAttributes.normal&&"source"===d.shading&&(d.shading="flat");e.push(b)}}function l(a,c,e,d,f){if(c){var b=c.position;if(b)if(c=c[a]){f=0;b=e[a];e=d[a];for(var g=c.length,h=0;h<g;h++)b[e++]=c[f++];d[a]+=c.length}else if(c=e[a],e=d[a],g=m[a],c){for(h=0;h<b.length;h+=3)for(var p=0;p<g;p++)c[e++]=f;d[a]=e}}}function w(a){var c,e,d,f,b=0,g=0,h=0,p=0,l=0;f=d=c=e=!1;for(var n=0;n<a.length;n++){var k=a[n].vertexAttributes;if(k&&k.position&&(k.uv&&(e=!0),k.normal&&
(c=!0),k.tangent&&(f=!0),k.color&&(d=!0),c&&e&&d&&f))break}for(n=0;n<a.length;n++)(k=a[n].vertexAttributes)&&k.position&&(b+=k.position.length,e&&(g+=k.position.length/m.position*m.uv),c&&(h+=k.position.length/m.position*m.normal),d&&(p+=k.position.length/m.position*m.color),f&&(l+=k.position.length/m.position*m.tangent));return{position:new Float64Array(b),uv:g?new Float32Array(g):null,normal:h?new Float32Array(h):null,tangent:l?new Float32Array(l):null,color:p?new Uint8Array(p):null}}Object.defineProperty(q,
"__esModule",{value:!0});var r=t.getLogger("esri.geometry.support.triangleMeshMerge");q.merge=function(a){if(0===a.length)return r.error("merge()","Must specify one more more geometries to merge"),null;var c=a[0].spatialReference;if(a.some(function(a){return!a.spatialReference.equals(c)}))return r.error("merge()","Geometries must all be in the same spatial reference"),null;for(var e=w(a),d=[],f={position:0,uv:0,normal:0,tangent:0,color:0},b=0;b<a.length;b++){var g=a[b],h=g.vertexAttributes;v(g,f,
d);l("position",h,e,f,0);l("normal",h,e,f,0);l("tangent",h,e,f,0);l("uv",h,e,f,0);l("color",h,e,f,255)}return{vertexAttributes:e,components:d,spatialReference:c}};var m={position:3,normal:3,tangent:4,uv:2,color:4}});