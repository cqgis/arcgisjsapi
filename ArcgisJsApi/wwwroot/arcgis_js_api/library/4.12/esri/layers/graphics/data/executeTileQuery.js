// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/Set ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ./QueryEngine ./utils".split(" "),function(v,p,w,x,y,t,m,u,q,n){function r(c,a,e,d,k,f,l,h){l&&!f?d.forEachInBounds(k,function(b){if(!a.has(b.objectId)){var g=n.getCentroid(e,b,h),d=b.attributes;g&&(a.add(b.objectId),c.push(new q.Feature(d,b.localId,
null,g)))}}):f&&!l?d.forEachInBounds(k,function(b){if(!a.has(b.objectId)){var g=b.attributes,d=n.getGeometry(e,b,0,h);d&&(a.add(b.objectId),c.push(new q.Feature(g,b.localId,d,null)))}}):d.forEachInBounds(k,function(b){if(!a.has(b.objectId)){var d=b.attributes,k=n.getGeometry(e,b,0,h),f=n.getCentroid(e,b,h);k&&f&&(a.add(b.objectId),c.push(new q.Feature(d,b.localId,k,f)))}})}Object.defineProperty(p,"__esModule",{value:!0});p.executeTileQueryForIds=function(c,a,e){a=m.pad(a.bounds,e.pixelBuffer*a.resolution,
m.create());var d=[];c.featureStore.forEachInBounds(a,function(a){return d.push(c.featureAdapter.getObjectId(a))});return d};p.executeTileQuery=function(c,a,e){var d=e.returnGeometry,k=e.returnCentroid,f=e.pixelBuffer;e=new t.default;var l=[],f=f*a.resolution,h=m.pad(a.bounds,f,m.create());r(l,e,c,c.featureStore,h,d,k,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]});if("esriGeometryPoint"===c.geometryType||k){var b=u.getInfo(c.spatialReference);if(b){var g=
b.valid,b=g[0],g=g[1];if(h[0]<b){var n=m.fromValues(g-f,h[1],g,h[3]);r(l,e,c,c.featureStore,n,d,k,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[g,a.bounds[3]]})}h[2]>g&&(f=m.fromValues(b,h[1],b+f,h[3]),r(l,e,c,c.featureStore,f,d,k,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[b-g+a.bounds[0],a.bounds[3]]}))}}l.sort(function(a,b){return a.attributes[c.objectIdField]-b.attributes[c.objectIdField]});return{features:l,objectIds:e}}});