// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/Error ../../core/promiseUtils ./arcgisLayerUrl ./lazyLayerLoader".split(" "),function(l,d,h,m,n,e,p,q){function r(b,a){return b.sublayerIds.map(function(c){return new b.Constructor(h({},a,{layerId:c,sublayerTitleMode:"service-name"}))})}function t(b){var a=p.parse(b);if(!a)return e.reject(new n("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:b}));var c=a.serverType,k=a.sublayer,u=
{FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(c){case "MapServer":c=null!=k?"FeatureLayer":v(b).then(function(a){return a?"TileLayer":"MapImageLayer"});break;case "ImageServer":c=f(b).then(function(a){var b=a.tileInfo&&a.tileInfo.format;return a.tileInfo?b&&"LERC"===b.toUpperCase()&&a.cacheType&&"elevation"===a.cacheType.toLowerCase()?"ElevationLayer":"TileLayer":"ImageryLayer"});break;case "SceneServer":c=f(a.url.path).then(function(a){var b=
{Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};return a&&Array.isArray(a.layers)&&0<a.layers.length&&(a=a.layers[0].layerType,null!=b[a])?b[a]:"SceneLayer"});break;default:c=u[c]}var w={FeatureLayer:!0,SceneLayer:!0},g={parsedUrl:a,Constructor:null,sublayerIds:null},d;return e.when(c).then(function(a){d=a;if(w[a]&&null==k)return x(b).then(function(a){1!==a.length&&(g.sublayerIds=a)})}).then(function(){return(0,q.layerLookupMap[d])()}).then(function(a){g.Constructor=
a;return g})}function x(b){return f(b).then(function(a){return a&&Array.isArray(a.layers)?a.layers.map(function(a){return a.id}).reverse():[]})}function v(b){return f(b).then(function(a){return a.tileInfo})}function f(b){return m(b,{responseType:"json",query:{f:"json"}}).then(function(a){return a.data})}Object.defineProperty(d,"__esModule",{value:!0});d.fromUrl=function(b){return t(b.url).then(function(a){var c=h({},b.properties,{url:b.url});return a.sublayerIds?e.create(function(a){return l(["../GroupLayer"],
a)}).then(function(b){var d=new b({title:a.parsedUrl.title});r(a,c).forEach(function(a){return d.add(a)});return e.resolve(d)}):e.resolve(new a.Constructor(c))})}});