// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/Collection ../../core/JSONSupport ../../core/Loadable ../../core/maybe ../../core/watchUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./kmlUtils".split(" "),function(r,t,m,d,u,h,n,p,q,k,c,l,f){return function(g){function b(){var a=null!==g&&g.apply(this,arguments)||this;a._sublayersHandles=null;a.description=null;a.id=
null;a.networkLink=null;a.title=null;return a}m(b,g);e=b;b.prototype.initialize=function(){var a=this;k.whenOnce(this,"networkLink").then(function(b){return k.whenTrueOnce(a,"visible")}).then(function(){return a.load()})};b.prototype.load=function(a){var b=this;if(this.networkLink)return a=q.isSome(a)?a.signal:null,a=this._fetchService(this._get("networkLink").href,a).then(function(a){a=l.default(h.ofType(e),f.sublayersFromJSON(e,a));b.sublayers?b.sublayers.addMany(a):b.sublayers=a;b.layer&&b.layer.notifyChange("visibleSublayers")}),
this.addResolvingPromise(a),this.when()};Object.defineProperty(b.prototype,"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(b){return b.layer=a})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sublayers",{set:function(a){var b=this,c=this._get("sublayers");c&&(c.forEach(function(a){a.parent=null;a.layer=null}),this._sublayersHandles.forEach(function(a){return a.remove()}),this._sublayersHandles=null);a&&(a.forEach(function(a){a.parent=
b;a.layer=b.layer}),this._sublayersHandles=[a.on("after-add",function(a){a=a.item;a.parent=b;a.layer=b.layer}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})]);this._set("sublayers",a)},enumerable:!0,configurable:!0});b.prototype.castSublayers=function(a){return l.default(h.ofType(e),a)};Object.defineProperty(b.prototype,"visible",{get:function(){return this._get("visible")},set:function(a){this._get("visible")!==a&&(this._set("visible",a),this.layer&&this.layer.notifyChange("visibleSublayers"))},
enumerable:!0,configurable:!0});b.prototype.readVisible=function(a,b){return!!b.visibility};b.prototype._fetchService=function(a,b){return f.fetchService(a,this.layer.outSpatialReference,this.layer.refreshInterval,b).then(function(a){return f.parseKML(a.data)})};var e;d([c.property()],b.prototype,"description",void 0);d([c.property()],b.prototype,"id",void 0);d([c.property({value:null})],b.prototype,"layer",null);d([c.property({readOnly:!0,value:null})],b.prototype,"networkLink",void 0);d([c.property({json:{write:{allowNull:!0}}})],
b.prototype,"parent",void 0);d([c.property({value:null,json:{write:{allowNull:!0}}})],b.prototype,"sublayers",null);d([c.cast("sublayers")],b.prototype,"castSublayers",null);d([c.property({value:null,json:{read:{source:"name"}}})],b.prototype,"title",void 0);d([c.property({value:!0})],b.prototype,"visible",null);d([c.reader("visible",["visibility"])],b.prototype,"readVisible",null);return b=e=d([c.subclass("esri.layers.support.KMLSublayer")],b)}(c.declared(n,p))});