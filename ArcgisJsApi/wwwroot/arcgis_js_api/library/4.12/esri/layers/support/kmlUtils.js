// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../config ../../PopupTemplate ../../request ../../core/lang ../../renderers/support/jsonUtils ../../tasks/support/FeatureSet".split(" "),function(A,h,q,r,B,t,u,v,g,w,x){function p(c,e,d){d.forEach(function(d){c.set(d.attributes[e],d)})}function y(c,e){var d;e.some(function(e){return e.id===c?(d=e,!0):!1});return d}Object.defineProperty(h,"__esModule",{value:!0});var z=
{esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};h.parseKML=function(c){var e=c.folders.slice(),d=new Map,f=new Map,k=new Map,l=new Map,m=new Map,n={esriGeometryPoint:f,esriGeometryPolyline:k,esriGeometryPolygon:l};c.featureCollection.layers.forEach(function(b){var a=g.clone(b);a.featureSet.features=[];var c=b.featureSet.geometryType;d.set(c,a);a=b.layerDefinition.objectIdField;"esriGeometryPoint"===c?p(f,a,b.featureSet.features):"esriGeometryPolyline"===
c?p(k,a,b.featureSet.features):"esriGeometryPolygon"===c&&p(l,a,b.featureSet.features)});c.groundOverlays&&c.groundOverlays.forEach(function(b){m.set(b.id,b)});c.folders.forEach(function(b){b.networkLinkIds.forEach(function(a){var d=b.id;if(a=y(a,c.networkLinks))a.parentFolderId=d,a.networkLink=a;a&&e.push(a)})});e.forEach(function(b){b.featureInfos&&(b.points=g.clone(d.get("esriGeometryPoint")),b.polylines=g.clone(d.get("esriGeometryPolyline")),b.polygons=g.clone(d.get("esriGeometryPolygon")),b.mapImages=
[],b.featureInfos.map(function(a){switch(a.type){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":var c=n[a.type].get(a.id);c&&b[z[a.type]].featureSet.features.push(c);break;case "GroundOverlay":(a=m.get(a.id))&&b.mapImages.push(a)}}))});return{folders:c.folders,sublayers:e}};h.fetchService=function(c,e,d,f){return v(t.kmlServiceUrl,{query:{url:c,model:"simple",folders:"",refresh:0!==d?!0:void 0,outSR:JSON.stringify(e)},responseType:"json",signal:f})};h.sublayersFromJSON=
function(c,e,d,f){void 0===d&&(d=null);void 0===f&&(f=[]);var k=[],l={},m=e.sublayers,n=e.folders.map(function(b){return b.id});m.forEach(function(b){var a=new c;d?a.read(b,d):a.read(b);f.length&&-1<n.indexOf(a.id)&&(a.visible=-1!==f.indexOf(a.id));l[b.id]=a;null!=b.parentFolderId&&-1!==b.parentFolderId?(b=l[b.parentFolderId],b.sublayers||(b.sublayers=[]),b.sublayers.unshift(a)):k.unshift(a)});return k};h.getGraphics=function(c){return r(this,void 0,void 0,function(){var e,d,f,k,l,m,n,b,a,h;return q(this,
function(g){switch(g.label){case 0:e=x.fromJSON(c.featureSet),d=e.features,f=c.layerDefinition,k=w.fromJSON(f.drawingInfo.renderer),l=u.fromJSON(c.popupInfo),m=[],n=0,b=d,g.label=1;case 1:if(!(n<b.length))return[3,4];a=b[n];return[4,k.getSymbolAsync(a)];case 2:h=g.sent(),a.symbol=h,a.popupTemplate=l,a.visible=a.attributes.visibility?!0:!1,m.push(a),g.label=3;case 3:return n++,[3,1];case 4:return[2,m]}})})}});