// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/assignHelper ../geometry ../core/promiseUtils".split(" "),function(q,d,v,k,C,D,l){function w(){return k(this,void 0,void 0,function(){return v(this,function(b){m||(m=l.all([l.create(function(a){return q(["./arcadeUtils"],a)})]).then(function(a){a=a[0];return{arcade:a.arcade,arcadeUtils:a,Dictionary:a.Dictionary,Feature:a.arcadeFeature}}));return[2,m]})})}Object.defineProperty(d,"__esModule",
{value:!0});var m;d.loadArcade=w;d.createLabelExpression=function(b,a,e){return f.create(b,a,e,["$feature"])};d.createVVExpression=function(b,a,e){return f.create(b,a,e,["$feature","$view"])};d.createRendererExpression=function(b,a,e){return f.create(b,a,e,["$feature","$view"])};var f=function(){function b(a,b,d,f,l,g,c){this.evaluate=f;this._syntaxTree=d;this._arcade=a;this._arcadeDictionary=b;this._arcadeFeature=l;this._fields=g;this._spatialReference=c;this._referencesGeometry=a.scriptTouchesGeometry(this._syntaxTree);
this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"$view.scale")}b.create=function(a,d,f,m,q){return k(this,void 0,void 0,function(){var g,c,e,r,p,h,k,x,y,t,z,n,A,B;return v(this,function(u){switch(u.label){case 0:return[4,w()];case 1:return g=u.sent(),c=g.arcade,e=g.Feature,r=g.Dictionary,p=D.SpatialReference.fromJSON(d),h=c.parseScript(a,q),k=m.reduce(function(a,b){var c;return C({},a,(c={},c[b]=null,c))},{}),x=c.scriptUsesGeometryEngine(h)&&c.enableGeometrySupport(),y=c.scriptUsesFeatureSet(h)&&
c.enableFeatureSetSupport(),t=c.scriptIsAsync(h)&&c.enableAsyncSupport(),z={vars:k,spatialReference:p,useAsync:!!t},n=new r,n.immutable=!1,n.setField("scale",0),A=c.compileScript(h,z),B=function(a){"$view"in a&&a.$view&&(n.setField("scale",a.$view.scale),a.$view=n);return A({vars:a,spatialReference:p})},[4,l.all([x,y,t])];case 2:return u.sent(),[2,new b(c,r,h,B,new e,f,p)]}})})};b.prototype.repurposeFeature=function(a){a.geometry.spatialReference||(a.geometry.spatialReference=this._spatialReference);
this._arcadeFeature.repurposeFromGraphicLikeObject(a.geometry,a.attributes,{fields:this._fields});return this._arcadeFeature};b.prototype.createDictionary=function(){return new this._arcadeDictionary};b.prototype.referencesMember=function(a){return this._arcade.referencesMember(this._syntaxTree,a)};b.prototype.referencesFunction=function(a){return this._arcade.referencesFunction(this._syntaxTree,a)};b.prototype.referencesGeometry=function(){return this._referencesGeometry};b.prototype.referencesScale=
function(){return this._referencesScale};b.prototype.extractFieldLiterals=function(a){return this._arcade.extractFieldLiterals(this._syntaxTree,a)};return b}();d.default=f});