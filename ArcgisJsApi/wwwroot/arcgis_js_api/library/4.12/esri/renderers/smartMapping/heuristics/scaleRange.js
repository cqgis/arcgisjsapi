// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../geometry/support/scaleUtils ../statistics/spatialStatistics ../support/utils".split(" "),function(C,D,v,q,z,u,w,A,r){function B(e){return q(this,void 0,void 0,function(){var k,g,d,f,h;return v(this,function(l){switch(l.label){case 0:k=e.view;g=e.layer;d=e.sampleSize;if(!(e&&k&&g))throw new u("scale-range:missing-parameters","'view' and 'layer' parameters are required");
f=z({},e);h=[0,2,3,1];f.layer=r.createLayerAdapter(g,h);f.sampleSize=d||500;if(!f.layer)throw new u("scale-range:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(h).join(", "));return[4,k.when()];case 1:return l.sent(),[4,f.layer.load()];case 2:return l.sent(),[2,f]}})})}function x(e,k,g){void 0===g&&(g=!0);if(e.constraints&&"effectiveLODs"in e.constraints){var d=e.constraints.effectiveLODs;e=null;for(var f=0,d=g?d:d.slice(0).reverse();f<d.length;f++){var h=d[f];if(!(g?
h.scale>k:h.scale<k)){e=h;break}}return e}}return function(e){return q(this,void 0,void 0,function(){var k,g,d,f,h,l,q,p,r,y;return v(this,function(b){var a;switch(b.label){case 0:return[4,B(e)];case 1:return d=b.sent(),f=d.view,h=d.sampleSize,l=d.layer,[4,l.getSampleFeatures({view:f,sampleSize:h})];case 2:return q=b.sent(),[4,A({features:q,geometryType:l.geometryType})];case 3:p=b.sent();b=f;var c=null,n=null,m=a=null;switch(l.geometryType){case "point":a=p;c=a.avgMinDistance;n=12;a=a.minDistance;
m=320;break;case "multipoint":a=p;c=a.avgMinDistance;n=12;a=a.minDistance;m=320;break;case "polyline":a=p;c=a.avgLength;n=30;a=a.minLength;m=320;break;case "polygon":a=p,c=a.avgSize,n=15,a=a.minSize,m=640}a=0<a?a/m:null;c=w.getScaleForResolution(0<c?c/n:null,b.spatialReference);b=w.getScaleForResolution(a,b.spatialReference);k=c;g=b;r=k;y=g;b=r;var c=y,n=p,t=d.view;a=d.layer;d.snapToLOD&&(m=x(t,b),t=x(t,c,!1),b=m?m.scale:b,c=t?t.scale:c);if(b<c)throw new u("scale-range:invalid","calculated minScale is less than maxScale.");
c>b/2&&(c=Math.floor(c/2));1E8<b&&(b=0);"polygon"!==a.geometryType&&(c=0);return[2,{minScale:Math.ceil(b),maxScale:Math.floor(c),spatialStatistics:n}]}})})}});