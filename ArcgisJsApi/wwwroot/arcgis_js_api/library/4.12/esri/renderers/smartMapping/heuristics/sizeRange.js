// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/screenUtils ../../../geometry/support/scaleUtils ./scaleRange ../support/utils ../../visualVariables/SizeVariable".split(" "),function(x,y,h,l,q,g,m,r,t,k,n){function u(c){return l(this,void 0,void 0,function(){var d,a,b,e;return h(this,function(f){switch(f.label){case 0:d=c.view;a=c.layer;if(!(c&&d&&a))throw new g("size-range:missing-parameters",
"'view' and 'layer' parameters are required");b=q({},c);e=[0,2,3,1];b.layer=k.createLayerAdapter(a,e);if(!b.layer)throw new g("size-range:invalid-parameters","'layer' must be one of these types: "+k.getLayerTypeLabels(e).join(", "));return[4,d.when()];case 1:return f.sent(),[4,b.layer.load()];case 2:f.sent();if("polygon"!==b.layer.geometryType)throw new g("size-range:not-supported","sizeRange is not supported for geometryType: "+b.layer.geometryType);return[2,b]}})})}function v(c,d){var a=c.view,
b=c.layer,e=b.fullExtent;c=b.minScale||1128.497176;var b=b.maxScale||5.91657527591555E8,f=d.minScale||0;d=d.maxScale||0;a=e?r.getScale(a,e):0;a=a<c&&a>b?a:0;return{scales:[c,b,f,d,a].map(Math.round).sort(function(a,b){return a-b}).filter(function(a,b,c){return!!a&&c.indexOf(a)===b}).filter(function(a,b,c){return b?5<Math.abs(a-c[b-1]):!0}),fullExtentScale:a}}function w(c,d){var a=d.spatialStatistics,b=d.minScale;d=d.maxScale;if(!("avgSize"in a&&a.avgSize))throw new g("size-range:insufficient-info",
"average polygon size is invalid");var e=a.avgSize,a=c.view,f=a.resolution/a.scale;c=v(c,{minScale:b,maxScale:d});var h=c.scales,l=c.fullExtentScale,k=[],p=[];h.forEach(function(a,b){var c;c=Math.ceil(Math.ceil(e/(f*a))/4);4>c?c=4:16<c&&(c=16);var d=5*c,d=50>d?50:d,g=h.indexOf(l);b=-1<g&&b>g?2:1;k.push({value:a,size:m.px2pt(c/b)});p.push({value:a,size:m.px2pt(d/b)})});c=new n({valueExpression:"$view.scale",stops:k});b=new n({valueExpression:"$view.scale",stops:p});return{minSize:c,maxSize:b}}return function(c){return l(this,
void 0,void 0,function(){var d,a,b,e;return h(this,function(f){switch(f.label){case 0:return[4,u(c)];case 1:return d=f.sent(),a=d.view,b=d.layer,[4,t({layer:b,view:a})];case 2:return e=f.sent(),[2,w(d,e)]}})})}});