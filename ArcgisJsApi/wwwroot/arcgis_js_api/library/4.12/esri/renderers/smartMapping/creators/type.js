// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper dojo/i18n!../../nls/smartMapping ../.. ../../../pointCloudRenderers ../../../core/Error ../../../core/lang ../../../core/promiseUtils ./support/utils ../heuristics/outline ../statistics/uniqueValues ../support/utils ../symbology/type ../../support/LegendOptions ../../support/utils".split(" "),function(S,v,w,z,A,H,I,J,l,B,k,g,K,C,h,x,L,y){function M(b){return A(this,
void 0,void 0,function(){var a,c,d,e,f,m;return z(this,function(r){switch(r.label){case 0:if(!b||!b.layer||!b.field&&!b.valueExpression)throw new l("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(b.valueExpression&&!b.view)throw new l("type-renderer:missing-parameters","View is required when 'valueExpression' is specified");a=w({},b);a.symbolType=a.symbolType||"2d";a.numTypes=null==a.numTypes?10:a.numTypes;a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?
!0:a.defaultSymbolEnabled;a.sortBy=null==a.sortBy?"count":a.sortBy;a.sortEnabled=null==a.sortEnabled?!0:a.sortEnabled;a.statistics=B.clone(a.statistics);c=[0,2,1,3];d=h.createLayerAdapter(a.layer,c);a.layer=d;if(!d)throw new l("type-renderer:invalid-parameters","'layer' must be one of these types: "+h.getLayerTypeLabels(c).join(", "));return[4,d.load()];case 1:r.sent();e=d.geometryType;a.outlineOptimizationEnabled="polygon"===e?a.outlineOptimizationEnabled:!1;if("mesh"===e)a.symbolType="3d-volumetric",
a.colorMixMode=a.colorMixMode||"replace",a.edgesType=a.edgesType||"none";else{if("3d-volumetric-uniform"===a.symbolType&&"point"!==e)throw new l("type-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))throw new l("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");}f=h.getFieldsList({field:a.field,
valueExpression:a.valueExpression});if(m=g.verifyBasicFieldValidity(d,f,"type-renderer:invalid-parameters"))throw m;return[2,a]}})})}function N(b){if(!(b&&b.layer&&b.field))return k.reject(g.createError("type-point-cloud-class-renderer:missing-parameters","'layer' and 'field' parameters are required"));var a=w({},b);a.statistics=B.clone(a.statistics);b=[4];var c=h.createLayerAdapter(a.layer,b);a.layer=c;a.density=a.density||25;a.size=a.size||"100%";return g.isValidPointSize(a.size)?c?c.load().then(function(){var b=
h.getFieldsList({field:a.field});return(b=g.verifyBasicFieldValidity(c,b,"type-point-cloud-class-renderer:invalid-parameters"))?k.reject(b):a}):k.reject(g.createError("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+h.getLayerTypeLabels(b).join(", "))):k.reject(g.createError("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'"))}function D(b){var a=b.typeScheme,c=b.basemap;a?a=x.cloneScheme(a):
(a=(b=x.getSchemes({basemap:b.basemap,geometryType:b.geometryType,theme:b.theme,worldScale:b.worldScale,view:b.view}))&&b.primaryScheme,c=b&&b.basemapId);return{scheme:a,basemapId:c}}function E(b,a){return b.label<a.label?-1:b.label>a.label?1:0}function F(b,a){return b.value<a.value?-1:b.value>a.value?1:0}function O(b,a){var c=a.count-b.count;0===c&&(c=E(b,a));return c}function P(b,a){var c=a.count-b.count;0===c&&(c=F(b,a));return c}function G(b,a,c){var d;"count"===a?(d=P,c&&c.codedValues&&(d=O)):
"value"===a&&(d=F,c&&c.codedValues&&(d=E));d&&b.sort(d)}function Q(b,a,c){b=b.uniqueValueInfos;var d=a.layer,e=a.field,f=e?d.getField(e):null,m=f?d.getFieldDomain(f.name):null,r=-1===a.numTypes?b.length:a.numTypes,n=d.geometryType,d=D({basemap:a.basemap,geometryType:n,typeScheme:a.typeScheme,worldScale:-1<a.symbolType.indexOf("3d-volumetric"),view:a.view}),p=d.scheme,e=new I.UniqueValueRenderer({field:e}),k=-1,q,h={value:null,domain:m,fieldInfo:f};b.forEach(function(a,b){h.value=a.value;a.label=y.createUniqueValueLabel(h);
null===a.value&&(k=b)});-1<k&&(q=b.splice(k,1)[0]);!1!==a.sortEnabled&&G(b,a.sortBy,m);f&&"date"===f.type&&(f=b.filter(function(a,b){return b<r}).map(function(a){return a.value}),h.dateFormatInterval=y.calculateDateFormatInterval(f));var f=c&&c.opacity,l=g.createColors(p.colors,b.length),t=g.getSymbolSizeFromScheme(p,n),u=g.getSymbolOutlineFromScheme(p,n,f);b.forEach(function(b,c){h.value=b.value;b.label=y.createUniqueValueLabel(h);b.symbol=g.createSymbol(n,{type:a.symbolType,color:l[c],size:t,outline:u,
meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}})});a.valueExpression&&(e.valueExpression=a.valueExpression,e.valueExpressionTitle=a.valueExpressionTitle);a.legendOptions&&(e.legendOptions=new L.LegendOptions(a.legendOptions));l=g.createColors(p.colors,r);for(f=0;f<r;f++)(m=b[f])&&e.addUniqueValueInfo({value:m.value,label:m.label,symbol:g.createSymbol(n,{type:a.symbolType,color:l[f],size:t,outline:u,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}})});a.defaultSymbolEnabled&&
(e.defaultSymbol=g.createSymbol(n,{type:a.symbolType,color:p.noDataColor,size:t,outline:u,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}}),e.defaultLabel=H.other);q&&(q.symbol=g.createSymbol(n,{type:a.symbolType,color:p.noDataColor,size:t,outline:u,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}}),b.push(q));q=[];f=e.uniqueValueInfos.length===b.length?-1:e.uniqueValueInfos.length;if(-1<f)for(;f<b.length;f++)q.push(w({},b[f]));c&&c.visualVariables&&c.visualVariables.length&&
(e.visualVariables=c.visualVariables.map(function(a){return a.clone()}));return{renderer:e,uniqueValueInfos:b,excludedUniqueValueInfos:q,typeScheme:x.cloneScheme(p),basemapId:d.basemapId}}function R(b,a){b=b.uniqueValueInfos;a=(a=D({basemap:"gray",theme:"point-cloud-class",geometryType:"point",typeScheme:a}))&&a.scheme;var c="point-cloud-class"===a.theme,d=c?a.colors:g.createColors(a.colors,b.length);G(b,"value");return b.map(function(a,b){var f=a.value,e=null;c?(e=d[f])||(e=d[d.length-1]):e=d[b];
return{values:[f],color:e,label:a.label}})}Object.defineProperty(v,"__esModule",{value:!0});v.createRenderer=function(b){return A(this,void 0,void 0,function(){var a,c,d,e,f,g;return z(this,function(h){switch(h.label){case 0:return[4,M(b)];case 1:return a=h.sent(),c={layer:a.layer,field:a.field,valueExpression:a.valueExpression,returnAllCodedValues:a.returnAllCodedValues,view:a.view},d={layer:a.layer,view:a.view},[4,k.all([null!=a.statistics?a.statistics:C(c),a.outlineOptimizationEnabled?K(d):null])];
case 2:return e=h.sent(),f=e[0],g=e[1],[2,Q(f,a,g)]}})})};v.createPCClassRenderer=function(b){return N(b).then(function(a){return(null!=a.statistics?k.resolve(a.statistics):C({layer:a.layer,field:a.field})).then(function(b){return{renderer:new J.PointCloudUniqueValueRenderer({field:a.field,pointsPerInch:a.density,pointSizeAlgorithm:g.getPointSizeAlgorithm(a.size),colorUniqueValueInfos:R(b,a.typeScheme)})}})})}});