// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../support/adapters/support/utils ../../../../support/arcadeOnDemand".split(" "),function(M,N,I,t,J,K){return function(L,k,d){return t(this,void 0,void 0,function(){var l,u,e,f,a,v,m,D,n,b,p,t,E,q,w,r,x,F,y,z,A,G,B,C,g,H,c;return I(this,function(h){switch(h.label){case 0:u=l=0;e=Infinity;f=-Infinity;a=null;v=new Map;m=[];for(D in k)m.push(D);n=0;h.label=1;case 1:if(!(n<m.length))return[3,
5];b=m[n];return(p=k[b].valueExpression)?a?[3,3]:[4,K.loadArcade()]:[3,4];case 2:a=t=h.sent().arcadeUtils,h.label=3;case 3:v.set(b,a.createFunction(p)),h.label=4;case 4:return n++,[3,1];case 5:E=d&&a&&a.getViewInfo({viewingMode:"2d"===d.type?"map":d.viewingMode,scale:d.scale,spatialReference:d.spatialReference});q=0;for(w=L;q<w.length;q++)if(r=w[q],x=r.geometry,F=r.attributes,x&&(y=x.extent))if(z=y.width*y.height,0<z){A=0;G=a&&a.createExecContext(r,E);for(b in k)B=k[b],C=B.field,p=B.valueExpression,
g=null,C?g=F[C]:p&&(H=v.get(b),g=a.executeFunction(H,G)),J.isValidNumber(g)&&(A+=g||0);c=A/z;++l;u+=c;c<e&&(e=c);c>f&&(f=c)}return[2,{minDensity:Infinity!==e?e:null,maxDensity:-Infinity!==f?f:null,avgDensity:l?u/l:null}]}})})}});