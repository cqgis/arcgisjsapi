// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/Accessor ../../core/Collection ../../core/Logger ../../core/maybe ../../core/screenUtils ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../../geometry/support/webMercatorUtils ../../symbols/support/defaults ../../views/3d/support/projectionUtils ../draw/support/drawUtils ../../views/support/drapedUtils".split(" "),
function(h,m,c,p,q,r,t,g,k,d,u,v,w,n,x,y,z,A){Object.defineProperty(m,"__esModule",{value:!0});var B=t.getLogger("esri.views.interactive.GraphicManipulator");h=function(h){function a(b){b=h.call(this)||this;b.layer=null;b.interactive=!0;b.selectable=!1;b.dragging=!1;b._handlers=new r;b._circleCollisionCache=null;b._originalSymbol=null;return b}p(a,h);Object.defineProperty(a.prototype,"graphic",{get:function(){return this._get("graphic")},set:function(b){"mesh"===g.get(b.geometry,"type")?B.error("Mesh geometries are not supported"):
(this._circleCollisionCache=null,this._originalSymbol=b.symbol,this._set("graphic",b))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"focusedSymbol",{set:function(b){b!==this._get("focusedSymbol")&&(this._set("focusedSymbol",b),this._updateGraphicSymbol(),this._circleCollisionCache=null)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"grabbing",{set:function(b){if(b!==this._get("grabbing")){var a=this._focused;this._set("grabbing",b);this._updateGraphicSymbol(a)}},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hovering",{set:function(b){if(b!==this._get("hovering")){var a=this._focused;this._set("hovering",b);this._updateGraphicSymbol(a)}},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"selected",{set:function(b){b!==this._get("selected")&&(this._set("selected",b),this._updateGraphicSymbol())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},
enumerable:!0,configurable:!0});a.prototype.destroy=function(){this._resetGraphicSymbol();this._handlers.removeAll();this._handlers=null;this._set("view",null)};a.prototype.intersectionDistance=function(b){var a=this._get("graphic"),f=this._get("focusedSymbol"),f=g.isSome(f)?f:a.symbol,d=a.geometry;if(g.isNone(d))return null;var e=this._get("view");return"2d"===e.type?this._intersect2D(b,e,d,f):this._intersect3D(b,e,a)};a.prototype.attemptDragTo=function(b,a){if(g.isNone(this.graphic.geometry)||"mesh"===
this.graphic.geometry.type)return!1;var f=this.view.toMap(a.previous),d=this.view.toMap(b.screenPoint),e=b.screenPoint.x-a.previous.x;a=b.screenPoint.y-a.previous.y;var l=0,c=0;if(!f||!d)return!1;c=[0,0,0,0,0,0];y.bufferToBuffer([f.x,f.y,0,d.x,d.y,0],f.spatialReference,0,c,this.graphic.geometry.spatialReference,0,2);l=c[3]-c[0];c=c[4]-c[1];if(0===l&&0===c)return!0;this.graphic.geometry=z.move(this.graphic.geometry.clone(),l,c);var h={screenPoint:b.screenPoint,dxMap:l,dyMap:c,dx:e,dy:a};this._handlers.forEach(function(b){var a=
b.handler;"drag"===b.type&&a(h)});return!0};a.prototype.click=function(b){this._handlers.forEach(function(a){"click"===a.type&&a.handler(b)})};a.prototype.on=function(b,a){this._handlers.push({type:b,handler:a})};a.prototype.attach=function(){g.isNone(this.layer)||this.layer.add(this.graphic)};a.prototype.detach=function(){this._resetGraphicSymbol();g.isNone(this.layer)||this.layer.remove(this.graphic)};a.prototype._updateGraphicSymbol=function(b){void 0===b&&(b=this._focused);b!==this._focused&&
(b=this.graphic.symbol,b!==this._originalSymbol&&b!==this.focusedSymbol&&(this._originalSymbol=b));this.graphic.symbol=this._focused&&g.isSome(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol};a.prototype._resetGraphicSymbol=function(){this.graphic.symbol=this._originalSymbol};a.prototype._intersect2D=function(b,a,c,d){d=d||x.getDefaultSymbol2D(c);if(g.isNone(d))return null;var e=this._circleCollisionCache;if("point"!==c.type||"simple-marker"!==d.type)return e=A.intersectsDrapedGeometry(b,
c,a),g.isSome(e)?1:null;if(g.isNone(e)||!e.originalPoint.equals(c)){var f=a.spatialReference;n.canProject(c,f)&&(e=n.project(c,f),this._circleCollisionCache=e={originalPoint:c.clone(),mapPoint:e,radiusPx:k.pt2px(d.size)})}return g.isSome(e)?(b=k.screenPointObjectToArray(b,C),a=a.state.toScreen(D,e.mapPoint.x,e.mapPoint.y),e=e.radiusPx,u.vec2.squaredDistance(b,a)<e*e?1:null):null};a.prototype._intersect3D=function(b,a,c){b=a.toMap(b,{include:[c]});if(!b)return null;c=E;return a.renderCoordsHelper.toRenderCoords(b,
c)?v.vec3.distance(c,a.state.camera.eye):null};c([d.property({constructOnly:!0,nonNullable:!0})],a.prototype,"graphic",null);c([d.property({constructOnly:!0,nonNullable:!0})],a.prototype,"view",void 0);c([d.property({value:null})],a.prototype,"focusedSymbol",null);c([d.property({constructOnly:!0})],a.prototype,"layer",void 0);c([d.property()],a.prototype,"interactive",void 0);c([d.property()],a.prototype,"selectable",void 0);c([d.property({value:!1})],a.prototype,"grabbing",null);c([d.property()],
a.prototype,"dragging",void 0);c([d.property()],a.prototype,"hovering",null);c([d.property({value:!1})],a.prototype,"selected",null);return a=c([d.subclass("esri.views.interactive.GraphicManipulator")],a)}(d.declared(q));m.GraphicManipulator=h;var E=w.vec3f64.create(),C=k.createScreenPointArray(),D=k.createScreenPointArray()});