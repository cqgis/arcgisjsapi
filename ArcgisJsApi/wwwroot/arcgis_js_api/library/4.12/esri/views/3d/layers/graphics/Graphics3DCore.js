// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry ../../../../renderers ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/diffUtils ../../../../renderers/support/rendererConversion ../../../../support/arcadeUtils ../../../../symbols/support/symbolConversion ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphic ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./graphicUtils ./SpatialIndex2D ./symbolComplexity ../../support/projectionUtils ../../support/PropertiesPool ../../webgl-engine/Stage ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/Layer ../../../support/index".split(" "),
function(v,qa,T,k,w,x,O,C,D,U,t,V,y,W,E,X,u,m,Y,F,I,G,l,P,Q,Z,aa,z,J,ba,K,R,ca,H,da,ea,fa,ga,ha,ia,ja,ka,A,la,S,ma,na,oa){var B=new O.Point,L=P.vec3f64.create(),h=Q.create(),r=X.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");v=function(v){function c(a){a=v.call(this)||this;a.propertiesPool=new la.PropertiesPool({computedExtent:O.Extent},a);a.computedExtent=null;a.currentRenderer=null;a.rendererHasGeometryOperations=!1;a.symbolCreationContext=new fa.Graphics3DSymbolCreationContext;a.graphics3DGraphics=
new Map;a.stageLayer=null;a.stage=null;a.graphicsDrapedUids=new Set;a.graphicsBySymbol=new Map;a.symbolConversionCache=new Map;a.symbols=new Map;a.graphicsWithoutSymbol={};a.graphicsWaitingForSymbol=new Set;a.handles=new W;a.suspendSymbolCleanup=!1;a._spatialReference=null;a.elevationAlignment=null;a.scaleVisibility=null;a.filterVisibility=null;a._spatialIndex=null;a.featureStore=null;a.deconflictor=null;a.labeler=null;a.highlights=null;a.viewElevationProvider=null;a.sharedSymbolResourcesOwnerHandle=
null;a.whenGraphics3DGraphicRequests={};a.pendingUpdates=new Map;a.pendingAdds=0;a.pendingRemoves=0;a.pendingUpdatesPool=new F({allocator:function(a){return a||{add:null,remove:null}},deallocator:function(a){a.add=null;a.remove=null;return a}});a.symbolWarningLogged=!1;a.geometryWarningLogged=!1;a.objectIdInvisibleSet=new Set;a._whenSymbolRemoved=new F;a.asyncUpdates=!1;a.elevationFeatureExpressionEnabled=!0;a.owner=null;a.layer=null;a.hasDraped=!1;a.graphicSymbolSupported=!0;a.hasZ=null;a.hasM=null;
a._usedMemory=0;a.numberOfGraphics=0;a._visible=void 0;a._startCreateGraphics=!1;a.maxPendingUpdates=0;return a}T(c,v);M=c;Object.defineProperty(c.prototype,"spatialIndex",{get:function(){this._spatialIndex||(this._spatialIndex=new ja.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM}),p.clear(),this.graphics3DGraphics.forEach(function(a){p.push(a);return!1}),this._spatialIndex.addMany(p.data,p.length));return this._spatialIndex},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return!!(0<this.graphicsWaitingForSymbol.size||this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"displayFeatureLimit",{get:function(){var a=this.owner&&this.owner.view&&this.owner.view.qualitySettings,b=a?a.graphics3D.minTotalNumberOfFeatures:0,d=a?a.graphics3D.maxTotalNumberOfFeatures:0,a=a?a.graphics3D.maxTotalNumberOfPrimitives:0,e=this.maxSymbolComplexity,c=Math.max(b,Math.min(d,Math.ceil(a/Math.max(1,e?e.primitivesPerFeature:
1)))),f=this._get("displayFeatureLimit");return f&&f.minimumTotalNumberOfFeatures===b&&f.maximumTotalNumberOfFeatures===d&&f.maximumTotalNumberOfPrimitives===a&&f.maximumSymbolComplexity===e&&f.maximumNumberOfFeatures===c?f:{minimumTotalNumberOfFeatures:b,maximumTotalNumberOfFeatures:d,maximumTotalNumberOfPrimitives:a,maximumSymbolComplexity:e,maximumNumberOfFeatures:c}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"maxSymbolComplexity",{get:function(){for(var a=null,b=this.symbolComplexities,
d=this._get("maxSymbolComplexity"),e=!1,c=0;c<b.length;c++){var f=b[c];if(!a||0===a.primitivesPerCoordinate&&f.primitivesPerFeature>a.primitivesPerFeature||0!==a.primitivesPerCoordinate&&f.primitivesPerCoordinate>a.primitivesPerCoordinate)a=f;e=e||f.estimated}return!a||e&&d&&(d.primitivesPerFeature>=a.primitivesPerFeature||d.primitivesPerCoordinate>=a.primitivesPerCoordinate)||d&&d.primitivesPerFeature===a.primitivesPerFeature&&d.primitivesPerCoordinate===a.primitivesPerCoordinate?d:a},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"spatialReference",{get:function(){return this._spatialReference},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"usedMemory",{get:function(){return this._usedMemory},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature:
0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"symbolComplexities",{get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()},enumerable:!0,configurable:!0});c.prototype.getConvertedSymbol=function(a){if("web-style"===
a.type)return a.clone();var b=this.symbolConversionCache.get(a.id);if(void 0!==b)return b;var b=R.to3D(a,!0,!1,this.hasLabelingContext(a)),d=b.symbol||null;d||b.error&&r.error(b.error.message);this.symbolConversionCache.set(a.id,d);return d};c.prototype.getSymbolComplexitiesUsedOrRenderer=function(a){a=a.getSymbols();if(!a||!a.length)return[];for(var b=[],d=0;d<a.length;d++){var e=a[d],c=this.symbols.get(e.id);c?b.push(c.complexity):(e=this.getConvertedSymbol(e))&&b.push(ka.defaultSymbolComplexity(e))}return b};
c.prototype.getSymbolComplexitiesUsed=function(){var a=[];this.symbols.forEach(function(b){b&&a.push(b.complexity)});return a};c.prototype.initialize=function(){var a=this;this._spatialReference=this.owner.view.spatialReference;this._set("featureStore",new da.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:function(){return a.spatialIndex},forAllGraphics:function(b){return a.graphics3DGraphics.forEach(b)}}))};
c.prototype.setup=function(a){return x(this,void 0,void 0,function(){var b,d,e,c,f=this;return w(this,function(g){this._set("elevationAlignment",a.elevationAlignment);this._set("scaleVisibility",a.scaleVisibility);this._set("filterVisibility",a.filterVisibility);this._set("deconflictor",a.deconflictor);this._set("labeler",a.labeler);this._set("highlights",a.highlights);b=this.owner.view;this.viewElevationProvider=new ca.ViewElevationProvider(this._spatialReference,b);this.initializeStage(b,this.layer.uid);
this.symbolCreationContext.sharedResources=b.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=b.sharedSymbolResources.addGraphicsOwner(this.owner);this.symbolCreationContext.renderer=this.currentRenderer;this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=b.sharedSymbolResources.streamDataRequester;this.symbolCreationContext.renderSpatialReference=b.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=b.renderCoordsHelper;this.symbolCreationContext.layer=
this.layer;this.symbolCreationContext.layerView=this.owner;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=new ma;this.symbolCreationContext.elevationProvider=b.elevationProvider;d=H.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=H.createContext(d,this._spatialReference,r);this.symbolCreationContext.screenSizePerspectiveEnabled=b.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;
this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.handles.add(this.owner.watch("suspended",function(){return f.updateLayerVisibility()}));e="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled";this.handles.add([this.owner.watch(e,function(){var a=b.screenSizePerspectiveEnabled&&f.layer.screenSizePerspectiveEnabled;a!==f.symbolCreationContext.screenSizePerspectiveEnabled&&(f.symbolCreationContext.screenSizePerspectiveEnabled=
a,f.recreateAllGraphics())}),G.init(this,"asyncUpdates",function(a){return f.modeChange(a)},!0),this.owner.watch("slicePlaneEnabled",function(a){return f.slicePlaneEnabledChange(!!a)}),this.owner.view.watch("pixelRatio",function(a){return f.pixelRatioChange(a)}),G.when(b.basemapTerrain,"tilingScheme",function(a){a.spatialReference.equals(f.symbolCreationContext.overlaySR)||(f.symbolCreationContext.overlaySR=b.basemapTerrain.spatialReference);f.handles.has("loaded-graphics")?f.recreateAllGraphics():
f.handles.add(G.on(f.owner,"loadedGraphics","change",function(a){return f.graphicsCollectionChanged(a)},function(){return f.recreateAllGraphics()}),"loaded-graphics")}),b.resourceController.scheduler.registerTask(3,function(a){return f.update(a)},function(){return f.needsUpdate()})]);this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",function(){return f.deconflictor.featureReductionChange()}));c=this.rendererChange(this.layer.renderer);
this.notifyChange("maxSymbolComplexity");return[2,c]})})};c.prototype.destroy=function(){this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this.clear();this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(S.ModelContentType.LAYER,this.stageLayer.id),this.stage=this.stageLayer=null);this.handles.destroy();this._spatialReference=this.handles=null;this._set("owner",null);for(var a in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[a].reject(new y("graphic:layer-destroyed",
"Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null);this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear();this._spatialIndex&&(this._spatialIndex.destroy(),this._spatialIndex=null);this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",
null))};c.prototype.clear=function(){this.graphics3DGraphics.forEach(function(a){return a.destroy()});this._spatialIndex&&this._spatialIndex.clear();this.graphics3DGraphics.clear();this._usedMemory=this.numberOfGraphics=0;this.updateLayerVisibility();this.symbols.forEach(function(a){a&&a.destroy()});this.symbols.clear();this.graphicsBySymbol.clear();this.graphicsWithoutSymbol={};this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=this.pendingAdds=
this.maxPendingUpdates=0;this._set("hasDraped",!1);this.notifyChange("updating");this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.featureStore.events.emit("changed")};c.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new na(b,{isPickable:!this.owner.suspended},b);this.stage.add(S.ModelContentType.LAYER,this.stageLayer);this.stage.addToViewContent([this.stageLayer.id])};c.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=
a;var b=new Set;this.symbols.forEach(function(d){d&&d.setDrawOrder(a,b)});0<b.size&&this.stage.renderView.getDrapedRenderer().updateRenderOrder(b)};c.prototype.updateLayerVisibility=function(){var a=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*pa,a=!this.owner.suspended&&!a;a!==this._visible&&((this._visible=a)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())};c.prototype.updateStageLayerVisibility=
function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};c.prototype.getGraphics3DGraphicById=function(a){return this.graphics3DGraphics.get(a)};c.prototype._getGraphicObjectID=function(a,b){void 0===b&&(b=this.owner.layer&&this.owner.layer.objectIdField);return z.getObjectId(a,b)};Object.defineProperty(c.prototype,"graphics3DGraphicsByObjectID",{get:function(){var a=this,b=this.owner.layer&&this.owner.layer.objectIdField;if(!b)return null;var d=new Map;
this.graphics3DGraphics.forEach(function(e){if(e){var c=a._getGraphicObjectID(e.graphic,b);m.isSome(c)&&d.set(c,e)}});return d},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"labelsEnabled",{get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())},enumerable:!0,configurable:!0});c.prototype.updateLabelingInfo=function(a){return x(this,void 0,void 0,function(){var b,d;return w(this,function(c){switch(c.label){case 0:return b=this.deconflictor&&this.deconflictor.labelingInfoChange(a),
d=this.labeler&&this.labeler.labelingInfoChange(a),[4,I.eachAlways([b,d])];case 1:return c.sent(),[2]}})})};c.prototype.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange();this.labeler&&this.labeler.visibilityInfoChange()};Object.defineProperty(c.prototype,"symbolUpdateType",{get:function(){var a=this;if(0<this.pendingUpdates.size)return"unknown";var b=0,d=0;return E.everyMap(this.symbols,function(c,g){if(c){c=c.getFastUpdateStatus();if(0<c.loading)return!1;a.graphicsBySymbol.has(g)&&
(d+=c.fast,b+=c.slow)}})?0<=d&&0===b?"fast":0<=b&&0===d?"slow":"mixed":"unknown"},enumerable:!0,configurable:!0});c.prototype.needsUpdate=function(){return 0<this.pendingUpdates.size};c.prototype.update=function(a){this._applyPendingUpdates(a);this.needsUpdate()||this.notifyChange("updating")};c.prototype.setObjectIdVisibility=function(a,b){b?this.objectIdInvisibleSet.delete(a):this.objectIdInvisibleSet.add(a);a=this._findGraphics3DGraphicByObjectId(a);m.isSome(a)&&this._updateUserVisibility(a)};
c.prototype._findGraphics3DGraphicByObjectId=function(a){var b=this,d;E.everyMap(this.graphics3DGraphics,function(c){return b._getGraphicObjectID(c.graphic)===a?(d=c,!1):!0});return d};c.prototype._updateUserVisibility=function(a){if(m.isNone(a))return!1;var b=a.graphic,d=this._getGraphicObjectID(b),b=b.visible&&!this.owner.suspended&&(m.isNone(d)||!this.objectIdInvisibleSet.has(d));return a.setVisibilityFlag(0,b,0)};c.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics3DGraphics.get(a.uid);
if(b)return I.resolve(b);if(b=this.whenGraphics3DGraphicRequests[a.uid])return b.promise;b=I.createDeferred();this.whenGraphics3DGraphicRequests[a.uid]=b;return b.promise};c.prototype.boundsForGraphics3DGraphic=function(a,b){return x(this,void 0,void 0,function(){var d,c,g,f,q,h,l,k,p,n;return w(this,function(e){switch(e.label){case 0:return d=this._spatialReference,c=this.owner.view.renderSpatialReference,g=this.owner.view.basemapTerrain.spatialReference,f=function(a,b,e){return A.bufferToBuffer(a,
c,b,a,d,b,e)},q=function(a,b,c){return A.bufferToBuffer(a,g,b,a,d,b,c)},h=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:m.isSome(b)&&b.useViewElevation,minDemResolution:m.isSome(b)&&b.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,a.getProjectedBoundingBox(f,q,h,m.get(b,"signal"))];case 1:l=e.sent();if(!l)return[2,null];k=l.boundingBox;l.requiresDrapedElevation&&(p=this.symbolCreationContext.elevationProvider)&&(Q.center(k,L),B.x=L[0],
B.y=L[1],B.z=void 0,B.spatialReference=d,n=p.getElevation(B)||0,k[2]=Math.min(k[2],n),k[5]=Math.max(k[5],n));return[2,{boundingBox:k,screenSpaceObjects:l.screenSpaceObjects}]}})})};c.prototype.whenGraphicBounds=function(a,b){var d=this;return G.whenOnce(this.owner,"loadedGraphics").then(function(){var b=d.owner.layer&&d.owner.layer.objectIdField,c=d.owner.loadedGraphics.find(function(d){return d===a?!0:b&&d.attributes&&a.attributes&&d.attributes[b]===a.attributes[b]});if(c)return d.whenGraphics3DGraphic(c);
throw new y("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return d.boundsForGraphics3DGraphic(a,b)})};c.prototype.whenSymbolLayerSize=function(a,b){return x(this,void 0,void 0,function(){var d,c,g;return w(this,function(e){switch(e.label){case 0:d=this.symbols.get(a.id);if(null==d)throw new y("internal:symbol-not-part-of-view","Symbol is not part of this view");c=a.symbolLayers.indexOf(b);if(-1===c)throw new y("internal:missing-symbol-layer","Symbol layer is not in symbol");
return[4,d.whenSymbolLayerSize(c)];case 1:g=e.sent();if(null==g)throw new y("internal:missing-size","Symbol layer has no valid size");return[2,g]}})})};c.prototype.graphicsCollectionChanged=function(a){this._startCreateGraphics&&(this.add(a.added),this.remove(a.removed))};c.prototype.graphicUpdateHandler=function(a){var b=a.graphic.uid,d=this.graphics3DGraphics.get(b),b=this.graphicsWithoutSymbol[b];if(d||b)switch(a.property){case "visible":this.graphicUpdateVisibleHandler(d,a);break;case "geometry":this.graphicUpdateGeometryHandler(d,
a);break;case "symbol":this.graphicUpdateSymbolHandler(d,a);break;case "attributes":break;default:V.neverReached(a)}};c.prototype.graphicUpdateGeometryHandler=function(a,b){var d=b.graphic.geometry;if(m.isNone(d))this.recreateGraphic(b.graphic);else if(m.isNone(a)){if((a=b.graphic.symbol&&b.graphic.symbol.id)&&(a=this.symbols.get(a))&&0===a.loadStatus)return;this.recreateGraphic(b.graphic)}else a.graphics3DSymbol.updateGeometry(a,b.newValue)||this.recreateGraphic(a.graphic),this.expandComputedExtent(d)};
c.prototype.graphicUpdateSymbolHandler=function(a,b){var d=b.graphic,c=m.isSome(a)?a.graphics3DSymbol:b.oldValue&&this.symbols.get(b.oldValue.id);if(c){var g=c.symbol;b=this.getConvertedSymbol(b.newValue);if(b.type!==g.type||"web-style"===b.type||"web-style"===g.type)this.recreateGraphic(d);else{var f=this.graphicsBySymbol.get(g.id);if(f&&1!==f.size)this.recreateGraphic(d);else if(f=J.diff(g,b),m.isNone(f))this.updateSymbolMapping(g.id,b);else if(f={diff:f,graphics3DGraphicPatches:[],symbolStatePatches:[]},
c.prepareSymbolPatch(f),J.isEmpty(f.diff)){for(var q=0,h=f.symbolStatePatches;q<h.length;q++)c=h[q],c();d=this._getRenderingInfo(d);if(m.isSome(a))for(q=0,f=f.graphics3DGraphicPatches;q<f.length;q++)c=f[q],c(a,d);this.updateSymbolMapping(g.id,b)}else this.recreateGraphic(d)}}else this.recreateGraphic(d)};c.prototype.graphicUpdateVisibleHandler=function(a,b){(a=this._updateUserVisibility(a))&&this.labeler&&this.owner.view.labeler.setDirty();a&&this.owner.view.deconflictor.setDirty()};c.prototype.recreateGraphic=
function(a){a=[a];this.suspendSymbolCleanup=!0;this.remove(a);this.add(a);this.suspendSymbolCleanup=!1;this.asyncUpdates||this._cleanupSymbols()};c.prototype._beginGraphicUpdate=function(a){this.graphicsWaitingForSymbol.add(a.uid);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)};c.prototype._endGraphicUpdate=function(a){a&&(this.graphicsWaitingForSymbol.delete(a.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),
this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))};c.prototype.expandComputedExtent=function(a){var b=a.spatialReference;z.computeAABB(a,h);a=this._spatialReference;var d=M.tmpVec;!b.equals(a)&&A.xyzToVector(h[0],h[1],0,b,d,a)&&(h[0]=d[0],h[1]=d[1],A.xyzToVector(h[3],h[4],0,b,d,a),h[3]=d[0],h[4]=d[1]);if(u.isFinite(h[0])&&u.isFinite(h[3])&&u.isFinite(h[1])&&u.isFinite(h[4])){var b=this.computedExtent,d=null,
c=u.isFinite(h[2])&&u.isFinite(h[5]),g=c&&(!b||null==b.zmin||h[2]<b.zmin),c=c&&(!b||null==b.zmax||h[5]>b.zmax);if(b){if(h[0]<b.xmin||h[1]<b.ymin||h[3]>b.xmax||h[4]>b.ymax||g||c)d=this.propertiesPool.get("computedExtent"),d.xmin=Math.min(h[0],b.xmin),d.ymin=Math.min(h[1],b.ymin),d.xmax=Math.max(h[3],b.xmax),d.ymax=Math.max(h[4],b.ymax),d.spatialReference=a}else d=this.propertiesPool.get("computedExtent"),d.xmin=h[0],d.ymin=h[1],d.xmax=h[3],d.ymax=h[4],d.spatialReference=a;d&&(g&&(d.zmin=h[2]),c&&(d.zmax=
h[5]),this._set("computedExtent",d))}};c.prototype.updateHasDraped=function(){this._set("hasDraped",0<this.graphicsDrapedUids.size)};c.prototype.elevationInfoChange=function(){var a=this,b=H.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=H.createContext(b,this._spatialReference,r);this.labeler&&this.labeler.elevationInfoChange();this.forEachGraphics3DSymbol(function(b,c,g){b.globalPropertyChanged("elevationInfo",
c)?c.forEach(function(a){var b=a.graphic;a=a._labelGraphics;for(var d=0;d<a.length;d++){var c=a[d];c.graphics3DSymbolLayer.updateGraphicElevationContext(b,c)}}):a._recreateSymbol(g)});this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()};c.prototype.clearSymbolsAndGraphics=function(){this.clear();this.filterVisibility&&this.filterVisibility.clear();this.labeler&&this.labeler.reset();this.deconflictor&&this.deconflictor.clear();this.elevationAlignment&&this.elevationAlignment.clear();
this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()};c.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};c.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,
this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};c.prototype._recreateSymbol=function(a){var b=this,d=[];this.graphicsBySymbol.get(a).forEach(function(a,c){var e=a.usedMemory;b._conditionalRemove(a,c);b._spatialIndex&&b._spatialIndex.remove(a);d.push(a.graphic);a.destroy();b.removeGraphics3DGraphic(c,e);b.updateLayerVisibility();b.featureStore.events.emit("changed")});this.graphicsBySymbol.set(a,
new Map);var c=this.symbols.get(a);c&&c.destroy();this.symbols.delete(a);this.updateHasDraped();this.add(d)};c.prototype._conditionalRemove=function(a,b){a.isDraped()&&this.graphicsDrapedUids.delete(b);this.highlights&&this.highlights.removeGraphic(a);this.labeler&&this.labeler.removeGraphic(a);this.deconflictor&&this.deconflictor.removeGraphic(a)};c.prototype.add=function(a){a&&0!==a.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this.asyncUpdates?this._addDelayed(a):
this._addImmediate(a),this.notifyChange("updating")):r.error("#add()","Cannot add graphics before terrain surface has been initialized"))};c.prototype._addImmediate=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;n.clear();for(var d=0;d<a.length;d++)this._startAddGraphic(a[d],n);n.forEach(function(a){return b._finishAddGraphics(a)});n.clear();this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty();this._cleanupSymbols()};c.prototype._addDelayed=
function(a){for(var b=0;b<a.length;b++){var d=a[b],c=d.uid,g=this.pendingUpdates.get(c);g?(g.add||this.pendingAdds++,g.add=d):(g=this.pendingUpdatesPool.pushNew(),g.add=d,this.pendingAdds++,this.pendingUpdates.set(c,g))}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};c.prototype.remove=function(a){this.asyncUpdates?this._removeDelayed(a):this._removeImmediate(a);this.notifyChange("updating")};
c.prototype._removeImmediate=function(a){for(var b=0;b<a.length;b++)this._removeGraphic(a[b]);this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty()};c.prototype._removeDelayed=function(a){for(var b=0;b<a.length;b++){var d=a[b],c=d.uid,g=this.pendingUpdates.get(c);g?g.add&&(g.remove?g.add=null:this.pendingUpdates.delete(c),this.pendingAdds--):(g=this.pendingUpdatesPool.pushNew(),g.remove=d,this.pendingUpdates.set(c,g),this.pendingRemoves++)}0===this.pendingUpdates.size&&
this._finishPendingUpdates();this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};c.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();this.maxPendingUpdates=0;this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&r.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};c.prototype._applyPendingUpdates=function(a){var b=this;this.symbolWarningLogged=
this.geometryWarningLogged=!1;var c=a.idleFrame?1E3:100,e=0;n.clear();E.everyMap(this.pendingUpdates,function(d,f){d.remove&&(b.pendingRemoves--,b._removeGraphic(d.remove));d.add&&(b.pendingAdds--,b._startAddGraphic(d.add,n)&&e++);b.pendingUpdates.delete(f);e>c&&(n.forEach(function(a){return b._finishAddGraphics(a)}),n.clear(),e=0);a.madeProgress();if(a.done)return!1});n.forEach(function(a){return b._finishAddGraphics(a)});n.clear();0===this.pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("updatingTotal");
this.notifyChange("updatingRemaining");this.updateHasDraped()};c.prototype._startAddGraphic=function(a,b){this.graphicsWithoutSymbol[a.uid]=a;var c=this._getRenderingInfo(a,r);if(!c||m.isNone(c.symbol)||!z.hasGeometry(a))return!1;var e=this.getOrCreateGraphics3DSymbol(c.symbol,c.renderer);if(!e)return!1;this.expandComputedExtent(a.geometry);this._beginGraphicUpdate(a);a={graphic:a,renderingInfo:c,layer:this.layer};var c=e.symbol.id,g=b.get(c);g?g.graphics.push(a):(g=N.acquire(),g.clear(),g.push(a),
b.set(c,{asyncSymbol:e,graphics:g}));return!0};c.prototype._finishAddGraphics=function(a){var b=this,c=!1,e=function(b){b===a.asyncSymbol.symbol.id&&(c=!0)};this._whenSymbolRemoved.push(e);a.asyncSymbol.load().then(function(){b._whenSymbolRemoved.removeUnordered(e);p.clear();for(var d=0;d<a.graphics.length;d++){var f=a.graphics.data[d],h=f.graphic;c||a.asyncSymbol.destroyed||b.graphicSymbolSupported&&h.symbol&&h.symbol.id!==a.asyncSymbol.symbol.id||(b.graphicsWaitingForSymbol.has(h.uid)&&(f=b.createGraphics3DGraphic(a.asyncSymbol,
f),b._spatialIndex&&f&&p.push(f)),b._endGraphicUpdate(h));--a.asyncSymbol.referenced}0<p.length&&(b._spatialIndex.addMany(p.data,p.length),p.clear());b.featureStore.events.emit("changed");a.graphics.clear();N.release(a.graphics);b.labeler&&b.owner.view.labeler.setDirty()},function(){b._whenSymbolRemoved.removeUnordered(e);if(!c&&!a.asyncSymbol.destroyed)for(var d=0;d<a.graphics.length;d++)b._endGraphicUpdate(a.graphics.data[d].graphic);a.graphics.clear();N.release(a.graphics)})};c.prototype._removeGraphic=
function(a){a=a.uid;var b=this.graphics3DGraphics.get(a);if(b){var c=b.usedMemory;this._conditionalRemove(b,a);this._spatialIndex&&this._spatialIndex.remove(b);this.graphicsBySymbol.get(b.graphics3DSymbol.symbol.id).delete(a);delete this.graphicsWithoutSymbol[a];this.removeGraphics3DGraphic(a,c);b.destroy();this.featureStore.events.emit("changed")}else delete this.graphicsWithoutSymbol[a],this.graphicsWaitingForSymbol.delete(a)};c.prototype.hasLabelingContext=function(a){if(a instanceof D.LabelSymbol3D||
a instanceof D.TextSymbol){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};c.prototype.hasValidSymbolCreationContext=function(a){return a instanceof D.LabelSymbol3D&&!this.hasLabelingContext(a)?(r.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};c.prototype._getRenderingInfo=function(a,b){if(m.isNone(a.geometry))return b&&!this.geometryWarningLogged&&
(this.geometryWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&m.isSome(a.symbol))return b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;a=this.rendererHasGeometryOperations?z.hydrateGraphic(a,this.layer):a;a=this.owner.getRenderingInfo(a,this.currentRenderer);return!a||m.isNone(a.symbol)?(b&&!this.symbolWarningLogged&&
(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null):a};c.prototype.createGraphics3DSymbol=function(a,b){var c=this;if(!this.hasValidSymbolCreationContext(a))return null;a=this.getConvertedSymbol(a);if(!a)return null;var e;b&&"backgroundFillSymbol"in b&&b.backgroundFillSymbol&&(b=R.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&"web-style"!==b.symbol.type&&(e=b.symbol.symbolLayers));e=ga.make(a,this.symbolCreationContext,e);e.load().then(function(){return c.notifyChange("maxSymbolComplexity")});
return e};c.prototype.getOrCreateGraphics3DSymbol=function(a,b){var c=this,e=this.symbols.get(a.id);void 0===e&&(e=a instanceof D.WebStyleSymbol?new ha(a,function(a){return c.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols.set(a.id,e));e&&++e.referenced;return e};c.prototype.addGraphics3DGraphic=function(a){this._usedMemory+=a.usedMemory;this.graphics3DGraphics.set(a.graphic.uid,a);this.numberOfGraphics++;this.updateLayerVisibility()};c.prototype.removeGraphics3DGraphic=
function(a,b){this._usedMemory-=b;this.graphics3DGraphics.delete(a);this.numberOfGraphics--;this.updateLayerVisibility()};c.prototype.createGraphics3DGraphic=function(a,b){var c=b.graphic;delete this.graphicsWithoutSymbol[c.uid];if(!this.symbols.has(a.symbol.id))this.add([c]);else if(!this.graphics3DGraphics.has(c.uid)){b=a.createGraphics3DGraphic(b);a=a.symbol.id;this.addGraphics3DGraphic(b);this.graphicsBySymbol.has(a)||this.graphicsBySymbol.set(a,new Map);this.graphicsBySymbol.get(a).set(c.uid,
b);b.initialize(this.stageLayer,this.stage);b.isDraped()&&(this.graphicsDrapedUids.add(c.uid),this._set("hasDraped",!0));b.centroid=null;m.isSome(c.geometry)&&"point"!==c.geometry.type&&b instanceof ea&&(b.centroid=ia.computeCentroid(c.geometry,this._spatialReference));this._updateUserVisibility(b);this.deconflictor&&this.deconflictor.addGraphic(b);this.labeler&&this.labeler.addGraphic(b);this.scaleVisibility&&this.scaleVisibility.updateVisibility(b);this.filterVisibility&&this.filterVisibility.updateVisibility(b);
this.highlights&&this.highlights.addGraphic(b);this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,b);if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],a.resolve(b);return b}};c.prototype.rendererChange=function(a){return x(this,void 0,void 0,function(){return w(this,function(b){switch(b.label){case 0:if(a===this.currentRenderer)return[2];this.validateRenderer(a);return K.hasGeometryOperations(a)?[4,K.enableGeometryOperations()]:[3,2];case 1:return b.sent(),
this.layer.renderer===a&&this.currentRendererChange(a,!0),[3,3];case 2:this.currentRendererChange(a,!1),b.label=3;case 3:return[2]}})})};c.prototype.currentRendererChange=function(a,b){this.currentRenderer=a;this.rendererHasGeometryOperations=b;b=this.symbolCreationContext.renderer;if(a!==b){this.symbolConversionCache.clear();var c=J.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;m.isNone(c)||("complete"===c.type?this.recreateAllGraphics():"partial"===c.type&&
(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}};c.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};c.prototype.applySymbolSetDiff=function(a,b,c,e){var d=this;a=a||[];b=b||[];var f=[];e=function(b){var e=h.graphicsBySymbol.get(b.id);
e&&e.forEach(function(g,h){var k=g.graphic,l=d.layer instanceof aa?d.layer:null;if(b!==c.defaultSymbol||c.getSymbol(z.hydrateGraphic(k,l),{arcadeUtils:K})!==c.defaultSymbol)l=g.usedMemory,a.length||c.defaultSymbol?f.push(k):d.graphicsWithoutSymbol[h]=k,k=d.graphics3DGraphics.get(h),d._conditionalRemove(k,h),g.destroy(),e.delete(h),d.removeGraphics3DGraphic(h,l),d.updateLayerVisibility()});h._whenSymbolRemoved.forEach(function(a){return a(b.id)})};for(var h=this,k=0;k<b.length;k++)e(b[k]);if(a.length||
f.length){for(var l in this.graphicsWithoutSymbol)f.push(this.graphicsWithoutSymbol[l]);this.graphicsWithoutSymbol={};this.add(f)}this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty()};c.prototype.applyUniqueValueRendererDiff=function(a,b,c){var d=a.diff.defaultSymbol,g=a.diff.uniqueValueInfos;if(d||g){var f=g?g.added.map(function(a){return a.symbol}):[],h=g?g.removed.map(function(a){return a.symbol}):[];if(g)for(var k=0;k<g.changed.length;k++)f.push(g.changed[k].newValue.symbol),
h.push(g.changed[k].oldValue.symbol);d?(c.defaultSymbol&&h.push(c.defaultSymbol),b.defaultSymbol&&f.push(b.defaultSymbol)):c.defaultSymbol&&f.length&&h.push(b.defaultSymbol);this.applySymbolSetDiff(f,h,b,c);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};c.prototype.calculateUnchangedSymbolMapping=function(a,b,c){var d=function(a){return m.isSome(a)?a.id:null};if(b instanceof C.UniqueValueRenderer&&c instanceof C.UniqueValueRenderer&&(m.isNone(a)||"partial"===a.type)){var g=
a&&a.diff;a=g&&g.defaultSymbol;var g=g&&g.uniqueValueInfos,f=void 0,f=g?g.unchanged.map(function(a){return{oldId:d(a.oldValue.symbol),newId:d(a.newValue.symbol)}}):c.uniqueValueInfos.map(function(a,c){return{oldId:d(a.symbol),newId:d(b.uniqueValueInfos[c].symbol)}});!a&&c.defaultSymbol&&f.push({oldId:d(c.defaultSymbol),newId:d(b.defaultSymbol)});return f}return[]};c.prototype.updateSymbolMapping=function(a,b){var c=b?"string"===typeof b?b:b.id:null;b="string"===typeof b?null:b;if(a&&a!==c){var e=
this.graphicsBySymbol.get(a);this.graphicsBySymbol.delete(a);void 0!==e&&this.graphicsBySymbol.set(c,e);e=this.symbols.get(a);this.symbols.delete(a);void 0!==e&&(this.symbols.set(c,e),b?e.symbol=b:e.symbol.id=c)}};c.prototype.updateUnchangedSymbolMappings=function(a,b,c){var d=0;for(a=this.calculateUnchangedSymbolMapping(a,b,c);d<a.length;d++)b=a[d],this.updateSymbolMapping(b.oldId,b.newId)};c.prototype.applyRendererDiff=function(a,b,c){var d=this;return this.diffHasSymbolChange(a)?!1:b instanceof
C.UniqueValueRenderer&&c instanceof C.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(a,b,c)&&0===Object.keys(a.diff).length?!0:E.everyMap(this.graphicsBySymbol,function(c,e){if((c=d.symbols.get(e))&&!c.applyRendererDiff(a,b))return!1})};c.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(a){return a.globalPropertyChanged("opacity")});this.updateStageLayerVisibility()};c.prototype.modeChange=function(a){(this.symbolCreationContext.isAsync=a)||this.update(oa.noBudget)};
c.prototype.slicePlaneEnabledChange=function(a){a!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=a,this.stageLayer.isSliceable=a,this.forEachGraphics3DSymbol(function(a,c){return a.globalPropertyChanged("slicePlaneEnabled",c)}),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())};c.prototype.pixelRatioChange=function(a){var b=this;this.forEachGraphics3DSymbol(function(a,c,g){a.globalPropertyChanged("pixelRatio",
c)||b._recreateSymbol(g)})};c.prototype.setClippingExtent=function(a,b){var c=this.symbolCreationContext.clippingExtent,e=Z.create();A.extentToBoundingRect(a,e,b)?this.symbolCreationContext.clippingExtent=[e[0],e[1],-Infinity,e[2],e[3],Infinity]:this.symbolCreationContext.clippingExtent=null;return!t.equals(this.symbolCreationContext.clippingExtent,c)};c.prototype.notifyVisibilityChanged=function(){this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};c.prototype.modifyGraphics3DGraphicVisibilities=
function(a){var b=!1;this.graphics3DGraphics.forEach(function(c){a(c)&&(b=!0)});b&&this.notifyVisibilityChanged()};c.prototype.forEachGraphics3DSymbol=function(a){var b=this;this.graphicsBySymbol.forEach(function(c,e){var d=b.symbols.get(e);d&&a(d,c,e)})};c.prototype.updateAllGraphicsVisibility=function(){var a=this;this.filterVisibility&&(this.filterVisibility.dirty=!0);this.modifyGraphics3DGraphicVisibilities(function(b){var c=a._updateUserVisibility(b);b=a.scaleVisibility&&a.scaleVisibility.updateVisibility(b);
return c||b})};c.prototype.hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(function(a){return a.setVisibilityFlag(0,!1,0)})};c.prototype.validateRenderer=function(a){(a=ba.validateTo3D(a))&&r.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};c.prototype.volatileGraphicsUpdated=function(){this.labeler&&this.labeler.reset();this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();
this.notifyChange("updating")};c.prototype._cleanupSymbols=function(){var a=this;if(!(0<this.graphicsWaitingForSymbol.size||this.suspendSymbolCleanup)){var b=!1;this.symbols.forEach(function(c,e){if(c&&!(0<c.referenced)){var d=a.graphicsBySymbol.get(e);d&&0!==d.size||(a.graphicsBySymbol.delete(e),a.symbols.delete(e),c&&c.destroy(),b=!0)}});b&&this.notifyChange("maxSymbolComplexity")}};c.prototype.snapshotInternals=function(){var a=this;return{graphics:t.keysOfMap(this.graphics3DGraphics).sort(),symbols:t.keysOfMap(this.symbols).sort(),
graphicsBySymbol:t.keysOfMap(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,graphics:t.keysOfMap(a.graphicsBySymbol.get(b)).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:t.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}};Object.defineProperty(c.prototype,"test",{get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size}},enumerable:!0,configurable:!0});
c.prototype.getStats=function(){return{"core.visible":this.graphics3DGraphics.size,"core.missing":Object.keys(this.graphicsWithoutSymbol).length,"core.pending":this.pendingUpdates.size}};var M;c.tmpVec=P.vec3f64.create();k([l.property({readOnly:!0})],c.prototype,"computedExtent",void 0);k([l.property()],c.prototype,"currentRenderer",void 0);k([l.property()],c.prototype,"rendererHasGeometryOperations",void 0);k([l.property({readOnly:!0})],c.prototype,"elevationAlignment",void 0);k([l.property({readOnly:!0})],
c.prototype,"scaleVisibility",void 0);k([l.property({readOnly:!0})],c.prototype,"filterVisibility",void 0);k([l.property({readOnly:!0})],c.prototype,"featureStore",void 0);k([l.property({readOnly:!0})],c.prototype,"deconflictor",void 0);k([l.property({readOnly:!0})],c.prototype,"labeler",void 0);k([l.property({readOnly:!0})],c.prototype,"highlights",void 0);k([l.property()],c.prototype,"asyncUpdates",void 0);k([l.property({constructOnly:!0})],c.prototype,"elevationFeatureExpressionEnabled",void 0);
k([l.property({constructOnly:!0})],c.prototype,"owner",void 0);k([l.property({constructOnly:!0})],c.prototype,"layer",void 0);k([l.property({readOnly:!0})],c.prototype,"hasDraped",void 0);k([l.property({readOnly:!0})],c.prototype,"symbolsUpdating",void 0);k([l.property({constructOnly:!0})],c.prototype,"graphicSymbolSupported",void 0);k([l.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating","filterVisibility.updating"]})],c.prototype,"updating",null);k([l.property({readOnly:!0})],
c.prototype,"updatingRemaining",null);k([l.property({readOnly:!0})],c.prototype,"updatingTotal",null);k([l.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],c.prototype,"displayFeatureLimit",null);k([l.property({readOnly:!0})],c.prototype,"maxSymbolComplexity",null);k([l.property({constructOnly:!0})],c.prototype,"hasZ",void 0);k([l.property({constructOnly:!0})],
c.prototype,"hasM",void 0);return c=M=k([l.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],c)}(l.declared(U));var n=new Map,p=new F,N=new Y(F);(function(){return function(){this.remove=this.add=null}})();var pa=10;return v});