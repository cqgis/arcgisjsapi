// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/LineCalloutPrograms ../../../webgl/renderState".split(" "),function(l,A,m,g,r,t,u,e,k,f,v,n,h){function p(c,a,b){3===b.length?c.setUniform4f(a,b[0],b[1],b[2],1):c.setUniform4fv(a,b)}l=function(c){function a(b,d){d=c.call(this,
d)||this;d.params=f.copyParameters(b,w);d._uniqueMaterialIdentifier=a.uniqueMaterialIdentifier(d.params);return d}m(a,c);Object.defineProperty(a.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});a.prototype.dispose=function(){};a.prototype.getGLMaterials=function(){return{color:x,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};a.prototype.intersect=function(b,d,a,c,e,f,g,h){};a.prototype.createBufferWriter=
function(){return new y};a.prototype.createRenderer=function(b,d){return new v(b,d,this)};a.prototype.setParameterValues=function(b){f.updateParameters(this.params,b)&&(this._uniqueMaterialIdentifier=a.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};a.prototype.getParameters=function(){return this.params};a.uniqueMaterialIdentifier=function(b){return JSON.stringify({screenOffset:b.screenOffset||[0,0],centerOffsetUnits:b.centerOffsetUnits||"world"})};return a}(u);var x=function(c){function a(b,
d,a){b=c.call(this,b,d)||this;b.isRenderSlot=!0;b.updateParameters();return b}m(a,c);a.prototype.updateParameters=function(){this.params=f.copyParameters(this.material.getParameters());this.selectProgram()};a.prototype.selectProgram=function(){var b=this.params;this.renderProgram=this.programRep.getProgram(n.program,{occlTest:!!b.occlusionTest,verticalOffset:!!b.verticalOffset,screenSizePerspective:!!b.screenSizePerspective,depthHud:!1,depthHudAlignStart:!!b.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===
b.centerOffsetUnits,slice:b.slicePlaneEnabled});this.depthProgram=this.programRep.getProgram(n.program,{occlTest:!!b.occlusionTest,verticalOffset:!!b.verticalOffset,screenSizePerspective:!!b.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!b.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===b.centerOffsetUnits,slice:b.slicePlaneEnabled});this.renderPipelineState=h.makePipelineState({blending:h.separateBlendingParams(1,770,771,771),depthTest:{func:513},colorWrite:h.defaultColorWriteParams});
this.depthPipelineState=h.makePipelineState({depthTest:{func:513},depthWrite:h.defaultDepthWriteParams})};a.prototype.beginSlot=function(b){switch(b){case 18:return this.isRenderSlot=!0;case 19:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(a.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0});a.prototype.getProgram=function(){return this.program};a.prototype.getPrograms=function(){return[this.renderProgram,
this.depthProgram]};a.prototype.getDrawMode=function(){return 4};a.prototype.bind=function(b,a){var d=a.cameraAboveGround?1:-1,c=this.program,e=this.params;b.bindProgram(c);c.setUniform1f("cameraGroundRelative",d);c.setUniform1f("polygonOffset",e.shaderPolygonOffset);c.setUniform4fv("viewport",a.viewport);c.setUniform1f("perDistancePixelRatio",Math.tan(a.fovY/2)/(a.viewport[2]/2));c.setUniformMatrix4fv("viewNormal",a.viewInvTransp);c.setUniform1i("hudVisibilityTexture",0);b.bindTexture(a.hudVisibilityTexture,
0);p(c,"color",e.color);d=a.pixelRatio||1;c.setUniform1f("pixelRatio",d);c.setUniform2f("screenOffset",e.screenOffset[0]*d,e.screenOffset[1]*d);this.bindBorder(b,a);f.bindVerticalOffset(e.verticalOffset,a,c);this.bindSizing(b,a);f.bindScreenSizePerspective(e.screenSizePerspective,c);this.isRenderSlot?b.setPipelineState(this.renderPipelineState):b.setPipelineState(this.depthPipelineState)};a.prototype.bindView=function(b,a){b=this.program;var d=this.params;f.bindView(a.origin,a.view,b);f.bindCamPos(a.origin,
a.viewInvTransp,b);d.slicePlaneEnabled&&f.bindSlicePlane(a.origin,a.slicePlane,b)};a.prototype.bindInstance=function(b,a){b=this.program;b.setUniformMatrix4fv("model",a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};a.prototype.release=function(b,a){};a.prototype.bindSizing=function(b,a){b=this.program;var d=this.params;b.setUniform2f("pixelToNDC",2/a.viewport[2],2/a.viewport[3]);b.setUniform1f("lineSize",Math.ceil(d.size)*(a.pixelRatio||1))};a.prototype.bindBorder=function(a,
d){a=this.program;var b=this.params;d=d.pixelRatio||1;null!==b.borderColor?(p(a,"borderColor",b.borderColor),a.setUniform1f("borderSize",d)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return a}(t),w={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},z=r.newLayout().vec3f(e.VertexAttrConstants.POSITION).vec3f(e.VertexAttrConstants.NORMAL).vec2f(e.VertexAttrConstants.UV0).vec4f(e.VertexAttrConstants.AUXPOS1),
q=[g.vec2f32.fromValues(0,0),g.vec2f32.fromValues(1,0),g.vec2f32.fromValues(0,1),g.vec2f32.fromValues(1,0),g.vec2f32.fromValues(1,1),g.vec2f32.fromValues(0,1)],y=function(){function c(){this.vertexBufferLayout=z}c.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};c.prototype.elementCount=function(a){return 6*a.indices[e.VertexAttrConstants.POSITION].length};c.prototype.write=function(a,b,d,c){k.writePosition(b.indices[e.VertexAttrConstants.POSITION],b.vertexAttr[e.VertexAttrConstants.POSITION].data,
a.transformation,d.position,c,6);k.writeNormal(b.indices[e.VertexAttrConstants.NORMAL],b.vertexAttr[e.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,d.normal,c,6);k.writeBufferVec4(b.indices[e.VertexAttrConstants.AUXPOS1],b.vertexAttr[e.VertexAttrConstants.AUXPOS1].data,d.auxpos1,c,6);for(a=0;a<q.length;++a)d.uv0.setVec(c+a,q[a])};return c}();return l});