// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),function(t,u,v,A,g,B,C,D,w,E,n,x,F){function p(a){return x.getGraphics3DSymbol(a.graphics3DGraphic.graphics3DSymbol).symbol.symbolLayers.getItemAt(0)}
function q(a){var b=a.graphics3DGraphic.graphic.geometry;if(g.isNone(b))return null;b=b.type;switch(b){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return"extrude"===p(a).type?f["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return f["above-center"];case "mesh":return f["above-center"];default:v.neverReached(b)}}function k(a,b){null==l&&(G.log(a,b),l=B.schedule(function(){l.remove();
l=null}))}function r(a,b,c){c=c.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace(m);c=w.vec3f64.fromValues(c[3]-c[0],c[4]-c[1],c[5]-c[2]);a.centerOffset[0]=1.1*Math.sqrt(c[0]*c[0]+c[1]*c[1])/2*b.normalizedOffset[0];var d=a.translation[2],e=c[2]/2*b.normalizedOffset[1];a.translation[2]=e*(1.1-1);a.elevationOffset=d+e;c=D.vec3.length(c);a.centerOffset[2]=1.1*c/2*b.normalizedOffset[2]}function H(a){var b=a.labelClass.labelPlacement,c=a.labelSymbol,d=a.graphics3DGraphic,e=x.getGraphics3DSymbol(d.graphics3DSymbol).symbol;
a=f[b]||q(a);if("point-3d"===e.type&&e.supportsCallout()&&e.hasVisibleVerticalOffset()&&!d.isDraped())return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:y(e.verticalOffset),anchor:null,normalizedOffset:null};if(c&&c.hasVisibleVerticalOffset()&&("point-3d"!==e.type||!e.supportsCallout()||!e.verticalOffset||d.isDraped())){a:switch(a.placement){case "above-center":d=!0;break a;default:d=!1}return d?{placement:"above-center",verticalOffset:y(c.verticalOffset),anchor:"bottom",normalizedOffset:[0,
a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(k("error","Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+b+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function y(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}Object.defineProperty(u,"__esModule",{value:!0});var G=A.getLogger("esri.views.3d.layers.graphics.labelPlacement"),
l=null;u.get=function(a){var b=H(a);if(g.isNone(b))return null;var c;if(b.anchor)c=b;else{var d=a.labelClass.labelPlacement,e=f[d];c=e||q(a);d&&!e&&k("warn","the requested label placement '"+d+"' is not currently supported in SceneView");d=a.graphics3DGraphic.graphic.geometry;if(g.isNone(d))c=null;else switch(d=d.type,d){case "polyline":case "polygon":case "extent":case "multipoint":a.labelClass.labelPlacement&&(k("warn","the requested label placement '"+c.placement+"' is currently unsupported for '"+
d+"' geometries in SceneView"),c=q(a));break;case "point":case "mesh":break;default:v.neverReached(d)}}if(g.isNone(c))return null;d=!!b.hasLabelVerticalOffset;b={anchor:c.anchor,verticalOffset:b.verticalOffset,screenOffset:C.vec2f64.create(),centerOffset:E.vec4f64.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:w.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:d};d=a.graphics3DGraphic.graphic.geometry;if(g.isNone(d))a=null;else{switch(d.type){case "point":d=a.graphics3DGraphic;
e=p(a);d.getCenterObjectSpace(b.translation);switch(e.type){case "icon":case "text":e=a.graphics3DGraphic;d=e._graphics[0].getScreenSize();e.isDraped()?b.hasLabelVerticalOffset||"center"===b.anchor||(f[a.labelClass.labelPlacement]&&k("warn","the requested placement '"+c.placement+"' is currently unsupported for draped graphics"),b.anchor="center"):(e=void 0,void 0===e&&(e=I),a=a.graphics3DGraphic._graphics[0].stageObject.getGeometryRecords()[0].material,a instanceof F?(a=a.getParameters().anchorPos,
e[0]=2*(a[0]-.5),e[1]=2*(a[1]-.5)):(e[0]=0,e[1]=0),a=e,h[0]=d[0]/2*(c.normalizedOffset[0]-a[0]),h[1]=d[1]/2*(c.normalizedOffset[1]-a[1]),b.screenOffset[0]=h[0],b.hasLabelVerticalOffset?(b.centerOffset[1]=h[1],b.centerOffsetUnits="screen"):b.screenOffset[1]=h[1]);break;case "object":r(b,c,a)}break;case "polygon":switch(p(a).type){case "extrude":a.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace(m),n.center(m,b.translation),b.translation[2]=n.height(m)/2,r(b,c,a)}break;case "mesh":r(b,c,a)}a=
b}return a};var f={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,
0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},z={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],
"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};t=function(a){var b=f[a];z[a].forEach(function(a){f[a]=b})};for(var J in z)t(J);Object.freeze&&(Object.freeze(f),Object.keys(f).forEach(function(a){Object.freeze(f[a]);Object.freeze(f[a].normalizedOffset)}));
var h=[0,0],I=[0,0],m=n.create()});