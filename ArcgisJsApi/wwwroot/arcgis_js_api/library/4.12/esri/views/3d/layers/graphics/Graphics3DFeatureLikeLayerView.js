// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Graphic ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/diffUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DHighlights ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils".split(" "),
function(H,I,q,c,r,t,h,u,k,v,w,g,d,l,m,x,y,z,A,B,C,D,E,F,n){var G={remove:function(){},pause:function(){},resume:function(){}};return function(p){function b(a){a=p.call(this)||this;a._handles=new w;a.highlights=new D;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}q(b,p);Object.defineProperty(b.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating)},enumerable:!0,configurable:!0});b.prototype.normalizeCtorArgs=function(a){var b=a.frustumVisibilityEnabled?new C:null,f=a.scaleVisibilityEnabled?new E:null,d=(a.filterVisibilityEnabled||a.timeExtentVisibilityEnabled)&&"multipatch"!==a.layer.geometryType?new B.Graphics3DFilterVisibility:null,c=a.elevationAlignmentEnabled?
new A:null;return{graphicsCore:new z({owner:a.owner,layer:a.layer,asyncUpdates:a.asyncGraphicsUpdates,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:a.owner.hasZ,hasM:a.owner.hasM}),frustumVisibility:b,scaleVisibility:f,filterVisibility:d,elevationAlignment:c,updateClippingExtent:a.updateClippingExtent,suspendResumeExtentMode:a.suspendResumeExtentMode,dataExtent:a.dataExtent}};b.prototype.initialize=function(){var a=this;this.scaleVisibility&&
this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()}));this.filterVisibility&&this._handles.add(this.owner.watch(["filter","timeExtent"],function(){return a.filterVisibility.filterChanged()}));this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(b,f){m.diff(b,f)&&a.graphicsCore.elevationInfoChange()}));this._handles.add(this.layer.watch("labelsVisible",function(){return a.graphicsCore.updateVisibilityInfo()}));
this._handles.add(this.layer.watch("labelingInfo",function(b,f){m.diff(b,f)&&a.graphicsCore.updateLabelingInfo()}))};b.prototype.setup=function(){return t(this,void 0,void 0,function(){var a,b,f,d,c=this;return r(this,function(e){switch(e.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),a=this.owner,b=this.owner.view.basemapTerrain,f=function(a,b,f){return c.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(a,b,f)},this.scaleVisibility&&this.scaleVisibility.setup(a,
this.layer,f,this.graphicsCore,b),this.filterVisibility&&("filter"in a||"timeExtent"in a)&&this.filterVisibility.setup(a,this.graphicsCore),this.elevationAlignment&&(d=a.view.elevationProvider,this.elevationAlignment.setup(a,f,this.graphicsCore,d)),this.highlights&&this.highlights.setup(this.graphicsCore),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",a.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,k.result(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,
scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,highlights:this.highlights}))];case 1:return e.sent(),this._handles.add([this.layer.watch("renderer",function(a){return c.graphicsCore.rendererChange(a)}),a.watch("fullOpacity",function(){return c.graphicsCore.opacityChange()})]),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this._handles.add(a.view.watch("clippingArea",function(){return c._updateClippingExtent()})),
this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,k.result(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})};b.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var a=0,b="frustumVisibility scaleVisibility filterVisibility elevationAlignment highlights graphicsCore".split(" ");a<b.length;a++){var f=b[a],c=this[f];c&&(c.destroy(),this._set(f,null))}this._set("layer",
null);this._set("owner",null)};b.prototype.highlight=function(a,b,c){var d=this;if(a instanceof x){b=this.highlights.acquireSet(b,c);var f=b.set,e=b.handle;this.owner.queryObjectIds(a).then(function(a){return d.highlights.setObjectIds(f,a)});return e}if("number"===typeof a||a instanceof h)return this.highlight([a],b,c);"toArray"in a&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof h)if(e=a,c&&e[0].attributes&&null!==n.attributeLookup(e[0].attributes,c))a=e.map(function(a){return n.attributeLookup(a.attributes,
c)});else return a=e.map(function(a){return a.uid}),e=this.highlights.acquireSet(b,null),b=e.set,e=e.handle,this.highlights.setUids(b,a),e;if("number"===typeof a[0])return e=this.highlights.acquireSet(b,c),b=e.set,e=e.handle,this.highlights.setObjectIds(b,a),e}return G};b.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};b.prototype.setupSuspendResumeExtent=
function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(g.init(this,"suspendResumeExtentMode",function(){a._handles.remove("suspendResumeExtentMode");switch(a.suspendResumeExtentMode){case "computed":a._handles.add(g.init(a.graphicsCore,"computedExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;case "data":a._handles.add(g.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;
default:v.neverReached(a.suspendResumeExtentMode)}}))};b.prototype.updateSuspendResumeExtent=function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};b.prototype.extentToSuspendResumeRect=function(a,b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!l.canProject(a,c))return;a=l.project(a,c)}return F.enlargeExtent(a,b,y.SUSPEND_RESUME_EXTENT_OPTIMISM)};b.prototype.suspendResumeExtentChanged=
function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);this.scaleVisibility&&this.scaleVisibility.setExtent(a)};c([d.property({aliasOf:"graphicsCore.layer"})],b.prototype,"layer",void 0);c([d.property({aliasOf:"graphicsCore.owner"})],b.prototype,"owner",void 0);c([d.property({constructOnly:!0})],b.prototype,"updateClippingExtent",void 0);c([d.property({constructOnly:!0})],b.prototype,"graphicsCore",void 0);c([d.property({constructOnly:!0})],b.prototype,"scaleVisibility",void 0);c([d.property({constructOnly:!0})],
b.prototype,"filterVisibility",void 0);c([d.property({constructOnly:!0})],b.prototype,"elevationAlignment",void 0);c([d.property({constructOnly:!0})],b.prototype,"frustumVisibility",void 0);c([d.property({readOnly:!0})],b.prototype,"deconfliction",void 0);c([d.property({readOnly:!0})],b.prototype,"labeling",void 0);c([d.property({readOnly:!0})],b.prototype,"highlights",void 0);c([d.property()],b.prototype,"suspendResumeExtentMode",void 0);c([d.property()],b.prototype,"dataExtent",void 0);c([d.property({readOnly:!0,
dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],b.prototype,"suspended",null);c([d.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating"]})],b.prototype,"updating",null);return b=c([d.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],b)}(d.declared(u))});