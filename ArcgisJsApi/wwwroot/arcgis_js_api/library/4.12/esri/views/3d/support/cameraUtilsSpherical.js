// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),function(M,k,u,H,g,v,I,J,K,C,D,m){function E(c,a,d,f){void 0===f&&(f=C.createDirectionUp());g.vec3.cross(q,c,F);0===g.vec3.dot(q,q)&&g.vec3.cross(q,c,G);u.mat4.identity(n);
u.mat4.rotate(n,n,-m.deg2rad(a),c);u.mat4.rotate(n,n,-m.deg2rad(d),q);a=f.up;d=f.direction;g.vec3.cross(a,q,c);g.vec3.normalize(a,a);g.vec3.transformMat4(a,a,n);g.vec3.normalize(d,c);g.vec3.negate(d,d);g.vec3.transformMat4(d,d,n);return f}function A(c){var a=c[1];c[1]=-c[2];c[2]=a}function B(c,a){a=E(a,c.heading,c.tilt);c.up=a.up;return c}Object.defineProperty(k,"__esModule",{value:!0});var F=v.vec3f64.fromValues(0,0,1),G=g.vec3.normalize(v.vec3f64.create(),v.vec3f64.fromValues(1,1,1)),L=new m.Cyclical(-180,
180),n=H.mat4f64.create(),q=v.vec3f64.create(),p=v.vec3f64.create();k.headingTiltToDirectionUp=E;k.directionToHeadingTilt=function(c,a,d,f){var b=q;g.vec3.normalize(b,c);g.vec3.cross(p,b,F);0===g.vec3.dot(p,p)&&g.vec3.cross(p,b,G);g.vec3.cross(p,p,b);return C.directionToHeadingTilt(a,d,f,b,p)};k.eyeForCenterWithHeadingTilt=function(c,a,d,f){var b={eye:v.vec3f64.create(),up:null,tilt:f,heading:d},l=q;l[0]=c[0];l[1]=c[2];l[2]=-c[1];d=m.deg2rad(d);var e=m.deg2rad(f);f=Math.sin(d);d=Math.cos(d);var h=
Math.sin(e),y=Math.cos(e),w=g.vec3.length(l);if(1E-8>Math.abs(e))e=a+w;else var x=w/h,k=m.asin(a/x),e=x*Math.sin(Math.PI-e-k);var x=h*a,y=y*a,k=d*x,n=e-y,p=n*n,z=a*a*h*h,h=d*d*z,z=f*f*z,r=l[1]*n,t=h*(h+p-l[1]*l[1]);if(0>t)return g.vec3.scale(b.eye,l,e/w),b.tilt=0,b;var u=Math.sqrt(t),t=h+p,r=0<d?-u+r:u+r;if(1E-8>Math.abs(t))return 1E-8>w?(b.eye[0]=0,b.eye[1]=0,b.eye[2]=a):g.vec3.scale(b.eye,l,e/w),b.tilt=0,A(b.eye),B(b,c);b.eye[1]=r/t;t=b.eye[1]*b.eye[1];a=1-t;r=Math.sqrt(a);k=h*t+z-2*k*b.eye[1]*
r*n+a*p;if(1E-8>Math.abs(k))return g.vec3.scale(b.eye,l,e/w),b.tilt=0,A(b.eye),B(b,c);b.eye[0]=(a*(e*l[0]-y*l[0])-x*r*(l[0]*b.eye[1]*d+l[2]*f))/k;b.eye[2]=(a*(e*l[2]-y*l[2])-x*r*(l[2]*b.eye[1]*d-l[0]*f))/k;g.vec3.scale(b.eye,b.eye,e);A(b.eye);return B(b,c)};k.lookAtTiltToEyeTilt=function(c,a,d){c=g.vec3.length(c);a=m.asin(a/(Math.sqrt(a*a+c*c-2*a*c*Math.cos(Math.PI-d))/Math.sin(d)));return m.rad2deg(d-a)};k.eyeTiltToLookAtTilt=function(c,a,d){d=m.deg2rad(d);c=g.vec3.length(c);return m.asin(a/(c/Math.sin(d)))+
d};k.toExtent=function(c,a,d,f,b){function g(a){var b=Math.PI/2;a=m.cyclical2PI.normalize(a,-b);a>b&&(a=Math.PI-a);return a}var e;e=a.latitude;a=a.longitude;var h=D.getLonDeltaForDistance(a,e,d)/2;d=a-h;a+=h;e=m.deg2rad(e);h=D.earthRadius;e=(1+Math.sin(e))/(1-Math.sin(e));var k=(e+1)*Math.tan(f/h/2);e=1.5*Math.PI-2*Math.atan(.5*(k+Math.sqrt(4*e+k*k)));f=e+f/h;e=g(e);f=g(f);f<e&&(h=f,f=e,e=h);e=Math.max(m.rad2deg(e),-90);f=Math.min(m.rad2deg(f),90);a=L.monotonic(d,a);180<a-d&&(h=(a-d-180)/2,d+=h,a-=
h);h=c.spatialReference&&c.spatialReference.isGeographic?c.spatialReference:J.WGS84;b?(b.xmin=d,b.ymin=e,b.xmax=a,b.ymax=f,b.spatialReference=h):b=new I(d,e,a,f,h);c.spatialReference&&c.spatialReference.isWebMercator&&K.geographicToWebMercator(b,!1,b);return b}});