// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/Evented ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery".split(" "),function(t,u,m,h,v,w,n,p,k,g,q,r){return function(l){function c(a){a=l.call(this)||this;a.providers={im:[],ground:[],
scene:[]};a.handles=new Map;return a}m(c,l);c.prototype.getElevation=function(a,d){var b=-Infinity,f=!0;"scene"===d&&(b=this._updateElevation(b,this.providers.im,a,d),isFinite(b)&&(f=!1));f&&(b=this._updateElevation(b,this.providers.ground,a,d));"scene"===d&&(b=this._updateElevation(b,this.providers.scene,a,d));return isFinite(b)?b:null};c.prototype._updateElevation=function(a,d,b,f){for(var e=0;e<d.length;e++){var c=d[e].getElevation(b,f);null!=c&&(a=Math.max(c,a))}return a};c.prototype.queryElevation=
function(a,d,b,c){var e=this;void 0===b&&(b=0);this._elevationService||(this._elevationService=new r.ElevationQuery(this.view.spatialReference,function(){return e.view.map&&e.view.map.ground},{maximumAutoTileRequests:4}));var f=k.createResolver();(q.isPoint(a)?this._elevationService.queryElevation(a.x,a.y,d,b):this._elevationService.queryElevation(a[0],a[1],d,b)).then(function(b){"scene"===c&&(b=e._updateElevation(b,e.providers.scene,a,c));f.resolve(isFinite(b)?b:null)}).catch(function(b){k.isAbortError(b)?
f.reject(b):f.resolve(e.getElevation(a))});return f.promise};c.prototype.register=function(a,d){var b=this;this.handles.set(d,d.on("elevation-change",function(a){return b.emit("elevation-change",a)}));this.providers[a].push(d)};c.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var d=0,b=Object.keys(this.providers);d<b.length;d++){var c=b[d],e=this.providers[c].indexOf(a);-1<e&&this.providers[c].splice(e,1)}};h([g.property({constructOnly:!0})],
c.prototype,"view",void 0);h([g.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],c.prototype,"spatialReference",void 0);return c=h([g.subclass("esri.views.3d.support.CombinedElevationProvider")],c)}(g.declared(n,p))});