// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../geometry/support/coordsUtils ../../../../../geometry/support/spatialReferenceUtils".split(" "),function(l,h,z,r,t,u,p,m,v){function n(d,a,b){void 0===b&&(b=p.vec2f64.create());return u.vec2.set(b,d,a)}Object.defineProperty(h,"__esModule",{value:!0});var q=function(){function d(){this.vertices=
[];this.edges=[]}d.prototype.makeVertex=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);a={pos:a,unnormalizedPos:a,left:b,right:c,type:"vertex",component:this};this.vertices.push(a);return a};d.prototype.makeEdge=function(a,b){var c={v0:a,v1:b,type:"edge",component:this};a.right=c;b.left=c;this.edges.push(c);return c};d.prototype.removeVertex=function(a){this.vertices.splice(this.vertices.indexOf(a),1);a.left&&this.removeEdge(a.left);a.right&&this.removeEdge(a.right)};d.prototype.removeEdge=
function(a){this.edges.splice(this.edges.indexOf(a),1);a.v0.right=null;a.v1.left=null};return d}();h.Component=q;h.makeMapPoint=n;l=function(){function d(a,b){this.geometry=a;this.doUnnormalization=b;this.components=[];(a=v.getInfo(this.geometry.spatialReference))?(this._spanMin=a.valid[0],this._spanMax=a.valid[1],this._span=this._spanMax-this._spanMin):this.doUnnormalization=!1}d.prototype.getVertexPositionAsPoint=function(a,b){b.x=a.pos[0];b.y=a.pos[1];b.z=null;b.spatialReference=this.geometry.spatialReference;
return b};d.prototype.getEdgePosition=function(a,b,c){void 0===c&&(c=p.vec2f64.create());return n((a.v1.unnormalizedPos[0]-a.v0.unnormalizedPos[0])*b+a.v0.unnormalizedPos[0],(a.v1.unnormalizedPos[1]-a.v0.unnormalizedPos[1])*b+a.v0.unnormalizedPos[1],c)};d.prototype.getEdgePositionAsPoint=function(a,b,c){a=this.getEdgePosition(a,b,w);c.x=a[0];c.y=a[1];c.z=null;c.spatialReference=this.geometry.spatialReference;return c};d.prototype.canRemoveVertex=function(a){return!0};d.prototype.removeVertex=function(a){var b=
a.component,c=a.left,d=a.right;b.removeVertex(a);return c&&d?b.makeEdge(c.v0,d.v1):null};d.prototype.splitEdge=function(a,b){var c=a.component;b=c.makeVertex(this.getEdgePosition(a,b));var d=a.v0,g=a.v1;c.removeEdge(a);c.makeEdge(d,b);c.makeEdge(b,g);return b};return d}();h.ReshapeHelper=l;var x=function(d){function a(a,c){c=d.call(this,a,c)||this;c.geometry=a;a=c.geometry.rings;for(var b=0;b<a.length;++b){for(var g=a[b],e=new q,f=g.length-1,k=0;k<f;++k){var h=n(g[k][0],g[k][1]);e.makeVertex(h)}g=
e.vertices.length-1;for(f=0;f<g;++f)e.makeEdge(e.vertices[f],e.vertices[f+1]);e.makeEdge(e.vertices[e.vertices.length-1],e.vertices[0]);c.doUnnormalization&&m.computeUnnormalizedVertexPositionsOnDateLineCrossing(e.vertices,c._spanMin,c._spanMax,c._span);c.components.push(e)}return c}r(a,d);a.prototype.canRemoveVertex=function(a){return 3<a.component.vertices.length};a.prototype.commit=function(){var a=this,c=[];this.components.forEach(function(b){var d=[];a.doUnnormalization&&m.computeUnnormalizedVertexPositionsOnDateLineCrossing(b.vertices,
a._spanMin,a._spanMax,a._span);var e=b.vertices[0],f=e;do d.push(e.unnormalizedPos),e=e.right.v1;while(e&&e!==f);d.push(b.vertices[0].unnormalizedPos);c.push(d)});this.geometry.rings=c;return this.geometry};return a}(l),y=function(d){function a(a,c){c=d.call(this,a,c)||this;c.geometry=a;a=c.geometry.paths;for(var b=0;b<a.length;++b){for(var g=a[b],e=new q,f=g.length,k=0;k<f;++k){var h=n(g[k][0],g[k][1]);e.makeVertex(h)}g=e.vertices.length-1;for(f=0;f<g;++f)e.makeEdge(e.vertices[f],e.vertices[f+1]);
c.doUnnormalization&&m.computeUnnormalizedVertexPositionsOnDateLineCrossing(e.vertices,c._spanMin,c._spanMax,c._span);c.components.push(e)}return c}r(a,d);a.prototype.canRemoveVertex=function(a){return 2<a.component.vertices.length};a.prototype.commit=function(){var a=this,c=[];this.components.forEach(function(b){var d=[];a.doUnnormalization&&m.computeUnnormalizedVertexPositionsOnDateLineCrossing(b.vertices,a._spanMin,a._spanMax,a._span);var e=b=b.vertices[0];do d.push(b.unnormalizedPos),b=b.right?
b.right.v1:null;while(b&&b!==e);c.push(d)});this.geometry.paths=c;return this.geometry};return a}(l);h.isReshapeGeometry=function(d){return t.isSome(d)&&("polygon"===d.type||"polyline"===d.type)};h.createReshapeHelper=function(d,a){return d?"polygon"===d.type?new x(d,a):new y(d,a):null};var w=p.vec2f64.create()});