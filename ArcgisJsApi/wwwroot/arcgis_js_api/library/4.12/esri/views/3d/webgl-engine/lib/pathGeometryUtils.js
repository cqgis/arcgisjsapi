// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/mathUtils ./GeometryData ./GeometryUtil ./Util ../materials/internal/MaterialUtil ../shaders/PathPrograms".split(" "),
function(W,X,Y,D,I,M,J,y,c,u,E,K,F,N,C,P,B){var A;(function(w){function A(){return{up:u.vec3f64.create(),right:u.vec3f64.create()}}function z(c,a,b){c[0]=b[0]*a.right[0]+b[1]*a.up[0];c[1]=b[0]*a.right[1]+b[1]*a.up[1];c[2]=b[0]*a.right[2]+b[1]*a.up[2]}w.makeFrame=A;w.profileSpaceToVertexSpace=z;var p=function(){function h(){this.pos=u.vec3f64.create();this.posES=u.vec3f64.create();this.posGS=u.vec3f64.create();this.vRight=u.vec3f64.create();this.vLeft=u.vec3f64.create();this.frame=A();this.rotationFrame=
A();this.rotationAngle=0}h.prototype.setFrameFromUpVector=function(a){c.vec3.copy(this.frame.up,a);c.vec3.add(m,this.vLeft,this.vRight);c.vec3.normalize(m,m);c.vec3.scale(n,this.frame.up,c.vec3.dot(m,this.frame.up));c.vec3.subtract(G,m,n);c.vec3.normalize(G,G);c.vec3.cross(this.frame.right,G,this.frame.up)};h.prototype.computeRotationAxisAndAngleFromUpVector=function(){c.vec3.copy(this.rotationFrame.up,this.frame.up);var a=c.vec3.dot(this.rotationFrame.up,this.frame.up),b=c.vec3.dot(this.rotationFrame.up,
this.frame.right);c.vec3.scale(n,this.frame.up,-b);c.vec3.scale(m,this.frame.right,a);c.vec3.add(n,n,m);c.vec3.normalize(this.rotationFrame.right,n);c.vec3.scale(n,this.frame.up,c.vec3.dot(this.frame.up,this.vLeft));c.vec3.subtract(n,this.vLeft,n);c.vec3.negate(n,n);c.vec3.normalize(n,n);c.vec3.scale(m,this.frame.up,c.vec3.dot(this.frame.up,this.vRight));c.vec3.subtract(m,this.vRight,m);c.vec3.normalize(m,m);c.vec3.cross(x,this.rotationFrame.up,this.vLeft);this.rotationAngle=K.sign(c.vec3.dot(x,this.vRight))*
(Math.PI-K.acos(c.vec3.dot(n,m)));this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return h}();w.PathVertex=p;p=function(){function c(){this.vertices=[];this.vertexIndices=[];this.poles=[];this.poleIndices=[];this.uvIndices=this.uvs=null}c.prototype.addVertex=function(a,b){void 0===b&&(b=0);this.vertices.push(y.vec2f64.clone(a));this.poleIndices.push(b);return this.vertices.length-1};c.prototype.addUV=function(a){this.uvs||(this.uvs=
[],this.uvIndices=[]);this.uvs.push(a);return this.uvs.length-1};c.prototype.addPole=function(a){this.poles.push(y.vec2f64.clone(a));return this.poles.length-1};c.prototype.addSegment=function(a,b,d,c){void 0===d&&(d=null);void 0===c&&(c=null);this.vertexIndices.push(a);this.vertexIndices.push(b);null!==d&&null!==c&&(this.uvIndices.push(d),this.uvIndices.push(c))};Object.defineProperty(c.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0});c.prototype.hasUV=
function(){return null!=this.uvs};c.prototype.translate=function(a,b){for(var d=0,c=this.vertices;d<c.length;d++){var e=c[d];e[0]+=a;e[1]+=b}d=0;for(c=this.poles;d<c.length;d++)e=c[d],e[0]+=a,e[1]+=b};c.circle=function(a){void 0===a&&(a=20);var b=new c;b.addPole(y.vec2f64.fromValues(0,0));for(var d=0;d<a;++d){var l=2*d*Math.PI/a;b.addVertex(y.vec2f64.fromValues(.5*Math.cos(l),.5*Math.sin(l)));b.addUV(d/a)}b.addUV(1);for(d=0;d<a-1;++d)b.addSegment(d,d+1,d,d+1);b.addSegment(a-1,0,a-1,a);return b};c.rect=
function(){var a=new c,b=y.vec2f64.fromValues(-.5,-.5),d=y.vec2f64.fromValues(.5,-.5),l=y.vec2f64.fromValues(.5,.5),e=y.vec2f64.fromValues(-.5,.5);a.addPole(y.vec2f64.fromValues(0,.5));a.addPole(y.vec2f64.fromValues(0,.5));a.addPole(y.vec2f64.fromValues(0,-.5));a.addPole(y.vec2f64.fromValues(0,-.5));a.addUV(0);a.addUV(1);a.addVertex(b,3);a.addVertex(d,3);a.addSegment(0,1,0,1);a.addVertex(d,2);a.addVertex(l,1);a.addSegment(2,3,0,1);a.addVertex(l,0);a.addVertex(e,0);a.addSegment(4,5,0,1);a.addVertex(e,
1);a.addVertex(b,2);a.addSegment(6,7,0,1);return a};return c}();w.Profile=p;p=function(){function h(a){this.vertices=[];this.offset=u.vec3f64.create();this.xform=M.mat4f64.create();this.vertices=a;c.vec3.copy(this.offset,this.vertices[Math.floor((a.length-1)/2)].pos);a=0;for(var b=this.vertices;a<b.length;a++){var d=b[a];c.vec3.subtract(d.pos,d.pos,this.offset)}I.mat4.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}h.prototype.updatePathVertexInformation=function(){var a=
this.vertices.length,b=this.vertices[0];b.index=0;c.vec3.set(b.vLeft,0,0,0);b.vLeftLength=0;c.vec3.subtract(b.vRight,this.vertices[1].pos,b.pos);b.vRightLength=c.vec3.length(b.vRight);c.vec3.normalize(b.vRight,b.vRight);for(var d=b,l=1;l<a;++l)b=this.vertices[l],b.index=l,c.vec3.copy(b.vLeft,d.vRight),b.vLeftLength=d.vRightLength,l<a-1?(c.vec3.subtract(b.vRight,this.vertices[l+1].pos,b.pos),b.vRightLength=c.vec3.length(b.vRight),c.vec3.normalize(b.vRight,b.vRight)):(c.vec3.copy(b.vRight,b.vLeft),
b.vRightLength=b.vLeftLength),d=b};return h}();w.Path=p;w.computeMinimumRotationTangentFrame=function(h,a){var b=null,d=h.vertices.length,l=u.vec3f64.create(),e=u.vec3f64.create(),k=u.vec3f64.create(),g=u.vec3f64.create(),f=u.vec3f64.create(),r=u.vec3f64.create(),m=E.plane.create(),t=h.vertices[0];c.vec3.copy(e,a);c.vec3.set(l,0,1,0);N.makeOrthoBasisDirUpFallback(t.vRight,e,l,l,k,e,.99619469809);c.vec3.copy(t.frame.up,e);c.vec3.copy(t.frame.right,k);b=t;for(a=1;a<d;++a){t=h.vertices[a];c.vec3.add(f,
t.vLeft,t.vRight);var n=c.vec3.length(f);0<n?(n=1/Math.sqrt(n),f[0]*=n,f[1]*=n,f[2]*=n):(f[0]=t.vRight[0],f[1]=t.vRight[1],f[2]=t.vRight[2]);c.vec3.add(r,b.pos,b.frame.up);E.plane.fromPositionAndNormal(t.pos,f,m);E.plane.intersectRay(m,E.ray.wrap(r,t.vLeft),g)?(c.vec3.subtract(g,g,t.pos),c.vec3.normalize(e,g),c.vec3.cross(k,f,e),c.vec3.normalize(k,k)):N.makeOrthoBasisDirUpFallback(f,b.frame.up,b.frame.right,l,k,e,.99619469809);c.vec3.copy(t.frame.up,e);c.vec3.copy(t.frame.right,k);b=t}};p=function(){return function(){}}();
w.Extruder=p;p=function(){function c(){}c.prototype.numProfilesPerJoin=function(){return 1};c.prototype.extrude=function(a,b,d){for(var c=0;c<b.vertices.length;++c)z(v,a.frame,b.vertices[c]),d(a.index,a.frame,v,!1)};return c}();w.SimpleExtruder=p;p=function(){function h(a,b){void 0===a&&(a=.8*Math.PI);void 0===b&&(b=1);this.cutoffAngle=a;this.numBendSubdivisions=b}h.prototype.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};h.prototype.extrude=function(a,b,d){var l=Q,e=R,k=a.frame;
c.vec3.copy(e.up,k.up);c.vec3.copy(e.right,k.right);if(0<Math.abs(a.rotationAngle)){var k=c.vec3.dot(e.right,a.rotationFrame.up),g=c.vec3.dot(e.right,a.rotationFrame.right),f=c.vec3.dot(e.up,a.rotationFrame.up),r=c.vec3.dot(e.up,a.rotationFrame.right),g=g/Math.cos(.5*a.rotationAngle),r=r/Math.cos(.5*a.rotationAngle);c.vec3.scale(m,a.rotationFrame.up,k);c.vec3.scale(e.right,a.rotationFrame.right,g);c.vec3.add(e.right,e.right,m);c.vec3.scale(m,a.rotationFrame.up,f);c.vec3.scale(e.up,a.rotationFrame.right,
r);c.vec3.add(e.up,e.up,m)}if(Math.abs(a.rotationAngle)>=this.cutoffAngle)for(k=0;k<this.numBendSubdivisions+1;++k)for(I.mat4.identity(H),I.mat4.rotate(H,H,.5*-a.rotationAngle+k*a.rotationAngle/this.numBendSubdivisions,a.rotationFrame.up),f=l,r=a.frame,g=H,c.vec3.transformMat4(f.up,r.up,g),c.vec3.transformMat4(f.right,r.right,g),f=0;f<b.vertices.length;++f)z(v,a.frame,b.vertices[f]),r=c.vec3.dot(v,a.rotationFrame.right),(r=0<=r*a.rotationAngle)?(z(v,l,b.vertices[f]),d(a.index,l,v,!1)):(z(v,e,b.vertices[f]),
d(a.index,a.frame,v,!0));else for(k=0;k<this.numBendSubdivisions+1;++k)for(f=0;f<b.vertices.length;++f)z(v,a.frame,b.vertices[f]),r=c.vec3.dot(v,a.rotationFrame.right),r=0<=r*a.rotationAngle,z(v,e,b.vertices[f]),d(a.index,a.frame,v,r?!1:!0)};return h}();w.MiterExtruder=p;var S={generateUV:!1},p=function(){function c(){}c.prototype.rebuildConnectingProfileGeometry=function(a,b,d){for(var c=0;c<b.vertices.length;++c)z(v,a.frame,b.vertices[c]),d(a.index,a.frame,v,T,0)};return c}();w.CapBuilder=p;var L=
function(c){function a(){return c.call(this)||this}D(a,c);a.prototype.getNumVertices=function(){return 0};a.prototype.getNumIndices=function(){return 0};a.prototype.rebuildCapGeometry=function(b,d){};a.prototype.buildTopology=function(b,d){};return a}(p);w.NoCapBuilder=L;L=function(h){function a(b,d,a){void 0===d&&(d=0);void 0===a&&(a=!1);var c=h.call(this)||this;c.profile=b;c.profilePlaneOffset=d;c.flip=a;return c}D(a,h);a.prototype.getNumVertices=function(){return this.profile.vertices.length};
a.prototype.getNumIndices=function(){return 3*this.profile.numSegments};a.prototype.rebuildConnectingProfileGeometry=function(b,a,l){var d=n;c.vec3.cross(d,b.frame.up,b.frame.right);for(var k=0;k<a.vertices.length;++k)z(v,b.frame,a.vertices[k]),l(b.index,b.frame,v,d,this.profilePlaneOffset)};a.prototype.rebuildCapGeometry=function(b,a){this.rebuildConnectingProfileGeometry(b,this.profile,a)};a.prototype.buildTopology=function(b,a){b=this.vertexBufferStart+this.profile.vertexIndices[0];for(var d=1;d<
this.profile.numSegments;++d){var c=this.vertexBufferStart+this.profile.vertexIndices[2*d+0],k=this.vertexBufferStart+this.profile.vertexIndices[2*d+1];this.flip?a(k,c,b):a(b,c,k)}};return a}(p);w.TriangulationCapBuilder=L;p=function(h){function a(b){var a=h.call(this)||this;a.flip=!1;a.breakNormals=!1;a.numSegments=3;a.profile=b.profile;a.flip=b.flip;a.breakNormals=b.breakNormals;return a}D(a,h);a.prototype.getNumVertices=function(){var b=0,b=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&
(b+=this.profile.vertices.length);return b+=this.profile.poles.length};a.prototype.getNumIndices=function(){var b;b=0+2*this.profile.numSegments*(this.numSegments-1);for(var a=0;a<this.profile.numSegments;++a)b=this.profile.poleIndices[this.profile.vertexIndices[2*a+0]]===this.profile.poleIndices[this.profile.vertexIndices[2*a+1]]?b+1:b+2;return 3*b};a.prototype.rebuildCapGeometry=function(b,a){var d=b.frame,e=n;c.vec3.cross(e,d.up,d.right);for(var k=this.flip?.5:-.5,g=0;g<this.profile.poles.length;++g)z(v,
d,this.profile.poles[g]),a(b.index,d,v,e,k);if(this.breakNormals)for(g=0;g<this.profile.vertices.length;++g)z(v,d,this.profile.vertices[g]),a(b.index,d,v,e,0);for(g=0;g<this.numSegments-1;++g)for(var f=1-(g+1)/this.numSegments,r=Math.sin(f*Math.PI*.5),f=Math.cos(f*Math.PI*.5),h=0;h<this.profile.vertices.length;++h){var t=U,m=this.profile.poles[this.profile.poleIndices[h]];J.vec2.subtract(t,this.profile.vertices[h],m);J.vec2.scale(t,t,r);J.vec2.add(t,t,m);z(v,d,t);a(b.index,d,v,e,k*f)}};a.prototype.buildTopology=
function(b,a){b=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;for(var d=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length,c=0;c<this.profile.numSegments;++c){for(var k=this.profile.vertexIndices[2*c+0],g=this.profile.vertexIndices[2*c+1],f=this.vertexBufferStart+this.profile.poleIndices[k],r=this.vertexBufferStart+this.profile.poleIndices[g],h=b+k,m=b+g,
n=0;n<this.numSegments-1;++n){var p=d+n*this.profile.vertices.length+k,q=d+n*this.profile.vertices.length+g;this.flip?(a(p,m,h),a(m,p,q)):(a(h,m,p),a(q,p,m));h=p;m=q}this.flip?(a(f,m,h),f!==r&&a(f,r,m)):(a(h,m,f),f!==r&&a(m,r,f))}};return a}(p);w.RoundCapBuilder=p;p=function(){function h(a,b,c,l,e,k){void 0===k&&(k=S);this.options=k;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=b;this.path=a;this.extruder=
c;this.startCap=l;this.endCap=e;a=this.path.vertices.length-2;this.numExtrusionProfiles=c.numProfilesPerJoin()*a+2;this.numNormalsTotal=this.numVerticesTotal=b.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;b=this.startCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.endCap.vertexBufferStart=this.numVerticesTotal;b=this.endCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.profileRightAxisData=new Float32Array(4*
this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.auxVectorData=new Float32Array(3*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}h.prototype.emitVertex=function(a,b,d,l){var e=
c.vec3.dot(d,b.right);this.profileRightAxisData[4*this._extrusionVertexCount+0]=b.right[0]*e;this.profileRightAxisData[4*this._extrusionVertexCount+1]=b.right[1]*e;this.profileRightAxisData[4*this._extrusionVertexCount+2]=b.right[2]*e;d=c.vec3.dot(d,b.up);this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0]*d;this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1]*d;this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2]*d;this.pathVertexData[this._extrusionVertexCount]=a;
l?(a=this.path.vertices[a],this.auxVectorData[3*this._extrusionVertexCount+0]=a.rotationFrame.right[0]*a.maxStretchDistance,this.auxVectorData[3*this._extrusionVertexCount+1]=a.rotationFrame.right[1]*a.maxStretchDistance,this.auxVectorData[3*this._extrusionVertexCount+2]=a.rotationFrame.right[2]*a.maxStretchDistance):(this.auxVectorData[3*this._extrusionVertexCount+0]=0,this.auxVectorData[3*this._extrusionVertexCount+1]=0,this.auxVectorData[3*this._extrusionVertexCount+2]=0);++this._extrusionVertexCount};
h.prototype.emitCapVertex=function(a,b,d,l,e){var k=c.vec3.dot(d,b.right);this.profileRightAxisData[4*this._extrusionVertexCount+0]=b.right[0]*k;this.profileRightAxisData[4*this._extrusionVertexCount+1]=b.right[1]*k;this.profileRightAxisData[4*this._extrusionVertexCount+2]=b.right[2]*k;d=c.vec3.dot(d,b.up);this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0]*d;this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1]*d;this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2]*
d;this.pathVertexData[this._extrusionVertexCount]=a;this.auxVectorData[3*this._extrusionVertexCount+0]=l[0]*e;this.auxVectorData[3*this._extrusionVertexCount+1]=l[1]*e;this.auxVectorData[3*this._extrusionVertexCount+2]=l[2]*e;++this._extrusionVertexCount};h.prototype.emitTriangle=function(a,b,c){this.vertexIndices[3*this._triangleCount+0]=a;this.vertexIndices[3*this._triangleCount+1]=b;this.vertexIndices[3*this._triangleCount+2]=c;this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[a];
this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[b];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[c];this.normalIndices[3*this._triangleCount+0]=a;this.normalIndices[3*this._triangleCount+1]=b;this.normalIndices[3*this._triangleCount+2]=c;++this._triangleCount};h.prototype.rebuildGeometry=function(){for(var a=this.emitVertex.bind(this),b=this.emitCapVertex.bind(this),c=this._extrusionVertexCount=0,l=this.path.vertices;c<l.length;c++){var e=l[c];this.originData[3*
e.index+0]=e.pos[0];this.originData[3*e.index+1]=e.pos[1];this.originData[3*e.index+2]=e.pos[2]}this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,b);for(c=1;c<this.path.vertices.length-1;++c)this.extruder.extrude(this.path.vertices[c],this.profile,a);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,b);this.startCap.rebuildCapGeometry(this.path.vertices[0],b);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-
1],b);if(this.profile.hasUV()&&this.options.generateUV)for(c=0;c<this.profile.uvs.length;++c)this.uvData[2*c+0]=this.profile.uvs[c],this.uvData[2*c+1]=0};h.prototype.buildTopology=function(){var a=this.emitTriangle.bind(this);this._triangleCount=0;var b=this.profile.vertices.length,c=this.profile.numSegments,l=this.numExtrusionProfiles-1,e=c*l*6;this.startCap.indexBufferStart=e;this.startCap.firstProfileVertexIndex=0;e+=this.startCap.getNumIndices();this.endCap.indexBufferStart=e;this.endCap.firstProfileVertexIndex=
b*(this.numExtrusionProfiles-1);e+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(e);this.normalIndices=new Uint32Array(e);this.pathVertexIndices=new Uint32Array(e);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(e));for(e=0;e<c;++e)for(var k=this.profile.vertexIndices[2*e],g=this.profile.vertexIndices[2*e+1],f=0;f<l;++f){var h=f*b+k,m=(f+1)*b+g,n=f*b+g;a(h,(f+1)*b+k,m);a(h,m,n)}this.startCap.buildTopology(this.path.vertices[0],a);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-
1],a)};h.prototype.onPathChanged=function(){this.rebuildGeometry()};return h}();w.Builder=p;p=function(){function c(a){this.builder=a}Object.defineProperty(c.prototype,"xform",{get:function(){return this.builder.path.xform},enumerable:!0,configurable:!0});c.prototype.onPathChanged=function(){this.builder.onPathChanged()};return c}();w.PathGeometry=p;var O=function(h){function a(b){b=h.call(this,b)||this;b.vertexAttributePosition=null;b.vertexAttributeNormal=null;b.vertexAttributeColor=null;b.vertexAttributePosition=
new Float32Array(3*b.builder.numVerticesTotal);b.vertexAttributeNormal=new Float32Array(3*b.builder.numNormalsTotal);b.vertexAttributeColor=new Uint8Array(4);b.vertexAttributeColor[0]=255;b.vertexAttributeColor[1]=255;b.vertexAttributeColor[2]=255;b.vertexAttributeColor[3]=255;return b}D(a,h);a.prototype.bakeVertexColors=function(b){this.vertexAttributeColor[0]=255*b[0];this.vertexAttributeColor[1]=255*b[1];this.vertexAttributeColor[2]=255*b[2];this.vertexAttributeColor[3]=255*(3<b.length?b[3]:1)};
a.prototype.bakeVertexPositions=function(b){this.size=b;for(var a=0;a<this.builder.numVerticesTotal;++a){var l=this.builder.pathVertexData[a],e=0===l||l===this.builder.path.vertices.length-1,k=V;c.vec3.set(k,this.builder.originData[3*l+0],this.builder.originData[3*l+1],this.builder.originData[3*l+2]);l=n;c.vec3.set(l,this.builder.profileRightAxisData[4*a+0]*b[0]+this.builder.profileUpAxisData[4*a+0]*b[1],this.builder.profileRightAxisData[4*a+1]*b[0]+this.builder.profileUpAxisData[4*a+1]*b[1],this.builder.profileRightAxisData[4*
a+2]*b[0]+ +this.builder.profileUpAxisData[4*a+2]*b[1]);if(e)e=m,c.vec3.set(e,this.builder.auxVectorData[3*a+0]*b[0],this.builder.auxVectorData[3*a+1]*b[0],this.builder.auxVectorData[3*a+2]*b[0]),c.vec3.add(l,l,e);else{var e=m,g=x;c.vec3.set(e,this.builder.auxVectorData[3*a+0],this.builder.auxVectorData[3*a+1],this.builder.auxVectorData[3*a+2]);var f=c.vec3.length(e);c.vec3.normalize(e,e);var h=c.vec3.dot(l,e),p=K.sign(h);c.vec3.scale(g,e,h);c.vec3.subtract(g,l,g);Math.abs(h)>f&&(c.vec3.scale(e,e,
f*p),c.vec3.add(l,e,g))}this.vertexAttributePosition[3*a+0]=k[0]+l[0];this.vertexAttributePosition[3*a+1]=k[1]+l[1];this.vertexAttributePosition[3*a+2]=k[2]+l[2]}};a.prototype.computeNormals=function(){for(var a=this.builder.vertexIndices,d=this.vertexAttributePosition,l=a.length/3,e=0;e<this.vertexAttributeNormal.length;++e)this.vertexAttributeNormal[e]=0;for(var e=this.builder.profile.numSegments*(this.builder.numExtrusionProfiles-1)*2,k=0;k<e;k+=2){var g=this.builder.vertexIndices[3*k+0],f=this.builder.vertexIndices[3*
k+1],h=this.builder.vertexIndices[3*k+2],p=this.builder.vertexIndices[3*k+5];c.vec3.set(n,d[3*g+0],d[3*g+1],d[3*g+2]);c.vec3.set(m,d[3*f+0],d[3*f+1],d[3*f+2]);c.vec3.set(x,d[3*h+0],d[3*h+1],d[3*h+2]);c.vec3.subtract(m,m,n);c.vec3.subtract(x,x,n);c.vec3.normalize(m,m);c.vec3.normalize(x,x);c.vec3.cross(q,m,x);this.vertexAttributeNormal[3*g+0]+=q[0];this.vertexAttributeNormal[3*g+1]+=q[1];this.vertexAttributeNormal[3*g+2]+=q[2];this.vertexAttributeNormal[3*f+0]+=q[0];this.vertexAttributeNormal[3*f+
1]+=q[1];this.vertexAttributeNormal[3*f+2]+=q[2];this.vertexAttributeNormal[3*h+0]+=q[0];this.vertexAttributeNormal[3*h+1]+=q[1];this.vertexAttributeNormal[3*h+2]+=q[2];this.vertexAttributeNormal[3*p+0]+=q[0];this.vertexAttributeNormal[3*p+1]+=q[1];this.vertexAttributeNormal[3*p+2]+=q[2]}for(;k<l;++k)g=a[3*k+0],f=a[3*k+1],h=a[3*k+2],c.vec3.set(n,d[3*g+0],d[3*g+1],d[3*g+2]),c.vec3.set(m,d[3*f+0],d[3*f+1],d[3*f+2]),c.vec3.set(x,d[3*h+0],d[3*h+1],d[3*h+2]),c.vec3.subtract(m,m,n),c.vec3.subtract(x,x,
n),c.vec3.normalize(m,m),c.vec3.normalize(x,x),c.vec3.cross(q,m,x),this.vertexAttributeNormal[3*g+0]+=q[0],this.vertexAttributeNormal[3*g+1]+=q[1],this.vertexAttributeNormal[3*g+2]+=q[2],this.vertexAttributeNormal[3*f+0]+=q[0],this.vertexAttributeNormal[3*f+1]+=q[1],this.vertexAttributeNormal[3*f+2]+=q[2],this.vertexAttributeNormal[3*h+0]+=q[0],this.vertexAttributeNormal[3*h+1]+=q[1],this.vertexAttributeNormal[3*h+2]+=q[2];a=this.vertexAttributeNormal.length/3;for(e=0;e<a;++e)c.vec3.set(n,this.vertexAttributeNormal[3*
e+0],this.vertexAttributeNormal[3*e+1],this.vertexAttributeNormal[3*e+2]),c.vec3.normalize(n,n),this.vertexAttributeNormal[3*e+0]=n[0],this.vertexAttributeNormal[3*e+1]=n[1],this.vertexAttributeNormal[3*e+2]=n[2]};a.prototype.createGeometryData=function(){var a={};a[C.VertexAttrConstants.POSITION]=this.builder.vertexIndices;a[C.VertexAttrConstants.NORMAL]=this.builder.normalIndices;this.vertexAttributeColor&&(a[C.VertexAttrConstants.COLOR]=new Uint32Array(a[C.VertexAttrConstants.POSITION].length));
var c={};c[C.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition};c[C.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal};this.vertexAttributeColor&&(c[C.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor});return new F(c,a,F.DefaultOffsets,"triangle")};a.prototype.onPathChanged=function(){h.prototype.onPathChanged.call(this);this.bakeVertexPositions(this.size);this.computeNormals()};a.prototype.intersect=function(a,c,h){var b=this.builder.vertexIndices;
P.intersectTriangles(a,c,0,b.length/3,b,{size:3,offsetIdx:0,strideIdx:3,data:this.vertexAttributePosition},void 0,h)};return a}(p);w.StaticPathGeometry=O;p=function(c){function a(a,d,h,e){var b=c.call(this,a)||this;b.sizeAttributeValue=d;b.colorAttributeValue=h;b.opacityAttributeValue=e;b.vvData=null;b.data=null;b.baked=new O(a);b.baked.bakeVertexPositions([1,1]);b.baked.computeNormals();b.data=new Float32Array(9*b.builder.numVerticesTotal);for(var g=0;g<b.builder.numVerticesTotal;++g){var f=9*g;
b.data[f+0]=a.profileRightAxisData[4*g+0];b.data[f+1]=a.profileRightAxisData[4*g+1];b.data[f+2]=a.profileRightAxisData[4*g+2];b.data[f+3]=a.profileUpAxisData[4*g+0];b.data[f+4]=a.profileUpAxisData[4*g+1];b.data[f+5]=a.profileUpAxisData[4*g+2];b.data[f+6]=a.auxVectorData[3*g+0];b.data[f+7]=a.auxVectorData[3*g+1];b.data[f+8]=a.auxVectorData[3*g+2]}b.vvData=new Float32Array(4*b.builder.path.vertices.length);for(g=0;g<b.builder.path.vertices.length;++g)b.vvData[4*g+0]=d,b.vvData[4*g+1]=h,b.vvData[4*g+
2]=e,b.vvData[4*g+3]=0===g||g===b.builder.path.vertices.length-1?1:0;return b}D(a,c);a.prototype.createGeometryData=function(){var a={};a[B.VertexAttrConstants.POSITION]=this.builder.pathVertexIndices;a[B.VertexAttrConstants.NORMAL]=this.builder.normalIndices;a[B.VertexAttrConstants.PATHGEOMETRYINFO]=this.builder.vertexIndices;a[B.VertexAttrConstants.FEATUREVALUE]=this.builder.pathVertexIndices;var c={};c[B.VertexAttrConstants.POSITION]={size:3,data:this.builder.originData};c[B.VertexAttrConstants.NORMAL]=
{size:3,data:this.baked.vertexAttributeNormal};c[B.VertexAttrConstants.PATHGEOMETRYINFO]={size:9,data:this.data};c[B.VertexAttrConstants.FEATUREVALUE]={size:4,data:this.vvData};return new F(c,a,F.DefaultOffsets,"triangle")};return a}(p);w.FastUpdatePathGeometry=p})(A||(A={}));var v=u.vec3f64.create(),V=u.vec3f64.create(),T=u.vec3f64.fromValues(0,0,0),U=y.vec2f64.create(),n=u.vec3f64.create(),m=u.vec3f64.create(),x=u.vec3f64.create(),q=u.vec3f64.create(),G=u.vec3f64.create(),Q=A.makeFrame(),R=A.makeFrame(),
H=M.mat4f64.create();return A});