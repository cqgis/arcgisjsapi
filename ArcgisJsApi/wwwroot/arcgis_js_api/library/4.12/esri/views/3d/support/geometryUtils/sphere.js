// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../geometryUtils ../mathUtils ../stack ./ray".split(" "),function(I,d,B,C,D,r,e,g,E,l,h,m){function n(a){return a?{radius:a.radius,center:g.vec3f64.clone(a.center)}:{radius:1,center:g.vec3f64.create()}}function t(a,b){void 0===b&&(b=n());return u(a.radius,a.center,b)}function u(a,
b,c){void 0===c&&(c=n());e.vec3.copy(c.center,b);c.radius=a;return c}function k(a,b,c){var d=e.vec3.subtract(h.sv3d.get(),b.origin,a.center),f=e.vec3.dot(b.direction,b.direction),g=2*e.vec3.dot(b.direction,d);a=e.vec3.dot(d,d)-a.radius*a.radius;a=g*g-4*f*a;if(0>a)return!1;d=Math.sqrt(a);a=(-g-d)/(2*f);f=(-g+d)/(2*f);if(0>a||f<a&&0<f)a=f;if(0>a)return!1;c&&e.vec3.add(c,b.origin,e.vec3.scale(h.sv3d.get(),b.direction,a));return!0}function v(a,b,c){var d=h.sv3d.get(),f=h.sm4d.get();e.vec3.cross(d,b.origin,
b.direction);e.vec3.cross(c,d,b.origin);e.vec3.scale(c,c,1/e.vec3.length(c)*a.radius);a=w(a,b.origin);b=E.vector.angle(b.origin,c);r.mat4.identity(f);r.mat4.rotate(f,f,b+a,d);e.vec3.transformMat4(c,c,f);return c}function x(a,b,c){b=e.vec3.subtract(h.sv3d.get(),b,a.center);b=e.vec3.scale(h.sv3d.get(),b,a.radius/e.vec3.length(b));return e.vec3.add(c,b,a.center)}function w(a,b){b=e.vec3.subtract(h.sv3d.get(),b,a.center);b=e.vec3.length(b);return l.acos(a.radius/(a.radius+Math.abs(a.radius-b)))}function y(a,
b,c,d){a=e.vec3.subtract(p,b,a.center);switch(c){case 0:return a=l.cartesianToSpherical(a,p),a=a[2],e.vec3.set(d,-Math.sin(a),Math.cos(a),0);case 1:return a=l.cartesianToSpherical(a,p),c=a[1],a=a[2],b=Math.sin(c),e.vec3.set(d,-b*Math.cos(a),-b*Math.sin(a),Math.cos(c));case 2:return e.vec3.normalize(d,a);default:B.neverReached(c)}}function z(a,b){b=e.vec3.subtract(q,b,a.center);return e.vec3.length(b)-a.radius}Object.defineProperty(d,"__esModule",{value:!0});var F=C.getLogger("esri.views.3d.support.geometryUtils.sphere");
d.create=n;d.wrap=function(a,b){var c=G.get();c.radius=a;c.center=b||A;return c};d.copy=t;d.fromValues=u;d.elevate=function(a,b,c){a!==c&&e.vec3.copy(c.center,a.center);c.radius=a.radius+b;return c};d.setExtent=function(a,b,c){F.error("sphere.setExtent is not yet supported");return a===c?c:t(a,c)};d.intersectRay=k;d.intersectScreen=function(a,b,c,d){b=m.fromScreenAtEye(b,c,H);return k(a,b,d)};d.intersectsRay=function(a,b){return k(a,b,null)};d.intersectRayClosestSilhouette=function(a,b,c){if(k(a,
b,c))return c;a=v(a,b,h.sv3d.get());e.vec3.add(c,b.origin,e.vec3.scale(h.sv3d.get(),b.direction,e.vec3.distance(b.origin,a)/e.vec3.length(b.direction)));return c};d.closestPointOnSilhouette=v;d.closestPoint=function(a,b,c){if(k(a,b,c))return c;m.closestPoint(b,a.center,c);return x(a,c,c)};d.projectPoint=x;d.distanceToSilhouette=function(a,b){b=e.vec3.subtract(h.sv3d.get(),b,a.center);b=e.vec3.squaredLength(b);return Math.sqrt(Math.abs(b-a.radius*a.radius))};d.angleToSilhouette=w;var p=g.vec3f64.create();
d.axisAt=y;d.altitudeAt=z;d.setAltitudeAt=function(a,b,c,d){var f=z(a,b);a=y(a,b,2,q);c=e.vec3.scale(q,a,c-f);e.vec3.add(d,b,c);return d};var G=new D.ObjectStack(function(){return{center:null,radius:0}}),H=m.create(),A=g.vec3f64.create(),q=g.vec3f64.create();Object.freeze(A)});