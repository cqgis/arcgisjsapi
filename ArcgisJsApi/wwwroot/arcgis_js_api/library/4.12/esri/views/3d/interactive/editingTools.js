// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/3d/interactive/editingTools/graphicMove3D/GraphicMove3DTool":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/Collection ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/accessorSupport/decorators ../../../../draw/support/drawUtils ../../../../interactive/GraphicManipulator ../../../../interactive/InteractiveToolBase".split(" "),
function(r,b,e,q,t,u,a,f,l,d,c,h){Object.defineProperty(b,"__esModule",{value:!0});var C=function(){return function(a){this.allGraphics=a;this.type="graphic-move-start"}}();b.GraphicMoveStartEvent=C;var B=function(){return function(a,c,p){this.dx=a;this.dy=c;this.allGraphics=p;this.type="graphic-move"}}();b.GraphicMoveEvent=B;var m=function(){return function(a){this.allGraphics=a;this.type="graphic-move-stop"}}();b.GraphicMoveStopEvent=m;r=function(n){function k(c){c=n.call(this,c)||this;c.graphics=
new t;c.type="move-3d";c._handles=new a;return c}q(k,n);k.prototype.initialize=function(){var a=this;this._handles.add(this.graphics.on("change",function(){a._refreshGraphicManipulators()}));this._refreshGraphicManipulators()};k.prototype.destroy=function(){this._handles.destroy();this._handles=null;this.graphics.removeAll();this._set("view",null)};k.prototype.reset=function(){this.graphics.removeAll()};k.prototype._refreshGraphicManipulators=function(){var a=this;this._handles.remove("graphics");
this.manipulators.removeAll();var k=this.graphics.toArray().map(function(d){d=new c.GraphicManipulator({graphic:d,view:a.view,selectable:!0});a.manipulators.add(d);return d}),n=0;k.forEach(function(c){c.on("drag",function(p){k.forEach(function(a){var k=f.expect(a.graphic.geometry);if("mesh"===k.type)return!1;a!==c&&(a.graphic.geometry=d.move(k.clone(),p.dxMap,p.dyMap))});a.emit("graphic-move",new B(p.dx,p.dy,a.graphics.toArray()))});c.on("click",function(){return a.emit("click")});var p=c.watch("dragging",
function(d){d?(n++,1===n&&(a.emit("graphic-move-start",new C(a.graphics.toArray())),k.forEach(function(a){a!==c&&(a.interactive=!1)}))):(n--,0===n&&(a.emit("graphic-move-stop",new m(a.graphics.toArray())),k.forEach(function(a){a.interactive=!0})))},!0),h=c.watch("hovering",function(c){a.cursor=c?"move":null},!0);a._handles.add(p,"graphics");a._handles.add(h,"graphics")})};e([l.property({constructOnly:!0,nonNullable:!0})],k.prototype,"view",void 0);e([l.property({readOnly:!0})],k.prototype,"graphics",
void 0);e([l.property({value:null})],k.prototype,"cursor",void 0);e([l.property({readOnly:!0})],k.prototype,"type",void 0);return k=e([l.subclass("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMove3DTool")],k)}(l.declared(h.InteractiveToolBase,u));b.GraphicMove3DTool=r})},"esri/views/draw/support/drawUtils":function(){define(["require","exports","../../../geometry/support/aaBoundingRect","../../../geometry/support/boundsUtils","../../../geometry/support/coordsUtils"],function(r,b,e,
q,t){function u(a,f,b){if("point"===a.type)return a.x+=f,a.y+=b,a;if("multipoint"===a.type){var d=a.points,c;for(c in d){var h=d[c],l=h[0],h=h[1];d[c]=[l+f,h+b]}return a}if("extent"===a.type)return a.xmin+=f,a.xmax+=f,a.ymin+=b,a.ymax+=b,a;var d=t.geometryToCoordinates(a),e="polyline"===a.type?a.paths:a.rings,m;for(m in d){var n=d[m];for(c in n)h=n[c],l=h[0],h=h[1],e[m][c]=[l+f,h+b]}"paths"in a?a.paths=e:a.rings=e;return a}Object.defineProperty(b,"__esModule",{value:!0});b.move=u;b.cloneMove=function(a,
f,b,d,c){a=a.clone();var h=d.resolution;if("point"===a.type){if(c)u(a,f*h,-b*h);else{c=d.state.transform;d=d.state.inverseTransform;var e=c[0]*a.x+c[2]*a.y+c[4],l=c[1]*a.x+c[3]*a.y+c[5];a.x=d[0]*(e+f)+d[2]*(l+b)+d[4];a.y=d[1]*(e+f)+d[3]*(l+b)+d[5]}return a}if("multipoint"===a.type){if(c)u(a,f*h,-b*h);else{h=a.points;c=d.state.transform;d=d.state.inverseTransform;for(var m in h){var e=h[m],l=c[0]*e[0]+c[2]*e[1]+c[4],n=c[1]*e[0]+c[3]*e[1]+c[5],e=d[0]*(l+f)+d[2]*(n+b)+d[4],l=d[1]*(l+f)+d[3]*(n+b)+d[5];
h[m]=[e,l]}}return a}if("extent"===a.type){if(c)u(a,f*h,-b*h);else{c=d.state.transform;d=d.state.inverseTransform;m=c[0]*a.xmin+c[2]*a.ymin+c[4];var k=c[1]*a.xmin+c[3]*a.ymin+c[5],h=c[0]*a.xmax+c[2]*a.ymax+c[4];c=c[1]*a.xmax+c[3]*a.ymax+c[5];a.xmin=d[0]*(m+f)+d[2]*(k+b)+d[4];a.ymin=d[1]*(m+f)+d[3]*(k+b)+d[5];a.xmax=d[0]*(h+f)+d[2]*(c+b)+d[4];a.ymax=d[1]*(h+f)+d[3]*(c+b)+d[5]}return a}if(c)u(a,f*h,-b*h);else{var p=t.geometryToCoordinates(a),h="polyline"===a.type?a.paths:a.rings;c=d.state.transform;
d=d.state.inverseTransform;for(k in p){var A=p[k];for(m in A)e=A[m],l=c[0]*e[0]+c[2]*e[1]+c[4],n=c[1]*e[0]+c[3]*e[1]+c[5],e=d[0]*(l+f)+d[2]*(n+b)+d[4],l=d[1]*(l+f)+d[3]*(n+b)+d[5],h[k][m]=[e,l]}"paths"in a?a.paths=h:a.rings=h}return a};b.scale=function(a,f,b,d,c){if("point"===a.type){d=a.x;var h=a.y,l=c?c[0]:d;c=c?c[1]:h;a=a.clone();a.x=(d-l)*f+l;a.y=(h-c)*b+c;return a}if("multipoint"===a.type){var u=t.geometryToCoordinates(a);d=e.create();h=q.getRingsOrPathsBounds(d,[u]);u=h[0];d=h[1];var m=h[2],
h=h[3],u=c?c[0]:(u+m)/2,m=c?c[1]:(h+d)/2,n=a.clone(),k=n.points;for(l in k)a=k[l],d=a[0],h=a[1],a=(d-u)*f+u,c=(h-m)*b+m,k[l]=[a,c];return n}if("extent"===a.type)return l=a.xmin,u=a.xmax,d=a.ymin,m=a.ymax,h=c?c[0]:(l+u)/2,c=c?c[1]:(m+d)/2,a=a.clone(),a.xmin=(l-h)*f+h,a.ymax=(m-c)*b+c,a.xmax=(u-h)*f+h,a.ymin=(d-c)*b+c,a.xmin>a.xmax&&(f=a.xmin,a.xmin=a.xmax,a.xmax=f),a.ymin>a.ymax&&(f=a.ymin,a.ymin=a.ymax,a.ymax=f),a;m=t.geometryToCoordinates(a);d=e.create();k=q.getRingsOrPathsBounds(d,m);h=k[0];d=k[1];
var n=k[2],k=k[3],n=c?c[0]:(h+n)/2,k=c?c[1]:(k+d)/2,p=a.clone(),A="polyline"===p.type?p.paths:p.rings;for(u in m){var x=m[u];for(l in x)a=x[l],d=a[0],h=a[1],a=(d-n)*f+n,c=(h-k)*b+k,A[u][l]=[a,c]}"paths"in p?p.paths=A:p.rings=A;return p};b.getScaleRatio=function(a,f,b,d,c,h){return Math.sqrt((c-a)*(c-a)+(h-f)*(h-f))/Math.sqrt((b-a)*(b-a)+(d-f)*(d-f))};b.getRotationAngle=function(a,f,b,d,c,h){return 180*Math.atan2(f-h,a-c)/Math.PI-180*Math.atan2(f-d,a-b)/Math.PI}})},"esri/views/interactive/GraphicManipulator":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/Accessor ../../core/Collection ../../core/Logger ../../core/maybe ../../core/screenUtils ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../../geometry/support/webMercatorUtils ../../symbols/support/defaults ../../views/3d/support/projectionUtils ../draw/support/drawUtils ../../views/support/drapedUtils".split(" "),
function(r,b,e,q,t,u,a,f,l,d,c,h,C,B,m,n,k,p){Object.defineProperty(b,"__esModule",{value:!0});var A=a.getLogger("esri.views.interactive.GraphicManipulator");r=function(a){function b(c){c=a.call(this)||this;c.layer=null;c.interactive=!0;c.selectable=!1;c.dragging=!1;c._handlers=new u;c._circleCollisionCache=null;c._originalSymbol=null;return c}q(b,a);Object.defineProperty(b.prototype,"graphic",{get:function(){return this._get("graphic")},set:function(a){"mesh"===f.get(a.geometry,"type")?A.error("Mesh geometries are not supported"):
(this._circleCollisionCache=null,this._originalSymbol=a.symbol,this._set("graphic",a))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"focusedSymbol",{set:function(a){a!==this._get("focusedSymbol")&&(this._set("focusedSymbol",a),this._updateGraphicSymbol(),this._circleCollisionCache=null)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"grabbing",{set:function(a){if(a!==this._get("grabbing")){var c=this._focused;this._set("grabbing",a);this._updateGraphicSymbol(c)}},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hovering",{set:function(a){if(a!==this._get("hovering")){var c=this._focused;this._set("hovering",a);this._updateGraphicSymbol(c)}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"selected",{set:function(a){a!==this._get("selected")&&(this._set("selected",a),this._updateGraphicSymbol())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},
enumerable:!0,configurable:!0});b.prototype.destroy=function(){this._resetGraphicSymbol();this._handlers.removeAll();this._handlers=null;this._set("view",null)};b.prototype.intersectionDistance=function(a){var c=this._get("graphic"),b=this._get("focusedSymbol"),b=f.isSome(b)?b:c.symbol,d=c.geometry;if(f.isNone(d))return null;var p=this._get("view");return"2d"===p.type?this._intersect2D(a,p,d,b):this._intersect3D(a,p,c)};b.prototype.attemptDragTo=function(a,c){if(f.isNone(this.graphic.geometry)||"mesh"===
this.graphic.geometry.type)return!1;var b=this.view.toMap(c.previous),d=this.view.toMap(a.screenPoint),p=a.screenPoint.x-c.previous.x;c=a.screenPoint.y-c.previous.y;var h=0,e=0;if(!b||!d)return!1;e=[0,0,0,0,0,0];n.bufferToBuffer([b.x,b.y,0,d.x,d.y,0],b.spatialReference,0,e,this.graphic.geometry.spatialReference,0,2);h=e[3]-e[0];e=e[4]-e[1];if(0===h&&0===e)return!0;this.graphic.geometry=k.move(this.graphic.geometry.clone(),h,e);var g={screenPoint:a.screenPoint,dxMap:h,dyMap:e,dx:p,dy:c};this._handlers.forEach(function(a){var c=
a.handler;"drag"===a.type&&c(g)});return!0};b.prototype.click=function(a){this._handlers.forEach(function(c){"click"===c.type&&c.handler(a)})};b.prototype.on=function(a,c){this._handlers.push({type:a,handler:c})};b.prototype.attach=function(){f.isNone(this.layer)||this.layer.add(this.graphic)};b.prototype.detach=function(){this._resetGraphicSymbol();f.isNone(this.layer)||this.layer.remove(this.graphic)};b.prototype._updateGraphicSymbol=function(a){void 0===a&&(a=this._focused);a!==this._focused&&
(a=this.graphic.symbol,a!==this._originalSymbol&&a!==this.focusedSymbol&&(this._originalSymbol=a));this.graphic.symbol=this._focused&&f.isSome(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol};b.prototype._resetGraphicSymbol=function(){this.graphic.symbol=this._originalSymbol};b.prototype._intersect2D=function(a,b,d,k){k=k||m.getDefaultSymbol2D(d);if(f.isNone(k))return null;var n=this._circleCollisionCache;if("point"!==d.type||"simple-marker"!==k.type)return n=p.intersectsDrapedGeometry(a,
d,b),f.isSome(n)?1:null;if(f.isNone(n)||!n.originalPoint.equals(d)){var h=b.spatialReference;B.canProject(d,h)&&(n=B.project(d,h),this._circleCollisionCache=n={originalPoint:d.clone(),mapPoint:n,radiusPx:l.pt2px(k.size)})}return f.isSome(n)?(a=l.screenPointObjectToArray(a,z),b=b.state.toScreen(y,n.mapPoint.x,n.mapPoint.y),n=n.radiusPx,c.vec2.squaredDistance(a,b)<n*n?1:null):null};b.prototype._intersect3D=function(a,c,b){a=c.toMap(a,{include:[b]});if(!a)return null;b=x;return c.renderCoordsHelper.toRenderCoords(a,
b)?h.vec3.distance(b,c.state.camera.eye):null};e([d.property({constructOnly:!0,nonNullable:!0})],b.prototype,"graphic",null);e([d.property({constructOnly:!0,nonNullable:!0})],b.prototype,"view",void 0);e([d.property({value:null})],b.prototype,"focusedSymbol",null);e([d.property({constructOnly:!0})],b.prototype,"layer",void 0);e([d.property()],b.prototype,"interactive",void 0);e([d.property()],b.prototype,"selectable",void 0);e([d.property({value:!1})],b.prototype,"grabbing",null);e([d.property()],
b.prototype,"dragging",void 0);e([d.property()],b.prototype,"hovering",null);e([d.property({value:!1})],b.prototype,"selected",null);return b=e([d.subclass("esri.views.interactive.GraphicManipulator")],b)}(d.declared(t));b.GraphicManipulator=r;var x=C.vec3f64.create(),z=l.createScreenPointArray(),y=l.createScreenPointArray()})},"esri/views/support/drapedUtils":function(){define("require exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils".split(" "),
function(r,b,e,q,t,u){function a(a,b,c,f){void 0===f&&(f=new e.Extent);var d;if("2d"===c.type)d=b*c.resolution;else if("3d"===c.type){var h=c.basemapTerrain,m=h.overlayManager,m=m?m.overlayPixelSizeInMapUnits(a):1;d=h&&!h.spatialReference.equals(c.spatialReference)?t.getMetersPerUnitForSR(h.spatialReference)/t.getMetersPerUnitForSR(c.spatialReference):b*m}b=a.x-d;h=a.y-d;m=a.x+d;a=a.y+d;c=c.spatialReference;f.xmin=Math.min(b,m);f.ymin=Math.min(h,a);f.xmax=Math.max(b,m);f.ymax=Math.max(h,a);f.spatialReference=
c;return f}Object.defineProperty(b,"__esModule",{value:!0});b.createQueryGeometry=a;b.intersectsDrapedGeometry=function(b,d,c){b=c.toMap(b);if(q.isNone(b))return null;var h=u.calculateTolerance();return a(b,h,c,f).intersects(d)?b:null};var f=new e.Extent})},"esri/renderers/support/clickToleranceUtils":function(){define(["require","exports"],function(r,b){function e(b,a){return a&&a.xoffset?Math.max(b,Math.abs(a.xoffset)):a&&a.yoffset?Math.max(b,Math.abs(a.yoffset)):b}function q(b,a){if("number"===
typeof b)return b;if(b&&b.stops&&b.stops.length){b=b.stops;for(var f=a=0,e=0;e<b.length;e++){var d=b[e].size;"number"===typeof d&&(a+=d,f++)}return a/f}return a}function t(b,a){if(!a)return b;a=a.filter(function(a){return"size"===a.type}).map(function(a){var c=a.minSize;return(q(a.maxSize,b)+q(c,b))/2});for(var f=0,e=a.length,d=0;d<e;d++)f+=a[d];return Math.max(Math.floor(f/e),b)}Object.defineProperty(b,"__esModule",{value:!0});b.calculateTolerance=function(b){if(!b)return 6;var a="visualVariables"in
b?t(6,b.visualVariables):6;if("simple"===b.type)return e(a,b.symbol);if("unique-value"===b.type){var f=a;b.uniqueValueInfos.forEach(function(a){f=e(f,a.symbol)});return f}if("class-breaks"===b.type){var l=a;b.classBreakInfos.forEach(function(a){l=e(l,a.symbol)});return l}return a}})},"esri/views/interactive/InteractiveToolBase":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/accessorSupport/decorators ./interactiveToolUtils ./ManipulatorCollection".split(" "),
function(r,b,e,q,t,u,a,f,l){Object.defineProperty(b,"__esModule",{value:!0});r=function(b){function c(a){a=b.call(this)||this;a.manipulators=new l.ManipulatorCollection;a._attached=!1;a._editableFlags=[];a._manipulatorHandles=new u;return a}e(c,b);Object.defineProperty(c.prototype,"active",{get:function(){return this.view.activeTool===this},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isSupported",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"visible",{set:function(a){this._set("visible",a);this._attached&&(a?this._show():this._hide())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"editable",{get:function(){return this.hasEditableFlag(0)},set:function(a){this.setEditableFlag(0,a)},enumerable:!0,configurable:!0});c.prototype.attach=function(){if(!this._attached&&this.isSupported){this.manipulators.attach();this.onAttach();if(this.visible)this.onShow();this._attached=!0}};c.prototype.detach=function(){this._attached&&
(this.onHide(),this.onDetach(),this.manipulators.detach(),this._manipulatorHandles.removeAll(),this._attached=!1)};c.prototype.handleInputEvent=function(a){if(this._attached)this.onInputEvent(a)};c.prototype.destroy=function(){this.manipulators.destroy();this._manipulatorHandles.removeAll();this._manipulatorHandles=null;this._set("view",null)};c.prototype.setEditableFlag=function(a,c){this._editableFlags[a]=c;this.manipulators.isToolEditable=this._editableFlags.every(function(a){return null==a||a});
this._updateManipulatorAttachment();0===a&&this.notifyChange("editable");this.onEditableChange()};c.prototype.hasEditableFlag=function(a){a=this._editableFlags[a];return null==a?!0:a};c.prototype.onAttach=function(){};c.prototype.onDetach=function(){};c.prototype.onShow=function(){};c.prototype.onHide=function(){};c.prototype.onEditableChange=function(){};c.prototype.onInputEvent=function(a){};Object.defineProperty(c.prototype,"internallyEditable",{get:function(){return this.hasEditableFlag(0)&&this.hasEditableFlag(1)},
enumerable:!0,configurable:!0});c.prototype._show=function(){this._updateManipulatorAttachment();this.onShow()};c.prototype._hide=function(){f.setActive(this,!1);this._updateManipulatorAttachment();this.onHide()};c.prototype._updateManipulatorAttachment=function(){this.visible?this.manipulators.attach():this.manipulators.detach()};q([a.property({constructOnly:!0})],c.prototype,"view",void 0);q([a.property({dependsOn:["view.activeTool"],readOnly:!0})],c.prototype,"active",null);q([a.property({value:!0})],
c.prototype,"visible",null);q([a.property({value:!0})],c.prototype,"editable",null);q([a.property({readOnly:!0})],c.prototype,"manipulators",void 0);return c=q([a.subclass("esri.views.interactive.InteractiveToolBase")],c)}(a.declared(t));b.InteractiveToolBase=r})},"esri/views/interactive/ManipulatorCollection":function(){define(["require","exports","../../core/tsSupport/decorateHelper","../../core/Collection","../../core/maybe"],function(r,b,e,q,t){Object.defineProperty(b,"__esModule",{value:!0});
r=function(){function b(){this._isToolEditable=!0;this._manipulators=new q;this._nextManipulatorId=0;this._resourceContexts={manipulator3D:{}};this._attached=!1}Object.defineProperty(b.prototype,"isToolEditable",{set:function(a){this._isToolEditable=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"length",{get:function(){return this._manipulators.length},enumerable:!0,configurable:!0});b.prototype.add=function(a,b){void 0===b&&(b=0);return this.addMany([a],b)[0]};b.prototype.addMany=
function(a,b){var f=this;void 0===b&&(b=0);return a.map(function(a){var c=f._nextManipulatorId++;a={id:c,manipulator:a,visibilityPredicate:b,attached:!1};f._manipulators.add(a);f._attached&&f._updateManipulatorAttachment(a);return c})};b.prototype.remove=function(a){if("number"===typeof a){for(var b=0;b<this._manipulators.length;b++)if(this._manipulators.getItemAt(b).id===a)return a=this._manipulators.splice(b,1)[0],this._detachManipulator(a),a.id;return null}for(b=0;b<this._manipulators.length;b++)if(this._manipulators.getItemAt(b).manipulator===
a)return a=this._manipulators.splice(b,1)[0],this._detachManipulator(a),a.id;return null};b.prototype.removeAll=function(){var a=this;this._manipulators.forEach(function(b){a._detachManipulator(b)});this._manipulators.removeAll()};b.prototype.attach=function(){var a=this;this._manipulators.forEach(function(b){a._updateManipulatorAttachment(b)});this._attached=!0};b.prototype.detach=function(){var a=this;this._manipulators.forEach(function(b){a._detachManipulator(b)});this._attached=!1};b.prototype.destroy=
function(){this._manipulators.forEach(function(a){a=a.manipulator;a.destroy&&a.destroy()});this._manipulators.destroy();this._resourceContexts=null};b.prototype.on=function(a,b){return this._manipulators.on("change",function(a){b(a)})};b.prototype.forEach=function(a){for(var b=0,e=this._manipulators.items;b<e.length;b++)a(e[b])};b.prototype.intersect=function(a,b){var f=null,d=Number.MAX_VALUE;this._manipulators.forEach(function(c){var e=c.id,l=c.manipulator;c.attached&&l.interactive&&(c=l.intersectionDistance(a,
b),t.isSome(c)&&c<d&&(d=c,f=e))});return f};b.prototype.findById=function(a){if(t.isNone(a))return null;for(var b=0,e=this._manipulators.items;b<e.length;b++){var d=e[b];if(a===d.id)return d.manipulator}return null};b.prototype._updateManipulatorAttachment=function(a){this._isManipulatorItemVisible(a)?this._attachManipulator(a):this._detachManipulator(a)};b.prototype._attachManipulator=function(a){a.attached||(a.manipulator.attach(this._resourceContexts),a.attached=!0)};b.prototype._detachManipulator=
function(a){if(a.attached){var b=a.manipulator;b.grabbing=!1;b.dragging=!1;b.hovering=!1;b.selected=!1;b.detach(this._resourceContexts);a.attached=!1}};b.prototype._isManipulatorItemVisible=function(a){return 2===a.visibilityPredicate?!0:this._isToolEditable?0===a.visibilityPredicate:1===a.visibilityPredicate};return b}();b.ManipulatorCollection=r})},"esri/views/3d/interactive/editingTools/graphicReshape3D/GraphicReshape3DTool":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ./isSupportedGraphic ./ReshapeOperation ./reshapeUtils ../../../../interactive/InteractiveToolBase".split(" "),
function(r,b,e,q,t,u,a,f,l,d,c,h,C,B){Object.defineProperty(b,"__esModule",{value:!0});var m=a.getLogger("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshape3DTool");r=function(a){function b(b){b=a.call(this,b)||this;b._handles=new u;b._reshapeOperation=null;b._internalGeometryUpdate=!1;b.type="reshape-3d";return b}q(b,a);b.prototype.destroy=function(){this._handles.removeAll();this._set("view",null);this._set("graphic",null)};Object.defineProperty(b.prototype,"graphic",{set:function(a){f.isSome(a)&&
!c.isSupportedGraphic(a)?m.error("Only polyline and polygon geometries are supported"):this._set("graphic",a)},enumerable:!0,configurable:!0});b.prototype._updateGeometry=function(){f.isSome(this.graphic)&&C.isReshapeGeometry(this.graphic.geometry)?this._reshapeOperation.inputGeometry=this.graphic.geometry.clone():this._reshapeOperation.inputGeometry=null};b.prototype._updateGraphic=function(){var a=this;this._handles.remove("onGraphicGeometryChange");this._updateGeometry();var b=this.watch("graphic.geometry",
function(){!1===a._internalGeometryUpdate&&a._updateGeometry()},!0);this._handles.add(b,"onGraphicGeometryChange")};b.prototype._onReshapeGeometryChanged=function(){f.isNone(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)};b.prototype.initialize=function(){var a=this;this._reshapeOperation=new h.ReshapeOperation({view:this.view,manipulators:this.manipulators});this._handles.add([this._reshapeOperation.watch("cursor",
function(){a.cursor=a._reshapeOperation.cursor}),this._reshapeOperation.on("reshape-operation-start",function(b){f.isNone(a.graphic)||(b.graphic=a.graphic,a.emit("reshape-start",b))}),this._reshapeOperation.on("vertex-move",function(b){a._onReshapeGeometryChanged();f.isSome(a.graphic)&&(b.graphic=a.graphic,a.emit("vertex-move",b))}),this._reshapeOperation.on("translate",function(b){a._onReshapeGeometryChanged();f.isSome(a.graphic)&&(b.graphic=a.graphic,a.emit("translate",b))}),this._reshapeOperation.on("vertex-add",
function(b){a._onReshapeGeometryChanged();f.isSome(a.graphic)&&(b.graphic=a.graphic,a.emit("vertex-add",b))}),this._reshapeOperation.on("vertex-remove",function(b){a._onReshapeGeometryChanged();f.isSome(a.graphic)&&(b.graphic=a.graphic,a.emit("vertex-remove",b))}),this._reshapeOperation.on("reshape-operation-stop",function(b){f.isNone(a.graphic)||(b.graphic=a.graphic,a.emit("reshape-stop",b))}),this._reshapeOperation.on("click",function(){return a.emit("click")}),l.init(this,"graphic",function(){a._updateGraphic()},
!0)])};b.prototype.handleInputEvent=function(a){"key-down"!==a.type||"Delete"!==a.key&&"Backspace"!==a.key||this._reshapeOperation.removeSelectedVertices()};b.prototype.reset=function(){this.graphic=null};e([d.property({constructOnly:!0,nonNullable:!0})],b.prototype,"view",void 0);e([d.property({value:null})],b.prototype,"graphic",null);e([d.property({readOnly:!0})],b.prototype,"type",void 0);e([d.property({value:null})],b.prototype,"cursor",void 0);return b=e([d.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshape3DTool")],
b)}(d.declared(B.InteractiveToolBase,t));b.GraphicReshape3DTool=r})},"esri/views/3d/interactive/editingTools/graphicReshape3D/isSupportedGraphic":function(){define(["require","exports","../../../../../core/maybe"],function(r,b,e){function q(b){return e.isSome(b)&&("polygon"===b.type||"polyline"===b.type)}Object.defineProperty(b,"__esModule",{value:!0});b.isSupportedGeometry=q;b.isSupportedGraphic=function(b){return q(b.geometry)}})},"esri/views/3d/interactive/editingTools/graphicReshape3D/ReshapeOperation":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/Accessor ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/accessorSupport/decorators ../../../../../layers/graphics/dehydratedFeatures ./ReshapeMoveManipulator ./reshapeUtils ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil ../../../../interactive/Manipulator3D ../../../../interactive/manipulatorUtils".split(" "),
function(r,b,e,q,t,u,a,f,l,d,c,h,C,B,m){Object.defineProperty(b,"__esModule",{value:!0});var n=function(){return function(a,b){void 0===a&&(a=!1);void 0===b&&(b=!1);this.isDragging=a;this.fromTranslation=b;this.graphic=null;this.type="reshape-start"}}();b.ReshapeStartEvent=n;var k=function(){return function(a){this.coords=a;this.graphic=null;this.type="vertex-move"}}();b.VertexMoveEvent=k;var p=function(){return function(a,b){this.dxScreen=a;this.dyScreen=b;this.graphic=null;this.type="translate"}}();
b.TranslateEvent=p;var A=function(){return function(a){this.coords=a;this.graphic=null;this.type="vertex-add"}}();b.VertexAddEvent=A;var x=function(){return function(a){this.coords=a;this.graphic=null;this.type="vertex-remove"}}();b.VertexRemoveEvent=x;var z=function(){return function(a,b){void 0===a&&(a=!1);void 0===b&&(b=!1);this.isDragging=a;this.fromTranslation=b;this.graphic=null;this.type="reshape-stop"}}();b.ReshapeStopEvent=z;r=function(b){function g(c){c=b.call(this,c)||this;c._vertexManipulatorMaterial=
m.createManipulatorMaterial([1,.5,0],1);c._edgeManipulatorMaterial=m.createManipulatorMaterial([.5,.5,.5],1);c._selectedManipulatorMaterial=m.createManipulatorMaterial([1,1,1],1);c._manipulatorGeometry=new h(C.createSphereGeometry(1,16,16),"reshape-manipulator");c._handles=new a;c._manipulatorInfos=[];c._reshapeHelper=null;c._moveManipulator=null;c._numDragging=0;c.manipulators=null;return c}q(g,b);g.prototype.destroy=function(){this._clear()};Object.defineProperty(g.prototype,"inputGeometry",{get:function(){return this._reshapeHelper?
this._reshapeHelper.geometry:null},set:function(a){this._recreateManipulators(a)},enumerable:!0,configurable:!0});g.prototype.removeSelectedVertices=function(){var a=this._manipulatorInfos.filter(function(a){return a.manipulator.selected&&"vertex"===a.handle.type});this._removeVertices(a)};g.prototype._clear=function(){this._handles.removeAll();this.manipulators.removeAll();this._manipulatorInfos=[];this._reshapeHelper=this._moveManipulator=null;this._numDragging=0};g.prototype._recreateManipulators=
function(a){var b=this;this._clear();this._reshapeHelper=c.createReshapeHelper(a,"global"===this.view.viewingMode);if(!this._reshapeHelper)return null;this._reshapeHelper.components.forEach(function(a){a.vertices.forEach(function(a){return b._createManipulator(a)});a.edges.forEach(function(a){return b._createManipulator(a)})});this._moveManipulator=new d.ReshapeMoveManipulator({view:this.view,reshapeHelper:this._reshapeHelper,selectable:!1});this._handles.add(this._moveManipulator.watch("grabbing",
function(a){b._manipulatorInfos.forEach(function(b){b.manipulator.interactive=!a})},!0),this._moveManipulator);this._handles.add(this._moveManipulator.watch("dragging",function(a){!0===a?(++b._numDragging,1===b._numDragging&&b.emit("reshape-operation-start",new n(!0,!0))):(--b._numDragging,0===b._numDragging&&b.emit("reshape-operation-stop",new z(!0,!0)))},!0),this._moveManipulator);this._handles.add(this._moveManipulator.watch("hovering",function(a){b.cursor=a?"move":null},!0),this._moveManipulator);
this._moveManipulator.on("drag",function(a){return b._moveManipulatorDragCallback(a)});this._moveManipulator.on("click",function(){return b.emit("click")});this.manipulators.add(this._moveManipulator)};g.prototype._clearManipulatorSelection=function(){this._manipulatorInfos.forEach(function(a){a.manipulator.selected=!1})};g.prototype._createManipulator=function(a){var b=this,c=new B.Manipulator3D({view:this.view,renderObjects:[{geometry:this._manipulatorGeometry,material:this._vertexManipulatorMaterial,
stateMask:E.Vertex|4},{geometry:this._manipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:E.Edge|4},{geometry:this._manipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8}],radius:5});c.alignment="on-the-ground";"vertex"===a.type?(c.state=E.Vertex,c.selectable=!0):(c.state=E.Edge,c.selectable=!1);var d={manipulator:c,handle:a};this._manipulatorInfos.push(d);this.manipulators.add(c);this._setManipulatorPosition(d);this._handles.add(c.watch("grabbing",function(a){b._moveManipulator.interactive=
!a},!0),c);this._handles.add(c.watch("dragging",function(a){!0===a?(++b._numDragging,1===b._numDragging&&b.emit("reshape-operation-start",new n(!0))):(--b._numDragging,0===b._numDragging&&b.emit("reshape-operation-stop",new z(!0)))},!0),c);this._handles.add(c.watch("hovering",function(a){b.cursor=a?"vertex"===d.handle.type?"move":"copy":null},!0),c);c.on("drag",function(){return b._manipulatorMoveCallback(d)});c.on("click",function(a){return b._manipulatorClickCallback(a,d)});return c};g.prototype._removeManipulator=
function(a){a&&(this._handles.remove(a.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(a),1),this.manipulators.remove(a.manipulator))};g.prototype._getManipulatorInfoFromHandle=function(a){if(a)for(var b=0,c=this._manipulatorInfos;b<c.length;b++){var d=c[b];if(a===d.handle)return d}return null};g.prototype._setManipulatorPosition=function(a){a&&("vertex"===a.handle.type?a.manipulator.mapPoint=this._reshapeHelper.getVertexPositionAsPoint(a.handle,y):"edge"===a.handle.type&&
(a.manipulator.mapPoint=this._reshapeHelper.getEdgePositionAsPoint(a.handle,.5,y)))};g.prototype._splitEdgeManipulator=function(a){if("edge"===a.handle.type){var b=this._reshapeHelper.splitEdge(a.handle,.5);a.handle=b;a.manipulator.state=E.Vertex;a.manipulator.selectable=!0;b.left&&this._createManipulator(b.left);b.right&&this._createManipulator(b.right);return b}return null};g.prototype._manipulatorMoveCallback=function(a){var b=this;"edge"===a.handle.type&&this._splitEdgeManipulator(a);if(a.handle&&
"vertex"===a.handle.type){!1===a.manipulator.selected&&(this._clearManipulatorSelection(),a.manipulator.selected=!0);var c=a.handle.pos,d=a.manipulator.mapPoint.x-c[0],n=a.manipulator.mapPoint.y-c[1],c=this._manipulatorInfos.filter(function(a){return a.manipulator.selected&&"vertex"===a.handle.type});c.forEach(function(c){var k=c.handle;k.pos[0]+=d;k.pos[1]+=n;a!==c&&(y.x=k.pos[0],y.y=k.pos[1],y.spatialReference=b._reshapeHelper.geometry.spatialReference,c.manipulator.mapPoint=y)});this.outputGeometry=
this._reshapeHelper.commit();c.forEach(function(a){a=a.handle;b._setManipulatorPosition(b._getManipulatorInfoFromHandle(a.left));b._setManipulatorPosition(b._getManipulatorInfoFromHandle(a.right))});c=c.map(function(a){return a.handle.unnormalizedPos});c=new k(c);this.emit("vertex-move",c)}};g.prototype._removeVertices=function(a){var b=this,c=[];a.forEach(function(a){"vertex"===a.handle.type&&b._reshapeHelper.canRemoveVertex(a.handle)&&(0===c.length&&b.emit("reshape-operation-start",new n),c.push(a.handle.unnormalizedPos),
b._removeManipulator(a),b._removeManipulator(b._getManipulatorInfoFromHandle(a.handle.left)),b._removeManipulator(b._getManipulatorInfoFromHandle(a.handle.right)),(a=b._reshapeHelper.removeVertex(a.handle))&&b._createManipulator(a))});0<c.length&&(this.outputGeometry=this._reshapeHelper.commit(),a=new x(c),this.emit("vertex-remove",a),this.emit("reshape-operation-stop",new z))};g.prototype._manipulatorClickCallback=function(a,b){"vertex"===b.handle.type&&2===a.button&&this._removeVertices([b]);"edge"===
b.handle.type&&0===a.button&&(this.emit("reshape-operation-start",new n),a=this._splitEdgeManipulator(b),this.outputGeometry=this._reshapeHelper.commit(),a=new A([a.unnormalizedPos]),this.emit("vertex-add",a),this.emit("reshape-operation-stop",new z))};g.prototype._moveManipulatorDragCallback=function(a){var b=this,c=[],d=!0;this._manipulatorInfos.forEach(function(n){"vertex"===n.handle.type&&(n.manipulator.grabbing?d=!1:"vertex"===n.handle.type&&(n.handle.pos[0]+=a.dxGeometry,n.handle.pos[1]+=a.dyGeometry,
c.push(n.handle.pos),b._setManipulatorPosition(n)))});this._manipulatorInfos.forEach(function(a){"vertex"!==a.handle.type&&b._setManipulatorPosition(a)});this.outputGeometry=this._reshapeHelper.commit();if(d)this.emit("translate",new p(a.dxScreen,a.dyScreen));else{var n=new k(c);this.emit("vertex-move",n)}};e([f.property({value:null,nonNullable:!0})],g.prototype,"view",void 0);e([f.property({value:null})],g.prototype,"inputGeometry",null);e([f.property({value:null})],g.prototype,"cursor",void 0);
e([f.property({value:null})],g.prototype,"outputGeometry",void 0);e([f.property({constructOnly:!0})],g.prototype,"manipulators",void 0);return g=e([f.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.ReshapeOperation")],g)}(f.declared(t,u));b.ReshapeOperation=r;var y=l.makeDehydratedPoint(0,0,null,null),E;(function(a){a.Vertex=16;a.Edge=32})(E||(E={}))})},"esri/views/3d/interactive/editingTools/graphicReshape3D/ReshapeMoveManipulator":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/Accessor ../../../../../core/Collection ../../../../../core/maybe ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../views/3d/support/projectionUtils ../../../../../views/3d/support/stack ../../../../../views/support/drapedUtils".split(" "),
function(r,b,e,q,t,u,a,f,l,d,c,h,C){Object.defineProperty(b,"__esModule",{value:!0});r=function(b){function d(a){a=b.call(this)||this;a._handlers=new u;a.interactive=!0;a.selectable=!1;a.grabbing=!1;a.dragging=!1;a.hovering=!1;a.selected=!1;return a}q(d,b);d.prototype.initialize=function(){};d.prototype.destroy=function(){this._handlers.removeAll();this._handlers=null;this._set("view",null)};d.prototype.intersectionDistance=function(b){if(!this.reshapeHelper.geometry)return null;b=C.intersectsDrapedGeometry(b,
this.reshapeHelper.geometry,this.view);if(a.isNone(b))return null;var c=h.sv3d.get();return this.view.renderCoordsHelper.toRenderCoords(b,c)?l.vec3.distance(B,this.view.state.camera.eye):null};d.prototype.attemptDragTo=function(a,b){if(null==this.reshapeHelper.geometry)return!1;var d=this.view.toMap(b.previous),n=this.view.toMap(a.screenPoint),e=0,f=0,k=0,p=0,h=0,m=0;d&&n&&(e=[0,0,0,0,0,0],c.bufferToBuffer([d.x,d.y,0,n.x,n.y,0],d.spatialReference,0,e,this.reshapeHelper.geometry.spatialReference,0,
2),k=e[3]-e[0],p=e[4]-e[1],e=n.x-d.x,f=n.y-d.y,h=a.screenPoint.x-b.previous.x,m=a.screenPoint.y-b.previous.y);var l={screenPoint:a.screenPoint,dxMap:e,dyMap:f,dxGeometry:k,dyGeometry:p,dxScreen:h,dyScreen:m,toMS:n};this._handlers.forEach(function(a){"drag"===a.type&&a.handler(l)});return!0};d.prototype.click=function(a){this._handlers.forEach(function(b){"click"===b.type&&b.handler(a)})};d.prototype.on=function(a,b){this._handlers.push({type:a,handler:b})};d.prototype.attach=function(){};d.prototype.detach=
function(){};e([f.property()],d.prototype,"reshapeHelper",void 0);e([f.property({constructOnly:!0,nonNullable:!0})],d.prototype,"view",void 0);e([f.property()],d.prototype,"interactive",void 0);e([f.property()],d.prototype,"selectable",void 0);e([f.property()],d.prototype,"grabbing",void 0);e([f.property()],d.prototype,"dragging",void 0);e([f.property()],d.prototype,"hovering",void 0);e([f.property()],d.prototype,"selected",void 0);return d=e([f.subclass("esri.views.interactive.GeometryManipulator")],
d)}(f.declared(t));b.ReshapeMoveManipulator=r;var B=d.vec3f64.create()})},"esri/views/3d/interactive/editingTools/graphicReshape3D/reshapeUtils":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../geometry/support/coordsUtils ../../../../../geometry/support/spatialReferenceUtils".split(" "),function(r,
b,e,q,t,u,a,f,l){function d(b,c,d){void 0===d&&(d=a.vec2f64.create());return u.vec2.set(d,b,c)}Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){this.vertices=[];this.edges=[]}a.prototype.makeVertex=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);a={pos:a,unnormalizedPos:a,left:b,right:c,type:"vertex",component:this};this.vertices.push(a);return a};a.prototype.makeEdge=function(a,b){var c={v0:a,v1:b,type:"edge",component:this};a.right=c;b.left=c;this.edges.push(c);
return c};a.prototype.removeVertex=function(a){this.vertices.splice(this.vertices.indexOf(a),1);a.left&&this.removeEdge(a.left);a.right&&this.removeEdge(a.right)};a.prototype.removeEdge=function(a){this.edges.splice(this.edges.indexOf(a),1);a.v0.right=null;a.v1.left=null};return a}();b.Component=c;b.makeMapPoint=d;r=function(){function b(a,b){this.geometry=a;this.doUnnormalization=b;this.components=[];(a=l.getInfo(this.geometry.spatialReference))?(this._spanMin=a.valid[0],this._spanMax=a.valid[1],
this._span=this._spanMax-this._spanMin):this.doUnnormalization=!1}b.prototype.getVertexPositionAsPoint=function(a,b){b.x=a.pos[0];b.y=a.pos[1];b.z=null;b.spatialReference=this.geometry.spatialReference;return b};b.prototype.getEdgePosition=function(b,c,e){void 0===e&&(e=a.vec2f64.create());return d((b.v1.unnormalizedPos[0]-b.v0.unnormalizedPos[0])*c+b.v0.unnormalizedPos[0],(b.v1.unnormalizedPos[1]-b.v0.unnormalizedPos[1])*c+b.v0.unnormalizedPos[1],e)};b.prototype.getEdgePositionAsPoint=function(a,
b,c){a=this.getEdgePosition(a,b,B);c.x=a[0];c.y=a[1];c.z=null;c.spatialReference=this.geometry.spatialReference;return c};b.prototype.canRemoveVertex=function(a){return!0};b.prototype.removeVertex=function(a){var b=a.component,c=a.left,d=a.right;b.removeVertex(a);return c&&d?b.makeEdge(c.v0,d.v1):null};b.prototype.splitEdge=function(a,b){var c=a.component;b=c.makeVertex(this.getEdgePosition(a,b));var d=a.v0,e=a.v1;c.removeEdge(a);c.makeEdge(d,b);c.makeEdge(b,e);return b};return b}();b.ReshapeHelper=
r;var h=function(a){function b(b,e){e=a.call(this,b,e)||this;e.geometry=b;b=e.geometry.rings;for(var h=0;h<b.length;++h){for(var n=b[h],k=new c,p=n.length-1,m=0;m<p;++m){var l=d(n[m][0],n[m][1]);k.makeVertex(l)}n=k.vertices.length-1;for(p=0;p<n;++p)k.makeEdge(k.vertices[p],k.vertices[p+1]);k.makeEdge(k.vertices[k.vertices.length-1],k.vertices[0]);e.doUnnormalization&&f.computeUnnormalizedVertexPositionsOnDateLineCrossing(k.vertices,e._spanMin,e._spanMax,e._span);e.components.push(k)}return e}q(b,
a);b.prototype.canRemoveVertex=function(a){return 3<a.component.vertices.length};b.prototype.commit=function(){var a=this,b=[];this.components.forEach(function(c){var d=[];a.doUnnormalization&&f.computeUnnormalizedVertexPositionsOnDateLineCrossing(c.vertices,a._spanMin,a._spanMax,a._span);var e=c.vertices[0],h=e;do d.push(e.unnormalizedPos),e=e.right.v1;while(e&&e!==h);d.push(c.vertices[0].unnormalizedPos);b.push(d)});this.geometry.rings=b;return this.geometry};return b}(r),C=function(a){function b(b,
e){e=a.call(this,b,e)||this;e.geometry=b;b=e.geometry.paths;for(var h=0;h<b.length;++h){for(var n=b[h],k=new c,m=n.length,p=0;p<m;++p){var l=d(n[p][0],n[p][1]);k.makeVertex(l)}n=k.vertices.length-1;for(m=0;m<n;++m)k.makeEdge(k.vertices[m],k.vertices[m+1]);e.doUnnormalization&&f.computeUnnormalizedVertexPositionsOnDateLineCrossing(k.vertices,e._spanMin,e._spanMax,e._span);e.components.push(k)}return e}q(b,a);b.prototype.canRemoveVertex=function(a){return 2<a.component.vertices.length};b.prototype.commit=
function(){var a=this,b=[];this.components.forEach(function(c){var d=[];a.doUnnormalization&&f.computeUnnormalizedVertexPositionsOnDateLineCrossing(c.vertices,a._spanMin,a._spanMax,a._span);var e=c=c.vertices[0];do d.push(c.unnormalizedPos),c=c.right?c.right.v1:null;while(c&&c!==e);b.push(d)});this.geometry.paths=b;return this.geometry};return b}(r);b.isReshapeGeometry=function(a){return t.isSome(a)&&("polygon"===a.type||"polyline"===a.type)};b.createReshapeHelper=function(a,b){return a?"polygon"===
a.type?new h(a,b):new C(a,b):null};var B=a.vec2f64.create()})},"esri/views/interactive/Manipulator3D":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/Accessor ../../core/Collection ../../core/compilerUtils ../../core/maybe ../../core/screenUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f64 ../../core/libs/gl-matrix-2/mat4 ../../core/libs/gl-matrix-2/mat4f64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../../geometry/support/aaBoundingRect ../../layers/graphics/dehydratedFeatures ../3d/support/geometryUtils ../3d/support/stack ../3d/webgl-engine/lib/Intersector ../3d/webgl-engine/lib/intersectorUtils ../3d/webgl-engine/lib/Layer ../3d/webgl-engine/lib/Object3D ../3d/webgl-engine/parts/Model".split(" "),
function(r,b,e,q,t,u,a,f,l,d,c,h,C,B,m,n,k,p,A,x,z,y,E,N,g,ba,G,K){function U(a){return 0!==a[12]||0!==a[13]||0!==a[14]}Object.defineProperty(b,"__esModule",{value:!0});r=function(b){function g(a){a=b.call(this)||this;a.hideOnGrab=!1;a.moveOnDrag=!0;a.snapToPointer=!0;a.collisionType={type:"point"};a.collisionPriority=0;a.renderObjects=[];a.autoScaleRenderObjects=!0;a._radius=10;a._worldSized=!1;a._focusMultiplier=2;a._touchMultiplier=2.5;a.interactive=!0;a.selectable=!1;a.dragging=!1;a._areAnyEngineObjectsVisible=
!1;a._position=A.vec3f64.create();a._modelTransform=m.mat4f64.create();a._dragOffset=null;a._dirtyScreenPoint=l.createScreenPoint();a._dirtyScreenPointArray=l.createScreenPointArray();a._dirtyRenderScreenPointArray=l.createRenderScreenPointArray3();a._dirtyOriginScreenPointArray=l.createScreenPointArray();a._dirtyScreenPixelSize=1;a._screenPositionDirty=!0;a._engineResourcesAddedToStage=!1;a._engineResources=null;a._attached=!1;a._engineLayerId=null;a._materialIdReferences=null;a._hitResult={onSurface:!1,
surfaceType:"ground"};a._handlers=new u;return a}q(g,b);g.prototype.initialize=function(){this._intersector=new N(this.view.viewingMode);this._mapPoint=z.makeDehydratedPoint(0,0,0,this.view.spatialReference)};g.prototype.destroy=function(){this._handlers.removeAll();this._handlers=null;this._removeResourcesFromStage();this._engineResources=null;this._set("view",null);this._camera=null};Object.defineProperty(g.prototype,"alignment",{get:function(){return this._get("alignment")},set:function(a){this._set("alignment",
a);this.constructed&&this._refreshMapPoint()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"visible",{set:function(a){a!==this._get("visible")&&(this._set("visible",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"radius",{get:function(){return this._radius},set:function(a){a!==this._radius&&(this._radius=a,this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"worldSized",{get:function(){return this._worldSized},
set:function(a){a!==this._worldSized&&(this._worldSized=a,this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"focusMultiplier",{get:function(){return this._focusMultiplier},set:function(a){this._focusMultiplier=a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"touchMultiplier",{get:function(){return this._touchMultiplier},set:function(a){this._touchMultiplier=a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"modelTransform",
{get:function(){return this._modelTransform},set:function(a){U(a)&&(this._screenPositionDirty=!0);B.mat4.copy(this._modelTransform,a);this._updateEngineObject()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"position",{get:function(){return this._position},set:function(a){this.view.renderCoordsHelper.fromRenderCoords(a,this._mapPoint,this._mapPoint.spatialReference);this._refreshMapPoint()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"mapPoint",{get:function(){return this._mapPoint},
set:function(a){z.clonePoint(a,this._mapPoint);this._refreshMapPoint()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"grabbing",{set:function(a){a!==this._get("grabbing")&&(this._set("grabbing",a),this._updateEngineObject());a||(this._dragOffset=null)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"hovering",{set:function(a){a!==this._get("hovering")&&(this._set("hovering",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"selected",{set:function(a){a!==this._get("selected")&&(this._set("selected",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"state",{set:function(a){a!==this._get("state")&&(this._set("state",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"areAnyEngineObjectsVisible",{get:function(){return this._areAnyEngineObjectsVisible},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"surfaceType",
{get:function(){return this._hitResult.onSurface?this._hitResult.surfaceType:null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"screenPoint",{get:function(){this._updateScreenSpaceProperties();return this._dirtyScreenPoint},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_screenPointArray",{get:function(){this._updateScreenSpaceProperties();return this._dirtyScreenPointArray},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_renderScreenPointArray",{get:function(){this._updateScreenSpaceProperties();return this._dirtyRenderScreenPointArray},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_originScreenPointArray",{get:function(){this._updateScreenSpaceProperties();
return this._dirtyOriginScreenPointArray},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_screenPixelSize",{get:function(){this._updateScreenSpaceProperties();return this._dirtyScreenPixelSize},enumerable:!0,configurable:!0});g.prototype._updateScreenSpaceProperties=function(){if(this._screenPositionDirty){this._screenPositionDirty=!1;this._dirtyScreenPixelSize=this._camera.computeScreenPixelSizeAt(this._position);var a=U(this._modelTransform),b;a?(b=this._calculateModelTransformOffset(ca),
b=p.vec3.add(b,b,this._position)):b=this._position;this._camera.projectPoint(b,this._dirtyRenderScreenPointArray);this._camera.renderToScreen(this._dirtyRenderScreenPointArray,this._dirtyScreenPointArray);l.screenPointArrayToObject(this._dirtyScreenPointArray,this._dirtyScreenPoint);a?(this._camera.projectPoint(this._position,L),this._camera.renderToScreen(L,this._dirtyOriginScreenPointArray)):n.vec2.copy(this._dirtyOriginScreenPointArray,this._dirtyScreenPointArray)}};g.prototype.intersectionDistance=
function(b,c){if(!this._get("visible"))return null;var d=l.screenPointObjectToArray(b,M),e=this._getCollisionRadius(c);c=-1*this._get("collisionPriority");switch(this.collisionType.type){case "point":if(n.vec2.squaredDistance(this._screenPointArray,d)<e*e)return this._renderScreenPointArray[2]+c;break;case "line":var g=this.collisionType.paths;b=this._getWorldToScreenObjectScale();b=this._calculateObjectTransform(b,O);for(var e=e*this._screenPixelSize,d=y.ray.fromScreen(this._camera,d,R),f=0,k=g;f<
k.length;f++)if(g=k[f],0!==g.length)for(var m=p.vec3.transformMat4(X,g[0],b),D=1;D<g.length;D++){var H=p.vec3.transformMat4(Y,g[D],b),q=y.lineSegment.closestRayDistance2(y.lineSegment.fromPoints(m,H,V),d);if(null!=q&&q<e*e)return b=p.vec3.add(E.sv3d.get(),m,H),p.vec3.scale(b,b,.5),e=l.castRenderScreenPointArray(E.sv3d.get()),this._camera.projectPoint(b,e),e[2]+c;p.vec3.copy(m,H)}break;case "disc":m=this.collisionType.direction;b=this._getWorldToScreenObjectScale();b=this._calculateObjectTransform(b,
O);e*=this._screenPixelSize;d=y.ray.fromScreen(this._camera,d,R);D=h.mat3.fromMat4(P,b);D=p.vec3.transformMat3(Z,m,D);m=this._calculateModelTransformPosition(S);y.plane.fromPositionAndNormal(m,D,Q);f=T;if(y.plane.intersectRay(Q,d,f)&&p.vec3.squaredDistance(f,m)<e*e)return this._renderScreenPointArray[2]+c;break;case "ribbon":b=this.collisionType;g=b.paths;m=b.direction;b=this._getWorldToScreenObjectScale();b=this._calculateObjectTransform(b,O);e*=this._camera.computeScreenPixelSizeAt(this._position);
d=y.ray.fromScreen(this._camera,d,R);D=h.mat3.fromMat4(P,b);D=p.vec3.transformMat3(Z,m,D);m=this._calculateModelTransformPosition(S);y.plane.fromPositionAndNormal(m,D,Q);f=T;if(!y.plane.intersectRay(Q,d,f))break;d=0;for(k=g;d<k.length;d++)if(g=k[d],0!==g.length)for(m=p.vec3.transformMat4(X,g[0],b),D=1;D<g.length;D++){H=p.vec3.transformMat4(Y,g[D],b);q=y.lineSegment.distance2(y.lineSegment.fromPoints(m,H,V),f);if(null!=q&&q<e*e)return b=p.vec3.add(E.sv3d.get(),m,H),p.vec3.scale(b,b,.5),e=l.castRenderScreenPointArray(E.sv3d.get()),
this._camera.projectPoint(b,e),e[2]+c;p.vec3.copy(m,H)}break;default:a.neverReached(this.collisionType)}return null};g.prototype.attemptDragTo=function(a){if(!this.moveOnDrag)return this._handlers.forEach(function(b){var c=b.handler;"drag"===b.type&&c(a)}),!1;var b=l.screenPointObjectToArray(a.screenPoint,M);f.isNone(this._dragOffset)&&this.grabbing&&!this.snapToPointer&&(this._dragOffset=n.vec2.subtract(k.vec2f32.create(),b,this._originScreenPointArray));f.isSome(this._dragOffset)&&n.vec2.subtract(b,
b,this._dragOffset);var b=this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(b,this._intersector,"on-the-ground"===this.alignment?v:null).results.min,c=T;b.getIntersectionPoint(c)?(this.position=c,this._hitResult.onSurface=!0,this._hitResult.surfaceType="TerrainRenderer"===b.intersector?"ground":"feature",this._handlers.forEach(function(b){var c=b.handler;"drag"===b.type&&c(a)})):this._hitResult.onSurface=!1;return this._hitResult.onSurface};g.prototype.grab=function(a){this._handlers.forEach(function(b){var c=
b.handler;"grab"===b.type&&c(a)})};g.prototype.click=function(a){this._handlers.forEach(function(b){var c=b.handler;"click"===b.type&&c(a)})};g.prototype.on=function(a,b){this._handlers.push({type:a,handler:b})};g.prototype.attach=function(a){void 0===a&&(a={manipulator3D:{}});if(this.view._stage){a=a.manipulator3D;this._engineLayerId=a.engineLayerId;if(f.isNone(this._engineLayerId)){var b=new ba("manipulator-3d",{isPickable:!1});this.view._stage.add(K.ContentType.LAYER,b);this.view._stage.addToViewContent([b.id]);
this._engineLayerId=b.id;a.engineLayerId=b.id}a.engineLayerReferences=(a.engineLayerReferences||0)+1;this._materialIdReferences=a.materialIdReferences;f.isNone(this._materialIdReferences)&&(this._materialIdReferences=new Map,a.materialIdReferences=this._materialIdReferences);this._camera=this.view.state.camera;this._attached=!0;this._updateEngineObject()}};g.prototype.detach=function(a){void 0===a&&(a={manipulator3D:{}});a=a.manipulator3D;a.engineLayerReferences--;var b=0===a.engineLayerReferences;
b&&(a.engineLayerId=null);this._removeResourcesFromStage(b);this._camera=this._materialIdReferences=this._engineLayerId=this._engineResources=null;this._attached=!1};g.prototype.onCameraChange=function(a){this._camera=a;this._screenPositionDirty=!0;this._updateEngineObject()};g.prototype.onElevationChange=function(a){this.view.renderCoordsHelper.fromRenderCoords(this.position,I,a.spatialReference)&&x.containsPoint(a.extent,I)&&this._refreshMapPoint(!0)};g.prototype._refreshMapPoint=function(b){void 0===
b&&(b=!1);switch(this.alignment){case "none":break;case "on-the-ground":var c=this.view.elevationProvider.getElevation(this.mapPoint,"ground");if(c===this._mapPoint.z&&b)return;this._mapPoint.z=c;break;default:a.neverReached(this.alignment)}this._screenPositionDirty=!0;this._hitResult.onSurface=!1;this.view.renderCoordsHelper.toRenderCoords(this._mapPoint,this._position);this._updateEngineObject()};g.prototype._updateEngineObject=function(){this._areAnyEngineObjectsVisible=!1;if(this._attached)if(!1===
this._get("visible"))this._removeResourcesFromStage();else{var a=this._getWorldToScreenObjectScale(),b=O;!0===this._get("autoScaleRenderObjects")&&(a*=this._getFocusedSize(this._radius,this._focused));this._calculateObjectTransform(a,b);for(var a=this._ensureEngineResources().objectsByState,c=(this._focused?2:1)|(this._get("selected")?8:4),d=this._get("hideOnGrab")&&this._get("grabbing"),e=0;e<a.length;e++){var g=a[e],f=g.stateMask,g=g.objects;if(d)for(var f=0,h=g;f<h.length;f++)g=h[f],g.hideAllComponents();
else if(h=0===(f&15)||(c&f)===(f&15),f=0===(f&65520)||(this._get("state")&f)===(f&65520),h&&f)for(f=0,h=g;f<h.length;f++)g=h[f],g.unhideAllComponents(),g.objectTransformation=b,this._areAnyEngineObjectsVisible=!0;else for(f=0,h=g;f<h.length;f++)g=h[f],g.hideAllComponents()}}};g.prototype._ensureEngineResources=function(){if(f.isNone(this._engineResources)){var a=this.view._stage.get(K.ContentType.LAYER,f.expect(this._engineLayerId)),b=[],c=new Set;this.renderObjects.forEach(function(a){a=a.material;
c.has(a)||(b.push(a),c.add(a))});var d=function(a,b){var c=b.geometry,d=b.material,e=b.transform;Array.isArray(c)?c.forEach(function(b){return a.addGeometry(b,d,e)}):a.addGeometry(c,d,e)},e=new Map;this.renderObjects.forEach(function(a){var b=new G({idHint:"manipulator"});d(b,a);a=a.stateMask||0;var c=e.get(a)||[];c.push(b);e.set(a,c)});var g=[];e.forEach(function(a,b){g.push({stateMask:b,objects:a})});this._engineResources={objectsByState:g,layer:a,materials:b}}this._addResourcesToStage();return this._engineResources};
g.prototype._addResourcesToStage=function(){var a=this;if(!this._engineResourcesAddedToStage&&!f.isNone(this._engineResources)){var b=this._engineResources,c=b.objectsByState,d=b.layer;b.materials.forEach(function(b){var c=f.expect(a._materialIdReferences),d=c.get(b.id)||0;0===d&&a.view._stage.add(K.ContentType.MATERIAL,b);c.set(b.id,d+1)});c.forEach(function(b){b.objects.forEach(function(b){d.addObject(b);a.view._stage.add(K.ContentType.OBJECT,b)})});this._engineResourcesAddedToStage=!0}};g.prototype._removeResourcesFromStage=
function(a){var b=this;void 0===a&&(a=!1);if(this._engineResourcesAddedToStage&&!f.isNone(this._engineResources)){var c=this._engineResources,d=c.layer,e=c.materials;c.objectsByState.forEach(function(a){a.objects.forEach(function(a){d.removeObject(a);b.view._stage.remove(K.ContentType.OBJECT,a.id)})});e.forEach(function(a){var c=f.expect(b._materialIdReferences),d=c.get(a.id);1===d?(b.view._stage.remove(K.ContentType.MATERIAL,a.id),c.delete(a.id)):c.set(a.id,d-1)});a&&this.view._stage.remove(K.ContentType.LAYER,
d.id);this._engineResourcesAddedToStage=!1}};g.prototype._getCollisionRadius=function(a){return this._getFocusedSize(this._radius,!0)*("touch"===a?this._touchMultiplier:1)};g.prototype._getFocusedSize=function(a,b){return a*(b?this._focusMultiplier:1)};g.prototype._getWorldToScreenObjectScale=function(){return this._worldSized?1:this._screenPixelSize};g.prototype._calculateModelTransformPosition=function(a){var b=this._getWorldToScreenObjectScale(),b=this._calculateObjectTransform(b,aa);return p.vec3.set(a,
b[12],b[13],b[14])};g.prototype._calculateModelTransformOffset=function(a){var b=this._calculateModelTransformPosition(a);return p.vec3.subtract(a,b,this._position)};g.prototype._calculateObjectTransform=function(a,b){B.mat4.set(b,a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1);B.mat4.multiply(b,b,this._modelTransform);b[12]+=this._position[0];b[13]+=this._position[1];b[14]+=this._position[2];b[15]=1;return b};e([d.property({constructOnly:!0,nonNullable:!0})],g.prototype,"view",void 0);e([d.property({value:"none",
nonNullable:!0})],g.prototype,"alignment",null);e([d.property()],g.prototype,"hideOnGrab",void 0);e([d.property()],g.prototype,"moveOnDrag",void 0);e([d.property()],g.prototype,"snapToPointer",void 0);e([d.property()],g.prototype,"collisionType",void 0);e([d.property({type:c.Integer})],g.prototype,"collisionPriority",void 0);e([d.property({constructOnly:!0})],g.prototype,"renderObjects",void 0);e([d.property()],g.prototype,"autoScaleRenderObjects",void 0);e([d.property({value:!0})],g.prototype,"visible",
null);e([d.property()],g.prototype,"radius",null);e([d.property()],g.prototype,"worldSized",null);e([d.property()],g.prototype,"focusMultiplier",null);e([d.property()],g.prototype,"touchMultiplier",null);e([d.property()],g.prototype,"interactive",void 0);e([d.property()],g.prototype,"selectable",void 0);e([d.property({value:!1})],g.prototype,"grabbing",null);e([d.property()],g.prototype,"dragging",void 0);e([d.property({value:!1})],g.prototype,"hovering",null);e([d.property({value:!1})],g.prototype,
"selected",null);e([d.property({value:0})],g.prototype,"state",null);e([d.property({dependsOn:["hovering","grabbing"]})],g.prototype,"focused",null);return g=e([d.subclass("esri.views.interactive.Manipulator3D")],g)}(d.declared(t));b.Manipulator3D=r;var v={include:new Set};v.include.add(g.TERRAIN_ID);var M=l.createScreenPointArray(),L=l.createRenderScreenPointArray3(),V=y.lineSegment.create(),R=y.ray.create(),P=C.mat3f64.create(),aa=m.mat4f64.create(),O=m.mat4f64.create(),Q=y.plane.create(),X=A.vec3f64.create(),
Y=A.vec3f64.create(),T=A.vec3f64.create(),Z=A.vec3f64.create(),S=A.vec3f64.create(),ca=A.vec3f64.create(),I=A.vec3f64.create()})},"esri/views/interactive/manipulatorUtils":function(){define("require exports ../../core/libs/gl-matrix-2/mat4 ../../core/libs/gl-matrix-2/vec3 ../3d/support/stack ../3d/webgl-engine/lib/Geometry ../3d/webgl-engine/lib/GeometryUtil ../3d/webgl-engine/materials/DefaultMaterial ./Manipulator3D".split(" "),function(r,b,e,q,t,u,a,f,l){function d(a,b){var c=1!==b;a=new f({diffuse:a,
transparent:c,writeDepth:!c,cullFace:"back",opacity:b,castShadows:!1,softwareInstanced:!0},"manipulator");a.renderOccluded=4;return a}function c(a,b,c,d){a=q.vec3.normalize(t.sv3d.get(),a);b=q.vec3.normalize(t.sv3d.get(),b);var e=q.vec3.cross(t.sv3d.get(),a,b);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=0;d[4]=b[0];d[5]=b[1];d[6]=b[2];d[7]=0;d[8]=e[0];d[9]=e[1];d[10]=e[2];d[11]=0;d[12]=c[0];d[13]=c[1];d[14]=c[2];d[15]=1;return d}Object.defineProperty(b,"__esModule",{value:!0});b.createManipulatorMaterial=
d;b.createSphereManipulator=function(b,c,e){return new l.Manipulator3D({view:b,renderObjects:[{geometry:new u(a.createSphereGeometry(1,32,32),"manipulator"),material:d(c,e)}]})};b.calculateInputRotationTransform=function(a,b,d,f){a=q.vec3.subtract(t.sv3d.get(),a,d);f=q.vec3.cross(t.sv3d.get(),f,a);d=c(a,f,d,t.sm4d.get());e.mat4.invert(d,d);b=q.vec3.transformMat4(t.sv3d.get(),b,d);return Math.atan2(b[1],b[0])};b.calculateTranslateRotateFromBases=c})},"esri/views/3d/interactive/editingTools/graphicTransform3D/GraphicTransform3DTool":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/scheduling ../../../../../core/screenUtils ../../../../../core/unitUtils ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/math/common ../../../../../geometry/Point ../../../../../layers/graphics/dehydratedFeatures ./graphicTransform3DToolConfig ./isSupportedGraphic ../../../support/geometryUtils ../../../support/mathUtils ../../../support/projectionUtils ../../../support/stack ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/materials/ColorMaterial ../../../../interactive/InteractiveToolBase ../../../../interactive/Manipulator3D ../../../../interactive/manipulatorUtils".split(" "),
function(r,b,e,q,t,u,a,f,l,d,c,h,C,B,m,n,k,p,A,x,z,y,E,N,g,ba,G,K,U,v,M,L,V,R,P,aa){function O(a){var b=new M(L.createCylinderGeometry(g.DISC_HEIGHT,1,g.GEOMETRY_SEGMENTS,z.vec3f64.fromValues(0,0,1),z.vec3f64.fromValues(0,0,0)),"graphic-transform-disc"),c=I(),d=I(.5),e=p.mat4.fromScaling(A.mat4f64.create(),z.vec3f64.fromValues(g.DISC_RADIUS,g.DISC_RADIUS,g.DISC_RADIUS));a=new P.Manipulator3D({view:a,renderObjects:[{geometry:b,material:c,stateMask:w.RingUnfocused|w.ArrowUnfocused,transform:e},{geometry:b,
material:d,transform:e}],autoScaleRenderObjects:!1,radius:g.DISC_COLLISION_RADIUS,focusMultiplier:1,touchMultiplier:1,snapToPointer:!1,alignment:"on-the-ground",collisionType:{type:"disc",direction:z.vec3f64.fromValues(0,0,1)}});a.visible=!1;return a}function Q(a){for(var b=function(a,b,c){for(var d=[],e=Math.ceil(g.GEOMETRY_SEGMENTS*(b-a)/(2*Math.PI)),F=0;F<e+1;F++){var f=a+F*(b-a)/e;d.push(z.vec3f64.fromValues(c*Math.cos(f),c*Math.sin(f),0))}return d},c=function(a){return b(0,2*Math.PI,a)},d=function(a,
b){return new M(L.createPathExtrusionGeometry([[-b/2,0],[b/2,0],[b/2,g.RING_HEIGHT/2],[-b/2,g.RING_HEIGHT/2]],a,[],[],!1),"graphic-transform-ring")},e=c(g.RING_RADIUS),f=d(e,g.RING_THICKNESS),h=[],k=[],n=[],J=0;2>J;J++){var m=J*Math.PI-Math.PI/4,l=Math.PI/2-g.ROTATE_INDICATOR_ARC_LENGTH,q=m+l,m=m+Math.PI/2-l,l=b(q,m,g.INNER_INDICATOR_RADIUS),t=d(l,g.INDICATOR_THICKNESS);n.push(l);h.push(t);k.push(t);for(t=0;2>t;t++){var u=0===t,r=A.mat4f64.create();if(u){p.mat4.scale(r,r,[1,-1,1]);p.mat4.rotate(r,
r,-q,[0,0,1]);var v=Math.round(g.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE*(l.length-1))}else p.mat4.rotate(r,r,m,[0,0,1]),v=Math.round((1-g.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE)*(l.length-1));r[12]=l[v][0];r[13]=l[v][1];r[14]=l[v][2];v=L.createExtrudedTriangle(g.ROTATE_INDICATOR_ARROW_TIP_LENGTH,0,g.ROTATE_INDICATOR_ARROW_TIP_RADIUS,g.RING_HEIGHT);L.transformInPlace(v,r);r=new M(v,"graphic-transform-ring-rotate");(u?h:k).push(r)}}t=[];for(J=0;2>J;J++)m=J*Math.PI-Math.PI/4,l=Math.PI/2-g.SCALE_INDICATOR_ARC_LENGTH,
q=m+l,m=m+Math.PI/2-l,l=b(q,m,g.OUTER_INDICATOR_RADIUS),t.push(d(l,g.INDICATOR_THICKNESS));J=c(g.RING_RADIUS+g.SCALE_INDICATOR_OFFSET1);q=c(g.RING_RADIUS+g.SCALE_INDICATOR_OFFSET2);J=d(J,g.INDICATOR_THICKNESS);q=d(q,g.INDICATOR_THICKNESS);m=c(g.RING_RADIUS-g.SCALE_INDICATOR_OFFSET1);l=c(g.RING_RADIUS-g.SCALE_INDICATOR_OFFSET2);c=d(m,g.INDICATOR_THICKNESS);d=d(l,g.INDICATOR_THICKNESS);m=I();l=I(.66);u=I(.5);r=I(.33);f=[{geometry:f,material:m,stateMask:w.DiscUnfocused|w.ArrowUnfocused},{geometry:f,
material:u},{geometry:t,material:m,stateMask:w.Unlocked|w.RingFocused},{geometry:J,material:l,stateMask:w.ScaleIn|2},{geometry:q,material:r,stateMask:w.ScaleIn|2},{geometry:c,material:l,stateMask:w.ScaleOut|2},{geometry:d,material:r,stateMask:w.ScaleOut|2},{geometry:h,material:m,stateMask:w.Unlocked|w.RingFocused},{geometry:h,material:m,stateMask:w.RotateLeft|2},{geometry:k,material:m,stateMask:w.RotateRight|2}];e=[e].concat(n);return new P.Manipulator3D({view:a,renderObjects:f,autoScaleRenderObjects:!1,
radius:g.RING_THICKNESS,focusMultiplier:1,touchMultiplier:1.5,moveOnDrag:!1,alignment:"on-the-ground",collisionType:{type:"ribbon",paths:e,direction:z.vec3f64.fromValues(0,0,1)}})}function X(a){var b=Math.sqrt(g.DISC_TRANSLATE_ARROW_SIZE*g.DISC_TRANSLATE_ARROW_SIZE*3/4),c=L.createExtrudedTriangle(b,g.DISC_TRANSLATE_ARROW_SIZE/2,g.DISC_TRANSLATE_ARROW_SIZE/2,g.DISC_HEIGHT);L.transformInPlace(c,p.mat4.fromTranslation(v.sm4d.get(),x.vec3.set(v.sv3d.get(),0,-b/3,0)));var c=new M(c,"graphic-transform-disc-arrow"),
d=I(),e=I(.5);a=new P.Manipulator3D({view:a,renderObjects:[{geometry:c,material:e,stateMask:w.DiscFocused|1},{geometry:c,material:e,stateMask:w.ArrowFocused|1},{geometry:c,material:d,stateMask:w.TouchInput|w.ArrowUnfocused|w.DiscUnfocused|w.RingUnfocused},{geometry:c,material:d,stateMask:2}],autoScaleRenderObjects:!1,radius:b,focusMultiplier:1,touchMultiplier:1,snapToPointer:!1,alignment:"on-the-ground",collisionType:{type:"disc",direction:z.vec3f64.fromValues(0,0,1)}});a.visible=!1;return a}function Y(a,
b){var c=this,d=a.allLayerViews.find(function(a){return a.layer===b.layer}),e=b.symbol;return h.all(e.symbolLayers.map(function(a){return u(c,void 0,void 0,function(){var b,c;return t(this,function(F){switch(F.label){case 0:c=b=null,"object"===a.type&&(b=a.heading),F.label=1;case 1:return F.trys.push([1,3,,4]),[4,d.whenSymbolLayerSize(e,a)];case 2:return c=F.sent(),[3,4];case 3:return F.sent(),c=null,[3,4];case 4:return[2,{heading:b,size:c}]}})})}).toArray()).then(function(a){return{symbolLayers:a}})}
function T(a){return(a=a.symbol.symbolLayers.find(function(a){return"object"===a.type}))&&a.heading||0}function Z(a,b,d,e){a.symbolLayers.forEach(function(a,F){var g=b.symbolLayers[F];F=g.heading;g=g.size;"object"===a.type&&(a.heading=(c.isSome(F)?F:0)-y.toDegree(d),c.isSome(g)&&"width"in g&&(a.width=g.width*e,a.depth=g.depth*e,a.height=g.height*e))})}function S(a){var b=x.vec3.subtract(v.sv3d.get(),a.startPoint,a.origin);a=x.vec3.subtract(v.sv3d.get(),a.endPoint,a.origin);b=x.vec3.length(b);a=x.vec3.length(a);
return 0===b?0:a/b}function ca(a,b){var c=a.origin,d=a.startPoint,e=a.endPoint,f=a.plane;a=W(d,b,v.sv3d.get());e=W(e,b,v.sv3d.get());if(x.vec3.squaredDistance(a,e)<g.DRAG_THRESHOLD_PX*g.DRAG_THRESHOLD_PX)return null;var h=x.vec3.subtract(v.sv3d.get(),d,c),f=x.vec3.cross(v.sv3d.get(),h,f),d=x.vec3.add(v.sv3d.get(),d,f),c=W(c,b,v.sv3d.get());b=W(d,b,v.sv3d.get());d=x.vec3.subtract(v.sv3d.get(),b,a);b=x.vec3.subtract(v.sv3d.get(),a,c);a=G.ray.wrap(a,d);b=G.ray.wrap(c,b);return G.ray.distance2(a,e)<G.ray.distance2(b,
e)?"rotate":"scale"}function I(a){void 0===a&&(a=1);var b=g.HANDLE_COLOR.concat([a]);a=new V({color:b,transparent:1!==a,cullFace:"back"},"graphic-transform");a.renderOccluded=2;return a}function W(a,b,c){a=b.projectPoint(a,B.castRenderScreenPointArray(ma));b=b.renderToScreen(a,na);return x.vec3.set(c,b[0],b[1],0)}function ha(a){return"local"===a.viewingMode?!0:a.scale<g.ALIGN_ARROWS_SCALE_THRESHOLD}Object.defineProperty(b,"__esModule",{value:!0});var D=l.getLogger("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransform3DTool"),
H=function(){return function(a){this.graphic=a}}();b.GraphicTranslateStartEvent=H;var da=function(){return function(a){this.graphic=a}}();b.GraphicTranslateStopEvent=da;var ea=function(){return function(a){this.graphic=a}}();b.GraphicRotateStartEvent=ea;var ia=function(){return function(a){this.graphic=a}}();b.GraphicRotateStopEvent=ia;var fa=function(){return function(a){this.graphic=a}}();b.GraphicScaleStartEvent=fa;var ja=function(){return function(a){this.graphic=a}}();b.GraphicScaleStopEvent=
ja;var ga=function(){return function(a,b,c){this.graphic=a;this.dx=b;this.dy=c;this.type="translate"}}();b.GraphicTranslateEvent=ga;var ka=function(){return function(a,b){this.graphic=a;this.angle=b;this.type="rotate"}}();b.GraphicRotateEvent=ka;var la=function(){return function(a,b){this.graphic=a;this.scale=b;this.type="scale"}}();b.GraphicScaleEvent=la;r=function(a){function b(b){b=a.call(this,b)||this;b.enableRotation=!0;b.enableScaling=!0;b.discManipulator=null;b.ringManipulator=null;b.arrowManipulators=
null;b.type="transform-3d";b._handles=new f;b._arrowDragData=null;b._ringDragData=null;b._startSymbolDataPromise=null;b._startSymbolData=null;b._ringDelayedFocusFrameTask=null;b._ringManipulatorHasDelayedFocused=!1;b._scaleAnimationFrameTask=null;b._lastPointerEventType=null;return b}q(b,a);b.prototype.destroy=function(){this._removeFrameTasks();this.graphic=null;this._handles.destroy();this._handles=null;this._set("view",null)};Object.defineProperty(b.prototype,"graphic",{set:function(a){c.isSome(a)&&
!ba.isSupportedGraphic(a)?D.error("Only graphics from a graphics layer with point geometries and object symbology are supported"):this._set("graphic",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_ringMode",{get:function(){return c.isSome(this._ringDragData)&&this._ringDragData.mode||this._ringModeFromOptions},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_ringModeFromOptions",{get:function(){var a=this._shouldAllowModeType("scale"),b=this._shouldAllowModeType("rotate");
return a||b?b?a?null:{type:"rotate",startAngle:0}:{type:"scale"}:{type:"disabled"}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_manipulatorState",{get:function(){var a=this._ringMode,b="touch"===this._lastPointerEventType?w.TouchInput:0,b=c.isNone(a)?b|w.Unlocked:"rotate"===a.type?b|(c.isSome(this._ringDragData)&&0>this._ringDragData.angleDir?w.RotateLeft:w.RotateRight):b|(c.isSome(this._ringDragData)&&0>this._ringDragData.scaleDir?w.ScaleIn:w.ScaleOut),b=b|(this.discManipulator.focused?
w.DiscFocused:w.DiscUnfocused),b=b|(this._ringManipulatorHasDelayedFocused?w.RingFocused:w.RingUnfocused);return b|=this.arrowManipulators.some(function(a){return a.manipulator.focused})?w.ArrowFocused:w.ArrowUnfocused},enumerable:!0,configurable:!0});b.prototype.reset=function(){this.graphic=null};b.prototype.handleInputEvent=function(a){"pointer-move"!==a.type&&"pointer-down"!==a.type&&"pointer-up"!==a.type||a.pointerType===this._lastPointerEventType||(this._lastPointerEventType=a.pointerType,this._updateManipulators())};
b.prototype.initialize=function(){for(var a=this,b=O(this.view),d=Q(this.view),e=[],g=0;4>g;g++){var f=X(this.view),h=A.mat4f64.create();this._calculateArrowManipulatorTransform(g,h);e.push({manipulator:f,transform:h})}this.discManipulator=b;this.ringManipulator=d;this.arrowManipulators=e;this._handles.add([b.watch("grabbing",function(c){a._setSingleManipulatorInteractive(b,c)},!0),b.watch("dragging",function(b){c.isSome(a.graphic)&&(b?a.emit("graphic-translate-start",new H(a.graphic)):a.emit("graphic-translate-stop",
new da(a.graphic)))},!0),n.watch(b,"focused",function(){c.isNone(a._scaleAnimationFrameTask)&&a._updateManipulators()}),n.init(this,"graphic.geometry",function(){c.isSome(a.graphic)&&c.isSome(a.graphic.geometry)&&"point"===a.graphic.geometry.type&&(b.mapPoint=N.clonePoint(a.graphic.geometry,oa));a._updateManipulators()},!0)]);e.forEach(function(b,d){var e=b.manipulator;e.on("drag",function(b){a._handleArrowDrag(d)});a._handles.add([n.watch(e,"focused",function(){a._updateManipulators()}),n.watch(e,
"grabbing",function(b){a._setSingleManipulatorInteractive(e,b)}),n.watch(e,"dragging",function(b){c.isNone(a.graphic)||(b?a.emit("graphic-translate-start",new H(a.graphic)):(a._arrowDragData=null,a.emit("graphic-translate-stop",new da(a.graphic))))})])});b.on("drag",function(d){if(!c.isNone(a.graphic)&&!c.isNone(a.graphic.geometry)&&"point"===a.graphic.geometry.type){d=a.graphic.geometry.z;var e=a.graphic.geometry,g=N.clonePoint(b.mapPoint,new E);g.z=d;a.graphic.geometry=g;a.emit("graphic-translate",
new ga(a.graphic,g.x-e.x,g.y-e.y))}});this._handles.add([d.watch("grabbing",function(b){a._setSingleManipulatorInteractive(d,b)},!0),d.watch("dragging",function(b){if(!1===b){if(b=a._ringDragData,a._ringDragData=null,a._startSymbolDataPromise=null,a._startSymbolData=null,c.isSome(b)){var d=b.mode;c.isNone(d)||c.isSome(d)&&"scale"===d.type?(d=S(b),a._startScaleResetAnimation(d)):a._updateManipulators();if(c.isSome(a.graphic)&&c.isSome(b.mode))switch(b.mode.type){case "rotate":a.emit("graphic-rotate-stop",
new ia(a.graphic));break;case "scale":a.emit("graphic-scale-stop",new ja(a.graphic))}}}else if(c.isSome(a.graphic)&&c.isSome(a._ringMode)&&"disabled"!==a._ringMode.type)switch(a._ringMode.type){case "rotate":a.emit("graphic-rotate-start",new ea(a.graphic));break;case "scale":a.emit("graphic-scale-start",new fa(a.graphic))}},!0),n.watch(d,"focused",function(){c.isNone(a._scaleAnimationFrameTask)&&a._startRingFocusFrameTask()})]);d.on("drag",function(b){a._handleRingDrag(b.screenPoint)});this.manipulators.add(b);
this.manipulators.add(d);e.forEach(function(b){return a.manipulators.add(b.manipulator)})};b.prototype.onHide=function(){this._removeFrameTasks()};b.prototype._handleArrowDrag=function(a){if(!c.isNone(this.graphic)&&!c.isNone(this.graphic.geometry)&&"point"===this.graphic.geometry.type){var b=this.arrowManipulators[a].manipulator,d=this.graphic.geometry,e=this.graphic.geometry.spatialReference,g=b.mapPoint,g=U.vectorToPoint(x.vec3.set(v.sv3d.get(),g.x,g.y,g.z),g.spatialReference,e),f=x.vec3.subtract(v.sv3d.get(),
b.position,this.discManipulator.position);b.position=this.discManipulator.position;var b=d.longitude,h=g.longitude;null==b||null==h?b=!1:(b=K.cyclicalDeg.shortestSignedDiff(b,h),b=90>Math.abs(b));if(b){b=1/m.getMetersPerUnitForSR(e)*1E-4;if(c.isNone(this._arrowDragData)){if(ha(this.view)){if(a=this._calculateArrowManipulatorDirection(a,v.sv3d.get()),G.vector.projectPoint(a,f,f),a=x.vec3.add(f,f,this.discManipulator.position),!this.view.renderCoordsHelper.fromRenderCoords(a,g,e))return}else 0===a||
2===a?g.x=d.x:g.y=d.y;e=N.clonePoint(d,new E);a=g.x-d.x;f=g.y-d.y;if(Math.abs(a)>b||Math.abs(f)>b)a=z.vec3f64.fromValues(a,f,0),x.vec3.normalize(a,a),this._arrowDragData={startPoint:e,dxDyMapConstrained:a}}c.isSome(this._arrowDragData)&&(e=this._arrowDragData,a=e.dxDyMapConstrained,e=e.startPoint,Math.abs(a[0])<b?g.x=e.x:Math.abs(a[1])<b?g.y=e.y:(b=g.x-e.x,f=g.y-e.y,b=G.vector.projectPoint(a,x.vec3.set(v.sv3d.get(),b,f,0),v.sv3d.get()),g.x=e.x+b[0],g.y=e.y+b[1]),e=g.x-d.x,b=g.y-d.y,g.z=d.z,this.graphic.geometry=
g,this.emit("graphic-translate",new ga(this.graphic,e,b)))}}};b.prototype._handleRingDrag=function(a){var b=this,e=this.graphic;if(!c.isNone(e)&&!c.isNone(e.symbol)&&!c.isSome(this._startSymbolDataPromise)){var f=this._ringDragData,h=this._startSymbolData;a=B.screenPointObjectToArray(a,B.castScreenPointArray(v.sv2d.get()));a=G.ray.fromScreen(this.view.state.camera,a,pa);var k=this.discManipulator.modelTransform;if(c.isNone(f)||c.isNone(h))f=z.vec3f64.fromValues(0,0,1),x.vec3.transformMat4(f,f,k),
h=z.vec3f64.clone(this.ringManipulator.position),k=G.plane.fromPositionAndNormal(h,f),f=z.vec3f64.create(),G.plane.intersectRay(k,a,f)&&(this._ringDragData={origin:h,plane:k,angle:0,angleDir:0,scale:1,scaleDir:0,startPoint:f,endPoint:z.vec3f64.clone(f),mode:null},this._startSymbolDataPromise=Y(this.view,e),this._startSymbolDataPromise.then(function(a){b._startSymbolData=a;b._startSymbolDataPromise=null},function(){b._startSymbolDataPromise=null}));else if(k=f.plane,G.plane.intersectRay(k,a,f.endPoint)){a=
S(f);var k=aa.calculateInputRotationTransform(f.startPoint,f.endPoint,f.origin,k),l=K.cyclicalPI.shortestSignedDiff(f.angle,k);f.angleDir=d.clamp(f.angleDir+l,-g.ROTATE_INDICATOR_DIRECTION_BUFFER,g.ROTATE_INDICATOR_DIRECTION_BUFFER);f.angle=k;f.scaleDir=d.clamp(f.scaleDir+(a-f.scale),-g.SCALE_INDICATOR_DIRECTION_BUFFER,g.SCALE_INDICATOR_DIRECTION_BUFFER);f.scale=a;var l=null,m=this._ringMode;if(c.isSome(m))l=m;else if(m=ca(f,this.view.state.camera),c.isSome(m)){switch(m){case "rotate":this.emit("graphic-rotate-start",
new ea(e));break;case "scale":this.emit("graphic-scale-start",new fa(e))}l="scale"===m?{type:"scale"}:{type:"rotate",startAngle:k}}f.mode=l;this._updateManipulators();if(c.isSome(l)&&"disabled"!==l.type){var f=e.symbol.clone(),m=this._calculateSymbolRotateAngle(l),n=this._calculateSymbolScaleFactor(l);Z(f,h,m,n);e.symbol=f;switch(l.type){case "rotate":this.emit("graphic-rotate",new ka(e,y.toDegree(k)));break;case "scale":this.emit("graphic-scale",new la(e,a))}}}}};b.prototype._calculateSymbolRotateAngle=
function(a){void 0===a&&(a=this._ringMode);return c.isNone(a)||"rotate"!==a.type||c.isNone(this._ringDragData)?0:this._ringDragData.angle-a.startAngle};b.prototype._calculateSymbolScaleFactor=function(a){void 0===a&&(a=this._ringMode);return c.isNone(a)||"scale"!==a.type||c.isNone(this._ringDragData)?1:this._ringDragData.scale};b.prototype._shouldAllowModeType=function(a){return"scale"===a?this.enableScaling:c.isNone(this.graphic)||!this.enableRotation?!1:this.graphic.symbol.symbolLayers.some(function(a){return"object"===
a.type})};b.prototype._updateManipulators=function(a){if(!a){var b=this._calculateSymbolScaleFactor();a=p.mat4.fromScaling(v.sm4d.get(),x.vec3.set(v.sv3d.get(),b,b,1))}var d=this._manipulatorState,e=this._getManipulatorRotationAngle(),b=p.mat4.identity(v.sm4d.get());0!==e&&p.mat4.rotate(b,b,e,z.vec3f64.fromValues(0,0,1));var f=this.discManipulator.position,e=this.view.renderCoordsHelper.basisMatrixAtPosition(f,v.sm4d.get());a=a?p.mat4.multiply(v.sm4d.get(),e,a):e;var g=c.isSome(this.graphic)&&null!=
this.graphic.geometry,h=ha(this.view)?p.mat4.multiply(v.sm4d.get(),a,b):a;this.discManipulator.state=d;this.discManipulator.modelTransform=h;this.discManipulator.visible=g;this.arrowManipulators.forEach(function(a){var b=a.manipulator;a=a.transform;a=p.mat4.multiply(v.sm4d.get(),h,a);b.state=d;b.position=f;b.modelTransform=a;b.visible=g});b=p.mat4.multiply(v.sm4d.get(),a,b);this.ringManipulator.state=d;this.ringManipulator.position=this.discManipulator.position;this.ringManipulator.modelTransform=
b;b=this._ringMode;b=c.isSome(b)&&"disabled"===b.type;this.ringManipulator.visible=g&&!b};b.prototype._setSingleManipulatorInteractive=function(a,b){b?(this.discManipulator.interactive=this.discManipulator===a,this.ringManipulator.interactive=this.ringManipulator===a,this.arrowManipulators.forEach(function(b){b=b.manipulator;b.interactive=b===a})):(this.discManipulator.interactive=!0,this.ringManipulator.interactive=!0,this.arrowManipulators.forEach(function(a){a.manipulator.interactive=!0}))};b.prototype._startRingFocusFrameTask=
function(){var a=this;this._removeFrameTasks();var b=0;this._ringDelayedFocusFrameTask=C.addFrameTask({update:function(c){b+=c.deltaTime;a.ringManipulator.focused?b>g.RING_INDICATOR_DELAY_MS&&(a._ringManipulatorHasDelayedFocused=!0,a._removeFrameTasks(),a._updateManipulators()):(a._ringManipulatorHasDelayedFocused=!1,a._removeFrameTasks(),a._updateManipulators())}})};b.prototype._startScaleResetAnimation=function(a){var b=this;this._removeFrameTasks();var c=a;this._scaleAnimationFrameTask=C.addFrameTask({update:function(a){c+=
((c+1)/2-c)*Math.min(a.deltaTime*g.RING_RESET_ANIMATION_SPEED_FACTOR,1);.01>Math.abs(c-1)?(b._removeFrameTasks(),b._updateManipulators()):(b._ringManipulatorHasDelayedFocused=!1,a=p.mat4.fromScaling(v.sm4d.get(),x.vec3.set(v.sv3d.get(),c,c,1)),b._updateManipulators(a))}})};b.prototype._getManipulatorRotationAngle=function(){var a=c.isSome(this.graphic)?T(this.graphic):0,a=y.toRadian(-a);if(c.isNone(this._ringDragData)||c.isSome(this._ringDragData.mode))return a;var b=this._ringDragData;return a+aa.calculateInputRotationTransform(b.startPoint,
b.endPoint,b.origin,b.plane)};b.prototype._calculateArrowManipulatorTransform=function(a,b){var c=p.mat4.identity(v.sm4d.get());p.mat4.fromZRotation(c,a*Math.PI/2);a=p.mat4.identity(v.sm4d.get());p.mat4.fromTranslation(a,x.vec3.set(v.sv3d.get(),0,g.DISC_TRANSLATE_ARROW_OFFSET,0));return p.mat4.multiply(b,c,a)};b.prototype._calculateArrowManipulatorDirection=function(a,b){var c=this.discManipulator.modelTransform;return 0===a||2===a?x.vec3.set(b,c[4],c[5],c[6]):x.vec3.set(b,c[0],c[1],c[2])};b.prototype._removeFrameTasks=
function(){this.ringManipulator&&(this._ringManipulatorHasDelayedFocused=this.ringManipulator.focused);c.isSome(this._ringDelayedFocusFrameTask)&&(this._ringDelayedFocusFrameTask.remove(),this._ringDelayedFocusFrameTask=null);c.isSome(this._scaleAnimationFrameTask)&&(this._scaleAnimationFrameTask.remove(),this._scaleAnimationFrameTask=null)};e([k.property({constructOnly:!0,nonNullable:!0})],b.prototype,"view",void 0);e([k.property({value:null})],b.prototype,"graphic",null);e([k.property()],b.prototype,
"enableRotation",void 0);e([k.property()],b.prototype,"enableScaling",void 0);e([k.property({readOnly:!0})],b.prototype,"type",void 0);return b=e([k.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransform3DTool")],b)}(k.declared(R.InteractiveToolBase,a));b.GraphicTransform3DTool=r;var ma=z.vec3f64.create(),na=B.createScreenPointArray(),w;(function(a){a.Unlocked=16;a.ScaleIn=32;a.ScaleOut=64;a.RotateLeft=128;a.RotateRight=256;a.DiscFocused=512;a.DiscUnfocused=1024;a.RingFocused=
2048;a.RingUnfocused=4096;a.ArrowFocused=8192;a.ArrowUnfocused=16384;a.TouchInput=32768})(w||(w={}));var pa=G.ray.create(),oa=N.makeDehydratedPoint(0,0,0,null)})},"esri/views/3d/interactive/editingTools/graphicTransform3D/graphicTransform3DToolConfig":function(){define(["require","exports"],function(r,b){Object.defineProperty(b,"__esModule",{value:!0});b.HANDLE_COLOR=[1,.5,0];b.GEOMETRY_SEGMENTS=128;b.DISC_RADIUS=70;b.DISC_COLLISION_RADIUS=80;b.DISC_HEIGHT=.02;b.DISC_TRANSLATE_ARROW_SIZE=54;b.DISC_TRANSLATE_ARROW_OFFSET=
100;b.RING_RADIUS=160;b.RING_HEIGHT=.5;b.RING_THICKNESS=24;b.INDICATOR_THICKNESS=9;b.INNER_INDICATOR_RADIUS=b.RING_RADIUS+30;b.OUTER_INDICATOR_RADIUS=b.RING_RADIUS+53;b.ROTATE_INDICATOR_ARROW_TIP_LENGTH=60;b.ROTATE_INDICATOR_ARROW_TIP_RADIUS=23;b.ROTATE_INDICATOR_ARC_LENGTH=5*Math.PI/12;b.SCALE_INDICATOR_ARC_LENGTH=1*Math.PI/3;b.DRAG_THRESHOLD_PX=10;b.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE=.2;b.SCALE_INDICATOR_OFFSET1=30;b.SCALE_INDICATOR_OFFSET2=53;b.SCALE_INDICATOR_DIRECTION_BUFFER=.2;b.ROTATE_INDICATOR_DIRECTION_BUFFER=
.3;b.RING_INDICATOR_DELAY_MS=200;b.RING_RESET_ANIMATION_SPEED_FACTOR=3;b.ALIGN_ARROWS_SCALE_THRESHOLD=1E6})},"esri/views/3d/interactive/editingTools/graphicTransform3D/isSupportedGraphic":function(){define(["require","exports","../../../../../core/maybe"],function(r,b,e){Object.defineProperty(b,"__esModule",{value:!0});b.isSupportedGraphic=function(b){var q=e.isSome(b.symbol)&&"point-3d"===b.symbol.type&&b.symbol.symbolLayers;return!!q&&0<q.length&&q.some(function(b){return"object"===b.type})&&e.isSome(b.geometry)&&
"point"===b.geometry.type&&"graphics"===b.layer.type}})},"*noref":1}});define(["require","exports","./editingTools/graphicMove3D/GraphicMove3DTool","./editingTools/graphicReshape3D/GraphicReshape3DTool","./editingTools/graphicTransform3D/GraphicTransform3DTool"],function(r,b,e,q,t){Object.defineProperty(b,"__esModule",{value:!0});b.GraphicMove3DTool=e.GraphicMove3DTool;b.GraphicReshape3DTool=q.GraphicReshape3DTool;b.GraphicTransform3DTool=t.GraphicTransform3DTool});