// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/projectionUtils ../../webgl-engine/lib/localOrigin".split(" "),function(E,m,A,B,w,C,p,D){function x(a,c,b){var d=w.vec3f64.create(),h=Math.ceil(Math.log(a[3])*Math.LOG2E/y),k=Math.pow(2,h*y+z),f;if(b.isGeographic){f=k/C.earthRadius*180/Math.PI;b=Math.round(a[1]/f);var l=Math.max(-90,Math.min(90,b*f)),g=f/Math.cos((Math.abs(l)-
f/2)/180*Math.PI);f=Math.round(a[0]/g);d[0]=f*g;d[1]=l}else f=Math.round(a[0]/k),b=Math.round(a[1]/k),d[0]=f*k,d[1]=b*k;a=Math.round((a[2]+c)/k);d[2]=a*k;return{center:d,id:h+"_"+f+"_"+b+"_"+a}}Object.defineProperty(m,"__esModule",{value:!0});var g=new Float64Array(3E3),q=w.vec3f64.create();m.computeGlobalTransformation=function(a,c,b,d){a=x(a,c,b).center;c=A.mat4f64.create();p.computeLinearTransformation(b,a,c,d);return c};m.reprojectPoints=function(a,c,b,d,h,k,f){var l=a.data,m=a.offsetIdx;a=a.strideIdx;
B.vec3.copy(q,c);q[2]+=d;c=[0,0,0];d=l.length/a;p.vectorToVector(q,h,c,k);for(h=0;h<d;h+=1E3){for(var r=Math.min(1E3,d-h),e=0;e<r;e++){var n=m+a*(h+e);g[3*e+0]=l[n+0]+c[0];g[3*e+1]=l[n+1]+c[1];g[3*e+2]=l[n+2]+c[2]}p.bufferToBuffer(g,k,0,g,f,0,r);for(e=0;e<r;e++){var n=g[3*e+0],t=g[3*e+1],u=g[3*e+2],v=m+a*(h+e);l[v+0]=b[0]*n+b[4]*t+b[8]*u+b[12];l[v+1]=b[1]*n+b[5]*t+b[9]*u+b[13];l[v+2]=b[2]*n+b[6]*t+b[10]*u+b[14]}}};m.createOrigin=function(a,c,b,d){c=x(a,c,b);a=c.center;c=c.id;p.vectorToVector(a,b,
a,d);return D.fromVector(a,c)};var z=1,y=5-z});