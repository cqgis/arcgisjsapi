// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../2d/engine/vectorTiles/SchemaHelper ../../2d/engine/vectorTiles/TileHandler ../../2d/engine/vectorTiles/renderers/Renderer ./TiledLayerView3D".split(" "),function(p,q,k,d,f,l,b,m,g,h,n){return function(e){function a(c){return e.call(this)||this}k(a,e);a.prototype.initialize=function(){var c=this,
a=this._getTileInfoSupportError(this.layer.compatibleTileInfo256,this.layer.fullExtent),b;a?this.addResolvingPromise(f.reject(a)):b=l.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){var a=c.view.basemapTerrain.tilingScheme,b=a.pixelSize[0];c.schemaHelper=new m(b,c.view.spatialReference.isGeographic);b=256===b?c.layer.compatibleTileInfo256:c.view.spatialReference.isGeographic?c.layer.compatibleTileInfo512:c.layer.tileInfo;if(a=c._getTileInfoCompatibilityError(b,a))throw a;
c._set("tileInfo",b)});a=f.createAbortController();this.tileHandler=new g(this.layer,this.view.pixelRatio,!1,null);var d=this.tileHandler.start({signal:a.signal}),e=this.tileHandler.spriteMosaic;e.then(function(a){return c.renderer=new h(a,c.tileHandler.glyphMosaic,!1)});this.watch(["layer.currentStyleInfo","view.pixelRatio"],function(){c._tileHandlerController.abort();var a=new g(c.layer,c.view.pixelRatio,!1,null),b=new AbortController,b=a.start({signal:b.signal});f.all([b,a.spriteMosaic]).then(function(b){var d=
c.tileHandler,e=c.renderer;c.renderer=new h(b[1],a.glyphMosaic,!1);c.tileHandler=a;c.emit("data-changed");d.destroy();e&&e.dispose()})});this._tileHandlerController=a;b=f.all([b,d,e]);this.addResolvingPromise(b)};a.prototype.destroy=function(){this.renderer.dispose();this.renderer=null;this.tileHandler.destroy();this.tileHandler=null};Object.defineProperty(a.prototype,"dataLevelRange",{get:function(){var a=this.tileInfo.lods,a=this.levelRangeFromScaleRange(a[0].scale,a[a.length-1].scale);1===a.minLevel&&
256===this.tileInfo.size[0]&&(a.minLevel=0);return a},enumerable:!0,configurable:!0});d([b.property({aliasOf:"layer.fullExtent"})],a.prototype,"fullExtent",void 0);d([b.property()],a.prototype,"layer",void 0);d([b.property()],a.prototype,"tileInfo",void 0);d([b.property()],a.prototype,"dataLevelRange",null);d([b.property()],a.prototype,"updatingPercentageValue",void 0);return a=d([b.subclass("esri.views.3d.layers.VectorTileLayerView3D")],a)}(b.declared(n))});