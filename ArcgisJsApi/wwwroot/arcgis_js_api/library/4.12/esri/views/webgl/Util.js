// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils"],function(v,e,t,u){function p(a){return a[0].stride}function q(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}function r(a){switch(a){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:return 4;case 34041:return 4;case 33325:return 2;case 33326:return 4;
case 35898:return 4;case 33327:return 4;case 33328:return 8;case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1;default:u.neverReached(a)}return 0}function n(a){if(!a)return 0;if("colorAttachment"in a)return a.glName?n(a.colorAttachment)+n(a.depthStencilAttachment):0;if("descriptor"in a)return a.glName?n(a.descriptor):0;var d=a.internalFormat||"pixelFormat"in a&&a.pixelFormat;if(!d)return 0;var b="hasMipmap"in a&&a.hasMipmap?1.3:
1;a=a.width*a.height;return r(d)*a*b}Object.defineProperty(e,"__esModule",{value:!0});e.vertexCount=function(a,d){return a.vertexBuffers[d].size/p(a.layout[d])};e.getStride=p;e.getBytesPerElement=q;e.addDescriptor=function(a,d,b,g,m,h){var c=q(g);if(0<a.length){var f=a[0].stride,k=f+c*b;a.forEach(function(a){return a.stride=k});a.push({name:d,count:b,type:g,offset:f,stride:k,normalized:m,divisor:h})}else a.push({name:d,count:b,type:g,offset:0,stride:c*b,normalized:m,divisor:h})};e.assertCompatibleVertexAttributeLocations=
function(a,d){(a=a.locations===d.locations)||console.error("VertexAttributeLocations are incompatible");return a};e.hasAttribute=function(a,d){for(var b=0;b<a.length;b++)if(a[b].name===d)return!0;return!1};e.findAttribute=function(a,d){for(var b=0;b<a.length;b++)if(a[b].name===d)return a[b];return null};e.copyFramebufferToTexture=function(a,d,b,g,m){void 0===m&&(m=0);var h=a.getBoundFramebufferObject(),c=a.getBoundTexture(0);a.bindFramebuffer(d);a.bindTexture(b,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,
m,b.descriptor.pixelFormat,g[0],g[1],g[2],g[3],0);a.gl.flush();a.bindFramebuffer(h);a.bindTexture(c,0)};e.setBaseInstanceOffset=function(a,d){var b={},g;for(g in a)b[g]=a[g].map(function(a){return a.divisor?t({},a,{baseInstance:d}):a});return b};e.bindVertexBufferLayout=function(a,d,b,g,e){var h=a.gl,c=a.capabilities.instancing;a.bindBuffer(b);for(a=0;a<g.length;a++){b=g[a];var f=d[b.name],k=(e?e:0+b.baseInstance?b.baseInstance:0)*b.stride;void 0===f&&console.error("There is no location for vertex attribute '"+
b.name+"' defined.");b.baseInstance&&!b.divisor&&console.error("Vertex attribute '"+b.name+"' uses baseInstanceOffset without divisor.");if(4>=b.count)h.vertexAttribPointer(f,b.count,b.type,b.normalized,b.stride,b.offset+k),h.enableVertexAttribArray(f),b.divisor&&0<b.divisor&&c&&c.vertexAttribDivisor(f,b.divisor);else if(9===b.count)for(var l=0;3>l;l++)h.vertexAttribPointer(f+l,3,b.type,b.normalized,b.stride,b.offset+12*l+k),h.enableVertexAttribArray(f+l),b.divisor&&0<b.divisor&&c&&c.vertexAttribDivisor(f+
l,b.divisor);else if(16===b.count)for(l=0;4>l;l++)h.vertexAttribPointer(f+l,4,b.type,b.normalized,b.stride,b.offset+16*l+k),h.enableVertexAttribArray(f+l),b.divisor&&0<b.divisor&&c&&c.vertexAttribDivisor(f+l,b.divisor);else console.error("Unsupported vertex attribute element count: "+b.count)}};e.unbindVertexBufferLayout=function(a,d,b,g){var e=a.gl,h=a.capabilities.instancing;a.bindBuffer(b);for(b=0;b<g.length;b++){var c=g[b],f=d[c.name];if(4>=c.count)e.disableVertexAttribArray(f),c.divisor&&0<c.divisor&&
h&&h.vertexAttribDivisor(f,0);else if(9===c.count)for(var k=0;3>k;k++)e.disableVertexAttribArray(f+k),c.divisor&&0<c.divisor&&h&&h.vertexAttribDivisor(f+k,0);else if(16===c.count)for(k=0;4>k;k++)e.disableVertexAttribArray(f+k),c.divisor&&0<c.divisor&&h&&h.vertexAttribDivisor(f+k,0);else console.error("Unsupported vertex attribute element count: "+c.count)}a.unbindBuffer(34962)};e.getBytesPerElementFormat=r;e.getGpuMemoryUsage=n});