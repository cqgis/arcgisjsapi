// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports @dojo/framework/shim/number ../../core/maybe ../../core/now ../../core/PooledArray".split(" "),function(r,f,n,p,q,k){function m(d){return new e.Budget(d)}Object.defineProperty(f,"__esModule",{value:!0});f.newScheduler=function(d){return new e.Scheduler(d)};f.newBudget=m;var e;(function(d){var f=function(){function b(a){this._now=a;this._budget=null;this._state=1;this._tasks=new k;this._runQueue=new k;this._load=0;this._idleStateCallbacks=new k;this._idleUpdatesStartFired=!1;
this._maxReschedule=l;this._forceTask=!1;this._safetyBudget=0;this._budget=new d.Budget(a);var b=this;this._test={state:void 0,FRAME_SAFETY_BUDGET:1,idleBudget:100,get budget(){return b._budget.budget},elapsed:0}}b.prototype.registerTask=function(a,b,c){var g=this,h={update:b,needsUpdate:c,priority:a,schedule:a};this._tasks.push(h);return{remove:function(){return g._removeTask(h)},set priority(a){h.priority=a;0!==h.schedule&&(h.schedule=a)}}};b.prototype.registerIdleStateCallbacks=function(a,b){var c=
this,g={idleBegin:a,idleEnd:b};this._idleStateCallbacks.push(g);2===this.state&&this._idleUpdatesStartFired&&g.idleBegin();var h=this;return{remove:function(){return c._removeIdleStateCallbacks(g)},set idleBegin(a){h._idleUpdatesStartFired&&(g.idleEnd(),2===h._state&&a());g.idleBegin=a},set idleEnd(a){g.idleEnd=a}}};Object.defineProperty(b.prototype,"now",{get:function(){return this._now()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"load",{get:function(){return this._load},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){return p.isNone(this._test.state)?this._state:this._test.state},set:function(a){this._state!==a&&(this._state=a,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forEach(function(a){return a.idleEnd()})))},enumerable:!0,configurable:!0});b.prototype.updateBudget=function(a){var b=2===this.state,c=a.frameDuration;switch(this.state){case 2:c=100;break;case 1:c=
Math.max(33,a.frameDuration);break;case 0:c=a.frameDuration}this._safetyBudget=b?0:1;c-=a.elapsedFrameTime+this._safetyBudget;this._test.elapsed=0;if(!b&&0>c&&!this._forceTask)return this._forceTask=!0,!1;c=Math.max(c,5);this._budget.reset(c,b);this._maxReschedule=l;return this._schedule()};b.prototype.frame=function(){this._forceTask=!1;switch(this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forEach(function(a){return a.idleBegin()}));this._idleFrame();
break;case 1:this._movingFrame();break;default:this._run()}this._test.elapsed=this._budget.elapsed};b.prototype._removeIdleStateCallbacks=function(a){this._idleUpdatesStartFired&&a.idleEnd();this._idleStateCallbacks.removeUnordered(a)};b.prototype._removeTask=function(a){this._tasks.removeUnordered(a);this._runQueue.removeUnordered(a)};b.prototype._idleFrame=function(){this._run()};b.prototype._movingFrame=function(){this._run()};b.prototype._schedule=function(){var a=this;if(0>=this._maxReschedule)return!1;
this._runQueue.forEach(function(a){a.needsUpdate()||(e.push(a),a.schedule=a.priority)});this._runQueue.removeUnorderedMany(e.data,e.length);e.clear();for(var b=function(){var b=0,d=0;c._tasks.forEach(function(c){if(c.needsUpdate())switch(++b,d=Math.max(d,c.priority),c.schedule){case 0:break;case 1:c.schedule=0;a._runQueue.push(c);break;default:--c.schedule}});if(0===b)return c._load*=.9,{value:!1};c._maxReschedule===l&&(c._maxReschedule=d,c._load=.9*c._load+b*(1-.9));--c._maxReschedule},c=this;0===
this._runQueue.length;){var d=b();if("object"===typeof d)return d.value}return!0};b.prototype._run=function(){do for(;0<this._runQueue.length;){var a=this._runQueue.pop();this._budget.resetProgress();a.update(this._budget);a.schedule=a.priority;if(0>=this._budget.remaining)return}while(this._schedule())};Object.defineProperty(b.prototype,"test",{get:function(){return this._test},enumerable:!0,configurable:!0});return b}();d.Scheduler=f;var e=new k,f=function(){function b(a){this.now=a;this._budget=
this._begin=0;this._didWork=this._idle=!1;this._enabled=!0}b.prototype.run=function(a){if(this.done)return!1;!0===a()&&(this._didWork=!0);return!0};Object.defineProperty(b.prototype,"done",{get:function(){return this._didWork&&this.elapsed>=this._budget&&this._enabled},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"budget",{get:function(){return this._budget},enumerable:!0,configurable:!0});b.prototype.madeProgress=function(){this._didWork=!0};Object.defineProperty(b.prototype,
"idleFrame",{get:function(){return this._idle},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a},enumerable:!0,configurable:!0});b.prototype.reset=function(a,b){this._begin=this.now();this._budget=a;this._idle=b;this._didWork=!1};Object.defineProperty(b.prototype,"remaining",{get:function(){return Math.max(this._budget-this.elapsed,0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"elapsed",{get:function(){return this.now()-this._begin},enumerable:!0,configurable:!0});b.prototype.resetProgress=function(){this._didWork=!1};Object.defineProperty(b.prototype,"hasProgressed",{get:function(){return this._didWork},enumerable:!0,configurable:!0});return b}();d.Budget=f})(e||(e={}));f.noBudget=function(){var d=m(q);d.enabled=!1;return d}();var l=n.MAX_SAFE_INTEGER});