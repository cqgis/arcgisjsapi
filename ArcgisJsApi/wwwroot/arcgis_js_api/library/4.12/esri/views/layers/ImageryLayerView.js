// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../layers/support/timeUtils ../../tasks/support/Query ./RefreshableLayerView ./support/popupUtils".split(" "),function(D,E,u,c,v,w,l,x,y,a,m,z,A,B,C){return function(e){function b(d){d=e.call(this,d)||this;d.view=
null;return d}u(b,e);b.prototype.fetchPopupFeatures=function(d,b){return w(this,void 0,void 0,function(){var a,c,f,e,g,h,n,k,p,q,r;return v(this,function(t){switch(t.label){case 0:a=this.layer;if(!d)return[2,y.reject(new l("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:a}))];c=a.popupEnabled;f=C.getFetchPopupTemplate(a,b);if(!c||!x.isSome(f))throw new l("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:c,popupTemplate:f});
return[4,f.getRequiredFields()];case 1:return e=t.sent(),g=new A,g.geometry=d,g.outFields=e,g.outSpatialReference=d.spatialReference,h=this.view.resolution,n="2d"===this.view.type?new m(h,h,this.view.spatialReference):new m(.5*h,.5*h,this.view.spatialReference),k=f.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},p=k.returnTopmostRaster,q=k.showNoDataRecords,r={returnDomainValues:!0,returnTopmostRaster:p,pixelSize:n,showNoDataRecords:q},[2,a.queryVisibleRasters(g,r).then(function(a){return a})]}})})};
c([a.property()],b.prototype,"layer",void 0);c([a.property()],b.prototype,"view",void 0);c([a.property(z.combinedViewLayerTimeExtentProperty)],b.prototype,"timeExtent",void 0);return b=c([a.subclass("esri.views.layers.ImageryLayerView")],b)}(a.declared(B))});