// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define(["require","exports","@dojo/framework/shim/Map"],function(f,g,k){function h(c){return"esri.views.2d.layers.FeatureLayerView2D"===c.declaredClass||"esri.views.2d.layers.StreamLayerView2D"===c.declaredClass}Object.defineProperty(g,"__esModule",{value:!0});f=function(){function c(a,b){this.registerLayer=a;this.unregisterLayer=b;this._layerViewState=new k.default}c.prototype.findIndex=function(a){return a.view.allLayerViews.findIndex(function(b){return b.uid===a.uid})};c.prototype.update=function(a){for(var b=
a.added,d=0,e=a.removed;d<e.length;d++)a=e[d],h(a)&&this._layerViewState.has(a)&&this._deleteState(a);for(d=0;d<b.length;d++){a=b[d];if(e=h(a))a:switch(a.get("layer.renderer.type")){case "class-breaks":case "simple":case "unique-value":e=!0;break a;default:e=!1}e&&!this._layerViewState.has(a)&&this._createState(a)}this._recomputeOrder()};c.prototype.destroy=function(){this._layerViewState.forEach(function(a,b){return a.handle.remove()})};c.prototype._createState=function(a){var b={priority:-1,handle:null};
b.handle=a.watch("labelsVisible",this._recomputeOrder.bind(this));this._layerViewState.set(a,b);return b};c.prototype._deleteState=function(a){if(this._layerViewState.has(a)){var b=this._layerViewState.get(a);b.handle.remove();-1!==b.priority&&this.unregisterLayer(a);this._layerViewState.delete(a)}};c.prototype._recomputeOrder=function(){var a=this;this._layerViewState.forEach(function(b,d){var e=d.view.map.allLayers.findIndex(function(a){return a.uid===d.layer.uid}),c=d.layer,e=c.visible&&c.labelsVisible&&
c.labelingInfo?4294967295-e:-1;e!==b.priority&&(b.priority=e,a.unregisterLayer(d),-1!==e&&a.registerLayer(d,e))})};return c}();g.LayerViewSorter=f});