// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../request ../../../../core/asyncUtils ../../../../core/has ../../../../core/ItemCache ../../../../core/promiseUtils ../../../../core/promiseUtils ../../../../core/requireUtils ../../../../core/workers ./GeometryUtils ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./TileIndex ./VectorTileDisplayObject ../../tiling/TileKey module @dojo/framework/shim/Promise".split(" "),
function(w,v,r,h,f,d,a,b,c,e,y,m,q,p,g,l,z,x,t,C,A){var n=new c(10),k=new Map;return function(){function c(a,c,e,b){this.devicePixelRatio=c;this.allowUpdates=e;this._connection=this._glyphMosaic=this._spriteMosaic=null;this._updateToAbortController=new Map;this._ongoingTileRequests=new Map;this._ongoingRequestToController=new Map;this._vectorTileLayer=a;this._container=b}c.prototype.destroy=function(){this._updateToAbortController&&this._updateToAbortController.forEach(function(a){return a.abort()});
this._ongoingTileRequests&&this.abortAll();this._connection&&(this._connection.close(),this._connection=null);this._vectorTileLayer=null;this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)};Object.defineProperty(c.prototype,"spriteMosaic",{get:function(){var a=this;return this._spriteSourcePromise.then(function(){return a._spriteMosaic})},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});c.prototype.start=function(c){return f(this,void 0,void 0,function(){var b,k,t,n,d,u=this;return h(this,function(H){b=this._vectorTileLayer.sourceNameToSource;k=[];for(t in b)k.push(this._fetchTileMap(b[t],c));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,c);this._spriteSourcePromise.then(function(a){u._spriteMosaic=new z(1024,1024,250);u._spriteMosaic.setSpriteSource(a)});
n=this._vectorTileLayer.styleRepository;d=new l(n.glyphs);this._glyphMosaic=new g(1024,1024,d);this._broadcastPromise=a.safeCast(q.open(m.getAbsMid("./WorkerTileHandler",w,A),{client:this,signal:c&&c.signal})).then(function(a){u._connection=a;return e.all(u._connection.broadcast("setLayers",n.styleJSON,r({},c)))});return[2,e.all(k)]})})};c.prototype.updateStyle=function(){return f(this,void 0,void 0,function(){var a,c=this;return h(this,function(b){switch(b.label){case 0:return[4,this._broadcastPromise];
case 1:return b.sent(),this._updateToAbortController.forEach(function(a){return a.abort()}),this._updateToAbortController.clear(),a=this._vectorTileLayer.styleRepository,this._broadcastPromise=e.create(function(b,g){e.all(c._connection.broadcast("updateStyle",a.styleJSON)).then(b,g)}),[2,this._broadcastPromise]}})})};c.prototype.updateTile=function(a,c){return f(this,void 0,void 0,function(){var b,g,l,k,t=this;return h(this,function(n){switch(n.label){case 0:return this.allowUpdates?[4,this._broadcastPromise]:
[2,null];case 1:n.sent();b=Math.round(p.degToByte(c.state.rotation));if(a.rotation===b)return[2,null];l=a.key;this._updateToAbortController.has(l.id)&&(g=this._updateToAbortController.get(l.id),g.abort(),this._updateToAbortController.delete(l.id));g=e.createAbortController();a.rotation=b;k=a.client.invoke("updateSymbols",{key:a.id,rotation:b},{signal:g.signal}).then(function(c){t._updateToAbortController.delete(l.id);a.updateSymbolData(c);return c}).catch(function(a){e.isAbortError(a)||t._updateToAbortController.delete(l.id)});
this._updateToAbortController.set(a.id,g);return[2,k]}})})};c.prototype.updateTileData=function(a){for(var c=a.tileId,e=this._container.children,b,g=0;g<e.length;g++)if(b=e[g],b.id===c){b.updateTileData(a.tileData);break}};c.prototype.getVectorTile=function(a,c,e,b){void 0===b&&(b=0);return f(this,void 0,void 0,function(){var g,l,k;return h(this,function(n){switch(n.label){case 0:return g=new C(a,c,e,0),l=new t(g,this._vectorTileLayer.tileInfo,this._vectorTileLayer.styleRepository,0),[4,this._getVectorTileData(g,
b,null)];case 1:return(k=n.sent())?l.setData(k.tileData,k.client):l.setData(null,null),[2,l]}})})};c.prototype.getVectorTile3D=function(a,c,e,b){void 0===b&&(b=0);return f(this,void 0,void 0,function(){var g,l,k,t;return h(this,function(n){switch(n.label){case 0:return[4,new Promise(function(a,c){w(["./VectorTileDisplayObject3D"],a,c)})];case 1:return g=n.sent(),l=new C(a,c,e,0),k=new g(l,this._vectorTileLayer.tileInfo,this._vectorTileLayer.styleRepository,0),[4,this._getVectorTileData(l,b,null)];
case 2:return(t=n.sent())?k.setData(t.tileData,t.client):k.setData(null,null),[2,k]}})})};c.prototype.fetchTileData=function(a,c){return f(this,void 0,void 0,function(){var e,b,g,l;return h(this,function(k){switch(k.label){case 0:return[4,this._getRefKeys(a,c)];case 1:e=k.sent();b=this._vectorTileLayer.sourceNameToSource;g=[];for(l in b)g.push(l);return[2,this._getSourcesData(a,g,e,c)]}})})};c.prototype.parseTileData=function(a,c,e){return f(this,void 0,void 0,function(){var g,l,k,t,n,u,d,y;return h(this,
function(m){switch(m.label){case 0:g=a&&a.data;if(!g)return[2,{tileData:null,client:null}];l=g.sourceName2DataAndRefKey;k=g.transferList;return 0===Object.keys(l).length?[2,{tileData:null,client:null}]:[4,this._broadcastPromise];case 1:return m.sent(),t=Math.round(p.degToByte(c)),n=this._connection.getAvailableClient(),[4,n.invoke("createTileAndParse",{key:a.key.id,rotation:t,cacheTile:this.allowUpdates,sourceName2DataAndRefKey:l},r({},e,{transferList:k}))];case 2:u=m.sent();if(b("esri-vector-tiles-debug")){d=
{};for(y in l)d[y]=l[y].refKey;return[2,{tileData:u,client:n,refKeys:d}]}return[2,{tileData:u,client:n}]}})})};Object.defineProperty(c.prototype,"updating",{get:function(){return 0<this._ongoingTileRequests.size},enumerable:!0,configurable:!0});c.prototype.abortAll=function(){this._ongoingRequestToController.forEach(function(a){return a.abort()});this._ongoingRequestToController.clear();this._ongoingTileRequests.clear()};c.prototype.getSprites=function(a){var c=this;return this._spriteSourcePromise.then(function(){return c._spriteMosaic.getSpriteItems(a)})};
c.prototype.getGlyphs=function(a){return this._glyphMosaic.getGlyphItems(a.tileID,a.font,a.codePoints)};c.prototype.getStyleRepository=function(){return this._vectorTileLayer.styleRepository};c.prototype._getTilePayload=function(a,c,e,b){return f(this,void 0,void 0,function(){var a,g,l,k,t;return h(this,function(n){switch(n.label){case 0:return a=C.pool.acquire(c.id),g=this._vectorTileLayer.sourceNameToSource,l=g[e],k=l.getSourceTileUrl(a.level,a.row,a.col),C.pool.release(a),[4,d(k,r({responseType:"array-buffer"},
b))];case 1:return t=n.sent(),[2,{protobuff:t.data,sourceName:e}]}})})};c.prototype._fetchTileMap=function(a,c){if(a.capabilities.operations.supportsTileMap&&a.tileIndex||!a.tileMapURL)return e.resolve();var b=n.get(a.tileMapURL);if(b)return a.tileIndex=b,e.resolve();if(k.has(a.tileMapURL))return k.get(a.tileMapURL).then(function(c){a.tileIndex=new x(c.data)});c=d(a.tileMapURL,c);c.then(function(c){a.tileIndex=new x(c.data);k["delete"](a.tileMapURL);n.put(a.tileMapURL,a.tileIndex)});k.set(a.tileMapURL,
c);return c};c.prototype._getRefKeys=function(a,c){return f(this,void 0,void 0,function(){var b,g,l,k,t;return h(this,function(n){b=this._vectorTileLayer.sourceNameToSource;g=[];for(l in b)k=b[l],t=k.getRefKey(a,c),g.push(t);return[2,e.eachAlways(g)]})})};c.prototype._getSourcesData=function(a,c,b,g){return f(this,void 0,void 0,function(){var l,k,t,n,u,d,y;return h(this,function(m){switch(m.label){case 0:l=[];for(k=0;k<b.length;k++)null==b[k].value||null==c[k]?l.push(null):(t=this._getTilePayload(a,
b[k].value,c[k],g),l.push(t));return[4,e.eachAlways(l)];case 1:n=m.sent();u={};d=[];for(k=0;k<n.length;k++)n[k].value&&n[k].value&&n[k].value.protobuff&&0<n[k].value.protobuff.byteLength&&(y=b[k].value.id,u[n[k].value.sourceName]={refKey:y,protobuff:n[k].value.protobuff},d.push(n[k].value.protobuff));return[2,{sourceName2DataAndRefKey:u,transferList:d}]}})})};c.prototype._getVectorTileData=function(a,c,e){return f(this,void 0,void 0,function(){var b,g,l,k,t,n=this;return h(this,function(u){b=a.id;
if(this._ongoingTileRequests.has(b))return[2,this._ongoingTileRequests.get(b)];g=new AbortController;l={signal:g.signal};k=e&&e.signal;t=this._getParsedVectorTileData(a,c,l).then(function(a){n._ongoingTileRequests.delete(b);n._ongoingRequestToController.delete(b);return a}).catch(function(a){n._ongoingTileRequests.delete(b);n._ongoingRequestToController.delete(b);return null});this._ongoingTileRequests.set(b,t);this._ongoingRequestToController.set(b,g);if(k)y.onAbort(k,function(){g.abort();n._ongoingTileRequests.delete(b);
n._ongoingRequestToController.delete(b)});return[2,t]})})};c.prototype._getParsedVectorTileData=function(a,c,e){return f(this,void 0,void 0,function(){var b;return h(this,function(g){switch(g.label){case 0:return[4,this.fetchTileData(a,e)];case 1:return b=g.sent(),[2,this.parseTileData({key:a,data:b},c,e)]}})})};return c}()})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(w,v,r){return function(){function h(f,d){this._storage=new r.MemCacheStorage;this._storage.maxSize=
f;d&&this._storage.registerRemoveFunc("",d)}h.prototype.put=function(f,d){this._storage.put(f,d,1,1)};h.prototype.pop=function(f){return this._storage.pop(f)};h.prototype.get=function(f){return this._storage.get(f)};h.prototype.clear=function(){this._storage.clearAll()};h.prototype.destroy=function(){this._storage.clearAll()};return h}()})},"esri/core/MemCache":function(){define(["require","exports","./iteratorUtils","./PooledArray","./string"],function(w,v,r,h,f){Object.defineProperty(v,"__esModule",
{value:!0});w=function(){function d(a,b,c){this._namespace=a;this._storage=b;this._removeFunc=!1;this._miss=this._hit=0;this._storage.register(this);this._namespace+=":";c&&(this._storage.registerRemoveFunc(this._namespace,c),this._removeFunc=!0)}Object.defineProperty(d.prototype,"namespace",{get:function(){return this._namespace.slice(0,-1)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hitRate",{get:function(){return this._hit/(this._hit+this._miss)},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"size",{get:function(){return this._storage.size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maxSize",{get:function(){return this._storage.maxSize},enumerable:!0,configurable:!0});d.prototype.resetHitRate=function(){this._hit=this._miss=0};d.prototype.destroy=function(){this._storage.clear(this._namespace);this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace);this._storage.deregister(this)};d.prototype.put=function(a,b,c,e){void 0===
e&&(e=1);this._storage.put(this._namespace+a,b,c,e)};d.prototype.get=function(a){a=this._storage.get(this._namespace+a);void 0===a?++this._miss:++this._hit;return a};d.prototype.pop=function(a){a=this._storage.pop(this._namespace+a);void 0===a?++this._miss:++this._hit;return a};d.prototype.clear=function(){this._storage.clear(this._namespace)};d.prototype.clearAll=function(){this._storage.clearAll()};d.prototype.getStats=function(){return this._storage.getStats()};d.prototype.resetStats=function(){this._storage.resetStats()};
return d}();v.MemCache=w;w=function(){function d(a){void 0===a&&(a=10485760);this._maxSize=a;this._db=new Map;this._miss=this._hit=this._size=0;this._removeFuncs=[];this._users=new h}d.prototype.register=function(a){this._users.push(a)};d.prototype.deregister=function(a){this._users.removeUnordered(a)};d.prototype.registerRemoveFunc=function(a,b){this._removeFuncs.push([a,b])};d.prototype.deregisterRemoveFunc=function(a){this._removeFuncs=this._removeFuncs.filter(function(b){return b[0]!==a})};Object.defineProperty(d.prototype,
"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maxSize",{get:function(){return this._maxSize},set:function(a){this._maxSize=Math.max(a,0);this._size>this._maxSize&&this._removeEntries()},enumerable:!0,configurable:!0});d.prototype.put=function(a,b,c,e){if(this._db.has(a)){var d=this._db.get(a);this._size-=d.size;this._db.delete(a);this._notifyRemoved(a,d.entry)}c>this._maxSize?this._notifyRemoved(a,b):void 0===b?console.warn("Refusing to cache undefined entry "):
!c||0>c?console.warn("Refusing to cache entry with invalid size "+c):(this._db.set(a,{entry:b,size:c,lifetime:e,lives:e}),this._size+=c,this._size>this._maxSize&&this._removeEntries())};d.prototype.pop=function(a){if(this._db.has(a)){var b=this._db.get(a);this._size-=b.size;this._db.delete(a);++this._hit;return b.entry}++this._miss};d.prototype.get=function(a){var b=this._db.get(a);if(void 0===b)++this._miss;else return this._db.delete(a),b.lives=b.lifetime,this._db.set(a,b),++this._hit,b.entry};
d.prototype.getStats=function(){var a=this,b={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},c={},e=[];this._db.forEach(function(b,g){var l=b.lifetime;e[l]=(e[l]||0)+1;a._users.forEach(function(a){a=a.namespace;if(f.startsWith(g,a))return c[a]=(c[a]||0)+b.size,!1})});var d={};this._users.forEach(function(a){var e=a.namespace;!isNaN(a.hitRate)&&0<a.hitRate?(c[e]=c[e]||0,d[e]=Math.round(100*
a.hitRate)+"%"):d[e]="0%"});var m=Object.keys(c);m.forEach(function(e){return c[e]=c[e]/a._size*100});m.sort(function(a,e){return c[e]-c[a]});m.forEach(function(a){return b[a]=Math.round(c[a])+"% / "+d[a]});for(m=0;m<e.length;++m){var q=e[m];q&&(b["Lifetime "+m]=Math.round(q/this._db.size*100)+"%")}return b};d.prototype.resetStats=function(){this._hit=this._miss=0;this._users.forEach(function(a){return a.resetHitRate()})};d.prototype.clear=function(a){var b=this;this._db.forEach(function(c,e){f.startsWith(e,
a)&&(b._size-=c.size,b._db.delete(e),b._notifyRemoved(e,c.entry))})};d.prototype.clearAll=function(){var a=this;this._db.forEach(function(b,c){a._notifyRemoved(c,b.entry)});this._size=0;this._db.clear()};d.prototype._getHitRate=function(){return this._hit/(this._hit+this._miss)};d.prototype._notifyRemoved=function(a,b){this._removeFuncs.forEach(function(c){if(f.startsWith(a,c[0]))c[1](b)})};d.prototype._removeEntries=function(){var a=this;r.everyMap(this._db,function(b,c){a._db.delete(c);1>=b.lives?
(a._size-=b.size,a._notifyRemoved(c,b.entry)):(--b.lives,a._db.set(c,b));return a._size>.9*a.maxSize})};return d}();v.MemCacheStorage=w})},"esri/core/PooledArray":function(){define(["require","exports","./tsSupport/generatorHelper","./arrayUtils","./HeapSort"],function(w,v,r,h,f){return function(){function d(a){var b=this;this.data=[];this._length=0;this._allocator=null;this._deallocator=function(){};this._shrink=function(){};this._hint=new h.RemoveHint;a&&(a.initialSize&&(this.data=Array(a.initialSize)),
a.allocator?(this._allocator=a.allocator,this._deallocator=a.deallocator):"deallocator"in a&&(this._deallocator=a.deallocator),a.shrink&&(this._shrink=function(){b.data.length>1.5*b.length&&(b.data.length=Math.floor(1.1*b.length))}))}d.prototype.toArray=function(){return this.data.slice(0,this.length)};Object.defineProperty(d.prototype,"length",{get:function(){return this._length},set:function(a){if(a>this._length)if(this._allocator)for(;this._length<a;)this.data[this._length++]=this._allocator(this.data[this._length]);
else this._length=a;else{if(this._deallocator)for(var b=a;b<this._length;++b)this.data[b]=this._deallocator(this.data[b]);this._length=a;this._shrink()}},enumerable:!0,configurable:!0});d.prototype.clear=function(){this.length=0};d.prototype.prune=function(){this.clear();this.data=[]};d.prototype.equal=function(a){return h.equals(this.data,a.data)};d.prototype.push=function(a){return this.data[this._length++]=a};d.prototype.pushArray=function(a,b){void 0===b&&(b=a.length);for(var c=0;c<b;c++)this.data[this._length++]=
a[c];return this.back()};d.prototype.pushNew=function(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));++this._length;return this.back()};d.prototype.pop=function(){if(0!==this.length){var a=this.data[this.length-1];--this.length;this._shrink();return a}};d.prototype.removeMany=function(a){var b=this,c=[];this.data=this.data.filter(function(e,d){if(d>=b.length)return!1;if(0>a.indexOf(e))return!0;c.push(e);return!1});this._length=this.data.length;return c};d.prototype.iterableRemoveMany=
function(a,b){var c,e;return r(this,function(d){switch(d.label){case 0:c=[],e=0,d.label=1;case 1:if(!(e<this.length)||e>=this.length)return[3,4];0>a.indexOf(this.data[e])&&c.push(this.data[e]);return b()?[4]:[3,3];case 2:d.sent(),d.label=3;case 3:return++e,[3,1];case 4:return this.data=c,this._length=this.data.length,[2]}})};d.prototype.removeUnordered=function(a){a=h.removeUnordered(this.data,a,this.length,this._hint);void 0!==a&&--this.length;return a};d.prototype.removeUnorderedIndex=function(a){if(!(a>=
this.length||0>a))return this.swapElements(a,this.length-1),this.pop()};d.prototype.removeUnorderedMany=function(a,b,c){void 0===b&&(b=a.length);this.length=h.removeUnorderedMany(this.data,a,this.length,b,this._hint,c)};d.prototype.front=function(){if(0!==this.length)return this.data[0]};d.prototype.back=function(){if(0!==this.length)return this.data[this.length-1]};d.prototype.swapElements=function(a,b){var c;a>=this.length||b>=this.length||a===b||(c=[this.data[b],this.data[a]],this.data[a]=c[0],
this.data[b]=c[1])};d.prototype.sort=function(a){f.sort(this.data,0,this.length,a)};d.prototype.iterableSort=function(a,b){return f.iterableSort(this.data,0,this.length,a,b)};d.prototype.some=function(a,b){for(var c=0;c<this.length;++c)if(a.call(b,this.data[c],c,this.data))return!0;return!1};d.prototype.find=function(a,b){for(var c=0;c<this.length;++c){var e=this.data[c];if(a.call(b,e,c,this.data))return e}};d.prototype.filterInPlace=function(a,b){for(var c=0,e=0;e<this._length;++e){var d=this.data[e];
a.call(b,d,e,this.data)&&(this.data[e]=this.data[c],this.data[c]=d,c++)}if(this._deallocator)for(e=c;e<this._length;e++)this.data[e]=this._deallocator(this.data[e]);this._length=c;return this};d.prototype.forEach=function(a,b){for(var c=this.length,e=0;e<Math.min(this.length,c);++e)a.call(b,this.data[e],e,this.data)};d.prototype.iterableForEach=function(){var a;return r(this,function(b){switch(b.label){case 0:a=0,b.label=1;case 1:return a<this.length?[4,this.data[a]]:[3,4];case 2:b.sent(),b.label=
3;case 3:return++a,[3,1];case 4:return[2]}})};d.prototype.map=function(a,b){for(var c=Array(this.length),e=0;e<this.length;++e)c[e]=a.call(b,this.data[e],e,this.data);return c};return d}()})},"esri/core/HeapSort":function(){define(["require","exports","./tsSupport/generatorHelper"],function(w,v,r){var h;(function(f){function d(a,c,e,d){for(var b=c,y=e>>>1,p=a[b-1];c<=y;){c=b<<1;c<e&&0>d(a[c-1],a[c])&&++c;var g=a[c-1];if(0>=d(g,p))break;a[b-1]=g;b=c}a[b-1]=p}function a(a,c){return a<c?-1:a>c?1:0}f.sort=
function(b,c,e,y){void 0===c&&(c=0);void 0===e&&(e=b.length);void 0===y&&(y=a);for(var m=e>>>1;m>c;m--)d(b,m,e,y);for(var q=c+1,m=e-1;m>c;m--)e=b[c],b[c]=b[m],b[m]=e,d(b,q,m,y)};f.iterableSort=function(b,c,e,y,m){var q,p,g;return r(this,function(l){switch(l.label){case 0:void 0===c&&(c=0),void 0===e&&(e=b.length),void 0===y&&(y=a),q=e>>>1,l.label=1;case 1:if(!(q>c))return[3,4];d(b,q,e,y);return m&&m()?[4]:[3,3];case 2:l.sent(),l.label=3;case 3:return q--,[3,1];case 4:p=c+1,q=e-1,l.label=5;case 5:if(!(q>
c))return[3,8];g=b[c];b[c]=b[q];b[q]=g;d(b,p,q,y);return m&&m()?[4]:[3,7];case 6:l.sent(),l.label=7;case 7:return q--,[3,5];case 8:return[2]}})}})(h||(h={}));return h})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define("require exports ../../../../core/has ../../../../core/promiseUtils ../../../webgl ./RectangleBinPack ../webgl/Rect".split(" "),function(w,v,r,h,f,d,a){return function(){function b(a,e,b){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=
0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=a;this.height=e;this._glyphSource=b;this._binPack=new d(a-4,e-4);this._glyphData.push(new Uint8Array(a*e));this._dirties.push(!0);this._textures.push(void 0)}b.prototype.getGlyphItems=function(c,e,b){var m=this,y=[],p=this._glyphSource;c=new Set;for(var g=1/256,l=0;l<b.length;l++)c.add(Math.floor(b[l]*g));var f=[];c.forEach(function(a){if(256>=a){var c=e+a;m._rangePromises.has(c)?f.push(m._rangePromises.get(c)):(a=p.getRange(e,
a).then(function(){m._rangePromises["delete"](c)},function(){m._rangePromises["delete"](c)}),m._rangePromises.set(c,a),f.push(a))}});return h.all(f).then(function(c){var g=m._glyphIndex[e];g||(g={},m._glyphIndex[e]=g);for(var l=0;l<b.length;l++){c=b[l];var x=g[c];if(x)y[c]={sdf:!0,rect:x.rect,metrics:x.metrics,page:x.page};else{var n=p.getGlyph(e,c);if(n&&n.metrics){var x=n.metrics,k=void 0;if(0===x.width)k=new a.default(0,0,0,0);else{var u=x.width+6,f=x.height+6,q=u%4?4-u%4:4,z=f%4?4-f%4:4;1===q&&
(q=5);1===z&&(z=5);k=m._binPack.allocate(u+q,f+z);k.isEmpty&&(m._dirties[m._currentPage]||(m._glyphData[m._currentPage]=null),m._currentPage=m._glyphData.length,m._glyphData.push(new Uint8Array(m.width*m.height)),m._dirties.push(!0),m._textures.push(void 0),m._binPack=new d(m.width-4,m.height-4),k=m._binPack.allocate(u+q,f+z));var q=m._glyphData[m._currentPage],n=n.bitmap,h=z=void 0;if(n)for(var r=0;r<f;r++)for(var z=u*r,h=m.width*(k.y+r+1)+k.x,v=0;v<u;v++)q[h+v+1]=n[z+v]}g[c]={rect:k,metrics:x,tileIDs:null,
page:m._currentPage};y[c]={sdf:!0,rect:k,metrics:x,page:m._currentPage};m._dirties[m._currentPage]=!0}}}return y})};b.prototype.removeGlyphs=function(a){for(var c in this._glyphIndex){var b=this._glyphIndex[c];if(b){var d=void 0,f;for(f in b)if(d=b[f],d.tileIDs["delete"](a),0===d.tileIDs.size){for(var p=this._glyphData[d.page],g=d.rect,l=void 0,z=void 0,x=0;x<g.height;x++)for(l=this.width*(g.y+x)+g.x,z=0;z<g.width;z++)p[l+z]=0;delete b[f];this._dirties[d.page]=!0}}}};b.prototype.bind=function(a,e,
b,d){void 0===d&&(d=0);this._textures[b]||(this._textures[b]=new f.Texture(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var c=this._textures[b];c.setSamplingMode(e);this._dirties[b]&&c.setData(this._glyphData[b]);a.bindTexture(c,d);this._dirties[b]=!1};b.prototype.dispose=function(){this._binPack=null;for(var a=0,e=this._textures;a<e.length;a++){var b=e[a];b&&b.dispose()}this._textures.length=0};return b}()})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["require",
"exports","../webgl/Rect"],function(w,v,r){return function(){function h(f,d){this._height=this._width=0;this._free=[];this._width=f;this._height=d;this._free.push(new r.default(0,0,f,d))}Object.defineProperty(h.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});h.prototype.allocate=function(f,d){if(f>this._width||d>this._height)return new r.default;for(var a=
null,b=-1,c=0;c<this._free.length;++c){var e=this._free[c];f<=e.width&&d<=e.height&&(null===a||e.y<=a.y&&e.x<=a.x)&&(a=e,b=c)}if(null===a)return new r.default;this._free.splice(b,1);a.width<a.height?(a.width>f&&this._free.push(new r.default(a.x+f,a.y,a.width-f,d)),a.height>d&&this._free.push(new r.default(a.x,a.y+d,a.width,a.height-d))):(a.width>f&&this._free.push(new r.default(a.x+f,a.y,a.width-f,a.height)),a.height>d&&this._free.push(new r.default(a.x,a.y+d,f,a.height-d)));return new r.default(a.x,
a.y,f,d)};h.prototype.release=function(f){for(var d=0;d<this._free.length;++d){var a=this._free[d];if(a.y===f.y&&a.height===f.height&&a.x+a.width===f.x)a.width+=f.width;else if(a.x===f.x&&a.width===f.width&&a.y+a.height===f.y)a.height+=f.height;else if(f.y===a.y&&f.height===a.height&&f.x+f.width===a.x)a.x=f.x,a.width+=f.width;else if(f.x===a.x&&f.width===a.width&&f.y+f.height===a.y)a.y=f.y,a.height+=f.height;else continue;this._free.splice(d,1);this.release(f)}this._free.push(f)};return h}()})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["require",
"exports","../../../../request","../../../../core/pbf","../../../../core/promiseUtils"],function(w,v,r,h,f){var d=function(){function a(a){this._metrics=[];this._bitmaps=[];if(a)for(;a.next();)switch(a.tag()){case 1:for(var c=a.getMessage();c.next();)switch(c.tag()){case 3:for(var b=c.getMessage(),d=void 0,f=void 0,p=void 0,g=void 0,l=void 0,z=void 0,x=void 0;b.next();)switch(b.tag()){case 1:d=b.getUInt32();break;case 2:f=b.getBytes();break;case 3:p=b.getUInt32();break;case 4:g=b.getUInt32();break;
case 5:l=b.getSInt32();break;case 6:z=b.getSInt32();break;case 7:x=b.getUInt32();break;default:b.skip()}d&&(this._metrics[d]={width:p,height:g,left:l,top:z,advance:x},this._bitmaps[d]=f);break;default:c.skip()}break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),a=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,b){this._ranges[a]=
b};return a}();return function(){function b(a){this._glyphInfo={};this._baseURL=a}b.prototype.getRange=function(a,b){var c=this._getFontStack(a);if(c.getRange(b))return f.resolve();var e=256*b,q=e+255;a=this._baseURL.replace("{fontstack}",a).replace("{range}",e+"-"+q);return r(a,{responseType:"array-buffer"}).then(function(a){c.addRange(b,new d(new h(new Uint8Array(a.data),new DataView(a.data))))}).catch(function(){c.addRange(b,new d)})};b.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var c=
Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}};b.prototype._getFontStack=function(b){var c=this._glyphInfo[b];c||(c=this._glyphInfo[b]=new a);return c};return b}()})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("require exports ../../../webgl ./GeometryUtils ./RectangleBinPack ../webgl/Rect".split(" "),function(w,v,r,h,f,d){return function(){function a(a,c,e){void 0===e&&(e=0);this._size=[];this._mosaicsData=[];this._textures=
[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=a||0>=c)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=c;0<e&&(this._maxItemSize=e);this._binPack=new f(a-4,c-4)}a.prototype.getWidth=function(a){return a>=this._size.length?-1:this._size[a][0]};a.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};a.prototype.setSpriteSource=
function(a){this.dispose();this.pixelRatio=a.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new f(this._pageWidth-4,this._pageHeight-4);var c=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=c;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=a};a.prototype.getSpriteItem=function(a,c){void 0===c&&(c=!1);var b=this._mosaicRects[a];if(b)return b;if(!this._sprites||"loaded"!==
this._sprites.loadStatus)return null;b=this._sprites.getSpriteInfo(a);if(!b||!b.width||!b.height||0>b.width||0>b.height)return null;var d=b.width,f=b.height,q=this._allocateImage(d,f),p=q[0],g=q[1];if(0>=p.width)return null;this._copy(p,b,g,q[2],c);b={rect:p,width:d,height:f,sdf:b.sdf,simplePattern:!1,pixelRatio:b.pixelRatio,page:g};return this._mosaicRects[a]=b};a.prototype.preloadSpriteItems=function(){for(var a=0,c=this._sprites.spriteNames;a<c.length;a++)this.getSpriteItem(c[a],!0)};a.prototype.getSpriteItems=
function(a){for(var c={},b=0;b<a.length;b++){var d=a[b];c[d]=this.getSpriteItem(d)}return c};a.prototype.getMosaicItemPosition=function(a,c){c=(a=this.getSpriteItem(a,c))&&a.rect;if(!c)return null;c.width=a.width;c.height=a.height;return{size:[a.width,a.height],tl:[(c.x+2)/this._size[a.page][0],(c.y+2)/this._size[a.page][1]],br:[(c.x+2+a.width)/this._size[a.page][0],(c.y+2+a.height)/this._size[a.page][1]],page:a.page}};a.prototype.bind=function(a,c,e,d){void 0===e&&(e=0);void 0===d&&(d=0);this._textures[e]||
(this._textures[e]=new r.Texture(a,{pixelFormat:6408,dataType:5121,width:this._size[e][0],height:this._size[e][1]},new Uint8Array(this._mosaicsData[e].buffer)));var b=this._textures[e];b.setSamplingMode(c);this._dirties[e]&&b.setData(new Uint8Array(this._mosaicsData[e].buffer));a.bindTexture(b,d);this._dirties[e]=!1};a._copyBits=function(a,c,e,d,f,q,p,g,l,z,x){var b=d*c+e;p=g*q+p;if(x)for(p-=q,x=-1;x<=z;x++,b=((x+z)%z+d)*c+e,p+=q)for(g=-1;g<=l;g++)f[p+g]=a[b+(g+l)%l];else for(x=0;x<z;x++){for(g=0;g<
l;g++)f[p+g]=a[b+g];b+=c;p+=q}};a.prototype._copy=function(b,c,e,d,f,q){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(e>=this._mosaicsData.length)){var p=new Uint32Array(q?q.buffer:this._sprites.image.buffer),g=this._mosaicsData[e];g&&p||console.error("Source or target images are uninitialized!");a._copyBits(p,q?c.width:this._sprites.width,c.x,c.y,g,d[0],b.x+2,b.y+2,c.width,c.height,f);this._dirties[e]=!0}};a.prototype._allocateImage=function(a,c){a+=2;c+=2;var b=Math.max(a,c);if(this._maxItemSize&&
this._maxItemSize<b){var b=Math.pow(2,Math.ceil(h.log2(a))),y=Math.pow(2,Math.ceil(h.log2(c)));a=new d.default(0,0,a,c);this._mosaicsData.push(new Uint32Array(b*y));this._dirties.push(!0);this._size.push([b,y]);this._textures.push(void 0);return[a,this._mosaicsData.length-1,[b,y]]}b=a%4?4-a%4:4;y=c%4?4-c%4:4;1===b&&(b=5);1===y&&(y=5);b=this._binPack.allocate(a+b,c+y);return 0>=b.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,
this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new f(this._pageWidth-4,this._pageHeight-4),this._allocateImage(a,c)):[b,this._currentPage,[this._pageWidth,this._pageHeight]]};a.prototype.dispose=function(){this._binPack=null;this._mosaicRects={};for(var a=0,c=this._textures;a<c.length;a++){var e=c[a];e&&e.dispose()}this._textures.length=0};return a}()})},
"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["require","exports","../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(w,v,r,h,f){return function(){function d(a){if(a instanceof h)this._tilemapCache=a;else if(a&&"index"in a)this._tilemap=a.index;else throw Error("Invalid tilemap!");}d.prototype.dataKey=function(a,b){if(this._tilemapCache){var c=a.level,e=a.row,d=a.col,m=new f(a);return this._tilemapCache.fetchAvailabilityUpsample(c,
e,d,m,b).then(function(){return m}).catch(function(a){if(r.isAbortError(a))throw a;m.level=c;m.row=e;m.col=d;return m})}return this._getIndexedDataKey(a)};d.prototype.forEach=function(a,b,c,e,d){this._callback=d;this._maxLevel=b+a;this._forEach(this._tilemap,b,c,e)};d.prototype._forEach=function(a,b,c,e){0!==a&&(this._callback(b,c,e),b!==this._maxLevel&&"object"===typeof a&&(this._forEach(a[0],b+1,2*c,2*e),this._forEach(a[1],b+1,2*c,2*e+1),this._forEach(a[2],b+1,2*c+1,2*e),this._forEach(a[3],b+1,
2*c+1,2*e+1)))};d.prototype._getIndexedDataKey=function(a){var b=[a];if(0>a.level||0>a.row||0>a.col||0<a.row>>a.level||0<a.col>>a.level)return r.resolve(null);for(;0!==a.level;)a=new f(a.level-1,a.row>>1,a.col>>1,a.world),b.push(a);a=this._tilemap;var c=b.pop(),e,d;if(1===a)return r.resolve(c);for(;b.length;)if(e=b.pop(),d=(e.col&1)+((e.row&1)<<1),a){if(0===a[d]){c=null;break}if(1===a[d]){c=e;break}c=e;a=a[d]}return r.resolve(c)};return d}()})},"esri/layers/support/TilemapCache":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),
function(w,v,r,h,f,d,a,b,c,e,y,m,q,p,g,l,z){var x=e.getLogger("esri.layers.support.TilemapCache");return function(a){function e(b){b=a.call(this)||this;b._handles=new c;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2097152;b.request=d;return b}h(e,a);t=e;e.prototype.initialize=function(){var a=this;this._tilemapCache=new y(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],function(){return a._initializeTilemapDefinition()}),
g.init(this,"layer.tileInfo.lods",function(c){return a._initializeAvailableLevels(c)},!0)]);this._initializeTilemapDefinition()};e.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};e.prototype.castLevels=function(a){return 2>=a?(x.error("Minimum levels for Tilemap is 3, but got ",a),3):a};Object.defineProperty(e.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0});e.prototype.getTilemap=function(a,c,b){return this._tilemapFromCache(a,
c,b,this._tmpTilemapDefinition)};e.prototype.fetchTilemap=function(a,c,e,g){var l=this;if(!this._availableLevels[a])return q.reject(new b("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"));var d=this._tmpTilemapDefinition;if(a=this._tilemapFromCache(a,c,e,d))return q.resolve(a);var k=g&&g.signal;g=r({},g,{signal:null});return q.create(function(a,c){q.onAbort(k,function(){return c(q.createAbortError())});var b=z.tilemapDefinitionId(d),e=l._pendingTilemapRequests[b];if(!e){var e=
z.Tilemap.fromDefinition(d,g).then(function(a){l._tilemapCache.put(b,a,a.byteSize);return a}),t=function(){return delete l._pendingTilemapRequests[b]};l._pendingTilemapRequests[b]=e;e.then(t,t)}e.then(a,c)})};e.prototype.getAvailability=function(a,c,b){return this._availableLevels[a]?(a=this.getTilemap(a,c,b))?a.getAvailability(c,b):"unknown":"unavailable"};e.prototype.getAvailabilityUpsample=function(a,c,b,e){e.level=a;e.row=c;e.col=b;a=this.layer.tileInfo;for(a.updateTileInfo(e);;)if(c=this.getAvailability(e.level,
e.row,e.col),"unavailable"===c){if(!a.upsampleTile(e))return"unavailable"}else return c};e.prototype.fetchAvailability=function(a,c,e,g){return this._availableLevels[a]?this.fetchTilemap(a,c,e,g).catch(function(a){return a}).then(function(g){return g instanceof z.Tilemap?(g=g.getAvailability(c,e),"unavailable"===g?q.reject(new b("tile-map:tile-unavailable","Tile is not available",{level:a,row:c,col:e})):g):q.isAbortError(g)?q.reject(g):"unknown"}):q.reject(new b("tilemap-cache:level-unavailable",
"Level "+a+" is unavailable in the service"))};e.prototype.fetchAvailabilityUpsample=function(a,c,b,e,g){var l=this;e.level=a;e.row=c;e.col=b;var d=this.layer.tileInfo;d.updateTileInfo(e);var k=!1,n=this.fetchAvailability(a,c,b,g).catch(function(a){if(q.isAbortError(a))throw a;if(d.upsampleTile(e))return l.fetchAvailabilityUpsample(e.level,e.row,e.col,e);throw a;}).then(function(a){k=!0;return a},function(a){k=!0;throw a;});if(k)return n;var u={id:e.id,level:a,row:c,col:b},f=q.createAbortController(),
x=r({},g,{signal:f.signal});a=function(a){var c=p.fetchAvailability(u.level,u.row,u.col,x);t._prefetches.push(c);a=function(){t._prefetches.removeUnordered(c)};c.then(a,a)};var p=this;for(c=0;t._prefetches.length<t._maxPrefetch&&d.upsampleTile(u);++c)a(c);n.then(function(){return f.abort()},function(){return f.abort()});return n};e.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var a=this.layer.parsedUrl,c=a.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:a.path,
query:c?p.objectToQuery(c):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};e.prototype._tilemapFromCache=function(a,c,b,e){a=this._getTilemapDefinition(a,c,b,e);a=z.tilemapDefinitionId(a);return this._tilemapCache.get(a)};e.prototype._getTilemapDefinition=function(a,c,b,e){e.level=a;e.row=c-c%this.size;e.col=b-b%this.size;return e};e.prototype._initializeAvailableLevels=function(a){var c=this;this._availableLevels=
{};a&&a.forEach(function(a){return c._availableLevels[a.level]=!0})};var t;e._maxPrefetch=4;e._prefetches=new m({initialSize:t._maxPrefetch});f([l.property({constructOnly:!0,type:Number})],e.prototype,"levels",void 0);f([l.cast("levels")],e.prototype,"castLevels",null);f([l.property({readOnly:!0,dependsOn:["levels"],type:Number})],e.prototype,"size",null);f([l.property({constructOnly:!0,type:Number})],e.prototype,"cacheByteSize",void 0);f([l.property({constructOnly:!0})],e.prototype,"layer",void 0);
f([l.property({constructOnly:!0})],e.prototype,"request",void 0);return e=t=f([l.subclass("esri.layers.support.TilemapCache")],e)}(l.declared(a))})},"esri/core/LRUCache":function(){define(["require","exports","./MemCache"],function(w,v,r){return function(){function h(f,d){this._storage=new r.MemCacheStorage;this._storage.maxSize=f;d&&this._storage.registerRemoveFunc("",d)}h.prototype.put=function(f,d,a){this._storage.put(f,d,a,1)};h.prototype.pop=function(f){return this._storage.pop(f)};h.prototype.get=
function(f){return this._storage.get(f)};h.prototype.clear=function(){this._storage.clearAll()};h.prototype.destroy=function(){this._storage.clearAll()};return h}()})},"esri/layers/support/Tilemap":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/Error ../../core/lang ../../core/promiseUtils".split(" "),function(w,v,r,h,f,d,a){function b(a){var c;"vector-tile"===a.service.type?c=a.service.url+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height:
(c=a.service.tileServers,c=(c&&c.length?c[a.row%c.length]:a.service.url)+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height);(a=a.service.query)&&(c=c+"?"+a);return c}Object.defineProperty(v,"__esModule",{value:!0});w=function(){function c(){this.location={left:0,top:0,width:0,height:0};this.byteSize=40}c.prototype.getAvailability=function(a,c){if(this._isAllAvailable)return"available";if(this._isAllUnvailable)return"unavailable";a=(a-this.location.top)*this.location.width+(c-this.location.left);
c=a>>3;var b=this._tileAvailabilityBitSet;return 0>c||c>b.length?"unknown":b[c]&1<<a%8?"available":"unavailable"};c.prototype._updateFromData=function(a){for(var c=!0,b=!0,e=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),d=0,g=0;g<a.length;g++){var l=g%8;a[g]?(b=!1,e[d]|=1<<l):c=!1;7===l&&++d}this._isAllUnvailable=b;this._isAllAvailable=c;this._isAllAvailable||this._isAllUnvailable||(this._tileAvailabilityBitSet=e,this.byteSize+=e.length)};c.fromDefinition=function(e,d){var m=
e.service.request||h,q=e.row,p=e.col,g=e.width,l=e.height,z={query:{f:"json"}};d=d?r({},z,d):z;return m(b(e),d).then(function(a){return a.data}).catch(function(c){if(c&&c.details&&422===c.details.httpStatus){c=[];for(var b=0,e=g*l;b<e;b++)c[b]=0;return{location:{top:q,left:p,width:g,height:l},valid:!0,data:c}}return a.reject(c)}).then(function(a){if(a.location&&(a.location.top!==q||a.location.left!==p||a.location.width!==g||a.location.height!==l))throw new f("tilemap:location-mismatch","Tilemap response for different location than requested",
{response:a,definition:{top:q,left:p,width:g,height:l}});return c.fromJSON(a)})};c.fromJSON=function(a){c.validateJSON(a);var b=new c;b.location=Object.freeze(d.clone(a.location));b._updateFromData(a.data);return Object.freeze(b)};c.validateJSON=function(a){if(!a||!a.location)throw new f("tilemap:missing-location","Location missing from tilemap response");if(!1===a.valid)throw new f("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new f("tilemap:missing-data","Data missing from tilemap response");
if(!Array.isArray(a.data))throw new f("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new f("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return c}();v.Tilemap=w;v.tilemapDefinitionId=function(a){return a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height};v.tilemapDefinitionUrl=b;v.default=w})},"esri/views/2d/engine/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../geometry/support/spatialReferenceUtils ../../../webgl ../../engine ./RenderBucket ../../tiling/TileKey".split(" "),
function(w,v,r,h,f,d,a,b,c,e,y){var m="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ");return function(c){function p(){for(var a,b=[],e=0;e<arguments.length;e++)b[e]=arguments[e];e=c.call(this)||this;e._renderBuckets=[];e._vectorTileData=
null;e._symbolUpdateData=null;e.coords=[0,0];e.bounds=[0,0,0,0];e.tileTransform={transform:f.mat4f32.create(),displayCoord:d.vec2f32.create()};e.stencilData={mask:0,reference:0};e.triangleCount=0;0<b.length&&(a=e.acquire).call.apply(a,[e].concat(b));return e}r(p,c);p.prototype.reset=function(){y.pool.release(this.key);this.key=null;this.coords[0]=0;this.coords[1]=0;this.bounds[0]=0;this.bounds[1]=0;this.bounds[2]=0;this.height=this.width=this.bounds[3]=0;this.resolution=null;this.rotation=0;this.id=
this.client=this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this.stage=this._symbolUpdateData=null;this.triangleCount=0;this.refKeys=null};p.prototype.acquire=function(c,b,e,d){this.key=c;var g=b.lodAt(c.level),g=null!==g?g.resolution:0,l=b.size[0]*g,f=b.origin,n=c.col*l,k=c.row*l,u=b.spatialReference,p=0;u&&(u._isWrappable?u._isWrappable():u.isWrappable)&&
(u=a.getInfo(u),p=u.valid[1]-u.valid[0]);n=f.x+n+c.world*p;f=f.y-k;this.coords[0]=n;this.coords[1]=f;this.bounds[0]=n;this.bounds[1]=f;this.bounds[2]=n+l;this.bounds[3]=f-l;this.widthInPixels=b.size[1];this.coordRange=4096;this.resolution=g;this.rotation=d;this.styleLayers=e;this.id=c.id};p.prototype.setData=function(a,c,b){this._vectorTileData=a;this.client=c;this.refKeys=b};p.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};p.prototype.updateTileData=function(a){this._vectorTileData=
a;this.stage.requestRender()};p.prototype.dispose=function(){for(var a="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" "),
c=0;c<a.length;++c){var b=a[c];this[b]&&(this[b].dispose(),this[b]=null)}this._renderBuckets.length=0};p.prototype.getCpuMemoryUsage=function(){return null!=this._vectorTileData&&this._vectorTileData.bufferData?this._vectorTileData.bufferData.reduce(function(a,c){return a+c.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength:0};p.prototype.getGpuMemoryUsage=function(){var a=this,c=m.reduce(function(c,b){return a[b]?c+a[b].size:c},0);this.texture&&
(c+=this.texture.descriptor.width*this.texture.descriptor.height*4);return c};p.prototype.attach=function(){this._vectorTileData&&this.ready();return null!=this._vectorTileData};p.prototype._commitChanges=function(){this._vectorTileData&&(this.dispose(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null)};p.prototype._createRenderBuckets=function(){for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),c=a.length,b=0;b<c;){var d=a[b];switch(a[b+1]){case 0:var t=
new e.BackgroundRenderBucket;t.layerID=d;this._renderBuckets.push(t);b+=2;break;case 1:t=new e.FillRenderBucket;t.layerID=d;t.triangleElementStart=a[b+2];t.triangleElementCount=a[b+3];t.outlineElementStart=a[b+4];t.outlineElementCount=a[b+5];this._renderBuckets.push(t);b+=6;break;case 2:t=new e.LineRenderBucket;t.layerID=d;t.triangleElementStart=a[b+2];t.triangleElementCount=a[b+3];this._renderBuckets.push(t);b+=4;break;case 3:t=new e.SymbolRenderBucket;t.layerID=d;t.isSDF=0!==a[b+2];var f=b+3,d=
a[f];f++;if(0<d)for(var p=void 0,n=void 0,k=void 0,u=0;u<d;u++)p=a[f],n=a[f+1],k=a[f+2],t.markerPerPageElementsMap.set(p,[n,k]),f+=3;var m=a[f];f++;if(0<m)for(k=n=p=void 0,u=0;u<m;u++)p=a[f],n=a[f+1],k=a[f+2],t.glyphPerPageElementsMap.set(p,[n,k]),f+=3;this._renderBuckets.push(t);b+=5+3*d+3*m;break;case 4:t=new e.CircleRenderBucket;t.layerID=d;t.triangleElementStart=a[b+2];t.triangleElementCount=a[b+3];this._renderBuckets.push(t);b+=4;break;default:console.error("Bad bucket type!"),b+=2}}};p._createBufferToObject=
function(){var a=[];a[1]={create:b.BufferObject.createVertex,var:"fillVertexBuffer"};a[2]={create:b.BufferObject.createVertex,var:"fillDDVertexBuffer"};a[3]={create:b.BufferObject.createIndex,var:"fillIndexBuffer"};a[4]={create:b.BufferObject.createVertex,var:"outlineVertexBuffer"};a[5]={create:b.BufferObject.createVertex,var:"outlineDDVertexBuffer"};a[6]={create:b.BufferObject.createIndex,var:"outlineIndexBuffer"};a[7]={create:b.BufferObject.createVertex,var:"lineVertexBuffer"};a[8]={create:b.BufferObject.createVertex,
var:"lineDDVertexBuffer"};a[9]={create:b.BufferObject.createIndex,var:"lineIndexBuffer"};a[10]={create:b.BufferObject.createVertex,var:"iconVertexBuffer"};a[11]={create:b.BufferObject.createVertex,var:"iconDDVertexBuffer"};a[12]={create:b.BufferObject.createIndex,var:"iconIndexBuffer"};a[13]={create:b.BufferObject.createVertex,var:"textVertexBuffer"};a[14]={create:b.BufferObject.createVertex,var:"textDDVertexBuffer"};a[15]={create:b.BufferObject.createIndex,var:"textIndexBuffer"};a[16]={create:b.BufferObject.createVertex,
var:"circleVertexBuffer"};a[17]={create:b.BufferObject.createIndex,var:"circleIndexBuffer"};return a};p.prototype._createBufferObjects=function(){for(var a=this.stage.context,c=new Uint32Array(this._vectorTileData.bufferDataInfo),b=c.length,e=0,d=0;d<b;d+=2,e++){var f=c[d];if(!(0>=c[d+1]||0===this._vectorTileData.bufferData[e].byteLength)){var m=p.bufferToObject[f];m?this[m.var]?this[m.var].setData(this._vectorTileData.bufferData[e]):this[m.var]=m.create(a,35044,this._vectorTileData.bufferData[e]):
console.error("Bad buffer type "+f)}}};p.prototype.detach=function(){this.isReady&&this.client&&this.client.invoke("destructTileData",this.id);this.dispose();c.prototype.detach.call(this)};p.prototype.doRender=function(a){if(this.visible&&this.isReady){var c=this.stage.context,b=a.renderer;if(c&&b){this._commitChanges();var e=a.drawphase;this._symbolUpdateData&&(this._updateSymbolData(a,this._symbolUpdateData),this._symbolUpdateData=null);c.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);
var d=this.styleLayers,g,f=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==f){var n=this._renderBuckets.length;if(0===e)for(var k=n-1;0<=k;k--){var u=this._renderBuckets[k];g=d.layers[u.layerID];if(!u||!g)break;1!==u.type&&0!==u.type||!u.hasData()||(this.triangleCount+=b.renderBucket(c,u,a.displayLevel,a.requiredLevel,e,this,g,f))}else for(k=0;k<n;k++){u=this._renderBuckets[k];g=d.layers[u.layerID];if(!u||!g)break;u.hasData()&&(this.triangleCount+=b.renderBucket(c,u,a.displayLevel,a.requiredLevel,
e,this,g,f))}}}}};p.prototype._updateSymbolData=function(a,c){if(!c||!c.bucketDataInfo)return!0;a=new Uint32Array(c.bucketDataInfo);var d=a.length;if(0===d)return!0;if(!this.isReady)return this.requestRender(),!1;for(var l=this.stage.context,g=new Uint32Array(c.bufferDataInfo),f=g.length,p=0,n=0;n<f;n+=2,p++)switch(g[n]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=b.BufferObject.createVertex(l,35044,c.bufferData[p]);break;case 11:this.iconDDVertexBuffer&&
(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=b.BufferObject.createVertex(l,35044,c.bufferData[p]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=b.BufferObject.createIndex(l,35044,c.bufferData[p]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=b.BufferObject.createVertex(l,35044,c.bufferData[p]);break;case 14:this.textDDVertexBuffer&&
(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=b.BufferObject.createVertex(l,35044,c.bufferData[p]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=b.BufferObject.createIndex(l,35044,c.bufferData[p])}c=[];for(l=0;l<this._renderBuckets.length;l++)this._renderBuckets[l]instanceof e.SymbolRenderBucket||c.push(this._renderBuckets[l]);this._renderBuckets=c;for(l=0;l<d;){f=a[l];g=new e.SymbolRenderBucket;
g.layerID=f;g.isSDF=0!==a[l+2];this.styleLayers.layers.length>g.layerID&&this.styleLayers.layers[g.layerID].type===g.type&&c.push(g);var k=l+3,f=a[k];k++;if(0<f)for(var u=n=p=void 0,m=0;m<f;m++)p=a[k],n=a[k+1],u=a[k+2],g.markerPerPageElementsMap.set(p,[n,u]),k+=3;var q=a[k];k++;if(0<q)for(u=n=p=void 0,m=0;m<q;m++)p=a[k],n=a[k+1],u=a[k+2],g.glyphPerPageElementsMap.set(p,[n,u]),k+=3;l+=5+3*f+3*q}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&
(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};p.pool=new h(p);p.bufferToObject=p._createBufferToObject();return p}(c.DisplayObject)})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper"],
function(w,v,r){Object.defineProperty(v,"__esModule",{value:!0});w=function(){return function(f){this.type=f}}();v.RenderBucket=w;var h=function(f){function d(){var a=f.call(this,2)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}r(d,f);d.prototype.hasData=function(){return 0<this.triangleElementCount};d.prototype.triangleCount=function(){return this.triangleElementCount/3};return d}(w);v.LineRenderBucket=h;h=function(f){function d(){var a=f.call(this,1)||this;a.triangleElementStart=
0;a.triangleElementCount=0;a.outlineElementStart=0;a.outlineElementCount=0;return a}r(d,f);d.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};d.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3};return d}(w);v.FillRenderBucket=h;h=function(f){function d(){var a=f.call(this,3)||this;a.markerPerPageElementsMap=new Map;a.glyphPerPageElementsMap=new Map;a.isSDF=!1;return a}r(d,f);d.prototype.hasData=function(){return 0<
this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};d.prototype.triangleCount=function(){var a=0;this.markerPerPageElementsMap.forEach(function(b){a+=b[1]});this.glyphPerPageElementsMap.forEach(function(b){a+=b[1]});return a/3};return d}(w);v.SymbolRenderBucket=h;h=function(f){function d(){var a=f.call(this,4)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}r(d,f);d.prototype.hasData=function(){return 0<this.triangleElementCount};d.prototype.triangleCount=function(){return this.triangleElementCount/
3};return d}(w);v.CircleRenderBucket=h;w=function(f){function d(){return f.call(this,0)||this}r(d,f);d.prototype.hasData=function(){return!0};d.prototype.triangleCount=function(){return 2};return d}(w);v.BackgroundRenderBucket=w})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/has ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../webgl ../../engine ./GeometryUtils ./renderers/Renderer".split(" "),
function(w,v,r,h,f,d,a,b,c,e,y,m){var q=e.enums.WGLDrawPhase;return function(c){function e(){var e=null!==c&&c.apply(this,arguments)||this;e._tileCoordinateScale=b.vec3f32.create();e._orientationVec=b.vec3f32.fromValues(0,0,1);e._displayScale=b.vec3f32.create();e._defaultTransform=a.mat4f32.create();e._displayWidth=0;e._displayHeight=0;e._pointToCallbacks=new Map;return e}r(e,c);e.prototype.initialize=function(a,c,b,e){var d=this;this._spriteMosaicPromise=a;this._spriteMosaicPromise.then(function(b){d._spriteMosaicPromise===
a&&(d._renderer=new m(b,c))});this._tileInfoView=e;this._tileInfo=b};e.prototype.dispose=function(){this._renderer&&this._renderer.dispose();c.prototype.dispose.call(this)};e.prototype.hitTest=function(a,c){var b=this,e=[a,c];return f.create(function(a,c){b._pointToCallbacks.set(e,{resolve:a,reject:c});b.requestRender()},function(){b._pointToCallbacks.has(e)&&b._pointToCallbacks.delete(e)})};e.prototype.renderChildren=function(a){var b=this;if(0!==this.children.length&&this._tileInfoView&&a&&a.state&&
(a.drawPhase===q.MAP||a.drawPhase===q.HITTEST))if(this._renderer){if(h("esri-vector-tiles-debug"))for(var e=0,d=this.children;e<d.length;e++){var g=d[e];g.triangleCount=0}d=a.state;e=this.stage.context;g=this._renderer;g.initializeProgramCache(this.stage.context);g.setGlobalOpacity(e,a,this.opacity);e.setDepthWriteEnabled(!0);e.setStencilWriteMask(255);e.setClearDepth(1);e.setClearStencil(0);e.clear(e.gl.DEPTH_BUFFER_BIT|e.gl.STENCIL_BUFFER_BIT);e.setDepthWriteEnabled(!1);a.displayLevel=this._tileInfoView.scaleToLevel(d.scale);
a.requiredLevel=this._tileInfoView.getSmallestInfoForScale(d.scale).level;a.renderer=this._renderer;this.sortChildren(function(a,c){return a.key.level-c.key.level});for(var d=this.children.length,l=1;l<=d;l++){var f=this.children[l-1];f.attached&&f.visible&&(f.stencilData.reference=l,f.stencilData.mask=255)}this._updateTilesTransform(a.state,a.requiredLevel,this.children);e.setDepthWriteEnabled(!0);this._renderer.setStateParams(a.state,a.pixelRatio,a.displayLevel);this._renderer.drawClippingMasks(e,
this.children);e.setStencilWriteMask(0);e.setBlendFunctionSeparate(1,771,1,771);e.setStencilOp(7680,7680,7681);e.setDepthFunction(515);e.setBlendingEnabled(!1);e.setStencilTestEnabled(!0);e.setDepthTestEnabled(!0);e.setDepthWriteEnabled(!0);a.drawphase=0;c.prototype.renderChildren.call(this,a);e.setDepthWriteEnabled(!1);e.setBlendingEnabled(!0);a.drawphase=1;c.prototype.renderChildren.call(this,a);a.drawphase=2;c.prototype.renderChildren.call(this,a);e.setStencilTestEnabled(!1);e.setDepthTestEnabled(!1);
g.applyGlobalOpacity(e,a,this.opacity);if(h("esri-vector-tiles-debug"))for(d=0,l=this.children;d<l.length;d++)g=l[d],g.attached&&g.visible&&this._renderer.renderTileInfo(e,g);0<this._pointToCallbacks.size&&(this._pointToCallbacks.forEach(function(c,e){c.resolve(b._hitTest(a,e[0],e[1]))}),this._pointToCallbacks.clear());this._renderer.needsRedraw()&&this.requestRender()}else this.requestRender()};e.prototype.removeAllChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].dispose();
c.prototype.removeAllChildren.call(this)};e.prototype._hitTest=function(a,c,b){var e=this._tileInfoView.getSmallestInfoForScale(a.state.scale).level,d=[0,0];a.state.toMap(d,[c,b]);var g=a.state.clone(),f=g.viewpoint.clone(),k=f.targetGeometry;k.x=d[0];k.y=d[1];f.targetGeometry=k;g.viewpoint=f;g.size=[3,3];this._renderer.setStateParams(g,a.pixelRatio,a.displayLevel);return(a=this._renderer.hitTest({context:this.stage.context,drawPhase:0,pixelRatio:a.pixelRatio,stationary:a.stationary,globalOpacity:a.globalOpacity,
displayLevel:a.displayLevel,requiredLevel:a.requiredLevel,renderer:a.renderer,layerOpacity:a.layerOpacity,state:g,drawphase:3},c,b,this.children,e,3,this._updateTilesTransform.bind(this)))&&0!==a.length?a[0]:null};e.prototype._updateTilesTransform=function(a,c,b){var e=1/a.size[0],d=1/a.size[1],g=[0,0];this._calculateRelativeViewProjMat(this._tileInfo.lodAt(c).resolution,a.resolution,a.rotation,this._tileInfo.size[1],4096,a.size[0],a.size[1],this._defaultTransform);for(var f=0;f<b.length;f++){var k=
b[f];a.toScreen(g,k.coords);g[1]=a.size[1]-g[1];k.tileTransform.displayCoord[0]=2*g[0]*e-1;k.tileTransform.displayCoord[1]=2*g[1]*d-1;k.key.level===c&&4096===k.coordRange?k.tileTransform.transform.set(this._defaultTransform):this._calculateRelativeViewProjMat(this._tileInfo.lodAt(k.key.level).resolution,a.resolution,a.rotation,this._tileInfo.size[1],k.coordRange,a.size[0],a.size[1],k.tileTransform.transform)}};e.prototype._calculateRelativeViewProjMat=function(a,c,b,e,g,f,p,k){var l=.125;512!==e&&
4096!==g&&(l=e/g);a=a/c*l;this._tileCoordinateScale.set([a,a,1]);if(f!==this._displayWidth||p!==this._displayHeight)this._displayScale.set([2/f,-2/p,1]),this._displayWidth=f,this._displayHeight=p;d.mat4.identity(k);d.mat4.scale(k,k,this._tileCoordinateScale);d.mat4.rotate(k,k,-b*y.C_DEG_TO_RAD,this._orientationVec);d.mat4.scale(k,k,this._displayScale);d.mat4.transpose(k,k)};return e}(e.Container)})},"esri/views/2d/engine/vectorTiles/renderers/Renderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../../../engine ../GeometryUtils ./BackgroundRenderer ./CircleRenderer ./FadeRecorder ./FillRenderer ./LineRenderer ./SymbolRenderer ./TileInfoRenderer ./shaders/ProgramCache".split(" "),
function(w,v,r,h,f,d,a,b,c,e,y,m,q,p,g,l,z){return function(){function x(a,c,e){void 0===e&&(e=!0);this._extrudeMatrix=h.mat4f32.create();this._extrudeNoRotationMatrix=h.mat4f32.create();this._extrudeRotateVector=f.vec3f32.fromValues(0,0,1);this._extrudeScaleVector=f.vec3f32.fromValues(1,1,1);this._backgroundColor=d.vec4f32.fromValues(1,0,0,1);this._state={rotation:0,size:[0,0]};this._cachedRotation=this._cachedHeight=this._cachedWidth=0;this._blitRenderer=new b.BitBlitRenderer;this._programCache=
this._boundFBO=this._globalOpacityFBO=null;this._spriteMosaic=a;this._glyphMosaic=c;this._ignoreSpeed=!e;this._fadeRecorder=new m.FadeRecorder(300)}x.prototype.dispose=function(){this._backgroundRenderer&&(this._backgroundRenderer.dispose(),this._backgroundRenderer=null);this._lineRenderer&&(this._lineRenderer.dispose(),this._lineRenderer=null);this._fillRenderer&&(this._fillRenderer.dispose(),this._fillRenderer=null);this._symbolRenderer&&(this._symbolRenderer.dispose(),this._symbolRenderer=null);
this._circleRenderer&&(this._circleRenderer.dispose(),this._circleRenderer=null);this._tileInfoRenderer&&(this._tileInfoRenderer.dispose(),this._tileInfoRenderer=null);this._hittestFBO&&(this._hittestFBO.dispose(),this._hittestFBO=null);this._globalOpacityFBO&&(this._globalOpacityFBO.dispose(),this._globalOpacityFBO=null);this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._boundFBO=null;this._programCache&&(this._programCache.dispose(),this._programCache=null);this._cachedRotation=
this._cachedHeight=this._cachedWidth=0};x.prototype.initializeProgramCache=function(a){if(null===this._programCache){var c=new z.default;c.initialize(a);this._backgroundRenderer=new e(c);this._lineRenderer=new p(c);this._fillRenderer=new q(c);this._symbolRenderer=new g(c);this._circleRenderer=new y(c);this._tileInfoRenderer=new l(c);this._programCache=c}};x.prototype.setStateParams=function(a,b,e){this._fadeRecorder.recordLevel(e);this._state=a;if(this._state.size[0]!==this._cachedWidth||this._state.size[1]!==
this._cachedHeight||this._state.rotation!==this._cachedRotation)this._extrudeScaleVector[0]=2/a.size[0],this._extrudeScaleVector[1]=-2/a.size[1],r.mat4.identity(this._extrudeMatrix),r.mat4.rotate(this._extrudeMatrix,this._extrudeMatrix,-a.rotation*c.C_DEG_TO_RAD,this._extrudeRotateVector),r.mat4.scale(this._extrudeMatrix,this._extrudeMatrix,this._extrudeScaleVector),r.mat4.transpose(this._extrudeMatrix,this._extrudeMatrix),r.mat4.identity(this._extrudeNoRotationMatrix),r.mat4.scale(this._extrudeNoRotationMatrix,
this._extrudeNoRotationMatrix,this._extrudeScaleVector),r.mat4.transpose(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix),this._cachedWidth=this._state.size[0],this._cachedHeight=this._state.size[1],this._cachedRotation=this._state.rotation};x.prototype.drawClippingMasks=function(a,c){if(0!==c.length){a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255);
a.setClearStencil(0);a.clear(a.gl.STENCIL_BUFFER_BIT);for(var b=0;b<c.length;b++){var e=c[b];e.attached&&e.visible&&(a.setStencilFunctionSeparate(1032,519,e.stencilData.reference,e.stencilData.mask),this._backgroundRenderer.renderSolidColor(a,{u_matrix:e.tileTransform.transform,u_normalized_origin:e.tileTransform.displayCoord,u_coord_range:e.coordRange,u_depth:0,u_color:this._backgroundColor}))}a.setColorMask(!0,!0,!0,!0);a.setBlendingEnabled(!0)}};x.prototype.renderDebug=function(a,c){var b=c.key;
this._backgroundColor.set([b.col%2,b.row%2,0===b.col%2&&0===b.row%2?1:0,.5]);this._backgroundRenderer.renderSolidColor(a,{u_matrix:c.tileTransform.transform,u_normalized_origin:c.tileTransform.displayCoord,u_coord_range:c.coordRange,u_depth:0,u_color:this._backgroundColor})};x.prototype.renderBucket=function(a,c,b,e,d,g,f,l){if(!f||void 0!==f.minzoom&&f.minzoom>b+1E-6||g.key.level===e&&void 0!==f.maxzoom&&f.maxzoom<=b-1E-6)return 0;switch(c.type){case 0:if(2!==d)return this._renderBackground(a,c,
b,d,g,f,l);break;case 1:if(2!==d)return this._renderFill(a,c,b,d,g,f,l);break;case 2:if(1===d||3===d)return this._renderLine(a,c,b,d,g,f,l);break;case 3:if(2===d||3===d)return this._renderSymbol(a,c,b,d,e,g,f,l);break;case 4:if(2===d||3===d)return this._renderCircle(a,c,b,d,e,g,f,l)}return 0};x.prototype.renderTileInfo=function(a,c){this._tileInfoRenderer.render(a,c)};x.prototype.setGlobalOpacity=function(c,b,e){if(1!==e){this._boundFBO=c.getBoundFramebufferObject();e=b.pixelRatio;var d=b.state.size;
b=Math.round(d[0]*e);e=Math.round(d[1]*e);if(null===this._globalOpacityFBO||this._globalOpacityFBO.width!==b||this._globalOpacityFBO.height!==e)null!==this._globalOpacityFBO&&this._globalOpacityFBO.dispose(),this._globalOpacityFBO=a.FramebufferObject.create(c,{colorTarget:0,depthStencilTarget:3,width:b,height:e});c.bindFramebuffer(this._globalOpacityFBO);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT)}};x.prototype.applyGlobalOpacity=function(a,c,b){if(1!==b){var e=c.pixelRatio,d=c.state.size;
c=d[0];var d=d[1],g=a.getViewport();a.setViewport(0,0,e*c,e*d);a.bindFramebuffer(this._boundFBO);this._blitRenderer.render(a,this._globalOpacityFBO.colorTexture,9728,b);a.setViewport(g.x,g.y,g.width,g.height);this._boundFBO=null}};x.prototype.needsRedraw=function(){return this._fadeRecorder.needsRedraw()};x.prototype.hitTest=function(c,b,e,d,g,f,l){var k=[0,0],p=[0,0],m=c.state;m.toMap(k,[0,0]);m.toMap(p,[f,f]);b=d.filter(function(a){return!(k[0]>a.bounds[2]||p[0]<a.bounds[0]||k[1]<a.bounds[3]||p[1]>
a.bounds[1])});if(0===b.length)return[];b.sort(function(a,c){return a.key.level-c.key.level});e=b.length;for(d=1;d<=e;d++){var u=b[d-1];u.attached&&(u.stencilData.reference=d,u.stencilData.mask=255)}l(m,g,b);g=c.context;this._hittestFBO||(this._hittestFBO=a.FramebufferObject.create(g,{colorTarget:0,depthStencilTarget:3,width:f,height:f}));l=g.getViewport();m=g.getBoundFramebufferObject();g.bindFramebuffer(this._hittestFBO);g.setViewport(0,0,f,f);d=g.gl;g.setDepthWriteEnabled(!0);g.setStencilWriteMask(255);
g.setClearColor(1,1,1,1);g.setClearDepth(1);g.setClearStencil(0);g.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);g.setDepthWriteEnabled(!1);this.drawClippingMasks(g,b);g.setBlendingEnabled(!1);g.setStencilWriteMask(0);g.setStencilOp(7680,7680,7681);g.setDepthFunction(515);g.setDepthTestEnabled(!0);g.setDepthWriteEnabled(!0);g.setStencilTestEnabled(!0);for(d=0;d<e;d++)u=b[d],u.attached&&u.doRender(c);g.setStencilTestEnabled(!1);g.setDepthTestEnabled(!1);this._readbackBuffer||(this._readbackBuffer=
new Uint8Array(4*f*f),this._readbackBuffer32=new Uint32Array(this._readbackBuffer.buffer));this._hittestFBO.readPixels(0,0,f,f,6408,5121,this._readbackBuffer);c=new Set;f*=f;b=this._readbackBuffer32[Math.round(f/2)];4294967295!==b&&c.add(b);for(d=0;d<f;d++)b=this._readbackBuffer32[d],4294967295!==b&&c.add(b);g.bindFramebuffer(m);g.setViewport(l.x,l.y,l.width,l.height);var q=[];c.forEach(function(a){q.push(a)});return q};x.prototype._renderBackground=function(a,c,b,e,d,g,f){return this._backgroundRenderer.render(a,
c,b,e,d,g,this._spriteMosaic,this._spriteMosaic.pixelRatio,f)};x.prototype._renderLine=function(a,c,b,e,d,g,f){return this._lineRenderer.render(a,c,b,e,this._state,d,g,this._spriteMosaic,this._extrudeMatrix,this._spriteMosaic.pixelRatio,f)};x.prototype._renderFill=function(a,c,b,e,d,g,f){return this._fillRenderer.render(a,c,b,this._state.rotation,e,d,g,this._spriteMosaic,this._extrudeMatrix,this._spriteMosaic.pixelRatio,f)};x.prototype._renderCircle=function(a,c,b,e,d,g,f,l){var p=!0;d===g.key.level&&
(p=!1);a.setStencilTestEnabled(p);return this._circleRenderer.render(a,c,b,e,this._state.rotation,g,f,this._extrudeMatrix,l)};x.prototype._renderSymbol=function(a,c,b,e,d,g,f,l){var p=!0;d===g.key.level&&(p=!1);a.setStencilTestEnabled(p);return this._symbolRenderer.render(a,c,b,e,this._state.rotation,this._fadeRecorder.getFadeValues(this._ignoreSpeed),g,f,this._spriteMosaic,this._glyphMosaic,this._extrudeMatrix,this._extrudeNoRotationMatrix,this._spriteMosaic.pixelRatio,l)};return x}()})},"esri/views/2d/engine/vectorTiles/renderers/BackgroundRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../MemoryBuffer ./rendererUtils".split(" "),
function(w,v,r,h,f,d,a,b){return function(){function c(a){this._patternMatrix=h.mat3f32.create();this._color=f.vec4f32.create();this._rendererInitialized=this._solidrendererInitialized=!1;this._programOptions={id:!1,pattern:!1};this._programCache=a;this._color.set([1,0,0,1])}c.prototype.dispose=function(){this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};
c.prototype.renderSolidColor=function(a,c){this._solidrendererInitialized||this._initializeSolidRenderer(a);a.bindVAO(this._solidVertexArrayObject);var b=this._programOptions;b.id=!1;b.pattern=!1;b=this._programCache.getProgram(0,0,b);a.bindProgram(b);b.setUniformMatrix4fv("u_transformMatrix",c.u_matrix);b.setUniform2fv("u_normalized_origin",c.u_normalized_origin);b.setUniform1f("u_coord_range",c.u_coord_range||4096);b.setUniform1f("u_depth",c.u_depth||0);b.setUniform4fv("u_color",c.u_color||this._color);
a.drawArrays(5,0,4);a.bindVAO()};c.prototype.render=function(a,c,d,f,p,g,l,h,x){this._rendererInitialized||this._initialize(a);var e=g.getPaintValue("background-color",d);x*=g.getPaintValue("background-opacity",d);var m=g.getPaintValue("background-pattern",d),q=void 0!==m,n=e[3]*x,k=q||1>n;if(k&&0===f||!k&&1===f)return 0;f=3===f;k=this._programOptions;k.id=f;k.pattern=q;k=this._programCache.getProgram(0,(f?1:0)<<1|(q?1:0),k);a.bindVAO(this._vertexArrayObject);a.bindProgram(k);k.setUniform1f("u_coord_range",
p.coordRange);k.setUniform1f("u_depth",g.z||0);k.setUniformMatrix4fv("u_transformMatrix",p.tileTransform.transform);k.setUniform2fv("u_normalized_origin",p.tileTransform.displayCoord);if(q){g=l.getMosaicItemPosition(m,!0);if(!g)return 0;d=512*Math.pow(2,Math.floor(d)-p.key.level)*h;r.mat3.identity(this._patternMatrix);p=d/g.size[1];this._patternMatrix[0]=d/g.size[0];this._patternMatrix[4]=p;l.bind(a,9729,g.page,5);k.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix);k.setUniform1f("u_opacity",
x);k.setUniform2f("u_pattern_tl",g.tl[0],g.tl[1]);k.setUniform2f("u_pattern_br",g.br[0],g.br[1]);k.setUniform1i("u_texture",5)}else this._color[0]=n*e[0],this._color[1]=n*e[1],this._color[2]=n*e[2],this._color[3]=n,k.setUniform4fv("u_color",this._color);f&&(l=b.int32To4Bytes(c.layerID),k.setUniform4f("u_id",l[0],l[1],l[2],l[3]));a.drawArrays(5,0,4);a.bindVAO();return c.triangleCount()};c.prototype._initializeSolidRenderer=function(a){if(this._solidrendererInitialized)return!0;var c=new Int8Array([0,
0,1,0,0,1,1,1]),c=d.BufferObject.createVertex(a,35044,c);this._solidVertexArrayObject=new d.VertexArrayObject(a,this._programCache.getProgramAttributes(0),{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:c});return this._solidrendererInitialized=!0};c.prototype._initialize=function(c){if(this._rendererInitialized)return!0;var b=[];b.push(a.i1616to32(0,0));b.push(a.i1616to32(1,0));b.push(a.i1616to32(0,1));b.push(a.i1616to32(1,1));b=new Uint32Array(b);
b=d.BufferObject.createVertex(c,35044,b);this._vertexArrayObject=new d.VertexArrayObject(c,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:b});return this._rendererInitialized=!0};return c}()})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["require","exports"],function(w,v){return function(){function r(h){this._array=[];0>=h&&console.error("strideInBytes must be positive!");this._stride=h}Object.defineProperty(r.prototype,
"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"index",{get:function(){return 4*this._array.length/this._stride},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"itemSize",{get:function(){return this._stride},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"sizeInBytes",{get:function(){return 4*this._array.length},enumerable:!0,configurable:!0});r.prototype.reset=function(){this.array.length=0};r.prototype.toBuffer=
function(){return(new Uint32Array(this._array)).buffer};r.i1616to32=function(h,f){return 65535&h|f<<16};r.i8888to32=function(h,f,d,a){return h&255|(f&255)<<8|(d&255)<<16|a<<24};r.i8816to32=function(h,f,d){return h&255|(f&255)<<8|d<<16};return r}()})},"esri/views/2d/engine/vectorTiles/renderers/rendererUtils":function(){define(["require","exports"],function(w,v){Object.defineProperty(v,"__esModule",{value:!0});var r=new Uint32Array(1),h=new Uint8Array(r.buffer);v.int32To4Bytes=function(f){r[0]=f|0;
return[h[0],h[1],h[2],h[3]]}})},"esri/views/2d/engine/vectorTiles/renderers/CircleRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./rendererUtils".split(" "),function(w,v,r,h,f,d,a,b,c){return function(){function e(a){this._viewProjMat=h.mat4f32.create();this._offsetVector=f.vec3f32.create();
this._color=d.vec4f32.create();this._strokeColor=d.vec4f32.create();this._initialized=!1;this._programOptions={id:!1};this._programCache=a}e.prototype.dispose=function(){};e.prototype.render=function(a,e,d,f,g,l,h,x,t){if(0===e.triangleElementCount)return 0;this._initialized||this._initialize(a);var p=h.hasDataDrivenRadius?1:h.getPaintValue("circle-radius",d),m=h.hasDataDrivenColor?[1,1,1,1]:h.getPaintValue("circle-color",d),n=h.hasDataDrivenOpacity?1:h.getPaintValue("circle-opacity",d),k=h.hasDataDrivenStrokeWidth?
1:h.getPaintValue("circle-stroke-width",d),u=h.hasDataDrivenStrokeColor?[1,1,1,1]:h.getPaintValue("circle-stroke-color",d),q=h.hasDataDrivenStrokeOpacity?1:h.getPaintValue("circle-stroke-opacity",d),y=h.hasDataDrivenBlur?0:h.getPaintValue("circle-blur",d),n=n*m[3]*t;this._color[0]=n*m[0];this._color[1]=n*m[1];this._color[2]=n*m[2];this._color[3]=n;n=q*u[3]*t;this._strokeColor[0]=n*u[0];this._strokeColor[1]=n*u[1];this._strokeColor[2]=n*u[2];this._strokeColor[3]=n;t=l.tileTransform.transform;m=h.getPaintValue("circle-translate",
d);if(0!==m[0]||0!==m[1])r.mat4.copy(this._viewProjMat,l.tileTransform.transform),t=m[0],m=m[1],q=u=0,q=(1<<l.key.level)/Math.pow(2,d)*(l.coordRange/512),1===h.getPaintValue("circle-translate-anchor",d)?(g*=-b.C_DEG_TO_RAD,d=Math.sin(g),g=Math.cos(g),u=q*(t*g-m*d),q*=t*d+m*g):(u=q*t,q*=m),this._offsetVector[0]=u,this._offsetVector[1]=q,this._offsetVector[2]=0,r.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),t=this._viewProjMat;d=this._getCircleVAO(a,l);if(!d)return 0;a.bindVAO(d);
f=3===f;d=this._programOptions;d.id=f;d=this._programCache.getProgram(5,f?1:0,d);a.bindProgram(d);d.setUniformMatrix4fv("u_transformMatrix",t);d.setUniformMatrix4fv("u_extrudeMatrix",x);d.setUniform2fv("u_normalized_origin",l.tileTransform.displayCoord);d.setUniform1f("u_depth",h.z);d.setUniform1f("u_radius",p);d.setUniform4fv("u_color",this._color);d.setUniform1f("u_blur",y);d.setUniform1f("u_stroke_width",k);d.setUniform4fv("u_stroke_color",this._strokeColor);d.setUniform1f("u_antialiasingWidth",
1.2);f&&(l=c.int32To4Bytes(e.layerID),d.setUniform4f("u_id",l[0],l[1],l[2],l[3]));a.drawElements(4,e.triangleElementCount,5125,12*e.triangleElementStart);a.bindVAO();return e.triangleCount()};e.prototype._initialize=function(a){if(this._initialized)return!0;this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,
normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return this._initialized=!0};e.prototype._getCircleVAO=function(c,b){if(b.circleVertexArrayObject)return b.circleVertexArrayObject;var e=b.circleVertexBuffer,d=b.circleIndexBuffer;if(!e||!d)return null;b.circleVertexArrayObject=new a.VertexArrayObject(c,this._programCache.getProgramAttributes(5),this._vertexAttributes,{geometry:e},d);return b.circleVertexArrayObject};return e}()})},"esri/views/2d/engine/vectorTiles/renderers/FadeRecorder":function(){define(["require",
"exports","../../../../../core/now"],function(w,v,r){Object.defineProperty(v,"__esModule",{value:!0});(function(){return function(h,f){this.level=h;this.now=f}})();w=function(){return function(h,f,d,a){this.fadeSpeed=h;this.minfadeLevel=f;this.maxfadeLevel=d;this.fadeChange=a}}();v.FadeProperties=w;w=function(){function h(f){void 0===f&&(f=300);this._levelSnapshots=[];this._duration=f}h.prototype.recordLevel=function(f){var d=r(),a=this._levelSnapshots;0===a.length&&(a.push({level:f,now:0}),a.push({level:f,
now:0}));2!==a.length&&a[0].level===f||a.push({level:f,now:d})};h.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var f=this._duration,d=this._levelSnapshots,a=d.length,b=d[a-1],c=-1;a>c+1&&d[c+1].now+f<b.now;)c++;for(0>c&&(c=0);c<a;c++)if(d[c].level!==b.level)return!0;return!1};h.prototype.getFadeValues=function(f){void 0===f&&(f=!1);for(var d=this._duration,a=r(),b=this._levelSnapshots;3<b.length&&b[1].now+d<a;)b.shift();b[1].now+d<a&&(b[0].level=b[1].level);var c=
b[0].level,e=b[b.length-1],h=e.level,m=Math.min(c,h),c=Math.max(c,h),b=(e.level-b[1].level)/((e.now-b[1].now)/d);return f?{fadeSpeed:0,minfadeLevel:m,maxfadeLevel:c,fadeChange:0}:{fadeSpeed:b,minfadeLevel:m,maxfadeLevel:c,fadeChange:(a-e.now)/d*b}};return h}();v.FadeRecorder=w})},"esri/views/2d/engine/vectorTiles/renderers/FillRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./rendererUtils".split(" "),
function(w,v,r,h,f,d,a,b,c,e,y){var m=1/65536;return function(){function q(c){this._viewProjMat=d.mat4f32.create();this._offsetVector=a.vec3f32.create();this._patternMatrix=h.mat3f32.create();this._color=b.vec4f32.create();this._outlineColor=b.vec4f32.create();this._initialized=!1;this._fillProgramOptions={id:!1,dd:!1,pattern:!1};this._outlineProgramOptions={id:!1,dd:!1};this._programCache=c}q.prototype.dispose=function(){};q.prototype.render=function(a,c,b,d,h,q,r,v,n,k,u){if(0===c.triangleElementCount)return 0;
this._initialized||this._initialize(a);var g=void 0!==r.getPaintValue("fill-pattern",b),l=r.hasDataDrivenColor?[1,1,1,1]:r.getPaintValue("fill-color",b),p=r.hasDataDrivenOpacity?1:r.getPaintValue("fill-opacity",b),t=p*l[3]*u;this._color[0]=t*l[0];this._color[1]=t*l[1];this._color[2]=t*l[2];this._color[3]=t;var l=3===h,z;l&&(z=y.int32To4Bytes(c.layerID));var t=q.tileTransform.transform,x=q.coordRange/512,w=r.getPaintValue("fill-translate",b);if(0!==w[0]||0!==w[1]){f.mat4.copy(this._viewProjMat,q.tileTransform.transform);
var t=w[0],w=w[1],A=0,C=0,x=(1<<q.key.level)/Math.pow(2,b)*x;1===r.getPaintValue("fill-translate-anchor",b)?(A=-e.C_DEG_TO_RAD*d,d=Math.sin(A),C=Math.cos(A),A=x*(t*C-w*d),C=x*(t*d+w*C)):(A=x*t,C=x*w);this._offsetVector[0]=A;this._offsetVector[1]=C;this._offsetVector[2]=0;f.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);t=this._viewProjMat}v=this._drawFill(a,c,b,h,q,r,v,t,k,u,l,z);if(!(r.getPaintValue("fill-antialias",b)&&!g&&0<c.outlineElementCount)||1!==h&&3!==h)return v;
h=r.hasDataDrivenOutline;if(r.outlineUsesFillColor){if(1!==this._color[3])return c.triangleElementCount/3;this._outlineColor[0]=this._color[0];this._outlineColor[1]=this._color[1];this._outlineColor[2]=this._color[2];this._outlineColor[3]=this._color[3]}else b=r.hasDataDrivenOutlineColor?[1,1,1,1]:r.getPaintValue("fill-outline-color",b),u*=p*b[3],this._outlineColor[0]=u*b[0],this._outlineColor[1]=u*b[1],this._outlineColor[2]=u*b[2],this._outlineColor[3]=u;k=.75/k;u=this._getOutlineVAO(a,q,h);if(!u)return v;
a.bindVAO(u);u=this._outlineProgramOptions;u.id=l;u.dd=h;u=this._programCache.getProgram(2,(l?1:0)<<1|(h?1:0),u);a.bindProgram(u);u.setUniformMatrix4fv("u_transformMatrix",t);u.setUniformMatrix4fv("u_extrudeMatrix",n);u.setUniform2fv("u_normalized_origin",q.tileTransform.displayCoord);u.setUniform1f("u_depth",r.z+m);u.setUniform1f("u_outline_width",k);u.setUniform4fv("u_color",this._outlineColor);l&&u.setUniform4f("u_id",z[0],z[1],z[2],z[3]);a.drawElements(4,c.outlineElementCount,5125,12*c.outlineElementStart);
a.bindVAO();return v+=c.outlineElementCount/3};q.prototype._initialize=function(a){if(this._initialized)return!0;this._fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};this._fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};this._outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,
stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]};this._outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,
offset:8,stride:12,normalized:!0,divisor:0}]};return this._initialized=!0};q.prototype._drawFill=function(a,c,b,e,d,f,h,q,n,k,u,y){var g=f.getPaintValue("fill-pattern",b),l=void 0!==g,p=f.hasDataDrivenOpacity?1:k*f.getPaintValue("fill-opacity",b),t=f.hasDataDrivenColor?[1,1,1,1]:f.getPaintValue("fill-color",b);k*=p*t[3];this._color[0]=k*t[0];this._color[1]=k*t[1];this._color[2]=k*t[2];this._color[3]=k;t=f.hasDataDrivenFill;if((k=l||1>k||t)&&0===e||!k&&1===e)return 0;e=this._getFillVAO(a,d,t);if(!e)return 0;
a.bindVAO(e);e=this._fillProgramOptions;e.id=u;e.dd=t;e.pattern=l;e=this._programCache.getProgram(1,(u?1:0)<<2|(t?1:0)<<1|(l?1:0),e);a.bindProgram(e);if(l){g=h.getMosaicItemPosition(g,!0);if(!g){a.bindVAO();a.bindProgram();return}b=d.coordRange/512/Math.pow(2,Math.round(b)-d.key.level)/n;r.mat3.identity(this._patternMatrix);n=1/(g.size[1]*b);this._patternMatrix[0]=1/(g.size[0]*b);this._patternMatrix[4]=n;h.bind(a,9729,g.page,5);e.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix);e.setUniform2f("u_pattern_tl",
g.tl[0],g.tl[1]);e.setUniform2f("u_pattern_br",g.br[0],g.br[1]);e.setUniform1i("u_texture",5)}e.setUniformMatrix4fv("u_transformMatrix",q);e.setUniform2fv("u_normalized_origin",d.tileTransform.displayCoord);e.setUniform1f("u_depth",f.z+m);e.setUniform4fv("u_color",this._color);u&&e.setUniform4f("u_id",y[0],y[1],y[2],y[3]);a.drawElements(4,c.triangleElementCount,5125,12*c.triangleElementStart);a.bindVAO();return c.triangleElementCount/3};q.prototype._getFillVAO=function(a,b,e){if(e){if(b.fillDDVertexArrayObject)return b.fillDDVertexArrayObject;
e=b.fillDDVertexBuffer;var d=b.fillIndexBuffer;if(!e||!d)return null;b.fillDDVertexArrayObject=new c.VertexArrayObject(a,this._programCache.getProgramAttributes(1),this._fillVertexAttributesDD,{geometry:e},d);return b.fillDDVertexArrayObject}if(b.fillVertexArrayObject)return b.fillVertexArrayObject;e=b.fillVertexBuffer;d=b.fillIndexBuffer;if(!e||!d)return null;b.fillVertexArrayObject=new c.VertexArrayObject(a,this._programCache.getProgramAttributes(1),this._fillVertexAttributes,{geometry:e},d);return b.fillVertexArrayObject};
q.prototype._getOutlineVAO=function(a,b,e){if(e){if(b.outlineDDVertexArrayObject)return b.outlineDDVertexArrayObject;e=b.outlineDDVertexBuffer;var d=b.outlineIndexBuffer;if(!e||!d)return null;b.outlineDDVertexArrayObject=new c.VertexArrayObject(a,this._programCache.getProgramAttributes(2),this._outlineVertexAttributesDD,{geometry:e},d);return b.outlineDDVertexArrayObject}if(b.outlineVertexArrayObject)return b.outlineVertexArrayObject;e=b.outlineVertexBuffer;d=b.outlineIndexBuffer;if(!e||!d)return null;
b.outlineVertexArrayObject=new c.VertexArrayObject(a,this._programCache.getProgramAttributes(2),this._outlineVertexAttributes,{geometry:e},d);return b.outlineVertexArrayObject};return q}()})},"esri/views/2d/engine/vectorTiles/renderers/LineRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./rendererUtils".split(" "),
function(w,v,r,h,f,d,a,b,c,e){return function(){function y(b){this._initialized=!1;this._viewProjMat=h.mat4f32.create();this._offsetVector=d.vec3f32.create();this._color=a.vec4f32.create();this._dashArray=f.vec2f32.create();this._programOptions={id:!1,dd:!1,pattern:!1};this._programCache=b}y.prototype.dispose=function(){};y.prototype.render=function(a,b,d,f,l,h,y,t,v,w,n){if(0===b.triangleElementCount)return 0;this._initialized||this._initialize(a);var g=h.tileTransform.transform,u=h.coordRange/512,
m=y.getPaintValue("line-translate",d);if(0!==m[0]||0!==m[1]){r.mat4.copy(this._viewProjMat,h.tileTransform.transform);var g=m[0],m=m[1],p=0,q=0,q=(1<<h.key.level)/Math.pow(2,d)*u;l=l.rotation;if(1===y.getPaintValue("line-translate-anchor",d)){p=-c.C_DEG_TO_RAD*l;l=Math.sin(p);var x=Math.cos(p),p=q*(g*x-m*l),q=q*(g*l+m*x)}else p=q*g,q*=m;this._offsetVector[0]=p;this._offsetVector[1]=q;this._offsetVector[2]=0;r.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);g=this._viewProjMat}m=
y.getPaintValue("line-pattern",d);q=void 0!==m;w=1/w;l=y.getPaintValue("line-blur",d);var x=y.hasDataDrivenColor?[1,1,1,1]:y.getPaintValue("line-color",d),z=y.hasDataDrivenOpacity?1:y.getPaintValue("line-opacity",d),p=y.hasDataDrivenWidth?1:y.getPaintValue("line-width",d);n*=z*x[3];this._color[0]=n*x[0];this._color[1]=n*x[1];this._color[2]=n*x[2];this._color[3]=n;n=y.hasDataDrivenLine;f=3===f;var A;f&&(A=e.int32To4Bytes(b.layerID));x=this._getLineVAO(a,h,n);if(!x)return 0;a.bindVAO(x);x=this._programOptions;
x.id=f;x.dd=n;x.pattern=q;n=this._programCache.getProgram(3,(f?1:0)<<2|(n?1:0)<<1|(q?1:0),x);a.bindProgram(n);n.setUniformMatrix4fv("u_transformMatrix",g);n.setUniformMatrix4fv("u_extrudeMatrix",v);n.setUniform2fv("u_normalized_origin",h.tileTransform.displayCoord);n.setUniform1f("u_depth",y.z);n.setUniform1f("u_blur",l);n.setUniform1f("u_antialiasing",w);n.setUniform4fv("u_color",this._color);n.setUniform1f("u_width",p);f&&n.setUniform4f("u_id",A[0],A[1],A[2],A[3]);if(q){if(d=t.getMosaicItemPosition(m,
!0))t.bind(a,9729,d.page,5),n.setUniform2f("u_pattern_tl",d.tl[0],d.br[1]),n.setUniform2f("u_pattern_br",d.br[0],d.tl[1]),n.setUniform2f("u_spriteSize",u*d.size[0],d.size[1]),n.setUniform1i("u_texture",5)}else t=y.getPaintValue("line-dasharray",d),2>t.length&&(t=[1,-1]),this._dashArray[0]=u*t[0],this._dashArray[1]=u*t[1],n.setUniform2fv("u_dasharray",this._dashArray);a.drawElements(4,b.triangleElementCount,5125,12*b.triangleElementStart);a.bindVAO();return b.triangleCount()};y.prototype._initialize=
function(a){if(this._initialized)return!0;this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]};this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,
normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};return this._initialized=!0};y.prototype._getLineVAO=function(a,c,e){if(e){if(c.lineDDVertexArrayObject)return c.lineDDVertexArrayObject;e=c.lineDDVertexBuffer;var d=c.lineIndexBuffer;if(!e||!d)return null;c.lineDDVertexArrayObject=
new b.VertexArrayObject(a,this._programCache.getProgramAttributes(3),this._vertexAttributesDD,{geometry:e},d);return c.lineDDVertexArrayObject}if(c.lineVertexArrayObject)return c.lineVertexArrayObject;e=c.lineVertexBuffer;d=c.lineIndexBuffer;if(!e||!d)return null;c.lineVertexArrayObject=new b.VertexArrayObject(a,this._programCache.getProgramAttributes(3),this._vertexAttributes,{geometry:e},d);return c.lineVertexArrayObject};return y}()})},"esri/views/2d/engine/vectorTiles/renderers/SymbolRenderer":function(){define(["require",
"exports","./IconRenderer","./SDFRenderer"],function(w,v,r,h){return function(){function f(d){this._iconRenderer=new r(d);this._sdfRenderer=new h(d)}f.prototype.dispose=function(){this._iconRenderer&&(this._iconRenderer.dispose(),this._iconRenderer=null);this._sdfRenderer&&(this._sdfRenderer.dispose(),this._sdfRenderer=null)};f.prototype.render=function(d,a,b,c,e,f,h,q,p,g,l,r,x,t){if(!a.hasData())return 0;0<a.markerPerPageElementsMap.size&&this._iconRenderer.render(d,a,b,c,e,f,h,q,p,l,r,t);0<a.glyphPerPageElementsMap.size&&
this._sdfRenderer.render(d,a,b,c,e,f,h,q,g,l,r,x,t);return a.triangleCount()};return f}()})},"esri/views/2d/engine/vectorTiles/renderers/IconRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./rendererUtils".split(" "),function(w,v,r,h,f,d,a,b,c,e){return function(){function y(c){this._viewProjMat=
h.mat4f32.create();this._offsetVector=d.vec3f32.create();this._spritesTextureSize=f.vec2f32.create();this._color=a.vec4f32.create();this._initialized=!1;this._programOptions={id:!1,dd:!1,sdf:!1};this._programCache=c}y.prototype.dispose=function(){};y.prototype.render=function(a,b,d,f,l,h,y,t,v,w,n,k){var g=this;this._initialized||this._initialize(a);var m=t.hasDataDrivenIconSize?1:t.getLayoutValue("icon-size",d),p=t.hasDataDrivenIconColor?[1,1,1,1]:t.getPaintValue("icon-color",d),q=t.hasDataDrivenIconOpacity?
1:t.getPaintValue("icon-opacity",d);k*=p[3]*q;this._color[0]=k*p[0];this._color[1]=k*p[1];this._color[2]=k*p[2];this._color[3]=k;p=t.getLayoutValue("icon-rotation-alignment",d);2===p&&(p=1===t.getLayoutValue("symbol-placement",d)?0:1);var x=0===p;k=b.isSDF;q=t.hasDataDrivenIcon;f=3===f;var p=c.degToByte(l),z=y.tileTransform.transform,A=t.getPaintValue("icon-translate",d);if(0!==A[0]||0!==A[1]){r.mat4.copy(this._viewProjMat,y.tileTransform.transform);var z=A[0],A=A[1],C=0,E=0,E=(1<<y.key.level)/Math.pow(2,
d)*(y.coordRange/512);if(1===t.getPaintValue("icon-translate-anchor",d)){C=-c.C_DEG_TO_RAD*l;l=Math.sin(C);var J=Math.cos(C),C=E*(z*J-A*l),E=E*(z*l+A*J)}else C=E*z,E*=A;this._offsetVector[0]=C;this._offsetVector[1]=E;this._offsetVector[2]=0;r.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);z=this._viewProjMat}w=x?w:n;if(n=this._getIconVAO(a,y,q)){a.bindVAO(n);n=this._programOptions;n.id=f;n.dd=q;n.sdf=k;var B=this._programCache.getProgram(4,(f?1:0)<<2|(q?1:0)<<1|(k?1:0),n);
a.bindProgram(B);k&&(n=t.getPaintValue("icon-halo-color",d),k=t.getPaintValue("icon-halo-width",d),B.setUniform4f("u_outlineColor",n[0],n[1],n[2],n[3]),B.setUniform1f("u_outlineSize",k));B.setUniformMatrix4fv("u_transformMatrix",z);B.setUniformMatrix4fv("u_extrudeMatrix",w);B.setUniform2fv("u_normalized_origin",y.tileTransform.displayCoord);B.setUniform1f("u_depth",t.z);B.setUniform1f("u_mapRotation",p);B.setUniform1f("u_keepUpright",0);B.setUniform1f("u_level",10*d);B.setUniform1f("u_fadeSpeed",
10*h.fadeSpeed);B.setUniform1f("u_minfadeLevel",10*h.minfadeLevel);B.setUniform1f("u_maxfadeLevel",10*h.maxfadeLevel);B.setUniform1f("u_fadeChange",10*(d+h.fadeChange));B.setUniform1i("u_texture",5);B.setUniform1f("u_size",m);B.setUniform4fv("u_color",this._color);f&&(d=e.int32To4Bytes(b.layerID),B.setUniform4f("u_id",d[0],d[1],d[2],d[3]));b.markerPerPageElementsMap.forEach(function(b,c){g._spritesTextureSize[0]=v.getWidth(c)/4;g._spritesTextureSize[1]=v.getHeight(c)/4;B.setUniform2fv("u_mosaicSize",
g._spritesTextureSize);v.bind(a,9729,c,5);a.drawElements(4,b[1],5125,12*b[0])});a.bindVAO()}};y.prototype._initialize=function(a){if(this._initialized)return!0;this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,
divisor:0}]};this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,
normalized:!1,divisor:0}]};return this._initialized=!0};y.prototype._getIconVAO=function(a,c,e){if(e){if(c.iconDDVertexArrayObject)return c.iconDDVertexArrayObject;e=c.iconDDVertexBuffer;var d=c.iconIndexBuffer;if(!e||!d)return null;c.iconDDVertexArrayObject=new b.VertexArrayObject(a,this._programCache.getProgramAttributes(4),this._vertexAttributesDD,{geometry:e},d);return c.iconDDVertexArrayObject}if(c.iconVertexArrayObject)return c.iconVertexArrayObject;e=c.iconVertexBuffer;d=c.iconIndexBuffer;
if(!e||!d)return null;c.iconVertexArrayObject=new b.VertexArrayObject(a,this._programCache.getProgramAttributes(4),this._vertexAttributes,{geometry:e},d);return c.iconVertexArrayObject};return y}()})},"esri/views/2d/engine/vectorTiles/renderers/SDFRenderer":function(){define("require exports ../../../../../core/has ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./rendererUtils".split(" "),
function(w,v,r,h,f,d,a,b,c,e,y){var m=1/65536;return function(){function q(c){this._viewProjMat=f.mat4f32.create();this._offsetVector=a.vec3f32.create();this._extrudeMat=f.mat4f32.create();this._scaleVec=a.vec3f32.create();this._haloColor=b.vec4f32.create();this._sdfColor=b.vec4f32.create();this._initialized=!1;this._programOptions={id:!1,dd:!1};this._programCache=c}q.prototype.dispose=function(){};q.prototype.render=function(a,c,b,f,q,t,v,w,n,k,u,H,I){var g=this;if(!r("esri-vector-tiles-avoid-text")){this._initialized||
this._initialize(a);var l=e.degToByte(q),p=w.getLayoutValue("text-rotation-alignment",b);2===p&&(p=1===w.getLayoutValue("symbol-placement",b)?0:1);var x=0===p,p=w.getLayoutValue("text-keep-upright",b)&&x;f=3===f;H=.8*3/H;var z=w.hasDataDrivenTextSize?1:w.getLayoutValue("text-size",b),A=w.hasDataDrivenTextColor?[1,1,1,1]:w.getPaintValue("text-color",b),C=w.hasDataDrivenTextOpacity?1:w.getPaintValue("text-opacity",b),B=A[3]*C*I;this._sdfColor[0]=B*A[0];this._sdfColor[1]=B*A[1];this._sdfColor[2]=B*A[2];
this._sdfColor[3]=B;this._glyphTextureSize||(this._glyphTextureSize=d.vec2f32.fromValues(n.width/4,n.height/4));A=v.tileTransform.transform;B=w.getPaintValue("text-translate",b);if(0!==B[0]||0!==B[1]){h.mat4.copy(this._viewProjMat,v.tileTransform.transform);var A=B[0],B=B[1],G=0,F=0,F=(1<<v.key.level)/Math.pow(2,b)*(v.coordRange/512);if(1===w.getPaintValue("text-translate-anchor",b)){G=-e.C_DEG_TO_RAD*q;q=Math.sin(G);var K=Math.cos(G),G=F*(A*K-B*q),F=F*(A*q+B*K)}else G=F*A,F*=B;this._offsetVector[0]=
G;this._offsetVector[1]=F;this._offsetVector[2]=0;h.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);A=this._viewProjMat}x?h.mat4.copy(this._extrudeMat,k):h.mat4.copy(this._extrudeMat,u);this._scaleVec[0]=1/24;this._scaleVec[1]=1/24;this._scaleVec[2]=1;h.mat4.scale(this._extrudeMat,this._extrudeMat,this._scaleVec);k=w.hasDataDrivenText;if(u=this._getSDFVAO(a,v,k)){a.bindVAO(u);u=this._programOptions;u.id=f;u.dd=k;var D=this._programCache.getProgram(6,(f?1:0)<<1|(k?1:0),u);a.bindProgram(D);
D.setUniformMatrix4fv("u_transformMatrix",A);D.setUniformMatrix4fv("u_extrudeMatrix",this._extrudeMat);D.setUniform2fv("u_normalized_origin",v.tileTransform.displayCoord);D.setUniform1f("u_depth",w.z+m);D.setUniform2fv("u_mosaicSize",this._glyphTextureSize);D.setUniform1f("u_mapRotation",l);D.setUniform1f("u_keepUpright",p?1:0);D.setUniform1f("u_level",10*b);D.setUniform1f("u_fadeSpeed",10*t.fadeSpeed);D.setUniform1f("u_minfadeLevel",10*t.minfadeLevel);D.setUniform1f("u_maxfadeLevel",10*t.maxfadeLevel);
D.setUniform1f("u_fadeChange",10*(b+t.fadeChange));D.setUniform1i("u_texture",6);D.setUniform1f("u_size",z);D.setUniform1f("u_antialiasingWidth",H);f&&(t=y.int32To4Bytes(c.layerID),D.setUniform4f("u_id",t[0],t[1],t[2],t[3]));c.glyphPerPageElementsMap.forEach(function(c,e){g._renderGlyphRange(a,c,e,w,n,D,b,C*I,3)});a.bindVAO()}}};q.prototype._renderGlyphRange=function(a,c,b,e,d,f,h,m,n){d.bind(a,9729,b,6);d=e.getPaintValue("text-halo-color",h);b=e.getPaintValue("text-halo-width",h);0<d[3]&&0<b&&(m*=
d[3],this._haloColor[0]=m*d[0],this._haloColor[1]=m*d[1],this._haloColor[2]=m*d[2],this._haloColor[3]=m,e=e.getPaintValue("text-halo-blur",h)*n,n*=b,f.setUniform4fv("u_color",this._haloColor),f.setUniform1f("u_halo",1),f.setUniform1f("u_edgeDistance",n),f.setUniform1f("u_edgeBlur",e),a.drawElements(4,c[1],5125,12*c[0]));0<this._sdfColor[3]&&(f.setUniform4fv("u_color",this._sdfColor),f.setUniform1f("u_halo",0),f.setUniform1f("u_edgeDistance",0),f.setUniform1f("u_edgeBlur",0),a.drawElements(4,c[1],
5125,12*c[0]))};q.prototype._initialize=function(a){if(this._initialized)return!0;this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,
offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}]};return this._initialized=!0};q.prototype._getSDFVAO=function(a,
b,e){if(e){if(b.textDDVertexArrayObject)return b.textDDVertexArrayObject;e=b.textDDVertexBuffer;var d=b.textIndexBuffer;if(!e||!d)return null;b.textDDVertexArrayObject=new c.VertexArrayObject(a,this._programCache.getProgramAttributes(6),this._vertexAttributesDD,{geometry:e},d);return b.textDDVertexArrayObject}if(b.textVertexArrayObject)return b.textVertexArrayObject;e=b.textVertexBuffer;d=b.textIndexBuffer;if(!e||!d)return null;b.textVertexArrayObject=new c.VertexArrayObject(a,this._programCache.getProgramAttributes(6),
this._vertexAttributes,{geometry:e},d);return b.textVertexArrayObject};return q}()})},"esri/views/2d/engine/vectorTiles/renderers/TileInfoRenderer":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec4f32","../../../../webgl","../GeometryUtils"],function(w,v,r,h,f){return function(){function d(a){this._initialized=!1;this._color=r.vec4f32.fromValues(1,0,0,1);this._maxWidth=0;this._programOptions={id:!1,pattern:!1};this._programCache=a}d.prototype.dispose=function(){this._outlineVertexArrayObject&&
(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null)};d.prototype.render=function(a,b){this._initialized||this._initialize(a);var c=this._programCache.getProgram(0,0,this._programOptions);if(c&&(a.bindVAO(this._outlineVertexArrayObject),a.bindProgram(c),c.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform),c.setUniform2fv("u_normalized_origin",
b.tileTransform.displayCoord),c.setUniform1f("u_coord_range",b.coordRange),c.setUniform1f("u_depth",0),c.setUniform4fv("u_color",this._color),a.drawArrays(3,0,4),a.bindVAO(),1E5<b.triangleCount&&(a.setStencilFunction(514,b.stencilData.reference,b.stencilData.mask),a.setStencilTestEnabled(!0),a.bindVAO(this._quadVertexArrayObject),c.setUniform4f("u_color",.9,0,0,.35),a.drawArrays(5,0,4),a.bindVAO(),a.setStencilTestEnabled(!1)),c=this._getTexture(a,b))){var e=this._programCache.getProgram(7,0,null);
e&&(a.bindVAO(this._tileInfoVertexArrayObject),a.bindProgram(e),a.bindTexture(c,0),e.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform),e.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord),e.setUniform1f("u_depth",0),e.setUniform1f("u_coord_ratio",b.coordRange/512),e.setUniform2f("u_delta",8,8),e.setUniform2f("u_dimensions",c.descriptor.width,c.descriptor.height),a.drawArrays(5,0,4),a.bindVAO())}};d.prototype._initialize=function(a){if(this._initialized)return!0;var b=
{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},c=new Int8Array([0,0,1,0,1,1,0,1]),c=h.BufferObject.createVertex(a,35044,c),c=new h.VertexArrayObject(a,this._programCache.getProgramAttributes(0),b,{geometry:c}),e=new Int8Array([0,0,0,1,1,0,1,1]),e=h.BufferObject.createVertex(a,35044,e),e=new h.VertexArrayObject(a,this._programCache.getProgramAttributes(0),b,{geometry:e}),d=new Int8Array([0,0,1,0,0,1,1,1]),d=h.BufferObject.createVertex(a,35044,d);a=new h.VertexArrayObject(a,
this._programCache.getProgramAttributes(7),b,{geometry:d});this._outlineVertexArrayObject=c;this._quadVertexArrayObject=e;this._tileInfoVertexArrayObject=a;return this._initialized=!0};d.prototype._getTexture=function(a,b){if(b.texture)return b.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","512"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var c=b.key.id+
", "+b.triangleCount,e=this._canvas.getContext("2d");e.font="24px sans-serif";e.textAlign="left";e.textBaseline="middle";var d=e.measureText(c),d=Math.pow(2,Math.ceil(f.log2(d.width+2)));d>this._maxWidth&&(this._maxWidth=d);e.clearRect(0,0,this._maxWidth,32);e.fillStyle="blue";var m=d=0,q;if(b.refKeys)for(var p=0,g=Object.keys(b.refKeys);p<g.length;p++)q=b.refKeys[g[p]].match(/\d+/),q=parseInt(q[0],10),isNaN(q)||(m++,b.key.level>q&&d++);d===m?e.fillStyle="red":0<d&&(e.fillStyle="purple");e.fillText(c,
0,16);b.texture=new h.Texture(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas);return b.texture};return d}()})},"esri/views/2d/engine/vectorTiles/renderers/shaders/ProgramCache":function(){define(["require","exports","../../../../../webgl","./Programs"],function(w,v,r,h){Object.defineProperty(v,"__esModule",{value:!0});w=function(){function f(){this._cache=Array(8);for(var d=0;8>d;d++)this._cache[d]={}}f.prototype.dispose=function(){this._programRepo&&(this._programRepo.dispose(),
this._programRepo=null)};f.prototype.getProgram=function(d,a,b){var c=this._cache[d];c[a]||(d=this._programRepo.getProgram(this._getProgramTemplate(d),b),c[a]=d);return c[a]};f.prototype.getProgramAttributes=function(d){switch(d){case 0:return h.background.attributes;case 5:return h.circle.attributes;case 1:return h.fill.attributes;case 4:return h.icon.attributes;case 3:return h.line.attributes;case 2:return h.outline.attributes;case 6:return h.text.attributes;case 7:return h.tileInfo.attributes}};
f.prototype.initialize=function(d){this._programRepo||(this._programRepo=new r.ProgramCache(d))};f.prototype._getProgramTemplate=function(d){switch(d){case 0:return h.background;case 5:return h.circle;case 1:return h.fill;case 4:return h.icon;case 3:return h.line;case 2:return h.outline;case 6:return h.text;case 7:return h.tileInfo}};return f}();v.default=w})},"esri/views/2d/engine/vectorTiles/renderers/shaders/Programs":function(){define(["require","exports","../../../../../webgl","./sources/resolver"],
function(w,v,r,h){Object.defineProperty(v,"__esModule",{value:!0});v.background={name:"background",shaders:function(a){return{vertexShader:r.glslifyDefineMap({ID:a.id,PATTERN:a.pattern})+h.resolveIncludes("background/background.vert"),fragmentShader:r.glslifyDefineMap({ID:a.id,PATTERN:a.pattern})+h.resolveIncludes("background/background.frag")}},attributes:{a_pos:0}};v.circle={name:"circle",shaders:function(a){return{vertexShader:r.glslifyDefineMap({ID:a.id})+h.resolveIncludes("circle/circle.vert"),
fragmentShader:r.glslifyDefineMap({ID:a.id})+h.resolveIncludes("circle/circle.frag")}},attributes:{a_pos:0,a_color:1,a_stroke_color:2,a_data:3}};var f=function(a){return r.glslifyDefineMap({ID:a.id,DD:a.dd,PATTERN:a.pattern})};v.fill={name:"fill",shaders:function(a){return{vertexShader:f(a)+h.resolveIncludes("fill/fill.vert"),fragmentShader:f(a)+h.resolveIncludes("fill/fill.frag")}},attributes:{a_pos:0,a_color:1}};v.outline={name:"outline",shaders:function(a){return{vertexShader:r.glslifyDefineMap({ID:a.id,
DD:a.dd})+h.resolveIncludes("outline/outline.vert"),fragmentShader:r.glslifyDefineMap({ID:a.id,DD:a.dd})+h.resolveIncludes("outline/outline.frag")}},attributes:{a_pos:0,a_offset:1,a_xnormal:2,a_color:3}};v.icon={name:"icon",shaders:function(a){return{vertexShader:r.glslifyDefineMap({ID:a.id,DD:a.dd,SDF:a.sdf})+h.resolveIncludes("icon/icon.vert"),fragmentShader:r.glslifyDefineMap({ID:a.id,DD:a.dd,SDF:a.sdf})+h.resolveIncludes("icon/icon.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,
a_color:4,a_size:5}};var d=function(a){return r.glslifyDefineMap({ID:a.id,DD:a.dd,PATTERN:a.pattern})};v.line={name:"line",shaders:function(a){return{vertexShader:d(a)+h.resolveIncludes("line/line.vert"),fragmentShader:d(a)+h.resolveIncludes("line/line.frag")}},attributes:{a_pos:0,a_offsetAndNormal:1,a_accumulatedDistance:2,a_color:3,a_width:4}};v.text={name:"text",shaders:function(a){return{vertexShader:r.glslifyDefineMap({ID:a.id,DD:a.dd})+h.resolveIncludes("text/text.vert"),fragmentShader:r.glslifyDefineMap({ID:a.id,
DD:a.dd})+h.resolveIncludes("text/text.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_color:4,a_size:5}};v.tileInfo={name:"tileInfo",shaders:{vertexShader:h.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:h.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/vectorTiles/renderers/shaders/sources/resolver":function(){define(["require","exports","../../../../../../webgl","./shaderRepository"],function(w,v,r,h){Object.defineProperty(v,
"__esModule",{value:!0});var f=new r.ShaderCompiler(function(d){var a=h;d.split("/").forEach(function(b){a&&(a=a[b])});return a});v.resolveIncludes=function(d){return f.resolveIncludes(d)}})},"esri/views/2d/engine/vectorTiles/renderers/shaders/sources/shaderRepository":function(){define(["require","exports"],function(w,v){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d u_opacity * color;\n#else\n  gl_FragColor \x3d u_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform mediump vec2 u_normalized_origin;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\nvoid main() {\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(u_coord_range * a_pos, 0.0, 1.0);\n#ifdef PATTERN\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float dist \x3d length(v_offset);\n  mediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\n  lowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\n  gl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_color;\nattribute vec4 a_stroke_color;\nattribute vec4 a_data;\nconst float sizePrecision \x3d 0.25;\nconst float blurPrecision \x3d 0.03125;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_radius;\nuniform lowp vec4 u_color;\nuniform mediump float u_blur;\nuniform mediump float u_stroke_width;\nuniform lowp vec4 u_stroke_color;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n  v_color \x3d a_color * u_color;\n  v_stroke_color \x3d a_stroke_color * u_stroke_color;\n  v_stroke_width \x3d a_data[1] * sizePrecision * u_stroke_width;\n  v_radius \x3d a_data[2] * u_radius;\n  v_blur \x3d max(a_data[0] * blurPrecision + u_blur, u_antialiasingWidth / (v_radius + v_stroke_width));\n  mediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n  v_offset \x3d offset;\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos * 0.5, 0.0, 1.0) + u_extrudeMatrix * (v_radius + v_stroke_width) * vec4(offset, 0.0, 0.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d v_color[3] * color;\n#else\n  gl_FragColor \x3d v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat4 u_transformMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\nvoid main()\n{\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n#ifdef PATTERN\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\nuniform mediump float u_outlineSize;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\n  lowp vec4 fillPixelColor \x3d v_color;\n  float d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\n  const float sofetEdgeRatio \x3d 0.248062016;\n  float size \x3d max(v_size.x, v_size.y);\n  float dist \x3d d * sofetEdgeRatio * size;\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  if (u_outlineSize \x3e 0.25) {\n    lowp vec4 outlinePixelColor \x3d u_outlineColor;\n    const float outlineLimitRatio \x3d (16.0 / 86.0);\n    float clampedOutlineSize \x3d sofetEdgeRatio * min(u_outlineSize, outlineLimitRatio * max(v_size.x, v_size.y));\n    outlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\n    gl_FragColor \x3d v_transparency * mixColors(fillPixelColor, outlinePixelColor);\n  }\n  else {\n    gl_FragColor \x3d v_transparency * fillPixelColor;\n  }\n#else\n  lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d v_transparency * texColor;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_size;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle         \x3d a_levelInfo[1];\n  mediump float a_minLevel      \x3d a_levelInfo[2];\n  mediump float a_maxLevel      \x3d a_levelInfo[3];\n  mediump float delta_z \x3d 0.0;\n  mediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level);\n  delta_z +\x3d step(a_maxLevel, u_level);\n  lowp float alpha \x3d clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0);\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n    v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n    v_transparency \x3d 1.0;\n  }\n  delta_z +\x3d step(v_transparency, 0.0);\n  vec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\n  v_size \x3d abs(offset);\n#ifdef SDF\n  offset \x3d (120.0 / 86.0) * offset;\n#endif\n#ifdef DD\n  mediump float icon_size \x3d a_size * u_size;\n#else\n  mediump float icon_size \x3d u_size;\n#endif\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * icon_size * vec4(offset, delta_z, 0.0);\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n  v_transparency *\x3d v_color.w;\n}"},
line:{"line.frag":"varying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform mediump vec2 u_spriteSize;\nuniform sampler2D u_texture;\nconst mediump float tileCoordRatio \x3d 8.0;\n#else\nvarying mediump vec2 v_dasharray;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\n  lowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\n  mediump float relativeTexX \x3d mod((v_accumulatedDistance + v_normal.x * v_lineHalfWidth * tileCoordRatio) / u_spriteSize.x, 1.0);\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / u_spriteSize.y);\n  mediump vec2 texCoord \x3d mix(u_pattern_tl, u_pattern_br, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n  gl_FragColor \x3d alpha * v_color[3] * color;\n#else\n  lowp float dashPos \x3d  mod(v_accumulatedDistance, v_dasharray.x + v_dasharray.y);\n  lowp float dashAlpha \x3d clamp(min(dashPos, v_dasharray.x - dashPos) + 0.5, 0.0, 1.0);\n  dashAlpha \x3d max(sign(-v_dasharray.y), dashAlpha);\n  alpha *\x3d dashAlpha;\n  gl_FragColor \x3d alpha * v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"attribute vec2 a_pos;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistance;\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_blur;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_width;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_width;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\n#ifndef PATTERN\nuniform mediump vec2 u_dasharray;\nvarying mediump vec2 v_dasharray;\n#endif\nvoid main()\n{\n  v_normal \x3d a_offsetAndNormal.zw * scale;\n#ifdef DD\n  v_lineHalfWidth \x3d a_width * u_width;\n#else\n  v_lineHalfWidth \x3d u_width;\n#endif\n  v_lineHalfWidth +\x3d u_antialiasing;\n  v_lineHalfWidth *\x3d 0.5;\n#ifndef PATTERN\n#ifdef DD\n  v_dasharray \x3d u_dasharray * a_width;\n#else\n  v_dasharray \x3d u_dasharray * u_width;\n#endif\n#endif\n  mediump vec2 dist \x3d v_lineHalfWidth * a_offsetAndNormal.xy * scale;\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(dist, 0.0, 0.0);\n  v_accumulatedDistance \x3d a_accumulatedDistance.x;\n  v_blur \x3d u_blur + u_antialiasing;\n  #ifdef DD\n    v_color \x3d a_color * u_color;\n  #else\n    v_color \x3d u_color;\n  #endif\n  #ifdef ID\n    v_id \x3d u_id / 255.0;\n  #endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist \x3d abs(v_normal.y);\n  lowp float alpha \x3d smoothstep(1.0, 0.0, dist);\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_normal \x3d a_xnormal;\n  mediump vec4 dist \x3d vec4(u_outline_width * a_offset * scale, 0.0, 0.0);\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * dist;\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nuniform mediump float u_edgeDistance;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  mediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist) * v_transparency;\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\nuniform lowp vec4 u_color;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nvarying lowp vec4 v_color;\nuniform mediump float u_size;\n#ifdef DD\nattribute mediump float a_size;\n#endif\nvarying mediump float v_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_edgeDistance;\nuniform mediump float u_edgeBlur;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle        \x3d a_levelInfo[1];\n  mediump float a_minLevel    \x3d a_levelInfo[2];\n  mediump float a_maxLevel    \x3d a_levelInfo[3];\n  mediump float delta_z \x3d 0.0;\n  mediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level);\n  delta_z +\x3d step(a_maxLevel, u_level);\n  lowp float alpha \x3d clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0);\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n    v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n    v_transparency \x3d 1.0;\n  }\n  delta_z +\x3d step(v_transparency, 0.0);\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n#ifdef DD\n  if (u_halo \x3e 0.5)\n  {\n    v_color \x3d u_color;\n  }\n  else\n  {\n    v_color \x3d a_color * u_color;\n  }\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef DD\n  v_size \x3d a_size * u_size;\n#else\n  v_size \x3d u_size;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_edgeDistance \x3d edgePos - u_edgeDistance / v_size;\n  v_edgeWidth \x3d (u_antialiasingWidth + u_edgeBlur) / v_size;\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * v_size * vec4(offsetPrecision * a_vertexOffset, delta_z, 0.0);\n}"},
tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d 0.75 * color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat4 u_transformMatrix;\nuniform mediump vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\n  mediump vec2 offests \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(offests, 0.0, 1.0);\n  v_tex \x3d a_pos;\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/LayerView".split(" "),
function(w,v,r,h,f,d,a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.attached=!1;b.lastUpdateId=-1;b.moving=!1;b.updateRequested=!1;return b}r(b,a);b.prototype.initialize=function(){var a=this;this.when(function(){a.requestUpdate()});var b=function(){return a.notifyChange("rendering")};this.handles.add([f.init(this,"suspended",function(b){a.container&&(a.container.visible=!b);a.view&&!b&&a.updateRequested&&a.view.requestLayerViewUpdate(a)},!0),f.init(this,"fullOpacity",
function(b){a.container&&(a.container.opacity=b)},!0),f.on(this,"container","post-render",b),f.on(this,"container","will-render",b)])};b.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");this.updateRequested=!1;this.layer=null};Object.defineProperty(b.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});b.prototype.isVisibleAtScale=function(a){var b=!0,c=this.layer,e=c.minScale,c=c.maxScale;if(null!=e&&null!=c){var b=!e,d=!c;!b&&a<=e&&(b=!0);!d&&a>=c&&(d=!0);b=b&&d}return b};b.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};b.prototype.processUpdate=function(a){this.isFulfilled()&&
!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};b.prototype.isUpdating=function(){return!1};b.prototype.isRendering=function(){return!1};b.prototype.canResume=function(){var a=this.inherited(arguments);a&&(a=this.isVisibleAtScale(this.view.scale));return a};h([d.property()],b.prototype,"attached",void 0);h([d.property()],b.prototype,"container",void 0);h([d.property()],b.prototype,"moving",
void 0);h([d.property({dependsOn:["attached","suspended","moving"]})],b.prototype,"rendering",null);h([d.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],b.prototype,"suspended",void 0);h([d.property({readOnly:!0})],b.prototype,"updateParameters",void 0);h([d.property()],b.prototype,"updateRequested",void 0);h([d.property({dependsOn:["updateRequested","attached"]})],b.prototype,"updating",null);h([d.property()],b.prototype,"view",void 0);return b=h([d.subclass("esri.views.2d.layers.LayerView2D")],
b)}(d.declared(a))})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../layers/support/TileInfo ./TileInfoView ./TileKey".split(" "),function(w,v,r,h,f,d,a){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._fullCacheLodInfos=null;a._levelByScale={};return a}r(c,b);c.prototype.getTileParentId=function(b){b=a.pool.acquire(b);var c=0===b.level?null:a.getId(b.level-
1,b.row>>1,b.col>>1,b.world);a.pool.release(b);return c};c.prototype.getTileCoverage=function(a,c,d){a=b.prototype.getTileCoverage.call(this,a,c,d);if(!a)return a;var e=1<<a.lodInfo.level;a.spans=a.spans.filter(function(a){return 0<=a.row&&a.row<e});return a};c.prototype.scaleToLevel=function(a){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[a])return this._levelByScale[a];var b=this._fullCacheLodInfos;if(a>b[0].scale)return b[0].level;for(var c=void 0,
d=void 0,c=0;c<b.length-1;c++)if(d=b[c+1],a>d.scale)return c=b[c],c.level+(c.scale-a)/(c.scale-d.scale);return b[b.length-1].level};c.prototype._initializeFullCacheLODs=function(a){a=0===a[0].level?a.map(function(a){return{level:a.level,resolution:a.resolution,scale:a.scale}}):f.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(function(a){return{level:a.level,resolution:a.resolution,scale:a.scale}});for(var b=0;b<a.length;b++)this._levelByScale[a[b].scale]=
a[b].level;this._fullCacheLodInfos=a};return c}(d)})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/asyncUtils ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../engine/vectorTiles/TileHandler ../engine/vectorTiles/VectorTileContainer ../engine/vectorTiles/VectorTileDisplayObject ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy".split(" "),function(w,
v,r,h,f,d,a,b,c,e,y,m,q,p,g,l,z,x,t,C){var A=e.getLogger("esri.views.2d.layers.VectorTileLayerView2D");return function(e){function k(){var a=null!==e&&e.apply(this,arguments)||this;a._fetchQueue=null;a._parseQueue=null;a._isTileHandlerPromiseFulfilled=!1;a._handles=new c;a._invalidateStyle=!1;a.container=new p;return a}r(k,e);k.prototype.initialize=function(){var a=this;this._tileInfoView=new z(this.layer.tileInfo,this.layer.fullExtent);this._tileHandler=new q(this.layer,window.devicePixelRatio||
1,!0,this.container);this.handles.add(this.watch("layer.currentStyleInfo",function(b){a._start()}))};k.prototype.destroy=function(){this._stop();this.container.dispose();this._tileHandler.destroy();this._tileHandler=null};k.prototype.hitTest=function(c,d){var e=this;return this.suspended||!this._tileHandlerPromise?y.resolve(null):b.safeCast(this._tileHandlerPromise).then(function(){return e.container.hitTest(c,d).then(function(b){var c=e._tileHandler.getStyleRepository().layers;if(null===b||0>b||
b>=c.length)return null;b=new a({attributes:{layerId:b,layerName:c[b].id}});b.layer=e.layer;b.sourceLayer=e.layer;return b})})};k.prototype.update=function(a){var b=this;this.notifyChange("updating");var c=this._tileHandlerPromise;c&&c.then(function(){if(a.pixelRatio!==b._tileHandler.devicePixelRatio)b._start(),b._tileHandler.devicePixelRatio=a.pixelRatio;else{b._invalidateStyle?(b._issueStyleInvalidation(a),b._invalidateStyle=!1):(b._fetchQueue.pause(),b._parseQueue.pause(),b._fetchQueue.state=a.state,
b._parseQueue.state=a.state,b._tileStrategy.update(a),b._parseQueue.resume(),b._fetchQueue.resume());for(var c=0,d=b.container.children;c<d.length;c++)b._tileHandler.updateTile(d[c],a)}})};k.prototype.attach=function(){var a=this;this._start();this._handles.add(this.layer.on("paint-change",function(b){return a.container.requestRender()}));this._handles.add(this.layer.on("layout-change",function(b){a._invalidateStyle=!0;a.requestUpdate()}))};k.prototype.detach=function(){this._stop();this._handles.removeAll()};
k.prototype.moveStart=function(){this.requestUpdate()};k.prototype.viewChange=function(){this.requestUpdate()};k.prototype.moveEnd=function(){this.requestUpdate()};k.prototype.canResume=function(){var a=this.inherited(arguments),b=this.layer;if(a&&b.currentStyleInfo){var c=this.view.scale;(b=b.currentStyleInfo)&&b.layerDefinition&&(b=b.layerDefinition,b.minScale&&b.minScale<c&&(a=!1),b.maxScale&&b.maxScale>c&&(a=!1))}return a};k.prototype.isUpdating=function(){return!this._isTileHandlerPromiseFulfilled||
this._fetchQueue.updating||this._parseQueue.updating};k.prototype.acquireTile=function(a){var c=this,d=x.pool.acquire();d.set(a.level,a.row,a.col,a.world);a=this.updateParameters.state.rotation;var e=this._tileHandler.getStyleRepository(),f=g.pool.acquire(d,this.layer.tileInfo,e,a);b.safeCast(this._tileHandlerPromise).then(function(){c.notifyChange("updating");c._fetchQueue.push(f.key).then(function(a){return c._parseQueue.push(a)}).then(function(a){f.setData(a.tileData,a.client,a.refKeys);f.once("attach",
function(){return c.requestUpdate()});c.container.addChild(f);c.notifyChange("updating")}).catch(function(a){c.notifyChange("updating");y.isAbortError(a)||A.error(a)})});return f};k.prototype.releaseTile=function(a){var b=a.key.id;this._fetchQueue.abort(b);this._parseQueue.abort(b);this.container.removeChild(a);this.requestUpdate();a.once("detach",function(){return g.pool.release(a)});this.notifyChange("updating")};k.prototype._start=function(){var a=this;this._stop();if(this.layer.currentStyleInfo&&
this.attached){var b=new AbortController,c=this._tileHandler.start({signal:b.signal}).then(function(){a._tileStrategy=new C({cachePolicy:"keep",coveragePolicy:"smallest",acquireTile:function(b){return a.acquireTile(b)},releaseTile:function(b){return a.releaseTile(b)},tileInfoView:a._tileInfoView});a._fetchQueue=new t({tileInfoView:a._tileInfoView,process:function(b,c){return a._getTileData(b,c)},concurrency:15});a._parseQueue=new t({tileInfoView:a._tileInfoView,process:function(b,c){return a._parseTileData(b,
c)},concurrency:8});a.container.initialize(a._tileHandler.spriteMosaic,a._tileHandler.glyphMosaic,a.layer.tileInfo,a._tileInfoView);a.requestUpdate();a._isTileHandlerPromiseFulfilled=!0});this._tileHandlerAbortController=b;this._tileHandlerPromise=c}};k.prototype._stop=function(){if(this._tileHandlerAbortController){var a=this._tileHandlerAbortController;a&&a.abort();this._tileHandlerPromise=null;this._isTileHandlerPromiseFulfilled=!1;this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=
null);this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null);this.container.removeAllChildren();g.pool.prune()}};k.prototype._getTileData=function(a,b){return d(this,void 0,void 0,function(){var c;return f(this,function(d){switch(d.label){case 0:return[4,this._tileHandler.fetchTileData(a,b)];case 1:return c=d.sent(),this.notifyChange("updating"),[2,{key:a,data:c}]}})})};k.prototype._parseTileData=function(a,b){return d(this,
void 0,void 0,function(){return f(this,function(c){return[2,this._tileHandler.parseTileData(a,this.updateParameters.state.rotation,b)]})})};k.prototype._issueStyleInvalidation=function(a){var b=this;this.notifyChange("updating");this._tileHandlerPromise=this._tileHandler.updateStyle().then(function(){b._fetchQueue.pause();b._parseQueue.pause();b._fetchQueue.clear();b._parseQueue.clear();b._parseQueue.resume();b._fetchQueue.resume();b.notifyChange("updating");b.requestUpdate()})};h([m.property({dependsOn:["view.scale",
"layer.currentStyleInfo"]})],k.prototype,"suspended",void 0);return k=h([m.subclass("esri.views.2d.layers.VectorTileLayerView2D")],k)}(m.declared(l))});