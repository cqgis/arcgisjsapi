// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper @dojo/framework/shim/Set ../../webgl ./DisplayObject".split(" "),function(e,f,m,n,p,q){function r(d){var c=document.createElement("canvas");c.width=d.width;c.height=d.height;d.render(c.getContext("2d"));return c}function g(d,c,a){var b={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,flipped:!0};c&&a&&(b.width=c,b.height=a);return new p.Texture(d,b)}function h(d){k.has(d)&&(l.splice(l.indexOf(d),1),k.delete(d))}
Object.defineProperty(f,"__esModule",{value:!0});var l=[],k=new n.default;e=function(d){function c(a){void 0===a&&(a=null);var b=d.call(this)||this;b._height=void 0;b.pixelRatio=1;b.resolution=0;b.rotation=0;b._source=null;b._width=void 0;b.x=0;b.y=0;b.source=a;b.requestRender=b.requestRender.bind(b);return b}m(c,d);Object.defineProperty(c.prototype,"height",{get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(a){this._height=a},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"source",{get:function(){return this._source},set:function(a){this._source=a;this.invalidateTexture()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"sourceHeight",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"sourceWidth",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"width",{get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(a){this._width=a},enumerable:!0,configurable:!0});c.prototype.attach=function(){this.updateTexture();d.prototype.attach.call(this);return!0};c.prototype.detach=function(){this._texture.dispose();this._texture=null;h(this)};c.prototype.invalidateTexture=function(){this.attached?this.updateTexture():h(this)};c.prototype.updateTexture=function(){this._texture||
(this._texture=this.source?g(this.stage.context,this.sourceWidth,this.sourceHeight):g(this.stage.context));var a=this.source;a?(this._texture.resize(this.sourceWidth,this.sourceHeight),a&&"render"in a?this._texture.setData(r(a)):!a||"render"in a||this._texture.setData(a),this.ready(),this.requestRender()):this._texture.setData(null)};c.prototype.setSamplingMode=function(a){if(this._texture){var b=a;if(this._texture.descriptor.hasMipmap)b=9728===a?9985:9729===a?9987:a;else if(this.width!==this.sourceHeight||
this.height!==this.sourceHeight)b=9729;this._texture.setSamplingMode(b)}};c.prototype.bind=function(a){this._texture&&this.stage.context.bindTexture(this._texture,a)};c.prototype.doRender=function(a){if(this.source&&0<this.width&&this.isReady){var b=this.resolution/this.pixelRatio/a.state.resolution;.05>b||this.stage.painter.drawBitmap(a,this,b)}};return c}(q.DisplayObject);f.Bitmap=e});