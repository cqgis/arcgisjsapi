// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/renderers/support/heatmapUtils":function(){define(["require","exports","../../core/global","../../core/mathUtils"],function(h,d,m,g){function n(b,a,e,f,c){b=new Uint32Array(b*b);a="buffer"in a?a:new Float64Array(a);e="buffer"in e?new Uint32Array(e.buffer):new Uint32Array((new Uint8Array(e)).buffer);c=e.length/(c-f);for(var d=0;d<a.length;d++)b[d]=e[g.clamp(Math.floor((a[d]-f)*c),0,e.length-1)];return b.buffer}function p(b){for(var a=Math.round(3*b),e=2*b*b,f=new Float64Array(2*
a+1),c=0;c<=f.length;c++)f[c]=Math.exp(-Math.pow(c-a,2)/e)/Math.sqrt(2*Math.PI)*(b/2);return f}function l(b,a){return"function"===typeof b?b:b?"string"===typeof a?function(a){return-1*+a[b]}:function(e){return+e[b]+a}:function(a){return 1}}Object.defineProperty(d,"__esModule",{value:!0});d.generateGradient=function(){if(!("document"in m))return function(a){return null};var b=document.createElement("canvas"),a=b.getContext("2d");b.height=512;b.width=1;return function(e){a.clearRect(0,0,1,b.height);
var f=a.createLinearGradient(0,0,0,b.height),c=0;for(e=e.colorStops;c<e.length;c++){var d=e[c],k=d.color;f.addColorStop(Math.max(d.ratio,.001),"rgba("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+")")}a.fillStyle=f;a.fillRect(0,0,1,b.height);return a.getImageData(0,0,1,b.height).data}}();d.calculateHeatmapIntensityInfo=function(b,a,e,d){var c=a.blurRadius,f=a.fieldOffset,k=a.field;a=new Float64Array(e*d);for(var g=p(c),c=Math.round(3*c),w=Number.NEGATIVE_INFINITY,r,f=l(k,f),k=0;k<b.length;k++){var v=b[k],q=
v.geometry,h=q.x-c,x=q.y-c,n=Math.max(0,h);r=Math.max(0,x);for(var m=Math.min(d,q.y+c),q=Math.min(e,q.x+c),v=+f(v.attributes),t=r;t<m;t++)for(var z=g[t-x],u=n;u<q;u++)r=a[t*e+u]+=z*g[u-h]*v,r>w&&(w=r)}return{matrix:a.buffer,max:w}};d.drawHeatmap=function(b,a,e,d,c,g){b.canvas.width=b.canvas.height=a;b.clearRect(0,0,a,a);var f=b.getImageData(0,0,a,a);e&&d&&f.data.set(new Uint8ClampedArray(n(a,e,d,c,g)));b.putImageData(f,0,0)};d.createHeatmapImageData=n;d.createKernel=p;d.createValueFunction=l})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Accessor ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators".split(" "),
function(h,d,m,g,n,p,l){Object.defineProperty(d,"__esModule",{value:!0});h=function(b){function a(a){a=b.call(this)||this;a.tiles=new Map;a.layer=null;return a}m(a,b);a.prototype.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.tiles=null};Object.defineProperty(a.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!0,configurable:!0});a.prototype.acquireTile=function(a){var b=this,e=this.createTile(a);e.once("isReady",function(){return b.notifyChange("updating")});
this.tiles.set(a.id,e);return e};a.prototype.forEachTile=function(a){this.tiles.forEach(a)};a.prototype.releaseTile=function(a){this.tiles.delete(a.key.id);this.disposeTile(a)};a.prototype.isUpdating=function(){var a=!0;this.tiles.forEach(function(b){a=a&&b.isReady});return!a};a.prototype.invalidateLabels=function(){};a.prototype.requestUpdate=function(){this.layerView.requestUpdate()};g([l.property()],a.prototype,"layer",void 0);g([l.property()],a.prototype,"layerView",void 0);g([l.property()],a.prototype,
"tileInfoView",void 0);g([l.property()],a.prototype,"updating",null);return a=g([l.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],a)}(l.declared(n,p));d.default=h})},"esri/views/2d/layers/features/tileRenderers/support/HeatmapSource":function(){define(["require","exports","../../../../../../renderers/support/heatmapUtils"],function(h,d,m){Object.defineProperty(d,"__esModule",{value:!0});h=function(){function d(){this.gradient=null;this.width=this.height=512}d.prototype.render=
function(d){m.drawHeatmap(d,512,this.intensities,this.gradient,this.minPixelIntensity,this.maxPixelIntensity)};return d}();d.HeatmapSource=h})},"*noref":1}});
define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Accessor ../../../../../core/Error ../../../../../core/Logger ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators ../../../../../renderers/support/heatmapUtils ../../../engine ./BaseTileRenderer ./support/HeatmapSource".split(" "),function(h,d,m,g,n,p,l,b,a,e,f,c,y){Object.defineProperty(d,"__esModule",{value:!0});var k=l.getLogger("esri.2d.layers.features.tileRenderers.HeatmapTileRenderer");
h=function(d){function c(a){a=d.call(this,a)||this;a.container=new f.BitmapContainer;a.featuresView={attributeView:{initialize:function(){},requestUpdate:function(){}}};return a}m(c,d);Object.defineProperty(c.prototype,"gradient",{get:function(){return e.generateGradient(this.renderer.toJSON())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderer",{get:function(){var a=this.layer.renderer.type;return"heatmap"!==this.layer.renderer.type?(k.error(p("mapview-bad-type","Found invalid type "+
a+" for renderer")),null):this.layer.renderer},enumerable:!0,configurable:!0});c.prototype.createTile=function(a){var b=f.BitmapTile.pool.acquire();b.key.set(a);this.tileInfoView.getTileCoords(b,a);b.resolution=this.tileInfoView.getTileResolution(a);return b};c.prototype.onConfigUpdate=function(){var a=this.renderer,b=a.minPixelIntensity,c=a.maxPixelIntensity,d=this.gradient;this.tiles.forEach(function(a){var e=a.source;e&&(e.minPixelIntensity=b,e.maxPixelIntensity=c,e.gradient=d,a.invalidateTexture())})};
c.prototype.clear=function(){this.tiles.forEach(function(a){if(a=a.source)a.intensities=null})};c.prototype.hitTest=function(a,c){return b.resolve([])};c.prototype.highlight=function(a){return{remove:function(){},pause:function(){},resume:function(){}}};c.prototype.install=function(a){a.addChild(this.container)};c.prototype.uninstall=function(a){this.container.removeAllChildren();a.removeChild(this.container)};c.prototype.disposeTile=function(a){this.container.removeChild(a);f.BitmapTile.pool.release(a)};
c.prototype.supportsRenderer=function(a){return a&&"heatmap"===a.type};c.prototype.onTileData=function(a){var b=this.tiles.get(a.tileKey);if(b){a=a.intensityInfo;var c=this.renderer,d=c.minPixelIntensity,c=c.maxPixelIntensity,e=b.source||new y.HeatmapSource;e.intensities=a&&a.matrix||null;e.minPixelIntensity=d;e.maxPixelIntensity=c;e.gradient=this.gradient;b.source=e;this.container.addChild(b);this.requestUpdate()}};c.prototype.onTileError=function(a){console.error(a)};g([a.property({readOnly:!0,
dependsOn:["layer.renderer"]})],c.prototype,"gradient",null);return c=g([a.subclass("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],c)}(a.declared(n,c.default));d.default=h});