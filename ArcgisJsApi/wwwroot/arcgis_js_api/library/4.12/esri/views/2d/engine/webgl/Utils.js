// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/screenUtils ../../../../symbols/cim/enums ../../../webgl ./color ./enums ./SymbolProperties ../../support/mathUtils".split(" "),function(q,b,I,u,J,x,e,K,y,d,L,z){function n(a){for(var b={},c=0;c<a.length;c++){var f=a[c];b[f.name]=f.strideInBytes}return b}function E(a){switch(a){case d.WGLGeometryType.MARKER:return M;case d.WGLGeometryType.FILL:return N;case d.WGLGeometryType.LINE:return O;
case d.WGLGeometryType.TEXT:return P;case d.WGLGeometryType.LABEL:return Q}return null}function F(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function l(a){switch(a){case "esriSMS":return"simple-marker";case "esriPMS":return"picture-marker";case "esriSLS":return"simple-line";case "esriPLS":return"picture-line";case "esriSFS":return"simple-fill";case "esriPFS":return"picture-fill";case "esriTS":return"text"}return a}function G(a){return"string"===typeof a}function H(a){switch(a){case 5120:case 5121:return 1;
case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function R(a){var b={},c=function(h){var c=0;b[h]=a[h].map(function(a){var b=I({},a,{normalized:a.normalized||!1,divisor:a.divisor||0,offset:c,stride:0});c+=a.count*H(a.type);return b});b[h].forEach(function(a){return a.stride=c})},f;for(f in a)c(f);return b}Object.defineProperty(b,"__esModule",{value:!0});var v,p=J.getLogger("esri.views.2d.engine.webgl.Utils");b.C_HITTEST_SEARCH_SIZE=4;b.C_VBO_GEOMETRY="geometry";b.C_VBO_PERINSTANCE=
"per_instance";b.C_VBO_PERINSTANCE_VV="per_instance_vv";b.C_ICON_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:28,divisor:0}];b.C_FILL_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];b.C_FILL_VERTEX_DEF_DD=[{name:b.C_VBO_GEOMETRY,strideInBytes:12,divisor:0}];b.C_LINE_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];b.C_TEXT_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:24,divisor:0}];b.C_LABEL_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:28,divisor:0}];b.C_ICON_STRIDE_SPEC=
n(b.C_ICON_VERTEX_DEF);b.C_FILL_STRIDE_SPEC=n(b.C_FILL_VERTEX_DEF);b.C_FILL_STRIDE_SPEC_DD=n(b.C_FILL_VERTEX_DEF_DD);b.C_LINE_STRIDE_SPEC=n(b.C_LINE_VERTEX_DEF);b.C_TEXT_STRIDE_SPEC=n(b.C_TEXT_VERTEX_DEF);b.C_LABEL_STRIDE_SPEC=n(b.C_LABEL_VERTEX_DEF);b.getStrides=function(a,h){switch(a){case d.WGLGeometryType.MARKER:return b.C_ICON_STRIDE_SPEC;case d.WGLGeometryType.FILL:return h?b.C_FILL_STRIDE_SPEC_DD:b.C_FILL_STRIDE_SPEC;case d.WGLGeometryType.LINE:return b.C_LINE_STRIDE_SPEC;case d.WGLGeometryType.TEXT:return b.C_TEXT_STRIDE_SPEC;
case d.WGLGeometryType.LABEL:return b.C_LABEL_STRIDE_SPEC}return null};var M=[b.C_VBO_GEOMETRY],N=[b.C_VBO_GEOMETRY],O=[b.C_VBO_GEOMETRY],P=[b.C_VBO_GEOMETRY],Q=[b.C_VBO_GEOMETRY];b.getNamedBuffers=E;b.strideToPackingFactor=F;b.allocateTypedArrayBuffer=function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(Math.floor(a*b/4));case 1:case 3:return new Uint8Array(a*b)}};b.allocateTypedArrayBufferwithData=function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(a);case 1:case 3:return new Uint8Array(a)}};
b.normalizeSymbolType=l;b.isMarkerSymbol=function(a){if(a=l(a.type)){switch(a){case "simple-marker":case "picture-marker":return!0;case "CIMPointSymbol":return!0;case "CIMVectorMarker":case "CIMPictureMarker":case "CIMCharacterMarker":return!0}return!1}};b.isFillSymbol=function(a){if(a=l(a.type)){switch(a){case "simple-fill":case "picture-fill":return!0;case "CIMPolygonSymbol":return!0}return!1}};b.isLineSymbol=function(a){if(a=l(a.type)){switch(a){case "simple-line":case "picture-line":return!0;
case "CIMLineSymbol":return!0}return!1}};b.isPictureSymbol=function(a){if(a=l(a.type))switch(a){case "picture-marker":case "picture-line":case "picture-fill":return!0;case "CIMPictureMarker":return!0}return!1};b.isTextSymbol=function(a){if(a=l(a.type)){switch(a){case "text":return!0;case "CIMTextSymbol":return!0}return!1}};b.getTextProperties=function(a){return L.TextProperties.pool.acquire(a.color?y.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?y.copyAndPremultiply(a.haloColor):[255,
255,255,255],x.pt2px(a.haloSize),x.pt2px(a.font.size),a.angle*Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};b.isDefined=function(a){return null!=a};b.isNumber=function(a){return"number"===typeof a};b.isString=G;b.isStringOrNull=function(a){return null==a||G(a)};b.lerp=function(a,b,c){return a+(b-a)*c};q=function(){function a(){this._arr=[];this._push=
this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(b)};a.prototype.getKeys=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();b.KeysGetter=q;q=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(a)};a.prototype.getValues=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();b.ValuesGetter=q;b.getCapType=function(a,b){switch(a){case "butt":return e.CapType.BUTT;
case "round":return b?e.CapType.SQUARE:e.CapType.ROUND;case "square":return e.CapType.SQUARE;default:return p.error(new u("mapview-invalid-type","Cap type "+a+" is not a valid option. Defaulting to round")),e.CapType.ROUND}};b.getJoinType=function(a){switch(a){case "miter":return e.JoinType.MITER;case "bevel":return e.JoinType.BEVEL;case "round":return e.JoinType.ROUND;default:return p.error(new u("mapview-invalid-type","Join type "+a+" is not a valid option. Defaulting to round")),e.JoinType.ROUND}};
b.getVVType=function(a){switch(a){case "opacity":return d.VVType.OPACITY;case "color":return d.VVType.COLOR;case "rotation":return d.VVType.ROTATION;case "size":return d.VVType.SIZE;default:return p.error("Cannot interpret unknown vv: "+a),null}};b.getTransformParams=function(a){return{transform:a.transform,hasZ:a.hasZ,hasM:a.hasM}};b.copyMeshData=function(a,b,c,f,m,r,d){for(var h in r)for(var k=r[h].stride,e=F(k),S=r[h].data,A=c[h].data,n=k*m.vertexCount/e,g=k*a/e,e=k*m.vertexFrom/e,k=0;k<n;++k)A[k+
g]=S[k+e];c=m.indexCount;for(k=0;k<c;++k)f[k+b]=d[k+m.indexFrom]-m.vertexFrom+a};b.C_VBO_INFO=(v={},v[b.C_VBO_GEOMETRY]=35044,v);b.createGeometryData=function(a,b){for(var c=[],f=0;5>f;++f){for(var h={},r=0,d=E(f);r<d.length;r++){var e=d[r];h[e]={data:b(f,e)}}c.push({data:a(f),buffers:h})}return c};b.resampleHermite=function(a,b,c,f,d,e,n){void 0===n&&(n=!0);var h=b/d;c/=e;for(var k=Math.ceil(h/2),r=Math.ceil(c/2),m=0;m<e;m++)for(var l=0;l<d;l++){for(var p=4*(l+(n?e-m-1:m)*d),g=0,q=0,u=0,A=0,v=0,
w=0,x=0,y=(m+.5)*c,B=Math.floor(m*c);B<(m+1)*c;B++)for(var C=Math.abs(y-(B+.5))/r,z=(l+.5)*h,C=C*C,D=Math.floor(l*h);D<(l+1)*h;D++){var t=Math.abs(z-(D+.5))/k,g=Math.sqrt(C+t*t);-1<=g&&1>=g&&(g=2*g*g*g-3*g*g+1,0<g&&(t=4*(D+B*b),x+=g*a[t+3],u+=g,255>a[t+3]&&(g=g*a[t+3]/250),A+=g*a[t],v+=g*a[t+1],w+=g*a[t+2],q+=g))}f[p]=A/q;f[p+1]=v/q;f[p+2]=w/q;f[p+3]=x/u}};b.createTextureFromTexelData=function(a,b){var c,f;z.isPowerOfTwo(b.width)&&z.isPowerOfTwo(b.height)?(c=!0,f=9987):(c=!1,f=9729);return new K.Texture(a,
{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:c,samplingMode:f,wrapMode:33071,flipped:!0},b)};b.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,vertexTo:void 0,geometry:a}};b.getBytes=H;b.getPixelBytes=function(a){switch(a){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:p.error(new u("webgl-utils","Unable to handle type "+a))}};b.getPixelArrayCtor=function(a){switch(a){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;
default:p.error(new u("webgl-utils","Unable to handle type "+a))}};var w=new Map;b.createProgramDescriptor=function(a,b){if(!w.has(a)){var c=R(b),f={},d;for(d in c){var e=c[d];f[d]=e.length?e[0].stride:0}d={};for(var h in b)for(var e=0,l=b[h];e<l.length;e++){var k=l[e];d[k.name]=k.location}w.set(a,{strides:f,bufferLayouts:c,attributes:d})}return w.get(a)}});