// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Accessor ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators".split(" "),function(t,f,a,n,v,m,r){Object.defineProperty(f,"__esModule",{value:!0});t=function(k){function h(a){a=k.call(this)||this;a.tiles=new Map;a.layer=null;return a}a(h,k);h.prototype.destroy=
function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.tiles=null};Object.defineProperty(h.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!0,configurable:!0});h.prototype.acquireTile=function(a){var l=this,h=this.createTile(a);h.once("isReady",function(){return l.notifyChange("updating")});this.tiles.set(a.id,h);return h};h.prototype.forEachTile=function(a){this.tiles.forEach(a)};h.prototype.releaseTile=function(a){this.tiles.delete(a.key.id);this.disposeTile(a)};
h.prototype.isUpdating=function(){var a=!0;this.tiles.forEach(function(l){a=a&&l.isReady});return!a};h.prototype.invalidateLabels=function(){};h.prototype.requestUpdate=function(){this.layerView.requestUpdate()};n([r.property()],h.prototype,"layer",void 0);n([r.property()],h.prototype,"layerView",void 0);n([r.property()],h.prototype,"tileInfoView",void 0);n([r.property()],h.prototype,"updating",null);return h=n([r.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],h)}(r.declared(v,
m));f.default=t})},"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":function(){define(["require","exports","../../../../../../core/screenUtils","../../../../engine","../../../../../3d/layers/support/FastSymbolUpdates"],function(t,f,a,n,v){function m(l){return{value:l.value,size:a.toPt(l.size)}}function r(a){return a.map(function(a){return m(a)})}function k(l){return"string"===typeof l||"number"===typeof l?a.toPt(l):{type:"size",expression:l.expression,stops:r(l.stops)}}function h(a){var h=
{values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(n.Utils.isString(a.field))if(a.stops){if(8<a.stops.length)return null;var k=a.stops;for(a=0;8>a;++a){var l=k[Math.min(a,k.length-1)];h.values[a]=l.value;h.opacities[a]=l.opacity}}else return null;else if(a.stops&&0<=a.stops.length)for(k=a.stops&&0<=a.stops.length&&a.stops[0].opacity,a=0;8>a;a++)h.values[a]=Infinity,h.opacities[a]=k;else return null;return h}Object.defineProperty(f,"__esModule",{value:!0});var u=n.enums.WGLVVFlag;f.getVisualVariableSizeValueRepresentationRatio=
function(a,h){if(!a||!h)return a;switch(h){case "radius":case "distance":return 2*a;case "area":return Math.sqrt(a)}return a};f.stopToSizeStop=m;f.normalizeSizeStops=r;f.normalizeSizeElement=k;f.getVisualVariablesFields=function(a){var h=a&&0<a.length?{}:null;h&&a.forEach(function(a){var k=a.type;a.field&&(h[k]=a.field)});return h};f.convertVisualVariables=function(f){var m=f&&0<f.length?{}:null,l=m?{}:null;if(!m)return{vvFields:m,vvRanges:l};for(var q=0;q<f.length;q++){var g=f[q],d=g.type;g.field&&
(m[d]=g.field);if("size"===d){l.size||(l.size={});var p=g;switch(n.getTypeOfSizeVisualVariable(p)){case u.SIZE_MINMAX_VALUE:l.size.minMaxValue={minDataValue:p.minDataValue,maxDataValue:p.maxDataValue,minSize:k(p.minSize),maxSize:k(p.maxSize)};break;case u.SIZE_SCALE_STOPS:l.size.scaleStops={stops:r(p.stops)};break;case u.SIZE_FIELD_STOPS:for(var g=[],d=[],p=r(p.stops),z=p.length,y=0;6>y;y++){var C=p[Math.min(y,z-1)];g.push(C.value);d.push(a.pt2px(C.size))}l.size.fieldStops={values:g,sizes:d};break;
case u.SIZE_UNIT_VALUE:l.size.unitValue={unit:p.valueUnit,valueRepresentation:p.valueRepresentation}}}else if("color"===d)for(g=v.convertVisualVariables([g],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null}),l.color=g.color,y=0;32>y;y+=4)n.color.premultiplyAlpha(l.color.colors,y,!0);else"opacity"===d?l.opacity=h(g):"rotation"===d&&(l.rotation={type:g.rotationType})}return{vvFields:m,vvRanges:l}}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),
function(t,f,a,n,v,m,r,k,h,u,l,w){function x(b){return null!==b&&void 0!==b}function q(b){return"number"===typeof b}function g(b){return"string"===typeof b}function d(b,c){b&&b.push(c)}function p(b,c,e,a,g){var A=b.minSize,p=b.maxSize;if(b.expression)return d(g,"Could not convert size info: expression not supported"),!1;if(b.useSymbolValue)return b=a.symbolSize[e],c.minSize[e]=b,c.maxSize[e]=b,c.offset[e]=c.minSize[e],c.factor[e]=0,c.type[e]=1,!0;if(x(b.field)){if(x(b.stops)){if(2===b.stops.length&&
q(b.stops[0].size)&&q(b.stops[1].size))return z(b.stops[0].size,b.stops[1].size,b.stops[0].value,b.stops[1].value,c,e),c.type[e]=1,!0;d(g,"Could not convert size info: stops only supported with 2 elements");return!1}if(q(A)&&q(p)&&x(b.minDataValue)&&x(b.maxDataValue))return z(A,p,b.minDataValue,b.maxDataValue,c,e),c.type[e]=1,!0;if(null!=l.meterIn[b.valueUnit])return c.minSize[e]=-Infinity,c.maxSize[e]=Infinity,c.offset[e]=0,c.factor[e]=1/l.meterIn[b.valueUnit],c.type[e]=1,!0;if("unknown"===b.valueUnit)return d(g,
"Could not convert size info: proportional size not supported"),!1;d(g,"Could not convert size info: scale-dependent size not supported");return!1}if(!x(b.field)){if(b.stops&&b.stops[0]&&q(b.stops[0].size))return c.minSize[e]=b.stops[0].size,c.maxSize[e]=b.stops[0].size,c.offset[e]=c.minSize[e],c.factor[e]=0,c.type[e]=1,!0;if(q(A))return c.minSize[e]=A,c.maxSize[e]=A,c.offset[e]=A,c.factor[e]=0,c.type[e]=1,!0}d(g,"Could not convert size info: unsupported variant of sizeInfo");return!1}function z(b,
c,e,d,a,g){d=0<Math.abs(d-e)?(c-b)/(d-e):0;a.minSize[g]=0<d?b:c;a.maxSize[g]=0<d?c:b;a.offset[g]=b-e*d;a.factor[g]=d}function y(b,c,e,a){if(b.normalizationField||b.valueRepresentation)return d(a,"Could not convert size info: unsupported property"),null;var h=b.field;if(null!=h&&!g(h))return d(a,"Could not convert size info: field is not a string"),null;if(!c.size)c.size={field:b.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(b.field)if(!c.size.field)c.size.field=
b.field;else if(b.field!==c.size.field)return d(a,"Could not convert size info: multiple fields in use"),null;switch(b.axis){case "width":return(h=p(b,c.size,0,e,a))?c:null;case "height":return(h=p(b,c.size,2,e,a))?c:null;case "depth":return(h=p(b,c.size,1,e,a))?c:null;case "width-and-depth":return(h=p(b,c.size,0,e,a))&&p(b,c.size,1,e,a),h?c:null;case null:case void 0:case "all":return(h=(h=(h=p(b,c.size,0,e,a))&&p(b,c.size,1,e,a))&&p(b,c.size,2,e,a))?c:null;default:return d(a,'Could not convert size info: unknown axis "'+
b.axis+'""'),null}}function C(b,c,a){for(var e=0;3>e;++e){var g=c.unitInMeters;1===b.type[e]&&(g*=c.modelSize[e],b.type[e]=2);b.minSize[e]/=g;b.maxSize[e]/=g;b.offset[e]/=g;b.factor[e]/=g}if(0!==b.type[0])c=0;else if(0!==b.type[1])c=1;else if(0!==b.type[2])c=2;else return d(a,"No size axis contains a valid size or scale"),!1;for(e=0;3>e;++e)0===b.type[e]&&(b.minSize[e]=b.minSize[c],b.maxSize[e]=b.maxSize[c],b.offset[e]=b.offset[c],b.factor[e]=b.factor[c],b.type[e]=b.type[c]);return!0}function I(b,
c,e){b[4*c+0]=e.r/255;b[4*c+1]=e.g/255;b[4*c+2]=e.b/255;b[4*c+3]=e.a}function J(b,c,e){if(b.normalizationField)return d(e,"Could not convert color info: unsupported property"),null;if(g(b.field))if(b.stops){if(8<b.stops.length)return d(e,"Could not convert color info: too many color stops"),null;c.color={field:b.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};e=b.stops;for(b=0;8>b;++b){var a=e[Math.min(b,e.length-1)];c.color.values[b]=a.value;
I(c.color.colors,b,a.color)}}else return d(e,"Could not convert color info: missing stops or colors"),null;else if(b.stops&&0<=b.stops.length)for(e=b.stops&&0<=b.stops.length&&b.stops[0].color,c.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},b=0;8>b;b++)c.color.values[b]=Infinity,I(c.color.colors,b,e);else return d(e,"Could not convert color info: no field and no colors/stops"),null;return c}function K(b,c,e){if(b.normalizationField)return d(e,
"Could not convert opacity info: unsupported property"),null;if(g(b.field))if(b.stops){if(8<b.stops.length)return d(e,"Could not convert opacity info: too many opacity stops"),null;c.opacity={field:b.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};e=b.stops;for(b=0;8>b;++b){var a=e[Math.min(b,e.length-1)];c.opacity.values[b]=a.value;c.opacity.opacityValues[b]=a.opacity}}else return d(e,"Could not convert opacity info: missing stops or opacities"),null;else if(b.stops&&0<=b.stops.length)for(e=
b.stops&&0<=b.stops.length&&b.stops[0].opacity,c.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},b=0;8>b;b++)c.opacity.values[b]=Infinity,c.opacity.opacityValues[b]=e;else return d(e,"Could not convert opacity info: no field and no opacities/stops"),null;return c}function E(b,c,e,a){b=2===e&&"arithmetic"===b.rotationType;c.offset[e]=b?90:0;c.factor[e]=b?-1:1;c.type[e]=1}function L(b,c,e){if(!g(b.field))return d(e,"Could not convert rotation info: field is not a string"),
null;if(!c.rotation)c.rotation={field:b.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(b.field)if(!c.rotation.field)c.rotation.field=b.field;else if(b.field!==c.rotation.field)return d(e,"Could not convert rotation info: multiple fields in use"),null;switch(b.axis){case "tilt":return E(b,c.rotation,0,e),c;case "roll":return E(b,c.rotation,1,e),c;case null:case void 0:case "heading":return E(b,c.rotation,2,e),c;default:return d(e,'Could not convert rotation info: unknown axis "'+b.axis+
'""'),null}}function F(b,c,e){if(!b)return null;var g=!c.supportedTypes||!!c.supportedTypes.size,h=!c.supportedTypes||!!c.supportedTypes.color,p=!c.supportedTypes||!!c.supportedTypes.rotation,k=!!c.supportedTypes&&!!c.supportedTypes.opacity,f=b.reduce(function(b,f){if(!b)return b;if(f.valueExpression)return d(e,"Could not convert visual variables: arcade expressions not supported"),null;switch(f.type){case "size":return g?y(f,b,c,e):b;case "color":return h?J(f,b,e):b;case "opacity":return k?K(f,b,
e):b;case "rotation":return p?L(f,b,e):b;default:return a.neverReached(f),null}},{size:null,color:null,opacity:null,rotation:null});return 0<b.length&&f&&!f.size&&!f.color&&!f.opacity&&!f.rotation||f&&f.size&&!C(f.size,c,e)?null:f}function G(b,c,e){if(!!b!==!!c||b&&b.field!==c.field)return!1;if(b&&"rotation"===e)for(e=0;3>e;e++)if(b.type[e]!==c.type[e]||b.offset[e]!==c.offset[e]||b.factor[e]!==c.factor[e])return!1;return!0}function H(b,c){var e={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,
vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},a=b&&null!=b.size;b&&b.size?(e.vvSizeEnabled=!0,e.vvSizeMinSize=b.size.minSize,e.vvSizeMaxSize=b.size.maxSize,e.vvSizeOffset=b.size.offset,e.vvSizeFactor=b.size.factor):b&&a&&(e.vvSizeValue=c.transformation.scale);if(b&&a){e.vvSymbolAnchor=c.transformation.anchor;e.vvSymbolRotationMatrix=
m.mat3f64.create();r.mat4.identity(B);var d=c.transformation.rotation[2],a=c.transformation.rotation[0],g=c.transformation.rotation[1];c=B;void 0===c&&(c=k.mat4f64.create());d=d||0;a=a||0;g=g||0;0!==d&&r.mat4.rotateZ(c,c,-d/180*Math.PI);0!==a&&r.mat4.rotateX(c,c,a/180*Math.PI);0!==g&&r.mat4.rotateY(c,c,g/180*Math.PI);v.mat3.fromMat4(e.vvSymbolRotationMatrix,B)}b&&b.color&&(e.vvColorEnabled=!0,e.vvColorValues=b.color.values,e.vvColorColors=b.color.colors);b&&b.opacity&&(e.vvOpacityEnabled=!0,e.vvOpacityValues=
b.opacity.values,e.vvOpacityOpacities=b.opacity.opacityValues);return e}Object.defineProperty(f,"__esModule",{value:!0});f.convertVisualVariables=F;f.initFastSymbolUpdatesState=function(b,c){return!b||w.DISABLE_FAST_UPDATES?{enabled:!1}:(b=F(b.visualVariables,c))?{enabled:!0,visualVariables:b,materialParameters:H(b,c),requiresShaderTransformation:b&&null!=b.size}:{enabled:!1}};f.updateFastSymbolUpdatesState=function(b,c,a){if(!c||!b.enabled)return!1;var e=b.visualVariables;c=F(c.visualVariables,a);
if(!(c&&G(e.size,c.size,"size")&&G(e.color,c.color,"color")&&G(e.rotation,c.rotation,"rotation")))return!1;b.visualVariables=c;b.materialParameters=H(c,a);b.requiresShaderTransformation=c&&null!=c.size;return!0};f.getMaterialParams=H;var D;(function(b){var c=k.mat4f64.create(),a=u.vec3f64.create();b.evaluateModelTransform=function(b,e,d){if(!b.vvSizeEnabled)return d;r.mat4.copy(c,d);d=b.vvSymbolRotationMatrix;r.mat4.set(B,d[0],d[1],d[2],0,d[3],d[4],d[5],0,d[6],d[7],d[8],0,0,0,0,1);r.mat4.multiply(c,
c,B);for(d=0;3>d;++d)a[d]=n.clamp(b.vvSizeOffset[d]+e[0]*b.vvSizeFactor[d],b.vvSizeMinSize[d],b.vvSizeMaxSize[d]);r.mat4.scale(c,c,a);r.mat4.translate(c,c,b.vvSymbolAnchor);return c};b.evaluateModelTransformScale=function(b,c,a){if(!c.vvSizeEnabled)return h.vec3.set(b,1,1,1);for(var d=0;3>d;++d)b[d]=n.clamp(c.vvSizeOffset[d]+a[0]*c.vvSizeFactor[d],c.vvSizeMinSize[d],c.vvSizeMaxSize[d]);return b}})(D||(D={}));var B=k.mat4f64.create();f.evaluateModelTransform=D.evaluateModelTransform;f.evaluateModelTransformScale=
D.evaluateModelTransformScale})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(t,f,a){Object.defineProperty(f,"__esModule",{value:!0});f.mat3f64=a})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require","exports"],function(t,f){Object.defineProperty(f,"__esModule",{value:!0});f.create=function(){return[1,0,0,0,1,0,0,0,1]};f.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]};f.fromValues=function(a,
f,t,m,r,k,h,u,l){return[a,f,t,m,r,k,h,u,l]};f.createView=function(a,f){return new Float64Array(a,f,9)}})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(t,f,a){Object.defineProperty(f,"__esModule",{value:!0});f.mat4f64=a})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(t,f){Object.defineProperty(f,"__esModule",{value:!0});f.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};f.clone=
function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]};f.fromValues=function(a,f,t,m,r,k,h,u,l,w,x,q,g,d,p,z){return[a,f,t,m,r,k,h,u,l,w,x,q,g,d,p,z]};f.createView=function(a,f){return new Float64Array(a,f,16)}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(t,
f,a,n,v,m){return new (function(f){function k(){var a=null!==f&&f.apply(this,arguments)||this;a.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;a.SCENEVIEW_LOCKING_LOG=!1;a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;a.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;a.DECONFLICTOR_SHOW_OUTLINES=!1;a.DECONFLICTOR_SHOW_GRID=!1;a.LABELS_SHOW_BORDER=!1;a.OVERLAY_DRAW_TEST_TEXTURE=!1;a.OVERLAY_SHOW_CENTER=!1;a.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1;a.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=
!1;a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;a.DRAW_MESH_GEOMETRY_NORMALS=!1;a.FEATURE_TILE_FETCH_SHOW_TILES=!1;a.FEATURE_TILE_TREE_SHOW_TILES=!1;a.ENABLE_PROFILE_DEPTH_RANGE=!1;a.DISABLE_FAST_UPDATES=!1;a.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;a.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;return a}a(k,f);n([m.property()],k.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);n([m.property()],k.prototype,"SCENEVIEW_LOCKING_LOG",void 0);n([m.property()],k.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",
void 0);n([m.property()],k.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);n([m.property()],k.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);n([m.property()],k.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);n([m.property()],k.prototype,"DECONFLICTOR_SHOW_GRID",void 0);n([m.property()],k.prototype,"LABELS_SHOW_BORDER",void 0);n([m.property()],k.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);n([m.property()],k.prototype,"OVERLAY_SHOW_CENTER",void 0);n([m.property()],k.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",
void 0);n([m.property()],k.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);n([m.property()],k.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);n([m.property()],k.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);n([m.property()],k.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);n([m.property()],k.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);n([m.property()],k.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);n([m.property()],k.prototype,"DISABLE_FAST_UPDATES",void 0);n([m.property()],
k.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);n([m.property()],k.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);return k=n([m.subclass("esri.views.3d.support.DebugFlags")],k)}(m.declared(v)))})},"esri/views/2d/layers/features/tileRenderers/support/WGLFeatureView":function(){define("require exports ../../../../../../core/tsSupport/assignHelper ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/maybe ../../../../../../core/promiseUtils ../../../../../../core/promiseUtils ../../../../../../geometry/Point ../../../../engine".split(" "),
function(t,f,a,n,v,m,r,k,h,u,l){Object.defineProperty(f,"__esModule",{value:!0});var w=l.enums.WGLDrawPhase;t=function(f){function q(a){var d=f.call(this)||this;d._rendererInfo=new l.WGLRendererInfo;d._pointToCallbacks=new Map;d._displayWidth=0;d._displayHeight=0;d.layer=null;d.tileInfoView=a.tileInfoView;d.layer=a.layer;d._layerView=a.layerView;d.attributeView=new l.AttributeStoreView;return d}n(q,f);q.prototype.dispose=function(){this.removeAllChildren();for(var a=0,d=this.children;a<d.length;a++)d[a].dispose();
this.attributeView.destroy()};q.prototype.disposeWebGLResources=function(){for(var a=0,d=this.children;a<d.length;a++)d[a].clear()};q.prototype.displayWidth=function(){return this._displayWidth};Object.defineProperty(q.prototype,"displayHeight",{get:function(){return this._displayHeight},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"visualVariablesInfo",{get:function(){return this._visualVariablesInfo},set:function(a){this._visualVariablesInfo=a;this.requestRender()},enumerable:!0,
configurable:!0});q.prototype.hitTest=function(a,d){var g=this,f=[a,d];return k.create(function(a,d){g._pointToCallbacks.set(f,{resolve:a,reject:d});g.requestRender()},function(){g._pointToCallbacks.has(f)&&g._pointToCallbacks.delete(f)})};q.prototype.whenAttached=function(){var a=this;return this.attached?k.resolve():k.create(function(d){return a.once("attached",function(){return d()})})};q.prototype.getMaterialItems=function(a){var d=this;return this.whenAttached().then(function(){if(d.stage&&a&&
0!==a.length){for(var g=[],f=d.stage.painter.textureManager,k=0;k<a.length;k++){var l=a[k];g.push(f.rasterizeItem(l.symbol,l.glyphIds))}return h.all(g).then(function(d){return d.map(function(d,g){return{id:a[g].id,mosaicItem:d}})})}})};q.prototype.onTileData=function(g,d){return m(this,void 0,void 0,function(){var f,k,h,m;return v(this,function(p){switch(p.label){case 0:return f=!(!this.layer.labelingInfo||!this.layer.labelingInfo.length),k=d.addOrUpdate&&l.TileData.decode(d.addOrUpdate),h=a({},d,
{addOrUpdate:k}),[4,this._layerView.getLocalIdsToHighlight()];case 1:return m=p.sent(),g.setData(h,f,this.layer.labelsVisible),g.buildHLList(m),this.contains(g)||this.addChild(g),this.requestRender(),this._layerView&&this._layerView.view.labelManager.requestUpdate(),[2]}})})};q.prototype.onTileError=function(a){a.clear();this.contains(a)||this.addChild(a);this.requestRender()};q.prototype.addChild=function(a){var d=f.prototype.addChild.call(this,a);this.layer.labelingInfo&&this._layerView&&this._layerView.view.labelManager.addTile(this._layerView,
a);this._buildHLList();return d};q.prototype.removeChild=function(a){var d=f.prototype.removeChild.call(this,a);this.layer.labelingInfo&&this._layerView&&this._layerView.view.labelManager.removeTile(this._layerView,a.key.id);this._buildHLList();return d};q.prototype.renderChildren=function(g){var d=this,f=g.state,k=this.stage.painter,h=this._visualVariablesInfo&&this._visualVariablesInfo.vvRanges;this._updateTilesTransform(f,this.tileInfoView.getClosestInfoForScale(f.scale).level);this._rendererInfo.update(f,
this.layer.renderer,h,this._layerView.effects);this.attributeView.update(this.stage.context);this.attributeView.bindTextures(this.stage.context);var h=this.tileInfoView.getClosestInfoForScale(f.scale).level,f=this.tileInfoView.tileInfo.scaleToZoom(f.scale),l=a({},g,{rendererInfo:this._rendererInfo,requiredLevel:h,displayLevel:f,context:this.stage.context,painter:this.stage.painter,attributeView:this.attributeView});this.sortChildren(function(a,d){return 0!==a.key.level-d.key.level?a.key.level-d.key.level:
0!==a.key.row-d.key.row?a.key.row-d.key.row:a.key.col-d.key.col});g=l.drawPhase;if(g&(w.LABEL|w.LABEL_ALPHA)){f=this.layer;if(!(f.labelsVisible&&f.labelingInfo&&0<f.labelingInfo.length))return;this._updateTilesTransform(l.state,l.requiredLevel)}k.draw(l,this.children,g,this._painterOptions);this._layerView.hasHighlight()&&k.highlight(l,this.children);this._pointToCallbacks.forEach(function(a,f){a.resolve(d._hitTest(l,f[0],f[1]))});this._pointToCallbacks.clear();this._layerView.effects&&this._layerView.effects.some(function(a){return r.isSome(a)&&
!a.done})&&this.requestRender()};q.prototype.updateHighlight=function(){this._buildHLList()};q.prototype._hitTest=function(a,d,f){var g=this.stage,h=g.painter,g=g.context,k=a.requiredLevel,p=[0,0];a.state.toMap(p,[d,f]);d=a.state.clone();f=d.viewpoint.clone();f.targetGeometry=new u(p[0],p[1],a.state.spatialReference);d.viewpoint=f;d.size=[l.Utils.C_HITTEST_SEARCH_SIZE,l.Utils.C_HITTEST_SEARCH_SIZE];this._updateTilesTransform(d,k);return h.hitTest({globalOpacity:1,painter:h,context:g,drawPhase:w.HITTEST,
pixelRatio:a.pixelRatio,displayLevel:a.displayLevel,rendererInfo:this._rendererInfo,requiredLevel:k,state:d,stationary:a.stationary,attributeView:this.attributeView},this.children)};q.prototype._updateTilesTransform=function(a,d){d=0;for(var f=this.children;d<f.length;d++){var g=f[d],h=this.tileInfoView.tileInfo.lods[g.key.level].resolution;g.setTransform(a,h/(a.resolution*a.pixelRatio));g.setLabelTransform(a,h)}};q.prototype._buildHLList=function(){return m(this,void 0,void 0,function(){var a,d,
f,h;return v(this,function(g){switch(g.label){case 0:return[4,this._layerView.getLocalIdsToHighlight()];case 1:a=g.sent();d=0;for(f=this.children;d<f.length;d++)h=f[d],h.buildHLList(a);return[2]}})})};return q}(l.Container);f.WGLFeatureView=t})},"*noref":1}});
define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/Accessor ../../../../../core/accessorSupport/decorators ../../../../../geometry/support/aaBoundingRect ../../../engine ../support/rendererUtils ./BaseTileRenderer ./support/visualVariablesUtils ./support/WGLFeatureView".split(" "),function(t,f,a,n,v,m,r,k,h,u,l,w,x){Object.defineProperty(f,"__esModule",{value:!0});t=
function(f){function g(a){return f.call(this)||this}a(g,f);g.prototype.install=function(a){var d=new x.WGLFeatureView({tileInfoView:this.tileInfoView,layer:this.layer,layerView:this.layerView});this.featuresView=d;a.addChild(d)};g.prototype.uninstall=function(a){a.removeChild(this.featuresView);this.featuresView.dispose();this.featuresView=null};g.prototype.updateHighlight=function(){this.featuresView.updateHighlight()};g.prototype.hitTest=function(a,f){return this.featuresView.hitTest(a,f)};g.prototype.supportsRenderer=
function(a){return null!=a&&-1!==["simple","class-breaks","unique-value","dot-density","dictionary"].indexOf(a.type)};g.prototype.clear=function(){this.featuresView.disposeWebGLResources()};g.prototype.onConfigUpdate=function(){if("visualVariables"in this.layer.renderer){var a=(u.simplifyVVRenderer(this.layer.renderer).visualVariables||[]).map(function(a){var d=a.clone();"normalizationField"in a&&(d.normalizationField=null);a.valueExpression&&"$view.scale"!==a.valueExpression&&(d.valueExpression=
null,d.field="nop");return d});this.featuresView.visualVariablesInfo=w.convertVisualVariables(a)}};g.prototype.onTileData=function(a){var d=this.tiles.get(a.tileKey);if(d)this.featuresView.onTileData(d,a.data)};g.prototype.onTileError=function(a){if(a=this.tiles.get(a.tileKey))this.featuresView.onTileError(a)};g.prototype.getMaterialItems=function(a){return this.featuresView.getMaterialItems(a)};g.prototype.invalidateLabels=function(){this.layer.labelingInfo&&this.layer.labelsVisible&&(this.tiles.forEach(function(a){return a.isDirty=
!0}),this.layerView.view.labelManager.requestUpdate())};g.prototype.createTile=function(a){var d=k.create();this.tileInfoView.getTileBounds(d,a);return new h.WGLTile(a,d)};g.prototype.disposeTile=function(a){this.featuresView.removeChild(a)};return g=n([r.subclass("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],g)}(r.declared(m,l.default));f.default=t});