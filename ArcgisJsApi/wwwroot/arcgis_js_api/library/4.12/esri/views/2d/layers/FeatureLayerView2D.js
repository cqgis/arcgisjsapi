// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/renderers/support/clickToleranceUtils":function(){define(["require","exports"],function(G,b){function n(b,e){return e&&e.xoffset?Math.max(b,Math.abs(e.xoffset)):e&&e.yoffset?Math.max(b,Math.abs(e.yoffset)):b}function e(b,e){if("number"===typeof b)return b;if(b&&b.stops&&b.stops.length){b=b.stops;for(var p=e=0,c=0;c<b.length;c++){var u=b[c].size;"number"===typeof u&&(e+=u,p++)}return e/p}return e}function h(b,n){if(!n)return b;n=n.filter(function(c){return"size"===c.type}).map(function(c){var v=
c.minSize;return(e(c.maxSize,b)+e(v,b))/2});for(var p=0,c=n.length,u=0;u<c;u++)p+=n[u];return Math.max(Math.floor(p/c),b)}Object.defineProperty(b,"__esModule",{value:!0});b.calculateTolerance=function(b){if(!b)return 6;var e="visualVariables"in b?h(6,b.visualVariables):6;if("simple"===b.type)return n(e,b.symbol);if("unique-value"===b.type){var p=e;b.uniqueValueInfos.forEach(function(c){p=n(p,c.symbol)});return p}if("class-breaks"===b.type){var c=e;b.classBreakInfos.forEach(function(b){c=n(c,b.symbol)});
return c}return e}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/LayerView".split(" "),function(G,b,n,e,h,m,q){return function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c.attached=!1;c.lastUpdateId=-1;c.moving=!1;c.updateRequested=!1;return c}n(c,b);c.prototype.initialize=function(){var c=this;
this.when(function(){c.requestUpdate()});var b=function(){return c.notifyChange("rendering")};this.handles.add([h.init(this,"suspended",function(b){c.container&&(c.container.visible=!b);c.view&&!b&&c.updateRequested&&c.view.requestLayerViewUpdate(c)},!0),h.init(this,"fullOpacity",function(b){c.container&&(c.container.opacity=b)},!0),h.on(this,"container","post-render",b),h.on(this,"container","will-render",b)])};c.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");
this.updateRequested=!1;this.layer=null};Object.defineProperty(c.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});c.prototype.isVisibleAtScale=function(c){var b=!0,e=this.layer,p=e.minScale,e=e.maxScale;
if(null!=p&&null!=e){var b=!p,m=!e;!b&&c<=p&&(b=!0);!m&&c>=e&&(m=!0);b=b&&m}return b};c.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};c.prototype.processUpdate=function(c){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",c),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(c)))};c.prototype.isUpdating=function(){return!1};c.prototype.isRendering=
function(){return!1};c.prototype.canResume=function(){var c=this.inherited(arguments);c&&(c=this.isVisibleAtScale(this.view.scale));return c};e([m.property()],c.prototype,"attached",void 0);e([m.property()],c.prototype,"container",void 0);e([m.property()],c.prototype,"moving",void 0);e([m.property({dependsOn:["attached","suspended","moving"]})],c.prototype,"rendering",null);e([m.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],c.prototype,"suspended",void 0);e([m.property({readOnly:!0})],
c.prototype,"updateParameters",void 0);e([m.property()],c.prototype,"updateRequested",void 0);e([m.property({dependsOn:["updateRequested","attached"]})],c.prototype,"updating",null);e([m.property()],c.prototype,"view",void 0);return c=e([m.subclass("esri.views.2d.layers.LayerView2D")],c)}(m.declared(q))})},"esri/views/2d/layers/features/tileRenderers":function(){define(["require","exports","../../../../core/nextTick","../../../../core/promiseUtils"],function(G,b,n,e){Object.defineProperty(b,"__esModule",
{value:!0});b.createOrReuseTileRenderer=function(b,m,q){if(!m)return e.resolve(null);switch(m.type){case "class-breaks":case "simple":case "unique-value":case "dot-density":case "dictionary":return e.create(function(b){n(function(){return G(["./tileRenderers/SymbolTileRenderer"],b)})}).then(function(b){return b.default}).then(function(b){return new b(q)});case "heatmap":return e.create(function(b){n(function(){return G(["./tileRenderers/HeatmapTileRenderer"],b)})}).then(function(b){return b.default}).then(function(b){return new b(q)})}return e.resolve(null)}})},
"esri/views/2d/layers/features/support/rendererUtils":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/screenUtils","../../../engine"],function(G,b,n,e,h){Object.defineProperty(b,"__esModule",{value:!0});var m=h.definitions.WEBGL_MAX_INNER_STOPS,q=h.definitions.WEBGL_MAX_STOPS,p=n.getLogger("esri.renderers.visualVariables.support.utils");b.simplifyVVRenderer=function(c){if(!("visualVariables"in c&&c.visualVariables&&c.visualVariables.length))return c;c=c.clone();
var b=c.visualVariables.map(function(c){if(("size"===c.type||"color"===c.type||"opacity"===c.type)&&null!=c.stops){var b;var n=c.type;b=c.stops;if(!(b.length<=q))if(p.warn("Found "+b.length+" Visual Variable stops, but MapView only supports "+q+". Displayed stops will be simplified."),b.length>2*q){for(var u=b[0],r=b.slice(1),z=r.pop(),A=r[0].value,I=r[r.length-1].value,g=(I-A)/m,a=[];A<I;A+=g){for(var y=0;A>=r[y].value;)y++;var h=r[y],t=b[y-1],H=A-t.value,h=h.value===t.value?1:H/(h.value-t.value);
"color"===n?(t=r[y],y=b[y-1],H=t.color.clone(),H.r=(1-h)*y.color.r+h*H.r,H.g=(1-h)*y.color.g+h*H.g,H.b=(1-h)*y.color.b+h*H.b,H.a=(1-h)*y.color.a+h*H.a,a.push({value:A,color:H,label:t.label})):"size"===n?(t=r[y],H=b[y-1],y=e.toPt(t.size),H=e.toPt(H.size),a.push({value:A,size:(1-h)*H+h*y,label:t.label})):(t=r[y],a.push({value:A,opacity:(1-h)*b[y-1].opacity+h*t.opacity,label:t.label}))}b=[u].concat(a,[z])}else{n=b[0];b=b.slice(1);for(u=b.pop();b.length>m;){z=r=0;for(I=1;I<b.length;I++)g=Math.abs(b[I].value-
b[I-1].value),g>z&&(z=g,r=I);b.splice(r,1)}b=[n].concat(b,[u])}c.stops=b}return c});c.visualVariables=b;return c}})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Accessor ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/requireUtils ../../../../core/workers ../../../../core/accessorSupport/decorators module".split(" "),
function(G,b,n,e,h,m,q,p,c,u,r,v,x,C){Object.defineProperty(b,"__esModule",{value:!0});h=function(c){function b(b){return c.call(this,b)||this}n(b,c);b.prototype.initialize=function(){this._controller=u.createAbortController();this.addResolvingPromise(this._startWorker(this._controller.signal))};b.prototype.destroy=function(){this._connection.close();this._controller.abort()};Object.defineProperty(b.prototype,"tileRenderer",{set:function(c){this.client.tileRenderer=c},enumerable:!0,configurable:!0});
b.prototype.startup=function(c,b,g){var a=this._controller.signal,a=Array.isArray(g.source)?{transferList:g.source,signal:a}:void 0;c=c.tileInfo.toJSON();return this._connection.invoke("startup",{service:g,config:b,tileInfo:c},a)};b.prototype.update=function(c,b){return this._connection.invoke("update",{config:c,options:b})};b.prototype.refresh=function(){return this._connection.invoke("controller.refresh")};b.prototype.redraw=function(){return this._connection.invoke("controller.redraw")};b.prototype.setViewState=
function(c){return this._connection.invoke("setViewState",c.toJSON())};b.prototype.queryFeatures=function(c,b){return this._connection.invoke("controller.queryFeatures",c.toJSON(),b)};b.prototype.queryObjectIds=function(c,b){return this._connection.invoke("controller.queryObjectIds",c.toJSON(),b)};b.prototype.queryFeatureCount=function(c,b){return this._connection.invoke("controller.queryFeatureCount",c.toJSON(),b)};b.prototype.queryExtent=function(c,b){return this._connection.invoke("controller.queryExtent",
c.toJSON(),b)};b.prototype.queryLatestObservations=function(c,b){return this._connection.invoke("controller.queryLatestObservations",c.toJSON(),b)};b.prototype.getObjectId=function(c){return this._connection.invoke("controller.getObjectId",c)};b.prototype.getLocalId=function(c){return this._connection.invoke("controller.getLocalId",c)};b.prototype.mapValidLocalIds=function(c){return this._connection.invoke("controller.mapValidLocalIds",c)};b.prototype.onEdits=function(c){return this._connection.invoke("controller.onEdits",
{addedFeatures:c.addedFeatures,deletedFeatures:c.deletedFeatures,updatedFeatures:c.updatedFeatures})};b.prototype.enableEvent=function(c,b){return this._connection.invoke("controller.enableEvent",{name:c,value:b})};b.prototype._startWorker=function(c){return q(this,void 0,void 0,function(){var b,g;return m(this,function(a){switch(a.label){case 0:return b=r.getAbsMid("../features/Pipeline",G,C),[4,v.open(b,{client:this.client,strategy:"dedicated",signal:c})];case 1:return this._connection=g=a.sent(),
[2]}})})};e([x.property()],b.prototype,"client",void 0);e([x.property()],b.prototype,"tileRenderer",null);return b=e([x.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],b)}(x.declared(p,c));b.default=h})},"esri/views/2d/layers/support/popupUtils2D":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../../core/tsSupport/decorateHelper","../../../../geometry/Extent"],function(G,b,n,e,h){Object.defineProperty(b,"__esModule",{value:!0});b.createQueryGeometry=
function(b,e,p){var c=p.get("state.resolution"),c=e*("number"===typeof c?c:1);e=b.clone().offset(-c,-c);b=b.clone().offset(c,c);return new h({xmin:Math.min(e.x,b.x),ymin:Math.min(e.y,b.y),xmax:Math.max(e.x,b.x),ymax:Math.max(e.y,b.y),spatialReference:p.spatialReference})}})},"esri/views/2d/layers/support/util":function(){define(["require","exports","../../../../core/jsonMap"],function(G,b,n){Object.defineProperty(b,"__esModule",{value:!0});var e=new n.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",
esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});b.toJSONGeometryType=function(b){return e.toJSON(b)}})},"esri/views/layers/FeatureLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper @dojo/framework/shim/array @dojo/framework/shim/Set ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/support/fieldUtils ../../layers/support/timeUtils ../../support/arcadeOnDemand ../../tasks/support/Query ./RefreshableLayerView ./support/FeatureEffect ./support/FeatureFilter ./support/popupUtils".split(" "),
function(G,b,n,e,h,m,q,p,c,u,r,v,x,C,L,z,A,I,g,a,y,ha,t){var H=r.getLogger("esri.views.layers.FeatureLayerView");return function(a){function b(b){b=a.call(this,b)||this;b.effect=null;b.filter=null;b.layer=null;b.requiredFields=null;b.view=null;return b}n(b,a);b.prototype.initialize=function(){var a=this;C.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo filter effect layer.timeInfo timeExtent".split(" "),function(){return a._updateRequiredFields()})};Object.defineProperty(b.prototype,
"availableFields",{get:function(){var a=this.layer,b=this.layer.fields,c=this.requiredFields;return"outFields"in a&&a.outFields?z.fixFields(b,z.unpackFieldNames(b,a.outFields).concat(c)):z.fixFields(b,c)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(a){H.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumNumberOfFeaturesExceeded",
{get:function(){return!1},enumerable:!0,configurable:!0});b.prototype.highlight=function(a,b){void 0===b&&(b={});return this.inherited(arguments)};b.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},a=v.isSome(this.filter)?this.filter.createQuery(a):new g(a);this.timeExtent&&(a.timeExtent=a.timeExtent?a.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return a};b.prototype.queryFeatures=function(a,b){return this.inherited(arguments)};
b.prototype.queryObjectIds=function(a,b){return this.inherited(arguments)};b.prototype.queryFeatureCount=function(a,b){return this.inherited(arguments)};b.prototype.queryExtent=function(a,b){return this.inherited(arguments)};b.prototype._updateRequiredFields=function(){return q(this,void 0,void 0,function(){var a,b,g,e,n,u,r,y,h,A,q,C,t;return m(this,function(m){switch(m.label){case 0:if(!this.layer||!this.view)return[2];a="3d"===this.view.type;b=this;e=g=b.layer;n=e.fields;u=e.objectIdField;r=e.renderer;
y=new c.default;return[4,x.eachAlways([r?r.collectRequiredFields(y,n):null,z.collectLabelingFields(y,g),a?z.collectElevationFields(y,g):null,v.isSome(this.filter)?z.collectFilterFields(y,g,this.filter):null,this.effect?z.collectFilterFields(y,g,this.effect.filter):null])];case 1:h=m.sent();g.timeInfo&&this.timeExtent&&z.collectFields(y,g.fields,[g.timeInfo.startField,g.timeInfo.endField]);A=0;for(q=h;A<q.length;A++)C=q[A],C.error&&H.error(C.error);z.collectField(y,n,u);t=p.from(y).sort();this._set("requiredFields",
t);return[2]}})})};b.prototype.validateFetchPopupFeatures=function(a){var b=this.layer;if(!this.layer.popupEnabled)return new u("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:b});if(!t.getFetchPopupTemplate(this.layer,a))return new u("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:b})};b.prototype.fetchClientPopupFeatures=function(a){return q(this,void 0,void 0,function(){var b,c,g,e,p,n,y,u,r,h,A,q;return m(this,function(m){switch(m.label){case 0:b=
v.isSome(a)?a.clientGraphics:null;if(!b||0===b.length)return[2,x.resolve([])];c=[];g=[];e=this.layer;p=t.getFetchPopupTemplate(e,a);return v.isSome(p)?[4,I.loadArcade()]:[2,x.resolve([])];case 1:return n=m.sent().arcadeUtils,y=n.hasGeometryOperations(p),[4,this.createPopupQuery(a)];case 2:u=m.sent();r=z.unpackFieldNames(e.fields,u.outFields);h=0;for(A=b;h<A.length;h++)q=A[h],y||!z.featureHasFields(r,q)?g.push(q):c.push(q);if(0===g.length)return[2,x.resolve(c)];u.objectIds=g.map(function(a){return a.attributes[e.objectIdField]});
return[2,e.queryFeatures(u).then(function(a){return c.concat(a.features)}).catch(function(){return g})]}})})};b.prototype.createPopupQuery=function(a){return q(this,void 0,void 0,function(){var b,c,g;return m(this,function(e){switch(e.label){case 0:return b=this.layer,c=b.createQuery(),c.returnGeometry=!0,c.returnZ=!0,c.returnM=!0,g=c,[4,t.getRequiredFields(this.layer,t.getFetchPopupTemplate(this.layer,a))];case 1:return g.outFields=e.sent(),c.outSpatialReference=this.view.spatialReference,[2,c]}})})};
e([L.property({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],b.prototype,"availableFields",null);e([L.property({type:y})],b.prototype,"effect",void 0);e([L.property({type:ha})],b.prototype,"filter",void 0);e([L.property(A.combinedViewLayerTimeExtentProperty)],b.prototype,"timeExtent",void 0);e([L.property()],b.prototype,"layer",void 0);e([L.property({type:Number})],b.prototype,"maximumNumberOfFeatures",null);e([L.property({readOnly:!0,type:Boolean})],b.prototype,"maximumNumberOfFeaturesExceeded",
null);e([L.property({readOnly:!0})],b.prototype,"requiredFields",void 0);e([L.property()],b.prototype,"view",void 0);return b=e([L.subclass("esri.views.layers.FeatureLayerView")],b)}(L.declared(a))})},"esri/views/layers/RefreshableLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators".split(" "),
function(G,b,n,e,h,m,q,p,c){return function(b){function r(){var c=null!==b&&b.apply(this,arguments)||this;c.refreshTimestamp=null;c.refreshDebounced=p.debounce(function(b,e){return m(c,void 0,void 0,function(){var c;return h(this,function(z){switch(z.label){case 0:return"number"===typeof b?c=b:(c=Date.now(),e=b),this._set("refreshTimestamp",c),this.doRefresh?[4,this.doRefresh(e)]:[3,2];case 1:z.sent(),z.label=2;case 2:return[2]}})})},2E3);return c}n(r,b);r.prototype.refresh=function(b){void 0===b&&
(b=Date.now());this._set("refreshTimestamp",b);this.doRefresh&&this.doRefresh()};e([c.property()],r.prototype,"layer",void 0);e([c.aliasOf("layer.refreshInterval")],r.prototype,"refreshInterval",void 0);e([c.property({readOnly:!0})],r.prototype,"refreshTimestamp",void 0);return r=e([c.subclass("esri.layers.mixins.RefreshableLayerView")],r)}(c.declared(q))})},"esri/views/layers/support/FeatureEffect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ./FeatureFilter ./ParsedFeatureEffect ./Transition".split(" "),
function(G,b,n,e,h,m,q,p,c,u,r){var v=m.getLogger("esri.views.layers.support.FeatureEffect");return function(b){function m(){var c=null!==b&&b.apply(this,arguments)||this;c.filter=null;c.includedEffect=null;c.excludedEffect=null;c.excludedLabelsVisible=!1;return c}e(m,b);h=m;Object.defineProperty(m.prototype,"insideEffect",{get:function(){v.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");return this.includedEffect},set:function(b){v.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");
this.includedEffect=b},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"outsideEffect",{get:function(){v.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");return this.excludedEffect},set:function(b){v.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");this.excludedEffect=b},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"parsedIncludedEffect",{get:function(){return q.isSome(this.includedEffect)?
"string"===typeof this.includedEffect?u.fromString(this.includedEffect):new r({from:u.fromString(this.includedEffect.from),to:u.fromString(this.includedEffect.to),duration:this.includedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"parsedExcludedEffect",{get:function(){return q.isSome(this.excludedEffect)?"string"===typeof this.excludedEffect?u.fromString(this.excludedEffect):new r({from:u.fromString(this.excludedEffect.from),to:u.fromString(this.excludedEffect.to),
duration:this.excludedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"renderingHash",{get:function(){return this.excludedLabelsVisible+"-"+this.includedEffect+"-"+this.excludedEffect},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"done",{get:function(){return(!q.isSome(this.parsedIncludedEffect)||this.parsedIncludedEffect.done)&&(!q.isSome(this.parsedExcludedEffect)||this.parsedExcludedEffect.done)},enumerable:!0,configurable:!0});m.prototype.clone=
function(){return new h({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};var h;n([p.property({type:c,json:{write:!0}})],m.prototype,"filter",void 0);n([p.property({type:String,json:{write:!0}})],m.prototype,"includedEffect",void 0);n([p.property({type:String,json:{write:!0}})],m.prototype,"excludedEffect",void 0);n([p.property({type:Boolean,json:{write:!0}})],m.prototype,"excludedLabelsVisible",
void 0);n([p.property({dependsOn:["includedEffect"]})],m.prototype,"parsedIncludedEffect",null);n([p.property({dependsOn:["excludedEffect"]})],m.prototype,"parsedExcludedEffect",null);n([p.property({dependsOn:["includedEffect","excludedEffect"]})],m.prototype,"renderingHash",null);return m=h=n([p.subclass("esri.views.layers.support.FeatureEffect")],m)}(p.declared(h))})},"esri/views/layers/support/FeatureFilter":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper @dojo/framework/shim/array @dojo/framework/shim/Set ../../../geometry ../../../TimeExtent ../../../core/jsonMap ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../geometry/support/jsonUtils ../../../tasks/support/Query".split(" "),
function(G,b,n,e,h,m,q,p,c,u,r,v,x,C,L){var z=new u.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),A=new u.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(b){function g(a){a=b.call(this,a)||this;a.where=null;a.geometry=null;a.spatialRelationship="intersects";a.hiddenIds=new q.default;a.distance=void 0;a.objectIds=null;a.units=null;a.timeExtent=null;a.enabled=!1;return a}e(g,b);a=g;g.prototype.writeWhere=function(a,b,c){b.where=a||"1\x3d1"};g.prototype.enable=function(){this._set("enabled",!0)};
g.prototype.createQuery=function(a){void 0===a&&(a={});var b=this.where,c=this.spatialRelationship,g=this.timeExtent,e=this.objectIds,z=this.units,p=this.distance;return new L(h({geometry:v.clone(this.geometry),objectIds:v.clone(e),spatialRelationship:c,timeExtent:v.clone(g),where:b,units:z,distance:p},a))};g.prototype.clone=function(){var b=this.where,c=this.geometry,g=this.spatialRelationship,e=this.hiddenIds,z=this.timeExtent,p=this.objectIds,m=this.units,n=this.distance,r=new q.default;e.forEach(function(a){return r.add(a)});
return new a({geometry:v.clone(c),hiddenIds:r,objectIds:v.clone(p),spatialRelationship:g,timeExtent:v.clone(z),where:b,units:m,distance:n})};var a;n([x.property({type:String})],g.prototype,"where",void 0);n([x.writer("where")],g.prototype,"writeWhere",null);n([x.property({types:p.geometryTypes,json:{read:C.fromJSON,write:!0}})],g.prototype,"geometry",void 0);n([x.property({type:String,json:{read:{source:"spatialRel",reader:z.read},write:{target:"spatialRel",writer:z.write}}})],g.prototype,"spatialRelationship",
void 0);n([x.property({json:{write:function(a,b,c){return b[c]=m.from(a)},read:function(a,b){return new q.default(a)}}})],g.prototype,"hiddenIds",void 0);n([x.property({type:Number,json:{write:{overridePolicy:function(a){return{enabled:0<a}}}}})],g.prototype,"distance",void 0);n([x.property({type:[Number],json:{write:!0}})],g.prototype,"objectIds",void 0);n([x.property({type:String,json:{read:A.read,write:{writer:A.write,overridePolicy:function(a){return{enabled:a&&0<this.distance}}}}})],g.prototype,
"units",void 0);n([x.property({type:c,json:{write:!0}})],g.prototype,"timeExtent",void 0);n([x.property({readOnly:!0})],g.prototype,"enabled",void 0);return g=a=n([x.subclass("esri.views.layers.support.FeatureFilter")],g)}(x.declared(r))})},"esri/views/layers/support/ParsedFeatureEffect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f32 ./cssFilterParser".split(" "),
function(G,b,n,e,h,m,q,p,c,u,r,v,x){var C=p.getLogger("esri.views.layers.support.ParsedFeatureEffect"),L={grayscale:function(b){b=1-b.amount;b=v.mat4f32.fromValues(.2126+.7874*b,.7152-.7152*b,.0722-.0722*b,0,.2126-.2126*b,.7152+.2848*b,.0722-.0722*b,0,.2126-.2126*b,.7152-.7152*b,.0722+.9278*b,0,0,0,0,1);return r.mat4.transpose(b,b)},sepia:function(b){b=1-b.amount;b=v.mat4f32.fromValues(.393+.607*b,.769-.769*b,.189-.189*b,0,.349-.349*b,.686+.314*b,.168-.168*b,0,.272-.272*b,.534-.534*b,.131+.869*b,
0,0,0,0,1);return r.mat4.transpose(b,b)},saturate:function(b){b=b.amount;b=v.mat4f32.fromValues(.213+.787*b,.715-.715*b,.072-.072*b,0,.213-.213*b,.715+.285*b,.072-.072*b,0,.213-.213*b,.715-.715*b,.072+.928*b,0,0,0,0,1);return r.mat4.transpose(b,b)},"hue-rotate":function(b){var c=Math.sin(b.angle*Math.PI/180);b=Math.cos(b.angle*Math.PI/180);c=v.mat4f32.fromValues(.213+.787*b-.213*c,.715-.715*b-.715*c,.072-.072*b+.928*c,0,.213-.213*b+.143*c,.715+.285*b+.14*c,.072-.072*b-.283*c,0,.213-.213*b-.787*c,
.715-.715*b+.715*c,.072+.928*b+.072*c,0,0,0,0,1);return r.mat4.transpose(c,c)},invert:function(b){var c=1-2*b.amount;b=b.amount;c=v.mat4f32.fromValues(c,0,0,b,0,c,0,b,0,0,c,b,0,0,0,1);return r.mat4.transpose(c,c)},brightness:function(b){b=b.amount;b=v.mat4f32.fromValues(b,0,0,0,0,b,0,0,0,0,b,0,0,0,0,1);return r.mat4.transpose(b,b)},contrast:function(b){b=b.amount;b=v.mat4f32.fromValues(b,0,0,.5-.5*b,0,b,0,.5-.5*b,0,0,b,.5-.5*b,0,0,0,1);return r.mat4.transpose(b,b)}};return function(b){function p(){var c=
null!==b&&b.apply(this,arguments)||this;c.customTransforms=null;c.done=!0;return c}e(p,b);q=p;p.fromString=function(b){var a=[],c=null;try{for(var g=0,e=x.parse(b);g<e.length;g++){var p=e[g];"opacity"===p.type?c=p:a.push(p)}}catch(oa){C.error(new m("invalid-type","Encountered an error when parsing css",oa))}return new q({transforms:a,opacity:c})};p.prototype.getOpacity=function(){return c.isSome(this.opacity)?this.opacity.amount:1};p.prototype.getColorMatrix=function(){var b=this;return(this.transforms||
[]).map(function(a){return h({},a)}).reverse().reduce(function(a,c){return r.mat4.multiply(a,a,b._getFactory(c)(c))},v.mat4f32.create())};p.prototype.clone=function(){return new q({transforms:this.transforms&&this.transforms.map(function(b){return h({},b)}),customTransforms:this.customTransforms&&this.customTransforms.map(function(b){return h({},b)})})};p.prototype._getFactory=function(b){var a=L[b.type];if(!a){if(this.customTransforms)for(var a=function(a){if(a.type===b.type){a=v.mat4f32.fromValues.apply(v.mat4f32,
a.matrix);var c=r.mat4.transpose(a,a);return{value:function(a){return c}}}},c=0,e=this.customTransforms;c<e.length;c++){var g=a(e[c]);if("object"===typeof g)return g.value}C.error("invalid-type","No effect "+b.type+" exists");return function(a){return v.mat4f32.create()}}return a};var q;n([u.property()],p.prototype,"opacity",void 0);n([u.property()],p.prototype,"transforms",void 0);n([u.property()],p.prototype,"customTransforms",void 0);return p=q=n([u.subclass("esri.views.layers.support.ParsedFeatureEffect")],
p)}(u.declared(q))})},"esri/views/layers/support/cssFilterParser":function(){define([],function(){function G(b,n,e,h){this.message=b;this.expected=n;this.found=e;this.location=h;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,G)}(function(b,n){function e(){this.constructor=b}e.prototype=n.prototype;b.prototype=new e})(G,Error);G.buildMessage=function(b,n){function e(b){return b.charCodeAt(0).toString(16).toUpperCase()}function h(b){return b.replace(/\\/g,
"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+e(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+e(b)})}function m(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+e(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,
function(b){return"\\x"+e(b)})}var q={literal:function(b){return'"'+h(b.text)+'"'},"class":function(b){var c="",e;for(e=0;e<b.parts.length;e++)c+=b.parts[e]instanceof Array?m(b.parts[e][0])+"-"+m(b.parts[e][1]):m(b.parts[e]);return"["+(b.inverted?"^":"")+c+"]"},any:function(b){return"any character"},end:function(b){return"end of input"},other:function(b){return b.description}};return"Expected "+function(b){var c=Array(b.length),e;for(e=0;e<b.length;e++){var m=e,p;p=b[e];p=q[p.type](p);c[m]=p}c.sort();
if(0<c.length){for(b=e=1;e<c.length;e++)c[e-1]!==c[e]&&(c[b]=c[e],b++);c.length=b}switch(c.length){case 1:return c[0];case 2:return c[0]+" or "+c[1];default:return c.slice(0,-1).join(", ")+", or "+c[c.length-1]}}(b)+" but "+(n?'"'+h(n)+'"':"end of input")+" found."};return{SyntaxError:G,parse:function(b,n){function e(a,b){return{type:"literal",text:a,ignoreCase:b}}function h(a,b,d){return{type:"class",parts:a,inverted:b,ignoreCase:d}}function m(a){return{type:"other",description:a}}function q(a){var d=
la[a],c;if(!d){for(c=a-1;!la[c];)c--;d=la[c];for(d={line:d.line,column:d.column};c<a;)10===b.charCodeAt(c)?(d.line++,d.column=1):d.column++,c++;la[a]=d}return d}function p(a,b){var d=q(a),c=q(b);return{start:{offset:a,line:d.line,column:d.column},end:{offset:b,line:c.line,column:c.column}}}function c(a){d<ga||(d>ga&&(ga=d,xa=[]),xa.push(a))}function u(){var e,k;l++;e=d;k=g();k!==a?(b.substr(d,4)===H?(k=H,d+=4):(k=a,0===l&&c(oa)),k!==a?(k=g(),k!==a?(w=e,e=null):(d=e,e=a)):(d=e,e=a)):(d=e,e=a);l--;
e===a&&(k=a,0===l&&c(t));if(e===a)if(e=[],k=r(),k!==a)for(;k!==a;)e.push(k),k=r();else e=a;return e}function r(){var e,M,m,n,r,h,q,u,y;l++;M=d;m=g();m!==a?(b.substr(d,5)===wa?(n=wa,d+=5):(n=a,0===l&&c(eb)),n!==a?(r=g(),r!==a?(h=z(),h!==a?(q=g(),q!==a?(41===b.charCodeAt(d)?(u=V,d++):(u=a,0===l&&c(W)),u!==a?(y=g(),y!==a?(w=M,M=m={type:"blur",radius:h}):(d=M,M=a)):(d=M,M=a)):(d=M,M=a)):(d=M,M=a)):(d=M,M=a)):(d=M,M=a)):(d=M,M=a);l--;M===a&&(m=a,0===l&&c(Na));e=M;if(e===a){var t,A,H,ga,ha,na,ka,oa;l++;
t=d;A=g();A!==a?(b.substr(d,11)===Oa?(H=Oa,d+=11):(H=a,0===l&&c(gb)),H!==a?(ga=g(),ga!==a?(ha=v(),ha!==a?(na=g(),na!==a?(41===b.charCodeAt(d)?(ka=V,d++):(ka=a,0===l&&c(W)),ka!==a?(oa=g(),oa!==a?(w=t,t=A={type:"brightness",amount:ha}):(d=t,t=a)):(d=t,t=a)):(d=t,t=a)):(d=t,t=a)):(d=t,t=a)):(d=t,t=a)):(d=t,t=a);l--;t===a&&(A=a,0===l&&c(fb));e=t;if(e===a){var N,la,ra,xa,jb,Da,kb,Ea;l++;N=d;la=g();la!==a?(b.substr(d,9)===Pa?(ra=Pa,d+=9):(ra=a,0===l&&c(Qa)),ra!==a?(xa=g(),xa!==a?(jb=v(),jb!==a?(Da=g(),
Da!==a?(41===b.charCodeAt(d)?(kb=V,d++):(kb=a,0===l&&c(W)),kb!==a?(Ea=g(),Ea!==a?(w=N,N=la={type:"contrast",amount:jb}):(d=N,N=a)):(d=N,N=a)):(d=N,N=a)):(d=N,N=a)):(d=N,N=a)):(d=N,N=a)):(d=N,N=a);l--;N===a&&(la=a,0===l&&c(hb));e=N;if(e===a){var E,Ta,lb,Fa,mb,Ga,nb,Ha,za,Ia,Aa,Ja,ob,Ka;l++;E=d;Ta=g();if(Ta!==a)if(b.substr(d,12)===Ra?(lb=Ra,d+=12):(lb=a,0===l&&c(Sa)),lb!==a)if(Fa=g(),Fa!==a)if(mb=z(),mb!==a)if(Ga=g(),Ga!==a)if(nb=z(),nb!==a)if(Ha=g(),Ha!==a)if(za=z(),za===a&&(za=null),za!==a)if(Ia=
g(),Ia!==a){var f,D,K,B,F,J,ba,X,ia,Y,ja,Z,ca,da,Ba,ya,La,pb;f=d;35===b.charCodeAt(d)?(D=Lb,d++):(D=a,0===l&&c(Mb));if(D!==a)if(K=d,B=I(),B!==a?(F=I(),F!==a?K=B=[B,F]:(d=K,K=a)):(d=K,K=a),K!==a)if(B=d,F=I(),F!==a?(J=I(),J!==a?B=F=[F,J]:(d=B,B=a)):(d=B,B=a),B!==a)if(F=d,J=I(),J!==a?(ba=I(),ba!==a?F=J=[J,ba]:(d=F,F=a)):(d=F,F=a),F!==a){w=f;var cb=B,db=F;f=D=[parseInt(K.join(""),16),parseInt(cb.join(""),16),parseInt(db.join(""),16)]}else d=f,f=a;else d=f,f=a;else d=f,f=a;else d=f,f=a;if(f===a){f=d;35===
b.charCodeAt(d)?(D=Lb,d++):(D=a,0===l&&c(Mb));if(D!==a)if(K=I(),K!==a)if(B=I(),B!==a)if(F=I(),F!==a){w=f;var Ma=B,Nb=F;f=D=[parseInt([K,K].join(""),16),parseInt([Ma,Ma].join(""),16),parseInt([Nb,Nb].join(""),16)]}else d=f,f=a;else d=f,f=a;else d=f,f=a;else d=f,f=a;if(f===a&&(f=d,b.substr(d,5)===pa?(D=pa,d+=5):(D=a,0===l&&c(Ua)),D!==a?(K=g(),K!==a?(B=C(),B!==a?(F=g(),F!==a?(44===b.charCodeAt(d)?(J=ea,d++):(J=a,0===l&&c(fa)),J!==a?(ba=g(),ba!==a?(X=C(),X!==a?(ia=g(),ia!==a?(44===b.charCodeAt(d)?(Y=
ea,d++):(Y=a,0===l&&c(fa)),Y!==a?(ja=g(),ja!==a?(Z=C(),Z!==a?(ca=g(),ca!==a?(44===b.charCodeAt(d)?(da=ea,d++):(da=a,0===l&&c(fa)),da!==a?(Ba=g(),Ba!==a?(ya=v(),ya!==a?(La=g(),La!==a?(41===b.charCodeAt(d)?(pb=V,d++):(pb=a,0===l&&c(W)),pb!==a?(w=f,f=D=[255*B,255*X,255*Z,ya]):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a),f===a&&(f=d,b.substr(d,5)===pa?(D=pa,d+=5):
(D=a,0===l&&c(Ua)),D!==a?(K=g(),K!==a?(B=x(),B!==a?(F=g(),F!==a?(44===b.charCodeAt(d)?(J=ea,d++):(J=a,0===l&&c(fa)),J!==a?(ba=g(),ba!==a?(X=x(),X!==a?(ia=g(),ia!==a?(44===b.charCodeAt(d)?(Y=ea,d++):(Y=a,0===l&&c(fa)),Y!==a?(ja=g(),ja!==a?(Z=x(),Z!==a?(44===b.charCodeAt(d)?(ca=ea,d++):(ca=a,0===l&&c(fa)),ca!==a?(da=g(),da!==a?(Ba=v(),Ba!==a?(41===b.charCodeAt(d)?(ya=V,d++):(ya=a,0===l&&c(W)),ya!==a?(w=f,f=D=[B,X,Z,Ba]):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=
f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a),f===a&&(f=d,b.substr(d,5)===pa?(D=pa,d+=5):(D=a,0===l&&c(Ua)),D!==a?(K=g(),K!==a?(B=C(),B!==a?(F=g(),F!==a?(44===b.charCodeAt(d)?(J=ea,d++):(J=a,0===l&&c(fa)),J!==a?(ba=g(),ba!==a?(X=C(),X!==a?(ia=g(),ia!==a?(44===b.charCodeAt(d)?(Y=ea,d++):(Y=a,0===l&&c(fa)),Y!==a?(ja=g(),ja!==a?(Z=C(),Z!==a?(ca=g(),ca!==a?(41===b.charCodeAt(d)?(da=V,d++):(da=a,0===l&&c(W)),da!==a?(w=f,f=D=[255*B,255*X,255*Z,1]):(d=f,f=a)):(d=f,f=
a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a),f===a&&(f=d,b.substr(d,5)===pa?(D=pa,d+=5):(D=a,0===l&&c(Ua)),D!==a?(K=g(),K!==a?(B=x(),B!==a?(F=g(),F!==a?(44===b.charCodeAt(d)?(J=ea,d++):(J=a,0===l&&c(fa)),J!==a?(ba=g(),ba!==a?(X=x(),X!==a?(ia=g(),ia!==a?(44===b.charCodeAt(d)?(Y=ea,d++):(Y=a,0===l&&c(fa)),Y!==a?(ja=g(),ja!==a?(Z=x(),Z!==a?(41===b.charCodeAt(d)?(ca=V,d++):(ca=a,0===l&&c(W)),ca!==a?(w=f,f=D=[B,X,Z,1]):(d=f,
f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a),f===a&&(f=d,b.substr(d,4)===Va?(D=Va,d+=4):(D=a,0===l&&c(Ob)),D!==a?(K=g(),K!==a?(B=C(),B!==a?(F=g(),F!==a?(44===b.charCodeAt(d)?(J=ea,d++):(J=a,0===l&&c(fa)),J!==a?(ba=g(),ba!==a?(X=C(),X!==a?(ia=g(),ia!==a?(44===b.charCodeAt(d)?(Y=ea,d++):(Y=a,0===l&&c(fa)),Y!==a?(ja=g(),ja!==a?(Z=C(),Z!==a?(ca=g(),ca!==a?(41===b.charCodeAt(d)?(da=V,d++):(da=a,0===l&&c(W)),da!==a?(w=f,f=
D=[255*B,255*X,255*Z,1]):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a),f===a&&(f=d,b.substr(d,4)===Va?(D=Va,d+=4):(D=a,0===l&&c(Ob)),D!==a?(K=g(),K!==a?(B=x(),B!==a?(F=g(),F!==a?(44===b.charCodeAt(d)?(J=ea,d++):(J=a,0===l&&c(fa)),J!==a?(ba=g(),ba!==a?(X=x(),X!==a?(ia=g(),ia!==a?(44===b.charCodeAt(d)?(Y=ea,d++):(Y=a,0===l&&c(fa)),Y!==a?(ja=g(),ja!==a?(Z=x(),Z!==a?(ca=g(),ca!==a?(41===b.charCodeAt(d)?(da=
V,d++):(da=a,0===l&&c(W)),da!==a?(w=f,f=D=[B,X,Z,1]):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a)):(d=f,f=a),f===a))))))){var Ca,sa,ta;l++;Ca=d;sa=[];Pb.test(b.charAt(d))?(ta=b.charAt(d),d++):(ta=a,0===l&&c(Qb));if(ta!==a)for(;ta!==a;)sa.push(ta),Pb.test(b.charAt(d))?(ta=b.charAt(d),d++):(ta=a,0===l&&c(Qb));else sa=a;if(sa!==a){w=Ca;var qb=b.substring(w,d);if(!sc.has(qb)){var Jb='unknown color "'+qb+'"',Wa=void 0,
Wa=void 0!==Wa?Wa:p(w,d);throw new G(Jb,null,null,Wa);}sa=Rb[qb].concat(1)}Ca=sa;l--;Ca===a&&(sa=a,0===l&&c(tc));f=Ca}}Aa=f;Aa===a&&(Aa=null);Aa!==a?(Ja=g(),Ja!==a?(41===b.charCodeAt(d)?(ob=V,d++):(ob=a,0===l&&c(W)),ob!==a?(Ka=g(),Ka!==a?(w=E,E=Ta={type:"drop-shadow",offsetX:mb,offsetY:nb,blurRadius:za,color:Aa}):(d=E,E=a)):(d=E,E=a)):(d=E,E=a)):(d=E,E=a)}else d=E,E=a;else d=E,E=a;else d=E,E=a;else d=E,E=a;else d=E,E=a;else d=E,E=a;else d=E,E=a;else d=E,E=a;else d=E,E=a;l--;E===a&&(Ta=a,0===l&&c(ib));
e=E;if(e===a){var O,Xa,rb,Sb,sb,Tb,tb,Ub;l++;O=d;Xa=g();Xa!==a?(b.substr(d,10)===Kb?(rb=Kb,d+=10):(rb=a,0===l&&c(k)),rb!==a?(Sb=g(),Sb!==a?(sb=v(),sb!==a?(Tb=g(),Tb!==a?(41===b.charCodeAt(d)?(tb=V,d++):(tb=a,0===l&&c(W)),tb!==a?(Ub=g(),Ub!==a?(w=O,O=Xa={type:"grayscale",amount:sb}):(d=O,O=a)):(d=O,O=a)):(d=O,O=a)):(d=O,O=a)):(d=O,O=a)):(d=O,O=a)):(d=O,O=a);l--;O===a&&(Xa=a,0===l&&c(rc));e=O;if(e===a){var P,Ya,ub,Vb,vb,Wb,wb,Xb;l++;P=d;Ya=g();if(Ya!==a)if(b.substr(d,11)===Yb?(ub=Yb,d+=11):(ub=a,0===
l&&c(uc)),ub!==a)if(Vb=g(),Vb!==a){var aa,qa,ua;l++;aa=d;var ma,va,Zb;l++;ma=d;vc.test(b.charAt(d))?(va=b.charAt(d),d++):(va=a,0===l&&c(wc));va===a&&(va=null);va!==a?(Zb=x(),Zb!==a?(w=ma,ma=va=parseFloat(b.substring(w,d))):(d=ma,ma=a)):(d=ma,ma=a);l--;ma===a&&(va=a,0===l&&c(xc));qa=ma;qa!==a?(ua=L(),ua!==a?(w=aa,aa=qa*=ua):(d=aa,aa=a)):(d=aa,aa=a);aa===a&&(aa=d,48===b.charCodeAt(d)?(qa=$b,d++):(qa=a,0===l&&c(ac)),qa!==a?(ua=L(),ua===a&&(ua=null),ua!==a?(w=aa,aa=qa=0):(d=aa,aa=a)):(d=aa,aa=a));l--;
aa===a&&(qa=a,0===l&&c(yc));vb=aa;vb!==a?(Wb=g(),Wb!==a?(41===b.charCodeAt(d)?(wb=V,d++):(wb=a,0===l&&c(W)),wb!==a?(Xb=g(),Xb!==a?(w=P,P=Ya={type:"hue-rotate",angle:vb}):(d=P,P=a)):(d=P,P=a)):(d=P,P=a)):(d=P,P=a)}else d=P,P=a;else d=P,P=a;else d=P,P=a;l--;P===a&&(Ya=a,0===l&&c(Q));e=P;if(e===a){var R,Za,xb,bc,yb,cc,zb,dc;l++;R=d;Za=g();Za!==a?(b.substr(d,7)===ec?(xb=ec,d+=7):(xb=a,0===l&&c(zc)),xb!==a?(bc=g(),bc!==a?(yb=v(),yb!==a?(cc=g(),cc!==a?(41===b.charCodeAt(d)?(zb=V,d++):(zb=a,0===l&&c(W)),
zb!==a?(dc=g(),dc!==a?(w=R,R=Za={type:"invert",amount:yb}):(d=R,R=a)):(d=R,R=a)):(d=R,R=a)):(d=R,R=a)):(d=R,R=a)):(d=R,R=a)):(d=R,R=a);l--;R===a&&(Za=a,0===l&&c(Ac));e=R;if(e===a){var S,$a,Ab,fc,Bb,gc,Cb,hc;l++;S=d;$a=g();$a!==a?(b.substr(d,8)===ic?(Ab=ic,d+=8):(Ab=a,0===l&&c(Bc)),Ab!==a?(fc=g(),fc!==a?(Bb=v(),Bb!==a?(gc=g(),gc!==a?(41===b.charCodeAt(d)?(Cb=V,d++):(Cb=a,0===l&&c(W)),Cb!==a?(hc=g(),hc!==a?(w=S,S=$a={type:"opacity",amount:Bb}):(d=S,S=a)):(d=S,S=a)):(d=S,S=a)):(d=S,S=a)):(d=S,S=a)):
(d=S,S=a)):(d=S,S=a);l--;S===a&&($a=a,0===l&&c(Cc));e=S;if(e===a){var T,ab,Db,jc,Eb,kc,Fb,lc;l++;T=d;ab=g();ab!==a?(b.substr(d,9)===mc?(Db=mc,d+=9):(Db=a,0===l&&c(Dc)),Db!==a?(jc=g(),jc!==a?(Eb=v(),Eb!==a?(kc=g(),kc!==a?(41===b.charCodeAt(d)?(Fb=V,d++):(Fb=a,0===l&&c(W)),Fb!==a?(lc=g(),lc!==a?(w=T,T=ab={type:"saturate",amount:Eb}):(d=T,T=a)):(d=T,T=a)):(d=T,T=a)):(d=T,T=a)):(d=T,T=a)):(d=T,T=a)):(d=T,T=a);l--;T===a&&(ab=a,0===l&&c(Ec));e=T;if(e===a){var U,bb,Gb,nc,Hb,oc,Ib,pc;l++;U=d;bb=g();bb!==
a?(b.substr(d,6)===qc?(Gb=qc,d+=6):(Gb=a,0===l&&c(Fc)),Gb!==a?(nc=g(),nc!==a?(Hb=v(),Hb!==a?(oc=g(),oc!==a?(41===b.charCodeAt(d)?(Ib=V,d++):(Ib=a,0===l&&c(W)),Ib!==a?(pc=g(),pc!==a?(w=U,U=bb={type:"sepia",amount:Hb}):(d=U,U=a)):(d=U,U=a)):(d=U,U=a)):(d=U,U=a)):(d=U,U=a)):(d=U,U=a)):(d=U,U=a);l--;U===a&&(bb=a,0===l&&c(Gc));e=U}}}}}}}}}return e}function v(){var b;l++;b=C();b===a&&(b=x());l--;b===a&&0===l&&c(Jb);return b}function x(){var e,g,k;l++;e=d;g=[];na.test(b.charAt(d))?(k=b.charAt(d),d++):(k=
a,0===l&&c(ka));if(k!==a)for(;k!==a;)g.push(k),na.test(b.charAt(d))?(k=b.charAt(d),d++):(k=a,0===l&&c(ka));else g=a;if(g!==a)if(46===b.charCodeAt(d)?(k=Hc,d++):(k=a,0===l&&c(Ic)),k!==a){g=[];na.test(b.charAt(d))?(k=b.charAt(d),d++):(k=a,0===l&&c(ka));if(k!==a)for(;k!==a;)g.push(k),na.test(b.charAt(d))?(k=b.charAt(d),d++):(k=a,0===l&&c(ka));else g=a;g!==a?(w=e,e=g=parseFloat(b.substring(w,d))):(d=e,e=a)}else d=e,e=a;else d=e,e=a;if(e===a){l++;e=d;g=[];na.test(b.charAt(d))?(k=b.charAt(d),d++):(k=a,
0===l&&c(ka));if(k!==a)for(;k!==a;)g.push(k),na.test(b.charAt(d))?(k=b.charAt(d),d++):(k=a,0===l&&c(ka));else g=a;g!==a&&(w=e,g=parseInt(b.substring(w,d),10));e=g;l--;e===a&&(g=a,0===l&&c(Jc))}l--;e===a&&(g=a,0===l&&c(Kc));return e}function C(){var e,k,g;e=d;k=x();k!==a?(37===b.charCodeAt(d)?(g=Lc,d++):(g=a,0===l&&c(Mc)),g!==a?(w=e,e=k/100):(d=e,e=a)):(d=e,e=a);return e}function L(){var e,k;l++;e=d;b.substr(d,3)===Da?(k=Da,d+=3):(k=a,0===l&&c(Nc));k!==a&&(w=e,k=1);e=k;e===a&&(e=d,b.substr(d,4)===
Ea?(k=Ea,d+=4):(k=a,0===l&&c(Oc)),k!==a&&(w=e,k=.9),e=k,e===a&&(e=d,b.substr(d,3)===Fa?(k=Fa,d+=3):(k=a,0===l&&c(Pc)),k!==a&&(w=e,k=180/Math.PI),e=k,e===a&&(e=d,b.substr(d,4)===Ga?(k=Ga,d+=4):(k=a,0===l&&c(Qc)),k!==a&&(w=e,k=1/360),e=k)));l--;e===a&&(k=a,0===l&&c(Rc));return e}function z(){var e,k,g;l++;e=d;k=x();k!==a?(g=A(),g!==a?(w=e,e=k*g):(d=e,e=a)):(d=e,e=a);e===a&&(e=d,48===b.charCodeAt(d)?(k=$b,d++):(k=a,0===l&&c(ac)),k!==a?(g=A(),g===a&&(g=null),g!==a?(w=e,e=0):(d=e,e=a)):(d=e,e=a));l--;
e===a&&(k=a,0===l&&c(Sc));return e}function A(){var e,k;e=d;b.substr(d,2)===Ha?(k=Ha,d+=2):(k=a,0===l&&c(Tc));k!==a&&(w=e,k=1);e=k;e===a&&(e=d,b.substr(d,2)===Ia?(k=Ia,d+=2):(k=a,0===l&&c(Uc)),k!==a&&(w=e,k=96/2.54),e=k,e===a&&(e=d,b.substr(d,2)===Ja?(k=Ja,d+=2):(k=a,0===l&&c(Vc)),k!==a&&(w=e,k=96/2.54/10),e=k,e===a&&(e=d,81===b.charCodeAt(d)?(k=Wc,d++):(k=a,0===l&&c(Xc)),k!==a&&(w=e,k=96/2.54/40),e=k,e===a&&(e=d,b.substr(d,2)===Ka?(k=Ka,d+=2):(k=a,0===l&&c(Yc)),k!==a&&(w=e,k=96),e=k,e===a&&(e=d,
b.substr(d,2)===La?(k=La,d+=2):(k=a,0===l&&c(Zc)),k!==a&&(w=e,k=16),e=k,e===a&&(e=d,b.substr(d,2)===cb?(k=cb,d+=2):(k=a,0===l&&c($c)),k!==a&&(w=e,k=96/73),e=k))))));return e}function I(){var e;ad.test(b.charAt(d))?(e=b.charAt(d),d++):(e=a,0===l&&c(bd));return e}function g(){var e,k;l++;e=[];db.test(b.charAt(d))?(k=b.charAt(d),d++):(k=a,0===l&&c(Ma));for(;k!==a;)e.push(k),db.test(b.charAt(d))?(k=b.charAt(d),d++):(k=a,0===l&&c(Ma));l--;e===a&&(k=a,0===l&&c(cd));return e}n=void 0!==n?n:{};var a={},y=
{start:u},ha=u,t=m("none"),H="none",oa=e("none",!1),Na=m("blur()"),wa="blur(",eb=e("blur(",!1),V=")",W=e(")",!1),fb=m("brightness()"),Oa="brightness(",gb=e("brightness(",!1),hb=m("contrast()"),Pa="contrast(",Qa=e("contrast(",!1),ib=m("drop-shadow()"),Ra="drop-shadow(",Sa=e("drop-shadow(",!1),rc=m("grayscale()"),Kb="grayscale(",k=e("grayscale(",!1),Q=m("hue-rotate()"),Yb="hue-rotate(",uc=e("hue-rotate(",!1),Ac=m("invert()"),ec="invert(",zc=e("invert(",!1),Cc=m("opacity()"),ic="opacity(",Bc=e("opacity(",
!1),Ec=m("saturate()"),mc="saturate(",Dc=e("saturate(",!1),Gc=m("sepia()"),qc="sepia(",Fc=e("sepia(",!1),Jb=m("\x3cnumber-percentage\x3e"),Jc=m("\x3cinteger\x3e"),na=/^[0-9]/,ka=h([["0","9"]],!1,!1),Kc=m("\x3cnumber\x3e"),Hc=".",Ic=e(".",!1),xc=m("\x3csignedNumber\x3e"),vc=/^[+\-]/,wc=h(["+","-"],!1,!1),Lc="%",Mc=e("%",!1),yc=m("\x3cangle\x3e"),$b="0",ac=e("0",!1),Rc=m("\x3cunit\x3e"),Da="deg",Nc=e("deg",!1),Ea="grad",Oc=e("grad",!1),Fa="rad",Pc=e("rad",!1),Ga="turn",Qc=e("turn",!1),Sc=m("\x3clength\x3e"),
Ha="px",Tc=e("px",!1),Ia="cm",Uc=e("cm",!1),Ja="mm",Vc=e("mm",!1),Wc="Q",Xc=e("Q",!1),Ka="in",Yc=e("in",!1),La="pc",Zc=e("pc",!1),cb="pt",$c=e("pt",!1),Lb="#",Mb=e("#",!1),pa="rgba(",Ua=e("rgba(",!1),ea=",",fa=e(",",!1),Va="rgb(",Ob=e("rgb(",!1),ad=/^[0-9a-fA-F]/,bd=h([["0","9"],["a","f"],["A","F"]],!1,!1),cd=m("whitespace"),db=/^[ \t\n\r]/,Ma=h([" ","\t","\n","\r"],!1,!1),tc=m("\x3cnamed-color\x3e"),Pb=/^[a-z]/,Qb=h([["a","z"]],!1,!1),d=0,w=0,la=[{line:1,column:1}],ga=0,xa=[],l=0,ra;if("startRule"in
n){if(!(n.startRule in y))throw Error("Can't start parsing from rule \""+n.startRule+'".');ha=y[n.startRule]}var Rb={transparent:[0,0,0,0],black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,
255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],
darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],
gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,
182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,
21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rebeccapurple:[102,51,153],
rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,
205,50]},sc=new Set(Object.keys(Rb));ra=ha();if(ra!==a&&d===b.length)return ra;ra!==a&&d<b.length&&c({type:"end"});throw function(a,b,d){return new G(G.buildMessage(a,b),a,b,d)}(xa,ga<b.length?b.charAt(ga):null,ga<b.length?p(ga,ga+1):p(ga,ga));}}})},"esri/views/layers/support/Transition":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4".split(" "),
function(G,b,n,e,h,m,q){return function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c.from=null;c.to=null;c.duration=4E3;c.repeat=!0;c.done=!1;return c}e(c,b);p=c;c.prototype.getColorMatrix=function(){this.done=!1;if(null==this._lastTime)this._currentStep=0,this._lastTime=Date.now();else{var b=this._lastTime,c=Date.now();this._currentStep+=c-b;2147483647<=this._currentStep&&(this._currentStep=0);this._lastTime=c}var b=this._currentStep%this.duration/(this.duration/2),b=1>=b?b:2-
b,c=this.from.getColorMatrix(),e=this.to.getColorMatrix();q.mat4.multiplyScalar(c,c,1-b);q.mat4.multiplyScalar(e,e,b);!this.repeat&&this._currentStep>=this.duration&&(this.done=!0);return q.mat4.add(c,c,e)};c.prototype.getOpacity=function(){throw Error("No getOpacity definition for Transition");};c.prototype.clone=function(){var b=new p({from:this.from.clone(),to:this.to.clone(),duration:this.duration});b._lastTime=this._lastTime;b._currentStep=this._currentStep;return b};var p;n([m.property()],c.prototype,
"from",void 0);n([m.property()],c.prototype,"to",void 0);n([m.property({type:Number})],c.prototype,"duration",void 0);n([m.property({type:Boolean})],c.prototype,"repeat",void 0);return c=p=n([m.subclass("esri.views.layers.support.Transition")],c)}(m.declared(h))})},"esri/views/layers/support/popupUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),
function(G,b,n,e,h,m,q){Object.defineProperty(b,"__esModule",{value:!0});b.getRequiredFields=function(b,c){void 0===c&&(c=b.popupTemplate);return e(this,void 0,void 0,function(){var e,p,v,x,C,G,z,A,I,g,a;return n(this,function(n){switch(n.label){case 0:return m.isSome(c)?[4,c.getRequiredFields(b.fields)]:[2,[]];case 1:e=n.sent();p=c.lastEditInfoEnabled;v=b.objectIdField;x=b.typeIdField;if(h.includes(e,"*"))return[2,["*"]];G=q.fixFields;z=[b.fields];I=(A=e).concat;g=[[x]];return(a=p)?[4,q.getFeatureEditFields(b)]:
[3,3];case 2:a=n.sent(),n.label=3;case 3:return(C=G.apply(void 0,z.concat([I.apply(A,g.concat([a||null]))])))&&v&&q.hasField(b.fields,v)&&-1===C.indexOf(v)&&C.push(v),[2,C]}})})};b.getFetchPopupTemplate=function(b,c){return b.popupTemplate?b.popupTemplate:m.isSome(c)&&c.defaultPopupTemplateEnabled&&m.isSome(b.defaultPopupTemplate)?b.defaultPopupTemplate:null}})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/paramHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array @dojo/framework/shim/Set ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../renderers/support/clickToleranceUtils ../../../tasks/support/FeatureSet ../../../tasks/support/Query ../engine ./LayerView2D ./features/tileRenderers ./features/support/rendererUtils ./support/FeatureLayerProxy ./support/popupUtils2D ./support/util ../tiling/TileStrategy ../../layers/FeatureLayerView ../../../views/layers/support/FeatureFilter ../../layers/support/FeatureEffect".split(" "),function(G,
b,n,e,h,m,q,p,c,u,r,v,x,C,L,z,A,I,g,a,y,ha,t,H,oa,Na,wa,eb,V,W,fb,Oa,gb,hb,Pa,Qa,ib){function Ra(a){return a&&"openPorts"in a}var Sa=I.getLogger("esri.views.2d.layers.FeatureLayerView2D");return function(b){function h(){var c=null!==b&&b.apply(this,arguments)||this;c._pipelineIsUpdating=!0;c._updatingPipelineConfig=!1;c._visibilityOverrides=new u.default;c._effect=null;c._highlightIDs=new u.default;c._highlightRequested=!1;c._outstandingIdRequests=0;c.container=new wa.Container;c.filter=null;c._onRenderingConfigChange=
a.debounce(C.safeCastFunction(function(){return p(c,void 0,void 0,function(){var a,b,c,e,k,h,m,n,p,r,t;return q(this,function(Q){switch(Q.label){case 0:if(!this._hasRequiredSupport(this.layer))return[2];this._set("_updatingPipelineConfig",!0);a=this._createLayerFilterHash();b=this._createTileRendererHash();c=this._createFeatureDataHash();e=this._createMeshHash();return[4,this._updateRequiredFields()];case 1:return Q.sent(),b===this._tileRendererHash?[3,8]:[4,this._initTileRenderer()];case 2:return Q.sent(),
Ra(this.layer.source)?[4,this._createMemoryServiceOptions(this.layer.source)]:[3,4];case 3:return h=Q.sent(),[3,5];case 4:h=this._createServiceOptions(),Q.label=5;case 5:return k=h,[4,this._proxy.startup(this.view.featuresTilingScheme,this._createConfiguration(),k)];case 6:return Q.sent(),[4,this._onceTilesUpdated()];case 7:return Q.sent(),[3,13];case 8:m=a!==this._layerFilterHash;n=c!==this._featureDataHash;p=e!==this._meshHash;r=this._createConfiguration();if(!(m||n||p))return[3,10];t={invalidateFeatureData:n,
invalidateMesh:p,layerFilterChanged:m};return[4,this._proxy.update(r,t)];case 9:Q.sent(),Q.label=10;case 10:return m?[4,this._onceTilesUpdated()]:[3,12];case 11:Q.sent(),Q.label=12;case 12:this.tileRenderer.onConfigUpdate(),Q.label=13;case 13:return this._layerFilterHash=a,this._tileRendererHash=b,this._meshHash=e,this._featureDataHash=c,this.effects.forEach(function(a){return g.isSome(a)&&g.isSome(a.filter)&&a.filter.enable()}),this.tileRenderer.invalidateLabels(),this.requestUpdate(),[2]}})})}));
return c}n(h,b);h.prototype.destroy=function(){this._proxy.destroy()};h.prototype.initialize=function(){this.addResolvingPromise(C.safeCast(this._initProxy()))};h.prototype._initProxy=function(){return p(this,void 0,void 0,function(){var a;return q(this,function(b){if(this.layer.isTable)throw new z("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});this._proxy&&this._proxy.destroy();a=this._createClientOptions();this._proxy=new fb.default({client:a});
return[2,this._proxy.when()]})})};Object.defineProperty(h.prototype,"labelsVisible",{get:function(){return!this.suspended&&this.layer.labelingInfo&&this.layer.labelsVisible},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"effect",{get:function(){return g.unwrapOr(this._effect,null)},set:function(a){var b=this._effect;g.isSome(b)&&g.isSome(b.filter)&&b.filter.enabled&&g.isSome(a)&&g.isSome(a.filter)&&a.filter.enable();this._effect=a;this.notifyChange("effect")},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"effects",{get:function(){return this.effect&&[this.effect]||[]},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"numFeatures",{get:function(){var a=0;this.attached&&this._tileStrategy.tiles.forEach(function(b){a+=b.iconDisplayRecords?b.iconDisplayRecords.length:0});return a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"renderingConfigHash",{get:function(){if(!this.layer)return null;var a=this.availableFields,b=this.layer,c=
b.definitionExpression,e=b.renderer,b=b.labelingInfo,h="historicMoment"in this.layer?this.layer.historicMoment:null,m=this.timeExtent,n="filter"in this.layer&&this.layer.filter&&""+JSON.stringify(this.layer.filter.geometry)+this.layer.filter.where;return JSON.stringify({filterHash:g.isSome(this.filter)&&this.filter.toJSON(),effectHash:g.isSome(this.effect)&&this.effect.toJSON(),streamFilter:n,definitionExpression:c,historicMoment:h,availableFields:a,renderer:e,labelingInfo:b,timeExtent:m})},enumerable:!0,
configurable:!0});h.prototype.highlight=function(a){var b=this,c;a instanceof v?c=[a.getAttribute(this.layer.objectIdField||"__esri_stream_id__")]:"number"===typeof a?c=[a]:L.isCollection(a)?c=a.map(function(a){return a&&a.getAttribute(b.layer.objectIdField)}).toArray():Array.isArray(a)&&0<a.length&&(c="number"===typeof a[0]?a:a.map(function(a){return a&&a.getAttribute(b.layer.objectIdField)}));c=c.filter(function(a){return null!=a});c.length&&this._addHighlight(c);return{remove:function(){return b._removeHighlight(c)},
pause:function(){return b._removeHighlight(c)},resume:function(){return b._addHighlight(c)}}};h.prototype.getLocalIdsToHighlight=function(){return p(this,void 0,void 0,function(){var a,b,e,g,h;return q(this,function(k){switch(k.label){case 0:a=[];if(!this.hasHighlight())return[2,{isEmpty:!0,has:function(a){return!1}}];this._set("_outstandingIdRequests",this._outstandingIdRequests+1);k.label=1;case 1:return k.trys.push([1,3,,4]),[4,this._proxy.mapValidLocalIds(c.from(this._highlightIDs))];case 2:return a=
k.sent(),[3,4];case 3:return k.sent(),[3,4];case 4:this._set("_outstandingIdRequests",this._outstandingIdRequests-1);b=new u.default;e=0;for(g=a;e<g.length;e++)h=g[e],b.add(h);return[2,{isEmpty:0===b.size,has:function(a){return b.has(a)}}]}})})};h.prototype.hasHighlight=function(){return!!this._highlightIDs.size};h.prototype.hitTest=function(a,b){return C.safeCast(this._hitTest(a,b))};h.prototype.queryFeatures=function(a,b){var c=this;return this.queryFeaturesJSON(a,b).then(function(a){a=oa.fromJSON(a);
a.features.forEach(function(a){a.layer=c.layer;a.sourceLayer=c.layer});return a})};h.prototype.queryFeaturesJSON=function(a,b){return this._proxy.queryFeatures(this._cleanUpQuery(a),b)};h.prototype.queryObjectIds=function(a,b){return this._proxy.queryObjectIds(this._cleanUpQuery(a),b)};h.prototype.queryFeatureCount=function(a,b){return this._proxy.queryFeatureCount(this._cleanUpQuery(a),b)};h.prototype.queryExtent=function(a,b){return this._proxy.queryExtent(this._cleanUpQuery(a),b).then(function(a){return{count:a.count,
extent:r.Extent.fromJSON(a.extent)}})};h.prototype.setVisibility=function(a,b){b?this._visibilityOverrides.delete(a):this._visibilityOverrides.add(a);this._renderingConfigHashChanged()};h.prototype.update=function(a){this.attached&&this._tileStrategy&&this.tileRenderer&&(this._tileStrategy.update(a)||this.requestUpdate(),this._proxy.setViewState(a.state),this.notifyChange("numFeatures"),this.notifyChange("updating"))};h.prototype.attach=function(){var a=this;this._tileStrategy=new hb({cachePolicy:"purge",
acquireTile:function(b){return a._acquireTile(b)},releaseTile:function(b){return a._releaseTile(b)},tileInfoView:this.view.featuresTilingScheme,buffer:0});this.handles.add([ha.watch(this,"layer.processing?.version",function(b){return a._proxy.redraw()}),this.layer.on("edits",function(b){return a._proxy.onEdits(b)}),ha.init(this,"renderingConfigHash",function(){return a._renderingConfigHashChanged()})],"attach")};h.prototype.detach=function(){this.container.removeAllChildren();this.handles.remove("attach");
this._updatingPipelineConfig=!1;this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null)};h.prototype.moveStart=function(){this.requestUpdate()};h.prototype.viewChange=function(){this.requestUpdate()};h.prototype.moveEnd=function(){this.requestUpdate()};h.prototype.fetchPopupFeatures=function(b,c){return p(this,void 0,void 0,function(){var e,k,g;return q(this,function(h){if(e=this.validateFetchPopupFeatures(c))return[2,
a.reject(e)];k=this.fetchClientPopupFeatures(c);if(!b)return[2,k];g=this._fetchServicePopupFeatures(b,c);return[2,a.eachAlwaysValues([k,g]).then(x.flatten)]})})};h.prototype._fetchServicePopupFeatures=function(a,b){return p(this,void 0,void 0,function(){var c,e,k,h,m,n,p,Q,r,t;return q(this,function(q){switch(q.label){case 0:return[4,this.createPopupQuery(b)];case 1:c=q.sent();e=this.layer;k=e.renderer;h=H.calculateTolerance(k);c.geometry=this.createFetchPopupFeaturesQueryGeometry(a,h);m=new u.default;
n=e.objectIdField;if(p=g.isSome(b)?b.clientGraphics:null)for(Q=0,r=p;Q<r.length;Q++)t=r[Q],m.add(t.attributes[n]);return[2,e.queryFeatures(c).then(function(a){return a.features.filter(function(a){return!m.has(a.attributes[n])})})]}})})};h.prototype.createFetchPopupFeaturesQueryGeometry=function(a,b){return Oa.createQueryGeometry(a,b,this.view)};h.prototype.doRefresh=function(a){return p(this,void 0,void 0,function(){return q(this,function(a){this._proxy.refresh();return[2]})})};h.prototype.isUpdating=
function(){return null!=this.layer.renderer&&(null==this.tileRenderer||0!==this._outstandingIdRequests||this._pipelineIsUpdating||this._updatingPipelineConfig||this.tileRenderer.updating)};h.prototype._createClientOptions=function(){var b=this;return{executeProcessing:function(c){if(!("processing"in b.layer&&b.layer.processing))return c.featureSet;var e=b.layer.processing;return(c=e.process(c.featureSet,e.options))?c:a.reject(new z("FeatureLayer","invalid processing.process() method, returns nothing"))},
setUpdating:function(a){b._set("_pipelineIsUpdating",a)}}};h.prototype._createServiceOptions=function(){var a=this.layer,b=a.capabilities,c=a.objectIdField,e=a.fields.map(function(a){return a.toJSON()}),g=a.fullExtent&&a.fullExtent.toJSON(),h=gb.toJSONGeometryType(a.geometryType),m=a.timeInfo&&a.timeInfo.toJSON()||null;return{type:"on-demand",maxRecordCount:"maxRecordCount"in this.layer&&this.layer.maxRecordCount,tileMaxRecordCount:"tileMaxRecordCount"in this.layer&&this.layer.tileMaxRecordCount,
capabilities:b,fields:e,fullExtent:g,geometryType:h,objectIdField:c,source:"dynamicDataSource"in a?a.dynamicDataSource?a.parsedUrl:a.url+"/"+a.layerId:a.parsedUrl,timeInfo:m}};h.prototype._createMemoryServiceOptions=function(a){return p(this,void 0,void 0,function(){var b;return q(this,function(c){switch(c.label){case 0:return[4,a.openPorts()];case 1:return b=c.sent(),[2,m({},this._createServiceOptions(),{type:"memory",source:b})]}})})};h.prototype._cleanUpQuery=function(a){a=Na.from(a)||this.createQuery();
a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};h.prototype._acquireTile=function(a){var b=this;a=this.tileRenderer.acquireTile(a);a.once("attach",function(){b.requestUpdate()});return a};h.prototype._releaseTile=function(a){this.tileRenderer.releaseTile(a)};h.prototype._initTileRenderer=function(){return p(this,void 0,void 0,function(){var a;return q(this,function(b){switch(b.label){case 0:return[4,V.createOrReuseTileRenderer(this.tileRenderer,this.layer.renderer,
{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer})];case 1:a=b.sent();if(!this.tileRenderer)return[3,3];this._tileStrategy.clear();this.tileRenderer.uninstall(this.container);this.tileRenderer.destroy();this.tileRenderer=null;return[4,this._initProxy()];case 2:b.sent(),b.label=3;case 3:return this.tileRenderer=this._proxy.tileRenderer=a,this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(),[2,this.tileRenderer]}})})};h.prototype._createLayerFilterHash=
function(){var a=this.layer.definitionExpression,b=("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.historicMoment&&this.layer.historicMoment.getTime();return a+"."+b+"."+(("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.gdbVersion)};h.prototype._createTileRendererHash=function(){return("heatmap"===this.layer.renderer.type?"heatmap":"symbol")+"."+("dot-density"===this.layer.renderer.type)};h.prototype._createFeatureDataHash=function(){var a=this.layer.renderer.getAttributeHash(),
b=JSON.stringify(this.filter),c=g.isSome(this.effect)&&JSON.stringify(this.effect.filter),e=JSON.stringify(this.timeExtent),h="";this._visibilityOverrides.forEach(function(a){return h+=a});return a+"."+b+"."+c+"."+e+"."+h};h.prototype._createMeshHash=function(){var a=this.layer.renderer,b=wa.getVVFlags("visualVariables"in a&&a.visualVariables||[]),c=this.layer.labelingInfo&&this.layer.labelingInfo.map(function(a){return JSON.stringify(a)}).join("/");return a.getMeshHash()+"."+b+"."+c};h.prototype._injectOverrides=
function(a){var b=this.filter&&this.filter.timeExtent,b=this.timeExtent&&b?this.timeExtent.intersection(b):this.timeExtent||b;if(!this._visibilityOverrides.size&&!b)return a;a=g.isSome(this.filter)&&this.filter.clone()||new Qa;a.hiddenIds=this._visibilityOverrides;a.timeExtent=b;return a};h.prototype._createConfiguration=function(){var a=W.simplifyVVRenderer(this.layer.renderer),b=this.layer.labelingInfo,c=("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.historicMoment&&this.layer.historicMoment.getTime(),
e=("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.gdbVersion,h=Array(wa.definitions.MAX_FILTERS),m=this._injectOverrides(this.filter);h[0]=g.isSome(m)&&m.toJSON()||null;h[1]=g.isSome(this.effect)&&this.effect.filter&&this.effect.filter.toJSON()||null;return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,labelingInfo:b&&b.map(function(a){return a.toJSON()}),renderer:a.toJSON(),gdbVersion:e,historicMoment:c,devicePixelRatio:window.devicePixelRatio||
1,filters:h,processing:"processing"in this.layer&&this.layer.processing&&this.layer.processing.toWorker()}};h.prototype._hasRequiredSupport=function(a){return"dot-density"!==a.renderer.type||A("esri-webgl-texture-float")?!0:(Sa.error(new z("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1)};h.prototype._onceTilesUpdated=function(){this.requestUpdate();return ha.once(this,"_pipelineIsUpdating")};h.prototype._renderingConfigHashChanged=function(){var b=
this,c=this._onRenderingConfigChange();this._updatingPromise=c;var e=function(){return c===b._updatingPromise&&b._set("_updatingPipelineConfig",!1)};c.then(e).catch(function(b){a.isAbortError(b)||Sa.error(b);e()})};h.prototype._requestHighlight=function(){var a=this;this._highlightRequested||(this._highlightRequested=!0,y.schedule(function(){a.tileRenderer&&"updateHighlight"in a.tileRenderer&&a.tileRenderer.updateHighlight();a._highlightRequested=!1}))};h.prototype._addHighlight=function(a){for(var b=
0;b<a.length;b++)this._highlightIDs.add(a[b]);this._requestHighlight()};h.prototype._removeHighlight=function(a){for(var b=0;b<a.length;b++)this._highlightIDs.delete(a[b]);this._requestHighlight()};h.prototype._hitTest=function(b,c){return p(this,void 0,void 0,function(){var e,h,k,m,n=this;return q(this,function(p){switch(p.label){case 0:return this.suspended||!this.tileRenderer?[2,null]:[4,this.tileRenderer.hitTest(b,c)];case 1:return e=p.sent(),0===e.length?[2,null]:[4,a.all(e.map(function(a){return n._proxy.getObjectId(a)}))];
case 2:return h=p.sent(),[4,this._proxy.queryFeatures(new Na({objectIds:h,outSpatialReference:this.view.spatialReference,returnGeometry:!0}))];case 3:k=p.sent();if(!k.features[0])return[2,null];m=v.fromJSON(k.features[0]);m.layer=this.layer;m.sourceLayer=this.layer;g.isSome(m.geometry)&&(m.geometry.spatialReference=this.view.spatialReference);return[2,m]}})})};e([t.property()],h.prototype,"_pipelineIsUpdating",void 0);e([t.property()],h.prototype,"_updatingPipelineConfig",void 0);e([t.property()],
h.prototype,"_outstandingIdRequests",void 0);e([t.property({dependsOn:["suspended","layer.labelingInfo","layer.labelsVisible"]})],h.prototype,"labelsVisible",null);e([t.property({type:Qa})],h.prototype,"filter",void 0);e([t.property({type:ib})],h.prototype,"effect",null);e([t.property({readOnly:!0,dependsOn:["effect"]})],h.prototype,"effects",null);e([t.property()],h.prototype,"numFeatures",null);e([t.property({dependsOn:"layer.renderer availableFields layer.definitionExpression layer.filter? layer.historicMoment? layer.labelingInfo filter effect timeExtent".split(" ")})],
h.prototype,"renderingConfigHash",null);e([t.property()],h.prototype,"tileRenderer",void 0);e([t.property({dependsOn:["layer.renderer","tileRenderer.updating","_updatingPipelineConfig","_pipelineIsUpdating","_outstandingIdRequests"]})],h.prototype,"updating",void 0);return h=e([t.subclass("esri.views.2d.layers.FeatureLayerView2D")],h)}(t.declared(eb,Pa))});