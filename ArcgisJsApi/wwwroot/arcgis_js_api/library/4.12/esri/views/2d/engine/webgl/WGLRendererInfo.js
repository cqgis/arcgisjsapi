// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../renderers/support/utils ./definitions ./Utils".split(" "),function(q,r,z,u,v,l,k,w,x,y,m,n){function p(d,a){var c=a.length;if(d<a[0].value||1===c)return a[0].size;for(var b=1;b<c;b++)if(d<a[b].value)return a[b-1].size+(d-a[b-1].value)/(a[b].value-a[b-1].value)*(a[b].size-
a[b-1].size);return a[c-1].size}function t(d,a,c){void 0===c&&(c=0);var b=a.g,h=a.b,e=a.a;d[c+0]=a.r*e/255;d[c+1]=b*e/255;d[c+2]=h*e/255;d[c+3]=e}Object.defineProperty(r,"__esModule",{value:!0});var g=function(d,a,c){for(var b=c*=16,h=0;b<Math.min(c+16,d.length);b++,h++)d[b]=a[h]},f=x.mat4f32.create();q=function(){function d(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);
this.vvSizeMinMaxValue=new Float32Array(4);this.vvSizeFieldStopsValues=new Float32Array(6);this.vvSizeFieldStopsSizes=new Float32Array(6);this.ddColors=new Float32Array(32);this.ddBackgroundColor=new Float32Array(4);this.ddActiveDots=new Float32Array(8);this.insideEffect=new Float32Array(16*m.MAX_FILTERS);this.insideOpacity=1;this.outsideEffect=new Float32Array(16*m.MAX_FILTERS);this.outsideOpacity=1;this.effectCount=0;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,
vvRotationType:"geographic",vvOpacityEnabled:!1};this._buf0=new Float32Array(2);this._buf1=new Float32Array(2);this.symbolLevels.push(0);for(var a=0;a<m.MAX_FILTERS;a++)g(this.insideEffect,f,a),g(this.outsideEffect,f,a)}Object.defineProperty(d.prototype,"insideOpacities",{get:function(){this._buf0[0]=1;this._buf0[1]=this.insideOpacity;return this._buf0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"outsideOpacities",{get:function(){this._buf1[0]=0;this._buf1[1]=this.outsideOpacity;
return this._buf1},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});d.prototype.update=function(a,c,b,d){var h=this;l.isSome(d)?(d.forEach(function(a,b){return h._updateEffects(b,a)}),this.effectCount=d.length):this.effectCount=0;b&&this._updateVisualVariables(b,a);switch(c.type){case "dot-density":this._updateDotDensityInfo(c)}};d.prototype.getVariation=function(){return{ddDotBlending:this.ddDotBlending,
outsideLabelsVisible:this.outsideLabelsVisible,effectCount:this.effectCount,oesTextureFloat:v("esri-webgl-texture-float")}};d.prototype.getVariationHash=function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1|this.effectCount<<2};d.prototype._updateEffects=function(a,c){a+=1;if(l.isSome(c)&&c.filter&&c.filter.enabled){this.outsideLabelsVisible=c.excludedLabelsVisible;var b=c.parsedIncludedEffect;c=c.parsedExcludedEffect;l.isSome(b)?(g(this.insideEffect,b.getColorMatrix(),a),this.insideOpacity=
b.getOpacity()):(g(this.insideEffect,f,a),this.insideOpacity=1);l.isSome(c)?(g(this.outsideEffect,c.getColorMatrix(),a),this.outsideOpacity=c.getOpacity()):(g(this.outsideEffect,f,a),this.outsideOpacity=1)}else g(this.insideEffect,f,a),g(this.outsideEffect,f,a),this.outsideOpacity=this.insideOpacity=1};d.prototype._updateVisualVariables=function(a,c){var b=this._vvMaterialParameters;b.vvOpacityEnabled=!1;b.vvSizeEnabled=!1;b.vvColorEnabled=!1;b.vvRotationEnabled=!1;if(a){var d=a.size;if(d){b.vvSizeEnabled=
!0;if(d.minMaxValue){var e=d.minMaxValue,g=void 0,f=void 0;n.isDefined(e.minSize)&&n.isDefined(e.maxSize)&&(n.isNumber(e.minSize)&&n.isNumber(e.maxSize)?(g=k.pt2px(e.minSize),f=k.pt2px(e.maxSize)):(f=c.scale,g=k.pt2px(p(f,e.minSize.stops)),f=k.pt2px(p(f,e.maxSize.stops))));this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,g,f])}d.scaleStops&&(this.vvSizeScaleStopsValue=k.pt2px(p(c.scale,d.scaleStops.stops)));d.unitValue&&(this.vvSizeUnitValueToPixelsRatio=w.getMetersPerUnitForSR(c.spatialReference)/
y.meterIn[d.unitValue.unit]/c.resolution);d.fieldStops&&(this.vvSizeFieldStopsValues.set(d.fieldStops.values),this.vvSizeFieldStopsSizes.set(d.fieldStops.sizes))}if(c=a.color)b.vvColorEnabled=!0,this.vvColorValues.set(c.values),this.vvColors.set(c.colors);if(c=a.opacity)b.vvOpacityEnabled=!0,this.vvOpacityValues.set(c.values),this.vvOpacities.set(c.opacities);if(a=a.rotation)b.vvRotationEnabled=!0,b.vvRotationType=a.type}};d.prototype._updateDotDensityInfo=function(a){var c=a.attributes;this.ddDotValue=
a.dotValue;this.ddDotScale=a.referenceScale;this.ddDotSize=a.dotSize;this.ddDotBlending=a.dotBlendingEnabled;this.ddSeed=a.seed;for(var b=0;b<m.DOT_DENSITY_MAX_FIELDS;b++){var d=b>=c.length?new u([0,0,0,0]):c[b].color;t(this.ddColors,d,4*b)}for(b=0;8>b;b++)this.ddActiveDots[b]=b<a.attributes.length?1:0;t(this.ddBackgroundColor,a.backgroundColor)};return d}();r.WGLRendererInfo=q});