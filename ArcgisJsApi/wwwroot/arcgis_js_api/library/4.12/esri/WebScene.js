// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(r,d,p){Object.defineProperty(d,"__esModule",{value:!0});d.updateOrigins=function(f){f&&f.writtenProperties&&f.writtenProperties.forEach(function(f){var d=f.target;f.newOrigin&&f.oldOrigin!==f.newOrigin&&d.isInstanceOf(p)&&d.updateOrigin(f.propName,f.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(r,d,p){Object.defineProperty(d,
"__esModule",{value:!0});d.createCopyError=function(){return new p("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};d.isCopyError=function(f){return f&&"webscene:failed-to-copy-embedded-resources"===f.name};d.createSchemaValidationError=function(f){return new p("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:f})};d.isSchemaValidationError=function(f){return f&&
"webscene:schema-validation"===f.name}})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ./mathUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(r,d,p,f,m,h,g,l,q,a,b,c,e,w,n){function k(a,b,c,e){2===a.length?(v[0]=a[0],v[1]=a[1],v[2]=0,a=v):a===c&&(g.vec3.copy(v,a),a=v);return P(a,b,0,c,e,0,1)}function P(a,b,c,e,t,k,n){void 0===n&&(n=1);b=B(b,t,Z).projector;if(f.isNone(b))return!1;if(b===C){if(a===e&&c===k)return!0;for(b=c+3*n;c<b;c++,k++)e[k]=a[c];return!0}for(n=c+3*n;c<n;c+=3,k+=3)b(a,c,e,k);return!0}function S(a,b){if(b.spatialReference===a)return b.spatialReferenceId;b.spatialReference=a;"metersPerUnit"in b&&(b.metersPerUnit=
m.getMetersPerUnitForSR(a,1));return a.wkt===d.SphericalECEFSpatialReference.wkt?b.spatialReferenceId=1:a.isWGS84?b.spatialReferenceId=2:a.isWebMercator?b.spatialReferenceId=3:a.wkt===d.WGS84ECEFSpatialReference.wkt?b.spatialReferenceId=4:4490===a.wkid?b.spatialReferenceId=5:b.spatialReferenceId=0}function C(a,b,c,e){c[e++]=a[b++];c[e++]=a[b++];c[e]=a[b]}function aa(a,b,c,t){c[t++]=U*(a[b++]/e.earthRadius);c[t++]=U*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/e.earthRadius)));c[t]=a[b]}function X(a,
b,c,t){var M=.4999999*Math.PI,M=p.clamp(R*a[b+1],-M,M),M=Math.sin(M);c[t++]=R*a[b]*e.earthRadius;c[t++]=e.halfEarthRadius*Math.log((1+M)/(1-M));c[t]=a[b+2]}function D(a,b,c){b=S(b,Q);b=J[b][6];if(f.isNone(b))return!1;b(a,0,v,0);c!==v&&(c[0]=v[0],c[1]=v[1],2<c.length&&(c[2]=v[2]));return!0}function E(a,b){v[0]=a.x;v[1]=a.y;v[2]=a.hasZ?a.z:0;return D(v,a.spatialReference,b)}function u(a,b,c,t){var k=e.earthRadius+a[b+2],n=R*a[b+1];a=R*a[b];b=Math.cos(n);c[t++]=Math.cos(a)*b*k;c[t++]=Math.sin(a)*b*k;
c[t]=Math.sin(n)*k}function N(a,b,c,t){var k=n.Vec3Compact.length(a,b),M=w.asin(a[b+2]/(0===k?1:k)),f=Math.cos(M)*k;a=(0<a[b+1]?1:-1)*w.acos(a[b]/(0===f?1:f));c[t++]=U*a;c[t++]=U*M;c[t]=k-e.earthRadius}function x(a,b,c,e){var t=ca,k=R*a[b],n=R*a[b+1];a=a[b+2];b=Math.sin(n);var n=Math.cos(n),w=t.a/Math.sqrt(1-t.e2*b*b);c[e++]=(w+a)*n*Math.cos(k);c[e++]=(w+a)*n*Math.sin(k);c[e++]=(w*(1-t.e2)+a)*b}function O(a,b,c,e){var t=ca,k=a[b],n=a[b+1];a=a[b+2];var w,f,M,d,T,P;b=Math.abs(a);w=k*k+n*n;f=Math.sqrt(w);
M=w+a*a;d=Math.sqrt(M);k=Math.atan2(n,k);T=a*a/M;M=w/M;n=t.a2/d;w=t.a3-t.a4/d;.3<M?(T=b/d*(1+M*(t.a1+n+T*w)/d),d=Math.asin(T),n=T*T,M=Math.sqrt(1-n)):(M=f/d*(1-T*(t.a5-n-M*w)/d),d=Math.acos(M),n=1-M*M,T=Math.sqrt(n));P=1-t.e2*n;n=t.a/Math.sqrt(P);t=t.a6*n;n=f-n*M;w=b-t*T;b=M*n+T*w;f=M*w-T*n;t=f/(t/P+b);d+=t;0>a&&(d=-d);c[e++]=U*k;c[e++]=U*d;c[e]=b+f*t/2}function B(a,b,c){if(c.source.spatialReference===a&&c.dest.spatialReference===b)return c;var e=S(a,c.source),t=S(b,c.dest);0===e&&0===t?a.equals(b)?
c.projector=C:c.projector=null:c.projector=J[e][t];return c}Object.defineProperty(d,"__esModule",{value:!0});var y,z,A,F,K,G,L,H;d.SphericalECEFSpatialReference=new a({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});d.WGS84ECEFSpatialReference=new a({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});
d.canProject=function(a,b){return!!B(a,b,Z).projector};d.vectorToVector=k;d.pointToPoint=function(a,b,c,e){void 0===c&&(c=b.spatialReference);void 0===e&&(e=0);v[0]=a.x;v[1]=a.y;var t=a.z;v[2]=void 0!==t?t:e;if(!P(v,a.spatialReference,0,v,c,0,1))return!1;b.x=v[0];b.y=v[1];b.spatialReference=c;void 0!==t?(b.z=v[2],b.hasZ=!0):(b.z=void 0,b.hasZ=!1);return!0};d.pointToVector=function(a,b,c,e){void 0===e&&(e=0);v[0]=a.x;v[1]=a.y;var t=a.z;v[2]=void 0!==t?t:e;return P(v,a.spatialReference,0,b,c,0,1)};
d.vectorToPoint=function(a,b,e,t){e instanceof q?t=t||e.spatialReference:c.isPoint(e)?(e.hasZ=!0,t=t||e.spatialReference):(t=e,e=new q({spatialReference:t}));return P(a,b,0,v,t,0,1)?(e.x=v[0],e.y=v[1],e.z=v[2],e.spatialReference=t,e):null};d.xyzToVector=function(a,b,c,e,t,n){v[0]=a;v[1]=b;v[2]=c;return P(v,e,0,t,n,0,1)};d.bufferToBuffer=P;d.computeLinearTransformation=function(a,b,c,e){var n=S(a,Q),k=S(e,I);if(n===k&&1!==k&&(0!==n||a.equals(e)))return h.mat4.identity(c),h.mat4.translate(c,c,b),!0;
if(1===k){a=J[n][6];k=J[6][k];if(f.isNone(a)||f.isNone(k))return!1;a(b,0,V,0);k(V,0,t,0);a=R*V[0];k=R*V[1];b=Math.sin(a);a=Math.cos(a);e=Math.sin(k);k=Math.cos(k);c[0]=-b;c[4]=-e*a;c[8]=k*a;c[12]=t[0];c[1]=a;c[5]=-e*b;c[9]=k*b;c[13]=t[1];c[2]=0;c[6]=k;c[10]=e;c[14]=t[2];c[3]=0;c[7]=0;c[11]=0;c[15]=1;return!0}if(3===k&&(2===n||1===n)){a=J[n][6];k=J[6][3];if(f.isNone(a)||f.isNone(k))return!1;a(b,0,V,0);b=R*V[1];k(V,0,t,0);h.mat4.identity(c);h.mat4.translate(c,c,t);b=1/Math.cos(b);h.mat4.scale(c,c,[b,
b,1]);return!0}return!1};d.transformDirection=function(a,b,c,e,t){g.vec3.copy(W,a);g.vec3.add(ba,a,b);k(W,c,W,t);k(ba,c,ba,t);g.vec3.subtract(e,ba,W);g.vec3.normalize(e,e)};d.mbsToMbs=function(a,b,c,t){b=B(b,t,Y);if(b.projector===C)return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],!0;if(f.isNone(b.projector))return!1;t=b.source;var k=b.dest;if(3===k.spatialReferenceId){b=J[t.spatialReferenceId][2];if(f.isNone(b))return!1;b(a,0,V,0);b=Math.abs(R*V[1])+Math.asin(a[3]/(e.earthRadius+a[2]));X(V,0,c,0);c[3]=
b>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(b)*a[3];return!0}b.projector(a,0,c,0);c[3]=a[3]*t.metersPerUnit/k.metersPerUnit;return!0};d.extentToBoundingBox=function(a,b,c){if(null==a)return!1;var e;v[0]=null!=a.xmin?a.xmin:0;v[1]=null!=a.ymin?a.ymin:0;v[2]=null!=a.zmin?a.zmin:0;e=P(v,a.spatialReference,0,b,c,0,1);v[0]=null!=a.xmax?a.xmax:0;v[1]=null!=a.ymax?a.ymax:0;v[2]=null!=a.zmax?a.zmax:0;e=e&&P(v,a.spatialReference,0,b,c,3,1);null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==
a.zmin&&(b[2]=-Infinity);null==a.xmax&&(b[3]=Infinity);null==a.ymax&&(b[4]=Infinity);null==a.zmax&&(b[5]=Infinity);return e};d.extentToBoundingRect=function(a,b,c){if(null==a)return!1;var e;v[0]=null!=a.xmin?a.xmin:0;v[1]=null!=a.ymin?a.ymin:0;v[2]=null!=a.zmin?a.zmin:0;e=P(v,a.spatialReference,0,v,c,0,1);b[0]=v[0];b[1]=v[1];v[0]=null!=a.xmax?a.xmax:0;v[1]=null!=a.ymax?a.ymax:0;v[2]=null!=a.zmax?a.zmax:0;e=e&&P(v,a.spatialReference,0,v,c,0,1);b[2]=v[0];b[3]=v[1];null==a.xmin&&(b[0]=-Infinity);null==
a.ymin&&(b[1]=-Infinity);null==a.xmax&&(b[2]=Infinity);null==a.ymax&&(b[3]=Infinity);return e};d.boundingRectToBoundingRect=function(a,c,e,t){if(null==a)return!1;if(c.equals(t))return b.set(e,a),!0;var k;v[0]=a[0];v[1]=a[1];v[2]=0;k=P(v,c,0,v,t,0,1);e[0]=v[0];e[1]=v[1];v[0]=a[2];v[1]=a[3];v[2]=0;k=k&&P(v,c,0,v,t,0,1);e[2]=v[0];e[3]=v[1];return k};(function(a){a.x2lon=function(a){return a/e.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/e.earthRadius))};a.lon2x=function(a){return a*
e.earthRadius};a.lat2y=function(a){a=Math.sin(a);return e.earthRadius/2*Math.log((1+a)/(1-a))}})(d.webMercator||(d.webMercator={}));d.canProjectToWGS84ComparableLonLat=function(a){a=S(a,Q);return!!J[a][6]};d.vectorToWGS84ComparableLonLat=D;d.pointToWGS84ComparableLonLat=E;d.pointToWGS84ComparableLonLatPoint=function(a,b){var c=S(b.spatialReference,I);return f.isNone(J[6][c])?!1:E(a,v)?(b.x=v[0],b.y=v[1],b.z=v[2],!0):!1};d.wgs84ComparableLonLatToECEF=function(a,b,c,t){void 0===t&&(t=0);t=e.earthRadius+
t;var k=Math.cos(c);a[0]=Math.cos(b)*k*t;a[1]=Math.sin(b)*k*t;a[2]=Math.sin(c)*t};var J=(y={},y[2]=(z={},z[5]=null,z[6]=C,z[1]=u,z[0]=null,z[3]=X,z[2]=C,z[4]=x,z),y[5]=(A={},A[5]=C,A[6]=C,A[1]=u,A[0]=null,A[3]=null,A[2]=null,A[4]=x,A),y[3]=(F={},F[5]=null,F[6]=aa,F[1]=function(a,b,c,e){aa(a,b,c,e);u(c,e,c,e)},F[0]=null,F[3]=C,F[2]=aa,F[4]=function(a,b,c,e){aa(a,b,c,e);x(c,e,c,e)},F),y[4]=(K={},K[5]=O,K[6]=O,K[1]=function(a,b,c,e){O(a,b,c,e);u(c,e,c,e)},K[0]=null,K[3]=function(a,b,c,e){O(a,b,c,e);
X(c,e,c,e)},K[2]=O,K[4]=C,K),y[1]=(G={},G[5]=N,G[6]=N,G[1]=C,G[0]=null,G[3]=function(a,b,c,e){N(a,b,c,e);X(c,e,c,e)},G[2]=N,G[4]=function(a,b,c,e){N(a,b,c,e);x(c,e,c,e)},G),y[0]=(L={},L[5]=null,L[6]=null,L[1]=null,L[0]=C,L[3]=null,L[2]=null,L[4]=null,L),y[6]=(H={},H[5]=null,H[6]=C,H[1]=u,H[0]=null,H[3]=null,H[2]=C,H[4]=x,H),y),Q={spatialReference:null,spatialReferenceId:0},I={spatialReference:null,spatialReferenceId:0},Z={source:{spatialReference:null,spatialReferenceId:0},dest:{spatialReference:null,
spatialReferenceId:0},projector:C},Y={source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:C},R=w.deg2rad(1),U=w.rad2deg(1),ca={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},v=l.vec3f64.create(),V=l.vec3f64.create(),t=l.vec3f64.create(),W=l.vec3f64.create(),ba=l.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require",
"exports","./math/mat4"],function(r,d,p){Object.defineProperty(d,"__esModule",{value:!0});d.mat4=p})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(r,d,p,f){function m(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function h(a,b,c){var e=b[0],w=b[1],n=b[2],k=b[3],f=b[4],d=b[5],C=b[6],h=b[7],g=b[8],l=b[9],m=b[10],u=b[11],q=b[12],p=b[13],r=b[14];
b=b[15];var B=c[0],y=c[1],z=c[2],A=c[3];a[0]=B*e+y*f+z*g+A*q;a[1]=B*w+y*d+z*l+A*p;a[2]=B*n+y*C+z*m+A*r;a[3]=B*k+y*h+z*u+A*b;B=c[4];y=c[5];z=c[6];A=c[7];a[4]=B*e+y*f+z*g+A*q;a[5]=B*w+y*d+z*l+A*p;a[6]=B*n+y*C+z*m+A*r;a[7]=B*k+y*h+z*u+A*b;B=c[8];y=c[9];z=c[10];A=c[11];a[8]=B*e+y*f+z*g+A*q;a[9]=B*w+y*d+z*l+A*p;a[10]=B*n+y*C+z*m+A*r;a[11]=B*k+y*h+z*u+A*b;B=c[12];y=c[13];z=c[14];A=c[15];a[12]=B*e+y*f+z*g+A*q;a[13]=B*w+y*d+z*l+A*p;a[14]=B*n+y*C+z*m+A*r;a[15]=B*k+y*h+z*u+A*b;return a}function g(a,b,c){var e=
b[0],w=b[1],n=b[2],k=b[3],f=e+e,d=w+w,C=n+n;b=e*f;var h=e*d,e=e*C,g=w*d,w=w*C,n=n*C,f=k*f,d=k*d,k=k*C;a[0]=1-(g+n);a[1]=h+k;a[2]=e-d;a[3]=0;a[4]=h-k;a[5]=1-(b+n);a[6]=w+f;a[7]=0;a[8]=e+d;a[9]=w-f;a[10]=1-(b+g);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a}function l(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];a[9]=b[9]-c[9];a[10]=b[10]-c[10];a[11]=b[11]-c[11];a[12]=b[12]-c[12];a[13]=b[13]-
c[13];a[14]=b[14]-c[14];a[15]=b[15]-c[15];return a}Object.defineProperty(d,"__esModule",{value:!0});d.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};d.set=function(a,b,c,e,w,n,k,f,d,C,h,g,l,m,q,p,x){a[0]=b;a[1]=c;a[2]=e;a[3]=w;a[4]=n;a[5]=k;a[6]=f;a[7]=d;a[8]=C;a[9]=h;a[10]=g;a[11]=l;a[12]=m;a[13]=q;a[14]=p;a[15]=x;return a};d.identity=m;d.transpose=
function(a,b){if(a===b){var c=b[1],e=b[2],w=b[3],n=b[6],k=b[7],f=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=e;a[9]=n;a[11]=b[14];a[12]=w;a[13]=k;a[14]=f}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};d.invert=function(a,b){var c=b[0],e=b[1],w=b[2],n=b[3],k=b[4],f=b[5],d=b[6],C=b[7],h=b[8],g=b[9],l=b[10],m=b[11],q=b[12],p=b[13],x=b[14];
b=b[15];var r=c*f-e*k,B=c*d-w*k,y=c*C-n*k,z=e*d-w*f,A=e*C-n*f,F=w*C-n*d,K=h*p-g*q,G=h*x-l*q,L=h*b-m*q,H=g*x-l*p,J=g*b-m*p,Q=l*b-m*x,I=r*Q-B*J+y*H+z*L-A*G+F*K;if(!I)return null;I=1/I;a[0]=(f*Q-d*J+C*H)*I;a[1]=(w*J-e*Q-n*H)*I;a[2]=(p*F-x*A+b*z)*I;a[3]=(l*A-g*F-m*z)*I;a[4]=(d*L-k*Q-C*G)*I;a[5]=(c*Q-w*L+n*G)*I;a[6]=(x*y-q*F-b*B)*I;a[7]=(h*F-l*y+m*B)*I;a[8]=(k*J-f*L+C*K)*I;a[9]=(e*L-c*J-n*K)*I;a[10]=(q*A-p*y+b*r)*I;a[11]=(g*y-h*A-m*r)*I;a[12]=(f*G-k*H-d*K)*I;a[13]=(c*H-e*G+w*K)*I;a[14]=(p*B-q*z-x*r)*I;
a[15]=(h*z-g*B+l*r)*I;return a};d.adjoint=function(a,b){var c=b[0],e=b[1],f=b[2],n=b[3],k=b[4],d=b[5],h=b[6],g=b[7],l=b[8],m=b[9],q=b[10],p=b[11],u=b[12],r=b[13],x=b[14];b=b[15];a[0]=d*(q*b-p*x)-m*(h*b-g*x)+r*(h*p-g*q);a[1]=-(e*(q*b-p*x)-m*(f*b-n*x)+r*(f*p-n*q));a[2]=e*(h*b-g*x)-d*(f*b-n*x)+r*(f*g-n*h);a[3]=-(e*(h*p-g*q)-d*(f*p-n*q)+m*(f*g-n*h));a[4]=-(k*(q*b-p*x)-l*(h*b-g*x)+u*(h*p-g*q));a[5]=c*(q*b-p*x)-l*(f*b-n*x)+u*(f*p-n*q);a[6]=-(c*(h*b-g*x)-k*(f*b-n*x)+u*(f*g-n*h));a[7]=c*(h*p-g*q)-k*(f*p-
n*q)+l*(f*g-n*h);a[8]=k*(m*b-p*r)-l*(d*b-g*r)+u*(d*p-g*m);a[9]=-(c*(m*b-p*r)-l*(e*b-n*r)+u*(e*p-n*m));a[10]=c*(d*b-g*r)-k*(e*b-n*r)+u*(e*g-n*d);a[11]=-(c*(d*p-g*m)-k*(e*p-n*m)+l*(e*g-n*d));a[12]=-(k*(m*x-q*r)-l*(d*x-h*r)+u*(d*q-h*m));a[13]=c*(m*x-q*r)-l*(e*x-f*r)+u*(e*q-f*m);a[14]=-(c*(d*x-h*r)-k*(e*x-f*r)+u*(e*h-f*d));a[15]=c*(d*q-h*m)-k*(e*q-f*m)+l*(e*h-f*d);return a};d.determinant=function(a){var b=a[0],c=a[1],e=a[2],f=a[3],n=a[4],k=a[5],d=a[6],h=a[7],g=a[8],l=a[9],m=a[10],q=a[11],p=a[12],u=a[13],
r=a[14];a=a[15];return(b*k-c*n)*(m*a-q*r)-(b*d-e*n)*(l*a-q*u)+(b*h-f*n)*(l*r-m*u)+(c*d-e*k)*(g*a-q*p)-(c*h-f*k)*(g*r-m*p)+(e*h-f*d)*(g*u-l*p)};d.multiply=h;d.translate=function(a,b,c){var e=c[0],f=c[1];c=c[2];var n=void 0,k=void 0,d=void 0,h=void 0,g=void 0,l=void 0,m=void 0,q=void 0,p=void 0,u=void 0,r=void 0,x=void 0;b===a?(a[12]=b[0]*e+b[4]*f+b[8]*c+b[12],a[13]=b[1]*e+b[5]*f+b[9]*c+b[13],a[14]=b[2]*e+b[6]*f+b[10]*c+b[14],a[15]=b[3]*e+b[7]*f+b[11]*c+b[15]):(n=b[0],k=b[1],d=b[2],h=b[3],g=b[4],l=
b[5],m=b[6],q=b[7],p=b[8],u=b[9],r=b[10],x=b[11],a[0]=n,a[1]=k,a[2]=d,a[3]=h,a[4]=g,a[5]=l,a[6]=m,a[7]=q,a[8]=p,a[9]=u,a[10]=r,a[11]=x,a[12]=n*e+g*f+p*c+b[12],a[13]=k*e+l*f+u*c+b[13],a[14]=d*e+m*f+r*c+b[14],a[15]=h*e+q*f+x*c+b[15]);return a};d.scale=function(a,b,c){var e=c[0],f=c[1];c=c[2];a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*f;a[5]=b[5]*f;a[6]=b[6]*f;a[7]=b[7]*f;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};d.rotate=
function(a,b,c,e){var d=e[0],n=e[1];e=e[2];var k=Math.sqrt(d*d+n*n+e*e),h=void 0,g=void 0,l=void 0,m=void 0,q=void 0,p=void 0,r=void 0,u=void 0,N=void 0,x=void 0,O=void 0,B=void 0,y=void 0,z=void 0,A=void 0,F=void 0,K=void 0,G=void 0,L=void 0,H=void 0,J=void 0,Q=void 0,g=h=void 0;if(k<f.EPSILON)return null;k=1/k;d*=k;n*=k;e*=k;h=Math.sin(c);g=Math.cos(c);l=1-g;m=b[0];q=b[1];p=b[2];r=b[3];u=b[4];N=b[5];x=b[6];O=b[7];B=b[8];y=b[9];z=b[10];A=b[11];F=d*d*l+g;K=n*d*l+e*h;G=e*d*l-n*h;L=d*n*l-e*h;H=n*n*
l+g;J=e*n*l+d*h;Q=d*e*l+n*h;h=n*e*l-d*h;g=e*e*l+g;a[0]=m*F+u*K+B*G;a[1]=q*F+N*K+y*G;a[2]=p*F+x*K+z*G;a[3]=r*F+O*K+A*G;a[4]=m*L+u*H+B*J;a[5]=q*L+N*H+y*J;a[6]=p*L+x*H+z*J;a[7]=r*L+O*H+A*J;a[8]=m*Q+u*h+B*g;a[9]=q*Q+N*h+y*g;a[10]=p*Q+x*h+z*g;a[11]=r*Q+O*h+A*g;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};d.rotateX=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var f=b[4],n=b[5],k=b[6],d=b[7],h=b[8],g=b[9],l=b[10],m=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],
a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=f*c+h*e;a[5]=n*c+g*e;a[6]=k*c+l*e;a[7]=d*c+m*e;a[8]=h*c-f*e;a[9]=g*c-n*e;a[10]=l*c-k*e;a[11]=m*c-d*e;return a};d.rotateY=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var f=b[0],n=b[1],k=b[2],d=b[3],h=b[8],g=b[9],l=b[10],m=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=f*c-h*e;a[1]=n*c-g*e;a[2]=k*c-l*e;a[3]=d*c-m*e;a[8]=f*e+h*c;a[9]=n*e+g*c;a[10]=k*e+l*c;a[11]=d*e+m*c;return a};d.rotateZ=function(a,
b,c){var e=Math.sin(c);c=Math.cos(c);var f=b[0],n=b[1],k=b[2],d=b[3],h=b[4],g=b[5],l=b[6],m=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=f*c+h*e;a[1]=n*c+g*e;a[2]=k*c+l*e;a[3]=d*c+m*e;a[4]=h*c-f*e;a[5]=g*c-n*e;a[6]=l*c-k*e;a[7]=m*c-d*e;return a};d.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};d.fromScaling=function(a,
b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromRotation=function(a,b,c){var e=c[0],d=c[1];c=c[2];var n=Math.sqrt(e*e+d*d+c*c),k=void 0,h=void 0,g=void 0;if(n<f.EPSILON)return null;n=1/n;e*=n;d*=n;c*=n;k=Math.sin(b);h=Math.cos(b);g=1-h;a[0]=e*e*g+h;a[1]=d*e*g+c*k;a[2]=c*e*g-d*k;a[3]=0;a[4]=e*d*g-c*k;a[5]=d*d*g+h;a[6]=c*d*g+e*k;a[7]=0;a[8]=e*c*g+d*k;a[9]=d*c*g-e*k;a[10]=c*c*g+h;a[11]=0;a[12]=0;a[13]=0;
a[14]=0;a[15]=1;return a};d.fromXRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=c;a[7]=0;a[8]=0;a[9]=-c;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-c;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=c;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=0;a[4]=
-c;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromRotationTranslation=g;d.fromQuat2=function(a,b){var c=q,e=-b[0],f=-b[1],n=-b[2],k=b[3],d=b[4],h=b[5],l=b[6],m=b[7],p=e*e+f*f+n*n+k*k;0<p?(c[0]=2*(d*k+m*e+h*n-l*f)/p,c[1]=2*(h*k+m*f+l*e-d*n)/p,c[2]=2*(l*k+m*n+d*f-h*e)/p):(c[0]=2*(d*k+m*e+h*n-l*f),c[1]=2*(h*k+m*f+l*e-d*n),c[2]=2*(l*k+m*n+d*f-h*e));g(a,b,c);return a};var q=p.create();d.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};
d.getScaling=function(a,b){var c=b[0],e=b[1],f=b[2],d=b[4],k=b[5],h=b[6],g=b[8],l=b[9];b=b[10];a[0]=Math.sqrt(c*c+e*e+f*f);a[1]=Math.sqrt(d*d+k*k+h*h);a[2]=Math.sqrt(g*g+l*l+b*b);return a};d.getRotation=function(a,b){var c=b[0]+b[5]+b[10],e=0;0<c?(e=2*Math.sqrt(c+1),a[3]=.25*e,a[0]=(b[6]-b[9])/e,a[1]=(b[8]-b[2])/e,a[2]=(b[1]-b[4])/e):b[0]>b[5]&&b[0]>b[10]?(e=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/e,a[0]=.25*e,a[1]=(b[1]+b[4])/e,a[2]=(b[8]+b[2])/e):b[5]>b[10]?(e=2*Math.sqrt(1+b[5]-b[0]-b[10]),
a[3]=(b[8]-b[2])/e,a[0]=(b[1]+b[4])/e,a[1]=.25*e,a[2]=(b[6]+b[9])/e):(e=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/e,a[0]=(b[8]+b[2])/e,a[1]=(b[6]+b[9])/e,a[2]=.25*e);return a};d.fromRotationTranslationScale=function(a,b,c,e){var f=b[0],d=b[1],k=b[2],h=b[3],g=f+f,l=d+d,m=k+k;b=f*g;var q=f*l,f=f*m,p=d*l,d=d*m,k=k*m,g=h*g,l=h*l,h=h*m,m=e[0],r=e[1];e=e[2];a[0]=(1-(p+k))*m;a[1]=(q+h)*m;a[2]=(f-l)*m;a[3]=0;a[4]=(q-h)*r;a[5]=(1-(b+k))*r;a[6]=(d+g)*r;a[7]=0;a[8]=(f+l)*e;a[9]=(d-g)*e;a[10]=(1-(b+p))*
e;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};d.fromRotationTranslationScaleOrigin=function(a,b,c,e,f){var d=b[0],k=b[1],h=b[2],g=b[3],l=d+d,m=k+k,q=h+h;b=d*l;var w=d*m,p=d*q,d=k*m,k=k*q,r=h*q,h=g*l,m=g*m,N=g*q,x=e[0],O=e[1],q=e[2];e=f[0];g=f[1];f=f[2];var l=(1-(d+r))*x,B=(w+N)*x,x=(p-m)*x,w=(w-N)*O,r=(1-(b+r))*O,O=(k+h)*O,p=(p+m)*q,k=(k-h)*q;b=(1-(b+d))*q;a[0]=l;a[1]=B;a[2]=x;a[3]=0;a[4]=w;a[5]=r;a[6]=O;a[7]=0;a[8]=p;a[9]=k;a[10]=b;a[11]=0;a[12]=c[0]+e-(l*e+w*g+p*f);a[13]=c[1]+g-(B*
e+r*g+k*f);a[14]=c[2]+f-(x*e+O*g+b*f);a[15]=1;return a};d.fromQuat=function(a,b){var c=b[0],e=b[1],f=b[2];b=b[3];var d=c+c,k=e+e,h=f+f,c=c*d,g=e*d,e=e*k,l=f*d,m=f*k,f=f*h,d=b*d,k=b*k;b*=h;a[0]=1-e-f;a[1]=g+b;a[2]=l-k;a[3]=0;a[4]=g-b;a[5]=1-c-f;a[6]=m+d;a[7]=0;a[8]=l+k;a[9]=m-d;a[10]=1-c-e;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.frustum=function(a,b,c,e,f,d,k){var h=1/(c-b),n=1/(f-e),g=1/(d-k);a[0]=2*d*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*d*n;a[6]=0;a[7]=0;a[8]=(c+b)*h;a[9]=(f+e)*n;a[10]=
(k+d)*g;a[11]=-1;a[12]=0;a[13]=0;a[14]=k*d*2*g;a[15]=0;return a};d.perspective=function(a,b,c,e,f){b=1/Math.tan(b/2);var d=void 0;a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=f&&Infinity!==f?(d=1/(e-f),a[10]=(f+e)*d,a[14]=2*f*e*d):(a[10]=-1,a[14]=-2*e);return a};d.perspectiveFromFieldOfView=function(a,b,c,e){var f=Math.tan(b.upDegrees*Math.PI/180),d=Math.tan(b.downDegrees*Math.PI/180),k=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*
Math.PI/180);var h=2/(k+b),g=2/(f+d);a[0]=h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=g;a[6]=0;a[7]=0;a[8]=-((k-b)*h*.5);a[9]=(f-d)*g*.5;a[10]=e/(c-e);a[11]=-1;a[12]=0;a[13]=0;a[14]=e*c/(c-e);a[15]=0;return a};d.ortho=function(a,b,c,e,f,d,k){var h=1/(b-c),g=1/(e-f),n=1/(d-k);a[0]=-2*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*g;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*n;a[11]=0;a[12]=(b+c)*h;a[13]=(f+e)*g;a[14]=(k+d)*n;a[15]=1;return a};d.lookAt=function(a,b,c,e){var d=void 0,h=void 0,k=void 0,g=void 0,l=void 0,q=void 0,
p=void 0,r=void 0,D=void 0,E=void 0,u=b[0],N=b[1];b=b[2];k=e[0];g=e[1];e=e[2];p=c[0];r=c[1];c=c[2];if(Math.abs(u-p)<f.EPSILON&&Math.abs(N-r)<f.EPSILON&&Math.abs(b-c)<f.EPSILON)return m(a);p=u-p;r=N-r;D=b-c;E=1/Math.sqrt(p*p+r*r+D*D);p*=E;r*=E;D*=E;d=g*D-e*r;h=e*p-k*D;k=k*r-g*p;(E=Math.sqrt(d*d+h*h+k*k))?(E=1/E,d*=E,h*=E,k*=E):k=h=d=0;g=r*k-D*h;l=D*d-p*k;q=p*h-r*d;(E=Math.sqrt(g*g+l*l+q*q))?(E=1/E,g*=E,l*=E,q*=E):q=l=g=0;a[0]=d;a[1]=g;a[2]=p;a[3]=0;a[4]=h;a[5]=l;a[6]=r;a[7]=0;a[8]=k;a[9]=q;a[10]=D;
a[11]=0;a[12]=-(d*u+h*N+k*b);a[13]=-(g*u+l*N+q*b);a[14]=-(p*u+r*N+D*b);a[15]=1;return a};d.targetTo=function(a,b,c,e){var f=b[0],d=b[1];b=b[2];var k=e[0],h=e[1],g=e[2];e=f-c[0];var l=d-c[1];c=b-c[2];var m=e*e+l*l+c*c;0<m&&(m=1/Math.sqrt(m),e*=m,l*=m,c*=m);var q=h*c-g*l,g=g*e-k*c,k=k*l-h*e,m=q*q+g*g+k*k;0<m&&(m=1/Math.sqrt(m),q*=m,g*=m,k*=m);a[0]=q;a[1]=g;a[2]=k;a[3]=0;a[4]=l*k-c*g;a[5]=c*q-e*k;a[6]=e*g-l*q;a[7]=0;a[8]=e;a[9]=l;a[10]=c;a[11]=0;a[12]=f;a[13]=d;a[14]=b;a[15]=1;return a};d.str=function(a){return"mat4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};d.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};d.add=function(a,b,
c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];a[9]=b[9]+c[9];a[10]=b[10]+c[10];a[11]=b[11]+c[11];a[12]=b[12]+c[12];a[13]=b[13]+c[13];a[14]=b[14]+c[14];a[15]=b[15]+c[15];return a};d.subtract=l;d.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12]*c;a[13]=b[13]*c;a[14]=b[14]*
c;a[15]=b[15]*c;return a};d.multiplyScalarAndAdd=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;a[2]=b[2]+c[2]*e;a[3]=b[3]+c[3]*e;a[4]=b[4]+c[4]*e;a[5]=b[5]+c[5]*e;a[6]=b[6]+c[6]*e;a[7]=b[7]+c[7]*e;a[8]=b[8]+c[8]*e;a[9]=b[9]+c[9]*e;a[10]=b[10]+c[10]*e;a[11]=b[11]+c[11]*e;a[12]=b[12]+c[12]*e;a[13]=b[13]+c[13]*e;a[14]=b[14]+c[14]*e;a[15]=b[15]+c[15]*e;return a};d.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&
a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};d.equals=function(a,b){var c=a[0],e=a[1],d=a[2],g=a[3],k=a[4],h=a[5],l=a[6],m=a[7],q=a[8],p=a[9],r=a[10],E=a[11],u=a[12],N=a[13],x=a[14];a=a[15];var O=b[0],B=b[1],y=b[2],z=b[3],A=b[4],F=b[5],K=b[6],G=b[7],L=b[8],H=b[9],J=b[10],Q=b[11],I=b[12],Z=b[13],Y=b[14];b=b[15];return Math.abs(c-O)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(e-B)<=f.EPSILON*Math.max(1,Math.abs(e),Math.abs(B))&&
Math.abs(d-y)<=f.EPSILON*Math.max(1,Math.abs(d),Math.abs(y))&&Math.abs(g-z)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(k-A)<=f.EPSILON*Math.max(1,Math.abs(k),Math.abs(A))&&Math.abs(h-F)<=f.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(l-K)<=f.EPSILON*Math.max(1,Math.abs(l),Math.abs(K))&&Math.abs(m-G)<=f.EPSILON*Math.max(1,Math.abs(m),Math.abs(G))&&Math.abs(q-L)<=f.EPSILON*Math.max(1,Math.abs(q),Math.abs(L))&&Math.abs(p-H)<=f.EPSILON*Math.max(1,Math.abs(p),Math.abs(H))&&Math.abs(r-
J)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(J))&&Math.abs(E-Q)<=f.EPSILON*Math.max(1,Math.abs(E),Math.abs(Q))&&Math.abs(u-I)<=f.EPSILON*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(N-Z)<=f.EPSILON*Math.max(1,Math.abs(N),Math.abs(Z))&&Math.abs(x-Y)<=f.EPSILON*Math.max(1,Math.abs(x),Math.abs(Y))&&Math.abs(a-b)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};d.mul=h;d.sub=l})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./mathUtils ./projectionUtils".split(" "),
function(r,d,p,f,m,h,g,l){function q(a,b,c,e){var f,k;a instanceof h&&b instanceof h&&(c=b.longitude,e=b.latitude,k=a.latitude,f=a.longitude);a=g.deg2rad(k);e=g.deg2rad(e);f=g.deg2rad(f);b=g.deg2rad(c);c=Math.sin((a-e)/2);f=Math.sin((f-b)/2);c=2*g.asin(Math.sqrt(c*c+Math.cos(a)*Math.cos(e)*f*f))*d.earthRadius;return Math.round(1E4*c)/1E4}function a(a,b,c){a=c/d.earthRadius;b=g.deg2rad(b);a=Math.sin(a/2);b=Math.cos(b);b=2*g.asin(Math.sqrt(a*a/(b*b)));return g.rad2deg(b)}function b(a,b,c){return g.rad2deg(c/
d.earthRadius)}function c(a,b){a/=15;b||(a=Math.round(a));return a}Object.defineProperty(d,"__esModule",{value:!0});d.earthRadius=p.wgs84Radius;d.halfEarthRadius=d.earthRadius/2;d.halfEarthCircumference=Math.PI*d.earthRadius;d.earthCircumference=2*d.halfEarthCircumference;d.metersPerDegree=d.halfEarthCircumference/180;d.getGreatCircleDistance=q;d.getGreatCircleSpanAt=function(a,b,c){var e=b.spatialReference,f=new h(b.x,a.y,e),d=new h(c.x,a.y,e);b=new h(a.x,b.y,e);a=new h(a.x,c.y,e);return{lon:q(f,
d),lat:q(b,a)}};d.getLonDeltaForDistance=a;d.getLatDeltaForDistance=b;d.getLatLonDeltaForDistance=function(c,e,f){return{lat:b(c,e,f),lon:a(c,e,f)}};d.getMaxCameraAltitude=function(a){a=g.deg2rad(a/2);return(1-Math.sin(a))*d.earthRadius/Math.sin(a)};d.getViewExtentDistance=function(a,b){b=g.deg2rad(b/2);return 2*g.acos((Math.pow(a+d.earthRadius,2)+Math.pow(d.earthRadius,2)-Math.pow((a+d.earthRadius)*Math.cos(b)-Math.sqrt(Math.pow(Math.cos(b)*(a+d.earthRadius),2)-a*a-2*a*d.earthRadius),2))/(2*(a+d.earthRadius)*
d.earthRadius))*d.earthRadius};d.computeCartesianDistance=function(a,b){a=l.wgs84ComparableLonLatToECEF(e,a.longitude,a.latitude,a.z||0);b=l.wgs84ComparableLonLatToECEF(w,b.longitude,b.latitude,b.z||0);b=[b[0]-a[0],b[1]-a[1],b[2]-a[2]];return Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])};d.longitudeToTimezone=c;d.positionToTimezone=function(a,b){b||(b={hours:0,minutes:0,seconds:0});b.hours=c(a[0],!0);a=b.hours%1;b.hours-=a;b.minutes=60*a;a=b.minutes%1;b.minutes-=a;b.seconds=Math.round(60*a);return b};
d.distanceToIdealHorizon=function(a,b){b=b||d.earthRadius;a=f.vec3.dot(a,a);return Math.sqrt(Math.abs(a-b*b))};var e=m.vec3f64.create(),w=m.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(r,d){Object.defineProperty(d,"__esModule",{value:!0});(function(d){d.length=function(f,d){var h=f[d],g=f[d+1];f=f[d+2];return Math.sqrt(h*h+g*g+f*f)};d.normalize=function(f,d){var h=f[d],g=f[d+1],l=f[d+2],h=1/Math.sqrt(h*h+g*g+l*l);f[d]*=h;f[d+
1]*=h;f[d+2]*=h};d.scale=function(f,d,h){f[d]*=h;f[d+1]*=h;f[d+2]*=h};d.add=function(d,m,h,g,l,q){void 0===q&&(q=m);l=l||d;l[q]=d[m]+h[g];l[q+1]=d[m+1]+h[g+1];l[q+2]=d[m+2]+h[g+2]};d.subtract=function(d,m,h,g,l,q){void 0===q&&(q=m);l=l||d;l[q]=d[m]-h[g];l[q+1]=d[m+1]-h[g+1];l[q+2]=d[m+2]-h[g+2]}})(d.Vec3Compact||(d.Vec3Compact={}))})},"esri/views/support/spatialReferenceSupport":function(){define(["require","exports"],function(r,d){Object.defineProperty(d,"__esModule",{value:!0});d.isSpatialReferenceSupported=
function(d,f){return null==d?!1:"2d"===f?!0:"local"===f?!d.isGeographic:d.isWebMercator||d.isWGS84||4490===d.wkid}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),function(r,d,p,f,m,h,g){return function(d){function l(a){a=d.call(this,a)||this;a.viewing=null;return a}p(l,d);a=l;l.prototype.clone=
function(){return new a({viewing:this.viewing?this.viewing.clone():null})};var a;f([h.property({type:g,json:{write:!0}})],l.prototype,"viewing",void 0);return l=a=f([h.subclass("esri.webscene.ApplicationProperties")],l)}(h.declared(m))})},"esri/webdoc/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),function(r,
d,p,f,m,h,g,l){return function(d){function a(a){a=d.call(this,a)||this;a.search=null;return a}p(a,d);b=a;a.prototype.clone=function(){return new b(h.clone({search:this.search}))};var b;f([g.property({type:l,json:{write:!0}})],a.prototype,"search",void 0);return a=b=f([g.subclass("esri.webdoc.applicationProperties.Viewing")],a)}(g.declared(m))})},"esri/webdoc/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(r,d,p,f,m,h,g,l,q){var a=m.ofType(q);return function(b){function c(c){c=b.call(this,c)||this;c.addressSearchEnabled=!0;c.enabled=!0;c.hintText=null;c.layers=new a;return c}p(c,b);e=c;c.prototype.readAddressSearchEnabled=function(a,b){return!a};c.prototype.writeAddressSearchEnabled=function(a,b,c){b[c]=!a};c.prototype.clone=function(){return new e(g.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var e;f([l.property({type:Boolean,
json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"addressSearchEnabled",void 0);f([l.reader("addressSearchEnabled")],c.prototype,"readAddressSearchEnabled",null);f([l.writer("addressSearchEnabled")],c.prototype,"writeAddressSearchEnabled",null);f([l.property({type:Boolean,json:{write:!0,default:!0}})],c.prototype,"enabled",void 0);f([l.property({type:String,json:{write:!0}})],c.prototype,"hintText",void 0);
f([l.property({type:a,json:{write:{enabled:!0,isRequired:!0}}})],c.prototype,"layers",void 0);return c=e=f([l.subclass("esri.webdoc.applicationProperties.Search")],c)}(l.declared(h))})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),function(r,
d,p,f,m,h,g,l,q){return function(a){function b(b){b=a.call(this,b)||this;b.field=null;b.id=null;b.subLayer=null;return b}p(b,a);c=b;b.prototype.clone=function(){return new c(h.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var c;f([g.property({type:q,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"field",void 0);f([g.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"id",void 0);f([g.property({type:l.Integer,json:{write:!0}})],b.prototype,"subLayer",
void 0);return b=c=f([g.subclass("esri.webdoc.applicationProperties.SearchLayer")],b)}(g.declared(m))})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(r,d,p,f,m,h,g){return function(d){function l(a){a=d.call(this,a)||this;a.exactMatch=!1;a.name=null;a.type=null;return a}
p(l,d);a=l;l.prototype.clone=function(){return new a({exactMatch:this.exactMatch,type:this.type,name:this.name})};var a;f([h.property({type:Boolean,json:{write:!0}})],l.prototype,"exactMatch",void 0);f([h.property({type:String,json:{write:!0}})],l.prototype,"name",void 0);f([h.enumeration.serializable()(g.kebabDict)],l.prototype,"type",void 0);return l=a=f([h.subclass("esri.webdoc.applicationProperties.SearchLayerField")],l)}(h.declared(m))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(r,d,p,f,m,h,g,l,q){var a=function(a,c,e){return{enabled:!e||!e.isPresentation}};return function(b){function c(a){a=b.call(this,a)||this;a.lighting=new l;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}p(c,b);e=c;c.prototype.clone=function(){return new e(this.cloneConstructProperties())};c.prototype.cloneConstructProperties=function(){return{lighting:l.prototype.clone.call(this.lighting),background:h.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var e;f([g.property({type:l,json:{write:!0}})],c.prototype,"lighting",void 0);f([g.property(q.backgroundProperty)],c.prototype,"background",void 0);f([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],c.prototype,"atmosphereEnabled",void 0);f([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],c.prototype,"starsEnabled",void 0);return c=e=f([g.subclass("esri.webscene.Environment")],c)}(g.declared(m))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(r,d,p,f,m,h){return function(d){function g(a){a=d.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}p(g,d);m=g;g.prototype.readDate=function(a,b){return null!=b.datetime&&new Date(b.datetime)||null};g.prototype.writeDate=function(a,b,c){b[c]=a.getTime()};g.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};g.prototype.writedirectShadowsEnabled=function(a,b,c){a&&(b[c]=a)};g.prototype.writeDisplayUTCOffset=function(a,b){null!=
a&&(b.displayUTCOffset=a)};g.prototype.clone=function(){return new m(this.cloneConstructProperties())};g.prototype.cloneConstructProperties=function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var m;f([h.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],g.prototype,"date",void 0);f([h.reader("date",["datetime"])],g.prototype,"readDate",
null);f([h.writer("date")],g.prototype,"writeDate",null);f([h.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],g.prototype,"directShadowsEnabled",void 0);f([h.reader("directShadowsEnabled",["directShadows"])],g.prototype,"readDirectShadowsEnabled",null);f([h.writer("directShadowsEnabled")],g.prototype,"writedirectShadowsEnabled",null);f([h.property({type:Number,json:{write:!0}})],g.prototype,"displayUTCOffset",void 0);f([h.writer("displayUTCOffset")],g.prototype,"writeDisplayUTCOffset",
null);return g=m=f([h.subclass("esri.webscene.Lighting")],g)}(h.declared(m))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(r,d,p,f){Object.defineProperty(d,"__esModule",{value:!0});r={base:p,key:"type",typeMap:{color:f}};d.backgroundProperty={types:r,json:{read:function(d){return function(f,g,l){if(!f)return f;for(var h in d.typeMap)if(f.type===h)return g=new d.typeMap[h],g.read(f,l),g}}(r),write:{overridePolicy:function(d,
f,g){return{enabled:!g||!g.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(r,d,p,f,m,h,g,l){var q=h.strict()({color:"color"});return function(a){function b(b){return a.call(this)||this}p(b,a);b.prototype.normalizeCtorArgs=function(a){a&&a.type&&
(a=m({},a),delete a.type);return a};b.prototype.clone=function(){};f([l.property({type:q.apiValues,readOnly:!0,json:{type:q.jsonValues,read:!1,write:q.write}})],b.prototype,"type",void 0);return b=f([l.subclass("esri.webscene.background.Background")],b)}(l.declared(g))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(r,d,p,f,m,h,g,l,q){var a=m({},l.colorAndTransparencyProperty,{nonNullable:!0});return function(b){function c(a){a=b.call(this)||this;a.type="color";a.color=new h([0,0,0,1]);return a}p(c,b);e=c;c.prototype.clone=function(){return new e(this.cloneProperties())};c.prototype.cloneProperties=function(){return{color:this.color.clone()}};var e;f([g.enumeration.serializable()({color:"color"})],c.prototype,"type",void 0);f([g.property(a)],c.prototype,"color",void 0);return c=e=f([g.subclass("esri.webscene.background.ColorBackground")],
c)}(g.declared(q))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(r,d,p,f,m,h,g,l,q){return function(a){function b(b){b=a.call(this,b)||this;b.environment=new q;b.spatialReference=null;b.viewpoint=null;return b}p(b,a);c=b;Object.defineProperty(b.prototype,"viewingMode",{set:function(a){this._set("viewingMode",
a)},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new c({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var c;f([g.property({type:q,json:{write:{isRequired:!0}}})],b.prototype,"environment",void 0);f([g.property({type:l})],b.prototype,"spatialReference",void 0);f([g.property({type:["local","global"]})],b.prototype,"viewingMode",
null);f([g.property({type:m,json:{write:{isRequired:!0}}})],b.prototype,"viewpoint",void 0);return b=c=f([g.subclass("esri.webscene.InitialViewProperties")],b)}(g.declared(h))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(r,d,p,f,m,h,g,l,q){var a=m.ofType(q);return function(b){function c(c){c=
b.call(this,c)||this;c.slides=new a;return c}p(c,b);Object.defineProperty(c.prototype,"slides",{set:function(b){b&&(b=b.filter(function(a){return!!a.viewpoint}));this._set("slides",h.referenceSetter(b,this._get("slides"),a))},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};f([l.property({type:a,nonNullable:!0,json:{write:!0}}),l.cast(h.castForReferenceSetter)],c.prototype,"slides",null);return c=f([l.subclass("esri.webscene.Presentation")],
c)}(l.declared(g))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(r,d,p,f,m,h,g,l,q,a,b,c,e,w,n,k,P,S,C,aa,X,D,E,u,N,x,O,B,y){function z(a){if("building-scene"===a.type||"map-image"===a.type)return a.allSublayers}function A(a){if(a=z(a))return a.filter(function(a){return a.visible}).map(function(a){return a.id}).toArray()}function F(a,b){a=b-a;a>J&&(a-=H);a<-J&&(a+=H);return a}var K=0,G=b.ofType(B.default),L=w.getLogger("esri.webscene.Slide"),H=86400,J=43200;return function(d){function e(a){a=d.call(this,a)||this;a._applyToController=null;a.id=Date.now().toString(16)+
"-slide-"+K++;a.title=new y.default;a.description=new x.default;a.thumbnail=new E.default;a.viewpoint=null;a.basemap=null;a.ground=null;a.environment=new u;a.visibleLayers=new G;return a}f(e,d);e.prototype.castTitle=function(a){return"string"===typeof a?new y.default({text:a}):P.ensureType(y.default,a)};e.prototype.castDescription=function(a){return"string"===typeof a?new x.default({text:a}):P.ensureType(x.default,a)};e.prototype.castThumbnail=function(a){return"string"===typeof a?new E.default({url:a}):
P.ensureType(E.default,a)};e.prototype.castBasemap=function(a){return X.ensureType(a)};Object.defineProperty(e.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",c.referenceSetter(a,this._get("visibleLayers"),G))},enumerable:!0,configurable:!0});e.prototype.castVisibleLayers=function(a){return a&&"function"===typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a instanceof aa){var b=A(a);return{id:a.id,sublayerIds:b}}if(a.id)return{id:a.id,sublayerIds:a.sublayerIds};
L.warn('Invalid visible layer, expected { id }, Layer or "id"');return a}):null};e.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||
null})};e.prototype._updateVisibleLayersFrom=function(a){var b=this,c=[];return n.eachAlways(this._allLayers(a.map).map(function(b){return a.whenLayerView(b).then(function(a){if(a.visible){var e=A(b);c.push(new B.default({id:a.layer.id,sublayerIds:e}))}})}).toArray()).then(function(){b.visibleLayers.removeAll();b.visibleLayers.addMany(c)})};e.prototype.updateFrom=function(a,b){var c=this;b={screenshot:p({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},b&&b.screenshot)};return a.when(function(){c.viewpoint=
a.viewpoint.clone();c.environment.lighting=N.prototype.clone.apply(a.environment.lighting);c.basemap=a.map.basemap&&a.map.basemap.clone()||null;c.ground=a.map.ground?O.default.fromGround(a.map.ground):null;return c._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(b.screenshot)}).then(function(a){c.thumbnail=new E.default({url:a.dataUrl});return c})};e.prototype.applyTo=function(a,b){return g(this,void 0,void 0,function(){var c,e,d;return h(this,function(f){this._applyToController&&
this._applyToController.abort();this._applyToController=c=n.createAbortController();n.onAbortOrThrow(b,function(){return c.abort()});e=p({animate:!0},b,{signal:this._applyToController.signal});d=n.createDeferred(function(){c.abort()});this._applyTo(a,e,c).then(d.resolve,d.reject);return[2,d.promise]})})};e.prototype._applyTo=function(b,c,e){return g(this,void 0,void 0,function(){var d,f=this;return h(this,function(k){switch(k.label){case 0:return[4,a.result(function(){return g(f,void 0,void 0,function(){return h(this,
function(a){switch(a.label){case 0:return[4,this._applyBasemap(b,c)];case 1:return a.sent(),this._applyLayerVisibility(b),this._applyGround(b),[4,this._applyViewpoint(b,c)];case 2:return a.sent(),[2]}})})}())];case 1:d=k.sent();this._applyToController===e&&(this._applyToController=null);if(!1===d.ok)throw d.error;return[2,this]}})})};e.prototype._applyBasemap=function(a,b){return g(this,void 0,void 0,function(){var c;return h(this,function(e){switch(e.label){case 0:if(!this.basemap)return[3,5];e.label=
1;case 1:return e.trys.push([1,3,,4]),[4,this.basemap.load(b)];case 2:return e.sent(),[3,4];case 3:c=e.sent();if(n.isAbortError(c))throw c;return[3,4];case 4:a.map.basemap=X.clonePreservingTiledLayers(this.basemap,a.map.basemap),e.label=5;case 5:return[2]}})})};e.prototype._applyGround=function(a){this.ground&&(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground))};e.prototype._allLayers=function(a){var c=new b;this._collectLayers(a,c);this._collectLayers(a.ground,c);return c};e.prototype._collectLayers=
function(a,b){var c=this;a.layers.forEach(function(a){b.add(a);a.layers&&c._collectLayers(a,b)})};e.prototype._applyLayerVisibility=function(a){var b=this;this.visibleLayers&&this._allLayers(a.map).forEach(function(a){var c=b.visibleLayers.find(function(b){return b.id===a.id});a.visible=null!=c;var e=c&&c.sublayerIds,c=z(a);e&&c&&c.forEach(function(a){return a.visible=0<=e.indexOf(a.id)})})};e.prototype._applyViewpoint=function(a,b){return g(this,void 0,void 0,function(){return h(this,function(c){switch(c.label){case 0:if(!this.viewpoint||
b.ignoreViewpoint)return[3,5];this.viewpoint.camera.fov=a.camera.fov;return b.animate?this.get("environment.lighting.date")?[4,this._animateToLighting(a,b)]:[3,2]:[3,4];case 1:return c.sent(),[2];case 2:return a.environment.lighting=this.environment.lighting.clone(),[4,a.goTo(this.viewpoint,b)];case 3:c.sent(),c.label=4;case 4:return a.viewpoint=this.viewpoint,a.environment.lighting=this.environment.lighting.clone(),[3,6];case 5:a.environment.lighting=this.environment.lighting.clone(),c.label=6;case 6:return[2]}})})};
e.prototype._animateToLighting=function(a,b){return g(this,void 0,void 0,function(){var c,e,d,f=this;return h(this,function(g){c=null;"global"===a.viewingMode&&(c=this._animateLightingWithCamera(a));a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);e=a.goTo(this.viewpoint,b);e.then(function(){a.environment.lighting=
f.environment.lighting.clone()});d=function(){c&&c.remove();a.environment.lighting.cameraTrackingEnabled=!0};e.catch(function(a){d();throw a;}).then(d);return[2,e]})})};e.prototype._getTime=function(a){var b=a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[b,a]};e.prototype._setTime=function(a,b,c){a.setTime(b);a.setUTCHours(c/3600);a.setUTCMinutes(c%3600/60);a.setUTCSeconds(c%3600%60);return a};e.prototype._animateLightingWithCamera=function(a){var b=this,c=this._getTime(new Date(a.environment.lighting.date.toString())),
e=c[0],d=c[1],c=this._getTime(this.environment.lighting.date),f=c[0],g=F(d,c[1]),t=a.renderCoordsHelper,h=C.vec3f64.create();t.toRenderCoords(a.camera.position,h);var k=C.vec3f64.create();t.toRenderCoords(this.viewpoint.camera.position,k);var l=C.vec3f64.create(),m=new Date;return a.watch("camera",function(c){t.toRenderCoords(c.position,l);var W=S.vec3.squaredDistance(h,l),n=S.vec3.squaredDistance(k,l);c=0;0!==W+n&&(c=W/(W+n));W=e+(f-e)*c;c=D.moduloPositive(d+g*c,H);a.environment.lighting.date=b._setTime(m,
W,c)})};e.createFrom=function(a,b){return(new this).updateFrom(a,b)};m([k.property({type:String,json:{write:{isRequired:!0}}})],e.prototype,"id",void 0);m([k.property({type:y.default,json:{default:function(){return new y.default({text:""})},write:{isRequired:!0}}})],e.prototype,"title",void 0);m([k.cast("title")],e.prototype,"castTitle",null);m([k.property({type:x.default,json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],e.prototype,"description",void 0);m([k.cast("description")],
e.prototype,"castDescription",null);m([k.property({type:E.default,json:{default:function(){return new E.default({url:""})},write:{isRequired:!0}}})],e.prototype,"thumbnail",void 0);m([k.cast("thumbnail")],e.prototype,"castThumbnail",null);m([k.property({type:q,nonNullable:!0,json:{write:{isRequired:!0}}})],e.prototype,"viewpoint",void 0);m([k.property({type:l,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],e.prototype,"basemap",void 0);m([k.cast("basemap")],e.prototype,"castBasemap",null);
m([k.property({type:O.default,json:{write:!0}})],e.prototype,"ground",void 0);m([k.property({type:G,json:{write:{isRequired:!0}}})],e.prototype,"visibleLayers",null);m([k.cast("visibleLayers")],e.prototype,"castVisibleLayers",null);m([k.property({type:u,json:{write:!0}})],e.prototype,"environment",void 0);return e=m([k.subclass("esri.webscene.Slide")],e)}(k.declared(e))})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(r,d,p,f,m,h){Object.defineProperty(d,"__esModule",{value:!0});r=function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a.url="";return a}p(g,d);m=g;g.prototype.clone=function(){return new m({url:this.url})};var m;f([h.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"url",void 0);return g=m=f([h.subclass("esri.webdoc.support.Thumbnail")],g)}(h.declared(m));d.default=r})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(r,d,p,f,m,h){Object.defineProperty(d,"__esModule",{value:!0});r=function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a.text="";return a}p(g,d);m=g;g.prototype.clone=function(){return new m({text:this.text})};var m;f([h.property({type:String,json:{write:!0}})],g.prototype,"text",void 0);return g=m=f([h.subclass("esri.webscene.support.Description")],g)}(h.declared(m));d.default=r})},"esri/webscene/support/SlideGround":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../webdoc/support/opacityUtils".split(" "),
function(r,d,p,f,m,h,g,l,q){Object.defineProperty(d,"__esModule",{value:!0});r=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.opacity=null;return b}p(b,a);c=b;b.prototype.clone=function(){return new c({opacity:this.opacity})};b.prototype.cloneAndApplyTo=function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new m;a.opacity=this.opacity;return a};b.fromGround=function(a){return new c({opacity:a.opacity})};var c;f([g.property({type:Number,json:{type:l.Integer,read:{reader:q.transparencyToOpacity,
source:"transparency"},write:{writer:function(a,b){b.transparency=q.opacityToTransparency(a)},target:"transparency"}}})],b.prototype,"opacity",void 0);return b=c=f([g.subclass("esri.webscene.support.SlideGround")],b)}(g.declared(h));d.default=r})},"esri/webscene/support/SlideVisibleLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(r,d,p,f,m,h,g,l){Object.defineProperty(d,"__esModule",{value:!0});r=function(d){function a(a){a=d.call(this)||this;a.id="";a.sublayerIds=null;return a}p(a,d);b=a;a.prototype.clone=function(){return new b({id:this.id,sublayerIds:h.clone(this.sublayerIds)})};var b;f([g.property({type:String,json:{write:!0}})],a.prototype,"id",void 0);f([g.property({type:[l.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],a.prototype,"sublayerIds",void 0);return a=b=f([g.subclass("esri.webscene.support.SlideVisibleLayer")],
a)}(g.declared(m));d.SlideVisibleLayer=r;d.default=r})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(r,d,p,f,m,h){Object.defineProperty(d,"__esModule",{value:!0});r=function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a.text="";return a}p(g,d);m=g;g.prototype.clone=function(){return new m({text:this.text})};
var m;f([h.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"text",void 0);return g=m=f([h.subclass("esri.webscene.support.Title")],g)}(h.declared(m));d.default=r})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(r,d,p,f){Object.defineProperty(d,"__esModule",{value:!0});r=function(d){function f(f,h){return d.call(this,f,h,"webscene")||this}p(f,d);Object.defineProperty(f.prototype,"supportsGround",{get:function(){return this.since(1,
8)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return f}(f.Version);d.Version=r;d.default=r})},"esri/core/Version":function(){define(["require","exports","./Error"],function(r,d,p){Object.defineProperty(d,"__esModule",{value:!0});r=function(){function d(d,f,g){void 0===g&&(g="");this.major=d;this.minor=f;this._context=g}d.prototype.lessThan=function(d,f){return this.major<
d||d===this.major&&this.minor<f};d.prototype.since=function(d,f){return!this.lessThan(d,f)};d.prototype.validate=function(d){if(this.major!==d.major)throw new p((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:d});};d.prototype.clone=function(){return new d(this.major,this.minor,this._context)};d.parse=function(f,h){void 0===h&&(h="");var g=f.split("."),
l=g[0],g=g[1],m=/^\s*\d+\s*$/;if(!l||!l.match||!l.match(m))throw new p((h&&h+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:f});if(!g||!g.match||!g.match(m))throw new p((h&&h+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:f});f=parseInt(l,10);l=parseInt(g,10);return new d(f,l,h)};return d}();d.Version=r})},"*noref":1}});
define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./core/tsSupport/assignHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./kernel ./Map ./Viewpoint ./core/asyncUtils ./core/Collection ./core/Error ./core/Handles ./core/has ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./views/3d/support/projectionUtils ./views/support/spatialReferenceSupport ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/Version".split(" "),function(r,
d,p,f,m,h,g,l,q,a,b,c,e,w,n,k,P,S,C,aa,X,D,E,u,N,x,O,B,y,z,A,F,K,G,L,H,J,Q,I,Z,Y){var R=X.getLogger("esri.WebScene"),U=new Y.default(1,16),ca={width:600,height:400};return function(a){function d(b){b=a.call(this)||this;b._handles=new n;b.applicationProperties=null;b.clippingArea=null;b.clippingEnabled=!1;b.heightModelInfo=null;b.sourceVersion=null;b.supportsHeightModelInfo=!0;b.presentation=new Z;b.initialViewProperties=new I;b.portalItem=null;b.resourceInfo=null;b.authoringApp=null;b.authoringAppVersion=
null;b._isAuthoringAppSetByUser=!1;b._isAuthoringAppVersionSetByUser=!1;return b}p(d,a);d.prototype.initialize=function(){var a=this;this.when().catch(function(a){R.error("#load()","Failed to load web scene",a)});if(this.resourceInfo){var b=void 0;try{b=this._validateJSON(this.resourceInfo)}catch(ba){this.addResolvingPromise(D.reject(ba));return}this.read(b);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",
function(){return a._scheduleLayersIdGC()}))};d.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy()};d.prototype.writeClippingArea=function(a,b){b.clippingArea||(b.clippingArea={});b.clippingArea.geometry=a.toJSON()};d.prototype.readClippingEnabled=function(a,b){return b.clippingArea?!!b.clippingArea.clip:!1};d.prototype.writeClippingEnabled=function(a,b){this.clippingArea&&(b.clippingArea||(b.clippingArea={}),b.clippingArea.clip=a)};d.prototype.writeLayers=function(a,
b,c,d){var e=this,f=h({},d,{layerContainerType:"operational-layers"});a=a.map(function(a){return e.verifyWriteLayer(a,d)?a.write(null,f):null}).filter(function(a){return!!a});b[c]=a.toArray()};d.prototype.verifyWriteLayer=function(a,b){return"write"in a?!0:(b&&b.messages&&b.messages.push(new w("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)};d.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];
return new Y.default(parseInt(a[0],10),parseInt(b,10))};d.prototype.writeSourceVersion=function(a,b,c){b[c]=U.major+"."+U.minor};Object.defineProperty(d.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):this._clearOverride("thumbnailUrl")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},
enumerable:!0,configurable:!0});d.prototype.writeAuthoringApp=function(a,b){b.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(d.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});d.prototype.writeAuthoringAppVersion=function(a,b){b.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:q.version};d.prototype.writeGround=function(a,b,c,
d){b[c]=a?a.write(null,d):{transparency:0,layers:[]}};d.prototype.readInitialViewProperties=function(a,c){a={};c.initialState&&c.initialState.environment&&(a.environment=Q.fromJSON(c.initialState.environment));a.spatialReference=c.spatialReference?y.fromJSON(c.spatialReference):y.WebMercator;a.viewingMode=c.viewingMode||"global";c.initialState&&c.initialState.viewpoint&&(a.viewpoint=b.fromJSON(c.initialState.viewpoint));return new I(a)};d.prototype.writeInitialViewProperties=function(a,b,c,d){a&&
(c={},a.environment&&(c.environment=a.environment.write({},d)),a.viewpoint&&(c.viewpoint=a.viewpoint.write({},d)),0!==Object.keys(c).length&&(b.initialState=c),b.spatialReference=a.spatialReference?a.spatialReference.write({},d):y.WebMercator.toJSON(),b.viewingMode=null!=a.viewingMode?a.viewingMode:"global")};d.prototype.load=function(a){this.addResolvingPromise(this._loadFromSource());return this.when()};d.prototype.loadAll=function(){var a=this;return c.safeCast(aa.default(this,function(b){var c=
a.presentation&&a.presentation.slides;b(a.ground,a.basemap,a.layers,c&&c.map(function(a){return a.basemap}))}))};d.prototype.read=function(a,b){var c=this;b=h({},b,{origin:"web-scene"});var d=this._isAuthoringAppVersionSetByUser,e=this._isAuthoringAppSetByUser,f=arguments;x.readLoadable(this,a,function(b){return c.inherited(f,[a,b])},b);e||(this._isAuthoringAppSetByUser=!1);d||(this._isAuthoringAppVersionSetByUser=!1);if(a.baseMap&&Array.isArray(a.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var d=
a.baseMap.elevationLayers.map(function(a){return{id:a.id}}),g=this.presentation.slides,k=function(a,b){return a.visibleLayers.some(function(a){return a.id===b})},t=d.filter(function(a){return!g.some(function(b){return k(b,a.id)})});g.forEach(function(a){a.visibleLayers.addMany(t)})}};d.prototype._writeBasemapElevationLayers=function(a){var b=a.ground&&a.ground.layers;!a.baseMap&&b&&b.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=S.clone(b))};d.prototype.write=
function(a,b){if("loaded"!==this.loadStatus){var c=new w("webscene:not-loaded","Web scene must be loaded before it can be serialized");R.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw c;}this._runLayersIdGC();b=h({},b,{origin:"web-scene"});c=this.inherited(arguments,[a,b]);this._writeBasemapElevationLayers(c);return c};d.prototype.save=function(a){return l(this,void 0,void 0,function(){var b,c,d;return g(this,function(e){switch(e.label){case 0:if(this.portalItem)return[3,
2];R.error("save(): requires the .portalItem property to be set");return[4,D.reject(new w("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:e.sent(),e.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,D.reject(new w("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:e.sent(),e.label=4;case 4:return b=this._updateFromPromise,[4,this.load()];case 5:return e.sent(),[4,this._loadObjectsWithLayers()];
case 6:return e.sent(),c=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&E.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||F.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),d=this.write(null,c),[4,this._verifySave(d,c,a)];case 7:return e.sent(),this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:d})];case 8:return e.sent(),N.updateOrigins(c),b?[4,b]:[3,10];case 9:e.sent(),e.label=10;case 10:return[4,
this._saveThumbnail()];case 11:return e.sent(),[2,this.portalItem]}})})};d.prototype.saveAs=function(a,b){return l(this,void 0,void 0,function(){var c,d,e,f,h;return g(this,function(g){switch(g.label){case 0:if(a)return[3,2];R.error("saveAs(portalItem): requires a portal item parameter");return[4,D.reject(new w("webscene:portal-item-required","saveAs requires a portal item to save to"))];case 1:g.sent(),g.label=2;case 2:return a.id&&(a=a.clone(),a.id=null),c=a.portal||F.getDefault(),[4,this.load()];
case 3:return g.sent(),[4,this._loadObjectsWithLayers()];case 4:return g.sent(),d=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:c,writtenProperties:[],blockedRelativeUrls:[]}),e=this.write(null,d),[4,this._verifySaveAs(e,d,b)];case 5:return g.sent(),[4,c._signIn()];case 6:return g.sent(),f=this.thumbnailUrl,h=!this._isOverridden("thumbnailUrl"),a.type="Web Scene",a.portal=c,this._updateTypeKeywords(a),[4,c.user.addItem({item:a,folder:b&&b.folder,data:e})];case 7:return g.sent(),
this.portalItem=a,P.prototype.read.call(this,{version:e.version,authoringApp:e.authoringApp,authoringAppVersion:e.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:a.itemUrl&&E.urlToObject(a.itemUrl)}),N.updateOrigins(d),f&&(this.thumbnailUrl=h?E.addQueryParameter(f,"w","8192"):f),[4,this._saveThumbnail()];case 8:return g.sent(),[2,a]}})})};d.prototype._saveThumbnail=function(){return l(this,void 0,void 0,function(){return g(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?
[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),a.label=2;case 2:return[2]}})})};d.prototype._verifySave=function(a,b,c,d){void 0===d&&(d=!1);var e=b.messages.filter(function(a){return"error"===a.type}).map(function(a){return new w(a.name,a.message,a.details)});b.blockedRelativeUrls&&(e=e.concat(b.blockedRelativeUrls.map(function(a){return new w("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));
c&&c.ignoreUnsupported&&(e=e.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name}));c&&c.strictSchemaValidationEnabled||(e=e.filter(function(a){return"web-document-write:property-required"!==a.name}));var f=c&&c.strictSchemaValidationEnabled;return(f?D.create(function(a){return r(["./webscene/validator"],a)}).then(function(b){b=b.validate(a);if(0<b.length){var c="webscene did not validate:\n"+
b.join("\n");R.error((d?"saveAs":"save")+"(): "+c)}return b.map(function(a){return new w("webscene:schema-validation",a)})}).then(function(a){return f&&0<a.length?(a=G.createSchemaValidationError(a.concat(e)),D.reject(a)):e}):D.resolve(e)).then(function(a){if(0<a.length)return D.reject(new w("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a}))})};d.prototype._verifySaveAs=function(a,b,c){return this.canSaveAs(b)?
D.reject(G.createCopyError()):this._verifySave(a,b,c,!0)};d.prototype.verifySaveAs=function(a){var b=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),c=this.write(null,b);return this._verifySaveAs(c,b,a)};d.prototype.canSaveAs=function(a){a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};d.prototype.updateFrom=function(a,b){void 0===b&&(b={});return l(this,
void 0,void 0,function(){var c,d;return g(this,function(e){switch(e.label){case 0:return this._updateFromPromise=c=this._updateFromInternal(a,b),[4,c];case 1:e.sent();if(d=this._updateFromPromise===c)this._updateFromPromise=null;return[2]}})})};d.prototype._updateFromInternal=function(a,b){void 0===b&&(b={});return l(this,void 0,void 0,function(){return g(this,function(c){switch(c.label){case 0:return[4,a.whenReady()];case 1:return c.sent(),!b.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=
Q.prototype.clone.apply(a.environment)),!b.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=a.spatialReference.clone(),this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=
a.visible}),!1===b.thumbnailExcluded||null==b.thumbnailExcluded&&!b.viewpointExcluded?[4,this._updateFromThumbnail(a,b.thumbnailSize||void 0)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2]}})})};d.prototype._updateFromThumbnail=function(a,b){void 0===b&&(b=ca);return l(this,void 0,void 0,function(){var c,d,e,f;return g(this,function(g){switch(g.label){case 0:return c=b.width,d=b.height,e=c/d,1.5>e?d=c/1.5:1.5<e&&(c=1.5*d),c>a.width&&(d*=a.width/c,c=a.width),d>a.height&&(c*=a.height/d,d=a.height),
[4,a.takeScreenshot({format:"jpg",width:Math.round(c),height:Math.round(d),disableSlice:!0})];case 1:return f=g.sent(),this.thumbnailUrl=f.dataUrl,[2]}})})};d.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};d.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a,b&&b.url&&b.url.path);this.read(a,b);return this._loadFromJSON(a,
b)};d.prototype._extractOperationalLayers=function(a){var b=this,c=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var d=0,e=a.baseMap.elevationLayers;d<e.length;d++)c.push(e[d]);var f=[],g=function(a){a.layers&&(a.layers=a.layers.filter(g));return"ArcGISTiledElevationServiceLayer"===a.layerType?(b.sourceVersion.supportsGround||f.push(a),!1):!0};return{operationalLayers:a.operationalLayers?a.operationalLayers.filter(g):[],operationalElevationLayers:f,
basemapElevationLayers:c}};d.prototype._loadFromJSON=function(a,b){var d=this,f=new e;return this._validateSpatialReference().then(function(){return d._validateHeightModelInfo()}).then(function(){return D.create(function(a){return r(["./portal/support/layersCreator"],a)})}).then(function(e){var g=d._extractOperationalLayers(a),k=g.operationalLayers,l=g.operationalElevationLayers,g=g.basemapElevationLayers,m=[],n={context:h({},b,{layerContainerType:"operational-layers"})};d.portalItem&&(n.context.portal=
d.portalItem.portal||F.getDefault());if(0<g.length){var t=h({},n,{context:h({},n.context,{layerContainerType:"ground"})});t.defaultLayerType="ArcGISTiledElevationServiceLayer";m.push(c.safeCast(e.populateOperationalLayers(d.ground.layers,g,t)))}0<l.length&&(t=h({},n,{context:h({},n.context,{layerContainerType:"ground"})}),t.defaultLayerType="ArcGISTiledElevationServiceLayer",m.push(c.safeCast(e.populateOperationalLayers(f,l,t))));k&&0<k.length&&m.push(c.safeCast(e.populateOperationalLayers(d.layers,
k,n)));return D.eachAlways(m).then(function(){})}).then(function(){return d._loadObjectsWithLayers()}).then(function(){d.ground.layers.addMany(f)})};d.prototype._loadObjectsWithLayers=function(){var a=[];this.ground&&a.push(this.ground.load());this.basemap&&a.push(this.basemap.load());this.presentation.slides.forEach(function(b){b.basemap&&a.push(b.basemap.load())});return D.eachAlways(a).then(function(){})};d.prototype._loadFromItem=function(a){var b=this;return a.load().catch(function(a){throw new w("webscene:load-portal-item",
"Failed to load portal item",{error:a});}).then(function(){if("Web Scene"!==a.type)throw new w("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(c){b.resourceInfo=c;return b._readAndLoadFromJSON(c,{origin:"web-scene",url:E.urlToObject(a.itemUrl),portal:a.portal||F.getDefault()})})};d.prototype._validateSpatialReference=function(){var a=this.initialViewProperties,b=this._sceneSpatialReference,
c;if("local"!==a.viewingMode){if(!H.isSpatialReferenceSupported(b,"global"))return D.reject(new w("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||L.canProject(a,b)}}else{if(!H.isSpatialReferenceSupported(b,"local"))return D.reject(new w("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",
{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||a.equals(b)}}var d=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},e=d(a.viewpoint);return e&&!c(e)?D.reject(new w("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:e,sceneSpatialReference:b,
viewingMode:a.viewingMode})):(e=this.presentation.slides.find(function(a){return!c(d(a.viewpoint))}))?(e=d(e.viewpoint),D.reject(new w("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode}))):D.resolve()};d.prototype._validateHeightModelInfo=function(){var a=z.validateWebSceneError(this.heightModelInfo,
this._sceneSpatialReference);return a?D.reject(a):D.resolve()};d.prototype._validateJSON=function(a,b){void 0===b&&(b=null);b=Y.default.parse(a.version||"","webscene");U.validate(b);a.version=b.major+"."+b.minor;1===b.major&&2>=b.minor&&(a.spatialReference=y.WebMercator.toJSON());return a};d.prototype._updateTypeKeywords=function(a){"local"===this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=
["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}))};Object.defineProperty(d.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||y.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_verifyItemRelativeRootPath",
{get:function(){return this.portalItem&&this.portalItem.itemUrl?E.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});d.prototype._enableVerifyItemRelativeUrls=function(a){var b=this._verifyItemRelativeRootPath;b&&(a.verifyItemRelativeUrls={rootPath:b,writtenUrls:[]});return a};d.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)};d.prototype._scheduleLayersIdGC=function(){var a=this;
this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};d.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var b=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,c=function(b){return!!a.allLayers.find(function(a){return a.id===b})};b&&b.layers&&(b.layers=b.layers.filter(function(a){return c(a.id)}));(b=this.presentation&&this.presentation.slides)&&
b.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return c(a.id)}))})};d.fromJSON=function(a){if(!a)throw new w("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};d.VERSION=U;f([u.property({type:J,json:{write:!0}})],d.prototype,"applicationProperties",void 0);f([u.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],d.prototype,"basemap",void 0);f([u.property({type:O,json:{read:{source:"clippingArea.geometry",
reader:A.fromJSON},write:{target:"clippingArea.geometry"}}})],d.prototype,"clippingArea",void 0);f([u.writer("clippingArea")],d.prototype,"writeClippingArea",null);f([u.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],d.prototype,"clippingEnabled",void 0);f([u.reader("clippingEnabled",["clippingArea"])],d.prototype,"readClippingEnabled",null);f([u.writer("clippingEnabled")],d.prototype,"writeClippingEnabled",null);f([u.property({type:B,json:{write:!0}})],d.prototype,"heightModelInfo",
void 0);f([u.property({json:{write:{target:"operationalLayers"}}})],d.prototype,"layers",void 0);f([u.writer("layers")],d.prototype,"writeLayers",null);f([u.property({readOnly:!0,type:Y.default,json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],d.prototype,"sourceVersion",void 0);f([u.reader("sourceVersion",["version"])],d.prototype,"readSourceVersion",null);f([u.writer("sourceVersion")],d.prototype,"writeSourceVersion",null);f([u.property({dependsOn:["portalItem.thumbnailUrl"]})],
d.prototype,"thumbnailUrl",null);f([u.property({type:String,json:{write:{allowNull:!0}}})],d.prototype,"authoringApp",null);f([u.writer("authoringApp")],d.prototype,"writeAuthoringApp",null);f([u.property({type:String,json:{write:{allowNull:!0}}})],d.prototype,"authoringAppVersion",null);f([u.writer("authoringAppVersion")],d.prototype,"writeAuthoringAppVersion",null);f([u.property({json:{write:{isRequired:!0,allowNull:!0,enabled:!0}}})],d.prototype,"ground",void 0);f([u.writer("ground")],d.prototype,
"writeGround",null);f([u.property({type:Z,nonNullable:!0,json:{write:function(a,b,c,d){a.slides&&0<a.slides.length&&(c=h({},d,{isPresentation:!0}),b.presentation=a.write(null,c))}}})],d.prototype,"presentation",void 0);f([u.property({type:I,nonNullable:!0,json:{default:function(){return new I({viewingMode:"global",spatialReference:y.WebMercator})}}})],d.prototype,"initialViewProperties",void 0);f([u.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],
d.prototype,"readInitialViewProperties",null);f([u.writer("initialViewProperties",{"initialState.environment":{type:Q},spatialReference:{type:y},viewingMode:{type:String},"initialState.viewpoint":{type:b}})],d.prototype,"writeInitialViewProperties",null);f([u.property({type:K})],d.prototype,"portalItem",void 0);f([u.property()],d.prototype,"resourceInfo",void 0);f([m(0,u.cast(K))],d.prototype,"saveAs",null);f([u.property()],d.prototype,"_sceneSpatialReference",null);f([u.property()],d.prototype,"_verifyItemRelativeRootPath",
null);return d=f([u.subclass("esri.WebScene")],d)}(u.declared(a,C,P))});