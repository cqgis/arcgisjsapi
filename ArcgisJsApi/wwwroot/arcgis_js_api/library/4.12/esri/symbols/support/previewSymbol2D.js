// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils".split(" "),function(D,p,w,v,m,r,x,y){function z(c,b){var a=t.getContext("2d"),k=[];b&&(b.weight&&k.push(b.weight),b.size&&k.push(b.size+"px"),b.family&&k.push(b.family));a.font=k.join(" ");return a.measureText(c).width}function A(c){if(0===c.length)return 0;if(2<c.length){var b=m.px2pt(1),a=parseFloat(c);switch(c.slice(-2)){case "px":return a;case "pt":return a*b;case "in":return 72*
a*b;case "pc":return 12*a*b;case "mm":return a*B*b;case "cm":return a*C*b}}return parseFloat(c)}Object.defineProperty(p,"__esModule",{value:!0});var t=document.createElement("canvas"),B=7.2/2.54,C=72/2.54;p.previewSymbol2D=function(c,b){var a=b&&b.size?m.pt2px(b.size):null,k=b&&b.maxSize?m.pt2px(b.maxSize):null,p=b&&null!=b.opacity?b.opacity:null,t=b&&null!=b.rotation?b.rotation:null,f=r.getStroke(c),h={shape:null,fill:null,stroke:f};f&&f.width&&(f.width=Math.min(f.width,80));var g=0,e=0,l=f&&f.width||
0,u=!1;switch(c.type){case "simple-marker":f=c.style;e=g=a=Math.min(a||m.pt2px(c.size),k||120);switch(f){case "circle":h.shape={type:"circle",cx:0,cy:0,r:.5*a};break;case "cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[g,.5*e]},{command:"M",values:[.5*g,0]},{command:"L",values:[.5*g,e]},{command:"E",values:[]}]};break;case "diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[.5*g,0]},{command:"L",values:[g,.5*e]},{command:"L",
values:[.5*g,e]},{command:"Z",values:[]}]};break;case "square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[g,0]},{command:"L",values:[g,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]};break;case "triangle":h.shape={type:"path",path:[{command:"M",values:[.5*g,0]},{command:"L",values:[g,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]};break;case "x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[g,e]},{command:"M",values:[g,
0]},{command:"L",values:[0,e]},{command:"E",values:[]}]};break;case "path":u=!0,h.shape={type:"path",path:c.path||""}}break;case "simple-line":l=Math.min(a||l,k||80);g=22<l?2*l:40;e=l;f.width=l;l=0;h.shape={type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[g,.5*e]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":e=g=a=Math.min(a,k||120);u=!0;h.shape=x.shapes.fill[0];break;case "picture-marker":var k=k||120,f=m.pt2px(c.width),d=m.pt2px(c.height),a=Math.min(a||
Math.max(f,d),k),d=f/d,f=1>=d?Math.ceil(a*d):a,d=1>=d?a:Math.ceil(a/d),g=f,e=d;h.shape={type:"image",x:-Math.round(f/2),y:-Math.round(d/2),width:f,height:d,src:c.url||""};break;case "text":var f=c.text||"Aa",d=c.font,a=Math.min(a||m.pt2px(d.size),k||120),q=z(f,{weight:d.weight,size:a,family:d.family}),g=(k=/[\uE600-\uE6FF]/.test(f))?a:q,e=a,q=.25*A((d?a:0).toString());k&&(q+=5);h.shape={type:"text",text:f,x:0,y:q,align:"middle",decoration:d&&d.decoration,rotated:c.rotated,kerning:c.kerning};h.font=
d&&{size:a,style:d.style,decoration:d.decoration,weight:d.weight,family:d.family}}if(!h.shape)return v.reject(new w("symbolPreview: renderPreviewHTML2D","symbol not supported."));var g=(g||22)+l+1,e=(e||22)+l+1,n=r.getFill(c),l=c.color,a=null;n&&"pattern"===n.type&&l&&"picture-fill"!==c.type?a=r.getPatternUrlWithColor(n.src,l.toCss(!0)).then(function(a){n.src=a;h.fill=n;return h}):(h.fill=n,a=v.resolve(h));return a.then(function(a){return y.renderSymbol([[a]],[g,e],{node:b&&b.node,scale:u,opacity:p,
rotation:t})})}});