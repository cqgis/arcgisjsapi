// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/compilerUtils ../../core/maybe ../../core/promiseUtils ./previewSymbol2D ./previewSymbol3D ./previewWebStyleSymbol ./utils".split(" "),function(z,n,A,B,C,D,E,F,G,H,u){function r(a,c){switch(a.type){case "web-style":return H.previewWebStyleSymbol(a,r,c);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return G.previewSymbol3D(a,c);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":case "cim":return F.previewSymbol2D(a,
c);default:C.neverReached(a)}}function w(a){return a&&"opacity"in a?a.opacity*w(a.parent):1}Object.defineProperty(n,"__esModule",{value:!0});var k=null;n.renderDotDensityPreview=function(a,c,b){var l=a.backgroundColor,d=a.outline;a=a.dotSize;var e=b&&b.swatchSize||22,m=Math.round(e*e/Math.pow(a,2)*.8),h=window.devicePixelRatio;b=document.createElement("canvas");var g=e*h;b.width=g;b.height=g;b.style.width=b.width/h+"px";b.style.height=b.height/h+"px";var f=b.getContext("2d");l&&(f.fillStyle=l.toCss(!0),
f.fillRect(0,0,g,g),f.fill());f.fillStyle=c.toCss(!0);if(k&&k.length/2===m)for(c=0;c<2*m;c+=2){var l=k[c],p=k[c+1];f.fillRect(l,p,a*h,a*h);f.fill()}else for(k=[],c=0;c<2*m;c+=2)l=Math.floor(Math.random()*(g-0+1)+0),p=Math.floor(Math.random()*(g-0+1)+0),k.push(l,p),f.fillRect(l,p,a*h,a*h),f.fill();d&&(d.color&&(f.strokeStyle=d.color.toCss(!0)),f.lineWidth=d.width,f.strokeRect(0,0,g,g));d=new Image(e,e);d.src=b.toDataURL();return d};n.renderPreviewHTML=r;n.getDisplayedSymbol=function(a,c){return B(this,
void 0,void 0,function(){var b,l,d,e,m,h,g,f,p,k,n,q,r,x,y,t;return A(this,function(v){switch(v.label){case 0:if(!a)return[2];b=w(a.layer||a.sourceLayer);if(D.isSome(a.symbol))return l=a.symbol.clone(),u.applyColorToSymbol(l,null,b),[2,l];d=a.get("layer.renderer")||a.get("sourceLayer.renderer");return[4,d.getSymbolAsync(a)];case 1:e=v.sent();if(!e)return[2];e=e.clone();return!("visualVariables"in d)||"visualVariables"in d&&!d.visualVariables||"visualVariables"in d&&d.visualVariables&&!d.visualVariables.length?
[2,e]:[4,E.create(function(a){return z(["../../renderers/visualVariables/support/visualVariableUtils"],a)})];case 2:m=v.sent();h=[];g=[];f=[];p=[];k=0;for(n=d.visualVariables;k<n.length;k++)switch(q=n[k],q.type){case "color":h.push(q);break;case "opacity":g.push(q);break;case "rotation":p.push(q);break;case "size":f.push(q)}x=(r=!!h.length&&h[h.length-1])?m.getColor(r,a,c):null;t=(y=!!g.length&&g[g.length-1])?m.getOpacity(y,a,c):null;null!=b&&(t=null!=t?t*b:b);u.applyColorToSymbol(e,x,t);f.forEach(function(b){return u.applySizeToSymbol(e,
m.getSize(b,a,c),b.axis)});p.forEach(function(b){return u.applyRotationToSymbol(e,m.getRotationAngle(b,a,c),b.axis)});return[2,e]}})})}});