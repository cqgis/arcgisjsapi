// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../request ../../../../core/asyncUtils ../../../../core/has ../../../../core/ItemCache ../../../../core/MemCache ../../../../core/promiseUtils ../../../../core/requireUtils ../../../../core/workers ./GeometryUtils ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./TileIndex ./VectorTileDisplayObject ../../tiling/TileKey module".split(" "),
function(y,m,r,k,d,f,a,c,b,e,p,x,l,g,w,q,u,z,h,n,A){var v=new b(10),t=new Map;return function(){function b(a,g,e,n,h){this._vectorTileLayer=a;this.devicePixelRatio=g;this.allowUpdates=e;this._container=n;this._memCache=h;this._connection=this._glyphMosaic=this._spriteMosaic=null;this._updateToAbortController=new Map;this._ongoingTileRequests=new Map;this._ongoingRequestToController=new Map}b.prototype.destroy=function(){this._updateToAbortController&&this._updateToAbortController.forEach(function(a){return a.abort()});
this._ongoingTileRequests&&this.abortAll();this._connection&&(this._connection.close(),this._connection=null);this._vectorTileLayer=null;this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)};Object.defineProperty(b.prototype,"spriteMosaic",{get:function(){var a=this;return this._spriteSourcePromise.then(function(){return a._spriteMosaic})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});b.prototype.start=function(g){return d(this,void 0,void 0,function(){var e,C,n,h,b,c=this;return k(this,function(D){e=this._vectorTileLayer.sourceNameToSource;C=[];for(n in e)C.push(this._fetchTileMap(e[n],g));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,g);this._spriteSourcePromise.then(function(a){c._spriteMosaic=new u(1024,1024,250);c._spriteMosaic.setSpriteSource(a)});
h=this._vectorTileLayer.styleRepository;b=new q(h.glyphs);this._glyphMosaic=new w(1024,1024,b);this._broadcastPromise=a.safeCast(l.open(x.getAbsMid("./WorkerTileHandler",y,A),{client:this,scheduler:g.scheduler,signal:g.signal})).then(function(a){c._connection=a;return p.all(c._connection.broadcast("setLayers",h.styleJSON,r({},g)))});return[2,p.all(C)]})})};b.prototype.updateStyle=function(){return d(this,void 0,void 0,function(){var a,g=this;return k(this,function(e){switch(e.label){case 0:return[4,
this._broadcastPromise];case 1:return e.sent(),this._updateToAbortController.forEach(function(a){return a.abort()}),this._updateToAbortController.clear(),a=this._vectorTileLayer.styleRepository,this._broadcastPromise=p.create(function(e,n){p.all(g._connection.broadcast("updateStyle",a.styleJSON)).then(e,n)}),[2,this._broadcastPromise]}})})};b.prototype.abortTileUpdate=function(a){this._updateToAbortController.has(a)&&(this._updateToAbortController.get(a).abort(),this._updateToAbortController.delete(a))};
b.prototype.updateTile=function(a,e){return d(this,void 0,void 0,function(){var n,h,c,b,C=this;return k(this,function(D){switch(D.label){case 0:return this.allowUpdates&&a.isReady?[4,this._broadcastPromise]:[2,null];case 1:D.sent();n=Math.round(g.degToByte(e.state.rotation));if(a.rotation===n)return[2,null];c=a.key;this._updateToAbortController.has(c.id)&&(h=this._updateToAbortController.get(c.id),h.abort(),this._updateToAbortController.delete(c.id));h=p.createAbortController();a.rotation=n;b=a.client.invoke("updateSymbols",
{key:a.id,rotation:n},{signal:h.signal}).then(function(g){C._updateToAbortController.delete(c.id);a.isReady&&a.updateSymbolData(g);return g}).catch(function(a){p.isAbortError(a)||C._updateToAbortController.delete(c.id)});this._updateToAbortController.set(a.id,h);return[2,b]}})})};b.prototype.updateTileData=function(a){for(var g=a.tileId,e=this._container.children,n,h=0;h<e.length;h++)if(n=e[h],n.id===g){n.updateTileData(a.tileData);break}};b.prototype.getVectorTile=function(a,g,c){return d(this,void 0,
void 0,function(){var b,C,p,x,q;return k(this,function(t){switch(t.label){case 0:return b=new n(a,g,c,0),this._memCache&&(C=this._memCache.get(b.id))?(C.reference(),[2,C]):[4,this._getVectorTileData(b,null)];case 1:p=t.sent();if(this._memCache&&(x=this._memCache.get(b.id)))return x.reference(),[2,x];q=h.pool.acquire(b,this._vectorTileLayer.tileInfo,this._vectorTileLayer.styleRepository,0);p&&p.tileData?(q.setData(p.tileData,p.client),this._memCache&&(q.reference(),this._memCache.put(q.key.id,q,q.getMemoryUsage()*
q.referenced,e.MIN_PRIORITY))):q.setData(null,null);return[2,q]}})})};b.prototype.releaseVectorTile=function(a){!this._memCache||a.release()?h.pool.release(a):this._memCache.updateSize(a.key.id,a,a.getMemoryUsage()*a.referenced)};b.prototype.fetchTileData=function(a,g){return d(this,void 0,void 0,function(){var e,n,h,c;return k(this,function(b){switch(b.label){case 0:return[4,this._getRefKeys(a,g)];case 1:e=b.sent();n=this._vectorTileLayer.sourceNameToSource;h=[];for(c in n)h.push(c);return[2,this._getSourcesData(h,
e,g)]}})})};b.prototype.parseTileData=function(a,e,n){return d(this,void 0,void 0,function(){var h,b,p,q,C,x,t,v;return k(this,function(D){switch(D.label){case 0:h=a&&a.data;if(!h)return[2,null];b=h.sourceName2DataAndRefKey;p=h.transferList;return 0===Object.keys(b).length?[2,null]:[4,this._broadcastPromise];case 1:return D.sent(),q=Math.round(g.degToByte(e)),C=this._connection.getAvailableClient(),[4,C.invoke("createTileAndParse",{key:a.key.id,rotation:q,cacheTile:this.allowUpdates,sourceName2DataAndRefKey:b},
r({},n,{transferList:p}))];case 2:x=D.sent();if(c("esri-vector-tiles-debug")){t={};for(v in b)t[v]=b[v].refKey;return[2,{tileData:x,client:C,refKeys:t}]}return[2,{tileData:x,client:C}]}})})};Object.defineProperty(b.prototype,"updating",{get:function(){return 0<this._ongoingTileRequests.size},enumerable:!0,configurable:!0});b.prototype.abortAll=function(){this._ongoingRequestToController.forEach(function(a){return a.abort()});this._ongoingRequestToController.clear();this._ongoingTileRequests.clear()};
b.prototype.getSprites=function(a){var g=this;return this._spriteSourcePromise.then(function(){return g._spriteMosaic.getSpriteItems(a)})};b.prototype.getGlyphs=function(a){return this._glyphMosaic.getGlyphItems(a.tileID,a.font,a.codePoints)};b.prototype.getStyleRepository=function(){return this._vectorTileLayer.styleRepository};b.prototype._getTilePayload=function(a,g,e){return d(this,void 0,void 0,function(){var h,b,c,p,q;return k(this,function(x){switch(x.label){case 0:return h=n.pool.acquire(a.id),
b=this._vectorTileLayer.sourceNameToSource,c=b[g],p=c.getSourceTileUrl(h.level,h.row,h.col),n.pool.release(h),[4,f(p,r({responseType:"array-buffer"},e))];case 1:return q=x.sent(),[2,{protobuff:q.data,sourceName:g}]}})})};b.prototype._fetchTileMap=function(a,g){if(a.capabilities.operations.supportsTileMap&&a.tileIndex||!a.tileMapURL)return p.resolve();var e=v.get(a.tileMapURL);if(e)return a.tileIndex=e,p.resolve();if(t.has(a.tileMapURL))return t.get(a.tileMapURL).then(function(g){a.tileIndex=new z(g.data)});
g=f(a.tileMapURL,g);g.then(function(g){a.tileIndex=new z(g.data);t["delete"](a.tileMapURL);v.put(a.tileMapURL,a.tileIndex)});t.set(a.tileMapURL,g);return g};b.prototype._getRefKeys=function(a,g){return d(this,void 0,void 0,function(){var e,h,n,b,c;return k(this,function(q){e=this._vectorTileLayer.sourceNameToSource;h=[];for(n in e)b=e[n],c=b.getRefKey(a,g),h.push(c);return[2,p.eachAlways(h)]})})};b.prototype._getSourcesData=function(a,g,e){return d(this,void 0,void 0,function(){var h,n,b,c,q,x,t;
return k(this,function(v){switch(v.label){case 0:h=[];for(n=0;n<g.length;n++)null==g[n].value||null==a[n]?h.push(null):(b=this._getTilePayload(g[n].value,a[n],e),h.push(b));return[4,p.eachAlways(h)];case 1:c=v.sent();q={};x=[];for(n=0;n<c.length;n++)c[n].value&&c[n].value&&c[n].value.protobuff&&0<c[n].value.protobuff.byteLength&&(t=g[n].value.id,q[c[n].value.sourceName]={refKey:t,protobuff:c[n].value.protobuff},x.push(c[n].value.protobuff));return[2,{sourceName2DataAndRefKey:q,transferList:x}]}})})};
b.prototype._getVectorTileData=function(a,g){return d(this,void 0,void 0,function(){var e,n,h,c,b,q=this;return k(this,function(x){e=a.id;if(this._ongoingTileRequests.has(e))return[2,this._ongoingTileRequests.get(e)];n=new AbortController;h={signal:n.signal};c=g&&g.signal;b=this._getParsedVectorTileData(a,h).then(function(a){q._ongoingTileRequests.delete(e);q._ongoingRequestToController.delete(e);return a}).catch(function(){q._ongoingTileRequests.delete(e);q._ongoingRequestToController.delete(e);
return null});this._ongoingTileRequests.set(e,b);this._ongoingRequestToController.set(e,n);if(c)p.onAbort(c,function(){n.abort();q._ongoingTileRequests.delete(e);q._ongoingRequestToController.delete(e)});return[2,b]})})};b.prototype._getParsedVectorTileData=function(a,g){return d(this,void 0,void 0,function(){var e;return k(this,function(n){switch(n.label){case 0:return[4,this.fetchTileData(a,g)];case 1:return e=n.sent(),[2,this.parseTileData({key:a,data:e},0,g)]}})})};return b}()})},"esri/core/ItemCache":function(){define(["require",
"exports","./MemCache"],function(y,m,r){return function(){function k(d,f){this._storage=new r.MemCacheStorage;this._storage.maxSize=d;f&&this._storage.registerRemoveFunc("",f)}k.prototype.put=function(d,f){this._storage.put(d,f,1,1)};k.prototype.pop=function(d){return this._storage.pop(d)};k.prototype.get=function(d){return this._storage.get(d)};k.prototype.clear=function(){this._storage.clearAll()};k.prototype.destroy=function(){this._storage.clearAll()};return k}()})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define("require exports ../../../../core/has ../../../../core/promiseUtils ../../../webgl ./RectangleBinPack ../webgl/Rect".split(" "),
function(y,m,r,k,d,f,a){return function(){function c(a,e,c){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=a;this.height=e;this._glyphSource=c;this._binPack=new f(a-4,e-4);this._glyphData.push(new Uint8Array(a*e));this._dirties.push(!0);this._textures.push(void 0)}c.prototype.getGlyphItems=function(c,e,p){var b=this,l=[],g=this._glyphSource;c=new Set;for(var w=1/256,q=0;q<p.length;q++)c.add(Math.floor(p[q]*
w));var u=[];c.forEach(function(a){if(256>=a){var h=e+a;b._rangePromises.has(h)?u.push(b._rangePromises.get(h)):(a=g.getRange(e,a).then(function(){b._rangePromises["delete"](h)},function(){b._rangePromises["delete"](h)}),b._rangePromises.set(h,a),u.push(a))}});return k.all(u).then(function(c){var h=b._glyphIndex[e];h||(h={},b._glyphIndex[e]=h);for(var n=0;n<p.length;n++){c=p[n];var q=h[c];if(q)l[c]={sdf:!0,rect:q.rect,metrics:q.metrics,page:q.page};else{var v=g.getGlyph(e,c);if(v&&v.metrics){var q=
v.metrics,t=void 0;if(0===q.width)t=new a.default(0,0,0,0);else{var u=q.width+6,x=q.height+6,w=u%4?4-u%4:4,D=x%4?4-x%4:4;1===w&&(w=5);1===D&&(D=5);t=b._binPack.allocate(u+w,x+D);t.isEmpty&&(b._dirties[b._currentPage]||(b._glyphData[b._currentPage]=null),b._currentPage=b._glyphData.length,b._glyphData.push(new Uint8Array(b.width*b.height)),b._dirties.push(!0),b._textures.push(void 0),b._binPack=new f(b.width-4,b.height-4),t=b._binPack.allocate(u+w,x+D));var w=b._glyphData[b._currentPage],v=v.bitmap,
d=D=void 0;if(v)for(var z=0;z<x;z++)for(var D=u*z,d=b.width*(t.y+z+1)+t.x,k=0;k<u;k++)w[d+k+1]=v[D+k]}h[c]={rect:t,metrics:q,tileIDs:null,page:b._currentPage};l[c]={sdf:!0,rect:t,metrics:q,page:b._currentPage};b._dirties[b._currentPage]=!0}}}return l})};c.prototype.removeGlyphs=function(a){for(var e in this._glyphIndex){var b=this._glyphIndex[e];if(b){var c=void 0,l;for(l in b)if(c=b[l],c.tileIDs["delete"](a),0===c.tileIDs.size){for(var g=this._glyphData[c.page],w=c.rect,q=void 0,u=void 0,d=0;d<w.height;d++)for(q=
this.width*(w.y+d)+w.x,u=0;u<w.width;u++)g[q+u]=0;delete b[l];this._dirties[c.page]=!0}}}};c.prototype.bind=function(a,e,c,x){void 0===x&&(x=0);this._textures[c]||(this._textures[c]=new d.Texture(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var b=this._textures[c];b.setSamplingMode(e);this._dirties[c]&&b.setData(this._glyphData[c]);a.bindTexture(b,x);this._dirties[c]=!1};c.prototype.dispose=function(){this._binPack=null;for(var a=
0,e=this._textures;a<e.length;a++){var c=e[a];c&&c.dispose()}this._textures.length=0};return c}()})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["require","exports","../webgl/Rect"],function(y,m,r){return function(){function k(d,f){this._height=this._width=0;this._free=[];this._width=d;this._height=f;this._free.push(new r.default(0,0,d,f))}Object.defineProperty(k.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"height",{get:function(){return this._height},enumerable:!0,configurable:!0});k.prototype.allocate=function(d,f){if(d>this._width||f>this._height)return new r.default;for(var a=null,c=-1,b=0;b<this._free.length;++b){var e=this._free[b];d<=e.width&&f<=e.height&&(null===a||e.y<=a.y&&e.x<=a.x)&&(a=e,c=b)}if(null===a)return new r.default;this._free.splice(c,1);a.width<a.height?(a.width>d&&this._free.push(new r.default(a.x+d,a.y,a.width-d,f)),a.height>f&&this._free.push(new r.default(a.x,a.y+f,a.width,
a.height-f))):(a.width>d&&this._free.push(new r.default(a.x+d,a.y,a.width-d,a.height)),a.height>f&&this._free.push(new r.default(a.x,a.y+f,d,a.height-f)));return new r.default(a.x,a.y,d,f)};k.prototype.release=function(d){for(var f=0;f<this._free.length;++f){var a=this._free[f];if(a.y===d.y&&a.height===d.height&&a.x+a.width===d.x)a.width+=d.width;else if(a.x===d.x&&a.width===d.width&&a.y+a.height===d.y)a.height+=d.height;else if(d.y===a.y&&d.height===a.height&&d.x+d.width===a.x)a.x=d.x,a.width+=d.width;
else if(d.x===a.x&&d.width===a.width&&d.y+d.height===a.y)a.y=d.y,a.height+=d.height;else continue;this._free.splice(f,1);this.release(d)}this._free.push(d)};return k}()})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define("require exports ../../../../request ../../../../core/has ../../../../core/pbf ../../../../core/promiseUtils".split(" "),function(y,m,r,k,d,f){var a=function(){function a(a){this._metrics=[];this._bitmaps=[];if(a)for(;a.next();)switch(a.tag()){case 1:for(var e=a.getMessage();e.next();)switch(e.tag()){case 3:for(var c=
e.getMessage(),b=void 0,g=void 0,w=void 0,q=void 0,u=void 0,d=void 0,h=void 0;c.next();)switch(c.tag()){case 1:b=c.getUInt32();break;case 2:g=c.getBytes();break;case 3:w=c.getUInt32();break;case 4:q=c.getUInt32();break;case 5:u=c.getSInt32();break;case 6:d=c.getSInt32();break;case 7:h=c.getUInt32();break;default:c.skip()}c.release();b&&(this._metrics[b]={width:w,height:q,left:u,top:d,advance:h},this._bitmaps[b]=g);break;default:e.skip()}e.release();break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};
a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),c=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,c){this._ranges[a]=c};return a}();return function(){function b(a){this._glyphInfo={};this._baseURL=a}b.prototype.getRange=function(c,b){var e=this._getFontStack(c);if(e.getRange(b))return f.resolve();var p=256*b,g=p+255;c=this._baseURL.replace("{fontstack}",c).replace("{range}",p+"-"+g);return r(c,
{responseType:"array-buffer"}).then(function(c){e.addRange(b,new a(new d(new Uint8Array(c.data),new DataView(c.data))))}).catch(function(){e.addRange(b,new a)})};b.prototype.getGlyph=function(a,c){if(a=this._getFontStack(a)){var b=Math.floor(c/256);if(!(256<b)&&(a=a.getRange(b)))return{metrics:a.getMetrics(c),bitmap:a.getBitmap(c)}}};b.prototype._getFontStack=function(a){var b=this._glyphInfo[a];b||(b=this._glyphInfo[a]=new c);return b};return b}()})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define(["require",
"exports","../../../webgl","./RectangleBinPack","../webgl/Rect"],function(y,m,r,k,d){return function(){function f(a,c,b){void 0===b&&(b=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=a||0>=c)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=c;0<b&&(this._maxItemSize=b);this._binPack=
new k(a-4,c-4)}f.prototype.getWidth=function(a){return a>=this._size.length?-1:this._size[a][0]};f.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};f.prototype.setSpriteSource=function(a){this.dispose();this.pixelRatio=a.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new k(this._pageWidth-4,this._pageHeight-4);var c=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=c;this._dirties.push(!0);this._size.push([this._pageWidth,
this._pageHeight]);this._textures.push(void 0)}this._sprites=a};f.prototype.getSpriteItem=function(a,c){void 0===c&&(c=!1);var b=this._mosaicRects[a];if(b)return b;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;b=this._sprites.getSpriteInfo(a);if(!b||!b.width||!b.height||0>b.width||0>b.height)return null;var e=b.width,p=b.height,d=this._allocateImage(e,p),l=d[0],g=d[1];if(0>=l.width)return null;this._copy(l,b,g,d[2],c);b={rect:l,width:e,height:p,sdf:b.sdf,simplePattern:!1,pixelRatio:b.pixelRatio,
page:g};return this._mosaicRects[a]=b};f.prototype.preloadSpriteItems=function(){for(var a=0,c=this._sprites.spriteNames;a<c.length;a++)this.getSpriteItem(c[a],!0)};f.prototype.getSpriteItems=function(a){for(var c={},b=0;b<a.length;b++){var e=a[b];c[e]=this.getSpriteItem(e)}return c};f.prototype.getMosaicItemPosition=function(a,c){c=(a=this.getSpriteItem(a,c))&&a.rect;if(!c)return null;c.width=a.width;c.height=a.height;return{size:[a.width,a.height],tl:[(c.x+2)/this._size[a.page][0],(c.y+2)/this._size[a.page][1]],
br:[(c.x+2+a.width)/this._size[a.page][0],(c.y+2+a.height)/this._size[a.page][1]],page:a.page}};f.prototype.bind=function(a,c,b,e){void 0===b&&(b=0);void 0===e&&(e=0);this._textures[b]||(this._textures[b]=new r.Texture(a,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[b][0],height:this._size[b][1]},new Uint8Array(this._mosaicsData[b].buffer)));var p=this._textures[b];p.setSamplingMode(c);this._dirties[b]&&p.setData(new Uint8Array(this._mosaicsData[b].buffer));a.bindTexture(p,e);this._dirties[b]=
!1};f._copyBits=function(a,c,b,e,p,d,l,g,w,q,u){var f=e*c+b;l=g*d+l;if(u)for(l-=d,u=-1;u<=q;u++,f=((u+q)%q+e)*c+b,l+=d)for(g=-1;g<=w;g++)p[l+g]=a[f+(g+w)%w];else for(u=0;u<q;u++){for(g=0;g<w;g++)p[l+g]=a[f+g];f+=c;l+=d}};f.prototype._copy=function(a,c,b,e,p,d){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(b>=this._mosaicsData.length)){var l=new Uint32Array(d?d.buffer:this._sprites.image.buffer),g=this._mosaicsData[b];g&&l||console.error("Source or target images are uninitialized!");f._copyBits(l,
d?c.width:this._sprites.width,c.x,c.y,g,e[0],a.x+2,a.y+2,c.width,c.height,p);this._dirties[b]=!0}};f.prototype._allocateImage=function(a,c){a+=2;c+=2;var b=Math.max(a,c);if(this._maxItemSize&&this._maxItemSize<b)return b=new d.default(0,0,a,c),this._mosaicsData.push(new Uint32Array(a*c)),this._dirties.push(!0),this._size.push([a,c]),this._textures.push(void 0),[b,this._mosaicsData.length-1,[a,c]];var b=a%4?4-a%4:4,e=c%4?4-c%4:4;1===b&&(b=5);1===e&&(e=5);b=this._binPack.allocate(a+b,c+e);return 0>=
b.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new k(this._pageWidth-4,this._pageHeight-4),this._allocateImage(a,c)):[b,this._currentPage,[this._pageWidth,this._pageHeight]]};f.prototype.dispose=function(){this._binPack=null;this._mosaicRects=
{};for(var a=0,c=this._textures;a<c.length;a++){var b=c[a];b&&b.dispose()}this._textures.length=0};return f}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["require","exports","../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(y,m,r,k,d){return function(){function f(a){if(a instanceof k.TilemapCache)this._tilemapCache=a;else if(a&&"index"in a)this._tilemap=a.index;else throw Error("Invalid tilemap!");}f.prototype.dataKey=
function(a,c){if(this._tilemapCache){var b=a.level,e=a.row,p=a.col,f=new d(a);return this._tilemapCache.fetchAvailabilityUpsample(b,e,p,f,c).then(function(){return f}).catch(function(a){if(r.isAbortError(a))throw a;f.level=b;f.row=e;f.col=p;return f})}return this._getIndexedDataKey(a)};f.prototype.forEach=function(a,c,b,e,d){this._callback=d;this._maxLevel=c+a;this._forEach(this._tilemap,c,b,e)};f.prototype._forEach=function(a,c,b,e){0!==a&&(this._callback(c,b,e),c!==this._maxLevel&&"object"===typeof a&&
(this._forEach(a[0],c+1,2*b,2*e),this._forEach(a[1],c+1,2*b,2*e+1),this._forEach(a[2],c+1,2*b+1,2*e),this._forEach(a[3],c+1,2*b+1,2*e+1)))};f.prototype._getIndexedDataKey=function(a){var c=[a];if(0>a.level||0>a.row||0>a.col||0<a.row>>a.level||0<a.col>>a.level)return r.resolve(null);for(;0!==a.level;)a=new d(a.level-1,a.row>>1,a.col>>1,a.world),c.push(a);a=this._tilemap;var b=c.pop(),e,p;if(1===a)return r.resolve(b);for(;c.length;)if(e=c.pop(),p=(e.col&1)+((e.row&1)<<1),a){if(0===a[p]){b=null;break}if(1===
a[p]){b=e;break}b=e;a=a[p]}return r.resolve(b)};return f}()})},"esri/layers/support/TilemapCache":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),
function(y,m,r,k,d,f,a,c,b,e,p,x,l,g,w,q,u,z,h,n){Object.defineProperty(m,"__esModule",{value:!0});m.TILEMAP_SIZE_EXP=5;var A=x.getLogger("esri.layers.support.TilemapCache");y=function(b){function t(a){a=b.call(this)||this;a._handles=new p;a._pendingTilemapRequests={};a._availableLevels={};a.levels=5;a.cacheByteSize=2097152;a.request=c;a._prefetchingEnabled=!0;return a}k(t,b);v=t;t.prototype.initialize=function(){var a=this;this._tilemapCache=new l(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl",
"layer.tileServers?"],function(){return a._initializeTilemapDefinition()}),z.init(this,"layer.tileInfo.lods",function(c){return a._initializeAvailableLevels(c)},!0)]);this._initializeTilemapDefinition()};t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};t.prototype.castLevels=function(a){return 2>=a?(A.error("Minimum levels for Tilemap is 3, but got ",a),3):a};Object.defineProperty(t.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0});
t.prototype.fetchTilemap=function(a,c,g,b){var h=this;if(!this._availableLevels[a])return w.reject(new e("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"));var q=this._tmpTilemapDefinition;if(a=this._tilemapFromCache(a,c,g,q))return w.resolve(a);var t=b&&b.signal;b=r({},b,{signal:null});return w.create(function(a,c){w.onAbort(t,function(){return c(w.createAbortError())});var g=n.tilemapDefinitionId(q),e=h._pendingTilemapRequests[g];if(!e){var e=n.Tilemap.fromDefinition(q,
b).then(function(a){h._tilemapCache.put(g,a,a.byteSize);return a}),v=function(){return delete h._pendingTilemapRequests[g]};h._pendingTilemapRequests[g]=e;e.then(v,v)}e.then(a,c)})};t.prototype.getAvailability=function(a,c,g){return this._availableLevels[a]?(a=this._tilemapFromCache(a,c,g,this._tmpTilemapDefinition))?a.getAvailability(c,g):"unknown":"unavailable"};t.prototype.getAvailabilityUpsample=function(a,c,g,b){b.level=a;b.row=c;b.col=g;a=this.layer.tileInfo;for(a.updateTileInfo(b);;)if(c=this.getAvailability(b.level,
b.row,b.col),"unavailable"===c){if(!a.upsampleTile(b))return"unavailable"}else return c};t.prototype.fetchAvailability=function(a,c,g,b){return this._availableLevels[a]?this.fetchTilemap(a,c,g,b).catch(function(a){return a}).then(function(b){return b instanceof n.Tilemap?(b=b.getAvailability(c,g),"unavailable"===b?w.reject(new e("tile-map:tile-unavailable","Tile is not available",{level:a,row:c,col:g})):b):w.isAbortError(b)?w.reject(b):"unknown"}):w.reject(new e("tilemap-cache:level-unavailable",
"Level "+a+" is unavailable in the service"))};t.prototype.fetchAvailabilityUpsample=function(a,c,g,b,n){var e=this;b.level=a;b.row=c;b.col=g;var h=this.layer.tileInfo;h.updateTileInfo(b);var q=this.fetchAvailability(a,c,g,n).catch(function(a){if(w.isAbortError(a))throw a;if(h.upsampleTile(b))return e.fetchAvailabilityUpsample(b.level,b.row,b.col,b);throw a;});this._fetchAvailabilityUpsamplePrefetch(b.id,a,c,g,n,q);return q};t.prototype._fetchAvailabilityUpsamplePrefetch=function(c,b,g,n,e,h){return a(this,
void 0,void 0,function(){var a,t,u,d,p,l,D,k,x,z;return f(this,function(f){switch(f.label){case 0:if(!this._prefetchingEnabled)return[2];a="prefetch-"+c;if(this._handles.has(a))return[2];t=w.createAbortController();h.then(function(){return t.abort()},function(){return t.abort()});u=!1;d={remove:function(){u||(u=!0,t.abort())}};this._handles.add(d,a);f.label=1;case 1:return f.trys.push([1,3,,4]),[4,q.waitTicks(10,t.signal)];case 2:return f.sent(),[3,4];case 3:return f.sent(),[3,4];case 4:u||(u=!0,
this._handles.remove(a));if(w.isAborted(t))return[2];p={id:c,level:b,row:g,col:n};l=r({},e,{signal:t.signal});D=this.layer.tileInfo;k=function(a){var c=x.fetchAvailability(p.level,p.row,p.col,l);v._prefetches.push(c);a=function(){v._prefetches.removeUnordered(c)};c.then(a,a)};x=this;for(z=0;v._prefetches.length<v._maxPrefetch&&D.upsampleTile(p);++z)k(z);return[2]}})})};t.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var a=this.layer.parsedUrl,c=a.query;this._tilemapCache.clear();
this._tmpTilemapDefinition={service:{url:a.path,query:c?u.objectToQuery(c):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};t.prototype._tilemapFromCache=function(a,c,b,g){a=this._getTilemapDefinition(a,c,b,g);a=n.tilemapDefinitionId(a);return this._tilemapCache.get(a)};t.prototype._getTilemapDefinition=function(a,c,b,g){g.level=a;a=a>m.TILEMAP_SIZE_EXP;g.row=a?c-c%this.size:c;g.col=a?b-b%this.size:b;return g};
t.prototype._initializeAvailableLevels=function(a){var c=this;this._availableLevels={};a&&a.forEach(function(a){return c._availableLevels[a.level]=!0})};Object.defineProperty(t.prototype,"test",{get:function(){var a=this;return{get prefetchingEnabled(){return a._prefetchingEnabled},set prefetchingEnabled(c){a._prefetchingEnabled=this.prefetchingEnabled},hasTilemap:function(c,b,g){return!!a._tilemapFromCache(c,b,g,a._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0});var v;t._maxPrefetch=4;t._prefetches=
new g({initialSize:v._maxPrefetch});d([h.property({constructOnly:!0,type:Number})],t.prototype,"levels",void 0);d([h.cast("levels")],t.prototype,"castLevels",null);d([h.property({readOnly:!0,dependsOn:["levels"],type:Number})],t.prototype,"size",null);d([h.property({constructOnly:!0,type:Number})],t.prototype,"cacheByteSize",void 0);d([h.property({constructOnly:!0})],t.prototype,"layer",void 0);d([h.property({constructOnly:!0})],t.prototype,"request",void 0);return t=v=d([h.subclass("esri.layers.support.TilemapCache")],
t)}(h.declared(b));m.TilemapCache=y})},"esri/layers/support/Tilemap":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/arrayUtils ../../core/Error ../../core/lang ../../core/promiseUtils".split(" "),function(y,m,r,k,d,f,a,c){function b(a){var c;"vector-tile"===a.service.type?c=a.service.url+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height:(c=a.service.tileServers,c=(c&&c.length?c[a.row%c.length]:a.service.url)+"/tilemap/"+a.level+"/"+a.row+
"/"+a.col+"/"+a.width+"/"+a.height);(a=a.service.query)&&(c=c+"?"+a);return c}Object.defineProperty(m,"__esModule",{value:!0});y=function(){function e(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}e.prototype.getAvailability=function(a,c){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(c-this.location.left);c=a>>3;var b=this._tileAvailabilityBitSet;return 0>c||c>b.length?"unknown":b[c]&
1<<a%8?"available":"unavailable"};e.prototype._updateFromData=function(a){for(var c=!0,b=!0,g=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),e=0,q=0;q<a.length;q++){var u=q%8;a[q]?(b=!1,g[e]|=1<<u):c=!1;7===u&&++e}b?this._allAvailability="unavailable":c?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=g,this.byteSize+=g.length)};e.fromDefinition=function(a,x){var l=a.service.request||k,g=a.row,w=a.col,q=a.width,u=a.height,p={query:{f:"json"}};
x=x?r({},p,x):p;return l(b(a),x).then(function(a){return a.data}).catch(function(a){return a&&a.details&&422===a.details.httpStatus?{location:{top:g,left:w,width:q,height:u},valid:!0,data:d.constant(q*u,0)}:c.reject(a)}).then(function(a){if(a.location&&(a.location.top!==g||a.location.left!==w||a.location.width!==q||a.location.height!==u))throw new f("tilemap:location-mismatch","Tilemap response for different location than requested",{response:a,definition:{top:g,left:w,width:q,height:u}});return e.fromJSON(a)})};
e.fromJSON=function(c){e.validateJSON(c);var b=new e;b.location=Object.freeze(a.clone(c.location));b._updateFromData(c.data);return Object.freeze(b)};e.validateJSON=function(a){if(!a||!a.location)throw new f("tilemap:missing-location","Location missing from tilemap response");if(!1===a.valid)throw new f("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new f("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new f("tilemap:data-mismatch",
"Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new f("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return e}();m.Tilemap=y;m.tilemapDefinitionId=function(a){return a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height};m.tilemapDefinitionUrl=b;m.default=y})},"esri/views/2d/engine/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../geometry/support/spatialReferenceUtils ../../../webgl ../../engine ./RenderBucket".split(" "),
function(y,m,r,k,d,f,a,c,b,e){var p="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ");return function(b){function l(){for(var a,c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];e=b.call(this)||this;e._renderBuckets=[];e._vectorTileData=
null;e._symbolUpdateData=null;e._memoryUsed=-1;e.coords=[0,0];e.bounds=[0,0,0,0];e.tileTransform={transform:d.mat4f32.create(),displayCoord:f.vec2f32.create()};e.stencilData={mask:0,reference:0};e._referenced=0;e.triangleCount=0;0<c.length&&(a=e.acquire).call.apply(a,[e].concat(c));return e}r(l,b);Object.defineProperty(l.prototype,"stencilRef",{get:function(){return this.stencilData.reference},enumerable:!0,configurable:!0});l.prototype.acquire=function(c,b,e,u){this.key=c;this._referenced=1;this._memoryUsed=
-1;this._vectorTileData=this._symbolUpdateData=null;var g=b.lodAt(c.level),g=null!==g?g.resolution:0,h=b.size[0]*g,n=b.origin,q=c.col*h,v=c.row*h,t=b.spatialReference,d=0;t&&(t._isWrappable?t._isWrappable():t.isWrappable)&&(t=a.getInfo(t),d=t.valid[1]-t.valid[0]);q=n.x+q+c.world*d;n=n.y-v;this.coords[0]=q;this.coords[1]=n;this.bounds[0]=q;this.bounds[1]=n;this.bounds[2]=q+h;this.bounds[3]=n-h;this.widthInPixels=b.size[1];this.coordRange=4096;this.resolution=g;this.rotation=u;this.styleLayers=e;this.id=
c.id};l.prototype.setData=function(a,c,b){this._vectorTileData=a;this.client=c;this.refKeys=b;this._memoryUsed=-1};l.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};l.prototype.updateTileData=function(a){this._vectorTileData=a;this.stage.requestRender();this._memoryUsed=-1};l.prototype.dispose=function(){for(var a=0,c="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" ");a<
c.length;a++){var b=c[a];this[b]&&(this[b].dispose(),this[b]=null)}this._renderBuckets.length=0;this._memoryUsed=-1};l.prototype.release=function(){return 0===--this._referenced?(this.dispose(),this.attached=!1,this.stage=null,!0):!1};l.prototype.reference=function(){++this._referenced};Object.defineProperty(l.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0});l.prototype.getMemoryUsage=function(){var a=this;-1===this._memoryUsed&&(this._memoryUsed=p.reduce(function(c,
b){return a[b]?c+a[b].size:c},0),this.texture&&(this._memoryUsed+=this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce(function(a,c){return a+c.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength));return this._memoryUsed/(this._referenced||1)};l.prototype.attach=function(){return this._vectorTileData?(this.ready(),!0):
!1};l.prototype.attachWithContext=function(a){this.stage={context:a};this.attached=this.attach()};l.prototype._commitChanges=function(){this._vectorTileData&&(this.dispose(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null,this._memoryUsed=-1)};l.prototype._createRenderBuckets=function(){for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),c=a.length,b=0;b<c;){var u=a[b];switch(a[b+1]){case 0:var d=new e.BackgroundRenderBucket;d.layerID=u;this._renderBuckets.push(d);
b+=2;break;case 1:d=new e.FillRenderBucket;d.layerID=u;d.triangleElementStart=a[b+2];d.triangleElementCount=a[b+3];d.outlineElementStart=a[b+4];d.outlineElementCount=a[b+5];this._renderBuckets.push(d);b+=6;break;case 2:d=new e.LineRenderBucket;d.layerID=u;d.triangleElementStart=a[b+2];d.triangleElementCount=a[b+3];this._renderBuckets.push(d);b+=4;break;case 3:d=new e.SymbolRenderBucket;d.layerID=u;d.isSDF=0!==a[b+2];var h=b+3,u=a[h];h++;for(var n=0;n<u;n++){var f=a[h],v=a[h+1],t=a[h+2];d.markerPerPageElementsMap.set(f,
[v,t]);h+=3}var l=a[h];h++;for(n=0;n<l;n++)f=a[h],v=a[h+1],t=a[h+2],d.glyphPerPageElementsMap.set(f,[v,t]),h+=3;this._renderBuckets.push(d);b+=5+3*u+3*l;break;case 4:d=new e.CircleRenderBucket;d.layerID=u;d.triangleElementStart=a[b+2];d.triangleElementCount=a[b+3];this._renderBuckets.push(d);b+=4;break;default:console.error("Bad bucket type!"),b+=2}}};l._createBufferToObject=function(){var a=[];a[1]={create:c.BufferObject.createVertex,var:"fillVertexBuffer"};a[2]={create:c.BufferObject.createVertex,
var:"fillDDVertexBuffer"};a[3]={create:c.BufferObject.createIndex,var:"fillIndexBuffer"};a[4]={create:c.BufferObject.createVertex,var:"outlineVertexBuffer"};a[5]={create:c.BufferObject.createVertex,var:"outlineDDVertexBuffer"};a[6]={create:c.BufferObject.createIndex,var:"outlineIndexBuffer"};a[7]={create:c.BufferObject.createVertex,var:"lineVertexBuffer"};a[8]={create:c.BufferObject.createVertex,var:"lineDDVertexBuffer"};a[9]={create:c.BufferObject.createIndex,var:"lineIndexBuffer"};a[10]={create:c.BufferObject.createVertex,
var:"iconVertexBuffer"};a[11]={create:c.BufferObject.createVertex,var:"iconDDVertexBuffer"};a[12]={create:c.BufferObject.createIndex,var:"iconIndexBuffer"};a[13]={create:c.BufferObject.createVertex,var:"textVertexBuffer"};a[14]={create:c.BufferObject.createVertex,var:"textDDVertexBuffer"};a[15]={create:c.BufferObject.createIndex,var:"textIndexBuffer"};a[16]={create:c.BufferObject.createVertex,var:"circleVertexBuffer"};a[17]={create:c.BufferObject.createIndex,var:"circleIndexBuffer"};return a};l.prototype._createBufferObjects=
function(){for(var a=this.stage.context,c=new Uint32Array(this._vectorTileData.bufferDataInfo),b=c.length,e=0;e<b;e+=2){var d=e/2;if(!(0>=c[e+1]||0===this._vectorTileData.bufferData[d].byteLength)){var h=c[e],n=l.bufferToObject[h];n?this[n.var]?this[n.var].setData(this._vectorTileData.bufferData[d]):this[n.var]=n.create(a,35044,this._vectorTileData.bufferData[d]):console.error("Bad buffer type "+h)}}};l.prototype.detach=function(){this.isReady&&this.client&&this.client.invoke("destructTileData",this.id);
this.dispose();b.prototype.detach.call(this)};l.prototype.doRender=function(a){if(this.visible&&this.isReady){var c=this.stage.context,b=a.renderer;if(c&&b){this._commitChanges();var e=a.drawphase;this._symbolUpdateData&&(this._updateSymbolData(a,this._symbolUpdateData),this._symbolUpdateData=null);c.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var g=this.styleLayers,h=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==h){var n=this._renderBuckets.length;if(1===e)for(var d=
n-1;0<=d;d--){var v=this._renderBuckets[d],t=g.layers[v.layerID];if(!v||!t)break;1!==v.type&&0!==v.type||!v.hasData()||(this.triangleCount+=b.renderBucket(c,v,a.displayLevel,a.requiredLevel,e,this,t,h))}else for(d=0;d<n;d++){v=this._renderBuckets[d];t=g.layers[v.layerID];if(!v||!t)break;v.hasData()&&(this.triangleCount+=b.renderBucket(c,v,a.displayLevel,a.requiredLevel,e,this,t,h))}}}}};l.prototype._updateSymbolData=function(a,b){if(!b||!b.bucketDataInfo)return!0;a=new Uint32Array(b.bucketDataInfo);
var g=a.length;if(0===g)return!0;this._memoryUsed=-1;if(!this.isReady)return this.requestRender(),!1;for(var d=this.stage.context,f=new Uint32Array(b.bufferDataInfo),h=f.length,n=0,l=0;l<h;l+=2,n++)switch(f[l]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=c.BufferObject.createVertex(d,35044,b.bufferData[n]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=
c.BufferObject.createVertex(d,35044,b.bufferData[n]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=c.BufferObject.createIndex(d,35044,b.bufferData[n]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=c.BufferObject.createVertex(d,35044,b.bufferData[n]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=
c.BufferObject.createVertex(d,35044,b.bufferData[n]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=c.BufferObject.createIndex(d,35044,b.bufferData[n])}b=[];for(d=0;d<this._renderBuckets.length;d++)this._renderBuckets[d]instanceof e.SymbolRenderBucket||b.push(this._renderBuckets[d]);this._renderBuckets=b;for(d=0;d<g;){h=a[d];f=new e.SymbolRenderBucket;f.layerID=h;f.isSDF=0!==a[d+2];this.styleLayers.layers.length>f.layerID&&this.styleLayers.layers[f.layerID].type===
f.type&&b.push(f);var v=d+3,h=a[v];v++;for(n=0;n<h;n++){var l=a[v],t=a[v+1],p=a[v+2];f.markerPerPageElementsMap.set(l,[t,p]);v+=3}var k=a[v];v++;for(n=0;n<k;n++)l=a[v],t=a[v+1],p=a[v+2],f.glyphPerPageElementsMap.set(l,[t,p]),v+=3;d+=5+3*h+3*k}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),
this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};l.pool=new k(l);l.bufferToObject=l._createBufferToObject();return l}(b.DisplayObject)})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper"],function(y,m,r){Object.defineProperty(m,"__esModule",{value:!0});y=function(){return function(d){this.type=d}}();m.RenderBucket=y;var k=
function(d){function f(){var a=d.call(this,2)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}r(f,d);f.prototype.hasData=function(){return 0<this.triangleElementCount};f.prototype.triangleCount=function(){return this.triangleElementCount/3};return f}(y);m.LineRenderBucket=k;k=function(d){function f(){var a=d.call(this,1)||this;a.triangleElementStart=0;a.triangleElementCount=0;a.outlineElementStart=0;a.outlineElementCount=0;return a}r(f,d);f.prototype.hasData=function(){return 0<this.triangleElementCount||
0<this.outlineElementCount};f.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3};return f}(y);m.FillRenderBucket=k;k=function(d){function f(){var a=d.call(this,3)||this;a.markerPerPageElementsMap=new Map;a.glyphPerPageElementsMap=new Map;a.isSDF=!1;return a}r(f,d);f.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};f.prototype.triangleCount=function(){var a=0;this.markerPerPageElementsMap.forEach(function(c){a+=
c[1]});this.glyphPerPageElementsMap.forEach(function(c){a+=c[1]});return a/3};return f}(y);m.SymbolRenderBucket=k;k=function(d){function f(){var a=d.call(this,4)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}r(f,d);f.prototype.hasData=function(){return 0<this.triangleElementCount};f.prototype.triangleCount=function(){return this.triangleElementCount/3};return f}(y);m.CircleRenderBucket=k;y=function(d){function f(){return d.call(this,0)||this}r(f,d);f.prototype.hasData=function(){return!0};
f.prototype.triangleCount=function(){return 2};return f}(y);m.BackgroundRenderBucket=y})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/has ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../webgl ../../engine ../../tiling ./GeometryUtils ./renderers/Renderer ../../tiling/TileCoverage".split(" "),
function(y,m,r,k,d,f,a,c,b,e,p,x,l,g,w,q){var u=x.enums.WGLDrawPhase;return function(p){function h(){var a=null!==p&&p.apply(this,arguments)||this;a._tileCoordinateScale=e.vec3f32.create();a._orientationVec=e.vec3f32.fromValues(0,0,1);a._displayScale=e.vec3f32.create();a._defaultTransform=c.mat4f32.create();a._displayWidth=0;a._displayHeight=0;a._backgroundTile={tileTransform:{transform:c.mat4f32.create(),displayCoord:b.vec2f32.create()},coords:[0,0],key:l.TileKey.pool.acquire(),coordRange:4096};
a._pointToCallbacks=new Map;return a}r(h,p);h.prototype.initialize=function(a,c,b,e){var n=this;this._spriteMosaicPromise=a;this._spriteMosaicPromise.then(function(b){n._spriteMosaicPromise===a&&(n._renderer=new w(b,c))});this._tileInfoView=e;this._tileInfo=b};h.prototype.dispose=function(){this._renderer&&this._renderer.dispose();l.TileKey.pool.release(this._backgroundTile.key);p.prototype.dispose.call(this)};h.prototype.hitTest=function(a,c){var b=this,e=[a,c];return d.create(function(a,c){b._pointToCallbacks.set(e,
{resolve:a,reject:c});b.requestRender()},function(){b._pointToCallbacks.has(e)&&b._pointToCallbacks.delete(e)})};h.prototype.renderChildren=function(a){var c=this;if(0!==this.children.length&&this._tileInfoView&&a&&a.state&&(a.drawPhase===u.MAP||a.drawPhase===u.HITTEST))if(this._renderer){if(k("esri-vector-tiles-debug"))for(var b=0,e=this.children;b<e.length;b++){var h=e[b];h.triangleCount=0}e=a.state;b=this.stage.context;h=this._renderer;h.initializeProgramCache(this.stage.context);h.setGlobalOpacity(b,
a,this.opacity);a.displayLevel=this._tileInfoView.scaleToLevel(e.scale);a.requiredLevel=this._tileInfoView.getSmallestInfoForScale(e.scale).level;a.renderer=this._renderer;e=a.drawPhase===u.HITTEST?4:0;b.setDepthWriteEnabled(!1);b.setStencilTestEnabled(!1);this._renderBackgroundBuckets(a,this._styleRepository.backgroundBucketIds,e);b.setDepthWriteEnabled(!0);b.setStencilWriteMask(255);b.setClearDepth(1);b.setClearStencil(0);b.clear(b.gl.DEPTH_BUFFER_BIT|b.gl.STENCIL_BUFFER_BIT);b.setDepthWriteEnabled(!1);
this.sortChildren(function(a,b){a=0!==a.key.level-b.key.level?a.key.level-b.key.level:0!==a.key.row-b.key.row?a.key.row-b.key.row:a.key.col-b.key.col;return a});for(var e=this.children.length,d=1;d<=e;d++){var g=this.children[d-1];g.attached&&g.visible&&(g.stencilData.reference=d,g.stencilData.mask=255)}this._updateTilesTransform(a.state,a.requiredLevel,this.children);b.setDepthWriteEnabled(!0);this._renderer.setStateParams(a.state,a.pixelRatio,a.displayLevel);this._renderer.drawClippingMasks(b,this.children);
b.setStencilWriteMask(0);b.setBlendFunctionSeparate(1,771,1,771);b.setStencilOp(7680,7680,7681);b.setDepthFunction(515);b.setBlendingEnabled(!1);b.setStencilTestEnabled(!0);b.setDepthTestEnabled(!0);b.setDepthWriteEnabled(!0);a.drawphase=1;p.prototype.renderChildren.call(this,a);b.setDepthWriteEnabled(!1);b.setBlendingEnabled(!0);a.drawphase=2;p.prototype.renderChildren.call(this,a);a.drawphase=3;p.prototype.renderChildren.call(this,a);b.setStencilTestEnabled(!1);b.setDepthTestEnabled(!1);h.applyGlobalOpacity(b,
a,this.opacity);if(k("esri-vector-tiles-debug"))for(e=0,d=this.children;e<d.length;e++)h=d[e],h.attached&&h.visible&&this._renderer.renderTileInfo(b,h);0<this._pointToCallbacks.size&&(this._pointToCallbacks.forEach(function(b,e){var h=c._hitTest(a,e[0],e[1]);f.schedule(function(){b.resolve(h)})}),this._pointToCallbacks.clear());this._renderer.needsRedraw()&&this.requestRender()}else this.requestRender()};h.prototype.removeAllChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].dispose();
p.prototype.removeAllChildren.call(this)};h.prototype.setStyleRepository=function(a){this._styleRepository=a};h.prototype._hitTest=function(a,b,c){var e=this._tileInfoView.getSmallestInfoForScale(a.state.scale).level,h=[0,0];a.state.toMap(h,[b,c]);var d=a.state.clone(),g=d.viewpoint.clone(),n=g.targetGeometry;n.x=h[0];n.y=h[1];g.targetGeometry=n;d.viewpoint=g;d.size=[3,3];this._renderer.setStateParams(d,a.pixelRatio,a.displayLevel);return(a=this._renderer.hitTest({context:this.stage.context,drawPhase:0,
pixelRatio:a.pixelRatio,stationary:a.stationary,globalOpacity:a.globalOpacity,displayLevel:a.displayLevel,requiredLevel:a.requiredLevel,renderer:a.renderer,layerOpacity:a.layerOpacity,state:d,drawphase:4},b,c,this.children,e,3,this._updateTilesTransform.bind(this)))&&0!==a.length?a[0]:null};h.prototype._updateTilesTransform=function(a,b,c){var e=1/a.size[0],h=1/a.size[1],d=[0,0];this._calculateRelativeViewProjMat(this._tileInfo.lodAt(b).resolution,a.resolution,a.rotation,this._tileInfo.size[1],4096,
a.size[0],a.size[1],this._defaultTransform);for(var g=0;g<c.length;g++){var n=c[g];a.toScreen(d,n.coords);d[1]=a.size[1]-d[1];n.tileTransform.displayCoord[0]=2*d[0]*e-1;n.tileTransform.displayCoord[1]=2*d[1]*h-1;n.key.level===b&&4096===n.coordRange?n.tileTransform.transform.set(this._defaultTransform):this._calculateRelativeViewProjMat(this._tileInfo.lodAt(n.key.level).resolution,a.resolution,a.rotation,this._tileInfo.size[1],n.coordRange,a.size[0],a.size[1],n.tileTransform.transform)}};h.prototype._calculateRelativeViewProjMat=
function(b,c,e,h,d,f,q,l){var n=.125;512!==h&&4096!==d&&(n=h/d);b=b/c*n;this._tileCoordinateScale.set([b,b,1]);if(f!==this._displayWidth||q!==this._displayHeight)this._displayScale.set([2/f,-2/q,1]),this._displayWidth=f,this._displayHeight=q;a.mat4.identity(l);a.mat4.scale(l,l,this._tileCoordinateScale);a.mat4.rotate(l,l,-e*g.C_DEG_TO_RAD,this._orientationVec);a.mat4.scale(l,l,this._displayScale);a.mat4.transpose(l,l)};h.prototype._renderBackgroundBuckets=function(a,b,c){if(b&&0!==b.length){var e=
a.state,h=this._tileInfoView.getTileCoverage(a.state,0,"smallest"),d=e.resolution,g=e.rotation,n=e.size,f=h.spans,l=h.lodInfo,u=l.level,p=this._tileInfo,v=this.stage.context,k=a.displayLevel,w=this._backgroundTile;this._calculateRelativeViewProjMat(p.lodAt(u).resolution,d,g,p.size[1],w.coordRange,n[0],n[1],w.tileTransform.transform);for(var x,d=[0,0],g=1/e.size[0],n=1/e.size[1],p=0;p<f.length;p++)for(var r=f[p],A=r.row,z=r.colTo,r=r.colFrom;r<=z;r++){x=w.key;x.set(u,A,l.normalizeCol(r),l.getWorldForColumn(r));
this._tileInfoView.getTileCoords(w.coords,x);e.toScreen(d,w.coords);d[1]=e.size[1]-d[1];w.tileTransform.displayCoord[0]=2*d[0]*g-1;w.tileTransform.displayCoord[1]=2*d[1]*n-1;for(var m=0,y=b;m<y.length;m++){var M=y[m];x=this._styleRepository.layers[M];void 0!==x.minzoom&&x.minzoom>k+1E-6||void 0!==x.maxzoom&&x.maxzoom<=k-1E-6||this._renderer.renderBackGroundLayer(v,x,M,w,a.requiredLevel,c,1)}}q.pool.release(h)}};return h}(x.Container)})},"esri/views/2d/engine/vectorTiles/renderers/Renderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../../../engine ../GeometryUtils ./BackgroundRenderer ./CircleRenderer ./FadeRecorder ./FillRenderer ./LineRenderer ./SymbolRenderer ./TileInfoRenderer ./shaders/ProgramCache".split(" "),
function(y,m,r,k,d,f,a,c,b,e,p,x,l,g,w,q,u){return function(){function z(a,b,e){void 0===e&&(e=!0);this._extrudeMatrix=k.mat4f32.create();this._extrudeNoRotationMatrix=k.mat4f32.create();this._extrudeRotateVector=d.vec3f32.fromValues(0,0,1);this._extrudeScaleVector=d.vec3f32.fromValues(1,1,1);this._backgroundColor=f.vec4f32.fromValues(1,0,0,1);this._state={rotation:0,size:[0,0]};this._cachedRotation=this._cachedHeight=this._cachedWidth=0;this._blitRenderer=new c.BitBlitRenderer;this._programCache=
this._boundFBO=this._globalOpacityFBO=null;this._spriteMosaic=a;this._glyphMosaic=b;this._ignoreSpeed=!e;this._fadeRecorder=new x.FadeRecorder(400)}z.prototype.dispose=function(){this._backgroundRenderer&&(this._backgroundRenderer.dispose(),this._backgroundRenderer=null);this._lineRenderer&&(this._lineRenderer.dispose(),this._lineRenderer=null);this._fillRenderer&&(this._fillRenderer.dispose(),this._fillRenderer=null);this._symbolRenderer&&(this._symbolRenderer.dispose(),this._symbolRenderer=null);
this._circleRenderer&&(this._circleRenderer.dispose(),this._circleRenderer=null);this._tileInfoRenderer&&(this._tileInfoRenderer.dispose(),this._tileInfoRenderer=null);this._hittestFBO&&(this._hittestFBO.dispose(),this._hittestFBO=null);this._globalOpacityFBO&&(this._globalOpacityFBO.dispose(),this._globalOpacityFBO=null);this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._boundFBO=null;this._programCache&&(this._programCache.dispose(),this._programCache=null);this._cachedRotation=
this._cachedHeight=this._cachedWidth=0};z.prototype.initializeProgramCache=function(a){if(null===this._programCache){var b=new u.default;b.initialize(a);this._backgroundRenderer=new e(b);this._lineRenderer=new g(b);this._fillRenderer=new l(b);this._symbolRenderer=new w(b);this._circleRenderer=new p(b);this._tileInfoRenderer=new q(b);this._programCache=b}};z.prototype.setStateParams=function(a,c,e){this._fadeRecorder.recordLevel(e);this._state=a;if(this._state.size[0]!==this._cachedWidth||this._state.size[1]!==
this._cachedHeight||this._state.rotation!==this._cachedRotation)this._extrudeScaleVector[0]=2/a.size[0],this._extrudeScaleVector[1]=-2/a.size[1],r.mat4.identity(this._extrudeMatrix),r.mat4.rotate(this._extrudeMatrix,this._extrudeMatrix,-a.rotation*b.C_DEG_TO_RAD,this._extrudeRotateVector),r.mat4.scale(this._extrudeMatrix,this._extrudeMatrix,this._extrudeScaleVector),r.mat4.transpose(this._extrudeMatrix,this._extrudeMatrix),r.mat4.identity(this._extrudeNoRotationMatrix),r.mat4.scale(this._extrudeNoRotationMatrix,
this._extrudeNoRotationMatrix,this._extrudeScaleVector),r.mat4.transpose(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix),this._cachedWidth=this._state.size[0],this._cachedHeight=this._state.size[1],this._cachedRotation=this._state.rotation};z.prototype.drawClippingMasks=function(a,b){if(0!==b.length){a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255);
a.setClearStencil(0);a.clear(a.gl.STENCIL_BUFFER_BIT);for(var c=0;c<b.length;c++){var e=b[c];e.attached&&e.visible&&(a.setStencilFunctionSeparate(1032,519,e.stencilData.reference,e.stencilData.mask),this._backgroundRenderer.renderSolidColor(a,{u_matrix:e.tileTransform.transform,u_normalized_origin:e.tileTransform.displayCoord,u_coord_range:e.coordRange,u_depth:0,u_color:this._backgroundColor}))}a.setColorMask(!0,!0,!0,!0);a.setBlendingEnabled(!0)}};z.prototype.renderDebug=function(a,b){var c=b.key;
this._backgroundColor.set([c.col%2,c.row%2,0===c.col%2&&0===c.row%2?1:0,.5]);this._backgroundRenderer.renderSolidColor(a,{u_matrix:b.tileTransform.transform,u_normalized_origin:b.tileTransform.displayCoord,u_coord_range:b.coordRange,u_depth:0,u_color:this._backgroundColor})};z.prototype.renderBackGroundLayer=function(a,b,c,e,d,g,f){return this._backgroundRenderer.render(a,b,c,e,d,g,this._spriteMosaic,this._spriteMosaic.pixelRatio,f)};z.prototype.getBackGroundRenderer=function(){return this._backgroundRenderer};
z.prototype.getSpriteMosaic=function(){return this._spriteMosaic};z.prototype.renderBucket=function(a,b,c,e,d,g,f,q){if(!f||void 0!==f.minzoom&&f.minzoom>c+1E-6||void 0!==f.maxzoom&&f.maxzoom<=c-1E-6)return 0;switch(b.type){case 1:if(3!==d)return this._renderFill(a,b,c,d,g,f,q);break;case 2:if(2===d||4===d)return this._renderLine(a,b,c,d,g,f,q);break;case 3:if(3===d||4===d)return this._renderSymbol(a,b,c,d,e,g,f,q);break;case 4:if(3===d||4===d)return this._renderCircle(a,b,c,d,e,g,f,q)}return 0};
z.prototype.renderTileInfo=function(a,b){this._tileInfoRenderer.render(a,b)};z.prototype.setGlobalOpacity=function(b,c,e){if(1!==e){this._boundFBO=b.getBoundFramebufferObject();e=c.pixelRatio;var d=c.state.size;c=Math.round(d[0]*e);e=Math.round(d[1]*e);if(null===this._globalOpacityFBO||this._globalOpacityFBO.width!==c||this._globalOpacityFBO.height!==e)null!==this._globalOpacityFBO&&this._globalOpacityFBO.dispose(),this._globalOpacityFBO=a.FramebufferObject.create(b,{colorTarget:0,depthStencilTarget:3,
width:c,height:e});b.bindFramebuffer(this._globalOpacityFBO);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT)}};z.prototype.applyGlobalOpacity=function(a,b,c){if(1!==c){var e=b.pixelRatio,d=b.state.size;b=d[0];var d=d[1],g=a.getViewport();a.setViewport(0,0,e*b,e*d);a.bindFramebuffer(this._boundFBO);this._blitRenderer.render(a,this._globalOpacityFBO.colorTexture,9728,c);a.setViewport(g.x,g.y,g.width,g.height);this._boundFBO=null}};z.prototype.needsRedraw=function(){return this._fadeRecorder.needsRedraw()};
z.prototype.hitTest=function(b,c,e,d,g,f,q){var h=[0,0],l=[0,0],p=b.state;p.toMap(h,[0,0]);p.toMap(l,[f,f]);c=d.filter(function(a){return!(h[0]>a.bounds[2]||l[0]<a.bounds[0]||h[1]<a.bounds[3]||l[1]>a.bounds[1])});if(0===c.length)return[];c.sort(function(a,b){return a.key.level-b.key.level});e=c.length;for(d=1;d<=e;d++){var u=c[d-1];u.attached&&(u.stencilData.reference=d,u.stencilData.mask=255)}q(p,g,c);g=b.context;this._hittestFBO||(this._hittestFBO=a.FramebufferObject.create(g,{colorTarget:0,depthStencilTarget:3,
width:f,height:f}));q=g.getViewport();p=g.getBoundFramebufferObject();g.bindFramebuffer(this._hittestFBO);g.setViewport(0,0,f,f);d=g.gl;g.setDepthWriteEnabled(!0);g.setStencilWriteMask(255);g.setClearColor(1,1,1,1);g.setClearDepth(1);g.setClearStencil(0);g.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);g.setDepthWriteEnabled(!1);this.drawClippingMasks(g,c);g.setBlendingEnabled(!1);g.setStencilWriteMask(0);g.setStencilOp(7680,7680,7681);g.setDepthFunction(515);g.setDepthTestEnabled(!0);
g.setDepthWriteEnabled(!0);g.setStencilTestEnabled(!0);for(d=0;d<e;d++)u=c[d],u.attached&&u.doRender(b);g.setStencilTestEnabled(!1);g.setDepthTestEnabled(!1);this._readbackBuffer||(this._readbackBuffer=new Uint8Array(4*f*f),this._readbackBuffer32=new Uint32Array(this._readbackBuffer.buffer));this._hittestFBO.readPixels(0,0,f,f,6408,5121,this._readbackBuffer);b=new Set;f*=f;c=this._readbackBuffer32[Math.round(f/2)];4294967295!==c&&b.add(c);for(d=0;d<f;d++)c=this._readbackBuffer32[d],4294967295!==c&&
b.add(c);g.bindFramebuffer(p);g.setViewport(q.x,q.y,q.width,q.height);var n=[];b.forEach(function(a){n.push(a)});return n};z.prototype._renderLine=function(a,b,c,e,d,g,f){return this._lineRenderer.render(a,b,c,e,this._state,d,g,this._spriteMosaic,this._extrudeMatrix,this._spriteMosaic.pixelRatio,f)};z.prototype._renderFill=function(a,b,c,e,d,g,f){return this._fillRenderer.render(a,b,c,this._state.rotation,e,d,g,this._spriteMosaic,this._extrudeMatrix,this._spriteMosaic.pixelRatio,f)};z.prototype._renderCircle=
function(a,b,c,e,d,g,f,q){var h=!0;d===g.key.level&&(h=!1);a.setStencilTestEnabled(h);return this._circleRenderer.render(a,b,c,e,this._state.rotation,g,f,this._extrudeMatrix,q)};z.prototype._renderSymbol=function(a,b,c,e,d,g,f,q){var h=!0;d===g.key.level&&(h=!1);a.setStencilTestEnabled(h);return this._symbolRenderer.render(a,b,c,e,this._state.rotation,this._fadeRecorder.getFadeValues(this._ignoreSpeed),g,f,this._spriteMosaic,this._glyphMosaic,this._extrudeMatrix,this._extrudeNoRotationMatrix,this._spriteMosaic.pixelRatio,
q)};return z}()})},"esri/views/2d/engine/vectorTiles/renderers/BackgroundRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../MemoryBuffer ./rendererUtils".split(" "),function(y,m,r,k,d,f,a,c){return function(){function b(a){this._patternMatrix=k.mat3f32.create();this._color=d.vec4f32.create();this._rendererInitialized=this._solidrendererInitialized=!1;this._programOptions=
{id:!1,pattern:!1};this._programCache=a;this._color.set([1,0,0,1])}b.prototype.dispose=function(){this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};b.prototype.renderSolidColor=function(a,b){this._solidrendererInitialized||this._initializeSolidRenderer(a);a.bindVAO(this._solidVertexArrayObject);var c=this._programOptions;c.id=!1;c.pattern=!1;c=this._programCache.getProgram(0,
0,c);a.bindProgram(c);c.setUniformMatrix4fv("u_transformMatrix",b.u_matrix);c.setUniform2fv("u_normalized_origin",b.u_normalized_origin);c.setUniform1f("u_coord_range",b.u_coord_range||4096);c.setUniform1f("u_depth",b.u_depth||0);c.setUniform4fv("u_color",b.u_color||this._color);a.drawArrays(5,0,4);a.bindVAO()};b.prototype.render=function(a,b,d,f,g,k,q,u,z){this._rendererInitialized||this._initialize(a);var e=b.getPaintValue("background-color",g);z*=b.getPaintValue("background-opacity",g);var l=b.getPaintValue("background-pattern",
g),p=void 0!==l,w=e[3]*z;k=4===k;var t=this._programOptions;t.id=k;t.pattern=p;t=this._programCache.getProgram(0,(k?1:0)<<1|(p?1:0),t);a.bindVAO(this._vertexArrayObject);a.bindProgram(t);t.setUniform1f("u_coord_range",f.coordRange);t.setUniform1f("u_depth",b.z||0);t.setUniformMatrix4fv("u_transformMatrix",f.tileTransform.transform);t.setUniform2fv("u_normalized_origin",f.tileTransform.displayCoord);if(p){b=q.getMosaicItemPosition(l,!0);if(!b)return 0;f=512*(u>c.HIGH_RES_CUTOFF?2:1)*Math.max(Math.pow(2,
Math.round(g)-f.key.level),1);r.mat3.identity(this._patternMatrix);g=f/b.size[1];this._patternMatrix[0]=f/b.size[0];this._patternMatrix[4]=g;q.bind(a,9729,b.page,5);t.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix);t.setUniform1f("u_opacity",z);t.setUniform2f("u_pattern_tl",b.tl[0],b.tl[1]);t.setUniform2f("u_pattern_br",b.br[0],b.br[1]);t.setUniform1i("u_texture",5)}else this._color[0]=w*e[0],this._color[1]=w*e[1],this._color[2]=w*e[2],this._color[3]=w,t.setUniform4fv("u_color",this._color);
k&&(d=c.int32To4Bytes(d),t.setUniform4f("u_id",d[0],d[1],d[2],d[3]));a.drawArrays(5,0,4);a.bindVAO();return 2};b.prototype._initializeSolidRenderer=function(a){if(this._solidrendererInitialized)return!0;var b=new Int8Array([0,0,1,0,0,1,1,1]),b=f.BufferObject.createVertex(a,35044,b);this._solidVertexArrayObject=new f.VertexArrayObject(a,this._programCache.getProgramAttributes(0),{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:b});return this._solidrendererInitialized=
!0};b.prototype._initialize=function(b){if(this._rendererInitialized)return!0;var c=[];c.push(a.i1616to32(0,0));c.push(a.i1616to32(1,0));c.push(a.i1616to32(0,1));c.push(a.i1616to32(1,1));c=new Uint32Array(c);c=f.BufferObject.createVertex(b,35044,c);this._vertexArrayObject=new f.VertexArrayObject(b,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:c});return this._rendererInitialized=!0};return b}()})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["require",
"exports"],function(y,m){return function(){function r(k){this._array=[];0>=k&&console.error("strideInBytes must be positive!");this._stride=k}Object.defineProperty(r.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"index",{get:function(){return 4*this._array.length/this._stride},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"itemSize",{get:function(){return this._stride},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,
"sizeInBytes",{get:function(){return 4*this._array.length},enumerable:!0,configurable:!0});r.prototype.reset=function(){this.array.length=0};r.prototype.toBuffer=function(){return(new Uint32Array(this._array)).buffer};r.i1616to32=function(k,d){return 65535&k|d<<16};r.i8888to32=function(k,d,f,a){return k&255|(d&255)<<8|(f&255)<<16|a<<24};r.i8816to32=function(k,d,f){return k&255|(d&255)<<8|f<<16};return r}()})},"esri/views/2d/engine/vectorTiles/renderers/rendererUtils":function(){define(["require",
"exports"],function(y,m){Object.defineProperty(m,"__esModule",{value:!0});var r=new Uint32Array(1),k=new Uint8Array(r.buffer);m.int32To4Bytes=function(d){r[0]=d|0;return[k[0],k[1],k[2],k[3]]};m.HIGH_RES_CUTOFF=1.15})},"esri/views/2d/engine/vectorTiles/renderers/CircleRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./rendererUtils".split(" "),
function(y,m,r,k,d,f,a,c,b){return function(){function e(a){this._viewProjMat=k.mat4f32.create();this._offsetVector=d.vec3f32.create();this._color=f.vec4f32.create();this._strokeColor=f.vec4f32.create();this._initialized=!1;this._programOptions={id:!1};this._programCache=a}e.prototype.dispose=function(){};e.prototype.render=function(a,e,d,g,f,q,u,k,h){if(0===e.triangleElementCount)return 0;this._initialized||this._initialize(a);var l=u.hasDataDrivenRadius?1:u.getPaintValue("circle-radius",d),p=u.hasDataDrivenColor?
[1,1,1,1]:u.getPaintValue("circle-color",d),w=u.hasDataDrivenOpacity?1:u.getPaintValue("circle-opacity",d),t=u.hasDataDrivenStrokeWidth?1:u.getPaintValue("circle-stroke-width",d),x=u.hasDataDrivenStrokeColor?[1,1,1,1]:u.getPaintValue("circle-stroke-color",d),z=u.hasDataDrivenStrokeOpacity?1:u.getPaintValue("circle-stroke-opacity",d),m=u.hasDataDrivenBlur?0:u.getPaintValue("circle-blur",d),w=w*p[3]*h;this._color[0]=w*p[0];this._color[1]=w*p[1];this._color[2]=w*p[2];this._color[3]=w;w=z*x[3]*h;this._strokeColor[0]=
w*x[0];this._strokeColor[1]=w*x[1];this._strokeColor[2]=w*x[2];this._strokeColor[3]=w;h=q.tileTransform.transform;p=u.getPaintValue("circle-translate",d);if(0!==p[0]||0!==p[1])r.mat4.copy(this._viewProjMat,q.tileTransform.transform),h=p[0],p=p[1],z=x=0,z=(1<<q.key.level)/Math.pow(2,d)*(q.coordRange/512),1===u.getPaintValue("circle-translate-anchor",d)?(f*=-c.C_DEG_TO_RAD,d=Math.sin(f),f=Math.cos(f),x=z*(h*f-p*d),z*=h*d+p*f):(x=z*h,z*=p),this._offsetVector[0]=x,this._offsetVector[1]=z,this._offsetVector[2]=
0,r.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),h=this._viewProjMat;d=this._getCircleVAO(a,q);if(!d)return 0;a.bindVAO(d);g=4===g;d=this._programOptions;d.id=g;d=this._programCache.getProgram(5,g?1:0,d);a.bindProgram(d);d.setUniformMatrix4fv("u_transformMatrix",h);d.setUniformMatrix4fv("u_extrudeMatrix",k);d.setUniform2fv("u_normalized_origin",q.tileTransform.displayCoord);d.setUniform1f("u_depth",u.z);d.setUniform1f("u_radius",l);d.setUniform4fv("u_color",this._color);
d.setUniform1f("u_blur",m);d.setUniform1f("u_stroke_width",t);d.setUniform4fv("u_stroke_color",this._strokeColor);d.setUniform1f("u_antialiasingWidth",1.2);g&&(q=b.int32To4Bytes(e.layerID),d.setUniform4f("u_id",q[0],q[1],q[2],q[3]));a.drawElements(4,e.triangleElementCount,5125,12*e.triangleElementStart);a.bindVAO();return e.triangleCount()};e.prototype._initialize=function(a){if(this._initialized)return!0;this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,
divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return this._initialized=!0};e.prototype._getCircleVAO=function(b,c){if(c.circleVertexArrayObject)return c.circleVertexArrayObject;var d=c.circleVertexBuffer,e=c.circleIndexBuffer;if(!d||!e)return null;c.circleVertexArrayObject=new a.VertexArrayObject(b,
this._programCache.getProgramAttributes(5),this._vertexAttributes,{geometry:d},e);return c.circleVertexArrayObject};return e}()})},"esri/views/2d/engine/vectorTiles/renderers/FadeRecorder":function(){define(["require","exports","../../../../../core/now"],function(y,m,r){Object.defineProperty(m,"__esModule",{value:!0});(function(){return function(k,d){this.level=k;this.now=d}})();y=function(){return function(k,d,f,a){this.fadeSpeed=k;this.minfadeLevel=d;this.maxfadeLevel=f;this.fadeChange=a}}();m.FadeProperties=
y;y=function(){function k(d){void 0===d&&(d=300);this._levelSnapshots=[];this._duration=d}k.prototype.recordLevel=function(d){var f=r(),a=this._levelSnapshots;0===a.length&&(a.push({level:d,now:0}),a.push({level:d,now:0}));2!==a.length&&a[0].level===d||a.push({level:d,now:f})};k.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var d=this._duration,f=this._levelSnapshots,a=f.length,c=f[a-1],b=-1;a>b+1&&f[b+1].now+d<c.now;)b++;for(0>b&&(b=0);b<a;b++)if(f[b].level!==c.level)return!0;
return!1};k.prototype.getFadeValues=function(d){void 0===d&&(d=!1);for(var f=this._duration,a=r(),c=this._levelSnapshots;3<c.length&&c[1].now+f<a;)c.shift();c[1].now+f<a&&(c[0].level=c[1].level);var b=c[0].level,e=c[c.length-1],k=e.level,x=Math.min(b,k),b=Math.max(b,k),c=(e.level-c[1].level)/((e.now-c[1].now)/f);return d?{fadeSpeed:0,minfadeLevel:x,maxfadeLevel:b,fadeChange:0}:{fadeSpeed:c,minfadeLevel:x,maxfadeLevel:b,fadeChange:(a-e.now)/f*c}};return k}();m.FadeRecorder=y})},"esri/views/2d/engine/vectorTiles/renderers/FillRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./rendererUtils".split(" "),
function(y,m,r,k,d,f,a,c,b,e,p){var x=1/65536;return function(){function l(b){this._viewProjMat=f.mat4f32.create();this._offsetVector=a.vec3f32.create();this._patternMatrix=k.mat3f32.create();this._color=c.vec4f32.create();this._outlineColor=c.vec4f32.create();this._initialized=!1;this._fillProgramOptions={id:!1,dd:!1,pattern:!1};this._outlineProgramOptions={id:!1,dd:!1};this._programCache=b}l.prototype.dispose=function(){};l.prototype.render=function(a,b,c,f,k,h,l,r,v,t,m){if(0===b.triangleElementCount)return 0;
this._initialized||this._initialize(a);var g=void 0!==l.getPaintValue("fill-pattern",c),q=l.hasDataDrivenColor?[1,1,1,1]:l.getPaintValue("fill-color",c),u=l.hasDataDrivenOpacity?1:l.getPaintValue("fill-opacity",c),n=u*q[3]*m;this._color[0]=n*q[0];this._color[1]=n*q[1];this._color[2]=n*q[2];this._color[3]=n;var q=4===k,w;q&&(w=p.int32To4Bytes(b.layerID));var n=h.tileTransform.transform,z=h.coordRange/512,y=l.getPaintValue("fill-translate",c);if(0!==y[0]||0!==y[1]){d.mat4.copy(this._viewProjMat,h.tileTransform.transform);
var n=y[0],y=y[1],A=0,F=0,z=(1<<h.key.level)/Math.pow(2,c)*z;1===l.getPaintValue("fill-translate-anchor",c)?(A=-e.C_DEG_TO_RAD*f,f=Math.sin(A),F=Math.cos(A),A=z*(n*F-y*f),F=z*(n*f+y*F)):(A=z*n,F=z*y);this._offsetVector[0]=A;this._offsetVector[1]=F;this._offsetVector[2]=0;d.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);n=this._viewProjMat}r=this._drawFill(a,b,c,k,h,l,r,n,t,m,q,w);if(!(l.getPaintValue("fill-antialias",c)&&!g&&0<b.outlineElementCount)||2!==k&&4!==k)return r;
k=l.hasDataDrivenOutline;if(l.outlineUsesFillColor){if(1!==this._color[3])return b.triangleElementCount/3;this._outlineColor[0]=this._color[0];this._outlineColor[1]=this._color[1];this._outlineColor[2]=this._color[2];this._outlineColor[3]=this._color[3]}else c=l.hasDataDrivenOutlineColor?[1,1,1,1]:l.getPaintValue("fill-outline-color",c),m*=u*c[3],this._outlineColor[0]=m*c[0],this._outlineColor[1]=m*c[1],this._outlineColor[2]=m*c[2],this._outlineColor[3]=m;t=.75/t;m=this._getOutlineVAO(a,h,k);if(!m)return r;
a.bindVAO(m);m=this._outlineProgramOptions;m.id=q;m.dd=k;m=this._programCache.getProgram(2,(q?1:0)<<1|(k?1:0),m);a.bindProgram(m);m.setUniformMatrix4fv("u_transformMatrix",n);m.setUniformMatrix4fv("u_extrudeMatrix",v);m.setUniform2fv("u_normalized_origin",h.tileTransform.displayCoord);m.setUniform1f("u_depth",l.z+x);m.setUniform1f("u_outline_width",t);m.setUniform4fv("u_color",this._outlineColor);q&&m.setUniform4f("u_id",w[0],w[1],w[2],w[3]);a.drawElements(4,b.outlineElementCount,5125,12*b.outlineElementStart);
a.bindVAO();return r+=b.outlineElementCount/3};l.prototype._initialize=function(a){if(this._initialized)return!0;this._fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};this._fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};this._outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,
stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]};this._outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,
offset:8,stride:12,normalized:!0,divisor:0}]};return this._initialized=!0};l.prototype._drawFill=function(a,b,c,d,e,f,k,l,v,t,m,y){var g=f.getPaintValue("fill-pattern",c),h=void 0!==g,q=f.hasDataDrivenOpacity?1:t*f.getPaintValue("fill-opacity",c),u=f.hasDataDrivenColor?[1,1,1,1]:f.getPaintValue("fill-color",c);t*=q*u[3];this._color[0]=t*u[0];this._color[1]=t*u[1];this._color[2]=t*u[2];this._color[3]=t;u=f.hasDataDrivenFill;if((t=h||1>t||u)&&1===d||!t&&2===d)return 0;d=this._getFillVAO(a,e,u);if(!d)return 0;
a.bindVAO(d);d=this._fillProgramOptions;d.id=m;d.dd=u;d.pattern=h;d=this._programCache.getProgram(1,(m?1:0)<<2|(u?1:0)<<1|(h?1:0),d);a.bindProgram(d);if(h){g=k.getMosaicItemPosition(g,!0);if(!g){a.bindVAO();a.bindProgram();return}c=e.coordRange/(512*(v>p.HIGH_RES_CUTOFF?2:1)*Math.max(Math.pow(2,Math.round(c)-e.key.level),1));r.mat3.identity(this._patternMatrix);v=1/(g.size[1]*c);this._patternMatrix[0]=1/(g.size[0]*c);this._patternMatrix[4]=v;k.bind(a,9729,g.page,5);d.setUniformMatrix3fv("u_pattern_matrix",
this._patternMatrix);d.setUniform2f("u_pattern_tl",g.tl[0],g.tl[1]);d.setUniform2f("u_pattern_br",g.br[0],g.br[1]);d.setUniform1i("u_texture",5)}d.setUniformMatrix4fv("u_transformMatrix",l);d.setUniform2fv("u_normalized_origin",e.tileTransform.displayCoord);d.setUniform1f("u_depth",f.z+x);d.setUniform4fv("u_color",this._color);m&&d.setUniform4f("u_id",y[0],y[1],y[2],y[3]);a.drawElements(4,b.triangleElementCount,5125,12*b.triangleElementStart);a.bindVAO();return b.triangleElementCount/3};l.prototype._getFillVAO=
function(a,c,d){if(d){if(c.fillDDVertexArrayObject)return c.fillDDVertexArrayObject;d=c.fillDDVertexBuffer;var e=c.fillIndexBuffer;if(!d||!e)return null;c.fillDDVertexArrayObject=new b.VertexArrayObject(a,this._programCache.getProgramAttributes(1),this._fillVertexAttributesDD,{geometry:d},e);return c.fillDDVertexArrayObject}if(c.fillVertexArrayObject)return c.fillVertexArrayObject;d=c.fillVertexBuffer;e=c.fillIndexBuffer;if(!d||!e)return null;c.fillVertexArrayObject=new b.VertexArrayObject(a,this._programCache.getProgramAttributes(1),
this._fillVertexAttributes,{geometry:d},e);return c.fillVertexArrayObject};l.prototype._getOutlineVAO=function(a,c,d){if(d){if(c.outlineDDVertexArrayObject)return c.outlineDDVertexArrayObject;d=c.outlineDDVertexBuffer;var e=c.outlineIndexBuffer;if(!d||!e)return null;c.outlineDDVertexArrayObject=new b.VertexArrayObject(a,this._programCache.getProgramAttributes(2),this._outlineVertexAttributesDD,{geometry:d},e);return c.outlineDDVertexArrayObject}if(c.outlineVertexArrayObject)return c.outlineVertexArrayObject;
d=c.outlineVertexBuffer;e=c.outlineIndexBuffer;if(!d||!e)return null;c.outlineVertexArrayObject=new b.VertexArrayObject(a,this._programCache.getProgramAttributes(2),this._outlineVertexAttributes,{geometry:d},e);return c.outlineVertexArrayObject};return l}()})},"esri/views/2d/engine/vectorTiles/renderers/LineRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./rendererUtils".split(" "),
function(y,m,r,k,d,f,a,c,b,e){return function(){function p(b){this._initialized=!1;this._viewProjMat=k.mat4f32.create();this._offsetVector=f.vec3f32.create();this._color=a.vec4f32.create();this._dashArray=d.vec2f32.create();this._programOptions={id:!1,dd:!1,pattern:!1};this._programCache=b}p.prototype.dispose=function(){};p.prototype.render=function(a,c,d,f,q,k,p,h,n,m,v){if(0===c.triangleElementCount)return 0;this._initialized||this._initialize(a);var g=k.tileTransform.transform,l=k.coordRange/512,
u=p.getPaintValue("line-translate",d);if(0!==u[0]||0!==u[1]){r.mat4.copy(this._viewProjMat,k.tileTransform.transform);var g=u[0],u=u[1],w=0,x=0,x=(1<<k.key.level)/Math.pow(2,d)*l;q=q.rotation;if(1===p.getPaintValue("line-translate-anchor",d)){w=-b.C_DEG_TO_RAD*q;q=Math.sin(w);var z=Math.cos(w),w=x*(g*z-u*q),x=x*(g*q+u*z)}else w=x*g,x*=u;this._offsetVector[0]=w;this._offsetVector[1]=x;this._offsetVector[2]=0;r.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);g=this._viewProjMat}u=
p.getPaintValue("line-pattern",d);x=void 0!==u;m=1/m;q=p.getPaintValue("line-blur",d);var z=p.hasDataDrivenColor?[1,1,1,1]:p.getPaintValue("line-color",d),y=p.hasDataDrivenOpacity?1:p.getPaintValue("line-opacity",d),w=p.hasDataDrivenWidth?1:p.getPaintValue("line-width",d);v*=y*z[3];this._color[0]=v*z[0];this._color[1]=v*z[1];this._color[2]=v*z[2];this._color[3]=v;v=p.hasDataDrivenLine;f=4===f;var A;f&&(A=e.int32To4Bytes(c.layerID));z=this._getLineVAO(a,k,v);if(!z)return 0;a.bindVAO(z);z=this._programOptions;
z.id=f;z.dd=v;z.pattern=x;v=this._programCache.getProgram(3,(f?1:0)<<2|(v?1:0)<<1|(x?1:0),z);a.bindProgram(v);v.setUniformMatrix4fv("u_transformMatrix",g);v.setUniformMatrix4fv("u_extrudeMatrix",n);v.setUniform2fv("u_normalized_origin",k.tileTransform.displayCoord);v.setUniform1f("u_depth",p.z);v.setUniform1f("u_blur",q);v.setUniform1f("u_antialiasing",m);v.setUniform4fv("u_color",this._color);v.setUniform1f("u_width",w);f&&v.setUniform4f("u_id",A[0],A[1],A[2],A[3]);if(x){if(d=h.getMosaicItemPosition(u,
!0))h.bind(a,9729,d.page,5),v.setUniform2f("u_pattern_tl",d.tl[0],d.br[1]),v.setUniform2f("u_pattern_br",d.br[0],d.tl[1]),v.setUniform2f("u_spriteSize",l*d.size[0],d.size[1]),v.setUniform1i("u_texture",5)}else h=p.getPaintValue("line-dasharray",d),2>h.length&&(h=[1,-1]),this._dashArray[0]=l*h[0],this._dashArray[1]=l*h[1],v.setUniform2fv("u_dasharray",this._dashArray);a.drawElements(4,c.triangleElementCount,5125,12*c.triangleElementStart);a.bindVAO();return c.triangleCount()};p.prototype._initialize=
function(a){if(this._initialized)return!0;this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]};this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,
normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};return this._initialized=!0};p.prototype._getLineVAO=function(a,b,d){if(d){if(b.lineDDVertexArrayObject)return b.lineDDVertexArrayObject;d=b.lineDDVertexBuffer;var e=b.lineIndexBuffer;if(!d||!e)return null;b.lineDDVertexArrayObject=
new c.VertexArrayObject(a,this._programCache.getProgramAttributes(3),this._vertexAttributesDD,{geometry:d},e);return b.lineDDVertexArrayObject}if(b.lineVertexArrayObject)return b.lineVertexArrayObject;d=b.lineVertexBuffer;e=b.lineIndexBuffer;if(!d||!e)return null;b.lineVertexArrayObject=new c.VertexArrayObject(a,this._programCache.getProgramAttributes(3),this._vertexAttributes,{geometry:d},e);return b.lineVertexArrayObject};return p}()})},"esri/views/2d/engine/vectorTiles/renderers/SymbolRenderer":function(){define(["require",
"exports","./IconRenderer","./SDFRenderer"],function(y,m,r,k){return function(){function d(d){this._iconRenderer=new r(d);this._sdfRenderer=new k(d)}d.prototype.dispose=function(){this._iconRenderer&&(this._iconRenderer.dispose(),this._iconRenderer=null);this._sdfRenderer&&(this._sdfRenderer.dispose(),this._sdfRenderer=null)};d.prototype.render=function(d,a,c,b,e,k,r,l,g,w,q,u,m,h){if(!a.hasData())return 0;0<a.markerPerPageElementsMap.size&&this._iconRenderer.render(d,a,c,b,e,k,r,l,g,q,u,h);0<a.glyphPerPageElementsMap.size&&
this._sdfRenderer.render(d,a,c,b,e,k,r,l,w,q,u,m,h);return a.triangleCount()};return d}()})},"esri/views/2d/engine/vectorTiles/renderers/IconRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./rendererUtils".split(" "),function(y,m,r,k,d,f,a,c,b,e){return function(){function p(b){this._viewProjMat=
k.mat4f32.create();this._offsetVector=f.vec3f32.create();this._spritesTextureSize=d.vec2f32.create();this._color=a.vec4f32.create();this._initialized=!1;this._programOptions={id:!1,dd:!1,sdf:!1};this._programCache=b}p.prototype.dispose=function(){};p.prototype.render=function(a,c,d,f,k,p,m,h,n,y,v,t){var g=this;this._initialized||this._initialize(a);var q=h.hasDataDrivenIconSize?1:h.getLayoutValue("icon-size",d),l=h.hasDataDrivenIconColor?[1,1,1,1]:h.getPaintValue("icon-color",d),u=h.hasDataDrivenIconOpacity?
1:h.getPaintValue("icon-opacity",d);t*=l[3]*u;this._color[0]=t*l[0];this._color[1]=t*l[1];this._color[2]=t*l[2];this._color[3]=t;l=h.getLayoutValue("icon-rotation-alignment",d);2===l&&(l=1===h.getLayoutValue("symbol-placement",d)?0:1);var w=0===l;t=c.isSDF;u=h.hasDataDrivenIcon;f=4===f;var l=b.degToByte(k),x=m.tileTransform.transform,z=h.getPaintValue("icon-translate",d);if(0!==z[0]||0!==z[1]){r.mat4.copy(this._viewProjMat,m.tileTransform.transform);var x=z[0],z=z[1],A=0,G=0,G=(1<<m.key.level)/Math.pow(2,
d)*(m.coordRange/512);if(1===h.getPaintValue("icon-translate-anchor",d)){A=-b.C_DEG_TO_RAD*k;k=Math.sin(A);var K=Math.cos(A),A=G*(x*K-z*k),G=G*(x*k+z*K)}else A=G*x,G*=z;this._offsetVector[0]=A;this._offsetVector[1]=G;this._offsetVector[2]=0;r.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);x=this._viewProjMat}y=w?y:v;if(v=this._getIconVAO(a,m,u)){a.bindVAO(v);v=this._programOptions;v.id=f;v.dd=u;v.sdf=t;var B=this._programCache.getProgram(4,(f?1:0)<<2|(u?1:0)<<1|(t?1:0),v);
a.bindProgram(B);t&&(v=h.getPaintValue("icon-halo-color",d),t=h.getPaintValue("icon-halo-width",d),B.setUniform4f("u_outlineColor",v[0],v[1],v[2],v[3]),B.setUniform1f("u_outlineSize",t));B.setUniformMatrix4fv("u_transformMatrix",x);B.setUniformMatrix4fv("u_extrudeMatrix",y);B.setUniform2fv("u_normalized_origin",m.tileTransform.displayCoord);B.setUniform1f("u_depth",h.z);B.setUniform1f("u_mapRotation",l);B.setUniform1f("u_keepUpright",0);B.setUniform1f("u_level",10*d);B.setUniform1f("u_fadeSpeed",
10*p.fadeSpeed);B.setUniform1f("u_minfadeLevel",10*p.minfadeLevel);B.setUniform1f("u_maxfadeLevel",10*p.maxfadeLevel);B.setUniform1f("u_fadeChange",10*(d+p.fadeChange));B.setUniform1i("u_texture",5);B.setUniform1f("u_size",q);B.setUniform4fv("u_color",this._color);f&&(d=e.int32To4Bytes(c.layerID),B.setUniform4f("u_id",d[0],d[1],d[2],d[3]));c.markerPerPageElementsMap.forEach(function(b,c){g._spritesTextureSize[0]=n.getWidth(c)/4;g._spritesTextureSize[1]=n.getHeight(c)/4;B.setUniform2fv("u_mosaicSize",
g._spritesTextureSize);n.bind(a,9729,c,5);a.drawElements(4,b[1],5125,12*b[0])});a.bindVAO()}};p.prototype._initialize=function(a){if(this._initialized)return!0;this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,
divisor:0}]};this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,
normalized:!1,divisor:0}]};return this._initialized=!0};p.prototype._getIconVAO=function(a,b,d){if(d){if(b.iconDDVertexArrayObject)return b.iconDDVertexArrayObject;d=b.iconDDVertexBuffer;var e=b.iconIndexBuffer;if(!d||!e)return null;b.iconDDVertexArrayObject=new c.VertexArrayObject(a,this._programCache.getProgramAttributes(4),this._vertexAttributesDD,{geometry:d},e);return b.iconDDVertexArrayObject}if(b.iconVertexArrayObject)return b.iconVertexArrayObject;d=b.iconVertexBuffer;e=b.iconIndexBuffer;
if(!d||!e)return null;b.iconVertexArrayObject=new c.VertexArrayObject(a,this._programCache.getProgramAttributes(4),this._vertexAttributes,{geometry:d},e);return b.iconVertexArrayObject};return p}()})},"esri/views/2d/engine/vectorTiles/renderers/SDFRenderer":function(){define("require exports ../../../../../core/has ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./rendererUtils".split(" "),
function(y,m,r,k,d,f,a,c,b,e,p){var x=1/65536;return function(){function l(b){this._viewProjMat=d.mat4f32.create();this._offsetVector=a.vec3f32.create();this._extrudeMat=d.mat4f32.create();this._scaleVec=a.vec3f32.create();this._haloColor=c.vec4f32.create();this._sdfColor=c.vec4f32.create();this._initialized=!1;this._programOptions={id:!1,dd:!1};this._programCache=b}l.prototype.dispose=function(){};l.prototype.render=function(a,b,c,d,l,h,n,m,v,t,y,C,J){var g=this;if(!r("esri-vector-tiles-avoid-text")){this._initialized||
this._initialize(a);var q=e.degToByte(l),u=m.getLayoutValue("text-rotation-alignment",c);2===u&&(u=1===m.getLayoutValue("symbol-placement",c)?0:1);var w=0===u,u=m.getLayoutValue("text-keep-upright",c)&&w;d=4===d;C=.8*3/C;var z=m.hasDataDrivenTextSize?1:m.getLayoutValue("text-size",c),A=m.hasDataDrivenTextColor?[1,1,1,1]:m.getPaintValue("text-color",c),F=m.hasDataDrivenTextOpacity?1:m.getPaintValue("text-opacity",c),B=A[3]*F*J;this._sdfColor[0]=B*A[0];this._sdfColor[1]=B*A[1];this._sdfColor[2]=B*A[2];
this._sdfColor[3]=B;this._glyphTextureSize||(this._glyphTextureSize=f.vec2f32.fromValues(v.width/4,v.height/4));A=n.tileTransform.transform;B=m.getPaintValue("text-translate",c);if(0!==B[0]||0!==B[1]){k.mat4.copy(this._viewProjMat,n.tileTransform.transform);var A=B[0],B=B[1],I=0,H=0,H=(1<<n.key.level)/Math.pow(2,c)*(n.coordRange/512);if(1===m.getPaintValue("text-translate-anchor",c)){I=-e.C_DEG_TO_RAD*l;l=Math.sin(I);var L=Math.cos(I),I=H*(A*L-B*l),H=H*(A*l+B*L)}else I=H*A,H*=B;this._offsetVector[0]=
I;this._offsetVector[1]=H;this._offsetVector[2]=0;k.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);A=this._viewProjMat}w?k.mat4.copy(this._extrudeMat,t):k.mat4.copy(this._extrudeMat,y);this._scaleVec[0]=1/24;this._scaleVec[1]=1/24;this._scaleVec[2]=1;k.mat4.scale(this._extrudeMat,this._extrudeMat,this._scaleVec);t=m.hasDataDrivenText;if(y=this._getSDFVAO(a,n,t)){a.bindVAO(y);y=this._programOptions;y.id=d;y.dd=t;var E=this._programCache.getProgram(6,(d?1:0)<<1|(t?1:0),y);a.bindProgram(E);
E.setUniformMatrix4fv("u_transformMatrix",A);E.setUniformMatrix4fv("u_extrudeMatrix",this._extrudeMat);E.setUniform2fv("u_normalized_origin",n.tileTransform.displayCoord);E.setUniform1f("u_depth",m.z+x);E.setUniform2fv("u_mosaicSize",this._glyphTextureSize);E.setUniform1f("u_mapRotation",q);E.setUniform1f("u_keepUpright",u?1:0);E.setUniform1f("u_level",10*c);E.setUniform1f("u_fadeSpeed",10*h.fadeSpeed);E.setUniform1f("u_minfadeLevel",10*h.minfadeLevel);E.setUniform1f("u_maxfadeLevel",10*h.maxfadeLevel);
E.setUniform1f("u_fadeChange",10*(c+h.fadeChange));E.setUniform1i("u_texture",6);E.setUniform1f("u_size",z);E.setUniform1f("u_antialiasingWidth",C);d&&(h=p.int32To4Bytes(b.layerID),E.setUniform4f("u_id",h[0],h[1],h[2],h[3]));b.glyphPerPageElementsMap.forEach(function(b,d){g._renderGlyphRange(a,b,d,m,v,E,c,F*J,3)});a.bindVAO()}}};l.prototype._renderGlyphRange=function(a,b,c,d,e,f,k,p,l){e.bind(a,9729,c,6);e=d.getPaintValue("text-halo-color",k);c=d.getPaintValue("text-halo-width",k);0<e[3]&&0<c&&(p*=
e[3],this._haloColor[0]=p*e[0],this._haloColor[1]=p*e[1],this._haloColor[2]=p*e[2],this._haloColor[3]=p,d=d.getPaintValue("text-halo-blur",k)*l,l*=c,f.setUniform4fv("u_color",this._haloColor),f.setUniform1f("u_halo",1),f.setUniform1f("u_edgeDistance",l),f.setUniform1f("u_edgeBlur",d),a.drawElements(4,b[1],5125,12*b[0]));0<this._sdfColor[3]&&(f.setUniform4fv("u_color",this._sdfColor),f.setUniform1f("u_halo",0),f.setUniform1f("u_edgeDistance",0),f.setUniform1f("u_edgeBlur",0),a.drawElements(4,b[1],
5125,12*b[0]))};l.prototype._initialize=function(a){if(this._initialized)return!0;this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,
offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}]};return this._initialized=!0};l.prototype._getSDFVAO=function(a,
c,d){if(d){if(c.textDDVertexArrayObject)return c.textDDVertexArrayObject;d=c.textDDVertexBuffer;var e=c.textIndexBuffer;if(!d||!e)return null;c.textDDVertexArrayObject=new b.VertexArrayObject(a,this._programCache.getProgramAttributes(6),this._vertexAttributesDD,{geometry:d},e);return c.textDDVertexArrayObject}if(c.textVertexArrayObject)return c.textVertexArrayObject;d=c.textVertexBuffer;e=c.textIndexBuffer;if(!d||!e)return null;c.textVertexArrayObject=new b.VertexArrayObject(a,this._programCache.getProgramAttributes(6),
this._vertexAttributes,{geometry:d},e);return c.textVertexArrayObject};return l}()})},"esri/views/2d/engine/vectorTiles/renderers/TileInfoRenderer":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec4f32","../../../../webgl","../GeometryUtils"],function(y,m,r,k,d){return function(){function f(a){this._initialized=!1;this._color=r.vec4f32.fromValues(1,0,0,1);this._maxWidth=0;this._programOptions={id:!1,pattern:!1};this._programCache=a}f.prototype.dispose=function(){this._outlineVertexArrayObject&&
(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null)};f.prototype.render=function(a,c){this._initialized||this._initialize(a);var b=this._programCache.getProgram(0,0,this._programOptions);if(b&&(a.bindVAO(this._outlineVertexArrayObject),a.bindProgram(b),b.setUniformMatrix4fv("u_transformMatrix",c.tileTransform.transform),b.setUniform2fv("u_normalized_origin",
c.tileTransform.displayCoord),b.setUniform1f("u_coord_range",c.coordRange),b.setUniform1f("u_depth",0),b.setUniform4fv("u_color",this._color),a.drawArrays(3,0,4),a.bindVAO(),1E5<c.triangleCount&&(a.setStencilFunction(514,c.stencilData.reference,c.stencilData.mask),a.setStencilTestEnabled(!0),a.bindVAO(this._quadVertexArrayObject),b.setUniform4f("u_color",.9,0,0,.35),a.drawArrays(5,0,4),a.bindVAO(),a.setStencilTestEnabled(!1)),b=this._getTexture(a,c))){var d=this._programCache.getProgram(7,0,null);
d&&(a.bindVAO(this._tileInfoVertexArrayObject),a.bindProgram(d),a.bindTexture(b,0),d.setUniformMatrix4fv("u_transformMatrix",c.tileTransform.transform),d.setUniform2fv("u_normalized_origin",c.tileTransform.displayCoord),d.setUniform1f("u_depth",0),d.setUniform1f("u_coord_ratio",c.coordRange/512),d.setUniform2f("u_delta",8,8),d.setUniform2f("u_dimensions",b.descriptor.width,b.descriptor.height),a.drawArrays(5,0,4),a.bindVAO())}};f.prototype._initialize=function(a){if(this._initialized)return!0;var c=
{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},b=new Int8Array([0,0,1,0,1,1,0,1]),b=k.BufferObject.createVertex(a,35044,b),b=new k.VertexArrayObject(a,this._programCache.getProgramAttributes(0),c,{geometry:b}),d=new Int8Array([0,0,0,1,1,0,1,1]),d=k.BufferObject.createVertex(a,35044,d),d=new k.VertexArrayObject(a,this._programCache.getProgramAttributes(0),c,{geometry:d}),f=new Int8Array([0,0,1,0,0,1,1,1]),f=k.BufferObject.createVertex(a,35044,f);a=new k.VertexArrayObject(a,
this._programCache.getProgramAttributes(7),c,{geometry:f});this._outlineVertexArrayObject=b;this._quadVertexArrayObject=d;this._tileInfoVertexArrayObject=a;return this._initialized=!0};f.prototype._getTexture=function(a,c){if(c.texture)return c.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","512"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var b=c.key.id+
", "+c.triangleCount,e=this._canvas.getContext("2d");e.font="24px sans-serif";e.textAlign="left";e.textBaseline="middle";var f=e.measureText(b),f=Math.pow(2,Math.ceil(d.log2(f.width+2)));f>this._maxWidth&&(this._maxWidth=f);e.clearRect(0,0,this._maxWidth,32);e.fillStyle="blue";var r=f=0,l;if(c.refKeys)for(var g=0,m=Object.keys(c.refKeys);g<m.length;g++)l=c.refKeys[m[g]].match(/\d+/),l=parseInt(l[0],10),isNaN(l)||(r++,c.key.level>l&&f++);f===r?e.fillStyle="red":0<f&&(e.fillStyle="purple");e.fillText(b,
0,16);c.texture=new k.Texture(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas);return c.texture};return f}()})},"esri/views/2d/engine/vectorTiles/renderers/shaders/ProgramCache":function(){define(["require","exports","../../../../../webgl","./Programs"],function(y,m,r,k){Object.defineProperty(m,"__esModule",{value:!0});y=function(){function d(){this._cache=Array(8);for(var d=0;8>d;d++)this._cache[d]={}}d.prototype.dispose=function(){this._programRepo&&(this._programRepo.dispose(),
this._programRepo=null)};d.prototype.getProgram=function(d,a,c){var b=this._cache[d];b[a]||(d=this._programRepo.getProgram(this._getProgramTemplate(d),c),b[a]=d);return b[a]};d.prototype.getProgramAttributes=function(d){switch(d){case 0:return k.background.attributes;case 5:return k.circle.attributes;case 1:return k.fill.attributes;case 4:return k.icon.attributes;case 3:return k.line.attributes;case 2:return k.outline.attributes;case 6:return k.text.attributes;case 7:return k.tileInfo.attributes}};
d.prototype.initialize=function(d){this._programRepo||(this._programRepo=new r.ProgramCache(d))};d.prototype._getProgramTemplate=function(d){switch(d){case 0:return k.background;case 5:return k.circle;case 1:return k.fill;case 4:return k.icon;case 3:return k.line;case 2:return k.outline;case 6:return k.text;case 7:return k.tileInfo}};return d}();m.default=y})},"esri/views/2d/engine/vectorTiles/renderers/shaders/Programs":function(){define(["require","exports","../../../../../webgl","./sources/resolver"],
function(y,m,r,k){Object.defineProperty(m,"__esModule",{value:!0});m.background={name:"background",shaders:function(a){return{vertexShader:r.glslifyDefineMap({ID:a.id,PATTERN:a.pattern})+k.resolveIncludes("background/background.vert"),fragmentShader:r.glslifyDefineMap({ID:a.id,PATTERN:a.pattern})+k.resolveIncludes("background/background.frag")}},attributes:{a_pos:0}};m.circle={name:"circle",shaders:function(a){return{vertexShader:r.glslifyDefineMap({ID:a.id})+k.resolveIncludes("circle/circle.vert"),
fragmentShader:r.glslifyDefineMap({ID:a.id})+k.resolveIncludes("circle/circle.frag")}},attributes:{a_pos:0,a_color:1,a_stroke_color:2,a_data:3}};var d=function(a){return r.glslifyDefineMap({ID:a.id,DD:a.dd,PATTERN:a.pattern})};m.fill={name:"fill",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("fill/fill.vert"),fragmentShader:d(a)+k.resolveIncludes("fill/fill.frag")}},attributes:{a_pos:0,a_color:1}};m.outline={name:"outline",shaders:function(a){return{vertexShader:r.glslifyDefineMap({ID:a.id,
DD:a.dd})+k.resolveIncludes("outline/outline.vert"),fragmentShader:r.glslifyDefineMap({ID:a.id,DD:a.dd})+k.resolveIncludes("outline/outline.frag")}},attributes:{a_pos:0,a_offset:1,a_xnormal:2,a_color:3}};m.icon={name:"icon",shaders:function(a){return{vertexShader:r.glslifyDefineMap({ID:a.id,DD:a.dd,SDF:a.sdf})+k.resolveIncludes("icon/icon.vert"),fragmentShader:r.glslifyDefineMap({ID:a.id,DD:a.dd,SDF:a.sdf})+k.resolveIncludes("icon/icon.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,
a_color:4,a_size:5}};var f=function(a){return r.glslifyDefineMap({ID:a.id,DD:a.dd,PATTERN:a.pattern})};m.line={name:"line",shaders:function(a){return{vertexShader:f(a)+k.resolveIncludes("line/line.vert"),fragmentShader:f(a)+k.resolveIncludes("line/line.frag")}},attributes:{a_pos:0,a_offsetAndNormal:1,a_accumulatedDistance:2,a_color:3,a_width:4}};m.text={name:"text",shaders:function(a){return{vertexShader:r.glslifyDefineMap({ID:a.id,DD:a.dd})+k.resolveIncludes("text/text.vert"),fragmentShader:r.glslifyDefineMap({ID:a.id,
DD:a.dd})+k.resolveIncludes("text/text.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_color:4,a_size:5}};m.tileInfo={name:"tileInfo",shaders:{vertexShader:k.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:k.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/vectorTiles/renderers/shaders/sources/resolver":function(){define(["require","exports","../../../../../../webgl","./shaderRepository"],function(y,m,r,k){Object.defineProperty(m,
"__esModule",{value:!0});var d=new r.ShaderCompiler(function(d){var a=k;d.split("/").forEach(function(c){a&&(a=a[c])});return a});m.resolveIncludes=function(f){return d.resolveIncludes(f)}})},"esri/views/2d/engine/vectorTiles/renderers/shaders/sources/shaderRepository":function(){define(["require","exports"],function(y,m){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d u_opacity * color;\n#else\n  gl_FragColor \x3d u_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform mediump vec2 u_normalized_origin;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\nvoid main() {\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(u_coord_range * a_pos, 0.0, 1.0);\n#ifdef PATTERN\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float dist \x3d length(v_offset);\n  mediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\n  lowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\n  gl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_color;\nattribute vec4 a_stroke_color;\nattribute vec4 a_data;\nconst float sizePrecision \x3d 0.25;\nconst float blurPrecision \x3d 0.03125;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_radius;\nuniform lowp vec4 u_color;\nuniform mediump float u_blur;\nuniform mediump float u_stroke_width;\nuniform lowp vec4 u_stroke_color;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n  v_color \x3d a_color * u_color;\n  v_stroke_color \x3d a_stroke_color * u_stroke_color;\n  v_stroke_width \x3d a_data[1] * sizePrecision * u_stroke_width;\n  v_radius \x3d a_data[2] * u_radius;\n  v_blur \x3d max(a_data[0] * blurPrecision + u_blur, u_antialiasingWidth / (v_radius + v_stroke_width));\n  mediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n  v_offset \x3d offset;\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos * 0.5, 0.0, 1.0) + u_extrudeMatrix * (v_radius + v_stroke_width) * vec4(offset, 0.0, 0.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d v_color[3] * color;\n#else\n  gl_FragColor \x3d v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat4 u_transformMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\nvoid main()\n{\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n#ifdef PATTERN\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\nuniform mediump float u_outlineSize;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\n  lowp vec4 fillPixelColor \x3d v_color;\n  float d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\n  const float sofetEdgeRatio \x3d 0.248062016;\n  float size \x3d max(v_size.x, v_size.y);\n  float dist \x3d d * sofetEdgeRatio * size;\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  if (u_outlineSize \x3e 0.25) {\n    lowp vec4 outlinePixelColor \x3d u_outlineColor;\n    const float outlineLimitRatio \x3d (16.0 / 86.0);\n    float clampedOutlineSize \x3d sofetEdgeRatio * min(u_outlineSize, outlineLimitRatio * max(v_size.x, v_size.y));\n    outlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\n    gl_FragColor \x3d v_transparency * mixColors(fillPixelColor, outlinePixelColor);\n  }\n  else {\n    gl_FragColor \x3d v_transparency * fillPixelColor;\n  }\n#else\n  lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d v_transparency * texColor;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_size;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle         \x3d a_levelInfo[1];\n  mediump float a_minLevel      \x3d a_levelInfo[2];\n  mediump float a_maxLevel      \x3d a_levelInfo[3];\n  mediump float delta_z \x3d 0.0;\n  mediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level);\n  delta_z +\x3d step(a_maxLevel, u_level);\n  mediump float alpha \x3d u_fadeSpeed !\x3d 0.0 ? clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0) : 1.0;\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n    v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n    v_transparency \x3d 1.0;\n  }\n  delta_z +\x3d step(v_transparency, 0.0);\n  vec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\n  v_size \x3d abs(offset);\n#ifdef SDF\n  offset \x3d (120.0 / 86.0) * offset;\n#endif\n#ifdef DD\n  mediump float icon_size \x3d a_size * u_size;\n#else\n  mediump float icon_size \x3d u_size;\n#endif\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * icon_size * vec4(offset, delta_z, 0.0);\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n  v_transparency *\x3d v_color.w;\n}"},
line:{"line.frag":"varying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform mediump vec2 u_spriteSize;\nuniform sampler2D u_texture;\nconst mediump float tileCoordRatio \x3d 8.0;\n#else\nvarying mediump vec2 v_dasharray;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\n  lowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\n  mediump float relativeTexX \x3d mod((v_accumulatedDistance + v_normal.x * v_lineHalfWidth * tileCoordRatio) / u_spriteSize.x, 1.0);\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / u_spriteSize.y);\n  mediump vec2 texCoord \x3d mix(u_pattern_tl, u_pattern_br, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n  gl_FragColor \x3d alpha * v_color[3] * color;\n#else\n  lowp float dashPos \x3d  mod(v_accumulatedDistance, v_dasharray.x + v_dasharray.y);\n  lowp float dashAlpha \x3d clamp(min(dashPos, v_dasharray.x - dashPos) + 0.5, 0.0, 1.0);\n  dashAlpha \x3d max(sign(-v_dasharray.y), dashAlpha);\n  alpha *\x3d dashAlpha;\n  gl_FragColor \x3d alpha * v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"attribute vec2 a_pos;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistance;\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_blur;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_width;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_width;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\n#ifndef PATTERN\nuniform mediump vec2 u_dasharray;\nvarying mediump vec2 v_dasharray;\n#endif\nvoid main()\n{\n  v_normal \x3d a_offsetAndNormal.zw * scale;\n#ifdef DD\n  v_lineHalfWidth \x3d a_width * u_width;\n#else\n  v_lineHalfWidth \x3d u_width;\n#endif\n  v_lineHalfWidth +\x3d u_antialiasing;\n  v_lineHalfWidth *\x3d 0.5;\n#ifndef PATTERN\n#ifdef DD\n  v_dasharray \x3d u_dasharray * a_width;\n#else\n  v_dasharray \x3d u_dasharray * u_width;\n#endif\n#endif\n  mediump vec2 dist \x3d v_lineHalfWidth * a_offsetAndNormal.xy * scale;\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(dist, 0.0, 0.0);\n  v_accumulatedDistance \x3d a_accumulatedDistance.x;\n  v_blur \x3d u_blur + u_antialiasing;\n  #ifdef DD\n    v_color \x3d a_color * u_color;\n  #else\n    v_color \x3d u_color;\n  #endif\n  #ifdef ID\n    v_id \x3d u_id / 255.0;\n  #endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist \x3d abs(v_normal.y);\n  lowp float alpha \x3d smoothstep(1.0, 0.0, dist);\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_normal \x3d a_xnormal;\n  mediump vec4 dist \x3d vec4(u_outline_width * a_offset * scale, 0.0, 0.0);\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * dist;\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nuniform mediump float u_edgeDistance;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  mediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist) * v_transparency;\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\nuniform lowp vec4 u_color;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nvarying lowp vec4 v_color;\nuniform mediump float u_size;\n#ifdef DD\nattribute mediump float a_size;\n#endif\nvarying mediump float v_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_edgeDistance;\nuniform mediump float u_edgeBlur;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle        \x3d a_levelInfo[1];\n  mediump float a_minLevel    \x3d a_levelInfo[2];\n  mediump float a_maxLevel    \x3d a_levelInfo[3];\n  mediump float delta_z \x3d 0.0;\n  mediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level);\n  delta_z +\x3d step(a_maxLevel, u_level);\n  mediump float alpha \x3d u_fadeSpeed !\x3d 0.0 ? clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0) : 1.0;\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n    v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n    v_transparency \x3d 1.0;\n  }\n  delta_z +\x3d step(v_transparency, 0.0);\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n#ifdef DD\n  if (u_halo \x3e 0.5)\n  {\n    v_color \x3d u_color;\n  }\n  else\n  {\n    v_color \x3d a_color * u_color;\n  }\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef DD\n  v_size \x3d a_size * u_size;\n#else\n  v_size \x3d u_size;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_edgeDistance \x3d edgePos - u_edgeDistance / v_size;\n  v_edgeWidth \x3d (u_antialiasingWidth + u_edgeBlur) / v_size;\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * v_size * vec4(offsetPrecision * a_vertexOffset, delta_z, 0.0);\n}"},
tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d 0.75 * color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat4 u_transformMatrix;\nuniform mediump vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\n  mediump vec2 offests \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(offests, 0.0, 1.0);\n  v_tex \x3d a_pos;\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(y,m,r,k,d,f,a,c,b,e,p,x){Object.defineProperty(m,"__esModule",{value:!0});var l=d.ofType({key:"type",base:b,typeMap:{rect:e,path:x,geometry:p}});m.LayerView2D=function(b){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.clips=new l;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}r(d,b);d.prototype.initialize=function(){var b=this;this.when(function(){b.requestUpdate()},function(){});var c=function(){return b.notifyChange("rendering")};
this.handles.add([a.init(this,"suspended",function(a){b.container&&(b.container.visible=!a);b.view&&!a&&b.updateRequested&&b.view.requestLayerViewUpdate(b)},!0),a.init(this,"fullOpacity",function(a){b.container&&(b.container.opacity=a)},!0),a.on(this,"container","post-render",c),a.on(this,"container","will-render",c)])};d.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=null};Object.defineProperty(d.prototype,
"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});d.prototype.isVisibleAtScale=function(a){var b=!0,c=this.layer,d=c.minScale,c=c.maxScale;if(null!=d&&null!=c){var b=!d,e=!c;!b&&a<=d&&(b=!0);!e&&a>=c&&(e=!0);b=
b&&e}return b};d.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};d.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};d.prototype.isUpdating=function(){return!1};d.prototype.isRendering=function(){return!1};d.prototype.canResume=function(){var a=this.inherited(arguments);
a&&(a=this.isVisibleAtScale(this.view.scale));return a};k([c.property({type:l,set:function(a){a=f.referenceSetter(a,this._get("clips"),l);this._set("clips",a)}})],d.prototype,"clips",void 0);k([c.property()],d.prototype,"moving",void 0);k([c.property({dependsOn:["attached","suspended","moving"]})],d.prototype,"rendering",null);k([c.property()],d.prototype,"attached",void 0);k([c.property()],d.prototype,"container",void 0);k([c.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],
d.prototype,"suspended",void 0);k([c.property({readOnly:!0})],d.prototype,"updateParameters",void 0);k([c.property()],d.prototype,"updateRequested",void 0);k([c.property({dependsOn:["updateRequested","attached","suspended"]})],d.prototype,"updating",null);k([c.property()],d.prototype,"view",void 0);return d=k([c.subclass("esri.views.2d.layers.LayerView2D")],d)}(c.declared(b))}})},"esri/views/layers/support/ClipArea":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(y,m,r,k,d,f){return function(a){function c(){return null!==a&&a.apply(this,arguments)||this}k(c,a);return c=r([f.subclass("esri.views.layers.support.ClipArea")],c)}(f.declared(d.JSONSupport))})},"esri/views/layers/support/ClipRect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(y,m,r,k,d,f){return function(a){function c(){var b=null!==a&&a.apply(this,
arguments)||this;b.type="rect";b.left=null;b.right=null;b.top=null;b.bottom=null;return b}k(c,a);b=c;c.prototype.clone=function(){return new b({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(c.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var b;r([d.property({type:[Number,String],json:{write:!0}})],c.prototype,"left",void 0);r([d.property({type:[Number,String],json:{write:!0}})],c.prototype,"right",
void 0);r([d.property({type:[Number,String],json:{write:!0}})],c.prototype,"top",void 0);r([d.property({type:[Number,String],json:{write:!0}})],c.prototype,"bottom",void 0);r([d.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],c.prototype,"version",null);return c=b=r([d.subclass("esri.views.layers.support.ClipRect")],c)}(d.declared(f))})},"esri/views/layers/support/Geometry":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),
function(y,m,r,k,d,f,a,c,b){var e={base:a,key:"type",typeMap:{extent:d.Extent,polygon:d.Polygon}};return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.type="geometry";b.geometry=null;return b}k(b,a);d=b;Object.defineProperty(b.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new d({geometry:this.geometry.clone()})};var d;r([f.property({types:e,json:{read:c.fromJSON,write:!0}})],b.prototype,
"geometry",void 0);r([f.property({readOnly:!0,dependsOn:["geometry"]})],b.prototype,"version",null);return b=d=r([f.subclass("esri.views.layers.support.Geometry")],b)}(f.declared(b))})},"esri/views/layers/support/Path":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(y,m,r,k,d,f){return function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;
b.type="path";b.path=[];return b}k(c,a);Object.defineProperty(c.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});r([d.property({type:[[[Number]]],json:{write:!0}})],c.prototype,"path",void 0);r([d.property({readOnly:!0,dependsOn:["path"]})],c.prototype,"version",null);return c=r([d.subclass("esri.views.layers.support.Path")],c)}(d.declared(f))})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../layers/support/TileInfo ./TileInfoView ./TileKey".split(" "),
function(y,m,r,k,d,f,a){return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a._fullCacheLodInfos=null;a._levelByScale={};return a}r(b,c);b.prototype.getTileParentId=function(b){b=a.pool.acquire(b);var c=0===b.level?null:a.getId(b.level-1,b.row>>1,b.col>>1,b.world);a.pool.release(b);return c};b.prototype.getTileCoverage=function(a,b,d){a=c.prototype.getTileCoverage.call(this,a,b,d);if(!a)return a;var e=1<<a.lodInfo.level;a.spans=a.spans.filter(function(a){return 0<=a.row&&
a.row<e});return a};b.prototype.scaleToLevel=function(a){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[a])return this._levelByScale[a];var b=this._fullCacheLodInfos;if(a>b[0].scale)return b[0].level;for(var c=void 0,d=void 0,c=0;c<b.length-1;c++)if(d=b[c+1],a>d.scale)return c=b[c],c.level+(c.scale-a)/(c.scale-d.scale);return b[b.length-1].level};b.prototype._initializeFullCacheLODs=function(a){a=0===a[0].level?a.map(function(a){return{level:a.level,resolution:a.resolution,
scale:a.scale}}):d.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(function(a){return{level:a.level,resolution:a.resolution,scale:a.scale}});for(var b=0;b<a.length;b++)this._levelByScale[a[b].scale]=a[b].level;this._fullCacheLodInfos=a};return b}(f)})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/asyncUtils ../../../core/Error ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../engine/vectorTiles/TileHandler ../engine/vectorTiles/VectorTileContainer ../engine/vectorTiles/VectorTileDisplayObject ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView".split(" "),function(y,
m,r,k,d,f,a,c,b,e,p,x,l,g,w,q,u,z,h,n,A,v,t){var F=x.getLogger("esri.views.2d.layers.VectorTileLayerView2D");return function(t){function m(){var a=null!==t&&t.apply(this,arguments)||this;a._fetchQueue=null;a._parseQueue=null;a._isTileHandlerPromiseFulfilled=!1;a._handles=new e;a._invalidateStyle=!1;a.container=new q;return a}r(m,t);m.prototype.initialize=function(){var a=this,c=this.layer.tileInfo;(c&&c.spatialReference).equals(this.view.spatialReference)?(this._tileInfoView=new h(this.layer.tileInfo,
this.layer.fullExtent),this._tileHandler=new w(this.layer,window.devicePixelRatio||1,!0,this.container),this.handles.add(this.watch("layer.currentStyleInfo",function(b){a._start()}))):this.addResolvingPromise(l.reject(new b("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))};m.prototype.destroy=function(){this._stop();this.container.dispose();this._tileHandler&&(this._tileHandler.destroy(),this._tileHandler=
null)};m.prototype.hitTest=function(b,d){var e=this;return this.suspended||!this._tileHandlerPromise?l.resolve(null):c.safeCast(this._tileHandlerPromise).then(function(){return e.container.hitTest(b,d).then(function(b){var c=e._tileHandler.getStyleRepository().layers;if(null===b||0>b||b>=c.length)return null;b=new a({attributes:{layerId:b,layerName:c[b].id}});b.layer=e.layer;b.sourceLayer=e.layer;return b})})};m.prototype.update=function(a){var b=this;this.notifyChange("updating");var c=this._tileHandlerPromise;
c&&c.then(function(){if(a.pixelRatio!==b._tileHandler.devicePixelRatio)b._start(),b._tileHandler.devicePixelRatio=a.pixelRatio;else{b._invalidateStyle?(b._issueStyleInvalidation(a),b._invalidateStyle=!1):(b._fetchQueue.pause(),b._parseQueue.pause(),b._fetchQueue.state=a.state,b._parseQueue.state=a.state,b._tileStrategy.update(a),b._parseQueue.resume(),b._fetchQueue.resume());for(var c=0,d=b.container.children;c<d.length;c++)b._tileHandler.updateTile(d[c],a)}})};m.prototype.attach=function(){var a=
this;this._start();this._handles.add(this.layer.on("paint-change",function(b){return a.container.requestRender()}));this._handles.add(this.layer.on("layout-change",function(b){a._invalidateStyle=!0;a.requestUpdate()}))};m.prototype.detach=function(){this._stop();this._handles.removeAll()};m.prototype.moveStart=function(){this.requestUpdate()};m.prototype.viewChange=function(){this.requestUpdate()};m.prototype.moveEnd=function(){this.requestUpdate()};m.prototype.canResume=function(){var a=this.inherited(arguments),
b=this.layer;if(a&&b.currentStyleInfo){var c=this.view.scale;(b=b.currentStyleInfo)&&b.layerDefinition&&(b=b.layerDefinition,b.minScale&&b.minScale<c&&(a=!1),b.maxScale&&b.maxScale>c&&(a=!1))}return a};m.prototype.isUpdating=function(){return!this._isTileHandlerPromiseFulfilled||this._fetchQueue.updating||this._parseQueue.updating};m.prototype.acquireTile=function(a){var b=this;a=new n(a.level,a.row,a.col,a.world);var d=this.updateParameters.state.rotation,e=this._tileHandler.getStyleRepository(),
f=u.pool.acquire(a,this.layer.tileInfo,e,d);c.safeCast(this._tileHandlerPromise).then(function(){b.notifyChange("updating");b._fetchQueue.push(f.key).then(function(a){return b._parseQueue.push(a)}).then(function(a){f.once("attach",function(){return b.requestUpdate()});a?f.setData(a.tileData,a.client,a.refKeys):f.setData(null,null);b.container.addChild(f);b.notifyChange("updating")}).catch(function(a){b.notifyChange("updating");l.isAbortError(a)||F.error(a)})});return f};m.prototype.releaseTile=function(a){var b=
a.key.id;this._fetchQueue.abort(b);this._parseQueue.abort(b);this._tileHandler.abortTileUpdate(b);this.container.removeChild(a);this.requestUpdate();a.once("detach",function(){return u.pool.release(a)});this.notifyChange("updating")};m.prototype._start=function(){var a=this;this._stop();if(this.layer.currentStyleInfo&&this.attached){var b=new AbortController,c=this._tileHandler.start({signal:b.signal}).then(function(){a._tileStrategy=new v({cachePolicy:"keep",coveragePolicy:"smallest",acquireTile:function(b){return a.acquireTile(b)},
releaseTile:function(b){return a.releaseTile(b)},tileInfoView:a._tileInfoView,cacheSize:40,buffer:p("esri-vector-tiles-buffer")?192:0});a._fetchQueue=new A({tileInfoView:a._tileInfoView,process:function(b,c){return a._getTileData(b,c)},concurrency:15});a._parseQueue=new A({tileInfoView:a._tileInfoView,process:function(b,c){return a._parseTileData(b,c)},concurrency:8});a.container.initialize(a._tileHandler.spriteMosaic,a._tileHandler.glyphMosaic,a.layer.tileInfo,a._tileInfoView);a.container.setStyleRepository(a._tileHandler.getStyleRepository());
a.requestUpdate();a._isTileHandlerPromiseFulfilled=!0});this._tileHandlerAbortController=b;this._tileHandlerPromise=c}};m.prototype._stop=function(){if(this._tileHandlerAbortController){var a=this._tileHandlerAbortController;a&&a.abort();this._tileHandlerPromise=null;this._isTileHandlerPromiseFulfilled=!1;this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null);this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=
null);this.container.removeAllChildren();u.pool.prune()}};m.prototype._getTileData=function(a,b){return f(this,void 0,void 0,function(){var c;return d(this,function(d){switch(d.label){case 0:return[4,this._tileHandler.fetchTileData(a,b)];case 1:return c=d.sent(),this.notifyChange("updating"),[2,{key:a,data:c}]}})})};m.prototype._parseTileData=function(a,b){return f(this,void 0,void 0,function(){return d(this,function(c){return[2,this._tileHandler.parseTileData(a,this.updateParameters.state.rotation,
b)]})})};m.prototype._issueStyleInvalidation=function(a){var b=this;this.notifyChange("updating");this._tileHandlerPromise=this._tileHandler.updateStyle().then(function(){b.container.setStyleRepository(b._tileHandler.getStyleRepository());b._fetchQueue.pause();b._parseQueue.pause();b._fetchQueue.clear();b._parseQueue.clear();b._parseQueue.resume();b._fetchQueue.resume();b.notifyChange("updating");b.requestUpdate()})};k([g.property({dependsOn:["view.scale","layer.currentStyleInfo"]})],m.prototype,
"suspended",void 0);return m=k([g.subclass("esri.views.2d.layers.VectorTileLayerView2D")],m)}(g.declared(z.LayerView2D(t)))});