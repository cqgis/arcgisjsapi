// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(g,l,m,v,n,r,t,u){Object.defineProperty(l,"__esModule",{value:!0});g=function(f){function c(){return null!==f&&f.apply(this,arguments)||this}m(c,f);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return n.WGLGeometryType.LABEL};c.prototype.drawGeometry=function(d,c,b,f,a){var e=d.context,g=d.painter,p=d.state,
h=d.rendererInfo,l=b.indexCount,m=b.indexFrom;b=u.LabelMaterialKey.load(b.materialKey);var q=b.mapAligned?1:0;if(q||!(1<=Math.abs(c.key.level-Math.round(100*d.displayLevel)/100))){var k=r.createProgramDescriptor(b.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_vertexOffset",count:2,type:5122},{location:4,name:"a_texAndSize",count:4,type:5121},{location:5,name:"a_refSymbolAndPlacementOffset",
count:4,type:5121},{location:6,name:"a_zoomRangeAndEmpty",count:4,type:5121}]}),n=k.bufferLayouts,k=k.attributes;a=g.materialManager.getMaterialProgram(d,b,"materials/label",k,a);f=this._getVAO(e,n,k,f);d.context.setStencilFunction(514,0,255);e.bindProgram(a);e.bindVAO(f);this._setSharedUniforms(a,d,c);g.textureManager.bindTextures(e,a,b,4);c=1===q?p.displayViewMat3:p.displayMat3;b.vvSizeMinMaxValue&&a.setUniform4fv("u_vvSizeMinMaxValue",h.vvSizeMinMaxValue);b.vvSizeScaleStops&&a.setUniform1f("u_vvSizeScaleStopsValue",
h.vvSizeScaleStopsValue);b.vvSizeFieldStops&&(a.setUniform1fv("u_vvSizeFieldStopsValues",h.vvSizeFieldStopsValues),a.setUniform1fv("u_vvSizeFieldStopsSizes",h.vvSizeFieldStopsSizes));b.vvSizeUnitValue&&a.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",h.vvSizeUnitValueToPixelsRatio);a.setUniform1f("u_mapRotation",Math.floor(p.rotation/360*254));a.setUniform1f("u_mapAligned",q);a.setUniformMatrix3fv("u_displayMat3",c);a.setUniform1f("u_opacity",1);a.setUniform1f("u_zoomLevel",Math.round(10*d.displayLevel));
a.setUniform2fv("u_screenSize",d.state.size);e.drawElements(4,l,5125,4*m);e.bindVAO(null);e.setStencilTestEnabled(!0);e.setBlendingEnabled(!0)}};return c}(t.default);l.default=g});