// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../symbols/cim/enums ../../../webgl ./color ./enums ./SymbolProperties".split(" "),function(m,b,B,n,C,u,v,d,D,w,c,E){function k(a){for(var b={},f=0;f<a.length;f++){var h=a[f];b[h.name]=h.strideInBytes}return b}function x(a){switch(a){case c.WGLGeometryType.MARKER:return F;case c.WGLGeometryType.FILL:return G;case c.WGLGeometryType.LINE:return H;
case c.WGLGeometryType.TEXT:return I;case c.WGLGeometryType.LABEL:return J}return null}function y(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function z(a){return"string"===typeof a}function A(a){switch(a){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function K(a){var b={},f=function(e){var f=0;b[e]=a[e].map(function(a){var b=B({},a,{normalized:a.normalized||!1,divisor:a.divisor||0,offset:f,stride:0});f+=a.count*A(a.type);return b});
b[e].forEach(function(a){return a.stride=f})},h;for(h in a)f(h);return b}Object.defineProperty(b,"__esModule",{value:!0});var r,l=C.getLogger("esri.views.2d.engine.webgl.Utils");b.C_VBO_GEOMETRY="geometry";b.C_VBO_PERINSTANCE="per_instance";b.C_VBO_PERINSTANCE_VV="per_instance_vv";b.C_ICON_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];b.C_FILL_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];b.C_FILL_VERTEX_DEF_DD=[{name:b.C_VBO_GEOMETRY,strideInBytes:12,divisor:0}];
b.C_LINE_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];b.C_TEXT_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:24,divisor:0}];b.C_LABEL_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:28,divisor:0}];b.C_ICON_STRIDE_SPEC=k(b.C_ICON_VERTEX_DEF);b.C_FILL_STRIDE_SPEC=k(b.C_FILL_VERTEX_DEF);b.C_FILL_STRIDE_SPEC_DD=k(b.C_FILL_VERTEX_DEF_DD);b.C_LINE_STRIDE_SPEC=k(b.C_LINE_VERTEX_DEF);b.C_TEXT_STRIDE_SPEC=k(b.C_TEXT_VERTEX_DEF);b.C_LABEL_STRIDE_SPEC=k(b.C_LABEL_VERTEX_DEF);b.getStrides=
function(a,e){switch(a){case c.WGLGeometryType.MARKER:return b.C_ICON_STRIDE_SPEC;case c.WGLGeometryType.FILL:return e?b.C_FILL_STRIDE_SPEC_DD:b.C_FILL_STRIDE_SPEC;case c.WGLGeometryType.LINE:return b.C_LINE_STRIDE_SPEC;case c.WGLGeometryType.TEXT:return b.C_TEXT_STRIDE_SPEC;case c.WGLGeometryType.LABEL:return b.C_LABEL_STRIDE_SPEC}return null};var F=[b.C_VBO_GEOMETRY],G=[b.C_VBO_GEOMETRY],H=[b.C_VBO_GEOMETRY],I=[b.C_VBO_GEOMETRY],J=[b.C_VBO_GEOMETRY];b.getNamedBuffers=x;b.strideToPackingFactor=y;
b.allocateTypedArrayBuffer=function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(Math.floor(a*b/4));case 1:case 3:return new Uint8Array(a*b)}};b.allocateTypedArrayBufferwithData=function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(a);case 1:case 3:return new Uint8Array(a)}};b.getTextProperties=function(a){return E.TextProperties.pool.acquire(a.color?w.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?w.copyAndPremultiply(a.haloColor):[255,255,255,255],v.pt2px(a.haloSize),
v.pt2px(a.font.size),a.angle*Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};b.isDefined=function(a){return null!=a};b.isNumber=function(a){return"number"===typeof a};b.isString=z;b.isStringOrNull=function(a){return null==a||z(a)};m=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(b)};a.prototype.getKeys=
function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();b.KeysGetter=m;m=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(a)};a.prototype.getValues=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();b.ValuesGetter=m;b.getCapType=function(a,b){switch(a){case "butt":return d.CapType.BUTT;case "round":return b?d.CapType.SQUARE:d.CapType.ROUND;case "square":return d.CapType.SQUARE;
default:return l.error(new n("mapview-invalid-type","Cap type "+a+" is not a valid option. Defaulting to round")),d.CapType.ROUND}};b.getJoinType=function(a){switch(a){case "miter":return d.JoinType.MITER;case "bevel":return d.JoinType.BEVEL;case "round":return d.JoinType.ROUND;default:return l.error(new n("mapview-invalid-type","Join type "+a+" is not a valid option. Defaulting to round")),d.JoinType.ROUND}};b.getVVType=function(a){switch(a){case "opacity":return c.VVType.OPACITY;case "color":return c.VVType.COLOR;
case "rotation":return c.VVType.ROTATION;case "size":return c.VVType.SIZE;default:return l.error("Cannot interpret unknown vv: "+a),null}};b.getTransformParams=function(a){return{transform:a.transform,hasZ:a.hasZ,hasM:a.hasM}};b.copyMeshData=function(a,b,f,h,p,c,d){for(var e in c)for(var g=c[e].stride,q=y(g),k=c[e].data,l=f[e].data,m=g*p.vertexCount/q,n=g*a/q,q=g*p.vertexFrom/q,g=0;g<m;++g)l[g+n]=k[g+q];f=p.indexCount;for(g=0;g<f;++g)h[g+b]=d[g+p.indexFrom]-p.vertexFrom+a};b.C_VBO_INFO=(r={},r[b.C_VBO_GEOMETRY]=
35044,r);b.createGeometryData=function(a,b){for(var f=[],h=0;5>h;++h){for(var c={},e=0,d=x(h);e<d.length;e++){var k=d[e];c[k]={data:b(h,k)}}f.push({data:a(h),buffers:c})}return f};b.createTextureFromTexelData=function(a,b){var f,c;u.isPowerOfTwo(b.width)&&u.isPowerOfTwo(b.height)?(f=!0,c=9987):(f=!1,c=9729);return new D.Texture(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:f,samplingMode:c,wrapMode:33071,flipped:!0},b)};b.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,
vertexTo:void 0,geometry:a}};b.getBytes=A;b.getPixelBytes=function(a){switch(a){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:l.error(new n("webgl-utils","Unable to handle type "+a))}};b.getPixelArrayCtor=function(a){switch(a){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:l.error(new n("webgl-utils","Unable to handle type "+a))}};var t=new Map;b.createProgramDescriptor=function(a,b){if(!t.has(a)){var c=K(b),h={},d;for(d in c){var e=
c[d];h[d]=e.length?e[0].stride:0}d={};for(var k in b)for(var e=0,l=b[k];e<l.length;e++){var g=l[e];d[g.name]=g.location}t.set(a,{strides:h,bufferLayouts:c,attributes:d})}return t.get(a)}});