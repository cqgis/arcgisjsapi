// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
require({cache:{"esri/renderers/support/clickToleranceUtils":function(){define(["require","exports"],function(C,c){function m(c,f){return f&&f.xoffset?Math.max(c,Math.abs(f.xoffset)):f&&f.yoffset?Math.max(c,Math.abs(f.yoffset)):c}function f(c,f){if("number"===typeof c)return c;if(c&&c.stops&&c.stops.length){c=c.stops;for(var e=f=0,b=0;b<c.length;b++){var p=c[b].size;"number"===typeof p&&(f+=p,e++)}return f/e}return f}function g(c,q){if(!q)return c;q=q.filter(function(b){return"size"===b.type}).map(function(b){var e=
b.minSize;return(f(b.maxSize,c)+f(e,c))/2});var e=0,b=q.length;if(0===b)return c;for(var p=0;p<b;p++)e+=q[p];return Math.max(Math.floor(e/b),c)}Object.defineProperty(c,"__esModule",{value:!0});c.calculateTolerance=function(c){if(!c)return 6;var f="visualVariables"in c?g(6,c.visualVariables):6;if("simple"===c.type)return m(f,c.symbol);if("unique-value"===c.type){var e=f;c.uniqueValueInfos.forEach(function(b){e=m(e,b.symbol)});return e}if("class-breaks"===c.type){var b=f;c.classBreakInfos.forEach(function(c){b=
m(b,c.symbol)});return b}return f}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),function(C,c,m,f,g,p,q,e,b,t,u,r){Object.defineProperty(c,"__esModule",
{value:!0});var E=g.ofType({key:"type",base:b,typeMap:{rect:t,path:r,geometry:u}});c.LayerView2D=function(b){return function(b){function k(){var k=null!==b&&b.apply(this,arguments)||this;k.clips=new E;k.moving=!1;k.attached=!1;k.lastUpdateId=-1;k.updateRequested=!1;return k}m(k,b);k.prototype.initialize=function(){var b=this;this.when(function(){b.requestUpdate()},function(){});var k=function(){return b.notifyChange("rendering")};this.handles.add([q.init(this,"suspended",function(k){b.container&&
(b.container.visible=!k);b.view&&!k&&b.updateRequested&&b.view.requestLayerViewUpdate(b)},!0),q.init(this,"fullOpacity",function(k){b.container&&(b.container.opacity=k)},!0),q.on(this,"container","post-render",k),q.on(this,"container","will-render",k)])};k.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=null};Object.defineProperty(k.prototype,"rendering",{get:function(){return this.attached&&
!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});k.prototype.isVisibleAtScale=function(b){var k=!0,c=this.layer,a=c.minScale,c=c.maxScale;if(null!=a&&null!=c){var k=!a,e=!c;!k&&b<=a&&(k=!0);!e&&b>=c&&(e=!0);k=k&&e}return k};k.prototype.requestUpdate=function(){this.updateRequested||
(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};k.prototype.processUpdate=function(b){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",b),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(b)))};k.prototype.isUpdating=function(){return!1};k.prototype.isRendering=function(){return!1};k.prototype.canResume=function(){var b=this.inherited(arguments);b&&(b=this.isVisibleAtScale(this.view.scale));return b};
f([e.property({type:E,set:function(b){b=p.referenceSetter(b,this._get("clips"),E);this._set("clips",b)}})],k.prototype,"clips",void 0);f([e.property()],k.prototype,"moving",void 0);f([e.property({dependsOn:["attached","suspended","moving"]})],k.prototype,"rendering",null);f([e.property()],k.prototype,"attached",void 0);f([e.property()],k.prototype,"container",void 0);f([e.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],k.prototype,"suspended",void 0);f([e.property({readOnly:!0})],
k.prototype,"updateParameters",void 0);f([e.property()],k.prototype,"updateRequested",void 0);f([e.property({dependsOn:["updateRequested","attached","suspended"]})],k.prototype,"updating",null);f([e.property()],k.prototype,"view",void 0);return k=f([e.subclass("esri.views.2d.layers.LayerView2D")],k)}(e.declared(b))}})},"esri/views/layers/support/ClipArea":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(C,c,m,f,g,p){return function(c){function e(){return null!==c&&c.apply(this,arguments)||this}f(e,c);return e=m([p.subclass("esri.views.layers.support.ClipArea")],e)}(p.declared(g.JSONSupport))})},"esri/views/layers/support/ClipRect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(C,c,m,f,g,p){return function(c){function e(){var b=null!==c&&c.apply(this,
arguments)||this;b.type="rect";b.left=null;b.right=null;b.top=null;b.bottom=null;return b}f(e,c);b=e;e.prototype.clone=function(){return new b({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(e.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var b;m([g.property({type:[Number,String],json:{write:!0}})],e.prototype,"left",void 0);m([g.property({type:[Number,String],json:{write:!0}})],e.prototype,"right",
void 0);m([g.property({type:[Number,String],json:{write:!0}})],e.prototype,"top",void 0);m([g.property({type:[Number,String],json:{write:!0}})],e.prototype,"bottom",void 0);m([g.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],e.prototype,"version",null);return e=b=m([g.subclass("esri.views.layers.support.ClipRect")],e)}(g.declared(p))})},"esri/views/layers/support/Geometry":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),
function(C,c,m,f,g,p,q,e,b){var t={base:q,key:"type",typeMap:{extent:g.Extent,polygon:g.Polygon}};return function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c.type="geometry";c.geometry=null;return c}f(c,b);q=c;Object.defineProperty(c.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new q({geometry:this.geometry.clone()})};var q;m([p.property({types:t,json:{read:e.fromJSON,write:!0}})],c.prototype,
"geometry",void 0);m([p.property({readOnly:!0,dependsOn:["geometry"]})],c.prototype,"version",null);return c=q=m([p.subclass("esri.views.layers.support.Geometry")],c)}(p.declared(b))})},"esri/views/layers/support/Path":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(C,c,m,f,g,p){return function(c){function e(){var b=null!==c&&c.apply(this,arguments)||this;
b.type="path";b.path=[];return b}f(e,c);Object.defineProperty(e.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});m([g.property({type:[[[Number]]],json:{write:!0}})],e.prototype,"path",void 0);m([g.property({readOnly:!0,dependsOn:["path"]})],e.prototype,"version",null);return e=m([g.subclass("esri.views.layers.support.Path")],e)}(g.declared(p))})},"esri/views/2d/layers/features/tileRenderers":function(){define(["require","exports","../../../../core/nextTick",
"../../../../core/promiseUtils"],function(C,c,m,f){Object.defineProperty(c,"__esModule",{value:!0});c.createOrReuseTileRenderer=function(c,p,q){if(!p)return f.resolve(null);switch(p.type){case "class-breaks":case "simple":case "unique-value":case "dot-density":case "dictionary":return f.create(function(c){m(function(){return C(["./tileRenderers/SymbolTileRenderer"],c)})}).then(function(c){return c.default}).then(function(c){return new c(q)});case "heatmap":return f.create(function(c){m(function(){return C(["./tileRenderers/HeatmapTileRenderer"],
c)})}).then(function(c){return c.default}).then(function(c){return new c(q)})}return f.resolve(null)}})},"esri/views/2d/layers/features/support/rendererUtils":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/screenUtils","../../../engine"],function(C,c,m,f,g){Object.defineProperty(c,"__esModule",{value:!0});var p=g.definitions.WEBGL_MAX_INNER_STOPS,q=g.definitions.WEBGL_MAX_STOPS,e=m.getLogger("esri.renderers.visualVariables.support.utils");c.simplifyVVRenderer=
function(b){if(!("visualVariables"in b&&b.visualVariables&&b.visualVariables.length))return b;b=b.clone();var c=b.visualVariables.map(function(b){if(("size"===b.type||"color"===b.type||"opacity"===b.type)&&null!=b.stops){var c;var m=b.type;c=b.stops;if(!(c.length<=q))if(e.warn("Found "+c.length+" Visual Variable stops, but MapView only supports "+q+". Displayed stops will be simplified."),c.length>2*q){for(var v=c[0],z=c.slice(1),k=z.pop(),Q=z[0].value,w=z[z.length-1].value,n=(w-Q)/p,a=[];Q<w;Q+=
n){for(var x=0;Q>=z[x].value;)x++;var u=z[x],t=c[x-1],g=Q-t.value,u=u.value===t.value?1:g/(u.value-t.value);"color"===m?(t=z[x],x=c[x-1],g=t.color.clone(),g.r=(1-u)*x.color.r+u*g.r,g.g=(1-u)*x.color.g+u*g.g,g.b=(1-u)*x.color.b+u*g.b,g.a=(1-u)*x.color.a+u*g.a,a.push({value:Q,color:g,label:t.label})):"size"===m?(t=z[x],g=c[x-1],x=f.toPt(t.size),g=f.toPt(g.size),a.push({value:Q,size:(1-u)*g+u*x,label:t.label})):(t=z[x],a.push({value:Q,opacity:(1-u)*c[x-1].opacity+u*t.opacity,label:t.label}))}c=[v].concat(a,
[k])}else{m=c[0];c=c.slice(1);for(v=c.pop();c.length>p;){k=z=0;for(w=1;w<c.length;w++)n=Math.abs(c[w].value-c[w-1].value),n>k&&(k=n,z=w);c.splice(z,1)}c=[m].concat(c,[v])}b.stops=c}return b});b.visualVariables=c;return b}})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/requireUtils ../../../../core/workers ../../../../core/accessorSupport/decorators module".split(" "),
function(C,c,m,f,g,p,q,e,b,t,u,r,E){Object.defineProperty(c,"__esModule",{value:!0});g=function(c){function e(k){k=c.call(this,k)||this;k._startupResolver=b.createResolver();k.isReady=!1;return k}m(e,c);e.prototype.initialize=function(){this._controller=b.createAbortController();this.addResolvingPromise(this._startWorker(this._controller.signal))};e.prototype.destroy=function(){this._connection.close();this._controller.abort()};Object.defineProperty(e.prototype,"tileRenderer",{set:function(b){this.client.tileRenderer=
b},enumerable:!0,configurable:!0});e.prototype.startup=function(b,c,e){return q(this,void 0,void 0,function(){var k,a,f,m;return p(this,function(n){switch(n.label){case 0:return k=this._controller.signal,a=Array.isArray(e.source)?{transferList:e.source,signal:k}:void 0,f=b.tileInfo.toJSON(),m={service:e,config:c,tileInfo:f},[4,this._connection.invoke("startup",m,a)];case 1:return n.sent(),this._startupResolver.resolve(),this._set("isReady",!0),[2]}})})};e.prototype.update=function(b,c){return q(this,
void 0,void 0,function(){var k;return p(this,function(e){switch(e.label){case 0:return k={config:b,options:c},[4,this._startupResolver.promise];case 1:return e.sent(),[2,this._connection.invoke("update",k)]}})})};e.prototype.setHighlight=function(b){return q(this,void 0,void 0,function(){return p(this,function(c){switch(c.label){case 0:return[4,this._startupResolver.promise];case 1:return c.sent(),[2,this._connection.invoke("controller.setHighlight",b)]}})})};e.prototype.refresh=function(){return q(this,
void 0,void 0,function(){return p(this,function(b){switch(b.label){case 0:return[4,this._startupResolver.promise];case 1:return b.sent(),[2,this._connection.invoke("controller.refresh")]}})})};e.prototype.redraw=function(){return q(this,void 0,void 0,function(){return p(this,function(b){switch(b.label){case 0:return[4,this._startupResolver.promise];case 1:return b.sent(),[2,this._connection.invoke("controller.redraw")]}})})};e.prototype.setViewState=function(b){return q(this,void 0,void 0,function(){return p(this,
function(c){switch(c.label){case 0:return[4,this._startupResolver.promise];case 1:return c.sent(),[2,this._connection.invoke("setViewState",b.toJSON())]}})})};e.prototype.queryFeatures=function(b,c){return q(this,void 0,void 0,function(){return p(this,function(k){switch(k.label){case 0:return[4,this._startupResolver.promise];case 1:return k.sent(),[2,this._connection.invoke("controller.queryFeatures",b.toJSON(),c)]}})})};e.prototype.queryObjectIds=function(b,c){return q(this,void 0,void 0,function(){return p(this,
function(k){switch(k.label){case 0:return[4,this._startupResolver.promise];case 1:return k.sent(),[2,this._connection.invoke("controller.queryObjectIds",b.toJSON(),c)]}})})};e.prototype.queryFeatureCount=function(b,c){return q(this,void 0,void 0,function(){return p(this,function(k){switch(k.label){case 0:return[4,this._startupResolver.promise];case 1:return k.sent(),[2,this._connection.invoke("controller.queryFeatureCount",b.toJSON(),c)]}})})};e.prototype.queryExtent=function(b,c){return q(this,void 0,
void 0,function(){return p(this,function(k){return[2,this._connection.invoke("controller.queryExtent",b.toJSON(),c)]})})};e.prototype.queryLatestObservations=function(b,c){return q(this,void 0,void 0,function(){return p(this,function(k){switch(k.label){case 0:return[4,this._startupResolver.promise];case 1:return k.sent(),[2,this._connection.invoke("controller.queryLatestObservations",b.toJSON(),c)]}})})};e.prototype.getObjectId=function(b){return q(this,void 0,void 0,function(){return p(this,function(c){switch(c.label){case 0:return[4,
this._startupResolver.promise];case 1:return c.sent(),[2,this._connection.invoke("controller.getObjectId",b)]}})})};e.prototype.getLocalId=function(b){return q(this,void 0,void 0,function(){return p(this,function(c){switch(c.label){case 0:return[4,this._startupResolver.promise];case 1:return c.sent(),[2,this._connection.invoke("controller.getLocalId",b)]}})})};e.prototype.mapValidLocalIds=function(b){return q(this,void 0,void 0,function(){return p(this,function(c){switch(c.label){case 0:return[4,
this._startupResolver.promise];case 1:return c.sent(),[2,this._connection.invoke("controller.mapValidLocalIds",b)]}})})};e.prototype.onEdits=function(b){return q(this,void 0,void 0,function(){var c,k,e;return p(this,function(a){switch(a.label){case 0:return[4,this._startupResolver.promise];case 1:return a.sent(),c=b.addedFeatures,k=b.deletedFeatures,e=b.updatedFeatures,[2,this._connection.invoke("controller.onEdits",{addedFeatures:c,deletedFeatures:k,updatedFeatures:e})]}})})};e.prototype.enableEvent=
function(b,c){return q(this,void 0,void 0,function(){return p(this,function(k){switch(k.label){case 0:return[4,this._startupResolver.promise];case 1:return k.sent(),[2,this._connection.invoke("controller.enableEvent",{name:b,value:c})]}})})};e.prototype._startWorker=function(b){return q(this,void 0,void 0,function(){var c,k;return p(this,function(e){switch(e.label){case 0:return c=t.getAbsMid("../features/Pipeline",C,E),[4,u.open(c,{client:this.client,strategy:"dedicated",signal:b})];case 1:return this._connection=
k=e.sent(),[2]}})})};f([r.property()],e.prototype,"isReady",void 0);f([r.property()],e.prototype,"client",void 0);f([r.property()],e.prototype,"tileRenderer",null);return e=f([r.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],e)}(r.declared(e.EsriPromise));c.default=g})},"esri/views/2d/layers/support/popupUtils2D":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../../core/tsSupport/decorateHelper","../../../../geometry/Extent"],function(C,c,m,f,
g){Object.defineProperty(c,"__esModule",{value:!0});c.createQueryGeometry=function(c,f,e){var b=e.get("state.resolution"),b=f*("number"===typeof b?b:1);f=c.clone().offset(-b,-b);c=c.clone().offset(b,b);return new g({xmin:Math.min(f.x,c.x),ymin:Math.min(f.y,c.y),xmax:Math.max(f.x,c.x),ymax:Math.max(f.y,c.y),spatialReference:e.spatialReference})}})},"esri/views/2d/layers/support/util":function(){define(["require","exports","../../../../core/jsonMap"],function(C,c,m){Object.defineProperty(c,"__esModule",
{value:!0});var f=new m.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});c.toJSONGeometryType=function(c){return f.toJSON(c)}})},"esri/views/layers/FeatureLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/iteratorUtils ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/support/fieldUtils ../../layers/support/timeUtils ../../support/arcadeOnDemand ../../tasks/support/Query ./support/FeatureEffect ./support/FeatureFilter ./support/popupUtils".split(" "),
function(C,c,m,f,g,p,q,e,b,t,u,r,E,v,z,k,Q,w,n,a,x){Object.defineProperty(c,"__esModule",{value:!0});var ga=t.getLogger("esri.views.layers.FeatureLayerView");c.FeatureLayerView=function(c){return function(c){function g(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=c.apply(this,a)||this;a._updatingRequiredFieldsPromise=null;a.effect=null;a.filter=null;a.layer=null;a.requiredFields=null;a.view=null;return a}m(g,c);g.prototype.initialize=function(){var a=this;E.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo filter effect layer.timeInfo timeExtent".split(" "),
function(){return a._handleRequiredFieldsChange()},!0)};Object.defineProperty(g.prototype,"availableFields",{get:function(){var a=this.layer,b=this.layer.fields,c=this.requiredFields;return"outFields"in a&&a.outFields?z.fixFields(b,z.unpackFieldNames(b,a.outFields).concat(c)):z.fixFields(b,c)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(a){ga.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!1},enumerable:!0,configurable:!0});g.prototype.highlight=function(a,b){void 0===b&&(b={});return this.inherited(arguments)};g.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},a=u.isSome(this.filter)?this.filter.createQuery(a):new w(a);this.timeExtent&&(a.timeExtent=a.timeExtent?a.timeExtent.intersection(this.timeExtent):
this.timeExtent.clone());return a};g.prototype.queryFeatures=function(a,b){return this.inherited(arguments)};g.prototype.queryObjectIds=function(a,b){return this.inherited(arguments)};g.prototype.queryFeatureCount=function(a,b){return this.inherited(arguments)};g.prototype.queryExtent=function(a,b){return this.inherited(arguments)};g.prototype._loadArcadeModules=function(a){if(a.get("expressionInfos.length"))return Q.loadArcade()};g.prototype._handleRequiredFieldsChange=function(){var a=this,b=this._updateRequiredFields();
this._set("_updatingRequiredFieldsPromise",b);b.then(function(){a._updatingRequiredFieldsPromise===b&&a._set("_updatingRequiredFieldsPromise",null)})};g.prototype._updateRequiredFields=function(){return q(this,void 0,void 0,function(){var a,c,k,e,f,n,g,m,q,t,w,x,v;return p(this,function(p){switch(p.label){case 0:if(!this.layer||!this.view)return[2];a="3d"===this.view.type;c=this;e=k=c.layer;f=e.fields;n=e.objectIdField;g=e.renderer;m=new Set;return[4,r.eachAlways([g?g.collectRequiredFields(m,f):null,
z.collectLabelingFields(m,k),a?z.collectElevationFields(m,k):null,u.isSome(this.filter)?z.collectFilterFields(m,k,this.filter):null,this.effect?z.collectFilterFields(m,k,this.effect.filter):null])];case 1:q=p.sent();k.timeInfo&&this.timeExtent&&z.collectFields(m,k.fields,[k.timeInfo.startField,k.timeInfo.endField]);t=0;for(w=q;t<w.length;t++)x=w[t],x.error&&ga.error(x.error);z.collectField(m,f,n);v=b.valuesOfSet(m).sort();this._set("requiredFields",v);return[2]}})})};g.prototype.validateFetchPopupFeatures=
function(a){var b=this.layer;if(!this.layer.popupEnabled)return new e("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:b});if(!x.getFetchPopupTemplate(this.layer,a))return new e("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:b})};g.prototype.fetchClientPopupFeatures=function(a){return q(this,void 0,void 0,function(){var b,c,k,e,f,n,g,m,q,t,w,v;return p(this,function(p){switch(p.label){case 0:b=u.isSome(a)?a.clientGraphics:null;if(!b||0===b.length)return[2,
r.resolve([])];c=[];k=[];e=this.layer;f=x.getFetchPopupTemplate(e,a);return u.isSome(f)?[4,this._loadArcadeModules(f)]:[2,r.resolve([])];case 1:return g=(n=p.sent())&&n.arcadeUtils.hasGeometryOperations(f),[4,this.createPopupQuery(a)];case 2:m=p.sent();q=z.unpackFieldNames(e.fields,m.outFields);t=0;for(w=b;t<w.length;t++)v=w[t],g||!z.featureHasFields(q,v)?k.push(v):c.push(v);if(0===k.length)return[2,r.resolve(c)];m.objectIds=k.map(function(a){return a.attributes[e.objectIdField]});return[2,e.queryFeatures(m).then(function(a){return c.concat(a.features)}).catch(function(){return k})]}})})};
g.prototype.createPopupQuery=function(a){return q(this,void 0,void 0,function(){var b,c,k;return p(this,function(e){switch(e.label){case 0:return b=this.layer,c=b.createQuery(),c.returnGeometry=!0,c.returnZ=!0,c.returnM=!0,k=c,[4,x.getRequiredFields(this.layer,x.getFetchPopupTemplate(this.layer,a))];case 1:return k.outFields=e.sent(),c.outSpatialReference=this.view.spatialReference,[2,c]}})})};f([v.property()],g.prototype,"_updatingRequiredFieldsPromise",void 0);f([v.property({readOnly:!0,dependsOn:["layer.outFields?",
"requiredFields"]})],g.prototype,"availableFields",null);f([v.property({type:n})],g.prototype,"effect",void 0);f([v.property({type:a})],g.prototype,"filter",void 0);f([v.property(k.combinedViewLayerTimeExtentProperty)],g.prototype,"timeExtent",void 0);f([v.property()],g.prototype,"layer",void 0);f([v.property({type:Number})],g.prototype,"maximumNumberOfFeatures",null);f([v.property({readOnly:!0,type:Boolean})],g.prototype,"maximumNumberOfFeaturesExceeded",null);f([v.property({readOnly:!0})],g.prototype,
"requiredFields",void 0);f([v.property()],g.prototype,"view",void 0);return g=f([v.subclass("esri.views.layers.FeatureLayerView")],g)}(v.declared(c))}})},"esri/views/layers/support/FeatureEffect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ./FeatureFilter ./ParsedFeatureEffect ./Transition".split(" "),function(C,c,m,
f,g,p,q,e,b,t,u){var r=p.getLogger("esri.views.layers.support.FeatureEffect");return function(c){function g(){var b=null!==c&&c.apply(this,arguments)||this;b.filter=null;b.includedEffect=null;b.excludedEffect=null;b.excludedLabelsVisible=!1;return b}f(g,c);p=g;Object.defineProperty(g.prototype,"insideEffect",{get:function(){r.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");return this.includedEffect},set:function(b){r.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");
this.includedEffect=b},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"outsideEffect",{get:function(){r.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");return this.excludedEffect},set:function(b){r.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");this.excludedEffect=b},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"parsedIncludedEffect",{get:function(){return q.isSome(this.includedEffect)?
"string"===typeof this.includedEffect?t.fromString(this.includedEffect):new u({from:t.fromString(this.includedEffect.from),to:t.fromString(this.includedEffect.to),duration:this.includedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"parsedExcludedEffect",{get:function(){return q.isSome(this.excludedEffect)?"string"===typeof this.excludedEffect?t.fromString(this.excludedEffect):new u({from:t.fromString(this.excludedEffect.from),to:t.fromString(this.excludedEffect.to),
duration:this.excludedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderingHash",{get:function(){return this.excludedLabelsVisible+"-"+this.includedEffect+"-"+this.excludedEffect},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"done",{get:function(){return(!q.isSome(this.parsedIncludedEffect)||this.parsedIncludedEffect.done)&&(!q.isSome(this.parsedExcludedEffect)||this.parsedExcludedEffect.done)},enumerable:!0,configurable:!0});g.prototype.clone=
function(){return new p({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};var p;m([e.property({type:b,json:{write:!0}})],g.prototype,"filter",void 0);m([e.property({type:String,json:{write:!0}})],g.prototype,"includedEffect",void 0);m([e.property({type:String,json:{write:!0}})],g.prototype,"excludedEffect",void 0);m([e.property({type:Boolean,json:{write:!0}})],g.prototype,"excludedLabelsVisible",
void 0);m([e.property({dependsOn:["includedEffect"]})],g.prototype,"parsedIncludedEffect",null);m([e.property({dependsOn:["excludedEffect"]})],g.prototype,"parsedExcludedEffect",null);m([e.property({dependsOn:["includedEffect","excludedEffect"]})],g.prototype,"renderingHash",null);return g=p=m([e.subclass("esri.views.layers.support.FeatureEffect")],g)}(e.declared(g.JSONSupport))})},"esri/views/layers/support/FeatureFilter":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../TimeExtent ../../../core/iteratorUtils ../../../core/jsonMap ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../geometry/support/jsonUtils ../../../tasks/support/Query".split(" "),
function(C,c,m,f,g,p,q,e,b,t,u,r,E,v){var z=new b.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),k=new b.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(b){function c(a){a=b.call(this,a)||this;a.where=null;a.geometry=null;a.spatialRelationship="intersects";a.hiddenIds=new Set;a.distance=void 0;a.objectIds=null;a.units=null;a.timeExtent=null;a.enabled=!1;return a}f(c,b);n=c;c.prototype.writeWhere=function(a,b,c){b.where=a||"1\x3d1"};c.prototype.enable=function(){this._set("enabled",!0)};c.prototype.createQuery=
function(a){void 0===a&&(a={});var b=this.where,c=this.spatialRelationship,k=this.timeExtent,e=this.objectIds,f=this.units,n=this.distance;return new v(g({geometry:u.clone(this.geometry),objectIds:u.clone(e),spatialRelationship:c,timeExtent:u.clone(k),where:b,units:f,distance:n},a))};c.prototype.clone=function(){var a=this.where,b=this.geometry,c=this.spatialRelationship,k=this.hiddenIds,e=this.timeExtent,f=this.objectIds,g=this.units,m=this.distance,p=new Set;k.forEach(function(a){return p.add(a)});
return new n({geometry:u.clone(b),hiddenIds:p,objectIds:u.clone(f),spatialRelationship:c,timeExtent:u.clone(e),where:a,units:g,distance:m})};var n;m([r.property({type:String})],c.prototype,"where",void 0);m([r.writer("where")],c.prototype,"writeWhere",null);m([r.property({types:p.geometryTypes,json:{read:E.fromJSON,write:!0}})],c.prototype,"geometry",void 0);m([r.property({type:String,json:{read:{source:"spatialRel",reader:z.read},write:{target:"spatialRel",writer:z.write}}})],c.prototype,"spatialRelationship",
void 0);m([r.property({json:{write:function(a,b,c){return b[c]=e.valuesOfSet(a)},read:function(a,b){return e.SetFromValues(a)}}})],c.prototype,"hiddenIds",void 0);m([r.property({type:Number,json:{write:{overridePolicy:function(a){return{enabled:0<a}}}}})],c.prototype,"distance",void 0);m([r.property({type:[Number],json:{write:!0}})],c.prototype,"objectIds",void 0);m([r.property({type:String,json:{read:k.read,write:{writer:k.write,overridePolicy:function(a){return{enabled:a&&0<this.distance}}}}})],
c.prototype,"units",void 0);m([r.property({type:q,json:{write:!0}})],c.prototype,"timeExtent",void 0);m([r.property({readOnly:!0})],c.prototype,"enabled",void 0);return c=n=m([r.subclass("esri.views.layers.support.FeatureFilter")],c)}(r.declared(t.JSONSupport))})},"esri/views/layers/support/ParsedFeatureEffect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f32 ./cssFilterParser".split(" "),
function(C,c,m,f,g,p,q,e,b,t,u,r,E){var v=e.getLogger("esri.views.layers.support.ParsedFeatureEffect"),z={grayscale:function(b){b=1-b.amount;b=r.mat4f32.fromValues(.2126+.7874*b,.7152-.7152*b,.0722-.0722*b,0,.2126-.2126*b,.7152+.2848*b,.0722-.0722*b,0,.2126-.2126*b,.7152-.7152*b,.0722+.9278*b,0,0,0,0,1);return u.mat4.transpose(b,b)},sepia:function(b){b=1-b.amount;b=r.mat4f32.fromValues(.393+.607*b,.769-.769*b,.189-.189*b,0,.349-.349*b,.686+.314*b,.168-.168*b,0,.272-.272*b,.534-.534*b,.131+.869*b,
0,0,0,0,1);return u.mat4.transpose(b,b)},saturate:function(b){b=b.amount;b=r.mat4f32.fromValues(.213+.787*b,.715-.715*b,.072-.072*b,0,.213-.213*b,.715+.285*b,.072-.072*b,0,.213-.213*b,.715-.715*b,.072+.928*b,0,0,0,0,1);return u.mat4.transpose(b,b)},"hue-rotate":function(b){var c=Math.sin(b.angle*Math.PI/180);b=Math.cos(b.angle*Math.PI/180);c=r.mat4f32.fromValues(.213+.787*b-.213*c,.715-.715*b-.715*c,.072-.072*b+.928*c,0,.213-.213*b+.143*c,.715+.285*b+.14*c,.072-.072*b-.283*c,0,.213-.213*b-.787*c,
.715-.715*b+.715*c,.072+.928*b+.072*c,0,0,0,0,1);return u.mat4.transpose(c,c)},invert:function(b){var c=1-2*b.amount;b=b.amount;c=r.mat4f32.fromValues(c,0,0,b,0,c,0,b,0,0,c,b,0,0,0,1);return u.mat4.transpose(c,c)},brightness:function(b){b=b.amount;b=r.mat4f32.fromValues(b,0,0,0,0,b,0,0,0,0,b,0,0,0,0,1);return u.mat4.transpose(b,b)},contrast:function(b){b=b.amount;b=r.mat4f32.fromValues(b,0,0,.5-.5*b,0,b,0,.5-.5*b,0,0,b,.5-.5*b,0,0,0,1);return u.mat4.transpose(b,b)}};return function(c){function e(){var b=
null!==c&&c.apply(this,arguments)||this;b.customTransforms=null;b.done=!0;return b}f(e,c);k=e;e.fromString=function(b){var a=[],c=null;try{for(var e=0,f=E.parse(b);e<f.length;e++){var g=f[e];"opacity"===g.type?c=g:a.push(g)}}catch(ha){v.error(new p("invalid-type","Encountered an error when parsing css",ha))}return new k({transforms:a,opacity:c})};e.prototype.getOpacity=function(){return b.isSome(this.opacity)?this.opacity.amount:1};e.prototype.getColorMatrix=function(){var b=this;return(this.transforms||
[]).map(function(a){return g({},a)}).reverse().reduce(function(a,c){return u.mat4.multiply(a,a,b._getFactory(c)(c))},r.mat4f32.create())};e.prototype.clone=function(){return new k({transforms:this.transforms&&this.transforms.map(function(b){return g({},b)}),customTransforms:this.customTransforms&&this.customTransforms.map(function(b){return g({},b)})})};e.prototype._getFactory=function(b){var a=z[b.type];if(!a){if(this.customTransforms)for(var a=function(a){if(a.type===b.type){a=r.mat4f32.fromValues.apply(r.mat4f32,
a.matrix);var c=u.mat4.transpose(a,a);return{value:function(a){return c}}}},c=0,e=this.customTransforms;c<e.length;c++){var f=a(e[c]);if("object"===typeof f)return f.value}v.error("invalid-type","No effect "+b.type+" exists");return function(a){return r.mat4f32.create()}}return a};var k;m([t.property()],e.prototype,"opacity",void 0);m([t.property()],e.prototype,"transforms",void 0);m([t.property()],e.prototype,"customTransforms",void 0);return e=k=m([t.subclass("esri.views.layers.support.ParsedFeatureEffect")],
e)}(t.declared(q.JSONSupport))})},"esri/views/layers/support/cssFilterParser":function(){define([],function(){function C(c,m,f,g){this.message=c;this.expected=m;this.found=f;this.location=g;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,C)}(function(c,m){function f(){this.constructor=c}f.prototype=m.prototype;c.prototype=new f})(C,Error);C.buildMessage=function(c,m){function f(c){return c.charCodeAt(0).toString(16).toUpperCase()}function g(c){return c.replace(/\\/g,
"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+f(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+f(b)})}function p(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+f(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,
function(b){return"\\x"+f(b)})}var q={literal:function(c){return'"'+g(c.text)+'"'},"class":function(c){var b="",e;for(e=0;e<c.parts.length;e++)b+=c.parts[e]instanceof Array?p(c.parts[e][0])+"-"+p(c.parts[e][1]):p(c.parts[e]);return"["+(c.inverted?"^":"")+b+"]"},any:function(c){return"any character"},end:function(c){return"end of input"},other:function(c){return c.description}};return"Expected "+function(c){var b=Array(c.length),e;for(e=0;e<c.length;e++){var f=e,g;g=c[e];g=q[g.type](g);b[f]=g}b.sort();
if(0<b.length){for(c=e=1;e<b.length;e++)b[e-1]!==b[e]&&(b[c]=b[e],c++);b.length=c}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(c)+" but "+(m?'"'+g(m)+'"':"end of input")+" found."};return{SyntaxError:C,parse:function(c,m){function f(a,b){return{type:"literal",text:a,ignoreCase:b}}function g(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function p(a){return{type:"other",description:a}}function q(a){var b=
ra[a],d;if(!b){for(d=a-1;!ra[d];)d--;b=ra[d];for(b={line:b.line,column:b.column};d<a;)10===c.charCodeAt(d)?(b.line++,b.column=1):b.column++,d++;ra[a]=b}return b}function e(a,b){var d=q(a),c=q(b);return{start:{offset:a,line:d.line,column:d.column},end:{offset:b,line:c.line,column:c.column}}}function b(a){d<X||(d>X&&(X=d,xa=[]),xa.push(a))}function t(){var e,f;l++;e=d;f=n();f!==a?(c.substr(d,4)===ja?(f=ja,d+=4):(f=a,0===l&&b(ha)),f!==a?(f=n(),f!==a?(y=e,e=null):(d=e,e=a)):(d=e,e=a)):(d=e,e=a);l--;e===
a&&(f=a,0===l&&b(qa));if(e===a)if(e=[],f=u(),f!==a)for(;f!==a;)e.push(f),f=u();else e=a;return e}function u(){var f,g,m,p,q,u,t,x,Q;l++;g=d;m=n();m!==a?(c.substr(d,5)===Na?(p=Na,d+=5):(p=a,0===l&&b(eb)),p!==a?(q=n(),q!==a?(u=k(),u!==a?(t=n(),t!==a?(41===c.charCodeAt(d)?(x=R,d++):(x=a,0===l&&b(S)),x!==a?(Q=n(),Q!==a?(y=g,g=m={type:"blur",radius:u}):(d=g,g=a)):(d=g,g=a)):(d=g,g=a)):(d=g,g=a)):(d=g,g=a)):(d=g,g=a)):(d=g,g=a);l--;g===a&&(m=a,0===l&&b(db));f=g;if(f===a){var I,X,ga,ha,ia,ma,ja,ra;l++;I=
d;X=n();X!==a?(c.substr(d,11)===Oa?(ga=Oa,d+=11):(ga=a,0===l&&b(gb)),ga!==a?(ha=n(),ha!==a?(ia=r(),ia!==a?(ma=n(),ma!==a?(41===c.charCodeAt(d)?(ja=R,d++):(ja=a,0===l&&b(S)),ja!==a?(ra=n(),ra!==a?(y=I,I=X={type:"brightness",amount:ia}):(d=I,I=a)):(d=I,I=a)):(d=I,I=a)):(d=I,I=a)):(d=I,I=a)):(d=I,I=a)):(d=I,I=a);l--;I===a&&(X=a,0===l&&b(fb));f=I;if(f===a){var J,na,qa,xa,jb,Da,kb,Ea;l++;J=d;na=n();na!==a?(c.substr(d,9)===Pa?(qa=Pa,d+=9):(qa=a,0===l&&b(Qa)),qa!==a?(xa=n(),xa!==a?(jb=r(),jb!==a?(Da=n(),
Da!==a?(41===c.charCodeAt(d)?(kb=R,d++):(kb=a,0===l&&b(S)),kb!==a?(Ea=n(),Ea!==a?(y=J,J=na={type:"contrast",amount:jb}):(d=J,J=a)):(d=J,J=a)):(d=J,J=a)):(d=J,J=a)):(d=J,J=a)):(d=J,J=a)):(d=J,J=a);l--;J===a&&(na=a,0===l&&b(hb));f=J;if(f===a){var D,Sa,lb,Fa,mb,Ga,nb,Ha,za,Ia,Aa,Ja,ob,Ka;l++;D=d;Sa=n();if(Sa!==a)if(c.substr(d,12)===Ra?(lb=Ra,d+=12):(lb=a,0===l&&b(wa)),lb!==a)if(Fa=n(),Fa!==a)if(mb=k(),mb!==a)if(Ga=n(),Ga!==a)if(nb=k(),nb!==a)if(Ha=n(),Ha!==a)if(za=k(),za===a&&(za=null),za!==a)if(Ia=
n(),Ia!==a){var h,B,H,A,F,G,Y,T,ea,U,fa,V,aa,ba,Ba,ya,La,pb;h=d;35===c.charCodeAt(d)?(B=Kb,d++):(B=a,0===l&&b(Lb));if(B!==a)if(H=d,A=w(),A!==a?(F=w(),F!==a?H=A=[A,F]:(d=H,H=a)):(d=H,H=a),H!==a)if(A=d,F=w(),F!==a?(G=w(),G!==a?A=F=[F,G]:(d=A,A=a)):(d=A,A=a),A!==a)if(F=d,G=w(),G!==a?(Y=w(),Y!==a?F=G=[G,Y]:(d=F,F=a)):(d=F,F=a),F!==a){y=h;var bb=A,cb=F;h=B=[parseInt(H.join(""),16),parseInt(bb.join(""),16),parseInt(cb.join(""),16)]}else d=h,h=a;else d=h,h=a;else d=h,h=a;else d=h,h=a;if(h===a){h=d;35===
c.charCodeAt(d)?(B=Kb,d++):(B=a,0===l&&b(Lb));if(B!==a)if(H=w(),H!==a)if(A=w(),A!==a)if(F=w(),F!==a){y=h;var Ma=A,Mb=F;h=B=[parseInt([H,H].join(""),16),parseInt([Ma,Ma].join(""),16),parseInt([Mb,Mb].join(""),16)]}else d=h,h=a;else d=h,h=a;else d=h,h=a;else d=h,h=a;if(h===a&&(h=d,c.substr(d,5)===oa?(B=oa,d+=5):(B=a,0===l&&b(Ta)),B!==a?(H=n(),H!==a?(A=v(),A!==a?(F=n(),F!==a?(44===c.charCodeAt(d)?(G=ca,d++):(G=a,0===l&&b(da)),G!==a?(Y=n(),Y!==a?(T=v(),T!==a?(ea=n(),ea!==a?(44===c.charCodeAt(d)?(U=ca,
d++):(U=a,0===l&&b(da)),U!==a?(fa=n(),fa!==a?(V=v(),V!==a?(aa=n(),aa!==a?(44===c.charCodeAt(d)?(ba=ca,d++):(ba=a,0===l&&b(da)),ba!==a?(Ba=n(),Ba!==a?(ya=r(),ya!==a?(La=n(),La!==a?(41===c.charCodeAt(d)?(pb=R,d++):(pb=a,0===l&&b(S)),pb!==a?(y=h,h=B=[255*A,255*T,255*V,ya]):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a),h===a&&(h=d,c.substr(d,5)===oa?(B=oa,d+=5):(B=
a,0===l&&b(Ta)),B!==a?(H=n(),H!==a?(A=E(),A!==a?(F=n(),F!==a?(44===c.charCodeAt(d)?(G=ca,d++):(G=a,0===l&&b(da)),G!==a?(Y=n(),Y!==a?(T=E(),T!==a?(ea=n(),ea!==a?(44===c.charCodeAt(d)?(U=ca,d++):(U=a,0===l&&b(da)),U!==a?(fa=n(),fa!==a?(V=E(),V!==a?(44===c.charCodeAt(d)?(aa=ca,d++):(aa=a,0===l&&b(da)),aa!==a?(ba=n(),ba!==a?(Ba=r(),Ba!==a?(41===c.charCodeAt(d)?(ya=R,d++):(ya=a,0===l&&b(S)),ya!==a?(y=h,h=B=[A,T,V,Ba]):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=
a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a),h===a&&(h=d,c.substr(d,5)===oa?(B=oa,d+=5):(B=a,0===l&&b(Ta)),B!==a?(H=n(),H!==a?(A=v(),A!==a?(F=n(),F!==a?(44===c.charCodeAt(d)?(G=ca,d++):(G=a,0===l&&b(da)),G!==a?(Y=n(),Y!==a?(T=v(),T!==a?(ea=n(),ea!==a?(44===c.charCodeAt(d)?(U=ca,d++):(U=a,0===l&&b(da)),U!==a?(fa=n(),fa!==a?(V=v(),V!==a?(aa=n(),aa!==a?(41===c.charCodeAt(d)?(ba=R,d++):(ba=a,0===l&&b(S)),ba!==a?(y=h,h=B=[255*A,255*T,255*V,1]):(d=h,h=a)):(d=h,h=a)):(d=
h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a),h===a&&(h=d,c.substr(d,5)===oa?(B=oa,d+=5):(B=a,0===l&&b(Ta)),B!==a?(H=n(),H!==a?(A=E(),A!==a?(F=n(),F!==a?(44===c.charCodeAt(d)?(G=ca,d++):(G=a,0===l&&b(da)),G!==a?(Y=n(),Y!==a?(T=E(),T!==a?(ea=n(),ea!==a?(44===c.charCodeAt(d)?(U=ca,d++):(U=a,0===l&&b(da)),U!==a?(fa=n(),fa!==a?(V=E(),V!==a?(41===c.charCodeAt(d)?(aa=R,d++):(aa=a,0===l&&b(S)),aa!==a?(y=h,h=B=[A,T,V,1]):(d=h,h=a)):(d=
h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a),h===a&&(h=d,c.substr(d,4)===Ua?(B=Ua,d+=4):(B=a,0===l&&b(Nb)),B!==a?(H=n(),H!==a?(A=v(),A!==a?(F=n(),F!==a?(44===c.charCodeAt(d)?(G=ca,d++):(G=a,0===l&&b(da)),G!==a?(Y=n(),Y!==a?(T=v(),T!==a?(ea=n(),ea!==a?(44===c.charCodeAt(d)?(U=ca,d++):(U=a,0===l&&b(da)),U!==a?(fa=n(),fa!==a?(V=v(),V!==a?(aa=n(),aa!==a?(41===c.charCodeAt(d)?(ba=R,d++):(ba=a,0===l&&b(S)),ba!==a?(y=h,h=B=[255*A,255*
T,255*V,1]):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a),h===a&&(h=d,c.substr(d,4)===Ua?(B=Ua,d+=4):(B=a,0===l&&b(Nb)),B!==a?(H=n(),H!==a?(A=E(),A!==a?(F=n(),F!==a?(44===c.charCodeAt(d)?(G=ca,d++):(G=a,0===l&&b(da)),G!==a?(Y=n(),Y!==a?(T=E(),T!==a?(ea=n(),ea!==a?(44===c.charCodeAt(d)?(U=ca,d++):(U=a,0===l&&b(da)),U!==a?(fa=n(),fa!==a?(V=E(),V!==a?(aa=n(),aa!==a?(41===c.charCodeAt(d)?(ba=R,d++):(ba=a,0===
l&&b(S)),ba!==a?(y=h,h=B=[A,T,V,1]):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a)):(d=h,h=a),h===a))))))){var Ca,sa,ta;l++;Ca=d;sa=[];Ob.test(c.charAt(d))?(ta=c.charAt(d),d++):(ta=a,0===l&&b(Pb));if(ta!==a)for(;ta!==a;)sa.push(ta),Ob.test(c.charAt(d))?(ta=c.charAt(d),d++):(ta=a,0===l&&b(Pb));else sa=a;if(sa!==a){y=Ca;var qb=c.substring(y,d);if(!sc.has(qb)){var Jb='unknown color "'+qb+'"',Va=void 0,Va=void 0!==Va?
Va:e(y,d);throw new C(Jb,null,null,Va);}sa=Qb[qb].concat(1)}Ca=sa;l--;Ca===a&&(sa=a,0===l&&b(tc));h=Ca}}Aa=h;Aa===a&&(Aa=null);Aa!==a?(Ja=n(),Ja!==a?(41===c.charCodeAt(d)?(ob=R,d++):(ob=a,0===l&&b(S)),ob!==a?(Ka=n(),Ka!==a?(y=D,D=Sa={type:"drop-shadow",offsetX:mb,offsetY:nb,blurRadius:za,color:Aa}):(d=D,D=a)):(d=D,D=a)):(d=D,D=a)):(d=D,D=a)}else d=D,D=a;else d=D,D=a;else d=D,D=a;else d=D,D=a;else d=D,D=a;else d=D,D=a;else d=D,D=a;else d=D,D=a;else d=D,D=a;l--;D===a&&(Sa=a,0===l&&b(ib));f=D;if(f===
a){var K,Wa,rb,Rb,sb,Sb,tb,Tb;l++;K=d;Wa=n();Wa!==a?(c.substr(d,10)===Ub?(rb=Ub,d+=10):(rb=a,0===l&&b(ka)),rb!==a?(Rb=n(),Rb!==a?(sb=r(),sb!==a?(Sb=n(),Sb!==a?(41===c.charCodeAt(d)?(tb=R,d++):(tb=a,0===l&&b(S)),tb!==a?(Tb=n(),Tb!==a?(y=K,K=Wa={type:"grayscale",amount:sb}):(d=K,K=a)):(d=K,K=a)):(d=K,K=a)):(d=K,K=a)):(d=K,K=a)):(d=K,K=a)):(d=K,K=a);l--;K===a&&(Wa=a,0===l&&b(rc));f=K;if(f===a){var L,Xa,ub,Vb,vb,Wb,wb,Xb;l++;L=d;Xa=n();if(Xa!==a)if(c.substr(d,11)===Yb?(ub=Yb,d+=11):(ub=a,0===l&&b(uc)),
ub!==a)if(Vb=n(),Vb!==a){var W,pa,ua;l++;W=d;var la,va,Zb;l++;la=d;vc.test(c.charAt(d))?(va=c.charAt(d),d++):(va=a,0===l&&b(wc));va===a&&(va=null);va!==a?(Zb=E(),Zb!==a?(y=la,la=va=parseFloat(c.substring(y,d))):(d=la,la=a)):(d=la,la=a);l--;la===a&&(va=a,0===l&&b(xc));pa=la;pa!==a?(ua=z(),ua!==a?(y=W,W=pa*=ua):(d=W,W=a)):(d=W,W=a);W===a&&(W=d,48===c.charCodeAt(d)?(pa=$b,d++):(pa=a,0===l&&b(ac)),pa!==a?(ua=z(),ua===a&&(ua=null),ua!==a?(y=W,W=pa=0):(d=W,W=a)):(d=W,W=a));l--;W===a&&(pa=a,0===l&&b(yc));
vb=W;vb!==a?(Wb=n(),Wb!==a?(41===c.charCodeAt(d)?(wb=R,d++):(wb=a,0===l&&b(S)),wb!==a?(Xb=n(),Xb!==a?(y=L,L=Xa={type:"hue-rotate",angle:vb}):(d=L,L=a)):(d=L,L=a)):(d=L,L=a)):(d=L,L=a)}else d=L,L=a;else d=L,L=a;else d=L,L=a;l--;L===a&&(Xa=a,0===l&&b(Z));f=L;if(f===a){var M,Ya,xb,bc,yb,cc,zb,dc;l++;M=d;Ya=n();Ya!==a?(c.substr(d,7)===ec?(xb=ec,d+=7):(xb=a,0===l&&b(zc)),xb!==a?(bc=n(),bc!==a?(yb=r(),yb!==a?(cc=n(),cc!==a?(41===c.charCodeAt(d)?(zb=R,d++):(zb=a,0===l&&b(S)),zb!==a?(dc=n(),dc!==a?(y=M,M=
Ya={type:"invert",amount:yb}):(d=M,M=a)):(d=M,M=a)):(d=M,M=a)):(d=M,M=a)):(d=M,M=a)):(d=M,M=a)):(d=M,M=a);l--;M===a&&(Ya=a,0===l&&b(Ac));f=M;if(f===a){var N,Za,Ab,fc,Bb,gc,Cb,hc;l++;N=d;Za=n();Za!==a?(c.substr(d,8)===ic?(Ab=ic,d+=8):(Ab=a,0===l&&b(Bc)),Ab!==a?(fc=n(),fc!==a?(Bb=r(),Bb!==a?(gc=n(),gc!==a?(41===c.charCodeAt(d)?(Cb=R,d++):(Cb=a,0===l&&b(S)),Cb!==a?(hc=n(),hc!==a?(y=N,N=Za={type:"opacity",amount:Bb}):(d=N,N=a)):(d=N,N=a)):(d=N,N=a)):(d=N,N=a)):(d=N,N=a)):(d=N,N=a)):(d=N,N=a);l--;N===
a&&(Za=a,0===l&&b(Cc));f=N;if(f===a){var O,$a,Db,jc,Eb,kc,Fb,lc;l++;O=d;$a=n();$a!==a?(c.substr(d,9)===mc?(Db=mc,d+=9):(Db=a,0===l&&b(Dc)),Db!==a?(jc=n(),jc!==a?(Eb=r(),Eb!==a?(kc=n(),kc!==a?(41===c.charCodeAt(d)?(Fb=R,d++):(Fb=a,0===l&&b(S)),Fb!==a?(lc=n(),lc!==a?(y=O,O=$a={type:"saturate",amount:Eb}):(d=O,O=a)):(d=O,O=a)):(d=O,O=a)):(d=O,O=a)):(d=O,O=a)):(d=O,O=a)):(d=O,O=a);l--;O===a&&($a=a,0===l&&b(Ec));f=O;if(f===a){var P,ab,Gb,nc,Hb,oc,Ib,pc;l++;P=d;ab=n();ab!==a?(c.substr(d,6)===qc?(Gb=qc,
d+=6):(Gb=a,0===l&&b(Fc)),Gb!==a?(nc=n(),nc!==a?(Hb=r(),Hb!==a?(oc=n(),oc!==a?(41===c.charCodeAt(d)?(Ib=R,d++):(Ib=a,0===l&&b(S)),Ib!==a?(pc=n(),pc!==a?(y=P,P=ab={type:"sepia",amount:Hb}):(d=P,P=a)):(d=P,P=a)):(d=P,P=a)):(d=P,P=a)):(d=P,P=a)):(d=P,P=a)):(d=P,P=a);l--;P===a&&(ab=a,0===l&&b(Gc));f=P}}}}}}}}}return f}function r(){var d;l++;d=v();d===a&&(d=E());l--;d===a&&0===l&&b(Jb);return d}function E(){var e,f,g;l++;e=d;f=[];ia.test(c.charAt(d))?(g=c.charAt(d),d++):(g=a,0===l&&b(ma));if(g!==a)for(;g!==
a;)f.push(g),ia.test(c.charAt(d))?(g=c.charAt(d),d++):(g=a,0===l&&b(ma));else f=a;if(f!==a)if(46===c.charCodeAt(d)?(g=Hc,d++):(g=a,0===l&&b(Ic)),g!==a){f=[];ia.test(c.charAt(d))?(g=c.charAt(d),d++):(g=a,0===l&&b(ma));if(g!==a)for(;g!==a;)f.push(g),ia.test(c.charAt(d))?(g=c.charAt(d),d++):(g=a,0===l&&b(ma));else f=a;f!==a?(y=e,e=f=parseFloat(c.substring(y,d))):(d=e,e=a)}else d=e,e=a;else d=e,e=a;if(e===a){l++;e=d;f=[];ia.test(c.charAt(d))?(g=c.charAt(d),d++):(g=a,0===l&&b(ma));if(g!==a)for(;g!==a;)f.push(g),
ia.test(c.charAt(d))?(g=c.charAt(d),d++):(g=a,0===l&&b(ma));else f=a;f!==a&&(y=e,f=parseInt(c.substring(y,d),10));e=f;l--;e===a&&(f=a,0===l&&b(Jc))}l--;e===a&&(f=a,0===l&&b(Kc));return e}function v(){var e,f,g;e=d;f=E();f!==a?(37===c.charCodeAt(d)?(g=Lc,d++):(g=a,0===l&&b(Mc)),g!==a?(y=e,e=f/100):(d=e,e=a)):(d=e,e=a);return e}function z(){var e,f;l++;e=d;c.substr(d,3)===Da?(f=Da,d+=3):(f=a,0===l&&b(Nc));f!==a&&(y=e,f=1);e=f;e===a&&(e=d,c.substr(d,4)===Ea?(f=Ea,d+=4):(f=a,0===l&&b(Oc)),f!==a&&(y=e,
f=.9),e=f,e===a&&(e=d,c.substr(d,3)===Fa?(f=Fa,d+=3):(f=a,0===l&&b(Pc)),f!==a&&(y=e,f=180/Math.PI),e=f,e===a&&(e=d,c.substr(d,4)===Ga?(f=Ga,d+=4):(f=a,0===l&&b(Qc)),f!==a&&(y=e,f=1/360),e=f)));l--;e===a&&(f=a,0===l&&b(Rc));return e}function k(){var e,f,g;l++;e=d;f=E();f!==a?(g=Q(),g!==a?(y=e,e=f*g):(d=e,e=a)):(d=e,e=a);e===a&&(e=d,48===c.charCodeAt(d)?(f=$b,d++):(f=a,0===l&&b(ac)),f!==a?(g=Q(),g===a&&(g=null),g!==a?(y=e,e=0):(d=e,e=a)):(d=e,e=a));l--;e===a&&(f=a,0===l&&b(Sc));return e}function Q(){var e,
f;e=d;c.substr(d,2)===Ha?(f=Ha,d+=2):(f=a,0===l&&b(Tc));f!==a&&(y=e,f=1);e=f;e===a&&(e=d,c.substr(d,2)===Ia?(f=Ia,d+=2):(f=a,0===l&&b(Uc)),f!==a&&(y=e,f=96/2.54),e=f,e===a&&(e=d,c.substr(d,2)===Ja?(f=Ja,d+=2):(f=a,0===l&&b(Vc)),f!==a&&(y=e,f=96/2.54/10),e=f,e===a&&(e=d,81===c.charCodeAt(d)?(f=Wc,d++):(f=a,0===l&&b(Xc)),f!==a&&(y=e,f=96/2.54/40),e=f,e===a&&(e=d,c.substr(d,2)===Ka?(f=Ka,d+=2):(f=a,0===l&&b(Yc)),f!==a&&(y=e,f=96),e=f,e===a&&(e=d,c.substr(d,2)===La?(f=La,d+=2):(f=a,0===l&&b(Zc)),f!==
a&&(y=e,f=16),e=f,e===a&&(e=d,c.substr(d,2)===bb?(f=bb,d+=2):(f=a,0===l&&b($c)),f!==a&&(y=e,f=96/73),e=f))))));return e}function w(){var e;ad.test(c.charAt(d))?(e=c.charAt(d),d++):(e=a,0===l&&b(bd));return e}function n(){var e,f;l++;e=[];cb.test(c.charAt(d))?(f=c.charAt(d),d++):(f=a,0===l&&b(Ma));for(;f!==a;)e.push(f),cb.test(c.charAt(d))?(f=c.charAt(d),d++):(f=a,0===l&&b(Ma));l--;e===a&&(f=a,0===l&&b(cd));return e}m=void 0!==m?m:{};var a={},x={start:t},ga=t,qa=p("none"),ja="none",ha=f("none",!1),
db=p("blur()"),Na="blur(",eb=f("blur(",!1),R=")",S=f(")",!1),fb=p("brightness()"),Oa="brightness(",gb=f("brightness(",!1),hb=p("contrast()"),Pa="contrast(",Qa=f("contrast(",!1),ib=p("drop-shadow()"),Ra="drop-shadow(",wa=f("drop-shadow(",!1),rc=p("grayscale()"),Ub="grayscale(",ka=f("grayscale(",!1),Z=p("hue-rotate()"),Yb="hue-rotate(",uc=f("hue-rotate(",!1),Ac=p("invert()"),ec="invert(",zc=f("invert(",!1),Cc=p("opacity()"),ic="opacity(",Bc=f("opacity(",!1),Ec=p("saturate()"),mc="saturate(",Dc=f("saturate(",
!1),Gc=p("sepia()"),qc="sepia(",Fc=f("sepia(",!1),Jb=p("\x3cnumber-percentage\x3e"),Jc=p("\x3cinteger\x3e"),ia=/^[0-9]/,ma=g([["0","9"]],!1,!1),Kc=p("\x3cnumber\x3e"),Hc=".",Ic=f(".",!1),xc=p("\x3csignedNumber\x3e"),vc=/^[+\-]/,wc=g(["+","-"],!1,!1),Lc="%",Mc=f("%",!1),yc=p("\x3cangle\x3e"),$b="0",ac=f("0",!1),Rc=p("\x3cunit\x3e"),Da="deg",Nc=f("deg",!1),Ea="grad",Oc=f("grad",!1),Fa="rad",Pc=f("rad",!1),Ga="turn",Qc=f("turn",!1),Sc=p("\x3clength\x3e"),Ha="px",Tc=f("px",!1),Ia="cm",Uc=f("cm",!1),Ja=
"mm",Vc=f("mm",!1),Wc="Q",Xc=f("Q",!1),Ka="in",Yc=f("in",!1),La="pc",Zc=f("pc",!1),bb="pt",$c=f("pt",!1),Kb="#",Lb=f("#",!1),oa="rgba(",Ta=f("rgba(",!1),ca=",",da=f(",",!1),Ua="rgb(",Nb=f("rgb(",!1),ad=/^[0-9a-fA-F]/,bd=g([["0","9"],["a","f"],["A","F"]],!1,!1),cd=p("whitespace"),cb=/^[ \t\n\r]/,Ma=g([" ","\t","\n","\r"],!1,!1),tc=p("\x3cnamed-color\x3e"),Ob=/^[a-z]/,Pb=g([["a","z"]],!1,!1),d=0,y=0,ra=[{line:1,column:1}],X=0,xa=[],l=0,na;if("startRule"in m){if(!(m.startRule in x))throw Error("Can't start parsing from rule \""+
m.startRule+'".');ga=x[m.startRule]}var Qb={transparent:[0,0,0,0],black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,
205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],
darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,
128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,
206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,
225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rebeccapurple:[102,51,153],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,
128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]},sc=new Set(Object.keys(Qb));na=ga();if(na!==a&&d===c.length)return na;na!==
a&&d<c.length&&b({type:"end"});throw function(a,b,d){return new C(C.buildMessage(a,b),a,b,d)}(xa,X<c.length?c.charAt(X):null,X<c.length?e(X,X+1):e(X,X));}}})},"esri/views/layers/support/Transition":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4".split(" "),function(C,c,m,f,g,p,q){return function(c){function b(){var b=null!==c&&
c.apply(this,arguments)||this;b.from=null;b.to=null;b.duration=4E3;b.repeat=!0;b.done=!1;return b}f(b,c);e=b;b.prototype.getColorMatrix=function(){this.done=!1;if(null==this._lastTime)this._currentStep=0,this._lastTime=Date.now();else{var b=this._lastTime,c=Date.now();this._currentStep+=c-b;2147483647<=this._currentStep&&(this._currentStep=0);this._lastTime=c}var b=this._currentStep%this.duration/(this.duration/2),b=1>=b?b:2-b,c=this.from.getColorMatrix(),e=this.to.getColorMatrix();q.mat4.multiplyScalar(c,
c,1-b);q.mat4.multiplyScalar(e,e,b);!this.repeat&&this._currentStep>=this.duration&&(this.done=!0);return q.mat4.add(c,c,e)};b.prototype.getOpacity=function(){throw Error("No getOpacity definition for Transition");};b.prototype.clone=function(){var b=new e({from:this.from.clone(),to:this.to.clone(),duration:this.duration});b._lastTime=this._lastTime;b._currentStep=this._currentStep;return b};var e;m([p.property()],b.prototype,"from",void 0);m([p.property()],b.prototype,"to",void 0);m([p.property({type:Number})],
b.prototype,"duration",void 0);m([p.property({type:Boolean})],b.prototype,"repeat",void 0);return b=e=m([p.subclass("esri.views.layers.support.Transition")],b)}(p.declared(g))})},"esri/views/layers/support/popupUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),function(C,c,m,f,g,p,q){Object.defineProperty(c,"__esModule",{value:!0});c.getRequiredFields=
function(c,b){void 0===b&&(b=c.popupTemplate);return f(this,void 0,void 0,function(){var e,f,r,E,v,z,k,C,w,n,a;return m(this,function(m){switch(m.label){case 0:return p.isSome(b)?[4,b.getRequiredFields(c.fields)]:[2,[]];case 1:e=m.sent();f=b.lastEditInfoEnabled;r=c.objectIdField;E=c.typeIdField;if(g.includes(e,"*"))return[2,["*"]];z=q.fixFields;k=[c.fields];w=(C=e).concat;n=[[E]];return(a=f)?[4,q.getFeatureEditFields(c)]:[3,3];case 2:a=m.sent(),m.label=3;case 3:return(v=z.apply(void 0,k.concat([w.apply(C,
n.concat([a||null]))])))&&r&&q.hasField(c.fields,r)&&-1===v.indexOf(r)&&v.push(r),[2,v]}})})};c.getFetchPopupTemplate=function(c,b){return c.popupTemplate?c.popupTemplate:p.isSome(b)&&b.defaultPopupTemplateEnabled&&p.isSome(c.defaultPopupTemplate)?c.defaultPopupTemplate:null}})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/paramHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/iteratorUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../renderers/support/clickToleranceUtils ../../../tasks/support/FeatureSet ../../../tasks/support/Query ../engine ./LayerView2D ./features/tileRenderers ./features/support/rendererUtils ./support/FeatureLayerProxy ./support/popupUtils2D ./support/util ../tiling/TileStrategy ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../../views/layers/support/FeatureFilter ../../layers/support/FeatureEffect".split(" "),function(C,
c,m,f,g,p,q,e,b,t,u,r,E,v,z,k,Q,w,n,a,x,ga,qa,ja,ha,db,Na,eb,R,S,fb,Oa,gb,hb,Pa,Qa,ib){function Ra(a){return a&&"openPorts"in a}var wa=Q.getLogger("esri.views.2d.layers.FeatureLayerView2D");return function(c){function g(){var a=null!==c&&c.apply(this,arguments)||this;a._pipelineIsUpdating=!0;a._updatingPipelineConfig=!1;a._visibilityOverrides=new Set;a._effect=null;a._highlightIds=new Map;a.container=new ha.Container;a.filter=null;a._onRenderingConfigChange=n.debounce(r.safeCastFunction(function(){return e(a,
void 0,void 0,function(){var a,b,c,e,f,g,ka,m,n,p,r,t,u;return q(this,function(Z){switch(Z.label){case 0:if(!this._hasRequiredSupport(this.layer))return[2];this._set("_updatingPipelineConfig",!0);return[4,this._updateRequiredFields()];case 1:return Z.sent(),a=this.availableFields.join("."),b=this._createLayerFilterHash(),c=this._createTileRendererHash(),e=this._createFeatureDataHash(),f=this._createMeshHash(),this._lockAttributeTextureUpload(),c===this._tileRendererHash?[3,10]:[4,this._initTileRenderer()];
case 2:return Z.sent(),Ra(this.layer.source)?[4,this._createMemoryServiceOptions(this.layer.source)]:[3,4];case 3:return ka=Z.sent(),[3,5];case 4:ka=this._createServiceOptions(),Z.label=5;case 5:return g=ka,[4,this._proxy.startup(this.view.featuresTilingScheme,this._createConfiguration(),g)];case 6:return Z.sent(),this.hasHighlight()?[4,this._proxy.setHighlight(k.keysOfMap(this._highlightIds))]:[3,8];case 7:Z.sent(),Z.label=8;case 8:return[4,this._onceTilesUpdated()];case 9:return Z.sent(),[3,14];
case 10:m=a!==this._clientDataHash;n=b!==this._layerFilterHash;p=e!==this._featureDataHash||m;r=f!==this._meshHash;t=this._createConfiguration();if(!(m||n||p||r))return[3,12];u={invalidateFeatureData:p,invalidateMesh:r,layerFilterChanged:n};this._set("_pipelineIsUpdating",!0);return[4,this._proxy.update(t,u)];case 11:Z.sent(),Z.label=12;case 12:return n?[4,this._onceTilesUpdated()]:[3,14];case 13:Z.sent(),Z.label=14;case 14:return this._clientDataHash=a,this._layerFilterHash=b,this._tileRendererHash=
c,this._meshHash=f,this._featureDataHash=e,this.effects.forEach(function(a){return w.isSome(a)&&w.isSome(a.filter)&&a.filter.enable()}),this.tileRenderer.invalidateLabels(),this.tileRenderer.onConfigUpdate(),this._unlockAttributeTextureUpload(),this._forceAttributeTextureUpload(),this.requestUpdate(),[2]}})})}));a._updateHighlight=n.debounce(function(){return e(a,void 0,void 0,function(){return q(this,function(a){return[2,this._proxy.setHighlight(k.keysOfMap(this._highlightIds))]})})});return a}m(g,
c);g.prototype.destroy=function(){this._proxy.destroy()};g.prototype.initialize=function(){var a=this;this.addResolvingPromise(r.safeCast(this._initProxy()));this.handles.add([this.clips.on("change",function(){return a.tileRenderer&&a.tileRenderer.onConfigUpdate()})])};g.prototype._initProxy=function(){return e(this,void 0,void 0,function(){var a;return q(this,function(b){if(this.layer.isTable)throw new v("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});
this._proxy&&this._proxy.destroy();a=this._createClientOptions();this._set("_proxy",new R.default({client:a}));return[2,this._proxy.when()]})})};Object.defineProperty(g.prototype,"labelsVisible",{get:function(){return!this.suspended&&this.layer.labelingInfo&&this.layer.labelsVisible},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"effect",{get:function(){return w.unwrapOr(this._effect,null)},set:function(a){var b=this._effect;w.isSome(b)&&w.isSome(b.filter)&&b.filter.enabled&&w.isSome(a)&&
w.isSome(a.filter)&&a.filter.enable();this._effect=a;this.notifyChange("effect")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"effects",{get:function(){return this.effect&&[this.effect]||[]},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"numFeatures",{get:function(){var a=0;this.attached&&this._tileStrategy.tiles.forEach(function(b){a+=b.iconDisplayRecords?b.iconDisplayRecords.length:0});return a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"renderingConfigHash",{get:function(){if(!this.layer)return null;var a=this.availableFields,b=this.layer,c=b.definitionExpression,e=b.renderer,b=b.labelingInfo,f="historicMoment"in this.layer?this.layer.historicMoment:null,g=this.timeExtent,k="filter"in this.layer&&this.layer.filter&&""+JSON.stringify(this.layer.filter.geometry)+this.layer.filter.where,m=JSON.stringify(this.clips);return JSON.stringify({filterHash:w.isSome(this.filter)&&this.filter.toJSON(),effectHash:w.isSome(this.effect)&&this.effect.toJSON(),
streamFilter:k,definitionExpression:c,historicMoment:f,availableFields:a,renderer:e,labelingInfo:b,timeExtent:g,clipsHash:m})},enumerable:!0,configurable:!0});g.prototype.highlight=function(a){var b=this,c;a instanceof t?c=[a.getAttribute(this.layer.objectIdField||"__esri_stream_id__")]:"number"===typeof a?c=[a]:E.isCollection(a)?c=a.map(function(a){return a&&a.getAttribute(b.layer.objectIdField)}).toArray():Array.isArray(a)&&0<a.length&&(c="number"===typeof a[0]?a:a.map(function(a){return a&&a.getAttribute(b.layer.objectIdField)}));
if(!c||!c.length)return{remove:function(){},pause:function(){},resume:function(){}};c=c.filter(function(a){return null!=a});this._addHighlight(c);return{remove:function(){return b._removeHighlight(c)},pause:function(){return b._removeHighlight(c)},resume:function(){return b._addHighlight(c)}}};g.prototype.hasHighlight=function(){return!!this._highlightIds.size};g.prototype.hitTest=function(a,b){return r.safeCast(this._hitTest(a,b))};g.prototype.queryFeatures=function(a,b){var c=this;return this.queryFeaturesJSON(a,
b).then(function(a){a=qa.fromJSON(a);a.features.forEach(function(a){a.layer=c.layer;a.sourceLayer=c.layer});return a})};g.prototype.queryFeaturesJSON=function(a,b){return r.safeCast(this._proxy.queryFeatures(this._cleanUpQuery(a),b))};g.prototype.queryObjectIds=function(a,b){return r.safeCast(this._proxy.queryObjectIds(this._cleanUpQuery(a),b))};g.prototype.queryFeatureCount=function(a,b){return r.safeCast(this._proxy.queryFeatureCount(this._cleanUpQuery(a),b))};g.prototype.queryExtent=function(a,
c){return r.safeCast(this._proxy.queryExtent(this._cleanUpQuery(a),c).then(function(a){return{count:a.count,extent:b.Extent.fromJSON(a.extent)}}))};g.prototype.setVisibility=function(a,b){b?this._visibilityOverrides.delete(a):this._visibilityOverrides.add(a);this._renderingConfigHashChanged()};g.prototype.update=function(a){this.attached&&this._tileStrategy&&this.tileRenderer&&(this._tileStrategy.update(a)||this.requestUpdate(),this._proxy.setViewState(a.state),this.notifyChange("numFeatures"),this.notifyChange("updating"))};
g.prototype.attach=function(){var b=this;this.view.timeline.record(this.layer.title+" (FeatureLayer) Attach");this._tileStrategy=new Oa({cachePolicy:"purge",acquireTile:function(a){return b._acquireTile(a)},releaseTile:function(a){return b._releaseTile(a)},tileInfoView:this.view.featuresTilingScheme,buffer:0});this.handles.add([a.watch(this,"layer.processing?.version",function(a){return b._proxy.redraw()}),this.layer.on("edits",function(a){return b._proxy.onEdits(a)}),a.init(this,"renderingConfigHash",
function(){return b._renderingConfigHashChanged()},!0)],"attach")};g.prototype.detach=function(){this.container.removeAllChildren();this.handles.remove("attach");this._updatingPipelineConfig=!1;this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null)};g.prototype.moveStart=function(){this.requestUpdate()};g.prototype.viewChange=function(){this.requestUpdate()};g.prototype.moveEnd=function(){this.requestUpdate()};
g.prototype.fetchPopupFeatures=function(a,b){return e(this,void 0,void 0,function(){var c,e,f;return q(this,function(g){if(c=this.validateFetchPopupFeatures(b))return[2,n.reject(c)];if(w.isSome(b)&&0===b.clientGraphics.length)return[2,n.resolve([])];e=this.fetchClientPopupFeatures(b);if(!a)return[2,e];f=this._fetchServicePopupFeatures(a,b);return[2,n.eachAlwaysValues([e,f]).then(u.flatten)]})})};g.prototype._fetchServicePopupFeatures=function(a,b){return e(this,void 0,void 0,function(){var c,e,f,
g,k,m,n,p,ka,r;return q(this,function(q){switch(q.label){case 0:return[4,this.createPopupQuery(b)];case 1:c=q.sent();e=this.layer;f=e.renderer;g=ga.calculateTolerance(f);c.geometry=this.createFetchPopupFeaturesQueryGeometry(a,g);k=new Set;m=e.objectIdField;if(n=w.isSome(b)?b.clientGraphics:null)for(p=0,ka=n;p<ka.length;p++)r=ka[p],k.add(r.attributes[m]);return[2,e.queryFeatures(c).then(function(a){return a.features.filter(function(a){return!k.has(a.attributes[m])})})]}})})};g.prototype.createFetchPopupFeaturesQueryGeometry=
function(a,b){return S.createQueryGeometry(a,b,this.view)};g.prototype.doRefresh=function(a){return e(this,void 0,void 0,function(){return q(this,function(a){this._proxy.refresh();return[2]})})};g.prototype.isUpdating=function(){return null!=this.layer.renderer&&(null!=this._updatingRequiredFieldsPromise||null==this.tileRenderer||!this._proxy||!this._proxy.isReady||this._pipelineIsUpdating||this._updatingPipelineConfig||this.tileRenderer.updating)};g.prototype._createClientOptions=function(){var a=
this;return{executeProcessing:function(b){if(!("processing"in a.layer&&a.layer.processing))return b.featureSet;var c=a.layer.processing;return(b=c.process(b.featureSet,c.options))?b:n.reject(new v("FeatureLayer","invalid processing.process() method, returns nothing"))},setUpdating:function(b){a._set("_pipelineIsUpdating",b)}}};g.prototype._createServiceOptions=function(){var a=this.layer,b=a.capabilities,c=a.objectIdField,e=a.fields.map(function(a){return a.toJSON()}),f=a.fullExtent&&a.fullExtent.toJSON(),
g=fb.toJSONGeometryType(a.geometryType),k=a.timeInfo&&a.timeInfo.toJSON()||null;return{type:"on-demand",maxRecordCount:"maxRecordCount"in this.layer&&this.layer.maxRecordCount,tileMaxRecordCount:"tileMaxRecordCount"in this.layer&&this.layer.tileMaxRecordCount,capabilities:b,fields:e,fullExtent:f,geometryType:g,objectIdField:c,source:"dynamicDataSource"in a?a.dynamicDataSource?a.parsedUrl:a.url+"/"+a.layerId:a.parsedUrl,timeInfo:k}};g.prototype._createMemoryServiceOptions=function(a){return e(this,
void 0,void 0,function(){var b;return q(this,function(c){switch(c.label){case 0:return[4,a.openPorts()];case 1:return b=c.sent(),[2,p({},this._createServiceOptions(),{type:"memory",source:b})]}})})};g.prototype._cleanUpQuery=function(a){a=ja.from(a)||this.createQuery();a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};g.prototype._acquireTile=function(a){var b=this;a=this.tileRenderer.acquireTile(a);a.once("attach",function(){b.requestUpdate()});return a};g.prototype._releaseTile=
function(a){this.tileRenderer.releaseTile(a)};g.prototype._initTileRenderer=function(){return e(this,void 0,void 0,function(){var a;return q(this,function(b){switch(b.label){case 0:return[4,Na.createOrReuseTileRenderer(this.tileRenderer,this.layer.renderer,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer})];case 1:a=b.sent();if(!this.tileRenderer)return[3,3];this._tileStrategy.clear();this.tileRenderer.uninstall(this.container);this.tileRenderer.destroy();this.tileRenderer=
null;return[4,this._initProxy()];case 2:b.sent(),b.label=3;case 3:return this._proxy.tileRenderer=a,this._set("tileRenderer",a),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(),[2,this.tileRenderer]}})})};g.prototype._createLayerFilterHash=function(){var a=this.layer.definitionExpression,b=("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.historicMoment&&this.layer.historicMoment.getTime();return a+"."+b+"."+(("feature"===this.layer.type||"csv"===this.layer.type)&&
this.layer.gdbVersion)};g.prototype._createTileRendererHash=function(){return("heatmap"===this.layer.renderer.type?"heatmap":"symbol")+"."+("dot-density"===this.layer.renderer.type)};g.prototype._createFeatureDataHash=function(){var a=this.layer.renderer.getAttributeHash(),b=JSON.stringify(this.filter),c=w.isSome(this.effect)&&JSON.stringify(this.effect.filter),e=JSON.stringify(this.timeExtent),f="";this._visibilityOverrides.forEach(function(a){return f+=a});return a+"."+b+"."+c+"."+e+"."+f};g.prototype._createMeshHash=
function(){var a=this.layer.renderer,b=ha.getVVFlags("visualVariables"in a&&a.visualVariables||[]),c=this.layer.labelingInfo&&this.layer.labelingInfo.map(function(a){return JSON.stringify(a)}).join("/");return a.getMeshHash()+"."+b+"."+c};g.prototype._injectOverrides=function(a){var b=this.filter&&this.filter.timeExtent,b=this.timeExtent&&b?this.timeExtent.intersection(b):this.timeExtent||b;if(!this._visibilityOverrides.size&&!b)return a;a=w.isSome(this.filter)&&this.filter.clone()||new Qa;a.hiddenIds=
this._visibilityOverrides;a.timeExtent=b;return a};g.prototype._createConfiguration=function(){var a=eb.simplifyVVRenderer(this.layer.renderer),b=this.layer.labelingInfo,c=("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.historicMoment&&this.layer.historicMoment.getTime(),e=("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.gdbVersion,f=Array(ha.definitions.MAX_FILTERS),g=this._injectOverrides(this.filter);f[0]=w.isSome(g)&&g.toJSON()||null;f[1]=w.isSome(this.effect)&&
this.effect.filter&&this.effect.filter.toJSON()||null;return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,labelingInfo:b&&b.map(function(a){return a.toJSON()}),renderer:a.toJSON(),gdbVersion:e,historicMoment:c,devicePixelRatio:window.devicePixelRatio||1,filters:f,processing:"processing"in this.layer&&this.layer.processing&&this.layer.processing.toWorker()}};g.prototype._hasRequiredSupport=function(a){return"dot-density"!==a.renderer.type||z("esri-webgl-texture-float")?
!0:(wa.error(new v("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1)};g.prototype._onceTilesUpdated=function(){this.requestUpdate();return a.whenFalseOnce(this,"_pipelineIsUpdating",!0)};g.prototype._lockAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.lockAttributeTextureUpload()};g.prototype._unlockAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.unlockAttributeTextureUpload()};g.prototype._forceAttributeTextureUpload=
function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()};g.prototype._renderingConfigHashChanged=function(){var a=this;this.view.timeline.begin(this.layer.title+" (FeatureLayer) Initial Pipeline Config");var b=this._onRenderingConfigChange();this._updatingPromise=b;var c=function(){b===a._updatingPromise&&a._set("_updatingPipelineConfig",!1);a.view.timeline.end(a.layer.title+" (FeatureLayer) Initial Pipeline Config")};b.then(c).catch(function(a){n.isAbortError(a)||wa.error(a);
c()})};g.prototype._addHighlight=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(this._highlightIds.has(c)){var e=this._highlightIds.get(c);this._highlightIds.set(c,e+1)}else this._highlightIds.set(c,1)}this._updateHighlight().catch(function(a){n.isAbortError(a)||wa.error(a)})};g.prototype._removeHighlight=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(this._highlightIds.has(c)){var e=this._highlightIds.get(c)-1;0===e?this._highlightIds.delete(c):this._highlightIds.set(c,e)}}this._updateHighlight().catch(function(a){n.isAbortError(a)||
wa.error(a)})};g.prototype._hitTest=function(a,b){return e(this,void 0,void 0,function(){var c,e,f,g;return q(this,function(k){switch(k.label){case 0:return this.suspended||!this.tileRenderer?[2,null]:[4,this.tileRenderer.hitTest(a,b)];case 1:return c=k.sent(),0!==c.length?[3,3]:[4,n.after(1)];case 2:return k.sent(),[2,null];case 3:return[4,this._proxy.getObjectId(c[0])];case 4:return e=k.sent(),[4,this._proxy.queryFeatures(new ja({objectIds:[e],outSpatialReference:this.view.spatialReference,returnGeometry:!0}))];
case 5:f=k.sent();if(!f.features[0])return[2,null];g=t.fromJSON(f.features[0]);g.layer=this.layer;g.sourceLayer=this.layer;w.isSome(g.geometry)&&(g.geometry.spatialReference=this.view.spatialReference);return[2,g]}})})};f([x.property()],g.prototype,"_proxy",void 0);f([x.property()],g.prototype,"_pipelineIsUpdating",void 0);f([x.property()],g.prototype,"_updatingPipelineConfig",void 0);f([x.property({dependsOn:["suspended","layer.labelingInfo","layer.labelsVisible"]})],g.prototype,"labelsVisible",
null);f([x.property({type:Qa})],g.prototype,"filter",void 0);f([x.property({type:ib})],g.prototype,"effect",null);f([x.property({readOnly:!0,dependsOn:["effect"]})],g.prototype,"effects",null);f([x.property()],g.prototype,"numFeatures",null);f([x.property({dependsOn:"layer.renderer availableFields layer.definitionExpression layer.filter? layer.historicMoment? layer.labelingInfo filter effect timeExtent clips".split(" ")})],g.prototype,"renderingConfigHash",null);f([x.property()],g.prototype,"tileRenderer",
void 0);f([x.property({dependsOn:"layer.renderer tileRenderer.updating _updatingPipelineConfig _pipelineIsUpdating _updatingRequiredFieldsPromise _proxy _proxy.isReady?".split(" ")})],g.prototype,"updating",void 0);return g=f([x.subclass("esri.views.2d.layers.FeatureLayerView2D")],g)}(x.declared(gb.FeatureLayerView(Pa.RefreshableLayerView(db.LayerView2D(hb)))))});