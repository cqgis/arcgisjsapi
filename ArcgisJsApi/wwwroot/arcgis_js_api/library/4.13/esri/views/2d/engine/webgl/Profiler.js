// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/CircularArray ../../../../core/Evented ../../../../core/has ../../../../core/maybe ../../../webgl/capabilities/DisjointTimerQuery".split(" "),function(h,g,n,p,q,l,r){Object.defineProperty(g,"__esModule",{value:!0});var e=q("esri-2d-profiler");h=function(){function b(a,b){var c=this;this._events=new p;this._entries=new Map;this._timings=new n.default(10);if(e){this._ext=r.load(a.gl,{});this._debugOutput=b;var d=a.gl;if(this.enableCommandLogging){a=function(a){if("function"===
typeof d[a]){var b=d[a],k=-1!==a.indexOf("draw");d[a]=function(){for(var e=[],f=0;f<arguments.length;f++)e[f]=arguments[f];c._events.emit("command",{container:c._currentContainer,pass:c._currentPass,brush:c._currentBrush,method:a,args:e,isDrawCommand:k});c._currentSummary&&(c._currentSummary.commands++,k&&c._currentSummary.drawCommands++);return b.apply(d,e)}}};for(var k in d)a(k)}}}Object.defineProperty(b.prototype,"enableCommandLogging",{get:function(){return!("object"===typeof e&&e.disableCommands)},
enumerable:!0,configurable:!0});b.prototype.recordContainerStart=function(a){e&&(this._currentContainer=a)};b.prototype.recordContainerEnd=function(a){e&&(this._currentContainer=null)};b.prototype.recordPassStart=function(a){e&&(this._currentPass=a,this._initSummary())};b.prototype.recordPassEnd=function(a){e&&(this._currentPass=null,this._emitSummary())};b.prototype.recordBrushStart=function(a){e&&(this._currentBrush=a)};b.prototype.recordBrushEnd=function(a){e&&(this._currentBrush=null)};b.prototype.recordStart=
function(a){if(e&&l.isSome(this._ext)){if(this._entries.has(a)){var b=this._entries.get(a),c=this._ext.resultAvailable(b.query),d=this._ext.disjoint();if(c&&!d){c=this._ext.getResult(b.query)/1E6;d=0;if(l.isSome(this._timings.enqueue(c))){for(var d=this._timings.entries,h=d.length,g=0,m=0;m<d.length;m++)g+=d[m];d=g/h}c=c.toFixed(2);d=d?d.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed("Frame report for "+a+", "+c+" ms ("+d+" last 10 avg)\n"+b.commandsLen+" Commands ("+b.drawCommands+
" draw)"),console.log("RenderPass breakdown: "),console.table(b.summaries),console.log("Commands: ",b.commands),console.groupEnd()):console.log("Frame report for "+a+", "+c+" ms ("+d+" last 10 avg)");this._debugOutput.innerHTML=c+" ("+d+")"}c=0;for(b=b.handles;c<b.length;c++)b[c].remove();this._entries.delete(a)}var f={name:a,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(f.handles.push(this._events.on("command",function(a){f.commandsLen++;
f.commands.push(a);a.isDrawCommand&&f.drawCommands++})),f.handles.push(this._events.on("summary",function(a){delete a.target;f.summaries.push(a)})));this._ext.beginTimeElapsed(f.query);this._entries.set(a,f)}};b.prototype.recordEnd=function(a){e&&l.isSome(this._ext)&&this._entries.has(a)&&this._ext.endTimeElapsed()};b.prototype._initSummary=function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})};b.prototype._emitSummary=
function(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)};return b}();g.Profiler=h});