// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
require({cache:{"esri/renderers/support/heatmapUtils":function(){define(["require","exports","../../core/global","../../core/mathUtils"],function(h,b,n,e){function q(a,c,d,k,f){a=new Uint32Array(a*a);c="buffer"in c?c:new Float64Array(c);d="buffer"in d?new Uint32Array(d.buffer):new Uint32Array((new Uint8Array(d)).buffer);f=d.length/(f-k);for(var b=0;b<c.length;b++)a[b]=d[e.clamp(Math.floor((c[b]-k)*f),0,d.length-1)];return a.buffer}function l(a){for(var c=Math.round(3*a),d=2*a*a,b=new Float64Array(2*
c+1),f=0;f<=b.length;f++)b[f]=Math.exp(-Math.pow(f-c,2)/d)/Math.sqrt(2*Math.PI)*(a/2);return b}function v(a,c){return"function"===typeof a?a:a?"string"===typeof c?function(c){return-1*+c[a]}:function(d){return+d[a]+c}:function(a){return 1}}Object.defineProperty(b,"__esModule",{value:!0});b.generateGradient=function(){if(!("document"in n))return function(a){return null};var a=document.createElement("canvas"),c=a.getContext("2d");a.height=512;a.width=1;return function(d){c.clearRect(0,0,1,a.height);
var b=c.createLinearGradient(0,0,0,a.height),f=0;for(d=d.colorStops;f<d.length;f++){var e=d[f],p=e.color;b.addColorStop(Math.max(e.ratio,.001),"rgba("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+")")}c.fillStyle=b;c.fillRect(0,0,1,a.height);return c.getImageData(0,0,1,a.height).data}}();b.calculateHeatmapIntensityInfo=function(a,c,d,b){var f=c.blurRadius,e=c.fieldOffset,p=c.field;c=new Float64Array(d*b);for(var g=l(f),f=Math.round(3*f),m=Number.NEGATIVE_INFINITY,r,e=v(p,e),p=0;p<a.length;p++){var w=a[p],k=
w.geometry,x=k.x-f,h=k.y-f,n=Math.max(0,x);r=Math.max(0,h);for(var q=Math.min(b,k.y+f),k=Math.min(d,k.x+f),w=+e(w.attributes),t=r;t<q;t++)for(var z=g[t-h],u=n;u<k;u++)r=c[t*d+u]+=z*g[u-x]*w,r>m&&(m=r)}return{matrix:c.buffer,max:m}};b.drawHeatmap=function(a,c,b,e,f,h){a.canvas.width=a.canvas.height=c;a.clearRect(0,0,c,c);var d=a.getImageData(0,0,c,c);b&&e&&d.data.set(new Uint8ClampedArray(q(c,b,e,f,h)));a.putImageData(d,0,0)};b.createHeatmapImageData=q;b.createKernel=l;b.createValueFunction=v})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators".split(" "),
function(h,b,n,e,q,l){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function a(a){a=b.call(this,a)||this;a.tiles=new Map;return a}n(a,b);a.prototype.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.tiles=null};Object.defineProperty(a.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!0,configurable:!0});a.prototype.acquireTile=function(a){var c=this,b=this.createTile(a);b.once("isReady",function(){return c.notifyChange("updating")});
this.tiles.set(a.id,b);return b};a.prototype.lockAttributeTextureUpload=function(){};a.prototype.unlockAttributeTextureUpload=function(){};a.prototype.forceAttributeTextureUpload=function(){};a.prototype.forEachTile=function(a){this.tiles.forEach(a)};a.prototype.releaseTile=function(a){this.tiles.delete(a.key.id);this.disposeTile(a)};a.prototype.isUpdating=function(){var a=!0;this.tiles.forEach(function(b){a=a&&b.isReady});return!a};a.prototype.setHighlight=function(a,b){};a.prototype.invalidateLabels=
function(){};a.prototype.requestUpdate=function(){this.layerView.requestUpdate()};e([l.property()],a.prototype,"layer",void 0);e([l.property()],a.prototype,"layerView",void 0);e([l.property()],a.prototype,"tileInfoView",void 0);e([l.property()],a.prototype,"updating",null);return a=e([l.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],a)}(l.declared(q.HandleOwner));b.default=h})},"esri/views/2d/layers/features/tileRenderers/support/HeatmapSource":function(){define(["require",
"exports","../../../../../../renderers/support/heatmapUtils"],function(h,b,n){Object.defineProperty(b,"__esModule",{value:!0});h=function(){function b(){this.gradient=null;this.width=this.height=512}b.prototype.render=function(b){n.drawHeatmap(b,512,this.intensities,this.gradient,this.minPixelIntensity,this.maxPixelIntensity)};return b}();b.HeatmapSource=h})},"*noref":1}});
define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/Error ../../../../../core/Logger ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators ../../../../../renderers/support/heatmapUtils ../../../engine/BitmapTileContainer ./BaseTileRenderer ./support/HeatmapSource".split(" "),function(h,b,n,e,q,l,v,a,c,d,k,f){Object.defineProperty(b,"__esModule",{value:!0});var y=l.getLogger("esri.2d.layers.features.tileRenderers.HeatmapTileRenderer");
h=function(b){function g(a){var c=b.call(this,a)||this;c.featuresView={attributeView:{initialize:function(){},requestUpdate:function(){}}};var m=a.layerView.clips;c.container=new d.BitmapTileContainer(a.tileInfoView,a.layerView.clips);c.handles.add([m.on("change",function(){return c.container.setClips(m)})]);return c}e(g,b);Object.defineProperty(g.prototype,"gradient",{get:function(){return c.generateGradient(this.renderer.toJSON())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"renderer",{get:function(){var a=this.layer.renderer.type;return"heatmap"!==this.layer.renderer.type?(y.error(q("mapview-bad-type","Found invalid type "+a+" for renderer")),null):this.layer.renderer},enumerable:!0,configurable:!0});g.prototype.createTile=function(a){var b=this.container.createTile(a);this.tileInfoView.getTileCoords(b.bitmap,a);b.bitmap.resolution=this.tileInfoView.getTileResolution(a);return b};g.prototype.onConfigUpdate=function(){var a=this.renderer,b=a.minPixelIntensity,c=a.maxPixelIntensity,
d=this.gradient;this.tiles.forEach(function(a){var m=a.bitmap.source;m&&(m.minPixelIntensity=b,m.maxPixelIntensity=c,m.gradient=d,a.bitmap.invalidateTexture())})};g.prototype.hitTest=function(a,b){return v.resolve([])};g.prototype.install=function(a){a.addChild(this.container)};g.prototype.uninstall=function(a){this.container.removeAllChildren();a.removeChild(this.container)};g.prototype.disposeTile=function(a){this.container.removeChild(a);a.destroy()};g.prototype.supportsRenderer=function(a){return a&&
"heatmap"===a.type};g.prototype.onTileData=function(a){var b=this.tiles.get(a.tileKey);if(b){a=a.intensityInfo;var c=this.renderer,d=c.minPixelIntensity,c=c.maxPixelIntensity,e=b.bitmap.source||new f.HeatmapSource;e.intensities=a&&a.matrix||null;e.minPixelIntensity=d;e.maxPixelIntensity=c;e.gradient=this.gradient;b.bitmap.source=e;this.container.addChild(b);this.requestUpdate()}};g.prototype.onTileError=function(a){console.error(a)};n([a.property({readOnly:!0,dependsOn:["layer.renderer"]})],g.prototype,
"gradient",null);return g=n([a.subclass("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],g)}(a.declared(k.default));b.default=h});