// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/iteratorUtils ../../../../../core/maybe ../definitions ./Effect".split(" "),function(g,m,q,u,v,h,w){Object.defineProperty(m,"__esModule",{value:!0});g=function(d){function b(){var a=null!==d&&d.apply(this,arguments)||this;a.name=a.constructor.name;a.defines=["id"];a._buf=new Uint8Array(4*h.HITTEST_SEARCH_SIZE*h.HITTEST_SEARCH_SIZE);a._buf32=new Uint32Array(a._buf.buffer);return a}q(b,d);b.prototype.destroy=function(){v.isSome(this._fbo)&&
this._fbo.dispose()};b.prototype.bind=function(a){var c=a.context;a=a.painter;var b=c.getViewport();a=a.getFbos(c,b.width,b.height).effect0;c.bindFramebuffer(a);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT)};b.prototype.unbind=function(a){};b.prototype.draw=function(a,b){var c=this,d=a.state,g=a.pixelRatio,e=h.HITTEST_SEARCH_SIZE,m=a.context.getBoundFramebufferObject(),q=d.size[1],r=e/2,t=e/2;b.forEach(function(a,d){var f=new Map;m.readPixels(Math.floor((d[0]-h.HITTEST_SEARCH_SIZE/2)*g),
Math.floor((q-d[1]-h.HITTEST_SEARCH_SIZE/2)*g),e,e,6408,5121,c._buf);for(var k=0;k<c._buf32.length;k++){var l=c._buf32[k];if(4294967295!==l&&0!==l){var n=k%e,p=e-Math.floor(k/e),n=(r-n)*(r-n)+(t-p)*(t-p),p=f.has(l)?f.get(l):4294967295;f.set(l,Math.min(n,p))}}f=u.pairsOfMap(f).sort(function(a,b){return a[1]-b[1]}).map(function(a){return a[0]});a.resolve(f);b.delete(d)})};return b}(w.Effect);m.HittestEffect=g});