// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/cim/cimAnalyzer ./WGLMeshTemplate".split(" "),function(d,e,m,n,h,p,q){Object.defineProperty(e,"__esModule",{value:!0});var k=n.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");d=function(d){function f(c){var a=d.call(this)||this;a._ongoingMaterialRequestMap=new Map;a._materialCache=new Map;a._dynamicPropertyMap=new Map;a._cimLayer=
c;return a}m(f,d);f.prototype.analyze=function(c,a,d,f){var e=this,g=this._materialCache,l=this._cimLayer.materialHash;if(!l)return k.error("A Dynamic mesh template must have a material hash function!"),h.reject(null);var b=l(a,d,f);if(g.has(b))return c=g.get(b),h.resolve(c);if(this._ongoingMaterialRequestMap.has(b))return this._ongoingMaterialRequestMap.get(b);a=p.analyzeCIMResource(a,this._cimLayer.cim,this._cimLayer.materialOverrides);a.mosaicHash=b;c=c.getCIMMosaicItem(a).then(function(a){e._ongoingMaterialRequestMap.delete(b);
g.set(b,a);return a}).catch(function(a){e._ongoingMaterialRequestMap.delete(b);k.error(".analyze()",a.message);return null});this._ongoingMaterialRequestMap.set(b,c);return c};return f}(q.default);e.default=d});