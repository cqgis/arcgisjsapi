// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(F,A,v){function h(a,d){a=Math.min(Math.max(a,-100),100);d=Math.min(Math.max(d,-100),100);var g,m,b=new Uint8Array(256);for(g=0;256>g;g++)0<a&&100>a?m=(200*g-25500+510*d)/(2*(100-a))+128:0>=a&&-100<a?m=(200*g-25500+510*d)*(100+a)/2E4+128:100===a?(m=200*g-25500+256*(100-a)+510*d,m=0<m?255:0):-100===a&&(m=128),b[g]=255<m?255:0>m?0:m;return b}function q(a,d,g,m,b,w,f,c){return{xmin:b<=
g*a?0:b<g*a+a?b-g*a:a,ymin:w<=m*d?0:w<m*d+d?w-m*d:d,xmax:b+f<=g*a?0:b+f<g*a+a?b+f-g*a:a,ymax:w+c<=m*d?0:w+c<m*d+d?w+c-m*d:d}}var t=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length},n={createColormapLUT:function(a){if(a){var d=a.colormap;if(d&&0!==d.length){var d=d.sort(function(a,f){return a[0]-f[0]}),g=0;0>d[0][0]&&(g=d[0][0]);var m=Math.max(256,d[d.length-1][0]-g+1),b=new Uint8Array(4*m),w=[],f=0,c=0,l=5===d[0].length;if(65536<m)return d.forEach(function(a){w[a[0]-
g]=l?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:w,offset:g,alphaSpecified:l};if(a.fillUnspecified)for(a=d[c],f=a[0]-g;f<m;f++)b[4*f]=a[1],b[4*f+1]=a[2],b[4*f+2]=a[3],b[4*f+3]=l?a[4]:255,f===a[0]-g&&(a=c===d.length-1?a:d[++c]);else for(f=0;f<d.length;f++)a=d[f],c=4*(a[0]-g),b[c]=a[1],b[c+1]=a[2],b[c+2]=a[3],b[c+3]=l?a[4]:255;return{indexedColormap:b,offset:g,alphaSpecified:l}}}},createContrastBrightnessLUT:h,createStretchLUT:function(a){var d=a.minCutOff,g=a.maxCutOff,m=a.gamma,b=a.pixelType,
w=a.outMin||0,f=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(b))return null;var c=d.length,l,k=0;"s8"===b?k=-127:"s16"===b&&(k=-32767);var e=256;-1<["u16","s16"].indexOf(b)&&(e=65536);for(var p=[],r=f-w,b=0;b<c;b++)p[b]=g[b]-d[b];l=m&&m.length>=c;var u=[];if(l)for(b=0;b<c;b++)u[b]=1<m[b]?2<m[b]?6.5+Math.pow(m[b]-2,2.5):6.5+100*Math.pow(2-m[b],4):1;var n,y=[],x,z,q;if(l)for(b=0;b<c;b++){q=[];for(l=0;l<e;l++)x=l+k,n=(x-d[b])/p[b],z=1,1<m[b]&&(z-=Math.pow(1/r,n*u[b])),q[l]=x<g[b]&&x>d[b]?Math.floor(z*
r*Math.pow(n,1/m[b]))+w:x>=g[b]?f:w;y[b]=q}else for(b=0;b<c;b++){q=[];for(l=0;l<e;l++)x=l+k,q[l]=x<=d[b]?w:x>=g[b]?f:Math.floor((x-d[b])/p[b]*r)+w;y[b]=q}if(null!=a.contrastOffset)for(a=h(a.contrastOffset,a.brightnessOffset),b=0;b<c;b++)for(q=y[b],l=0;l<e;l++)q[l]=a[q[l]];return{lut:y,offset:k}},colorize:function(a,d){if(!t(a)||!d&&(d.indexedColormap||d.indexed2DColormap))return a;var g=a.clone(),m=g.pixels,b=g.mask,w=g.width*g.height;if(1!==m.length)return a;var f=d.indexedColormap;a=d.indexed2DColormap;
var c=d.offset;d=d.alphaSpecified;var l=f.length-1,k=0,m=m[0],e=new Uint8Array(m.length),p=new Uint8Array(m.length),r=new Uint8Array(m.length),u=0;if(f)if(b)for(k=0;k<w;k++)b[k]&&(u=4*(m[k]-c),u<c||u>l?b[k]=0:(e[k]=f[u],p[k]=f[u+1],r[k]=f[u+2],b[k]=f[u+3]));else{b=new Uint8Array(w);for(k=0;k<w;k++)u=4*(m[k]-c),u<c||u>l?b[k]=0:(e[k]=f[u],p[k]=f[u+1],r[k]=f[u+2],b[k]=f[u+3]);g.mask=b}else if(b)for(k=0;k<w;k++)b[k]&&(f=a[m[k]],e[k]=f[0],p[k]=f[1],r[k]=f[2],b[k]=f[3]);else{b=new Uint8Array(w);for(k=0;k<
w;k++)f=a[m[k]],e[k]=f[0],p[k]=f[1],r[k]=f[2],b[k]=f[3];g.mask=b}g.pixels=[e,p,r];g.statistics=null;g.pixelType="u8";g.maskIsAlpha=d;return g},estimateStatisticsHistograms:function(a){if(!t(a))return null;var d=a.pixels,g=a.mask,m=a.pixelType,b=a.statistics;a=a.width*a.height;var w=d.length,f,c,l,k,e,p=[],r=[],u,h,y;for(k=0;k<w;k++){u=new Uint32Array(256);y=d[k];if("u8"===m)if(f=-.5,c=255.5,g)for(e=0;e<a;e++)g[e]&&u[y[e]]++;else for(e=0;e<a;e++)u[y[e]]++;else{f=b[k].minValue;c=b[k].maxValue;l=(c-
f)/256;h=new Uint32Array(257);if(g)for(e=0;e<a;e++)g[e]&&h[Math.floor((y[e]-f)/l)]++;else for(e=0;e<a;e++)h[Math.floor((y[e]-f)/l)]++;for(e=0;255>e;e++)u[e]=h[e];u[255]=h[255]+h[256]}p.push({min:f,max:c,size:256,counts:u});for(e=y=h=l=0;256>e;e++)l+=u[e],h+=e*u[e];h/=l;for(e=0;256>e;e++)y+=u[e]*Math.pow(e-h,2);u=Math.sqrt(y/(l-1));l=(c-f)/256;e=(h+.5)*l+f;u*=l;r.push({min:f,max:c,avg:e,stddev:u})}return{statistics:r,histograms:p}},extractBands:function(a,d){return!d||!t(a)||d&&d.some(function(d){return d>
a.pixels.length})?a:new v({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:d.map(function(d){return a.pixels[d]}),statistics:a.statistics&&d.map(function(d){return a.statistics[d]})})},stretch:function(a,d){if(!t(a))return null;a=a.clone();var g=a.pixels,m=a.mask,b=d.minCutOff,h=d.maxCutOff,f=d.gamma,c=d.outMin||0;d=d.outMax||255;var l=a.width*a.height,k=g.length,e,p,r,u,n,y=d-c,x=[];for(e=0;e<k;e++)x[e]=h[e]-b[e];
p=f&&f.length>=k;var z=[];if(p)for(e=0;e<k;e++)z[e]=1<f[e]?2<f[e]?6.5+Math.pow(f[e]-2,2.5):6.5+100*Math.pow(2-f[e],4):1;if(p)if(null!=m)for(p=0;p<l;p++){if(m[p])for(e=0;e<k;e++)r=g[e][p],n=(r-b[e])/x[e],u=1,1<f[e]&&(u-=Math.pow(1/y,n*z[e])),g[e][p]=r<h[e]&&r>b[e]?Math.floor(u*y*Math.pow(n,1/f[e]))+c:r>=h[e]?d:c}else for(p=0;p<l;p++)for(e=0;e<k;e++)r=g[e][p],n=(r-b[e])/x[e],u=1,1<f[e]&&(u-=Math.pow(1/y,n*z[e])),g[e][p]=r<h[e]&&r>b[e]?Math.floor(u*y*Math.pow(n,1/f[e]))+c:r>=h[e]?d:c;else if(null!=m)for(p=
0;p<l;p++){if(m[p])for(e=0;e<k;e++)r=g[e][p],g[e][p]=r<h[e]&&r>b[e]?Math.floor((r-b[e])/x[e]*y)+c:r>=h[e]?d:c}else for(p=0;p<l;p++)for(e=0;e<k;e++)r=g[e][p],g[e][p]=r<h[e]&&r>b[e]?Math.floor((r-b[e])/x[e]*y)+c:r>=h[e]?d:c;a.pixelType="u8";a.updateStatistics();return a},lookupPixels:function(a,d){if(!t(a))return null;var g=a.pixels,m=a.mask,b=a.width*a.height,h=g.length,f=d.lut;d=d.offset;var c,l;f&&1===f[0].length&&(f=g.map(function(a){return f}));var k=[],e,p,r;if(d)if(null==m)for(c=0;c<h;c++){e=
g[c];p=f[c];r=new Uint8Array(b);for(l=0;l<b;l++)r[l]=p[e[l]-d];k.push(r)}else for(c=0;c<h;c++){e=g[c];p=f[c];r=new Uint8Array(b);for(l=0;l<b;l++)m[l]&&(r[l]=p[e[l]-d]);k.push(r)}else if(null==m)for(c=0;c<h;c++){e=g[c];p=f[c];r=new Uint8Array(b);for(l=0;l<b;l++)r[l]=p[e[l]];k.push(r)}else for(c=0;c<h;c++){e=g[c];p=f[c];r=new Uint8Array(b);for(l=0;l<b;l++)m[l]&&(r[l]=p[e[l]]);k.push(r)}a=new v({width:a.width,height:a.height,pixels:k,mask:m,pixelType:"u8"});a.updateStatistics();return a},remapColor:function(a,
d){if(!t(a))return null;a=a.clone();var g=a.width*a.height,m=d.length,b=Math.floor(m/2),h=d[Math.floor(b)],f=a.pixels[0],c,l,k,e,p,r,u=!1,n=new Uint8Array(g),y=new Uint8Array(g),x=new Uint8Array(g),z=a.mask,q=4===d[0].mappedColor.length;z||(z=new Uint8Array(g),z.fill(q?255:1),a.mask=z);for(p=0;p<g;p++)if(z[p]){c=f[p];u=!1;r=b;l=h;k=0;for(e=m-1;1<e-k;){if(c===l.value){u=!0;break}c>l.value?k=r:e=r;r=Math.floor((k+e)/2);l=d[Math.floor(r)]}u||(c===d[k].value?(l=d[k],u=!0):c===d[e].value?(l=d[e],u=!0):
c<d[k].value?(u=!1,l=null):c>d[k].value&&(c<d[e].value?(l=d[k],u=!0):e===m-1?(u=!1,l=null):(l=d[e],u=!0)));u?(n[p]=l.mappedColor[0],y[p]=l.mappedColor[1],x[p]=l.mappedColor[2],z[p]=l.mappedColor[3]):n[p]=y[p]=x[p]=z[p]=0}a.pixels=[n,y,x];a.mask=z;a.pixelType="u8";a.maskIsAlpha=q;return a},mosaic:function(a,d,g,m){var b=a.filter(function(a){return t(a)})[0];if(null==b)return null;var h=m?m.width:d.width;m=m?m.height:d.height;var f=b.width,c=b.height,l=d.width/f;d=d.height/c;var k=g?g.x:0;g=g?g.y:0;
var e=b.getPixelArrayConstructor(b.pixelType),p=b.pixels.length,b=[],r,u,n,y,x,z,E,C,D,B;for(x=0;x<p;x++){u=new e(h*m);for(z=0;z<d;z++)for(E=0;E<l;E++)if(n=a[z*l+E])for(r=n.pixels[x],B=q(f,c,E,z,k,g,h,m),C=B.ymin;C<B.ymax;C++)for(n=(z*c+C-g)*h+(E*f-k),y=C*f,D=B.xmin;D<B.xmax;D++)u[n+D]=r[y+D];b.push(u)}var G;if(a.some(function(a){return a&&a.mask&&0<a.mask.length}))for(G=new Uint8Array(h*m),z=0;z<d;z++)for(E=0;E<l;E++)if(e=(n=a[z*l+E])?n.mask:null,B=q(f,c,E,z,k,g,h,m),e)for(C=B.ymin;C<B.ymax;C++)for(n=
(z*c+C-g)*h+(E*f-k),y=C*f,D=B.xmin;D<B.xmax;D++)G[n+D]=e[y+D];else if(n)for(C=B.ymin;C<B.ymax;C++)for(n=(z*c+C-g)*h+(E*f-k),y=C*f,D=B.xmin;D<B.xmax;D++)G[n+D]=1;else for(C=B.ymin;C<B.ymax;C++)for(n=(z*c+C-g)*h+(E*f-k),y=C*f,D=B.xmin;D<B.xmax;D++)G[n+D]=0;a=new v({width:h,height:m,pixels:b,mask:G});a.updateStatistics();return a},mosaicPixelData:function(a,d){if(!a||0===a.length)return null;var g=a.filter(function(a){return a.pixelBlock})[0];if(!g)return null;var h=(g.extent.xmax-g.extent.xmin)/g.pixelBlock.width,
b=(g.extent.ymax-g.extent.ymin)/g.pixelBlock.height,q=.01*Math.min(h,b),f=a.sort(function(a,f){return Math.abs(a.extent.ymax-f.extent.ymax)>q?f.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-f.extent.xmin)>q?a.extent.xmin-f.extent.xmin:0}),c=Math.min.apply(null,f.map(function(a){return a.extent.xmin})),l=Math.min.apply(null,f.map(function(a){return a.extent.ymin})),k=Math.max.apply(null,f.map(function(a){return a.extent.xmax})),e=Math.max.apply(null,f.map(function(a){return a.extent.ymax}));a={x:Math.round((d.xmin-
c)/h),y:Math.round((e-d.ymax)/b)};c={width:Math.round((k-c)/h),height:Math.round((e-l)/b)};h={width:Math.round((d.xmax-d.xmin)/h),height:Math.round((d.ymax-d.ymin)/b)};if(Math.round(c.width/g.pixelBlock.width)*Math.round(c.height/g.pixelBlock.height)!==f.length||0>a.x||0>a.y||c.width<h.width||c.height<h.height)return null;g=f.map(function(a){return a.pixelBlock});g=n.mosaic(g,c,a,h);return{extent:d,pixelBlock:g}}};return n})},"esri/layers/support/PixelBlock":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),
function(F,A,v,h,q,t,n,a,d){var g=a.getLogger("esri.layers.support.PixelBlock");return function(a){function b(f){f=a.call(this)||this;f.width=null;f.height=null;f.pixelType="f32";f.validPixelCount=null;f.mask=null;f.maskIsAlpha=!1;f.pixels=null;f.statistics=null;return f}v(b,a);m=b;b.prototype.castPixelType=function(a){if(!a)return"f32";a=a.toLowerCase();-1<["u1","u2","u4"].indexOf(a)?a="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(a)&&(a="f32");return a};b.prototype.getPlaneCount=
function(){return this.pixels&&this.pixels.length};b.prototype.addData=function(a){if(!a.pixels||a.pixels.length!==this.width*this.height)throw new q("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(a.pixels);this.statistics.push(a.statistics||{minValue:null,maxValue:null})};b.prototype.getAsRGBA=function(){var a=new ArrayBuffer(this.width*
this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(a);break;default:this._fillFrom8Bit(a)}return new Uint8ClampedArray(a)};b.prototype.getAsRGBAFloat=function(){var a=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(a);return a};b.prototype.updateStatistics=function(){var a=this;this.statistics=this.pixels.map(function(c){return a._calculateBandStatistics(c,a.mask)});var c=this.mask,l=0;if(c)for(var k=
0;k<c.length;k++)c[k]&&l++;else l=this.width*this.height;this.validPixelCount=l};b.prototype.clamp=function(a){if(a&&"f64"!==a&&"f32"!==a){var c;switch(a){case "u8":c=[0,255];break;case "u16":c=[0,65535];break;case "u32":c=[0,4294967295];break;case "s8":c=[-128,127];break;case "s16":c=[-32768,32767];break;case "s32":c=[-2147483648,2147483647];break;default:c=[-3.4*1E39,3.4*1E39]}var f=c[0];c=c[1];for(var k=this.pixels,e=this.width*this.height,b=k.length,d,g,h,n=[],x=0;x<b;x++){h=this._createEmptyBand(a,
e);d=k[x];for(var m=0;m<e;m++)g=d[m],h[m]=g>c?c:g<f?f:g;n.push(h)}this.pixels=n;this.pixelType=a}};b.prototype.clone=function(){var a=new m({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(a.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var c,l=this.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){a.pixels=[];var k=this.pixels[0].slice;for(c=
0;c<this.pixels.length;c++)a.pixels[c]=k?this.pixels[c].slice(0,this.pixels[c].length):new l(this.pixels[c])}if(this.statistics)for(a.statistics=[],c=0;c<this.statistics.length;c++)a.statistics[c]=n.clone(this.statistics[c]);return a};b.prototype.getPixelArrayConstructor=function(a){switch(a){case "u8":a=Uint8Array;break;case "u16":a=Uint16Array;break;case "u32":a=Uint32Array;break;case "s8":a=Int8Array;break;case "s16":a=Int16Array;break;case "s32":a=Int32Array;break;case "u32":a=Uint32Array;break;
case "f32":a=Float32Array;break;case "f64":a=Float64Array;break;default:a=Float32Array}return a};b.prototype._createEmptyBand=function(a,c){return new (this.getPixelArrayConstructor(a))(c)};b.prototype._fillFrom8Bit=function(a){var c=this.mask,l=this.maskIsAlpha,k=this.pixels;if(a&&k&&k.length){var e,b,d;e=b=d=k[0];3<=k.length?(b=k[1],d=k[2]):2===k.length&&(b=k[1]);a=new Uint32Array(a);k=this.width*this.height;if(e.length!==k)g.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");
else if(c&&c.length===k)if(l)for(l=0;l<k;l++)c[l]&&(a[l]=c[l]<<24|d[l]<<16|b[l]<<8|e[l]);else for(l=0;l<k;l++)c[l]&&(a[l]=-16777216|d[l]<<16|b[l]<<8|e[l]);else for(l=0;l<k;l++)a[l]=-16777216|d[l]<<16|b[l]<<8|e[l]}else g.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};b.prototype._fillFromNon8Bit=function(a){var c=this.pixels,b=this.mask,k=this.statistics;if(a&&c&&c.length){var e=this.pixelType,d=1,f=0,d=1;k&&0<k.length?(f=k.map(function(a){return a.minValue}).reduce(function(a,
c){return Math.min(a,c)}),d=k.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,c){return Math.max(a,c)}),d=255/d):(d=255,"s8"===e?(f=-128,d=127):"u16"===e?d=65535:"s16"===e?(f=-32768,d=32767):"u32"===e?d=4294967295:"s32"===e?(f=-2147483648,d=2147483647):"f32"===e?(f=-3.4*1E39,d=3.4*1E39):"f64"===e&&(f=-Number.MAX_VALUE,d=Number.MAX_VALUE),d=255/(d-f));a=new Uint32Array(a);var e=this.width*this.height,h,m,k=h=m=c[0];if(k.length!==e)return g.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");
if(2<=c.length)if(h=c[1],3<=c.length&&(m=c[2]),b&&b.length===e)for(c=0;c<e;c++)b[c]&&(a[c]=-16777216|(m[c]-f)*d<<16|(h[c]-f)*d<<8|(k[c]-f)*d);else for(c=0;c<e;c++)a[c]=-16777216|(m[c]-f)*d<<16|(h[c]-f)*d<<8|(k[c]-f)*d;else if(b&&b.length===e)for(c=0;c<e;c++)h=(k[c]-f)*d,b[c]&&(a[c]=-16777216|h<<16|h<<8|h);else for(c=0;c<e;c++)h=(k[c]-f)*d,a[c]=-16777216|h<<16|h<<8|h}else g.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};b.prototype._fillFrom32Bit=function(a){var c=
this.pixels,d=this.mask;if(!a||!c||!c.length)return g.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var b,e,f;b=e=f=c[0];3<=c.length?(e=c[1],f=c[2]):2===c.length&&(e=c[1]);var h=this.width*this.height;if(b.length!==h)return g.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var m=0;if(d&&d.length===h)for(c=0;c<h;c++)a[m++]=b[c],a[m++]=e[c],a[m++]=f[c],a[m++]=d[c]&1;else for(c=0;c<h;c++)a[m++]=b[c],a[m++]=e[c],a[m++]=f[c],a[m++]=
1};b.prototype._calculateBandStatistics=function(a,c){var d=Infinity,b=-Infinity,e=a.length,g,f=0;if(c)for(g=0;g<e;g++)c[g]&&(f=a[g],d=f<d?f:d,b=f>b?f:b);else for(g=0;g<e;g++)f=a[g],d=f<d?f:d,b=f>b?f:b;return{minValue:d,maxValue:b}};var m;h([d.property({json:{write:!0}})],b.prototype,"width",void 0);h([d.property({json:{write:!0}})],b.prototype,"height",void 0);h([d.property({json:{write:!0}})],b.prototype,"pixelType",void 0);h([d.cast("pixelType")],b.prototype,"castPixelType",null);h([d.property({json:{write:!0}})],
b.prototype,"validPixelCount",void 0);h([d.property({json:{write:!0}})],b.prototype,"mask",void 0);h([d.property({json:{write:!0}})],b.prototype,"maskIsAlpha",void 0);h([d.property({json:{write:!0}})],b.prototype,"pixels",void 0);h([d.property({json:{write:!0}})],b.prototype,"statistics",void 0);return b=m=h([d.subclass("esri.layers.support.PixelBlock")],b)}(d.declared(t.JSONSupport))})},"esri/views/2d/layers/BitmapLayerView2D":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ../engine/BitmapContainer".split(" "),
function(F,A,v,h,q,t){Object.defineProperty(A,"__esModule",{value:!0});A.BitmapLayerView2D=function(n){return function(a){function d(){var d=null!==a&&a.apply(this,arguments)||this;d.container=new t.BitmapContainer(d.clips);return d}h(d,a);d.prototype.initialize=function(){var a=this;this.handles.add(this.clips.on("change",function(){return a.container.setClips(a.clips)}))};return d=v([q.subclass("esri.views.2d.layers.BitmapLayerView2D")],d)}(q.declared(n))}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(F,A,v,h,q,t,n,a,d,g,m,b){Object.defineProperty(A,"__esModule",{value:!0});var w=q.ofType({key:"type",base:d,typeMap:{rect:g,path:b,geometry:m}});A.LayerView2D=function(d){return function(d){function b(){var a=null!==d&&d.apply(this,arguments)||this;a.clips=new w;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}v(b,d);b.prototype.initialize=function(){var a=this;this.when(function(){a.requestUpdate()},function(){});var b=function(){return a.notifyChange("rendering")};
this.handles.add([n.init(this,"suspended",function(b){a.container&&(a.container.visible=!b);a.view&&!b&&a.updateRequested&&a.view.requestLayerViewUpdate(a)},!0),n.init(this,"fullOpacity",function(b){a.container&&(a.container.opacity=b)},!0),n.on(this,"container","post-render",b),n.on(this,"container","will-render",b)])};b.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=null};Object.defineProperty(b.prototype,
"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});b.prototype.isVisibleAtScale=function(a){var b=!0,d=this.layer,c=d.minScale,d=d.maxScale;if(null!=c&&null!=d){var b=!c,f=!d;!b&&a<=c&&(b=!0);!f&&a>=d&&(f=!0);b=
b&&f}return b};b.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};b.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};b.prototype.isUpdating=function(){return!1};b.prototype.isRendering=function(){return!1};b.prototype.canResume=function(){var a=this.inherited(arguments);
a&&(a=this.isVisibleAtScale(this.view.scale));return a};h([a.property({type:w,set:function(a){a=t.referenceSetter(a,this._get("clips"),w);this._set("clips",a)}})],b.prototype,"clips",void 0);h([a.property()],b.prototype,"moving",void 0);h([a.property({dependsOn:["attached","suspended","moving"]})],b.prototype,"rendering",null);h([a.property()],b.prototype,"attached",void 0);h([a.property()],b.prototype,"container",void 0);h([a.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],
b.prototype,"suspended",void 0);h([a.property({readOnly:!0})],b.prototype,"updateParameters",void 0);h([a.property()],b.prototype,"updateRequested",void 0);h([a.property({dependsOn:["updateRequested","attached","suspended"]})],b.prototype,"updating",null);h([a.property()],b.prototype,"view",void 0);return b=h([a.subclass("esri.views.2d.layers.LayerView2D")],b)}(a.declared(d))}})},"esri/views/layers/support/ClipArea":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(F,A,v,h,q,t){return function(n){function a(){return null!==n&&n.apply(this,arguments)||this}h(a,n);return a=v([t.subclass("esri.views.layers.support.ClipArea")],a)}(t.declared(q.JSONSupport))})},"esri/views/layers/support/ClipRect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(F,A,v,h,q,t){return function(n){function a(){var a=null!==n&&n.apply(this,
arguments)||this;a.type="rect";a.left=null;a.right=null;a.top=null;a.bottom=null;return a}h(a,n);d=a;a.prototype.clone=function(){return new d({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var d;v([q.property({type:[Number,String],json:{write:!0}})],a.prototype,"left",void 0);v([q.property({type:[Number,String],json:{write:!0}})],a.prototype,"right",
void 0);v([q.property({type:[Number,String],json:{write:!0}})],a.prototype,"top",void 0);v([q.property({type:[Number,String],json:{write:!0}})],a.prototype,"bottom",void 0);v([q.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],a.prototype,"version",null);return a=d=v([q.subclass("esri.views.layers.support.ClipRect")],a)}(q.declared(t))})},"esri/views/layers/support/Geometry":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),
function(F,A,v,h,q,t,n,a,d){var g={base:n,key:"type",typeMap:{extent:q.Extent,polygon:q.Polygon}};return function(d){function b(){var a=null!==d&&d.apply(this,arguments)||this;a.type="geometry";a.geometry=null;return a}h(b,d);m=b;Object.defineProperty(b.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new m({geometry:this.geometry.clone()})};var m;v([t.property({types:g,json:{read:a.fromJSON,write:!0}})],b.prototype,
"geometry",void 0);v([t.property({readOnly:!0,dependsOn:["geometry"]})],b.prototype,"version",null);return b=m=v([t.subclass("esri.views.layers.support.Geometry")],b)}(t.declared(d))})},"esri/views/layers/support/Path":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(F,A,v,h,q,t){return function(n){function a(){var a=null!==n&&n.apply(this,arguments)||this;
a.type="path";a.path=[];return a}h(a,n);Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});v([q.property({type:[[[Number]]],json:{write:!0}})],a.prototype,"path",void 0);v([q.property({readOnly:!0,dependsOn:["path"]})],a.prototype,"version",null);return a=v([q.subclass("esri.views.layers.support.Path")],a)}(q.declared(t))})},"esri/views/2d/layers/support/ExportStrategy":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../engine ../../viewStateUtils ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(F,A,v,h,q,t,n,a,d,g,m,b,w,f,c,l,k,e){var p=b.create(),r=[0,0],u=new e(0,0,0,0);return function(a){function b(b){var c=a.call(this,b)||this;c._imagePromise=null;c.hidpi=!1;c.imageMaxWidth=2048;c.imageMaxHeight=2048;c.imageRotationSupported=!1;c.imageNormalizationSupported=!1;c.update=d.debounce(function(a){return q(c,void 0,void 0,function(){var b,c,e,f,g,k,m,n,x,p=this;return h(this,function(h){b=a.state;c=w.getInfo(b.spatialReference);e=this.hidpi?a.pixelRatio:1;if(!a.stationary||this.destroyed)return[2];
this.imageRotationSupported?(r[0]=b.size[0],r[1]=b.size[1]):l.getOuterSize(r,b);f=Math.floor(r[0]*e)>this.imageMaxWidth||Math.floor(r[1]*e)>this.imageMaxHeight;g=c&&(b.extent.xmin<c.valid[0]||b.extent.xmax>c.valid[1]);k=!this.imageNormalizationSupported&&g;m=!f&&!k;n=this.imageRotationSupported?b.rotation:0;m?this._imagePromise=this._singleExport(b,r,n,e):(x=Math.min(this.imageMaxWidth,this.imageMaxHeight),k&&(x=Math.min(b.worldScreenWidth,x)),this._imagePromise=this._tiledExport(b,x,n,e));return[2,
this._imagePromise.then(function(a){p._imagePromise=null;var b=p.container.children.slice();p.container.removeAllChildren();a.forEach(p.container.addChild,p.container);p.disposeSource&&b.forEach(function(a){p.disposeSource(a.source)},p)}).catch(function(a){p._imagePromise=null;if(!d.isAbortError(a))throw a;})]})})});return c}t(b,a);b.prototype.destroy=function(){};Object.defineProperty(b.prototype,"updating",{get:function(){return null!==this._imagePromise},enumerable:!0,configurable:!0});b.prototype.updateExports=
function(a){for(var b=0,d=this.container.children;b<d.length;b++){var c=d[b];if(!c.visible||!c.attached)break;a(c)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(c.invalidateTexture(),c.requestRender())}};b.prototype._export=function(a,b,e,f,g){var h=this;return d.resolve().then(function(){return h.fetchSource(a,Math.floor(b*g),Math.floor(e*g),{rotation:f,pixelRatio:g})}).then(function(d){d=new c.Bitmap(d);d.x=a.xmin;d.y=a.ymax;d.resolution=a.width/b;d.rotation=f;d.pixelRatio=
g;return d})};b.prototype._singleExport=function(a,b,d,c){l.getBBox(p,a.center,a.resolution,b);a=new m(p[0],p[1],p[2],p[3],a.spatialReference);return this._export(a,b[0],b[1],d,c).then(function(a){return[a]})};b.prototype._tiledExport=function(a,b,c,e){var g=this,h=f.create({size:b,spatialReference:a.spatialReference,scales:[a.scale]}),l=new k(h),h=l.getTileCoverage(a);if(!h)return null;var n=[];h.forEach(function(d,f,h,k){u.set(d,f,h,k);l.getTileBounds(p,u);d=new m(p[0],p[1],p[2],p[3],a.spatialReference);
n.push(g._export(d,b,b,c,e))});return d.all(n)};n([g.property()],b.prototype,"_imagePromise",void 0);n([g.property()],b.prototype,"container",void 0);n([g.property()],b.prototype,"disposeSource",void 0);n([g.property()],b.prototype,"fetchSource",void 0);n([g.property()],b.prototype,"hidpi",void 0);n([g.property()],b.prototype,"imageMaxWidth",void 0);n([g.property()],b.prototype,"imageMaxHeight",void 0);n([g.property()],b.prototype,"imageRotationSupported",void 0);n([g.property()],b.prototype,"imageNormalizationSupported",
void 0);n([g.property()],b.prototype,"requestUpdate",void 0);n([g.property({dependsOn:["_imagePromise"]})],b.prototype,"updating",null);return b=n([g.subclass("esri.views.2d.layers.support.ExportStrategy")],b)}(g.declared(a))})},"esri/views/2d/viewStateUtils":function(){define(["require","exports"],function(F,A){Object.defineProperty(A,"__esModule",{value:!0});var v=Math.PI/180;A.snapToPixel=function(h,q,t){var n=t.resolution;t=t.size;h[0]=n*(Math.round(q[0]/n)+t[0]%2*.5);h[1]=n*(Math.round(q[1]/
n)+t[1]%2*.5);return h};A.getOuterSize=function(h,q){var t=q.rotation*v,n=Math.abs(Math.cos(t)),t=Math.abs(Math.sin(t)),a=q.size;q=a[0];a=a[1];h[0]=Math.round(a*t+q*n);h[1]=Math.round(a*n+q*t);return h};A.getBBox=function(h,q,t,n){var a=q[0];q=q[1];var d=n[0];n=n[1];t*=.5;h[0]=a-t*d;h[1]=q-t*n;h[2]=a+t*d;h[3]=q+t*n;return h};A.bboxIntersects=function(h,q){var t=h[1],n=h[2],a=h[3],d=q[0],g=q[1],m=q[3];return!(h[0]>q[2]||n<d||t>m||a<g)}})},"esri/views/layers/ImageryLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../layers/support/timeUtils ../../tasks/support/Query ./support/popupUtils".split(" "),
function(F,A,v,h,q,t,n,a,d,g,m,b,w,f){Object.defineProperty(A,"__esModule",{value:!0});A.ImageryLayerView=function(c){return function(c){function k(){var a=null!==c&&c.apply(this,arguments)||this;a.view=null;return a}v(k,c);k.prototype.fetchPopupFeatures=function(b,c){return t(this,void 0,void 0,function(){var e,g,h,k,l,p,t,v,A,B,G;return q(this,function(q){switch(q.label){case 0:e=this.layer;if(!b)return[2,d.reject(new n("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:e}))];
g=e.popupEnabled;h=f.getFetchPopupTemplate(e,c);if(!g||!a.isSome(h))throw new n("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:g,popupTemplate:h});return[4,h.getRequiredFields()];case 1:return k=q.sent(),l=new w,l.geometry=b,l.outFields=k,l.outSpatialReference=b.spatialReference,p=this.view.resolution,t="2d"===this.view.type?new m(p,p,this.view.spatialReference):new m(.5*p,.5*p,this.view.spatialReference),v=h.layerOptions||{returnTopmostRaster:!0,
showNoDataRecords:!1},A=v.returnTopmostRaster,B=v.showNoDataRecords,G={returnDomainValues:!0,returnTopmostRaster:A,pixelSize:t,showNoDataRecords:B},[2,e.queryVisibleRasters(l,G).then(function(a){return a})]}})})};h([g.property()],k.prototype,"layer",void 0);h([g.property()],k.prototype,"view",void 0);h([g.property(b.combinedViewLayerTimeExtentProperty)],k.prototype,"timeExtent",void 0);return k=h([g.subclass("esri.views.layers.ImageryLayerView")],k)}(g.declared(c))}})},"esri/views/layers/support/popupUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),
function(F,A,v,h,q,t,n){Object.defineProperty(A,"__esModule",{value:!0});A.getRequiredFields=function(a,d){void 0===d&&(d=a.popupTemplate);return h(this,void 0,void 0,function(){var g,h,b,w,f,c,l,k,e,p,r;return v(this,function(m){switch(m.label){case 0:return t.isSome(d)?[4,d.getRequiredFields(a.fields)]:[2,[]];case 1:g=m.sent();h=d.lastEditInfoEnabled;b=a.objectIdField;w=a.typeIdField;if(q.includes(g,"*"))return[2,["*"]];c=n.fixFields;l=[a.fields];e=(k=g).concat;p=[[w]];return(r=h)?[4,n.getFeatureEditFields(a)]:
[3,3];case 2:r=m.sent(),m.label=3;case 3:return(f=c.apply(void 0,l.concat([e.apply(k,p.concat([r||null]))])))&&b&&n.hasField(a.fields,b)&&-1===f.indexOf(b)&&f.push(b),[2,f]}})})};A.getFetchPopupTemplate=function(a,d){return a.popupTemplate?a.popupTemplate:t.isSome(d)&&d.defaultPopupTemplateEnabled&&t.isSome(a.defaultPopupTemplate)?a.defaultPopupTemplate:null}})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/Logger ../../../core/promiseUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/rasterFunctions/pixelUtils ../engine/ImageryBitmapSource ./BitmapLayerView2D ./LayerView2D ./support/ExportStrategy ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(F,
A,v,h,q,t,n,a,d,g,m,b,w,f,c,l,k,e,p,r){var u=a.getLogger("esri.views.2d.layers.ImageryLayerView2D");return function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._exportImageVersion=-1;return b}v(c,a);Object.defineProperty(c.prototype,"pixelData",{get:function(){if(this.updating)return null;var a=this.strategy.container.children;if(1===a.length&&a[0].source)return{extent:a[0].source.extent,pixelBlock:a[0].source.originalPixelBlock};if(1<a.length){var b=this.view.extent,a=a.map(function(a){return a.source}).filter(function(a){return a.extent&&
a.extent.intersects(b)}).map(function(a){return{extent:a.extent,pixelBlock:a.originalPixelBlock}});return(a=w.mosaicPixelData(a,b))?{extent:a.extent,pixelBlock:a.pixelBlock}:null}return null},enumerable:!0,configurable:!0});c.prototype.hitTest=function(a,b){if(this.suspended)return d.resolve(null);a=this.view.toMap(g.createScreenPoint(a,b));return d.resolve(new n({attributes:{},geometry:a}))};c.prototype.update=function(a){this.strategy.update(a)};c.prototype.attach=function(){var a=this;this.layer.increaseRasterJobHandlerUsage();
this.strategy=new k({container:this.container,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this.fetchImage.bind(this),requestUpdate:function(){return a.requestUpdate()}});this.handles.add([m.init(this,"layer.exportImageServiceParameters.version",function(b){a._exportImageVersion!==b&&(a._exportImageVersion=b,a.requestUpdate())}),this.watch("timeExtent",
function(){return a.requestUpdate()}),this.layer.on("redraw",function(){a.strategy.updateExports(function(b){b.source instanceof HTMLImageElement?b.requestRender():a.layer.applyRenderer({pixelBlock:b.source.pixelBlock}).then(function(c){var d=b.source;d.pixelBlock=c.pixelBlock;d.filter=function(b){return a.layer.applyFilter(b)};a.container.requestRender()})})})],"imagerylayerview-update")};c.prototype.detach=function(){this.layer.decreaseRasterJobHandlerUsage();this.strategy.destroy();this.container.removeAllChildren();
this.handles.remove("imagerylayerview-update");this._exportImageVersion=-1};c.prototype.moveStart=function(){};c.prototype.viewChange=function(){};c.prototype.moveEnd=function(){this.requestUpdate()};c.prototype.doRefresh=function(a){return t(this,void 0,void 0,function(){return q(this,function(a){this.requestUpdate();return[2]})})};c.prototype.isUpdating=function(){return this.attached&&(this.strategy.updating||this.updateRequested)};c.prototype.fetchImage=function(a,b,c,e){var g=this;this._exportImageVersion=
this.get("layer.exportImageServiceParameters.version");e=e||{};e.timeExtent=this.timeExtent;e.requestAsImageElement=!0;return this.layer.fetchImage(a,b,c,e).then(function(a){return a.imageElement?a.imageElement:g.layer.applyRenderer(a.pixelData,{signal:e.signal}).then(function(b){b=new f.default(b.pixelBlock,b.extent.clone(),a.pixelData.pixelBlock);b.filter=function(a){return g.layer.applyFilter(a)};return b})}).catch(function(a){d.isAbortError(a)||u.error(a);throw a;})};h([b.property({dependsOn:["updating"]})],
c.prototype,"pixelData",null);h([b.property()],c.prototype,"strategy",void 0);h([b.property({dependsOn:["strategy.updating"]})],c.prototype,"updating",void 0);return c=h([b.subclass("esri.views.2d.layers.ImageryLayerView2D")],c)}(b.declared(e.ImageryLayerView(r.RefreshableLayerView(c.BitmapLayerView2D(l.LayerView2D(p))))))});