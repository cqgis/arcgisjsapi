// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/LabelManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Error ../../core/HandleOwner ../../core/Logger ../../core/throttle ../../core/accessorSupport/decorators ./engine".split(" "),function(w,a,v,e,u,p,l,t,h,k,d){Object.defineProperty(a,"__esModule",{value:!0});var q=t.getLogger("esri.views.2d.layers.labels.LabelManager");w=function(a){function c(c){c=a.call(this)||
this;c._applyVisibilityPassThrottled=h.throttle(c._applyVisibilityPass,64,c);c.lastUpdateId=-1;c.updateRequested=!1;c.view=null;return c}v(c,a);c.prototype.initialize=function(){var c=this;this.collisionEngine=new d.CollisionEngine(this.view.featuresTilingScheme);this._layerViewSorter=new d.LayerViewSorter(function(a,b){c.collisionEngine.registerLayerView(a,b);(b=a.tileRenderer)&&b.forEachTile(function(b){b.isDirty=!0;c.addTile(a,b)});c.requestUpdate()},function(a){c.collisionEngine.unregisterLayerView(a);
c.requestUpdate()});this.handles.add(this.view.allLayerViews.on("change",function(a){c._layerViewSorter.update(a)}))};c.prototype.destroy=function(){this._layerViewSorter.destroy();this.collisionEngine=this._layerViewSorter=null;this._applyVisibilityPassThrottled.remove()};Object.defineProperty(c.prototype,"updating",{get:function(){return this.updateRequested},enumerable:!0,configurable:!0});c.prototype.update=function(c){this._applyVisibilityPassThrottled(c)};c.prototype.viewChange=function(){this.requestUpdate()};
c.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))};c.prototype.processUpdate=function(c){this._set("updateParameters",c);this.updateRequested&&(this.update(c),this.updateRequested=!1)};c.prototype.addTile=function(c,a){this.collisionEngine.addTile(c,a)};c.prototype.removeTile=function(c,a){this.collisionEngine.removeTile(c,a)};c.prototype._applyVisibilityPass=function(c){try{var a=this.view.featuresTilingScheme.getClosestInfoForScale(c.state.scale).level;
this.collisionEngine.run(c,a)}catch(b){q.error(new p("mapview-labeling","Encountered an error during label decluttering",b))}};e([k.property()],c.prototype,"updateRequested",void 0);e([k.property({readOnly:!0})],c.prototype,"updateParameters",void 0);e([k.property({dependsOn:["updateRequested"]})],c.prototype,"updating",null);e([k.property()],c.prototype,"view",void 0);return c=e([k.subclass("esri.views.2d.layers.labels.LabelManager")],c)}(k.declared(l.HandleOwnerMixin(u)));a.default=w})},"esri/core/throttle":function(){define(["require",
"exports"],function(w,a){function v(a,u,p,l){var e=null,h=1E3;"number"===typeof u?(h=u,l=p):(e=u,h=p);var k=0,d,q=function(){k=0;a.apply(l,d)};u=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];e&&e.apply(l,a);d=a;h?k||(k=setTimeout(q,h)):q()};u.remove=function(){k&&(clearTimeout(k),k=0)};u.forceUpdate=function(){k&&(clearTimeout(k),q())};u.hasPendingUpdates=function(){return!!k};return u}Object.defineProperty(a,"__esModule",{value:!0});a.throttle=v;a.default=v})},"esri/views/2d/layers/graphics/GraphicsView2D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/HandleOwner ../../../../core/Identifiable ../../../../core/iteratorUtils ../../../../core/MapPool ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/coordsUtils ../../../../geometry/support/jsonUtils ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/data/projectionSupport ../../../../symbols/support/cimSymbolUtils ../../../../symbols/support/defaults ../../engine ../../engine/webgl/definitions ../features/support/AttributeStore ../features/support/TileStore ./GraphicContainer ./GraphicProcessingQueue ./GraphicStore ./graphicsUtils ../../../layers/GraphicsView".split(" "),
function(w,a,v,e,u,p,l,t,h,k,d,q,x,c,n,m,b,r,f,g,y,z,I,E,L,G,C,F,J,D,B,H,P,M,A){function K(b,c,a){if(a.has(b))return a.get(b);c={tile:c,addedOrModified:[],removed:[]};a.set(b,c);return c}Object.defineProperty(a,"__esModule",{value:!0});w=function(a){function d(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b._tiles=new Map;b._graphicStoreUpdate=!1;b._graphicsSet=new Set;b._matcher=n.resolve(null);b._tileUpdateSet=new Set;b._tilesToUpdate=new Map;b._graphicIdToAbortController=
new Map;b._attached=!1;b._highlightIds=new Map;b._updatingGraphicsTimer=null;b.lastUpdateId=-1;b.updateRequested=!1;b.graphicUpdateHandler=b.graphicUpdateHandler.bind(b);b.addOrUpdateGraphic=b.addOrUpdateGraphic.bind(b);b._processAnalyzedGraphics=b._processAnalyzedGraphics.bind(b);b._graphicsChangeHandler=b._graphicsChangeHandler.bind(b);return b}v(d,a);d.prototype.initialize=function(){var b=this;this._tileStore=new D.default(this.view.featuresTilingScheme);this.container=new B.default(this.view.featuresTilingScheme,
null);this._attributeStore=new J.default({type:"local",initialize:function(c){return n.resolve(b.container.attributeView.initialize(c))},update:function(c){return h.safeCast(b.container.attributeView.requestUpdate(c))},render:function(){return b.container.requestRender()}});this._graphicStore=new P.default(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,function(c){var a=b._attributeStore.createLocalId(c.uid);b._attributeStore.setData(a,0,0,c.visible?F.FILTER_FLAG_0:0)},
function(c){b._attributeStore.freeLocalId(c.uid)});this._graphicProcessingQueue=new H.default({process:this.addOrUpdateGraphic});var c=new C.WGLTemplateStore(this.container.getMaterialItems.bind(this.container),!0),a=this._tileStore.tileScheme.tileInfo;this.renderer&&(this._matcher=C.createMatcher(this.renderer,c,null));this._meshFactory=new C.WGLMeshFactory(null,this.uid,null,c,null,a);this.watch("renderer",function(a){a&&(b._matcher=C.createMatcher(b.renderer,c,null))});this._tileStore.on("update",
this._onTileUpdate.bind(this));this.container.on("attach",function(){0<b.graphics.items.length&&b._graphicsChangeHandler({target:b.graphics,added:b.graphics.items,removed:[],moved:[]});b.handles.add(b.graphics.on("change",b._graphicsChangeHandler),"graphics");b._attached=!0;b.notifyChange("updating")});this.container.on("detach",function(){b._graphicProcessingQueue&&b._graphicProcessingQueue.clear()})};d.prototype.destroy=function(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),
this._updatingGraphicsTimer=null,this.notifyChange("updating"));this.container.dispose();this._set("graphics",null);this._graphicProcessingQueue&&(this._graphicProcessingQueue.destroy(),this._graphicProcessingQueue=null);this._graphicStore.clear();this._tileStore.destroy();this._attributeStore=null};Object.defineProperty(d.prototype,"updating",{get:function(){return!this._attached||null!==this._updatingGraphicsTimer||this._graphicProcessingQueue.updating||0<this._tileUpdateSet.size||0<this._tilesToUpdate.size},
enumerable:!0,configurable:!0});d.prototype.install=function(b){b.addChild(this.container)};d.prototype.uninstall=function(b){b.removeChild(this.container)};d.prototype.hitTest=function(c,a){if(!this.view||!this.view.position)return n.resolve();c=this.view.toMap(b.createScreenPoint(c,a));return this.searchFeatures(c).then(function(b){return b&&b.length?b[0]:null})};d.prototype.searchFeatures=function(b,c){var a=this;void 0===c&&(c=2);return n.create(function(f){f(a._graphicStore.hitTest(b.x,b.y,c,
a.view.state.resolution,a.view.state.rotation))})};d.prototype.update=function(b){b=b.state;var c=this.view.featuresTilingScheme.getClosestInfoForScale(b.scale).level;this._graphicStore.updateLevel(c);this._tileStore.setViewState(b);this._graphicStoreUpdate=!0;this.updateRequested=!1};d.prototype.viewChange=function(){this.requestUpdate()};d.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))};d.prototype.processUpdate=function(b){this.updateRequested&&
(this.updateRequested=!1,this.update(b))};d.prototype.graphicUpdateHandler=function(b){var c=b.newValue,a=b.graphic;switch(b.property){case "geometry":case "symbol":this._graphicProcessingQueue.push(a,"update");break;case "visible":this._setVisible(a.uid,c),this._attributeStore.sendUpdates()}};d.prototype.addHighlight=function(b){for(var c=0;c<b.length;c++){var a=b[c];if(this._highlightIds.has(a)){var f=this._highlightIds.get(a);this._highlightIds.set(a,f+1)}else this._highlightIds.set(a,1)}this._updateHighlight()};
d.prototype.removeHighlight=function(b){for(var c=0;c<b.length;c++){var a=b[c];if(this._highlightIds.has(a)){var f=this._highlightIds.get(a)-1;0===f?this._highlightIds.delete(a):this._highlightIds.set(a,f)}}this._updateHighlight()};d.prototype._updateHighlight=function(){this._attributeStore.setHighlight(q.keysOfMap(this._highlightIds))};d.prototype._getIntersectingTiles=function(b){return(b=this._graphicStore.getBounds(b))&&0!==g.width(b)&&0!==g.height(b)?this._tileStore.boundsIntersections(b):[]};
d.prototype._updateTile=function(b){var c=this,a=b.tile,f=this._getGraphicsData(a,b.addedOrModified);return h.safeCast(this._processGraphics(a.key,f)).then(function(f){c._patchTile(a.key,{addOrUpdate:f,remove:b.removed});return f})};d.prototype._patchTile=function(b,c){this._tiles.has(b)&&(b=this._tiles.get(b),this.container.onTileData(b,c),this.container.requestRender())};d.prototype._graphicsChangeHandler=function(b){var c=this;if(!this._graphicStoreUpdate){var a=this.view.state,f=this.view.featuresTilingScheme.getClosestInfoForScale(a.scale).level;
this._graphicStore.updateLevel(f);this._tileStore.setViewState(a)}var g=b.added,f=b.removed;b=b.moved;for(var r=this._tilesToUpdate,y,a=[],d=Array(g.length),z=0;z<g.length;z++){var m=g[z];d[z]=m;this._graphicsSet.add(m);a.push(this.addGraphic(m))}for(z=0;z<f.length;z++){m=f[z];this._abortProcessingGraphic(m.uid);for(var g=this._getIntersectingTiles(m),B=0,h=g;B<h.length;B++)g=h[B],y=g.key.id,g=K(y,g,r),g.removed.push(this._attributeStore.getLocalId(m.uid));this._graphicsSet.delete(m);this._graphicStore.remove(m)}for(f=
0;f<b.length;f++)for(z=b[f],g=this._getIntersectingTiles(z),m=0,B=g;m<B.length;m++)g=B[m],y=g.key.id,g=K(y,g,r),g.addedOrModified.push(z);this._flipUpdatingGraphics();n.all(a).then(function(){for(var b,a=0;a<d.length;a++){b=d[a];for(var f=0,g=c._getIntersectingTiles(b);f<g.length;f++){var z=g[f];y=z.key.id;K(y,z,r).addedOrModified.push(b)}}c._graphicStore.updateZ();var m=[];r.forEach(function(b){return m.push(c._updateTile(b))});return n.all(m).then(function(){r.clear();c.notifyChange("updating")})}).catch(function(){r.clear();
c.notifyChange("updating")})};d.prototype._getSymbolResources=function(b,a){return l(this,void 0,void 0,function(){var f,g,r,y,d,z,m,B;return p(this,function(h){switch(h.label){case 0:return this.container.attached?(f=c.isSome(b.symbol)?b.symbol:null)?[3,3]:this.renderer?[4,this.renderer.getSymbolAsync(b,{scale:this.view.scale})]:[3,2]:[2,n.resolve(null)];case 1:return f=h.sent(),[3,3];case 2:f=this._getNullSymbol(b),h.label=3;case 3:return[4,L.expandSymbol(f,a)];case 4:f=h.sent();g=[];if("text"===
f.type){r=new Set;y=f;d=y.text;for(z=0;z<d.length;z++)r.add(d.charCodeAt(z));m=[];r.forEach(function(b){return m.push(b)});g.push({symbol:y.toJSON(),id:0,glyphIds:m})}else g.push({symbol:f.toJSON(),id:b.uid,glyphIds:null});return[4,this.container.getMaterialItems(g,a).then(function(b){return b&&0<b.length?b[0].mosaicItem:null})];case 5:return B=h.sent(),[2,{symbol:f,mosaicItem:B}]}})})};d.prototype._projectAndNormalizeGeometry=function(b){return l(this,void 0,void 0,function(){var a,g,r,d=this;return p(this,
function(m){if(c.isNone(b.geometry))return[2,n.resolve(null)];a=b.geometry;z.isPolygon(a)?(g=a.rings,a.rings=g):z.isPolyline(a)?(r=a.paths,a.paths=r):z.isExtent(a)&&(a=f.fromExtent(a));return[2,E.checkProjectionSupport(a.spatialReference,this.view.spatialReference).then(function(){var b=M.normalizeCentralMeridian(a),b=E.project(b,a.spatialReference,d.view.spatialReference);y.closeRingsAndFixWinding(b);return b})]})})};d.prototype._onTileUpdate=function(b){var a=I.getInfo(this.view.spatialReference);
if(b.added&&0<b.added.length)for(var c=0,f=b.added;c<f.length;c++)this._addNewTile(f[c],a);if(b.removed&&0<b.removed.length)for(a=0,b=b.removed;a<b.length;a++)this._removeTile(b[a].key)};d.prototype.addOrUpdateGraphic=function(b,a,c){return this._addOrUpdateGraphic(b,a,c)};d.prototype.addGraphic=function(b){var a=this;this._abortProcessingGraphic(b.uid);var c=m.createAbortController();this._graphicIdToAbortController.set(b.uid,c);return this._addOrUpdateGraphic(b,"add",{signal:c.signal}).then(function(){a._graphicIdToAbortController.delete(b.uid)}).catch(function(c){a._graphicIdToAbortController.delete(b.uid);
if(!n.isAbortError(c))throw c;})};d.prototype._addOrUpdateGraphic=function(b,a,c){var f=this,g=this._projectAndNormalizeGeometry(b),r=this._getSymbolResources(b,c);return n.all([g,r]).then(function(g){var r=g[0];g=g[1];return"add"===a?f._addProjectedGraphic(b,g,r):f._updateGraphic(b,g,r,c)})};d.prototype._addProjectedGraphic=function(b,a,c){this._graphicsSet.has(b)&&this._graphicStore.add(b,a,c)};d.prototype._updateGraphic=function(b,a,c,f){var r=this;if(!this._graphicStore.has(b)||n.isAborted(f))return n.resolve();
c=this._graphicStore.update(b,a,c);a=c.oldBounds;c=c.newBounds;var y=0===g.width(a)&&0===g.height(a),d=0===g.width(c)&&0===g.height(c),y=y?[]:this._tileStore.boundsIntersections(a);a=d?[]:this._tileStore.boundsIntersections(c);c=x.acquire();for(var z=0;z<y.length;z++)d=y[z],c.set(d.key,{addOrUpdate:null,remove:[this._attributeStore.getLocalId(b.uid)]});for(y=0;y<a.length;y++)d=a[y],z=this._getGraphicData(d,b),c.has(d.key)?(d=c.get(d.key),d.remove.length=0,d.addOrUpdate=z):c.set(d.key,{addOrUpdate:z,
remove:null});var m=[];c.forEach(function(b,c){var a=h.safeCast(r._processGraphics(c,b.addOrUpdate,f)).then(function(a){r._patchTile(c,{addOrUpdate:a,remove:b.remove})});m.push(a)});x.release(c);return n.all(m).then(function(){})};d.prototype._addTile=function(b,c){var a=g.create();this.view.featuresTilingScheme.getTileBounds(a,b);a=new C.WGLTile(b,a,!0);c={clear:!0,addOrUpdate:c,remove:[]};this._tiles.set(b,a);this.container.addChild(a);a.setData(c,!1,!1)};d.prototype._addNewTile=function(b,c){var a=
this,f=this._graphicStore.queryTileData(b);if(c){c=Math.round((c.valid[1]-c.valid[0])/b.resolution);for(var g=0;g<f.length;g++){var r=f[g];r.geometry&&z.isPoint(r.geometry)&&this._wrapPoints(r,c)}}var y=b.key;this._tileUpdateSet.add(b.key);this.notifyChange("updating");this._processGraphics(y,f).then(function(b){a._addTile(y,b);a._tileUpdateSet.delete(y);a.notifyChange("updating")}).catch(function(b){a._tileUpdateSet.delete(y);a.notifyChange("updating");if(!n.isAbortError(b))throw b;})};d.prototype._removeTile=
function(b){if(this._tiles.has(b)){var c=this._tiles.get(b);this.container.removeChild(c);c.destroy();this._tiles.delete(b)}};d.prototype._setVisible=function(b,c){b=this._attributeStore.getLocalId(b);this._attributeStore.setData(b,0,0,c?F.FILTER_FLAG_0:0)};d.prototype._getGraphicsData=function(b,c){var a=I.getInfo(this.view.spatialReference);c=this._graphicStore.getGraphicsData(b,c);if(a)for(b=Math.round((a.valid[1]-a.valid[0])/b.resolution),a=0;a<c.length;a++){var f=c[a];f.geometry&&z.isPoint(f.geometry)&&
this._wrapPoints(f,b)}c.sort(function(b,c){return b.insertAfter-c.insertAfter});return c};d.prototype._getGraphicData=function(b,c){c=this._graphicStore.getGraphicData(b,c);var a=[c],f=I.getInfo(this.view.spatialReference);f&&(b=Math.round((f.valid[1]-f.valid[0])/b.resolution),c.geometry&&z.isPoint(c.geometry)&&this._wrapPoints(c,b));return a};d.prototype._wrapPoints=function(b,c){var a=b.geometry;512===c?20>a.x?b.geometry={points:[[a.x,a.y],[c,0]]}:492<a.x&&(b.geometry={points:[[a.x,a.y],[-c,0]]}):
-20>a.x?b.geometry={points:[[a.x,a.y],[c,0]]}:532<a.x&&(b.geometry={points:[[a.x,a.y],[-c,0]]})};d.prototype._processGraphics=function(b,c,a){return l(this,void 0,void 0,function(){var f,g,r;return p(this,function(y){switch(y.label){case 0:f=c&&c.length;if(!f||!this._meshFactory)return[2,null];g=this._meshFactory;return[4,h.safeCast(this._matcher.then(function(b){return g.analyze(c,!0,b,null,null,a)}))];case 1:return r=y.sent(),this._attributeStore.sendUpdates(),[2,this._processAnalyzedGraphics(b,
r)]}})})};d.prototype._processAnalyzedGraphics=function(b,c){for(var a=this._meshFactory,f=a.createMeshData(c.length),g=this._attributeStore,r=0;r<c.length;r++){var y=c[r];y.insertAfter=-1===y.insertAfter?-1:g.getLocalId(y.insertAfter);y.localId=g.getLocalId(y.attributes[this.uid]);a.write(f,y,null,null,b.level)}return C.TileData.fromMeshData(f)};d.prototype._abortProcessingGraphic=function(b){this._graphicIdToAbortController.has(b)&&this._graphicIdToAbortController.get(b).abort()};d.prototype._getNullSymbol=
function(b){b=b.geometry;return z.isPolyline(b)?G.errorPolylineSymbol2D:z.isPolygon(b)||z.isExtent(b)?G.errorPolygonSymbol2D:G.errorPointSymbol2D};d.prototype._flipUpdatingGraphics=function(){var b=this;this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer);this._updatingGraphicsTimer=setTimeout(function(){b._updatingGraphicsTimer=null;b.notifyChange("updating")},160);this.notifyChange("updating")};e([r.property()],d.prototype,"_graphicProcessingQueue",void 0);e([r.property({constructOnly:!0})],
d.prototype,"graphics",void 0);e([r.property({dependsOn:["_graphicProcessingQueue.updating"]})],d.prototype,"updating",null);e([r.property()],d.prototype,"view",void 0);e([r.property()],d.prototype,"updateRequested",void 0);return d=e([r.subclass("esri.views.2d.layers.support.GraphicsView2D")],d)}(r.declared(A.GraphicsView(k.HandleOwnerMixin(d.IdentifiableMixin(t)))));a.default=w})},"esri/core/MapPool":function(){define(["require","exports","./ObjectPool"],function(w,a,v){w=function(){function a(a,
e){void 0===a&&(a=50);void 0===e&&(e=50);this._pool=new v(Map,!1,function(a){return a.clear()},e,a)}a.prototype.acquire=function(){return this._pool.acquire()};a.prototype.release=function(a){this._pool.release(a)};a.acquire=function(){return e.acquire()};a.release=function(a){return e.release(a)};return a}();var e=new w(100);return w})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(w,a,v,e,u,p,l,t,h){function k(b,a){var g;if(!a)return null;if("x"in a){var f={x:0,y:0};b=b(a.x,a.y,c);f.x=b[0];f.y=b[1];null!=a.z&&(f.z=a.z);null!=a.m&&(f.m=a.m);return f}if("xmin"in a)return f={xmin:0,ymin:0,xmax:0,ymax:0},g=b(a.xmin,a.ymin,c),f.xmin=g[0],f.ymin=g[1],b=b(a.xmax,a.ymax,c),f.xmax=b[0],f.ymax=b[1],a.hasZ&&(f.zmin=a.zmin,f.zmax=a.zmax,f.hasZ=!0),a.hasM&&(f.mmin=a.mmin,f.mmax=a.mmax,f.hasM=!0),f;if("rings"in a)return{rings:d(a.rings,b),hasM:a.hasM,hasZ:a.hasZ};if("paths"in a)return{paths:d(a.paths,
b),hasM:a.hasM,hasZ:a.hasZ};if("points"in a)return{points:q(a.points,b),hasM:a.hasM,hasZ:a.hasZ}}function d(b,a){for(var c=[],f=0;f<b.length;f++)c.push(q(b[f],a));return c}function q(b,a){for(var c=[],f=0;f<b.length;f++){var r=b[f],d=a(r[0],r[1],[0,0]);c.push(d);2<r.length&&d.push(r[2]);3<r.length&&d.push(r[3])}return c}function x(b,a){return!t.isValid(b)||!t.isValid(a)||t.equals(b,a)||h.canProject(b,a)?!1:!0}Object.defineProperty(a,"__esModule",{value:!0});var c=[0,0];a.checkProjectionSupport=function(b,
a){return e(this,void 0,void 0,function(){var c,f,r;return v(this,function(g){if(!a)return[2];if(Array.isArray(b)){c=0;for(f=b;c<f.length;c++)if(r=f[c],x(r.geometry&&r.geometry.spatialReference,a)){if(l.isSupported())return[2,l.load()];throw new u("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,outSpatialReference:a});}return[2]}if(!x(b,a))return[2];if(l.isSupported())return[2,l.load()];throw new u("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,
outSpatialReference:a});})})};var n=k.bind(null,h.lngLatToXY),m=k.bind(null,h.xyToLngLat);a.project=function(b,a,c){c||(c=a,a=b.spatialReference);return t.isValid(a)&&t.isValid(c)&&!t.equals(a,c)?h.canProject(a,c)?t.isWebMercator(c)?n(b):m(b):l.projectMany([b],a,c,null,!0)[0]:b};var b=new (function(){function b(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}b.prototype.push=function(b,a,c){return e(this,void 0,void 0,function(){var f,g=this;return v(this,function(d){b&&b.length&&
a&&c&&!t.equals(a,c)||p.resolve(b);f={geometries:b,inSpatialReference:a,outSpatialReference:c,resolve:null};this._jobs.push(f);return[2,p.create(function(b){f.resolve=b;null===g._timer&&(g._timer=setTimeout(g._process,10))},function(){var b=g._jobs.indexOf(f);-1<b&&g._jobs.splice(b,1)})]})})};b.prototype._process=function(){this._timer=null;var b=this._jobs.shift();if(b){var a=b.geometries,c=b.inSpatialReference,d=b.outSpatialReference,b=b.resolve;h.canProject(c,d)?t.isWebMercator(d)?b(a.map(n)):
b(a.map(m)):b(l.projectMany(a,c,d,null,!0));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return b}());a.projectMany=function(a,c,g){return e(this,void 0,void 0,function(){return v(this,function(f){return[2,b.push(a,c,g)]})})}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),function(w,a,v,e,u,p){function l(a,k,c,n,m){void 0===n&&(n=null);void 0===m&&(m=!1);if(null===n){var b=
p.cacheKey(k,c);void 0!==d[b]?n=d[b]:(n=t(k,c,null),null===n&&(n=new p),d[b]=n)}return h._project(a,k,c instanceof u||!1===m?c:new u(c),n,m)}function t(a,d,c){void 0===c&&(c=null);a=h._getTransformation(a,d,c);return null!==a?p.fromGE(a):null}Object.defineProperty(a,"__esModule",{value:!0});var h=null;a.isLoaded=function(){return!!h&&e.isLoaded()};a.isSupported=function(){return e.isSupported()};var k=null;a.load=function(){return k?k:k=v.create(function(a,d){var c=e.load();w(["./geometryEngine"],
function(n){h=n;c.then(function(){h._enableProjection(e);a()},function(a){d(a)})})})};a.project=function(a,d,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:l(a,a[0].spatialReference,d,c):l([a],a.spatialReference,d,c)[0]};var d={};a.projectMany=l;a.getTransformation=t;a.getTransformations=function(a,d,c){void 0===c&&(c=null);a=h._getTransformationBySuitability(a,d,c);if(null!==a){d=[];for(c=0;c<a.length;c++)d.push(p.fromGE(a[c]));return d}return[]}})},"esri/geometry/pe":function(){define(["require",
"exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(w,a,v,e,u){function p(b){function d(b,a,c){b[a]=c(b[a])}a._pe=b;q.init();x.init();c.init();n.init();m.init();a.PeGCSExtent=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}v(c,b);c.prototype.destroy=function(){a._pe.destroy(this)};return c}(a._pe.PeGCSExtent);for(var f=0,g=[a._pe.PeDatum,a._pe.PeGeogcs,a._pe.PeGeogtran,a._pe.PeObject,a._pe.PeParameter,a._pe.PePrimem,a._pe.PeProjcs,a._pe.PeSpheroid,
a._pe.PeUnit];f<g.length;f++)b=g[f],d(b.prototype,"getName",function(b){return function(){return b.call(this,Array(q.PE_NAME_MAX))}});f=0;for(g=[a._pe.PeGeogtran,a._pe.PeProjcs];f<g.length;f++)b=g[f],d(b.prototype,"getParameters",function(b){return function(){for(var c=Array(q.PE_PARM_MAX),f=b.call(this),g=0;g<c.length;g++){var d=a._pe.getValue(f,"*");c[g]=d?a._pe.wrapPointer(d,a._pe.PeParameter):null;f+=Int32Array.BYTES_PER_ELEMENT}return c}});d(a._pe.PeHorizon.prototype,"getCoord",function(b){return function(){var a=
this.getSize();if(!a)return null;var c=[],f=b.call(this);k(c,a,f);return c}});d(a._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(b){var c=a._pe._pe_getPeGTlistExtendedGTsSize();return function(){var f=null,g=b.call(this);if(!a._pe.compare(g,a._pe.NULL)){var f=[g],d=this.getSteps();if(1<d)for(var g=a._pe.getPointer(g),r=1;r<d;r++)f.push(a._pe.wrapPointer(g+c*r,a._pe.PeGTlistExtendedGTs))}return f}});var y=a._pe._pe_getPeHorizonSize();b=function(b){return function(){var c=this._cache;c||
(this._cache=c=new Map);if(c.has(b))return c.get(b);var f=null,g=b.call(this);if(!a._pe.compare(g,a._pe.NULL)){var f=[g],d=g.getNump();if(1<d)for(var g=a._pe.getPointer(g),r=1;r<d;r++)f.push(a._pe.wrapPointer(g+y*r,a._pe.PeHorizon))}c.set(b,f);return f}};d(a._pe.PeProjcs.prototype,"horizonGcsGenerate",b);d(a._pe.PeProjcs.prototype,"horizonPcsGenerate",b);a._pe.PeObject.prototype.toString=function(b){void 0===b&&(b=q.PE_STR_OPTS_NONE);a._pe.ensureCache.prepare();var c=a._pe.getPointer(this),f=a._pe.ensureInt8(Array(q.PE_BUFFER_MAX));
return a._pe.UTF8ToString(a._pe._pe_object_to_string_ext(c,b,f))}}function l(b){if(b){var c=a._pe.getClass(b);c&&(c=a._pe.getCache(c))&&(b=a._pe.getPointer(b))&&delete c[b]}}function t(b,c){var f=[];c=Array(c);for(var g=0;g<b;g++)f.push(a._pe.ensureInt8(c));return f}function h(b){var a;Array.isArray(b[0])?(a=[],b.forEach(function(b){a.push(b[0],b[1])})):a=b;return a}function k(b,c,f,g){void 0===g&&(g=!1);if(g)for(g=0;g<2*c;g++)b[g]=a._pe.getValue(f+g*Float64Array.BYTES_PER_ELEMENT,"double");else{var d=
0===b.length;for(g=0;g<c;g++)d&&(b[g]=Array(2)),b[g][0]=a._pe.getValue(f,"double"),b[g][1]=a._pe.getValue(f+Float64Array.BYTES_PER_ELEMENT,"double"),f+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(a,"__esModule",{value:!0});var d;a._pe=null;a.isLoaded=function(){return!!a._pe};a.isSupported=function(){return!!e("esri-wasm")};a.load=function(){return d?d:d=u.create(function(b,a){w(["./support/pe-wasm"],function(c){c({locateFile:function(b){return w.toUrl("./support/"+b)},onAbort:function(b){a(Error(b))}}).then(function(a){p(a);
b()})})})};(function(b){function c(b,c,f){a._pe.ensureCache.prepare();var g=h(f),d=f===g,g=a._pe.ensureFloat64(g);(b=a._pe._pe_geog_to_proj(a._pe.getPointer(b),c,g))&&k(f,c,g,d);return b}function f(b,a,c){return g(b,a,c,0)}function g(b,c,f,g){a._pe.ensureCache.prepare();var d=h(f),r=f===d,d=a._pe.ensureFloat64(d);(b=a._pe._pe_proj_to_geog_center(a._pe.getPointer(b),c,d,g))&&k(f,c,d,r);return b}b.geogToProj=c;b.projGeog=function(b,a,g,d){switch(d){case q.PE_TRANSFORM_P_TO_G:return f(b,a,g);case q.PE_TRANSFORM_G_TO_P:return c(b,
a,g)}return 0};b.projToGeog=f;b.projToGeogCenter=g})(a.PeCSTransformations||(a.PeCSTransformations={}));var q;(function(b){b.init=function(){b.PE_BUFFER_MAX=a._pe.PeDefs.prototype.PE_BUFFER_MAX;b.PE_NAME_MAX=a._pe.PeDefs.prototype.PE_NAME_MAX;b.PE_MGRS_MAX=a._pe.PeDefs.prototype.PE_MGRS_MAX;b.PE_USNG_MAX=a._pe.PeDefs.prototype.PE_USNG_MAX;b.PE_DD_MAX=a._pe.PeDefs.prototype.PE_DD_MAX;b.PE_DDM_MAX=a._pe.PeDefs.prototype.PE_DDM_MAX;b.PE_DMS_MAX=a._pe.PeDefs.prototype.PE_DMS_MAX;b.PE_UTM_MAX=a._pe.PeDefs.prototype.PE_UTM_MAX;
b.PE_PARM_MAX=a._pe.PeDefs.prototype.PE_PARM_MAX;b.PE_TYPE_NONE=a._pe.PeDefs.prototype.PE_TYPE_NONE;b.PE_TYPE_GEOGCS=a._pe.PeDefs.prototype.PE_TYPE_GEOGCS;b.PE_TYPE_PROJCS=a._pe.PeDefs.prototype.PE_TYPE_PROJCS;b.PE_TYPE_GEOGTRAN=a._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;b.PE_TYPE_COORDSYS=a._pe.PeDefs.prototype.PE_TYPE_COORDSYS;b.PE_TYPE_UNIT=a._pe.PeDefs.prototype.PE_TYPE_UNIT;b.PE_STR_OPTS_NONE=a._pe.PeDefs.prototype.PE_STR_OPTS_NONE;b.PE_STR_AUTH_NONE=a._pe.PeDefs.prototype.PE_STR_AUTH_NONE;b.PE_STR_AUTH_TOP=
a._pe.PeDefs.prototype.PE_STR_AUTH_TOP;b.PE_STR_NAME_CANON=a._pe.PeDefs.prototype.PE_STR_NAME_CANON;b.PE_PARM_X0=a._pe.PeDefs.prototype.PE_PARM_X0;b.PE_PARM_ND=a._pe.PeDefs.prototype.PE_PARM_ND;b.PE_TRANSFORM_1_TO_2=a._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;b.PE_TRANSFORM_2_TO_1=a._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;b.PE_TRANSFORM_P_TO_G=a._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;b.PE_TRANSFORM_G_TO_P=a._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;b.PE_HORIZON_RECT=a._pe.PeDefs.prototype.PE_HORIZON_RECT;
b.PE_HORIZON_POLY=a._pe.PeDefs.prototype.PE_HORIZON_POLY;b.PE_HORIZON_LINE=a._pe.PeDefs.prototype.PE_HORIZON_LINE;b.PE_HORIZON_DELTA=a._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(q=a.PeDefs||(a.PeDefs={}));(function(b){function c(b,c){var d=null,r=g[b];r||(r={},g[b]=r);r.hasOwnProperty(String(c))?d=r[c]:(b=a._pe.PeFactory.prototype.factoryByType(b,c),a._pe.compare(b,a._pe.NULL)||(d=b,r[c]=d));return d=f(d)}function f(b){if(b){var c=b.getType();switch(c){case q.PE_TYPE_GEOGCS:b=a._pe.castObject(b,a._pe.PeGeogcs);
break;case q.PE_TYPE_PROJCS:b=a._pe.castObject(b,a._pe.PeProjcs);break;case q.PE_TYPE_GEOGTRAN:b=a._pe.castObject(b,a._pe.PeGeogtran);break;default:c&q.PE_TYPE_UNIT&&(b=a._pe.castObject(b,a._pe.PeUnit))}}return b}var g={},d={};b.initialize=function(){a._pe.PeFactory.prototype.initialize(null)};b.coordsys=function(b){return c(q.PE_TYPE_COORDSYS,b)};b.factoryByType=c;b.fromString=function(b,c){var g=null,r=d[b];r||(r={},d[b]=r);r.hasOwnProperty(c)?g=r[c]:(b=a._pe.PeFactory.prototype.fromString(b,c),
a._pe.compare(b,a._pe.NULL)||(g=b,r[c]=g));return g=f(g)};b.geogcs=function(b){return c(q.PE_TYPE_GEOGCS,b)};b.geogtran=function(b){return c(q.PE_TYPE_GEOGTRAN,b)};b.getCode=function(b){return a._pe.PeFactory.prototype.getCode(b)};b.projcs=function(b){return c(q.PE_TYPE_PROJCS,b)};b.unit=function(b){return c(q.PE_TYPE_UNIT,b)}})(a.PeFactory||(a.PeFactory={}));a.PeGCSExtent=null;var x;(function(b){var c;b.init=function(){b.PE_GTLIST_OPTS_COMMON=a._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;
c=a._pe._pe_getPeGTlistExtendedEntrySize()};b.getGTlist=function(b,g,d,r,n,m){var f=null,y=new a._pe.PeInteger(m);try{var h=a._pe.PeGTlistExtended.prototype.getGTlist(b,g,d,r,n,y);if(m=y.val)if(f=[h],1<m){var k=a._pe.getPointer(h);for(b=1;b<m;b++)f.push(a._pe.wrapPointer(k+c*b,a._pe.PeGTlistExtendedEntry))}}finally{a._pe.destroy(y)}return f}})(x=a.PeGTlistExtended||(a.PeGTlistExtended={}));(function(b){b.destroy=function(b){if(b&&b.length){for(var c=0;c<b.length;c++){var g=b[c];l(g);g.getEntries().forEach(function(b){l(b);
b=b.getGeogtran();l(b);b.getParameters().forEach(l);[b.getGeogcs1(),b.getGeogcs2()].forEach(function(b){l(b);var a=b.getDatum();l(a);l(a.getSpheroid());l(b.getPrimem());l(b.getUnit())})})}a._pe.PeGTlistExtendedEntry.prototype.Delete(b[0])}}})(a.PeGTlistExtendedEntry||(a.PeGTlistExtendedEntry={}));(function(b){b.geogToGeog=function(b,c,g,d,n){a._pe.ensureCache.prepare();var f=h(g),r=g===f,f=a._pe.ensureFloat64(f),m=0;d&&(m=a._pe.ensureFloat64(d));(b=a._pe._pe_geog_to_geog(a._pe.getPointer(b),c,f,m,
n))&&k(g,c,f,r);return b}})(a.PeGTTransformations||(a.PeGTTransformations={}));(function(b){function c(b,c,f,d,r,n){a._pe.ensureCache.prepare();var g,m;switch(b){case "dd":g=a._pe._pe_geog_to_dd;m=q.PE_DD_MAX;break;case "ddm":g=a._pe._pe_geog_to_ddm;m=q.PE_DDM_MAX;break;case "dms":g=a._pe._pe_geog_to_dms,m=q.PE_DMS_MAX}b=0;c&&(b=a._pe.getPointer(c));c=h(d);c=a._pe.ensureFloat64(c);m=t(f,m);d=a._pe.ensureInt32(m);if(r=g(b,f,c,r,d))for(g=0;g<f;g++)n[g]=a._pe.UTF8ToString(m[g]);return r}function f(b,
c,f,d,r){a._pe.ensureCache.prepare();var g;switch(b){case "dd":g=a._pe._pe_dd_to_geog;break;case "ddm":g=a._pe._pe_ddm_to_geog;break;case "dms":g=a._pe._pe_dms_to_geog}b=0;c&&(b=a._pe.getPointer(c));c=d.map(function(b){return a._pe.ensureString(b)});d=a._pe.ensureInt32(c);c=a._pe.ensureFloat64(Array(2*f));(g=g(b,f,d,c))&&k(r,f,c);return g}b.geog_to_dms=function(b,a,f,d,r){return c("dms",b,a,f,d,r)};b.dms_to_geog=function(b,c,a,d){return f("dms",b,c,a,d)};b.geog_to_ddm=function(b,a,f,d,r){return c("ddm",
b,a,f,d,r)};b.ddm_to_geog=function(b,c,a,d){return f("ddm",b,c,a,d)};b.geog_to_dd=function(b,a,f,d,r){return c("dd",b,a,f,d,r)};b.dd_to_geog=function(b,c,a,d){return f("dd",b,c,a,d)}})(a.PeNotationDms||(a.PeNotationDms={}));var c;(function(b){b.init=function(){b.PE_MGRS_STYLE_NEW=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;b.PE_MGRS_STYLE_OLD=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;b.PE_MGRS_STYLE_AUTO=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;b.PE_MGRS_180_ZONE_1_PLUS=a._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;
b.PE_MGRS_ADD_SPACES=a._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};b.geog_to_mgrs_extended=function(b,c,d,n,m,k,e){a._pe.ensureCache.prepare();var f=0;b&&(f=a._pe.getPointer(b));b=h(d);d=a._pe.ensureFloat64(b);b=t(c,q.PE_MGRS_MAX);var g=a._pe.ensureInt32(b);if(n=a._pe._pe_geog_to_mgrs_extended(f,c,d,n,m,k,g))for(m=0;m<c;m++)e[m]=a._pe.UTF8ToString(b[m]);return n};b.mgrs_to_geog_extended=function(b,c,d,m,n){a._pe.ensureCache.prepare();var f=0;b&&(f=a._pe.getPointer(b));b=d.map(function(b){return a._pe.ensureString(b)});
d=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(m=a._pe._pe_mgrs_to_geog_extended(f,c,d,m,b))&&k(n,c,b);return m}})(c=a.PeNotationMgrs||(a.PeNotationMgrs={}));(function(b){b.geog_to_usng=function(b,c,d,m,n,k,e){a._pe.ensureCache.prepare();var f=0;b&&(f=a._pe.getPointer(b));b=h(d);d=a._pe.ensureFloat64(b);b=t(c,q.PE_MGRS_MAX);var g=a._pe.ensureInt32(b);if(m=a._pe._pe_geog_to_usng(f,c,d,m,n,k,g))for(n=0;n<c;n++)e[n]=a._pe.UTF8ToString(b[n]);return m};b.usng_to_geog=function(b,c,d,m){a._pe.ensureCache.prepare();
var f=0;b&&(f=a._pe.getPointer(b));b=d.map(function(b){return a._pe.ensureString(b)});d=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(f=a._pe._pe_usng_to_geog(f,c,d,b))&&k(m,c,b);return f}})(a.PeNotationUsng||(a.PeNotationUsng={}));var n;(function(b){b.init=function(){b.PE_UTM_OPTS_NONE=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;b.PE_UTM_OPTS_ADD_SPACES=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;b.PE_UTM_OPTS_NS=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};b.geog_to_utm=function(b,
c,d,m,n){a._pe.ensureCache.prepare();var f=0;b&&(f=a._pe.getPointer(b));b=h(d);d=a._pe.ensureFloat64(b);b=t(c,q.PE_UTM_MAX);var g=a._pe.ensureInt32(b);if(m=a._pe._pe_geog_to_utm(f,c,d,m,g))for(f=0;f<c;f++)n[f]=a._pe.UTF8ToString(b[f]);return m};b.utm_to_geog=function(b,c,d,m,n){a._pe.ensureCache.prepare();var f=0;b&&(f=a._pe.getPointer(b));b=d.map(function(b){return a._pe.ensureString(b)});d=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(m=a._pe._pe_utm_to_geog(f,c,d,m,b))&&k(n,c,b);return m}})(n=
a.PeNotationUtm||(a.PeNotationUtm={}));var m;(function(b){var c=new Map;b.init=function(){b.PE_PCSINFO_OPTION_NONE=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;b.PE_PCSINFO_OPTION_DOMAIN=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;b.PE_POLE_OUTSIDE_BOUNDARY=a._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;b.PE_POLE_POINT=a._pe.PePCSInfo.prototype.PE_POLE_POINT};b.generate=function(d,g){void 0===g&&(g=b.PE_PCSINFO_OPTION_DOMAIN);var f,m;c.has(d)&&(m=c.get(d),m[g]&&(f=m[g]));f||(f=a._pe.PePCSInfo.prototype.generate(d,
g),m||(m=[],c.set(d,m)),m[g]=f);return f}})(m=a.PePCSInfo||(a.PePCSInfo={}));(function(b){b.version_string=function(){return a._pe.PeVersion.prototype.version_string()}})(a.PeVersion||(a.PeVersion={}));a._init=p})},"esri/geometry/support/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(w,a,v){return function(){function a(a){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(a&&a.steps){var e=0;for(a=a.steps;e<
a.length;e++){var l=a[e];l instanceof v?this.steps.push(l):this.steps.push(new v({wkid:l.wkid,wkt:l.wkt,isInverse:l.isInverse}))}}}a.cacheKey=function(a,e){return[void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():"",void 0!==e.wkid&&null!==e.wkid?e.wkid.toString():"-1",void 0!==e.wkt&&null!==e.wkt?e.wkt.toString():""].join()};a.fromGE=function(e){var u=new a,l="",t=0;for(e=e.steps;t<e.length;t++){var h=v.fromGE(e[t]);u.steps.push(h);l+=h.uid.toString()+
","}u._cached_projection={};u._gtlistentry=null;u._chain=l;return u};a.prototype.getInverse=function(){var e=new a;e.steps=[];for(var p=this.steps.length-1;0<=p;p--)e.steps.push(this.steps[p].getInverse());return e};a.prototype.getGTListEntry=function(){for(var a="",e=0,l=this.steps;e<l.length;e++)a+=l[e].uid.toString()+",";a!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=a);return this._gtlistentry};a.prototype.assignCachedGe=function(e,p,l){this._cached_projection[a.cacheKey(e,
p)]=l};a.prototype.getCachedGeTransformation=function(e,p){for(var l="",t=0,h=this.steps;t<h.length;t++)l+=h[t].uid.toString()+",";l!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=l);e=this._cached_projection[a.cacheKey(e,p)];return void 0===e?null:e};return a}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(w,a){var v=0;return function(){function a(a){void 0===a&&(a=null);this.uid=v++;a?(this._wkt=void 0!==
a.wkt?a.wkt:null,this._wkid=void 0!==a.wkid?a.wkid:-1,this._isInverse=void 0!==a.isInverse?!0===a.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}a.fromGE=function(e){var p=new a;p._wkt=e.wkt;p._wkid=e.wkid;p._isInverse=e.isInverse;return p};Object.defineProperty(a.prototype,"wkt",{get:function(){return this._wkt},set:function(a){this._wkt=a;this.uid=v++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wkid",{get:function(){return this._wkid},set:function(a){this._wkid=
a;this.uid=v++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isInverse",{get:function(){return this._isInverse},set:function(a){this._isInverse=a;this.uid=v++},enumerable:!0,configurable:!0});a.prototype.getInverse=function(){var e=new a;e._wkt=this.wkt;e._wkid=this._wkid;e._isInverse=!this.isInverse;return e};return a}()})},"esri/views/2d/layers/features/support/AttributeStore":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../layers/support/FieldsIndex ../../../../../support/arcadeOnDemand ../../../../webgl ../../../engine ../../../arcade/utils ../../../engine/webgl/definitions ../tileRenderers/support/visualVariablesUtils @dojo/framework/shim/Promise".split(" "),
function(w,a,v,e,u,p,l,t,h,k,d,q,x,c,n,m,b){Object.defineProperty(a,"__esModule",{value:!0});var r=l.getLogger("esri.views.layers.2d.features.support.AttributeStore"),f=c.debug.createDebugLogger(c.debug.DEBUG_ATTR_UPDATES,r),g=function(b,a){return function(c,d,f){var g;try{g=a(c,d,f)}catch(H){g=NaN}return(null===g||isNaN(g)||Infinity===g)&&b||g}},y=p("esri-shared-array-buffer"),z=p("esri-webgl-texture-float"),I=p("esri-webgl-max-texture-size"),E=p("esri-atomics"),L=function(){function b(b,a,c,d){this.texelSize=
4;var f=d.pixelType,g=d.layout;this.textureOnly=(d=d.textureOnly)||!1;this.pixelType=f;this._ctype=a;this.layout=g;this._resetRange();this._shared=b;d||(this.data=this._initData(f,c,b,a))}Object.defineProperty(b.prototype,"buffer",{get:function(){return h.andThen(this.data,function(b){return b.buffer})},enumerable:!0,configurable:!0});b.prototype.getData=function(b,a){return h.expect(this.data)[b*this.texelSize+a]};b.prototype.setData=function(b,a,c,d){void 0===d&&(d=!0);0===(this.layout&1<<a)?r.error("mapview-attributes-store",
"Tried to set a value for a texel's readonly component"):(this.data[b*this.texelSize+a]=c,this.dirtyStart=Math.min(this.dirtyStart,b),this.dirtyEnd=Math.max(this.dirtyEnd,b))};b.prototype.lock=function(){this._shared&&E&&Atomics.store(this.data,0,1)};b.prototype.unlock=function(){this._shared&&E&&Atomics.store(this.data,0,0)};b.prototype.expand=function(b){if(!this.textureOnly){b=this._initData(this.pixelType,b,this._shared,this._ctype);var a=h.expect(this.data);b.set(a);this.data=b}};b.prototype.toMessage=
function(){var b=this.dirtyStart,a=this.dirtyEnd,d=this.texelSize;if(b>a)return null;this._resetRange();var f=!this._shared&&"local"!==this._ctype,g=this.pixelType,m=this.layout,n=h.expect(this.data);if(!n.slice){if(!f)return{start:b,end:a,data:null,pixelType:g,layout:m};d=new (c.Utils.getPixelArrayCtor(this.pixelType))(Array.prototype.slice.call(this.data,b*d,(a+1)*d));return{start:b,end:a,data:d,pixelType:g,layout:m}}d=f&&n.slice(b*d,(a+1)*d)||null;return{start:b,end:a,data:d,pixelType:g,layout:m}};
b.prototype._initData=function(b,a,d,f){d=d&&"local"!==f?SharedArrayBuffer:ArrayBuffer;b=c.Utils.getPixelArrayCtor(b);a=new b(new d(a*a*4*b.BYTES_PER_ELEMENT));for(b=0;b<a.length;b+=4)a[b+1]=255;return a};b.prototype._resetRange=function(){this.dirtyStart=4294967295;this.dirtyEnd=0};return b}();p=function(){function a(b){this._attributeComputeMap=new Map;this._blocks=[];this._idMap=new Map;this._localToObjectId=new Map;this._filters=Array(c.definitions.MAX_FILTERS);this._freeList=[];this._abortController=
k.createAbortController();this._hasScaleExpr=!1;this._size=32;this._idCounter=1;this._idsToHighlight=new Set;var a=z?5126:5121;f("Creating AttributeStore "+(y?"with":"without")+" shared memory");this._client=b;this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:a,layout:15},{pixelType:a,layout:15}];this._blocks=this._blockDescriptors.map(function(b){return null})}a.prototype.destroy=function(){this._abortController.abort()};Object.defineProperty(a.prototype,
"hasScaleExpr",{get:function(){return this._hasScaleExpr},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_signal",{get:function(){return this._abortController.signal},enumerable:!0,configurable:!0});a.prototype.createLocalId=function(b){if(!this._idMap.has(b)){var a=this._getFreeId();this._idMap.set(b,-1===a?0:a);this._localToObjectId.set(a,b)}return this._idMap.get(b)};a.prototype.freeLocalId=function(b){var a=this._idMap.get(b);this._idMap.delete(b);this._localToObjectId.delete(a);
this._freeList.push(a)};a.prototype.getFeatureId=function(b){return this._localToObjectId.get(b)};a.prototype.getLocalId=function(b){return this._idMap.has(b)?this._idMap.get(b):null};a.prototype.setHighlight=function(b){return e(this,void 0,void 0,function(){var a,c,d,f,g,m,n=this;return v(this,function(r){switch(r.label){case 0:this._getBlock(0).lock();this._idsToHighlight.forEach(function(b){if(b=n.getLocalId(b)){var a=n._getBlock(0).getData(b,0);n._getBlock(0).setData(b,0,a&-2)}});this._idsToHighlight.clear();
a=0;for(c=b;a<c.length;a++)d=c[a],this._idsToHighlight.add(d);for(f=0;f<b.length;f++)g=this.getLocalId(b[f]),null!=g&&(m=this._getBlock(0).getData(g,0),this._getBlock(0).setData(g,0,m|1));this._getBlock(0).unlock();return[4,this.sendUpdates()];case 1:return r.sent(),[2]}})})};a.prototype.addHighlight=function(b){return e(this,void 0,void 0,function(){return v(this,function(b){return[2]})})};a.prototype.removeHighlight=function(b){return e(this,void 0,void 0,function(){return v(this,function(b){return[2]})})};
a.prototype.updateFilters=function(b){return e(this,void 0,void 0,function(){var a,c,d,f,g,m,n=this;return v(this,function(r){switch(r.label){case 0:return a=b.config,c=b.service,d=b.spatialReference,f=a.filters,g=a.definitionExpression,m=f.map(function(a,f){return n._updateFilter(b,a,f,c,g,d)}),[4,k.all(m)];case 1:return r.sent(),[2]}})})};a.prototype.setAttributeBindings=function(b,a){return e(this,void 0,void 0,function(){return v(this,function(c){this._hasScaleExpr=!1;switch(b.type){case "simple":case "class-breaks":case "unique-value":case "dictionary":return[2,
this._bindVVEvaluators(b.visualVariables,a)];case "dot-density":return[2,this._bindDDEvaluators(b.attributes,a)];case "heatmap":break;default:r.error(new u("attribute-store","Found invalid renderer type: "+b))}return[2]})})};a.prototype.setData=function(b,a,c,d){this._getBlock(a).setData(b,c,d)};a.prototype.setAttributeData=function(b,a,d,f){var g=this;this._getBlock(0).setData(b,0,this._getFilterFlags(a));var n=z?1:2;this._attributeComputeMap.forEach(function(r,e){var h=e*n%4;e=g._getBlock(Math.floor(e*
n/4)+m.ATTRIBUTE_DATA_VV);r=r(a,{$view:f},d);if(z)e.setData(b,h,r);else if(r===c.definitions.NAN_MAGIC_NUMBER)e.setData(b,h,255),e.setData(b,h+1,255);else{r=t.clamp(Math.round(r),-32767,32766)+32768;var k=(r&65280)>>8;e.setData(b,h,r&255);e.setData(b,h+1,k)}})};a.prototype.sendUpdates=function(){var b=this;if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=k.createResolver(),this._nextUpdate.promise;var a={blocks:this._blocks.map(function(b){return h.isSome(b)?
b.toMessage():null})};return this._currUpdate=this._createResources().then(function(){var c=b._client.update(a,b._signal).then(function(){b._currUpdate=null;if(b._nextUpdate){var a=b._nextUpdate;b._nextUpdate=null;b.sendUpdates().then(function(){return a.resolve()})}});b._client.render();return c})};a.prototype._createResources=function(){var b=this;if(h.isSome(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(m.ATTRIBUTE_DATA_ANIMATION);f("Initializing AttributeStore");
var a={shared:y&&"local"!==this._client.type,size:this._size,blocks:h.mapMany(this._blocks,function(b){return{textureOnly:b.textureOnly,buffer:b.buffer,pixelType:b.pixelType}})};this._createResourcesPromise=a=this._client.initialize(a,this._signal);a.then(function(){return h.isNone(b._createResourcesPromise)?b._createResources():void 0});return a};a.prototype._getBlock=function(b){var a=this._blocks[b];if(h.isSome(a))return a;f("Initializing AttributeBlock at index "+b);a=new L(y,this._client.type,
this._size,this._blockDescriptors[b]);this._blocks[b]=a;this._createResourcesPromise=null;return a};a.prototype._expand=function(){if(this._size<I){var b=this._size<<=1;f("Expanding block size to",b,this._blocks);h.forEachSome(this._blocks,function(a){return a.expand(b)});this._createResourcesPromise=null;this._size=b;return 0}r.error(new u("mapview-limitations","Maximum number of onscreen features exceeded."));return-1};a.prototype._getFreeId=function(){return this._freeList.length?this._freeList.pop():
this._idCounter>=this._size*this._size&&this._expand()?-1:this._idCounter++};a.prototype._updateFilter=function(b,a,c,d,f,g){return e(this,void 0,void 0,function(){var m,n,r,e,k,B,y,q,l,t=this;return v(this,function(H){switch(H.label){case 0:m=this._filters[c];n=h.isSome(m)&&m.hash;if(n===JSON.stringify(a))return[2];r=1<<c+1;return h.isNone(a)?(this._filters[c]=null,this._idMap.forEach(function(b){var a=t._getBlock(0).getData(b,0);t._getBlock(0).setData(b,0,a|r)}),[2]):[4,b.queryObjectIds(a)];case 1:return e=
H.sent(),a.hiddenIds&&a.hiddenIds.length&&(e=e.filter(function(b){return-1===a.hiddenIds.indexOf(b)})),k=e.map(function(b){return t._idMap.get(b)}),[4,this._getFilter(c,d)];case 2:B=H.sent();B.update(a,f,g);this._getBlock(0).lock();this._idMap.forEach(function(b){var a=t._getBlock(0).getData(b,0);t._getBlock(0).setData(b,0,a&~r)});for(y=0;y<k.length;y++)q=k[y],null!=q&&(l=this._getBlock(0).getData(q,0),this._getBlock(0).setData(q,0,l|r));this._getBlock(0).unlock();return[2]}})})};a.prototype._getFilter=
function(b,a){return e(this,void 0,void 0,function(){var c,f,g;return v(this,function(m){switch(m.label){case 0:return c=this._filters[b],h.isSome(c)?[2,c]:[4,new Promise(function(b,a){w(["../../../../../layers/graphics/data/FeatureFilter"],b,a)})];case 1:return f=m.sent().default,g=new f({geometryType:a.geometryType,hasM:!1,hasZ:!1,timeInfo:a.timeInfo,fieldsIndex:new d(a.fields)}),this._filters[b]=g,[2,g]}})})};a.prototype._getFilterFlags=function(b){for(var a=0,c=0;c<this._filters.length;c++)var d=
this._filters[c],d=h.isNone(d)||d.check(b),a=a|(d?1:0)<<c;b=this.getFeatureId(b.localId);b=this._idsToHighlight.has(b)?1:0;return a<<1|b};a.prototype._bindVVEvaluators=function(b,a){return e(this,void 0,void 0,function(){var d,f=this;return v(this,function(g){switch(g.label){case 0:this._attributeComputeMap.clear();if(!h.isSome(b))return[3,2];d=k.all(b.map(function(b){return e(f,void 0,void 0,function(){var d,f;return v(this,function(g){switch(g.label){case 0:return d=c.Utils.getVVType(b.type),[4,
this._createGetValueFunction(b,a)];case 1:return f=g.sent(),h.isSome(f)&&this._attributeComputeMap.set(d,f),[2]}})})}));return[4,d];case 1:g.sent(),g.label=2;case 2:return[2]}})})};a.prototype._bindDDEvaluators=function(b,a){return e(this,void 0,void 0,function(){var d,f,m,n=this;return v(this,function(e){switch(e.label){case 0:return this._attributeComputeMap.clear(),b.length>c.definitions.DOT_DENSITY_MAX_FIELDS&&r.warn("mapview-invalid-value","DotDensityRenderer supports a maximum of "+c.definitions.DOT_DENSITY_MAX_FIELDS+
" attribtues, but found "+b.length),[4,k.all(b.map(function(b){return n._createNormalizedFunction(b,a)}))];case 1:d=e.sent().map(function(b){return g(0,b)});for(f=0;f<c.definitions.DOT_DENSITY_MAX_FIELDS;f++)(m=f<b.length&&d[f])?this._attributeComputeMap.set(f,m):this._attributeComputeMap.has(f)&&this._attributeComputeMap.delete(f);return[2]}})})};a.prototype._createGetValueFunction=function(a,d){return e(this,void 0,void 0,function(){var f,m,n,r,e,h,k;return v(this,function(B){switch(B.label){case 0:if("size"!==
a.type)return[3,2];f=c.getTypeOfSizeVisualVariable(a);if(f===c.enums.WGLVVFlag.SIZE_SCALE_STOPS)return[2,null];n=(m=f===c.enums.WGLVVFlag.SIZE_UNIT_VALUE)&&function(c){return b.getVisualVariableSizeValueRepresentationRatio(c,a.valueRepresentation)};r=g;e=[c.definitions.NAN_MAGIC_NUMBER];return[4,this._createNormalizedFunction(a,d,n)];case 1:return[2,r.apply(void 0,e.concat([B.sent()]))];case 2:return h=g,k=[c.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(a,d)];case 3:return[2,h.apply(void 0,
k.concat([B.sent()]))]}})})};a.prototype._createNormalizedFunction=function(b,a,c){return e(this,void 0,void 0,function(){var d,f,g;return v(this,function(m){switch(m.label){case 0:if(d=b.field){if("string"===typeof d)return(f=b.normalizationField)?[2,function(b){if(b.attributes[d]&&b.attributes[f])return b=b.attributes[d]/b.attributes[f],c?c(b):b}]:[2,c?function(b){return c(b.attributes[d])}:function(b){return b.attributes[d]}];r.error(new u("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+
typeof d));return[2,function(b){}]}if(!b.valueExpression)return[3,2];this._hasScaleExpr=this._hasScaleExpr||-1!==b.valueExpression.indexOf("scale");return[4,q.createVVExpression(b.valueExpression,a.spatialReference,a.fields)];case 1:return g=m.sent(),[2,n.callWithOptimizedFeature.bind(null,g)];case 2:return r.error("Unable to create a normalized function for visual variable: "+b),[2,function(b){}]}})})};return a}();a.default=p})},"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":function(){define(["require",
"exports","../../../../../../core/screenUtils","../../../../engine","../../../../../3d/layers/support/FastSymbolUpdates"],function(w,a,v,e,u){function p(a){return{value:a.value,size:v.toPt(a.size)}}function l(a){return a.map(function(a){return p(a)})}function t(a){return"string"===typeof a||"number"===typeof a?v.toPt(a):{type:"size",expression:a.expression,stops:l(a.stops)}}function h(a){var d={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(e.Utils.isString(a.field))if(a.stops){if(8<a.stops.length)return null;
var h=a.stops;for(a=0;8>a;++a){var c=h[Math.min(a,h.length-1)];d.values[a]=c.value;d.opacities[a]=c.opacity}}else return null;else if(a.stops&&0<=a.stops.length)for(h=a.stops&&0<=a.stops.length&&a.stops[0].opacity,a=0;8>a;a++)d.values[a]=Infinity,d.opacities[a]=h;else return null;return d}Object.defineProperty(a,"__esModule",{value:!0});var k=e.enums.WGLVVFlag;a.getVisualVariableSizeValueRepresentationRatio=function(a,e){if(!a||!e)return a;switch(e){case "radius":case "distance":return 2*a;case "area":return Math.sqrt(a)}return a};
a.stopToSizeStop=p;a.normalizeSizeStops=l;a.normalizeSizeElement=t;a.getVisualVariablesFields=function(a){var d=a&&0<a.length?{}:null;d&&a.forEach(function(a){var c=a.type;a.field&&(d[c]=a.field)});return d};a.convertVisualVariables=function(a){var d=a&&0<a.length?{}:null,x=d?{}:null;if(!d)return{vvFields:d,vvRanges:x};for(var c=0;c<a.length;c++){var n=a[c],m=n.type;n.field&&(d[m]=n.field);if("size"===m){x.size||(x.size={});var b=n;switch(e.getTypeOfSizeVisualVariable(b)){case k.SIZE_MINMAX_VALUE:x.size.minMaxValue=
{minDataValue:b.minDataValue,maxDataValue:b.maxDataValue,minSize:t(b.minSize),maxSize:t(b.maxSize)};break;case k.SIZE_SCALE_STOPS:x.size.scaleStops={stops:l(b.stops)};break;case k.SIZE_FIELD_STOPS:for(var n=[],m=[],b=l(b.stops),r=b.length,f=0;6>f;f++){var g=b[Math.min(f,r-1)];n.push(g.value);m.push(v.pt2px(g.size))}x.size.fieldStops={values:n,sizes:m};break;case k.SIZE_UNIT_VALUE:x.size.unitValue={unit:b.valueUnit,valueRepresentation:b.valueRepresentation}}}else if("color"===m)for(n=u.convertVisualVariables([n],
{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null}),x.color=n.color,f=0;32>f;f+=4)e.color.premultiplyAlpha(x.color.colors,f,!0);else"opacity"===m?x.opacity=h(n):"rotation"===m&&(x.rotation={type:n.rotationType})}return{vvFields:d,vvRanges:x}}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),
function(w,a,v,e,u,p,l,t,h,k,d,q){function x(b){return null!==b&&void 0!==b}function c(b){return"number"===typeof b}function n(b){return"string"===typeof b}function m(b,a){b&&b.push(a)}function b(b,a,f,g,n){var e=b.minSize,h=b.maxSize;if(b.expression)return m(n,"Could not convert size info: expression not supported"),!1;if(b.useSymbolValue)return b=g.symbolSize[f],a.minSize[f]=b,a.maxSize[f]=b,a.offset[f]=a.minSize[f],a.factor[f]=0,a.type[f]=1,!0;if(x(b.field)){if(x(b.stops)){if(2===b.stops.length&&
c(b.stops[0].size)&&c(b.stops[1].size))return r(b.stops[0].size,b.stops[1].size,b.stops[0].value,b.stops[1].value,a,f),a.type[f]=1,!0;m(n,"Could not convert size info: stops only supported with 2 elements");return!1}if(c(e)&&c(h)&&x(b.minDataValue)&&x(b.maxDataValue))return r(e,h,b.minDataValue,b.maxDataValue,a,f),a.type[f]=1,!0;if(null!=d.meterIn[b.valueUnit])return a.minSize[f]=-Infinity,a.maxSize[f]=Infinity,a.offset[f]=0,a.factor[f]=1/d.meterIn[b.valueUnit],a.type[f]=1,!0;if("unknown"===b.valueUnit)return m(n,
"Could not convert size info: proportional size not supported"),!1;m(n,"Could not convert size info: scale-dependent size not supported");return!1}if(!x(b.field)){if(b.stops&&b.stops[0]&&c(b.stops[0].size))return a.minSize[f]=b.stops[0].size,a.maxSize[f]=b.stops[0].size,a.offset[f]=a.minSize[f],a.factor[f]=0,a.type[f]=1,!0;if(c(e))return a.minSize[f]=e,a.maxSize[f]=e,a.offset[f]=e,a.factor[f]=0,a.type[f]=1,!0}m(n,"Could not convert size info: unsupported variant of sizeInfo");return!1}function r(b,
a,c,f,d,g){f=0<Math.abs(f-c)?(a-b)/(f-c):0;d.minSize[g]=0<f?b:a;d.maxSize[g]=0<f?a:b;d.offset[g]=b-c*f;d.factor[g]=f}function f(a,c,f,d){if(a.normalizationField||a.valueRepresentation)return m(d,"Could not convert size info: unsupported property"),null;var g=a.field;if(null!=g&&!n(g))return m(d,"Could not convert size info: field is not a string"),null;if(!c.size)c.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!c.size.field)c.size.field=
a.field;else if(a.field!==c.size.field)return m(d,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(g=b(a,c.size,0,f,d))?c:null;case "height":return(g=b(a,c.size,2,f,d))?c:null;case "depth":return(g=b(a,c.size,1,f,d))?c:null;case "width-and-depth":return(g=b(a,c.size,0,f,d))&&b(a,c.size,1,f,d),g?c:null;case null:case void 0:case "all":return(g=(g=(g=b(a,c.size,0,f,d))&&b(a,c.size,1,f,d))&&b(a,c.size,2,f,d))?c:null;default:return m(d,'Could not convert size info: unknown axis "'+
a.axis+'""'),null}}function g(b,a,c){for(var f=0;3>f;++f){var d=a.unitInMeters;1===b.type[f]&&(d*=a.modelSize[f],b.type[f]=2);b.minSize[f]/=d;b.maxSize[f]/=d;b.offset[f]/=d;b.factor[f]/=d}if(0!==b.type[0])a=0;else if(0!==b.type[1])a=1;else if(0!==b.type[2])a=2;else return m(c,"No size axis contains a valid size or scale"),!1;for(f=0;3>f;++f)0===b.type[f]&&(b.minSize[f]=b.minSize[a],b.maxSize[f]=b.maxSize[a],b.offset[f]=b.offset[a],b.factor[f]=b.factor[a],b.type[f]=b.type[a]);return!0}function y(b,
a,c){b[4*a+0]=c.r/255;b[4*a+1]=c.g/255;b[4*a+2]=c.b/255;b[4*a+3]=c.a}function z(b,a,c){if(b.normalizationField)return m(c,"Could not convert color info: unsupported property"),null;if(n(b.field))if(b.stops){if(8<b.stops.length)return m(c,"Could not convert color info: too many color stops"),null;a.color={field:b.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c=b.stops;for(b=0;8>b;++b){var f=c[Math.min(b,c.length-1)];a.color.values[b]=f.value;
y(a.color.colors,b,f.color)}}else return m(c,"Could not convert color info: missing stops or colors"),null;else if(b.stops&&0<=b.stops.length)for(c=b.stops&&0<=b.stops.length&&b.stops[0].color,a.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},b=0;8>b;b++)a.color.values[b]=Infinity,y(a.color.colors,b,c);else return m(c,"Could not convert color info: no field and no colors/stops"),null;return a}function I(b,a,c){if(b.normalizationField)return m(c,
"Could not convert opacity info: unsupported property"),null;if(n(b.field))if(b.stops){if(8<b.stops.length)return m(c,"Could not convert opacity info: too many opacity stops"),null;a.opacity={field:b.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};c=b.stops;for(b=0;8>b;++b){var f=c[Math.min(b,c.length-1)];a.opacity.values[b]=f.value;a.opacity.opacityValues[b]=f.opacity}}else return m(c,"Could not convert opacity info: missing stops or opacities"),null;else if(b.stops&&0<=b.stops.length)for(c=
b.stops&&0<=b.stops.length&&b.stops[0].opacity,a.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},b=0;8>b;b++)a.opacity.values[b]=Infinity,a.opacity.opacityValues[b]=c;else return m(c,"Could not convert opacity info: no field and no opacities/stops"),null;return a}function E(b,a,c,f){b=2===c&&"arithmetic"===b.rotationType;a.offset[c]=b?90:0;a.factor[c]=b?-1:1;a.type[c]=1}function L(b,a,c){if(!n(b.field))return m(c,"Could not convert rotation info: field is not a string"),
null;if(!a.rotation)a.rotation={field:b.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(b.field)if(!a.rotation.field)a.rotation.field=b.field;else if(b.field!==a.rotation.field)return m(c,"Could not convert rotation info: multiple fields in use"),null;switch(b.axis){case "tilt":return E(b,a.rotation,0,c),a;case "roll":return E(b,a.rotation,1,c),a;case null:case void 0:case "heading":return E(b,a.rotation,2,c),a;default:return m(c,'Could not convert rotation info: unknown axis "'+b.axis+
'""'),null}}function G(b,a,c){if(!b)return null;var d=!a.supportedTypes||!!a.supportedTypes.size,n=!a.supportedTypes||!!a.supportedTypes.color,r=!a.supportedTypes||!!a.supportedTypes.rotation,e=!!a.supportedTypes&&!!a.supportedTypes.opacity,h=b.reduce(function(b,g){if(!b)return b;if(g.valueExpression)return m(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(g.type){case "size":return d?f(g,b,a,c):b;case "color":return n?z(g,b,c):b;case "opacity":return e?I(g,b,
c):null;case "rotation":return r?L(g,b,c):b;default:return v.neverReached(g),null}},{size:null,color:null,opacity:null,rotation:null});return 0<b.length&&h&&!h.size&&!h.color&&!h.opacity&&!h.rotation||h&&h.size&&!g(h.size,a,c)?null:h}function C(b,a,c){if(!!b!==!!a||b&&b.field!==a.field)return!1;if(b&&"rotation"===c)for(c=0;3>c;c++)if(b.type[c]!==a.type[c]||b.offset[c]!==a.offset[c]||b.factor[c]!==a.factor[c])return!1;return!0}function F(b,a){var c={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,
vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},f=b&&null!=b.size;b&&b.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=b.size.minSize,c.vvSizeMaxSize=b.size.maxSize,c.vvSizeOffset=b.size.offset,c.vvSizeFactor=b.size.factor):b&&f&&(c.vvSizeValue=a.transformation.scale);if(b&&f){c.vvSymbolAnchor=a.transformation.anchor;c.vvSymbolRotationMatrix=
p.mat3f64.create();l.mat4.identity(D);var d=a.transformation.rotation[2],f=a.transformation.rotation[0],g=a.transformation.rotation[1];a=D;void 0===a&&(a=t.mat4f64.create());d=d||0;f=f||0;g=g||0;0!==d&&l.mat4.rotateZ(a,a,-d/180*Math.PI);0!==f&&l.mat4.rotateX(a,a,f/180*Math.PI);0!==g&&l.mat4.rotateY(a,a,g/180*Math.PI);u.mat3.fromMat4(c.vvSymbolRotationMatrix,D)}b&&b.color&&(c.vvColorEnabled=!0,c.vvColorValues=b.color.values,c.vvColorColors=b.color.colors);b&&b.opacity&&(c.vvOpacityEnabled=!0,c.vvOpacityValues=
b.opacity.values,c.vvOpacityOpacities=b.opacity.opacityValues);return c}Object.defineProperty(a,"__esModule",{value:!0});a.convertVisualVariables=G;a.initFastSymbolUpdatesState=function(b,a){return!b||q.DISABLE_FAST_UPDATES?{enabled:!1}:(b=G(b.visualVariables,a))?{enabled:!0,visualVariables:b,materialParameters:F(b,a),requiresShaderTransformation:b&&null!=b.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(b,a,c){if(!a||!b.enabled)return!1;var f=b.visualVariables;a=G(a.visualVariables,c);
if(!(a&&C(f.size,a.size,"size")&&C(f.color,a.color,"color")&&C(f.rotation,a.rotation,"rotation")&&C(f.opacity,a.opacity,"opacity")))return!1;b.visualVariables=a;b.materialParameters=F(a,c);b.requiresShaderTransformation=a&&null!=a.size;return!0};a.getMaterialParams=F;var J;(function(b){var a=t.mat4f64.create(),c=k.vec3f64.create();b.evaluateModelTransform=function(b,f,d){if(!b.vvSizeEnabled)return d;l.mat4.copy(a,d);d=b.vvSymbolRotationMatrix;l.mat4.set(D,d[0],d[1],d[2],0,d[3],d[4],d[5],0,d[6],d[7],
d[8],0,0,0,0,1);l.mat4.multiply(a,a,D);for(d=0;3>d;++d)c[d]=e.clamp(b.vvSizeOffset[d]+f[0]*b.vvSizeFactor[d],b.vvSizeMinSize[d],b.vvSizeMaxSize[d]);l.mat4.scale(a,a,c);l.mat4.translate(a,a,b.vvSymbolAnchor);return a};b.evaluateModelTransformScale=function(b,a,c){if(!a.vvSizeEnabled)return h.vec3.set(b,1,1,1);for(var f=0;3>f;++f)b[f]=e.clamp(a.vvSizeOffset[f]+c[0]*a.vvSizeFactor[f],a.vvSizeMinSize[f],a.vvSizeMaxSize[f]);return b}})(J||(J={}));var D=t.mat4f64.create();a.evaluateModelTransform=J.evaluateModelTransform;
a.evaluateModelTransformScale=J.evaluateModelTransformScale})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(w,a,v){Object.defineProperty(a,"__esModule",{value:!0});a.mat3f64=v})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require","exports"],function(w,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return[1,0,0,0,1,0,0,0,1]};a.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],
a[7],a[8]]};a.fromValues=function(a,e,u,p,l,t,h,k,d){return[a,e,u,p,l,t,h,k,d]};a.createView=function(a,e){return new Float64Array(a,e,9)}})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(w,a,v){Object.defineProperty(a,"__esModule",{value:!0});a.mat4f64=v})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(w,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return[1,0,
0,0,0,1,0,0,0,0,1,0,0,0,0,1]};a.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]};a.fromValues=function(a,e,u,p,l,t,h,k,d,q,x,c,n,m,b,r){return[a,e,u,p,l,t,h,k,d,q,x,c,n,m,b,r]};a.createView=function(a,e){return new Float64Array(a,e,16)}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(w,a,v,e,u,p){return new (function(a){function l(){var e=null!==a&&a.apply(this,arguments)||this;e.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;e.SCENEVIEW_LOCKING_LOG=!1;e.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;e.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;e.DECONFLICTOR_SHOW_OUTLINES=!1;e.DECONFLICTOR_SHOW_GRID=!1;e.LABELS_SHOW_BORDER=!1;e.OVERLAY_DRAW_TEST_TEXTURE=!1;e.OVERLAY_SHOW_CENTER=!1;e.TESTS_DISABLE_UPDATE_THRESHOLDS=!1;e.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=
!1;e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;e.DRAW_MESH_GEOMETRY_NORMALS=!1;e.FEATURE_TILE_FETCH_SHOW_TILES=!1;e.FEATURE_TILE_TREE_SHOW_TILES=!1;e.TERRAIN_TILE_TREE_SHOW_TILES=!1;e.I3S_TREE_SHOW_TILES=!1;e.ENABLE_PROFILE_DEPTH_RANGE=!1;e.DISABLE_FAST_UPDATES=!1;e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;return e}v(l,a);e([p.property()],l.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);e([p.property()],
l.prototype,"SCENEVIEW_LOCKING_LOG",void 0);e([p.property()],l.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);e([p.property()],l.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);e([p.property()],l.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);e([p.property()],l.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);e([p.property()],l.prototype,"DECONFLICTOR_SHOW_GRID",void 0);e([p.property()],l.prototype,"LABELS_SHOW_BORDER",void 0);e([p.property()],l.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);
e([p.property()],l.prototype,"OVERLAY_SHOW_CENTER",void 0);e([p.property()],l.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0);e([p.property()],l.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);e([p.property()],l.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);e([p.property()],l.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);e([p.property()],l.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);e([p.property()],l.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);e([p.property()],
l.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);e([p.property()],l.prototype,"I3S_TREE_SHOW_TILES",void 0);e([p.property()],l.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);e([p.property()],l.prototype,"DISABLE_FAST_UPDATES",void 0);e([p.property()],l.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);e([p.property()],l.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);e([p.property()],l.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);return l=e([p.subclass("esri.views.3d.support.DebugFlags")],
l)}(p.declared(u)))})},"esri/views/2d/layers/features/support/TileStore":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Evented ../../../../../core/has ../../../../../core/libs/rbush/rbush ./Tile ../../../tiling/TileCoverage ../../../tiling/TileKey".split(" "),function(w,a,v,e,u,p,l,t,h,k){Object.defineProperty(a,"__esModule",{value:!0});var d={added:[],removed:[]},q=new Set,x=new k(0,0,0,0);w=function(a){function c(c){var b=
a.call(this)||this;b._tiles=new Map;b._index=l(9,p("csp-restrictions")?function(b){return{minX:b.bounds[0],minY:b.bounds[1],maxX:b.bounds[2],maxY:b.bounds[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]);b.tiles=[];b.tileScheme=c;return b}v(c,a);c.prototype.destroy=function(){this._tiles.clear()};c.prototype.has=function(a){return this._tiles.has(a)};c.prototype.get=function(a){return this._tiles.get(a)};c.prototype.findByKey=function(a){return this._tiles.get(a.id)};c.prototype.intersections=
function(a,b){var c="string"===typeof a?this.get(a):a;if(!c)return[];var f=b*c.resolution;b=c.bounds[0]-f;a=c.bounds[1]-f;for(var d=c.bounds[2]+f,c=c.bounds[3]+f,f=[],m=0,n=this._index.search({minX:b,minY:a,maxX:d,maxY:c});m<n.length;m++){var e=n[m],k=e.bounds.slice();k[0]=Math.max(k[0],b);k[1]=Math.max(k[1],a);k[2]=Math.min(k[2],d);k[3]=Math.min(k[3],c);0<k[2]-k[0]&&0<k[3]-k[1]&&f.push({bounds:k,tile:e})}return f};c.prototype.boundsIntersections=function(a){return this._index.search({minX:a[0],minY:a[1],
maxX:a[2],maxY:a[3]})};c.prototype.setViewState=function(a){if(a=this.tileScheme.getTileCoverage(a,0)){var b=a.spans,c=a.lodInfo,f=c.level;if(0<b.length)for(var g=0;g<b.length;g++)for(var n=b[g],m=n.row,e=n.colTo,k=n.colFrom;k<=e;k++){var l=x.set(f,m,c.normalizeCol(k),c.getWorldForColumn(k)).id;q.add(l);this.has(l)||(n=new t.default(this.tileScheme,l),this._tiles.set(l,n),this._index.insert(n),this.tiles.push(n),d.added.push(n))}for(b=this.tiles.length-1;0<=b;b--)n=this.tiles[b],q.has(n.id)||(this._tiles.delete(n.id),
this.tiles.splice(b,1),this._index.remove(n),d.removed.push(n));(d.added.length||d.removed.length)&&this.emit("update",d);h.pool.release(a);q.clear();d.added.length=0;d.removed.length=0}};return c}(u);a.default=w})},"esri/core/libs/rbush/rbush":function(){define(["../quickselect/quickselect"],function(w){function a(c,d){if(!(this instanceof a))return new a(c,d);this._maxEntries=Math.max(4,c||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));d&&("function"===typeof d?this.toBBox=d:this._initFormat(d));
this.clear()}function v(a,d){e(a,0,a.children.length,d,a)}function e(a,d,m,b,e){e||(e=q(null));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;e.maxY=-Infinity;for(var c;d<m;d++)c=a.children[d],u(e,a.leaf?b(c):c);return e}function u(a,d){a.minX=Math.min(a.minX,d.minX);a.minY=Math.min(a.minY,d.minY);a.maxX=Math.max(a.maxX,d.maxX);a.maxY=Math.max(a.maxY,d.maxY);return a}function p(a,d){return a.minX-d.minX}function l(a,d){return a.minY-d.minY}function t(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function h(a){return a.maxX-
a.minX+(a.maxY-a.minY)}function k(a,d){return a.minX<=d.minX&&a.minY<=d.minY&&d.maxX<=a.maxX&&d.maxY<=a.maxY}function d(a,d){return d.minX<=a.maxX&&d.minY<=a.maxY&&d.maxX>=a.minX&&d.maxY>=a.minY}function q(a){return{children:a,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function x(a,d,m,b,e){for(var c=[d,m],g;c.length;)m=c.pop(),d=c.pop(),m-d<=b||(g=d+Math.ceil((m-d)/b/2)*b,w(a,g,d,m,e),c.push(d,g,g,m))}a.prototype={all:function(){return this._all(this.data,[])},search:function(a){var c=
this.data,m=[],b=this.toBBox;if(!d(a,c))return m;for(var e=[],f,g,h,l;c;){f=0;for(g=c.children.length;f<g;f++)h=c.children[f],l=c.leaf?b(h):h,d(a,l)&&(c.leaf?m.push(h):k(a,l)?this._all(h,m):e.push(h));c=e.pop()}return m},collides:function(a){var c=this.data,m=this.toBBox;if(!d(a,c))return!1;for(var b=[],e,f,g,h;c;){e=0;for(f=c.children.length;e<f;e++)if(g=c.children[e],h=c.leaf?m(g):g,d(a,h)){if(c.leaf||k(a,h))return!0;b.push(g)}c=b.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<
this._minEntries){for(var c=0,d=a.length;c<d;c++)this.insert(a[c]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this},insert:function(a){a&&this._insert(a,this.data.height-1);return this},clear:function(){this.data=q([]);return this},remove:function(a,d){if(!a)return this;for(var c=this.data,
b=this.toBBox(a),e=[],f=[],g,n,h,l;c||e.length;){c||(c=e.pop(),n=e[e.length-1],g=f.pop(),l=!0);if(c.leaf){a:{h=a;var q=c.children,t=d;if(t){for(var x=0;x<q.length;x++)if(t(h,q[x])){h=x;break a}h=-1}else h=q.indexOf(h)}if(-1!==h){c.children.splice(h,1);e.push(c);this._condense(e);break}}l||c.leaf||!k(c,b)?n?(g++,c=n.children[g],l=!1):c=null:(e.push(c),f.push(g),g=0,n=c,c=c.children[0])}return this},toBBox:function(a){return a},compareMinX:p,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(a){this.data=
a;return this},_all:function(a,d){for(var c=[];a;)a.leaf?d.push.apply(d,a.children):c.push.apply(c,a.children),a=c.pop();return d},_build:function(a,d,e,b){var c=e-d+1,f=this._maxEntries,g;if(c<=f)return g=q(a.slice(d,e+1)),v(g,this.toBBox),g;b||(b=Math.ceil(Math.log(c)/Math.log(f)),f=Math.ceil(c/Math.pow(f,b-1)));g=q([]);g.leaf=!1;g.height=b;var c=Math.ceil(c/f),f=c*Math.ceil(Math.sqrt(f)),m,n,h;for(x(a,d,e,f,this.compareMinX);d<=e;d+=f)for(n=Math.min(d+f-1,e),x(a,d,n,c,this.compareMinY),m=d;m<=
n;m+=c)h=Math.min(m+c-1,n),g.children.push(this._build(a,m,h,b-1));v(g,this.toBBox);return g},_chooseSubtree:function(a,d,e,b){for(var c,f,g,m,n,h,k,l;;){b.push(d);if(d.leaf||b.length-1===e)break;k=l=Infinity;c=0;for(f=d.children.length;c<f;c++)g=d.children[c],n=t(g),h=(Math.max(g.maxX,a.maxX)-Math.min(g.minX,a.minX))*(Math.max(g.maxY,a.maxY)-Math.min(g.minY,a.minY))-n,h<l?(l=h,k=n<k?n:k,m=g):h===l&&n<k&&(k=n,m=g);d=m||d.children[0]}return d},_insert:function(a,d,e){var b=this.toBBox;e=e?a:b(a);var b=
[],c=this._chooseSubtree(e,this.data,d,b);c.children.push(a);for(u(c,e);0<=d;)if(b[d].children.length>this._maxEntries)this._split(b,d),d--;else break;this._adjustParentBBoxes(e,b,d)},_split:function(a,d){var c=a[d],b=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,b);b=this._chooseSplitIndex(c,e,b);b=q(c.children.splice(b,c.children.length-b));b.height=c.height;b.leaf=c.leaf;v(c,this.toBBox);v(b,this.toBBox);d?a[d-1].children.push(b):this._splitRoot(c,b)},_splitRoot:function(a,d){this.data=
q([a,d]);this.data.height=a.height+1;this.data.leaf=!1;v(this.data,this.toBBox)},_chooseSplitIndex:function(a,d,m){var b,c,f,g,h,k,n;h=k=Infinity;for(b=d;b<=m-d;b++)c=e(a,0,b,this.toBBox),f=e(a,b,m,this.toBBox),g=Math.max(0,Math.min(c.maxX,f.maxX)-Math.max(c.minX,f.minX))*Math.max(0,Math.min(c.maxY,f.maxY)-Math.max(c.minY,f.minY)),c=t(c)+t(f),g<h?(h=g,n=b,k=c<k?c:k):g===h&&c<k&&(k=c,n=b);return n},_chooseSplitAxis:function(a,d,e){var b=a.leaf?this.compareMinX:p,c=a.leaf?this.compareMinY:l,f=this._allDistMargin(a,
d,e,b);d=this._allDistMargin(a,d,e,c);f<d&&a.children.sort(b)},_allDistMargin:function(a,d,m,b){a.children.sort(b);b=this.toBBox;var c=e(a,0,d,b),f=e(a,m-d,m,b),g=h(c)+h(f),k,n;for(k=d;k<m-d;k++)n=a.children[k],u(c,a.leaf?b(n):n),g+=h(c);for(k=m-d-1;k>=d;k--)n=a.children[k],u(f,a.leaf?b(n):n),g+=h(f);return g},_adjustParentBBoxes:function(a,d,e){for(;0<=e;e--)u(d[e],a)},_condense:function(a){for(var c=a.length-1,d;0<=c;c--)0===a[c].children.length?0<c?(d=a[c-1].children,d.splice(d.indexOf(a[c]),1)):
this.clear():v(a[c],this.toBBox)},_initFormat:function(a){var c=["return a"," - b",";"];this.compareMinX=new Function("a","b",c.join(a[0]));this.compareMinY=new Function("a","b",c.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")}};return a})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function w(e,u,p,l,t){for(;l>p;){if(600<l-p){var h=l-p+1,k=u-p+1,d=Math.log(h),q=.5*Math.exp(2*d/3),d=.5*Math.sqrt(d*
q*(h-q)/h)*(0>k-h/2?-1:1);w(e,u,Math.max(p,Math.floor(u-k*q/h+d)),Math.min(l,Math.floor(u+(h-k)*q/h+d)),t)}h=e[u];k=p;q=l;a(e,p,u);for(0<t(e[l],h)&&a(e,p,l);k<q;){a(e,k,q);k++;for(q--;0>t(e[k],h);)k++;for(;0<t(e[q],h);)q--}0===t(e[p],h)?a(e,p,q):(q++,a(e,q,l));q<=u&&(p=q+1);u<=q&&(l=q-1)}}function a(a,u,p){var e=a[u];a[u]=a[p];a[p]=e}function v(a,u){return a<u?-1:a>u?1:0}return function(a,u,p,l,t){w(a,u,p||0,l||a.length-1,t||v)}})},"esri/views/2d/layers/features/support/Tile":function(){define("require exports ../../../../../core/ArrayPool ../../../../../geometry/Extent ../../../../../geometry/support/aaBoundingRect ../../../../../tasks/support/QuantizationParameters ../../../tiling/TileKey".split(" "),
function(w,a,v,e,u,p,l){function t(a,e){var d=a.bounds,k=e.bounds;return a.key.id!==e.key.id&&a.key.world===e.key.world&&d[0]<=k[0]&&d[1]<=k[1]&&d[2]>=k[2]&&d[3]>=k[3]}Object.defineProperty(a,"__esModule",{value:!0});a.isParentOf=t;a.isChildOf=function(a,e){return t(e,a)};w=function(){function a(a,d){this.bounds=u.create();this.key=new l(0,0,0,0);this.objectIds=new Set;this.key.set(d);d=a.getLODInfoAt(this.key);this.tileInfoView=a;this.tileInfoView.getTileBounds(this.bounds,this.key,!0);this.resolution=
d.resolution;this.scale=d.scale;this.level=d.level;this.needsClear=!0}Object.defineProperty(a.prototype,"id",{get:function(){return this.key.id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"extent",{get:function(){return e.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transform",{get:function(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],
this.bounds[3]]}},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new a(this.tileInfoView,this.id)};a.prototype.createChildTiles=function(){for(var e=this.key.getChildKeys(),d=v.acquire(),h=0;h<e.length;h++)d[h]=new a(this.tileInfoView,e[h]);return d};a.prototype.getQuantizationParameters=function(){return p.default.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],
spatialReference:this.tileInfoView.tileInfo.spatialReference}})};return a}();a.Tile=w;a.default=w})},"esri/views/2d/layers/graphics/GraphicContainer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../engine/FeatureContainer".split(" "),function(w,a,v,e,u,p,l){Object.defineProperty(a,"__esModule",{value:!0});w=function(a){function h(){return null!==
a&&a.apply(this,arguments)||this}e(h,a);Object.defineProperty(h.prototype,"hasLabels",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"labelsVisible",{get:function(){return!1},enumerable:!0,configurable:!0});h.prototype._renderGraphics=function(a,d){for(var e=0,k=this.children;e<k.length;e++){var c=k[e];c.isReady&&c.hasData&&(c.commitChanges(a),a.context.setStencilFunction(514,c.stencilRef,255),c._displayList.replay(a,c,d))}};h.prototype.renderChildren=
function(e){var d=e.painter;this.children.some(function(a){return a.hasData})&&(a.prototype.renderChildren.call(this,e),this._renderGraphics(e),d=d.effects.highlight,d.bind(e),this._renderGraphics(e,d.defines),d.draw(e),d.unbind(e))};return h}(l.FeatureContainer);a.default=w})},"esri/views/2d/engine/FeatureContainer":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../core/promiseUtils ../../../core/promiseUtils ../../../geometry/support/aaBoundingRect ../engine".split(" "),
function(w,a,v,e,u,p,l,t,h,k){Object.defineProperty(a,"__esModule",{value:!0});w=function(a){function d(d,c){d=a.call(this,d,c)||this;d._rendererInfo=new k.WGLRendererInfo;d.attributeView=new k.AttributeStoreView;return d}u(d,a);d.prototype.destroy=function(){this.removeAllChildren();this.children.forEach(function(a){return a.destroy()});this.attributeView.destroy()};d.prototype.whenAttached=function(){var a=this;return this.attached?l.resolve():l.create(function(c){return a.once("attached",function(){return c()})})};
d.prototype.setRendererInfo=function(a,c,d){this._rendererInfo.setInfo(a,c,d);this.requestRender()};d.prototype.getMaterialItems=function(a,c){return e(this,void 0,void 0,function(){var d,e,b,k;return v(this,function(f){switch(f.label){case 0:return a&&0!==a.length?[4,this.whenAttached()]:[2,null];case 1:return f.sent(),d=this.stage.painter.textureManager,e=a.map(function(a){return d.rasterizeItem(a.symbol,a.glyphIds,c)}),[4,t.all(e)];case 2:return b=f.sent(),k=b.map(function(b,c){return{id:a[c].id,
mosaicItem:b}}),[2,k]}})})};d.prototype.onTileData=function(a,c){if(!(c.addOrUpdate&&"tileDisplayData"in c.addOrUpdate)){var d=c.addOrUpdate&&k.TileData.decode(c.addOrUpdate);c=p({},c,{addOrUpdate:d})}a.setData(c,this.hasLabels,this.labelsVisible);this.contains(a)||this.addChild(a);this.requestRender()};d.prototype.onTileError=function(a){a.clear();this.contains(a)||this.addChild(a)};d.prototype.renderChildren=function(d){this._rendererInfo.update(d.state);this.attributeView.bindTextures(this.stage.context);
a.prototype.renderChildren.call(this,d)};d.prototype.createTile=function(a){var c=this._tileInfoView.getTileBounds(h.create(),a);return new k.WGLTile(a,c)};d.prototype.destroyTile=function(a){this.removeChild(a);a.destroy()};d.prototype.attach=function(){this._initializeExtensions();return a.prototype.attach.call(this)};d.prototype.createRenderParams=function(d){return p({},a.prototype.createRenderParams.call(this,d),{rendererInfo:this._rendererInfo,attributeView:this.attributeView})};d.prototype._initializeExtensions=
function(){var a=this.stage.context.capabilities;a.textureFloat;a.vao};return d}(k.TileContainer);a.FeatureContainer=w})},"esri/views/2d/layers/graphics/GraphicProcessingQueue":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators".split(" "),function(w,a,v,e,u,p,l,t){Object.defineProperty(a,"__esModule",
{value:!0});w=function(a){function k(d){d=a.call(this,d)||this;d._queue=new Map;d._queueArray=[];d._onGoingGraphic=null;d._onGoingPromise=null;d._scheduledNextHandle=null;d._next=d._next.bind(d);d._finalize=d._finalize.bind(d);return d}v(k,a);Object.defineProperty(k.prototype,"length",{get:function(){return this._queueArray.length},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"updating",{get:function(){return 0<this._queueArray.length||null!==this._onGoingPromise},enumerable:!0,
configurable:!0});k.prototype.cancel=function(a){this._onGoingGraphic&&this._onGoingGraphic.graphic===a&&(this._ongoingAbortController.abort(),this._onGoingGraphic=this._onGoingPromise=null);if(this._queue.has(a)){var d=this._queue.get(a);this._queue.delete(a);a=this._queueArray.indexOf(d);this._queueArray.slice(a,1)}this._scheduleNext();this.notifyChange("updating")};k.prototype.clear=function(){this._queue.clear();this._queueArray.length=0;this._onGoingPromise&&(this._ongoingAbortController.abort(),
this._onGoingGraphic=this._onGoingPromise=null);this._cancelNext();this.notifyChange("updating")};k.prototype.has=function(a){return this._queue.has(a)};k.prototype.isOngoing=function(a){return this._onGoingGraphic&&this._onGoingGraphic.graphic===a};k.prototype.push=function(a,e){this._queue.has(a)||(e={graphic:a,addOrUpdate:e},this._queueArray.push(e),this._queue.set(a,e),this._scheduleNext(),this.notifyChange("updating"))};k.prototype.refresh=function(){this.reset()};k.prototype.reset=function(){var a=
this._onGoingGraphic;a&&this.push(a.graphic,a.addOrUpdate)};k.prototype._finalize=function(){this._onGoingPromise=this._ongoingAbortController=this._onGoingGraphic=null;this.notifyChange("updating");this._scheduleNext()};k.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)};k.prototype._scheduleNext=function(){this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingGraphic||(this._scheduledNextHandle=l.schedule(this._next))};
k.prototype._next=function(){if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingGraphic)this._scheduledNextHandle=null;else{this._scheduledNextHandle=null;var a=this._peek(),e=a.graphic,k=a.addOrUpdate,c=p.createAbortController();this._queue.delete(e);this._onGoingGraphic=a;this._onGoingPromise=this.process(e,k,{signal:c.signal});this._ongoingAbortController=c;this._onGoingPromise.then(this._finalize,this._finalize);this.notifyChange("updating")}};k.prototype._peek=function(){return 0===
this._queueArray.length?null:this._queueArray.pop()};e([t.property({readOnly:!0})],k.prototype,"length",null);e([t.property({readOnly:!0})],k.prototype,"updating",null);e([t.property({constructOnly:!0})],k.prototype,"process",void 0);return k=e([t.subclass("esri.views.2d.layers.graphics.GraphicProcessingQueue")],k)}(t.declared(u));a.default=w})},"esri/views/2d/layers/graphics/GraphicStore":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/screenUtils ../../../../core/libs/rbush/rbush ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/contains ../../../../geometry/support/extentUtils ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtils ./GraphicStoreItem ./graphicsUtils".split(" "),
function(w,a,v,e,u,p,l,t,h,k,d,q,x){function c(a,b,c,d,e){n.minX=b;n.minY=c;n.maxX=d;n.maxY=e;return a.search(n)}Object.defineProperty(a,"__esModule",{value:!0});var n={minX:0,minY:0,maxX:0,maxY:0},m=l.create(),b=[];w=function(){function a(a,b,c,d,m,k){this._graphics=d;this._onAdd=m;this._onRemove=k;this._index=p(9,e("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]);this._itemByGraphic=new Map;this._currentLevel=
-Infinity;this._tileInfoView=a;this._uidFieldName=c;if(a=a.getClosestInfoForScale(b))this._currentLevel=a.level,this._resolution=this._tileInfoView.getTileResolution(a.level)}a.prototype.hitTest=function(a,b,e,n,r){a=d.normalizeMapX(a,this._tileInfoView.spatialReference);var f=.5*n*e;m[0]=a-f;m[1]=b-f;m[2]=a+f;m[3]=b+f;e=.5*n*(e+50);e=c(this._index,a-e,b-e,a+e,b+e);if(!e||0===e.length)return[];for(var f={x:a,y:b},g=[],q,y=0;y<e.length;y++){var p=e[y];if(p.graphic.visible)switch(k.getJsonType(p.geometry)){case "esriGeometryPoint":q=
p.symbol;if(!q)continue;var z=p.geometry,v=void 0;switch(q.type){case "text":v=x.getTextSymbolBounds(z.x,z.y,q,p.size,this._resolution,r);break;case "cim":v=x.getCIMMarkerBounds(z.x,z.y,q,this._resolution,r);break;default:v=x.getMarkerSymbolBounds(z.x,z.y,q,this._resolution,r)}t.polygonContainsPoint(v,f)&&g.push(p);break;case "esriGeometryPolyline":q=p.symbol;if(!q)continue;q=1.5*n*window.devicePixelRatio*u.pt2px(q.width);x.isPointOnPolyline(p.geometry,a,b,q)&&g.push(p);break;case "esriGeometryEnvelope":q=
p.geometry;q=l.fromValues(q.xmin,q.ymin,q.xmax,q.ymax);l.intersects(q,m)&&g.push(p);break;case "esriGeometryPolygon":if(t.polygonContainsPoint(p.geometry,f)){g.push(p);break}q=h.getPolygonExtent(p.geometry);if(Math.abs(q.ymax-q.ymin)<5*n||Math.abs(q.xmax-q.xmin)<5*n)q=l.fromValues(q.xmin,q.ymin,q.xmax,q.ymax),l.intersects(q,m)&&g.push(p);break;case "esriGeometryMultipoint":if(q=p.symbol)for(var z=p.geometry.points,v=void 0,w=0;w<z.length;w++)if(v="text"===q.type?x.getTextSymbolBounds(z[w][0],z[w][1],
q,p.size,this._resolution,r):x.getMarkerSymbolBounds(z[w][0],z[w][1],q,this._resolution,r),t.polygonContainsPoint(v,f)){g.push(p);break}}}g.sort(function(a,b){var c=x.graphicGeometryToNumber(a.graphic),d=x.graphicGeometryToNumber(b.graphic);return c===d?b.zorder-a.zorder:c-d});return g.map(function(a){return a.graphic})};a.prototype.getGraphicsData=function(a,b){var d=c(this._index,a.bounds[0],a.bounds[1],a.bounds[2],a.bounds[3]);if(0===d.length||0===b.length)return[];d.sort(function(a,b){return a.zorder-
b.zorder});d[0].insertAfter=-1;for(var f=1;f<d.length;f++)d[f].insertAfter=d[f-1].graphic.uid;d.sort(function(a,b){return a.graphic.uid-b.graphic.uid});b.sort(function(a,b){return a.uid-b.uid});var g=f=0,e,m=[];a={originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]};for(var k=0;k<b.length;k++){for(var h=b[k],g=-2;f<d.length;)if(e=d[f],f++,h.uid===e.graphic.uid){g=e.insertAfter;break}if(e.geometry&&-2!==g){var l=e.getGeometryQuantized(a),n=v({},e.graphic.attributes);
n[this._uidFieldName]=h.uid;m.push({centroid:q.default.getCentroidQuantized(e,a,this._scale),geometry:l,attributes:n,symbol:e.symbol,insertAfter:g})}}return m};a.prototype.getGraphicData=function(a,b){var d=this._itemByGraphic.get(b);if(!d)return null;var f=c(this._index,a.bounds[0],a.bounds[1],a.bounds[2],a.bounds[3]);f.sort(function(a,b){return a.zorder-b.zorder});var g=f.indexOf(d),f=0===g||-1===g?-1:f[g-1].graphic.uid;a={originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],
a.bounds[3]]};var g=d.getGeometryQuantized(a),e=v({},d.graphic.attributes);e[this._uidFieldName]=b.uid;return{centroid:q.default.getCentroidQuantized(d,a,this._scale),geometry:g,attributes:e,symbol:d.symbol,insertAfter:f}};a.prototype.queryTileData=function(a){var b=l.pad(a.bounds,50*a.resolution,l.create()),b=c(this._index,b[0],b[1],b[2],b[3]),d=[];this._createTileGraphics(d,b,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]});return d};a.prototype.has=
function(a){return this._itemByGraphic.has(a)};a.prototype.getBounds=function(a){return this._itemByGraphic.has(a)?this._itemByGraphic.get(a).bounds:null};a.prototype.add=function(a,b,c){if(a)return this._onAdd(a),b=q.default.acquire(a,b,c,this._resolution,this._scale,this._tileInfoView.spatialReference),this._itemByGraphic.set(a,b),c&&this._index.insert(b),b.bounds};a.prototype.remove=function(a){if(this._itemByGraphic.has(a)){this._onRemove(a);var b=this._itemByGraphic.get(a);this._index.remove(b);
this._itemByGraphic.delete(a)}};a.prototype.updateZ=function(){for(var a=this._graphics.items,b,c=0;c<a.length;c++)if(b=a[c],b=this._itemByGraphic.get(b))b.zorder=c};a.prototype.update=function(a,b,c){var d=this._itemByGraphic.get(a),f=l.clone(d.bounds);d.size[0]=d.size[1]=0;this._index.remove(d);d.set(a,b,c,this._resolution,this._scale,this._tileInfoView.spatialReference);c&&this._index.insert(d);return{oldBounds:f,newBounds:d.bounds}};a.prototype.updateLevel=function(a){var c=this;this._currentLevel!==
a&&(this._currentLevel=a,this._resolution=this._tileInfoView.getTileResolution(a),this._scale=this._tileInfoView.getTileScale({level:a,row:0,col:0,world:0}),this._index.clear(),b.length=0,this._itemByGraphic.forEach(function(a){a.updateBounds(a.symbol,c._resolution,c._scale,c._tileInfoView.spatialReference);a.geometry&&b.push(a)}),this._index.load(b))};a.prototype.clear=function(){this._itemByGraphic.clear();this._index.clear()};a.prototype._createTileGraphics=function(a,b,c){var d=this._uidFieldName;
b.sort(function(a,b){return a.zorder-b.zorder});for(var f,e,g,m,k=0;k<b.length;k++){g=b[k];f=g.graphic;e=g.getGeometryQuantized(c);m=0===k?-1:b[k-1].graphic.uid;var h=v({},g.graphic.attributes);h[d]=f.uid;a.push({centroid:q.default.getCentroidQuantized(g,c,this._scale),geometry:e,attributes:h,symbol:g.symbol,insertAfter:m})}};return a}();a.default=w})},"esri/views/2d/layers/graphics/GraphicStoreItem":function(){define("require exports ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/jsonUtils ../../../../geometry/support/quantizationUtils ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./graphicsUtils".split(" "),
function(w,a,v,e,u,p,l,t,h,k){Object.defineProperty(a,"__esModule",{value:!0});var d=new h.default,q=new h.default;w=function(){function a(){this.bounds=e.create();this.graphic=null;this.size=[0,0,0,0]}a.acquire=function(c,d,e,b,k,f){void 0===c&&(c=null);var g;0===a._pool.length?g=new a:(g=a._pool.pop(),this._set.delete(g));g.acquire(c,d,e,b,k,f);return g};a.release=function(a){a&&!this._set.has(a)&&(a.release(),this._pool.push(a),this._set.add(a))};a.getCentroidQuantized=function(a,d,e){if(p.isPolygon(a.geometry)){e=
a.symbol;if(v.isNone(e))return null;if(k.isMarkerSymbol(e.type))return a=u.polygonCentroid(a.geometry),l.quantizePoint(d,{},{x:a[0],y:a[1]},!1,!1)}return null};a.prototype.acquire=function(a,d,e,b,k,f){void 0===a&&(a=null);a&&this.set(a,d,e,b,k,f)};a.prototype.release=function(){this.geometry=this.symbol=this.graphic=null};a.prototype.set=function(a,d,e,b,h,f){this.graphic=a;this.geometry=e;this.symbol=d.symbol;k.getBounds(this.bounds,this.size,d.symbol,e,d.mosaicItem,b,h,f)};a.prototype.updateBounds=
function(a,d,e,b){k.getBounds(this.bounds,this.size,a,this.geometry,null,d,e,b)};a.prototype.getGeometryQuantized=function(a){if(p.isPolygon(this.geometry)){var c=this.geometry.rings;if(1===c.length&&2===c[0].length)return l.quantizeGeometry(a,{paths:[[c[0][0],c[0][1]]]})}else if(p.isPolyline(this.geometry))return d.coords.length=0,d.lengths.length=0,q.coords.length=0,q.lengths.length=0,t.convertFromPolyline(d,this.geometry),t.generalizeOptimizedGeometry(q,d,this.geometry.hasZ,this.geometry.hasM,
"esriGeometryPolyline",a.scale[0]),t.quantizeOptimizedGeometry(d,q,this.geometry.hasZ,this.geometry.hasM,"esriGeometryPolyline",a),t.convertToPolyline(d,this.geometry.hasZ,this.geometry.hasM);return l.quantizeGeometry(a,this.geometry)};a._pool=[];a._set=new Set;return a}();a.default=w})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define("require exports ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat2d ../../../../core/libs/gl-matrix-2/mat2df32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/boundsUtils ../../../../geometry/support/intersects ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/support/spatialReferenceUtils ../../engine".split(" "),
function(w,a,v,e,u,p,l,t,h,k,d,q,x,c,n,m,b){function r(a,b,c,d,f){var g,k,m=e.pt2px(c.xoffset),h=e.pt2px(c.yoffset),n=D*c.angle;f*=D;switch(c.type){case "simple-marker":g=k=e.pt2px(c.size);break;case "picture-marker":g=e.pt2px(c.width),k=e.pt2px(c.height)}c=u.mat2d.identity(M);u.mat2d.translate(c,c,l.vec2.set(A,a,b));u.mat2d.rotate(c,c,f-n);u.mat2d.scale(c,c,l.vec2.set(A,d,-d));u.mat2d.translate(c,c,l.vec2.set(A,m,-h));a=[0,0];l.vec2.transformMat2d(a,l.vec2.set(A,-.5*g,-.5*k),c);b=[0,0];l.vec2.transformMat2d(b,
l.vec2.set(A,-.5*g,.5*k),c);d=[0,0];l.vec2.transformMat2d(d,l.vec2.set(A,.5*g,-.5*k),c);m=[0,0];l.vec2.transformMat2d(m,l.vec2.set(A,.5*g,.5*k),c);return{rings:[[a,d,m,b,a]]}}function f(a,c,d,f,g){var k=b.CIMSymbolHelper.getEnvelope(d.data);if(!k)return null;d=e.pt2px(k.width);var m=e.pt2px(k.height),h=e.pt2px(k.x),k=e.pt2px(k.y),n=0*D,q=D*g;g=u.mat2d.identity(M);u.mat2d.translate(g,g,l.vec2.set(A,a,c));u.mat2d.rotate(g,g,q-n);u.mat2d.scale(g,g,l.vec2.set(A,f,f));a=[0,0];l.vec2.transformMat2d(a,l.vec2.set(A,
h,k+m),g);c=[0,0];l.vec2.transformMat2d(c,l.vec2.set(A,h,k),g);f=[0,0];l.vec2.transformMat2d(f,l.vec2.set(A,h+d,k+m),g);m=[0,0];l.vec2.transformMat2d(m,l.vec2.set(A,h+d,k),g);return{rings:[[a,f,m,c,a]]}}function g(a,c,d,f,g,k){var m=b.alignmentUtils.getYAnchorDirection(d.verticalAlignment||"baseline"),h="baseline"===(d.verticalAlignment||"baseline"),n=e.pt2px(d.xoffset),q=e.pt2px(d.yoffset),r=e.pt2px(d.font.size)/24,p=4*r,m=h?25*r:f[1]+(1+m)*f[3]*.5;d=D*d.angle;h=D*k;k=u.mat2d.identity(M);u.mat2d.translate(k,
k,l.vec2.set(A,a,c));u.mat2d.rotate(k,k,h-d);u.mat2d.scale(k,k,l.vec2.set(A,g,-g));u.mat2d.translate(k,k,l.vec2.set(A,n,-q));u.mat2d.translate(k,k,l.vec2.set(A,-p,-p-m));a=[0,0];l.vec2.transformMat2d(a,l.vec2.set(A,f[0],f[1]),k);c=[0,0];l.vec2.transformMat2d(c,l.vec2.set(A,f[0],f[1]+f[3]),k);g=[0,0];l.vec2.transformMat2d(g,l.vec2.set(A,f[0]+f[2],f[1]),k);n=[0,0];l.vec2.transformMat2d(n,l.vec2.set(A,f[0]+f[2],f[1]+f[3]),k);return{rings:[[a,g,n,c,a]]}}function y(a,c,d){if(!d||0===d.glyphMosaicItems.length)return a;
var f=b.bidiText(c.text),g=f[0],f=f[1],k=b.alignmentUtils.getJustification(c.horizontalAlignment||"center"),m=b.alignmentUtils.getXAnchorDirection(c.horizontalAlignment||"center");d=(new b.TextShapingNew([d.glyphMosaicItems],b.definitions.TEXT_MAX_WIDTH,b.definitions.TEXT_LINE_HEIGHT,b.definitions.TEXT_SPACING,[0,.5*-H],.5*(1-m),0,k)).getShaping(g,f);g=b.fontUtils.getFontDecorationTop(c.font.decoration);isNaN(g)||b.TextShapingNew.addDecoration(d,g);d=b.TextShapingNew.getBox(d);c=e.pt2px(c.font.size)/
W;a[0]=c*d.x;a[1]=c*d.y;a[2]=c*d.width;a[3]=c*d.height;return a}function z(a,b){return Math.ceil((a-b)/(2*b))}function I(a,b){var c;c=x.isPolygon(a)?a.rings:a.paths;for(var d=0;d<c.length;d++)for(var f=0,g=c[d];f<g.length;f++)g[f][0]+=b;return a}function E(a,b){if(!b)return a;var c=L(a,b).map(function(a){return a.extent});return 2>c.length?c[0]||a:2<c.length?(a.xmin=b.valid[0],a.xmax=b.valid[1],a):{rings:c.map(function(a){return[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,
a.ymin]]})}}function L(a,b){var c=[],d=a.ymin,f=a.ymax,g=a.xmax-a.xmin,e=a.xmin,k=a.xmax,m,h=b.valid,l=h[0],n=h[1];m=G(a.xmin,b);var q=m.x,h=m.frameId;m=G(a.xmax,b);b=m.x;a=m.frameId;m=q===b&&0<g;if(g>2*n){g={xmin:e<k?q:b,ymin:d,xmax:n,ymax:f};e={xmin:l,ymin:d,xmax:e<k?b:q,ymax:f};k={xmin:0,ymin:d,xmax:n,ymax:f};d={xmin:l,ymin:d,xmax:0,ymax:f};f=[];l=[];C(g,k)&&f.push(h);C(g,d)&&l.push(h);C(e,k)&&f.push(a);C(e,d)&&l.push(a);for(n=h+1;n<a;n++)f.push(n),l.push(n);c.push({extent:g,frameIds:[h]},{extent:e,
frameIds:[a]},{extent:k,frameIds:f},{extent:d,frameIds:l})}else q>b||m?c.push({extent:{xmin:q,ymin:d,xmax:n,ymax:f},frameIds:[h]},{extent:{xmin:l,ymin:d,xmax:b,ymax:f},frameIds:[a]}):c.push({extent:{xmin:q,ymin:d,xmax:b,ymax:f},frameIds:[h]});return c}function G(a,b){var c=b.valid;b=c[0];var d=c[1],c=2*d,f=0;a>d?(b=Math.ceil(Math.abs(a-d)/c),a-=b*c,f=b):a<b&&(b=Math.ceil(Math.abs(a-b)/c),a+=b*c,f=-b);return{x:a,frameId:f}}function C(a,b){var c=b.xmin,d=b.ymin,f=b.xmax;b=b.ymax;return F(a,c,d)&&F(a,
c,b)&&F(a,f,b)&&F(a,f,d)}function F(a,b,c){return b>=a.xmin&&b<=a.xmax&&c>=a.ymin&&c<=a.ymax?!0:!1}function J(a,b,c){if(Array.isArray(a)){var d=a[0];if(d>b){var f=z(d,b);a[0]=d+-2*f*b}else d<c&&(f=z(d,c),a[0]=d+-2*f*c)}else d=a.x,d>b?(f=z(d,b),a.x+=-2*f*b):d<c&&(f=z(d,c),a.x+=-2*f*c);return a}Object.defineProperty(a,"__esModule",{value:!0});var D=Math.PI/180,B=b.definitions.TEXT_MAX_WIDTH,H=b.definitions.TEXT_LINE_HEIGHT,P=b.definitions.TEXT_SPACING,M=p.mat2df32.create(),A=t.vec2f32.create(),K=k.create();
a.getBounds=function(a,e,k,h,l,n,q,p){if(!h||!k)return a[0]=a[1]=a[2]=a[3]=0,e[0]=e[1]=e[2]=e[3]=0,a;if(x.isPoint(h)){q=h.x;h=h.y;"text"===k.type&&0===e[2]&&0===e[3]&&y(e,k,l);var t;switch(k.type){case "simple-marker":case "picture-marker":t=r(q,h,k,n,0);break;case "text":t=g(q,h,k,e,n,0);break;case "cim":t=f(q,h,k,n,0)}for(n=e=0;n<t.rings[0].length-1;n++)k=t.rings[0][n],k=(q-k[0])*(q-k[0])+(h-k[1])*(h-k[1]),e=Math.max(e,k);e=Math.sqrt(e);n=c.normalizeMapX(q-e,p);q=c.normalizeMapX(q+e,p);n>q&&(p=
m.getInfo(p))&&(n=p.valid,p=n[1],n=n[0],q=p);a[0]=n;a[1]=h-e;a[2]=q;a[3]=h+e}else{d.getBoundsXY(a,h);h=e[0];if(0===h){a:switch(h=0,k.type){case "simple-fill":case "picture-fill":h=k.outline;if(!h){h=0;break a}h=h.width;break;case "simple-line":h=k.width;break;case "simple-marker":h=k.size;break;case "picture-marker":h=Math.max(k.width,k.height);break;case "text":h=[0,0,0,0];y(h,k,l);h=Math.max(h[0],h[1]);break;case "cim":h=b.CIMSymbolHelper.getEnvelope(k.data),h=Math.sqrt(h.width*h.width+h.height*
h.height)}e[0]=h}h=n*h/2;a[0]-=h;a[1]-=h;a[2]+=h;a[3]+=h}return a};a.isMarkerSymbol=function(a){return"simple-marker"===a||"picture-marker"===a||"text"===a};a.graphicGeometryToNumber=function(a){switch(v.expect(a.geometry).type){case "polyline":return 1;case "polygon":case "extent":return 2}return 0};var Q=t.vec2f32.create(),T=t.vec2f32.create(),U=t.vec2f32.create(),N=t.vec2f32.create(),S=t.vec2f32.create(),V=t.vec2f32.create(),R=t.vec2f32.create();a.isPointOnPolyline=function(a,b,c,d){l.vec2.set(U,
b,c);a=a.paths;for(var f,g,e,k,h,m,n,q,r=Infinity,p=0;p<a.length;p++){var t=a[p];if(!(2>t.length))for(var u=1;u<t.length;u++)f=t[u-1][0],e=t[u-1][1],g=t[u][0],k=t[u][1],h=Math.min(f,g)-d,m=Math.min(e,k)-d,n=Math.max(f,g)+d,q=Math.max(e,k)+d,b<h||b>n||c<m||c>q||(l.vec2.set(Q,f,e),l.vec2.set(T,g,k),l.vec2.subtract(N,T,Q),l.vec2.subtract(S,Q,U),l.vec2.scale(V,N,l.vec2.dot(N,S)/l.vec2.dot(N,N)),l.vec2.subtract(R,S,V),f=l.vec2.dot(R,R),r>f&&(r=f))}return Math.sqrt(r)<=d};a.getMarkerSymbolBounds=r;a.getCIMMarkerBounds=
f;a.getTextSymbolBounds=g;a.normalizeCentralMeridian=function(a){var b,c,f,g,e,k=null;if(!a)return null;b=a.spatialReference;c=n.getInfo(b);e=b.isWebMercator?102100:4326;f=O[e].maxX;g=O[e].minX;b=O[e].plus180Line;e=O[e].minus180Line;var h,m=a.toJSON();if(!c)return m;"mesh"===a.type?h=m:x.isPoint(m)?h=J(m,f,g):x.isMultipoint(m)?(m.points=m.points.map(function(a){return J(a,f,g)}),h=m):x.isExtent(m)?h=E(m,c):x.isPolygon(m)||x.isPolyline(m)?(d.getBoundsXY(K,m),a={xmin:K[0],ymin:K[1],xmax:K[2],ymax:K[3]},
c=2*z(a.xmin,g)*f,m=0===c?m:I(m,c),a.xmin+=c,a.xmax+=c,q.extentIntersectsPolyline(a,b)&&a.xmax!==f?k=m:q.extentIntersectsPolyline(a,e)&&a.xmin!==g?k=m:h=m):h=a.clone();return null!==k?(new X).cut(k,f):h};var W=24;a.getTextSymbolSize=y;a.getTextSymbolEstimatedSize=function(a,c,d){var f=b.bidiText(c.text),g=f[0],f=f[1],k=b.alignmentUtils.getJustification(c.horizontalAlignment||"center"),h=b.alignmentUtils.getXAnchorDirection(c.horizontalAlignment||"center");d=(new b.TextShapingNew([],B,H,P,[0,.5*-H],
.5*(1-h),0,k)).getEstimatedShaping(g,f,d);d=b.TextShapingNew.getBox(d);c=e.pt2px(c.font.size)/W;a[0]=c*d.x;a[1]=c*d.y;a[2]=c*d.width;a[3]=c*d.height;return a};var O={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:{paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:h.WebMercator},minus180Line:{paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:h.WebMercator}},
4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:h.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:h.WGS84}}},X=function(){function a(){}a.prototype.cut=function(a,b){var c;if(a.rings)this.closed=!0,c=a.rings,this.minPts=4;else if(a.paths)this.closed=!1,c=a.paths,this.minPts=2;else return null;var d=c.length;b*=-2;for(var f=0;f<d;f++){var g=c[f];if(g&&g.length>=this.minPts){for(var e=[],k=0;k<g.length;k++){var h=g[k];e.push([h[0]+b,h[1]])}c.push(e)}}this.closed?
a.rings=c:a.paths=c;return a};return a}()})},"esri/views/layers/GraphicsView":function(){define(["require","exports","../../core/tsSupport/declareExtendsHelper","../../core/tsSupport/decorateHelper","../../core/accessorSupport/decorators"],function(w,a,v,e,u){Object.defineProperty(a,"__esModule",{value:!0});a.GraphicsView=function(a){return function(a){function l(){var e=null!==a&&a.apply(this,arguments)||this;e.graphics=null;e.renderer=null;e.view=null;return e}v(l,a);e([u.property()],l.prototype,
"graphics",void 0);e([u.property()],l.prototype,"renderer",void 0);e([u.property()],l.prototype,"updating",void 0);e([u.property()],l.prototype,"view",void 0);return l=e([u.subclass("esri.views.layers.GraphicsView")],l)}(u.declared(a))}})},"esri/views/2d/navigation/MapViewNavigation":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Viewpoint ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../geometry/Point ../viewpointUtils ./ZoomBox ./actions/Pan ./actions/Pinch ./actions/Rotate".split(" "),
function(w,a,v,e,u,p,l,t,h,k,d,q,x,c,n){Object.defineProperty(a,"__esModule",{value:!0});var m=new l({targetGeometry:new k}),b=[0,0];w=function(a){function f(b){b=a.call(this)||this;b._endTimer=null;b.animationManager=null;return b}v(f,a);f.prototype.initialize=function(){this.pan=new x({navigation:this});this.rotate=new n({navigation:this});this.pinch=new c({navigation:this});this.zoomBox=new q({view:this.view,navigation:this})};f.prototype.destroy=function(){this.zoomBox.destroy();this.animationManager=
this.zoomBox=null};Object.defineProperty(f.prototype,"momentumEnabled",{get:function(){return!0},enumerable:!0,configurable:!0});f.prototype.begin=function(){this._set("interacting",!0)};f.prototype.end=function(){var a=this;this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=0);this._endTimer=setTimeout(function(){a._set("interacting",!1)},0)};f.prototype.zoom=function(a,b){void 0===b&&(b=this._getDefaultAnchor());return p(this,void 0,void 0,function(){return u(this,function(c){this.stop();
this.begin();if(this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return 1>a?[2,this.zoomIn(b)]:[2,this.zoomOut(b)];this.setViewpoint(b,a,0,[0,0]);return[2]})})};f.prototype.zoomIn=function(a){return p(this,void 0,void 0,function(){var b,c;return u(this,function(d){b=this.view;c=b.constraints.snapToNextScale(b.scale);return[2,this._zoomToScale(c,a)]})})};f.prototype.zoomOut=function(a){return p(this,void 0,void 0,function(){var b,c;return u(this,function(d){b=this.view;c=b.constraints.snapToPreviousScale(b.scale);
return[2,this._zoomToScale(c,a)]})})};f.prototype.setViewpoint=function(a,b,c,d){this.begin();this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,a,b,c,d);this.end()};f.prototype.continousRotateClockwise=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){d.rotateBy(a,a,-1)})};f.prototype.continousRotateCounterclockwise=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){d.rotateBy(a,
a,1)})};f.prototype.resetRotation=function(){this.view.rotation=0};f.prototype.continousPanLeft=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){d.translateBy(a,a,[-10,0])})};f.prototype.continousPanRight=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){d.translateBy(a,a,[10,0])})};f.prototype.continousPanUp=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){d.translateBy(a,
a,[0,10])})};f.prototype.continousPanDown=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){d.translateBy(a,a,[0,-10])})};f.prototype.stop=function(){this.pan.stopMomentumNavigation();this.animationManager.stop();this.end();this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=0,this._set("interacting",!1))};f.prototype._getDefaultAnchor=function(){var a=this.view,c=a.size,a=a.padding,d=a.top,f=a.bottom;b[0]=.5*(c[0]-a.right+a.left);b[1]=.5*(c[1]-
f+d);return b};f.prototype._zoomToScale=function(a,b){void 0===b&&(b=this._getDefaultAnchor());return p(this,void 0,void 0,function(){var c,f,e,g,k,h,n,l;return u(this,function(q){c=this.view;f=c.constraints;e=c.scale;g=c.viewpoint;k=c.size;h=c.padding;n=f.canZoomInTo(a);l=f.canZoomOutTo(a);return a<e&&!n||a>e&&!l?[2]:[2,this.view.goTo(d.padAndScaleAndRotateBy(m,g,a/e,0,b,k,h),{animate:this.momentumEnabled})]})})};f.prototype._scaleRotateTranslateViewpoint=function(a,b,c,f,e){var g=this.view,k=g.size,
h=g.padding,m=g.constraints,n=g.viewpoint,l=g.scale*c,g=m.canZoomInTo(l),m=m.canZoomOutTo(l);if(1>c&&!g||1<c&&!m)c=1;d.translateBy(n,n,e);return d.padAndScaleAndRotateBy(a,n,c,f,b,k,h)};e([h.property()],f.prototype,"animationManager",void 0);e([h.property({type:Boolean,readOnly:!0})],f.prototype,"interacting",void 0);e([h.property()],f.prototype,"pan",void 0);e([h.property()],f.prototype,"pinch",void 0);e([h.property()],f.prototype,"rotate",void 0);e([h.property()],f.prototype,"view",void 0);e([h.property()],
f.prototype,"zoomBox",void 0);return f=e([h.subclass("esri.views.2d.navigation.MapViewNavigation")],f)}(h.declared(t));a.default=w})},"esri/views/2d/navigation/ZoomBox":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/screenUtils ../../../core/accessorSupport/decorators".split(" "),function(w,a,v,e,u,p,l){return function(a){function h(e){e=a.call(this,e)||this;e._container=null;e._overlay=null;
e._backgroundShape=null;e._boxShape=null;e._box={x:0,y:0,width:0,height:0};e._redraw=e._redraw.bind(e);return e}v(h,a);h.prototype.destroy=function(){this.view=null};Object.defineProperty(h.prototype,"view",{set:function(a){var d=this;this._handles&&this._handles.forEach(function(a){a.remove()});this._handles=null;this._destroyOverlay();this._set("view",a);a&&(a.on("drag",["Shift"],function(a){return d._handleDrag(a,1)}),a.on("drag",["Shift","Ctrl"],function(a){return d._handleDrag(a,-1)}))},enumerable:!0,
configurable:!0});h.prototype._start=function(a,d,e,h){this._createContainer();this._createOverlay();this.navigation.begin()};h.prototype._update=function(a,d,e,h){this._box.x=a;this._box.y=d;this._box.width=e;this._box.height=h;this._rafId||(this._rafId=requestAnimationFrame(this._redraw))};h.prototype._end=function(a,d,e,h,c){var k=this.view;a=k.toMap(p.createScreenPoint(a+.5*e,d+.5*h));e=Math.max(e/k.width,h/k.height);-1===c&&(e=1/e);this._destroyOverlay();this.navigation.end();k.goTo({center:a,
scale:k.scale*e})};h.prototype._updateBox=function(a,d,e,h){var c=this._boxShape;c.setAttributeNS(null,"x",""+a);c.setAttributeNS(null,"y",""+d);c.setAttributeNS(null,"width",""+e);c.setAttributeNS(null,"height",""+h);c.setAttributeNS(null,"class","esri-zoom-box__outline")};h.prototype._updateBackground=function(a,d,e,h){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(a,d,e,h,this.view.width,this.view.height))};h.prototype._createContainer=function(){var a=document.createElement("div");
a.className="esri-zoom-box__container";this.view.root.appendChild(a);this._container=a};h.prototype._createOverlay=function(){var a=this.view.width,d=this.view.height,e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttributeNS(null,"d","M 0 0 L "+a+" 0 L "+a+" "+d+" L 0 "+d+" Z");e.setAttributeNS(null,"class","esri-zoom-box__overlay-background");a=document.createElementNS("http://www.w3.org/2000/svg","rect");d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttributeNS("http://www.w3.org/2000/xmlns/",
"xmlns:xlink","http://www.w3.org/1999/xlink");d.setAttributeNS(null,"class","esri-zoom-box__overlay");d.appendChild(e);d.appendChild(a);this._container.appendChild(d);this._backgroundShape=e;this._boxShape=a;this._overlay=d};h.prototype._destroyOverlay=function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container=this._backgroundShape=this._boxShape=this._overlay=null};h.prototype._toSVGPath=function(a,d,e,h,c,n){e=a+e;h=d+h;return"M 0 0 L "+
c+" 0 L "+c+" "+n+" L 0 "+n+" ZM "+a+" "+d+" L "+a+" "+h+" L "+e+" "+h+" L "+e+" "+d+" Z"};h.prototype._handleDrag=function(a,d){var e=a.x,h=a.y,c=a.origin.x,k=a.origin.y,m;e>c?(m=c,c=e-c):(m=e,c-=e);h>k?(e=k,h-=k):(e=h,h=k-h);switch(a.action){case "start":this._start(m,e,c,h);break;case "update":this._update(m,e,c,h);break;case "end":this._end(m,e,c,h,d)}a.stopPropagation()};h.prototype._redraw=function(){if(this._rafId&&(this._rafId=null,this._overlay)){var a=this._box,d=a.x,e=a.y,h=a.width,a=a.height;
this._updateBox(d,e,h,a);this._updateBackground(d,e,h,a);this._rafId=requestAnimationFrame(this._redraw)}};e([l.property()],h.prototype,"navigation",void 0);e([l.property()],h.prototype,"view",null);return h=e([l.subclass("esri.views.2d.navigation.ZoomBox")],h)}(l.declared(u))})},"esri/views/2d/navigation/actions/Pan":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../viewpointUtils ../../../navigation/PanPlanarMomentumEstimator".split(" "),
function(w,a,v,e,u,p,l,t,h,k,d,q,x){return function(a){function c(c){var b=a.call(this)||this;b.animationTime=0;b.momentumEstimator=new x.PanPlanarMomentumEstimator(500,6,.92);b.momentum=null;b.tmpMomentum=d.vec3f64.create();b.momentumFinished=!1;b.viewpoint=new p({targetGeometry:new u.Point,scale:0,rotation:0});b.watch("momentumFinished",function(a){a&&b.navigation.stop()});return b}v(c,a);c.prototype.begin=function(a,b){this.navigation.begin();this.momentumEstimator.reset();this.addToEstimator(b);
this.previousDrag=b};c.prototype.update=function(a,b){this.addToEstimator(b);var c=b.center.x,d=b.center.y,e=this.previousDrag,c=e?e.center.x-c:-c,d=e?d-e.center.y:d;a.viewpoint=q.translateBy(this.viewpoint,a.viewpoint,[c||0,d||0]);this.previousDrag=b};c.prototype.end=function(a,b){this.addToEstimator(b);this.momentum=this.navigation.momentumEnabled?this.momentumEstimator.evaluateMomentum():null;this.animationTime=0;if(this.momentum)this.onAnimationUpdate(a);this.previousDrag=null;this.navigation.end()};
c.prototype.addToEstimator=function(a){var b=a.center.x,c=a.center.y,f=t.createScreenPointArray(-b,c),b=d.vec3f64.fromValues(-b,c,0);this.momentumEstimator.add(f,b,.001*a.timestamp)};c.prototype.onAnimationUpdate=function(a){var b=this;this.navigation.animationManager.animateContinous(a.viewpoint,function(c,d){b.momentumFinished=!b.momentum||b.momentum.isFinished(b.animationTime);d*=.001;if(!b.momentumFinished){var f=b.momentum.valueDelta(b.animationTime,d);k.vec3.scale(b.tmpMomentum,b.momentum.direction,
f);a.viewpoint=q.translateBy(c,c,b.tmpMomentum)}b.animationTime+=d})};c.prototype.stopMomentumNavigation=function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())};e([h.property()],c.prototype,"momentumFinished",void 0);e([h.property()],c.prototype,"viewpoint",void 0);e([h.property()],c.prototype,"navigation",void 0);return c=e([h.subclass("esri.views.2d.navigation.actions.Pan")],c)}(h.declared(l))})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),
function(w,a,v,e,u,p,l){Object.defineProperty(a,"__esModule",{value:!0});var t=function(a){function e(d,e,h,c,k){d=a.call(this,d,e,h)||this;d.sceneVelocity=c;d.direction=k;return d}v(e,a);e.prototype.value=function(d){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,d)};return e}(l.Momentum);a.PanPlanarMomentum=t;w=function(){function a(a,d,e){void 0===a&&(a=300);void 0===d&&(d=12);void 0===e&&(e=.84);this.minimumInitialVelocity=a;this.stopVelocity=d;this.friction=e;this.time=
new p.FilteredFiniteDifference(.6);this.screen=[new p.FilteredFiniteDifference(.4),new p.FilteredFiniteDifference(.4)];this.scene=[new p.FilteredFiniteDifference(.6),new p.FilteredFiniteDifference(.6),new p.FilteredFiniteDifference(.6)];this.tmpDirection=u.vec3f64.create()}a.prototype.add=function(a,d,e){this.time.hasLastValue&&.015>this.time.computeDelta(e)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(d[0]),this.scene[1].update(d[1]),this.scene[2].update(d[2]),this.time.update(e))};
a.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,d=this.screen[1].filteredDelta,a=Math.sqrt(a*a+d*d)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,
d,h){e.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var k=e.vec3.length(this.tmpDirection);0<k&&e.vec3.scale(this.tmpDirection,this.tmpDirection,1/k);return new t(a,d,h,k/this.time.filteredDelta,this.tmpDirection)};return a}();a.PanPlanarMomentumEstimator=w})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(w,a){Object.defineProperty(a,"__esModule",{value:!0});w=function(){function a(a){this.gain=
a}a.prototype.update=function(a){if(this.hasLastValue){var e=this.computeDelta(a);this.updateDelta(e)}this.lastValue=a};a.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(a.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});a.prototype.computeDelta=function(a){return a-
this.lastValue};a.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*a:a};return a}();a.FilteredFiniteDifference=w})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(w,a,v){Object.defineProperty(a,"__esModule",{value:!0});w=function(){function a(a,e,l){this._initialVelocity=a;this._stopVelocity=e;this._friction=l;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,e){var l=this.value(a);return this.value(a+
e)-l};a.prototype.valueFromInitialVelocity=function(a,e){e=Math.min(e,this.duration);var l=1-this.friction;return a*(Math.pow(l,e)-1)/Math.log(l)};return a}();a.Momentum=w})},"esri/views/2d/navigation/actions/Pinch":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../viewpointUtils ../../../navigation/RotationMomentumEstimator ../../../navigation/ZoomMomentumEstimator".split(" "),
function(w,a,v,e,u,p,l,t,h,k,d,q,x){return function(a){function c(c){var b=a.call(this,c)||this;b._animationTime=0;b._momentumFinished=!1;b._rotationMomentumEstimator=new q.RotationMomentumEstimator(.6,.15,.95);b._rotationDirection=1;b._zoomDirection=1;b._zoomMomentumEstimator=new x.ZoomMomentumEstimator;b._zoomOnly=null;b.zoomMomentum=null;b.rotateMomentum=null;b.viewpoint=new p({targetGeometry:new u.Point,scale:0,rotation:0});b.watch("_momentumFinished",function(a){a&&b.navigation.stop()});return b}
v(c,a);c.prototype.begin=function(a,b){this.navigation.begin();this._rotationMomentumEstimator.reset();this._zoomMomentumEstimator.reset();this._zoomOnly=null;this._previousAngle=this._startAngle=b.angle;this._previousRadius=this._startRadius=b.radius;this._previousCenter=b.center;this._updateTimestamp=null;a.constraints.rotationEnabled&&this.addToRotateEstimator(0,b.timestamp);this.addToZoomEstimator(b,1)};c.prototype.update=function(a,b){null===this._updateTimestamp&&(this._updateTimestamp=b.timestamp);
var c=b.angle,d=b.radius,e=b.center,h=Math.abs(180*(c-this._startAngle)/Math.PI),k=Math.abs(d-this._startRadius),m=this._startRadius/d;if(this._previousRadius){var l=d/this._previousRadius,n=180*(c-this._previousAngle)/Math.PI;this._rotationDirection=0<=n?1:-1;this._zoomDirection=1<=l?1:-1;a.constraints.rotationEnabled?(null===this._zoomOnly&&200<b.timestamp-this._updateTimestamp&&(this._zoomOnly=0<k-h),null===this._zoomOnly||this._zoomOnly?n=0:this.addToRotateEstimator(c-this._startAngle,b.timestamp)):
n=0;this.addToZoomEstimator(b,m);this.navigation.setViewpoint([e.x,e.y],1/l,n,[this._previousCenter.x-e.x,e.y-this._previousCenter.y])}this._previousAngle=c;this._previousRadius=d;this._previousCenter=e};c.prototype.end=function(a,b){if(this.navigation.momentumEnabled&&(this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,this.rotateMomentum||this.zoomMomentum))this.onAnimationUpdate(a);this.navigation.end()};
c.prototype.addToRotateEstimator=function(a,b){this._rotationMomentumEstimator.add(a,.001*b)};c.prototype.addToZoomEstimator=function(a,b){this._zoomMomentumEstimator.add(b,.001*a.timestamp)};c.prototype.canZoomIn=function(a){var b=a.scale;a=a.constraints.effectiveMaxScale;return 0===a||b>a};c.prototype.canZoomOut=function(a){var b=a.scale;a=a.constraints.effectiveMinScale;return 0===a||b<a};c.prototype.onAnimationUpdate=function(a){var b=this;this.navigation.animationManager.animateContinous(a.viewpoint,
function(c,f){var e=!b.canZoomIn(a)&&1<b._zoomDirection||!b.canZoomOut(a)&&1>b._zoomDirection,m=!b.rotateMomentum||b.rotateMomentum.isFinished(b._animationTime),e=e||!b.zoomMomentum||b.zoomMomentum.isFinished(b._animationTime);f*=.001;b._momentumFinished=m&&e;if(!b._momentumFinished){var m=b.rotateMomentum?Math.abs(b.rotateMomentum.valueDelta(b._animationTime,f))*b._rotationDirection*180/Math.PI:0,e=b.zoomMomentum?Math.abs(b.zoomMomentum.valueDelta(b._animationTime,f)):1,l=k.vec2f64.create(),n=k.vec2f64.create();
if(b._previousCenter){h.vec2.set(l,b._previousCenter.x,b._previousCenter.y);d.getPaddingScreenTranslation(n,a.size,a.padding);h.vec2.add(l,l,n);var n=a.constraints,p=a.scale,q=p*e;1>e&&!n.canZoomInTo(q)?(e=p/n.effectiveMaxScale,b.zoomMomentum=null,b.rotateMomentum=null):1<e&&!n.canZoomOutTo(q)&&(e=p/n.effectiveMinScale,b.zoomMomentum=null,b.rotateMomentum=null);d.scaleAndRotateBy(c,a.viewpoint,e,m,l,a.size)}}b._animationTime+=f})};c.prototype.stopMomentumNavigation=function(){if(this.rotateMomentum||
this.zoomMomentum)this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop()};e([t.property()],c.prototype,"_momentumFinished",void 0);e([t.property()],c.prototype,"viewpoint",void 0);e([t.property()],c.prototype,"navigation",void 0);return c=e([t.subclass("esri.views.2d.navigation.actions.Pinch")],c)}(t.declared(l))})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require",
"exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(w,a,v,e){Object.defineProperty(a,"__esModule",{value:!0});w=function(a){function e(e,p,h,k){void 0===e&&(e=3);void 0===p&&(p=.01);void 0===h&&(h=.95);void 0===k&&(k=12);return a.call(this,e,p,h,k)||this}v(e,a);e.prototype.add=function(e,p){if(this.value.hasLastValue){var h=this.value.lastValue;for(e-=h;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;e=h+e}a.prototype.add.call(this,e,p)};return e}(e.MomentumEstimator);
a.RotationMomentumEstimator=w})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),function(w,a,v,e,u,p){Object.defineProperty(a,"__esModule",{value:!0});w=function(){function a(a,e,k,d){void 0===a&&(a=2.5);void 0===e&&(e=.01);void 0===k&&(k=.95);void 0===d&&(d=12);this.minimumInitialVelocity=a;this.stopVelocity=e;this.friction=k;this.maxVelocity=d;this.value=new u.FilteredFiniteDifference(.8);
this.time=new u.FilteredFiniteDifference(.3)}a.prototype.add=function(a,e){if(this.time.hasLastValue){if(.01>this.time.computeDelta(e))return;if(this.value.hasFilteredDelta){var h=this.value.computeDelta(a);0>this.value.filteredDelta*h&&this.value.reset()}}this.time.update(e);this.value.update(a)};a.prototype.reset=function(){this.value.reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var a=this.value.filteredDelta/this.time.filteredDelta,
a=e.clamp(a,-this.maxVelocity,this.maxVelocity);return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,e,k){return new p.Momentum(a,e,k)};return a}();a.MomentumEstimator=w})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(w,a,v,e,u){Object.defineProperty(a,"__esModule",{value:!0});var p=function(a){function e(e,
k,d){return a.call(this,e,k,d)||this}v(e,a);e.prototype.value=function(e){e=a.prototype.value.call(this,e);return Math.exp(e)};e.prototype.valueDelta=function(e,k){var d=a.prototype.value.call(this,e);e=a.prototype.value.call(this,e+k);return Math.exp(e-d)};return e}(e.Momentum);a.ZoomMomentum=p;w=function(a){function e(e,k,d,l){void 0===e&&(e=2.5);void 0===k&&(k=.01);void 0===d&&(d=.95);void 0===l&&(l=12);return a.call(this,e,k,d,l)||this}v(e,a);e.prototype.add=function(e,k){a.prototype.add.call(this,
Math.log(e),k)};e.prototype.createMomentum=function(a,e,d){return new p(a,e,d)};return e}(u.MomentumEstimator);a.ZoomMomentumEstimator=w})},"esri/views/2d/navigation/actions/Rotate":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../viewpointUtils".split(" "),
function(w,a,v,e,u,p,l,t,h,k,d){var q=k.vec2f64.create(),x=k.vec2f64.create();return function(a){function c(c){c=a.call(this,c)||this;c._previousCenter=k.vec2f64.create();c.viewpoint=new p({targetGeometry:new u.Point,scale:0,rotation:0});return c}v(c,a);c.prototype.begin=function(a,b){this.navigation.begin();h.vec2.set(this._previousCenter,b.center.x,b.center.y)};c.prototype.update=function(a,b){var c=a.state,e=c.size,c=c.padding;h.vec2.set(q,b.center.x,b.center.y);d.getAnchor(x,e,c);a.viewpoint=
d.rotateBy(this.viewpoint,a.content.viewpoint,d.angleBetween(x,this._previousCenter,q));h.vec2.copy(this._previousCenter,q)};c.prototype.end=function(a,b){this.navigation.end()};e([t.property()],c.prototype,"viewpoint",void 0);e([t.property()],c.prototype,"navigation",void 0);return c=e([t.subclass("esri.views.2d.actions.Rotate")],c)}(t.declared(l))})},"esri/views/2d/magnifier/MagnifierView2D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../request ../../../core/promiseUtils ../../webgl ../engine".split(" "),
function(w,a,v,e,u,p,l,t,h){Object.defineProperty(a,"__esModule",{value:!0});var k=h.enums.WGLDrawPhase,d=function(a){function d(){var c=a.call(this)||this;c.visible=!1;return c}v(d,a);d.prototype.destroy=function(){this._readbackTexture&&(this._readbackTexture.dispose(),this._readbackTexture=null,this._maskTexture.dispose(),this._maskTexture=null,this._overlayTexture.dispose(),this._overlayTexture=null,this._vertexArrayObject.dispose(),this._vertexArrayObject=null,this._program.dispose(),this._resourcesPromise=
this._program=null)};Object.defineProperty(d.prototype,"magnifier",{get:function(){return this._magnifier},set:function(a){var c=this;this._magnifier=a;this._handle&&this._handle.remove();this._handle=a.watch("version",function(){c.visible=a.visible});this.visible=a.visible},enumerable:!0,configurable:!0});d.prototype.doRender=function(a){var c=this.stage.context;if(!this._resourcesPromise)this._resourcesPromise=this._loadResources(w.toUrl("../../../images/magnifier/mask.png"),w.toUrl("../../../images/magnifier/overlay.png"));
else if(a.drawPhase===k.MAP&&this._canRender()){this._updateResources(c);var d=this._magnifier,b=1/d.factor,e=Math.ceil(b*this.overlay.width),f=Math.ceil(b*this.overlay.height),g=a.state.size,h=a.pixelRatio,b=h*g[0];a=h*g[1];var l=d.position||{x:.5*g[0],y:.5*g[1]},g=h*l.x,h=a-h*l.y,l=.5*e,p=.5*f;l>g?g=l:g>=b-l&&(g=b-l-1);p>h?h=p:h>=a-p&&(h=a-p-1);var l=g-l,p=h-p,q=this._readbackTexture;c.bindTexture(q,0);c.gl.copyTexImage2D(q.descriptor.target,0,q.descriptor.pixelFormat,l,p,e,f,0);e=(e=this.stage.background&&
this.stage.background.color)?[e.a*e.r/255,e.a*e.g/255,e.a*e.b/255,e.a]:[1,1,1,1];f=-1+(g+d.offsetX)/b*2;d=-1+(h-d.offsetY)/a*2;b=this.overlay.width/b*2;a=this.overlay.height/a*2;g=this._program;c.bindVAO(this._vertexArrayObject);c.bindTexture(this._overlayTexture,6);c.bindTexture(this._maskTexture,7);c.bindProgram(g);g.setUniform4fv("u_background",e);g.setUniform1i("u_readbackTexture",0);g.setUniform1i("u_overlyTexture",6);g.setUniform1i("u_maskTexture",7);g.setUniform2f("u_drawPos",f,d);g.setUniform1f("u_width",
b);g.setUniform1f("u_height",a);c.setStencilTestEnabled(!1);c.drawArrays(5,0,4);c.bindVAO()}};d.prototype._canRender=function(){return this.mask&&this.overlay&&null!=this._magnifier};d.prototype._loadResources=function(a,d){return e(this,void 0,void 0,function(){var c,b,e;return u(this,function(f){switch(f.label){case 0:return[4,l.all([p(a,{responseType:"image"}),p(d,{responseType:"image"})])];case 1:return c=f.sent(),b=c[0].data,e=c[1].data,this.mask=b,this.overlay=e,this.requestRender(),[2]}})})};
d.prototype._updateResources=function(a){if(!this._readbackTexture){var c=1/this._magnifier.factor,d=Math.ceil(c*this.overlay.width),c=Math.ceil(c*this.overlay.height);this._program=h.createMagnifierProgram(a);var b=new Uint16Array([0,1,0,0,1,1,1,0]);this._vertexArrayObject=new t.VertexArrayObject(a,h.magnifier.attributes,{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:t.BufferObject.createVertex(a,35044,b)});this._overlayTexture=new t.Texture(a,{target:3553,
pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.overlay);this._maskTexture=new t.Texture(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.mask);this._readbackTexture=new t.Texture(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:d,height:c})}};return d}(h.DisplayObject);a.default=d})},"*noref":1}});
define("require exports ./LabelManager ./layers/graphics/GraphicsView2D ./navigation/MapViewNavigation ./magnifier/MagnifierView2D".split(" "),function(w,a,v,e,u,p){Object.defineProperty(a,"__esModule",{value:!0});a.LabelManager=v.default;a.GraphicsView2D=e.default;a.MapViewNavigation=u.default;a.MagnifierView2D=p.default});