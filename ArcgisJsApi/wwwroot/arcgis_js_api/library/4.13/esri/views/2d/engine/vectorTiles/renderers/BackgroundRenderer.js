// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../MemoryBuffer ./rendererUtils".split(" "),function(w,x,t,u,v,f,h,q){return function(){function e(b){this._patternMatrix=u.mat3f32.create();this._color=v.vec4f32.create();this._rendererInitialized=this._solidrendererInitialized=!1;this._programOptions={id:!1,pattern:!1};this._programCache=b;this._color.set([1,0,0,1])}e.prototype.dispose=
function(){this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};e.prototype.renderSolidColor=function(b,a){this._solidrendererInitialized||this._initializeSolidRenderer(b);b.bindVAO(this._solidVertexArrayObject);var c=this._programOptions;c.id=!1;c.pattern=!1;c=this._programCache.getProgram(0,0,c);b.bindProgram(c);c.setUniformMatrix4fv("u_transformMatrix",
a.u_matrix);c.setUniform2fv("u_normalized_origin",a.u_normalized_origin);c.setUniform1f("u_coord_range",a.u_coord_range||4096);c.setUniform1f("u_depth",a.u_depth||0);c.setUniform4fv("u_color",a.u_color||this._color);b.drawArrays(5,0,4);b.bindVAO()};e.prototype.render=function(b,a,c,g,e,k,f,h,n){this._rendererInitialized||this._initialize(b);var l=a.getPaintValue("background-color",e);n*=a.getPaintValue("background-opacity",e);var r=a.getPaintValue("background-pattern",e),p=void 0!==r,m=l[3]*n;k=4===
k;var d=this._programOptions;d.id=k;d.pattern=p;d=this._programCache.getProgram(0,(k?1:0)<<1|(p?1:0),d);b.bindVAO(this._vertexArrayObject);b.bindProgram(d);d.setUniform1f("u_coord_range",g.coordRange);d.setUniform1f("u_depth",a.z||0);d.setUniformMatrix4fv("u_transformMatrix",g.tileTransform.transform);d.setUniform2fv("u_normalized_origin",g.tileTransform.displayCoord);if(p){a=f.getMosaicItemPosition(r,!0);if(!a)return 0;g=512*(h>q.HIGH_RES_CUTOFF?2:1)*Math.max(Math.pow(2,Math.round(e)-g.key.level),
1);t.mat3.identity(this._patternMatrix);e=g/a.size[1];this._patternMatrix[0]=g/a.size[0];this._patternMatrix[4]=e;f.bind(b,9729,a.page,5);d.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix);d.setUniform1f("u_opacity",n);d.setUniform2f("u_pattern_tl",a.tl[0],a.tl[1]);d.setUniform2f("u_pattern_br",a.br[0],a.br[1]);d.setUniform1i("u_texture",5)}else this._color[0]=m*l[0],this._color[1]=m*l[1],this._color[2]=m*l[2],this._color[3]=m,d.setUniform4fv("u_color",this._color);k&&(c=q.int32To4Bytes(c),
d.setUniform4f("u_id",c[0],c[1],c[2],c[3]));b.drawArrays(5,0,4);b.bindVAO();return 2};e.prototype._initializeSolidRenderer=function(b){if(this._solidrendererInitialized)return!0;var a=new Int8Array([0,0,1,0,0,1,1,1]),a=f.BufferObject.createVertex(b,35044,a);this._solidVertexArrayObject=new f.VertexArrayObject(b,this._programCache.getProgramAttributes(0),{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:a});return this._solidrendererInitialized=!0};e.prototype._initialize=
function(b){if(this._rendererInitialized)return!0;var a=[];a.push(h.i1616to32(0,0));a.push(h.i1616to32(1,0));a.push(h.i1616to32(0,1));a.push(h.i1616to32(1,1));a=new Uint32Array(a);a=f.BufferObject.createVertex(b,35044,a);this._vertexArrayObject=new f.VertexArrayObject(b,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:a});return this._rendererInitialized=!0};return e}()});