// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ./BitmapLayerView2D ./LayerView2D ./support/ExportStrategy ./support/popupUtils2D ../../layers/LayerView ../../layers/MapImageLayerView ../../layers/RefreshableLayerView".split(" "),
function(B,C,k,l,f,m,n,p,h,q,c,r,t,u,v,w,x,y,z){var A=p.getLogger("esri.views.2d.layers.MapImageLayerView2D");return function(g){function a(){var a=null!==g&&g.apply(this,arguments)||this;a._exportImageParameters=null;a._exportImageVersion=-1;return a}l(a,g);a.prototype.hitTest=function(a,b){return null};a.prototype.update=function(a){this.strategy.update(a)};a.prototype.attach=function(){var a=this,b=this.layer,c=b.imageMaxWidth,d=b.imageMaxHeight,e=b.version,b=10.3<=e,e=10<=e;this.strategy=new v({container:this.container,
fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:c,imageMaxHeight:d,imageRotationSupported:b,imageNormalizationSupported:e,hidpi:!0});this._exportImageParameters=new r.ExportImageParameters({view:this.view,layer:this.layer});this.handles.add(q.init(this._exportImageParameters,"version",function(b){a._exportImageVersion!==b&&(a._exportImageVersion=b,a.requestUpdate())}),"mapimagelayerview-update")};a.prototype.detach=function(){this.strategy.destroy();
this.handles.remove("mapimagelayerview-update");this._exportImageParameters.layer=null;this._exportImageParameters.destroy();this._exportImageParameters=null;this._exportImageVersion=-1;this.container.removeAllChildren()};a.prototype.moveStart=function(){};a.prototype.viewChange=function(){};a.prototype.moveEnd=function(){this.requestUpdate()};a.prototype.createFetchPopupFeaturesQueryGeometry=function(a,b){return w.createQueryGeometry(a,b,this.view)};a.prototype.doRefresh=function(a){return n(this,
void 0,void 0,function(){return m(this,function(a){this.requestUpdate();return[2]})})};a.prototype.isUpdating=function(){return this.attached&&(this.strategy.updating||this.updateRequested)};a.prototype.fetchImage=function(a,b,c,d){d=k({timeExtent:this._exportImageParameters.timeExtent,timestamp:this.refreshTimestamp},d);return this.layer.fetchImage(a,b,c,d).catch(function(a){h.isAbortError(a)||A.error(a);return h.reject(a)})};f([c.property()],a.prototype,"strategy",void 0);f([c.property({dependsOn:["strategy.updating"]})],
a.prototype,"updating",void 0);return a=f([c.subclass("esri.views.2d.layers.MapImageLayerView2D")],a)}(c.declared(y.MapImageLayerView(z.RefreshableLayerView(t.BitmapLayerView2D(u.LayerView2D(x))))))});