// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/PooledArray"],function(g,h,e){Object.defineProperty(h,"__esModule",{value:!0});var k=function(){return function(){}}();g=function(){function b(d,c){this.renderer=d;this.handlers=c;this._pendingAddsRemoves=new Map;this._adds=new e;this._removes=new e;this._updates=new e({allocator:function(a){return a?a:new k},deallocator:function(a){a.renderGeometry=null;return a}})}b.prototype.dispose=function(){this._adds.prune();this._removes.prune();this._updates.prune()};
Object.defineProperty(b.prototype,"updating",{get:function(){return 0<this._pendingAddsRemoves.size||0<this._updates.length},enumerable:!0,configurable:!0});b.prototype.commitChanges=function(){var d=this;if(0!==this._pendingAddsRemoves.size||0!==this._updates.length){this._pendingAddsRemoves.forEach(function(a,c){switch(a){case 0:d._adds.push(c);break;case 1:d._removes.push(c)}});for(var c=0;c<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[c].renderGeometry)?this._updates.removeUnorderedIndex(c):
c++;this.renderer.modify(this._adds.data,this._adds.length,this._removes.data,this._removes.length,this._updates.data,this._updates.length);this._adds.clear();this._removes.clear();this._pendingAddsRemoves.clear();this._updates.clear();this.handlers.emitContentChanged();this.handlers.emitUpdatingChanged()}};b.prototype.add=function(d){for(var c=0===this._pendingAddsRemoves.size,a=0;a<d.length;a++)this._pendingAddsRemoves.set(d[a],0);c&&0<this._pendingAddsRemoves.size&&this.handlers.emitUpdatingChanged()};
b.prototype.remove=function(d){for(var c=0===this._pendingAddsRemoves.size,a=0;a<d.length;a++){var b=d[a],f=this._pendingAddsRemoves.get(b);0===f?this._pendingAddsRemoves.set(b,2):2!==f&&this._pendingAddsRemoves.set(b,1)}c&&0<this._pendingAddsRemoves.size&&this.handlers.emitUpdatingChanged()};b.prototype.modify=function(d,c){for(var a=0===this._updates.length,b=0;b<d.length;b++){var f=d[b],e=this._updates.pushNew();e.renderGeometry=f;e.updateType=c}a&&0<this._updates.length&&this.handlers.emitUpdatingChanged()};
return b}();h.DrapedUpdates=g});