// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../lib/GLMaterial ./internal/MaterialUtil ./internal/waterMaterialUtils ../shaders/WaterSurfacePrograms ../../../webgl/renderState".split(" "),function(g,k,l,m,h,e,n,f){Object.defineProperty(k,"__esModule",{value:!0});g=function(d){function a(b){b=d.call(this,b)||this;b.updateParameters();return b}l(a,d);a.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters());this.selectProgram()};a.prototype._selectPipelineState=
function(){this.pipelineState=f.makePipelineState({blending:this.params.transparent&&f.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:this.params.writeDepth&&f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams})};a.prototype.getProgramTemplate=function(){return n.color};a.prototype.selectProgram=function(){this.program=this.programRep.getProgram(this.getProgramTemplate(),{slice:this.params.slicePlaneEnabled,receiveShadows:this.params.receiveShadows});this._selectPipelineState()};
a.prototype.beginSlot=function(b){var a=5;this.params.transparent&&(a=this.params.writeDepth?7:10);return b===a};a.prototype.getProgram=function(){return this.program};a.prototype._initTextures=function(b){this.texturePaths=[this.params.waveTexture,this.params.perturbationTexture];e.waterTextureRepo.initialize(b,this.texturePaths)};a.prototype._bindUniforms=function(b,a){b.bindProgram(this.program);b.setPipelineState(this.pipelineState);e.waterTextureRepo.bindRepo(b);this.program.setUniform4fv("waterColor",
this.params.color);this._setWaveUniforms(this.program)};a.prototype._setWaveUniforms=function(b){b.setUniform1i("texWaveNormal",0);b.setUniform1i("texWavePerturbation",1);b.setUniform4f("waveParams",this.params.waveStrength,this.params.waveTextureRepeat,this.params.flowStrength,this.params.flowOffset);b.setUniform2f("waveDirection",this.params.waveDirection[0]*this.params.waveVelocity,this.params.waveDirection[1]*this.params.waveVelocity);b.setUniform1f("timeElapsed",.001*this.material.animation.time*
this.params.animationSpeed)};a.prototype._updateShadowState=function(b){b.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:b.shadowMappingEnabled}),this.updateParameters())};a.prototype.bind=function(b,a){e.waterTextureRepo.ready()?(this._updateShadowState(a),this._bindUniforms(b,a)):e.waterTextureRepo.loading()||this._initTextures(b)};a.prototype.release=function(b){};a.prototype.bindView=function(b,a){b=this.program;b.setUniform3fv("localOrigin",
a.origin);h.bindView(a.origin,a.view,b);h.bindCamPos(a.origin,a.viewInvTransp,b);this.params.slicePlaneEnabled&&h.bindSlicePlane(a.origin,a.slicePlane,b);a.shadowMappingEnabled&&(a.shadowMap.bind(b),a.shadowMap.bindView(b,a.origin))};a.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};a.prototype.getDrawMode=function(){return 4};return a}(m);k.WaterGLMaterial=g;m=function(d){function a(){return null!==d&&d.apply(this,arguments)||this}l(a,d);a.prototype.bind=
function(a,c){a.bindProgram(this.program);a.setPipelineState(this.pipelineState);this.program.setUniform4fv("waterColor",this.params.color)};a.prototype.bindView=function(a,c){this.program.setUniform3fv("localOrigin",c.origin);h.bindView(c.origin,c.view,this.program)};a.prototype.beginSlot=function(a){return null==a};a.prototype.getProgramTemplate=function(){return n.drapedColor};return a}(g);k.WaterDrapedGLMaterial=m;g=function(d){function a(){return null!==d&&d.apply(this,arguments)||this}l(a,d);
a.prototype.bind=function(a,c){e.waterTextureRepo.ready()?(a.bindProgram(this.program),a.setPipelineState(this.pipelineState),e.waterTextureRepo.bindRepo(a),this._setWaveUniforms(this.program)):e.waterTextureRepo.loading()||this._initTextures(a)};a.prototype.bindView=function(a,c){this.program.setUniform3fv("localOrigin",c.origin);h.bindView(c.origin,c.view,this.program)};a.prototype.beginSlot=function(a){return 20===a};a.prototype._selectPipelineState=function(){this.pipelineState=f.makePipelineState({depthTest:{func:513},
depthWrite:this.params.writeDepth&&f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams})};a.prototype.getProgramTemplate=function(){return n.drapedNormal};return a}(g);k.WaterNormalGLMaterial=g});