// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/ComponentUtils".split(" "),function(g,x,y,p,q,r,t,d,u,v,h){g=function(){function b(a,e,b){this.type="draped";this.isElevationSource=this._addedToStage=
!1;this.graphics3DSymbolLayer=a;this.renderGeometries=e;this.boundingBox=b;this.stage=null;this._visible=!1}b.prototype.initialize=function(a,e){this.stage=e};b.prototype.setVisibility=function(a){if(null!=this.stage){if(this._visible!==a){this._visible=a;var e=this.stage.renderView.getDrapedRenderer();if(a&&!this._addedToStage)return this._addedToStage=!0,e.addRenderGeometries(this.renderGeometries),!0;if(!a&&!this._addedToStage)return!1;for(var b=0,f=this.renderGeometries;b<f.length;b++){var c=
f[b],d=c.instanceParameters.componentVisibilities,d=a?h.unhideAllComponents(d):h.hideAllComponents(d);c.instanceParameters.componentVisibilities=d}e.updateRenderGeometries(this.renderGeometries,1);return!0}return!1}};b.prototype.destroy=function(){this.stage&&this._addedToStage&&this.stage.renderView.getDrapedRenderer().removeRenderGeometries(this.renderGeometries);this._visible=this._addedToStage=!1;this.stage=null};b.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,
e){return Math.max(a,e.bsRadius)},0)};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=t.vec3f64.create());return r.vec3.set(a,0,0,0)};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=d.create());return d.empty(a)};b.prototype.addHighlight=function(a,e){var b=this;this.renderGeometries.forEach(function(d){var c=d.addHighlight(e);a.addRenderGeometry(d,c,b)});this._addedToStage&&this.stage.renderView.getDrapedRenderer().updateHighlights(this.renderGeometries)};b.prototype.removeHighlight=
function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};b.prototype.removeRenderGeometryHighlight=function(a,b){a.removeHighlight(b);this._addedToStage&&this.stage.renderView.getDrapedRenderer().updateHighlights(this.renderGeometries)};b.prototype.getProjectedBoundingBox=function(a,b,f,w,c){return q(this,void 0,void 0,function(){var e,g,k,h;return p(this,function(l){switch(l.label){case 0:d.empty(c);for(e=0;e<this.renderGeometries.length;e++)g=this.renderGeometries[e],this._getRenderGeometryProjectedBoundingRect(g,
a,n,f),d.expand(c,n);if(!b)return[3,5];d.center(c,m);k=void 0;h=v.demResolutionForBoundingBox(c,b);l.label=1;case 1:return l.trys.push([1,3,,4]),[4,b.service.queryElevation(m[0],m[1],w,h)];case 2:return k=l.sent(),[3,4];case 3:return l.sent(),k=null,[3,4];case 4:null!=k&&(c[2]=Math.min(c[2],k),c[5]=Math.max(c[5],k)),l.label=5;case 5:return[2,c]}})})};b.prototype._getRenderGeometryProjectedBoundingRect=function(a,b,g,h){if(this.boundingBox)d.set(f,this.boundingBox);else{var c=a.center;a=a.bsRadius;
f[0]=c[0]-a;f[1]=c[1]-a;f[2]=c[2]-a;f[3]=c[0]+a;f[4]=c[1]+a;f[5]=c[2]+a}b(f,0,2);this.calculateRelativeScreenBounds&&h.push({location:d.center(f),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return d.toRect(f,g)};return b}();var n=u.create(),f=d.create(),m=[0,0,0];return g});