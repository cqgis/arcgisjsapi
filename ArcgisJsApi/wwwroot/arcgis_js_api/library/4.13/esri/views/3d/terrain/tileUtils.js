// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/maybe","../../../core/PooledArray"],function(h,d,m,k){function n(a){return a[0]+"/"+a[1]+"/"+a[2]}function l(a,b){b(a);if(!a.isLeaf){var c=0;for(a=a.children;c<a.length;c++)l(a[c],b)}}function p(a,b,c){a=a.screenDepth;b=b.screenDepth;return a<b?-c:a>b?c:0}Object.defineProperty(d,"__esModule",{value:!0});h=function(){function a(){this.q=new k;this._last=null}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length&&(!this._last||this._last.isLeaf)},
enumerable:!0,configurable:!0});a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null};a.prototype.reset=function(a,c){this.q.clear();this._eye=c;if(a&&(this.q.pushArray(a),m.isSome(this._eye))){var b=this._eye;this.q.sort(function(a,c){return c.distanceToSquared(b)-a.distanceToSquared(b)})}this._last=null};a.prototype.skipSubtree=function(){this._last=null};a.prototype.next=function(){if(this._last&&!this._last.isLeaf){var a=this._last.children;if(m.isSome(this._eye)){var c=
this._eye;g.pushArray(a);g.sort(function(a,b){return b.distanceToSquared(c)-a.distanceToSquared(c)});this.q.pushArray(g.data,g.length);g.clear()}else this.q.pushArray(a)}return this._last=this.q.pop()};return a}();d.IteratorPreorder=h;var g=new k;h=function(){function a(){this.q=new k}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length},enumerable:!0,configurable:!0});a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a){var b=
this.q.data[a];b.isLeaf||this.q.pushArray(b.children)}};a.prototype.next=function(){return this.q.pop()};return a}();d.IteratorPostorder=h;d.lij2str=n;d.tile2str=function(a){return n(a.lij)};d.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)l(a[c],b);else l(a,b)};d.findParentByLIJ=function(a,b){for(;a;a=a.parent)if(a.hasLij(b))return a;return null};d.fallsWithinLayer=function(a,b,c){if(!b)return!1;var f=b.fullExtent,e=a.extent;if(c){if(e[0]<f.xmin||e[1]<f.ymin||
e[2]>f.xmax||e[3]>f.ymax)return!1}else if(f.xmin>e[2]||f.ymin>e[3]||f.xmax<e[0]||f.ymax<e[1])return!1;a=a.surface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};d.getTileNLevelsUp=function(a,b){for(;b--;)a=a.parent;return a};d.getRootTile=function(a){for(;a.parent;)a=a.parent;return a};d.nextTileInAncestry=function(a,b){var c=a.lij[0]-b.lij[0]-1,f=a.lij[2]>>c,e=0;a.lij[1]>>c&1&&(e+=2);f&1&&(e+=1);return b.children[e]};
d.sortTiles=function(a,b){b.sort(function(b,f){return p(b,f,a)})};d.compareTiles=p;d.computeUpsampleInfo=function(a,b,c){for(var f=1,e=0,d=0;a!==b;)if(f*=.5,e*=.5,d*=.5,a.lij[2]&1&&(e+=.5),0===(a.lij[1]&1)&&(d+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of upsampleTile");c.init(b,e,d,f)};d.hasVisibleSiblings=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.parent;if(d)for(var e=0;4>e;e++){var g=d.children[e];if(g&&g!==c&&g.visible)return!0}}return!1}});