// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/mat2f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./GeometryData ./GeometryUtil ./Util ../materials/internal/MaterialUtil ../shaders/PathPrograms".split(" "),
function(X,Y,Z,z,H,P,Q,I,M,p,l,f,n,C,D,N,y,R,u){var w;(function(r){function w(){return{up:n.vec3f64.create(),right:n.vec3f64.create()}}r.makeFrame=w;r.profileSpaceToVertexSpace=function(c,a,b){c[0]=b[0]*a.right[0]+b[1]*a.up[0];c[1]=b[0]*a.right[1]+b[1]*a.up[1];c[2]=b[0]*a.right[2]+b[1]*a.up[2]};r.vertexSpaceToProfileSpace=function(c,a,b){p.vec2.set(c,f.vec3.dot(b,a.right),f.vec3.dot(b,a.up))};var h=function(){function c(){this.pos=n.vec3f64.create();this.posES=n.vec3f64.create();this.posGS=n.vec3f64.create();
this.vRight=n.vec3f64.create();this.vLeft=n.vec3f64.create();this.frame=w();this.rotationFrame=w();this.rotationRight=l.vec2f64.create();this.rotationAngle=0;this.miterStretch=Q.mat2f64.create()}c.prototype.setFrameFromUpVector=function(a){f.vec3.copy(this.frame.up,a);f.vec3.add(v,this.vLeft,this.vRight);f.vec3.normalize(v,v);f.vec3.scale(x,this.frame.up,f.vec3.dot(v,this.frame.up));f.vec3.subtract(E,v,x);f.vec3.normalize(E,E);f.vec3.cross(this.frame.right,E,this.frame.up)};c.prototype.computeRotationAxisAndAngleFromUpVector=
function(){f.vec3.copy(this.rotationFrame.up,this.frame.up);f.vec3.copy(this.rotationFrame.right,this.frame.right);p.vec2.set(this.rotationRight,1,0);f.vec3.scale(x,this.frame.up,f.vec3.dot(this.frame.up,this.vLeft));f.vec3.subtract(x,this.vLeft,x);f.vec3.negate(x,x);f.vec3.normalize(x,x);f.vec3.scale(v,this.frame.up,f.vec3.dot(this.frame.up,this.vRight));f.vec3.subtract(v,this.vRight,v);f.vec3.normalize(v,v);f.vec3.cross(J,this.rotationFrame.up,this.vLeft);this.rotationAngle=H.sign(f.vec3.dot(J,
this.vRight))*(Math.PI-H.acosClamped(f.vec3.dot(x,v)));0<Math.abs(this.rotationAngle)&&P.mat2.set(this.miterStretch,1+(1/Math.cos(.5*this.rotationAngle)-1),0,0,1);this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return c}();r.PathVertex=h;h=function(){function c(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=[];this.uvIndices=this.uvs=null}c.prototype.addVertex=function(a,b){this.vertices.push(l.vec2f64.clone(a));
this.vertexNormals.push(l.vec2f64.clone(b));return this.vertices.length-1};c.prototype.addUV=function(a){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(a);return this.uvs.length-1};c.prototype.addPole=function(a,b){void 0===b&&(b=null);this.poles.push({position:l.vec2f64.clone(a),normal:b?l.vec2f64.clone(b):null});return this.poles.length-1};c.prototype.addSegment=function(a,b,d){void 0===b&&(b=null);void 0===d&&(d=null);this.vertexIndices.push(a.v0);this.vertexIndices.push(a.v1);b&&(this.uvIndices.push(b.v0),
this.uvIndices.push(b.v1));d&&(this.poleIndices.push(d.v0),this.poleIndices.push(d.v1))};Object.defineProperty(c.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0});c.prototype.hasUV=function(){return null!=this.uvs};c.prototype.translate=function(a,b){for(var d=0,k=this.vertices;d<k.length;d++){var e=k[d];e[0]+=a;e[1]+=b}d=0;for(k=this.poles;d<k.length;d++)e=k[d],e.position[0]+=a,e.position[1]+=b};c.circle=function(a){void 0===a&&(a=20);var b=
new c,d={v0:0,v1:0};b.addPole(l.vec2f64.fromValues(0,0));for(var k=0;k<a;++k){var e=2*k*Math.PI/a,g=Math.cos(e),f=Math.sin(e),e=l.vec2f64.fromValues(.5*g,.5*f),g=l.vec2f64.fromValues(g,f);b.addVertex(e,g);b.addUV(k/a)}b.addUV(1);for(k=0;k<a-1;++k)g={v0:k,v1:k+1},b.addSegment(g,g,d);b.addSegment({v0:a-1,v1:0},{v0:a-1,v1:a},d);return b};c.rect=function(){var a=new c,b=l.vec2f64.fromValues(-.5,-.5),d=l.vec2f64.fromValues(.5,-.5),k=l.vec2f64.fromValues(.5,.5),e=l.vec2f64.fromValues(-.5,.5),g=l.vec2f64.fromValues(0,
-1),f=l.vec2f64.fromValues(1,0),t=l.vec2f64.fromValues(0,1),q=l.vec2f64.fromValues(-1,0);a.addUV(0);a.addUV(1);a.addPole(l.vec2f64.fromValues(0,.5),t);a.addPole(l.vec2f64.fromValues(0,.5));a.addPole(l.vec2f64.fromValues(0,-.5));a.addPole(l.vec2f64.fromValues(0,-.5),g);var A={v0:0,v1:1};a.addVertex(b,g);a.addVertex(d,g);a.addSegment({v0:0,v1:1},A,{v0:3,v1:3});a.addVertex(d,f);a.addVertex(k,f);a.addSegment({v0:2,v1:3},A,{v0:2,v1:1});a.addVertex(k,t);a.addVertex(e,t);a.addSegment({v0:4,v1:5},A,{v0:0,
v1:0});a.addVertex(e,q);a.addVertex(b,q);a.addSegment({v0:6,v1:7},A,{v0:1,v1:2});return a};return c}();r.Profile=h;h=function(){function c(a){this.vertices=[];this.offset=n.vec3f64.create();this.xform=M.mat4f64.create();this.vertices=a;f.vec3.copy(this.offset,this.vertices[Math.floor((a.length-1)/2)].pos);a=0;for(var b=this.vertices;a<b.length;a++){var d=b[a];f.vec3.subtract(d.pos,d.pos,this.offset)}I.mat4.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}c.prototype.updatePathVertexInformation=
function(){var a=this.vertices.length,b=this.vertices[0];b.index=0;f.vec3.set(b.vLeft,0,0,0);b.vLeftLength=0;f.vec3.subtract(b.vRight,this.vertices[1].pos,b.pos);b.vRightLength=f.vec3.length(b.vRight);f.vec3.normalize(b.vRight,b.vRight);for(var d=b,k=1;k<a;++k)b=this.vertices[k],b.index=k,f.vec3.copy(b.vLeft,d.vRight),b.vLeftLength=d.vRightLength,k<a-1?(f.vec3.subtract(b.vRight,this.vertices[k+1].pos,b.pos),b.vRightLength=f.vec3.length(b.vRight),f.vec3.normalize(b.vRight,b.vRight)):(f.vec3.copy(b.vRight,
b.vLeft),b.vRightLength=b.vLeftLength),d=b};return c}();r.Path=h;r.computeMinimumRotationTangentFrame=function(c,a){var b=null,d=c.vertices.length,k=n.vec3f64.create(),e=n.vec3f64.create(),g=n.vec3f64.create(),F=n.vec3f64.create(),t=n.vec3f64.create(),q=n.vec3f64.create(),A=C.plane.create(),m=c.vertices[0];f.vec3.copy(e,a);f.vec3.set(k,0,1,0);N.makeOrthoBasisDirUpFallback(m.vRight,e,k,k,g,e,.99619469809);f.vec3.copy(m.frame.up,e);f.vec3.copy(m.frame.right,g);b=m;for(a=1;a<d;++a){m=c.vertices[a];f.vec3.add(t,
m.vLeft,m.vRight);var h=f.vec3.length(t);0<h?(h=1/Math.sqrt(h),t[0]*=h,t[1]*=h,t[2]*=h):(t[0]=m.vRight[0],t[1]=m.vRight[1],t[2]=m.vRight[2]);f.vec3.add(q,b.pos,b.frame.up);C.plane.fromPositionAndNormal(m.pos,t,A);C.plane.intersectRay(A,C.ray.wrap(q,m.vLeft),F)?(f.vec3.subtract(F,F,m.pos),f.vec3.normalize(e,F),f.vec3.cross(g,t,e),f.vec3.normalize(g,g)):N.makeOrthoBasisDirUpFallback(t,b.frame.up,b.frame.right,k,g,e,.99619469809);f.vec3.copy(m.frame.up,e);f.vec3.copy(m.frame.right,g);b=m}};h=function(){return function(){}}();
r.Extruder=h;h=function(){function c(){}c.prototype.numProfilesPerJoin=function(){return 1};c.prototype.extrude=function(a,b,d){for(var k=0;k<b.vertices.length;++k)d(a.index,a.frame,b.vertices[k],b.vertexNormals[k],!1)};return c}();r.SimpleExtruder=h;h=function(){function c(a,b){void 0===a&&(a=.8*Math.PI);void 0===b&&(b=1);this.cutoffAngle=a;this.numBendSubdivisions=b}c.prototype.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};c.prototype.extrude=function(a,b,d){var k=S;if(Math.abs(a.rotationAngle)>=
this.cutoffAngle)for(var e=0;e<this.numBendSubdivisions+1;++e){I.mat4.identity(G);I.mat4.rotate(G,G,.5*-a.rotationAngle+e*a.rotationAngle/this.numBendSubdivisions,a.rotationFrame.up);var g=k,c=a.frame,t=G;f.vec3.transformMat4(g.up,c.up,t);f.vec3.transformMat4(g.right,c.right,t);for(g=0;g<b.vertices.length;++g)c=p.vec2.dot(b.vertices[g],a.rotationRight),(c=0<=c*a.rotationAngle)?d(a.index,k,b.vertices[g],b.vertexNormals[g],!1):(p.vec2.transformMat2(B,b.vertices[g],a.miterStretch),d(a.index,a.frame,
B,b.vertexNormals[g],!0))}else for(e=0;e<this.numBendSubdivisions+1;++e)for(g=0;g<b.vertices.length;++g)c=p.vec2.dot(b.vertices[g],a.rotationRight),c=0<=c*a.rotationAngle,p.vec2.transformMat2(B,b.vertices[g],a.miterStretch),d(a.index,a.frame,B,b.vertexNormals[g],c?!1:!0)};return c}();r.MiterExtruder=h;var T={generateUV:!1},h=function(){function c(){}c.prototype.rebuildConnectingProfileGeometry=function(a,b,d){for(var k=0;k<b.vertices.length;++k)d(a.index,a.frame,b.vertices[k],b.vertexNormals[k],0,
0)};return c}();r.CapBuilder=h;var K=function(c){function a(){return c.call(this)||this}z(a,c);a.prototype.getNumVertices=function(){return 0};a.prototype.getNumIndices=function(){return 0};a.prototype.rebuildCapGeometry=function(b,a){};a.prototype.buildTopology=function(b,a){};return a}(h);r.NoCapBuilder=K;K=function(c){function a(b,a,k){void 0===a&&(a=0);void 0===k&&(k=!1);var d=c.call(this)||this;d.profile=b;d.profilePlaneOffset=a;d.flip=k;return d}z(a,c);a.prototype.getNumVertices=function(){return this.profile.vertices.length};
a.prototype.getNumIndices=function(){return 3*this.profile.numSegments};a.prototype.rebuildConnectingProfileGeometry=function(b,a,k){for(var d=0;d<a.vertices.length;++d)k(b.index,b.frame,a.vertices[d],a.vertexNormals[d],this.profilePlaneOffset,0)};a.prototype.rebuildCapGeometry=function(b,a){var d=L;p.vec2.set(d,0,0);for(var e=this.flip?1:-1,g=0;g<this.profile.vertices.length;++g)a(b.index,b.frame,this.profile.vertices[g],d,this.profilePlaneOffset,e)};a.prototype.buildTopology=function(b,a){b=this.vertexBufferStart+
this.profile.vertexIndices[0];for(var d=1;d<this.profile.numSegments;++d){var e=this.vertexBufferStart+this.profile.vertexIndices[2*d+0],g=this.vertexBufferStart+this.profile.vertexIndices[2*d+1];this.flip?a(g,e,b):a(b,e,g)}};return a}(h);r.TriangulationCapBuilder=K;h=function(c){function a(b){var a=c.call(this)||this;a.flip=!1;a.sign=0;a.breakNormals=!1;a.numSegments=3;a.profile=b.profile;a.flip=b.flip;a.sign=a.flip?1:-1;a.breakNormals=b.breakNormals;a.numSegments=b.subdivisions;return a}z(a,c);
a.prototype.getNumVertices=function(){var b=0,b=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(b+=this.profile.vertices.length);return b+=this.profile.poles.length};a.prototype.getNumIndices=function(){var b;b=0+2*this.profile.numSegments*(this.numSegments-1);for(var a=0;a<this.profile.numSegments;++a)b=this.profile.poleIndices[this.profile.vertexIndices[2*a+0]]===this.profile.poleIndices[this.profile.vertexIndices[2*a+1]]?b+1:b+2;return 3*b};a.prototype.rebuildCapGeometry=
function(b,a){var d=b.frame,e=.5*this.sign,g=B,c=L;p.vec2.set(c,0,0);for(var f=0;f<this.profile.poles.length;++f){var q=this.profile.poles[f];q.normal?a(b.index,d,q.position,q.normal,e,0):a(b.index,d,q.position,c,e,this.sign)}if(this.breakNormals)for(f=0;f<this.profile.vertices.length;++f)a(b.index,d,this.profile.vertices[f],this.profile.vertexNormals[f],0,0);for(f=0;f<this.numSegments-1;++f)for(var q=(1-(f+1)/this.numSegments)*Math.PI*.5,h=Math.sin(q),m=Math.cos(q),l=0;l<this.profile.vertices.length;++l)q=
this.profile.poles[this.profile.poleIndices[l]],p.vec2.subtract(g,this.profile.vertices[l],q.position),p.vec2.scale(g,g,h),q.normal?(p.vec2.add(g,g,q.position),a(b.index,d,g,q.normal,e*m,0)):(p.vec2.normalize(c,g),p.vec2.scale(c,c,h),p.vec2.add(g,g,q.position),a(b.index,d,g,c,e*m,this.sign*m))};a.prototype.buildTopology=function(b,a){b=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;for(var d=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+
this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length,e=0;e<this.profile.numSegments;++e){for(var g=this.profile.vertexIndices[2*e+0],c=this.profile.vertexIndices[2*e+1],f=this.vertexBufferStart+this.profile.poleIndices[g],h=this.vertexBufferStart+this.profile.poleIndices[c],l=b+g,m=b+c,p=0;p<this.numSegments-1;++p){var n=d+p*this.profile.vertices.length+g,r=d+p*this.profile.vertices.length+c;this.flip?(a(n,m,l),a(m,n,r)):(a(l,m,n),a(r,n,m));l=n;m=r}this.flip?(a(f,m,l),f!==
h&&a(f,h,m)):(a(l,m,f),f!==h&&a(m,h,f))}};return a}(h);r.RoundCapBuilder=h;h=function(){function c(a,b,d,c,e,g){void 0===g&&(g=T);this.options=g;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=b;this.path=a;this.extruder=d;this.startCap=c;this.endCap=e;a=this.path.vertices.length-2;this.numExtrusionProfiles=d.numProfilesPerJoin()*a+2;this.numNormalsTotal=this.numVerticesTotal=b.vertices.length*this.numExtrusionProfiles;
this.startCap.vertexBufferStart=this.numVerticesTotal;b=this.startCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.endCap.vertexBufferStart=this.numVerticesTotal;b=this.endCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*
this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}c.prototype.emitVertex=function(a,b,d,c,e){this.profileRightAxisData[4*this._extrusionVertexCount+0]=b.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=b.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+
2]=b.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=d[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=c[1];this.pathVertexData[this._extrusionVertexCount]=
a;e?(a=this.path.vertices[a],this.profileRightAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[0]*a.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[1]*a.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};c.prototype.emitCapVertex=function(a,b,d,c,e,g){this.profileRightAxisData[4*this._extrusionVertexCount+0]=b.right[0];this.profileRightAxisData[4*
this._extrusionVertexCount+1]=b.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=b.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=d[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=
c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=c[1];this.pathVertexData[this._extrusionVertexCount]=a;this.profileRightAxisData[4*this._extrusionVertexCount+3]=e;this.profileUpAxisData[4*this._extrusionVertexCount+3]=g;++this._extrusionVertexCount};c.prototype.emitTriangle=function(a,b,d){this.vertexIndices[3*this._triangleCount+0]=a;this.vertexIndices[3*this._triangleCount+1]=b;this.vertexIndices[3*this._triangleCount+2]=d;this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[a];
this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[b];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[d];this.normalIndices[3*this._triangleCount+0]=a;this.normalIndices[3*this._triangleCount+1]=b;this.normalIndices[3*this._triangleCount+2]=d;++this._triangleCount};c.prototype.rebuildGeometry=function(){for(var a=this.emitVertex.bind(this),b=this.emitCapVertex.bind(this),d=this._extrusionVertexCount=0,c=this.path.vertices;d<c.length;d++){var e=c[d];this.originData[3*
e.index+0]=e.pos[0];this.originData[3*e.index+1]=e.pos[1];this.originData[3*e.index+2]=e.pos[2]}this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,b);for(d=1;d<this.path.vertices.length-1;++d)this.extruder.extrude(this.path.vertices[d],this.profile,a);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,b);this.startCap.rebuildCapGeometry(this.path.vertices[0],b);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-
1],b);if(this.profile.hasUV()&&this.options.generateUV)for(d=0;d<this.profile.uvs.length;++d)this.uvData[2*d+0]=this.profile.uvs[d],this.uvData[2*d+1]=0};c.prototype.buildTopology=function(){var a=this.emitTriangle.bind(this);this._triangleCount=0;var b=this.profile.vertices.length,d=this.profile.numSegments,c=this.numExtrusionProfiles-1,e=d*c*6;this.startCap.indexBufferStart=e;this.startCap.firstProfileVertexIndex=0;e+=this.startCap.getNumIndices();this.endCap.indexBufferStart=e;this.endCap.firstProfileVertexIndex=
b*(this.numExtrusionProfiles-1);e+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(e);this.normalIndices=new Uint32Array(e);this.pathVertexIndices=new Uint32Array(e);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(e));for(e=0;e<d;++e)for(var g=this.profile.vertexIndices[2*e],f=this.profile.vertexIndices[2*e+1],h=0;h<c;++h){var l=h*b+g,p=(h+1)*b+f,m=h*b+f;a(l,(h+1)*b+g,p);a(l,p,m)}this.startCap.buildTopology(this.path.vertices[0],a);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-
1],a)};c.prototype.onPathChanged=function(){this.rebuildGeometry()};return c}();r.Builder=h;h=function(){function c(a){this.builder=a}Object.defineProperty(c.prototype,"xform",{get:function(){return this.builder.path.xform},enumerable:!0,configurable:!0});c.prototype.onPathChanged=function(){this.builder.onPathChanged()};return c}();r.PathGeometry=h;var O=function(c){function a(b){b=c.call(this,b)||this;b.vertexAttributePosition=null;b.vertexAttributeNormal=null;b.vertexAttributeColor=null;b.vertexAttributePosition=
new Float32Array(3*b.builder.numVerticesTotal);b.vertexAttributeNormal=new Float32Array(3*b.builder.numNormalsTotal);b.vertexAttributeColor=new Uint8Array(4);b.vertexAttributeColor[0]=255;b.vertexAttributeColor[1]=255;b.vertexAttributeColor[2]=255;b.vertexAttributeColor[3]=255;return b}z(a,c);a.prototype.bakeVertexColors=function(b){this.vertexAttributeColor[0]=255*b[0];this.vertexAttributeColor[1]=255*b[1];this.vertexAttributeColor[2]=255*b[2];this.vertexAttributeColor[3]=255*(3<b.length?b[3]:1)};
a.prototype.bake=function(b){this.size=b;for(var a=0;a<this.builder.numVerticesTotal;++a){var c=this.builder.pathVertexData[a],e=0===c||c===this.builder.path.vertices.length-1,g=U;f.vec3.set(g,this.builder.originData[3*c+0],this.builder.originData[3*c+1],this.builder.originData[3*c+2]);var h=x,l=B,c=v,q=J,n=V,m=0,r=0;f.vec3.set(q,this.builder.profileRightAxisData[4*a+0],this.builder.profileRightAxisData[4*a+1],this.builder.profileRightAxisData[4*a+2]);f.vec3.set(n,this.builder.profileUpAxisData[4*
a+0],this.builder.profileUpAxisData[4*a+1],this.builder.profileUpAxisData[4*a+2]);p.vec2.set(l,this.builder.profileVertexAndNormalData[4*a+0]*b[0],this.builder.profileVertexAndNormalData[4*a+1]*b[1]);if(e)f.vec3.cross(c,n,q),m=this.builder.profileRightAxisData[4*a+3]*b[0],r=this.builder.profileUpAxisData[4*a+3];else{var e=L,u=W;p.vec2.set(e,this.builder.profileRightAxisData[4*a+3],this.builder.profileUpAxisData[4*a+3]);var w=p.vec2.length(e);p.vec2.normalize(e,e);var y=p.vec2.dot(l,e);if(Math.abs(y)>
w){p.vec2.set(u,-e[1],e[0]);var z=p.vec2.dot(l,u);p.vec2.scale(e,e,w*H.sign(y));p.vec2.scale(u,u,z);p.vec2.add(l,e,u)}f.vec3.set(c,0,0,0)}f.vec3.set(h,q[0]*l[0]+n[0]*l[1],q[1]*l[0]+n[1]*l[1],q[2]*l[0]+n[2]*l[1]);this.vertexAttributePosition[3*a+0]=g[0]+h[0]+c[0]*m;this.vertexAttributePosition[3*a+1]=g[1]+h[1]+c[1]*m;this.vertexAttributePosition[3*a+2]=g[2]+h[2]+c[2]*m;g=B;p.vec2.set(g,this.builder.profileVertexAndNormalData[4*a+2],this.builder.profileVertexAndNormalData[4*a+3]);this.vertexAttributeNormal[3*
a+0]=q[0]*g[0]+n[0]*g[1]+c[0]*r;this.vertexAttributeNormal[3*a+1]=q[1]*g[0]+n[1]*g[1]+c[1]*r;this.vertexAttributeNormal[3*a+2]=q[2]*g[0]+n[2]*g[1]+c[2]*r}};a.prototype.createGeometryData=function(){var a={};a[y.VertexAttrConstants.POSITION]=this.builder.vertexIndices;a[y.VertexAttrConstants.NORMAL]=this.builder.normalIndices;this.vertexAttributeColor&&(a[y.VertexAttrConstants.COLOR]=new Uint32Array(a[y.VertexAttrConstants.POSITION].length));var c={};c[y.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition};
c[y.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal};this.vertexAttributeColor&&(c[y.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor});return new D.GeometryData(c,a,D.GeometryData.DefaultOffsets,"triangle")};a.prototype.onPathChanged=function(){c.prototype.onPathChanged.call(this);this.bake(this.size)};a.prototype.intersect=function(a,c,f){var b=this.builder.vertexIndices;R.intersectTriangles(a,c,0,b.length/3,b,{size:3,offsetIdx:0,strideIdx:3,data:this.vertexAttributePosition},
void 0,f)};return a}(h);r.StaticPathGeometry=O;h=function(c){function a(a,d,f,e){var b=c.call(this,a)||this;b.sizeAttributeValue=d;b.colorAttributeValue=f;b.opacityAttributeValue=e;b.vvData=null;b.baked=new O(a);b.vvData=new Float32Array(4*b.builder.path.vertices.length);for(a=0;a<b.builder.path.vertices.length;++a)b.vvData[4*a+0]=d,b.vvData[4*a+1]=f,b.vvData[4*a+2]=e,b.vvData[4*a+3]=0===a||a===b.builder.path.vertices.length-1?1:0;return b}z(a,c);a.prototype.createGeometryData=function(){var a={};
a[u.VertexAttrConstants.POSITION]=this.builder.pathVertexIndices;a[u.VertexAttrConstants.PROFILERIGHT]=this.builder.vertexIndices;a[u.VertexAttrConstants.PROFILEUP]=this.builder.vertexIndices;a[u.VertexAttrConstants.PROFILEVERTEXANDNORMAL]=this.builder.vertexIndices;a[u.VertexAttrConstants.FEATUREVALUE]=this.builder.pathVertexIndices;var c={};c[u.VertexAttrConstants.POSITION]={size:3,data:this.builder.originData};c[u.VertexAttrConstants.PROFILERIGHT]={size:4,data:this.builder.profileRightAxisData};
c[u.VertexAttrConstants.PROFILEUP]={size:4,data:this.builder.profileUpAxisData};c[u.VertexAttrConstants.PROFILEVERTEXANDNORMAL]={size:4,data:this.builder.profileVertexAndNormalData};c[u.VertexAttrConstants.FEATUREVALUE]={size:4,data:this.vvData};return new D.GeometryData(c,a,D.GeometryData.DefaultOffsets,"triangle")};return a}(h);r.FastUpdatePathGeometry=h})(w||(w={}));var U=n.vec3f64.create(),B=l.vec2f64.create(),L=l.vec2f64.create(),W=l.vec2f64.create(),x=n.vec3f64.create(),v=n.vec3f64.create(),
J=n.vec3f64.create(),V=n.vec3f64.create(),E=n.vec3f64.create(),S=w.makeFrame(),G=M.mat4f64.create();return w});