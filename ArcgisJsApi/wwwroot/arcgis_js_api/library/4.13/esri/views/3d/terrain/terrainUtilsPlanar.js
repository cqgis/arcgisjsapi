// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/Error ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),function(v,l,q,f,n,p,r,t){function m(a,b,d,c){f.vec3.copy(k,d);k[c]=b[c];c=f.vec3.subtract(k,k,b);var g=f.vec3.subtract(u,a,b),g=f.vec3.dot(g,c),e=f.vec3.dot(c,c);b=0>=g?b:e<=g?d:f.vec3.add(k,b,f.vec3.scale(c,c,g/e));a=f.vec3.subtract(k,a,b);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*a[0]+a[1]*
a[1]))}Object.defineProperty(l,"__esModule",{value:!0});var k=n.vec3f64.create(),u=n.vec3f64.create(),e=n.vec3f64.create(),h=n.vec3f64.create();l.isInsideExtent=function(a,b,d){void 0===d&&(d=0);a=a.extent;return 0===d?p.containsPoint(a,b):p.containsPointWithMargin(a,b,d*Math.min(a[2]-a[0],a[3]-a[1]))};l.tiltOnEdge=m;l.tiltToExtentEdge=function(a,b){var d=a.elevationBounds;a=a.extent;d=.5*(d.min+d.max);e[0]=a[0];e[1]=a[1];e[2]=d;h[0]=a[2];h[1]=a[3];h[2]=d;a=d=Infinity;b[0]<e[0]?d=m(b,e,h,0):b[0]>
h[0]&&(d=m(b,h,e,0));b[1]<e[1]?a=m(b,e,h,1):b[1]>h[1]&&(a=m(b,h,e,1));return Math.min(d,a)};l.checkIfTileInfoSupportedForViewSR=function(a,b,d){if(a.spatialReference.isGeographic)return new q("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var c=t.checkUnsupported(a);if(c)return c;var g=a.lods,c=g[0].resolution*Math.pow(2,g[0].level),e=[c*a.size[0],c*a.size[1]],h=[a.origin.x,a.origin.y];b=p.fromExtent(b);var f=p.create();t.computeRowColExtent(b,
e,h,f);e=(f[2]-f[0])*(f[3]-f[1]);e>r.MAX_ROOT_TILES?(g=g[0].scale*Math.pow(2,g[0].level),c=Math.max((b[3]-b[1])/a.size[1],(b[2]-b[0])/a.size[0])*g/c,b=Math.floor(Math.log(c)/Math.log(10)),c=Math.ceil(c/Math.pow(10,b))*Math.pow(10,b),c=new q("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(g).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+c.toLocaleString()+".",{level0Scale:g,suggestedLevel0Scale:c,requiredNumRootTiles:e,allowedNumRootTiles:r.MAX_ROOT_TILES})):
c=null;return c?c:d&&!a.spatialReference.equals(d)?new q("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}});