// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../geometry/Point ../../../../../layers/graphics/dehydratedFeatures ./AreaMeasurement3DView".split(" "),function(n,p,q,r,h,d,f,k,l,m){return function(){function c(a,b,c){this._manipulators=c;this._handles=new h;this._tempPickRequest=new m.PickRequest;this.model=a;this.view=b;this.model.reset();
this._setupManipulators()}c.prototype.destroy=function(){this._handles.destroy();this._handles=null};c.prototype.handleInputEvent=function(a,b){switch(a.type){case "immediate-click":this._handleImmediateClick(a);break;case "pointer-move":this._handlePointerMove(a);break;case "double-click":this._handleDoubleClick(a);break;case "drag":this._handleDrag(a);break;case "key-down":this._handleKeyDown(a)}};c.prototype._setupManipulators=function(){var a=this,b=0,c=function(c,g){a._handles.add(g.watch("dragging",
function(e){e?(b++,a.model.lastDraggedVertex=d.expect(a.view.manipulatorIdToVertexId(c)),"measured"===a.model.state&&(a.model.state="editing")):(b--,0===b&&"editing"===a.model.state&&(a.model.state="measured"))},!0),"manipulator-"+c);g.on("drag",function(){var b=d.expect(a.view.manipulatorIdToVertexId(c));a.model.path.update(b,l.clonePoint(g.mapPoint,new k))})};this._manipulators.forEach(function(a){c(a.id,a.manipulator)});this._handles.add(this._manipulators.on("change",function(b){b.added.forEach(function(a){c(a.id,
a.manipulator)});b.removed.forEach(function(b){a._handles.remove("manipulator-"+b.id)})}))};c.prototype._handleDrag=function(a){"editing"===this.model.state&&a.stopPropagation()};c.prototype._handleImmediateClick=function(a){if("mouse"!==a.pointerType||0===a.button){var b=f.createScreenPointFromEvent(a),c=!1;if(this.model.active)switch(this.model.state){case "initial":this._addVertexAt(b,a.pointerType)&&(this.model.state="drawing",c=!0);break;case "drawing":var e=this.view.vertexHandleAt(b,a.pointerType);
if(d.isNone(e)){if(this._addVertexAt(b,a.pointerType)){a.stopPropagation();return}}else 0===e&&(this.model.finishMeasurement(),c=!0);break;case "measured":d.isNone(this.view.vertexHandleAt(b,a.pointerType))&&(this.model.clearMeasurement(),this._addVertexAt(b,a.pointerType)&&(this.model.state="drawing",c=!0))}c&&a.stopPropagation();"mouse"===a.pointerType&&this._hoverAt(b)}};c.prototype._handlePointerMove=function(a){var b=f.createScreenPointFromEvent(a);"mouse"===a.pointerType&&this._hoverAt(b)};
c.prototype._handleDoubleClick=function(a){if("mouse"!==a.pointerType||0===a.button){var b=f.createScreenPointFromEvent(a);"drawing"===this.model.state&&d.isSome(this.view.vertexHandleAt(b,a.pointerType))&&(this.model.finishMeasurement(),a.stopPropagation())}};c.prototype._handleKeyDown=function(a){"Escape"===a.key&&"drawing"===this.model.state&&(this.model.clearMeasurement(),a.stopPropagation());"Enter"===a.key&&"drawing"===this.model.state&&(this.model.finishMeasurement(),a.stopPropagation())};
c.prototype._hoverAt=function(a){this.view.requiresCursorPoint?(a=this._pick(a),a.mapPoint&&(this.model.cursorPoint=a.mapPoint)):this.model.cursorPoint=null};c.prototype._addVertexAt=function(a,b){a=this._pick(a);return a.mapPoint?(this.model.path.add(a.mapPoint),!0):!1};c.prototype._pick=function(a){var b=this._tempPickRequest;b.screenPoint=a;return this.view.pick(b)};return c}()});