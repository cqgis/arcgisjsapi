// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./support/layerViewUpdatingProperties ./support/tiledLayerUtils ../terrain/terrainUtils".split(" "),function(p,e,h,d,q,f,k,l,b,g,m,n){Object.defineProperty(e,"__esModule",{value:!0});e.TiledLayerView3D=function(e){return function(e){function a(){return null!==
e&&e.apply(this,arguments)||this}h(a,e);Object.defineProperty(a.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isOpaque",{get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"dataLevelRange",{get:function(){var c=this.tileInfo.lods;return this.levelRangeFromScaleRange(c[0].scale,c[c.length-1].scale)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"displayLevelRange",{get:function(){var c=this.tileInfo.lods,c=this.levelRangeFromScaleRange(this.layer.minScale||c[0].scale,this.layer.maxScale||c[c.length-1].scale);this.layer.maxScale&&c.maxLevel++;return c},enumerable:!0,configurable:!0});a.prototype.getTileUrl=function(c,a,b){return this.layer.getTileUrl(c,a,b)};a.prototype._addTilingSchemeMatchPromise=function(){var c=this,a=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);a?this.addResolvingPromise(k.reject(a)):(a=l.whenTrueOnce(this.view,
"basemapTerrain.tilingSchemeLocked").then(function(){m.throwIfError(c._getTileInfoCompatibilityError(c.tileInfo,c.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(a))};a.prototype._getTileInfoSupportError=function(a,b){if(a=n.checkIfTileInfoSupportedForView(a,b,this.view.spatialReference,this.view.basemapTerrain.manifold)){b={layer:this.layer,error:a};var c=void 0;switch(a.name){case "tilingscheme:local-gcs-not-supported":c=new f("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",
b);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":c=new f("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",b);break;default:c=new f("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",b)}return c}return null};a.prototype._getTileInfoCompatibilityError=function(a,b){return b.compatibleWith(a)?null:new f("layerview:tiling-scheme-incompatible",
"The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};a.prototype.levelRangeFromScaleRange=function(a,b){var c={minLevel:0,maxLevel:Infinity},d=this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!d)return c;var e=d.levels[0],d=function(a){a=Math.log(e.scale/a)/Math.LN2;return 1E-9>.5-Math.abs(.5-a%1)?Math.round(a):Math.ceil(a)};null!=a&&0<a&&(c.minLevel=Math.max(0,d(a)));null!=b&&0<b&&(c.maxLevel=Math.max(0,d(b)));return c};a.prototype.isUpdating=
function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};d([b.property({readOnly:!0})],a.prototype,"imageFormatIsOpaque",null);d([b.property({readOnly:!0,dependsOn:["view.basemapTerrain.updating"]})],a.prototype,"updating",void 0);d([b.property(g.updatingPercentage)],a.prototype,"updatingPercentage",void 0);d([b.property(g.updatingPercentageValue)],a.prototype,"updatingPercentageValue",void 0);d([b.property({readOnly:!0})],a.prototype,"fullExtent",void 0);d([b.property({readOnly:!0,
dependsOn:["fullOpacity","imageFormatIsOpaque"]})],a.prototype,"isOpaque",null);d([b.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme"]})],a.prototype,"dataLevelRange",null);d([b.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme","layer.minScale","layer.maxScale"]})],a.prototype,"displayLevelRange",null);d([b.property()],a.prototype,"layer",void 0);d([b.property({readOnly:!0})],a.prototype,"tileInfo",void 0);return a=d([b.subclass("esri.views.3d.layers.TiledLayerView3D")],
a)}(b.declared(e))}});