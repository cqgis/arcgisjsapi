// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/has ../../../../core/now ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./intersectorUtils".split(" "),function(u,v,w,x,k,p,g,r,m){var t=k.mat4f64.create();return function(){function b(h){this.enable=new m.EnableIntersectorOptions;this.results=new m.IntersectorResults;this.transform=new m.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};
this.tolerance=1E-5;this._ray={origin:g.vec3f64.create(),direction:g.vec3f64.create()};this._rayEndPoint=g.vec3f64.create();this._rayStartPointTransformed=g.vec3f64.create();this._rayEndPointTransformed=g.vec3f64.create();this.viewingMode=h||"global"}Object.defineProperty(b.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"rayEndPoint",{get:function(){return this._rayEndPoint},enumerable:!0,configurable:!0});b.prototype.intersect=function(h,a,e,l,f,b,g,c,d,n){var q=this;if(void 0===d||!0===d)this._numObjectsTested=0,r.ray.fromPoints(a,e,this._ray),this.results.init(this._ray);this.point=l;this.camera=f;this.enable.selectionMode=g;this.filterPredicate=c;this.tolerance=null==b?1E-5:b;p.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction);a=n?function(a){n(a)&&q.intersectObject(a)}:function(a){q.intersectObject(a)};
if(h&&0<h.length)for(e=0;e<h.length;e++)if(l=h[e],f=l.getSpatialQueryAccelerator?l.getSpatialQueryAccelerator():void 0)f.forEachAlongRay(this._ray.origin,this._ray.direction,a),g&&f.forEachDegenerateObject(a);else for(f=0,l=l.getObjects();f<l.length;f++)a(l[f]);this.sortResults()};b.prototype.intersectObject=function(h){var a=this;this._numObjectsTested++;var b=h.geometryRecords;if(b)for(var l=h.id,f=h.objectTransformation,g,k=function(b){var d=b.geometry,e=b.material,k=b.instanceParameters;if(k.hidden)return"continue";
g=d.id;c.transform.setAndInvalidateLazyTransforms(f,b.getShaderTransformation());p.vec3.transformMat4(c._rayStartPointTransformed,c._ray.origin,c.transform.inverse);p.vec3.transformMat4(c._rayEndPointTransformed,c._rayEndPoint,c.transform.inverse);var n=c.transform.transform;e.intersect(d,k,c.transform.transform,c,c._rayStartPointTransformed,c._rayEndPointTransformed,function(b,c,f,d,e,k){0<=b&&(null==a.filterPredicate||a.filterPredicate(a._ray.origin,a._rayEndPoint,b))&&(e?(null==a.results.hud.dist||
b<a.results.hud.dist)&&a.results.hud.set(h,l,b,c,t,d,k,g,f):(e=function(a){return a.set(h,l,b,c,n,d,null,g,f)},(null==a.results.min.drapedLayerOrder||d>=a.results.min.drapedLayerOrder)&&(null==a.results.min.dist||b<a.results.min.dist)&&e(a.results.min),(null==a.results.max.drapedLayerOrder||d<a.results.max.drapedLayerOrder)&&(null==a.results.max.dist||b>a.results.max.dist)&&e(a.results.max),a.enable.storeAll&&(k=new m.IntersectorResult(a._ray),e(k),a.results.all.push(k))))},b.shaderTransformation)},
c=this,d=0;d<b.length;d++)k(b[d])};b.prototype.sortResults=function(){this.results.all.sort(function(b,a){return b.dist!==a.dist?b.dist-a.dist:b.drapedLayerOrder!==a.drapedLayerOrder?(void 0!==b.drapedLayerOrder?b.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==a.drapedLayerOrder?a.drapedLayerOrder:Number.MAX_VALUE):(void 0!==a.drapedLayerGraphicOrder?a.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==b.drapedLayerGraphicOrder?b.drapedLayerGraphicOrder:Number.MIN_VALUE)})};b.DEFAULT_TOLERANCE=1E-5;
return b}()});