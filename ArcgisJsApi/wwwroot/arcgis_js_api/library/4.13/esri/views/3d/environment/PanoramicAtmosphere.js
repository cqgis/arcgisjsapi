// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Texture ../../webgl/Util ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(h,G,q,r,k,t,u,v,w,x,y,z,l,m,A,B,f,C,D,E,F){h=function(){function e(d){this.slot=13;this._readyResolver=k.createResolver();this._readyController=k.createAbortController();this.view=d}Object.defineProperty(e.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});e.prototype.destroy=function(){this._readyResolver.reject();this._program&&(this._program.dispose(),this._program=null);this._texture&&(this._texture.dispose(),this._texture=null);this._readyController&&
(this._readyController.abort(),this._readyController=null)};e.prototype.when=function(d){return r(this,void 0,void 0,function(){return q(this,function(b){switch(b.label){case 0:return[4,this._readyResolver.promise];case 1:return b.sent(),d(),[2]}})})};e.prototype.initializeRenderContext=function(d){var b=this,c=d.rctx;this._program=B.createProgram(c,m.colorPass,{panoramic:!0});this._pipelineState=f.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),culling:f.backFaceCullingParams,
depthTest:{func:515},colorWrite:f.defaultColorWriteParams});this._vao=this._createVertexArrayObject(c);this._vaoCount=E.vertexCount(this._vao,"geometry");w.requestImage(v,{signal:this._readyController.signal}).then(function(a){b._texture=new C(d.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);d.requestRender();b._readyController=null;b._readyResolver.resolve()})};e.prototype.uninitializeRenderContext=function(d){this.destroy()};e.prototype.render=function(d){if(d.slot!==
this.slot||0!==d.pass)return!1;var b=d.rctx,c=this._program;b.bindProgram(c);b.setPipelineState(this._pipelineState);b.bindTexture(this._texture);c.setUniform1i("tex",0);c.setUniformMatrix4fv("proj",d.camera.projectionMatrix);var a=n;t.mat4.copy(a,d.camera.viewMatrix);a[12]=0;a[13]=0;a[14]=0;a[15]=1;c.setUniformMatrix4fv("view",n);c.setUniform4f("color",1,1,1,1);d.scenelightingData.setLightDirectionUniform(c);b.bindVAO(this._vao);D.assertCompatibleVertexAttributeLocations(this._vao,c);b.drawArrays(4,
0,this._vaoCount);return!0};e.prototype._createVertexArrayObject=function(d){for(var b=z.createPolySphereGeometry(1,2,!1),c=b.indices[l.VertexAttrConstants.POSITION],a=0;a<c.length;a+=3){var e=c[a];c[a]=c[a+2];c[a+2]=e}for(var b=b.vertexAttributes[l.VertexAttrConstants.POSITION].data,e=p.createBuffer(c.length),f=e.position,a=0;a<c.length;++a){var g=3*c[a];f.set(a,0,b[g]);f.set(a,1,b[g+1]);f.set(a,2,b[g+2])}return new F(d,m.colorPass.attributes,{geometry:x.glLayout(p)},{geometry:A.createVertex(d,35044,
e.buffer)})};return e}();var n=u.mat4f64.create(),p=y.newLayout().vec3f("position");return h});