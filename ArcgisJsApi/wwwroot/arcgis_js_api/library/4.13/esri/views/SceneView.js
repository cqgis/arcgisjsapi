// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
/*

 Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
 Copyright 2015, Google Inc. All Rights Reserved.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to
 deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 sell copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice including the dates of first publication and
 either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
 shall be included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

 Original Code. The Original Code is: OpenGL Sample Implementation,
 Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
 Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
 Copyright in any portions created by third parties is as indicated
 elsewhere herein. All Rights Reserved.
*/
require({cache:{"esri/geometry/support/scaleUtils":function(){define(["require","exports","../../config","../../core/unitUtils"],function(n,b,l,k){function h(a,b){b=k.getMetersPerUnitForSR(b);return a/(b*k.inchesPerMeter*l.screenDPI)}Object.defineProperty(b,"__esModule",{value:!0});b.getScale=function(a,b){b=b||a.extent;a=a.width;var e=k.getMetersPerUnitForSR(b&&b.spatialReference);return b&&a?b.width/a*e*k.inchesPerMeter*l.screenDPI:0};b.getResolutionForScale=h;b.getScaleForResolution=function(a,
b){b=k.getMetersPerUnitForSR(b);return a*b*k.inchesPerMeter*l.screenDPI};b.getExtentForScale=function(a,b){var e=a.extent;a=a.width;b=h(b,e.spatialReference);return e.clone().expand(b*a/e.width)}})},"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a,g,e,d){function f(f,
a){return a?c[f].valueToClassName[a].split(" "):[]}Object.defineProperty(b,"__esModule",{value:!0});var c={widthBreakpoint:{getValue:function(c){var f=c.viewSize[0];c=c.breakpoints;var a=this.values;return f<=c.xsmall?a.xsmall:f<=c.small?a.small:f<=c.medium?a.medium:f<=c.large?a.large:a.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(c){var f=c.viewSize[1];c=c.breakpoints;var a=this.values;return f<=c.xsmall?a.xsmall:f<=c.small?a.small:f<=c.medium?a.medium:f<=c.large?a.large:a.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(c){c=c.viewSize;var f=this.values;return c[1]>=c[0]?f.portrait:f.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},q={xsmall:544,small:768,medium:992,large:1200};b.BreakpointsOwner=
function(b){return function(b){function p(){for(var c=[],f=0;f<arguments.length;f++)c[f]=arguments[f];c=b.apply(this,c)||this;c._breakpointsHandles=new g;c.orientation=null;c.widthBreakpoint=null;c.heightBreakpoint=null;c.breakpoints=q;return c}l(p,b);p.prototype.initialize=function(){this._breakpointsHandles.add(e.init(this,["breakpoints","size"],this._updateClassNames))};p.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=
null)};Object.defineProperty(p.prototype,"breakpoints",{set:function(c){var f=this._get("breakpoints");if(c!==f){f=(f=c)&&f.xsmall<f.small&&f.small<f.medium&&f.medium<f.large;if(!f){var a=JSON.stringify(q,null,2);console.warn("provided breakpoints are not valid, using defaults:"+a)}c=f?c:q;this._set("breakpoints",h({},c))}},enumerable:!0,configurable:!0});p.prototype._updateClassNames=function(){if(this.container){var d=a.acquire(),e=a.acquire(),b=!1,q;for(q in c){var m=this[q],g=c[q].getValue({viewSize:this.size,
breakpoints:this.breakpoints});m!==g&&(b=!0,this[q]=g,f(q,m).forEach(function(c){return e.push(c)}),f(q,g).forEach(function(c){return d.push(c)}))}b&&(this._applyClassNameChanges(d,e),a.release(d),a.release(e))}};p.prototype._applyClassNameChanges=function(c,f){var a=this.container;a&&(f.forEach(function(c){return a.classList.remove(c)}),c.forEach(function(c){return a.classList.add(c)}))};p.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var d in c)f(d,this[d]).forEach(function(c){return a.classList.remove(c)})};
k([d.property()],p.prototype,"breakpoints",null);k([d.property()],p.prototype,"orientation",void 0);k([d.property()],p.prototype,"widthBreakpoint",void 0);k([d.property()],p.prototype,"heightBreakpoint",void 0);return p=k([d.subclass("esri.views.BreakpointsOwner")],p)}(d.declared(b))}})},"esri/views/GroundView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./support/GroundViewElevationSampler".split(" "),
function(n,b,l,k,h,a,g,e,d,f){return function(c){function b(f){f=c.call(this)||this;f.handles=new g;f.view=null;f.layerViews=new a;return f}l(b,c);b.prototype.initialize=function(){var c=this;this.handles.add(e.when(this,"view.map.ground",function(c){return c.load()}));this.handles.add(this.layerViews.on("after-changes",function(){return c.layerViewsAfterChangesHandler()}))};b.prototype.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};Object.defineProperty(b.prototype,
"elevationSampler",{get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new f({view:this.view}):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return this.suspended?!1:this.layerViews.some(function(c){return c.updating})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!0,configurable:!0});
b.prototype.layerViewsAfterChangesHandler=function(){var c=this;this.handles.remove("updating");this.handles.add(this.layerViews.map(function(f){return f.watch("updating",function(){return c.updateUpdating()},!0)}).toArray(),"updating");this.updateUpdating()};b.prototype.updateUpdating=function(){this.notifyChange("updating")};k([d.property({readOnly:!0,dependsOn:["view.ready","view.basemapTerrain?.ready"]})],b.prototype,"elevationSampler",null);k([d.property({type:Boolean,dependsOn:["suspended"],
readOnly:!0})],b.prototype,"updating",null);k([d.property({constructOnly:!0})],b.prototype,"view",void 0);k([d.property({type:a,readOnly:!0})],b.prototype,"layerViews",void 0);k([d.property({readOnly:!0,dependsOn:["view.suspended"]})],b.prototype,"suspended",null);return b=k([d.subclass("esri.views.GroundView")],b)}(d.declared(h))})},"esri/views/support/GroundViewElevationSampler":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){var p=a.getLogger("esri.views.support.GroundViewElevationSampler");return function(a){function b(c){c=a.call(this,c)||this;c.demResolution={min:-1,max:-1};c.noDataValue=q.ELEVATION_NODATA_VALUE;return c}l(b,a);b.prototype.initialize=function(){var c=this;this.view.basemapTerrain.on("elevation-change",function(){return c.emit("changed",{})})};Object.defineProperty(b.prototype,"extent",{get:function(){var c=this.view.basemapTerrain;return c.extent&&c.spatialReference?
e.toExtent(c.extent,c.spatialReference):null},enumerable:!0,configurable:!0});b.prototype.elevationAt=function(c){var a=c.spatialReference,e=this.spatialReference;if(!f.canProject(a,e))return p.error("Cannot sample elevation at a location with spatial reference ("+(a?a.wkid:"unknown")+") different from the view ("+e.wkid+")"),null;d.extentContainsPoint(this.extent,c)||(a=this.extent,p.warn("#elevationAt()","Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler extent ("+(a.xmin+
", "+a.ymin+", "+a.xmax+", "+a.ymax)+")"));return this.view.basemapTerrain.getElevation(c)};b.prototype.queryElevation=function(f){return c.updateGeometryElevation(f.clone(),this)};k([g.property({readOnly:!0})],b.prototype,"demResolution",void 0);k([g.property({readOnly:!0,dependsOn:["view.basemapTerrain.extent","view.basemapTerrain.spatialReference"]})],b.prototype,"extent",null);k([g.property({readOnly:!0})],b.prototype,"noDataValue",void 0);k([g.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],
b.prototype,"spatialReference",void 0);k([g.property({constructOnly:!0})],b.prototype,"view",void 0);return b=k([g.subclass("esri.views.support.GroundViewElevationSampler")],b)}(g.declared(h.EventedAccessor))})},"esri/layers/support/ElevationSampler":function(){define("require exports ../../core/tsSupport/extendsHelper ../../geometry ../../core/compilerUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f){function c(c,f){var a=q(c,f.spatialReference);if(!a)return null;switch(c.type){case "point":c.z=f.elevationAt(a)||0;break;case "polyline":t.spatialReference=a.spatialReference;for(var d=c.hasM&&!c.hasZ,e=0;e<c.paths.length;e++)for(var b=c.paths[e],g=a.paths[e],p=0;p<b.length;p++){var r=b[p],k=g[p];t.x=k[0];t.y=k[1];k=f.elevationAt(t)||0;d&&(r[3]=r[2]);r[2]=k}c.hasZ=!0;break;case "multipoint":t.spatialReference=a.spatialReference;d=c.hasM&&!c.hasZ;for(e=0;e<c.points.length;e++)b=
c.points[e],g=a.points[e],t.x=g[0],t.y=g[1],g=f.elevationAt(t)||0,d&&(b[3]=b[2]),b[2]=g;c.hasZ=!0;break;default:h.neverReached(c)}return c}function q(c,a){var d=c.spatialReference;return d.equals(a)?c:f.canProject(d,a)?f.project(c,a):(p.error("Cannot project geometry spatial reference (wkid:"+d.wkid+") to elevation sampler spatial reference (wkid:"+a.wkid+")"),null)}Object.defineProperty(b,"__esModule",{value:!0});var p=a.getLogger("esri.layers.support.ElevationSampler");n=function(){function f(){}
f.prototype.queryElevation=function(f){return c(f.clone(),this)};f.prototype.on=function(c,f){return x};f.prototype.projectIfRequired=function(c,f){return q(c,f)};return f}();b.ElevationSamplerBase=n;var r=function(c){function f(f,a,d){var b=c.call(this)||this;b.tile=f;b.noDataValue=d;b.extent=e.toExtent(f.tile.extent,a.spatialReference);d=g.getMetersPerUnitForSR(a.spatialReference);f=a.lodAt(f.tile.level).resolution*d;b.demResolution={min:f,max:f};return b}l(f,c);Object.defineProperty(f.prototype,
"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});f.prototype.contains=function(c){c=this.projectIfRequired(c,this.spatialReference);return d.extentContainsPoint(this.extent,c)};f.prototype.elevationAt=function(c){var f=this.projectIfRequired(c,this.spatialReference);if(!f)return null;if(!this.contains(c)){var a=this.extent;p.warn("#elevationAt()","Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler extent ("+(a.xmin+", "+
a.ymin+", "+a.xmax+", "+a.ymax)+")")}return this.tile.sample(f.x,f.y)};return f}(n);b.TileElevationSampler=r;n=function(c){function f(f,a,d){var b=c.call(this)||this,q;"number"===typeof a?(b.noDataValue=a,q=null):(q=a,b.noDataValue=d);b.samplers=q?f.map(function(c){return new r(c,q,b.noDataValue)}):f;if(f=b.samplers[0])for(b.extent=f.extent.clone(),f=f.demResolution,b.demResolution={min:f.min,max:f.max},f=1;f<b.samplers.length;f++)a=b.samplers[f],b.extent.union(a.extent),b.demResolution.min=Math.min(b.demResolution.min,
a.demResolution.min),b.demResolution.max=Math.max(b.demResolution.max,a.demResolution.max);else b.extent=e.toExtent(e.create(),q.spatialReference),b.demResolution={min:0,max:0};return b}l(f,c);Object.defineProperty(f.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});f.prototype.elevationAt=function(c){var f=this.projectIfRequired(c,this.spatialReference);if(!f)return null;for(var a=0,d=this.samplers;a<d.length;a++){var e=d[a];if(e.contains(f))return e.elevationAt(f)}p.warn("#elevationAt()",
"Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler");return null};return f}(n);b.MultiTileElevationSampler=n;b.updateGeometryElevation=c;var t=new k.Point,x={remove:function(){}}})},"esri/views/3d/terrain/TerrainConst":function(){define("require exports ../../../core/mathUtils ../../../geometry/support/aaBoundingRect ../../../layers/support/TilemapCache ./TilingScheme".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.TILE_LOADING_DEBUGLOG=
!1;b.MAX_ROOT_TILES=64;b.MAX_PATCH_TESSELATION=512;b.MAX_MEMORY_LOD_BIAS=2.5;b.ELEVATION_NODATA_VALUE=l.clampFloat32(l.NUMBER_MAX_FLOAT32/10);b.START_LOADING_LEVEL_DELTA=8;b.LOADING_LEVEL_MODULO=2;b.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;b.TILEMAP_SIZE=1<<h.TILEMAP_SIZE_EXP;b.WEBMERCATOR_WORLD_EXTENT=k.create();a.WebMercatorAuxiliarySphere.getExtent(0,0,0,b.WEBMERCATOR_WORLD_EXTENT);b.GEOGRAPHIC_WORLD_EXTENT=k.create([-180,-90,180,90]);b.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";
b.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";b.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
b.GEOMETRY_VERTEX_STRIDE=5})},"esri/layers/support/TilemapCache":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m){Object.defineProperty(b,"__esModule",{value:!0});b.TILEMAP_SIZE_EXP=5;var v=q.getLogger("esri.layers.support.TilemapCache");n=function(d){function q(f){f=d.call(this)||this;f._handles=new c;f._pendingTilemapRequests={};f._availableLevels={};f.levels=5;f.cacheByteSize=2097152;f.request=e;f._prefetchingEnabled=!0;return f}k(q,d);z=q;q.prototype.initialize=function(){var c=this;this._tilemapCache=new p(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl",
"layer.tileServers?"],function(){return c._initializeTilemapDefinition()}),u.init(this,"layer.tileInfo.lods",function(f){return c._initializeAvailableLevels(f)},!0)]);this._initializeTilemapDefinition()};q.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};q.prototype.castLevels=function(c){return 2>=c?(v.error("Minimum levels for Tilemap is 3, but got ",c),3):c};Object.defineProperty(q.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0});
q.prototype.fetchTilemap=function(c,a,d,e){var b=this;if(!this._availableLevels[c])return t.reject(new f("tilemap-cache:level-unavailable","Level "+c+" is unavailable in the service"));var q=this._tmpTilemapDefinition;if(c=this._tilemapFromCache(c,a,d,q))return t.resolve(c);var g=e&&e.signal;e=l({},e,{signal:null});return t.create(function(c,f){t.onAbort(g,function(){return f(t.createAbortError())});var a=m.tilemapDefinitionId(q),d=b._pendingTilemapRequests[a];if(!d){var d=m.Tilemap.fromDefinition(q,
e).then(function(c){b._tilemapCache.put(a,c,c.byteSize);return c}),p=function(){return delete b._pendingTilemapRequests[a]};b._pendingTilemapRequests[a]=d;d.then(p,p)}d.then(c,f)})};q.prototype.getAvailability=function(c,f,a){return this._availableLevels[c]?(c=this._tilemapFromCache(c,f,a,this._tmpTilemapDefinition))?c.getAvailability(f,a):"unknown":"unavailable"};q.prototype.getAvailabilityUpsample=function(c,f,a,d){d.level=c;d.row=f;d.col=a;c=this.layer.tileInfo;for(c.updateTileInfo(d);;)if(f=this.getAvailability(d.level,
d.row,d.col),"unavailable"===f){if(!c.upsampleTile(d))return"unavailable"}else return f};q.prototype.fetchAvailability=function(c,a,d,e){return this._availableLevels[c]?this.fetchTilemap(c,a,d,e).catch(function(c){return c}).then(function(e){return e instanceof m.Tilemap?(e=e.getAvailability(a,d),"unavailable"===e?t.reject(new f("tile-map:tile-unavailable","Tile is not available",{level:c,row:a,col:d})):e):t.isAbortError(e)?t.reject(e):"unknown"}):t.reject(new f("tilemap-cache:level-unavailable",
"Level "+c+" is unavailable in the service"))};q.prototype.fetchAvailabilityUpsample=function(c,f,a,d,e){var b=this;d.level=c;d.row=f;d.col=a;var q=this.layer.tileInfo;q.updateTileInfo(d);var m=this.fetchAvailability(c,f,a,e).catch(function(c){if(t.isAbortError(c))throw c;if(q.upsampleTile(d))return b.fetchAvailabilityUpsample(d.level,d.row,d.col,d);throw c;});this._fetchAvailabilityUpsamplePrefetch(d.id,c,f,a,e,m);return m};q.prototype._fetchAvailabilityUpsamplePrefetch=function(c,f,d,e,b,q){return g(this,
void 0,void 0,function(){var m,g,p,r,h,v,k,u,y,w;return a(this,function(a){switch(a.label){case 0:if(!this._prefetchingEnabled)return[2];m="prefetch-"+c;if(this._handles.has(m))return[2];g=t.createAbortController();q.then(function(){return g.abort()},function(){return g.abort()});p=!1;r={remove:function(){p||(p=!0,g.abort())}};this._handles.add(r,m);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,x.waitTicks(10,g.signal)];case 2:return a.sent(),[3,4];case 3:return a.sent(),[3,4];case 4:p||(p=!0,
this._handles.remove(m));if(t.isAborted(g))return[2];h={id:c,level:f,row:d,col:e};v=l({},b,{signal:g.signal});k=this.layer.tileInfo;u=function(c){var f=y.fetchAvailability(h.level,h.row,h.col,v);z._prefetches.push(f);c=function(){z._prefetches.removeUnordered(f)};f.then(c,c)};y=this;for(w=0;z._prefetches.length<z._maxPrefetch&&k.upsampleTile(h);++w)u(w);return[2]}})})};q.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var c=this.layer.parsedUrl,f=c.query;this._tilemapCache.clear();
this._tmpTilemapDefinition={service:{url:c.path,query:f?w.objectToQuery(f):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};q.prototype._tilemapFromCache=function(c,f,a,d){c=this._getTilemapDefinition(c,f,a,d);c=m.tilemapDefinitionId(c);return this._tilemapCache.get(c)};q.prototype._getTilemapDefinition=function(c,f,a,d){d.level=c;c=c>b.TILEMAP_SIZE_EXP;d.row=c?f-f%this.size:f;d.col=c?a-a%this.size:a;return d};
q.prototype._initializeAvailableLevels=function(c){var f=this;this._availableLevels={};c&&c.forEach(function(c){return f._availableLevels[c.level]=!0})};Object.defineProperty(q.prototype,"test",{get:function(){var c=this;return{get prefetchingEnabled(){return c._prefetchingEnabled},set prefetchingEnabled(f){c._prefetchingEnabled=this.prefetchingEnabled},hasTilemap:function(f,a,d){return!!c._tilemapFromCache(f,a,d,c._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0});var z;q._maxPrefetch=4;q._prefetches=
new r({initialSize:z._maxPrefetch});h([y.property({constructOnly:!0,type:Number})],q.prototype,"levels",void 0);h([y.cast("levels")],q.prototype,"castLevels",null);h([y.property({readOnly:!0,dependsOn:["levels"],type:Number})],q.prototype,"size",null);h([y.property({constructOnly:!0,type:Number})],q.prototype,"cacheByteSize",void 0);h([y.property({constructOnly:!0})],q.prototype,"layer",void 0);h([y.property({constructOnly:!0})],q.prototype,"request",void 0);return q=z=h([y.subclass("esri.layers.support.TilemapCache")],
q)}(y.declared(d));b.TilemapCache=n})},"esri/layers/support/Tilemap":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/arrayUtils ../../core/Error ../../core/lang ../../core/promiseUtils".split(" "),function(n,b,l,k,h,a,g,e){function d(f){var c;"vector-tile"===f.service.type?c=f.service.url+"/tilemap/"+f.level+"/"+f.row+"/"+f.col+"/"+f.width+"/"+f.height:(c=f.service.tileServers,c=(c&&c.length?c[f.row%c.length]:f.service.url)+"/tilemap/"+f.level+"/"+f.row+
"/"+f.col+"/"+f.width+"/"+f.height);(f=f.service.query)&&(c=c+"?"+f);return c}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function f(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}f.prototype.getAvailability=function(c,f){if("unknown"!==this._allAvailability)return this._allAvailability;c=(c-this.location.top)*this.location.width+(f-this.location.left);f=c>>3;var a=this._tileAvailabilityBitSet;return 0>f||f>a.length?"unknown":a[f]&
1<<c%8?"available":"unavailable"};f.prototype._updateFromData=function(c){for(var f=!0,a=!0,d=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),e=0,b=0;b<c.length;b++){var g=b%8;c[b]?(a=!1,d[e]|=1<<g):f=!1;7===g&&++e}a?this._allAvailability="unavailable":f?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=d,this.byteSize+=d.length)};f.fromDefinition=function(c,b){var q=c.service.request||k,g=c.row,t=c.col,x=c.width,w=c.height,u={query:{f:"json"}};
b=b?l({},u,b):u;return q(d(c),b).then(function(c){return c.data}).catch(function(c){return c&&c.details&&422===c.details.httpStatus?{location:{top:g,left:t,width:x,height:w},valid:!0,data:h.constant(x*w,0)}:e.reject(c)}).then(function(c){if(c.location&&(c.location.top!==g||c.location.left!==t||c.location.width!==x||c.location.height!==w))throw new a("tilemap:location-mismatch","Tilemap response for different location than requested",{response:c,definition:{top:g,left:t,width:x,height:w}});return f.fromJSON(c)})};
f.fromJSON=function(c){f.validateJSON(c);var a=new f;a.location=Object.freeze(g.clone(c.location));a._updateFromData(c.data);return Object.freeze(a)};f.validateJSON=function(c){if(!c||!c.location)throw new a("tilemap:missing-location","Location missing from tilemap response");if(!1===c.valid)throw new a("tilemap:invalid","Tilemap response was marked as invalid");if(!c.data)throw new a("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(c.data))throw new a("tilemap:data-mismatch",
"Data must be an array of numbers");if(c.data.length!==c.location.width*c.location.height)throw new a("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return f}();b.Tilemap=n;b.tilemapDefinitionId=function(f){return f.level+"/"+f.row+"/"+f.col+"/"+f.width+"/"+f.height};b.tilemapDefinitionUrl=d;b.default=n})},"esri/views/3d/terrain/TilingScheme":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/support/TileInfo ../support/projectionUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f){var c=f.webMercator.x2lon,q=f.webMercator.y2lat;n=function(){function b(c){var a=b.checkUnsupported(c);if(a)throw a;this.spatialReference=c.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84Comparable=f.canProjectToWGS84ComparableLonLat(this.spatialReference);this.origin=[c.origin.x,c.origin.y];this.pixelSize=c.size[0];this.dpi=c.dpi;var d=c.lods.reduce(function(c,f,a){f.level<c.min&&(c.min=f.level,c.minIndex=a);c.max=Math.max(c.max,
f.level);return c},{min:Infinity,minIndex:0,max:-Infinity}),e=c.lods[d.minIndex],q=Math.pow(2,e.level),a=e.resolution*q,e=e.scale*q;this.levels=Array(d.max+1);for(d=0;d<this.levels.length;d++)this.levels[d]={resolution:a,scale:e,tileSize:[a*c.size[0],a*c.size[1]]},a/=2,e/=2}b.prototype.clone=function(){return new b(this.toTileInfo())};b.prototype.toTileInfo=function(){return new d({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,
this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(function(c,f){return{level:f,scale:c.scale,resolution:c.resolution}})})};b.prototype.getExtent=function(f,a,d,b,g){void 0===b&&(b=e.create());var m=this.levels[f];f=m.tileSize[0];m=m.tileSize[1];b[0]=this.origin[0]+d*f;b[2]=b[0]+f;b[3]=this.origin[1]-a*m;b[1]=b[3]-m;g&&(this._isWebMercator?(g[0]=c(b[0]),g[1]=q(b[1]),g[2]=c(b[2]),g[3]=q(b[3])):this._isWGS84Comparable&&(g[0]=h.deg2rad(b[0]),g[1]=h.deg2rad(b[1]),g[2]=h.deg2rad(b[2]),
g[3]=h.deg2rad(b[3])));return b};b.prototype.getExtentGeometry=function(c,f,a,d){void 0===d&&(d=new l.Extent);this.getExtent(c,f,a,p);d.spatialReference=this.spatialReference;d.xmin=p[0];d.ymin=p[1];d.xmax=p[2];d.ymax=p[3];d.zmin=void 0;d.zmax=void 0;return d};b.prototype.ensureMaxLod=function(c){if(null==c)return!1;for(var f=!1;this.levels.length<=c;){var f=this.levels[this.levels.length-1],a=f.resolution/2;this.levels.push({resolution:a,scale:f.scale/2,tileSize:[a*this.pixelSize,a*this.pixelSize]});
f=!0}return f};b.prototype.capMaxLod=function(c){this.levels.length>c+1&&(this.levels.length=c+1)};b.prototype.getMaxLod=function(){return this.levels.length-1};b.prototype.scaleAtLevel=function(c){return this.levels[0].scale/Math.pow(2,c)};b.prototype.levelAtScale=function(c){var f=this.levels[0].scale;return c>=f?0:Math.log(f/c)*Math.LOG2E};b.prototype.resolutionAtLevel=function(c){return this.levels[0].resolution/Math.pow(2,c)};b.prototype.compatibleWith=function(c){if(!(c instanceof b)){if(b.checkUnsupported(c))return!1;
c=new b(c)}if(!c.spatialReference.equals(this.spatialReference)||c.pixelSize!==this.pixelSize)return!1;var f=Math.min(this.levels.length,c.levels.length)-1,a=this.levels[f].resolution,d=.5*a;if(!h.floatEqualAbsolute(c.origin[0],this.origin[0],d)||!h.floatEqualAbsolute(c.origin[1],this.origin[1],d))return!1;d=.5*a/Math.pow(2,f)/this.pixelSize*12;return h.floatEqualAbsolute(a,c.levels[f].resolution,d)};b.prototype.rootTilesInExtent=function(c,f,a){var d=this.levels[0].tileSize;if(0===d[0]||0===d[1])return[];
b.computeRowColExtent(c,d,this.origin,p);c=p[1];var e=p[3],q=p[0],g=p[2],r=g-q,h=e-c;r*h>a&&(a=Math.floor(Math.sqrt(a)),h>a&&(c=c+Math.floor(.5*h)-Math.floor(.5*a),e=c+a),r>a&&(q=q+Math.floor(.5*r)-Math.floor(.5*a),g=q+a));a=Array((g-q)*(e-c));r=0;for(h=c;h<e;h++)for(var k=q;k<g;k++)a[r++]=[0,h,k];f&&(f[0]=this.origin[0]+q*d[0],f[1]=this.origin[1]-e*d[1],f[2]=this.origin[0]+g*d[0],f[3]=this.origin[1]-c*d[1]);return a};b.computeRowColExtent=function(c,f,a,d){var e=.001*(c[2]-c[0]+(c[3]-c[1]));d[0]=
Math.floor((c[0]+e-a[0])/f[0]);d[2]=Math.ceil((c[2]-e-a[0])/f[0]);d[1]=Math.floor((a[1]-c[3]+e)/f[1]);d[3]=Math.ceil((a[1]-c[1]-e)/f[1])};b.isPowerOfTwo=function(c){c=c.lods;var f=c[0].resolution*Math.pow(2,c[0].level);return!c.some(function(c){return!h.floatEqualRelative(c.resolution,f/Math.pow(2,c.level))})};b.hasGapInLevels=function(c){c=c.lods.map(function(c){return c.level});c.sort(function(c,f){return c-f});for(var f=1;f<c.length;f++)if(c[f]!==c[0]+f)return!0;return!1};b.tileSizeSupported=function(c){var f=
c.size[1];return f===c.size[0]&&0===(f&f-1)&&128<=f&&512>=f};b.checkUnsupported=function(c){return c?1>c.lods.length?new k("tilingscheme:generic","Tiling scheme must have at least one level"):b.isPowerOfTwo(c)?b.hasGapInLevels(c)?new k("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):b.tileSizeSupported(c)?null:new k("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new k("tilingscheme:power-of-two","Tiling scheme must be power of two"):
new k("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};b.fromExtent=function(c,f){var e=c[2]-c[0],q=c[3]-c[1],g=a.getMetersPerUnitForSR(f),m=1.2*Math.max(e,q);c=new b(new d({size:[256,256],origin:{x:c[0]-.5*(m-e),y:c[3]+.5*(m-q)},lods:[{level:0,resolution:m/256,scale:1/(256/96*.0254/(m*g))}],spatialReference:f}));c.ensureMaxLod(20);return c};b.makeWebMercatorAuxiliarySphere=function(c){var f=new b(b.WebMercatorAuxiliarySphereTileInfo);f.ensureMaxLod(c);return f};b.makeGCSWithTileSize=
function(c,f,a){void 0===f&&(f=256);void 0===a&&(a=16);var e=256/f;c=new b(new d({size:[f,f],origin:{x:-180,y:90,spatialReference:c},spatialReference:c,lods:[{level:0,resolution:.703125*e,scale:2.95497598570834E8*e}]}));c.ensureMaxLod(a);return c};Object.defineProperty(b.prototype,"test",{get:function(){return{isWebMercator:this._isWebMercator,isWGS84:this._isWGS84Comparable}},enumerable:!0,configurable:!0});b.WebMercatorAuxiliarySphereTileInfo=new d({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,
spatialReference:g.WebMercator},spatialReference:g.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});b.WebMercatorAuxiliarySphere=b.makeWebMercatorAuxiliarySphere(19);return b}();var p=e.create();return n})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(c,f,a,d){2===c.length?(F[0]=c[0],F[1]=c[1],F[2]=0,c=F):c===a&&(g.vec3.copy(F,c),c=F);return x(c,f,0,a,d,0,1)}function x(c,f,a,d,e,b,q){void 0===q&&(q=1);f=I(f,e,P).projector;if(k.isNone(f))return!1;if(f===u){if(c===d&&a===b)return!0;for(f=a+3*q;a<f;a++,b++)d[b]=c[a];return!0}for(q=a+3*q;a<q;a+=3,b+=3)f(c,a,d,b);return!0}function w(c,f){if(f.spatialReference===c)return f.spatialReferenceId;f.spatialReference=c;"metersPerUnit"in f&&(f.metersPerUnit=h.getMetersPerUnitForSR(c,
1));return c.wkt===b.SphericalECEFSpatialReference.wkt?f.spatialReferenceId=1:c.isWGS84?f.spatialReferenceId=2:c.isWebMercator?f.spatialReferenceId=3:c.wkt===b.WGS84ECEFSpatialReference.wkt?f.spatialReferenceId=4:4490===c.wkid?f.spatialReferenceId=5:f.spatialReferenceId=0}function u(c,f,a,d){a[d++]=c[f++];a[d++]=c[f++];a[d]=c[f]}function y(c,f,a,d){a[d++]=ca*(c[f++]/p.earthRadius);a[d++]=ca*(Math.PI/2-2*Math.atan(Math.exp(-1*c[f++]/p.earthRadius)));a[d]=c[f]}function m(c,f,a,d){var e=.4999999*Math.PI,
e=l.clamp(Z*c[f+1],-e,e),e=Math.sin(e);a[d++]=Z*c[f]*p.earthRadius;a[d++]=p.halfEarthRadius*Math.log((1+e)/(1-e));a[d]=c[f+2]}function v(c,f,a){f=w(f,Y);f=U[f][6];if(k.isNone(f))return!1;f(c,0,F,0);a!==F&&(a[0]=F[0],a[1]=F[1],2<a.length&&(a[2]=F[2]));return!0}function z(c,f){F[0]=c.x;F[1]=c.y;F[2]=c.hasZ?c.z:0;return v(F,c.spatialReference,f)}function B(c,f,a,d){var e=p.earthRadius+c[f+2],b=Z*c[f+1];c=Z*c[f];f=Math.cos(b);a[d++]=Math.cos(c)*f*e;a[d++]=Math.sin(c)*f*e;a[d]=Math.sin(b)*e}function C(c,
f,a,d){var e=r.Vec3Compact.length(c,f),b=l.asinClamped(c[f+2]/(0===e?1:e)),q=Math.cos(b)*e;c=(0<c[f+1]?1:-1)*l.acosClamped(c[f]/(0===q?1:q));a[d++]=ca*c;a[d++]=ca*b;a[d]=e-p.earthRadius}function D(c,f,a,d){var e=da,b=Z*c[f],q=Z*c[f+1];c=c[f+2];f=Math.sin(q);var q=Math.cos(q),g=e.a/Math.sqrt(1-e.e2*f*f);a[d++]=(g+c)*q*Math.cos(b);a[d++]=(g+c)*q*Math.sin(b);a[d++]=(g*(1-e.e2)+c)*f}function K(c,f,a,d){var e=da,b=c[f],q=c[f+1];c=c[f+2];var g,m,p,r,h,v;f=Math.abs(c);g=b*b+q*q;m=Math.sqrt(g);p=g+c*c;r=
Math.sqrt(p);b=Math.atan2(q,b);h=c*c/p;p=g/p;q=e.a2/r;g=e.a3-e.a4/r;.3<p?(h=f/r*(1+p*(e.a1+q+h*g)/r),r=Math.asin(h),q=h*h,p=Math.sqrt(1-q)):(p=m/r*(1-h*(e.a5-q-p*g)/r),r=Math.acos(p),q=1-p*p,h=Math.sqrt(q));v=1-e.e2*q;q=e.a/Math.sqrt(v);e=e.a6*q;q=m-q*p;g=f-e*h;f=p*q+h*g;m=p*g-h*q;e=m/(e/v+f);r+=e;0>c&&(r=-r);a[d++]=ca*b;a[d++]=ca*r;a[d]=f+m*e/2}function I(c,f,a){if(a.source.spatialReference===c&&a.dest.spatialReference===f)return a;var d=w(c,a.source),e=w(f,a.dest);0===d&&0===e?c.equals(f)?a.projector=
u:a.projector=null:a.projector=U[d][e];return a}Object.defineProperty(b,"__esModule",{value:!0});var Q,J,N,L,M,R,S,T;b.SphericalECEFSpatialReference=new f({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});b.WGS84ECEFSpatialReference=new f({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});
b.canProject=function(c,f){return!!I(c,f,P).projector};b.vectorToVector=t;b.pointToPoint=function(c,f,a,d){void 0===a&&(a=f.spatialReference);void 0===d&&(d=0);F[0]=c.x;F[1]=c.y;var e=c.z;F[2]=void 0!==e?e:d;if(!x(F,c.spatialReference,0,F,a,0,1))return!1;f.x=F[0];f.y=F[1];f.spatialReference=a;void 0!==e?(f.z=F[2],f.hasZ=!0):(f.z=void 0,f.hasZ=!1);return!0};b.pointToVector=function(c,f,a,d){void 0===d&&(d=0);F[0]=c.x;F[1]=c.y;var e=c.z;F[2]=void 0!==e?e:d;return x(F,c.spatialReference,0,f,a,0,1)};
b.vectorToPoint=function(c,f,a,e){a instanceof d?e=e||a.spatialReference:q.isPoint(a)?(a.hasZ=!0,e=e||a.spatialReference):(e=a,a=new d({spatialReference:e}));return x(c,f,0,F,e,0,1)?(a.x=F[0],a.y=F[1],a.z=F[2],a.spatialReference=e,a):null};b.xyzToVector=function(c,f,a,d,e,b){F[0]=c;F[1]=f;F[2]=a;return x(F,d,0,e,b,0,1)};b.bufferToBuffer=x;b.computeLinearTransformation=function(c,f,d,e){var b=w(c,Y),q=w(e,X);if(b===q&&1!==q&&(0!==b||c.equals(e)))return a.mat4.identity(d),a.mat4.translate(d,d,f),!0;
if(1===q){c=U[b][6];q=U[6][q];if(k.isNone(c)||k.isNone(q))return!1;c(f,0,ea,0);q(ea,0,la,0);c=Z*ea[0];q=Z*ea[1];f=Math.sin(c);c=Math.cos(c);e=Math.sin(q);q=Math.cos(q);d[0]=-f;d[4]=-e*c;d[8]=q*c;d[12]=la[0];d[1]=c;d[5]=-e*f;d[9]=q*f;d[13]=la[1];d[2]=0;d[6]=q;d[10]=e;d[14]=la[2];d[3]=0;d[7]=0;d[11]=0;d[15]=1;return!0}if(3===q&&(2===b||1===b)){c=U[b][6];q=U[6][3];if(k.isNone(c)||k.isNone(q))return!1;c(f,0,ea,0);f=Z*ea[1];q(ea,0,la,0);a.mat4.identity(d);a.mat4.translate(d,d,la);f=1/Math.cos(f);a.mat4.scale(d,
d,[f,f,1]);return!0}return!1};b.transformDirection=function(c,f,a,d,e){g.vec3.copy(ka,c);g.vec3.add(oa,c,f);t(ka,a,ka,e);t(oa,a,oa,e);g.vec3.subtract(d,oa,ka);g.vec3.normalize(d,d)};b.mbsToMbs=function(c,f,a,d){f=I(f,d,V);if(f.projector===u)return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],!0;if(k.isNone(f.projector))return!1;d=f.source;var e=f.dest;if(3===e.spatialReferenceId){f=U[d.spatialReferenceId][2];if(k.isNone(f))return!1;f(c,0,ea,0);f=Math.abs(Z*ea[1])+Math.asin(c[3]/(p.earthRadius+c[2]));m(ea,
0,a,0);a[3]=f>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(f)*c[3];return!0}f.projector(c,0,a,0);a[3]=c[3]*d.metersPerUnit/e.metersPerUnit;return!0};b.extentToBoundingBox=function(c,f,a){if(null==c)return!1;var d;F[0]=null!=c.xmin?c.xmin:0;F[1]=null!=c.ymin?c.ymin:0;F[2]=null!=c.zmin?c.zmin:0;d=x(F,c.spatialReference,0,f,a,0,1);F[0]=null!=c.xmax?c.xmax:0;F[1]=null!=c.ymax?c.ymax:0;F[2]=null!=c.zmax?c.zmax:0;d=d&&x(F,c.spatialReference,0,f,a,3,1);null==c.xmin&&(f[0]=-Infinity);null==c.ymin&&(f[1]=-Infinity);
null==c.zmin&&(f[2]=-Infinity);null==c.xmax&&(f[3]=Infinity);null==c.ymax&&(f[4]=Infinity);null==c.zmax&&(f[5]=Infinity);return d};b.extentToBoundingRect=function(c,f,a){if(null==c)return!1;var d;F[0]=null!=c.xmin?c.xmin:0;F[1]=null!=c.ymin?c.ymin:0;F[2]=null!=c.zmin?c.zmin:0;d=x(F,c.spatialReference,0,F,a,0,1);f[0]=F[0];f[1]=F[1];F[0]=null!=c.xmax?c.xmax:0;F[1]=null!=c.ymax?c.ymax:0;F[2]=null!=c.zmax?c.zmax:0;d=d&&x(F,c.spatialReference,0,F,a,0,1);f[2]=F[0];f[3]=F[1];null==c.xmin&&(f[0]=-Infinity);
null==c.ymin&&(f[1]=-Infinity);null==c.xmax&&(f[2]=Infinity);null==c.ymax&&(f[3]=Infinity);return d};b.boundingRectToBoundingRect=function(f,a,d,e){if(null==f)return!1;if(a.equals(e))return c.set(d,f),!0;var b;F[0]=f[0];F[1]=f[1];F[2]=0;b=x(F,a,0,F,e,0,1);d[0]=F[0];d[1]=F[1];F[0]=f[2];F[1]=f[3];F[2]=0;b=b&&x(F,a,0,F,e,0,1);d[2]=F[0];d[3]=F[1];return b};(function(c){c.x2lon=function(c){return c/p.earthRadius};c.y2lat=function(c){return Math.PI/2-2*Math.atan(Math.exp(-1*c/p.earthRadius))};c.lon2x=function(c){return c*
p.earthRadius};c.lat2y=function(c){c=Math.sin(c);return p.earthRadius/2*Math.log((1+c)/(1-c))}})(b.webMercator||(b.webMercator={}));b.canProjectToWGS84ComparableLonLat=function(c){c=w(c,Y);return!!U[c][6]};b.vectorToWGS84ComparableLonLat=v;b.pointToWGS84ComparableLonLat=z;b.pointToWGS84ComparableLonLatPoint=function(c,f){var a=w(f.spatialReference,X);return k.isNone(U[6][a])?!1:z(c,F)?(f.x=F[0],f.y=F[1],f.z=F[2],!0):!1};b.wgs84ComparableLonLatToECEF=function(c,f,a,d){void 0===d&&(d=0);d=p.earthRadius+
d;var e=Math.cos(a);c[0]=Math.cos(f)*e*d;c[1]=Math.sin(f)*e*d;c[2]=Math.sin(a)*d};var U=(Q={},Q[2]=(J={},J[5]=null,J[6]=u,J[1]=B,J[0]=null,J[3]=m,J[2]=u,J[4]=D,J),Q[5]=(N={},N[5]=u,N[6]=u,N[1]=B,N[0]=null,N[3]=null,N[2]=null,N[4]=D,N),Q[3]=(L={},L[5]=null,L[6]=y,L[1]=function(c,f,a,d){y(c,f,a,d);B(a,d,a,d)},L[0]=null,L[3]=u,L[2]=y,L[4]=function(c,f,a,d){y(c,f,a,d);D(a,d,a,d)},L),Q[4]=(M={},M[5]=K,M[6]=K,M[1]=function(c,f,a,d){K(c,f,a,d);B(a,d,a,d)},M[0]=null,M[3]=function(c,f,a,d){K(c,f,a,d);m(a,
d,a,d)},M[2]=K,M[4]=u,M),Q[1]=(R={},R[5]=C,R[6]=C,R[1]=u,R[0]=null,R[3]=function(c,f,a,d){C(c,f,a,d);m(a,d,a,d)},R[2]=C,R[4]=function(c,f,a,d){C(c,f,a,d);D(a,d,a,d)},R),Q[0]=(S={},S[5]=null,S[6]=null,S[1]=null,S[0]=u,S[3]=null,S[2]=null,S[4]=null,S),Q[6]=(T={},T[5]=null,T[6]=u,T[1]=B,T[0]=null,T[3]=null,T[2]=u,T[4]=D,T),Q),Y={spatialReference:null,spatialReferenceId:0},X={spatialReference:null,spatialReferenceId:0},P={source:{spatialReference:null,spatialReferenceId:0},dest:{spatialReference:null,
spatialReferenceId:0},projector:u},V={source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:u},Z=l.deg2rad(1),ca=l.rad2deg(1),da={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},F=e.vec3f64.create(),ea=e.vec3f64.create(),la=e.vec3f64.create(),ka=e.vec3f64.create(),oa=e.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require",
"exports","./math/mat4"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat4=l})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(n,b,l,k){function h(f){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f}function a(f,c,a){var d=c[0],e=c[1],b=c[2],q=c[3],g=c[4],h=c[5],k=c[6],m=c[7],v=c[8],z=c[9],B=c[10],l=c[11],D=c[12],K=c[13],I=c[14];
c=c[15];var n=a[0],J=a[1],N=a[2],L=a[3];f[0]=n*d+J*g+N*v+L*D;f[1]=n*e+J*h+N*z+L*K;f[2]=n*b+J*k+N*B+L*I;f[3]=n*q+J*m+N*l+L*c;n=a[4];J=a[5];N=a[6];L=a[7];f[4]=n*d+J*g+N*v+L*D;f[5]=n*e+J*h+N*z+L*K;f[6]=n*b+J*k+N*B+L*I;f[7]=n*q+J*m+N*l+L*c;n=a[8];J=a[9];N=a[10];L=a[11];f[8]=n*d+J*g+N*v+L*D;f[9]=n*e+J*h+N*z+L*K;f[10]=n*b+J*k+N*B+L*I;f[11]=n*q+J*m+N*l+L*c;n=a[12];J=a[13];N=a[14];L=a[15];f[12]=n*d+J*g+N*v+L*D;f[13]=n*e+J*h+N*z+L*K;f[14]=n*b+J*k+N*B+L*I;f[15]=n*q+J*m+N*l+L*c;return f}function g(f,c,a){var d=
c[0],e=c[1],b=c[2],q=c[3],g=d+d,h=e+e,k=b+b;c=d*g;var m=d*h,d=d*k,v=e*h,e=e*k,b=b*k,g=q*g,h=q*h,q=q*k;f[0]=1-(v+b);f[1]=m+q;f[2]=d-h;f[3]=0;f[4]=m-q;f[5]=1-(c+b);f[6]=e+g;f[7]=0;f[8]=d+h;f[9]=e-g;f[10]=1-(c+v);f[11]=0;f[12]=a[0];f[13]=a[1];f[14]=a[2];f[15]=1;return f}function e(f,c,a){f[0]=c[0]-a[0];f[1]=c[1]-a[1];f[2]=c[2]-a[2];f[3]=c[3]-a[3];f[4]=c[4]-a[4];f[5]=c[5]-a[5];f[6]=c[6]-a[6];f[7]=c[7]-a[7];f[8]=c[8]-a[8];f[9]=c[9]-a[9];f[10]=c[10]-a[10];f[11]=c[11]-a[11];f[12]=c[12]-a[12];f[13]=c[13]-
a[13];f[14]=c[14]-a[14];f[15]=c[15]-a[15];return f}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(f,c){f[0]=c[0];f[1]=c[1];f[2]=c[2];f[3]=c[3];f[4]=c[4];f[5]=c[5];f[6]=c[6];f[7]=c[7];f[8]=c[8];f[9]=c[9];f[10]=c[10];f[11]=c[11];f[12]=c[12];f[13]=c[13];f[14]=c[14];f[15]=c[15];return f};b.set=function(f,c,a,d,e,b,g,h,k,y,m,v,z,B,l,D,K){f[0]=c;f[1]=a;f[2]=d;f[3]=e;f[4]=b;f[5]=g;f[6]=h;f[7]=k;f[8]=y;f[9]=m;f[10]=v;f[11]=z;f[12]=B;f[13]=l;f[14]=D;f[15]=K;return f};b.identity=h;b.transpose=
function(f,c){if(f===c){var a=c[1],d=c[2],e=c[3],b=c[6],g=c[7],h=c[11];f[1]=c[4];f[2]=c[8];f[3]=c[12];f[4]=a;f[6]=c[9];f[7]=c[13];f[8]=d;f[9]=b;f[11]=c[14];f[12]=e;f[13]=g;f[14]=h}else f[0]=c[0],f[1]=c[4],f[2]=c[8],f[3]=c[12],f[4]=c[1],f[5]=c[5],f[6]=c[9],f[7]=c[13],f[8]=c[2],f[9]=c[6],f[10]=c[10],f[11]=c[14],f[12]=c[3],f[13]=c[7],f[14]=c[11],f[15]=c[15];return f};b.invert=function(f,c){var a=c[0],d=c[1],e=c[2],b=c[3],g=c[4],h=c[5],k=c[6],y=c[7],m=c[8],v=c[9],z=c[10],B=c[11],l=c[12],D=c[13],K=c[14];
c=c[15];var I=a*h-d*g,n=a*k-e*g,J=a*y-b*g,N=d*k-e*h,L=d*y-b*h,M=e*y-b*k,R=m*D-v*l,S=m*K-z*l,T=m*c-B*l,U=v*K-z*D,Y=v*c-B*D,X=z*c-B*K,P=I*X-n*Y+J*U+N*T-L*S+M*R;if(!P)return null;P=1/P;f[0]=(h*X-k*Y+y*U)*P;f[1]=(e*Y-d*X-b*U)*P;f[2]=(D*M-K*L+c*N)*P;f[3]=(z*L-v*M-B*N)*P;f[4]=(k*T-g*X-y*S)*P;f[5]=(a*X-e*T+b*S)*P;f[6]=(K*J-l*M-c*n)*P;f[7]=(m*M-z*J+B*n)*P;f[8]=(g*Y-h*T+y*R)*P;f[9]=(d*T-a*Y-b*R)*P;f[10]=(l*L-D*J+c*I)*P;f[11]=(v*J-m*L-B*I)*P;f[12]=(h*S-g*U-k*R)*P;f[13]=(a*U-d*S+e*R)*P;f[14]=(D*n-l*N-K*I)*P;
f[15]=(m*N-v*n+z*I)*P;return f};b.adjoint=function(f,c){var a=c[0],d=c[1],e=c[2],b=c[3],g=c[4],h=c[5],k=c[6],y=c[7],m=c[8],v=c[9],z=c[10],B=c[11],l=c[12],D=c[13],K=c[14];c=c[15];f[0]=h*(z*c-B*K)-v*(k*c-y*K)+D*(k*B-y*z);f[1]=-(d*(z*c-B*K)-v*(e*c-b*K)+D*(e*B-b*z));f[2]=d*(k*c-y*K)-h*(e*c-b*K)+D*(e*y-b*k);f[3]=-(d*(k*B-y*z)-h*(e*B-b*z)+v*(e*y-b*k));f[4]=-(g*(z*c-B*K)-m*(k*c-y*K)+l*(k*B-y*z));f[5]=a*(z*c-B*K)-m*(e*c-b*K)+l*(e*B-b*z);f[6]=-(a*(k*c-y*K)-g*(e*c-b*K)+l*(e*y-b*k));f[7]=a*(k*B-y*z)-g*(e*B-
b*z)+m*(e*y-b*k);f[8]=g*(v*c-B*D)-m*(h*c-y*D)+l*(h*B-y*v);f[9]=-(a*(v*c-B*D)-m*(d*c-b*D)+l*(d*B-b*v));f[10]=a*(h*c-y*D)-g*(d*c-b*D)+l*(d*y-b*h);f[11]=-(a*(h*B-y*v)-g*(d*B-b*v)+m*(d*y-b*h));f[12]=-(g*(v*K-z*D)-m*(h*K-k*D)+l*(h*z-k*v));f[13]=a*(v*K-z*D)-m*(d*K-e*D)+l*(d*z-e*v);f[14]=-(a*(h*K-k*D)-g*(d*K-e*D)+l*(d*k-e*h));f[15]=a*(h*z-k*v)-g*(d*z-e*v)+m*(d*k-e*h);return f};b.determinant=function(f){var c=f[0],a=f[1],d=f[2],e=f[3],b=f[4],g=f[5],h=f[6],k=f[7],y=f[8],m=f[9],v=f[10],z=f[11],B=f[12],l=f[13],
D=f[14];f=f[15];return(c*g-a*b)*(v*f-z*D)-(c*h-d*b)*(m*f-z*l)+(c*k-e*b)*(m*D-v*l)+(a*h-d*g)*(y*f-z*B)-(a*k-e*g)*(y*D-v*B)+(d*k-e*h)*(y*l-m*B)};b.multiply=a;b.translate=function(f,c,a){var d=a[0],e=a[1];a=a[2];var b=void 0,q=void 0,g=void 0,h=void 0,k=void 0,m=void 0,v=void 0,z=void 0,B=void 0,l=void 0,D=void 0,K=void 0;c===f?(f[12]=c[0]*d+c[4]*e+c[8]*a+c[12],f[13]=c[1]*d+c[5]*e+c[9]*a+c[13],f[14]=c[2]*d+c[6]*e+c[10]*a+c[14],f[15]=c[3]*d+c[7]*e+c[11]*a+c[15]):(b=c[0],q=c[1],g=c[2],h=c[3],k=c[4],m=
c[5],v=c[6],z=c[7],B=c[8],l=c[9],D=c[10],K=c[11],f[0]=b,f[1]=q,f[2]=g,f[3]=h,f[4]=k,f[5]=m,f[6]=v,f[7]=z,f[8]=B,f[9]=l,f[10]=D,f[11]=K,f[12]=b*d+k*e+B*a+c[12],f[13]=q*d+m*e+l*a+c[13],f[14]=g*d+v*e+D*a+c[14],f[15]=h*d+z*e+K*a+c[15]);return f};b.scale=function(f,c,a){var d=a[0],e=a[1];a=a[2];f[0]=c[0]*d;f[1]=c[1]*d;f[2]=c[2]*d;f[3]=c[3]*d;f[4]=c[4]*e;f[5]=c[5]*e;f[6]=c[6]*e;f[7]=c[7]*e;f[8]=c[8]*a;f[9]=c[9]*a;f[10]=c[10]*a;f[11]=c[11]*a;f[12]=c[12];f[13]=c[13];f[14]=c[14];f[15]=c[15];return f};b.rotate=
function(f,c,a,d){var e=d[0],b=d[1];d=d[2];var g=Math.sqrt(e*e+b*b+d*d),q=void 0,p=void 0,h=void 0,m=void 0,v=void 0,z=void 0,B=void 0,l=void 0,D=void 0,K=void 0,I=void 0,n=void 0,J=void 0,N=void 0,L=void 0,M=void 0,R=void 0,S=void 0,T=void 0,U=void 0,Y=void 0,X=void 0,p=q=void 0;if(g<k.EPSILON)return null;g=1/g;e*=g;b*=g;d*=g;q=Math.sin(a);p=Math.cos(a);h=1-p;m=c[0];v=c[1];z=c[2];B=c[3];l=c[4];D=c[5];K=c[6];I=c[7];n=c[8];J=c[9];N=c[10];L=c[11];M=e*e*h+p;R=b*e*h+d*q;S=d*e*h-b*q;T=e*b*h-d*q;U=b*b*
h+p;Y=d*b*h+e*q;X=e*d*h+b*q;q=b*d*h-e*q;p=d*d*h+p;f[0]=m*M+l*R+n*S;f[1]=v*M+D*R+J*S;f[2]=z*M+K*R+N*S;f[3]=B*M+I*R+L*S;f[4]=m*T+l*U+n*Y;f[5]=v*T+D*U+J*Y;f[6]=z*T+K*U+N*Y;f[7]=B*T+I*U+L*Y;f[8]=m*X+l*q+n*p;f[9]=v*X+D*q+J*p;f[10]=z*X+K*q+N*p;f[11]=B*X+I*q+L*p;c!==f&&(f[12]=c[12],f[13]=c[13],f[14]=c[14],f[15]=c[15]);return f};b.rotateX=function(f,c,a){var d=Math.sin(a);a=Math.cos(a);var e=c[4],b=c[5],g=c[6],q=c[7],h=c[8],k=c[9],m=c[10],v=c[11];c!==f&&(f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f[12]=c[12],
f[13]=c[13],f[14]=c[14],f[15]=c[15]);f[4]=e*a+h*d;f[5]=b*a+k*d;f[6]=g*a+m*d;f[7]=q*a+v*d;f[8]=h*a-e*d;f[9]=k*a-b*d;f[10]=m*a-g*d;f[11]=v*a-q*d;return f};b.rotateY=function(f,c,a){var d=Math.sin(a);a=Math.cos(a);var e=c[0],b=c[1],g=c[2],q=c[3],h=c[8],k=c[9],m=c[10],v=c[11];c!==f&&(f[4]=c[4],f[5]=c[5],f[6]=c[6],f[7]=c[7],f[12]=c[12],f[13]=c[13],f[14]=c[14],f[15]=c[15]);f[0]=e*a-h*d;f[1]=b*a-k*d;f[2]=g*a-m*d;f[3]=q*a-v*d;f[8]=e*d+h*a;f[9]=b*d+k*a;f[10]=g*d+m*a;f[11]=q*d+v*a;return f};b.rotateZ=function(f,
c,a){var d=Math.sin(a);a=Math.cos(a);var e=c[0],b=c[1],g=c[2],q=c[3],h=c[4],k=c[5],m=c[6],v=c[7];c!==f&&(f[8]=c[8],f[9]=c[9],f[10]=c[10],f[11]=c[11],f[12]=c[12],f[13]=c[13],f[14]=c[14],f[15]=c[15]);f[0]=e*a+h*d;f[1]=b*a+k*d;f[2]=g*a+m*d;f[3]=q*a+v*d;f[4]=h*a-e*d;f[5]=k*a-b*d;f[6]=m*a-g*d;f[7]=v*a-q*d;return f};b.fromTranslation=function(a,c){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};b.fromScaling=function(a,
c){a[0]=c[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=c[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotation=function(a,c,d){var f=d[0],e=d[1];d=d[2];var b=Math.sqrt(f*f+e*e+d*d),g=void 0,q=void 0,h=void 0;if(b<k.EPSILON)return null;b=1/b;f*=b;e*=b;d*=b;g=Math.sin(c);q=Math.cos(c);h=1-q;a[0]=f*f*h+q;a[1]=e*f*h+d*g;a[2]=d*f*h-e*g;a[3]=0;a[4]=f*e*h-d*g;a[5]=e*e*h+q;a[6]=d*e*h+f*g;a[7]=0;a[8]=f*d*h+e*g;a[9]=e*d*h-f*g;a[10]=d*d*h+q;a[11]=0;a[12]=0;a[13]=0;
a[14]=0;a[15]=1;return a};b.fromXRotation=function(a,c){var f=Math.sin(c);c=Math.cos(c);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=f;a[7]=0;a[8]=0;a[9]=-f;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromYRotation=function(a,c){var f=Math.sin(c);c=Math.cos(c);a[0]=c;a[1]=0;a[2]=-f;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=f;a[9]=0;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromZRotation=function(a,c){var d=Math.sin(c);c=Math.cos(c);a[0]=c;a[1]=d;a[2]=0;a[3]=0;a[4]=
-d;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotationTranslation=g;b.fromQuat2=function(a,c){var f=d,e=-c[0],b=-c[1],h=-c[2],k=c[3],w=c[4],u=c[5],y=c[6],m=c[7],v=e*e+b*b+h*h+k*k;0<v?(f[0]=2*(w*k+m*e+u*h-y*b)/v,f[1]=2*(u*k+m*b+y*e-w*h)/v,f[2]=2*(y*k+m*h+w*b-u*e)/v):(f[0]=2*(w*k+m*e+u*h-y*b),f[1]=2*(u*k+m*b+y*e-w*h),f[2]=2*(y*k+m*h+w*b-u*e));g(a,c,f);return a};var d=l.create();b.getTranslation=function(a,c){a[0]=c[12];a[1]=c[13];a[2]=c[14];return a};
b.getScaling=function(a,c){var d=c[0],f=c[1],e=c[2],b=c[4],g=c[5],h=c[6],k=c[8],y=c[9];c=c[10];a[0]=Math.sqrt(d*d+f*f+e*e);a[1]=Math.sqrt(b*b+g*g+h*h);a[2]=Math.sqrt(k*k+y*y+c*c);return a};b.getRotation=function(a,c){var d=c[0]+c[5]+c[10],f=0;0<d?(f=2*Math.sqrt(d+1),a[3]=.25*f,a[0]=(c[6]-c[9])/f,a[1]=(c[8]-c[2])/f,a[2]=(c[1]-c[4])/f):c[0]>c[5]&&c[0]>c[10]?(f=2*Math.sqrt(1+c[0]-c[5]-c[10]),a[3]=(c[6]-c[9])/f,a[0]=.25*f,a[1]=(c[1]+c[4])/f,a[2]=(c[8]+c[2])/f):c[5]>c[10]?(f=2*Math.sqrt(1+c[5]-c[0]-c[10]),
a[3]=(c[8]-c[2])/f,a[0]=(c[1]+c[4])/f,a[1]=.25*f,a[2]=(c[6]+c[9])/f):(f=2*Math.sqrt(1+c[10]-c[0]-c[5]),a[3]=(c[1]-c[4])/f,a[0]=(c[8]+c[2])/f,a[1]=(c[6]+c[9])/f,a[2]=.25*f);return a};b.fromRotationTranslationScale=function(a,c,d,e){var f=c[0],b=c[1],g=c[2],q=c[3],p=f+f,h=b+b,m=g+g;c=f*p;var v=f*h,f=f*m,k=b*h,b=b*m,g=g*m,p=q*p,h=q*h,q=q*m,m=e[0],B=e[1];e=e[2];a[0]=(1-(k+g))*m;a[1]=(v+q)*m;a[2]=(f-h)*m;a[3]=0;a[4]=(v-q)*B;a[5]=(1-(c+g))*B;a[6]=(b+p)*B;a[7]=0;a[8]=(f+h)*e;a[9]=(b-p)*e;a[10]=(1-(c+k))*
e;a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1;return a};b.fromRotationTranslationScaleOrigin=function(a,c,d,e,b){var f=c[0],g=c[1],q=c[2],p=c[3],h=f+f,m=g+g,r=q+q;c=f*h;var k=f*m,B=f*r,f=g*m,g=g*r,l=q*r,q=p*h,m=p*m,D=p*r,K=e[0],I=e[1],r=e[2];e=b[0];p=b[1];b=b[2];var h=(1-(f+l))*K,n=(k+D)*K,K=(B-m)*K,k=(k-D)*I,l=(1-(c+l))*I,I=(g+q)*I,B=(B+m)*r,g=(g-q)*r;c=(1-(c+f))*r;a[0]=h;a[1]=n;a[2]=K;a[3]=0;a[4]=k;a[5]=l;a[6]=I;a[7]=0;a[8]=B;a[9]=g;a[10]=c;a[11]=0;a[12]=d[0]+e-(h*e+k*p+B*b);a[13]=d[1]+p-(n*
e+l*p+g*b);a[14]=d[2]+b-(K*e+I*p+c*b);a[15]=1;return a};b.fromQuat=function(a,c){var d=c[0],f=c[1],e=c[2];c=c[3];var b=d+d,g=f+f,h=e+e,d=d*b,k=f*b,f=f*g,y=e*b,m=e*g,e=e*h,b=c*b,g=c*g;c*=h;a[0]=1-f-e;a[1]=k+c;a[2]=y-g;a[3]=0;a[4]=k-c;a[5]=1-d-e;a[6]=m+b;a[7]=0;a[8]=y+g;a[9]=m-b;a[10]=1-d-f;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.frustum=function(a,c,d,e,b,g,h){var f=1/(d-c),q=1/(b-e),p=1/(g-h);a[0]=2*g*f;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*g*q;a[6]=0;a[7]=0;a[8]=(d+c)*f;a[9]=(b+e)*q;a[10]=
(h+g)*p;a[11]=-1;a[12]=0;a[13]=0;a[14]=h*g*2*p;a[15]=0;return a};b.perspective=function(a,c,d,e,b){c=1/Math.tan(c/2);var f=void 0;a[0]=c/d;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=b&&Infinity!==b?(f=1/(e-b),a[10]=(b+e)*f,a[14]=2*b*e*f):(a[10]=-1,a[14]=-2*e);return a};b.perspectiveFromFieldOfView=function(a,c,d,e){var f=Math.tan(c.upDegrees*Math.PI/180),b=Math.tan(c.downDegrees*Math.PI/180),g=Math.tan(c.leftDegrees*Math.PI/180);c=Math.tan(c.rightDegrees*
Math.PI/180);var q=2/(g+c),p=2/(f+b);a[0]=q;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=p;a[6]=0;a[7]=0;a[8]=-((g-c)*q*.5);a[9]=(f-b)*p*.5;a[10]=e/(d-e);a[11]=-1;a[12]=0;a[13]=0;a[14]=e*d/(d-e);a[15]=0;return a};b.ortho=function(a,c,d,e,b,g,h){var f=1/(c-d),q=1/(e-b),p=1/(g-h);a[0]=-2*f;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*q;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*p;a[11]=0;a[12]=(c+d)*f;a[13]=(b+e)*q;a[14]=(h+g)*p;a[15]=1;return a};b.lookAt=function(a,c,d,e){var f=void 0,b=void 0,g=void 0,q=void 0,p=void 0,y=void 0,
m=void 0,v=void 0,z=void 0,B=void 0,l=c[0],D=c[1];c=c[2];g=e[0];q=e[1];e=e[2];m=d[0];v=d[1];d=d[2];if(Math.abs(l-m)<k.EPSILON&&Math.abs(D-v)<k.EPSILON&&Math.abs(c-d)<k.EPSILON)return h(a);m=l-m;v=D-v;z=c-d;B=1/Math.sqrt(m*m+v*v+z*z);m*=B;v*=B;z*=B;f=q*z-e*v;b=e*m-g*z;g=g*v-q*m;(B=Math.sqrt(f*f+b*b+g*g))?(B=1/B,f*=B,b*=B,g*=B):g=b=f=0;q=v*g-z*b;p=z*f-m*g;y=m*b-v*f;(B=Math.sqrt(q*q+p*p+y*y))?(B=1/B,q*=B,p*=B,y*=B):y=p=q=0;a[0]=f;a[1]=q;a[2]=m;a[3]=0;a[4]=b;a[5]=p;a[6]=v;a[7]=0;a[8]=g;a[9]=y;a[10]=z;
a[11]=0;a[12]=-(f*l+b*D+g*c);a[13]=-(q*l+p*D+y*c);a[14]=-(m*l+v*D+z*c);a[15]=1;return a};b.targetTo=function(a,c,d,e){var f=c[0],b=c[1];c=c[2];var g=e[0],q=e[1],p=e[2];e=f-d[0];var h=b-d[1];d=c-d[2];var m=e*e+h*h+d*d;0<m&&(m=1/Math.sqrt(m),e*=m,h*=m,d*=m);var v=q*d-p*h,p=p*e-g*d,g=g*h-q*e,m=v*v+p*p+g*g;0<m&&(m=1/Math.sqrt(m),v*=m,p*=m,g*=m);a[0]=v;a[1]=p;a[2]=g;a[3]=0;a[4]=h*g-d*p;a[5]=d*v-e*g;a[6]=e*p-h*v;a[7]=0;a[8]=e;a[9]=h;a[10]=d;a[11]=0;a[12]=f;a[13]=b;a[14]=c;a[15]=1;return a};b.str=function(a){return"mat4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};b.add=function(a,c,
d){a[0]=c[0]+d[0];a[1]=c[1]+d[1];a[2]=c[2]+d[2];a[3]=c[3]+d[3];a[4]=c[4]+d[4];a[5]=c[5]+d[5];a[6]=c[6]+d[6];a[7]=c[7]+d[7];a[8]=c[8]+d[8];a[9]=c[9]+d[9];a[10]=c[10]+d[10];a[11]=c[11]+d[11];a[12]=c[12]+d[12];a[13]=c[13]+d[13];a[14]=c[14]+d[14];a[15]=c[15]+d[15];return a};b.subtract=e;b.multiplyScalar=function(a,c,d){a[0]=c[0]*d;a[1]=c[1]*d;a[2]=c[2]*d;a[3]=c[3]*d;a[4]=c[4]*d;a[5]=c[5]*d;a[6]=c[6]*d;a[7]=c[7]*d;a[8]=c[8]*d;a[9]=c[9]*d;a[10]=c[10]*d;a[11]=c[11]*d;a[12]=c[12]*d;a[13]=c[13]*d;a[14]=c[14]*
d;a[15]=c[15]*d;return a};b.multiplyScalarAndAdd=function(a,c,d,e){a[0]=c[0]+d[0]*e;a[1]=c[1]+d[1]*e;a[2]=c[2]+d[2]*e;a[3]=c[3]+d[3]*e;a[4]=c[4]+d[4]*e;a[5]=c[5]+d[5]*e;a[6]=c[6]+d[6]*e;a[7]=c[7]+d[7]*e;a[8]=c[8]+d[8]*e;a[9]=c[9]+d[9]*e;a[10]=c[10]+d[10]*e;a[11]=c[11]+d[11]*e;a[12]=c[12]+d[12]*e;a[13]=c[13]+d[13]*e;a[14]=c[14]+d[14]*e;a[15]=c[15]+d[15]*e;return a};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&
a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]};b.equals=function(a,c){var d=a[0],e=a[1],f=a[2],b=a[3],g=a[4],h=a[5],u=a[6],y=a[7],m=a[8],v=a[9],z=a[10],B=a[11],l=a[12],D=a[13],K=a[14];a=a[15];var I=c[0],n=c[1],J=c[2],N=c[3],L=c[4],M=c[5],R=c[6],S=c[7],T=c[8],U=c[9],Y=c[10],X=c[11],P=c[12],V=c[13],Z=c[14];c=c[15];return Math.abs(d-I)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(e-n)<=k.EPSILON*Math.max(1,Math.abs(e),Math.abs(n))&&
Math.abs(f-J)<=k.EPSILON*Math.max(1,Math.abs(f),Math.abs(J))&&Math.abs(b-N)<=k.EPSILON*Math.max(1,Math.abs(b),Math.abs(N))&&Math.abs(g-L)<=k.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(h-M)<=k.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(u-R)<=k.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(y-S)<=k.EPSILON*Math.max(1,Math.abs(y),Math.abs(S))&&Math.abs(m-T)<=k.EPSILON*Math.max(1,Math.abs(m),Math.abs(T))&&Math.abs(v-U)<=k.EPSILON*Math.max(1,Math.abs(v),Math.abs(U))&&Math.abs(z-
Y)<=k.EPSILON*Math.max(1,Math.abs(z),Math.abs(Y))&&Math.abs(B-X)<=k.EPSILON*Math.max(1,Math.abs(B),Math.abs(X))&&Math.abs(l-P)<=k.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(D-V)<=k.EPSILON*Math.max(1,Math.abs(D),Math.abs(V))&&Math.abs(K-Z)<=k.EPSILON*Math.max(1,Math.abs(K),Math.abs(Z))&&Math.abs(a-c)<=k.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};b.mul=a;b.sub=e})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/mathUtils ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./projectionUtils".split(" "),
function(n,b,l,k,h,a,g,e){function d(a,c,d,e){var f,m;a instanceof g&&c instanceof g&&(d=c.longitude,e=c.latitude,m=a.latitude,f=a.longitude);a=l.deg2rad(m);e=l.deg2rad(e);f=l.deg2rad(f);c=l.deg2rad(d);d=Math.sin((a-e)/2);f=Math.sin((f-c)/2);d=2*l.asinClamped(Math.sqrt(d*d+Math.cos(a)*Math.cos(e)*f*f))*b.earthRadius;return Math.round(1E4*d)/1E4}function f(a,c,d){a=d/b.earthRadius;c=l.deg2rad(c);a=Math.sin(a/2);c=Math.cos(c);c=2*l.asinClamped(Math.sqrt(a*a/(c*c)));return l.rad2deg(c)}function c(a,
c,d){return l.rad2deg(d/b.earthRadius)}function q(a,c){a/=15;c||(a=Math.round(a));return a}Object.defineProperty(b,"__esModule",{value:!0});b.earthRadius=k.wgs84Radius;b.halfEarthRadius=b.earthRadius/2;b.halfEarthCircumference=Math.PI*b.earthRadius;b.earthCircumference=2*b.halfEarthCircumference;b.metersPerDegree=b.halfEarthCircumference/180;b.getGreatCircleDistance=d;b.getGreatCircleSpanAt=function(a,c,e){var f=c.spatialReference,b=new g(c.x,a.y,f),m=new g(e.x,a.y,f);c=new g(a.x,c.y,f);a=new g(a.x,
e.y,f);return{lon:d(b,m),lat:d(c,a)}};b.getLonDeltaForDistance=f;b.getLatDeltaForDistance=c;b.getLatLonDeltaForDistance=function(a,d,e){return{lat:c(a,d,e),lon:f(a,d,e)}};b.getMaxCameraAltitude=function(a){a=l.deg2rad(a/2);return(1-Math.sin(a))*b.earthRadius/Math.sin(a)};b.getViewExtentDistance=function(a,c){c=l.deg2rad(c/2);return 2*l.acosClamped((Math.pow(a+b.earthRadius,2)+Math.pow(b.earthRadius,2)-Math.pow((a+b.earthRadius)*Math.cos(c)-Math.sqrt(Math.pow(Math.cos(c)*(a+b.earthRadius),2)-a*a-2*
a*b.earthRadius),2))/(2*(a+b.earthRadius)*b.earthRadius))*b.earthRadius};b.computeCartesianDistance=function(a,c){a=e.wgs84ComparableLonLatToECEF(p,a.longitude,a.latitude,a.z||0);c=e.wgs84ComparableLonLatToECEF(r,c.longitude,c.latitude,c.z||0);c=[c[0]-a[0],c[1]-a[1],c[2]-a[2]];return Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2])};b.longitudeToTimezone=q;b.positionToTimezone=function(a,c){c||(c={hours:0,minutes:0,seconds:0});c.hours=q(a[0],!0);a=c.hours%1;c.hours-=a;c.minutes=60*a;a=c.minutes%1;c.minutes-=
a;c.seconds=Math.round(60*a);return c};b.distanceToIdealHorizon=function(a,c){c=c||b.earthRadius;a=h.vec3.dot(a,a);return Math.sqrt(Math.abs(a-c*c))};var p=a.vec3f64.create(),r=a.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});(function(b){b.length=function(b,h){var a=b[h],g=b[h+1];b=b[h+2];return Math.sqrt(a*a+g*g+b*b)};b.normalize=function(b,h){var a=b[h],g=b[h+1],e=b[h+2],
a=1/Math.sqrt(a*a+g*g+e*e);b[h]*=a;b[h+1]*=a;b[h+2]*=a};b.scale=function(b,h,a){b[h]*=a;b[h+1]*=a;b[h+2]*=a};b.add=function(b,h,a,g,e,d){void 0===d&&(d=h);e=e||b;e[d]=b[h]+a[g];e[d+1]=b[h+1]+a[g+1];e[d+2]=b[h+2]+a[g+2]};b.subtract=function(b,h,a,g,e,d){void 0===d&&(d=h);e=e||b;e[d]=b[h]-a[g];e[d+1]=b[h+1]-a[g+1];e[d+2]=b[h+2]-a[g+2]}})(b.Vec3Compact||(b.Vec3Compact={}))})},"esri/views/PopupView":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/generatorHelper ../core/arrayUtils ../core/asyncUtils ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){Object.defineProperty(b,"__esModule",{value:!0});b.PopupView=function(b){return function(b){function p(){return null!==b&&b.apply(this,arguments)||this}k(p,b);p.prototype.when=function(a,c){return this.inherited(arguments)};p.prototype.fetchPopupFeatures=function(a,c){return d.safeCast(this._fetchPopupFeaturesAsync(a,c))};p.prototype._fetchPopupFeaturesAsync=function(d,f){return a(this,void 0,void 0,function(){var a,b,m,q,p,h;return g(this,function(g){switch(g.label){case 0:return[4,
this.when()];case 1:return g.sent(),[4,this._prepareFetchPopupFeatures(d,f)];case 2:return a=g.sent(),b=a.location,m=this._queryLayerPopupFeatures(a,f),q=c.resolve(a.clientOnlyGraphics),p=[q].concat(m),h=c.eachAlwaysValues(p).then(e.flatten),[2,{promise:h,location:b,promises:p}]}})})};p.prototype._queryLayerPopupFeatures=function(a,c){var d=a.queryArea;return a.layerViewsAndGraphics.map(function(a){var e=a.layerView;a={clientGraphics:a.graphics,signal:f.isSome(c)?c.signal:null,defaultPopupTemplateEnabled:f.isSome(c)?
!!c.defaultPopupTemplateEnabled:!1};return e.fetchPopupFeatures(d,a)})};p.prototype._isValidPopupGraphic=function(a,c){return a&&!!a.getEffectivePopupTemplate(f.isSome(c)&&c.defaultPopupTemplateEnabled)};p.prototype._prepareFetchPopupFeatures=function(c,d){return a(this,void 0,void 0,function(){var a,e,f,b,q,p,h,r;return g(this,function(g){switch(g.label){case 0:return[4,this._popupHitTestGraphics(c,d)];case 1:return a=g.sent(),e=a.clientGraphics,f=a.queryArea,b=a.location,q=this._getFetchPopupLayerViews(),
p=this._graphicsPerFetchPopupLayerView(e,q),h=p.layerViewsAndGraphics,r=p.clientOnlyGraphics,[2,{clientOnlyGraphics:r,layerViewsAndGraphics:h,queryArea:f,location:b}]}})})};p.prototype._popupHitTestGraphics=function(c,d){return a(this,void 0,void 0,function(){var a,e,f,b,q,p,h=this;return g(this,function(g){switch(g.label){case 0:return[4,this.popupHitTest(c)];case 1:return a=g.sent(),e=a.results,f=a.mapPoint,b=e.filter(function(a){return h._isValidPopupGraphic(a.graphic,d)}),q=b.length?b[0].mapPoint:
null,p=b.map(function(a){return a.graphic}),[2,{clientGraphics:p,queryArea:f,location:f||q}]}})})};p.prototype._getFetchPopupLayerViews=function(){var a=this,c=[];this.allLayerViews.forEach(function(d){a._isValidPopupLayerView(d)&&c.push(d)});f.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&c.push(this.graphicsView);return c.reverse()};p.prototype._isValidPopupLayerView=function(a){return f.isSome(a)&&(!("layer"in a)||!a.suspended)&&"fetchPopupFeatures"in a};p.prototype._graphicsPerFetchPopupLayerView=
function(a,c){var d=[],e=new Map;c=c.map(function(a){var c=[];"layer"in a?e.set(a.layer,c):e.set(a.graphics,c);return{layerView:a,graphics:c}});for(var f=0;f<a.length;f++){var b=a[f],g=e.get(b.layer)||null;g?g.push(b):d.push(b)}return{layerViewsAndGraphics:c,clientOnlyGraphics:d}};return p=h([q.subclass("esri.views.PopupView")],p)}(q.declared(b))}})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(n,b,l,k,h,a,g,e,d,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.tilt=new f.default;a.altitude=new g.default;a.clipDistance=new e.default;a.collision=new d.default;return a}l(b,c);k([a.property({type:f.default})],b.prototype,"tilt",void 0);k([a.property({type:g.default})],b.prototype,"altitude",void 0);k([a.property({type:e.default})],b.prototype,"clipDistance",void 0);k([a.property({type:d.default})],b.prototype,
"collision",void 0);return b=k([a.subclass("esri.views.3d.constraints.Constraints")],b)}(a.declared(h));b.Constraints=n;b.default=n})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function d(){var c=
null!==a&&a.apply(this,arguments)||this;c.min=e.AltitudeDefault.min;c.max=e.AltitudeDefault.max;return c}l(d,a);Object.defineProperty(d.prototype,"mode",{get:function(){h.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.","","4.6");return"manual"},set:function(a){h.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
"","4.6")},enumerable:!0,configurable:!0});k([g.property({type:Number})],d.prototype,"min",void 0);k([g.property({type:Number})],d.prototype,"max",void 0);return d=k([g.subclass("esri.views.3d.constraints.AltitudeConstraint")],d)}(g.declared(a));b.AltitudeConstraint=n;b.default=n})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/mathUtils ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});var q=a.getLogger("esri.views.3d.state.Constraints");n=function(a){function f(c){c=a.call(this)||this;c.collision=new r;c.distance=Infinity;c.minimumPoiDistance=4;return c}l(f,a);Object.defineProperty(f.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(a){"local"===this.mode?q.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",a)},enumerable:!0,
configurable:!0});f.prototype.clampAltitude=function(a){return this.altitude?g.clamp(a,this.altitude.min,this.altitude.max):a};f.prototype.clampTilt=function(a,c){if(!this.tilt)return c;a=this.tilt(a);return g.clamp(c,a.min,a.max)};f.prototype.clampDistance=function(a){return Math.min(a,this.distance)};f.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};f.prototype.createConstantMaxTilt=function(a){return function(c,d){void 0===
d&&(d=p);d.min=b.TiltDefault.min;d.max=a;return d}};f.prototype.createDefaultTiltLocal=function(){var a=this.collision.enabled?c.makePiecewiseLinearFunction([[4E3,b.TiltDefault.max],[1E4,e.deg2rad(88)],[6E6,e.deg2rad(88)]]):function(){return b.TiltDefault.max};return function(c,d){void 0===d&&(d=p);d.min=b.TiltDefault.min;d.max=a(c);return d}};f.prototype.createDefaultTiltGlobal=function(){var a=this.collision.enabled?c.makePiecewiseLinearFunction([[4E3,b.TiltDefault.max],[5E4,e.deg2rad(88)],[6E6,
e.deg2rad(88)],[2E7,b.TiltDefault.min]]):c.makePiecewiseLinearFunction([[3E5,b.TiltDefault.max],[3E6,e.deg2rad(88)],[6E6,e.deg2rad(88)],[2E7,b.TiltDefault.min]]);return function(c,d){void 0===d&&(d=p);d.min=b.TiltDefault.min;d.max=a(c);return d}};k([d.property()],f.prototype,"altitude",null);k([d.property({readOnly:!0})],f.prototype,"collision",void 0);k([d.property()],f.prototype,"distance",void 0);k([d.property({readOnly:!0})],f.prototype,"minimumPoiDistance",void 0);k([d.property()],f.prototype,
"tilt",void 0);k([d.property({constructOnly:!0})],f.prototype,"mode",void 0);return f=k([d.subclass("esri.views.3d.state.Constraints")],f)}(d.declared(h));b.Constraints=n;b.AltitudeDefault={min:-2E5,max:4*f.earthRadius};b.TiltDefault={min:e.deg2rad(.5),max:e.deg2rad(179.5)};var p={min:0,max:0},r=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.enabled=!0;c.elevationMargin=5;return c}l(c,a);k([d.property({type:Boolean})],c.prototype,"enabled",void 0);k([d.property({type:Number})],
c.prototype,"elevationMargin",void 0);return c=k([d.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],c)}(d.declared(h));b.default=n})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=
null!==b&&b.apply(this,arguments)||this;a.mode="auto";return a}l(e,b);Object.defineProperty(e.prototype,"near",{get:function(){return this._get("near")},set:function(a){this._set("near",a);a>=this._get("far")&&(this.far=a+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});e.prototype.castNear=function(a){return Math.max(1E-8,a)};Object.defineProperty(e.prototype,"far",{get:function(){return this._get("far")},set:function(a){this._set("far",a);a<=this._get("near")&&(this.near=a-1E-9);this.mode=
"manual"},enumerable:!0,configurable:!0});e.prototype.castFar=function(a){return Math.max(1E-8,a)};e.prototype.autoUpdate=function(a,e){"auto"===this.mode&&(this._get("near")!==a&&this._set("near",a),this._get("far")!==e&&this._set("far",e))};k([a.property({type:Number,value:1E-8})],e.prototype,"near",null);k([a.cast("near")],e.prototype,"castNear",null);k([a.property({type:Number,value:1E-8})],e.prototype,"far",null);k([a.cast("far")],e.prototype,"castFar",null);k([a.property({type:["auto","manual"]})],
e.prototype,"mode",void 0);return e=k([a.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],e)}(a.declared(h));b.ClipDistanceConstraint=n;b.default=n})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function d(){return null!==
a&&a.apply(this,arguments)||this}l(d,a);Object.defineProperty(d.prototype,"enabled",{set:function(a){h.deprecated("SceneView.constraint.collision.enabled","Use Map.ground.navigationConstraint instead","4.8");this._set("enabled",a)},enumerable:!0,configurable:!0});k([g.property({value:!0})],d.prototype,"enabled",null);return d=k([g.subclass("esri.views.3d.constraints.CollisionConstraint")],d)}(g.declared(a));b.CollisionConstraint=n;b.default=n})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});var d=a.rad2deg(e.TiltDefault.min),f=a.rad2deg(e.TiltDefault.max);n=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;a.mode="auto";return a}l(e,c);Object.defineProperty(e.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0});e.prototype.castMax=function(c){return a.clamp(c,d,f)};e.prototype.autoUpdate=function(a){"auto"===
this.mode&&this._get("max")!==a&&this._set("max",a)};k([g.property({type:["auto","manual"]})],e.prototype,"mode",void 0);k([g.property({type:Number,value:f})],e.prototype,"max",null);k([g.cast("max")],e.prototype,"castMax",null);return e=k([g.subclass("esri.views.3d.constraints.TiltConstraint")],e)}(g.declared(h));b.TiltConstraint=n;b.default=n})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){return function(c){function b(a){a=c.call(this,a)||this;a.atmosphere=new d.default;return a}l(b,c);p=b;b.fromWebsceneEnvironment=function(a){a=a.cloneConstructProperties();return new p(h({},a,{lighting:f.SceneViewLighting.fromWebsceneLighting(a.lighting)}))};b.prototype.castLighting=function(a){return a?a instanceof f.SceneViewLighting?a:a instanceof q?this.lighting?this.lighting.cloneWithWebsceneLighting(a):f.SceneViewLighting.fromWebsceneLighting(a):e.ensureType(f.SceneViewLighting,
a):new f.SceneViewLighting};b.prototype.clone=function(){return new p({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:a.clone(this.background)})};var p;k([g.property({type:d.default,json:{read:!1}})],b.prototype,"atmosphere",void 0);k([g.property()],b.prototype,"lighting",void 0);k([g.cast("lighting")],b.prototype,"castLighting",null);return b=p=k([g.subclass("esri.views.3d.environment.SceneViewEnvironment")],
b)}(g.declared(c))})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}l(e,b);d=e;Object.defineProperty(e.prototype,"quality",{set:function(a){-1!==["low","high"].indexOf(a)&&
this._set("quality",a)},enumerable:!0,configurable:!0});e.prototype.clone=function(){return new d({quality:this.quality})};var d;k([a.property({type:["low","high"],value:"low"})],e.prototype,"quality",null);return e=d=k([a.subclass("esri.views.3d.environment.SceneViewAtmosphere")],e)}(a.declared(h));b.SceneViewAtmosphere=n;b.default=n})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function c(c){c=a.call(this,c)||this;c.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};c.cameraTrackingEnabled=!0;c.ambientOcclusionEnabled=!1;var d=(new Date).getFullYear(),d=new Date("March 15, "+d+" 12:00:00 UTC");c._set("defaultDate",d);c._set("date",d);return c}l(c,a);e=c;c.fromWebsceneLighting=function(a){return new e(h({},a.cloneConstructProperties()))};Object.defineProperty(c.prototype,
"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var c=this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);c&&this._set("date",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(a.getTime())))},enumerable:!0,configurable:!0});c.prototype.autoUpdate=function(a,c){var e=this._calculateTimezoneOffset(this.positionTimezoneInfo);
this.positionTimezoneInfo.hours=c.hours;this.positionTimezoneInfo.minutes=c.minutes;this.positionTimezoneInfo.seconds=c.seconds;c=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=!0,c=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())));var b=this._calculateTimezoneOffset(this.positionTimezoneInfo);e!==b&&(d.target=this,d.timezoneOffset=b,this.emit("timezone-will-change",d));if(null!=a)return c!==a.getTime()};c.prototype.clone=function(){var a=this._get("date")===this._get("defaultDate"),
c=new e(h({},this.cloneConstructProperties(),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled}));a&&c._set("date",c._get("defaultDate"));c.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;c.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;c.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;c.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return c};c.prototype.cloneWithWebsceneLighting=
function(a){var c=this.clone();null!=a.date&&(c.date=a.date);c.directShadowsEnabled=a.directShadowsEnabled;c.displayUTCOffset=a.displayUTCOffset;return c};c.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)};var e;k([g.property({type:Boolean})],c.prototype,"cameraTrackingEnabled",void 0);k([g.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);k([g.property({type:Date})],c.prototype,"defaultDate",null);k([g.property({type:Date})],
c.prototype,"date",null);return c=e=k([g.subclass("esri.views.3d.environment.SceneViewLighting")],c)}(g.declared(a.EventedMixin(e)));b.SceneViewLighting=n;var d={target:null,timezoneOffset:0};b.default=n})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a){return function(b){function e(a){a=b.call(this,a)||this;a.date=null;a.directShadowsEnabled=
!1;a.displayUTCOffset=null;return a}l(e,b);d=e;e.prototype.readDate=function(a,c){return null!=c.datetime&&new Date(c.datetime)||null};e.prototype.writeDate=function(a,c,d){c[d]=a.getTime()};e.prototype.readDirectShadowsEnabled=function(a,c){return!!c.directShadows};e.prototype.writedirectShadowsEnabled=function(a,c,d){a&&(c[d]=a)};e.prototype.writeDisplayUTCOffset=function(a,c){null!=a&&(c.displayUTCOffset=a)};e.prototype.clone=function(){return new d(this.cloneConstructProperties())};e.prototype.cloneConstructProperties=
function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var d;k([a.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],e.prototype,"date",void 0);k([a.reader("date",["datetime"])],e.prototype,"readDate",null);k([a.writer("date")],e.prototype,"writeDate",null);k([a.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],
e.prototype,"directShadowsEnabled",void 0);k([a.reader("directShadowsEnabled",["directShadows"])],e.prototype,"readDirectShadowsEnabled",null);k([a.writer("directShadowsEnabled")],e.prototype,"writedirectShadowsEnabled",null);k([a.property({type:Number,json:{write:!0}})],e.prototype,"displayUTCOffset",void 0);k([a.writer("displayUTCOffset")],e.prototype,"writeDisplayUTCOffset",null);return e=d=k([a.subclass("esri.webscene.Lighting")],e)}(a.declared(h.JSONSupport))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(n,b,l,k,h,a,g,e,d){var f=function(a,d,e){return{enabled:!e||!e.isPresentation}};return function(c){function b(a){a=c.call(this,a)||this;a.lighting=new e;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}l(b,c);p=b;b.prototype.clone=function(){return new p(this.cloneConstructProperties())};b.prototype.cloneConstructProperties=function(){return{lighting:e.prototype.clone.call(this.lighting),background:a.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var p;k([g.property({type:e,json:{write:!0}})],b.prototype,"lighting",void 0);k([g.property(d.backgroundProperty)],b.prototype,"background",void 0);k([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:f}}})],b.prototype,"atmosphereEnabled",void 0);k([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:f}}})],b.prototype,"starsEnabled",void 0);return b=p=k([g.subclass("esri.webscene.Environment")],b)}(g.declared(h.JSONSupport))})},"esri/webscene/background/utils":function(){define(["require",
"exports","./Background","./ColorBackground"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n={base:l,key:"type",typeMap:{color:k}};b.backgroundProperty={types:n,json:{read:function(b){return function(a,g,e){if(!a)return a;for(var d in b.typeMap)if(a.type===d)return g=new b.typeMap[d],g.read(a,e),g}}(n),write:{overridePolicy:function(b,a,g){return{enabled:!g||!g.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(n,b,l,k,h,a,g,e){var d=a.strict()({color:"color"});return function(a){function c(c){return a.call(this)||this}l(c,a);c.prototype.normalizeCtorArgs=function(a){a&&a.type&&(a=h({},a),delete a.type);return a};c.prototype.clone=function(){};k([e.property({type:d.apiValues,readOnly:!0,json:{type:d.jsonValues,read:!1,write:d.write}})],c.prototype,"type",void 0);return c=k([e.subclass("esri.webscene.background.Background")],c)}(e.declared(g.JSONSupport))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(n,b,l,k,h,a,g,e,d){var f=h({},e.colorAndTransparencyProperty,{nonNullable:!0});return function(c){function d(d){d=c.call(this)||this;d.type="color";d.color=new a([0,0,0,1]);return d}l(d,c);e=d;d.prototype.clone=function(){return new e(this.cloneProperties())};d.prototype.cloneProperties=function(){return{color:this.color.clone()}};var e;k([g.enumeration.serializable()({color:"color"})],d.prototype,"type",void 0);k([g.property(f)],d.prototype,"color",void 0);return d=e=k([g.subclass("esri.webscene.background.ColorBackground")],
d)}(g.declared(d))})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ./EnvironmentRenderer ../support/earthUtils ../support/projectionUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z){Object.defineProperty(b,"__esModule",{value:!0});var B=t.vec3f64.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);n=function(e){function b(a){a=e.call(this)||this;a._referencePointUpdateDelay=200;a._referencePointUpdateInterval=3E3;a._referencePointUpdateDistThreshold=1E6;a._referencePosUpdateQuery=null;a._referencePosMapCoordsRequested=null;a._viewHandles=new d;a._preserveAbsoluteDateTime=!1;a._trackingEnabled=!1;a._viewConnected=
!1;a._referencePosResetPreserveAbsoluteTime=!1;a.referencePosUpdateTimer=null;a._referencePosWGS84Comparable=null;a._referencePosMapCoords=null;a._mainLight=new v.MainLight;a._ambientLight=new v.AmbientLight;a._moonLight=new v.FillLight;a._renderer=null;a._resetReferencePosition();return a}l(b,e);b.prototype.destroy=function(){this._viewHandles.destroy();this.disposeRendering()};Object.defineProperty(b.prototype,"updating",{get:function(){return this._viewConnected?!!(!this.disableQueries&&(this._referencePosUpdateQuery||
this._referencePosMapCoordsRequested)||this._renderer&&this._renderer.updating):!1},enumerable:!0,configurable:!0});b.prototype.updateReadyChange=function(a){a&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view),this.notifyChange("updating")):!a&&this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view),this.notifyChange("updating"))};b.prototype.disposeRendering=function(){this._renderer&&(this._renderer.destroy(),this._renderer=null);this._resetReferencePosition()};
b.prototype.connectView=function(a){var c=this;this._renderer=new w({view:a});this._viewHandles.add([this.view.watch("environment.lighting.date",function(a){return c._lightingDateHandler(a)},!0),this.view.watch("interacting,stationary",this._interactingStationaryHandler.bind(this)),this.view.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.background.color"],function(){return c._updateRenderParamsHandler()},!0),this.view.watch("spatialReference",
function(){return c._resetReferencePosition()},!0),q.init(this.view,"viewingMode",function(){return c._resetReferencePosition()},!0),q.init(this.view,"environment.lighting.cameraTrackingEnabled",function(a){return c._updateCameraTracking(a)},!0),q.init(this,"view.state.camera",function(){return c._cameraHandler(null)},!0),this.watch("disableQueries",function(){return c._cameraHandler(null)})]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()};b.prototype._updateCameraTracking=
function(a){if(this._trackingEnabled=a)this._cameraHandler();else if(a=this.get("view.environment.lighting"))a.positionTimezoneInfo.autoUpdated=!1};b.prototype.disconnectView=function(a){this.disposeRendering();this._viewHandles.removeAll()};b.prototype._lightingDateHandler=function(a){if(a){var c=this.view.environment.lighting;if(!c.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!y.canProjectToWGS84ComparableLonLat(this.view.spatialReference)){var d=this.view.camera.position;
if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(d)){this._requestReferencePositionUpdate(d);return}}this._preupdateTracking(a);this._referencePosWGS84Comparable&&(d=u.positionToTimezone(this._referencePosWGS84Comparable,D),f.isSome(d)&&(c.autoUpdate(null,d),this._trackingEnabled&&(c.positionTimezoneInfo.autoUpdated=!0)))}this._updateLightParams(a)}};b.prototype._preupdateTracking=function(a){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&
this._cameraHandler(a)};b.prototype._cameraHandler=function(a){void 0===a&&(a=null);if(this.view.ready){var c=this.view.camera;c&&(this._cameraHandlerClientSide(c,a)||this._cameraHandlerServerSide(c,a))}};b.prototype._cameraHandlerClientSide=function(a,c){if(!y.canProjectToWGS84ComparableLonLat(this.view.spatialReference))return!1;a=a.position;this._referencePosWGS84Comparable||(this._referencePosWGS84Comparable=t.vec3f64.create());y.pointToWGS84ComparableLonLat(a,this._referencePosWGS84Comparable);
this._autoUpdateTimezone(this._referencePosWGS84Comparable,c)||this._updateLightParams(c);return!0};b.prototype._cameraHandlerServerSide=function(a,c){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this.view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=a.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};b.prototype._interactingStationaryHandler=
function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()};b.prototype._updateLightParams=function(a){var c=this.view.environment.lighting;a=a||c.date;var c=this.view._stage,d;this._referencePosWGS84Comparable?(d=m.computeColorAndIntensity(a,this._referencePosWGS84Comparable),m.computeDirection(a,this._referencePosWGS84Comparable,this.view.viewingMode,d.diffuse.direction)):d={diffuse:{color:[1,1,1],intensity:.55,direction:B},ambient:{color:[1,1,1],intensity:.55},
noonFactor:.5,globalFactor:0};r.vec3.scale(this._mainLight.intensity,d.diffuse.color,d.diffuse.intensity*Math.PI);r.vec3.negate(this._mainLight.direction,d.diffuse.direction);r.vec3.scale(this._ambientLight.intensity,d.ambient.color,d.ambient.intensity);r.vec3.lerp(this._moonLight.intensity,K,I,d.globalFactor);r.vec3.scale(this._moonLight.intensity,this._moonLight.intensity,(1-.5*d.globalFactor)*(1-.4*d.noonFactor*(1-d.globalFactor)));r.vec3.copy(this._moonLight.direction,d.diffuse.direction);c.setLighting({lights:[this._mainLight,
this._ambientLight,this._moonLight],globalFactor:d.globalFactor,groundLightingFactor:1-d.noonFactor});this._updateRenderParamsHandler()};b.prototype._autoUpdateTimezone=function(a,c){void 0===c&&(c=null);if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;var d=C;d.setTime((c||this.view.environment.lighting.date).getTime());a=u.positionToTimezone(a,D);if(f.isNone(a))return!1;var e=this.view.environment.lighting.positionTimezoneInfo;if(!e.autoUpdated)e=a;else if(e.hours===a.hours&&
e.minutes===a.minutes&&e.seconds===a.seconds)return!1;var b=d.getUTCHours()-(a.hours-e.hours),g=d.getUTCMinutes()-(a.minutes-e.minutes),e=d.getUTCSeconds()-(a.seconds-e.seconds);d.setUTCHours(b);d.setUTCMinutes(g);d.setUTCSeconds(e);return c?!1:this.view.environment.lighting.autoUpdate(d,a)};b.prototype._updateRenderParamsHandler=function(){var a=this.view._stage;if(a){var c=this._referencePosWGS84Comparable?m.computeShadowsEnabled(this._referencePosWGS84Comparable,this.view.viewingMode):!0,d=this.view.environment.background,
d=d instanceof z?{type:"color",color:x.vec4f64.fromArray(g.toUnitRGBA(d.color))}:{type:"color",color:x.vec4f64.fromValues(0,0,0,1)};a.renderView.setRenderParameters({shadowMap:this.view.environment.lighting.directShadowsEnabled&&c,ssao:this.view.environment.lighting.ambientOcclusionEnabled,background:d})}};b.prototype._resetReferencePosition=function(){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=
this._referencePosMapCoords=null;this.notifyChange("updating")};b.prototype._requestReferencePositionUpdate=function(a,d){var e=this;void 0===d&&(d=!1);if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(a):this._referencePosMapCoordsRequested=a.clone(),this._referencePosResetPreserveAbsoluteTime=!!d,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var b=this._referencePosUpdateQuery=
c.after(this._referencePointUpdateDelay).then(function(){if(e._referencePosUpdateQuery===b)return e._doReferencePositionUpdateQuery(function(){return e._referencePosUpdateQuery!==b})}).catch(function(a){"mapcoordshelper:missing-geometry-service"===a.name&&(e.disableQueries=!0)}).then(function(){e._referencePosUpdateQuery===b&&(e._referencePosUpdateQuery=null,e.referencePosUpdateTimer||e._executePendingReferencePositionUpdate(),e.notifyChange("updating"))}),f=this.referencePosUpdateTimer=c.after(this._referencePointUpdateInterval).then(function(){e.referencePosUpdateTimer===
f&&(e.referencePosUpdateTimer=null,e._referencePosUpdateQuery||e._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};b.prototype._doReferencePositionUpdateQuery=function(c){return a(this,void 0,void 0,function(){var a,d;return h(this,function(e){switch(e.label){case 0:return this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=
this._referencePosMapCoordsRequested.clone(),this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null,[4,this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords)];case 1:return a=e.sent(),c()||isNaN(a[0])||isNaN(a[1])||(d=this._referencePosMapCoords.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=a[0],this._referencePosWGS84Comparable[1]=a[1],this._referencePosWGS84Comparable[2]=d):this._referencePosWGS84Comparable=
[a[0],a[1],d],this._referencePosChanged()),[2]}})})};b.prototype._executePendingReferencePositionUpdate=function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)};b.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLightParams()};b.prototype._exceedsReferencePosDistThreshold=function(a){return this._referencePosMapCoords?
(a=this._referencePosMapCoords.distance(a),this.view.mapCoordsHelper&&(a*=this.view.mapCoordsHelper.unitInMeters),a>this._referencePointUpdateDistThreshold):!0};b.prototype._cancelReferencePosUpdates=function(){this.referencePosUpdateTimer=this._referencePosUpdateQuery=null};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{renderer:this._renderer,set referencePointUpdateInterval(c){a._referencePointUpdateInterval=c},set referencePointUpdateDistThreshold(c){a._referencePointUpdateDistThreshold=
c},set referencePosUpdateTimer(c){a.referencePosUpdateTimer=c},set referencePointUpdateDelay(c){a._referencePointUpdateDelay=c}}},enumerable:!0,configurable:!0});b.FIXED_LIGHT_DIRECTION=B;k([p.property({type:Boolean,dependsOn:["disableQueries","_renderer.updating"],readOnly:!0})],b.prototype,"updating",null);k([p.property()],b.prototype,"disableQueries",void 0);k([p.property({constructOnly:!0})],b.prototype,"view",void 0);k([p.property()],b.prototype,"_renderer",void 0);return b=k([p.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],
b)}(p.declared(e.EventedAccessor));b.SceneViewEnvironmentManager=n;var C=new Date,D={hours:0,minutes:0,seconds:0},K=t.vec3f64.fromValues(.22,.22,.33),I=t.vec3f64.fromValues(.22,.22,.22);b.default=n})},"esri/core/libs/gl-matrix-2/vec4f64":function(){define(["require","exports","./factories/vec4f64"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec4f64=l})},"esri/core/libs/gl-matrix-2/factories/vec4f64":function(){define(["require","exports"],function(n,b){function l(){return[0,
0,0,0]}function k(){return[1,1,1,1]}function h(){return[1,0,0,0]}function a(){return[0,1,0,0]}function g(){return[0,0,1,0]}function e(){return[0,0,0,1]}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.clone=function(a){return[a[0],a[1],a[2],a[3]]};b.fromValues=function(a,e,c,b){return[a,e,c,b]};b.fromArray=function(a){for(var d=l(),c=Math.min(4,a.length),e=0;e<c;++e)d[e]=a[e];return d};b.createView=function(a,e){return new Float64Array(a,e,4)};b.zeros=function(){return l()};b.ones=k;
b.unitX=h;b.unitY=a;b.unitZ=g;b.unitW=e;b.ZEROS=l();b.ONES=k();b.UNIT_X=h();b.UNIT_Y=a();b.UNIT_Z=g();b.UNIT_W=e()})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/compilerUtils ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){var r=[13,14];return function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new g;a._initContext=null;a._pendingAtmosphere=null;a._atmosphere=null;a._stars=null;return a}l(h,b);Object.defineProperty(h.prototype,"canRender",{get:function(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return null!=
this._pendingAtmosphere},enumerable:!0,configurable:!0});h.prototype.initialize=function(){this.view._stage.addRenderPlugin(r,this)};h.prototype.destroy=function(){this._pendingAtmosphere&&(this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&(this.view._stage.removeRenderPlugin(this),this._set("view",null))};h.prototype.initializeRenderContext=
function(a){this._initContext=a;this.setup()};h.prototype.setup=function(){var a=this;this._handles.add(e.when(this.view,"basemapTerrain",function(){return a._updateBasemapTerrain()},!0));this._handles.add([e.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],function(){return a._updateAtmosphere()},!0),e.init(this.view,"environment.starsEnabled",function(){return a._updateStars()},!0)])};h.prototype.uninitializeRenderContext=function(a){this._stars&&(this._stars.uninitializeRenderContext(a),
this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(a),this._atmosphere.destroy(),this._atmosphere=null)};h.prototype.render=function(a){var c=!0;this._stars&&this._stars.canRender&&(c=this._stars.render(a)&&c);this._atmosphere&&this._atmosphere.canRender&&(c=this._atmosphere.render(a)&&c);return c};h.prototype._setNeedsRender=function(){this._initContext&&this._initContext.requestRender()};h.prototype._updateStars=function(){var a=this.view.get("environment.starsEnabled")||
!1;a&&!this._stars?(this._stars=new p(this.view),this._stars.initializeRenderContext(this._initContext),this._setNeedsRender()):!a&&this._stars&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())};h.prototype._updateAtmosphere=function(){var a=this,c=this._getAtmosphereType();this.atmosphereType!==c&&(this.atmosphereType=c,this._pendingAtmosphere&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),(c=this._getAtmosphereClass())?
(c=new c(this.view),c.initializeRenderContext(this._initContext),null==this._atmosphere&&(this._atmosphere=c,this._setNeedsRender()),this._pendingAtmosphere=c,c.when(function(){a._pendingAtmosphere!==a._atmosphere&&(a._atmosphere.destroy(),a._atmosphere=a._pendingAtmosphere);a._pendingAtmosphere=null;a._setNeedsRender();a._updateBasemapTerrain()})):(this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()))};h.prototype._getAtmosphereClass=
function(){var d=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(d);switch(d){case "none":return null;case "realistic":return c.RealisticAtmosphere;case "panoramic":return f;case "simple":return q;default:a.neverReached(d)}};h.prototype._getAtmosphereType=function(){var a=this.view.get("environment.atmosphereEnabled"),d=this.view.get("environment.atmosphere.quality");return a&&null!=d?"local"===this.view.viewingMode?"panoramic":"high"===d&&c.RealisticAtmosphere.isSupported(this._initContext)?
"realistic":"simple":"none"};h.prototype._updateBasemapTerrain=function(){var a=this.view.basemapTerrain;a&&(a.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};Object.defineProperty(h.prototype,"test",{get:function(){return{atmosphere:this._atmosphere}},enumerable:!0,configurable:!0});k([d.property({constructOnly:!0})],h.prototype,"view",void 0);k([d.property({constructOnly:!0})],h.prototype,"atmosphereClassFromType",void 0);k([d.property({dependsOn:["_pendingAtmosphere"]})],
h.prototype,"updating",null);k([d.property()],h.prototype,"_pendingAtmosphere",void 0);return h=k([d.subclass("esri.views.3d.environment.EnvironmentRenderer")],h)}(d.declared(h))})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Texture ../../webgl/Util ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v){n=function(){function c(a){this.slot=13;this._readyResolver=h.createResolver();this._readyController=h.createAbortController();this.view=a}Object.defineProperty(c.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});c.prototype.destroy=function(){this._readyResolver.reject();this._program&&(this._program.dispose(),this._program=null);this._texture&&(this._texture.dispose(),this._texture=null);this._readyController&&
(this._readyController.abort(),this._readyController=null)};c.prototype.when=function(a){return k(this,void 0,void 0,function(){return l(this,function(c){switch(c.label){case 0:return[4,this._readyResolver.promise];case 1:return c.sent(),a(),[2]}})})};c.prototype.initializeRenderContext=function(a){var c=this,b=a.rctx;this._program=x.createProgram(b,r.colorPass,{panoramic:!0});this._pipelineState=w.makePipelineState({blending:w.separateBlendingParams(770,1,771,771),culling:w.backFaceCullingParams,
depthTest:{func:515},colorWrite:w.defaultColorWriteParams});this._vao=this._createVertexArrayObject(b);this._vaoCount=m.vertexCount(this._vao,"geometry");d.requestImage(e,{signal:this._readyController.signal}).then(function(d){c._texture=new u(a.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},d);a.requestRender();c._readyController=null;c._readyResolver.resolve()})};c.prototype.uninitializeRenderContext=function(a){this.destroy()};c.prototype.render=function(c){if(c.slot!==
this.slot||0!==c.pass)return!1;var d=c.rctx,e=this._program;d.bindProgram(e);d.setPipelineState(this._pipelineState);d.bindTexture(this._texture);e.setUniform1i("tex",0);e.setUniformMatrix4fv("proj",c.camera.projectionMatrix);var b=z;a.mat4.copy(b,c.camera.viewMatrix);b[12]=0;b[13]=0;b[14]=0;b[15]=1;e.setUniformMatrix4fv("view",z);e.setUniform4f("color",1,1,1,1);c.scenelightingData.setLightDirectionUniform(e);d.bindVAO(this._vao);y.assertCompatibleVertexAttributeLocations(this._vao,e);d.drawArrays(4,
0,this._vaoCount);return!0};c.prototype._createVertexArrayObject=function(a){for(var c=q.createPolySphereGeometry(1,2,!1),d=c.indices[p.VertexAttrConstants.POSITION],e=0;e<d.length;e+=3){var b=d[e];d[e]=d[e+2];d[e+2]=b}for(var c=c.vertexAttributes[p.VertexAttrConstants.POSITION].data,b=B.createBuffer(d.length),g=b.position,e=0;e<d.length;++e){var m=3*d[e];g.set(e,0,c[m]);g.set(e,1,c[m+1]);g.set(e,2,c[m+2])}return new v(a,r.colorPass.attributes,{geometry:f.glLayout(B)},{geometry:t.createVertex(a,35044,
b.buffer)})};return c}();var z=g.mat4f64.create(),B=c.newLayout().vec3f("position");return n})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat4f64=l})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};b.clone=function(b){return[b[0],
b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15]]};b.fromValues=function(b,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u){return[b,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u]};b.createView=function(b,k){return new Float64Array(b,k,16)}})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(n,b){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../core/tsSupport/assignHelper","../../../request"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.dataURItoBlob=function(b){var a=atob(b.split(",")[1]);b=b.split(",")[0].split(":")[1].split(";")[0];for(var g=new ArrayBuffer(a.length),e=new Uint8Array(g),d=0;d<a.length;d++)e[d]=a.charCodeAt(d);return new Blob([g],{type:b})};b.requestImage=function(b,a){return k(b,l({responseType:"image"},a)).then(function(a){return a.data})}})},
"esri/views/3d/support/buffer/glUtil":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});var k={divisor:0,prefixA:!1};b.glLayout=function(a,b){void 0===b&&(b={});b=l({},k,b);var e=a.stride;return a.fieldNames.filter(function(d){d=a.fields.get(d).optional;return!(d&&d.glPadding)}).map(function(d){var f=a.fields.get(d),c=f.constructor.ElementCount,g;g=h[f.constructor.ElementType];if(!g)throw Error("BufferType not supported in WebGL");
var p=f.offset,f=!(!f.optional||!f.optional.glNormalized);return{name:b.prefixA?"a"+d[0].toUpperCase()+d.substr(1):d,stride:e,count:c,type:g,offset:p,normalized:f,divisor:b.divisor}})};var h={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView","./types"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,d){this.layout=a;this.buffer="number"===
typeof d?new ArrayBuffer(d*a.stride):d;d=0;for(var b=a.fieldNames;d<b.length;d++){var c=b[d],e=a.fields.get(c);this[c]=new e.constructor(this.buffer,e.offset,this.stride)}}Object.defineProperty(a.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"byteLength",{get:function(){return this.buffer.byteLength},
enumerable:!0,configurable:!0});a.prototype.getField=function(a,d){return(a=this[a])&&a.elementCount===d.ElementCount&&a.elementType===d.ElementType?a:null};a.prototype.slice=function(b,d){return new a(this.layout,this.buffer.slice(b*this.stride,d*this.stride))};a.prototype.copyFrom=function(a,d,b,c){var e=this.stride;0===e%4?(a=new Uint32Array(a.buffer,d*e,c*e/4),b=new Uint32Array(this.buffer,b*e,c*e/4)):(a=new Uint8Array(a.buffer,d*e,c*e),b=new Uint8Array(this.buffer,b*e,c*e));b.set(a)};return a}();
b.InterleavedBuffer=h;var a=function(){function a(){this.stride=0;this.fields=new Map;this.fieldNames=[]}a.prototype.vec2f=function(a,d){this.appendField(a,l.BufferViewVec2f,d);return this};a.prototype.vec2f64=function(a,d){this.appendField(a,l.BufferViewVec2f64,d);return this};a.prototype.vec3f=function(a,d){this.appendField(a,l.BufferViewVec3f,d);return this};a.prototype.vec3f64=function(a,d){this.appendField(a,l.BufferViewVec3f64,d);return this};a.prototype.vec4f=function(a,d){this.appendField(a,
l.BufferViewVec4f,d);return this};a.prototype.vec4f64=function(a,d){this.appendField(a,l.BufferViewVec4f64,d);return this};a.prototype.mat3f=function(a,d){this.appendField(a,l.BufferViewMat3f,d);return this};a.prototype.mat3f64=function(a,d){this.appendField(a,l.BufferViewMat3f64,d);return this};a.prototype.mat4f=function(a,d){this.appendField(a,l.BufferViewMat4f,d);return this};a.prototype.mat4f64=function(a,d){this.appendField(a,l.BufferViewMat4f64,d);return this};a.prototype.vec4u8=function(a,
d){this.appendField(a,l.BufferViewVec4u8,d);return this};a.prototype.f32=function(a,d){this.appendField(a,l.BufferViewFloat,d);return this};a.prototype.f64=function(a,d){this.appendField(a,l.BufferViewFloat64,d);return this};a.prototype.u8=function(a,d){this.appendField(a,l.BufferViewUint8,d);return this};a.prototype.u16=function(a,d){this.appendField(a,l.BufferViewUint16,d);return this};a.prototype.i8=function(a,d){this.appendField(a,l.BufferViewInt8,d);return this};a.prototype.vec2i8=function(a,
d){this.appendField(a,l.BufferViewVec2i8,d);return this};a.prototype.vec2i16=function(a,d){this.appendField(a,l.BufferViewVec2i16,d);return this};a.prototype.vec2u8=function(a,d){this.appendField(a,l.BufferViewVec2u8,d);return this};a.prototype.vec4u16=function(a,d){this.appendField(a,l.BufferViewVec4u16,d);return this};a.prototype.u32=function(a,d){this.appendField(a,l.BufferViewUint32,d);return this};a.prototype.appendField=function(a,d,b){var c=d.ElementCount*k.elementTypeSize(d.ElementType);this.fields.set(a,
{size:c,constructor:d,offset:this.stride,optional:b});this.stride+=c;this.fieldNames.push(a)};a.prototype.alignTo=function(a){this.stride=Math.floor((this.stride+a-1)/a)*a;return this};a.prototype.hasField=function(a){return 0<=this.fieldNames.indexOf(a)};a.prototype.createBuffer=function(a){return new h(this,a)};a.prototype.createView=function(a){return new h(this,a)};a.prototype.clone=function(){var b=new a;b.stride=this.stride;b.fields=new Map;this.fields.forEach(function(a,e){return b.fields.set(e,
a)});b.fieldNames=this.fieldNames.slice();b.BufferType=this.BufferType;return b};return a}();b.InterleavedLayout=a;b.newLayout=function(){return new a}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function c(c,d,b,e){void 0===
d&&(d=0);c=a.call(this,Float32Array,c,d,b,e)||this;c.elementType="f32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(a.BufferViewScalarImpl);b.BufferViewFloat=n;n=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Float32Array,c,d,b,e)||this;c.elementType="f32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";
return c}(g.BufferViewVec2Impl);b.BufferViewVec2f=n;n=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Float32Array,c,d,b,e)||this;c.elementType="f32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(e.BufferViewVec3Impl);b.BufferViewVec3f=n;n=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Float32Array,c,d,b,e)||this;c.elementType="f32";return c}l(c,a);c.fromTypedArray=function(a,
d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(d.BufferViewVec4Impl);b.BufferViewVec4f=n;n=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Float32Array,c,d,b,e)||this;c.elementType="f32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(k.BufferViewMat3Impl);b.BufferViewMat3f=n;k=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,
Float64Array,c,d,b,e)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(k.BufferViewMat3Impl);b.BufferViewMat3f64=k;k=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Float32Array,c,d,b,e)||this;c.elementType="f32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(h.BufferViewMat4Impl);
b.BufferViewMat4f=k;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Float64Array,c,d,b,e)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(h.BufferViewMat4Impl);b.BufferViewMat4f64=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Float64Array,c,d,b,e)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,
a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(a.BufferViewScalarImpl);b.BufferViewFloat64=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Float64Array,c,d,b,e)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(g.BufferViewVec2Impl);b.BufferViewVec2f64=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Float64Array,c,d,
b,e)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(e.BufferViewVec3Impl);b.BufferViewVec3f64=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Float64Array,c,d,b,e)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(d.BufferViewVec4Impl);b.BufferViewVec4f64=
h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Uint8Array,c,d,b,e)||this;c.elementType="u8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u8";return c}(a.BufferViewScalarImpl);b.BufferViewUint8=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Uint8Array,c,d,b,e)||this;c.elementType="u8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+
a.byteLength)};c.ElementType="u8";return c}(g.BufferViewVec2Impl);b.BufferViewVec2u8=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Uint8Array,c,d,b,e)||this;c.elementType="u8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u8";return c}(e.BufferViewVec3Impl);b.BufferViewVec3u8=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Uint8Array,c,d,b,e)||this;c.elementType="u8";return c}
l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u8";return c}(d.BufferViewVec4Impl);b.BufferViewVec4u8=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Uint16Array,c,d,b,e)||this;c.elementType="u16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u16";return c}(a.BufferViewScalarImpl);b.BufferViewUint16=h;h=function(a){function c(c,
d,b,e){void 0===d&&(d=0);c=a.call(this,Uint16Array,c,d,b,e)||this;c.elementType="u16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u16";return c}(g.BufferViewVec2Impl);b.BufferViewVec2u16=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Uint16Array,c,d,b,e)||this;c.elementType="u16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType=
"u16";return c}(e.BufferViewVec3Impl);b.BufferViewVec3u16=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Uint16Array,c,d,b,e)||this;c.elementType="u16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u16";return c}(d.BufferViewVec4Impl);b.BufferViewVec4u16=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Uint32Array,c,d,b,e)||this;c.elementType="u32";return c}l(c,a);c.fromTypedArray=
function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u32";return c}(a.BufferViewScalarImpl);b.BufferViewUint32=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Uint32Array,c,d,b,e)||this;c.elementType="u32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u32";return c}(g.BufferViewVec2Impl);b.BufferViewVec2u32=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=
0);c=a.call(this,Uint32Array,c,d,b,e)||this;c.elementType="u32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u32";return c}(e.BufferViewVec3Impl);b.BufferViewVec3u32=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Uint32Array,c,d,b,e)||this;c.elementType="u32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u32";return c}(d.BufferViewVec4Impl);
b.BufferViewVec4u32=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Int8Array,c,d,b,e)||this;c.elementType="i8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(a.BufferViewScalarImpl);b.BufferViewInt8=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Int8Array,c,d,b,e)||this;c.elementType="i8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,
d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(g.BufferViewVec2Impl);b.BufferViewVec2i8=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Int8Array,c,d,b,e)||this;c.elementType="i8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(e.BufferViewVec3Impl);b.BufferViewVec3i8=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Int8Array,c,d,b,e)||this;c.elementType=
"i8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(d.BufferViewVec4Impl);b.BufferViewVec4i8=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Int16Array,c,d,b,e)||this;c.elementType="i16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i16";return c}(a.BufferViewScalarImpl);b.BufferViewInt16=h;h=function(a){function c(c,
d,b,e){void 0===d&&(d=0);c=a.call(this,Int16Array,c,d,b,e)||this;c.elementType="i16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i16";return c}(g.BufferViewVec2Impl);b.BufferViewVec2i16=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Int16Array,c,d,b,e)||this;c.elementType="i16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType=
"i16";return c}(e.BufferViewVec3Impl);b.BufferViewVec3i16=h;h=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Int16Array,c,d,b,e)||this;c.elementType="i16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i16";return c}(d.BufferViewVec4Impl);b.BufferViewVec4i16=h;a=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Int32Array,c,d,b,e)||this;c.elementType="i32";return c}l(c,a);c.fromTypedArray=
function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i32";return c}(a.BufferViewScalarImpl);b.BufferViewInt32=a;g=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Int32Array,c,d,b,e)||this;c.elementType="i32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i32";return c}(g.BufferViewVec2Impl);b.BufferViewVec2i32=g;e=function(a){function c(c,d,b,e){void 0===d&&(d=0);
c=a.call(this,Int32Array,c,d,b,e)||this;c.elementType="i32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i32";return c}(e.BufferViewVec3Impl);b.BufferViewVec3i32=e;d=function(a){function c(c,d,b,e){void 0===d&&(d=0);c=a.call(this,Int32Array,c,d,b,e)||this;c.elementType="i32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i32";return c}(d.BufferViewVec4Impl);
b.BufferViewVec4i32=d})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,h,a,g,e){void 0===a&&(a=0);this.TypedArrayConstructor=b;this.elementCount=9;b=this.TypedArrayConstructor;void 0===g&&(g=9*b.BYTES_PER_ELEMENT);var d=0===h.byteLength?0:a;this.typedBuffer=null==e?new b(h,d):new b(h,d,(e-a)/b.BYTES_PER_ELEMENT);this.typedBufferStride=g/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/
this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getMat=function(b,h){b*=this.typedBufferStride;for(var a=0;9>a;a++)h[a]=this.typedBuffer[b+a];return h};b.prototype.setMat=function(b,h){b*=this.typedBufferStride;for(var a=0;9>a;a++)this.typedBuffer[b+a]=h[a]};b.prototype.get=function(b,h){return this.typedBuffer[b*this.typedBufferStride+h]};b.prototype.set=function(b,h,a){this.typedBuffer[b*this.typedBufferStride+h]=a};b.prototype.copyFrom=
function(b,h,a){var g=this.typedBuffer,e=h.typedBuffer;b*=this.typedBufferStride;h=a*h.typedBufferStride;for(a=0;9>a;++a)g[b+a]=e[h+a]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=9;return b}();b.BufferViewMat3Impl=n})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,h,a,g,e){void 0===
a&&(a=0);this.TypedArrayConstructor=b;this.elementCount=16;b=this.TypedArrayConstructor;void 0===g&&(g=16*b.BYTES_PER_ELEMENT);var d=0===h.byteLength?0:a;this.typedBuffer=null==e?new b(h,d):new b(h,d,(e-a)/b.BYTES_PER_ELEMENT);this.typedBufferStride=g/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getMat=function(b,h){b*=this.typedBufferStride;for(var a=0;16>a;a++)h[a]=
this.typedBuffer[b+a];return h};b.prototype.setMat=function(b,h){b*=this.typedBufferStride;for(var a=0;16>a;a++)this.typedBuffer[b+a]=h[a]};b.prototype.get=function(b,h){return this.typedBuffer[b*this.typedBufferStride+h]};b.prototype.set=function(b,h,a){this.typedBuffer[b*this.typedBufferStride+h]=a};b.prototype.copyFrom=function(b,h,a){var g=this.typedBuffer,e=h.typedBuffer;b*=this.typedBufferStride;h=a*h.typedBufferStride;for(a=0;16>a;++a)g[b+a]=e[h+a]};Object.defineProperty(b.prototype,"buffer",
{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=16;return b}();b.BufferViewMat4Impl=n})},"esri/views/3d/support/buffer/internals/Scalar":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,h,a,g,e){void 0===a&&(a=0);this.TypedArrayConstructor=b;this.elementCount=1;b=this.TypedArrayConstructor;void 0===g&&(g=b.BYTES_PER_ELEMENT);var d=0===h.byteLength?0:a;this.typedBuffer=null==
e?new b(h,d):new b(h,d,(e-a)/b.BYTES_PER_ELEMENT);this.typedBufferStride=g/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.get=function(b){return this.typedBuffer[b*this.typedBufferStride]};b.prototype.set=function(b,h){this.typedBuffer[b*this.typedBufferStride]=h};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,
configurable:!0});b.ElementCount=1;return b}();b.BufferViewScalarImpl=n})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a,g,e,d){void 0===g&&(g=0);this.TypedArrayConstructor=b;this.elementCount=2;b=this.TypedArrayConstructor;void 0===e&&(e=2*b.BYTES_PER_ELEMENT);var f=0===a.byteLength?0:g;this.typedBuffer=null==d?new b(a,f):
new b(a,f,(d-g)/b.BYTES_PER_ELEMENT);this.typedBufferStride=e/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,a){return l.vec2.set(a,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1])};b.prototype.setVec=function(b,a){this.typedBuffer[b*this.typedBufferStride]=a[0];this.typedBuffer[b*this.typedBufferStride+1]=a[1]};
b.prototype.get=function(b,a){return this.typedBuffer[b*this.typedBufferStride+a]};b.prototype.set=function(b,a,g){this.typedBuffer[b*this.typedBufferStride+a]=g};b.prototype.copyFrom=function(b,a,g){var e=this.typedBuffer,d=a.typedBuffer;b*=this.typedBufferStride;a=g*a.typedBufferStride;e[b]=d[a];e[b+1]=d[a+1]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=2;return b}();b.BufferViewVec2Impl=n})},"esri/core/libs/gl-matrix-2/vec2":function(){define(["require",
"exports","./math/vec2"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec2=l})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["require","exports","./common"],function(n,b,l){function k(a,d,b){a[0]=d[0]-b[0];a[1]=d[1]-b[1];return a}function h(a,d,b){a[0]=d[0]*b[0];a[1]=d[1]*b[1];return a}function a(a,d,b){a[0]=d[0]/b[0];a[1]=d[1]/b[1];return a}function g(a,d){var c=d[0]-a[0];a=d[1]-a[1];return Math.sqrt(c*c+a*a)}function e(a,d){var c=d[0]-a[0];a=d[1]-a[1];return c*
c+a*a}function d(a){var c=a[0];a=a[1];return Math.sqrt(c*c+a*a)}function f(a){var c=a[0];a=a[1];return c*c+a*a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,d){a[0]=d[0];a[1]=d[1];return a};b.set=function(a,d,b){a[0]=d;a[1]=b;return a};b.add=function(a,d,b){a[0]=d[0]+b[0];a[1]=d[1]+b[1];return a};b.subtract=k;b.multiply=h;b.divide=a;b.ceil=function(a,d){a[0]=Math.ceil(d[0]);a[1]=Math.ceil(d[1]);return a};b.floor=function(a,d){a[0]=Math.floor(d[0]);a[1]=Math.floor(d[1]);return a};
b.min=function(a,d,b){a[0]=Math.min(d[0],b[0]);a[1]=Math.min(d[1],b[1]);return a};b.max=function(a,d,b){a[0]=Math.max(d[0],b[0]);a[1]=Math.max(d[1],b[1]);return a};b.round=function(a,d){a[0]=Math.round(d[0]);a[1]=Math.round(d[1]);return a};b.scale=function(a,d,b){a[0]=d[0]*b;a[1]=d[1]*b;return a};b.scaleAndAdd=function(a,d,b,e){a[0]=d[0]+b[0]*e;a[1]=d[1]+b[1]*e;return a};b.distance=g;b.squaredDistance=e;b.length=d;b.squaredLength=f;b.negate=function(a,d){a[0]=-d[0];a[1]=-d[1];return a};b.inverse=
function(a,d){a[0]=1/d[0];a[1]=1/d[1];return a};b.normalize=function(a,d){var c=d[0],b=d[1],c=c*c+b*b;0<c&&(c=1/Math.sqrt(c),a[0]=d[0]*c,a[1]=d[1]*c);return a};b.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]};b.cross=function(a,d,b){d=d[0]*b[1]-d[1]*b[0];a[0]=a[1]=0;a[2]=d;return a};b.lerp=function(a,d,b,e){var c=d[0];d=d[1];a[0]=c+e*(b[0]-c);a[1]=d+e*(b[1]-d);return a};b.random=function(a,d){d=d||1;var c=2*l.RANDOM()*Math.PI;a[0]=Math.cos(c)*d;a[1]=Math.sin(c)*d;return a};b.transformMat2=function(a,
d,b){var c=d[0];d=d[1];a[0]=b[0]*c+b[2]*d;a[1]=b[1]*c+b[3]*d;return a};b.transformMat2d=function(a,d,b){var c=d[0];d=d[1];a[0]=b[0]*c+b[2]*d+b[4];a[1]=b[1]*c+b[3]*d+b[5];return a};b.transformMat3=function(a,d,b){var c=d[0];d=d[1];a[0]=b[0]*c+b[3]*d+b[6];a[1]=b[1]*c+b[4]*d+b[7];return a};b.transformMat4=function(a,d,b){var c=d[0];d=d[1];a[0]=b[0]*c+b[4]*d+b[12];a[1]=b[1]*c+b[5]*d+b[13];return a};b.rotate=function(a,d,b,e){var c=d[0]-b[0];d=d[1]-b[1];var f=Math.sin(e);e=Math.cos(e);a[0]=c*e-d*f+b[0];
a[1]=c*f+d*e+b[1];return a};b.angle=function(a,d){var c=a[0];a=a[1];var b=d[0];d=d[1];var e=c*c+a*a;0<e&&(e=1/Math.sqrt(e));var f=b*b+d*d;0<f&&(f=1/Math.sqrt(f));c=(c*b+a*d)*e*f;return 1<c?0:-1>c?Math.PI:Math.acos(c)};b.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};b.exactEquals=function(a,d){return a[0]===d[0]&&a[1]===d[1]};b.equals=function(a,d){var c=a[0];a=a[1];var b=d[0];d=d[1];return Math.abs(c-b)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(a-d)<=l.EPSILON*Math.max(1,Math.abs(a),
Math.abs(d))};b.len=d;b.sub=k;b.mul=h;b.div=a;b.dist=g;b.sqrDist=e;b.sqrLen=f})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec3"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a,g,e,d){void 0===g&&(g=0);this.TypedArrayConstructor=b;this.elementCount=3;b=this.TypedArrayConstructor;void 0===e&&(e=3*b.BYTES_PER_ELEMENT);var f=0===a.byteLength?0:g;this.typedBuffer=null==d?new b(a,
f):new b(a,f,(d-g)/b.BYTES_PER_ELEMENT);this.typedBufferStride=e/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,a){return l.vec3.set(a,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1],this.typedBuffer[b*this.typedBufferStride+2])};b.prototype.setVec=function(b,a){this.typedBuffer[b*this.typedBufferStride]=a[0];
this.typedBuffer[b*this.typedBufferStride+1]=a[1];this.typedBuffer[b*this.typedBufferStride+2]=a[2]};b.prototype.get=function(b,a){return this.typedBuffer[b*this.typedBufferStride+a]};b.prototype.set=function(b,a,g){this.typedBuffer[b*this.typedBufferStride+a]=g};b.prototype.copyFrom=function(b,a,g){var e=this.typedBuffer,d=a.typedBuffer;b*=this.typedBufferStride;a=g*a.typedBufferStride;e[b]=d[a];e[b+1]=d[a+1];e[b+2]=d[a+2]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},
enumerable:!0,configurable:!0});b.ElementCount=3;return b}();b.BufferViewVec3Impl=n})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec4"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a,g,e,d){void 0===g&&(g=0);this.TypedArrayConstructor=b;this.elementCount=4;b=this.TypedArrayConstructor;void 0===e&&(e=4*b.BYTES_PER_ELEMENT);var f=0===a.byteLength?0:g;this.typedBuffer=null==
d?new b(a,f):new b(a,f,(d-g)/b.BYTES_PER_ELEMENT);this.typedBufferStride=e/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,a){return l.vec4.set(a,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1],this.typedBuffer[b*this.typedBufferStride+2],this.typedBuffer[b*this.typedBufferStride+3])};b.prototype.setVec=function(b,
a){this.typedBuffer[b*this.typedBufferStride]=a[0];this.typedBuffer[b*this.typedBufferStride+1]=a[1];this.typedBuffer[b*this.typedBufferStride+2]=a[2];this.typedBuffer[b*this.typedBufferStride+3]=a[3]};b.prototype.get=function(b,a){return this.typedBuffer[b*this.typedBufferStride+a]};b.prototype.set=function(b,a,g){this.typedBuffer[b*this.typedBufferStride+a]=g};b.prototype.copyFrom=function(b,a,g){var e=this.typedBuffer,d=a.typedBuffer;b*=this.typedBufferStride;a=g*a.typedBufferStride;e[b]=d[a];
e[b+1]=d[a+1];e[b+2]=d[a+2];e[b+3]=d[a+3]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=4;return b}();b.BufferViewVec4Impl=n})},"esri/core/libs/gl-matrix-2/vec4":function(){define(["require","exports","./math/vec4"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec4=l})},"esri/core/libs/gl-matrix-2/math/vec4":function(){define(["require","exports","./common"],function(n,b,l){function k(a,
d,b){a[0]=d[0]-b[0];a[1]=d[1]-b[1];a[2]=d[2]-b[2];a[3]=d[3]-b[3];return a}function h(a,d,b){a[0]=d[0]*b[0];a[1]=d[1]*b[1];a[2]=d[2]*b[2];a[3]=d[3]*b[3];return a}function a(a,d,b){a[0]=d[0]/b[0];a[1]=d[1]/b[1];a[2]=d[2]/b[2];a[3]=d[3]/b[3];return a}function g(a,d){var c=d[0]-a[0],b=d[1]-a[1],e=d[2]-a[2];a=d[3]-a[3];return Math.sqrt(c*c+b*b+e*e+a*a)}function e(a,d){var c=d[0]-a[0],b=d[1]-a[1],e=d[2]-a[2];a=d[3]-a[3];return c*c+b*b+e*e+a*a}function d(a){var c=a[0],d=a[1],b=a[2];a=a[3];return Math.sqrt(c*
c+d*d+b*b+a*a)}function f(a){var c=a[0],d=a[1],b=a[2];a=a[3];return c*c+d*d+b*b+a*a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,d){a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3];return a};b.set=function(a,d,b,e,f){a[0]=d;a[1]=b;a[2]=e;a[3]=f;return a};b.add=function(a,d,b){a[0]=d[0]+b[0];a[1]=d[1]+b[1];a[2]=d[2]+b[2];a[3]=d[3]+b[3];return a};b.subtract=k;b.multiply=h;b.divide=a;b.ceil=function(a,d){a[0]=Math.ceil(d[0]);a[1]=Math.ceil(d[1]);a[2]=Math.ceil(d[2]);a[3]=Math.ceil(d[3]);
return a};b.floor=function(a,d){a[0]=Math.floor(d[0]);a[1]=Math.floor(d[1]);a[2]=Math.floor(d[2]);a[3]=Math.floor(d[3]);return a};b.min=function(a,d,b){a[0]=Math.min(d[0],b[0]);a[1]=Math.min(d[1],b[1]);a[2]=Math.min(d[2],b[2]);a[3]=Math.min(d[3],b[3]);return a};b.max=function(a,d,b){a[0]=Math.max(d[0],b[0]);a[1]=Math.max(d[1],b[1]);a[2]=Math.max(d[2],b[2]);a[3]=Math.max(d[3],b[3]);return a};b.round=function(a,d){a[0]=Math.round(d[0]);a[1]=Math.round(d[1]);a[2]=Math.round(d[2]);a[3]=Math.round(d[3]);
return a};b.scale=function(a,d,b){a[0]=d[0]*b;a[1]=d[1]*b;a[2]=d[2]*b;a[3]=d[3]*b;return a};b.scaleAndAdd=function(a,d,b,e){a[0]=d[0]+b[0]*e;a[1]=d[1]+b[1]*e;a[2]=d[2]+b[2]*e;a[3]=d[3]+b[3]*e;return a};b.distance=g;b.squaredDistance=e;b.length=d;b.squaredLength=f;b.negate=function(a,d){a[0]=-d[0];a[1]=-d[1];a[2]=-d[2];a[3]=-d[3];return a};b.inverse=function(a,d){a[0]=1/d[0];a[1]=1/d[1];a[2]=1/d[2];a[3]=1/d[3];return a};b.normalize=function(a,d){var c=d[0],b=d[1],e=d[2];d=d[3];var f=c*c+b*b+e*e+d*
d;0<f&&(f=1/Math.sqrt(f),a[0]=c*f,a[1]=b*f,a[2]=e*f,a[3]=d*f);return a};b.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]+a[2]*d[2]+a[3]*d[3]};b.lerp=function(a,d,b,e){var c=d[0],f=d[1],g=d[2];d=d[3];a[0]=c+e*(b[0]-c);a[1]=f+e*(b[1]-f);a[2]=g+e*(b[2]-g);a[3]=d+e*(b[3]-d);return a};b.random=function(a,d){d=d||1;var c,b,e,f,g,h;do c=2*l.RANDOM()-1,b=2*l.RANDOM()-1,g=c*c+b*b;while(1<=g);do e=2*l.RANDOM()-1,f=2*l.RANDOM()-1,h=e*e+f*f;while(1<=h);g=Math.sqrt((1-g)/h);a[0]=d*c;a[1]=d*b;a[2]=d*e*g;a[3]=d*f*
g;return a};b.transformMat4=function(a,d,b){var c=d[0],e=d[1],f=d[2];d=d[3];a[0]=b[0]*c+b[4]*e+b[8]*f+b[12]*d;a[1]=b[1]*c+b[5]*e+b[9]*f+b[13]*d;a[2]=b[2]*c+b[6]*e+b[10]*f+b[14]*d;a[3]=b[3]*c+b[7]*e+b[11]*f+b[15]*d;return a};b.transformQuat=function(a,d,b){var c=d[0],e=d[1],f=d[2],g=b[0],h=b[1],p=b[2];b=b[3];var m=b*c+h*f-p*e,v=b*e+p*c-g*f,q=b*f+g*e-h*c,c=-g*c-h*e-p*f;a[0]=m*b+c*-g+v*-p-q*-h;a[1]=v*b+c*-h+q*-g-m*-p;a[2]=q*b+c*-p+m*-h-v*-g;a[3]=d[3];return a};b.str=function(a){return"vec4("+a[0]+", "+
a[1]+", "+a[2]+", "+a[3]+")"};b.exactEquals=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]};b.equals=function(a,d){var c=a[0],b=a[1],e=a[2];a=a[3];var f=d[0],g=d[1],h=d[2];d=d[3];return Math.abs(c-f)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(b-g)<=l.EPSILON*Math.max(1,Math.abs(b),Math.abs(g))&&Math.abs(e-h)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(a-d)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))};b.sub=k;b.mul=h;b.div=a;b.dist=g;b.sqrDist=
e;b.len=d;b.sqrLen=f})},"esri/views/3d/support/buffer/types":function(){define(["require","exports","../../../../core/compilerUtils"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8;default:l.neverReached(b)}};b.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0;
default:l.neverReached(b)}};b.isInteger=function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1;default:l.neverReached(b)}};b.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308;default:l.neverReached(b)}}})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./Util".split(" "),
function(n,b,l,k,h,a,g,e,d){var f=g.Vec3Compact,c;(function(a){for(var c=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],b=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],f=[0,0,1,0,1,1,0,1],g=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],h=Array(36),p=0;6>p;p++)for(var q=0;6>q;q++)h[6*p+q]=p;for(var k=Array(36),p=0;6>p;p++)k[6*p+0]=0,k[6*p+1]=1,k[6*p+2]=2,k[6*p+3]=2,k[6*p+4]=3,k[6*p+5]=0;a.createGeometry=function(a){Array.isArray(a)||
(a=[a,a,a]);for(var m=new Float32Array(24),v=0;8>v;v++)m[3*v]=c[v][0]*a[0],m[3*v+1]=c[v][1]*a[1],m[3*v+2]=c[v][2]*a[2];a={};a[d.VertexAttrConstants.POSITION]=new Uint32Array(g);a[d.VertexAttrConstants.NORMAL]=new Uint32Array(h);a[d.VertexAttrConstants.UV0]=new Uint32Array(k);v={};v[d.VertexAttrConstants.POSITION]={size:3,data:m};v[d.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(b)};v[d.VertexAttrConstants.UV0]={size:2,data:new Float32Array(f)};return new e.GeometryData(v,a)}})(c||(c={}));
var q;(function(a){var c=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],b=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],f=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],g=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var m=new Float32Array(18),h=0;6>h;h++)m[3*h]=c[h][0]*a[0],m[3*h+1]=c[h][1]*a[1],m[3*h+2]=c[h][2]*a[2];a={};a[d.VertexAttrConstants.POSITION]=new Uint32Array(f);a[d.VertexAttrConstants.NORMAL]=
new Uint32Array(g);h={};h[d.VertexAttrConstants.POSITION]={size:3,data:m};h[d.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(b)};return new e.GeometryData(h,a)}})(q||(q={}));var p;(function(a){var c=k.vec3f32.fromValues(-.5,0,-.5),b=k.vec3f32.fromValues(.5,0,-.5),f=k.vec3f32.fromValues(0,0,.5),g=k.vec3f32.fromValues(0,.5,0),h=k.vec3f32.create(),p=k.vec3f32.create(),q=k.vec3f32.create(),r=k.vec3f32.create(),u=k.vec3f32.create();l.vec3.subtract(h,c,g);l.vec3.subtract(p,c,b);l.vec3.cross(q,
h,p);l.vec3.normalize(q,q);l.vec3.subtract(h,b,g);l.vec3.subtract(p,b,f);l.vec3.cross(r,h,p);l.vec3.normalize(r,r);l.vec3.subtract(h,f,g);l.vec3.subtract(p,f,c);l.vec3.cross(u,h,p);l.vec3.normalize(u,u);var t=[c,b,f,g],x=[0,-1,0,q[0],q[1],q[2],r[0],r[1],r[2],u[0],u[1],u[2]],w=[0,1,2,3,1,0,3,2,1,3,0,2],L=[0,0,0,1,1,1,2,2,2,3,3,3];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var c=new Float32Array(12),b=0;4>b;b++)c[3*b]=t[b][0]*a[0],c[3*b+1]=t[b][1]*a[1],c[3*b+2]=t[b][2]*a[2];a={};
a[d.VertexAttrConstants.POSITION]=new Uint32Array(w);a[d.VertexAttrConstants.NORMAL]=new Uint32Array(L);b={};b[d.VertexAttrConstants.POSITION]={size:3,data:c};b[d.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(x)};return new e.GeometryData(b,a)}})(p||(p={}));var r;(function(b){function r(a,d,c,b,e){if(Math.abs(l.vec3.dot(d,a))>e)return!1;l.vec3.cross(c,a,d);l.vec3.normalize(c,c);l.vec3.cross(b,c,a);l.vec3.normalize(b,b);return!0}function m(a,d,c,b,e,f,g){return r(a,d,e,f,g)||r(a,c,e,f,
g)||r(a,b,e,f,g)}b.createBoxGeometry=c.createGeometry;b.createDiamondGeometry=q.createGeometry;b.createTetrahedronGeometry=p.createGeometry;b.createSphereGeometry=function(a,c,b,f,g,m,h){a=a||50;f=void 0!==f?f:-Math.PI;g=void 0!==g?g:2*Math.PI;m=void 0!==m?m:.5*-Math.PI;h=void 0!==h?h:Math.PI;var v=Math.max(3,Math.floor(c)||8),p=Math.max(2,Math.floor(b)||6),q=(v+1)*(p+1);b=new Float32Array(3*q);c=new Float32Array(3*q);for(var q=new Float32Array(2*q),k=[],r=0,z=0;z<=p;z++){for(var u=[],t=z/p,y=m+t*
h,x=Math.cos(y),w=0;w<=v;w++){var B=w/v,l=f+B*g,C=Math.cos(l)*x,D=Math.sin(y),l=-Math.sin(l)*x;b[3*r]=C*a;b[3*r+1]=D*a;b[3*r+2]=l*a;c[3*r]=C;c[3*r+1]=D;c[3*r+2]=l;q[2*r]=B;q[2*r+1]=t;u.push(r);++r}k.push(u)}a=new Uint32Array(2*v*(p-1)*3);for(z=r=0;z<p;z++)for(w=0;w<v;w++)f=k[z][w],g=k[z][w+1],m=k[z+1][w+1],h=k[z+1][w],0===z?(a[r++]=f,a[r++]=m,a[r++]=h):z===p-1?(a[r++]=f,a[r++]=g,a[r++]=m):(a[r++]=f,a[r++]=g,a[r++]=m,a[r++]=m,a[r++]=h,a[r++]=f);d.assert(r===a.length);v={};v[d.VertexAttrConstants.POSITION]=
a;v[d.VertexAttrConstants.NORMAL]=a;v[d.VertexAttrConstants.UV0]=a;p={};p[d.VertexAttrConstants.POSITION]={size:3,data:b};p[d.VertexAttrConstants.NORMAL]={size:3,data:c};p[d.VertexAttrConstants.UV0]={size:2,data:q};return new e.GeometryData(p,v)};b.createPolySphereGeometry=function(a,c,b){function g(d,c){d>c&&(c=[c,d],d=c[0],c=c[1]);var b=d.toString()+"."+c.toString();if(v[b])return v[b];var e=m.length;m.length+=3;f.add(m,3*d,m,3*c,m,e);f.scale(m,e,a/f.length(m,e));e/=3;return v[b]=e}var m;b?(m=[0,
-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],b=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(b=a*(1+Math.sqrt(5))/2,m=[-a,b,0,a,b,0,-a,-b,0,a,-b,0,0,-a,b,0,a,b,0,-a,-b,0,a,-b,b,0,-a,b,0,a,-b,0,-a,-b,0,a],b=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var h=0;h<m.length;h+=3)f.scale(m,h,a/f.length(m,h));for(var v={},h=0;h<c;h++){for(var p=b.length,q=new Uint32Array(4*p),r=0;r<
p;r+=3){var k=b[r],z=b[r+1],u=b[r+2],t=g(k,z),y=g(z,u),x=g(u,k),w=4*r;q[w]=k;q[w+1]=t;q[w+2]=x;q[w+3]=z;q[w+4]=y;q[w+5]=t;q[w+6]=u;q[w+7]=x;q[w+8]=y;q[w+9]=t;q[w+10]=y;q[w+11]=x}b=q;v={}}c=new Float32Array(m);for(h=0;h<c.length;h+=3)f.normalize(c,h);h={};h[d.VertexAttrConstants.POSITION]=b;h[d.VertexAttrConstants.NORMAL]=b;b={};b[d.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(m)};b[d.VertexAttrConstants.NORMAL]={size:3,data:c};return new e.GeometryData(b,h)};b.createPointGeometry=function(a,
c,b,f,g,m,h,p){c=c?new Float64Array([c[0],c[1],c[2]]):new Float32Array([0,0,0]);a=a?new Float32Array([a[0],a[1],a[2]]):new Float32Array([0,0,1]);m=m?new Float32Array(m):new Float32Array([0,0]);b=b?new Uint8Array([255*b[0],255*b[1],255*b[2],3<b.length?255*b[3]:255]):new Uint8Array([255,255,255,255]);var v=null!=f&&2===f.length?new Float32Array(f):new Float32Array([1,1]);f={};f[d.VertexAttrConstants.POSITION]={size:3,data:c};f[d.VertexAttrConstants.NORMAL]={size:3,data:a};f[d.VertexAttrConstants.UV0]=
{size:m.length,data:m};f[d.VertexAttrConstants.COLOR]={size:4,data:b};f[d.VertexAttrConstants.SIZE]={size:2,data:v};null!=g&&(g=new Float32Array([g[0],g[1],g[2],g[3]]),f[d.VertexAttrConstants.AUXPOS1]={size:4,data:g});null!=h&&(h=new Float32Array([h[0],h[1],h[2],h[3]]),f[d.VertexAttrConstants.AUXPOS2]={size:4,data:h});return null!=p?(e.GeometryData.call(p,f,e.GeometryData.DefaultIndices,e.GeometryData.DefaultOffsets,"point"),p):new e.GeometryData(f,e.GeometryData.DefaultIndices,e.GeometryData.DefaultOffsets,
"point")};b.updatePointGeometry=function(a,c,b,e,f,g,m,h){var v=h.vertexAttributes;if(null!=a){var p=v[d.VertexAttrConstants.NORMAL].data;p[0]=a[0];p[1]=a[1];p[2]=a[2]}null!=c&&(p=v[d.VertexAttrConstants.POSITION].data,p[0]=c[0],p[1]=c[1],p[2]=c[2]);null!=b&&(p=v[d.VertexAttrConstants.COLOR].data,p[0]=b[0],p[1]=b[1],p[2]=b[2],p[3]=b[3]);null!=e&&(p=v[d.VertexAttrConstants.SIZE].data,p[0]=e[0],p[1]=e[1]);null!=f&&(p=v[d.VertexAttrConstants.AUXPOS1].data,p[0]=f[0],p[1]=f[1],p[2]=f[2],p[3]=f[3]);null!=
g&&(p=v[d.VertexAttrConstants.UV0].data,p[0]=g[0],p[1]=g[1]);null!=m&&(p=v[d.VertexAttrConstants.AUXPOS2].data,p[0]=m[0],p[1]=m[1],p[2]=m[2],p[3]=m[3]);return h};b.createPointArrayGeometry=function(a,c){for(var b=new Float32Array(3*a.length),f=new Float32Array(c?3*a.length:3),g=new Uint32Array(a.length),m=new Uint32Array(a.length),h=0;h<a.length;h++)b[3*h]=a[h][0],b[3*h+1]=a[h][1],b[3*h+2]=a[h][2],c&&(f[3*h]=c[h][0],f[3*h+1]=c[h][1],f[3*h+2]=c[h][2]),g[h]=h,m[h]=0;c||(f[0]=0,f[1]=1,f[2]=0);a=new Float32Array(2);
a[0]=0;a[1]=0;h={};h[d.VertexAttrConstants.POSITION]=g;h[d.VertexAttrConstants.NORMAL]=c?g:m;h[d.VertexAttrConstants.UV0]=m;c={};c[d.VertexAttrConstants.POSITION]={size:3,data:b};c[d.VertexAttrConstants.NORMAL]={size:3,data:f};c[d.VertexAttrConstants.UV0]={size:2,data:a};return new e.GeometryData(c,h,e.GeometryData.DefaultOffsets,"point")};b.createTriangleGeometry=function(){var a=new Float32Array([0,0,0,0,0,100,100,0,0]),c=new Uint32Array([0,1,2]),b=new Float32Array([0,1,0]),f=new Uint32Array([0,
0,0]),g=new Float32Array([0,0]),m=new Uint32Array([0,0,0]),h={};h[d.VertexAttrConstants.POSITION]=c;h[d.VertexAttrConstants.NORMAL]=f;h[d.VertexAttrConstants.UV0]=m;c={};c[d.VertexAttrConstants.POSITION]={size:3,data:a};c[d.VertexAttrConstants.NORMAL]={size:3,data:b};c[d.VertexAttrConstants.UV0]={size:2,data:g};return new e.GeometryData(c,h)};b.createSquareGeometry=function(a){var c=new Float32Array(12);if(a)for(var b=0;4>b;b++)for(var f=0;3>f;f++)c[3*b+f]=a[b][f];else c[0]=-1,c[1]=-1,c[2]=0,c[3]=
1,c[4]=-1,c[5]=0,c[6]=1,c[7]=1,c[8]=0,c[9]=-1,c[10]=1,c[11]=0;var g=new Uint32Array([0,1,2,2,3,0]);a=new Float32Array([0,0,1]);var m=new Uint32Array([0,0,0,0,0,0]),b=new Float32Array([0,0,1,0,1,1,0,1]),f=new Uint8Array([255,255,255,255]),h={};h[d.VertexAttrConstants.POSITION]=g;h[d.VertexAttrConstants.NORMAL]=m;h[d.VertexAttrConstants.UV0]=g;h[d.VertexAttrConstants.COLOR]=m;g={};g[d.VertexAttrConstants.POSITION]={size:3,data:c};g[d.VertexAttrConstants.NORMAL]={size:3,data:a};g[d.VertexAttrConstants.UV0]=
{size:2,data:b};g[d.VertexAttrConstants.COLOR]={size:4,data:f};return new e.GeometryData(g,h)};b.createConeGeometry=function(a,c,b,f,g,m){void 0===g&&(g=!0);void 0===m&&(m=!0);var h=0,p=k.vec3f32.fromValues(0,h,0),v=k.vec3f32.fromValues(0,h+a,0),q=k.vec3f32.fromValues(0,-1,0),r=k.vec3f32.fromValues(0,1,0);f&&(h=a,v=k.vec3f32.fromValues(0,0,0),p=k.vec3f32.fromValues(0,h,0),q=k.vec3f32.fromValues(0,1,0),r=k.vec3f32.fromValues(0,-1,0));p=[v,p];q=[q,r];r=b+2;v=Math.sqrt(a*a+c*c);if(f)for(f=b-1;0<=f;f--)z=
2*Math.PI/b*f,u=k.vec3f32.fromValues(Math.cos(z)*c,h,Math.sin(z)*c),p.push(u),z=k.vec3f32.fromValues(a*Math.cos(z)/v,-c/v,a*Math.sin(z)/v),q.push(z);else for(f=0;f<b;f++){var z=2*Math.PI/b*f,u=k.vec3f32.fromValues(Math.cos(z)*c,h,Math.sin(z)*c);p.push(u);z=k.vec3f32.fromValues(a*Math.cos(z)/v,c/v,a*Math.sin(z)/v);q.push(z)}a=new Uint32Array(6*(b+2));b=new Uint32Array(6*(b+2));h=c=0;if(g){for(f=3;f<p.length;f++)a[c++]=1,a[c++]=f-1,a[c++]=f,b[h++]=0,b[h++]=0,b[h++]=0;a[c++]=p.length-1;a[c++]=2;a[c++]=
1;b[h++]=0;b[h++]=0;b[h++]=0}if(m){for(f=3;f<p.length;f++)a[c++]=f,a[c++]=f-1,a[c++]=0,b[h++]=f,b[h++]=f-1,b[h++]=1;a[c++]=0;a[c++]=2;a[c++]=p.length-1;b[h++]=1;b[h++]=2;b[h++]=q.length-1}g=new Float32Array(3*r);for(f=0;f<r;f++)g[3*f]=p[f][0],g[3*f+1]=p[f][1],g[3*f+2]=p[f][2];m=new Float32Array(3*r);for(f=0;f<r;f++)m[3*f]=q[f][0],m[3*f+1]=q[f][1],m[3*f+2]=q[f][2];p={};p[d.VertexAttrConstants.POSITION]=a;p[d.VertexAttrConstants.NORMAL]=b;q={};q[d.VertexAttrConstants.POSITION]={size:3,data:g};q[d.VertexAttrConstants.NORMAL]=
{size:3,data:m};return new e.GeometryData(q,p)};b.createCylinderGeometry=function(a,c,b,f,g,m){f=f?k.vec3f32.clone(f):k.vec3f32.fromValues(1,0,0);g=g?k.vec3f32.clone(g):k.vec3f32.fromValues(0,0,0);m=void 0===m?!0:m;var h=k.vec3f32.create();l.vec3.normalize(h,f);f=k.vec3f32.create();l.vec3.scale(f,h,Math.abs(a));var p=k.vec3f32.create();l.vec3.scale(p,f,-.5);l.vec3.add(p,p,g);var q=k.vec3f32.fromValues(0,1,0);.2>Math.abs(1-l.vec3.dot(h,q))&&l.vec3.set(q,0,0,1);var v=k.vec3f32.create();l.vec3.cross(v,
h,q);l.vec3.normalize(v,v);l.vec3.cross(q,v,h);var r=2*b+(m?2:0),z=b+(m?2:0);a=new Float32Array(3*r);g=new Float32Array(3*z);var u=new Float32Array(2*r),t=new Uint32Array(3*b*(m?4:2)),y=new Uint32Array(3*b*(m?4:2));m&&(a[3*(r-2)+0]=p[0],a[3*(r-2)+1]=p[1],a[3*(r-2)+2]=p[2],u[2*(r-2)]=0,u[2*(r-2)+1]=0,a[3*(r-1)+0]=a[3*(r-2)+0]+f[0],a[3*(r-1)+1]=a[3*(r-2)+1]+f[1],a[3*(r-1)+2]=a[3*(r-2)+2]+f[2],u[2*(r-1)]=1,u[2*(r-1)+1]=1,g[3*(z-2)+0]=-h[0],g[3*(z-2)+1]=-h[1],g[3*(z-2)+2]=-h[2],g[3*(z-1)+0]=h[0],g[3*
(z-1)+1]=h[1],g[3*(z-1)+2]=h[2]);for(var h=function(a,c,d){t[a]=c;y[a]=d},x=0,w=k.vec3f32.create(),B=k.vec3f32.create(),C=0;C<b;C++){var D=2*Math.PI/b*C;l.vec3.scale(w,q,Math.sin(D));l.vec3.scale(B,v,Math.cos(D));l.vec3.add(w,w,B);g[3*C+0]=w[0];g[3*C+1]=w[1];g[3*C+2]=w[2];l.vec3.scale(w,w,c);l.vec3.add(w,w,p);a[3*C+0]=w[0];a[3*C+1]=w[1];a[3*C+2]=w[2];u[2*C+0]=C/b;u[2*C+1]=0;a[3*(C+b)+0]=a[3*C+0]+f[0];a[3*(C+b)+1]=a[3*C+1]+f[1];a[3*(C+b)+2]=a[3*C+2]+f[2];u[2*(C+b)+0]=C/b;u[2*C+1]=1;D=(C+1)%b;h(x++,
C,C);h(x++,C+b,C);h(x++,D,D);h(x++,D,D);h(x++,C+b,C);h(x++,D+b,D)}if(m){for(C=0;C<b;C++)D=(C+1)%b,h(x++,r-2,z-2),h(x++,C,z-2),h(x++,D,z-2);for(C=0;C<b;C++)D=(C+1)%b,h(x++,C+b,z-1),h(x++,r-1,z-1),h(x++,D+b,z-1)}c={};c[d.VertexAttrConstants.POSITION]=t;c[d.VertexAttrConstants.NORMAL]=y;c[d.VertexAttrConstants.UV0]=t;b={};b[d.VertexAttrConstants.POSITION]={size:3,data:a};b[d.VertexAttrConstants.NORMAL]={size:3,data:g};b[d.VertexAttrConstants.UV0]={size:2,data:u};return new e.GeometryData(b,c)};b.createTubeGeometry=
function(a,c,e,f,g){e=e||10;f=null!=f?f:!0;d.assert(1<a.length);for(var m=[],h=[],p=0;p<e;p++){m.push([0,-p-1,-((p+1)%e)-1]);var q=p/e*2*Math.PI;h.push([Math.cos(q)*c,Math.sin(q)*c])}return b.createPathExtrusionGeometry(h,a,[[0,0,0]],m,f,g)};b.createPathExtrusionGeometry=function(c,b,f,g,p,q){void 0===q&&(q=k.vec3f32.fromValues(0,0,0));var v=c.length,r=new Float32Array(b.length*v*3+(6*f.length||0)),z=new Float32Array(b.length*v+(2*f.length||0)),u=new Float32Array(b.length*v*3+(f?6:0)),y=(b.length-
1)*v*6+6*g.length,x=new Uint32Array(y),y=new Uint32Array(y),w=0,B=0,C=0,D=0,n=0,K=k.vec3f32.create(),P=k.vec3f32.create(),V=k.vec3f32.create(),Z=k.vec3f32.create(),ca=k.vec3f32.create(),da=k.vec3f32.create(),F=k.vec3f32.create(),ea=h.vec3f64.create(),la=k.vec3f32.create(),ka=k.vec3f32.create(),oa=k.vec3f32.create(),va=k.vec3f32.create(),fa=k.vec3f32.create(),xa=a.plane.create();l.vec3.set(la,0,1,0);l.vec3.subtract(P,b[1],b[0]);l.vec3.normalize(P,P);p?(l.vec3.add(ea,b[0],q),l.vec3.normalize(V,ea)):
l.vec3.set(V,0,0,1);m(P,V,la,la,ca,V,t);l.vec3.copy(Z,V);l.vec3.copy(va,ca);for(var ia=0;ia<f.length;ia++)l.vec3.scale(da,ca,f[ia][0]),l.vec3.scale(ea,V,f[ia][2]),l.vec3.add(da,da,ea),l.vec3.add(da,da,b[0]),r[w++]=da[0],r[w++]=da[1],r[w++]=da[2],z[C++]=0;u[B++]=-P[0];u[B++]=-P[1];u[B++]=-P[2];for(ia=0;ia<g.length;ia++)x[D++]=0<g[ia][0]?g[ia][0]:-g[ia][0]-1+f.length,x[D++]=0<g[ia][1]?g[ia][1]:-g[ia][1]-1+f.length,x[D++]=0<g[ia][2]?g[ia][2]:-g[ia][2]-1+f.length,y[n++]=0,y[n++]=0,y[n++]=0;for(var na=
f.length,ia=f.length-1,wa=0;wa<b.length;wa++){var Ca=!1;0<wa&&(l.vec3.copy(K,P),wa<b.length-1?(l.vec3.subtract(P,b[wa+1],b[wa]),l.vec3.normalize(P,P)):Ca=!0,l.vec3.add(ka,K,P),l.vec3.normalize(ka,ka),l.vec3.add(oa,b[wa-1],Z),a.plane.fromPositionAndNormal(b[wa],ka,xa),a.plane.intersectRay(xa,a.ray.wrap(oa,K),ea)?(l.vec3.subtract(ea,ea,b[wa]),l.vec3.normalize(V,ea),l.vec3.cross(ca,ka,V),l.vec3.normalize(ca,ca)):m(ka,Z,va,la,ca,V,t),l.vec3.copy(Z,V),l.vec3.copy(va,ca));p&&(l.vec3.add(ea,b[wa],q),l.vec3.normalize(fa,
ea));for(var ua=0;ua<v;ua++)if(l.vec3.scale(da,ca,c[ua][0]),l.vec3.scale(ea,V,c[ua][1]),l.vec3.add(da,da,ea),l.vec3.normalize(F,da),u[B++]=F[0],u[B++]=F[1],u[B++]=F[2],p?z[C++]=l.vec3.dot(da,fa):z[C++]=da[2],l.vec3.add(da,da,b[wa]),r[w++]=da[0],r[w++]=da[1],r[w++]=da[2],!Ca){var ya=(ua+1)%v;x[D++]=na+ua;x[D++]=na+v+ua;x[D++]=na+ya;x[D++]=na+ya;x[D++]=na+v+ua;x[D++]=na+v+ya;for(ya=0;6>ya;ya++)y[n++]=x[D-6+ya]-ia}na+=v}c=b[b.length-1];for(ia=0;ia<f.length;ia++)l.vec3.scale(da,ca,f[ia][0]),l.vec3.scale(ea,
V,f[ia][1]),l.vec3.add(da,da,ea),l.vec3.add(da,da,c),r[w++]=da[0],r[w++]=da[1],r[w++]=da[2],z[C++]=0;f=B/3;u[B++]=P[0];u[B++]=P[1];u[B++]=P[2];v=na-v;for(ia=0;ia<g.length;ia++)x[D++]=0<=g[ia][0]?na+g[ia][0]:-g[ia][0]-1+v,x[D++]=0<=g[ia][2]?na+g[ia][2]:-g[ia][2]-1+v,x[D++]=0<=g[ia][1]?na+g[ia][1]:-g[ia][1]-1+v,y[n++]=f,y[n++]=f,y[n++]=f;g={};g[d.VertexAttrConstants.POSITION]=x;g[d.VertexAttrConstants.NORMAL]=y;x={};x[d.VertexAttrConstants.POSITION]={size:3,data:r};x.zOffset={size:1,data:z};x[d.VertexAttrConstants.NORMAL]=
{size:3,data:u};return new e.GeometryData(x,g)};b.createPolylineGeometry=function(a,c){d.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");d.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");d.assert(void 0===c||c.length===a.length,"createPolylineGeometry: need same number of points and normals");d.assert(void 0===c||3===c[0].length,"createPolylineGeometry(): malformed normal");for(var b=new Float32Array(3*a.length),f=new Uint32Array(2*(a.length-1)),
g=0,m=0,h=0;h<a.length;h++){for(var p=0;3>p;p++)b[g++]=a[h][p];0<h&&(f[m++]=h-1,f[m++]=h)}g={};m={};g[d.VertexAttrConstants.POSITION]=f;m[d.VertexAttrConstants.POSITION]={size:3,data:b};if(c){for(var b=new Float32Array(3*c.length),q=0,h=0;h<a.length;h++)for(p=0;3>p;p++)b[q++]=c[h][p];g[d.VertexAttrConstants.NORMAL]=f;m[d.VertexAttrConstants.NORMAL]={size:3,data:b}}return new e.GeometryData(m,g,e.GeometryData.DefaultOffsets,"line")};b.createExtrudedTriangle=function(a,c,b,f){var g,m,h=new Float32Array(18);
a=[[-c,0,f/2],[b,0,f/2],[0,a,f/2],[-c,0,-f/2],[b,0,-f/2],[0,a,-f/2]];for(c=0;6>c;c++)h[3*c]=a[c][0],h[3*c+1]=a[c][1],h[3*c+2]=a[c][2];a=(g={},g[d.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),g);g=(m={},m[d.VertexAttrConstants.POSITION]={size:3,data:h},m);return new e.GeometryData(g,a)};b.transformInPlace=function(a,c){a=a.vertexAttributes[d.VertexAttrConstants.POSITION].data;for(var b=0;b<a.length;b+=3)l.vec3.set(x,a[b],a[b+1],a[b+2]),l.vec3.transformMat4(x,
x,c),a[b]=x[0],a[b+1]=x[1],a[b+2]=x[2]};b.addVertexColors=function(a,c){var b=c||[1,1,1,1];c=new Uint8Array(4);c[0]=255*b[0];c[1]=255*b[1];c[2]=255*b[2];c[3]=255*(3<b.length?b[3]:1);var b={},f=a.getVertexAttr(),g;for(g in f)b[g]=f[g];b[d.VertexAttrConstants.COLOR]={size:4,data:c};c={};for(g in a.indices)c[g]=a.indices[g];c[d.VertexAttrConstants.COLOR]=new Uint32Array(c[d.VertexAttrConstants.POSITION].length);return a=new e.GeometryData(b,c,a.componentOffsets,a.primitiveType)};b.addNormals=function(a){var c=
a.getVertexAttr();a=a.indices;for(var b=g.Vec3Compact.subtract,e=new Float32Array(a.position.length/3*3),f=c.position.data,m=0,h=a.position,p=new Uint32Array(h.length),q=0;q<h.length;q+=3){b(f,3*h[q],f,3*h[q+2],w,0);b(f,3*h[q],f,3*h[q+1],x,0);l.vec3.cross(x,x,w);l.vec3.normalize(x,x);var v=m/3;e[m++]=x[0];e[m++]=x[1];e[m++]=x[2];p[q]=v;p[q+1]=v;p[q+2]=v}c[d.VertexAttrConstants.NORMAL]={size:3,data:e,offsetIdx:0,strideIdx:3};a[d.VertexAttrConstants.NORMAL]=p};b.cgToGIS=function(a,c){void 0===c&&(c=
a);var d=a.getVertexAttr();a=d.position.data;var d=d.normal.data,b=c.getVertexAttr(),e=b.position.data,b=b.normal.data;if(d)for(var f=0;f<d.length;f+=3){var g=d[f+1];b[f+1]=-d[f+2];b[f+2]=g}if(a)for(f=0;f<a.length;f+=3)g=a[f+1],e[f+1]=-a[f+2],e[f+2]=g;return c};b.makeOrthoBasisDirUp=r;b.makeOrthoBasisDirUpFallback=m})(r||(r={}));var t=.99619469809,x=k.vec3f32.create(),w=k.vec3f32.create();return r})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["require","exports","./factories/vec3f32"],
function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec3f32=l})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["require","exports"],function(n,b){function l(){return new Float32Array(3)}function k(a,b,c){var d=new Float32Array(3);d[0]=a;d[1]=b;d[2]=c;return d}function h(){return k(1,1,1)}function a(){return k(1,0,0)}function g(){return k(0,1,0)}function e(){return k(0,0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.clone=function(a){var d=new Float32Array(3);
d[0]=a[0];d[1]=a[1];d[2]=a[2];return d};b.fromValues=k;b.createView=function(a,b){return new Float32Array(a,b,3)};b.zeros=function(){return l()};b.ones=h;b.unitX=a;b.unitY=g;b.unitZ=e;b.ZEROS=l();b.ONES=h();b.UNIT_X=a();b.UNIT_Y=g();b.UNIT_Z=e()})},"esri/views/3d/support/geometryUtils":function(){define("require exports ./geometryUtils/axisAngle ./geometryUtils/boundedPlane ./geometryUtils/frustum ./geometryUtils/lineSegment ./geometryUtils/plane ./geometryUtils/ray ./geometryUtils/sphere ./geometryUtils/triangle ./geometryUtils/vector".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});b.plane=g;b.boundedPlane=k;b.triangle=f;b.lineSegment=a;b.ray=e;b.sphere=d;b.frustum=h;b.vector=c;b.axisAngle=l})},"esri/views/3d/support/geometryUtils/axisAngle":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../stack","./vector"],function(n,b,l,k,h){function a(a){void 0===a&&(a=b.UP);return[a[0],a[1],a[2],a[3]]}function g(b,d,f,c,g){void 0===g&&(g=a());g[0]=b;g[1]=d;g[2]=f;g[3]=c;return g}
Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.wrap=function(a,d,b,c){return g(a,d,b,c,k.sv4d.get())};b.wrapAxisAngle=function(a,d){return g(a[0],a[1],a[2],d,k.sv4d.get())};b.copy=function(b,d){void 0===d&&(d=a());return g(b[0],b[1],b[2],b[3],d)};b.fromValues=g;b.fromAxisAndAngle=function(b,d,f){void 0===f&&(f=a());l.vec3.copy(f,b);f[3]=d;return f};b.fromPoints=function(b,d,f){void 0===f&&(f=a());l.vec3.cross(f,b,d);l.vec3.normalize(f,f);f[3]=h.angle(b,d);return f};b.UP=[0,0,1,0]})},
"esri/views/3d/support/stack":function(){define(["require","exports","../../../core/VectorStack"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.sv2d=l.VectorStack.createVec2f64();b.sv3d=l.VectorStack.createVec3f64();b.sv4d=l.VectorStack.createVec4f64();b.sm3d=l.VectorStack.createMat3f64();b.sm4d=l.VectorStack.createMat4f64();b.sq4d=l.VectorStack.createQuatf64()})},"esri/core/VectorStack":function(){define("require exports ./nextTick ./libs/gl-matrix-2/mat3f64 ./libs/gl-matrix-2/mat4f64 ./libs/gl-matrix-2/quatf64 ./libs/gl-matrix-2/vec2f64 ./libs/gl-matrix-2/vec3f64 ./libs/gl-matrix-2/vec4f64".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function c(a,c,d){var b=this;this.itemByteSize=a;this.itemCreate=c;this.buffers=[];this.items=[];this.itemsPtr=this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(d/this.itemByteSize);this.tickHandle=l.before(function(){return b.reset()})}c.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.itemsPtr=0;this.buffers=this.items=null};c.prototype.get=function(){0===
this.itemsPtr&&l(function(){});for(var a=Math.floor(this.itemsPtr/this.itemsPerBuffer);this.buffers.length<=a;){for(var c=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),d=0;d<this.itemsPerBuffer;++d)this.items.push(this.itemCreate(c,d*this.itemByteSize));this.buffers.push(c)}return this.items[this.itemsPtr++]};c.prototype.reset=function(){for(var a=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>a;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;
this.itemsPtr=0};c.createVec2f64=function(a){void 0===a&&(a=f);return new c(16,g.vec2f64.createView,a)};c.createVec3f64=function(a){void 0===a&&(a=f);return new c(24,e.vec3f64.createView,a)};c.createVec4f64=function(a){void 0===a&&(a=f);return new c(32,d.vec4f64.createView,a)};c.createMat3f64=function(a){void 0===a&&(a=f);return new c(72,k.mat3f64.createView,a)};c.createMat4f64=function(a){void 0===a&&(a=f);return new c(128,h.mat4f64.createView,a)};c.createQuatf64=function(d){void 0===d&&(d=f);return new c(32,
a.quatf64.createView,d)};Object.defineProperty(c.prototype,"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!0,configurable:!0});return c}();b.VectorStack=n;var f=4096})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat3f64=l})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require","exports"],function(n,
b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,0,1,0,0,0,1]};b.clone=function(b){return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8]]};b.fromValues=function(b,k,h,a,g,e,d,f,c){return[b,k,h,a,g,e,d,f,c]};b.createView=function(b,k){return new Float64Array(b,k,9)}})},"esri/core/libs/gl-matrix-2/quatf64":function(){define(["require","exports","./factories/quatf64"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.quatf64=l})},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[0,0,0,1]};b.clone=function(b){return[b[0],b[1],b[2],b[3]]};b.fromValues=function(b,k,h,a){return[b,k,h,a]};b.createView=function(b,k){return new Float64Array(b,k,4)}})},"esri/core/libs/gl-matrix-2/vec2f64":function(){define(["require","exports","./factories/vec2f64"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec2f64=l})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[0,0]};b.clone=function(b){return[b[0],b[1]]};b.fromValues=function(b,k){return[b,k]};b.fromArray=function(b){for(var k=[0,0],h=Math.min(2,b.length),a=0;a<h;++a)k[a]=b[a];return k};b.createView=function(b,k){return new Float64Array(b,k,2)};b.zeros=function(){return[0,0]};b.ones=function(){return[1,1]};b.unitX=function(){return[1,0]};b.unitY=function(){return[0,1]};b.ZEROS=[0,0];b.ONES=[1,1];b.UNIT_X=
[1,0];b.UNIT_Y=[0,1]})},"esri/views/3d/support/geometryUtils/vector":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3"],function(n,b,l,k){function h(a,b){return k.vec3.dot(a,b)/k.vec3.length(a)}Object.defineProperty(b,"__esModule",{value:!0});b.projectPoint=function(a,b,e){b=h(a,b);return k.vec3.scale(e,a,b)};b.projectPointSignedLength=h;b.angle=function(a,b){a=k.vec3.dot(a,b)/(k.vec3.length(a)*k.vec3.length(b));return-l.acosClamped(a)}})},
"esri/views/3d/support/geometryUtils/boundedPlane":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack ./lineSegment ./plane ./ray ./vector".split(" "),function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){function w(a){void 0===a&&(a=
b.UP);return{plane:r.create(a.plane),origin:f.vec3f64.clone(a.origin),basis1:f.vec3f64.clone(a.basis1),basis2:f.vec3f64.clone(a.basis2)}}function u(a,c){void 0===c&&(c=w());return y(a.origin,a.basis1,a.basis2,c)}function y(a,c,b,e){void 0===e&&(e=w());d.vec3.copy(e.origin,a);d.vec3.copy(e.basis1,c);d.vec3.copy(e.basis2,b);r.fromVectorsAndPoint(b,c,a,e.plane);a=e;1E-6<Math.abs(d.vec3.dot(a.basis1,a.basis2)/(d.vec3.length(a.basis1)*d.vec3.length(a.basis2)))&&M.warn("fromValues()","Provided basis vectors are not perpendicular");
1E-6<Math.abs(d.vec3.dot(a.basis1,a.plane))&&M.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-d.vec3.dot(a.plane,a.origin)-a.plane[3])&&M.warn("fromValues()","Plane offset is not consistent with plane origin");return e}function m(a,c,b){a!==b&&u(a,b);a=d.vec3.scale(q.sv3d.get(),a.plane,c);d.vec3.add(b.origin,b.origin,a);b.plane[3]-=c;return b}function v(a,c){void 0===c&&(c=w());var b=(a[2]-a[0])/2,e=(a[3]-a[1])/2;d.vec3.set(c.origin,a[0]+b,a[1]+e,0);d.vec3.set(c.basis1,
b,0,0);d.vec3.set(c.basis2,0,e,0);r.fromValues(0,0,1,0,c.plane);return c}function z(a,c,d){return r.intersectRay(a.plane,c,d)?Q(a,d):!1}function B(a,b,e){var f=R.get(),g=R.get();L(a,b,f,g);for(var g=Number.POSITIVE_INFINITY,m=0,p=Y;m<p.length;m++){var v=N(a,p[m],S.get()),k=q.sv3d.get();r.intersectLineSegment(f,v,k)&&(v=c.directionFromTo(q.sv3d.get(),b.origin,k),v=Math.abs(h.acosClamped(d.vec3.dot(b.direction,v))),v<g&&(g=v,d.vec3.copy(e,k)))}return g===Number.POSITIVE_INFINITY?C(a,b,e):e}function C(a,
c,b){if(z(a,c,b))return b;var e=R.get(),f=R.get();L(a,c,e,f);for(var g=Number.POSITIVE_INFINITY,m=0,h=Y;m<h.length;m++){var p=N(a,h[m],S.get()),v=q.sv3d.get();r.intersectLineSegmentClamp(e,p,v)&&(p=t.distance2(c,v),r.isPointInside(f,v)&&p<g&&(g=p,d.vec3.copy(b,v)))}K(a,c.origin)<g&&d.vec3.copy(b,c.origin);return b}function D(a,c,b){var e=a.origin,f=a.basis1,g=a.basis2;c=d.vec3.subtract(q.sv3d.get(),c,e);f=x.projectPointSignedLength(f,c)/d.vec3.length(f);g=x.projectPointSignedLength(g,c)/d.vec3.length(g);
a=x.projectPointSignedLength(a.plane,c);return d.vec3.set(b,f,g,a)}function K(a,c){c=D(a,c,q.sv3d.get());var b=a.basis2;a=d.vec3.length(a.basis1);b=d.vec3.length(b);a=Math.max(Math.abs(c[0])-a,0);b=Math.max(Math.abs(c[1])-b,0);c=c[2];return a*a+b*b+c*c}function I(a,c){var d=-a.plane[3];return x.projectPointSignedLength(a.plane,c)-d}function Q(a,c){var b=d.vec3.subtract(q.sv3d.get(),c,a.origin);c=d.vec3.squaredLength(a.basis1);var e=d.vec3.squaredLength(a.basis2),f=d.vec3.dot(a.basis1,b);a=d.vec3.dot(a.basis2,
b);return 0>-f-c&&0>f-c&&0>-a-e&&0>a-e}function J(a,c){var b=S.get();d.vec3.copy(b.origin,a.origin);d.vec3.copy(b.vector,c);return b}function N(a,c,b){var e=a.basis1,f=a.basis2;a=a.origin;var g=d.vec3.scale(q.sv3d.get(),e,c.origin[0]),m=d.vec3.scale(q.sv3d.get(),f,c.origin[1]);d.vec3.add(b.origin,g,m);d.vec3.add(b.origin,b.origin,a);e=d.vec3.scale(q.sv3d.get(),e,c.direction[0]);c=d.vec3.scale(q.sv3d.get(),f,c.direction[1]);d.vec3.scale(b.vector,d.vec3.add(e,e,c),2);return b}function L(a,c,d,b){a=
a.plane;r.fromVectorsAndPoint(a,c.direction,c.origin,d);r.fromVectorsAndPoint(d,a,c.origin,b)}Object.defineProperty(b,"__esModule",{value:!0});var M=k.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");n=function(){return function(){this.plane=r.create();this.origin=f.vec3f64.create();this.basis1=f.vec3f64.create();this.basis2=f.vec3f64.create()}}();b.BoundedPlaneClass=n;b.create=w;b.wrap=function(a,c,d){var b=U.get();b.origin=a;b.basis1=c;b.basis2=d;b.plane=r.fromVectorsAndPoint(d,c,a,
r.wrap(0,0,0,0));return b};b.copy=u;b.fromValues=y;b.elevate=m;b.setExtent=function(a,c,d){v(c,d);m(d,I(a,a.origin),d);return d};b.fromAABoundingRect=v;b.intersectRay=z;b.intersectRayClosestSilhouette=function(a,c,b){if(z(a,c,b))return b;a=B(a,c,q.sv3d.get());d.vec3.add(b,c.origin,d.vec3.scale(q.sv3d.get(),c.direction,d.vec3.distance(c.origin,a)/d.vec3.length(c.direction)));return b};b.closestPointOnSilhouette=B;b.closestPoint=C;b.projectPoint=function(a,c,b){var e=r.projectPoint(a.plane,c,q.sv3d.get());
c=p.projectPointClamp(J(a,a.basis1),e,-1,1,q.sv3d.get());e=p.projectPointClamp(J(a,a.basis2),e,-1,1,q.sv3d.get());d.vec3.subtract(b,d.vec3.add(q.sv3d.get(),c,e),a.origin);return b};b.projectPointLocal=D;b.distance2=K;b.distance=function(a,c){return Math.sqrt(K(a,c))};b.distanceToSilhouette=function(a,c){for(var d=Number.NEGATIVE_INFINITY,b=0,e=Y;b<e.length;b++){var f=N(a,e[b],S.get()),f=p.distance2(f,c);f>d&&(d=f)}return Math.sqrt(d)};b.extrusionContainsPoint=function(a,c){return r.isPointInside(a.plane,
c)&&Q(a,c)};b.axisAt=function(a,c,b,e){switch(b){case 0:d.vec3.copy(e,a.basis1);d.vec3.normalize(e,e);break;case 1:d.vec3.copy(e,a.basis2);d.vec3.normalize(e,e);break;case 2:d.vec3.copy(e,a.plane);break;default:l.neverReached(b)}return e};b.altitudeAt=I;b.setAltitudeAt=function(a,c,b,e){var f=I(a,c);a=d.vec3.scale(T,a.plane,b-f);d.vec3.add(e,c,a);return e};b.transform=function(a,c,b){a!==b&&u(a,b);g.mat4.invert(X,c);g.mat4.transpose(X,X);d.vec3.transformMat4(b.basis1,a.basis1,X);d.vec3.transformMat4(b.basis2,
a.basis2,X);d.vec3.transformMat4(b.plane,a.plane,X);d.vec3.transformMat4(b.origin,a.origin,c);r.setOffsetFromPoint(b.plane,b.origin,b.plane);return b};b.UP={plane:r.create(),origin:f.vec3f64.fromValues(0,0,0),basis1:f.vec3f64.fromValues(1,0,0),basis2:f.vec3f64.fromValues(0,1,0)};var R=new a.ObjectStack(r.create),S=new a.ObjectStack(p.create),T=f.vec3f64.create(),U=new a.ObjectStack(function(){return{origin:null,basis1:null,basis2:null,plane:null}}),Y=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],
direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],X=e.mat4f64.create()})},"esri/core/ObjectStack":function(){define(["require","exports","./nextTick"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){var b=this;this.allocator=a;this.items=[];this.itemsPtr=0;this.tickHandle=l.before(function(){return b.reset()});this.grow()}b.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.items=
null};b.prototype.get=function(){0===this.itemsPtr&&l(function(){});this.itemsPtr===this.items.length&&this.grow();return this.items[this.itemsPtr++]};b.prototype.reset=function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*k),this.items.length);this.itemsPtr=0};b.prototype.grow=function(){for(var a=0;a<Math.max(8,Math.min(this.items.length,k));a++)this.items.push(this.allocator())};return b}();b.ObjectStack=n;var k=1024;b.default=n})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),
function(n,b,l,k,h,a,g){function e(c){return c?{origin:a.vec3f64.clone(c.origin),vector:a.vec3f64.clone(c.vector)}:{origin:a.vec3f64.create(),vector:a.vec3f64.create()}}function d(a,c){var d=t.get();d.origin=a;d.vector=c;return d}function f(a,c,d){void 0===d&&(d=e());h.vec3.copy(d.origin,a);h.vec3.copy(d.vector,c);return d}function c(a,c){c=h.vec3.subtract(g.sv3d.get(),c,a.origin);var d=h.vec3.dot(a.vector,c),b=h.vec3.dot(a.vector,a.vector),d=l.clamp(d/b,0,1);a=h.vec3.subtract(g.sv3d.get(),h.vec3.scale(g.sv3d.get(),
a.vector,d),c);return h.vec3.dot(a,a)}function q(a,c,d,b,e){var f=a.vector,m=a.origin;c=h.vec3.subtract(g.sv3d.get(),c,m);m=h.vec3.length(f);c=h.vec3.dot(f,c)/m;h.vec3.scale(e,f,l.clamp(c,d,b));return h.vec3.add(e,e,a.origin)}function p(a,c,d,b){var e=a.origin,f=h.vec3.add(g.sv3d.get(),e,a.vector);a=c.origin;var p=h.vec3.add(g.sv3d.get(),a,c.vector),q=g.sv3d.get();c=g.sv3d.get();q[0]=e[0]-a[0];q[1]=e[1]-a[1];q[2]=e[2]-a[2];c[0]=p[0]-a[0];c[1]=p[1]-a[1];c[2]=p[2]-a[2];if(1E-6>Math.abs(c[0])&&1E-6>
Math.abs(c[1])&&1E-6>Math.abs(c[2]))return!1;p=g.sv3d.get();p[0]=f[0]-e[0];p[1]=f[1]-e[1];p[2]=f[2]-e[2];if(1E-6>Math.abs(p[0])&&1E-6>Math.abs(p[1])&&1E-6>Math.abs(p[2]))return!1;var f=q[0]*c[0]+q[1]*c[1]+q[2]*c[2],r=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],k=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],u=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*k-r*r;if(1E-6>Math.abs(u))return!1;q=(f*r-(q[0]*p[0]+q[1]*p[1]+q[2]*p[2])*k)/u;f=(f+r*q)/k;d&&(q=l.clamp(q,0,1),f=l.clamp(f,0,1));d=g.sv3d.get();r=g.sv3d.get();d[0]=e[0]+q*p[0];d[1]=e[1]+q*
p[1];d[2]=e[2]+q*p[2];r[0]=a[0]+f*c[0];r[1]=a[1]+f*c[1];r[2]=a[2]+f*c[2];b.tA=q;b.tB=f;b.pA=d;b.pB=r;b.distance2=h.vec3.squaredDistance(d,r);return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=e;b.wrap=d;b.copy=function(a,c){void 0===c&&(c=e());return f(a.origin,a.vector,c)};b.fromValues=f;b.fromPoints=function(a,c,d){void 0===d&&(d=e());h.vec3.copy(d.origin,a);h.vec3.subtract(d.vector,c,a);return d};b.distance2=c;b.distance=function(a,d){return Math.sqrt(c(a,d))};b.projectPoint=function(a,
c,d){return q(a,c,0,1,d)};b.projectPointClamp=q;b.closestRayDistance2=function(a,c){if(p(a,d(c.origin,c.direction),!1,r)){c=r.tA;var b=r.pB,e=r.distance2;if(0<=c&&1>=c)return e;if(0>c)return h.vec3.squaredDistance(a.origin,b);if(1<c)return h.vec3.squaredDistance(h.vec3.add(g.sv3d.get(),a.origin,a.vector),b)}return null};b.closestLineSegmentPoint=function(a,c,d){return p(a,c,!0,r)?(h.vec3.copy(d,r.pA),!0):!1};b.closestLineSegmentDistance2=function(a,c){return p(a,c,!0,r)?r.distance2:null};var r={tA:0,
tB:0,pA:a.vec3f64.create(),pB:a.vec3f64.create(),distance2:0},t=new k.ObjectStack(function(){return{origin:null,vector:null}})})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../stack"],function(n,b,l,k,h){function a(a){void 0===a&&(a=b.UP);return[a[0],a[1],a[2],a[3]]}function g(c,d){void 0===d&&(d=a());return e(c[0],c[1],c[2],c[3],d)}function e(c,d,b,e,f){void 0===f&&(f=a());f[0]=c;f[1]=d;
f[2]=b;f[3]=e;return f}function d(c,d,b){void 0===b&&(b=a());k.vec3.copy(b,d);d=k.vec3.dot(d,d);1E-5<Math.abs(d-1)&&1E-12<d&&k.vec3.scale(b,b,1/Math.sqrt(d));f(b,c,b);return b}function f(a,c,d){a!==d&&g(a,d);d[3]=-k.vec3.dot(d,c);return d}function c(c,b,e,f){void 0===f&&(f=a());c=k.vec3.cross(h.sv3d.get(),b,c);return d(e,c,f)}function q(a,c,d){a=k.vec3.scale(h.sv3d.get(),a,k.vec3.dot(a,c));k.vec3.subtract(d,c,a);return d}function p(a,c){return k.vec3.dot(a,c)+a[3]}function r(a,c,d,b,e,f){var g=k.vec3.dot(a,
d);if(0===g)return!1;a=-(k.vec3.dot(a,c)+a[3])/g;e&&(a=b?Math.max(0,a):l.clamp(a,0,1));if(0>a||!b&&1<a)return!1;k.vec3.add(f,c,k.vec3.scale(f,d,a));return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.wrap=function(a,c,d,b){return e(a,c,d,b,h.sv4d.get())};b.copy=g;b.fromValues=e;b.fromNormalAndOffset=function(c,d,b){void 0===b&&(b=a());k.vec3.copy(b,c);b[3]=d;return b};b.fromPositionAndNormal=d;b.fromPoints=function(d,b,e,f){void 0===f&&(f=a());return c(k.vec3.subtract(h.sv3d.get(),
d,b),k.vec3.subtract(h.sv3d.get(),e,b),d,f)};b.setOffsetFromPoint=f;b.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};b.fromVectorsAndPoint=c;b.intersectRay=function(a,c,d){return r(a,c.origin,c.direction,!0,!1,d)};b.intersectLineSegment=function(a,c,d){return r(a,c.origin,c.vector,!1,!1,d)};b.intersectLineSegmentClamp=function(a,c,d){return r(a,c.origin,c.vector,!1,!0,d)};b.isSphereFullyInside=function(a,c){var d=c.radius;return 0<=p(a,c.center)-d};b.isSphereFullyOutside=
function(a,c){var d=c.radius;return 0>p(a,c.center)+d};b.isPointInside=function(a,c){return 0<=p(a,c)};b.isPointOutside=function(a,c){return 0>p(a,c)};b.isAABBFullyInside=function(a,c){var d=c[0],b=c[1],e=c[2],f=c[3],g=c[4];c=c[5];return 0<=a[0]*(0<a[0]?d:f)+a[1]*(0<a[1]?b:g)+a[2]*(0<a[2]?e:c)+a[3]};b.clip=function(a,c){var d=k.vec3.dot(a,c.ray.direction);a=-p(a,c.ray.origin);if(0>a&&0<=d)return!1;if(-1E-6<d&&1E-6>d)return 0<a;if((0>a||0>d)&&!(0>a&&0>d))return!0;a/=d;0<d?a<c.c1&&(c.c1=a):a>c.c0&&
(c.c0=a);return c.c0<=c.c1};b.projectPoint=function(a,c,d){var b=k.vec3.scale(h.sv3d.get(),a,-a[3]);c=k.vec3.subtract(h.sv3d.get(),c,b);a=q(a,c,h.sv3d.get());k.vec3.add(d,a,b);return d};b.projectVector=q;b.distance=function(a,c){return Math.abs(p(a,c))};b.signedDistance=p;b.UP=[0,0,1,0]})},"esri/views/3d/support/geometryUtils/ray":function(){define("require exports ../../../../core/ObjectStack ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),
function(n,b,l,k,h,a,g,e){function d(a){return a?{origin:g.vec3f64.clone(a.origin),direction:g.vec3f64.clone(a.direction)}:{origin:g.vec3f64.create(),direction:g.vec3f64.create()}}function f(c,b,e){void 0===e&&(e=d());a.vec3.copy(e.origin,c);a.vec3.copy(e.direction,b);return e}function c(c,b,f){void 0===f&&(f=d());var g=k.castRenderScreenPointArray3(h.vec2.copy(e.sv3d.get(),b));g[2]=0;c.unprojectPoint(g,f.origin);b=k.castRenderScreenPointArray3(h.vec2.copy(e.sv3d.get(),b));b[2]=1;c=c.unprojectPoint(b,
e.sv3d.get());a.vec3.subtract(f.direction,c,f.origin);return f}function q(c,b,f){void 0===f&&(f=d());a.vec3.copy(f.origin,c.eye);b=a.vec3.set(e.sv3d.get(),b[0],b[1],1);c=c.unprojectPoint(b,e.sv3d.get());a.vec3.subtract(f.direction,c,f.origin);return f}function p(c,d){c=a.vec3.cross(e.sv3d.get(),a.vec3.normalize(e.sv3d.get(),c.direction),a.vec3.subtract(e.sv3d.get(),d,c.origin));return a.vec3.dot(c,c)}function r(){return{origin:null,direction:null}}Object.defineProperty(b,"__esModule",{value:!0});
b.create=d;b.wrap=function(a,c){var d=t.get();d.origin=a;d.direction=c;return d};b.copy=function(a,c){void 0===c&&(c=d());return f(a.origin,a.direction,c)};b.fromPoints=function(c,b,e){void 0===e&&(e=d());a.vec3.copy(e.origin,c);a.vec3.subtract(e.direction,b,c);return e};b.fromValues=f;b.fromScreen=function(a,b,f){void 0===f&&(f=d());return c(a,a.screenToRender(b,k.castRenderScreenPointArray3(e.sv3d.get())),f)};b.fromRender=c;b.fromScreenAtEye=function(a,c,b){void 0===b&&(b=d());return q(a,a.screenToRender(c,
k.castRenderScreenPointArray3(e.sv3d.get())),b)};b.fromRenderAtEye=q;b.distance2=p;b.distance=function(a,c){return Math.sqrt(p(a,c))};b.closestPoint=function(c,d,b){d=a.vec3.dot(c.direction,a.vec3.subtract(b,d,c.origin));a.vec3.add(b,c.origin,a.vec3.scale(b,c.direction,d));return b};b.createWrapper=r;var t=new l.ObjectStack(r)})},"esri/views/3d/support/geometryUtils/frustum":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../stack ./clipRay ./plane".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){function q(d){if(d){var b=d.planes;d=d.points;return{planes:[c.create(b[0]),c.create(b[1]),c.create(b[2]),c.create(b[3]),c.create(b[4]),c.create(b[5])],points:[a.vec3f64.clone(d[0]),a.vec3f64.clone(d[1]),a.vec3f64.clone(d[2]),a.vec3f64.clone(d[3]),a.vec3f64.clone(d[4]),a.vec3f64.clone(d[5]),a.vec3f64.clone(d[6]),a.vec3f64.clone(d[7])]}}return{planes:[c.create(),c.create(),c.create(),c.create(),c.create(),c.create()],points:[a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),
a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create()]}}function p(a,d,b){void 0===b&&(b=q());for(var e=0;6>e;e++)c.copy(a[e],b.planes[e]);for(e=0;8>e;e++)h.vec3.copy(b.points[e],d[e]);return b}function r(a){var d=a.planes;a=a.points;c.fromPoints(a[4],a[0],a[3],d[0]);c.fromPoints(a[1],a[5],a[6],d[1]);c.fromPoints(a[4],a[5],a[1],d[2]);c.fromPoints(a[3],a[2],a[6],d[3]);c.fromPoints(a[0],a[1],a[2],d[4]);c.fromPoints(a[5],a[4],a[7],d[5])}function t(a,d){for(var b=
0;6>b;b++)if(!c.clip(a[b],d))return!1;return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=q;b.copy=function(a,c){void 0===c&&(c=q());return p(a.planes,a.points,c)};b.fromValues=p;b.fromMatrix=function(a,c,b){void 0===b&&(b=q());var e=b.points;a=k.mat4.multiply(d.sm4d.get(),c,a);k.mat4.invert(a,a);for(c=0;8>c;++c){var f=g.vec4.transformMat4(d.sv4d.get(),x[c],a);h.vec3.set(e[c],f[0]/f[3],f[1]/f[3],f[2]/f[3])}r(b);return b};b.recomputePlanes=r;b.intersectsSphere=function(a,d){for(var b=
0;6>b;b++)if(c.isSphereFullyInside(a[b],d))return!1;return!0};b.intersectsRay=function(a,c){return t(a,f.fromRay(c,w.get()))};b.intersectsLineSegment=function(a,c,d){return t(a,f.fromLineSegmentAndDirection(c,d,w.get()))};b.intersectsPoint=function(a,d){for(var b=0;6>b;b++)if(0<c.signedDistance(a[b],d))return!1;return!0};b.intersectsAABB=function(a,d){for(var b=0;6>b;b++)if(c.isAABBFullyInside(a[b],d))return!1;return!0};b.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,
6,2],left:[4,0,3,7],top:[7,3,2,6]};var x=[e.vec4f64.fromValues(-1,-1,-1,1),e.vec4f64.fromValues(1,-1,-1,1),e.vec4f64.fromValues(1,1,-1,1),e.vec4f64.fromValues(-1,1,-1,1),e.vec4f64.fromValues(-1,-1,1,1),e.vec4f64.fromValues(1,-1,1,1),e.vec4f64.fromValues(1,1,1,1),e.vec4f64.fromValues(-1,1,1,1)],w=new l.ObjectStack(f.create)})},"esri/views/3d/support/geometryUtils/clipRay":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../stack ./ray".split(" "),
function(n,b,l,k,h,a){function g(c){return c?{ray:a.create(c.ray),c0:c.c0,c1:c.c1}:{ray:a.create(),c0:0,c1:Number.MAX_VALUE}}function e(c,d,b,e){void 0===e&&(e=g());a.copy(c,e.ray);e.c0=d;e.c1=b;return e}function d(c,d,b){void 0===b&&(b=g());var e=k.vec3.length(c.vector);a.fromValues(c.origin,d,b.ray);b.c0=0;b.c1=e;return b}Object.defineProperty(b,"__esModule",{value:!0});b.create=g;b.wrap=function(a,d,b){var c=f.get();c.ray=a;c.c0=d;c.c1=b;return c};b.copy=function(a,d){void 0===d&&(d=g());return e(a.ray,
a.c0,a.c1,d)};b.fromValues=e;b.fromRay=function(c,d){void 0===d&&(d=g());a.copy(c,d.ray);d.c0=0;d.c1=Number.MAX_VALUE;return d};b.fromLineSegment=function(a,b){void 0===b&&(b=g());var c=k.vec3.normalize(h.sv3d.get(),a.vector);return d(a,c,b)};b.fromLineSegmentAndDirection=d;var f=new l.ObjectStack(function(){return{c0:0,c1:0,ray:null}})})},"esri/views/3d/support/geometryUtils/sphere":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../geometryUtils ../mathUtils ../stack ./ray".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){function r(a){return a?{radius:a.radius,center:d.vec3f64.clone(a.center)}:{radius:1,center:d.vec3f64.create()}}function t(a,c){void 0===c&&(c=r());return x(a.radius,a.center,c)}function x(a,c,d){void 0===d&&(d=r());e.vec3.copy(d.center,c);d.radius=a;return d}function w(a,c,d){var b=e.vec3.subtract(q.sv3d.get(),c.origin,a.center),f=e.vec3.dot(c.direction,c.direction),g=2*e.vec3.dot(c.direction,b);a=e.vec3.dot(b,b)-a.radius*a.radius;a=g*g-4*f*a;if(0>a)return!1;b=
Math.sqrt(a);a=(-g-b)/(2*f);f=(-g+b)/(2*f);if(0>a||f<a&&0<f)a=f;if(0>a)return!1;d&&e.vec3.add(d,c.origin,e.vec3.scale(q.sv3d.get(),c.direction,a));return!0}function u(a,c,d){var b=q.sv3d.get(),h=q.sm4d.get();e.vec3.cross(b,c.origin,c.direction);e.vec3.cross(d,b,c.origin);e.vec3.scale(d,d,1/e.vec3.length(d)*a.radius);a=m(a,c.origin);c=f.vector.angle(c.origin,d);g.mat4.identity(h);g.mat4.rotate(h,h,c+a,b);e.vec3.transformMat4(d,d,h);return d}function y(a,c,d){c=e.vec3.subtract(q.sv3d.get(),c,a.center);
c=e.vec3.scale(q.sv3d.get(),c,a.radius/e.vec3.length(c));return e.vec3.add(d,c,a.center)}function m(a,c){c=e.vec3.subtract(q.sv3d.get(),c,a.center);c=e.vec3.length(c);return h.acosClamped(a.radius/(a.radius+Math.abs(a.radius-c)))}function v(a,d,b,f){a=e.vec3.subtract(C,d,a.center);switch(b){case 0:return a=c.cartesianToSpherical(a,C),a=a[2],e.vec3.set(f,-Math.sin(a),Math.cos(a),0);case 1:return a=c.cartesianToSpherical(a,C),b=a[1],a=a[2],d=Math.sin(b),e.vec3.set(f,-d*Math.cos(a),-d*Math.sin(a),Math.cos(b));
case 2:return e.vec3.normalize(f,a);default:l.neverReached(b)}}function z(a,c){c=e.vec3.subtract(Q,c,a.center);return e.vec3.length(c)-a.radius}Object.defineProperty(b,"__esModule",{value:!0});var B=k.getLogger("esri.views.3d.support.geometryUtils.sphere");b.create=r;b.wrap=function(a,c){var d=D.get();d.radius=a;d.center=c||I;return d};b.copy=t;b.fromValues=x;b.elevate=function(a,c,d){a!==d&&e.vec3.copy(d.center,a.center);d.radius=a.radius+c;return d};b.setExtent=function(a,c,d){B.error("sphere.setExtent is not yet supported");
return a===d?d:t(a,d)};b.intersectRay=w;b.intersectScreen=function(a,c,d,b){c=p.fromScreenAtEye(c,d,K);return w(a,c,b)};b.intersectsRay=function(a,c){return w(a,c,null)};b.intersectRayClosestSilhouette=function(a,c,d){if(w(a,c,d))return d;a=u(a,c,q.sv3d.get());e.vec3.add(d,c.origin,e.vec3.scale(q.sv3d.get(),c.direction,e.vec3.distance(c.origin,a)/e.vec3.length(c.direction)));return d};b.closestPointOnSilhouette=u;b.closestPoint=function(a,c,d){if(w(a,c,d))return d;p.closestPoint(c,a.center,d);return y(a,
d,d)};b.projectPoint=y;b.distanceToSilhouette=function(a,c){c=e.vec3.subtract(q.sv3d.get(),c,a.center);c=e.vec3.squaredLength(c);return Math.sqrt(Math.abs(c-a.radius*a.radius))};b.angleToSilhouette=m;var C=d.vec3f64.create();b.axisAt=v;b.altitudeAt=z;b.setAltitudeAt=function(a,c,d,b){var f=z(a,c);a=v(a,c,2,Q);d=e.vec3.scale(Q,a,d-f);e.vec3.add(b,c,d);return b};var D=new a.ObjectStack(function(){return{center:null,radius:0}}),K=p.create(),I=d.vec3f64.create(),Q=d.vec3f64.create();Object.freeze(I)})},
"esri/views/3d/support/geometryUtils/triangle":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack ./lineSegment".split(" "),function(n,b,l,k,h,a,g,e){function d(c){return c?{p0:a.vec3f64.clone(c.p0),p1:a.vec3f64.clone(c.p1),p2:a.vec3f64.clone(c.p2)}:{p0:a.vec3f64.create(),p1:a.vec3f64.create(),p2:a.vec3f64.create()}}function f(a,c,b,e){void 0===e&&(e=d());h.vec3.copy(e.p0,
a);h.vec3.copy(e.p1,c);h.vec3.copy(e.p2,b);return e}function c(a,c,d){var b=k.vec2.distance(a,c);c=k.vec2.distance(c,d);a=k.vec2.distance(d,a);d=(b+c+a)/2;b=d*(d-b)*(d-c)*(d-a);return 0>=b?0:Math.sqrt(b)}Object.defineProperty(b,"__esModule",{value:!0});b.create=d;b.wrap=function(a,c,d){var b=p.get();b.p0=a;b.p1=c;b.p2=d;return b};b.copy=function(a,c){void 0===c&&(c=d());return f(a.p0,a.p1,a.p2,c)};b.fromValues=f;b.distance2=function(a,c){var d=a.p0,b=a.p1;a=a.p2;var f=h.vec3.subtract(g.sv3d.get(),
b,d),p=h.vec3.subtract(g.sv3d.get(),a,b),m=h.vec3.subtract(g.sv3d.get(),d,a),v=h.vec3.subtract(g.sv3d.get(),c,d),r=h.vec3.subtract(g.sv3d.get(),c,b),k=h.vec3.subtract(g.sv3d.get(),c,a),t=h.vec3.cross(f,f,m),l=h.vec3.dot(h.vec3.cross(g.sv3d.get(),f,t),v),r=h.vec3.dot(h.vec3.cross(g.sv3d.get(),p,t),r),k=h.vec3.dot(h.vec3.cross(g.sv3d.get(),m,t),k);if(0<l&&0<r&&0<k)return c=h.vec3.dot(t,v),c*c/h.vec3.dot(t,t);d=e.distance2(e.fromValues(d,f,q.get()),c);b=e.distance2(e.fromValues(b,p,q.get()),c);c=e.distance2(e.fromValues(a,
m,q.get()),c);return Math.min(d,b,c)};b.intersectRay=function(a,c,d){var b=c.direction;c=c.origin;var e=a.p0,f=a.p1,g=a.p2,p=f[0]-e[0],q=f[1]-e[1],r=f[2]-e[2],f=g[0]-e[0];a=g[1]-e[1];var g=g[2]-e[2],k=b[1]*g-a*b[2],t=b[2]*f-g*b[0],x=b[0]*a-f*b[1],l=p*k+q*t+r*x;if(-1E-5<l&&1E-5>l)return!1;var l=1/l,n=c[0]-e[0],J=c[1]-e[1],e=c[2]-e[2],k=l*(n*k+J*t+e*x);if(0>k||1<k)return!1;t=J*r-q*e;r=e*p-r*n;p=n*q-p*J;q=l*(b[0]*t+b[1]*r+b[2]*p);if(0>q||1<k+q)return!1;d&&(h.vec3.scale(d,b,l*(f*t+a*r+g*p)),h.vec3.add(d,
c,d));return!0};b.areaPoints2d=c;b.area2d=function(a){return c(a.p0,a.p1,a.p2)};var q=new l.ObjectStack(e.create),p=new l.ObjectStack(function(){return{p0:null,p1:null,p2:null}})})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","./Util"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(b,e,d,f){void 0===e&&(e=a.DefaultIndices);void 0===d&&(d=a.DefaultOffsets);void 0===f&&(f=
"triangle");this.preinterleaved=!1;var c={},g;for(g in b){var p=b[g],r=p.size;c[g]={data:p.data,size:r,offsetIdx:0,strideIdx:r}}if(e===a.DefaultIndices){e=h.getFirstObjectValue(c);e=null==e?0:e.data.length/e.size;b=k.generateDefaultIndexArray(e);e={};for(var t in c)e[t]=b}this._id=k.getNewId();this._vertexAttributes=c;this._indices=e;this._componentOffsets=l.createOffsets(d);this._primitiveType=f}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexCount",{get:function(){var a=h.getFirstObjectValue(this._indices);return null==a?0:
a.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});a.prototype.getVertexAttr=function(){return this.vertexAttributes};a.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}};a.prototype.getIndices=function(a){return this._indices[a]};a.prototype.getAttribute=function(a){return this._vertexAttributes[a]};
a.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices[h.VertexAttrConstants.POSITION]&&(a+=12*this._indices[h.VertexAttrConstants.POSITION].length);this._indices[h.VertexAttrConstants.NORMAL]&&(a+=12*this._indices[h.VertexAttrConstants.NORMAL].length);this._indices[h.VertexAttrConstants.UV0]&&(a+=8*this._indices[h.VertexAttrConstants.UV0].length);this._indices[h.VertexAttrConstants.COLOR]&&(a+=4*this._indices[h.VertexAttrConstants.COLOR].length);return a};a.DefaultIndices={};a.DefaultOffsets=
new Uint32Array(0);return a}();b.GeometryData=n})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/maybe"],function(n,b,l,k){function h(a,c){if(null!=a){var d=a.isVisibleBit,b=a.data,e=8*b.BYTES_PER_ELEMENT;return c<b.length*e?r(d,b,c,e):!a.isVisibleBit}return!0}function a(a){return k.isSome(a.component)?a.component:-1}function g(a,c,d,b,f){h(c,b)&&e(a,c,d,d[b],d[b+1]-1,f)}function e(a,c,d,b,e,f){d=(c=0<a.length?
a[a.length-1]:null)?c.range[1]:-1;var g=c?c.options:null;d>=b||(d+1===b&&g===f?c.range[1]=e:a.push({range:[b,e],options:f}))}function d(a){void 0===a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}function f(a,c){return q(a,c,!0)}function c(a,c){return q(a,c,!1)}function q(a,c,d){var b=!1;a=a||x;b=a.isVisibleBit;a=a.data;c=t(c);var e=8*a.BYTES_PER_ELEMENT,f=a.length*e;d=d===b;if(0===a.length||0===c)b=!d;else if(f<c&&!d)b=!0;else{for(var g=w[e],f=w[0],m=0;m<a.length-1;m++)if(b=!d&&a[m]!==
g||d&&a[m]!==f)return b;b=a.length-1;c=w[(c-1)%e+1];b=!d&&(a[b]&c)!==c||d&&(a[b]&c)!==f}return b}function p(a){return 0<a.length}function r(a,c,d,b){var e=d/b|0;return 0!==(c[e]&1<<d-e*b)===a}function t(a){return Math.max(0,a.length-1)}Object.defineProperty(b,"__esModule",{value:!0});b.updateVisibility=function(a,c,b,e){if(b<t(c)){null==a&&(a=d());var f=a.isVisibleBit,g=a.data,m=8*g.BYTES_PER_ELEMENT,h=b/m|0,p=b-m*h;c=(t(c)-1)/m|0;var q=g;e=e===f;b<q.length*m||!e||(b=Math.max(h+1,Math.ceil(1.5*q.length)),
b=Math.min(b,c+1),g=new Uint32Array(b),g.set(q));h<g.length&&(g[h]=g[h]&~(1<<p)|(e?1:0)<<p);a.data=g}return a};b.getVisibility=h;b.hideAllComponents=function(a){if(null==a)a=d(!1);else{a.isVisibleBit=!0;for(var c=0;c<a.data.length;c++)a.data[c]=0}return a};b.unhideAllComponents=function(a){var c;if(null!=a)for(c=a,c.isVisibleBit=!1,a=0;a<c.data.length;a++)c.data[a]=0;return c};b.generateVisibleIndexRanges=function(a,c){var d;if(a)if(p(c))if(0===a.data.length)d=[],c=[[c[0],c[c.length-1]-1]],d=a.isVisibleBit?
d:c;else{d=[];for(var b=a.isVisibleBit,e=a.data,f=8*e.BYTES_PER_ELEMENT,g=e.length*f,h=t(c),q=!1,k=0;k<g&&k<h;k++){var y=r(b,e,k,f);if(y!==q){var u=c[k];y?d.push([u,0]):(q=d[d.length-1],q[1]=u-1);q=y}}a=!a.isVisibleBit;h>g&&a&&!q?d.push([c[g],c[h]-1]):q&&(q=d[d.length-1],q[1]=c[a?h:Math.min(h,g)]-1)}else d=[],d=a.isVisibleBit?d:null;else d=null;return d};b.addHighlight=function(c,d,b,e){c=c||[];d={component:d,options:b,id:e};c.push(d);b=a(d);for(e=c.length-1;0<e&&b<a(c[e-1]);)d=[c[e],c[e-1]],c[e-
1]=d[0],c[e]=d[1],--e;return c};b.removeHighlight=function(a,c){if(!a)return a;a=a.filter(function(a){return a.id!==c});return 0===a.length?null:a};b.generateHighlightedIndexRanges=function(a,d,b){if(!d)return null;if(!p(b))return a&&a.isVisibleBit?null:d.map(function(a){return{range:null,options:a.options}});for(var f=b[0],m=b[b.length-1]-1,h=[],q=!c(a,b),r=0;r<d.length;++r){var y=d[r].options,u=d[r].component;if(k.isSome(u))g(h,a,b,u,y);else if(q)e(h,a,b,f,m,y);else for(u=0;u<t(b);++u)g(h,a,b,u,
y)}return 0<h.length?h:null};b.hasHighlights=function(a,d,b){if(!d)return!1;if(!p(b))return a&&a.isVisibleBit?!1:0<d.length;a=!c(a,b);for(var e=0;e<d.length;e++)if(k.isSome(d[e].component)||a||0<t(b))return!0;return!1};b.defaultVisibilities=d;b.isAllVisible=function(a,d){return!c(a,d)};b.isAllHidden=function(a,c){return!f(a,c)};b.hasVisible=f;b.hasHidden=c;var x=d();b.createOffsets=function(a){return Array.isArray(a)?new Uint32Array(a):a};b.hasComponent=function(a,c){return c<t(a)};b.hasComponents=
p;var w=[];for(n=0;65>n;n++)w.push(Math.pow(2,n)-1);b.componentCount=t;b.componentFind=function(a,c){a=l.binaryIndexOf(a,c,!0);return 0<=a?a:null}})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});var l=1,k=null,h=new Uint32Array([0]);b.generateDefaultIndexArray=function(a){if(1===a)return h;if(a>l||null==k){for(;a>l;)l*=2;k=new Uint32Array(l);for(var b=0;b<l;b++)k[b]=b}return new Uint32Array(k.buffer,
0,a)};var a=0;b.getNewId=function(){return a++}})},"esri/views/3d/webgl-engine/lib/Util":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),function(n,b,l,k,h,a,g,e,d){function f(a,c){if(!a)throw c=c||"assert",a=Error(c),a.stack&&console.log(a.stack),
new x(c);}function c(a){for(var c in a)return c}function q(a,c){a[12]=c[0];a[13]=c[1];a[14]=c[2]}function p(a,c){void 0===c&&(c=0);for(var d=0,b=0;4>b;b++)d+=a[c+b]*u[b];return d}function r(a){return a-Math.floor(a)}Object.defineProperty(b,"__esModule",{value:!0});var t=d.vec4f64.create(),x=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};return a}();b.AssertException=x;b.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",
UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex",TANGENT:"aTangent"};b.assert=f;b.verify=function(a,c){a||console.warn("Verify failed: "+(c||"")+"\n"+Error("verify").stack)};b.encodeInt16=function(a){return l.clamp(Math.round(32767*a),-32767,32767)};b.encodeNormal=function(a,c){var d=Math.abs(a[0]),b=Math.abs(a[1]),e=1/(d+b+Math.abs(a[2])),f=Math.min(a[2]*e,0);c[0]=(0>a[0]?-1:1)*(d*e-f);c[1]=(0>a[1]?-1:
1)*(b*e-f)};b.fallbackIfUndefined=function(a,c){return void 0===a?c:a};b.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};b.rgb2hex=function(a){var c=l.clamp(Math.round(255*a[0]),0,255),d=l.clamp(Math.round(255*a[1]),0,255);a=l.clamp(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(d<<8)+a).toString(16)};b.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};b.rayTriangle3D=function(a,c,d,b,e,f,h,p,q){void 0===q&&(q=g.vec3f64.create());
var m=b[h]-d[f],r=b[h+1]-d[f+1],k=b[h+2]-d[f+2];b=e[p]-d[f];h=e[p+1]-d[f+1];e=e[p+2]-d[f+2];var v=c[1]*e-h*c[2],z=c[2]*b-e*c[0],t=c[0]*h-b*c[1];p=m*v+r*z+k*t;if(-1E-5<p&&1E-5>p)return!1;p=1/p;var y=a[0]-d[f],u=a[1]-d[f+1];a=a[2]-d[f+2];q[1]=p*(y*v+u*z+a*t);if(0>q[1]||1<q[1])return!1;d=u*k-r*a;a=a*m-k*y;m=y*r-m*u;q[2]=p*(c[0]*d+c[1]*a+c[2]*m);if(0>q[2]||1<q[1]+q[2])return!1;q[0]=p*(b*d+h*a+e*m);return!0};b.rayBoxTest=function(a,c,d,b){var e,f=(d[0]-a[0])/c[0],g=(b[0]-a[0])/c[0];f>g&&(e=f,f=g,g=e);
var m=(d[1]-a[1])/c[1],h=(b[1]-a[1])/c[1];m>h&&(e=m,m=h,h=e);if(f>h||m>g)return!1;m>f&&(f=m);h<g&&(g=h);d=(d[2]-a[2])/c[2];a=(b[2]-a[2])/c[2];d>a&&(e=d,d=a,a=e);if(f>a||d>g)return!1;a<g&&(g=a);return 0>g?!1:!0};b.rayRay2D=function(c,d,b,e,f,g){void 0===g&&(g=a.vec2f64.create());var m=(e[f]-b[f])*(d[0]-c[0])-(e[0]-b[0])*(d[f]-c[f]);if(0===m)return!1;b=((e[0]-b[0])*(c[f]-b[f])-(e[f]-b[f])*(c[0]-b[0]))/m;g[0]=c[0]+b*(d[0]-c[0]);g[1]=c[f]+b*(d[f]-c[f]);return!0};b.project=function(a,c,d,b,g){g||(g=a);
t[0]=a[0];t[1]=a[1];t[2]=a[2];t[3]=1;e.vec4.transformMat4(t,t,c);2<g.length&&(g[2]=-t[2]);e.vec4.transformMat4(t,t,d);f(0!==t[3]);g[0]=t[0]/t[3];g[1]=t[1]/t[3];g[2]=t[2]/t[3];g[0]=(.5*g[0]+.5)*b[2]+b[0];g[1]=(.5*g[1]+.5)*b[3]+b[1]};b.getFirstObjectKey=c;b.getFirstObjectValue=function(a){return a[c(a)]};b.objectEmpty=function(a){for(var c in a)return!1;return!0};b.logWithBase=function(a,c){return Math.log(a)/Math.log(c)};b.setMatrixTranslation=q;b.setMatrixTranslation3=function(a,c,d,b){a[12]=c;a[13]=
d;a[14]=b};b.getMatrixTranslation=function(a,c){void 0===c&&(c=g.vec3f64.create());c[0]=a[12];c[1]=a[13];c[2]=a[14];return c};b.createTranslationMatrix=function(a,c){a=k.mat4.identity(a);q(a,c);return a};b.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};b.fovx2fovy=function(a,c,d){return 2*Math.atan(d*Math.tan(.5*a)/c)};b.fovy2fovx=function(a,c,d){return 2*Math.atan(c*Math.tan(.5*
a)/d)};b.fovx2fovd=function(a,c,d){return 2*Math.atan(Math.sqrt(c*c+d*d)*Math.tan(.5*a)/c)};b.fovy2fovd=function(a,c,d){return 2*Math.atan(Math.sqrt(c*c+d*d)*Math.tan(.5*a)/d)};b.fovd2fovx=function(a,c,d){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(c*c+d*d))};b.fovd2fovy=function(a,c,d){return 2*Math.atan(d*Math.tan(.5*a)/Math.sqrt(c*c+d*d))};b.packFloatRGBA=function(a,c,d){void 0===d&&(d=0);a=l.clamp(a,0,y);for(var b=0;4>b;b++)c[d+b]=Math.floor(256*r(a*w[b]))};b.unpackFloatRGBA=p;var w=[1,256,
65536,16777216],u=[1/256,1/65536,1/16777216,1/4294967296],y=p(new Uint8ClampedArray([255,255,255,255]));b.inverseProjectionInfo=function(a,c,d,b,e){0===a[11]?(b[0]=2/(c*a[0]),b[1]=2/(d*a[5]),b[2]=(1+a[12])/a[0],b[3]=(1+a[13])/a[5],h.vec2.set(e,0,1)):(b[0]=-2/(c*a[0]),b[1]=-2/(d*a[5]),b[2]=(1-a[8])/a[0],b[3]=(1-a[9])/a[5],h.vec2.set(e,1,0))}})},"esri/views/3d/webgl-engine/shaders/SimpleAtmospherePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver",
"../../../webgl/programUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});b.colorPass={name:"simple-atmosphere-color",shaders:function(a){return{vertexShader:h.glslifyDefineMap({PANORAMIC:a.panoramic})+k.resolveIncludes("environment/simpleAtmosphere.vert"),fragmentShader:h.glslifyDefineMap({PANORAMIC:a.panoramic})+k.resolveIncludes("environment/simpleAtmosphere.frag")}},attributes:l.Default3D};b.fadePass={name:"simple-atmosphere-fade",shaders:{vertexShader:k.resolveIncludes("environment/simpleAtmosphereFade.vert"),
fragmentShader:k.resolveIncludes("environment/simpleAtmosphereFade.frag")},attributes:l.Default3D}})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,aTangent:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,
modelOriginLo:15}})},"esri/views/3d/webgl-engine/shaders/sources/resolver":function(){define(["require","exports","./shaderRepository","../../../../webgl/ShaderCompiler"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});var h=new k(function(a){var b=l;a.split("/").forEach(function(a){b&&(b=b[a])});return b});b.resolveIncludes=function(a){return h.resolveIncludes(a)}})},"esri/views/3d/webgl-engine/shaders/sources/shaderRepository":function(){define(["require","exports"],function(n,
b){return{edgeRenderer:{"adjustProjectedPosition.glsl":"uniform vec2 uDepthBias;\nuniform vec2 uViewportDimInv;\nbool isNaN(float val) {\n  return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\n}\nvec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\n  float offsetXY \x3d uDepthBias.x;\n  float offsetZ  \x3d uDepthBias.y;\n  vec4 projNormal \x3d uProj * uView * vec4(worldNormal, 0.0);\n  return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n}\nfloat calculateProjectedBiasZ(vec4 projPos) {\n  float offsetZ \x3d uDepthBias.y;\n  return sqrt(projPos.z) * offsetZ;\n}\nvec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n  vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\n  if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\n    projPos.xy +\x3d offsetXY;\n  }\n  projPos.z +\x3d calculateProjectedBiasZ(projPos);\n  return projPos;\n}",
"edgeRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvarying vec4 vColor;\nvarying float vRadius;\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vLineLengthPixels;\nvarying float vSizeFalloffFactor;\nvarying float vLineIndex;\n#define COVERAGE_TEST_THRESHOLD 0.01\n#include \x3cedgeRenderer/lineOffset.glsl\x3e\nvec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n  float lineOffset \x3d calculateLineOffset();\n  float positionX \x3d position.x - lineOffset;\n  if (radius \x3c 1.0) {\n    float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n    float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n    float coverage \x3d min(coverageX, coverageY);\n    return vec2(0.5 - coverage, 0.0);\n  }\n  else {\n    float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\n    vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\n    return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n  }\n}\nvoid main() {\n  float radius \x3d vRadius * calculateLinePressure();\n  vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n  float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\n#ifdef ANTIALIASING\n  const float coverageLimit \x3d COVERAGE_TEST_THRESHOLD;\n#else\n  float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\n#endif\n  if (coverage \x3c coverageLimit) {\n    discard;\n  }\n  discardBySlice(vWorldPosition);\n  float alpha \x3d vColor.a * coverage;\n  gl_FragColor \x3d vec4(vColor.rgb, alpha);\n}",
"edgeRenderer.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nuniform mat4 uProj;\nuniform mat4 uView;\nuniform mat4 uModel;\nuniform vec3 uCameraPosition;\nuniform vec2 uPixelToNDC;\nuniform vec2 uNDCToPixel;\nuniform float uPixelRatio;\nattribute vec3 aPosition0;\nattribute vec3 aPosition1;\nattribute float aVariantOffset;\nattribute float aVariantStroke;\nattribute float aVariantExtension;\n#ifdef SILHOUETTE\nattribute vec3 aNormalA;\nattribute vec3 aNormalB;\n#else\nattribute vec3 aNormal;\n#endif\nattribute vec2 aSideness;\nattribute vec2 aPackedAttributes;\nstruct UnpackedAttributes {\nvec2 sideness;\nvec2 sidenessNorm;\nfloat lineWidthPixels;\nfloat extensionLengthPixels;\n#if (MODE \x3d\x3d MODE_UBER)\nfloat type;\n#endif\n};\nvarying vec4 vColor;\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vRadius;\nvarying float vLineLengthPixels;\nvarying float vSizeFalloffFactor;\n#include \x3cedgeRenderer/adjustProjectedPosition.glsl\x3e\n#include \x3cedgeRenderer/styleOutputs.glsl\x3e\n#include \x3cedgeRenderer/lineAmplitude.glsl\x3e\n#include \x3cedgeRenderer/util.glsl\x3e\nconst float opaqueCutoff \x3d 1.0 / 255.0;\nvec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  vec2 sideness \x3d unpackedAttributes.sideness;\n  vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n  vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n  vec4 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\n  vec4 projPosV0 \x3d uProj * viewPosV0;\n  vec4 projPosV1 \x3d uProj * viewPosV1;\n  vec4 projPos \x3d uProj * viewPos;\n  vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n  vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\n  float lineLengthPixels \x3d length(screenSpaceLinePixels);\n  float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\n  vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n  float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n  float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\n  float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n  float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n  vSizeFalloffFactor \x3d falloffFactor;\n  float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n  float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n#ifdef ANTIALIASING\n  const float aaPaddingPixels \x3d 1.0;\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n  float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\n  float aaPaddedLineLengthPixels \x3d extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\n  float halfAAPaddedLineLengthPixels \x3d aaPaddedLineLengthPixels * 0.5;\n#else\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n  float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\n  float halfAAPaddedLineLengthPixels \x3d max(extendedLineLengthPixels, 1.0) * 0.5;\n#endif\n  vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n  vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\n  vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\n  vec2 ndcOffset \x3d (\n      screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n    + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n  );\n  projPos.xy +\x3d ndcOffset * projPos.w;\n  projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n  projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n  float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n  float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n  vPosition \x3d vec3(\n    halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n    pixelPositionAlongLine,\n    pixelPositionAlongLine / extendedLineLengthPixels\n  );\n  vRadius \x3d lineWidthPixels * 0.5;\n  vLineLengthPixels \x3d extendedLineLengthPixels;\n#ifdef SILHOUETTE\n  gl_Position \x3d isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10.0, 10.0, 10.0, 1.0);\n#else\n  gl_Position \x3d projPos;\n#endif\n  if (vColor.a \x3c opaqueCutoff) {\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n  }\n#if (MODE \x3d\x3d MODE_UBER)\n  if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) {\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n  }\n#elif (MODE \x3d\x3d MODE_SKETCH)\n  if (lineLengthPixels \x3c\x3d 3.0) {\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n  }\n#endif\n  return projPos;\n}\n#if (MODE \x3d\x3d MODE_UBER)\nUnpackedAttributes unpackAttributes(ComponentData component) {\n  vec2 sidenessNorm \x3d aSideness;\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n  float fType \x3d component.type;\n  float extensionLengthPixels \x3d component.extensionLength;\n  float lineWidth \x3d component.lineWidth;\n  if (fType \x3c\x3d 0.0) {\n    extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\n  }\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n}\n#else\nUnpackedAttributes unpackAttributes(ComponentData component) {\n  vec2 sidenessNorm \x3d aSideness;\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n  float extensionLengthPixels \x3d component.extensionLength;\n#if (MODE \x3d\x3d MODE_SKETCH)\n  extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\n#endif\n  float lineWidth \x3d component.lineWidth;\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n}\n#endif\nvoid main() {\n  ComponentData component \x3d readComponentData();\n  UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\n  vec4 worldPosV0 \x3d uModel * vec4(aPosition0, 1.0);\n  vec4 worldPosV1 \x3d uModel * vec4(aPosition1, 1.0);\n  vec4 viewPosV0 \x3d uView * worldPosV0;\n  vec4 viewPosV1 \x3d uView * worldPosV1;\n#ifdef SILHOUETTE\n  vec3 worldNormal \x3d silhouetteWorldNormal(aNormalA, aNormalB);\n#else\n  vec3 worldNormal \x3d modelToWorldNormal(aNormal);\n#endif\n  vColor \x3d component.color;\n  vec4 projPos \x3d calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\n  calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\n}",
"lineAmplitude.glsl":"#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\n  float calculateLineAmplitudeSolid() {\n    return 0.0;\n  }\n#endif\n#if (MODE \x3d\x3d MODE_SOLID)\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSolid();\n  }\n#endif\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\n  uniform float uStrokesAmplitude;\n  float calculateLineAmplitudeSketch() {\n    return uStrokesAmplitude;\n  }\n#endif\n#if (MODE \x3d\x3d MODE_SKETCH)\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSketch();\n  }\n#endif\n#if (MODE \x3d\x3d MODE_UBER)\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    float type \x3d unpackedAttributes.type;\n    if (type \x3c\x3d 0.0) {\n      return calculateLineAmplitudeSketch();\n    }\n    else {\n      return calculateLineAmplitudeSolid();\n    }\n  }\n#endif",
"lineOffset.glsl":"#include \x3cutil/encoding.glsl\x3e\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\n  uniform sampler2D uStrokesTexture;\n  uniform float uStrokesNormalizationScale;\n  varying vec2 vStrokeUV;\n  float calculateLineOffsetSketch() {\n    float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n  }\n  float calculateLinePressureSketch() {\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n  }\n#endif\n#if (MODE \x3d\x3d MODE_SKETCH)\n  float calculateLineOffset() {\n    return calculateLineOffsetSketch();\n  }\n  float calculateLinePressure() {\n    return calculateLinePressureSketch();\n  }\n#endif\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\n  float calculateLineOffsetSolid() {\n    return 0.0;\n  }\n  float calculateLinePressureSolid() {\n    return 1.0;\n  }\n#endif\n#if (MODE \x3d\x3d MODE_SOLID)\n  float calculateLineOffset() {\n    return calculateLineOffsetSolid();\n  }\n  float calculateLinePressure() {\n    return calculateLinePressureSolid();\n  }\n#endif\n#if (MODE \x3d\x3d MODE_UBER)\n  varying float vType;\n  float calculateLineOffset() {\n    if (vType \x3c\x3d 0.0) {\n      return calculateLineOffsetSketch();\n    }\n    else {\n      return calculateLineOffsetSolid();\n    }\n  }\n  float calculateLinePressure() {\n    if (vType \x3c\x3d 0.0) {\n      return calculateLinePressureSketch();\n    }\n    else {\n      return calculateLinePressureSolid();\n    }\n  }\n#endif",
"styleOutputs.glsl":"#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\n  uniform vec2 uStrokesTextureScale;\n  uniform float uStrokesLog2Resolution;\n  uniform float uStrokeVariants;\n  varying vec2 vStrokeUV;\n  varying float vLineIndex;\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n    float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n    vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\n    vStrokeUV.x +\x3d aVariantOffset;\n    vLineIndex \x3d lineIndex;\n  }\n#endif\n#if (MODE \x3d\x3d MODE_SOLID)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  }\n#elif (MODE \x3d\x3d MODE_SKETCH)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n  }\n#elif (MODE \x3d\x3d MODE_UBER)\n  varying float vType;\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    vType \x3d unpackedAttributes.type;\n    if (unpackedAttributes.type \x3c\x3d 0.0) {\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n    }\n  }\n#endif",
"util.glsl":"uniform float uDistanceFalloffFactor;\nfloat distanceBasedPerspectiveFactor(float distance) {\n  return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n}\nuniform sampler2D uComponentDataTex;\nuniform vec2 uComponentDataTexInvDim;\nattribute float aComponentIndex;\n#define COMPONENT_COLOR_FIELD_OFFSET 0.0\n#define COMPONENT_OTHER_FIELDS_OFFSET 1.0\n#define COMPONENT_FIELD_COUNT 2.0\n#define LINE_WIDTH_FRACTION_FACTOR 8.0\n#define EXTENSION_LENGTH_OFFSET 128.0\n#define COMPONENT_TEX_WIDTH 4096.0\nvec2 componentTextureCoords(float componentIndex, float fieldOffset) {\n  float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n  float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\n  float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\n  vec2 linearIndex \x3d vec2(\n    (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n    (rowIndex + 0.5) * uComponentDataTexInvDim.y\n  );\n  return linearIndex;\n}\nstruct ComponentData {\n  vec4 color;\n  float lineWidth;\n  float extensionLength;\n  float type;\n};\nComponentData readComponentData() {\n  vec2 colorIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n  vec2 otherIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n  vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\n  vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\n  return ComponentData(\n    vec4(colorValue.rgb, colorValue.a * otherValue.w),\n    otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n    otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n    -(otherValue.z * 255.0) + 0.5\n  );\n}\nvec3 modelToWorldNormal(vec3 normal) {\n  return (uModel * vec4(normal, 0.0)).xyz;\n}\nvec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\n  return modelToWorldNormal(normalize(normalA + normalB));\n}\nfloat calculateExtensionLength(float extensionLength, float lineLength) {\n  return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n}\n#ifdef SILHOUETTE\nbool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\n  vec3 viewNormalA \x3d (uView * uModel * vec4(normalA, 0.0)).xyz;\n  vec3 viewNormalB \x3d (uView * uModel * vec4(normalB, 0.0)).xyz;\n  vec3 viewDir \x3d -viewPos.xyz;\n  float faceAVisible \x3d dot(viewDir, viewNormalA);\n  float faceBVisible \x3d dot(viewDir, viewNormalB);\n  return faceAVisible * faceBVisible \x3c 0.0;\n}\n#endif"},
environment:{"realisticAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cutil/color.glsl\x3e\nuniform vec3 lightingMainDirection;\nuniform vec3 invWavelength;\nuniform vec3 invWavelengthScaled;\nconst float krESun \x3d 0.075;\nconst float kmESun \x3d 0.015;\nuniform vec2 radii;\n#define innerRadius radii[0]\n#define outerRadius radii[1]\nuniform vec4 atmosParams1;\nuniform vec4 atmosParams2;\n#define shellScale atmosParams1.x\n#define shellDepth vec2(atmosParams1.y, atmosParams2.y)\n#define scaleOverScaleDepth vec2(atmosParams1.z, atmosParams2.z)\n#define oneOverScaleDepth vec2(atmosParams1.w, atmosParams2.w)\n#ifndef HAZE\nuniform vec3 atmosParams3;\nuniform float innerFadeDistance;\nuniform float altitudeFade;\n#define g atmosParams2.x\n#define gSq atmosParams3.x\n#define miePhaseCoefficients atmosParams3.y\n#define lowerAlphaBlendBound atmosParams3.z\n#endif\nuniform vec3 cameraPosition;\nuniform vec2 nearFar;\nuniform vec4 sphereComp;\n#define cameraHeight sphereComp[0]\n#define cameraHeightSq sphereComp[1]\n#define C sphereComp[2]\n#define CSur sphereComp[3]\n#ifdef HAZE\nconst float exposure \x3d 1.5;\n#else\nconst float exposure \x3d 2.0;\n#endif\n#ifdef HAZE\nuniform sampler2D depthTex;\n#endif\nvarying vec3 eyeDir;\nvarying vec3 worldRay;\nvarying vec2 vtc;\nconst float samples \x3d 5.0;\nconst int maxSamples \x3d 5;\n#ifdef HAZE\n  const vec3 oneOverGamma \x3d vec3(1.0);\n#else\n  const vec3 oneOverGamma \x3d vec3(0.454545);\n#endif\nvec3 expTM(vec3 inputColor,float _exposure) {\n    return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n}\n#ifndef HAZE\nvec3 reinhardTM(vec3 inputColor, float _exposure) {\n  vec3 intermediate \x3d inputColor * _exposure;\n  intermediate /\x3d ( 1.0 + intermediate );\n  return pow(intermediate, oneOverGamma);\n}\n#endif\nfloat scale(float _cos) {\n  float x \x3d 1.0 - _cos;\n  return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n}\nvoid main() {\n  vec3 worldSpaceRay \x3d normalize(worldRay);\n  float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay);\n  float det \x3d B * B - 4.0 * C;\n  float detSur \x3d B * B - 4.0 * CSur;\n  float minRayStart \x3d 0.0;\n#ifndef HAZE\n  float surfaceBlend \x3d 0.0;\n  vec4 surfaceColor \x3d vec4(0.0);\n  if (detSur \x3e\x3d 0.0) {\n    float nearSurface \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\n    float farSurface \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\n    if (nearSurface \x3d\x3d 0.0) {\n      minRayStart \x3d farSurface;\n    }\n    vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurface;\n    float lightAngle \x3d dot(-lightingMainDirection, normalize(vPos));\n    float brightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n    surfaceColor \x3d vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n    float relDist \x3d (farSurface - nearSurface) / innerFadeDistance;\n    if (relDist \x3e 1.0) {\n      gl_FragColor \x3d surfaceColor;\n      return;\n    }\n    surfaceBlend \x3d smoothstep(0.0, 1.0, relDist * relDist);\n  }\n#endif\n  if (det \x3e\x3d 0.0) {\n#ifdef HAZE\n    float depthSample \x3d texture2D(depthTex, vtc).r;\n    float zNear \x3d nearFar[0];\n    float zFar \x3d nearFar[1];\n    float zNorm \x3d 2.0 * depthSample - 1.0;\n    float linDepth \x3d 2.0 * zNear * zFar /\n      (zFar + zNear - zNorm * (zFar - zNear));\n    float rayEnd;\n    float altitudeAlpha \x3d 1.0;\n    if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n      vec3 cameraSpaceRay \x3d normalize(eyeDir);\n      cameraSpaceRay /\x3d cameraSpaceRay.z;\n      cameraSpaceRay *\x3d linDepth;\n      float cameraSpaceRayLength \x3d length(cameraSpaceRay);\n      vec3 world \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n      float worldRadiusSq \x3d dot(world, world);\n      float transitionStart \x3d innerRadius + 20000.0;\n      float transitionHeight \x3d 25000.0;\n      float transitionEnd \x3d transitionStart + transitionHeight;\n      float edge0 \x3d transitionStart * transitionStart;\n      float edge1 \x3d transitionEnd * transitionEnd;\n      altitudeAlpha \x3d 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n      rayEnd \x3d cameraSpaceRayLength;\n      if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\n        float nearSurface \x3d 0.5 * ( -B - sqrt(detSur) );\n        float interp \x3d clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n        rayEnd \x3d mix(cameraSpaceRayLength, nearSurface, interp);\n      }\n    }\n#endif\n    float rayStart \x3d 0.5 *(-B - sqrt(det));\n#ifdef HAZE\n    float near \x3d abs(rayStart);\n    float far \x3d abs(rayEnd);\n#else\n    float rayEnd \x3d 0.5 *(-B + sqrt(det));\n#endif\n    float scatterDistance;\n    if (rayStart \x3c minRayStart)\n    {\n      rayStart \x3d minRayStart;\n#ifndef HAZE\n      scatterDistance \x3d shellScale * min(0.0, innerRadius - cameraHeight);\n#endif\n    }\n#ifndef HAZE\n    else\n    {\n      scatterDistance \x3d -1.0;\n    }\n#endif\n    vec3 start \x3d cameraPosition + worldSpaceRay * rayStart;\n#ifdef HAZE\n    vec3 end \x3d cameraPosition + worldSpaceRay * rayEnd;\n    float endLength \x3d length(end);\n    float altitudeEnd \x3d endLength - innerRadius;\n    float altitudeStart \x3d length(start) - innerRadius;\n    if (altitudeStart \x3c 0.0) {\n      altitudeStart \x3d -altitudeStart;\n      altitudeEnd \x3d -altitudeEnd;\n    }\n    float lightAngle \x3d dot(-lightingMainDirection, end) / endLength;\n    if (near \x3e far)\n    {\n      if (altitudeStart \x3c altitudeEnd)\n      {\n        end \x3d cameraPosition + worldSpaceRay * rayStart;\n        start \x3d cameraPosition + worldSpaceRay * rayEnd;\n        worldSpaceRay *\x3d -1.0;\n        float tmp \x3d altitudeStart;\n        altitudeStart \x3d altitudeEnd;\n        altitudeEnd \x3d tmp;\n      }\n      else if (altitudeStart \x3d\x3d altitudeEnd)\n      {\n        altitudeStart +\x3d 1.0;\n      }\n    }\n    if (altitudeStart \x3e outerRadius - innerRadius)\n    {\n      scatterDistance \x3d innerRadius - outerRadius;\n    } else\n    {\n      scatterDistance \x3d altitudeEnd - altitudeStart;\n    }\n#endif\n    vec2 opticalStartDepth \x3d exp(scatterDistance * oneOverScaleDepth);\n    float rayLength \x3d rayEnd - rayStart;\n    float sampleLength \x3d rayLength / samples;\n    float scaledLength \x3d sampleLength * shellScale;\n    vec3 sampleRay \x3d worldSpaceRay * sampleLength;\n    vec3 samplePoint \x3d start + sampleRay * 0.5;\n#ifdef HAZE\n    float cameraAngle \x3d dot(-worldSpaceRay, end) / length(end);\n    float scaleCameraAngle \x3d scale(cameraAngle);\n    vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth;\n    float scaledValues \x3d scale(lightAngle) + scaleCameraAngle;\n    vec2 scaledValuesDepth \x3d scaledValues * shellDepth;\n#else\n    float cameraAngle \x3d dot(worldSpaceRay, start / length(start));\n    float angleMultiplier \x3d cameraAngle \x3e 0.0 ? cameraAngle : 0.0;\n    float scaleCameraAngle \x3d scale(cameraAngle);\n    vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth * shellDepth;\n#endif\n    vec3 frontColor \x3d vec3(0.0);\n    vec3 frontColorBlue \x3d vec3(0.0);\n    vec3 attenuate \x3d vec3(0.0);\n    vec3 attenuateBlue \x3d vec3(0.0);\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\n      float height \x3d length(samplePoint);\n      float altitude \x3d abs(height - innerRadius);\n      vec2 depth \x3d exp(-altitude * scaleOverScaleDepth);\n#ifdef HAZE\n      vec2 scatter \x3d depth * scaledValuesDepth - cameraOffset;\n#else\n      float lightAngle \x3d dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle \x3d dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues \x3d scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter \x3d cameraOffset + tmpScaledValues * depth * shellDepth;\n#endif\n      attenuate \x3d exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue \x3d exp(-scatter.y * invWavelengthScaled);\n      frontColor +\x3d attenuate * depth.x;\n      frontColorBlue +\x3d attenuateBlue * depth.y;\n      samplePoint +\x3d sampleRay;\n    }\n    float LdotR \x3d clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq \x3d LdotR * LdotR + 1.0;\n#ifdef HAZE\n    vec3 colorCoefficients \x3d (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n    vec3 color \x3d colorCoefficients * frontColor;\n    vec3 colorBlue \x3d colorCoefficients * frontColorBlue;\n#else\n    vec3 rayleighCoefficients \x3d (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n    float mieCoefficients \x3d scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n    vec3 color \x3d rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n    vec3 colorBlue \x3d rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n#endif\n    vec3 ldrBlue \x3d expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed \x3d expTM(color, exposure);\n    vec3 LDR \x3d mix(ldrBlue, ldrRed, 0.2);\n#ifdef HAZE\n    LDR *\x3d (1.0 - cameraAngle);\n    vec3 hsv \x3d rgb2hsv(LDR);\n    hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0);\n    LDR \x3d hsv2rgb(hsv);\n    vec3 finalColor \x3d LDR;\n#else\n    vec3 ldrReinhard \x3d reinhardTM(color, exposure);\n    LDR +\x3d angleMultiplier * ldrReinhard;\n    float side \x3d (rayEnd + rayStart) * 0.5;\n    float atmoHeight \x3d sqrt(cameraHeightSq - side * side);\n    float h2 \x3d clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n    vec3 finalColor \x3d LDR * h2;\n    vec3 hsv \x3d rgb2hsv(finalColor);\n    hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0);\n    finalColor \x3d hsv2rgb(hsv);\n#endif\n#ifndef HAZE\n    float atmosStrength \x3d clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n    gl_FragColor \x3d vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n    if (surfaceBlend \x3e 0.0) {\n      gl_FragColor \x3d mix(gl_FragColor, surfaceColor, surfaceBlend);\n    }\n#else\n    gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;\n#endif\n  } else {\n    gl_FragColor \x3d vec4(0.0);\n  }\n}",
"realisticAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nuniform vec2 halfSizeNearPlane;\nuniform vec3 cameraUp;\nuniform vec3 cameraRight;\nuniform vec3 cameraDir;\nuniform vec2 cameraCenterOffset;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec3 worldRay;\nvarying vec2 vtc;\n#ifdef HAZE\nvarying vec3 eyeDir;\n#endif\nvoid main(void) {\n  vec3 v3Pos \x3d position;\n  vtc \x3d uv0;\n  vec2 rayvtc \x3d uv0 - cameraCenterOffset;\n#ifdef HAZE\n  eyeDir \x3d vec3((2.0 * halfSizeNearPlane * rayvtc) - halfSizeNearPlane, -1.0);\n#else\n  vec3 eyeDir \x3d vec3((2.0 * halfSizeNearPlane * rayvtc) - halfSizeNearPlane, -1.0);\n#endif\n  worldRay \x3d eyeDir.z * cameraDir + eyeDir.y * cameraUp + eyeDir.x * cameraRight;\n  gl_Position \x3d vec4(v3Pos, 1.0);\n}",
"simpleAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nvarying vec2 vtc;\nvarying float falloff;\n#ifndef PANORAMIC\nuniform float altitudeFade;\nvarying float innerFactor;\n#endif\nvoid main() {\n  vec4 texColor \x3d texture2D(tex, vtc);\n#ifdef PANORAMIC\n  gl_FragColor \x3d texColor * falloff;\n#else\n  vec4 atmosphereColor \x3d texColor * falloff;\n  vec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n  gl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n#endif\n}",
"simpleAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\n#ifndef PANORAMIC\nconst float TWICEPI \x3d 2.0*3.14159265;\nconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\nuniform vec3 silCircleCenter;\nuniform vec3 silCircleV1;\nuniform vec3 silCircleV2;\nuniform vec2 texV;\nuniform float innerScale;\nvarying float innerFactor;\n#endif\nuniform vec3 lightingMainDirection;\nattribute vec3 position;\nvarying vec2 vtc;\nvarying float falloff;\nvoid main(void) {\n  vec3 lightDirection \x3d -lightingMainDirection;\n#ifdef PANORAMIC\n  vec3 pos \x3d position;\n  float ndotl \x3d lightDirection.z;\n  vtc \x3d vec2(0.0, position.z+0.05);\n#else\n  innerFactor \x3d clamp(-position.z, 0.0, 1.0);\n  float scale \x3d position.y * (1.0 + innerFactor * innerScale);\n  float phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n  vec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n  float ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\n  vtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\n  vtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\n#endif\n  falloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n  gl_Position \x3d transformPosition(proj, view, pos);\n  gl_Position.z \x3d gl_Position.w;\n}",
"simpleAtmosphereFade.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nvarying vec4 color;\nvoid main() {\n  gl_FragColor \x3d color;\n}","simpleAtmosphereFade.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nuniform vec3 lightingMainDirection;\nuniform vec3 cameraPosition;\nuniform float undergroundFadeAlpha;\nvarying vec4 color;\nvoid main(void) {\n  float ndotl \x3d dot(normalize(cameraPosition), -lightingMainDirection);\n  float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n  color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\n  gl_Position \x3d vec4(position.xy, 1.0, 1.0);\n}",
"stars.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nvarying vec4 vcolor;\nvarying float vsize;\nvoid main() {\n  float cap \x3d 0.7;\n  float scale \x3d 1.0/cap;\n  float helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\n  float alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\n  float intensity \x3d alpha*alpha*alpha;\n  if (vsize \x3c 3.0)\n    intensity *\x3d 0.5;\n  gl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\n  gl_FragColor.xyz *\x3d vcolor.xyz;\n}","stars.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/alignPixel.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform vec4 viewport;\nuniform float pixelRatio;\nattribute vec3 position;\nattribute vec4 color;\nattribute float size;\nvarying vec4 vcolor;\nvarying float vsize;\nvoid main(void) {\n  vec4 posProj \x3d proj * view * model*vec4(position*1.0e25,1.0);\n  gl_Position \x3d alignToPixelCenter(posProj, viewport.zw);\n  gl_Position.z \x3d gl_Position.w;\n  vcolor \x3d color / 1.2;\n  vsize \x3d size * 5.0 * pixelRatio;\n  gl_PointSize \x3d vsize;\n}"},
materials:{checkerBoard:{"checkerBoard.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\nuniform vec2 size;\nuniform vec4 color1;\nuniform vec4 color2;\nvarying vec2 vUV;\nvoid main() {\n  vec2 uvScaled \x3d vUV / (2.0 * size);\n  vec2 uv \x3d fract(uvScaled - 0.25);\n  vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\n  float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\n  float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\n  gl_FragColor \x3d mix(color2, color1, t);\n}",
"checkerBoard.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec2 vUV;\nvoid main(void) {\n  vUV \x3d uv0;\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n}"},color:{"color.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nuniform vec4 eColor;\n#ifdef VERTEX_COLORS\nvarying vec4 vColor;\n#endif\nvarying vec3 vpos;\nvoid main() {\n  discardBySlice(vpos);\n#ifdef VERTEX_COLORS\n  gl_FragColor \x3d vColor * eColor;\n#else\n  gl_FragColor \x3d eColor;\n#endif\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n}",
"color.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nattribute vec3 position;\n#ifdef VERTEX_COLORS\nattribute vec4 color;\nvarying vec4 vColor;\n#endif\nvarying vec3 vpos;\nvoid main(void) {\n#ifdef VERTEX_COLORS\n  vColor \x3d color * 0.003921568627451;\n#endif\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}"},defaultMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha \x3d 0.0;\n  const float maxTint \x3d 85.0;\n  const float maxReplace \x3d 170.0;\n  const float scaleAlpha \x3d 3.0;\n  if (symbolColor.a \x3e maxReplace) {\n    colorMixMode \x3d 1;\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n  } else if (symbolColor.a \x3e maxTint) {\n    colorMixMode \x3d 3;\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n  } else if (symbolColor.a \x3e 0.0) {\n    colorMixMode \x3d 0;\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\n  } else {\n    colorMixMode \x3d 1;\n    symbolAlpha \x3d 0.0;\n  }\n  return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n}\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n  vec3 internalMixed \x3d internalColor * textureColor;\n  vec3 allMixed \x3d internalMixed * externalColor;\n  if (mode \x3d\x3d 1 ) {\n    return allMixed;\n  }\n  else if (mode \x3d\x3d 2  ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3  ) {\n    return externalColor;\n  }\n  else {\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n  float internalMixed \x3d internalOpacity * textureOpacity;\n  float allMixed \x3d internalMixed * externalOpacity;\n  if (mode \x3d\x3d 2  ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3  ) {\n    return externalOpacity;\n  }\n  else {\n    return allMixed;\n  }\n}",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/sceneLighting.glsl\x3e\n#include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\n#define FRAGMENT_SHADER\n#include \x3cmaterials/defaultMaterial/vertexTangents.glsl\x3e\n#include \x3cmaterials/defaultMaterial/textureNormals.glsl\x3e\nuniform vec3 camPos;\nuniform vec3 localOrigin;\nuniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float opacity;\nuniform float layerOpacity;\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode;\n#else\nuniform int colorMixMode;\n#endif\n#ifdef RECEIVE_SHADOWS\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\n#endif\n#ifdef RECEIVE_SSAO\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\n#endif\nvarying vec3 vpos;\nvarying vec3 localvpos;\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\n  varying vec3 vnormal;\n#endif\n#if defined(VERTEXCOLORS)\nvarying vec4 vcolor;\n#endif\nvarying vec4 vcolorExt;\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#include \x3cutil/shadow.glsl\x3e\n#endif\n#ifdef TREE_RENDERING\n  uniform mat4 view;\n#endif\n#ifdef USE_PBR\n    uniform float roughnessFactor;\n    uniform float metalnessFactor;\n    uniform vec3 emissionFactor;\n    uniform float reflectanceFactor;\n  #ifdef PBR_TEX_METALLNESS_ROUGHNESS\n    uniform sampler2D texMetallicRoughness;\n  #endif\n  #ifdef PBR_TEX_EMISSION\n    uniform sampler2D texEmission;\n  #endif\n  #ifdef PBR_TEX_OCCLUSION\n    uniform sampler2D texOcclusion;\n  #endif\n#endif\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\nvoid main() {\n  discardBySlice(vpos);\n#if defined(TEXTURE_COLOR)\n  vec4 texColor \x3d textureLookup(tex, vtc);\n  #if defined(TEXTURE_ALPHA_PREMULTIPLIED)\n    texColor.rgb /\x3d texColor.a;\n  #endif\n  discardOrAdjustTextureAlpha(texColor);\n#else\n  vec4 texColor \x3d vec4(1.0);\n#endif\n  vec3 viewDir \x3d vpos - camPos;\n#ifdef GROUND_NORMAL_SHADING\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    vec3 normal \x3d normalize(vpos + localOrigin);\n  #else\n    vec3 normal \x3d vec3(0.0, 0.0, 1.0);\n  #endif\n#else\n  #if (NORMALS \x3d\x3d NORMALS_SCREEN_DERIVATIVE)\n    vec3 normal \x3d normalize(cross(dFdx(localvpos),dFdy(localvpos)));\n  #else\n    #ifdef DOUBLESIDED\n      vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\n    #elif defined(WINDINGORDERDOUBLESIDED)\n      vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\n    #else\n      vec3 normal \x3d vnormal;\n    #endif\n    normal \x3d normalize(normal);\n  #endif\n#endif\n#ifdef USE_PBR\n    float reflectance \x3d reflectanceFactor;\n    float roughness \x3d roughnessFactor;\n    float metalness \x3d metalnessFactor;\n  #ifdef PBR_TEX_METALLNESS_ROUGHNESS\n    vec3 metallicRoughness \x3d textureLookup(texMetallicRoughness, vtc).rgb;\n    roughness *\x3d metallicRoughness.g ;\n    metalness *\x3d metallicRoughness.b ;\n  #endif\n    vec3 emission \x3d emissionFactor;\n  #ifdef PBR_TEX_EMISSION\n    emission *\x3d textureLookup(texEmission, vtc).rgb;\n  #endif\n    float bakedOcclusion \x3d 1.0;\n  #ifdef PBR_TEX_OCCLUSION\n    bakedOcclusion *\x3d textureLookup(texOcclusion, vtc).r;\n  #endif\n#endif\n#ifdef RECEIVE_SSAO\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n#else\n  float ssao \x3d 1.0;\n#endif\n#ifdef USE_PBR\n  ssao *\x3d bakedOcclusion;\n#endif\n  float additionalAmbientScale;\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n  float shadow \x3d 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#elif VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n#endif\n  vec3 matColor \x3d max(ambient, diffuse);\n#if defined(VERTEXCOLORS)\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n#else\n  vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n#endif\n#if defined(USE_PBR)\n  if (int(colorMixMode) \x3d\x3d 3 ) {\n    reflectance \x3d 0.2;\n    roughness \x3d 0.6;\n    metalness \x3d 0.0;\n  }\n#endif\n  #if defined(TEXTURE_NORMALS)\n    #ifdef VERTEX_TANGENTS\n      mat3 tangentSpace \x3d computeTangentSpace(normal);\n    #else\n      mat3 tangentSpace \x3d computeTangentSpace(normal, vpos, vtc);\n    #endif\n    vec3 shadingNormal \x3d computeTextureNormal(tangentSpace);\n  #else\n    vec3 shadingNormal \x3d normal;\n  #endif\n  #ifdef TREE_RENDERING\n    shadingNormal \x3d normalize(vnormal);\n    albedo_ *\x3d 1.2;\n    vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\n    float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n    float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadingNormal), 0.0, 1.0);\n    float treeRadialFalloff \x3d vcolor.r;\n    float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n    additionalLight +\x3d backLightFactor * lightingMainIntensity;\n  #endif\n  #ifdef USE_PBR\n    float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n    vec3 normalGround \x3d normalize(vpos + localOrigin);\n    vec3 shadedColor \x3d evaluateSceneLightingPBR(shadingNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDir, normalGround, roughness, metalness, emission, reflectance, additionalAmbientIrradiance);\n  #else\n    vec3 shadedColor \x3d evaluateSceneLighting(shadingNormal, albedo_, shadow, 1.0 - ssao, additionalLight);\n  #endif\n  gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n}",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cutil/offset.glsl\x3e\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\n#define VERTEX_SHADER\n#include \x3cmaterials/defaultMaterial/vertexTangents.glsl\x3e\n#ifdef INSTANCEDCOLOR\nattribute vec4 instanceColor;\n#endif\nattribute vec3 position;\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\n  attribute vec2 normalCompressed;\n  varying vec3 vnormal;\n  #define HAS_NORMALS 1\n#elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\n  attribute vec3 normal;\n  varying vec3 vnormal;\n  #define HAS_NORMALS 1\n#else\n  #define HAS_NORMALS 0\n#endif\nvarying vec3 vpos;\nvarying vec3 localvpos;\n#ifdef TEXTURE_COORDINATES\n    attribute vec2 uv0;\n    varying vec2 vtc;\n  #ifdef TEXTURE_ATLAS\n    attribute vec4 region;\n    varying vec4 regionV;\n  #endif\n#endif\n#ifdef COMPONENTCOLORS\n#include \x3cmaterials/defaultMaterial/componentColors.glsl\x3e\n#endif\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n#ifdef VERTEXCOLORS\nattribute vec4 color;\n#endif\n#ifdef SYMBOLVERTEXCOLORS\nattribute vec4 symbolColor;\n#endif\n#if defined(VERTEXCOLORS)\nvarying vec4 vcolor;\n#endif\nuniform vec4 externalColor;\nvarying vec4 vcolorExt;\n#ifdef VERTEX_TRANSPARENCY_DISCARD_ENABLED\nuniform float discardTransparentVertices;\n#endif\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode;\n#endif\n#include \x3cutil/visualVariables.glsl\x3e\n#if defined(VV_SIZE) || defined(VV_COLOR)\nattribute vec4 instanceFeatureAttribute;\n#endif\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\n#include \x3cmaterials/defaultMaterial/constants.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\nvoid main() {\n#ifdef VERTEXCOLORS\n  vcolor \x3d color * 0.003921568627451;\n#endif\n  vcolorExt \x3d externalColor;\n#ifdef INSTANCEDCOLOR\n  vcolorExt *\x3d instanceColor;\n#endif\n#ifdef VV_COLOR\n  vcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n#endif\n#ifdef SYMBOLVERTEXCOLORS\n  int symbolColorMixMode;\n  vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n#endif\n#ifdef COMPONENTCOLORS\n  int symbolColorMixMode;\n  vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451;\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n#endif\n#ifdef VERTEX_TRANSPARENCY_DISCARD_ENABLED\n  float opaqueCutoff \x3d 1.0 - 1.0 / 255.0;\n  if (discardTransparentVertices \x3e 0.5 ? vcolorExt.a \x3c\x3d opaqueCutoff : vcolorExt.a \x3e opaqueCutoff) {\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n    return;\n  }\n#endif\n  if (vcolorExt.a \x3c SYMBOL_ALPHA_CUTOFF) {\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n  }\n  else {\n    vpos \x3d calculateVPos();\n    localvpos \x3d vpos - view[3].xyz;\n#ifdef INSTANCED_DOUBLE_PRECISION\n  #if HAS_NORMALS\n    vnormal \x3d normalize(modelNormal * localNormal().xyz);\n  #endif\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -\x3d originDelta;\n#else\n  #if HAS_NORMALS\n    vnormal \x3d normalize((modelNormal * localNormal()).xyz);\n  #endif\n#endif\n    #ifdef VERTICAL_OFFSET\n      vpos +\x3d calculateVerticalOffset(vpos, localOrigin);\n    #endif\n    #if defined(VERTEX_TANGENTS)\n      transformVertexTangent(mat3(modelNormal));\n    #endif\n    gl_Position \x3d transformPosition(proj, view, vpos);\n    #if HAS_NORMALS \x26\x26 defined(OFFSET_BACKFACES)\n      gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vnormal, camPos);\n    #endif\n  }\n#ifdef RECEIVE_SHADOWS\n  linearDepth \x3d gl_Position.w;\n#endif\n#ifdef TEXTURE_COORDINATES\n  #ifndef FLIPV\n    vtc \x3d uv0;\n  #else\n    vtc \x3d vec2(uv0.x, 1.0-uv0.y);\n  #endif\n  #ifdef TEXTURE_ATLAS\n    regionV \x3d region;\n  #endif\n#endif\n}",
"commonFunctions.glsl":"#include \x3cmaterials/defaultMaterial/localPosition.glsl\x3e\n#include \x3cutil/doublePrecision.glsl\x3e\nvec3 calculateVPos() {\n#ifdef INSTANCED_DOUBLE_PRECISION\n  return model * localPosition().xyz;\n#else\n  return (model * localPosition()).xyz;\n#endif\n}\n#ifdef VERTICAL_OFFSET\n#ifdef SCREEN_SIZE_PERSPECTIVE\n#include \x3cutil/screenSizePerspective.glsl\x3e\n#endif\nvec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n  float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  vec3 worldNormal \x3d normalize(worldPos + localOrigin);\n#else\n  vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n  float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\n#else\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\n#endif\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n  return worldNormal * worldOffset;\n}\n#endif",
"commonInputs.glsl":"uniform mat4 proj;\nuniform mat4 view;\n#ifdef INSTANCED_DOUBLE_PRECISION\nuniform vec3 viewOriginHi;\nuniform vec3 viewOriginLo;\n#endif\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n#ifdef INSTANCED\n#ifdef INSTANCED_DOUBLE_PRECISION\nattribute vec3 modelOriginHi;\nattribute vec3 modelOriginLo;\nattribute mat3 model;\nattribute mat3 modelNormal;\n#else\nattribute mat4 model;\nattribute mat4 modelNormal;\n#endif\n#else\nuniform mat4 model;\nuniform mat4 modelNormal;\n#endif\n#ifdef VERTICAL_OFFSET\nuniform vec4 verticalOffset;\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspectiveAlignment;\n#endif\n#endif",
"componentColors.glsl":"uniform sampler2D uComponentColorTex;\nuniform vec2 uComponentColorTexInvDim;\nattribute float componentIndex;\nvec4 readComponentColor() {\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n  vec2 indexCoord \x3d vec2(\n    mod(normalizedIndex, 1.0),\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n  );\n  vec4 componentColor \x3d texture2D(uComponentColorTex, indexCoord);\n  return vec4( componentColor.r, componentColor.g, componentColor.b - mod(componentColor.b*255.0, 2.0)/255.0, componentColor.a);\n}\nbool readComponentCastShadowsFlag(){\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n  vec2 indexCoord \x3d vec2(\n    mod(normalizedIndex, 1.0),\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n  );\n  if( mod(texture2D(uComponentColorTex, indexCoord).b*255.0, 2.0) \x3c 1.0 )\n      return false;\n  return true;\n}",
"constants.glsl":"#define SYMBOL_ALPHA_CUTOFF 0.001","depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvarying float depth;\nvarying vec3 vpos;\n#if defined(TEXTURE_COLOR)\n  #include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\n  #include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\n#endif\nvoid main() {\n  discardBySlice(vpos);\n  #if defined(TEXTURE_COLOR)\n    vec4 texColor \x3d textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n  #ifndef BIAS_SHADOWMAP\n    gl_FragColor \x3d float2rgba(depth);\n  #else\n    gl_FragColor \x3d float2rgba(calcFragDepth(depth));\n  #endif\n}",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\nuniform vec2 nearFar;\nattribute vec3 position;\nvarying float depth;\nvarying vec3 vpos;\n#ifdef TEXTURE_COLOR\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n#include \x3cutil/visualVariables.glsl\x3e\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\n#if defined(COMPONENTCOLORS)\n#include \x3cmaterials/defaultMaterial/componentColors.glsl\x3e\n#endif\nvoid main(void) {\n  vpos \x3d calculateVPos();\n#if defined(COMPONENTCOLORS)\n  if( !readComponentCastShadowsFlag() ){\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n  }else\n  {\n#endif\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -\x3d originDelta;\n#endif\n  #ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(vpos, localOrigin);\n  #endif\n  gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n#if defined(COMPONENTCOLORS)\n  }\n#endif\n#ifdef TEXTURE_COLOR\n#ifndef FLIPV\n  vtc \x3d uv0;\n#else\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV \x3d region;\n#endif\n#endif\n}",
"highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/highlight.glsl\x3e\nvarying vec3 vpos;\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n#if defined(TEXTURE_COLOR)\n  #include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\n  #include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\n#endif\nvoid main() {\n  discardBySlice(vpos);\n  #if defined(TEXTURE_COLOR)\n    vec4 texColor \x3d textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\nattribute vec3 position;\nvarying vec3 vpos;\n#if defined(TEXTURE_COLOR)\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n#include \x3cutil/visualVariables.glsl\x3e\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\nvoid main(void) {\n  vpos \x3d calculateVPos();\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -\x3d originDelta;\n#endif\n  #ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(vpos, localOrigin);\n  #endif\n  gl_Position \x3d transformPosition(proj, view, vpos);\n#if defined(TEXTURE_COLOR)\n#ifndef FLIPV\n  vtc \x3d uv0;\n#else\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV \x3d region;\n#endif\n#endif\n}",
"localCenter.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vvTransformPosition(vec3(0.0), instanceFeatureAttribute); }\n# endif\n#else\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vec4(vec3(0.0), 1.0); }\n# endif\n#endif","localNormal.glsl":"#include \x3cutil/normalEncoding.glsl\x3e\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  # if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\n    vec4 localNormal() { return vvTransformNormal(decodeNormal(normalCompressed), instanceFeatureAttribute); }\n  # elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\n    vec4 localNormal() { return vvTransformNormal(normal, instanceFeatureAttribute); }\n  # endif\n#else\n  # if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\n    vec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\n  # elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\n    vec4 localNormal() { return vec4(normal, 1.0); }\n  # endif\n#endif",
"localPosition.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\nvec4 localPosition() { return vvTransformPosition(position, instanceFeatureAttribute); }\n#else\nvec4 localPosition() { return vec4(position, 1.0); }\n#endif","normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\n  varying vec3 vnormal;\n#endif\nvarying vec3 vpos;\nvarying vec3 vPositionView;\n#if defined(TEXTURE_COLOR)\n#include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\n#endif\nvoid main() {\n  discardBySlice(vpos);\n  #if defined(TEXTURE_COLOR)\n    vec4 texColor \x3d textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n#if (NORMALS \x3d\x3d NORMALS_SCREEN_DERIVATIVE)\n  vec3 normal \x3d normalize(cross(dFdx(vPositionView),dFdy(vPositionView)));\n#else\n  vec3 normal \x3d normalize(vnormal);\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n#endif\n  #ifndef ALPHA_ZERO\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\n  #else\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\n  #endif\n}",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\nuniform mat4 viewNormal;\nattribute vec3 position;\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\n  attribute vec2 normalCompressed;\n  varying vec3 vnormal;\n#elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\n  attribute vec3 normal;\n  varying vec3 vnormal;\n#endif\n#if defined(TEXTURE_COLOR)\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\nvarying vec3 vpos;\nvarying vec3 vPositionView;\n#include \x3cutil/visualVariables.glsl\x3e\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\nvoid main(void) {\n  vpos \x3d calculateVPos();\n#ifdef INSTANCED_DOUBLE_PRECISION\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\n    vnormal \x3d normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\n  #endif\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -\x3d originDelta;\n#else\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\n    vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\n  #endif\n#endif\n  #ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(vpos, localOrigin);\n  #endif\n  gl_Position \x3d transformPosition(proj, view, vpos);\n#if defined(TEXTURE_COLOR)\n#ifndef FLIPV\n  vtc \x3d uv0;\n#else\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV \x3d region;\n#endif\n#endif\n}",
"textureNormals.glsl":"#if defined(TEXTURE_NORMALS)\n  uniform sampler2D texNormal;\n  vec3 computeTextureNormal(mat3 tangentSpace) {\n    vec3 rawNormal \x3d textureLookup(texNormal, vtc).rgb * 2.0 - 1.0;\n    return tangentSpace * rawNormal;\n  }\n#endif","texturing.glsl":"float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n  float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\n}\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\n  vec2 atlasScale \x3d region.zw - region.xy;\n  vec2 uvAtlas \x3d fract(uv) * atlasScale + region.xy;\n  vec4 texColor;\n  vec2 dUVdx \x3d dFdx(uv) * atlasScale;\n  vec2 dUVdy \x3d dFdy(uv) * atlasScale;\n#ifdef GL_EXT_shader_texture_lod\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\n#else\n  vec2 dUVdxAuto \x3d dFdx(uvAtlas);\n  vec2 dUVdyAuto \x3d dFdy(uvAtlas);\n  float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\n  float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}\nvec4 textureLookup(sampler2D tex, vec2 uv) {\n#if defined(TEXTURE_ATLAS)\n  return textureAtlasLookup(tex, uv, regionV, atlasSize);\n#else\n  return texture2D(tex, uv);\n#endif\n}\nvoid discardOrAdjustTextureAlpha(inout vec4 texColor) {\n  #if defined(TEXTURE_COLOR)\n  #if defined(TEXTURE_ALPHA_MODE_MASK)\n    if (texColor.a \x3c textureAlphaCutoff) {\n      discard;\n    } else {\n      texColor.a \x3d 1.0;\n    }\n  #elif defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\n    if (texColor.a \x3c textureAlphaCutoff) {\n      discard;\n    }\n  #elif defined(TEXTURE_ALPHA_MODE_OPAQUE)\n    texColor.a \x3d 1.0;\n  #else\n  #endif\n  #endif\n}",
"texturingInputs.glsl":"#ifdef TEXTURE_COLOR\n  uniform sampler2D tex;\n  #if defined(TEXTURE_ALPHA_MODE_MASK) || defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\n    uniform float textureAlphaCutoff;\n  #endif\n#endif\n#if defined(TEXTURE_COORDINATES)\n  varying vec2 vtc;\n  #ifdef TEXTURE_ATLAS\n    varying vec4 regionV;\n    uniform vec2 atlasSize;\n  #endif\n#endif","vertexTangents.glsl":"#if defined(VERTEX_SHADER)\n  #if defined(VERTEX_TANGENTS)\n    attribute vec4 aTangent;\n    varying vec4 vTangent;\n    void transformVertexTangent(mat3 modelTransformForNormals) {\n      vTangent.xyz \x3d modelTransformForNormals * aTangent.xyz;\n      vTangent.w \x3d aTangent.w;\n    }\n  #endif\n#elif defined(FRAGMENT_SHADER)\n  #if defined(VERTEX_TANGENTS)\n    varying vec4 vTangent;\n    #if defined(WINDINGORDERDOUBLESIDED)\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    #else\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d vTangent.w;\n        vec3 tangent \x3d normalize(vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    #endif\n  #else\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n      vec3 Q1 \x3d dFdx(pos);\n      vec3 Q2 \x3d dFdy(pos);\n      vec2 stx \x3d dFdx(st);\n      vec2 sty \x3d dFdy(st);\n      float det \x3d stx.t * sty.s - sty.t * stx.s;\n      vec3 T \x3d stx.t * Q2 - sty.t * Q1;\n      T \x3d T - normal * dot(normal, T);\n      T *\x3d inversesqrt(max(dot(T,T), 1.e-10));\n      vec3 B \x3d sign(det) * cross(normal, T);\n      return mat3(T, B, normal);\n    }\n  #endif\n#endif"},
hud:{"colorPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\nvoid main() {\n#include \x3cmaterials/hud/hudMain.glsl\x3e\n}","highlightPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\n#include \x3cutil/highlight.glsl\x3e\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\nvoid main() {\n#include \x3cmaterials/hud/hudMain.glsl\x3e\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  if (voccluded \x3d\x3d 1.0) {\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n  } else {\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n  }\n#else\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n#endif\n}",
"hud.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/alignPixel.glsl\x3e\n#include \x3cutil/hud.glsl\x3e\n#include \x3cutil/visualVariables.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nuniform vec2 screenOffset;\nuniform vec2 anchorPos;\nuniform vec2 textureCoordinateScaleFactor;\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspective;\n#endif\n#ifdef DEBUG_DRAW_BORDER\nvarying vec4 debugBorderCoords;\n#endif\nattribute vec2 uv0;\nattribute vec4 color;\nattribute vec2 size;\nattribute vec4 auxpos2;\nvarying vec4 vcolor;\nvarying vec2 vtc;\nvarying vec2 vsize;\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvarying float voccluded;\n#endif\nvoid main(void) {\n  ProjectHUDAux projectAux;\n  vec4 posProj \x3d projectPositionHUD(projectAux);\n  if (rejectBySlice(projectAux.posModel)) {\n    gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    return;\n  }\n  vec2 inputSize;\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n  vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n#else\n  inputSize \x3d size;\n  vec2 screenOffsetScaled \x3d screenOffset;\n#endif\n#ifdef VV_SIZE\n  inputSize *\x3d vvGetScale(auxpos2).xx;\n#endif\n  vec2 combinedSize \x3d inputSize * pixelRatio;\n  vec4 quadOffset \x3d vec4(0.0);\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\n  bool visible \x3d testVisibilityHUD(posProj);\n#endif\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvoccluded \x3d visible ? 0.0 : 1.0;\n#endif\n#ifdef OCCL_TEST\n  if (visible) {\n#endif\n    vec2 uv01 \x3d floor(uv0);\n    vec2 uv \x3d uv0 - uv01;\n    quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n#ifdef SIGNED_DISTANCE_FIELD\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\n#else\n    posProj +\x3d quadOffset;\n    if (inputSize.x \x3d\x3d size.x) {\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n    }\n#endif\n    gl_Position \x3d posProj;\n    vtc \x3d uv * textureCoordinateScaleFactor;\n#ifdef DEBUG_DRAW_BORDER\n    debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);\n#endif\n    vsize \x3d inputSize;\n#ifdef OCCL_TEST\n  } else {\n    vtc \x3d vec2(.0);\n#ifdef DEBUG_DRAW_BORDER\n    debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);\n#endif\n  }\n#endif\n  gl_Position \x3d posProj;\n#ifdef VV_COLOR\n  vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors);\n#else\n  vcolor \x3d color / 255.0;\n#endif\n}",
"hudHeader.glsl":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cutil/color.glsl\x3e\nuniform sampler2D tex;\nuniform vec4 overrideColor;\nuniform vec4 outlineColor;\nuniform float outlineSize;\nvarying vec4 vcolor;\nvarying vec2 vtc;\nvarying vec2 vsize;\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvarying float voccluded;\n#endif\n#ifdef DEBUG_DRAW_BORDER\nvarying vec4 debugBorderCoords;\n#endif","hudMain.glsl":"#ifdef SIGNED_DISTANCE_FIELD\n  vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\n  vec4 fillPixelColor \x3d overrideColor * vcolor;\n  const float txSize \x3d 128.0;\n  const float texelSize \x3d 1.0 / txSize;\n  vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\n  vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n  float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\n  float dist \x3d d * vsize.x;\n  fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  if (outlineSize \x3e 0.25) {\n    vec4 outlinePixelColor \x3d outlineColor;\n    float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n    outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n    float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n    vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n      vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n    gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n  }\n  else {\n    gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\n  }\n#else\n  gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);\n#endif\n#ifdef DEBUG_DRAW_BORDER\n   float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));\n   gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);\n#endif\n  if (gl_FragColor.a \x3c 0.1) {\n    discard;\n  }",
"occlusionTest.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform vec4 color;\nvoid main() {\n  gl_FragColor \x3d color;\n}","occlusionTest.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/alignPixel.glsl\x3e\n#include \x3cutil/hud.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvoid main(void) {\n  vec4 posProjCenter;\n  if (dot(position, position) \x3e 0.0) {\n    ProjectHUDAux projectAux;\n    vec4 posProj \x3d projectPositionHUD(projectAux);\n    posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n    vec3 vpos \x3d projectAux.posModel;\n    if (rejectBySlice(vpos)) {\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n  }\n  else {\n    posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n  }\n  gl_Position \x3d posProjCenter;\n  gl_PointSize \x3d 1.0;\n}"},
lineCallout:{"lineCallout.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform vec4 color;\nuniform vec4 borderColor;\nvarying vec4 coverageSampling;\nvarying vec2 lineSizes;\nvoid main() {\n  vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n  float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n  float colorAlpha \x3d color.a * coverage.x;\n  float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n#ifdef DEPTH_HUD\n  if (finalAlpha \x3c 0.01) {\n    discard;\n  }\n#else\n  vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n  gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n#endif\n}",
"lineCallout.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/alignPixel.glsl\x3e\n#include \x3cutil/hud.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nattribute vec2 uv0;\nuniform float lineSize;\nuniform vec2 pixelToNDC;\nuniform float borderSize;\nuniform vec2 screenOffset;\nvarying vec4 coverageSampling;\nvarying vec2 lineSizes;\nvoid main(void) {\n  ProjectHUDAux projectAux;\n  vec4 endPoint \x3d projectPositionHUD(projectAux);\n  vec3 vpos \x3d projectAux.posModel;\n  if (rejectBySlice(vpos)) {\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n    return;\n  }\n#ifdef OCCL_TEST\n  if (!testVisibilityHUD(endPoint)) {\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n    return;\n  }\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n  vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n#else\n  vec2 screenOffsetScaled \x3d screenOffset;\n#endif\n  vec3 posView \x3d (view * (model * vec4(position, 1.0))).xyz;\n  applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n  vec4 startPoint \x3d proj * vec4(posView, 1.0);\n  vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n  startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n  endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n  vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n  vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n#ifdef DEPTH_HUD\n#ifdef DEPTH_HUD_ALIGN_START\n  endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\n#else\n  startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\n#endif\n#endif\n  vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\n  vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n  float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n#else\n  float lineSizeScaled \x3d lineSize;\n  float borderSizeScaled \x3d borderSize;\n#endif\n  float halfPixelSize \x3d lineSizeScaled * 0.5;\n  float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n  float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n  float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n  float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n  float padding \x3d 1.0 + borderSizeScaled;\n  vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n  projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n  float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\n  float halfBorderSize \x3d 0.5 * borderSizeScaled;\n  float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n  float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n  float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n  coverageSampling \x3d vec4(\n    outerEdgeCoverageSampler,\n    outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n    halfPixelSize - 0.5,\n    halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n  );\n  lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n  gl_Position \x3d projectedPosition;\n}"},
measurementArrow:{"measurementArrow.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform float outlineSize;\nuniform vec4 outlineColor;\nuniform float stripeLength;\nuniform vec4 stripeEvenColor;\nuniform vec4 stripeOddColor;\nvarying vec2 vtc;\nvarying float vlength;\nvarying float vradius;\n#define INV_SQRT2 (1.0 / sqrt(2.0))\nvec4 arrowColor(vec2 tc, float len) {\n  float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\n  d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n  d \x3d min(d, 1.0 - abs(tc.y));\n  if (d \x3c 0.0) {\n    return vec4(0.0);\n  } else if (d \x3c outlineSize) {\n    return outlineColor;\n  } else {\n    return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\n  }\n}\nvoid main(void) {\n  vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\n  vec4 color \x3d arrowColor(ntc, vlength / vradius);\n  if (color.a \x3d\x3d 0.0) {\n    discard;\n  }\n  gl_FragColor \x3d color;\n}",
"measurementArrow.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform float width;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv0;\nattribute float auxpos1;\nvarying vec2 vtc;\nvarying float vlength;\nvarying float vradius;\nvoid main(void) {\n  vec3 bitangent \x3d normal;\n  vtc \x3d uv0;\n  vlength \x3d auxpos1;\n  vradius \x3d 0.5 * width;\n  vec4 pos \x3d view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\n  gl_Position \x3d proj * pos;\n}"},
nativeLine:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nuniform vec4 constantColor;\nvarying vec3 vpos;\n#ifdef VERTEXCOLORS\nvarying vec4 vcolor;\n#endif\nvoid main() {\n  discardBySlice(vpos);\n#ifdef VERTEXCOLORS\n  gl_FragColor \x3d highlightSlice(vcolor, vpos);\n#else\n  gl_FragColor \x3d highlightSlice(constantColor, vpos);\n#endif\n}","highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/highlight.glsl\x3e\nvarying vec3 vpos;\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\nvoid main() {\n  discardBySlice(vpos);\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}",
"nativeLine.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nattribute vec3 position;\n#ifdef VERTEXCOLORS\nattribute vec4 color;\n#endif\nvarying vec3 vpos;\n#ifdef VERTEXCOLORS\nvarying vec4 vcolor;\n#endif\nvoid main(void) {\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\n  #ifdef VERTEXCOLORS\n    vcolor \x3d color * 0.003921568627451;\n  #endif\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}"},
pathMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha \x3d 0.0;\n  const float maxTint \x3d 85.0;\n  const float maxReplace \x3d 170.0;\n  const float scaleAlpha \x3d 3.0;\n  if (symbolColor.a \x3d\x3d 0.0) {\n    colorMixMode \x3d 1;\n    symbolAlpha \x3d 0.0;\n  }\n  else if (symbolColor.a \x3c\x3d maxTint) {\n    colorMixMode \x3d 0;\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\n  }\n  else if (symbolColor.a \x3c\x3d maxReplace) {\n    colorMixMode \x3d 3;\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n  }\n  else {\n    colorMixMode \x3d 1;\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n  }\n  return vec4(symbolColor.rgb, symbolAlpha);\n}\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n  vec3 internalMixed \x3d internalColor * textureColor;\n  vec3 allMixed \x3d internalMixed * externalColor;\n  if (mode \x3d\x3d 1 ) {\n    return allMixed;\n  }\n  else if (mode \x3d\x3d 2  ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3  ) {\n    return externalColor;\n  }\n  else {\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n  float internalMixed \x3d internalOpacity * textureOpacity;\n  float allMixed \x3d internalMixed * externalOpacity;\n  if (mode \x3d\x3d 2  ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3  ) {\n    return externalOpacity;\n  }\n  else {\n    return allMixed;\n  }\n}",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/sceneLighting.glsl\x3e\nuniform vec3 camPos;\nuniform vec3 localOrigin;\nuniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float opacity;\nuniform float layerOpacity;\nuniform int colorMixMode;\n#ifdef RECEIVE_SHADOWS\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\n#endif\n#ifdef RECEIVE_SSAO\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\n#endif\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying vec4 vcolor;\nvarying vec4 vcolorExt;\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#include \x3cutil/shadow.glsl\x3e\n#endif\n#include \x3cmaterials/pathMaterial/colorMixMode.glsl\x3e\nvoid main() {\n  discardBySlice(vpos);\n  vec4 texColor \x3d vec4(1.0);\n  vec3 viewDir \x3d vpos - camPos;\n#ifdef GROUND_NORMAL_SHADING\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  vec3 normal \x3d normalize(vpos + localOrigin);\n#else\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\n#endif\n#else\n#ifdef DOUBLESIDED\n  vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\n#elif defined(WINDINGORDERDOUBLESIDED)\n  vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\n#else\n  vec3 normal \x3d vnormal;\n#endif\n  normal \x3d normalize(normal);\n#endif\n#ifdef RECEIVE_SSAO\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n#else\n  float ssao \x3d 1.0;\n#endif\n  float additionalAmbientScale;\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n  float shadow \x3d 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#elif VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n#endif\n  vec3 matColor \x3d max(ambient, diffuse);\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n  albedo_+\x3d 0.25 * specular;\n#ifdef TRANSPARENCY_DISCARD\n  if (opacity_ \x3c 0.001) {\n    discard;\n  }\n#endif\n  vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n  gl_FragColor \x3d vec4(shadedColor, opacity_);\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n}",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\nvarying vec3 vpos;\nvarying vec3 vnormal;\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\nuniform vec4 externalColor;\nvarying vec4 vcolor;\nvarying vec4 vcolorExt;\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\nvoid main() {\n  vpos \x3d calculateVPos();\n  vnormal \x3d normalize((modelNormal * localNormal()).xyz);\n  gl_Position \x3d transformPosition(proj, view, vpos);\n#ifdef RECEIVE_SHADOWS\n  linearDepth \x3d gl_Position.w;\n#endif\n  vcolorExt \x3d externalColor;\n  vcolor \x3d getColor();\n}",
"commonFunctions.glsl":"#include \x3cutil/doublePrecision.glsl\x3e\nattribute vec4 featureValue;\nbool isCapVertex() {\n  return featureValue.w \x3d\x3d 1.0;\n}\nuniform vec3 size;\n#if defined(VV_SIZE)\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n  vec2 getSize() {\n    float value \x3d featureValue.x;\n    return size.xy*clamp(vvSizeOffset + value * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n  }\n#else\n  vec2 getSize(){\n    return size.xy;\n  }\n#endif\n#ifdef VV_OPACITY\n  #define VV_OPACITY_N 8\n  uniform float vvOpacityValues[VV_OPACITY_N];\n  uniform float vvOpacityOpacities[VV_OPACITY_N];\n  vec4 applyOpacity(vec4 color) {\n    float value \x3d featureValue.z;\n    if (value \x3c\x3d vvOpacityValues[0]) {\n      return vec4( color.xyz, vvOpacityOpacities[0]);\n    }\n    for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n      if (vvOpacityValues[i] \x3e\x3d value) {\n        float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n        return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n      }\n    }\n    return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n  }\n#else\n  vec4 applyOpacity(vec4 color){\n    return color;\n  }\n#endif\n#ifdef VV_COLOR\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n  vec4 getColor() {\n    float value \x3d featureValue.y;\n    if (value \x3c\x3d vvColorValues[0]) {\n      return applyOpacity(vvColorColors[0]);\n    }\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n      if (vvColorValues[i] \x3e\x3d value) {\n        float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n        return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n      }\n    }\n    return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n  }\n#else\n  vec4 getColor(){\n    return applyOpacity(vec4(1, 1, 1, 1));\n  }\n#endif\nvec3 calculateVPos() {\n  vec2 size \x3d getSize();\n  vec3 origin \x3d position;\n  vec3 right \x3d profileRight.xyz;\n  vec3 up \x3d profileUp.xyz;\n  vec3 forward \x3d cross(up, right);\n  vec2 profileVertex \x3d profileVertexAndNormal.xy * size;\n  vec2 profileNormal \x3d profileVertexAndNormal.zw;\n  float positionOffsetAlongProfilePlaneNormal \x3d 0.0;\n  float normalOffsetAlongProfilePlaneNormal \x3d 0.0;\n  if(!isCapVertex()) {\n    vec2 rotationRight \x3d vec2(profileRight.w, profileUp.w);\n    float maxDistance \x3d length(rotationRight);\n    rotationRight \x3d normalize(rotationRight);\n    float rx \x3d dot(profileVertex, rotationRight);\n    if (abs(rx) \x3e maxDistance) {\n      vec2 rotationUp \x3d vec2(-rotationRight.y, rotationRight.x);\n      float ry \x3d dot(profileVertex, rotationUp);\n      profileVertex \x3d rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n    }\n  }else{\n     positionOffsetAlongProfilePlaneNormal \x3d profileRight.w * size[0];\n     normalOffsetAlongProfilePlaneNormal \x3d profileUp.w;\n  }\n  vec3 offset \x3d right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n  vec4 localPosition \x3d vec4(origin + offset, 1.0);\n  return (model * localPosition).xyz;\n}\nvec4 localNormal() {\n  vec3 right \x3d profileRight.xyz;\n  vec3 up \x3d profileUp.xyz;\n  vec3 forward \x3d cross(up, right);\n  vec2 profileNormal \x3d profileVertexAndNormal.zw;\n  vec3 normal \x3d right * profileNormal.x + up * profileNormal.y;\n  if(isCapVertex()) {\n    normal +\x3d forward * profileUp.w;\n  }\n  return vec4(normal, 1.0);\n}",
"commonInputs.glsl":"uniform mat4 proj;\nuniform mat4 view;\nuniform vec3 camPos;\nuniform vec3 localOrigin;\nuniform mat4 model;\nuniform mat4 modelNormal;\nattribute vec3 position;\nattribute vec4 profileRight;\nattribute vec4 profileUp;\nattribute vec4 profileVertexAndNormal;","depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvarying float depth;\nvarying vec3 vpos;\nvoid main() {\n  discardBySlice(vpos);\n#ifndef BIAS_SHADOWMAP\n  gl_FragColor \x3d float2rgba(depth);\n#else\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\n#endif\n}",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\nuniform vec2 nearFar;\nvarying float depth;\nvarying vec3 vpos;\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\nvoid main(void) {\n  vpos \x3d calculateVPos();\n  gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n}","highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/highlight.glsl\x3e\nvarying vec3 vpos;\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\nvoid main() {\n  discardBySlice(vpos);\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\nvarying vec3 vpos;\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\nvoid main(void) {\n  vpos \x3d calculateVPos();\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}","normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvoid main() {\n  discardBySlice(vpos);\n  vec3 normal \x3d normalize(vnormal);\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n#ifndef ALPHA_ZERO\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n}",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\nuniform mat4 viewNormal;\nvarying vec3 vnormal;\nvarying vec3 vpos;\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\nvoid main(void) {\n  vpos \x3d calculateVPos();\n  vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}"},ribbonLine:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nuniform vec4 symbolColor;\nvarying vec4 vColor;\nvarying vec2 vtc;\nvarying vec3 vpos;\n#ifdef STIPPLE\nuniform float stippleLengthDoubleInv;\n#endif\nvoid main() {\n  discardBySlice(vpos);\n#ifdef STIPPLE\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\n    discard;\n  }\n#endif\n  gl_FragColor \x3d highlightSlice(symbolColor * vColor, vpos);\n}",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvarying vec2 vtc;\nvarying vec3 vpos;\n#ifdef STIPPLE\nuniform float stippleLengthDoubleInv;\n#endif\nvoid main() {\n  discardBySlice(vpos);\n#ifdef STIPPLE\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\n    discard;\n  }\n#endif\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","inputs.glsl":"uniform float symbolLineWidth;\n#ifdef VV_SIZE\n  attribute float sizeFeatureAttribute;\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n  float getSize() {\n    float value \x3d sizeFeatureAttribute;\n    return symbolLineWidth * clamp(vvSizeOffset + value * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n  }\n#else\n  attribute float size;\n  float getSize(){\n    return symbolLineWidth * size;\n  }\n#endif\n#ifdef VV_OPACITY\n  attribute float opacityFeatureAttribute;\n  #define VV_OPACITY_N 8\n  uniform float vvOpacityValues[VV_OPACITY_N];\n  uniform float vvOpacityOpacities[VV_OPACITY_N];\n  float interpolateOpacity( float value ){\n    if (value \x3c\x3d vvOpacityValues[0]) {\n      return vvOpacityOpacities[0];\n    }\n    for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n      if (vvOpacityValues[i] \x3e\x3d value) {\n        float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n        return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n      }\n    }\n    return vvOpacityOpacities[VV_OPACITY_N - 1];\n  }\n  vec4 applyOpacity( vec4 color ){\n    return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n  }\n#else\n  vec4 applyOpacity( vec4 color ){\n    return color;\n  }\n#endif\n#ifdef VV_COLOR\n  attribute float colorFeatureAttribute;\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n  vec4 interpolateColor( float value ) {\n    if (value \x3c\x3d vvColorValues[0]) {\n      return vvColorColors[0];\n    }\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n      if (vvColorValues[i] \x3e\x3d value) {\n        float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n        return mix(vvColorColors[i-1], vvColorColors[i], f);\n      }\n    }\n    return vvColorColors[VV_COLOR_N - 1];\n  }\n  vec4 getColor(){\n    return applyOpacity(interpolateColor(colorFeatureAttribute));\n  }\n#else\n  attribute vec4 color;\n  vec4 getColor(){\n    return applyOpacity(color);\n  }\n#endif",
"ribbonLine.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cmaterials/ribbonLine/inputs.glsl\x3e\nconst float PI \x3d 3.1415926535897932384626433832795;\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform float nearPlane;\nuniform float pixelRatio;\nattribute vec3 position;\nattribute float subdivisionFactor;\nattribute vec2 uv0;\nvarying vec2 vtc;\nvarying vec4 vColor;\nvarying vec3 vpos;\nuniform float miterLimit;\nattribute vec3 auxpos1;\nattribute vec3 auxpos2;\nuniform vec2 screenSize;\nvec4 toScreenCoords(vec3 vertex) {\n  vec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\n  vClipSpace.xy *\x3d screenSize;\n  return vClipSpace/abs(vClipSpace.w);\n}\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\nfloat interp(float ncp, vec4 a, vec4 b) {\n  return (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\n\tfloat s \x3d sin(a);\n\tfloat c \x3d cos(a);\n\tmat2 m \x3d mat2(c, -s, s, c);\n\treturn m * v;\n}\nvoid clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n  float vnp \x3d nearPlane*0.99;\n  if(pos.z \x3e -nearPlane) {\n    if (!isStartVertex) {\n      if(prev.z \x3c -nearPlane) {\n        pos \x3d mix(prev, pos, interp(vnp, prev, pos));\n        next \x3d pos;\n      } else {\n        pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n      }\n    }\n    if(isStartVertex) {\n      if(next.z \x3c -nearPlane) {\n        pos \x3d mix(pos, next, interp(vnp, pos, next));\n        prev \x3d pos;\n      } else {\n        pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n      }\n    }\n  } else {\n    if (prev.z \x3e -nearPlane) {\n      prev \x3d mix(pos, prev, interp(vnp, pos, prev));\n    }\n    if (next.z \x3e -nearPlane) {\n      next \x3d mix(next, pos, interp(vnp, next, pos));\n    }\n  }\n  pos\x3d proj * pos;\n  pos.xy *\x3d screenSize;\n  pos /\x3d pos.w;\n  next \x3d proj * next;\n  next.xy *\x3d screenSize;\n  next /\x3d next.w;\n  prev \x3d proj * prev;\n  prev.xy *\x3d screenSize;\n  prev /\x3d prev.w;\n}\nvoid main(void) {\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\n  if (uv0.y \x3d\x3d 0.0) {\n    gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n  }\n  else {\n    bool isStartVertex \x3d abs(abs(uv0.y)-3.0) \x3d\x3d 1.0;\n    bool isJoin \x3d abs(uv0.y)-3.0 \x3c 0.0;\n    float lineWidth \x3d getSize() * pixelRatio;\n    vec4 pos  \x3d view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\n    vec4 prev \x3d view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\n    vec4 next \x3d view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\n    clipAndTransform(pos, prev, next, isStartVertex);\n    vec2 left \x3d (pos - prev).xy;\n    vec2 right \x3d (next - pos).xy;\n    float leftLen \x3d length(left);\n    left \x3d (leftLen \x3e 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    float rightLen \x3d length(right);\n    right \x3d (rightLen \x3e 0.001) ? right/rightLen : vec2(0.0, 0.0);\n    vec2 capDisplacementDir \x3d vec2(0, 0);\n    vec2 joinDisplacementDir \x3d vec2(0, 0);\n    float displacementLen \x3d lineWidth;\n    if( isJoin ){\n      bool isOutside \x3d ISOUTSIDE;\n      joinDisplacementDir \x3d normalize(left + right);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n      if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n        float nDotSeg \x3d dot(joinDisplacementDir, left);\n        displacementLen /\x3d length(nDotSeg*left - joinDisplacementDir);\n        if (!isOutside) {\n          displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n      if (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\n#ifdef JOIN_ROUND\n        vec2 startDir;\n        vec2 endDir;\n        if (leftLen \x3c 0.001) {\n          startDir \x3d right;\n        }\n        else{\n          startDir \x3d left;\n        }\n        startDir \x3d normalize(startDir);\n        startDir \x3d PERPENDICULAR(startDir);\n        if (rightLen \x3c 0.001) {\n          endDir \x3d left;\n        }\n        else{\n          endDir \x3d right;\n        }\n        endDir \x3d normalize(endDir);\n        endDir \x3d PERPENDICULAR(endDir);\n        float rotationAngle \x3d acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir \x3d rotate( startDir, -sign(uv0.y)*subdivisionFactor*rotationAngle );\n        displacementLen \x3d lineWidth;\n#else\n        if (leftLen \x3c 0.001) {\n          joinDisplacementDir \x3d right;\n        }\n        else if (rightLen \x3c 0.001) {\n          joinDisplacementDir \x3d left;\n        }\n        else {\n          joinDisplacementDir \x3d isStartVertex ? right : left;\n        }\n        joinDisplacementDir \x3d normalize(joinDisplacementDir);\n        joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n        displacementLen \x3d lineWidth;\n#endif\n      }\n    } else {\n      if (leftLen \x3c 0.001) {\n        joinDisplacementDir \x3d right;\n      }\n      else if (rightLen \x3c 0.001) {\n        joinDisplacementDir \x3d left;\n      }\n      else {\n        joinDisplacementDir \x3d isStartVertex ? right : left;\n      }\n      joinDisplacementDir \x3d normalize(joinDisplacementDir);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n      displacementLen \x3d lineWidth;\n      capDisplacementDir \x3d isStartVertex ? -right : left;\n  #ifdef CAP_ROUND\n      float angle \x3d subdivisionFactor*PI*0.5;\n      joinDisplacementDir *\x3d cos(angle);\n      capDisplacementDir *\x3d sin(angle);\n  #else\n      capDisplacementDir *\x3d subdivisionFactor;\n  #endif\n    }\n    pos.xy +\x3d joinDisplacementDir * sign(uv0.y) * displacementLen;\n    pos.xy +\x3d capDisplacementDir * displacementLen;\n    pos.xy /\x3d screenSize;\n    vtc \x3d uv0;\n    vColor \x3d getColor();\n    gl_Position \x3d pos;\n  }\n}"},
slicePlane:{"slicePlane.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\nuniform vec4 backgroundColor;\nuniform vec4 gridColor;\nuniform float ratio;\nuniform float gridWidth;\nvarying vec2 vUV;\nvoid main() {\n  const float LINE_WIDTH \x3d 1.0;\n  vec2 uvScaled \x3d vUV * gridWidth;\n  vec2 gridUV \x3d (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\n  vec2 grid \x3d (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\n  grid.x *\x3d step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\n  grid.y *\x3d step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\n  float gridFade \x3d max(grid.x, grid.y);\n  float gridAlpha \x3d gridColor.a * gridFade;\n  gl_FragColor \x3d\n    vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\n    vec4(gridColor.rgb, 1.0) * gridAlpha;\n}",
"slicePlane.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec2 vUV;\nvoid main(void) {\n  vUV \x3d uv0;\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n}"},water:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D texWaveNormal;\nuniform sampler2D texWavePerturbation;\n#include \x3cmaterials/water/waterDistortion.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#ifdef RECEIVE_SHADOWS\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\nvarying float linearDepth;\n#include \x3cutil/shadow.glsl\x3e\n#endif\n#include \x3cmaterials/water/waterSurface.glsl\x3e\nuniform vec4 waterColor;\nuniform vec3 lightingMainDirection;\nuniform vec3 lightingMainIntensity;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nvoid main() {\n  discardBySlice(vpos);\n  vec3 localUp \x3d vnormal;\n  vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n  vec3 n \x3d normalize(vtbnMatrix * tangentNormal);\n  vec3 v \x3d -normalize(vpos - camPos);\n  vec3 l \x3d normalize(-lightingMainDirection);\n  float shadow \x3d 1.0;\n#ifdef RECEIVE_SHADOWS\n    shadow \x3d 1.0 - evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#endif\n  vec4 final \x3d vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow), waterColor.w);\n  gl_FragColor \x3d delinearizeGamma(final);\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n}",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/water/normalsUtils.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform vec3 localOrigin;\nattribute vec3 position;\nattribute vec2 uv0;\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\nvoid main(void) {\n  vuv \x3d uv0;\n  vpos \x3d calculateVPos();\n  vnormal \x3d getLocalUp(vpos, localOrigin);\n  vtbnMatrix \x3d getTBNMatrix(vnormal);\n  gl_Position \x3d transformPosition(proj, view, vpos);\n  #ifdef RECEIVE_SHADOWS\n    linearDepth \x3d gl_Position.w;\n  #endif\n}",
"drapedColorPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform vec4 waterColor;\nvoid main() {\n  gl_FragColor \x3d waterColor;\n}","drapedColorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/water/normalsUtils.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform vec3 localOrigin;\nattribute vec3 position;\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\nvarying vec3 vpos;\nvoid main(void) {\n  vpos \x3d calculateVPos();\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}",
"normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D texWaveNormal;\nuniform sampler2D texWavePerturbation;\n#include \x3cmaterials/water/waterDistortion.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nuniform float timeElapsed;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvoid main() {\n  discardBySlice(vpos);\n  vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n  tangentNormal \x3d normalize(tangentNormal);\n  gl_FragColor \x3d vec4((tangentNormal + vec3(1.0)) * 0.5, 0.0);\n}",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/water/normalsUtils.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform vec3 localOrigin;\nattribute vec3 position;\nattribute vec2 uv0;\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\nvarying vec3 vpos;\nvarying vec2 vuv;\nvoid main(void) {\n  vuv \x3d uv0;\n  vpos \x3d calculateVPos();\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}",
"normalsUtils.glsl":"vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    return normalize(pos + origin);\n  #else\n    return vec3(0.0, 0.0, 1.0);\n  #endif\n}\nmat3 getTBNMatrix(in vec3 n) {\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    vec3 t \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n    vec3 b \x3d normalize(cross(n, t));\n    return mat3(t, b, n);\n  #else\n    vec3 t \x3d vec3(1.0, 0.0, 0.0);\n    vec3 b \x3d normalize(cross(n, t));\n    return mat3(t, b, n);\n  #endif\n}",
"waterDistortion.glsl":"uniform vec3 octaveTextureRepeat;\nuniform vec4 waveParams;\nuniform vec2 waveDirection;\nconst vec2  FLOW_JUMP \x3d vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n  return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\n  return texture2D(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n  return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\n  return fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\n  float progress \x3d computeProgress(uv, time);\n  return 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n  float flowStrength \x3d waveParams[2];\n  float flowOffset \x3d waveParams[3];\n  vec2 flowVector \x3d textureDenormalized2D(texFlow, uv) * flowStrength;\n  float progress \x3d computeProgress(uv, time + phaseOffset);\n  float weight \x3d computeWeight(uv, time + phaseOffset);\n  vec2 result \x3d uv;\n  result -\x3d flowVector * (progress + flowOffset);\n  result +\x3d phaseOffset;\n  result +\x3d (time - progress) * FLOW_JUMP;\n  return vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT \x3d 0.3737;\nconst float TIME_NOISE_STRENGTH \x3d 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n  float waveStrength \x3d waveParams[0];\n  vec2 waveMovement \x3d time * -_waveDir;\n  float timeNoise \x3d sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n  vec3 uv_A \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n  vec3 uv_B \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n  vec3 normal_A \x3d textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n  vec3 normal_B \x3d textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n  vec3 mixNormal \x3d normalize(normal_A + normal_B);\n  mixNormal.xy *\x3d waveStrength;\n  mixNormal.z \x3d sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n  return mixNormal;\n}\nvec3 getSurfaceNormal(vec2 _uv, float _time) {\n  float waveTextureRepeat \x3d waveParams[1];\n  return getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n}",
"waterSurface.glsl":"const vec3 fresnelSky \x3d  vec3(0.02, 1.0, 5.0);\nconst vec2 fresnelMaterial \x3d  vec2(0.02, 0.1);\nconst float roughness \x3d 0.06;\nconst vec3 skyZenitColor \x3d vec3(0, 0.6, 0.9);\nconst vec3 skyColor \x3d vec3(0.72, 0.92, 1.0);\n#include \x3cutil/pbrUtils.glsl\x3e\n#include \x3cutil/gamma.glsl\x3e\nPBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n  float exponent \x3d pow((1.0 - cosTheta), fresnelSky[2]);\n  return mix(zenit, horizon, exponent);\n}\nvec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow) {\n  vec3 seaWaterColor \x3d linearizeGamma(color);\n  vec3 h \x3d normalize(l + v);\n  shadingInfo.NdotL \x3d clamp(dot(n, l), 0.0, 1.0);\n  shadingInfo.NdotV \x3d clamp(dot(n, v), 0.001, 1.0);\n  shadingInfo.VdotN \x3d clamp(dot(v, n), 0.001, 1.0);\n  shadingInfo.NdotH \x3d clamp(dot(n, h), 0.0, 1.0);\n  shadingInfo.VdotH \x3d clamp(dot(v, h), 0.0, 1.0);\n  shadingInfo.LdotH \x3d clamp(dot(l, h), 0.0, 1.0);\n  float upDotV \x3d max(dot(localUp,v), 0.0);\n  vec3 skyHorizon \x3d linearizeGamma(skyColor);\n  vec3 skyZenit \x3d linearizeGamma(skyZenitColor);\n  vec3 skyColor \x3d getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n  float upDotL \x3d max(dot(localUp,l),0.0);\n  skyColor *\x3d 0.1 + upDotL * 0.9;\n  float shadowModifier \x3d clamp(shadow, 0.8, 1.0);\n  vec3 reflSky \x3d fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]) * skyColor * shadowModifier;\n  vec3 reflSea \x3d seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n  vec3 specular \x3d vec3(0.0);\n  if(upDotV \x3e 0.0 \x26\x26 upDotL \x3e 0.0) {\n    vec3 specularSun \x3d brdfWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n    vec3 incidentLight \x3d lightIntensity * LIGHT_NORMALIZATION * shadow;\n    specular \x3d shadingInfo.NdotL * incidentLight * specularSun;\n  }\n  return tonemapACES(reflSky + reflSea + specular);\n}"}},
misc:{"blendLayers.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nvarying vec2 uv;\nuniform sampler2D tex;\nuniform float opacity;\nvoid main() {\n  vec4 color \x3d texture2D(tex, uv);\n  gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n}","blendLayers.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec3 position;\nattribute vec2 uv0;\nuniform float scale;\nuniform vec2 offset;\nvarying vec2 uv;\nvoid main(void) {\n  gl_Position \x3d vec4(position, 1.0);\n  uv \x3d uv0 * scale + offset;\n}",
"texOnly.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nuniform vec4 color;\nvarying vec2 vtc;\nvoid main() {\n  vec4 texColor \x3d texture2D(tex, vtc);\n  gl_FragColor \x3d texColor * color;\n}","texOnly.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec2 vtc;\nvoid main(void) {\n  gl_Position \x3d vec4(position, 1.0);\n  vtc \x3d uv0;\n}"},pointRenderer:{"pointRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#ifdef HIGHLIGHT_PASS\n#include \x3cutil/highlight.glsl\x3e\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n#endif\n#ifdef DEPTH_PASS\nvarying float depth;\n#elif defined(HIGHLIGHT_PASS)\n#else\nvarying vec3 vColor;\n#endif\nvoid main(void) {\n  vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\n  float r2 \x3d dot(vOffset, vOffset);\n  if (r2 \x3e 0.25) {\n    discard;\n  }\n#ifdef DEPTH_PASS\n  gl_FragColor \x3d float2rgba(depth);\n#elif defined(HIGHLIGHT_PASS)\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n#else\n  gl_FragColor \x3d vec4(vColor, 1.0);\n#endif\n}",
"pointRenderer.vert":"#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec3 aPosition;\nattribute vec3 aColor;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform vec2 uScreenMinMaxSize;\nuniform vec2 uPointScale;\nuniform vec3 uClipMin;\nuniform vec3 uClipMax;\n#ifdef DEPTH_PASS\nuniform vec2 nearFar;\nvarying float depth;\n#else\nvarying vec3 vColor;\n#endif\nvoid main(void) {\n  if (aPosition.x \x3c uClipMin.x || aPosition.y \x3c uClipMin.y || aPosition.z \x3c uClipMin.z ||\n      aPosition.x \x3e uClipMax.x || aPosition.y \x3e uClipMax.y || aPosition.z \x3e uClipMax.z) {\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n    gl_PointSize \x3d 0.0;\n    return;\n  }\n  if (rejectBySlice(aPosition)) {\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n    gl_PointSize \x3d 0.0;\n    return;\n  }\n  vec4 camera \x3d uModelViewMatrix * vec4(aPosition, 1.0);\n  float pointSize \x3d uPointScale.x;\n  vec4 position \x3d uProjectionMatrix * camera;\n#ifdef DRAW_SCREEN_SIZE\n    float clampedScreenSize \x3d pointSize;\n#else\n    float pointRadius \x3d 0.5 * pointSize;\n    vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\n    vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\n    float radius \x3d abs(positionOffset.y - position.y);\n    float viewHeight \x3d uPointScale.y;\n    float screenPointSize \x3d (radius / position.w) * viewHeight;\n    float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n    camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n    position \x3d uProjectionMatrix * camera;\n#endif\n  gl_PointSize \x3d clampedScreenSize;\n  gl_Position \x3d position;\n#ifdef DEPTH_PASS\n  depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n#else\n  vColor \x3d aColor;\n#endif\n}"},
renderer:{highlight:{"apply.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nuniform sampler2D origin;\nuniform vec4 color;\nuniform vec4 haloColor;\nuniform float outlineSize;\nuniform float blurSize;\nuniform vec4 opacities;\nvarying vec2 uv;\nvoid main() {\n  #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\n    gl_FragColor \x3d vec4(uv, 0.0, 1.0);\n  #else\n    vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n    float highlightIntensity \x3d blurredHighlightValue.a;\n    if (highlightIntensity \x3d\x3d 0.0) {\n      discard;\n    }\n    vec4 origin_color \x3d texture2D(origin, uv);\n    float outlineIntensity;\n    float fillIntensity;\n    if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n      outlineIntensity \x3d haloColor.w * opacities[1];\n      fillIntensity \x3d color.w * opacities[3];\n    }\n    else {\n      outlineIntensity \x3d haloColor.w * opacities[0];\n      fillIntensity \x3d color.w * opacities[2];\n    }\n    float inner \x3d 1.0 - outlineSize / 9.0;\n    float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n    float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n    float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n    float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n    gl_FragColor \x3d vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n  #endif\n}",
"apply.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nvarying vec2 uv;\n#ifdef GRID_OPTIMIZATION\n  attribute vec2 uv0;\n  uniform sampler2D coverageTex;\n#endif\nvoid main() {\n  #ifdef GRID_OPTIMIZATION\n    #ifdef GRID_DEBUG\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\n        gl_Position \x3d vec4(0.0);\n        return;\n      }\n      gl_Position \x3d vec4(position, .0, 1.0);\n      uv \x3d uv0;\n      return;\n    #else\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0.0);\n        return;\n      }\n    #endif\n  #endif\n  gl_Position \x3d vec4(position, .0, 1.0);\n  uv \x3d position.xy * .5 + vec2(.5);\n}",
"blur.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\n#ifdef GRID_OPTIMIZATION\n  uniform vec2 blurSize;\n  varying vec3 blurCoordinate;\n#else\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n#endif\nvoid main() {\n  #ifdef GRID_OPTIMIZATION\n    vec2 uv \x3d blurCoordinate.xy;\n    vec4 center \x3d texture2D(tex, uv);\n    if (blurCoordinate.z \x3d\x3d 1.0) {\n      gl_FragColor \x3d center;\n    }\n    else {\n      vec4 sum \x3d vec4(0.0);\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\n        sum +\x3d center * 0.204164;\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n        sum +\x3d center * 0.204164;\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n        sum +\x3d center * 0.204164;\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n        sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\n        sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n        sum +\x3d center * 0.154164;\n        sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\n        sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\n        sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\n        sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\n        sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\n        sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\n        sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\n        sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\n      #endif\n      gl_FragColor \x3d sum;\n    }\n  #else\n    vec4 sum \x3d vec4(0.0);\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\n      sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\n      sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\n    #endif\n    gl_FragColor \x3d sum;\n  #endif\n}",
"blur.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nattribute vec2 uv0;\n#ifdef GRID_OPTIMIZATION\n  uniform sampler2D coverageTex;\n  varying vec3 blurCoordinate;\n#else\n  uniform vec2 blurSize;\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n#endif\nvoid main() {\n  gl_Position \x3d vec4(position, 0.0, 1.0);\n  #ifdef GRID_OPTIMIZATION\n    vec4 cov \x3d texture2D(coverageTex, uv0);\n    if (cov.r \x3d\x3d 0.0) {\n      gl_Position \x3d vec4(0.0);\n    }\n    blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\n  #else\n    vec2 uv \x3d position.xy * .5 + vec2(.5);\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\n      blurCoordinates[7] \x3d uv + blurSize * 7.1;\n      blurCoordinates[8] \x3d uv - blurSize * 7.1;\n    #endif\n  #endif\n}",
"downsample.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nuniform vec2 invFramebufferDim;\nvoid main() {\n  vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n  vec4 value \x3d texture2D(tex, coord);\n  float mx \x3d floor(max(value.g, value.b));\n  gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n}","downsample.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nvoid main() {\n  gl_Position \x3d vec4(vec2(1.0) - position * 2.0, .0, 1.0);\n}"},
laserLine:{"laserLine.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\nuniform sampler2D depthMap;\nuniform vec2 nearFar;\nuniform vec4 projInfo;\nuniform vec2 zScale;\nuniform float maxPixelDistance;\nuniform vec4 focusPlane;\nuniform vec4 focusSphere;\nuniform vec4 segmentPlane;\nuniform vec3 segmentStart;\nuniform vec3 segmentEnd;\nuniform vec3 glowColor;\nuniform float glowWidth;\nuniform vec3 innerColor;\nuniform float innerWidth;\nuniform float globalAlpha;\nvarying vec2 uv;\n#define INFINITY 100000.0\nvec3 reconstructPosition(vec2 fragCoord, float depth) {\n  return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n}\nfloat planeDistancePixels(vec4 plane, vec3 pos) {\n  float dist \x3d dot(plane.xyz, pos) + plane.w;\n  float width \x3d fwidth(dist);\n  dist /\x3d min(width, maxPixelDistance);\n  return abs(dist);\n}\nfloat sphereDistancePixels(vec4 sphere, vec3 pos) {\n  float dist \x3d distance(sphere.xyz, pos) - sphere.w;\n  float width \x3d fwidth(dist);\n  dist /\x3d min(width, maxPixelDistance);\n  return abs(dist);\n}\nvec4 blendPremultiplied(vec4 source, vec4 dest) {\n  float oneMinusSourceAlpha \x3d 1.0 - source.a;\n  return vec4(\n    source.rgb + dest.rgb * oneMinusSourceAlpha,\n    source.a + dest.a * oneMinusSourceAlpha\n  );\n}\nvec4 premultipliedColor(vec3 rgb, float alpha) {\n  return vec4(rgb * alpha, alpha);\n}\nvec4 laserLineProfile(float dist) {\n  if (dist \x3e glowWidth) {\n    return vec4(0.0);\n  }\n  float innerAlpha \x3d (1.0 - smoothstep(0.0, innerWidth, dist));\n  float glowAlpha \x3d pow(max(0.0, 1.0 - dist / glowWidth), 8.0);\n  return blendPremultiplied(\n    premultipliedColor(innerColor, innerAlpha),\n    premultipliedColor(glowColor, glowAlpha)\n  );\n}\nvoid main() {\n  float depth \x3d linearDepth(depthMap, uv, nearFar);\n  if (-depth \x3d\x3d nearFar[0]) {\n    discard;\n  }\n  vec3 pos \x3d reconstructPosition(gl_FragCoord.xy, depth);\n  float ddepth \x3d fwidth(depth);\n  float depthDiscontinuityAlpha \x3d 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n  vec3 normal \x3d normalize(cross(dFdx(pos), dFdy(pos)));\n  float focusPlaneDistance \x3d planeDistancePixels(focusPlane, pos);\n  float focusSphereDistance \x3d sphereDistancePixels(focusSphere, pos);\n  float segmentDistance \x3d INFINITY;\n  float segmentLength \x3d length(segmentEnd - segmentStart);\n  vec3 segmentDir \x3d (segmentEnd - segmentStart) / segmentLength;\n  float t \x3d dot(segmentDir, pos - segmentStart);\n  if (segmentLength \x3e 0.0 \x26\x26 t \x3e\x3d 0.0 \x26\x26 t \x3c\x3d segmentLength) {\n    segmentDistance \x3d planeDistancePixels(segmentPlane, pos);\n  }\n  vec4 focusPlaneColor \x3d laserLineProfile(focusPlaneDistance);\n  vec4 focusSphereColor \x3d laserLineProfile(focusSphereDistance);\n  vec4 segmentColor \x3d laserLineProfile(segmentDistance);\n  float focusPlaneAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, focusPlane.xyz)));\n  float focusSphereAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, normalize(pos - focusSphere.xyz))));\n  float segmentAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, segmentPlane.xyz)));\n  vec4 color \x3d max(\n    focusPlaneColor * focusPlaneAlpha,\n    max(\n      focusSphereColor * focusSphereAlpha,\n      segmentColor * segmentAlpha\n    )\n  );\n  gl_FragColor \x3d color * globalAlpha * depthDiscontinuityAlpha;\n}"},
offscreen:{"composite.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nvarying vec2 vtc;\nvoid main() {\n  gl_FragColor \x3d texture2D(tex, vtc);\n}","compositeOccluded.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D occludedColorMap;\nuniform float opacity;\nvarying vec2 vtc;\nvoid main() {\n  vec4 occludedColor \x3d texture2D(occludedColorMap, vtc);\n  gl_FragColor \x3d occludedColor * opacity;\n}","compositeTransparentToHUDVisibility.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nvarying vec2 vtc;\nvoid main() {\n  gl_FragColor \x3d vec4(1.0 - texture2D(tex, vtc).a);\n}",
"offscreen.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nvarying vec2 vtc;\nvoid main(void) {\n  gl_Position \x3d vec4(position.xy, 0.0, 1.0);\n  vtc \x3d position.xy * 0.5 + 0.5;\n}"},ssao:{"blur.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\n#ifndef RADIUS\n#define RADIUS 4\n#endif\nuniform sampler2D normalMap;\nuniform sampler2D depthMap;\nuniform sampler2D tex;\nuniform vec2 blurSize;\nuniform float g_BlurFalloff;\nuniform float projScale;\nuniform vec2 nearFar;\nuniform vec2 zScale;\nvarying vec2 uv;\nfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n  float c \x3d texture2D(tex, uv).r;\n  float d \x3d linearDepth(depthMap, uv, nearFar);\n  float ddiff \x3d d - center_d;\n  float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n  w_total +\x3d w;\n  return w*c;\n}\nvoid main(void) {\n  float b \x3d 0.0;\n  float w_total \x3d 0.0;\n  float center_d \x3d linearDepth(depthMap, uv, nearFar);\n  float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\n  for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\n    float rf \x3d float(r);\n    vec2 uvOffset \x3d uv + rf*blurSize;\n    b +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\n  }\n  gl_FragColor \x3d vec4(b/w_total);\n}",
"ssao.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\n#ifndef SAMPLES\n#define SAMPLES 4\n#endif\nuniform mat4 projMatrixInv;\nuniform sampler2D normalMap;\nuniform sampler2D depthMap;\nuniform float intensity;\nuniform float projScale;\nuniform float radius;\nuniform vec2 nearFar;\nuniform vec4 projInfo;\nuniform vec2 screenDimensions;\nuniform vec3 pSphere[SAMPLES];\nuniform vec2 rnmScale;\nuniform sampler2D rnm;\nuniform vec2 zScale;\nvarying vec2  uv;\nvarying vec4  camPos;\nfloat fallOffFunction(float vv, float vn, float bias) {\n  float radius2 \x3d radius * radius;\n  float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n}\nfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n  vec3 v \x3d Q - C;\n  float vv \x3d dot(v, v);\n  float vn \x3d dot(normalize(v), n_C);\n  return fallOffFunction(vv, vn, 0.1);\n}\nvec3 reconstructCSPosition(vec2 S, float z) {\n  return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\n}\nvoid main(void) {\n  vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n  float currentPixelDepth \x3d linearDepth(depthMap, uv, nearFar);\n  if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n    gl_FragColor \x3d vec4(0.0);\n    return;\n  }\n  vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\n  vec4 norm4 \x3d texture2D(normalMap, uv);\n  vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n  bool isTerrain \x3d norm4.w\x3c0.5;\n  float sum \x3d .0;\n  vec4 occluderFragment;\n  vec3 ray;\n  vec3 tapPixelPos;\n  float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n  for(int i \x3d 0; i \x3c SAMPLES; ++i) {\n    vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n    vec2 offset \x3d vec2(-unitOffset*radius*ps);\n    if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n    vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n    if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n    vec2 tcTap \x3d tc/screenDimensions;\n    float occluderFragmentDepth \x3d linearDepth(depthMap, tcTap, nearFar);\n    if (isTerrain) {\n      bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n      if (isTerrainTap) {\n        continue;\n      }\n    }\n    tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\n    sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n  }\n  float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\n  A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n  gl_FragColor \x3d vec4(A);\n}"}},
terrainRenderer:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/sceneLighting.glsl\x3e\n#include \x3cutil/screenSizePerspective.glsl\x3e\n#include \x3cutil/shadow.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cterrainRenderer/overlay.glsl\x3e\nuniform vec3 camPos;\nuniform vec3 viewDirection;\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\nuniform sampler2D tex;\nuniform float opacity;\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvarying vec2 vtc;\n#if defined(TILE_BORDERS)\nvarying vec2 vuv;\n#endif\n#ifdef ATMOSPHERE\nvarying vec3 wnormal;\nvarying vec3 wlight;\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspective;\nvarying float screenSizeDistanceToCamera;\nvarying float screenSizeCosAngle;\n#endif\nconst vec3 ambient \x3d vec3(0.2, 0.2, 0.2);\nconst vec3 diffuse \x3d vec3(0.8, 0.8, 0.8);\nconst float diffuseHardness \x3d 2.5;\nconst float sliceOpacity \x3d 0.2;\n#ifdef OVERLAY\nuniform sampler2D ovInnerColorTex;\nuniform sampler2D ovOuterColorTex;\nuniform sampler2D ovInnerWaterTex;\nuniform sampler2D ovOuterWaterTex;\nuniform float overlayOpacity;\nvarying vec4 vtcOverlay;\nvarying vec3 tbnTangent;\nvarying vec3 tbnBiTangent;\n#endif\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\nfloat lum(vec3 c) {\n  float max \x3d max(max(c.r, c.g), c.b);\n  float min \x3d min(min(c.r, c.g), c.b);\n  return (min + max) * 0.5;\n}\n#ifdef ATMOSPHERE\nvec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n  vec3 surfaceColor   \x3d vec3(0.0);\n  vec3 fuzzySpecColor \x3d vec3(1.0);\n  vec3 subColor       \x3d vec3(0.0);\n  float rollOff       \x3d 1.0;\n  vec3 Ln \x3d normalize(lightPos);\n  vec3 Nn \x3d normalize(normal);\n  vec3 Hn \x3d normalize(view + Ln);\n  float ldn \x3d dot(Ln, Nn);\n  float diffComp \x3d max(0.0, ldn);\n  float vdn \x3d clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n  float ndv \x3d dot(view, Ln);\n  vec3 diffContrib \x3d surfaceColor * diffComp;\n  float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n  vec3 subContrib \x3d subLamb * subColor;\n  vec3 vecColor \x3d vec3(vdn);\n  vec3 diffuseContrib \x3d (subContrib + diffContrib);\n  vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n  return (diffContrib + specularContrib) * rollOff;\n}\n#endif\nvoid main() {\n  float shadow \x3d 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#endif\n  float vndl \x3d dot(normalize(vnormal), -lightingMainDirection);\n  float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n  vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n  float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  vec4 tileColor \x3d texture2D(tex, vtc) * opacity;\n#ifdef OVERLAY\n  vec4 overlayColor  \x3d overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n  tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;\n#endif\n  if (rejectBySlice(vpos)) {\n    tileColor *\x3d sliceOpacity;\n  }\n  vec3 atm \x3d vec3(0.0);\n#ifdef ATMOSPHERE\n  float ndotl \x3d max(0.0, min(1.0, vndl));\n  atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n  atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5)));\n  atm *\x3d max(0.0, min(1.0, ndotl*2.0));\n  atm *\x3d tileColor.a;\n#endif\n  vec3 albedo \x3d atm + tileColor.rgb;\n  vec3 normal \x3d normalize(vnormal);\n  float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n  vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n  gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n#ifdef OVERLAY\n  vec4 overlayWaterMask \x3d getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n  float waterNormalLength \x3d length(overlayWaterMask);\n  if (waterNormalLength \x3e 0.95) {\n    mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, vnormal);\n    vec4 waterColor \x3d overlayOpacity * getOverlayWaterColor(tileColor, overlayWaterMask, overlayColor, vpos, shadow, vnormal, camPos, tbnMatrix);\n    vec4 groundColor \x3d vec4(pow(gl_FragColor.rgb, vec3(2.2)), gl_FragColor.w);\n    waterColor \x3d mix(groundColor, waterColor, waterColor.a);\n    gl_FragColor \x3d delinearizeGamma(waterColor);\n  }\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n  if (perspectiveScale \x3c\x3d 0.25) {\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n  }\n  else if (perspectiveScale \x3c\x3d 0.5) {\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n  }\n  else if (perspectiveScale \x3e\x3d 0.99) {\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n  }\n  else {\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n  }\n#endif\n#if defined(TILE_BORDERS)\n  vec2 dVuv \x3d fwidth(vuv);\n  vec2 edgeFactors \x3d smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n  float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n  gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\n#endif\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n}",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cterrainRenderer/skirts.glsl\x3e\n#include \x3cmaterials/water/normalsUtils.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec3 origin;\nuniform vec4 texOffsetAndScale;\nuniform mat4 viewNormal;\nuniform float skirtScale;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvarying vec2 vtc;\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n#if defined(TILE_BORDERS)\nvarying vec2 vuv;\n#endif\n#ifdef ATMOSPHERE\nuniform vec3 lightingMainDirection;\nvarying vec3 wnormal;\nvarying vec3 wlight;\n#endif\n#ifdef OVERLAY\nuniform vec4 overlayTexOffset;\nuniform vec4 overlayTexScale;\nvarying vec4 vtcOverlay;\nvarying vec3 tbnTangent;\nvarying vec3 tbnBiTangent;\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspective;\nvarying float screenSizeDistanceToCamera;\nvarying float screenSizeCosAngle;\n#endif\nvoid main(void) {\n  vpos \x3d position;\n  vnormal \x3d getLocalUp(vpos, origin);\n  vec2 uv \x3d uv0;\n  vpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\n#ifdef ATMOSPHERE\n  wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n  wlight \x3d (view  * vec4(-lightingMainDirection, 1.0)).xyz;\n#endif\n#if defined(TILE_BORDERS)\n  vuv \x3d uv;\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n  screenSizeDistanceToCamera \x3d length(viewPos);\n  vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n  screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\n#endif\n  gl_Position \x3d transformPosition(proj, view, vpos);\n#ifdef RECEIVE_SHADOWS\n  linearDepth \x3d gl_Position.w;\n#endif\n  vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n#ifdef OVERLAY\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), vnormal));\n    tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));\n  #else\n    tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n    tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));\n  #endif\n#endif\n}",
"depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\nvarying float depth;\nvoid main() {\n#ifndef BIAS_SHADOWMAP\n  gl_FragColor \x3d float2rgba(depth);\n#else\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\n#endif\n}","depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cterrainRenderer/skirts.glsl\x3e\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec2 nearFar;\nuniform float skirtScale;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying float depth;\nvoid main(void) {\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  vec3 normal \x3d normalize(position + origin);\n#else\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\n#endif\n  vec2 uv \x3d uv0;\n  vec3 vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n  gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n}",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/highlight.glsl\x3e\n#include \x3cterrainRenderer/overlay.glsl\x3e\nuniform sampler2D ovInnerColorTex;\nuniform sampler2D ovOuterColorTex;\nuniform float overlayOpacity;\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\nvarying vec4 vtcOverlay;\nvoid main() {\n  vec4 overlayColor \x3d getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay) * overlayOpacity;\n  if (overlayColor.a \x3d\x3d 0.0) {\n    gl_FragColor \x3d vec4(0.0);\n    return;\n  }\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cterrainRenderer/skirts.glsl\x3e\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec4 overlayTexScale;\nuniform vec4 overlayTexOffset;\nuniform float skirtScale;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec3 vpos;\nvarying vec4 vtcOverlay;\nvoid main() {\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    vec3 vnormal \x3d normalize(position + origin);\n  #else\n    vec3 vnormal \x3d vec3(0.0, 0.0, 1.0);\n  #endif\n  vec2 uv \x3d uv0;\n  vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}",
"normalPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvoid main() {\n  vec3 normal \x3d normalize(vnormal);\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n#ifndef ALPHA_ZERO\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n}","normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cterrainRenderer/skirts.glsl\x3e\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 viewNormal;\nuniform float skirtScale;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvoid main(void) {\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  vec4 normal \x3d vec4(normalize(position + origin), 1.0);\n#else\n  vec4 normal \x3d vec4(0.0, 0.0, 1.0, 1.0);\n#endif\n  vec2 uv \x3d uv0;\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n  gl_Position \x3d transformPosition(proj, view, vpos);\n  vnormal \x3d normalize((viewNormal * normal).xyz);\n}",
"overlay.glsl":"#include \x3cmaterials/water/waterSurface.glsl\x3e\n#include \x3cutil/color.glsl\x3e\nvec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n  vec4 color \x3d vec4(0.0);\n  vec4 color0 \x3d texture2D(ov0Tex, texCoords.xy);\n  vec4 color1 \x3d texture2D(ov1Tex, texCoords.zw);\n  if ((texCoords.x \x3e 0.0) \x26\x26 (texCoords.x \x3c 1.0) \x26\x26 (texCoords.y \x3e 0.0) \x26\x26 (texCoords.y \x3c 1.0)) {\n    color \x3d color0;\n  } else if ((texCoords.z \x3e 0.0) \x26\x26 (texCoords.z \x3c 1.0) \x26\x26 (texCoords.w \x3e 0.0) \x26\x26 (texCoords.w \x3c 1.0)) {\n    color \x3d color1;\n  }\n  return color;\n}\n#ifdef OVERLAY\nvec4 getOverlayWaterColor( in vec4 tileColor, vec4 maskInput, vec4 colorInput,\n                     vec3 vpos, float shadow, vec3 localUp, vec3 eye, mat3 tbn) {\n  vec3 n \x3d normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n  vec3 v \x3d -normalize(vpos - eye);\n  vec3 l \x3d normalize(-lightingMainDirection);\n  vec3 final \x3d getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow);\n  return premultiplyAlpha(vec4(final, colorInput.w));\n}\n#endif",
"skirts.glsl":"vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n  float skirtLength \x3d 0.0;\n  if (uv.x \x3e\x3d 2.0) {\n    skirtLength \x3d uv.y * skirtScale;\n    vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\n    uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n  }\n  return vpos - vnormal * skirtLength;\n}"},util:{"alignPixel.glsl":"vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n  vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n  vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n  return vec4(result, clipCoord.zw);\n}\nvec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n  vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n  vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n  return vec4(result, clipCoord.zw);\n}",
"color.glsl":"vec4 premultiplyAlpha(vec4 v) {\n  return vec4(v.rgb * v.a, v.a);\n}\nvec3 rgb2hsv(vec3 c) {\n  vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n  vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n  float d \x3d q.x - min(q.w, q.y);\n  float e \x3d 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\n  vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}",
"depth.glsl":"#include \x3cutil/encoding.glsl\x3e\nfloat linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n  return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n}\nfloat calcFragDepth(const in float depth) {\n  const float SLOPE_SCALE \x3d 2.0;\n  const float BIAS \x3d 2.0 * .000015259;\n  float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n  float result \x3d depth + SLOPE_SCALE * m + BIAS;\n  return clamp(result, .0, .999999);\n}","doublePrecision.glsl":"#ifdef REQUIRES_FLOAT_OPERATIONS_FIX\nvec3 dpPlusFrc(vec3 a, vec3 b) {\n  return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n}\nvec3 dpMinusFrc(vec3 a, vec3 b) {\n  return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n}\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n  vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n  vec3 e \x3d dpMinusFrc(t1, hiA);\n  vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n  return t1 + t2;\n}\n#else\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n  vec3 t1 \x3d hiA + hiB;\n  vec3 e \x3d t1 - hiA;\n  vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n  return t1 + t2;\n}\n#endif",
"enableExtensions.glsl":"#define EXTENSIONS_ENABLED\n#extension GL_OES_standard_derivatives : enable\n#extension GL_EXT_shader_texture_lod : enable","encoding.glsl":"const float MAX_RGBA_FLOAT \x3d\n  255.0 / 256.0 +\n  255.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 / 256.0;\nconst vec4 fixedPointFactors \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\nvec4 float2rgba(const float value) {\n  float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n  vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\n  const float toU8AsFloat \x3d 1.0 / 255.0;\n  return fixedPointU8 * toU8AsFloat;\n}\nconst vec4 rgba2float_factors \x3d vec4(\n  255.0 / (256.0),\n  255.0 / (256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}",
"fsPrecision.glsl":"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif","gamma.glsl":"const float GAMMA \x3d 2.2;\nconst float INV_GAMMA \x3d 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\n  return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\n  return pow(color, vec3(GAMMA));\n}","highlight.glsl":"vec4 highlightData(vec4 fragCoord, sampler2D depthTex, vec4 viewportPixelSize) {\n  float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - viewportPixelSize.xy) * viewportPixelSize.zw).r;\n  if (fragCoord.z \x3e sceneDepth + 5e-7) {\n    return vec4(1.0, 1.0, 0.0, 1.0);\n  }\n  else {\n    return vec4(1.0, 0.0, 1.0, 1.0);\n  }\n}",
"hud.glsl":"#include \x3cutil/screenSizePerspective.glsl\x3e\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 auxpos1;\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 viewNormal;\nuniform mat4 model;\nuniform mat4 modelNormal;\nuniform vec4 viewport;\nuniform vec3 camPos;\nuniform float polygonOffset;\nuniform float cameraGroundRelative;\nuniform float pixelRatio;\nuniform float perDistancePixelRatio;\n#ifdef VERTICAL_OFFSET\nuniform vec4 verticalOffset;\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspectiveAlignment;\n#endif\nuniform sampler2D hudVisibilityTexture;\nconst float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\nstruct ProjectHUDAux {\n  vec3 posModel;\n  vec3 posView;\n  vec3 vnormal;\n  float distanceToCamera;\n  float absCosAngle;\n};\nfloat applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n  float pointGroundSign \x3d sign(pointGroundDistance);\n  if (pointGroundSign \x3d\x3d 0.0) {\n    pointGroundSign \x3d cameraGroundRelative;\n  }\n  float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n  if (polygonOffset \x3e .0) {\n    float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n    float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n    float factor \x3d (1.0 - tanAlpha / viewport[2]);\n    if (groundRelative \x3e 0.0) {\n      posView *\x3d factor;\n    }\n    else {\n      posView /\x3d factor;\n    }\n  }\n  return groundRelative;\n}\nvoid applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n  float distanceToCamera \x3d length(posView);\n  float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\n  vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\n  vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n  posModel +\x3d modelOffset;\n  posView +\x3d viewOffset;\n}\nvec4 projectPositionHUD(out ProjectHUDAux aux) {\n  vec3 centerOffset \x3d auxpos1.xyz;\n  float pointGroundDistance \x3d auxpos1.w;\n  aux.posModel \x3d (model * vec4(position, 1.0)).xyz;\n  aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n  aux.vnormal \x3d (modelNormal * vec4(normal, 1.0)).xyz;\n  applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n  aux.distanceToCamera \x3d length(aux.posView);\n  vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n  float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n  aux.absCosAngle \x3d abs(cosAngle);\n#ifdef SCREEN_SIZE_PERSPECTIVE\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\n#endif\n#endif\n#ifdef VERTICAL_OFFSET\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\n#else\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\n#endif\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n  vec3 modelOffset \x3d aux.vnormal * worldOffset;\n  aux.posModel +\x3d modelOffset;\n  vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n  aux.posView +\x3d viewOffset;\n  pointGroundDistance +\x3d worldOffset;\n#endif\n  float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n#ifndef CENTER_OFFSET_UNITS_SCREEN\n  aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\n  if (centerOffset.z !\x3d 0.0) {\n    aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n  }\n#endif\n  vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n#ifdef CENTER_OFFSET_UNITS_SCREEN\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\n#else\n  float centerOffsetY \x3d centerOffset.y;\n#endif\n  posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;\n#endif\n  posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n  return posProj;\n}\nuniform float uRenderTransparentlyOccludedHUD;\nbool testVisibilityHUD(vec4 posProj) {\n  vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n  vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n  if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\n  }\n  return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\n}",
"normalEncoding.glsl":"vec3 decodeNormal(vec2 f) {\n    float z \x3d 1.0 - abs(f.x) - abs(f.y);\n    return vec3(f + sign(f) * min(z, 0.0), z);\n}","offset.glsl":"vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n  vec3 camToVert \x3d posWorld - camPosWorld;\n  bool isBackface \x3d dot(camToVert, normalWorld) \x3e 0.0;\n  if (isBackface) {\n    posClip.z +\x3d 0.0000003 * posClip.w;\n  }\n  return posClip;\n}","pbrUtils.glsl":"struct PBRShadingWater\n{\n    float NdotL;\n    float NdotV;\n    float NdotH;\n    float VdotH;\n    float LdotH;\n    float VdotN;\n};\n#ifdef USE_PBR\n  struct PBRShadingInfo\n  {\n      float NdotL;\n      float NdotV;\n      float NdotH;\n      float VdotH;\n      float LdotH;\n      float NdotNG;\n      float LdotNG;\n      float RdotNG;\n      float VdotNG;\n      float NdotAmbDir;\n      float NdotH_Horizon;\n      vec3 skyRadianceToSurface;\n      vec3 groundRadianceToSurface;\n      vec3 skyIrradianceToSurface;\n      vec3 groundIrradianceToSurface;\n      float averageAmbientRadiance;\n      #ifdef USE_PBR_CLEAR_COATING\n      vec3 skyRadianceToClearCoat;\n      vec3 groundRadianceToClearCoat;\n      #endif\n      float ssao;\n      vec3 groundReflectance;\n      vec3 albedoLinear;\n      vec3 f0;\n      vec3 f90;\n      vec3 f0_ClearCoating;\n      vec3 f90_ClearCoating;\n      vec3 diffuseColor;\n      float roughnessClearCoating;\n      float coating;\n      float metalness;\n      float roughness;\n  };\n  const float fillLightIntensity \x3d 0.25;\n  const float horizonLightDiffusion \x3d 0.4;\n  const vec3  skyTransmittance \x3d vec3(0.9, 0.9, 1.0);\n  const float additionalAmbientIrradianceFactor \x3d 0.02;\n  const vec3 clearCoatingFresnel \x3d vec3(0.04);\n#endif\nconst float PI \x3d 3.14159265359;\nconst float LIGHT_NORMALIZATION \x3d 1.0 / PI;\nconst float INV_PI \x3d 0.318309886;\nconst float HALF_PI \x3d 1.5707964;\n#ifdef OVERLAY\n  float dtrExponent \x3d 2.0;\n#else\n  float dtrExponent \x3d 2.2;\n#endif\n  vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n    return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n  }\nfloat normalDistributionWater(float NdotH, float roughness)\n{\n  float r2 \x3d roughness * roughness;\n  float NdotH2 \x3d NdotH * NdotH;\n  float denom \x3d pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n  return r2 / denom;\n}\nfloat geometricOcclusionKelemen(float LoH)\n{\n    return 0.25 / (LoH * LoH);\n}\nvec3 brdfWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n{\n  vec3  F \x3d fresnelReflection(props.VdotH, F0, F0Max);\n  float D \x3d normalDistributionWater(props.NdotH, roughness);\n  float V \x3d geometricOcclusionKelemen(props.LdotH);\n  return (D * V) * F;\n}\nvec3 tonemapACES(const vec3 x) {\n  return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n}\n#ifdef USE_PBR\n  vec3 fresnelReflection(float angle, vec3 f0, vec3 f90) {\n    return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n  }\n  vec3 calculateDiffuseReflectanceFactor(PBRShadingInfo inputs)\n  {\n    return (1.0 - inputs.metalness) * inputs.albedoLinear * INV_PI;\n  }\n  float normalDistribution(float NdotH, float roughness)\n  {\n      float a \x3d NdotH * roughness;\n      float b \x3d roughness / (1.0 - NdotH * NdotH + a * a);\n      return b * b * INV_PI;\n  }\n  float geometricOcclusion(float NdotV, float NdotL, float roughness)\n  {\n      float a2 \x3d roughness * roughness;\n      float GGXL \x3d NdotV * sqrt((-NdotL * a2 + NdotL) * NdotL + a2);\n      float GGXV \x3d NdotL * sqrt((-NdotV * a2 + NdotV) * NdotV + a2);\n      return 0.5 / (GGXV + GGXL);\n  }\n  float geometricOcclusion_Fast(float NdotV, float NdotL, float roughness)\n  {\n      float r_1 \x3d (roughness + 1.0);\n      float a \x3d r_1 * r_1 / 8.0;\n      float GGXV \x3d (NdotV * (1.0 - a) + a);\n      float GGXL \x3d (NdotL * (1.0 - a) + a);\n      return 0.25 / (GGXV + GGXL);\n  }\n  float geometricOcclusionKelemenClearCoat(float LoH)\n  {\n      return 0.25 / (LoH * LoH);\n  }\n  vec3 calculateSpecularReflectanceFactor(PBRShadingInfo inputs, float roughness, vec3 f0, vec3 f90)\n  {\n    vec3  F \x3d fresnelReflection(inputs.VdotH, f0, f90);\n    float D \x3d normalDistribution(inputs.NdotH, roughness);\n    float V \x3d geometricOcclusion(inputs.NdotV, inputs.NdotL, roughness);\n      return (D * V) * F;\n  }\n  vec3 brdfPBR(PBRShadingInfo inputs)\n  {\n    vec3 diffuseComponent  \x3d calculateDiffuseReflectanceFactor(inputs);\n    vec3 specularComponent   \x3d calculateSpecularReflectanceFactor(inputs, inputs.roughness, inputs.f0, inputs.f90);\n    #ifdef USE_PBR_CLEAR_COATING\n      vec3  Fc \x3d fresnelReflection(inputs.LdotH, inputs.f0_ClearCoating, , inputs.f90_ClearCoating) * inputs.coating;\n      float Vc \x3d geometricOcclusionKelemenClearCoat(inputs.LdotH);\n      float Dc \x3d normalDistribution(inputs.NdotH, inputs.roughnessClearCoating);\n      vec3 specularComponentCoating \x3d  (Dc * Vc) * Fc;\n      vec3 complFc \x3d (1.0-Fc);\n      return (1.0 - inputs.ssao) * (diffuseComponent * complFc + specularComponent * complFc * complFc + specularComponentCoating);\n    #else\n      return (1.0 - inputs.ssao) * (diffuseComponent + specularComponent);\n    #endif\n  }\n  vec2 prefilteredDFG_Analytical(float roughness, float NdotV) {\n      const vec4 c0 \x3d vec4(-1.0, -0.0275, -0.572,  0.022);\n      const vec4 c1 \x3d vec4( 1.0,  0.0425,  1.040, -0.040);\n      vec4 r \x3d roughness * c0 + c1;\n      float a004 \x3d min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n      return vec2(-1.04, 1.04) * a004 + r.zw;\n  }\n  vec3 evaluateDiffuseIllumination_Hemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n  {\n    float ground \x3d 1.0 - NdotNG;\n    float sky \x3d 1.0 + NdotNG;\n    return (ground * ambientGround + sky * ambientSky)  * 0.5;\n  }\n  vec3 evaluateIrradianceIntegral(float firstAngle, float secondAngle, vec3 ambientGround, vec3 ambientSky)\n  {\n    float sin_firstAngleClamped \x3d sin(clamp(firstAngle, 0.0, HALF_PI));\n    float sin_secondAngleClamped \x3d sin(clamp(secondAngle, 0.0, HALF_PI));\n    float ground \x3d sin_firstAngleClamped + 1.0 - sin_secondAngleClamped;\n    float sky \x3d sin_secondAngleClamped - sin_firstAngleClamped;\n    return ground * ambientGround + sky * ambientSky;\n  }\n  vec3 evaluateDiffuseIllumination_Cone(vec3 ambientGround, vec3 ambientSky, float NdotNG, float skyIlluminationAngle)\n  {\n    float theta \x3d acos(clamp(NdotNG, -1.0, 1.0));\n    float firstAngle \x3d HALF_PI + theta - skyIlluminationAngle;\n    float secondAngle \x3d HALF_PI + theta + skyIlluminationAngle;\n    vec3 LeftIntegral \x3d evaluateIrradianceIntegral(HALF_PI - secondAngle, HALF_PI - firstAngle, ambientGround, ambientSky);\n    vec3 RightIntegral \x3d evaluateIrradianceIntegral(firstAngle - HALF_PI, secondAngle - HALF_PI, ambientGround, ambientSky);\n    vec3 ambientDiffuseLight \x3d (LeftIntegral + RightIntegral)  * 0.5;\n    return ambientDiffuseLight;\n  }\n  float integratedRadiance(float cosTheta2, float roughness)\n  {\n    return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n  }\n  vec3 evaluateSpecularIllumination_Hemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n  {\n    float cosTheta2 \x3d 1.0 - RdotNG * RdotNG;\n    float intRadTheta \x3d integratedRadiance(cosTheta2, roughness);\n    float ground \x3d RdotNG \x3c 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n    float sky \x3d 2.0 - ground;\n    vec3 enviromentSpecularLight \x3d (ground * ambientGround + sky * ambientSky) * 0.5;\n    return enviromentSpecularLight;\n  }\n  vec3 evaluateRadianceIntegral(float firstAngle, float secondAngle, vec3 ambientGround, vec3 ambientSky, float roughness)\n  {\n    float firstAngleClamped \x3d clamp(firstAngle, 0.0, HALF_PI);\n    float secondAngleClamped \x3d clamp(secondAngle, 0.0, HALF_PI);\n    float ro \x3d roughness;\n    float intRadFirstAngle \x3d integratedRadiance(pow(cos(firstAngleClamped), 2.0), ro);\n    float intRadSecondAngle \x3d integratedRadiance(pow(cos(secondAngleClamped), 2.0), ro);\n    float ground \x3d intRadFirstAngle - integratedRadiance(1.0, ro) + integratedRadiance(0.0, ro) - intRadSecondAngle;\n    float sky \x3d intRadSecondAngle - intRadFirstAngle;\n    return ground * ambientGround + sky * ambientSky;\n  }\n  vec3 evaluateSpecularIllumination_Cone(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness, float skyIlluminationAngle)\n  {\n    float theta \x3d acos(clamp(RdotNG, -1.0, 1.0));\n    float firstPoint \x3d - HALF_PI + theta + skyIlluminationAngle;\n    float secondPoint \x3d - HALF_PI + theta - skyIlluminationAngle;\n    vec3 LeftIntegral \x3d evaluateRadianceIntegral(HALF_PI - firstPoint, HALF_PI - secondPoint, ambientGround, ambientSky, roughness);\n    vec3 RightIntegral \x3d evaluateRadianceIntegral(secondPoint - HALF_PI, firstPoint - HALF_PI, ambientGround, ambientSky, roughness);\n    vec3 enviromentSpecularLight \x3d (LeftIntegral + RightIntegral) * 0.5;\n    return enviromentSpecularLight;\n  }\n  vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n    vec3 indirectDiffuse \x3d evaluateDiffuseIllumination_Hemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n    vec3 indirectSpecular \x3d evaluateSpecularIllumination_Hemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n    vec3 diffuseComponent \x3d inputs.diffuseColor * indirectDiffuse * INV_PI;\n    vec2 dfg \x3d prefilteredDFG_Analytical(inputs.roughness, inputs.NdotV);\n    vec3 specularColor \x3d inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n    vec3 specularComponent \x3d specularColor * indirectSpecular;\n    #ifdef USE_PBR_CLEAR_COATING\n      vec3 Fc \x3d fresnelReflection(inputs.NdotV, inputs.f0_ClearCoating) * inputs.coating;\n      diffuseComponent  *\x3d 1.0 - Fc;\n      specularComponent *\x3d (1.0 - Fc) * (1.0 - Fc);\n      specularComponent +\x3d evaluateSpecularIllumination_Hemisphere(inputs.groundRadianceToClearCoat, inputs.skyRadianceToClearCoat, inputs.RdotNG, inputs.roughnessClearCoating) * Fc;\n    #endif\n    return (diffuseComponent + specularComponent);\n  }\n  float gamutMapChanel(float x, vec2 p){\n    return (x \x3c p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n  }\n  vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n    vec3 outColor;\n    vec2 p \x3d vec2(0.02*(inputs.averageAmbientRadiance), 0.0075*(inputs.averageAmbientRadiance));\n    outColor.x \x3d gamutMapChanel(inColor.x, p) ;\n    outColor.y \x3d gamutMapChanel(inColor.y, p) ;\n    outColor.z \x3d gamutMapChanel(inColor.z, p) ;\n    return outColor;\n  }\n#endif",
"quad.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nvarying vec2 uv;\nvoid main(void) {\n  gl_Position \x3d vec4(position.x, position.y, .0, 1.0);\n  uv \x3d position * .5 + vec2(.5);\n}","sceneLighting.glsl":"#include \x3cutil/pbrUtils.glsl\x3e\nuniform vec3 lightingMainDirection;\nuniform vec3 lightingMainIntensity;\n#ifndef SH_ORDER\n  #define SH_ORDER 2\n#endif\n#if SH_ORDER \x3d\x3d 0\n  uniform vec3 lightingAmbientSH0;\n#elif SH_ORDER \x3d\x3d 1\n  uniform vec4 lightingAmbientSH_R;\n  uniform vec4 lightingAmbientSH_G;\n  uniform vec4 lightingAmbientSH_B;\n#elif SH_ORDER \x3d\x3d 2\n  uniform vec3 lightingAmbientSH0;\n  uniform vec4 lightingAmbientSH_R1;\n  uniform vec4 lightingAmbientSH_G1;\n  uniform vec4 lightingAmbientSH_B1;\n  uniform vec4 lightingAmbientSH_R2;\n  uniform vec4 lightingAmbientSH_G2;\n  uniform vec4 lightingAmbientSH_B2;\n#endif\nuniform float lightingFixedFactor;\nuniform float lightingGlobalFactor;\nuniform float ambientBoostFactor;\nconst float GROUND_REFLECTANCE \x3d 0.2;\nconst float GAMMA_SRGB \x3d 2.1;\nconst float INV_GAMMA_SRGB \x3d 0.4761904;\n#ifdef USE_PBR\n  #ifdef USE_PBR_CLEAR_COATING\n    uniform float clearCoating;\n    uniform float clearCoatRoughness;\n  #endif\n#endif\n#ifdef USE_PBR\n  vec3 calculateAmbientRadiance(float ssao)\n  {\n    vec3 ambientLight ;\n    ambientLight \x3d 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n    return ambientLight *\x3d (1.0 - ssao) * skyTransmittance;\n  }\n#endif\nvec3 calculateAmbientIrradiance(vec3 normal, float ssao)\n{\n  #if SH_ORDER \x3d\x3d 0\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n  #elif SH_ORDER \x3d\x3d 1\n    vec4 sh0 \x3d vec4(\n      0.282095,\n      0.488603 * normal.x,\n      0.488603 * normal.z,\n      0.488603 * normal.y\n    );\n    vec3 ambientLight \x3d vec3(\n      dot(lightingAmbientSH_R, sh0),\n      dot(lightingAmbientSH_G, sh0),\n      dot(lightingAmbientSH_B, sh0)\n    );\n  #elif SH_ORDER \x3d\x3d 2\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n    vec4 sh1 \x3d vec4(\n      0.488603 * normal.x,\n      0.488603 * normal.z,\n      0.488603 * normal.y,\n      1.092548 * normal.x * normal.y\n    );\n    vec4 sh2 \x3d vec4(\n      1.092548 * normal.y * normal.z,\n      0.315392 * (3.0 * normal.z * normal.z - 1.0),\n      1.092548 * normal.x * normal.z,\n      0.546274 * (normal.x * normal.x - normal.y * normal.y)\n    );\n    ambientLight +\x3d vec3(\n      dot(lightingAmbientSH_R1, sh1),\n      dot(lightingAmbientSH_G1, sh1),\n      dot(lightingAmbientSH_B1, sh1)\n    );\n    ambientLight +\x3d vec3(\n      dot(lightingAmbientSH_R2, sh2),\n      dot(lightingAmbientSH_G2, sh2),\n      dot(lightingAmbientSH_B2, sh2)\n    );\n  #endif\n  ambientLight *\x3d (1.0 - ssao);\n  return ambientLight;\n}\nvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n  #if defined(TREE_RENDERING)\n    float minDot \x3d -0.5;\n    float dotRange \x3d 1.0 - minDot;\n    float dotNormalization \x3d 0.66;\n    float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n  #else\n    float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n  #endif\n  dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n  vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n  vec3 ambientLight \x3d calculateAmbientIrradiance(normal, ssao);\n  vec3 albedoGammaC \x3d pow(albedo, vec3(GAMMA_SRGB));\n  vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n  totalLight \x3d min(totalLight, vec3(PI, PI, PI));\n  vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n  outColor \x3d pow(outColor, vec3(1.0/GAMMA_SRGB));\n  return outColor;\n}\nvec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    float vndl \x3d -dot(normalize(worldPos), lightingMainDirection);\n#else\n    float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n#endif\n  additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n  return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n}\n#ifdef USE_PBR\n  vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, float _roughness, float _metalness, vec3 _emission, float _reflectance, float additionalAmbientIrradiance)\n  {\n      vec3 viewDirection \x3d - normalize(viewDir);\n      vec3 mainLightDirection \x3d -lightingMainDirection;\n      vec3 h \x3d normalize(viewDirection + mainLightDirection);\n      PBRShadingInfo inputs;\n      inputs.NdotL \x3d clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n      inputs.NdotV \x3d clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n      inputs.NdotH \x3d clamp(dot(normal, h), 0.0, 1.0);\n      inputs.VdotH \x3d clamp(dot(viewDirection, h), 0.0, 1.0);\n      inputs.NdotNG \x3d clamp(dot(normal, normalGround), -1.0, 1.0);\n      inputs.LdotNG \x3d clamp(dot(normalGround, mainLightDirection), 0.001, 1.0);\n      inputs.VdotNG \x3d clamp(dot(-viewDirection, normalGround), -1.0, 1.0);\n      vec3 reflectedView \x3d normalize(reflect(viewDirection, normal));\n      inputs.RdotNG \x3d clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n      inputs.albedoLinear \x3d pow(albedo, vec3(GAMMA_SRGB));\n      inputs.groundReflectance \x3d vec3(GROUND_REFLECTANCE);\n      inputs.ssao \x3d ssao;\n      inputs.roughness \x3d clamp(_roughness * _roughness, 0.001, 0.99);\n      inputs.metalness \x3d _metalness;\n      inputs.f0 \x3d (0.16 * _reflectance * _reflectance) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n      inputs.f90 \x3d vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));\n      inputs.diffuseColor \x3d inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      #ifdef USE_PBR_CLEAR_COATING\n        inputs.f0_ClearCoating \x3d clearCoatingFresnel;\n        inputs.f90_ClearCoating \x3d vec3(clamp(dot(inputs.f0_ClearCoating, vec3(50.0 * 0.33)), 0.0, 1.0));\n        float clearCoatRoughnessLinear \x3d mix(0.089, 0.6, clearCoatRoughness);\n        inputs.roughnessClearCoating \x3d clearCoatRoughnessLinear * clearCoatRoughnessLinear;\n        inputs.coating \x3d clearCoating;\n      #endif\n      vec3 ambientDir \x3d normalize(vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2],\n                                     - 5.0 * normalGround[0] - normalGround[2] * normalGround[1],\n                                       normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]));\n      inputs.NdotAmbDir \x3d abs(dot(normal, ambientDir));\n      vec3 mainLightIrradianceComponent  \x3d inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n      vec3 fillLightsIrradianceComponent \x3d inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n      vec3 ambientLightIrradianceComponent \x3d calculateAmbientIrradiance(normal, ssao) + additionalLight;\n      inputs.skyIrradianceToSurface    \x3d ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      inputs.groundIrradianceToSurface \x3d inputs.groundReflectance * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      vec3 horizonRingDir \x3d inputs.RdotNG * normalGround - reflectedView;\n      vec3 horizonRingH \x3d normalize(viewDirection + horizonRingDir);\n      inputs.NdotH_Horizon \x3d dot(normal, horizonRingH);\n      vec3 mainLightRadianceComponent  \x3d normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n      vec3 horizonLightRadianceComponent \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n      vec3 ambientLightRadianceComponent \x3d calculateAmbientRadiance(ssao) + additionalLight;\n      inputs.skyRadianceToSurface    \x3d  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n      inputs.groundRadianceToSurface \x3d inputs.groundReflectance * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n      #ifdef USE_PBR_CLEAR_COATING\n      vec3 mainLightRadianceComponentClearCoat  \x3d normalDistribution(inputs.NdotH, inputs.roughnessClearCoating) * lightingMainIntensity * (1.0 - shadow);\n      vec3 horizonLightRadianceComponentClearCoat \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughnessClearCoating + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n      inputs.skyRadianceToClearCoat    \x3d  ambinetLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n      inputs.groundRadianceToClearCoat \x3d inputs.groundReflectance * (ambinetLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n      #endif\n      inputs.averageAmbientRadiance \x3d ambientLightIrradianceComponent[1] * (1.0 + inputs.groundReflectance[1]);\n      vec3 reflectedColorComponent \x3d evaluateEnvironmentIllumination(inputs);\n      vec3 additionalMaterialReflectanceComponent \x3d inputs.albedoLinear * additionalAmbientIrradiance;\n      vec3 emissionComponent \x3d pow(_emission, vec3(GAMMA_SRGB));\n      vec3 outColorLinear \x3d reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n      vec3 outColor \x3d pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));\n  return outColor;\n  }\n#endif",
"screenSizePerspective.glsl":"float screenSizePerspectiveMinSize(float size, vec4 factor) {\n  float nonZeroSize \x3d 1.0 - step(size, 0.0);\n  return (\n    factor.z * (\n      1.0 +\n      nonZeroSize *\n      2.0 * factor.w / (\n        size + (1.0 - nonZeroSize)\n      )\n    )\n  );\n}\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n  return absCosAngle * absCosAngle * absCosAngle;\n}\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n}\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n}\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}",
"shadow.glsl":"#include \x3cutil/encoding.glsl\x3e\nfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\n  int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n  if (i \x3e\x3d num) { return .0; }\n  mat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\n  vec4 lv \x3d mat * vec4(vpos, 1.0);\n  lv.xy /\x3d lv.w;\n  vec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\n  if (lvpos.z \x3e\x3d 1.0) { return .0; }\n  if (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) { return .0; }\n  vec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\n  float texSize \x3d .5 / halfPxSz;\n  vec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\n  float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n  float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n  float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n  float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n  return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}",
"slice.glsl":"#ifdef SLICE\nuniform vec3 slicePlaneOrigin;\nuniform vec3 slicePlaneBasis1;\nuniform vec3 slicePlaneBasis2;\nstruct SliceFactors {\n  float front;\n  float side0;\n  float side1;\n  float side2;\n  float side3;\n};\nSliceFactors calculateSliceFactors(vec3 pos) {\n  vec3 rel \x3d pos - slicePlaneOrigin;\n  vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\n  float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\n  float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\n  float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\n  float basis1Dot \x3d dot(slicePlaneBasis1, rel);\n  float basis2Dot \x3d dot(slicePlaneBasis2, rel);\n  return SliceFactors(\n    dot(slicePlaneNormal, pos) + slicePlaneW,\n    -basis1Dot - basis1Len2,\n    basis1Dot - basis1Len2,\n    -basis2Dot - basis2Len2,\n    basis2Dot - basis2Len2\n  );\n}\nbool sliceByFactors(SliceFactors factors) {\n  return factors.front \x3c 0.0\n    \x26\x26 factors.side0 \x3c 0.0\n    \x26\x26 factors.side1 \x3c 0.0\n    \x26\x26 factors.side2 \x3c 0.0\n    \x26\x26 factors.side3 \x3c 0.0;\n}\nbool sliceByPlane(vec3 pos) {\n  return sliceByFactors(calculateSliceFactors(pos));\n}\n#ifdef EXTENSIONS_ENABLED\nvec4 applySliceHighlight(vec4 color, vec3 pos) {\n  SliceFactors factors \x3d calculateSliceFactors(pos);\n  if (sliceByFactors(factors)) {\n    return color;\n  }\n  const float HIGHLIGHT_WIDTH \x3d 1.0;\n  const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\n  factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n  factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n  factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n  factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n  factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n  float highlightFactor \x3d (1.0 - step(0.5, factors.front))\n    * (1.0 - step(0.5, factors.side0))\n    * (1.0 - step(0.5, factors.side1))\n    * (1.0 - step(0.5, factors.side2))\n    * (1.0 - step(0.5, factors.side3));\n  return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n}\n#else\n#endif\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n#ifdef SLICE_HIGHLIGHT_DISABLED\n#define highlightSlice(_color_, _pos_) (_color_)\n#else\n#define highlightSlice(_color_, _pos_) applySliceHighlight(_color_, _pos_)\n#endif\n#else\n#define rejectBySlice(_pos_) false\n#define discardBySlice(_pos_) {}\n#define highlightSlice(_color_, _pos_) (_color_)\n#endif",
"transform.glsl":"vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n  return proj * (view * vec4(pos, 1.0));\n}\nvec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n  vec4 eye \x3d view * vec4(pos, 1.0);\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n  return proj * eye;\n}","visualVariables.glsl":"#if defined(VV_SIZE)\n  #define VV_CUSTOM_MODEL_MATRIX\n#endif\n#if defined(VV_SIZE)\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  uniform vec3 vvSizeValue;\n#endif\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform mat3 vvSymbolRotationMatrix;\n#endif\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform vec3 vvSymbolAnchor;\n#endif\n#ifdef VV_COLOR\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n#endif\n#if defined(VV_SIZE)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n  }\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return vvSizeValue;\n  }\n#endif\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\n    return vec4(vvSymbolRotationMatrix * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n  }\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\n    return vec4(vvSymbolRotationMatrix * normal / vvGetScale(featureAttribute), 1.0);\n  }\n#endif\n#ifdef VV_COLOR\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n    float value \x3d featureAttribute.y;\n    if (value \x3c\x3d values[0]) {\n      return colors[0];\n    }\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n      if (values[i] \x3e\x3d value) {\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n        return mix(colors[i-1], colors[i], f);\n      }\n    }\n    return colors[VV_COLOR_N - 1];\n  }\n#endif",
"vsPrecision.glsl":"precision highp float;\nprecision highp sampler2D;"}}})},"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(n,b){return function(){function b(b){this.readFile=b}b.prototype.resolveIncludes=function(b){return this.resolve(b)};b.prototype.resolve=function(b,h){var a=this;void 0===h&&(h=new Map);if(h.has(b))return h.get(b);var g=this.read(b);if(!g)throw Error("cannot find shader file "+b);for(var e=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm,d=e.exec(g),
f=[];null!=d;)f.push({path:d[1],start:d.index,length:d[0].length}),d=e.exec(g);var c=0,q="";f.forEach(function(d){q+=g.slice(c,d.start);q+=h.has(d.path)?"":a.resolve(d.path,h);c=d.start+d.length});q+=g.slice(c);h.set(b,q);return q};b.prototype.read=function(b){return this.readFile(b)};return b}()})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.glslifyDefineMap=function(b){var h="",a;for(a in b){var g=
b[a];if("boolean"===typeof g)g&&(h+="#define "+a+"\n");else if("number"===typeof g)h+="#define "+a+" "+g.toFixed()+"\n";else if("object"===typeof g){var e=g.options,d=0,f;for(f in e)h+="#define "+e[f]+" "+(d++).toFixed()+"\n";h+="#define "+a+" "+e[g.value]+"\n"}}return h};b.createProgram=function(b,h,a,g){a=a||{};g=g||"";a="function"===typeof h.shaders?h.shaders(a):h.shaders;return new l(b,g+a.vertexShader,g+a.fragmentShader,h.attributes)}})},"esri/views/webgl/Program":function(){define(["require",
"exports","../../core/has","../../core/maybe","./ShaderTranspiler"],function(n,b,l,k,h){function a(a,b){if(k.isNone(a)||a.length!==b.length)return!0;for(var d=0;d<a.length;++d)if(a[d]!==b[d])return!0;return!1}return function(){function b(a,d,f,c,g){void 0===g&&(g={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v=
{};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};a||console.error("RenderingContext isn't initialized!");0===d.length&&console.error("Shaders source should not be empty!");this._context=a;this._vertexShaderSource=d;this._fragmentShaderSource=f;if(Array.isArray(g))for(a=0;a<g.length;a++)this._defines[g[a]]="1";else this._defines=g;this._id=b._nextId++;this._locations=c}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});b.prototype.getDefine=function(a){return this._defines[a]};b.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),
this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};b.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,d=a.createProgram();a.attachShader(d,this._vShader);a.attachShader(d,this._fShader);for(var b in this._locations)a.bindAttribLocation(d,this._locations[b],b);a.linkProgram(d);
this._glName=d;this._initialized=!0}};b.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};b.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};b.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,
a));return this._nameToAttribLocation[a]};b.prototype.setUniform1i=function(a,b){var d=this._nameToUniform1[a];if(void 0===d||b!==d)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),b),this._nameToUniform1[a]=b};b.prototype.setUniform1iv=function(e,d){var f=this._nameToUniform1v[e];a(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(e),d),void 0===f?this._nameToUniform1v[e]=b._arrayCopy(d):b._arrayAssign(d,f))};b.prototype.setUniform1f=
function(a,b){var d=this._nameToUniform1[a];if(void 0===d||b!==d)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),b),this._nameToUniform1[a]=b};b.prototype.setUniform1fv=function(e,d){var f=this._nameToUniform1v[e];a(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(e),d),void 0===f?this._nameToUniform1v[e]=b._arrayCopy(d):b._arrayAssign(d,f))};b.prototype.setUniform2f=function(a,b,f){var c=this._nameToUniform2[a];if(void 0===
c||b!==c[0]||f!==c[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),b,f),void 0===c?this._nameToUniform2[a]=[b,f]:(c[0]=b,c[1]=f)};b.prototype.setUniform2fv=function(e,d){var f=this._nameToUniform2[e];a(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(e),d),void 0===f?this._nameToUniform2[e]=b._arrayCopy(d):b._arrayAssign(d,f))};b.prototype.setUniform3f=function(a,b,f,c){var d=this._nameToUniform3[a];if(void 0===d||
b!==d[0]||f!==d[1]||c!==d[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),b,f,c),void 0===d?this._nameToUniform3[a]=[b,f,c]:(d[0]=b,d[1]=f,d[2]=c)};b.prototype.setUniform3fv=function(e,d){var f=this._nameToUniform3[e];a(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(e),d),void 0===f?this._nameToUniform3[e]=b._arrayCopy(d):b._arrayAssign(d,f))};b.prototype.setUniform4f=function(a,b,f,c,g){var d=this._nameToUniform4[a];
if(void 0===d||b!==d[0]||f!==d[1]||c!==d[2]||g!==d[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(a),b,f,c,g),void 0===d?this._nameToUniform4[a]=[b,f,c,g]:(d[0]=b,d[1]=f,d[2]=c,d[3]=g)};b.prototype.setUniform4fv=function(e,d){var f=this._nameToUniform4[e];a(f,d)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(e),d),void 0===f?this._nameToUniform4[e]=b._arrayCopy(d):b._arrayAssign(d,f))};b.prototype.setUniformMatrix3fv=function(e,
d,f){void 0===f&&(f=!1);var c=this._nameToUniformMatrix3[e],g;g=k.isNone(c)?!0:9!==c.length?a(c,d):9!==c.length||c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||c[4]!==d[4]||c[5]!==d[5]||c[6]!==d[6]||c[7]!==d[7]||c[8]!==d[8];g&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(e),f,d),void 0===c?this._nameToUniformMatrix3[e]=b._arrayCopy(d):b._arrayAssign(d,c))};b.prototype.setUniformMatrix4fv=function(e,d,f){void 0===f&&(f=!1);var c=this._nameToUniformMatrix4[e],
g;g=k.isNone(c)?!0:16!==c.length?a(c,d):16!==c.length||c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||c[4]!==d[4]||c[5]!==d[5]||c[6]!==d[6]||c[7]!==d[7]||c[8]!==d[8]||c[9]!==d[9]||c[10]!==d[10]||c[11]!==d[11]||c[12]!==d[12]||c[13]!==d[13]||c[14]!==d[14]||c[15]!==d[15];g&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(e),f,d),void 0===c?this._nameToUniformMatrix4[e]=b._arrayCopy(d):b._arrayAssign(d,c))};b._padToThree=function(a){var b=a.toString();1E3>
a&&(b=("  "+a).slice(-3));return b};b.prototype._addLineNumbers=function(a){var d=2;return a.replace(/\n/g,function(){return"\n"+b._padToThree(d++)+":"})};b.prototype._loadShader=function(a){var b=35633===a,e=b?this._vertexShaderSource:this._fragmentShaderSource,c="",g;for(g in this._defines)c+="#define "+g+" "+this._defines[g]+"\n";e=c+e;"webgl2"===this._context.contextVersion&&(e=h.transpileShader(e,b?"vertex":"fragment"));b=this._context.gl;a=b.createShader(a);b.shaderSource(a,e);b.compileShader(a);
return a};b._arrayCopy=function(a){for(var b=[],e=0;e<a.length;++e)b.push(a[e]);return b};b._arrayAssign=function(a,b){for(var d=0;d<a.length;++d)b[d]=a[d]};b._nextId=0;return b}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(n,b,l,k){function h(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}function a(b,e,c,g){g=g||c;for(var d=0;d<b.length;d++){var f=b[d];if("ident"===f.type&&f.data===
c)return g in e?e[g]++:e[g]=0,a(b,e,g+"_"+e[g],g)}return c}function g(a,b,c){void 0===c&&(c="afterVersion");var d={data:"\n",type:"whitespace"},e=function(c){return c<a.length?/[^\r\n]$/.test(a[c].data):!1},f=function(a){for(var b=-1,d=0,e=-1,f=0;f<a.length;f++){var g=a[f];"preprocessor"===g.type&&(g.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++d:g.data.match(/\#endif\s*.*/)&&--d);("afterVersion"===c||"afterPrecision"===c)&&"preprocessor"===g.type&&/^#version/.test(g.data)&&(e=Math.max(e,f));if("afterPrecision"===
c&&"keyword"===g.type&&"precision"===g.data){a:{for(g=f;g<a.length;g++){var h=a[g];if("operator"===h.type&&";"===h.data)break a}g=null}if(null===g)throw Error("precision statement not followed by any semicolons!");e=Math.max(e,g)}b<e&&0===d&&(b=f)}return b+1}(a);e(f-1)&&a.splice(f++,0,d);for(var g=0;g<b.length;g++){var h=b[g];a.splice(f++,0,h)}e(f-1)&&e(f)&&a.splice(f,0,d)}Object.defineProperty(b,"__esModule",{value:!0});var e=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers",
"GL_EXT_shader_texture_lod"];b.transpileShader=function(b,f){b=k(b);var c;a:{c="100";var d="300 es";void 0===c&&(c="100");void 0===d&&(d="300 es");for(var p=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,r=0;r<b.length;r++){var t=b[r];if("preprocessor"===t.type){var x=p.exec(t.data);if(x){p=x[1].replace(/\s\s+/g," ");if(p===d){c=p;break a}if(p===c){t.data="#version "+d;break a}throw Error("unknown glsl version: "+p);}}}b.splice(0,0,{type:"preprocessor",data:"#version "+d},{type:"whitespace",data:"\n"});
c=null}if("300 es"===c)throw Error("shader is already glsl 300 es");p=t=null;r={};x={};for(c=0;c<b.length;++c)switch(d=b[c],d.type){case "keyword":"vertex"===f&&"attribute"===d.data?d.data="in":"varying"===d.data&&(d.data="vertex"===f?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(d.data.trim())&&(d.data=d.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===f&&"gl_FragColor"===d.data){if(!t){var t=a(b,r,"fragColor"),w=void 0;void 0===w&&(w="lowp");g(b,[{type:"keyword",
data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:w},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}d.data=t}else"fragment"===f&&"gl_FragDepthEXT"===d.data&&(p||(p=a(b,r,"gl_FragDepth")),d.data=p);break;case "ident":if(0<=l.indexOf(d.data)){if(w="vertex"===f)a:{for(w=c-1;0<=w;w--){var u=b[w];if("whitespace"!==u.type&&"block-comment"!==u.type)if("keyword"===u.type){if("attribute"===
u.data||"in"===u.data){w=!0;break a}}else break}w=!1}if(w)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");d.data in x||(x[d.data]=a(b,r,d.data));d.data=x[d.data]}}for(c=b.length-1;0<=c;--c)d=b[c],"preprocessor"===d.type&&((f=d.data.match(/\#extension\s+(.*)\:/))&&f[1]&&0<=e.indexOf(f[1].trim())&&(f=b[c+1],b.splice(c,f&&"whitespace"===f.type?2:1)),(f=d.data.match(/\#ifdef\s+(.*)/))&&f[1]&&0<=e.indexOf(f[1].trim())&&(d.data="#if 1"),(f=d.data.match(/\#ifndef\s+(.*)/))&&
f[1]&&0<=e.indexOf(f[1].trim())&&(d.data="#if 0"));return h(b)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(n,b){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(n){"use strict;";return function(b){var l=n(),k=[],k=k.concat(l(b));return k=k.concat(l(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(n,b,l){"use strict;";var k="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function h(a){a.length&&u.push({type:k[r],
data:a,position:v,line:y,column:m})}function a(){w=w.length?[]:w;if("/"===x&&"*"===t)return v=p+q-1,r=0,x=t,q+1;if("/"===x&&"/"===t)return v=p+q-1,r=1,x=t,q+1;if("#"===t)return r=2,v=p+q,q;if(/\s/.test(t))return r=9,v=p+q,q;z=/\d/.test(t);B=/[^\w_]/.test(t);v=p+q;r=z?4:B?3:9999;return q}function g(){if(("\r"===t||"\n"===t)&&"\\"!==x)return h(w.join("")),r=999,q;w.push(t);x=t;return q+1}function e(){if("."===x&&/\d/.test(t))return r=5,q;if("/"===x&&"*"===t)return r=0,q;if("/"===x&&"/"===t)return r=
1,q;if("."===t&&w.length){for(;d(w););r=5;return q}if(";"===t||")"===t||"("===t){if(w.length)for(;d(w););h(t);r=999;return q+1}var a=2===w.length&&"\x3d"!==t;if(/[\w_\d\s]/.test(t)||a){for(;d(w););r=999;return q}w.push(t);x=t;return q+1}function d(a){var c=0,d,e;do{d=b.indexOf(a.slice(0,a.length+c).join(""));e=b[d];if(-1===d){if(0<c--+a.length)continue;e=a.slice(0,1).join("")}h(e);v+=e.length;w=w.slice(e.length);return w.length}while(1)}function f(){if("."===t||/[eE]/.test(t))return w.push(t),r=5,
x=t,q+1;if("x"===t&&1===w.length&&"0"===w[0])return r=11,w.push(t),x=t,q+1;if(/[^\d]/.test(t))return h(w.join("")),r=999,q;w.push(t);x=t;return q+1}function c(){"f"===t&&(w.push(t),x=t,q+=1);if(/[eE]/.test(t)||"-"===t&&/[eE]/.test(x))return w.push(t),x=t,q+1;if(/[^\d]/.test(t))return h(w.join("")),r=999,q;w.push(t);x=t;return q+1}var q=0,p=0,r=999,t,x,w=[],u=[],y=1,m=0,v=0,z=!1,B=!1,C="",D;return function(b){u=[];if(null!==b){b=b.replace?b.replace(/\r\n/g,"\n"):b;q=0;C+=b;for(D=C.length;t=C[q],q<
D;){b=q;switch(r){case 0:"/"===t&&"*"===x?(w.push(t),h(w.join("")),r=999):(w.push(t),x=t);q+=1;break;case 1:q=g();break;case 2:q=g();break;case 3:q=e();break;case 4:q=f();break;case 11:/[^a-fA-F0-9]/.test(t)?(h(w.join("")),r=999):(w.push(t),x=t,q+=1);break;case 5:q=c();break;case 9999:if(/[^\d\w_]/.test(t)){var d=w.join("");r=-1<n.indexOf(d)?8:-1<l.indexOf(d)?7:6;h(w.join(""));r=999}else w.push(t),x=t,q+=1;break;case 9:/[^\s]/g.test(t)?(h(w.join("")),r=999):(w.push(t),x=t,q+=1);break;case 999:q=a()}if(b!==
q)switch(C[b]){case "\n":m=0;++y;break;default:++m}}p+=q;C=C.slice(q);return u}w.length&&h(w.join(""));r=10;h("(eof)");return u}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../../core/typedArrayUtil"],function(n,b,l,k){return function(){function b(a,g,e,d,f){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=a;this._bufferType=g;this._usage=e;this._id=b._nextId++;this._glName=this._context.gl.createBuffer();d&&this.setData(d,f)}b.createIndex=function(a,g,e,d){return new b(a,34963,g,e,d)};b.createVertex=function(a,
g,e){return new b(a,34962,g,e)};Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"bufferType",
{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),
this._context=null)};b.prototype.setData=function(a,b){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&b)switch(this._indexType=b,this._size=a,b){case 5123:a*=2;break;case 5125:a*=4}}else b=a.byteLength,k.isUint16Array(a)&&(b/=2,this._indexType=5123),k.isUint32Array(a)&&(b/=4,this._indexType=5125),this._size=b;b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,
a,this._usage);this._context.bindVAO(b)}};b.prototype.setSubData=function(a,b,e,d){void 0===b&&(b=0);void 0===e&&(e=0);if(a){(0>b||b>=this._size)&&console.error("offset is out of range!");var f=b,c=e,g=d,h=a.byteLength;k.isUint16Array(a)&&(h/=2,f*=2,c*=2,g*=2);k.isUint32Array(a)&&(h/=4,f*=4,c*=4,g*=4);void 0===d&&(d=h-1);e>=d&&console.error("end must be bigger than start!");b+e-d>this._size&&console.error("An attempt to write beyond the end of the buffer!");b=this._context.getBoundVAO();this._context.bindVAO(null);
this._context.bindBuffer(this);e=this._context.gl;a=ArrayBuffer.isView(a)?a.buffer:a;e.bufferSubData(this._bufferType,f,a.slice(c,g));this._context.bindVAO(b)}};b._nextId=0;return b}()})},"esri/views/webgl/renderState":function(){define(["require","exports","../../core/tsSupport/assignHelper"],function(n,b,l){function k(a){return v.intern(a)}function h(a){return z.intern(a)}function a(a){return B.intern(a)}function g(a){return C.intern(a)}function e(a){return D.intern(a)}function d(a){return K.intern(a)}
function f(a){return I.intern(a)}function c(a){return Q.intern(a)}function q(a){return"["+a.join(",")+"]"}function p(a){return a?q([a.srcRgb,a.srcAlpha,a.dstRgb,a.dstAlpha,a.opRgb,a.opAlpha,a.color.r,a.color.g,a.color.b,a.color.a]):null}function r(a){return a?q([a.face,a.mode]):null}function t(a){return a?q([a.factor,a.units]):null}function x(a){return a?q([a.func]):null}function w(a){return a?q([a.function.func,a.function.ref,a.function.mask,a.operation.fail,a.operation.zFail,a.operation.zPass]):
null}function u(a){return a?q([a.zNear,a.zFar]):null}function y(a){return a?q([a.r,a.g,a.b,a.a]):null}function m(a){return a?q([a.mask]):null}Object.defineProperty(b,"__esModule",{value:!0});b.simpleBlendingParams=function(a,c,b,d){void 0===b&&(b=32774);void 0===d&&(d=[0,0,0,0]);return{srcRgb:a,srcAlpha:a,dstRgb:c,dstAlpha:c,opRgb:b,opAlpha:b,color:{r:d[0],g:d[1],b:d[2],a:d[3]}}};b.separateBlendingParams=function(a,c,b,d,e,f,g){void 0===e&&(e=32774);void 0===f&&(f=32774);void 0===g&&(g=[0,0,0,0]);
return{srcRgb:a,srcAlpha:c,dstRgb:b,dstAlpha:d,opRgb:e,opAlpha:f,color:{r:g[0],g:g[1],b:g[2],a:g[3]}}};b.backFaceCullingParams={face:1029,mode:2305};b.defaultDepthWriteParams={zNear:0,zFar:1};b.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};b.makeBlending=k;b.makeCulling=h;b.makePolygonOffset=a;b.makeDepthTest=g;b.makeStencilTest=e;b.makeDepthWrite=d;b.makeColorWrite=f;b.makeStencilWrite=c;b.makePipelineState=function(a){return J.intern(a)};n=function(){function a(a,c){this.makeKey=a;this.makeRef=
c;this.interns=new Map}a.prototype.intern=function(a){if(!a)return null;var c=this.makeKey(a),b=this.interns;b.has(c)||b.set(c,this.makeRef(a));return b.get(c)};return a}();var v=new n(p,function(a){return l({__tag:"Blending"},a)}),z=new n(r,function(a){return l({__tag:"Culling"},a)}),B=new n(t,function(a){return l({__tag:"PolygonOffset"},a)}),C=new n(x,function(a){return l({__tag:"DepthTest"},a)}),D=new n(w,function(a){return l({__tag:"StencilTest"},a)}),K=new n(u,function(a){return l({__tag:"DepthWrite"},
a)}),I=new n(y,function(a){return l({__tag:"ColorWrite"},a)}),Q=new n(m,function(a){return l({__tag:"StencilWrite"},a)}),J=new n(function(a){return a?q([p(a.blending),r(a.culling),t(a.polygonOffset),x(a.depthTest),w(a.stencilTest),u(a.depthWrite),y(a.colorWrite),m(a.stencilWrite)]):null},function(b){return{blending:k(b.blending),culling:h(b.culling),polygonOffset:a(b.polygonOffset),depthTest:g(b.depthTest),stencilTest:e(b.stencilTest),depthWrite:d(b.depthWrite),colorWrite:f(b.colorWrite),stencilWrite:c(b.stencilWrite)}});
n=function(){function a(a){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=a}a.prototype.setPipeline=function(a){if(this._pipelineInvalid||a!==this._pipeline)this.setBlending(a.blending),this.setCulling(a.culling),this.setPolygonOffset(a.polygonOffset),this.setDepthTest(a.depthTest),this.setStencilTest(a.stencilTest),
this.setDepthWrite(a.depthWrite),this.setColorWrite(a.colorWrite),this.setStencilWrite(a.stencilWrite),this._pipeline=a;this._pipelineInvalid=!1};a.prototype.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};a.prototype.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};a.prototype.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};a.prototype.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=
!0};a.prototype.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};a.prototype.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};a.prototype.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.setBlending=function(a){this._blending=this.setSubState(a,this._blending,this._blendingInvalid,this._stateSetters.setBlending);
this._blendingInvalid=!1};a.prototype.setCulling=function(a){this._culling=this.setSubState(a,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};a.prototype.setPolygonOffset=function(a){this._polygonOffset=this.setSubState(a,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};a.prototype.setDepthTest=function(a){this._depthTest=this.setSubState(a,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);
this._depthTestInvalid=!1};a.prototype.setStencilTest=function(a){this._stencilTest=this.setSubState(a,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};a.prototype.setDepthWrite=function(a){this._depthWrite=this.setSubState(a,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};a.prototype.setColorWrite=function(a){this._colorWrite=this.setSubState(a,this._colorWrite,this._colorWriteInvalid,
this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};a.prototype.setStencilWrite=function(a){this._stencilWrite=this.setSubState(a,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};a.prototype.setSubState=function(a,c,b,d){if(b||a!==c)d(a),this._pipelineInvalid=!0;return a};return a}();b.StateTracker=n})},"esri/views/webgl/Texture":function(){define(["require","exports","../../core/has","../../core/mathUtils"],function(n,b,l,k){return function(){function b(a,
g,e){this._glName=this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=a;this._desc={pixelFormat:g.pixelFormat,internalFormat:g.internalFormat,dataType:g.dataType,target:g.target?g.target:3553,samplingMode:g.samplingMode?g.samplingMode:9729,wrapMode:g.wrapMode?g.wrapMode:10497,maxAnisotropy:g.maxAnisotropy,flipped:void 0!==g.flipped?g.flipped:!1,hasMipmap:void 0!==g.hasMipmap?g.hasMipmap:!1,unpackAlignment:g.unpackAlignment?
g.unpackAlignment:4,width:g.width,height:g.height,preMultiplyAlpha:void 0!==g.preMultiplyAlpha?g.preMultiplyAlpha:!1,textureCoordinateScaleFactor:g.textureCoordinateScaleFactor||null};this._id=++b._nextId;this.setData(e)}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},
enumerable:!0,configurable:!0});b.prototype.dispose=function(){var a=this;if(this._context&&this._context.gl){if(this._glName){var b=this._context.gl;this._boundToUnits.forEach(function(b){a._context.bindTexture(null,b)});b.deleteTexture(this._glName);this._glName=null}this._context=null}};b.prototype.release=function(){this.dispose()};b.prototype.resize=function(a,b){var e=this._desc;if(e.width!==a||e.height!==b)e.width=a,e.height=b,this.setData(null)};b.prototype.setData=function(a){var g=this._context.gl;
this._glName||(this._glName=g.createTexture());void 0===a&&(a=null);null===a&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var e=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var d=this._desc;b._validateTexture(d);g.pixelStorei(g.UNPACK_ALIGNMENT,d.unpackAlignment);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,d.flipped?1:0);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d.preMultiplyAlpha?1:0);var f=d.pixelFormat,c=d.internalFormat?d.internalFormat:f;if(a instanceof
ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement)d.width&&d.height&&console.assert(a.width===d.width&&a.height===d.height),g.texImage2D(g.TEXTURE_2D,0,c,f,d.dataType,a),d.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=a.width),void 0===this._desc.height&&(this._desc.height=a.height);else{null!=d.width&&null!=d.height||console.error("Width and height must be specified!");g.DEPTH24_STENCIL8&&c===g.DEPTH_STENCIL&&(c=
g.DEPTH24_STENCIL8);var h=d.width,p=d.height;if(null!=a&&"type"in a&&"compressed"===a.type){f=Math.round(Math.log(Math.max(h,p))/Math.LN2)+1;d.hasMipmap=d.hasMipmap&&f===a.levels.length;for(var r=0;;++r){g.compressedTexImage2D(g.TEXTURE_2D,r,c,h,p,0,a.levels[Math.min(r,a.levels.length-1)]);if(1===h&&1===p||!d.hasMipmap)break;h=Math.max(1,h>>1);p=Math.max(1,p>>1)}}else if(a)g.texImage2D(g.TEXTURE_2D,0,c,h,p,0,f,d.dataType,a),d.hasMipmap&&this.generateMipmap();else for(r=0;;++r){g.texImage2D(g.TEXTURE_2D,
r,c,h,p,0,f,d.dataType,null);if(1===h&&1===p||!d.hasMipmap)break;h=Math.max(1,h>>1);p=Math.max(1,p>>1)}}b._applySamplingMode(g,this._desc);b._applyWrapMode(g,this._desc);b._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(e,0)};b.prototype.updateData=function(a,b,e,d,f,c){c||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var g=this._context.gl,h=this._desc,r=this._context.getBoundTexture(0);
this._context.bindTexture(this,0);(0>b||0>e||d>h.width||f>h.height||b+d>h.width||e+f>h.height)&&console.error("An attempt to update out of bounds of the texture!");g.pixelStorei(g.UNPACK_ALIGNMENT,h.unpackAlignment);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h.flipped?1:0);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h.preMultiplyAlpha?1:0);c instanceof ImageData||c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement?(console.assert(c.width===d&&c.height===f),g.texSubImage2D(g.TEXTURE_2D,
a,b,e,h.pixelFormat,h.dataType,c)):g.texSubImage2D(g.TEXTURE_2D,a,b,e,d,f,h.pixelFormat,h.dataType,c);this._context.bindTexture(r,0)};b.prototype.generateMipmap=function(){var a=this._desc;a.hasMipmap||(a.hasMipmap=!0,b._validateTexture(a));9729===a.samplingMode?(this._samplingModeDirty=!0,a.samplingMode=9985):9728===a.samplingMode&&(this._samplingModeDirty=!0,a.samplingMode=9984);a=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var g=this._context.gl;g.generateMipmap(g.TEXTURE_2D);
this._context.bindTexture(a,0)};b.prototype.setSamplingMode=function(a){a!==this._desc.samplingMode&&(this._desc.samplingMode=a,b._validateTexture(this._desc),this._samplingModeDirty=!0)};b.prototype.setWrapMode=function(a){a!==this._desc.wrapMode&&(this._desc.wrapMode=a,b._validateTexture(this._desc),this._wrapModeDirty=!0)};b.prototype.applyChanges=function(){var a=this._context.gl,g=this._desc;this._samplingModeDirty&&(b._applySamplingMode(a,g),this._samplingModeDirty=!1);this._wrapModeDirty&&
(b._applyWrapMode(a,g),this._wrapModeDirty=!1)};b.prototype.setBoundToUnit=function(a,b){b?this._boundToUnits.add(a):this._boundToUnits.delete(a)};b._validateTexture=function(a){(0>a.width||0>a.height)&&console.error("Negative dimension parameters are not allowed!");k.isPowerOfTwo(a.width)&&k.isPowerOfTwo(a.height)||("number"===typeof a.wrapMode?33071!==a.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===a.wrapMode.s&&33071===a.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),
a.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};b._applySamplingMode=function(a,b){var e=b.samplingMode,d=b.samplingMode;if(9985===e||9987===e)e=9729,b.hasMipmap||(d=9729);else if(9984===e||9986===e)e=9728,b.hasMipmap||(d=9728);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d)};b._applyWrapMode=function(a,b){"number"===typeof b.wrapMode?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrapMode),a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_WRAP_T,b.wrapMode)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrapMode.s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrapMode.t))};b._applyAnisotropicFilteringParameters=function(a,b){if(null!=b.maxAnisotropy){var e=a.capabilities.textureFilterAnisotropic;e&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY,b.maxAnisotropy))}};b._nextId=0;return b}()})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils"],
function(n,b,l,k){function h(a){return a[0].stride}function a(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}function g(a){switch(a){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:return 4;case 34041:return 4;case 33325:return 2;case 33326:return 4;case 35898:return 4;case 33327:return 4;case 33328:return 8;case 34842:return 8;
case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1;default:k.neverReached(a)}return 0}function e(a){if(!a)return 0;if("colorAttachment"in a)return a.glName?e(a.colorAttachment)+e(a.depthStencilAttachment):0;if("descriptor"in a)return a.glName?e(a.descriptor):0;var b=a.internalFormat||"pixelFormat"in a&&a.pixelFormat;if(!b)return 0;var c="hasMipmap"in a&&a.hasMipmap?1.3:1;a=a.width*a.height;return g(b)*a*c}Object.defineProperty(b,"__esModule",{value:!0});
b.vertexCount=function(a,b){return a.vertexBuffers[b].size/h(a.layout[b])};b.getStride=h;b.getBytesPerElement=a;b.addDescriptor=function(b,e,c,g,h,r){var d=a(g);if(0<b.length){var f=b[0].stride,p=f+d*c;b.forEach(function(a){return a.stride=p});b.push({name:e,count:c,type:g,offset:f,stride:p,normalized:h,divisor:r})}else b.push({name:e,count:c,type:g,offset:0,stride:d*c,normalized:h,divisor:r})};b.assertCompatibleVertexAttributeLocations=function(a,b){(a=a.locations===b.locations)||console.error("VertexAttributeLocations are incompatible");
return a};b.hasAttribute=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return!0;return!1};b.findAttribute=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return a[c];return null};b.copyFramebufferToTexture=function(a,b,c,e,g){void 0===g&&(g=0);var d=a.getBoundFramebufferObject(),f=a.getBoundTexture(0);a.bindFramebuffer(b);a.bindTexture(c,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,g,c.descriptor.pixelFormat,e[0],e[1],e[2],e[3],0);a.gl.flush();a.bindFramebuffer(d);a.bindTexture(f,
0)};b.setBaseInstanceOffset=function(a,b){var c={},d;for(d in a)c[d]=a[d].map(function(a){return a.divisor?l({},a,{baseInstance:b}):a});return c};b.bindVertexBufferLayout=function(a,b,c,e,g){var d=a.gl,f=a.capabilities.instancing;a.bindBuffer(c);for(a=0;a<e.length;a++){c=e[a];var h=b[c.name],p=(g?g:0+c.baseInstance?c.baseInstance:0)*c.stride;void 0===h&&console.error("There is no location for vertex attribute '"+c.name+"' defined.");c.baseInstance&&!c.divisor&&console.error("Vertex attribute '"+c.name+
"' uses baseInstanceOffset without divisor.");if(4>=c.count)d.vertexAttribPointer(h,c.count,c.type,c.normalized,c.stride,c.offset+p),d.enableVertexAttribArray(h),c.divisor&&0<c.divisor&&f&&f.vertexAttribDivisor(h,c.divisor);else if(9===c.count)for(var k=0;3>k;k++)d.vertexAttribPointer(h+k,3,c.type,c.normalized,c.stride,c.offset+12*k+p),d.enableVertexAttribArray(h+k),c.divisor&&0<c.divisor&&f&&f.vertexAttribDivisor(h+k,c.divisor);else if(16===c.count)for(k=0;4>k;k++)d.vertexAttribPointer(h+k,4,c.type,
c.normalized,c.stride,c.offset+16*k+p),d.enableVertexAttribArray(h+k),c.divisor&&0<c.divisor&&f&&f.vertexAttribDivisor(h+k,c.divisor);else console.error("Unsupported vertex attribute element count: "+c.count)}};b.unbindVertexBufferLayout=function(a,b,c,e){var d=a.gl,f=a.capabilities.instancing;a.bindBuffer(c);for(c=0;c<e.length;c++){var g=e[c],h=b[g.name];if(4>=g.count)d.disableVertexAttribArray(h),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(h,0);else if(9===g.count)for(var k=0;3>k;k++)d.disableVertexAttribArray(h+
k),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(h+k,0);else if(16===g.count)for(k=0;4>k;k++)d.disableVertexAttribArray(h+k),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(h+k,0);else console.error("Unsupported vertex attribute element count: "+g.count)}a.unbindBuffer(34962)};b.getBytesPerElementFormat=g;b.getGpuMemoryUsage=e})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/has","./Util"],function(n,b,l,k){return function(){function b(a,g,e,d,f){this._locations=
this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=a;this._layout=e;this._buffers=d;this._locations=g;f&&(this._indexBuffer=f);this._id=b._nextId++}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexBuffers",{get:function(){return this._buffers},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(b,e){return b+a._buffers[e].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});b.prototype.dispose=function(a){void 0===a&&(a=!0);if(this._context){var b=this._context.capabilities.vao;b&&this._glName&&(b.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(a){for(var e in this._buffers)this._buffers[e].dispose(),delete this._buffers[e];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};
b.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var b=a.createVertexArray();a.bindVertexArray(b);this._bindLayout();a.bindVertexArray(null);this._glName=b}this._initialized=!0}};b.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};b.prototype._bindLayout=function(){var a=this._buffers,b=!!this._context.capabilities.vao,e=this._layout,
d=this._indexBuffer;a||console.error("Vertex buffer dictionary is empty!");var f=this._context.gl,c;for(c in a){var h=a[c];h||console.error("Vertex buffer is uninitialized!");var p=e[c];p||console.error("Vertex element descriptor is empty!");k.bindVertexBufferLayout(this._context,this._locations,h,p)}d&&(b?f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,d.glName):this._context.bindBuffer(d))};b.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};
b.prototype._unbindLayout=function(){var a=this._buffers,b=this._layout;a||console.error("Vertex buffer dictionary is empty!");for(var e in a){var d=a[e];d||console.error("Vertex buffer is uninitialized!");k.unbindVertexBufferLayout(this._context,this._locations,d,b[e])}(a=this._indexBuffer)&&this._context.unbindBuffer(a.bufferType)};b._nextId=0;return b}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Handles ../../../core/watchUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ./atmosphereUtils ../support/earthUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/shaders/RealisticAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this._view=a;this.canRender=!0;this._skyslot=13;this._hazeSlot=14;this._renderData={texDepth:e.vec2f64.create(),cameraPosition:f.vec3f64.create(),cameraUp:f.vec3f64.create(),cameraRight:f.vec3f64.create(),cameraDir:f.vec3f64.create(),halfSizeNearPlane:e.vec2f64.create(),cameraCenterOffset:e.vec2f64.create(),sphereComp:q.vec4f64.create(),atmosParams1:q.vec4f64.create(),
atmosParams2:q.vec4f64.create(),atmosParams3:f.vec3f64.create(),invWavelength:B,invWavelengthScaled:C,radii:e.vec2f64.create(),scale:0,scaleDepth:D,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,oneOverScaleDepth:0,scaleDepthBlue:K,oneOverScaleDepthBlue:Q,scaleOverScaleDepthBlue:0,g:J,g2:J*J,miePhaseCoefficients:N,nearFar:e.vec2f64.create(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0};this._lowerElevationBoundRadius=0;this._earthRadius=r.earthRadius;this._updateRadius(r.earthRadius)}
b.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&(this._hazeProgram.dispose(),this._hazeProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null);this._vao&&(this._vao.dispose(),this._vao=null)};b.prototype.when=function(a){return k(this,void 0,void 0,function(){return l(this,function(b){a();return[2]})})};b.prototype.initializeRenderContext=function(b){var c=this;b=b.rctx;this._handles=new h;this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,
tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"});this._handles.add(a.on(this._view,"basemapTerrain","elevation-change",function(a){return c._updateElevation(a)},function(){return c._updateElevation()}));this._handles.add(a.on(this._view,"basemapTerrain","elevation-bounds-change",function(){return c._updateVisibleElevationBounds()},function(){return c._updateVisibleElevationBounds()}));this._hazeProgram=y.createProgram(b,w.program,
{haze:!0});this._skyProgram=y.createProgram(b,w.program);this._hazePipelineState=m.makePipelineState({blending:m.separateBlendingParams(1,0,769,1),colorWrite:m.defaultColorWriteParams});this._skyPipelineState=m.makePipelineState({blending:m.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:m.defaultColorWriteParams});this._vao=this._createVertexArrayObject(b)};b.prototype.uninitializeRenderContext=function(a){this.destroy()};b.prototype.render=function(a){if(a.slot!==this._hazeSlot&&
a.slot!==this._skyslot||0!==a.pass)return!1;this._update(a.camera);a.slot===this._skyslot&&this._renderSky(a);a.slot===this._hazeSlot&&this._renderHaze(a);return!0};b.prototype._renderSky=function(a){var b=a.rctx,c=this._skyProgram;b.bindProgram(c);b.setPipelineState(this._skyPipelineState);c.setUniform3fv("atmosParams3",this._renderData.atmosParams3);this._renderCommon(c,a)};b.prototype._renderHaze=function(a){var b=this,c=a.rctx,d=a.offscreenRenderingHelper,e=this._hazeProgram;c.bindProgram(e);
c.setPipelineState(this._hazePipelineState);d.renderDepthDetached(function(){c.bindTexture(d.depthTexture,0);e.setUniform1i("depthTex",0);b._renderCommon(e,a)})};b.prototype._renderCommon=function(a,b){var c=b.rctx;a.setUniform3fv("invWavelength",this._renderData.invWavelength);a.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled);b.scenelightingData.setLightDirectionUniform(a);a.setUniform4fv("sphereComp",this._renderData.sphereComp);a.setUniform3fv("cameraPosition",this._renderData.cameraPosition);
a.setUniform3fv("cameraUp",this._renderData.cameraUp);a.setUniform3fv("cameraRight",this._renderData.cameraRight);a.setUniform3fv("cameraDir",this._renderData.cameraDir);a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);a.setUniform2fv("cameraCenterOffset",this._renderData.cameraCenterOffset);a.setUniform2fv("radii",this._renderData.radii);a.setUniform4fv("atmosParams1",this._renderData.atmosParams1);a.setUniform4fv("atmosParams2",
this._renderData.atmosParams2);a.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance);a.setUniform1f("altitudeFade",this._renderData.altitudeFade);c.bindVAO(this._vao);v.assertCompatibleVertexAttributeLocations(this._vao,a);c.drawArrays(5,0,4)};b.prototype._createVertexArrayObject=function(a){var b=L.createBuffer(4);b.position.setVec(0,[-1,-1,1]);b.position.setVec(1,[1,-1,1]);b.position.setVec(2,[-1,1,1]);b.position.setVec(3,[1,1,1]);b.uv0.setVec(0,[0,0]);b.uv0.setVec(1,[1,0]);b.uv0.setVec(2,
[0,1]);b.uv0.setVec(3,[1,1]);return new z(a,w.program.attributes,{geometry:t.glLayout(L)},{geometry:u.createVertex(a,35044,b.buffer)})};b.prototype._adjustRadiusForTesselation=function(a){return a*Math.cos(Math.PI/Math.pow(2,4)/16)};b.prototype._updateElevation=function(a){a=a?a.tile:this._view.basemapTerrain.rootTiles[0];0===a.lij[0]&&(a=this._adjustRadiusForTesselation(r.earthRadius+a.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,
this._updateVisibleElevationBounds()))};b.prototype._updateVisibleElevationBounds=function(){var a=this._adjustRadiusForTesselation(r.earthRadius+this._view.basemapTerrain.elevationBounds.min);(0>this._earthRadius||a<this._earthRadius)&&this._updateRadius(a)};b.prototype._updateRadius=function(a){this._earthRadius=a;var b=a/10*10.25,e=1/(b-a),f=e/D,m=e/K,h=.3*(b-a)+a,k=this._renderData;c.vec4.set(k.atmosParams1,e,D,f,I);c.vec4.set(k.atmosParams2,J,K,m,Q);d.vec3.set(k.atmosParams3,J*J,N,h);g.vec2.set(k.radii,
a,b);k.scale=e;k.lowerAlphaBlendBound=h;k.scaleOverScaleDepth=f;k.scaleOverScaleDepthBlue=m;b=p.INNER_ATMOSPHERE_DEPTH;k.innerFadeDistance=2*Math.sqrt((2*a-b)*b)};b.prototype._update=function(a){a&&(d.vec3.negate(this._renderData.cameraDir,a.viewForward),d.vec3.copy(this._renderData.cameraUp,a.viewUp),d.vec3.copy(this._renderData.cameraRight,a.viewRight),this._renderData.cameraHeight=d.vec3.length(a.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=
this._renderData.cameraHeightSq-this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.sphereComp=q.vec4f64.fromValues(this._renderData.cameraHeight,this._renderData.cameraHeightSq,this._renderData.C,this._renderData.CSur),d.vec3.copy(this._renderData.cameraPosition,a.eye),g.vec2.set(this._renderData.halfSizeNearPlane,Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/2)/(a.height/
a.fullHeight)),g.vec2.set(this._renderData.cameraCenterOffset,(a.padding[3]+a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/a.fullHeight-.5),g.vec2.set(this._renderData.nearFar,a.near,a.far),this._renderData.altitudeFade=p.computeInnerAltitudeFade(this._renderData.cameraHeight-this._earthRadius))};b.isSupported=function(a){return a.rctx.capabilities.depthTexture};return b}();b.RealisticAtmosphere=n;b=.02*Math.PI;n=.004*Math.PI;var B=f.vec3f64.fromValues(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,
4)),C=f.vec3f64.clone(B);d.vec3.scale(C,C,b);d.vec3.add(C,C,f.vec3f64.fromValues(n,n,n));var D=.25,K=.05,I=1/D,Q=1/K,J=-.99999,N=(1-J*J)/(2+J*J)*1.5,L=x.newLayout().vec3f("position").vec2f("uv0")})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.computeInnerAltitudeFade=function(b){return Math.min(1,Math.max(0,(b-1E5)/9E5))};b.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/webgl-engine/shaders/RealisticAtmospherePrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});b.program={name:"realistic-atmosphere-color",shaders:function(a){return{vertexShader:h.glslifyDefineMap({HAZE:a.haze})+k.resolveIncludes("environment/realisticAtmosphere.vert"),fragmentShader:h.glslifyDefineMap({HAZE:a.haze})+k.resolveIncludes("environment/realisticAtmosphere.frag")}},attributes:l.Default3D}})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/mathUtils ../../../core/mathUtils ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./atmosphereUtils ./resources/SimpleAtmosphereTexture ../support/earthUtils ../support/imageUtils ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N){function L(a,b,c,d,e){var f=p.vec3.length(a),g=d*Math.sqrt(f*f-d*d)/f,m=e.silCircleV1,h=e.silCircleV2;p.vec3.scale(e.silCircleCenter,a,Math.sqrt(d*d-g*g)/f);p.vec3.cross(m,a,b);1>p.vec3.squaredLength(m)&&p.vec3.cross(m,a,c);p.vec3.scale(m,m,g/p.vec3.length(m));p.vec3.cross(h,m,a);p.vec3.scale(h,h,g/p.vec3.length(h));return g}function M(a,b,c,e){p.vec3.add(P,e.silCircleCenter,e.silCircleV2);p.vec3.scale(V,P,U);d.mat4.lookAt(X,b,
P,c);B.project(P,X,a.projectionMatrix,a.viewport);B.project(V,X,a.projectionMatrix,a.viewport);return p.vec3.distance(P,V)/a.height}var R=-t.INNER_ATMOSPHERE_DEPTH,S=(w.earthRadius+R)/w.earthRadius,T=(w.earthRadius+0)/w.earthRadius,U=(w.earthRadius+3E5)/w.earthRadius,Y=y.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);n=function(){function b(a){this.slot=13;this._renderData={texV:q.vec2f64.create(),silCircleCenter:r.vec3f64.create(),silCircleV1:r.vec3f64.create(),
silCircleV2:r.vec3f64.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this._readyResolver=g.createResolver();this._readyController=g.createAbortController();this.view=a}Object.defineProperty(b.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});b.prototype.when=function(a){return k(this,void 0,void 0,function(){return l(this,function(b){switch(b.label){case 0:return[4,this._readyResolver.promise];case 1:return b.sent(),
a(),[2]}})})};b.prototype.initializeRenderContext=function(a){var b=this,c=a.rctx;this._cameraChangeHandle=e.init(this.view,"state.camera",function(){return a.requestRender()},!0);this._program=K.createProgram(c,C.colorPass);this._fadeProgram=K.createProgram(c,C.fadePass);this._vao=this._createRibbon(c);this._vaoCount=J.vertexCount(this._vao,"geometry");this._fadeVao=z.createQuadVAO(c);this._fadeVaoCount=J.vertexCount(this._fadeVao,"geometry");u.requestImage(x,{signal:this._readyController.signal}).then(function(d){b._texture=
new Q(c,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},d);a.requestRender();b._readyController=null;b._readyResolver.resolve()});this._pipelineState=I.makePipelineState({blending:I.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:I.defaultColorWriteParams})};b.prototype.uninitializeRenderContext=function(a){this.destroy()};b.prototype.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=
null);this._texture&&(this._texture.dispose(),this._texture=null);this._program&&(this._program.dispose(),this._program=null);this._fadeProgram&&(this._fadeProgram.dispose(),this._fadeProgram=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};b.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass)return!1;this._update(a.camera);var b=a.rctx;b.setPipelineState(this._pipelineState);if(1>this._renderData.undergroundFadeAlpha){var c=
this._program;b.bindProgram(c);c.setUniformMatrix4fv("proj",a.camera.projectionMatrix);c.setUniformMatrix4fv("view",a.camera.viewMatrix);c.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);c.setUniform3fv("silCircleV1",this._renderData.silCircleV1);c.setUniform3fv("silCircleV2",this._renderData.silCircleV2);c.setUniform2fv("texV",this._renderData.texV);b.bindTexture(this._texture,0);c.setUniform1i("tex",0);a.scenelightingData.setLightDirectionUniform(c);c.setUniform1f("altitudeFade",
this._renderData.altitudeFade);c.setUniform1f("innerScale",this._renderData.innerScale);b.bindVAO(this._vao);b.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(c=this._fadeProgram,b.bindProgram(c),c.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),a.scenelightingData.setLightDirectionUniform(c),c.setUniform3fv("cameraPosition",a.camera.eye),b.bindVAO(this._fadeVao),b.drawArrays(5,0,this._fadeVaoCount));return!0};b.prototype._update=function(b){var d=
r.vec3f64.create(),e=w.earthRadius,f=p.vec3.length(b.eye),g=f-e;this._renderData.undergroundFadeAlpha=0>g?Math.min(-g/5E3,1):0;var m=e+R,k=e+Math.max(50,g);this._renderData.innerScale=k*k/(Math.sqrt(k*k-e*e)*Math.sqrt(k*k-m*m)+e*m)-1;this._renderData.altitudeFade=t.computeInnerAltitudeFade(g);p.vec3.scale(d,b.eye,(e+50)/f);L(d,b.center,b.up,e,this._renderData);d=M(b,d,b.up,this._renderData);f=Y(g);m=.001953125;k=0+d*f*1;50<g&&(L(b.eye,b.center,b.up,e,this._renderData),b=M(b,b.eye,b.up,this._renderData),
b=h.clamp((b-1.5)/(d-1.5),0,1),m=0+.001953125*b,k=0+1*a.lerp(1,d*f,b));c.vec2.set(this._renderData.texV,m,k)};b.prototype._createRibbon=function(a){var b=new Float32Array(1155),c=new Uint32Array(1920);b[0]=0;b[1]=0;b[2]=-1;for(var d=0;128>d;d++){var e=9*d+3;b[e+0]=d;b[e+1]=S;b[e+2]=-1;b[e+3]=d;b[e+4]=T;b[e+5]=0;b[e+6]=d;b[e+7]=U;b[e+8]=1;var e=3*d+1,f=127===d?1:e+3,g=15*d;c[g+0]=e;c[g+1]=e+1;c[g+2]=f+1;c[g+3]=f+1;c[g+4]=f;c[g+5]=e;c[g+6]=e+1;c[g+7]=e+2;c[g+8]=f+2;c[g+9]=f+2;c[g+10]=f+1;c[g+11]=e+
1;c[g+12]=e;c[g+13]=f;c[g+14]=0}e=Z.createBuffer(c.length);f=e.position;for(d=0;d<c.length;++d)g=3*c[d],f.set(d,0,b[g]),f.set(d,1,b[g+1]),f.set(d,2,b[g+2]);return new N(a,C.colorPass.attributes,{geometry:m.glLayout(Z)},{geometry:D.createVertex(a,35044,e.buffer)})};return b}();var X=f.mat4f64.create(),P=r.vec3f64.create(),V=r.vec3f64.create(),Z=v.newLayout().vec3f("position");return n})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});b.createQuadVAO=function(a,b){void 0===b&&(b=k.Pos2);var d=null;switch(b){case k.Pos3Tex:d=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case k.Pos3:d=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case k.Pos2Tex:d=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;default:d=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new g(a,l.Default3D,{geometry:b},{geometry:h.createVertex(a,35044,
d)})};b.createEmptyTexture=function(b,d){void 0===d&&(d=4);return new a(b,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:d,height:d})};b.createColorTexture=function(b,d,f){void 0===f&&(f=4);for(var c=new Uint8Array(f*f*4),e=0;e<c.length;e+=4)c[e+0]=255*d[0],c[e+1]=255*d[1],c[e+2]=255*d[2],c[e+3]=255*d[3];return new a(b,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:f,height:f},c)}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];b.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];b.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,
normalized:!1}];b.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];b.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];b.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/environment/Stars":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/shaders/StarsPrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m){var v=e.getLogger("esri.views.3d.environment.Stars");b=function(){function b(a){this.slot=13;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this._loadDataController=d.createAbortController();this._numStars=0;this._modelMatrix=q.mat4f64.create();this.view=a;this._loadDataPromise=this._loadBrightStarCatalogue()}Object.defineProperty(b.prototype,"canRender",{get:function(){return null!=this._vao},enumerable:!0,configurable:!0});b.prototype.destroy=
function(){this._loadDataController&&(this._loadDataController.abort(),this._loadDataController=null);this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};b.prototype.initializeRenderContext=function(a){var b=this;this._initContext=a;var c=a.rctx;this._program=w.createProgram(c,t.program);this._pipelineState=u.makePipelineState({blending:u.separateBlendingParams(770,1,771,771),
depthTest:{func:515},colorWrite:u.defaultColorWriteParams});this._dateHandle=f.init(this.view,"environment.lighting.date",function(a){return b._update(a)});this._loadDataPromise.then(function(){b._numStars=b._starData.byteLength/b.bytesPerStar;var d=new Float32Array(b._starData,0,b._numStars*b.numBinaryFloats),e=new Uint8Array(b._starData,b._numStars*b.numBinaryFloats*4,b._numStars*b.numBinaryUInt8);b._vao=b._createVertexArrayObject(c,d,e);a.requestRender()})};b.prototype.uninitializeRenderContext=
function(a){this.destroy()};b.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass)return!1;var b=a.rctx,c=this._program;b.bindProgram(c);a=a.camera;c.setUniformMatrix4fv("view",a.viewMatrix);c.setUniformMatrix4fv("proj",a.projectionMatrix);c.setUniform4fv("viewport",a.fullViewport);c.setUniformMatrix4fv("model",this._modelMatrix);c.setUniform1f("pixelRatio",a.pixelRatio);b.setPipelineState(this._pipelineState);b.bindVAO(this._vao);y.assertCompatibleVertexAttributeLocations(this._vao,c);
b.drawArrays(0,0,this._numStars);return!0};b.prototype._computeDayDuration=function(a){var b=new Date(a.getFullYear(),0,1,11,58,56),c=new Date(a.getFullYear()+1,0,1,11,58,55);return(+a-+b)/(+c-+b)};b.prototype._update=function(a){if(a){var b=a.getHours()/12,d=a.getMinutes()/60*(2/24),e=a.getSeconds()/60*(2/1440),b=(b+d+e-.9972222)%2;a=2*this._computeDayDuration(a);d=this._modelMatrix;c.mat4.copy(d,C);c.mat4.rotateZ(d,d,-a*Math.PI);c.mat4.multiply(d,B,d);c.mat4.rotateZ(d,d,-b*Math.PI);this._initContext.requestRender()}};
b.prototype._hexToRGB=function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]};b.prototype._unpackUint8Attributes=function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]};b.prototype._createVertexArrayObject=function(a,b,c){for(var d=D.createBuffer(this._numStars),e=d.position,f=d.color,g=d.size,h=0;h<this._numStars;h++){var k=b[2*h+0],r=b[2*h+1];e.set(h,0,-Math.cos(k)*Math.sin(r));
e.set(h,1,-Math.sin(k)*Math.sin(r));e.set(h,2,-Math.cos(r));k=this._unpackUint8Attributes(c[h]);r=this._hexToRGB(z[k[1]]);f.set(h,0,255*r[0]);f.set(h,1,255*r[1]);f.set(h,2,255*r[2]);f.set(h,3,255);g.set(h,k[0])}return new m(a,t.program.attributes,{geometry:p.glLayout(D)},{geometry:x.createVertex(a,35044,d.buffer)})};b.prototype._verifyStartData=function(a){if(!a)throw new g("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==
a%1||5E4<a||5E3>a)throw new g("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};b.prototype._loadBrightStarCatalogue=function(){return k(this,void 0,void 0,function(){var b,c,e;return l(this,function(f){switch(f.label){case 0:return K?(this._starData=K,[2]):[4,a.result(h(n.toUrl("./resources/stars.wsv"),{responseType:"array-buffer",signal:this._loadDataController.signal}))];case 1:b=f.sent();this._loadDataController=null;if(!1===b.ok){if(d.isAbortError(b.error))throw b.error;
v.error("loadBrightStarCatalogue",b.error.message);return[2]}c=b.value;e=c.data;try{this._verifyStartData(e)}catch(M){throw v.error("loadBrightStarCatalogue",M),M;}this._starData=K=e;return[2]}})})};return b}();var z="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),B=q.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,
0,0,0,0,1),C=q.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),D=r.newLayout().vec3f("position").vec4u8("color").f32("size"),K=null;return b})},"esri/views/3d/webgl-engine/shaders/StarsPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.program={name:"stars",shaders:{vertexShader:k.resolveIncludes("environment/stars.vert"),
fragmentShader:k.resolveIncludes("environment/stars.frag")},attributes:l.Default3D}})},"esri/views/3d/support/sunUtils":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../lib/SunCalc".split(" "),function(n,b,l,k,h,a,g,e){function d(a,b,c,d){for(var e=[],f=0;f<c.length;f++)e[f]=(d[f]-c[f])*a/b+c[f];return e}Object.defineProperty(b,"__esModule",
{value:!0});b.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};b.computeColorAndIntensity=function(c,f){var h,p,k,r,y=f[2],m=q;a.vec3.set(m.ambient.color,1,1,1);m.ambient.intensity=b.settings.global.ambient;a.vec3.set(m.diffuse.color,1,1,1);m.diffuse.intensity=b.settings.global.diffuse;
y=(Math.abs(y)-b.settings.local.altitude)/(b.settings.global.altitude-b.settings.local.altitude);y=l.clamp(y,0,1);m.globalFactor=y;f=e.getTimes(c,f[1],f[0]);if(1>y){k=c.valueOf();var v,z;f.polarException===e.POLAR_EXCEPTION.MIDNIGHT_SUN?(v=k-36E5*(c.getHours()+48)-6E4*c.getMinutes(),z=v+432E6):f.polarException===e.POLAR_EXCEPTION.POLAR_NIGHT?(v=k-2,z=k-1):(v=f.sunrise.valueOf(),z=f.sunset.valueOf());var B=z-v;r=v+B/2;p=B/4;h=r-p;p=r+p;var C=.06*B,B=v-C/2;v+=C/2;var D=z-C/2,n=z+C/2;z=b.settings.local;
var I=[.01,z.ambientAtNight],Q=[.8,.8,1],J=[.01,.01,.01],N=[z.diffuseAtTwilight,z.ambientAtTwilight],L=[1,.75,.75],M=[.8,.8,1],R=[.9*z.diffuseAtNoon,z.ambientAtNoon],S=[1,.98,.98],T=[.98,.98,1],U=[z.diffuseAtNoon,z.ambientAtNoon],Y=[1,1,1],X=[1,1,1];z=[0,0];var P=[0,0,0],C=[0,0,0];k<B||k>n?(z=I,P=J,C=Q):k<v?(C=v-B,z=d(k-B,C,I,N),P=d(k-B,C,J,L),C=d(k-B,C,Q,M)):k<h?(C=h-v,z=d(k-v,C,N,R),P=d(k-v,C,L,S),C=d(k-v,C,M,T)):k<r?(C=r-h,z=d(k-h,C,R,U),P=d(k-h,C,S,Y),C=d(k-h,C,T,X)):k<p?(C=p-r,z=d(k-r,C,U,R),
P=d(k-r,C,Y,S),C=d(k-r,C,X,T)):k<D?(C=D-p,z=d(k-p,C,R,N),P=d(k-p,C,S,L),C=d(k-p,C,T,M)):k<n&&(C=n-D,z=d(k-D,C,N,I),P=d(k-D,C,L,J),C=d(k-D,C,M,Q));k=z[0];r=g.vec3f64.fromValues(P[0],P[1],P[2]);h=z[1];p=g.vec3f64.fromValues(C[0],C[1],C[2]);a.vec3.lerp(m.ambient.color,p,m.ambient.color,y);m.ambient.intensity=l.lerp(h,m.ambient.intensity,y);a.vec3.lerp(m.diffuse.color,r,m.diffuse.color,y);m.diffuse.intensity=l.lerp(k,m.diffuse.intensity,y)}y=c.valueOf();f.polarException===e.POLAR_EXCEPTION.MIDNIGHT_SUN?
(c=y-36E5*(c.getHours()+48)-6E4*c.getMinutes(),f=c+432E6):f.polarException===e.POLAR_EXCEPTION.POLAR_NIGHT?(c=y-2,f=y-1):(c=f.sunrise.valueOf(),f=f.sunset.valueOf());c=1-l.clamp(Math.abs(y-(c+(f-c)/2))/432E5,0,1);m.noonFactor=c;return m};b.computeDirection=function(d,h,q,x){x||(x=g.vec3f64.create());var p=c,r=k.mat4.identity(f);if("global"===q)e.getPosition(d,0,0,p),a.vec3.set(x,0,0,-1),k.mat4.rotateX(r,r,-p.azimuth),k.mat4.rotateY(r,r,-p.altitude);else{var y=b.settings.planarDirection;q=y.globalAngles;
y=(Math.abs(h[2])-y.localAltitude)/(y.globalAltitude-y.localAltitude);y=l.clamp(y,0,1);1>y?(e.getPosition(d,h[1],h[0],p),p.azimuth=(1-y)*p.azimuth+y*q.azimuth,p.altitude=(1-y)*p.altitude+y*q.altitude):(p.azimuth=q.azimuth,p.altitude=q.altitude);a.vec3.set(x,0,-1,0);k.mat4.rotateZ(r,r,-p.azimuth);k.mat4.rotateX(r,r,-p.altitude)}a.vec3.transformMat4(x,x,r);return x};b.computeShadowsEnabled=function(a,c){return"global"===c?!0:Math.abs(a[2])<b.settings.planarDirection.localAltitude};var f=h.mat4f64.create(),
c={azimuth:0,altitude:0},q={ambient:{color:g.vec3f64.create(),intensity:0},diffuse:{color:g.vec3f64.create(),intensity:0,direction:g.vec3f64.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function n(a){return new Date(864E5*(a+.5-2440588))}function b(a,b){return t(c(a)*q(y)-p(b)*c(y),q(a))}function l(a,b){return r(c(b)*q(y)+q(b)*c(y)*c(a))}function k(a,b,d){return t(c(a),q(a)*c(b)-p(d)*q(b))}function h(a,b,d){return r(c(b)*c(d)+q(b)*q(d)*q(a))}
function a(a){return w*(1.9148*c(a)+.02*c(2*a)+3E-4*c(3*a))}function g(c,d){c=w*(357.5291+.98560028*c);var e=a(c);c=c+e+102.9372*w+f;d||(d={dec:0,ra:0});d.dec=l(c,0);d.ra=b(c,0);return d}function e(a,b,d){return 2451545+a+.0053*c(b)-.0069*c(2*d)}function d(a){var d=w*(134.963+13.064993*a),e=w*(93.272+13.22935*a);a=w*(218.316+13.176396*a)+6.289*w*c(d);e=5.128*w*c(e);d=385001-20905*q(d);return{ra:b(a,e),dec:l(a,e),dist:d}}var f=Math.PI,c=Math.sin,q=Math.cos,p=Math.tan,r=Math.asin,t=Math.atan2,x=Math.acos,
w=f/180,u={dec:0,ra:0},y=23.4397*w,m={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(a,b,c,d){c=w*-c;b*=w;var e=a.valueOf()/864E5-.5+2440588-2451545;a=g(e,u);c=w*(280.16+360.9856235*e)-c-a.ra;d||(d={azimuth:0,altitude:0});d.azimuth=k(c,b,a.dec);d.altitude=h(c,b,a.dec);return d}},v=[[-.83,"sunrise","sunset"]];m.addTime=function(a,b,c){v.push([a,b,c])};m.getTimes=function(b,d,g){function h(a){var b=k,d=t;a=x((c(a)-c(b)*c(d))/(q(b)*q(d)));return e(9E-4+(a+p)/(2*f)+r,z,y)}
var p=w*-g,k=w*d,r=Math.round(b.valueOf()/864E5-.5+2440588-2451545-9E-4-p/(2*f));b=9E-4+(0+p)/(2*f)+r;var z=w*(357.5291+.98560028*b);d=a(z);var y=z+d+102.9372*w+f,t=l(y,0);b=e(b,z,y);d={solarNoon:n(b),nadir:n(b-.5),polarException:m.POLAR_EXCEPTION.NORMAL};var u,B,C,T;g=0;for(u=v.length;g<u;g+=1)B=v[g],C=h(B[0]*w),T=b-(C-b),d[B[1]]=n(T),d[B[2]]=n(C);d.polarException=function(a){a=(c(a)-c(k)*c(t))/(q(k)*q(t));return-1>a?m.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?m.POLAR_EXCEPTION.POLAR_NIGHT:m.POLAR_EXCEPTION.NORMAL}(v[0][0]*
w);return d};m.getMoonPosition=function(a,b,c){c=w*-c;b*=w;var e=a.valueOf()/864E5-.5+2440588-2451545;a=d(e);c=w*(280.16+360.9856235*e)-c-a.ra;e=h(c,b,a.dec);e+=.017*w/p(e+10.26*w/(e+5.1*w));return{azimuth:k(c,b,a.dec),altitude:e,distance:a.dist}};m.getMoonFraction=function(a){var b=a.valueOf()/864E5-.5+2440588-2451545;a=g(b);b=d(b);a=x(c(a.dec)*c(b.dec)+q(a.dec)*q(b.dec)*q(a.ra-b.ra));a=t(149598E3*c(a),b.dist-149598E3*q(a));return(1+q(a))/2};return m})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(b,h,a){void 0===b&&(b=l.vec3f64.create());void 0===h&&(h=l.vec3f64.fromValues(.57735,.57735,.57735));void 0===a&&(a=!0);this.intensity=b;this.direction=h;this.castShadows=a}}();b.MainLight=n;n=function(){return function(b,h){void 0===b&&(b=l.vec3f64.create());void 0===h&&(h=l.vec3f64.fromValues(.57735,.57735,.57735));this.intensity=l.vec3f64.create();
this.direction=l.vec3f64.create();this.intensity=b;this.direction=h}}();b.FillLight=n;n=function(){return function(b){void 0===b&&(b=l.vec3f64.create());this.intensity=b}}();b.AmbientLight=n;n=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();b.SphericalHarmonicsLight=n})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/ViewEvents ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K){n=function(b){function h(){var c=null!==b&&b.apply(this,arguments)||this;c._handles=new a;return c}l(h,b);h.prototype.initialize=function(){this.viewEvents=new v.ViewEvents(this.view)};h.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};Object.defineProperty(h.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==
a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});h.prototype.disconnect=function(){this.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),
this._source=null)};h.prototype.connect=function(){var a=this.view;this._source=new y.BrowserEventSource(this.view.surface,a.input);var b=[new C.PointerClickHoldAndDrag,new D.SingleAndDoubleClick,new B.Drag,new K.VerticalTwoFingerDrag];this._inputManager=b=new m.InputManager(this._source,b);b.installHandlers("prevent-context-menu",[new z.PreventContextMenu]);this._modeDragPan=new r.PinchAndPanNavigation(a,"primary");this._modeDragRotate=new d.DragRotate(a,"secondary","center");this._modeDragZoom=
new f.DragZoom(a,"tertiary");b.installHandlers("navigation",[new t.PointerDownCancelAnimation(a),new e.DoubleClickZoom(a),new c.GamepadNavigation(a),new q.KeyboardNavigation(a,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s"}),new p.MouseWheelZoom(a),new w.SingleKeyResetTilt(a,"p"),new x.SingleKeyResetHeading(a,"n"),new d.DragRotate(a,"primary","eye",["b"]),new d.DragRotate(a,"secondary","center",["b"]),
new r.PinchAndPanNavigation(a,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new u.TwoFingerTilt(a)]);this.viewEvents.connect(b);this._updateMode()};h.prototype._updateMode=function(){var a=this.primaryDragAction,a=I.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};Object.defineProperty(h.prototype,"debug",{get:function(){return{inputManager:this._inputManager}},
enumerable:!0,configurable:!0});k([g.property()],h.prototype,"view",void 0);k([g.property({value:"pan"})],h.prototype,"primaryDragAction",null);k([g.property({value:"default"})],h.prototype,"mode",null);k([g.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],h.prototype,"hasPendingInputs",void 0);k([g.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],h.prototype,"latestPointerType",void 0);k([g.property()],h.prototype,"_inputManager",void 0);return h=k([g.subclass("esri.views.3d.input.SceneInputManager")],
h)}(g.declared(h));var I=new Map;b=new Map;h=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});h.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});h.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});I.set("default",b);I.set("pro",h);return n})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,d){var c=b.call(this,!0)||this;c.view=a;c.registerIncoming("double-click",d,function(a){return c.handleDoubleClick(a)});return c}l(d,b);d.prototype.handleDoubleClick=function(b){var c=b.data;if(e.eventMatchesPointerAction(c,"primary")){var d=this.view.state.isGlobal?new h.ZoomStepController(this.view,"animation"):new a.ZoomStepController(this.view,"animation");this.view.state.switchCameraController(d);
d.zoomStep(Math.log(.5)/Math.log(.6),k.createScreenPointArray(c.x,c.y));b.stopPropagation()}};return d}(g.InputHandler);b.DoubleClickZoom=n})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(a,c){var e=b.call(this,a.state,a.sceneIntersectionHelper,"interaction"===c?null:void 0)||this;e.view=a;e.mode=c;e.zoomLocation=h.vec3f64.create();e.tmpCamera=new f.default;e.tmpViewDir=h.vec3f64.create();e.targetOnSphere=h.vec3f64.create();e.tmpCenter=h.vec3f64.create();e.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new f.default,interactionDirection:null,
tiltMode:0};e.sphere=d.sphere.create();return e}l(g,b);Object.defineProperty(g.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});g.prototype.zoomStep=function(a,b){if(this.active){var c=this.view.state,d=this.constraintOptions.interactionStartCamera;this.animation.finished?d.copyFrom(c.camera):this.animation.cameraAt(1,d);d=!1;0<a&&this.intersectionHelper.intersectScreen(b,this.zoomLocation)&&(d=!0);this.tmpCamera.copyFrom(c.camera);d?this.intersectionHelper.intersectRay(this.tmpCamera.ray,
this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:k.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};g.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:c.outExpo}};g.prototype.updateCamera=function(b,c,f,g){this.sphere.radius=k.vec3.length(f);k.vec3.subtract(this.tmpViewDir,
b.center,b.eye);var h=k.vec3.length(this.tmpViewDir),p=h*c;1>=c&&4>p&&(p=4,c=p/h);1E-6>Math.abs(h-p)||(h=k.vec3.length(b.center),this.sphere.radius!==h&&k.vec3.scale(b.center,b.center,(this.sphere.radius+c*(h-this.sphere.radius))/h),k.vec3.scale(this.tmpViewDir,this.tmpViewDir,-c),k.vec3.add(b.eye,b.center,this.tmpViewDir),a.applyAll(this.view,b,this.constraintOptions),1E-12<k.vec3.squaredDistance(f,b.center)&&d.sphere.intersectScreen(this.sphere,b,g,this.targetOnSphere)&&e.panToPosition(this.sphere,
b,f,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0),a.applySurfaceCollision(this.view,b))};return g}(g.PointToPointAnimationController);b.ZoomStepController=n})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});b.applyTilt=f.apply;b.tiltError=f.error;b.applyAltitude=c.apply;b.altitudeError=c.error;b.applyDistance=q.apply;b.distanceError=q.error;b.applySurfaceCollision=p.apply;b.applyAll=function(a,b,c,d){void 0===c&&(c=t);void 0===d&&(d=b);var e=!1;d!==b&&d.copyFrom(b);d.markViewDirty();d.computeUp(a.state.mode);for(b=0;b<x;b++){for(var f=0,m=0,p=r;m<p.length;m++){var k=p[m];if(h.hasConstraintType(c.selection,k.type)){var q=
Math.abs(k.error(a,d,c));k.apply(a,d,c)&&(e=!0,f+=q)}}if(0===f)break}b=h.hasConstraintType(c.selection,8);a:switch(c.interactionType){case 4:c=1;break a;case 5:c=a.state.isGlobal?2:1;break a;default:c=0}b&&g.apply(a,d,c)&&(e=!0);e&&d.computeUp(a.state.mode);return e};b.pixelDistanceToInteractionFactor=function(a,b){a="number"===typeof a?a:l.vec2.distance(a,b);return d.inOutCubic(Math.min(1,a/150))};var r=[{type:1,error:function(a,b,c){return e.error(a,b,c)*b.distance},apply:e.apply},{type:2,error:k.error,
apply:k.apply},{type:4,error:a.error,apply:a.apply}],t={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},x=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/intersectionUtils".split(" "),function(n,b,l,k,h,a,g,e){function d(b,e,f){void 0===
f&&(f=a.defaultApplyOptions);var g;g=b.state.constraints.altitude;g=b.state.isGlobal&&g?2===f.interactionType&&a.hasConstraintType(f.selection,1)?!1:!0:!1;if(!g)return 0;var h=b.state.constraints.altitude;g=c;g.min=h.min;g.max=h.max;var m=f.interactionType;if(0!==m){var h=g.min,p=g.max,k=f.interactionStartCamera;f=f.interactionFactor;var m=2===m||1===m,q=d(b,k),k=0===q?0:b.renderCoordsHelper.getAltitude(k.eye);g.min=h;g.max=p;a.adjustRangeForInteraction(q,k,m,f,.05*k,g)}b=b.renderCoordsHelper.getAltitude(e.eye);
b=l.clamp(b,g.min,g.max)-b;return 1E-6>=Math.abs(b)?0:b}function f(a,b,c,d){a.renderCoordsHelper.worldUpAtPosition(b.eye,d);k.vec3.scale(d,d,c);return d}Object.defineProperty(b,"__esModule",{value:!0});b.apply=function(b,c,h,u){void 0===h&&(h=a.defaultApplyOptions);void 0===u&&(u=c);u!==c&&u.copyFrom(c);var y=d(b,c,h);if(0===y)return!1;var m=b.renderCoordsHelper,v=m.getAltitude(c.eye)+y;b=a.interactionDirectionTowardsConstraintMinimization(c,h.interactionDirection,f(b,c,l.sign(y),p),q);h=k.vec3.copy(r,
c.viewForward);m.intersectInfiniteManifold(g.ray.wrap(c.eye,b),v,u.eye)||m.setAltitude(v,u.eye);e.closestPointOnRay(c.eye,h,c.center,c.center);u.markViewDirty();return!0};b.error=d;var c={min:0,max:0},q=h.vec3f64.create(),p=h.vec3f64.create(),r=h.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.hasConstraintType=
function(b,a){return 0!==(b&a)};b.adjustRangeForInteraction=function(b,a,g,e,d,f){0!==b&&(g?(f.min=Math.min(f.min,a),f.max=Math.max(f.max,a)):null!=e?(f.min-=Math.max(0,(a-f.min)*(1-e)),f.max+=Math.max(0,(a-f.max)*(1-e))):d&&(f.min-=Math.max(0,a-f.min-d),f.max+=Math.max(0,a-f.max-d)))};b.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};b.interactionDirectionTowardsConstraintMinimization=function(b,a,g,e){a=a||
b.viewForward;k.vec3.copy(e,a);k.vec3.scale(e,e,l.sign(k.vec3.dot(a,g)));return e}})},"esri/views/3d/support/intersectionUtils":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,l,k,h){function a(a,b,e,g){var c=d;a?(e&&g&&(c.len=k.vec3.distance(b,e)),k.vec3.copy(c.dir,a)):g?(c.len=k.vec3.distance(b,e),k.vec3.subtract(c.dir,e,b),k.vec3.scale(c.dir,c.dir,1/c.len)):(k.vec3.subtract(c.dir,
e,b),k.vec3.normalize(c.dir,c.dir));return c}function g(a,b){return-k.vec3.dot(b,a)-a[3]}function e(a,b,d,e){e.clip[0]=0;e.clip[1]=d?e.len:Number.MAX_VALUE;for(d=0;d<a.length;d++){var c;var f=a[d],h=b;c=e;var p=k.vec3.dot(f,c.dir),f=g(f,h);0>f&&0<=p?c=!1:-1E-6<p&&1E-6>p?c=0<f:!(0>f||0>p)||0>f&&0>p?(f/=p,0<p?f<c.clip[1]&&(c.clip[1]=f):f>c.clip[0]&&(c.clip[0]=f),c=c.clip[0]<=c.clip[1]):c=!0;if(!c)return!1}return!0}Object.defineProperty(b,"__esModule",{value:!0});b.planeSphere=function(a,b,d){return a[0]*
b[0]+a[1]*b[1]+a[2]*b[2]+a[3]<d};b.frustumSphere=function(a,b,d){var c=b[0],e=b[1];b=b[2];return a[0][0]*c+a[0][1]*e+a[0][2]*b+a[0][3]>d||a[1][0]*c+a[1][1]*e+a[1][2]*b+a[1][3]>d||a[2][0]*c+a[2][1]*e+a[2][2]*b+a[2][3]>d||a[3][0]*c+a[3][1]*e+a[3][2]*b+a[3][3]>d||a[4][0]*c+a[4][1]*e+a[4][2]*b+a[4][3]>d||a[5][0]*c+a[5][1]*e+a[5][2]*b+a[5][3]>d?!1:!0};b.frustumRay=function(b,c,d,g){d=a(g,c,d,!1);return e(b,c,null,d)};b.frustumPoint=function(a,b){for(var c=0;6>c;c++)if(0>g(a[c],b))return!1;return!0};b.frustumLineSegment=
function(b,c,d,g){g=a(g,c,d,!0);return e(b,c,d,g)};b.closestPointOnRay=function(a,b,d,e){d=k.vec3.dot(b,k.vec3.subtract(e,d,a));k.vec3.add(e,a,k.vec3.scale(e,b,d));return e};var d={dir:h.vec3f64.create(),len:0,clip:l.vec2f64.create()}})},"esri/views/3d/camera/constraintUtils/distance":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/mathUtils".split(" "),function(n,b,l,k,h,a,g){function e(a,
b,c){void 0===c&&(c=h.defaultApplyOptions);if(!a.state.isLocal)return 0;var f=a.state.constraints.distance;if(!a.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===f)return 0;d.min=0;d.max=f;var f=d,g=c.interactionType;if(0!==g){var p=f.min,m=f.max,k=c.interactionStartCamera;c=c.interactionFactor;var g=1===g||4===g,q=e(a,k),k=0===q?0:l.vec3.distance(k.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);f.min=p;f.max=m;h.adjustRangeForInteraction(q,k,g,c,.05*k,f)}a=l.vec3.distance(b.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);
a=d.max-a;return-1E-6<=a?0:a}Object.defineProperty(b,"__esModule",{value:!0});b.error=e;b.apply=function(b,d,k,w){void 0===k&&(k=h.defaultApplyOptions);void 0===w&&(w=d);w!==d&&w.copyFrom(d);var r=e(b,d,k);if(0===r)return!1;var y=b.pointsOfInterest.surfaceOrigin,r=l.vec3.distance(d.eye,b.pointsOfInterest.surfaceOrigin.renderLocation)+r,m=l.vec3.copy(f,d.eye);k=h.interactionDirectionTowardsConstraintMinimization(d,k.interactionDirection,g.directionFromTo(p,d.eye,b.pointsOfInterest.surfaceOrigin.renderLocation),
q);return a.sphere.intersectRay(a.sphere.wrap(r,y.renderLocation),a.ray.wrap(d.eye,k),w.eye)?(d=l.vec3.subtract(c,w.eye,m),l.vec3.add(w.center,w.center,d),w.markViewDirty(),d=b.renderCoordsHelper.getAltitude(w.center),b.renderCoordsHelper.intersectInfiniteManifold(w.ray,d,w.center),w.markViewDirty(),!0):!1};var d={min:0,max:0},f=k.vec3f64.create(),c=k.vec3f64.create(),q=k.vec3f64.create(),p=k.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../intersectionUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});b.apply=function(b,e,d,f){void 0===d&&(d=0);void 0===f&&(f=e);var c=b.state.constraints;e!==f&&f.copyFrom(e);if(!c.collision.enabled)return!1;var g=h.surfaceElevationBelowEye(b,e);e=b.renderCoordsHelper.getAltitude(e.eye);c=g+c.collision.elevationMargin;if(e>=c)return!1;g=l.vec3.length(f.eye);l.vec3.subtract(a,f.center,
f.eye);b.renderCoordsHelper.setAltitude(c,f.eye);1===d?l.vec3.add(f.center,f.eye,a):2===d&&l.vec3.scale(f.center,f.center,(g-e+c)/g);f.markViewDirty();return!0};var a=k.vec3f64.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../support/earthUtils ../webgl-engine/lib/Intersector".split(" "),function(n,b,l,k,h,a,g,e){function d(a,
b){return a.renderCoordsHelper.fromRenderCoords(b,t,a.basemapTerrain.spatialReference)?a.basemapTerrain.getElevation(t)||0:0}function f(a,b,c){if(!a.state.isGlobal)return!1;var e=d(a,b);a=a.stateManager.constraintsManager.nearFarHeuristic.compute(b,c,a.dataExtent,e,w).far;a*=a;return l.vec3.squaredDistance(b,c)>a}function c(a,b,c){void 0===c&&(c=k.vec3f64.create());var d=q[a.viewingMode];d||(d=new e(a.viewingMode),d.enable.backfacesTerrain=!a.state.isGlobal,d.enable.invisibleTerrain=!0,q[a.viewingMode]=
d);var m=a.state.isGlobal;return a.sceneIntersectionHelper.intersectRay(b,c,null,d)&&!f(a,b.origin,c)?!0:!a.renderCoordsHelper.intersectManifold(b,0,c)||f(a,b.origin,c)?m?(a=c,c=l.vec3.dot(b.origin,b.origin)-g.earthRadius*g.earthRadius,l.vec3.scale(a,b.direction,(0<c?Math.sqrt(c)/3:1)/l.vec3.length(b.direction)),l.vec3.add(a,a,b.origin),!0):!1:!0}Object.defineProperty(b,"__esModule",{value:!0});b.eyeWithinExtent=function(b,c,d,e){return b.renderCoordsHelper.fromRenderCoords(c.eye,p,e)&&a.containsPoint(d,
p)};b.surfaceElevationBelowEye=function(a,b){return d(a,b.eye)};b.cameraOnContentAlongViewDirection=function(a,b,d,e){var f=a.state.camera.clone();b&&(f.eye=b);d&&(f.center=d);e&&(f.up=e);c(a,f.ray,r)||l.vec3.copy(r,f.center);d=a.state.constraints;e=d.minimumPoiDistance;l.vec3.squaredDistance(f.eye,r)<e&&(b=d.collision.enabled,l.vec3.copy(x,f.viewForward),l.vec3.scale(x,x,e),b?l.vec3.subtract(f.eye,r,x):l.vec3.add(r,f.eye,x),a=a.renderCoordsHelper,e=a.getAltitude(f.eye),d=d.collision.elevationMargin,
b&&e<d&&(l.vec3.subtract(x,r,f.eye),a.setAltitude(d,f.eye),l.vec3.add(r,f.eye,x)));f.center=r;return f};var q={},p=k.vec3f64.create(),r=k.vec3f64.create(),t=new h,x=k.vec3f64.create(),w={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("require exports ../../../../core/has ../../../../core/now ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./intersectorUtils".split(" "),
function(n,b,l,k,h,a,g,e,d){var f=h.mat4f64.create();return function(){function b(a){this.enable=new d.EnableIntersectorOptions;this.results=new d.IntersectorResults;this.transform=new d.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.tolerance=1E-5;this._ray={origin:g.vec3f64.create(),direction:g.vec3f64.create()};this._rayEndPoint=g.vec3f64.create();this._rayStartPointTransformed=g.vec3f64.create();this._rayEndPointTransformed=g.vec3f64.create();this.viewingMode=
a||"global"}Object.defineProperty(b.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rayEndPoint",{get:function(){return this._rayEndPoint},enumerable:!0,configurable:!0});b.prototype.intersect=function(b,c,d,f,g,h,k,y,m,v){var p=this;if(void 0===m||!0===m)this._numObjectsTested=0,e.ray.fromPoints(c,d,this._ray),
this.results.init(this._ray);this.point=f;this.camera=g;this.enable.selectionMode=k;this.filterPredicate=y;this.tolerance=null==h?1E-5:h;a.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction);c=v?function(a){v(a)&&p.intersectObject(a)}:function(a){p.intersectObject(a)};if(b&&0<b.length)for(d=0;d<b.length;d++)if(f=b[d],g=f.getSpatialQueryAccelerator?f.getSpatialQueryAccelerator():void 0)g.forEachAlongRay(this._ray.origin,this._ray.direction,c),k&&g.forEachDegenerateObject(c);else for(g=
0,f=f.getObjects();g<f.length;g++)c(f[g]);this.sortResults()};b.prototype.intersectObject=function(b){var c=this;this._numObjectsTested++;var e=b.geometryRecords;if(e)for(var g=b.id,h=b.objectTransformation,k,q=function(e){var m=e.geometry,p=e.material,q=e.instanceParameters;if(q.hidden)return"continue";k=m.id;y.transform.setAndInvalidateLazyTransforms(h,e.getShaderTransformation());a.vec3.transformMat4(y._rayStartPointTransformed,y._ray.origin,y.transform.inverse);a.vec3.transformMat4(y._rayEndPointTransformed,
y._rayEndPoint,y.transform.inverse);var r=y.transform.transform;p.intersect(m,q,y.transform.transform,y,y._rayStartPointTransformed,y._rayEndPointTransformed,function(a,e,m,h,p,q){0<=a&&(null==c.filterPredicate||c.filterPredicate(c._ray.origin,c._rayEndPoint,a))&&(p?(null==c.results.hud.dist||a<c.results.hud.dist)&&c.results.hud.set(b,g,a,e,f,h,q,k,m):(p=function(c){return c.set(b,g,a,e,r,h,null,k,m)},(null==c.results.min.drapedLayerOrder||h>=c.results.min.drapedLayerOrder)&&(null==c.results.min.dist||
a<c.results.min.dist)&&p(c.results.min),(null==c.results.max.drapedLayerOrder||h<c.results.max.drapedLayerOrder)&&(null==c.results.max.dist||a>c.results.max.dist)&&p(c.results.max),c.enable.storeAll&&(q=new d.IntersectorResult(c._ray),p(q),c.results.all.push(q))))},e.shaderTransformation)},y=this,m=0;m<e.length;m++)q(e[m])};b.prototype.sortResults=function(){this.results.all.sort(function(a,b){return a.dist!==b.dist?a.dist-b.dist:a.drapedLayerOrder!==b.drapedLayerOrder?(void 0!==a.drapedLayerOrder?
a.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==b.drapedLayerOrder?b.drapedLayerOrder:Number.MAX_VALUE):(void 0!==b.drapedLayerGraphicOrder?b.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==a.drapedLayerGraphicOrder?a.drapedLayerGraphicOrder:Number.MIN_VALUE)})};b.DEFAULT_TOLERANCE=1E-5;return b}()})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/geometryUtils/boundedPlane ./Object3D".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(a,b){return l.isNone(a)||null==a.layerUid?null:l.isSome(b.graphicsView)&&a.layerUid===b.graphicsView.mockLayerId?b.graphics:b.map.findLayerByUid(a.layerUid)}function x(a,b,c){if(l.isNone(a))return null;var d=t(a,b);return l.isNone(d)?null:d===b.graphics?l.isSome(b.graphicsView)?l.expect(b.graphicsView.getGraphicFromGraphicUid(a.graphicUid)):null:(b=b.allLayerViews.find(function(a){return a.layer===d}))?w(b,a,c):null}function w(a,b,c){return!a||a.suspended?
null:l.isSome(c)&&"getGraphicFromStageObject"in a?a.getGraphicFromStageObject(c.obj,c.triangleNr):"getGraphicFromGraphicUid"in a&&null!=b.graphicUid?a.getGraphicFromGraphicUid(b.graphicUid):null}Object.defineProperty(b,"__esModule",{value:!0});b.sliceFilterPredicate=function(a){return function(b,c,d){e.vec3.lerp(m,b,c,d);return!p.extrusionContainsPoint(a,m)}};n=function(){return function(){this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.storeAll=this.storeTerrainResults=this.backfacesTerrain=
!0}}();b.EnableIntersectorOptions=n;n=function(){function b(){this._transform=g.mat4f64.create();this._transformInverse=new u({value:this._transform},a.mat4.invert,g.mat4f64.create);this._transformInverseTranspose=new u(this._transformInverse,a.mat4.transpose,g.mat4f64.create);this._transformTranspose=new u({value:this._transform},a.mat4.transpose,g.mat4f64.create);this._transformInverseRotation=new u({value:this._transform},k.mat3.normalFromMat4Legacy,h.mat3f64.create)}b.prototype.invalidateLazyTransforms=
function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};Object.defineProperty(b.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});b.prototype.setTransformMatrix=function(b){a.mat4.copy(this._transform,b)};b.prototype.multiplyTransform=function(b){a.mat4.multiply(this._transform,this._transform,b)};b.prototype.set=function(b){a.mat4.copy(this._transform,
b);this.invalidateLazyTransforms()};b.prototype.setAndInvalidateLazyTransforms=function(a,b){this.setTransformMatrix(a);this.multiplyTransform(b);this.invalidateLazyTransforms()};return b}();b.IntersectorTransform=n;var u=function(){function a(a,b,c){this.original=a;this.update=b;this.dirty=!0;this.transform=c()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform},
enumerable:!0,configurable:!0});return a}();n=function(){function a(){this.min=new y;this.max=new y;this.hud=new y;this.terrain=new y}a.prototype.init=function(a){this.min.init(a);this.max.init(a);this.hud.init(a);this.terrain.init(a);this.all=[]};return a}();b.IntersectorResults=n;var y=function(){function b(a){this.normal=d.vec3f64.create();this.transformation=g.mat4f64.create();this._ray=q.ray.create();this.init(a)}Object.defineProperty(b.prototype,"ray",{get:function(){return this._ray},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return e.vec3.scale(v,this.ray.direction,this.dist),e.vec3.length(v)},enumerable:!0,configurable:!0});b.prototype.getIntersectionPoint=function(a){if(!this.hasIntersectionPoint)return!1;e.vec3.scale(v,this.ray.direction,this.dist);e.vec3.add(a,this.ray.origin,v);
return!0};b.prototype.getTransformedNormal=function(a){e.vec3.copy(z,this.normal);z[3]=0;f.vec4.transformMat4(z,z,this.transformation);e.vec3.copy(a,z);e.vec3.normalize(a,a);return a};b.prototype.set=function(b,c,f,g,m,h,p,k,q,v){b instanceof r&&(b={type:"stage",obj:b});this.dist=f;e.vec3.copy(this.normal,g);a.mat4.copy(this.transformation,m);this.target=b;this.name=c;this.drapedLayerOrder=h;this.center=p?d.vec3f64.clone(p):null;this.geometryId=k;this.triangleNr=q;this.drapedLayerGraphicOrder=v};
b.prototype.copyFrom=function(b){q.ray.copy(b._ray,this._ray);this.dist=b.dist;this.target=b.target;this.name=b.name;this.drapedLayerOrder=b.drapedLayerOrder;this.center=b.center?d.vec3f64.clone(b.center):null;this.geometryId=b.geometryId;this.triangleNr=b.triangleNr;this.intersector=b.intersector;this.drapedLayerGraphicOrder=b.drapedLayerGraphicOrder;e.vec3.copy(this.normal,b.normal);a.mat4.copy(this.transformation,b.transformation)};b.prototype.init=function(a){this.drapedLayerGraphicOrder=this.drapedLayerOrder=
this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";a?q.ray.copy(a,this._ray):this._ray=q.ray.create()};b.prototype.toOwner=function(a){if(!this.target)return null;switch(this.target.type){case "stage":var b=this.target.obj.getMetadata();return t(b,a);case "external":switch(this.intersector){case "PointRenderer":return b=this.target.metadata.layerUid,null!=b?a.map.findLayerByUid(b):null;case "LodRenderer":case "DrapedRenderer":return t(this.target.metadata,
a);case "TerrainRenderer":return a.map&&a.map.ground}}return null};b.prototype.toGraphic=function(a){if(!this.target)return null;switch(this.target.type){case "stage":var b=this.target.obj,c=this.triangleNr,d=b.getMetadata();return x(d,a,{obj:b,triangleNr:c});case "external":switch(this.intersector){case "PointRenderer":return this.target.metadata.createGraphic();case "LodRenderer":case "DrapedRenderer":return x(this.target.metadata,a,null)}}return null};return b}();b.IntersectorResult=y;b.TERRAIN_ID=
"terrain";var m=d.vec3f64.create(),v=d.vec3f64.create(),z=c.vec4f64.create()})},"esri/core/libs/gl-matrix-2/mat3":function(){define(["require","exports","./math/mat3"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat3=l})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["require","exports","./common"],function(n,b,l){function k(a,b,e){var d=b[0],f=b[1],c=b[2],g=b[3],h=b[4],k=b[5],t=b[6],x=b[7];b=b[8];var w=e[0],u=e[1],y=e[2],m=e[3],v=e[4],z=e[5],B=e[6],l=e[7];e=e[8];
a[0]=w*d+u*g+y*t;a[1]=w*f+u*h+y*x;a[2]=w*c+u*k+y*b;a[3]=m*d+v*g+z*t;a[4]=m*f+v*h+z*x;a[5]=m*c+v*k+z*b;a[6]=B*d+l*g+e*t;a[7]=B*f+l*h+e*x;a[8]=B*c+l*k+e*b;return a}function h(a,b,e){a[0]=b[0]-e[0];a[1]=b[1]-e[1];a[2]=b[2]-e[2];a[3]=b[3]-e[3];a[4]=b[4]-e[4];a[5]=b[5]-e[5];a[6]=b[6]-e[6];a[7]=b[7]-e[7];a[8]=b[8]-e[8];return a}Object.defineProperty(b,"__esModule",{value:!0});b.fromMat4=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a};b.copy=
function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};b.set=function(a,b,e,d,f,c,h,p,k,t){a[0]=b;a[1]=e;a[2]=d;a[3]=f;a[4]=c;a[5]=h;a[6]=p;a[7]=k;a[8]=t;return a};b.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};b.transpose=function(a,b){if(a===b){var e=b[1],d=b[2],f=b[5];a[1]=b[3];a[2]=b[6];a[3]=e;a[5]=b[7];a[6]=d;a[7]=f}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=
b[2],a[7]=b[5],a[8]=b[8];return a};b.invert=function(a,b){var e=b[0],d=b[1],f=b[2],c=b[3],g=b[4],h=b[5],k=b[6],t=b[7];b=b[8];var x=b*g-h*t,w=-b*c+h*k,u=t*c-g*k,y=e*x+d*w+f*u;if(!y)return null;y=1/y;a[0]=x*y;a[1]=(-b*d+f*t)*y;a[2]=(h*d-f*g)*y;a[3]=w*y;a[4]=(b*e-f*k)*y;a[5]=(-h*e+f*c)*y;a[6]=u*y;a[7]=(-t*e+d*k)*y;a[8]=(g*e-d*c)*y;return a};b.adjoint=function(a,b){var e=b[0],d=b[1],f=b[2],c=b[3],g=b[4],h=b[5],k=b[6],t=b[7];b=b[8];a[0]=g*b-h*t;a[1]=f*t-d*b;a[2]=d*h-f*g;a[3]=h*k-c*b;a[4]=e*b-f*k;a[5]=
f*c-e*h;a[6]=c*t-g*k;a[7]=d*k-e*t;a[8]=e*g-d*c;return a};b.determinant=function(a){var b=a[3],e=a[4],d=a[5],f=a[6],c=a[7],h=a[8];return a[0]*(h*e-d*c)+a[1]*(-h*b+d*f)+a[2]*(c*b-e*f)};b.multiply=k;b.translate=function(a,b,e){var d=b[0],f=b[1],c=b[2],g=b[3],h=b[4],k=b[5],t=b[6],x=b[7];b=b[8];var w=e[0];e=e[1];a[0]=d;a[1]=f;a[2]=c;a[3]=g;a[4]=h;a[5]=k;a[6]=w*d+e*g+t;a[7]=w*f+e*h+x;a[8]=w*c+e*k+b;return a};b.rotate=function(a,b,e){var d=b[0],f=b[1],c=b[2],g=b[3],h=b[4],k=b[5],t=b[6],x=b[7];b=b[8];var w=
Math.sin(e);e=Math.cos(e);a[0]=e*d+w*g;a[1]=e*f+w*h;a[2]=e*c+w*k;a[3]=e*g-w*d;a[4]=e*h-w*f;a[5]=e*k-w*c;a[6]=t;a[7]=x;a[8]=b;return a};b.scale=function(a,b,e){var d=e[0],f=e[1];e=e[2];a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=f*b[3];a[4]=f*b[4];a[5]=f*b[5];a[6]=e*b[6];a[7]=e*b[7];a[8]=e*b[8];return a};b.scaleByVec2=function(a,b,e){var d=e[0];e=e[1];a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=e*b[3];a[4]=e*b[4];a[5]=e*b[5];return a};b.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=
0;a[6]=b[0];a[7]=b[1];a[8]=1;return a};b.fromRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=0;a[3]=-e;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};b.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};b.fromQuat=function(a,b){var e=b[0],d=b[1],f=b[2];b=b[3];var c=e+e,g=d+d,h=f+f,e=e*c,k=d*c,d=d*g,t=f*c,
x=f*g,f=f*h,c=b*c,g=b*g;b*=h;a[0]=1-d-f;a[3]=k-b;a[6]=t+g;a[1]=k+b;a[4]=1-e-f;a[7]=x-c;a[2]=t-g;a[5]=x+c;a[8]=1-e-d;return a};b.normalFromMat4Legacy=function(a,b){var e=b[0],d=b[1],f=b[2],c=b[4],g=b[5],h=b[6],k=b[8],t=b[9];b=b[10];var x=b*g-h*t,w=-b*c+h*k,u=t*c-g*k,y=e*x+d*w+f*u;if(!y)return null;y=1/y;a[0]=x*y;a[1]=(-b*d+f*t)*y;a[2]=(h*d-f*g)*y;a[3]=w*y;a[4]=(b*e-f*k)*y;a[5]=(-h*e+f*c)*y;a[6]=u*y;a[7]=(-t*e+d*k)*y;a[8]=(g*e-d*c)*y;return a};b.normalFromMat4=function(a,b){var e=b[0],d=b[1],f=b[2],
c=b[3],g=b[4],h=b[5],k=b[6],t=b[7],x=b[8],w=b[9],u=b[10],y=b[11],m=b[12],v=b[13],z=b[14];b=b[15];var B=e*h-d*g,l=e*k-f*g,D=e*t-c*g,n=d*k-f*h,I=d*t-c*h,Q=f*t-c*k,J=x*v-w*m,N=x*z-u*m,x=x*b-y*m,L=w*z-u*v,w=w*b-y*v,u=u*b-y*z,y=B*u-l*w+D*L+n*x-I*N+Q*J;if(!y)return null;y=1/y;a[0]=(h*u-k*w+t*L)*y;a[1]=(k*x-g*u-t*N)*y;a[2]=(g*w-h*x+t*J)*y;a[3]=(f*w-d*u-c*L)*y;a[4]=(e*u-f*x+c*N)*y;a[5]=(d*x-e*w-c*J)*y;a[6]=(v*Q-z*I+b*n)*y;a[7]=(z*D-m*Q-b*l)*y;a[8]=(m*I-v*D+b*B)*y;return a};b.projection=function(a,b,e){a[0]=
2/b;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/e;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a};b.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};b.add=function(a,b,e){a[0]=b[0]+e[0];a[1]=b[1]+e[1];a[2]=b[2]+e[2];a[3]=b[3]+e[3];a[4]=b[4]+e[4];a[5]=b[5]+e[5];a[6]=
b[6]+e[6];a[7]=b[7]+e[7];a[8]=b[8]+e[8];return a};b.subtract=h;b.multiplyScalar=function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*e;return a};b.multiplyScalarAndAdd=function(a,b,e,d){a[0]=b[0]+e[0]*d;a[1]=b[1]+e[1]*d;a[2]=b[2]+e[2]*d;a[3]=b[3]+e[3]*d;a[4]=b[4]+e[4]*d;a[5]=b[5]+e[5]*d;a[6]=b[6]+e[6]*d;a[7]=b[7]+e[7]*d;a[8]=b[8]+e[8]*d;return a};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&
a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};b.equals=function(a,b){var e=a[0],d=a[1],f=a[2],c=a[3],g=a[4],h=a[5],k=a[6],t=a[7];a=a[8];var x=b[0],w=b[1],u=b[2],y=b[3],m=b[4],v=b[5],z=b[6],B=b[7];b=b[8];return Math.abs(e-x)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(x))&&Math.abs(d-w)<=l.EPSILON*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(f-u)<=l.EPSILON*Math.max(1,Math.abs(f),Math.abs(u))&&Math.abs(c-y)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(g-m)<=l.EPSILON*
Math.max(1,Math.abs(g),Math.abs(m))&&Math.abs(h-v)<=l.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(k-z)<=l.EPSILON*Math.max(1,Math.abs(k),Math.abs(z))&&Math.abs(t-B)<=l.EPSILON*Math.max(1,Math.abs(t),Math.abs(B))&&Math.abs(a-b)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.mul=k;b.sub=h})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./ComponentUtils ./GeometryRecord ./HighlightUtils ./IdGen ./Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){var r=p.assert,t=h.mat4f64.create();n=function(){function b(a){void 0===a&&(a={});this._objectTransformation=h.mat4f64.create();this._bvObjectSpace=new w;this._bvWorldSpace=new w;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;this.id=b._idGen.gen(a.idHint);this.castShadow=null!=a.castShadow?a.castShadow:!0;(this.metadata=a.metadata)&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=
new x);this.objectTransformation=h.mat4f64.create();this._initializeGeometryRecords(a.geometries,a.materials,a.transformations,a.origins)}Object.defineProperty(b.prototype,"geometryRecords",{get:function(){return this._geometryRecords},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometries",{get:function(){return this._geometries},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(a){k.mat4.copy(this._objectTransformation,
a);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")},enumerable:!0,configurable:!0});b.prototype.dispose=function(){for(var a=0,b=this._geometryRecords;a<b.length;a++)f.pool.release(b[a]);this._geometries=this._geometryRecords=null};b.prototype._initializeGeometryRecords=function(a,b,c,d){if(Array.isArray(a)){r(b.length===a.length,"Object3D: materials don't match geometries");r(c.length===a.length,"Object3D: transformations don't match geometries");this._geometryRecords=Array(a.length);
this._geometries=a.slice();for(var e=0;e<a.length;e++)this._geometryRecords[e]=f.pool.acquire(a[e],b[e],h.mat4f64.clone(c[e]),{},d&&d[e]);this._hasVolatileTransformation=!1}else this._geometryRecords=[],this._geometries=[]};Object.defineProperty(b.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(a){r(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0});b.prototype.getNumGeometryRecords=function(){return this._geometryRecords.length};
b.prototype.findGeometryRecords=function(a){for(var b=[],c=0;c<this._geometries.length;c++)this._geometries[c]===a&&b.push(this._geometryRecords[c]);return b};b.prototype.getGeometryRecord=function(a){r(0<=a&&a<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this._geometryRecords[a]};b.prototype.addGeometry=function(a,b,c,d,e,g){c=c?h.mat4f64.clone(c):t;this._geometries.push(a);a=f.pool.acquire(a,b,c,d||{},e,g);this._geometryRecords.push(a);this._hasVolatileTransformation=
this._geometryRecords.some(function(a){return!!a.shaderTransformation});this._notifyDirty("objGeometryAdded",a);this._invalidateBoundingVolume();this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;return a};b.prototype.removeGeometry=function(a){var b=this._geometryRecords.splice(a,1)[0];f.pool.release(b);this._hasVolatileTransformation=this._geometryRecords.some(function(a){return!!a.shaderTransformation});this._geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",b);this._invalidateBoundingVolume();
this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;return b};b.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};b.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this._geometryRecords[a]);this._invalidateBoundingVolume()};b.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;for(var a=0,b=this._geometryRecords;a<
b.length;a++){var c=b[a];if(!d.isAllHidden(c.instanceParameters.componentVisibilities,c.geometry.data.componentOffsets)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden};b.prototype.areAllComponentsVisible=function(){if(this._allComponentsVisibleDirty){this._allComponentsVisibleDirty=!1;this._allComponentsVisible=!0;for(var a=0,b=this._geometryRecords;a<b.length;a++){var c=b[a];if(!d.isAllVisible(c.instanceParameters.componentVisibilities,c.geometry.data.componentOffsets)){this._allComponentsVisible=
!1;break}}}return this._allComponentsVisible};b.prototype.hasComponents=function(){for(var a=!1,b=0;b<this._geometries.length&&!(a=d.hasComponents(this._geometries[b].data.componentOffsets));b++);return a};b.prototype.setComponentVisibility=function(a,b,c){b=d.updateVisibility(a.instanceParameters.componentVisibilities,a.geometry.data.componentOffsets,b,c);a.instanceParameters.componentVisibilities=b;this._notifyDirty("visibilityChanged",a);this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=
!0};b.prototype.setHidden=function(a,b){a.instanceParameters.hidden=!!b;this._notifyDirty("visibilityChanged",a)};b.prototype.isHidden=function(a){return!!a.instanceParameters.hidden};b.prototype.getComponentVisibility=function(a,b){return d.getVisibility(a.instanceParameters.componentVisibilities,b)};b.prototype.hideAllComponents=function(){if(this._allComponentsHiddenDirty||!this._allComponentsHidden){for(var a=0,b=this._geometryRecords;a<b.length;a++){var c=b[a],e=d.hideAllComponents(c.instanceParameters.componentVisibilities);
c.instanceParameters.componentVisibilities=e}this._notifyDirty("visibilityChanged");this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;this._allComponentsVisible=!1}};b.prototype.unhideAllComponents=function(){if(this._allComponentsVisibleDirty||!this._allComponentsVisible){for(var a=0,b=this._geometryRecords;a<b.length;a++){var c=b[a],e=d.unhideAllComponents(c.instanceParameters.componentVisibilities);c.instanceParameters.componentVisibilities=e}this._notifyDirty("visibilityChanged");
this._allComponentsHidden=this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!1;this._allComponentsVisible=!0}};b.prototype._setComponentHighlight=function(a,b,c,e){b=d.addHighlight(a.instanceParameters.componentHighlights,b,c,e);a.instanceParameters.componentHighlights=b};b.prototype.setComponentHighlight=function(a,b,d){var e=c.generateHighlightId();this._setComponentHighlight(a,b,d,e);this._notifyDirty("componentHighlightChanged");return e};b.prototype.highlightAllComponents=function(a){for(var b=
c.generateHighlightId(),d=0,e=this._geometryRecords;d<e.length;d++)this._setComponentHighlight(e[d],null,a,b);this._notifyDirty("componentHighlightChanged");return b};b.prototype.removeHighlights=function(a){for(var b=0,c=this._geometryRecords;b<c.length;b++){var e=c[b].instanceParameters,f=d.removeHighlight(e.componentHighlights,a);e.componentHighlights=f}this._notifyDirty("componentHighlightChanged")};b.prototype.getComponentFromTriangleNr=function(a,b){r(0<=a&&a<this._geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");
return d.componentFind(this._geometryRecords[a].geometry.data.componentOffsets,3*b)};b.prototype.setGeometryTransformation=function(a,b){r(0<=a&&a<this._geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var c=this._geometryRecords[a];f.pool.release(c);b=f.pool.acquire(c.geometry,c.material,h.mat4f64.clone(b),c.instanceParameters);this._geometryRecords[a]=b;this._notifyDirty("objGeometryReplaced",[c,b]);this._invalidateBoundingVolume()};b.prototype.getCombinedStaticTransformation=
function(a,b){b=b||h.mat4f64.create();k.mat4.multiply(b,this.objectTransformation,a.getStaticTransformation());return b};b.prototype.getCombinedShaderTransformation=function(a,b){b=b||h.mat4f64.create();k.mat4.multiply(b,this.objectTransformation,a.getShaderTransformation());return b};b.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};b.prototype.getMetadata=function(){return this.metadata};b.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?
this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};b.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};b.prototype.getCenter=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.center:this._bvWorldSpace.center};b.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};b.prototype._validateBoundingVolume=function(){if(this._bvDirty||
this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var b=0;b<this._geometryRecords.length;++b){var c=this._geometries[b],d=this._geometryRecords[b],c=c.boundingInfo;this._calculateTransformedBoundingVolume(c,this._bvObjectSpace,d.getShaderTransformation());this._calculateTransformedBoundingVolume(c,this._bvWorldSpace,this.getCombinedShaderTransformation(d))}a.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5);a.vec3.lerp(this._bvWorldSpace.center,
this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);for(var d=g.vec3f64.create(),f=g.vec3f64.create(),h=e.maxScale(this.objectTransformation),b=0;b<this._geometryRecords.length;++b){var c=this._geometries[b],k=this._geometryRecords[b].getShaderTransformation(),p=e.maxScale(k),c=c.boundingInfo;a.vec3.transformMat4(d,c.getCenter(),k);k=a.vec3.distance(d,this._bvObjectSpace.center);c=c.getBSRadius()*p;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,k+c);a.vec3.transformMat4(f,d,
this.objectTransformation);p=a.vec3.distance(f,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,p+c*h)}this._bvDirty=!1}};b.prototype._calculateTransformedBoundingVolume=function(b,c,d){var e=b.getBBMin();b=b.getBBMax();var f=g.vec3f64.clone(e),h=g.vec3f64.clone(b);a.vec3.transformMat4(f,f,d);a.vec3.transformMat4(h,h,d);for(var m=0;3>m;++m)c.bbMin[m]=Math.min(c.bbMin[m],f[m],h[m]),c.bbMax[m]=Math.max(c.bbMax[m],f[m],h[m]);for(m=0;3>m;++m){a.vec3.copy(f,e);
a.vec3.copy(h,b);f[m]=b[m];h[m]=e[m];a.vec3.transformMat4(f,f,d);a.vec3.transformMat4(h,h,d);for(var k=0;3>k;++k)c.bbMin[k]=Math.min(c.bbMin[k],f[k],h[k]),c.bbMax[k]=Math.max(c.bbMax[k],f[k],h[k])}};b.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};b.prototype._notifyDirty=function(a,b,c,d){this._parentLayer&&this._parentLayer.notifyDirty(a,b,c||1,
d||this)};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{hasGeometry:function(b){return-1<a._geometries.indexOf(b)},getGeometryIndex:function(b){return a._geometries.indexOf(b)}}},enumerable:!0,configurable:!0});b._idGen=new q.IdGen;return b}();var x=function(){function a(){this.bbMin=g.vec3f64.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.bbMax=g.vec3f64.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}a.prototype.isEmpty=function(){return this.bbMax[0]<
this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<this.bbMin[2]};return a}(),w=function(b){function c(){var a=b.call(this)||this;a.center=g.vec3f64.create();a.bsRadius=0;return a}l(c,b);c.prototype.init=function(){a.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);a.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);a.vec3.set(this.center,0,0,0);this.bsRadius=0};c.prototype.getCenter=function(){return this.center};c.prototype.getBSRadius=function(){return this.bsRadius};
return c}(x);return n})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","../../../../core/ObjectPool","./IdGen"],function(n,b,l,k){return function(){function b(a,g,e,d,f,c){this.id=b._idGen.gen(a&&a.id);this.geometry=a;this.material=g;this.transformation=e;this.instanceParameters=d;this.origin=f;this.shaderTransformation=c}b.prototype.getStaticTransformation=function(){return this.transformation};b.prototype.getShaderTransformation=function(){return this.shaderTransformation?
this.shaderTransformation(this.transformation):this.transformation};b._idGen=new k.IdGen;b.pool=new l(b,!0);return b}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._count=0}b.prototype.gen=function(b){null==b&&(b="a");return b+"_"+this._count++};return b}();b.IdGen=n})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],
function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});var k=new l.IdGen;b.generateHighlightId=function(){return k.gen("highlight")}})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../state/utils/viewUtils ../../support/earthUtils ../../support/geometryUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){function p(a,b,c,e,f){void 0===c&&(c=d.defaultApplyOptions);void 0===e&&(e=b);void 0===f&&(f=!0);b!==e&&e.copyFrom(b);B.eyeCenterDistance=0;B.requiresTwoSteps=!1;var m=r(a,b,c,void 0,B);if(0===m)return!1;h.mat4.identity(u);h.mat4.rotate(u,u,-m,b.viewRight);switch(c.tiltMode){case 1:g.vec3.transformMat4(w,b.viewForward,u);g.vec3.scale(w,w,B.eyeCenterDistance);g.vec3.add(e.center,b.eye,w);break;case 0:g.vec3.subtract(w,b.center,b.eye);g.vec3.transformMat4(w,w,u);g.vec3.subtract(e.eye,
b.center,w);break;default:l.neverReached(c.tiltMode)}g.vec3.transformMat4(e.up,e.up,u);e.markViewDirty();return B.requiresTwoSteps&&f?p(a,e,c,e,!1):!0}function r(a,b,e,h,p){void 0===e&&(e=d.defaultApplyOptions);void 0===h&&(h=d.defaultApplyOptions);if(!a.state.constraints.tilt)return 0;var u=a.state.constraints.tilt(b.distance,v);var w=e;if(0!==w.interactionType){var B=w.interactionStartCamera,C=w.interactionFactor,D=u.min,n=u.max,K=r(a,B,d.defaultApplyOptions,w),I=0===K?0:f.viewAngle(a.renderCoordsHelper,
B.center,B.eye);u.min=D;u.max=n;2===w.interactionType?(d.hasConstraintType(w.selection,2)&&x(a,B,u),d.adjustRangeForInteraction(K,I,!0,C,m,u)):d.adjustRangeForInteraction(K,I,!1,C,m,u)}2===h.interactionType&&d.hasConstraintType(h.selection,2)&&x(a,h.interactionStartCamera,u);if(1===e.tiltMode||1===h.tiltMode){a:switch(p&&(p.requiresTwoSteps=!1),a.viewingMode){case "global":e=z;w=a.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;h=w+c.earthRadius;w=a.renderCoordsHelper.intersectManifold(b.ray,
w,y);e.eyeCenterDistance=b.distance;w?(e.eyeCenterDistance=g.vec3.distance(b.eye,y),e.tiltAtCenter=f.viewAngle(a.renderCoordsHelper,y,b.eye)):a.state.isLocal?e.tiltAtCenter=f.viewAngle(a.renderCoordsHelper,b.center,b.eye):(q.sphere.closestPointOnSilhouette(q.sphere.wrap(h),b.ray,y),e.eyeCenterDistance=g.vec3.distance(b.eye,y),e.tiltAtCenter=k.acosClamped(-g.vec3.dot(b.viewForward,g.vec3.normalize(y,y))));e.radius=h;e.eyeRadius=g.vec3.length(b.eye);e.constraints=a.state.constraints;e.centerIsOnSurface=
w;b=k.clamp(e.tiltAtCenter,u.min,u.max);if(1E-9<Math.abs(e.tiltAtCenter-b)){if(e.centerIsOnSurface){b=e.constraints;a=h=e.tiltAtCenter;u=b.clampTilt(e.eyeCenterDistance,h);w=t(e,u);if(b.clampTilt(w,h)!==u)for(h=0;10>h&&1E-9<Math.abs(u-a);)w=(a+u)/2,B=t(e,w),B=b.clampTilt(B,w),1E-9<Math.abs(B-w)?a=w:u=w,h++;b=u;u=b;a=k.asinClamped(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter));u=k.asinClamped(e.radius/e.eyeRadius*Math.sin(u));a=e.eyeRadius>e.radius?a-u:u-a}else b=e.constraints.clampTilt(e.eyeCenterDistance,
e.tiltAtCenter),p&&b<Math.PI/2&&(p.requiresTwoSteps=!0,b=Math.PI/2-1E-5),a=e.tiltAtCenter-Math.PI/2-(b-Math.PI/2);p&&(p.eyeCenterDistance=t(e,b));p=a}else p=0;break a;case "local":h=f.viewAngle(a.renderCoordsHelper,b.center,b.eye);e=k.clamp(h,u.min,u.max);u=h-e;1E-9<Math.abs(u)?(p&&(h=a.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a=a.renderCoordsHelper.getAltitude(b.eye)-h,e=Math.cos(e),p.eyeCenterDistance=1E-4<Math.abs(e)?a/e:b.distance),p=u):p=0;break a;default:l.neverReached(a.viewingMode),
p=void 0}return p}p=f.viewAngle(a.renderCoordsHelper,b.center,b.eye);b=k.clamp(p,u.min,u.max);p-=b;p=1E-9<Math.abs(p)?p:0;return p}function t(a,b){if(!a.centerIsOnSurface)return a.eyeCenterDistance;b=Math.PI-k.clamp(b,0,Math.PI);var c=k.asinClamped(a.radius/a.eyeRadius*Math.sin(b)),d=Math.sin(Math.PI-b-c)/Math.sin(b);return a.eyeRadius<a.radius&&1<d?Math.sin(Math.PI-b-(Math.PI-c))/Math.sin(b)*a.eyeRadius:d*a.eyeRadius}function x(a,b,d){if(!a.state.isLocal){var e=a.state.constraints;if(e.altitude){a=
g.vec3.squaredLength(b.center);var f=Math.sqrt(a);b=b.distance;var h=e.altitude.min+c.earthRadius,e=e.altitude.max+c.earthRadius,h=(h*h-b*b-a)/(-2*f*b);d.min=Math.max(d.min,Math.min(Math.PI-k.acosClamped((e*e-b*b-a)/(-2*f*b)),d.max));d.max=Math.min(d.max,Math.PI-k.acosClamped(h))}}}Object.defineProperty(b,"__esModule",{value:!0});b.apply=p;b.error=r;var w=e.vec3f64.create(),u=a.mat4f64.create(),y=e.vec3f64.create(),m=k.deg2rad(5),v={min:0,max:0},z={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,
eyeCenterDistance:0,tiltAtCenter:0},B={eyeCenterDistance:0,requiresTwoSteps:!1}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});b.viewAngle=function(b,d,f){b.worldUpAtPosition(d,a);k.vec3.subtract(g,f,d);b=k.vec3.length(g);return 0===b?0:l.acosClamped(k.vec3.dot(g,a)/b)};var a=h.vec3f64.create(),
g=h.vec3f64.create()})},"esri/views/animation/easing":function(){define(["require","exports"],function(n,b){function l(a){return a}function k(a){var b=2*(a-Math.sqrt((a-1)*a)),e=b/2/a;return function(d){return d<e?a*d*d:b*d-b+1}}function h(a,b){return function(e){return e<b?b*a(e/b):1-a((1-e)/(1-b))*(1-b)}}Object.defineProperty(b,"__esModule",{value:!0});b.linear=l;b.inQuad=function(a){return a*a};b.outQuad=function(a){return 1-b.inQuad(1-a)};b.inOutQuad=function(a){return.5>a?b.inQuad(2*a)/2:(b.outQuad(2*
(a-.5))+1)/2};b.inCubic=function(a){return a*a*a};b.outCubic=function(a){return 1-b.inCubic(1-a)};b.inOutCubic=function(a){return.5>a?b.inCubic(2*a)/2:(b.outCubic(2*(a-.5))+1)/2};b.inQuart=function(a){return a*a*a*a};b.outQuart=function(a){return 1-b.inQuart(1-a)};b.inOutQuart=function(a){return.5>a?b.inQuart(2*a)/2:(b.outQuart(2*(a-.5))+1)/2};b.inQuint=function(a){return a*a*a*a*a};b.outQuint=function(a){return 1-b.inQuint(1-a)};b.inOutQuint=function(a){return.5>a?b.inQuint(2*a)/2:(b.outQuint(2*
(a-.5))+1)/2};b.inSine=function(a){return-Math.cos(a*Math.PI/2)+1};b.outSine=function(a){return 1-b.inSine(1-a)};b.inOutSine=function(a){return.5>a?b.inSine(2*a)/2:(b.outSine(2*(a-.5))+1)/2};b.inExpo=function(a){return Math.pow(2,10*(a-1))};b.outExpo=function(a){return 1-b.inExpo(1-a)};b.inOutExpo=function(a){return.5>a?b.inExpo(2*a)/2:(b.outExpo(2*(a-.5))+1)/2};b.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};b.outCirc=function(a){return 1-b.inCirc(1-a)};b.inOutCirc=function(a){return.5>a?b.inCirc(2*
a)/2:(b.outCirc(2*(a-.5))+1)/2};b.inCoastQuad=h(k(1),1);b.outCoastQuad=h(k(1),0);b.inOutCoastQuad=h(k(1),.5);b.inCoastCubic=h(k(2),1);b.outCoastCubic=h(k(2),0);b.inOutCoastCubic=h(k(2),.5);b.inCoastQuart=h(k(3),1);b.outCoastQuart=h(k(3),0);b.inOutCoastQuart=h(k(3),.5);b.inCoastQuint=h(k(4),1);b.outCoastQuint=h(k(4),0);b.inOutCoastQuint=h(k(4),.5);b.named={linear:l,"in-quad":b.inQuad,"out-quad":b.outQuad,"in-out-quad":b.inOutQuad,"in-coast-quad":b.inCoastQuad,"out-coast-quad":b.outCoastQuad,"in-out-coast-quad":b.inOutCoastQuad,
"in-cubic":b.inCubic,"out-cubic":b.outCubic,"in-out-cubic":b.inOutCubic,"in-coast-cubic":b.inCoastCubic,"out-coast-cubic":b.outCoastCubic,"in-out-coast-cubic":b.inOutCoastCubic,"in-quart":b.inQuart,"out-quart":b.outQuart,"in-out-quart":b.inOutQuart,"in-coast-quart":b.inCoastQuart,"out-coast-quart":b.outCoastQuart,"in-out-coast-quart":b.inOutCoastQuart,"in-quint":b.inQuint,"out-quint":b.outQuint,"in-out-quint":b.inOutQuint,"in-coast-quint":b.inCoastQuint,"out-coast-quint":b.outCoastQuint,"in-out-coast-quint":b.inOutCoastQuint,
"in-sine":b.inSine,"out-sine":b.outSine,"in-out-sine":b.inOutSine,"in-expo":b.inExpo,"out-expo":b.outExpo,"in-out-expo":b.inOutExpo,"in-circ":b.inCirc,"out-circ":b.outCirc,"in-out-circ":b.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3f64 ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera".split(" "),function(n,b,
l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,c,d){d=a.call(this,d)||this;d.viewState=b;d.intersectionHelper=c;d.hasTarget=!1;d.animation=new h.default(d.viewState.mode);return d}l(b,a);b.prototype.begin=function(a,b){this.hasTarget=!0;b=this.animationSettings(b);e.copyFrom(this.viewState.camera);this.intersectionHelper.intersectRay(e.ray,d)&&(e.center=d);this.animation.update(e,a,b);this.animation.finished&&this.finish()};b.prototype.finish=function(){this.animation.currentTime=
this.animation.time;a.prototype.finish.call(this)};Object.defineProperty(b.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});b.prototype.stepController=function(b,c){a.prototype.stepController.call(this,b,c);this.hasTarget&&this.animation.step(b,c)};b.prototype.onControllerEnd=function(b){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,b),this.animation.currentTime=this.animation.time);
a.prototype.onControllerEnd.call(this,b)};b.prototype.animationSettings=function(a){void 0===a&&(a={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};return b}(a.AnimationController);b.PointToPointAnimationController=n;var e=new g.default,d=k.vec3f64.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});var d=h.vec3f64.create();n=function(){function b(b){this.currentTime=0;this.animation=new e.Animation(function(){return new a.default(b)});this._current=new a.default(b)}Object.defineProperty(b.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});
b.prototype.update=function(a,b,e){var c=this.animation.definition.source,f=this.animation.definition.target,g=k.vec3.subtract(d,b.center,a.center),h=k.vec3.length(g);1E-5<=h?(g[0]/=h,g[1]/=h,g[2]/=h):(g[0]=0,g[1]=1,g[0]=0);k.vec3.copy(c.lookAtDirection,g);k.vec3.copy(f.lookAtDirection,g);c.copyFromRenderCamera(a);f.copyFromRenderCamera(b);this._current.copyFrom(c);this.animation.update(c,f,e);this.currentTime=0;a.almostEquals(b,5E-4,!0)&&(this.currentTime=this.animation.time)};b.prototype.cameraAt=
function(a,b){this.animation.cameraAt(a,this._current);b=b||new g.default;this._current.copyToRenderCamera(b);return b};b.prototype.step=function(a,b){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,b)};return b}();b.Animation=n;b.default=n})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});var d=g.vec3f64.create(),f=g.vec3f64.create(),c=g.vec3f64.create(),q=g.vec3f64.create(),p=g.vec3f64.create(),r=g.vec3f64.create(),t=g.vec3f64.fromValues(0,0,1),x=g.vec3f64.fromValues(0,1,0),w=g.vec3f64.fromValues(1,0,0),u=h.mat3f64.create();n=function(){function b(a){void 0===a&&(a="global");this.viewingMode=a;this.center=g.vec3f64.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=g.vec3f64.clone(x)}b.prototype.pixelsPerPanAtZoom=
function(a){return this.size/2/(this._zoomToPanScale*a)};b.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};b.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};b.prototype.compareTo=function(b,c){c||(c={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var d=a.vec3.length(this.center),f=a.vec3.length(b.center),d=(d+f)/2;c.pan=e.angle(this.center,b.center)*d}else c.pan=a.vec3.distance(this.center,
b.center);d=Math.abs(b.yaw-this.yaw);d>=Math.PI&&(d=2*Math.PI-d);c.rotate=Math.max(d,Math.abs(b.pitch-this.pitch));c.sourceZoom=this.distance;c.targetZoom=b.distance;return c};b.prototype.interpolate=function(b,c,d){"global"===this.viewingMode?e.slerp(b.center,c.center,d.pan,this.center):a.vec3.lerp(this.center,b.center,c.center,d.pan);this.distance=l.lerp(b.distance,c.distance,d.zoom);this.pitch=l.lerp(b.pitch,c.pitch,d.rotate);b=b.yaw;c=c.yaw;Math.abs(c-b)>=Math.PI&&(b+=2*(b<c?1:-1)*Math.PI);this.yaw=
l.lerp(b,c,d.rotate)};b.prototype.copyFrom=function(b){a.vec3.copy(this.center,b.center);this.pitch=b.pitch;this.yaw=b.yaw;this.distance=b.distance;a.vec3.copy(this.lookAtDirection,b.lookAtDirection);this.size=b.size;this.copyFromCommon(b);this.viewingMode=b.viewingMode};b.prototype.copyFromRenderCamera=function(b){var c=this._lookAtOrientation(b.center,u);a.vec3.copy(this.center,b.center);a.vec3.subtract(q,b.center,b.eye);a.vec3.transformMat3(q,q,c);a.vec3.transformMat3(p,b.up,c);this.distance=a.vec3.length(q);
q[0]/=this.distance;q[1]/=this.distance;q[2]/=this.distance;this.pitch=this._eyeUpToPitch(q,p);this.yaw=this._eyeUpToYaw(q,p);this.size=Math.sqrt(b.width*b.width+b.height*b.height);this.copyFromCommon(b)};b.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};b.prototype.copyToRenderCamera=function(b){var c=this._lookAtOrientation(this.center,u);k.mat3.transpose(c,c);this._axisAngleVec3(w,this.pitch-Math.PI/2,x,q);this._axisAngleVec3(t,this.yaw,q);this._axisAngleVec3(w,
this.pitch-Math.PI/2,t,p);this._axisAngleVec3(t,this.yaw,p);a.vec3.scale(q,q,this.distance);a.vec3.transformMat3(q,q,c);a.vec3.transformMat3(p,p,c);b.center=this.center;b.eye=a.vec3.subtract(q,this.center,q);b.up=p};b.prototype._axisAngleVec3=function(b,e,g,h){void 0===h&&(h=g);var m=Math.cos(e);e=Math.sin(e);a.vec3.scale(d,g,m);a.vec3.cross(f,b,g);a.vec3.scale(f,f,e);a.vec3.scale(c,b,(1-m)*a.vec3.dot(b,g));return a.vec3.add(h,a.vec3.add(h,d,f),c)};b.prototype._lookAtOrientation=function(b,e){this._upAtLookAt(b,
c);a.vec3.cross(d,this.lookAtDirection,c);a.vec3.normalize(d,d);0===d[0]&&0===d[1]&&0===d[2]&&a.vec3.copy(d,w);a.vec3.cross(f,c,d);a.vec3.normalize(f,f);e||(e=h.mat3f64.create());e[0]=d[0];e[1]=f[0];e[2]=c[0];e[3]=d[1];e[4]=f[1];e[5]=c[1];e[6]=d[2];e[7]=f[2];e[8]=c[2];return e};b.prototype._upAtLookAt=function(b,c){return"local"===this.viewingMode?a.vec3.copy(c,t):a.vec3.normalize(c,b)};b.prototype._eyeUpToPitch=function(a,b){return Math.PI-e.angle(t,a)};b.prototype._eyeUpToYaw=function(b,c){.5>Math.abs(c[2])?
(a.vec3.copy(r,c),0<b[2]&&a.vec3.scale(r,r,-1)):a.vec3.copy(r,b);a.vec3.cross(f,r,t);a.vec3.normalize(f,f);return e.angle(w,f,t)};return b}();b.default=n})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/vector ./Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];a=b[3]-a[3];return c*c+d*d+e*e+a*a}function x(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function w(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,d,g){void 0===b&&(b=e.vec3f64.create());void 0===d&&(d=e.vec3f64.create());void 0===g&&(g=e.vec3f64.fromValues(0,0,1));this._viewUp=e.vec3f64.create();this._viewForward=
e.vec3f64.create();this._viewRight=e.vec3f64.create();this._ray=c.ray.createWrapper();this._viewport=f.vec4f64.fromValues(0,0,1,1);this._padding=f.vec4f64.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._near=1;this._far=1E3;this._viewDirty=!0;this._viewMatrix=a.mat4f64.create();this._projectionDirty=!0;this._projectionMatrix=a.mat4f64.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=a.mat4f64.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=a.mat4f64.create();
this._frustumDirty=!0;this._frustum=c.frustum.create();this._fullViewport=null;this.pixelRatio=1;this.relativeElevation=0;this._eye=e.vec3f64.clone(b);this._center=e.vec3f64.clone(d);this._up=e.vec3f64.clone(g);this._padding=f.vec4f64.create()}Object.defineProperty(b.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,
this._center)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ray",{get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=e.vec3f64.create());g.vec3.subtract(this._ray.direction,this.center,this.eye);return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewMatrix",
{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){h.mat4.copy(this._viewMatrix,a);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==
a&&(this._far=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=f.vec4f64.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=
this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],
this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+this._padding[2]),d.vec4.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(h.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=this.width,b=this.height,c=this.near*Math.tan(this.fovY/2),d=c*this.aspect;h.mat4.frustum(this._projectionMatrix,-d*(1+2*this._padding[3]/a),d*(1+2*this._padding[1]/a),-c*(1+2*this._padding[2]/b),c*(1+2*this._padding[0]/b),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){h.mat4.copy(this._projectionMatrix,a);this._projectionDirty=
!1;this._frustumDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fov",{get:function(){return this._fov},set:function(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fovX",{get:function(){return r.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=r.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fovY",{get:function(){return r.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=r.fovy2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"distance",{get:function(){return g.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"frustum",{get:function(){this._recomputeFrustum();return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=a.mat4f64.create()),h.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),h.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=
!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"aboveGround",{get:function(){return 0<=this.relativeElevation},enumerable:!0,configurable:!0});
b.prototype.copyFrom=function(b){g.vec3.copy(this._eye,b._eye);g.vec3.copy(this._center,b._center);g.vec3.copy(this._up,b._up);d.vec4.copy(this._viewport,b._viewport);d.vec4.copy(this._padding,b._padding);this._near=b._near;this._far=b._far;this._fov=b._fov;this.relativeElevation=b.relativeElevation;this._viewDirty=b._viewDirty;this._viewDirty||(h.mat4.copy(this._viewMatrix,b._viewMatrix),g.vec3.copy(this._viewRight,b._viewRight),g.vec3.copy(this._viewUp,b._viewUp),g.vec3.copy(this._viewForward,b._viewForward));
b._projectionDirty?this._projectionDirty=!0:(h.mat4.copy(this._projectionMatrix,b._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=b._frustumDirty;this._frustumDirty||(c.frustum.copy(b._frustum,this._frustum),this._frustumDirty=!1);b._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?h.mat4.copy(this._viewInverseTransposeMatrix,b._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=a.mat4f64.clone(b._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1);b._fullViewport?this._fullViewport?d.vec4.copy(this._fullViewport,b._fullViewport):this._fullViewport=f.vec4f64.clone(b._fullViewport):this._fullViewport=null;this.pixelRatio=b.pixelRatio;return this};b.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};b.prototype.clone=function(){var a=new b;a.copyFrom(this);return a};b.prototype.equals=function(a){return x(this._eye,a._eye)&&x(this._center,a._center)&&x(this._up,a._up)&&
w(this._viewport,a._viewport)&&w(this._padding,a._padding)&&this._near===a._near&&this._far===a._far&&this._fov===a._fov&&this.pixelRatio===a.pixelRatio&&this.relativeElevation===a.relativeElevation};b.prototype.almostEquals=function(a,b,c){void 0===c&&(c=!1);b=g.vec3.distance(this._eye,this._center)*(b||5E-4);b*=b;c?(q.directionFromTo(m,a._eye,a._center),q.directionFromTo(v,this._eye,this._center),c=1E-10):(g.vec3.copy(m,a._center),g.vec3.copy(v,this._center),c=b);return g.vec3.squaredDistance(a._eye,
this._eye)<b&&g.vec3.squaredDistance(m,v)<c&&.001>Math.abs(a._fov-this._fov)&&.5>t(a._padding,this._padding)&&.5>t(a._viewport,this._viewport)&&this.pixelRatio===a.pixelRatio};b.prototype.markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};b.prototype.computeRenderPixelSizeAt=function(a){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(a))};b.prototype.computeRenderPixelSizeAtDist=function(a){return a*this.perRenderPixelRatio};b.prototype.computeScreenPixelSizeAt=
function(a){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(a))};b.prototype.viewDirectionDistance=function(a){return Math.abs(p.projectPointSignedLength(this.viewForward,g.vec3.subtract(m,a,this._eye)))};b.prototype.computeScreenPixelSizeAtDist=function(a){return a*this.perScreenPixelRatio};b.prototype.computeDistanceFromRadius=function(a,b){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};b.prototype.getScreenCenter=function(a){void 0===a&&(a=k.createScreenPointArray());
a[0]=(this.padding[3]+this.width/2)/this.pixelRatio;a[1]=(this.padding[0]+this.height/2)/this.pixelRatio;return a};b.prototype.getRenderCenter=function(a){a||(a=k.createRenderScreenPointArray3());a[0]=this.padding[3]+this.width/2;a[1]=this.padding[2]+this.height/2;2<a.length&&(a[2]=.5);return a};b.prototype.setGLViewport=function(a){var b=this.viewport,c=this.padding;a.setViewport(b[0]-c[3],b[1]-c[2],b[2]+c[1]+c[3],b[3]+c[0]+c[2])};b.prototype.applyProjection=function(a,b,c){void 0===c&&(c=!1);a!==
u&&g.vec3.copy(u,a);u[3]=1;c&&(b[2]=-u[2]);d.vec4.transformMat4(u,u,this.projectionMatrix);g.vec3.scale(u,u,1/Math.abs(u[3]));a=this.fullViewport;b[0]=l.lerp(0,a[0]+a[2],.5+.5*u[0]);b[1]=l.lerp(0,a[1]+a[3],.5+.5*u[1]);c||(b[2]=.5*(u[2]+1));return b};b.prototype.projectPoint=function(a,b){u[0]=a[0];u[1]=a[1];u[2]=a[2];u[3]=1;d.vec4.transformMat4(u,u,this.viewProjectionMatrix);if(0===u[3])return null;g.vec3.scale(u,u,1/Math.abs(u[3]));a=this.fullViewport;"x"in b?(b.x=l.lerp(0,a[0]+a[2],.5+.5*u[0]),
b.y=l.lerp(0,a[1]+a[3],.5+.5*u[1])):(b[0]=l.lerp(0,a[0]+a[2],.5+.5*u[0]),b[1]=l.lerp(0,a[1]+a[3],.5+.5*u[1]),2<b.length&&(b[2]=.5*(u[2]+1)));return b};b.prototype.unprojectPoint=function(a,b){h.mat4.multiply(y,this.projectionMatrix,this.viewMatrix);if(!h.mat4.invert(y,y))return null;var c=this.fullViewport;u[0]=2*(a[0]-c[0])/c[2]-1;u[1]=2*(a[1]-c[1])/c[3]-1;u[2]=2*a[2]-1;u[3]=1;d.vec4.transformMat4(u,u,y);if(0===u[3])return null;b[0]=u[0]/u[3];b[1]=u[1]/u[3];b[2]=u[2]/u[3];return b};b.prototype.computeUp=
function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()};b.prototype.screenToRender=function(a,b){var c=this.fullHeight-a[1]*this.pixelRatio;b[0]=a[0]*this.pixelRatio;b[1]=c;return b};b.prototype.renderToScreen=function(a,b){var c=(this.fullHeight-a[1])/this.pixelRatio;b[0]=a[0]/this.pixelRatio;b[1]=c;return b};b.prototype.computeUpGlobal=function(){g.vec3.subtract(m,this.center,this.eye);var a=g.vec3.length(this.center);1>a?(g.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(g.vec3.dot(m,
this.center))>.9999*g.vec3.length(m)*a||(g.vec3.cross(this.up,m,this.center),g.vec3.cross(this.up,this.up,m),g.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype.computeUpLocal=function(){q.directionFromTo(m,this.eye,this.center);.9999>=Math.abs(m[2])&&(g.vec3.scale(m,m,m[2]),g.vec3.set(this.up,-m[0],-m[1],1-m[2]),g.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype._compareAndSetView=function(a,b){x(a,b)||(g.vec3.copy(b,a),this._viewProjectionDirty=this._frustumDirty=
this._viewDirty=!0)};b.prototype._recomputeFrustum=function(){this._frustumDirty&&(c.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};b.prototype._ensureViewClean=function(){this._viewDirty&&(h.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),g.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),g.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),g.vec3.set(this._viewRight,
this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return b}();b.default=n;var u=f.vec4f64.create(),y=a.mat4f64.create(),m=e.vec3f64.create(),v=e.vec3f64.create()})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});var g={zoom:0,pan:0,rotate:0};n=function(){function b(b){this.createCamera=
b;this.time=0;this.definition=new k.Definition(b);this.path=new a.Path}b.prototype.update=function(a,b,c){this.definition.update(a,b,c);this.path.update(this.definition,c);this.time=this._applyTimeSettings(this.path.time,c);this.settings=c};b.prototype.cameraAt=function(a,b){b=b||this.createCamera();a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.normalizedEasing(this.settings.easing,a,1E3*this.time):1<=this.time?this.normalizedEasing(l.inOutCoastQuad,a):this.normalizedEasing(l.outExpo,a);
a=this.path.interpolateComponentsAt(a,g);b.interpolate(this.definition.source,this.definition.target,a);return b};b.prototype.normalizedEasing=function(a,b,c){c=a(0);var d=a(1);return(a(b)-c)/(d-c)};b.prototype._applyTimeSettings=function(a,b){var c=null!=b.speedFactor?b.speedFactor:1;null!=b.duration?a=b.duration:null!=b.speedFactor&&(a/=c);return a=Math.min(Math.max(null!=b.minDuration?b.minDuration:h.defaultSettings.minDuration/c,a),null!=b.maxDuration?b.maxDuration:h.defaultSettings.maxDuration/
c)};return b}();b.Animation=n;b.default=n})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.createCamera=b;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:l.defaultSettings.desiredScreenFlow};this.source=b();this.target=b()}b.prototype.clone=function(){var h=new b(this.createCamera);h.copyFrom(this);return h};
b.prototype.copyFrom=function(b){this.update(b.source,b.target,b.settings)};b.prototype.update=function(b,a,g){this.source!==b&&this.source.copyFrom(b);this.target!==a&&this.target.copyFrom(a);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=g.desiredScreenFlow?g.desiredScreenFlow:l.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};b.prototype.halfWindowPanAtZoom=
function(b){b=this.target.pixelsPerPanAtZoom(b);return this.halfWindowSize/b};Object.defineProperty(b.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,configurable:!0});return b}();
b.Definition=n;b.default=n})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=
function(b){function d(d,c){var e=b.call(this)||this;e._preallocSegments=[new a.default,new a.default,new a.default];e.update(d,c);return e}l(d,b);d.prototype.update=function(a,b){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var c=null;b&&b.apex&&(c=g.optimalDistance(a,b.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==c?this._updateWithoutApex():this._updateWithApex(c,b.apex)}};d.prototype.segmentInterpolateComponentsAt=function(a,
b,d){d=a.interpolateComponentsAt(b,d);a===this._ascensionSegment?d.zoom=k.outQuad(d.zoom):a===this._descensionSegment&&(d.zoom=k.inQuad(d.zoom));return d};d.prototype._updateWithApex=function(a,b){var c=this._preallocSegments,d=c[0],e=c[1],c=c[2],f=null!=b.ascensionFactor?b.ascensionFactor:.5;b=Math.min(1-f,null!=b.ascensionFactor?b.descensionFactor:.5);var g=1-f-b;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.targetZoom=a;d.definition.compared.pan=
this.definition.compared.pan*f;d.definition.compared.rotate=this.definition.compared.rotate*f;d.update();this._ascensionSegment=d;this.segments.push(d);0<g&&(e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone(),e.definition.copyFrom(this.definition),e.definition.compared.sourceZoom=a,e.definition.compared.targetZoom=a,e.definition.compared.pan=this.definition.compared.pan*g,e.definition.compared.rotate=this.definition.compared.rotate*g,e.update(),this.segments.push(e));
c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone();c.definition.compared.sourceZoom=a;c.definition.compared.pan=this.definition.compared.pan*b;c.definition.compared.rotate=this.definition.compared.rotate*b;c.update();this._descensionSegment=c;this.segments.push(c)};d.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return d}(h.default);b.Path=n;b.default=n})},"esri/views/animation/pointToPoint/Path":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.segments=[]}Object.defineProperty(b.prototype,"time",{get:function(){return this.segments.reduce(function(b,h){return b+h.time},0)},enumerable:!0,configurable:!0});b.prototype.interpolateComponentsAt=function(b,h){b=Math.min(Math.max(b,0),1);b*=this.time;for(var a=0,g=0,e=this.definition,d=0;d<this.segments.length;d++){var f=this.segments[d],c=f.definition;if(b<=f.time||d===this.segments.length-
1)return h=this.segmentInterpolateComponentsAt(f,b/f.time,h),h.pan=e.hasPan?(a+c.compared.pan*h.pan)/e.compared.pan:1,h.rotate=e.hasRotate?(g+c.compared.rotate*h.rotate)/e.compared.rotate:1,b=h.zoom*(c.compared.targetZoom-c.compared.sourceZoom)+c.compared.sourceZoom,a=this.segments[0].definition.compared.sourceZoom,g=this.segments[this.segments.length-1].definition.compared.targetZoom,h.zoom=e.hasZoom?(b-a)/(g-a):1,h;b-=f.time;a+=c.compared.pan;g+=c.compared.rotate}};b.prototype.segmentInterpolateComponentsAt=
function(b,h,a){return b.interpolateComponentsAt(h,a)};return b}();b.Path=n;b.default=n})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){b&&this.update(b)}b.prototype.update=function(b){b&&(this.definition?this.definition.copyFrom(b):this.definition=b.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};b.prototype._updatePrecomputedVariables=function(){var b=
this.definition,h=b.compared,a=h.sourceZoom,g=h.targetZoom;this._zoomSign=a>g?1:-1;this._panPixelsAtSource=h.pan*b.source.pixelsPerPanAtZoom(a);b=(b.source.pixelsPerRotateAtZoom(a)+b.target.pixelsPerRotateAtZoom(g))/2;this._rotatePixels=h.rotate*b};b.prototype._updatePixelFlow=function(){var b=this.definition.compared.sourceZoom,h=this.definition.compared.targetZoom,a=this.definition,g=a.hasZoom,e=a.hasPan,a=a.hasRotate,d=0,f=0;g&&(e&&(d=(h/b-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*
Math.LN2*this._panPixelsAtSource)),a&&(f=Math.log(b/h)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;b=this.definition.desiredPixelFlow;g&&e&&a?(h=d+f+d*f,this._zoomPixelFlow=d*f/h*b,this._panPixelFlow=f/h*b,this._rotatePixelFlow=d/h*b):g&&e?(h=1+d,this._zoomPixelFlow=d/h*b,this._panPixelFlow=1/h*b):g&&a?(h=1+f,this._zoomPixelFlow=f/h*b,this._rotatePixelFlow=1/h*b):e&&a?(d=this._panPixelsAtSource/this._rotatePixels,
h=1+d,this._panPixelFlow=d/h*b,this._rotatePixelFlow=1/h*b):e?this._panPixelFlow=b:g?this._zoomPixelFlow=b:a&&(this._rotatePixelFlow=b);this.time=a?this.rotateTime:g?this.zoomTime:e?this.panTime:0};Object.defineProperty(b.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var b=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*b+1)/(b*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,
configurable:!0});b.prototype._interpolateComponentsZoom=function(b){if(0===b||1===b)return b;if(this.definition.hasZoom){var h=this.definition.compared.sourceZoom,a=this.definition.compared.targetZoom;return(h*Math.pow(h/a,-b)-h)/(a-h)}return b};b.prototype._interpolateComponentsPan=function(b){if(0===b||1===b)return b;if(this.definition.hasPan&&this.definition.hasZoom){var h=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*
(Math.pow(2,h*b*this.time)-1)/(h*Math.LN2)}return b};b.prototype._interpolateComponentsRotate=function(b){return b};b.prototype.interpolateComponentsAt=function(b,h){b=Math.min(Math.max(b,0),1);var a=this._interpolateComponentsZoom(b),g=this._interpolateComponentsPan(b);b=this._interpolateComponentsRotate(b);h?(h.zoom=a,h.pan=g,h.rotate=b):h={zoom:a,pan:g,rotate:b};return h};return b}();b.Segment=n;b.default=n})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require","exports",
"./functions"],function(n,b,l){function k(b,a){var g=Math.max(b.compared.sourceZoom,b.compared.targetZoom);b=b.source.zoomAtPixelsPerPan(b.desiredPixelFlow/b.compared.pan)/2;return b<g?null!=a.maximumDistance?g+(a.maximumDistance-g)/2:1.5*g:a.maximumDistance?Math.min(a.maximumDistance,b):b}Object.defineProperty(b,"__esModule",{value:!0});b.optimalDistance=function(b,a){var g=k(b,a),e={ascensionFactor:null!=a.ascensionFactor?a.ascensionFactor:.5,descensionFactor:null!=a.descensionFactor?a.descensionFactor:
.5},d=0===e.ascensionFactor,f=0===e.descensionFactor,c=d?l.tAscensionZoomOnly:l.tAscensionZoomPan,h=d?l.dtAscensionZoomOnly:l.dtAscensionZoomPan,p=d?l.ddtAscensionZoomOnly:l.ddtAscensionZoomPan,r=f?l.tDescensionZoomOnly:l.tDescensionZoomPan,t=f?l.dtDescensionZoomOnly:l.dtDescensionZoomPan,x=f?l.ddtDescensionZoomOnly:l.ddtDescensionZoomPan,d=function(a){return c(b,e,a)+l.tPanion(b,e,a)+r(b,e,a)},f=function(a){return h(b,e,a)+l.dtPanion(b,e,a)+t(b,e,a)},w=function(a){return p(b,e,a)+l.ddtPanion(b,e,
a)+x(b,e,a)},u=d(g),y=l.tBaseLine(b),m=a.maximumIterations||20,v=null!=a.maximumDistance?a.maximumDistance:Infinity;for(a=0;a<m;a++){var z=(f(g)+1E-6)/w(g);if(isNaN(z)||g>=v&&0>z){if(!isFinite(v))return null;g=v;u=d(g);break}g-=z;if(g<b.compared.sourceZoom||g<b.compared.targetZoom)return null;z=d(g);if(.005>=Math.abs(z-u)/u)break;u=z}return u>.7*y||g<b.compared.sourceZoom||g<b.compared.targetZoom?null:g}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require","exports"],
function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.tAscensionZoomPan=function(b,k,h){var a=b.halfWindowPanAtZoom(h-b.compared.sourceZoom);return-b.halfWindowSize*(k.ascensionFactor*Math.LN2*b.compared.pan+a)*Math.log(b.compared.sourceZoom/h)/(b.desiredPixelFlow*Math.LN2*a)};b.dtAscensionZoomPan=function(b,k,h){var a=1/h,g=Math.log(b.compared.sourceZoom*a),e=1/b.desiredPixelFlow,d=1/Math.LN2;h-=b.compared.sourceZoom;var f=1/h;k=(k.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(h))/
b.halfWindowPanAtZoom(1);return b.halfWindowSize*a*e*d*f*k-b.halfWindowSize*g*e*d*f+b.halfWindowSize*g*e*d*k/(h*h)};b.ddtAscensionZoomPan=function(b,k,h){var a=h-b.compared.sourceZoom,g=1/a,e=1/h,d=Math.log(b.compared.sourceZoom*e);k=(k.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(a))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*g*(-2*g*e*k+2*g*d+2*e-2*d*k/(a*a)-k/(h*h))/(b.desiredPixelFlow*Math.LN2)};b.tAscensionZoomOnly=function(b,k,h){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/
h)/(b.desiredPixelFlow*Math.LN2)};b.dtAscensionZoomOnly=function(b,k,h){return b.halfWindowSize/(h*b.desiredPixelFlow*Math.LN2)};b.ddtAscensionZoomOnly=function(b,k,h){return-b.halfWindowSize/(h*h*b.desiredPixelFlow*Math.LN2)};b.tPanion=function(b,k,h){return-b.compared.pan*b.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(h))};b.dtPanion=function(b,k,h){return b.compared.pan*b.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(b.desiredPixelFlow*
b.halfWindowPanAtZoom(h*h))};b.ddtPanion=function(b,k,h){return-2*b.compared.pan*b.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(h*h*h))};b.tDescensionZoomPan=function(b,k,h){return b.halfWindowSize*(-b.halfWindowPanAtZoom(h)-k.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(h/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-h+b.compared.targetZoom))};b.dtDescensionZoomPan=
function(b,k,h){var a=Math.log(h/b.compared.targetZoom),g=1/b.desiredPixelFlow,e=1/Math.LN2,d=-h+b.compared.targetZoom,f=1/d;k=(-b.halfWindowPanAtZoom(h)-k.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*a*g*e*f+b.halfWindowSize*a*g*e*k/(d*d)+b.halfWindowSize*g*e*f*k/h};b.ddtDescensionZoomPan=function(b,k,h){var a=h-b.compared.targetZoom,g=1/a,e=1/h,d=Math.log(h/b.compared.targetZoom);k=(b.halfWindowPanAtZoom(h)+
k.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*g*(-2*g*e*k-2*g*d+2*e+2*d*k/(a*a)-k/(h*h))/(b.desiredPixelFlow*Math.LN2)};b.tDescensionZoomOnly=function(b,k,h){return b.halfWindowSize*Math.log(h/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};b.dtDescensionZoomOnly=function(b,k,h){return b.halfWindowSize/(h*b.desiredPixelFlow*Math.LN2)};b.ddtDescensionZoomOnly=function(b,k,h){return-b.halfWindowSize/(h*
h*b.desiredPixelFlow*Math.LN2)};b.tBaseLine=function(b){var k=Math.LN2*b.compared.pan,h=b.halfWindowPanAtZoom(b.compared.sourceZoom-b.compared.targetZoom),a=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*h);return b.compared.sourceZoom<=b.compared.targetZoom?a*(k-h):a*(k+h)}})},"esri/views/3d/state/controllers/AnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/promiseUtils ../../../ViewAnimation ./CameraController".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(a){void 0===a&&(a=new h);var d=b.call(this)||this;d.viewAnimation=a;return d}l(e,b);Object.defineProperty(e.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(b){this._asyncResult&&this._asyncResult.reject(k.createAbortError());this._asyncResult=b;if(this.state===a.State.Finished||
this.state===a.State.Stopped)this._asyncResult=null,this.state===a.State.Finished?b.resolve():b.reject(k.createAbortError())},enumerable:!0,configurable:!0});e.prototype.onControllerStart=function(a){var d=this;b.prototype.onControllerStart.call(this,a);this.viewAnimation&&this.viewAnimation.when().catch(function(){}).then(function(){d.updateStateFromViewAnimation()})};e.prototype.updateStateFromViewAnimation=function(){!this.viewAnimation||this.state!==a.State.Ready&&this.state!==a.State.Running||
(this.viewAnimation.state===h.State.FINISHED?this.finish():this.viewAnimation.state===h.State.STOPPED&&(this.state=a.State.Stopped))};e.prototype.onControllerEnd=function(d){this.viewAnimation&&(this.viewAnimation.done||(this.state===a.State.Finished?this.viewAnimation.finish():this.state===a.State.Stopped&&this.viewAnimation.stop()));this._asyncResult&&(this.state===a.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(k.createAbortError()));b.prototype.onControllerEnd.call(this,
d)};e.prototype.finish=function(){this.finishController()};return e}(a.CameraController);b.AnimationController=n})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});var g;(function(a){a.Ready="ready";a.Rejected="rejected";
a.Running="running";a.Stopped="stopped";a.Finished="finished"})(g=b.State||(b.State={}));n=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.state=g.Ready;return a}l(d,b);Object.defineProperty(d.prototype,"active",{get:function(){return this.state===g.Running},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isInteractive",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canStop",{get:function(){return!1},enumerable:!0,
configurable:!0});d.prototype.stopController=function(){return this.canStop?(this.state=g.Stopped,!0):!1};d.prototype.finishController=function(){this.state=g.Finished};d.prototype.onControllerStart=function(a){this.state=g.Running};d.prototype.onControllerEnd=function(a){};d.prototype.stepController=function(a,b){};Object.defineProperty(d.prototype,"steppingFinished",{get:function(){return!1},enumerable:!0,configurable:!0});k([a.property({readOnly:!0,dependsOn:["state"]})],d.prototype,"active",null);
k([a.property()],d.prototype,"state",void 0);return d=k([a.subclass("esri.views.3d.state.controllers.CameraController")],d)}(a.declared(h));b.CameraController=n})},"esri/views/3d/state/utils/navigationUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../support/geometryUtils/coordinateSystem ../../webgl-engine/lib/Camera".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){function w(a,b,c){var e=r.sm4d.get();h.mat4.identity(e);h.mat4.rotate(e,e,c[3],c);d.vec3.subtract(a.eye,a.eye,b);d.vec3.transformMat4(a.eye,a.eye,e);d.vec3.add(a.eye,a.eye,b);d.vec3.subtract(a.center,a.center,b);d.vec3.transformMat4(a.center,a.center,e);d.vec3.add(a.center,a.center,b);d.vec3.transformMat4(a.up,a.up,e);a.markViewDirty()}function u(a,b){d.vec3.set(b,0,0,0);for(var c=0;c<a.length;c++)d.vec3.add(b,b,a[c]);d.vec3.scale(b,b,1/a.length)}function y(a,
b,e){return Math.sin(a/d.vec3.length(b))*(e+c.earthRadius)}function m(a,b,c,e){c=q.ray.fromScreenAtEye(b,c,ya);q.sphere.closestPointOnSilhouette(a,c,S);return q.sphere.intersectRay(a,c,e)?d.vec3.squaredDistance(S,c.origin)<d.vec3.squaredDistance(e,c.origin)?(d.vec3.copy(e,S),!1):!0:(d.vec3.subtract(T,b.eye,b.center),d.vec3.normalize(T,T),q.plane.fromNormalAndOffset(T,-d.vec3.dot(d.vec3.normalize(T,T),S),U),q.plane.intersectRay(U,c,e),!1)}function v(a,c,e,f,g,h){d.vec3.cross(Ca,a,c);d.vec3.subtract(na,
a,c);d.vec3.length(a)<=g||!f.aboveGround?(d.vec3.cross(e,na,f.eye),a=d.vec3.dot(a,c)/(d.vec3.length(a)*d.vec3.length(c)),h=Math.cos(l.clamp(p.cyclicalPI.normalize(l.deg2rad(h)),0,b.TiltThresholdPanningSpeed)),c=-l.acosClamped(a)-Math.max(0,d.vec3.length(c)-g)/(h*g)):(d.vec3.subtract(Y,f.eye,f.center),d.vec3.cross(e,na,Y),c=-d.vec3.length(na)/g);d.vec3.normalize(e,e);d.vec3.scale(e,e,d.vec3.length(Ca));return c}function z(a,c,d,e){e=Math.cos(l.clamp(p.cyclicalPI.normalize(l.deg2rad(e)),0,b.TiltThresholdPanningSpeed));
c=c>d?-(c-d)/(e*d):c<-d?Math.PI-(c+d)/(e*d):l.acosClamped(c/d);return((a>d?-(a-d)/(e*d):a<-d?Math.PI-(a+d)/(e*d):l.acosClamped(a/d))-c)*d}function B(a,b,c,e,f,h,m,p,k,r){k=z(a[2],b[2],m.radius,k);b=r?z(a[0],b[0],m.radius,180):b[0]-a[0];a=Math.sin(p)*b-Math.cos(p)*k;p=Math.cos(p)*b+Math.sin(p)*k;d.vec3.normalize(ia,f);f=r?a/Math.sqrt(Math.abs(Math.pow(m.radius,2)-Math.pow(d.vec3.dot(c,ia),2))):a/m.radius;c=p/Math.sqrt(Math.abs(Math.pow(m.radius,2)-Math.pow(d.vec3.dot(c,e),2)));g.vec2.set(h,f,c)}function C(a,
b,c,e,f,g,h,m,p,k){d.vec3.cross(Ca,a,b);t.coordinateSystemFromOneAxisAndNormalVector(g.up,g.eye,Z,ca,da);t.coordinateSystemFromOneAxisAndNormalVector([0,0,1],g.eye,X,P,V);d.vec3.copy(c,P);d.vec3.copy(e,X);d.vec3.normalize(c,c);d.vec3.scale(c,c,d.vec3.length(Ca));t.vectorCoordinates(a,d.vec3.normalize(ca,ca),d.vec3.normalize(da,da),d.vec3.normalize(Z,Z),F);t.vectorCoordinates(b,ca,da,Z,ea);B(F,ea,a,X,P,f,h,m,p,k)}function D(a,b,c,e,f,g,m){h.mat4.identity(oa);h.mat4.identity(va);h.mat4.identity(fa);
h.mat4.rotate(oa,oa,f,e);h.mat4.rotate(va,va,m,g);h.mat4.multiply(fa,oa,va);d.vec3.subtract(b,a,c);d.vec3.transformMat4(b,b,fa);d.vec3.add(b,b,c)}function K(a,b,c,e,f,g){h.mat4.identity(oa);h.mat4.identity(va);h.mat4.identity(fa);h.mat4.rotate(oa,oa,e,c);h.mat4.rotate(va,va,g,f);h.mat4.multiply(fa,oa,va);d.vec3.subtract(a.eye,a.eye,b);d.vec3.transformMat4(a.eye,a.eye,fa);d.vec3.add(a.eye,a.eye,b);d.vec3.subtract(a.center,a.center,b);d.vec3.transformMat4(a.center,a.center,fa);d.vec3.add(a.center,a.center,
b);d.vec3.subtract(a.up,a.up,b);d.vec3.transformMat4(a.up,a.up,fa);d.vec3.add(a.up,a.up,b);a.markViewDirty()}function I(a,c,d,e,f,g,h,m){void 0===h&&(h=b.PreservingHeadingThreshold.Pole);void 0===m&&(m=b.PreservingHeadingThreshold.Angle);a=Math.abs(a[2])<d*h||Math.abs(c)>d;return(Math.abs(e)>Math.PI-m||Math.abs(e)<m)&&a&&g.aboveGround&&f<b.PreservingHeadingThreshold.Tilt?!0:!1}function Q(a,b,c,d,e,f){f?(q.axisAngle.fromPoints(c,d,ka),w(b,a.center,ka)):(c=v(c,d,ua,b,a.radius,e),w(b,a.center,q.axisAngle.wrapAxisAngle(ua,
c)))}function J(a,b,c,e,f,g,h){var m=h?20:1;d.vec3.copy(xa,e);wa.copyFrom(b);for(var p,k=0;k<m&&1E-12<d.vec3.squaredDistance(c,xa);k++)if(e=d.vec3.squaredDistance(c,xa),C(c,xa,P,X,la,wa,a,f,g,h),K(wa,a.center,X,la[1],P,la[0]),D(xa,xa,a.center,X,la[1],P,la[0]),p=d.vec3.squaredDistance(c,xa),p<e||0===k)b.copyFrom(wa);else break}Object.defineProperty(b,"__esModule",{value:!0});b.Earth=q.sphere.fromValues(c.earthRadius,f.vec3f64.create());b.normalizeCoordinate=function(a,b,c){c[0]=b[0]/(a.fullWidth/a.pixelRatio);
c[1]=b[1]/(a.fullHeight/a.pixelRatio);return c};b.rotationFromPointsAroundAxis=function(a,b,c){var e=r.sv3d.get(),f=r.sv3d.get(),g=r.sv3d.get();d.vec3.copy(f,a);d.vec3.copy(g,b);a=d.vec3.dot(f,c);b=d.vec3.dot(g,c);d.vec3.scale(e,c,a);d.vec3.subtract(f,f,e);d.vec3.normalize(f,f);d.vec3.scale(e,c,b);d.vec3.subtract(g,g,e);d.vec3.normalize(g,g);a=d.vec3.dot(f,g);d.vec3.cross(e,c,f);c=d.vec3.dot(g,e);return Math.atan2(c,a)};b.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=
2*Math.PI;return a};b.applyRotation=w;b.intersectPlaneFromScreenPoint=function(a,b,c,d){return q.plane.intersectRay(a,q.ray.fromScreen(b,c,ya),d)};b.applyZoomToPoint=function(a,b,c,e){var f=r.sv3d.get();c=1-c;d.vec3.subtract(f,b,a.eye);var g=d.vec3.length(f),h=g*(1-c);0<=c&&h<e&&(h=e,c=-(h-g)/g);1E-6>Math.abs(g-h)||(d.vec3.scale(f,f,c),d.vec3.add(a.eye,a.eye,f),d.vec3.lerp(a.center,a.center,b,c))};b.applyZoomOnSphere=function(a,b,c){b.getScreenCenter(N);q.sphere.intersectScreen(a,b,N,b.center);b.markViewDirty();
a=b.distance;c*=a;1E-6>Math.abs(a-c)||(c=d.vec3.scale(r.sv3d.get(),b.viewForward,c),d.vec3.subtract(b.eye,b.center,c),b.markViewDirty())};var N=k.createScreenPointArray();b.centroidOnSphere=function(a,b,c){u(b,c);d.vec3.normalize(c,c);d.vec3.scale(c,c,a)};b.centroid=u;b.onSurfaceTiltToEyeTiltGlobal=y;b.offSurfaceTiltToEyeTiltGlobal=function(a,b,c){return y(Math.PI/2,b,c)+(a-Math.PI/2)};var L;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(L=b.PanMode||(b.PanMode={}));b.VerticalPanTresholds=
{Elevation:3E4,Angle:l.deg2rad(8)};b.PreservingHeadingThreshold={Pole:.95,Angle:l.deg2rad(18),Tilt:45};b.TiltThresholdPanningSpeed=l.deg2rad(80);b.pickPointAndInitSphere=function(a,c,e,g){var h=f.vec3f64.create(),p=q.sphere.create(),k=!0;a.intersectScreen(e,h)?p.radius=d.vec3.length(h):(p.radius=c.aboveGround?Math.max(d.vec3.length(c.center),.9*b.Earth.radius):d.vec3.length(c.eye)-c.relativeElevation,g?m(p,c,e,h):k=q.sphere.intersectScreen(p,c,e,h));return{sphere:p,scenePickPoint:k?h:null}};b.decidePanMode=
function(a,c,e){var f=d.vec3.length(a.eye);if(Math.abs(f-b.Earth.radius)>b.VerticalPanTresholds.Elevation)return L.Horizontal;if(a.aboveGround===c.radius>f)return L.Vertical;d.vec3.subtract(M,a.eye,e);d.vec3.normalize(M,M);return Math.abs(.5*Math.PI-l.acosClamped(d.vec3.dot(e,M)/d.vec3.length(e)))<b.VerticalPanTresholds.Angle?L.Vertical:L.Horizontal};var M=f.vec3f64.create();b.applyPanPlanar=function(a,b,c){d.vec3.subtract(R,c,b);d.vec3.subtract(a.eye,a.eye,R);d.vec3.subtract(a.center,a.center,R);
a.markViewDirty()};var R=f.vec3f64.create();b.sphereOrPlanePointFromScreenPoint=m;var S=f.vec3f64.create(),T=f.vec3f64.create(),U=q.plane.create();b.rotationAngleAndAxisDirectRotation=v;var Y=f.vec3f64.create();b.lengthFromPoints=z;b.rotationAnglesHeadingPreserving=B;b.rotationAnglesAndAxesHeadingPreserving=C;b.rotatePointAroundTwoAxes=D;b.applyRotationWithTwoAxes=K;b.preserveHeadingThreshold=I;b.applyPanSphericalDirectRotation=Q;b.applyPanSphericalPreserveHeading=J;b.panToPosition=function(a,c,e,
f,g,h,m){I(e,d.vec3.dot(c.up,e),a.radius,-p.cyclicalPI.normalize(l.deg2rad(g)),h,c,b.PreservingHeadingThreshold.Pole,b.PreservingHeadingThreshold.Angle)?J(a,c,e,f,-p.cyclicalPI.normalize(l.deg2rad(g)),h,m):Q(a,c,e,f,h,m)};b.panMotionToRotationMatrix=function(a,b,c,e,f,g,m,k,q){if(I(a.center,d.vec3.dot(a.up,a.center),d.vec3.length(a.center),-p.cyclicalPI.normalize(l.deg2rad(g)),m,b))switch(a=-p.cyclicalPI.normalize(l.deg2rad(f)),t.coordinateSystemFromOneAxisAndNormalVector([0,0,1],b.eye,X,P,V),f=c.translation[0]*
e.pan,g=c.translation[1]*e.pan,b=Math.max(Math.sqrt(Math.abs(1-Math.pow(d.vec3.dot(b.center,X),2)/Math.pow(d.vec3.length(b.center),2))),.5),m=-Math.cos(a)*g+Math.sin(a)*f,h.mat4.rotate(k.pan.matrix,k.pan.matrix,(Math.sin(a)*g+Math.cos(a)*f)/b,X),k.pan.enabled=!0,q.mode){case "pan":h.mat4.rotate(k.pan.matrix,k.pan.matrix,m,P);k.pan.enabled=!0;break;case "zoom":k.zoom=-c.translation[1]*e.zoom}else switch(a=b.eye,b=b.viewRight,a=d.vec3.cross(r.sv3d.get(),b,a),f=c.translation[0]*e.pan,0!==f&&(h.mat4.rotate(k.pan.matrix,
k.pan.matrix,-f,a),k.pan.enabled=!0),q.mode){case "pan":c=c.translation[1]*e.pan;0!==c&&(h.mat4.rotate(k.pan.matrix,k.pan.matrix,c,b),k.pan.enabled=!0);break;case "zoom":k.zoom=-c.translation[1]*e.zoom}};var X=f.vec3f64.create(),P=f.vec3f64.create(),V=f.vec3f64.create(),Z=f.vec3f64.create(),ca=f.vec3f64.create(),da=f.vec3f64.create(),F=f.vec3f64.create(),ea=f.vec3f64.create(),la=e.vec2f64.create(),ka=q.axisAngle.create(),oa=a.mat4f64.create(),va=a.mat4f64.create(),fa=a.mat4f64.create(),xa=f.vec3f64.create(),
ia=f.vec3f64.create(),na=f.vec3f64.create(),wa=new x.default,Ca=f.vec3f64.create(),ua=f.vec3f64.create(),ya={origin:f.vec3f64.create(),direction:f.vec3f64.create()}})},"esri/views/3d/support/geometryUtils/coordinateSystem":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,l,k,h){function a(a){return{operations:a,value:a.create()}}function g(a,b,d,e){return a.operations.setAltitudeAt(a.value,
b,d,e)}Object.defineProperty(b,"__esModule",{value:!0});b.create=function(a){var b=a.operations;return{operations:b,value:b.create(a.value)}};b.setExtent=function(a,b,d){a.operations.setExtent(a.value,b,d.value);return d};b.createFromOperations=a;b.fromValues=function(b,d,e){void 0===e&&(e=a(b));e.operations=b;b.copy(d,e.value);return e};b.wrap=function(a,b){d.operations=a;d.value=b;return d};b.normalAt=function(a,b,d){return a.operations.axisAt(a.value,b,2,d)};b.axisAt=function(a,b,d,e){return a.operations.axisAt(a.value,
b,d,e)};b.intersectRay=function(a,b,d){return a.operations.intersectRay(a.value,b,d)};b.intersectsRay=function(a,b){return a.operations.intersectRay(a.value,b,null)};b.closestPoint=function(a,b,d){return a.operations.closestPoint(a.value,b,d)};b.intersectRayClosestSilhouette=function(a,b,d){return a.operations.intersectRayClosestSilhouette(a.value,b,d)};b.closestPointOnSilhouette=function(a,b,d){return a.operations.closestPointOnSilhouette(a.value,b,d)};b.distanceToSilhouette=function(a,b){return a.operations.distanceToSilhouette(a.value,
b)};b.altitudeAt=function(a,b){return a.operations.altitudeAt(a.value,b)};b.setAltitudeAt=g;b.setAltitudeOfTransformation=function(a,b,d,f){b!==f&&l.mat4.copy(f,b);k.vec3.set(e,f[12],f[13],f[14]);g(a,e,d,e);f[12]=e[0];f[13]=e[1];f[14]=e[2];return f};b.elevate=function(a,b,d){return a.operations.elevate(a.value,b,d.value)};var e=h.vec3f64.create(),d={operations:null,value:null};b.vectorCoordinates=function(a,b,d,e,f){f[0]=k.vec3.dot(a,b);f[1]=k.vec3.dot(a,d);f[2]=k.vec3.dot(a,e);return f};b.coordinateSystemFromOneAxisAndNormalVector=
function(a,b,d,e,g){k.vec3.copy(d,a);k.vec3.copy(f,b);k.vec3.normalize(f,f);k.vec3.cross(e,f,d);k.vec3.cross(g,e,d)};var f=h.vec3f64.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(a,c){var d=b.call(this,a.state,a.sceneIntersectionHelper,"interaction"===c?null:void 0)||this;d.view=a;d.mode=c;d.zoomLocation=h.vec3f64.create();d.tmpCamera=new e.default;d.tmpRayDir=h.vec3f64.create();d.tmpCenter=h.vec3f64.create();d.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new e.default,interactionDirection:null,tiltMode:0};return d}l(c,b);
Object.defineProperty(c.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});c.prototype.zoomStep=function(a,b){if(this.active){var c=this.view.state,d=this.constraintOptions.interactionStartCamera;this.animation.finished?d.copyFrom(c.camera):this.animation.cameraAt(1,d);this.tmpCamera.copyFrom(c.camera);0<a?(this.intersectionHelper.intersectScreenFreePointFallback(b,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.tmpCenter)&&
(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:k.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};c.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:d.outExpo}};c.prototype.updateCamera=function(b,c,d,e){k.vec3.subtract(this.tmpRayDir,d,b.eye);e=k.vec3.length(this.tmpRayDir);
var f=e*c;1>=c&&4>f&&(f=4,c=f/e);1E-6>Math.abs(e-f)||(k.vec3.scale(this.tmpRayDir,this.tmpRayDir,c),k.vec3.subtract(b.eye,d,this.tmpRayDir),k.vec3.lerp(b.center,b.center,d,1-c),a.applyAll(this.view,b,this.constraintOptions))};return c}(g.PointToPointAnimationController);b.ZoomStepController=n})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.eventMatchesPointerAction=function(b,k){switch(k){case "primary":return"touch"===
b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==b.pointerType&&1===b.button}};b.eventMatchesMousePointerAction=function(b,k){if("touch"===b.pointerType)return!1;switch(k){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,c,d,e){var f=a.call(this,!0)||this;f.view=b;f.pointerAction=c;f.pivotPoint=d;f.registerIncoming("drag",e,function(a){return f.handleDrag(a)});return f}l(b,a);b.prototype.handleDrag=function(a){var b=a.data;if(!(1<b.pointers.size)&&g.eventMatchesMousePointerAction(a.data,this.pointerAction)){var d=k.createScreenPointArray(b.center.x,b.center.y);switch(b.action){case "start":this.cameraController&&(this.cameraController.end(),
this.cameraController=null);this.cameraController=new h.RotateController(this.view,this.view.sceneIntersectionHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}a.stopPropagation()}};return b}(a.InputHandler);b.DragRotate=n})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function p(c,d,g){var h=b.call(this)||this;h.view=c;h.intersectionHelper=d;h.pivot=g;h.lastPoint=e.vec2f64.create();h.tmpWorldUp=f.vec3f64.create();h.tmpViewDir=f.vec3f64.create();h.tmpRotCurPoint=e.vec2f64.create();h.tmpTransf=a.mat4f64.create();h.tmpAxis=f.vec3f64.create();h.pivotPos=f.vec3f64.create();h.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};h.rotScale="center"===g?3:1.5;return h}l(p,b);p.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":d.vec3.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||d.vec3.copy(this.pivotPos,this.beginCamera.center),this.beginCamera.center=
this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;r.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};p.prototype.update=function(a){if(this.active){var b;switch(this.pivot){case "eye":b=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,b=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,b,this.pivotPos);c.applyAll(this.view,
this.currentCamera,this.constraintOptions)}};p.prototype.end=function(){this.active&&this.finishController()};p.prototype.applyRotation=function(a,b,c,e){this.view.renderCoordsHelper.worldUpAtPosition(e,this.tmpWorldUp);r.normalizeCoordinate(a,b,this.tmpRotCurPoint);b=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;var f=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;d.vec3.subtract(this.tmpViewDir,c,e);var m=d.vec3.length(this.tmpViewDir),m=k.acosClamped(d.vec3.dot(this.tmpViewDir,
this.tmpWorldUp)/m);if("eye"===this.pivot){var p=.5*Math.PI-m,t=.495*Math.PI;b=p-Math.max(-t,Math.min(t,p+-.5*b))}b=k.clamp(b+m,q.TiltDefault.min,q.TiltDefault.max)-m;h.mat4.identity(this.tmpTransf);d.vec3.cross(this.tmpAxis,a.up,this.tmpViewDir);"center"===this.pivot&&(f=-f);h.mat4.rotate(this.tmpTransf,this.tmpTransf,f,this.tmpWorldUp);h.mat4.rotate(this.tmpTransf,this.tmpTransf,b,this.tmpAxis);d.vec3.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);d.vec3.add(c,e,this.tmpViewDir);
d.vec3.transformMat4(a.up,a.up,this.tmpTransf);g.vec2.copy(this.lastPoint,this.tmpRotCurPoint);a.markViewDirty()};return p}(p.InteractiveController);b.RotateController=n})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||
this;b.beginCamera=new h.default;b.currentCamera=new h.default;return b}l(b,a);Object.defineProperty(b.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.stepController=function(b,d){a.prototype.stepController.call(this,b,d);d.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(d)};b.prototype.onControllerStart=function(b){a.prototype.onControllerStart.call(this,b);this.beginCamera.copyFrom(b);this.currentCamera.copyFrom(b)};b.prototype.onControllerEnd=
function(b){b.copyViewFrom(this.currentCamera);a.prototype.onControllerEnd.call(this,b)};return b}(k.CameraController);b.InteractiveController=n})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,b,l,k,h,a,g,e){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function d(a,d,e){var c=b.call(this,!0)||this;c.view=a;c.pointerAction=d;c.registerIncoming("drag",e,function(a){return c.handleDrag(a)});return c}l(d,b);d.prototype.handleDrag=function(b){var c=b.data;if(!(1<c.pointers.size)&&e.eventMatchesMousePointerAction(b.data,this.pointerAction)){var d=k.createScreenPointArray(c.center.x,c.center.y);switch(c.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
this.view.state.isGlobal?new h.ZoomController(this.view,this.view.sceneIntersectionHelper):new a.ZoomController(this.view,this.view.sceneIntersectionHelper);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}b.stopPropagation()}};return d}(g.InputHandler);b.DragZoom=n})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(c,d){var f=b.call(this)||this;f.view=c;f.intersectionHelper=d;f.pickPoint=e.vec3f64.create();f.tmpP0=a.vec2f64.create();f.panAxisAngle=q.axisAngle.create();f.tmpRayDir=e.vec3f64.create();f.targetOnSphere=e.vec3f64.create();f.dragBeginPoint=k.createScreenPointArray();f.normalizedAnchorPoint=a.vec2f64.create();f.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};f.sphere=q.sphere.create();f.hasPickPoint=!1;return f}l(f,b);f.prototype.begin=function(a){this.active&&(h.vec2.copy(this.dragBeginPoint,a),c.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=c.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,this.pickPoint=a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};f.prototype.update=function(a){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;g.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var b=g.vec3.length(this.tmpRayDir);c.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var e=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),f=b*Math.pow(2,e),h=this.view.state.constraints.minimumPoiDistance;0>e&&f<h&&(f=h);1E-6>Math.abs(b-f)||(this.hasPickPoint&&f<b&&(e=1-(1-f/b)*(1-this.sphere.radius/
g.vec3.length(this.currentCamera.center)),g.vec3.scale(this.currentCamera.center,this.currentCamera.center,e)),g.vec3.scale(this.tmpRayDir,this.tmpRayDir,-f/b),g.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=d.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),d.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(c.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,
this.targetOnSphere),q.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),c.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),d.applySurfaceCollision(this.view,this.currentCamera))}};f.prototype.end=function(){this.active&&this.finishController()};return f}(f.InteractiveController);b.ZoomController=n})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(a,c){var e=b.call(this)||this;e.view=a;e.intersectionHelper=c;e.tmpP=d.vec3f64.create();e.tmpN=d.vec3f64.create();e.tmpP0=g.vec2f64.create();e.tmpPoi=d.vec3f64.create();e.tmpRayDir=d.vec3f64.create();e.dragBeginPoint=h.createScreenPointArray();e.normalizedAnchorPoint=g.vec2f64.create();e.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:d.vec3f64.create(),
tiltMode:0};e.plane=p.plane.create();return e}l(c,b);c.prototype.begin=function(b){this.active&&(a.vec2.copy(this.dragBeginPoint,b),q.normalizeCoordinate(this.beginCamera,b,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(b,this.tmpP),e.vec3.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center),e.vec3.normalize(this.tmpN,this.tmpN),0>this.tmpN[1]&&e.vec3.negate(this.tmpN,this.tmpN),p.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)};c.prototype.update=function(b){if(this.active){q.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||e.vec3.copy(this.tmpPoi,this.currentCamera.center);q.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var c=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);a.vec2.copy(this.normalizedAnchorPoint,this.tmpP0);e.vec3.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var d=e.vec3.length(this.tmpRayDir),g=d*(1-c);e.vec3.copy(this.constraintOptions.interactionDirection,
this.tmpRayDir);e.vec3.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,k.sign(c)/d);var h=this.view.state.constraints.minimumPoiDistance;0<=c&&g<h&&(g=h,c=-(g-d)/d);1E-6>Math.abs(d-g)||(e.vec3.scale(this.tmpRayDir,this.tmpRayDir,c),e.vec3.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),e.vec3.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,c),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?
Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),f.applyAll(this.view,this.currentCamera,this.constraintOptions))}};c.prototype.end=function(){this.active&&this.finishController()};return c}(c.InteractiveController);b.ZoomController=n})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c){var d=b.call(this,!0)||this;d.view=a;d.watchHandles=new k;d.handle=d.registerIncoming("gamepad",function(a){return d.handleEventGamepad(a)});d.handle.pause();return d}l(d,b);d.prototype.onInstall=function(a){var c=this;b.prototype.onInstall.call(this,a);this.watchHandles.add([h.init(this.view.navigation.gamepad,"enabled",function(a){a?c.handle.resume():(c.handle.pause(),c.cameraControllerGamepad&&
(c.cameraControllerGamepad.finishController(),c.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",function(a){c.cameraControllerGamepad&&a&&c.cameraControllerGamepad.gamepadDevice!==a&&(c.cameraControllerGamepad.finishController(),c.cameraControllerGamepad=null)})])};d.prototype.onUninstall=function(){this.watchHandles.removeAll();b.prototype.onUninstall.call(this)};d.prototype.handleEventGamepad=function(b){var c=this.view.navigation.gamepad.device;if(!c||b.data.device===
c)if((c=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||a.GamepadKeyboardController.activatesFor(this.view,b.data))c||(c=new a.GamepadKeyboardController(this.view,b.data.device),this.view.state.switchCameraController(c)&&(this.cameraControllerGamepad=c)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===b.data.device&&this.cameraControllerGamepad.handleEventGamepad(b.data)};return d}(g.InputHandler);b.GamepadNavigation=
n})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c,d){var e=b.call(this)||this;e.view=a;e.gamepadDevice=c;e.disableMovements=d;e.transformation={translation:[0,0,0],heading:0,tilt:0};e.keysButtonState=[0,0,0,0,0,0,0,0,0,0];e.tmpCamera=new z.default;e.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new z.default,interactionFactor:0,interactionDirection:null,tiltMode:1};return e}l(d,b);d.prototype.handleEventGamepad=
function(a){var b=B.extractTransformation(a,this.view.navigation.gamepad,this.transformation);("end"===a.action||B.isZeroTransformation(b))&&this.finishController()};d.prototype.activateDirection=function(a){this.keysButtonState[a]=1;B.extractTransformationKeyboard(this.keysButtonState,this.transformation)};d.prototype.deactivateDirection=function(a){this.keysButtonState[a]=0;a=B.extractTransformationKeyboard(this.keysButtonState,this.transformation);B.isZeroTransformation(a)&&this.finishController()};
d.prototype.onControllerStart=function(a){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;b.prototype.onControllerStart.call(this,a)};d.prototype.updateFilteredSurfaceElevation=function(a){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*a};d.prototype.stepController=function(a,c){this.updateStartHeading();this.updateFilteredSurfaceElevation(a);this.currentCamera.copyViewFrom(c);
this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this.calculateControlTransformation(a,this.currentCamera,L);this.applyDisabledMovementTypes(L);this.applyPan(L.pan);this.applyRotate(L.rotate);this.applyZoom(L.zoom);this.applyAscend(L.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;f.applyAll(this.view,this.currentCamera,this.constraintOptions);b.prototype.stepController.call(this,a,c)};d.prototype.updateStartHeading=
function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};d.prototype.applyRotate=function(a){if(a.enabled){var b=this.currentCamera,c=b.center,d=b.up,g=b.eye;e.vec3.subtract(c,c,g);e.vec3.transformMat4(c,c,a.matrix);e.vec3.add(c,c,g);e.vec3.transformMat4(d,d,a.matrix);b.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;f.applyAll(this.view,b,this.constraintOptions)}};d.prototype.applyPan=function(a,b){void 0===b&&(b=this.currentCamera);
if(a.enabled){var c=b.center,d=b.eye,g=b.up;e.vec3.transformMat4(d,d,a.matrix);e.vec3.transformMat4(c,c,a.matrix);this.view.state.isGlobal&&e.vec3.transformMat4(g,g,a.matrix);b.markViewDirty();this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;f.applyAll(this.view,b,this.constraintOptions)}};d.prototype.applyZoom=function(a){if(a){var b=this.currentCamera,c=b.eye,b=b.viewForward;e.vec3.add(c,c,e.vec3.scale(v.sv3d.get(),b,a));this.currentCamera.markViewDirty();e.vec3.copy(M,
b);e.vec3.negate(M,M);this.constraintOptions.interactionDirection=M;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;f.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};d.prototype.applyAscend=function(a){if(a){var b=this.currentCamera,c=b.center,b=b.eye,d=this.view.renderCoordsHelper.worldUpAtPosition(b,v.sv3d.get());this.constraintOptions.interactionDirection=e.vec3.copy(M,d);this.view.state.isGlobal?(d=e.vec3.length(b),
a=(d+a)/d,e.vec3.scale(b,b,a),e.vec3.scale(c,c,a)):(a=e.vec3.scale(v.sv3d.get(),d,a),e.vec3.add(b,b,a),e.vec3.add(c,c,a));this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=8;f.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;f.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};d.prototype.calculateControlTransformation=
function(b,c,d){d.zoom=0;d.ascend=0;d.pan.enabled=!1;a.mat4.identity(d.pan.matrix);d.rotate.enabled=!1;a.mat4.identity(d.rotate.matrix);b=this.computeVelocities(b);this.view.state.isLocal?this.calculateControlTransformationLocal(b,c,d):this.calculateControlTransformationGlobal(b,c,d)};d.prototype.updateCameraCenter=function(){var a=this.currentCamera;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(a.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a.center);
this.currentCamera.markViewDirty()};d.prototype.calculateControlTransformationLocal=function(b,d,f){var g=d.viewRight,m=d.viewForward,p=this.transformation,r=this.view.navigation.gamepad,m=e.vec3.set(v.sv3d.get(),m[0],m[1],0);e.vec3.normalize(m,m);var q=p.translation[0]*b.pan;0!==q&&(q=e.vec3.scale(v.sv3d.get(),g,q),a.mat4.translate(f.pan.matrix,f.pan.matrix,q),f.pan.enabled=!0);switch(r.mode){case "pan":r=-p.translation[1]*b.pan;0!==r&&(r=e.vec3.scale(v.sv3d.get(),m,r),a.mat4.translate(f.pan.matrix,
f.pan.matrix,r),f.pan.enabled=!0);break;case "zoom":f.zoom=-p.translation[1]*b.zoom;break;default:k.neverReached(r.mode)}f.ascend=p.translation[2]*b.ascend;r=-p.heading*b.rotate;0!==r&&(a.mat4.rotate(f.rotate.matrix,f.rotate.matrix,r,this.view.renderCoordsHelper.worldUpAtPosition(d.eye,v.sv3d.get())),f.rotate.enabled=!0);b=p.tilt*b.rotate;d=t.viewAngle(this.view.renderCoordsHelper,d.center,d.eye);if(d=h.clamp(d+b,c.TiltDefault.min,c.TiltDefault.max)-d)a.mat4.rotate(f.rotate.matrix,f.rotate.matrix,
d,g),f.rotate.enabled=!0};d.prototype.calculateControlTransformationGlobal=function(b,c,d){var f=c.eye,g=c.viewRight,h=this.transformation,m=this.view.navigation.gamepad,f=e.vec3.cross(v.sv3d.get(),g,f);e.vec3.normalize(f,f);e.vec3.negate(f,f);p.panMotionToRotationMatrix(this.beginCamera,c,h,b,this.view.camera.heading,this.headingStart,this.view.camera.tilt,d,m);this.tmpCamera.copyFrom(this.currentCamera);this.applyPan(L.pan,this.tmpCamera);m=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;
d.ascend=h.translation[2]*b.ascend;f=-h.heading*b.rotate;0!==f&&(a.mat4.rotate(d.rotate.matrix,d.rotate.matrix,f,this.tmpCamera.eye),d.rotate.enabled=!0);b=this.clampTiltDeltaGlobalToValidRange(h.tilt*b.rotate,c.ray,m);0!==b&&(a.mat4.rotate(d.rotate.matrix,d.rotate.matrix,b,this.tmpCamera.viewRight),d.rotate.enabled=!0)};d.prototype.clampTiltDeltaGlobalToValidRange=function(a,b,d){var f=r.onSurfaceTiltToEyeTiltGlobal(c.TiltDefault.min,b.origin,d),g=0,m=0,g=v.sv3d.get();this.view.renderCoordsHelper.intersectManifold(b,
d,g)?(g=t.viewAngle(this.view.renderCoordsHelper,g,b.origin),g=r.onSurfaceTiltToEyeTiltGlobal(g,b.origin,d),m=r.onSurfaceTiltToEyeTiltGlobal(c.TiltDefault.max,b.origin,d)):(y.sphere.closestPointOnSilhouette(y.sphere.wrap(d+u.earthRadius),b,g),g=h.acosClamped(-e.vec3.dot(b.direction,e.vec3.normalize(g,g))),g=r.offSurfaceTiltToEyeTiltGlobal(g,b.origin,d),m=r.offSurfaceTiltToEyeTiltGlobal(c.TiltDefault.max,b.origin,d));return h.clamp(g+a,f,m)-g};d.prototype.getPointAbsoluteSurfaceElevation=function(a,
b,c){var d=this.view.renderCoordsHelper,f=d.getAltitude(a);b+=Math.abs(f-b);e.vec3.copy(c,a);d.setAltitude(b,c);return b};d.prototype.clampedDistanceToSurface=function(a,b){var c=this.view.renderCoordsHelper,d=this.view.state.camera,f=x.headingTiltToDirectionUp(this.view,b,0,D,R).direction,f=c.intersectManifoldClosestSilhouette(y.ray.wrap(b,f),a,v.sv3d.get()),f=e.vec3.distance(b,f);a=c.intersectManifoldClosestSilhouette(y.ray.wrap(b,m.directionFromTo(v.sv3d.get(),b,d.center)),a,v.sv3d.get());b=e.vec3.distance(b,
a);return Math.min(f,b)};d.prototype.computeHeadingRotateRadius=function(a){var b=this.view,c=b.renderCoordsHelper,d=b.state,b=d.isGlobal,d=c.intersectManifoldClosestSilhouette(d.camera.ray,this.filteredSurfaceElevation,v.sv3d.get());if(b)return b=e.vec3.subtract(v.sv3d.get(),a,d),c=e.vec3.length(b),e.vec3.scale(b,b,1/c),a=e.vec3.normalize(v.sv3d.get(),a),a=h.acosClamped(e.vec3.dot(a,b)),c*Math.sin(Math.min(K,a));a=e.vec3.copy(v.sv3d.get(),a);c.setAltitude(this.filteredSurfaceElevation,a);return e.vec3.distance(d,
a)};d.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:Q};d.prototype.computeVelocities=function(a){var b=this.filteredSurfaceElevation,c=b+u.earthRadius,d=this.view.state,e=d.camera,f=d.isGlobal,g=v.sv3d.get(),m=this.getPointAbsoluteSurfaceElevation(e.eye,b,g),k=this.clampedDistanceToSurface(b,g),p=e.width/2,r=I*e.width,d=I*e.width,e=k*Math.tan(.5*e.fovX)/p,q=e/c,c=e/this.computeHeadingRotateRadius(g),f=(f?q:e)*r*a,b=m-b,b=Math.max(this.minimumAscendVelocity()*
a,Math.pow(2,r*a/p)*b-b),k=Math.pow(2,r*a/p)*k-k;a*=h.clamp(c*d,J,N);return{pan:f,ascend:b,zoom:k,rotate:a}};d.prototype.applyDisabledMovementTypes=function(b){void 0===this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.mode!==this.disableMovements.mode||(b.zoom=this.disableMovements.zoom?0:b.zoom,b.ascend=this.disableMovements.ascend?0:b.ascend,b.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&a.mat4.identity(b.pan.matrix),b.rotate.enabled=!this.disableMovements.rotate,
this.disableMovements.rotate&&a.mat4.identity(b.rotate.matrix))};d.activatesFor=function(a,b){a=B.extractTransformation(b,a.navigation.gamepad,C);return!("end"===b.action||B.isZeroTransformation(a))};return d}(q.InteractiveController);b.GamepadKeyboardController=n;var C={translation:[0,0,0],heading:0,tilt:0},D=80,K=h.deg2rad(D),I=.75,Q=5,J=h.deg2rad(30),N=h.deg2rad(80),L={zoom:0,ascend:0,pan:{enabled:!1,matrix:g.mat4f64.create()},rotate:{enabled:!1,matrix:g.mat4f64.create()}},M=d.vec3f64.create(),
R=w.createDirectionUp()})},"esri/views/3d/support/cameraUtils":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../config ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../camera/intersectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./mathUtils ./projectionUtils ../../support/spatialReferenceSupport".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z){function B(a){return"global"===a.viewingMode?u:w}function C(b,e,f){var g=b.renderSpatialReference,h=c.vec3.copy(ca,e.viewForward),h=Q(b,e.eye,h,e.up,da);b=b.spatialReference||r.WGS84;v.vectorToVector(e.eye,g,V,b)||(b=r.WGS84,v.vectorToVector(e.eye,g,V,b));if(!f)return new a(new p(V,b),h.heading,h.tilt,d.rad2deg(e.fov));f.position.x=V[0];f.position.y=V[1];f.position.z=V[2];f.position.spatialReference=b;f.heading=h.heading;f.tilt=h.tilt;f.fov=d.rad2deg(e.fov);
return f}function D(a,b,c){var e=a.state.camera,f=e.fovX,e=e.width/2/e.pixelRatio;"global"===a.viewingMode&&null!=c&&(b*=Math.cos(d.deg2rad(c)));b/=a.renderCoordsHelper.unitInMeters;return e/(39.37*g.screenDPI/b)/Math.tan(f/2)}function K(a,b,c){var e=a.state.camera;b=39.37*g.screenDPI/(e.width/2/e.pixelRatio/(b*Math.tan(e.fovX/2)));"global"===a.viewingMode&&(b/=Math.cos(d.deg2rad(c)));return b*=a.renderCoordsHelper.unitInMeters}function I(a,b,c,d,e,f){if(X(f)){var g=Y(f.signal);R(a,d.heading,d.tilt,
b,c,e,g);g.resolver.promise.then(function(b){return f.resolver.resolve(U(a,b,d.fov))},function(a){return f.resolver.reject(a)})}else return b=R(a,d.heading,d.tilt,b,c,e),U(a,b,d.fov,f)}function Q(a,b,c,d,e){return B(a).directionToHeadingTilt(b,c,d,e)}function J(a,b,c){return a.basemapTerrain&&a.renderCoordsHelper.fromRenderCoords(b,F,a.spatialReference)&&a.basemapTerrain.getElevation(F)>F.z-1}function N(a,b,c,d){return h(this,void 0,void 0,function(){var c;return k(this,function(e){switch(e.label){case 0:return a.renderCoordsHelper.fromRenderCoords(b,
F,a.spatialReference)?[4,a.elevationProvider.queryElevation(F,d)]:[2,!1];case 1:return c=e.sent(),[2,c>F.z-10]}})})}function L(a,b,d){return h(this,void 0,void 0,function(){var e,f;return k(this,function(g){switch(g.label){case 0:e=q.vec3f64.create();if(b)return[3,1];c.vec3.copy(e,a.state.camera.center);return[3,5];case 1:if(!(b instanceof p))return[3,4];v.pointToVector(b,e,a.renderSpatialReference);return null!=b.z||null==a.basemapTerrain?[3,3]:[4,a.elevationProvider.queryElevation(b,d)];case 2:return f=
g.sent(),null!=f&&a.renderCoordsHelper.setAltitude(f,e),[2,e];case 3:return[3,5];case 4:c.vec3.copy(e,b),g.label=5;case 5:return[2,e]}})})}function M(a,b){var d=q.vec3f64.create();b&&b instanceof p?(v.pointToVector(b,d,a.renderSpatialReference),null==b.z&&null!=a.basemapTerrain&&(b=a.elevationProvider.getElevation(b),null!=b&&a.renderCoordsHelper.setAltitude(b,d))):b?c.vec3.copy(d,b):c.vec3.copy(d,a.state.camera.center);return d}function R(a,b,c,d,e,f,g){var h=d&&d instanceof p?d:null;if(X(g))L(a,
d,g.signal).then(function(d){S(a,b,c,h,d,e,f,g)},function(a){return g.resolver.reject(a)});else return d=M(a,d),S(a,b,c,h,d,e,f,g)}function S(a,b,c,d,e,f,g,h){d||(d=v.vectorToPoint(e,a.renderSpatialReference,a.spatialReference||r.WGS84));f=Math.max(f,a.state.constraints.minimumPoiDistance);var m=T(a,b,c,e,f,g),k=B(a).eyeForCenterWithHeadingTilt,p=k(e,f,m.heading,m.tilt);if(g===ka.ADJUST&&"global"===a.viewingMode&&0<c){var z=function(){var m=f,k=f,p=a.state.constraints.tilt(k),k=B(a).eyeTiltToLookAtTilt(e,
k,c),k=Math.min(k,.5*Math.PI),p=p.min*(1-oa)+k*oa,m=B(a).lookAtTiltToEyeTilt(e,m,p);g=1>c-m?ka.LOCKED:ka.ADJUST;return S(a,b,m,d,e,f,g,h)};if(J(a,p.eye,p.tilt))return z();if(X(h)){N(a,p.eye,p.tilt,h.signal).then(function(a){if(a)return z();h.resolver.resolve({eye:p.eye,up:p.up,center:q.vec3f64.clone(e),heading:p.heading,tilt:p.tilt})});return}}m=!h||X(h)?{center:q.vec3f64.create(),eye:q.vec3f64.create(),up:q.vec3f64.create(),tilt:0,heading:0}:h;m.eye=p.eye;m.up=p.up;m.center=q.vec3f64.clone(e);m.heading=
p.heading;m.tilt=p.tilt;X(h)&&h.resolver.resolve(m);return m}function T(a,b,c,d,e,f){var g=0;if(f=f===ka.ADJUST)if(g=a.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(e/g)/Math.LN2)f=!0;else{var h=a.renderSpatialReference,m=a.spatialReference||r.WGS84;f=v.vectorToPoint(d,h,m);h=v.vectorToPoint(a.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,h,m);g*=Math.tan(.5*a.state.camera.fov);f=5<h.distance(f)/g}f?(b=0,f=a.state.constraints.tilt(e),f.max=Math.min(f.max,.5*Math.PI),f=f.min*
(1-oa)+f.max*oa,c=B(a).eyeTiltToLookAtTilt(d,e,c),g=Math.min(c,f)):g=B(a).eyeTiltToLookAtTilt(d,e,c);c=g=a.state.constraints.clampTilt(e,g);c=B(a).lookAtTiltToEyeTilt(d,e,c);return{heading:b,tilt:c}}function U(b,c,d,e){b=v.vectorToPoint(c.eye,b.renderSpatialReference,b.spatialReference||r.WGS84);return b?e?(e.position=b,e.heading=c.heading,e.tilt=c.tilt,e.fov=d,e):new a(b,c.heading,c.tilt,d):null}function Y(a){return{resolver:f.createResolver(),signal:a}}function X(a){return a&&"resolver"in a}Object.defineProperty(b,
"__esModule",{value:!0});var P=e.getLogger("esri.views.3d.support.cameraUtils"),V=q.vec3f64.create(),Z=q.vec3f64.create(),ca=q.vec3f64.create(),da={heading:0,tilt:0},F=new p,ea=new m.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),la=new m.Cyclical(-180,180),ka;(function(a){a[a.LOCKED=0]="LOCKED";a[a.ADJUST=1]="ADJUST"})(ka=b.OrientationMode||(b.OrientationMode={}));b.headingTiltToDirectionUp=function(a,b,c,d,e){return B(a).headingTiltToDirectionUp(b,c,d,e)};b.externalToInternal=function(a,b){var e=
a.renderSpatialReference,f=B(a).headingTiltToDirectionUp,g=q.vec3f64.create();if(!v.pointToVector(b.position,g,e))return null;e=f(g,b.heading,b.tilt);c.vec3.scale(e.direction,e.direction,a.state.camera.distance);c.vec3.add(e.direction,e.direction,g);a=x.cameraOnContentAlongViewDirection(a,g,e.direction,e.up);a.fov=d.deg2rad(b.fov);return a};b.internalToExternal=C;b.scaleToDistance=D;b.distanceToScale=K;b.fromCenterScale=function(a,b,c,d,e,f){c=D(a,c,b.latitude);return I(a,b,c,d,e,f)};b.fromCenterDistance=
I;b.directionToHeadingTilt=Q;b.getObserverForPointAtDistance=R;b.fromExtent=function(a,b,c,d,e,f){var g,h=0;null!=b.zmax&&null!=b.zmin&&(g=(b.zmax+b.zmin)/2,h=b.zmax-b.zmin);var m,k;if("global"===a.viewingMode){if(!z.isSpatialReferenceSupported(b.spatialReference,"global"))return X(f)&&f.resolver.reject(),null;var q=new p(b.xmin,b.ymin,b.spatialReference),v=new p(b.xmax,b.ymax,b.spatialReference),t=b.spatialReference.isGeographic?la:ea;b=new p(t.center(q.x,v.x),(v.y+q.y)/2,b.spatialReference);null!=
g&&(b.z=g);k=y.getGreatCircleSpanAt(b,q,v);m=k.lon;k=k.lat;t.diff(q.x,v.x)>t.range/2&&(m+=y.halfEarthCircumference);m=Math.min(m,y.halfEarthCircumference);k=Math.min(k,y.halfEarthCircumference)}else q=a.spatialReference||r.WGS84,m=b.xmax-b.xmin,k=b.ymax-b.ymin,b=new p({x:b.xmin+.5*m,y:b.ymin+.5*k,z:g,spatialReference:q});g=a.state.camera;h=Math.max(1/Math.tan(g.fovX/2)*m*.5,1/Math.tan(g.fovY/2)*k*.5,1/Math.tan(g.fov/2)*h*.5)/1;if(X(f))m=Y(f.signal),R(a,c,d,b,h,e,m),m.resolver.promise.then(function(b){return f.resolver.resolve(U(a,
b,a.camera.fov))},function(a){return f.resolver.reject(a)});else return c=R(a,c,d,b,h,e),U(a,c,a.camera.fov,f)};b.toExtent=function(a,b,c,d,e){b||(c||(c=a.state.camera),b=C(a,c,e));e=a.renderSpatialReference;var f;if(c)e=v.vectorToPoint(c.center,e,a.spatialReference||r.WGS84),f=c.distance;else{e=a.toMap(a.screenCenter);if(!e)return null;f=y.computeCartesianDistance(b.position,e)}c||(c=a.state.camera);b=2*f*Math.tan(c.fovX/2)*1;c=2*f*Math.tan(c.fovY/2)*1;return"global"===a.viewingMode?u.toExtent(a,
e,b,c,d):w.toExtent(a,e,b,c,d)};var oa=.7;b.observerToCamera=U;b.scaleToZoom=function(a,b){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.levelAtScale(b);P.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};b.zoomToScale=function(a,b){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.scaleAtLevel(b);P.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};b.scaleToResolution=function(a,b){return a.spatialReference?
t.getResolutionForScale(b,a.spatialReference):void 0};b.computeScale=function(b,d,e){var f=b.renderSpatialReference;d||(d=b.state.camera);var g;g=r.WGS84;d instanceof a?(g=d.position.latitude,v.pointToVector(d.position,V,f),v.pointToVector(e,Z,f),d=c.vec3.distance(V,Z)):(v.vectorToVector(d.center,f,Z,g),g=Z[1],d=d.distance);return K(b,d,g)};b.createAsyncContext=Y;b.isAsyncContext=X})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ./cameraUtilsInternal ./projectionUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f){function c(b,c,e,f){void 0===f&&(f=d.createDirectionUp());k.mat4.identity(r);b=f.direction;var g=f.up;k.mat4.rotateZ(r,r,-l.deg2rad(c));k.mat4.rotateX(r,r,l.deg2rad(e));a.vec3.transformMat4(b,p,r);a.vec3.scale(b,b,-1);a.vec3.transformMat4(g,q,r);return f}Object.defineProperty(b,"__esModule",{value:!0});var q=g.vec3f64.fromValues(0,1,0),p=g.vec3f64.fromValues(0,0,1),r=h.mat4f64.create(),t=g.vec3f64.create(),x=g.vec3f64.create();b.headingTiltToDirectionUp=c;b.directionToHeadingTilt=
function(a,b,c,e){return d.directionToHeadingTilt(b,c,e,p,q)};b.eyeForCenterWithHeadingTilt=function(b,d,e,f){var h=c(b,e,f),m=g.vec3f64.create();a.vec3.scale(m,h.direction,-d);a.vec3.add(m,m,b);return{up:h.up,eye:m,heading:e,tilt:f}};b.lookAtTiltToEyeTilt=function(a,b,c){return l.rad2deg(c)};b.eyeTiltToLookAtTilt=function(a,b,c){return l.deg2rad(c)};b.toExtent=function(a,b,c,d,g){var h=a.renderSpatialReference;a=a.map&&a.spatialReference||b.spatialReference;f.pointToVector(b,t,h);f.pointToVector(b,
x,h);t[0]-=c/2;x[0]+=c/2;t[1]-=d/2;x[1]+=d/2;f.vectorToVector(t,h,t,a);f.vectorToVector(x,h,x,a);g?(g.xmin=t[0],g.ymin=t[1],g.xmax=x[0],g.ymax=x[1],g.spatialReference=a):g=new e(t[0],t[1],x[0],x[1],a);return g}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=h.vec3f64.create(),g=h.vec3f64.create();
b.createDirectionUp=function(){return{direction:h.vec3f64.create(),up:h.vec3f64.create()}};b.directionToHeadingTilt=function(b,d,f,c,h){var e=a;k.vec3.normalize(e,b);var r=k.vec3.dot(e,c),q=0<r,r=Math.abs(r);.99<r&&(r=Math.abs(k.vec3.dot(d,c)),.99>r?(k.vec3.copy(e,d),q&&k.vec3.scale(e,e,-1)):e=null);d=0;e&&(k.vec3.scale(g,c,k.vec3.dot(c,e)),k.vec3.subtract(e,e,g),d=k.vec3.dot(e,h)/(k.vec3.length(e)*k.vec3.length(h)),k.vec3.cross(g,e,h),d=(0<k.vec3.dot(g,c)?1:-1)*l.rad2deg(l.acosClamped(d)));b=l.rad2deg(l.acosClamped(-k.vec3.dot(c,
b)/k.vec3.length(b)));if(!f)return{heading:d,tilt:b};f.heading=d;f.tilt=b;return f}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){function r(b,d,e,f){void 0===f&&(f=c.createDirectionUp());a.vec3.cross(v,b,w);0===a.vec3.dot(v,v)&&a.vec3.cross(v,b,u);k.mat4.identity(m);k.mat4.rotate(m,m,-l.deg2rad(d),b);k.mat4.rotate(m,m,-l.deg2rad(e),v);d=f.up;e=f.direction;a.vec3.cross(d,v,b);a.vec3.normalize(d,d);a.vec3.transformMat4(d,d,m);a.vec3.normalize(e,b);a.vec3.negate(e,e);a.vec3.transformMat4(e,e,m);return f}function t(a){var b=a[1];a[1]=-a[2];a[2]=b}function x(a,b){b=r(b,a.heading,a.tilt);a.up=
b.up;return a}Object.defineProperty(b,"__esModule",{value:!0});var w=g.vec3f64.fromValues(0,0,1),u=a.vec3.normalize(g.vec3f64.create(),g.vec3f64.fromValues(1,1,1)),y=new p.Cyclical(-180,180),m=h.mat4f64.create(),v=g.vec3f64.create(),z=g.vec3f64.create();b.headingTiltToDirectionUp=r;b.directionToHeadingTilt=function(b,d,e,f){var g=v;a.vec3.normalize(g,b);a.vec3.cross(z,g,w);0===a.vec3.dot(z,z)&&a.vec3.cross(z,g,u);a.vec3.cross(z,z,g);return c.directionToHeadingTilt(d,e,f,g,z)};b.eyeForCenterWithHeadingTilt=
function(b,c,d,e){var f={eye:g.vec3f64.create(),up:null,tilt:e,heading:d},h=v;h[0]=b[0];h[1]=b[2];h[2]=-b[1];d=l.deg2rad(d);var m=l.deg2rad(e);e=Math.sin(d);d=Math.cos(d);var k=Math.sin(m),p=Math.cos(m),r=a.vec3.length(h);if(1E-8>Math.abs(m))m=c+r;else var q=r/k,z=l.asinClamped(c/q),m=q*Math.sin(Math.PI-m-z);var q=k*c,p=p*c,z=d*q,y=m-p,u=y*y,w=c*c*k*k,k=d*d*w,w=e*e*w,B=h[1]*y,C=k*(k+u-h[1]*h[1]);if(0>C)return a.vec3.scale(f.eye,h,m/r),f.tilt=0,f;var D=Math.sqrt(C),C=k+u,B=0<d?-D+B:D+B;if(1E-8>Math.abs(C))return 1E-8>
r?(f.eye[0]=0,f.eye[1]=0,f.eye[2]=c):a.vec3.scale(f.eye,h,m/r),f.tilt=0,t(f.eye),x(f,b);f.eye[1]=B/C;C=f.eye[1]*f.eye[1];c=1-C;B=Math.sqrt(c);z=k*C+w-2*z*f.eye[1]*B*y+c*u;if(1E-8>Math.abs(z))return a.vec3.scale(f.eye,h,m/r),f.tilt=0,t(f.eye),x(f,b);f.eye[0]=(c*(m*h[0]-p*h[0])-q*B*(h[0]*f.eye[1]*d+h[2]*e))/z;f.eye[2]=(c*(m*h[2]-p*h[2])-q*B*(h[2]*f.eye[1]*d-h[0]*e))/z;a.vec3.scale(f.eye,f.eye,m);t(f.eye);return x(f,b)};b.lookAtTiltToEyeTilt=function(b,c,d){b=a.vec3.length(b);c=l.asinClamped(c/(Math.sqrt(c*
c+b*b-2*c*b*Math.cos(Math.PI-d))/Math.sin(d)));return l.rad2deg(d-c)};b.eyeTiltToLookAtTilt=function(b,c,d){d=l.deg2rad(d);b=a.vec3.length(b);return l.asinClamped(c/(b/Math.sin(d)))+d};b.toExtent=function(a,b,c,g,h){function m(a){var b=Math.PI/2;a=p.cyclical2PI.normalize(a,-b);a>b&&(a=Math.PI-a);return a}var k;k=b.latitude;b=b.longitude;var r=q.getLonDeltaForDistance(b,k,c)/2;c=b-r;b+=r;k=l.deg2rad(k);r=q.earthRadius;k=(1+Math.sin(k))/(1-Math.sin(k));var v=(k+1)*Math.tan(g/r/2);k=1.5*Math.PI-2*Math.atan(.5*
(v+Math.sqrt(4*k+v*v)));g=k+g/r;k=m(k);g=m(g);g<k&&(r=g,g=k,k=r);k=Math.max(l.rad2deg(k),-90);g=Math.min(l.rad2deg(g),90);b=y.monotonic(c,b);180<b-c&&(r=(b-c-180)/2,c+=r,b-=r);r=a.spatialReference&&a.spatialReference.isGeographic?a.spatialReference:d.WGS84;h?(h.xmin=c,h.ymin=k,h.xmax=b,h.ymax=g,h.spatialReference=r):h=new e(c,k,b,g,r);a.spatialReference&&a.spatialReference.isWebMercator&&f.geographicToWebMercator(h,!1,h);return h}})},"esri/views/support/spatialReferenceSupport":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isSpatialReferenceSupported=function(b,k){return null==b?!1:"2d"===k?!0:"local"===k?!b.isGeographic:b.isWebMercator||b.isWGS84||4490===b.wkid}})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["require","exports","../../core/libs/gl-matrix-2/vec3"],function(n,b,l){function k(b){var a=b*b;0>b&&(a*=-1);return a}Object.defineProperty(b,"__esModule",{value:!0});b.quadraticAccentuation=k;b.resetTransformation=
function(b){b.translation[0]=0;b.translation[1]=0;b.translation[2]=0;b.heading=0;b.tilt=0;return b};b.extractTransformation=function(b,a,g){var e=b.state;b=b.device;a="forward-down"===a.tiltDirection?1:-1;"standard"===b.deviceType?(g.translation[0]=k(e.axes[0]),g.translation[1]=k(e.axes[1]),g.translation[2]=k(e.buttons[7])-k(e.buttons[6]),g.heading=k(e.axes[2]),g.tilt=k(e.axes[3])):"spacemouse"===b.deviceType&&(g.translation[0]=1.2*k(e.axes[0]),g.translation[1]=1.2*k(e.axes[1]),g.translation[2]=2*
-k(e.axes[2]),g.heading=1.2*k(e.axes[5]),g.tilt=1.2*k(e.axes[3]));g.tilt*=a;l.vec3.scale(g.translation,g.translation,1);return g};b.extractTransformationKeyboard=function(b,a){a.translation[0]=b[1]-b[0];a.translation[1]=b[3]-b[2];a.translation[2]=b[4]-b[5];a.heading=b[7]-b[6];a.tilt=b[8]-b[9];return a};b.isZeroTransformation=function(b){return 0===b.translation[0]&&0===b.translation[1]&&0===b.translation[2]&&0===b.heading&&0===b.tilt}})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,d,f){var c,e=a.call(this,!0)||this;e.view=b;e.disableMovements={pan:!0,zoom:!0,ascend:!0,rotate:!1,mode:"local"};e.keyToNumber=(c={},c[d.left]=0,c[d.right]=1,c[d.forward]=2,c[d.backward]=3,c[d.up]=4,c[d.down]=5,c[d.headingLeft]=6,c[d.headingRight]=7,c[d.tiltUp]=8,c[d.tiltDown]=
9,c);e.registerIncoming("key-down",f,function(a){return e.handleKeyDown(a)});e.registerIncoming("key-up",f,function(a){return e.handleKeyUp(a)});e.registerIncoming("blur",f,function(){return e.handleBlur()});return e}l(b,a);b.prototype.handleKeyDown=function(a){var b=this.keyToNumber[a.data.key];null!=b&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new k.GamepadKeyboardController(this.view,void 0,this.disableMovements),this.view.state.switchCameraController(this.cameraControllerKeyboard)),
this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(b),a.stopPropagation()))};b.prototype.handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};b.prototype.handleKeyUp=function(a){var b=this.keyToNumber[a.data.key];null!=b&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(b),
a.stopPropagation())};return b}(h.InputHandler);b.KeyboardNavigation=n})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c){var d=b.call(this,!0)||this;d.view=
a;d.registerIncoming("mouse-wheel",c,function(a){return d.handleMouseWheel(a)});return d}l(d,b);d.prototype.handleMouseWheel=function(b){var c=b.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new h.ZoomStepController(this.view,"interaction"):new a.ZoomStepController(this.view,"interaction"),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*c.deltaY,k.createScreenPointArray(c.x,c.y));b.stopPropagation()};
return d}(g.InputHandler);b.MouseWheelZoom=n})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,c,d){var e=a.call(this,!0)||this;e.view=b;e.pointerAction=
c;e.lastEndTimestamp=0;e.lastTimestamp=0;e.registerIncoming("drag",d,function(a){return e.handleDrag(a)});return e}l(b,a);b.prototype.handleDrag=function(a){if("mouse"!==a.data.pointerType||g.eventMatchesMousePointerAction(a.data,this.pointerAction)){var b=a.timestamp-this.lastEndTimestamp,b=this.momentum&&this.momentum.active&&40>b;switch(a.data.action){case "start":case "update":if(b)break;this.controller&&this.controller.active?2<a.data.timestamp-this.lastTimestamp&&(this.controller.update(a.data),
this.lastTimestamp=a.timestamp):this.startController(a);break;case "end":case "removed":this.endController(a,!0);break;case "added":this.endController(a,!1),this.startController(a)}a.stopPropagation()}};b.prototype.endController=function(a,b){this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,a=this.controller.end(a.data),b&&a&&(this.momentum=a,this.view.state.switchCameraController(this.momentum)));this.controller=null};b.prototype.startController=function(a){this.controller=
this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(a.data);this.lastTimestamp=a.timestamp};b.prototype.createController=function(){return this.view.state.isGlobal?new k.PinchAndPanController(this.view,this.view.sceneIntersectionHelper):new h.PinchAndPanController(this.view,this.view.sceneIntersectionHelper)};return b}(a.InputHandler);b.PinchAndPanNavigation=n})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function p(a,c){var d=b.call(this)||this;d.view=a;d.intersectionHelper=c;d.smoothRotation=new q.ExponentialFalloff(.05);d.rotationAxis=f.vec3f64.create();d.panningPlane=v.plane.create();d.smoothScaling=new q.ExponentialFalloff(.05);d.zoomCenterScreen=h.createScreenPointArray();d.zoomMomentumEstimator=new I.ZoomMomentumEstimator;d.rotationMomentumEstimator=new K.RotationMomentumEstimator;
d.panSphericalMomentumEstimator=new D.PanSphericalMomentumEstimator;d.panPlanarMomentumEstimator=new C.PanPlanarMomentumEstimator;d.adjustedSphere=v.sphere.create();d.tmp3d=f.vec3f64.create();d.tmpMat=g.mat4f64.create();d.tmpAxisAngle=v.axisAngle.create();d.tmpScreenPointArray=h.createScreenPointArray();d.beginScreenPoint=h.createScreenPointArray();d.beginScenePoint=f.vec3f64.create();d.screenPickPoint=h.createScreenPointArray();d.panMode=m.PanMode.Horizontal;d.tmpInteractionDirection=f.vec3f64.create();
d.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new B.default,interactionDirection:null,tiltMode:0};return d}l(p,b);p.prototype.begin=function(a){if(this.active){this.beginHeading=-z.cyclicalPI.normalize(k.deg2rad(this.view.camera.heading));this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();h.screenPointObjectToArray(a.center,this.screenPickPoint);e.vec2.copy(this.beginScreenPoint,this.screenPickPoint);
var b=y.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=b.scenePickPoint;this.sphere=b.sphere;d.vec3.copy(this.beginScenePoint,this.scenePickPoint);this.panMode=y.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===m.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(a):this.preparePlanarPanMode(a));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};p.prototype.preparePlanarPanModeOverground=
function(a){var b=d.vec3.negate(this.tmp3d,this.beginCamera.viewForward);v.plane.fromPositionAndNormal(this.scenePickPoint,b,this.panningPlane);var c=h.createScreenPointArray(this.screenPickPoint[0],0),b=f.vec3f64.create(),e=d.vec3.length(this.beginCamera.eye);this.adjustedSphere.radius=e<this.sphere.radius?e-100:this.sphere.radius;y.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,c,b);c=h.createRenderScreenPointArray3();this.beginCamera.projectPoint(b,c);this.screenPickPoint[1]=
Math.min(this.screenPickPoint[1],.9*c[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&v.plane.fromPositionAndNormal(this.scenePickPoint,this.panningPlane,this.panningPlane);a=h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,a,this.beginScenePoint)};p.prototype.preparePlanarPanMode=function(b){var c=d.vec3.negate(this.tmp3d,this.beginCamera.viewForward);v.plane.fromPositionAndNormal(this.scenePickPoint,
c,this.panningPlane);var e=v.sphere.angleToSilhouette(this.sphere,this.currentCamera.eye),c=v.axisAngle.fromPoints(this.currentCamera.eye,this.scenePickPoint,this.tmpAxisAngle),e=-c[3]-(this.currentCamera.aboveGround?.25:.025)*e;if(0<e){var f=a.mat4.identity(this.tmpMat);a.mat4.rotate(f,f,-e,c);d.vec3.subtract(this.scenePickPoint,this.scenePickPoint,this.sphere.center);d.vec3.transformMat4(this.scenePickPoint,this.scenePickPoint,f);d.vec3.add(this.scenePickPoint,this.scenePickPoint,this.sphere.center);
v.plane.setOffsetFromPoint(this.panningPlane,this.scenePickPoint,this.panningPlane);b=h.screenPointObjectToArray(b.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,b,this.beginScenePoint)}};p.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<a.pointers.size;this.panMode===m.PanMode.Horizontal?(b&&this.zoomSpherical(a),this.panningSpherical(a),b&&this.rotateSpherical(a)):(b&&this.zoomPlanar(a),this.panningPlanar(a),
b&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};p.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===m.PanMode.Horizontal?new u.ZoomSphericalMomentumController(this.view,a,this.zoomCenterScreen,this.beginScenePoint,this.sphere.radius):new w.ZoomPlanarMomentumController(this.view,a,this.beginScenePoint);if(a=this.rotationMomentumEstimator.evaluateMomentum())return new x.RotationMomentumController(this.view,
a,this.sphere.center,this.rotationAxis);if(this.panMode===m.PanMode.Horizontal){if(a=this.panSphericalMomentumEstimator.evaluateMomentum())return new t.PanSphericalMomentumController(this.view,a)}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new r.PanPlanarMomentumController(this.view,a);return null};p.prototype.zoomSpherical=function(a){var b=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(b);y.applyZoomOnSphere(this.sphere,
this.currentCamera,this.smoothScaling.value);h.screenPointObjectToArray(a.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};p.prototype.panningSpherical=function(a){var b=h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.sphereOrPlanePointFromScreenPoint(this.sphere,
this.currentCamera,b,this.tmp3d);y.preserveHeadingThreshold(this.beginScenePoint,d.vec3.dot(this.currentCamera.up,this.beginScenePoint),this.sphere.radius,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(y.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(b,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):
(y.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(b,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere.radius,this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.screenPickPoint,b);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};p.prototype.rotateSpherical=
function(a){d.vec3.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||d.vec3.negate(this.rotationAxis,this.rotationAxis);var b=this.smoothRotation.value,e=y.normalizeRotationDelta(a.angle-b),b=b+e;this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(b);e=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(e,.001*a.timestamp);y.applyRotation(this.currentCamera,this.sphere.center,v.axisAngle.wrapAxisAngle(this.rotationAxis,
e));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius*b);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};p.prototype.panningPlanar=function(a){var b=h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,b,this.tmp3d)&&(y.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(b,this.tmp3d,
.001*a.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.beginScreenPoint,b),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),c.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};p.prototype.zoomPlanar=function(a){var b=this.beginRadius/a.radius;this.smoothScaling.gain=
.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(b);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);y.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};p.prototype.rotatePlanar=
function(a){d.vec3.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||d.vec3.negate(this.rotationAxis,this.rotationAxis);var b=this.smoothRotation.value,e=a.angle-b,e=y.normalizeRotationDelta(e);this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(b+e);b=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(b,.001*a.timestamp);y.applyRotation(this.currentCamera,this.sphere.center,v.axisAngle.wrapAxisAngle(this.rotationAxis,
b));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius*b);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};return p}(p.InteractiveController);b.PinchAndPanController=n})},"esri/views/3d/input/util":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._gain=b}b.prototype.reset=function(b){this._value=b};Object.defineProperty(b.prototype,
"gain",{set:function(b){this._gain=b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});b.prototype.update=function(b){this._value=void 0===this._value?b:this._gain*b+(1-this._gain)*this._value};return b}();b.ExponentialFalloff=n})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,e){b=a.call(this,b,4)||this;b.momentum=e;b.tmpPan=h.vec3f64.create();return b}l(b,a);b.prototype.momentumStep=function(a,b){a=this.momentum.value(a);k.vec3.scale(this.tmpPan,this.momentum.direction,a);k.vec3.subtract(b.eye,b.eye,this.tmpPan);k.vec3.subtract(b.center,b.center,this.tmpPan);b.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return b}(a.MomentumController);b.PanPlanarMomentumController=
n})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(d,e){e=b.call(this)||this;e.view=d;e.beginCamera=new a.default;e.elapsedTimeSec=0;e.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new a.default,
interactionDirection:null,tiltMode:0};return e}l(e,b);Object.defineProperty(e.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!0,configurable:!0});e.prototype.onControllerStart=function(a){this.beginCamera.copyFrom(a);this.constraintOptions.interactionStartCamera=this.beginCamera;b.prototype.onControllerStart.call(this,a)};e.prototype.stepController=function(a,b){b.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=a;this.momentumStep(this.elapsedTimeSec,
b);k.applyAll(this.view,b,this.constraintOptions)};return e}(h.AnimationController);b.MomentumController=n})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});var e=h.vec3f64.create(),
d=h.vec3f64.create();n=function(a){function b(b,c){b=a.call(this,b,4)||this;b.momentum=c;return b}l(b,a);b.prototype.momentumStep=function(a,b){var c=this.momentum.value1(a);a=this.momentum.value2(a);k.vec3.copy(d,b.eye);k.vec3.normalize(d,d);k.vec3.cross(this.momentum.axis2,d,this.momentum.axis1);g.applyRotationWithTwoAxes(b,e,this.momentum.axis1,c,this.momentum.axis2,a)};return b}(a.MomentumController);b.PanSphericalMomentumController=n})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,d,e,f){b=a.call(this,b,2)||this;b.momentum=d;b.axis=h.vec3f64.create();b.center=h.vec3f64.create();k.vec3.copy(b.axis,f);k.vec3.copy(b.center,e);return b}l(b,a);b.prototype.momentumStep=function(a,b){a=this.momentum.value(a);g.applyRotation(b,this.center,e.axisAngle.wrapAxisAngle(this.axis,a))};return b}(a.MomentumController);b.RotationMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,d,e){b=a.call(this,b,1)||this;b.momentum=d;b.zoomCenter=h.vec3f64.create();k.vec3.copy(b.zoomCenter,e);b.constraintOptions.interactionDirection=h.vec3f64.create();return b}l(b,a);b.prototype.momentumStep=function(a,b){k.vec3.copy(this.constraintOptions.interactionDirection,b.eye);a=this.momentum.valueDelta(0,a);g.applyZoomToPoint(b,this.zoomCenter,a,this.view.state.constraints.minimumPoiDistance);
this.constraintOptions.interactionDirection=e.directionFromTo(this.constraintOptions.interactionDirection,b.eye,this.constraintOptions.interactionDirection)};return b}(a.MomentumController);b.ZoomPlanarMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(d,e,f,p,q){d=b.call(this,d,1)||this;d.momentum=e;d.screenCenter=k.createScreenPointArray();d.sceneCenter=g.vec3f64.create();d.tmpSceneCenter=g.vec3f64.create();d.tmpZoomAxisAngle=c.axisAngle.create();d.sphere=c.sphere.create();h.vec2.copy(d.screenCenter,f);a.vec3.copy(d.sceneCenter,p);d.sphere.radius=q;return d}l(d,b);d.prototype.momentumStep=function(a,b){a=this.momentum.valueDelta(0,a);f.applyZoomOnSphere(this.sphere,
b,a);this.constraintOptions.interactionType=1;e.applyAll(this.view,b,this.constraintOptions);f.sphereOrPlanePointFromScreenPoint(this.sphere,b,this.screenCenter,this.tmpSceneCenter);c.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);f.applyRotation(b,this.sphere.center,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};return d}(d.MomentumController);b.ZoomSphericalMomentumController=n})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});var e=function(a){function b(b,d,e,f,g){b=a.call(this,b,d,e)||this;b.sceneVelocity=f;b.direction=g;return b}l(b,a);b.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,b)};return b}(g.Momentum);b.PanPlanarMomentum=e;n=function(){function b(b,c,d){void 0===b&&(b=300);void 0===c&&(c=12);void 0===d&&(d=.84);this.minimumInitialVelocity=b;this.stopVelocity=c;this.friction=d;this.time=
new a.FilteredFiniteDifference(.6);this.screen=[new a.FilteredFiniteDifference(.4),new a.FilteredFiniteDifference(.4)];this.scene=[new a.FilteredFiniteDifference(.6),new a.FilteredFiniteDifference(.6),new a.FilteredFiniteDifference(.6)];this.tmpDirection=h.vec3f64.create()}b.prototype.add=function(a,b,d){this.time.hasLastValue&&.015>this.time.computeDelta(d)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(b[0]),this.scene[1].update(b[1]),this.scene[2].update(b[2]),this.time.update(d))};
b.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};b.prototype.createMomentum=function(a,
b,d){k.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var c=k.vec3.length(this.tmpDirection);0<c&&k.vec3.scale(this.tmpDirection,this.tmpDirection,1/c);return new e(a,b,d,c/this.time.filteredDelta,this.tmpDirection)};return b}();b.PanPlanarMomentumEstimator=n})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.gain=
b}b.prototype.update=function(b){if(this.hasLastValue){var h=this.computeDelta(b);this.updateDelta(h)}this.lastValue=b};b.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(b.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});b.prototype.computeDelta=function(b){return b-
this.lastValue};b.prototype.updateDelta=function(b){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*b:b};return b}();b.FilteredFiniteDifference=n})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a,g){this._initialVelocity=b;this._stopVelocity=a;this._friction=g;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(b.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});b.prototype.isFinished=function(b){return b>this.duration};Object.defineProperty(b.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});b.prototype.value=function(b){return this.valueFromInitialVelocity(this._initialVelocity,b)};b.prototype.valueDelta=function(b,a){var g=this.value(b);return this.value(b+
a)-g};b.prototype.valueFromInitialVelocity=function(b,a){a=Math.min(a,this.duration);var g=1-this.friction;return b*(Math.pow(g,a)-1)/Math.log(g)};return b}();b.Momentum=n})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(n,b,l,k,h,a,g,e,d,f){Object.defineProperty(b,"__esModule",{value:!0});var c=function(a){function b(b,c,d,e,f,g,h){void 0===g&&(g=0);b=a.call(this,b,c,d)||this;b.angularVelocity1=e;b.axis1=f;b.angularVelocity2=g;b.axis2=h;return b}l(b,a);b.prototype.value1=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,b)};b.prototype.value2=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,b)};return b}(f.Momentum);b.PanSphericalMomentum=
c;n=function(){function b(b,c,f){void 0===b&&(b=300);void 0===c&&(c=12);void 0===f&&(f=.84);this.minimumInitialVelocity=b;this.stopVelocity=c;this.friction=f;this.tmpAxis1=a.vec3f64.create();this.tmpAxis2=a.vec3f64.create();this.tmpAngles=k.vec2f64.create();this.time=new e.FilteredFiniteDifference(.3);this.screen=[new e.FilteredFiniteDifference(.4),new e.FilteredFiniteDifference(.4)];this.angle1=new d.FilteredValue(.6);this.angle2=new d.FilteredValue(.6);this.axis1=a.vec3f64.create();this.axis2=a.vec3f64.create();
this.lastScene=a.vec3f64.create()}b.prototype.addMomentumDirectRotation=function(a,b,c,d,e,f){if(this.time.hasLastValue){if(.01>this.time.computeDelta(c))return;d=g.rotationAngleAndAxisDirectRotation(this.lastScene,b,this.tmpAxis2,d,e,f);this.angle2.update(0);1E-5>h.vec3.squaredLength(this.tmpAxis2)?d=0:h.vec3.normalize(this.axis1,this.tmpAxis2);this.angle1.update(d);h.vec3.copy(this.lastScene,b)}this.screen[0].update(a[0]);this.screen[1].update(a[1]);this.time.update(c)};b.prototype.addMomentumPreserveHeading=
function(a,b,c,d,e,f,k){if(this.time.hasLastValue){if(.01>this.time.computeDelta(c))return;g.rotationAnglesAndAxesHeadingPreserving(this.lastScene,b,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,d,e,f,k,!1);1E-5>h.vec3.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),h.vec3.normalize(this.axis1,this.tmpAxis1),h.vec3.normalize(this.axis2,this.tmpAxis2));h.vec3.copy(this.lastScene,b)}this.screen[0].update(a[0]);
this.screen[1].update(a[1]);this.time.update(c)};b.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};b.prototype.createMomentum=
function(a,b,d){return new c(a,b,d,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return b}();b.PanSphericalMomentumEstimator=n})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.gain=b}b.prototype.update=function(b){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*
b:b};b.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(b.prototype,"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0});return b}();b.FilteredValue=n})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function a(a,e,d,f){void 0===a&&(a=3);void 0===
e&&(e=.01);void 0===d&&(d=.95);void 0===f&&(f=12);return b.call(this,a,e,d,f)||this}l(a,b);a.prototype.add=function(a,e){if(this.value.hasLastValue){var d=this.value.lastValue;for(a-=d;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;a=d+a}b.prototype.add.call(this,a,e)};return a}(k.MomentumEstimator);b.RotationMomentumEstimator=n})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,f,c){void 0===a&&(a=2.5);void 0===b&&(b=.01);void 0===f&&(f=.95);void 0===c&&(c=12);this.minimumInitialVelocity=a;this.stopVelocity=b;this.friction=f;this.maxVelocity=c;this.value=new h.FilteredFiniteDifference(.8);this.time=new h.FilteredFiniteDifference(.3)}b.prototype.add=function(a,b){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;if(this.value.hasFilteredDelta){var d=this.value.computeDelta(a);
0>this.value.filteredDelta*d&&this.value.reset()}}this.time.update(b);this.value.update(a)};b.prototype.reset=function(){this.value.reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var a=this.value.filteredDelta/this.time.filteredDelta,a=k.clamp(a,-this.maxVelocity,this.maxVelocity);return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};b.prototype.createMomentum=function(b,d,f){return new a.Momentum(b,
d,f)};return b}();b.MomentumEstimator=n})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(a){function b(b,e,c){return a.call(this,b,e,c)||this}l(b,a);b.prototype.value=function(b){b=a.prototype.value.call(this,b);return Math.exp(b)};b.prototype.valueDelta=function(b,e){var c=a.prototype.value.call(this,b);
b=a.prototype.value.call(this,b+e);return Math.exp(b-c)};return b}(k.Momentum);b.ZoomMomentum=a;n=function(b){function e(a,e,c,g){void 0===a&&(a=2.5);void 0===e&&(e=.01);void 0===c&&(c=.95);void 0===g&&(g=12);return b.call(this,a,e,c,g)||this}l(e,b);e.prototype.add=function(a,e){b.prototype.add.call(this,Math.log(a),e)};e.prototype.createMomentum=function(b,e,c){return new a(b,e,c)};return e}(h.MomentumEstimator);b.ZoomMomentumEstimator=n})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y){Object.defineProperty(b,"__esModule",{value:!0});var m;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(m=b.PanMode||(b.PanMode={}));var v=g.vec3f64.fromValues(0,0,1),z=16/180*Math.PI;n=function(b){function f(a,c){var e=b.call(this)||this;e.view=a;e.intersectionHelper=c;e.rotationValueSmooth=new d.ExponentialFalloff(.05);e.scalingValueSmooth=new d.ExponentialFalloff(.05);e.planeHorizontal=t.plane.create();e.planeVertical=t.plane.create();
e.rotationMomentumEstimator=new u.RotationMomentumEstimator;e.panMomentumEstimator=new w.PanPlanarMomentumEstimator(300,12,.9);e.zoomMomentumEstimator=new y.ZoomMomentumEstimator;e.beginCenter=g.vec3f64.create();e.tmpPoints=[];e.beginCenterScreen=h.createScreenPointArray();e.tmpCentroid3d=g.vec3f64.create();e.tmpCentroid2d=h.createScreenPointArray();e.tmp2d=h.createScreenPointArray();e.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new x.default,interactionDirection:null,
tiltMode:0};return e}l(f,b);f.prototype.begin=function(b){if(this.active){this.beginRadius=b.radius;this.pointerCount=b.pointers.size;this.beginAngle=b.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();h.screenPointObjectToArray(b.center,this.beginCenterScreen);t.plane.fromNormalAndOffset(v,0,this.planeHorizontal);var c=g.vec3f64.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,c);var d=g.vec3f64.create();a.vec3.negate(d,this.beginCamera.viewForward);
var e=g.vec3f64.create();a.vec3.copy(e,v);var f=a.vec3.dot(d,e);this.panMode=k.asinClamped(0>f?-f:f)>=z?m.Horizontal:m.Vertical;t.plane.setOffsetFromPoint(this.planeHorizontal,c,this.planeHorizontal);this.beginCamera.aboveGround||t.plane.negate(this.planeHorizontal,this.planeHorizontal);this.panMode===m.Vertical?(a.vec3.scale(e,e,f),a.vec3.subtract(this.planeVertical,d,e),a.vec3.normalize(this.planeVertical,this.planeVertical),t.plane.setOffsetFromPoint(this.planeVertical,c,this.planeVertical),this.computePlanePoints(b.pointers,
this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(b.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);r.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};f.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<a.pointers.size,c=this.panMode===m.Horizontal?this.planeHorizontal:this.planeVertical,d=this.beginCenter;if(b){var f=this.beginRadius/a.radius,
g=.001875*Math.min(Math.max(a.radius,40),120);this.scalingValueSmooth.gain=g;this.scalingValueSmooth.update(f);r.applyZoomToPoint(this.currentCamera,d,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(Math.abs(a.radius-this.beginRadius));e.applyAll(this.view,this.currentCamera,
this.constraintOptions)}this.computePlanePoints(a.pointers,c,this.currentCamera,this.tmpPoints);r.centroid(this.tmpPoints,this.tmpCentroid3d);h.screenPointObjectToArray(a.center,this.tmpCentroid2d);r.applyPanPlanar(this.currentCamera,d,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*a.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(this.beginCenterScreen,this.tmpCentroid2d);
e.applyAll(this.view,this.currentCamera,this.constraintOptions);b&&(b=this.planeHorizontal,c=this.rotationValueSmooth.value,f=r.normalizeRotationDelta(a.angle-c),g=.00125*Math.min(Math.max(a.radius,40),120),this.rotationValueSmooth.gain=g,this.rotationValueSmooth.update(c+f),g=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(g,.001*a.timestamp),r.applyRotation(this.currentCamera,d,t.axisAngle.wrapAxisAngle(b,g)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=
e.pixelDistanceToInteractionFactor(Math.abs(a.radius*g)),e.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};f.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();return(a=this.zoomMomentumEstimator.evaluateMomentum())?new p.ZoomPlanarMomentumController(this.view,a,this.beginCenter):(a=this.rotationMomentumEstimator.evaluateMomentum())?new q.RotationMomentumController(this.view,a,this.beginCenter,this.planeHorizontal):
(a=this.panMomentumEstimator.evaluateMomentum())?new c.PanPlanarMomentumController(this.view,a):null};f.prototype.computePlanePoints=function(a,b,c,d){d.length=a.size;var e=this.tmp2d,f=0;a.forEach(function(a){e[0]=a.x;e[1]=a.y;void 0===d[f]&&(d[f]=g.vec3f64.create());r.intersectPlaneFromScreenPoint(b,c,e,d[f]);f+=1});return d};return f}(f.InteractiveController);b.PinchAndPanController=n})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"../../../input/InputHandler"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function a(a,e){var d=b.call(this,!0)||this;d.view=a;d.registerIncoming("pointer-down",e,function(a){return d.view.state.stopActiveCameraController()});return d}l(a,b);return a}(k.InputHandler);b.PointerDownCancelAnimation=n})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],function(n,
b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function a(a,e,d){d=b.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",e,d)||this;d.view=a;d.key=e;return d}l(a,b);a.prototype.activate=function(){this.view.goTo({heading:0})};return a}(k.SingleKey);b.SingleKeyResetHeading=n})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(n,b,l,k){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function a(a,e,d){var f=b.call(this,!0)||this;f.key=e;f.registerIncoming("key-down",d,function(a){return f._handleKeyDown(a)});return f}l(a,b);a.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return a}(k.InputHandler);b.SingleKey=n})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],function(n,b,l,k){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function a(a,e,d){d=b.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",e,d)||this;d.view=a;d.key=e;return d}l(a,b);a.prototype.activate=function(){this.view.goTo({tilt:0})};return a}(k.SingleKey);b.SingleKeyResetTilt=n})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,e){void 0===e&&(e=!1);var c=a.call(this,!0)||this;c.view=b;c.invert=e;c.registerIncoming("vertical-two-finger-drag",function(a){return c.handleTwoFinger(a)});return c}l(b,a);b.prototype.handleTwoFinger=function(a){var b=k.createScreenPointArray(0,a.data.delta*(this.invert?-1:1));switch(a.data.action){case "begin":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
new h.RotateController(this.view,this.view.sceneIntersectionHelper,"center");this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(b);break;case "update":this.cameraController&&this.cameraController.update(b);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}};return b}(a.InputHandler);b.TwoFingerTilt=n})},"esri/views/input/BrowserEventSource":function(){define("require exports ../../core/has ../../core/screenUtils ../../core/libs/pep/pep ./keys ./gamepad/GamepadSource".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});var e=l("trident"),d=l("edge"),f=l("chrome"),c=l("ff"),q=l("safari");n=function(){function b(a,b){var c=this;this.input=b;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._element=a;h.applyLocal(a);a.getAttribute("tabindex")||a.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,
"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=a.style.touchAction;a.style.touchAction="none";this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new g.GamepadSource(a,this.input);this._gamepadSource.onEvent=function(a){return c._callback("gamepad",
a)}}b.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(b){a._releasePointerCaptureSafe(b)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction;this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(b.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"activeEvents",{set:function(a){var b=this,c;for(c in this._active)a&&a.has(c)||(this._element.removeEventListener(p[c],this._active[c]),delete this._active[c]);a&&a.forEach(function(a){if(!b._active[a]&&p[a]){var c=(b._eventHandlers[a]||b._handleDefault).bind(b,a);b._element.addEventListener(p[a],c);b._active[a]=c}});this._gamepadSource.pollingEnabled=a&&a.has("gamepad")},enumerable:!0,configurable:!0});b.prototype.setPointerCapture=function(a,
b){b?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._releasePointerCaptureSafe(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};b.prototype._releasePointerCaptureSafe=function(a){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(a)||this._element.releasePointerCapture(a)}catch(x){}};b.prototype._updateNormalizedPointerLikeEvent=function(a,c){a=k.createScreenPointFromNativeEvent(this._element,a);b.test.disableSubpixelCoordinates&&
(a.x=Math.round(a.x),a.y=Math.round(a.y));c.x=a.x;c.y=a.y;return c};b.prototype._handleKey=function(b,c){var d=a.eventKey(c);d&&"key-up"===b&&this._keyDownState.delete(d);c={native:c,key:d,repeat:d&&this._keyDownState.has(d)};d&&"key-down"===b&&this._keyDownState.add(c.key);this._callback(b,c)};b.prototype._handlePointer=function(a,b){b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons,eventId:this._eventId++});this._callback(a,
b)};b.prototype._handlePointerPreventDefault=function(a,b){var c=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons,eventId:this._eventId++});b.preventDefault();this._callback(a,c)};b.prototype._handleMouseWheel=function(a,b){b.preventDefault();var g=b.deltaY;switch(b.deltaMode){case 0:if(e||d)g=g/document.documentElement.clientHeight*600;break;case 1:g*=30;break;case 2:g*=900}e||d?g*=.7:f||q?g*=.6:c&&(g*=1.375);var h=Math.abs(g);
100<h&&(g=g/h*200/(1+Math.exp(-.02*(h-100))));b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,deltaY:g});this._callback(a,b)};b.prototype._handlePointerCaptureLost=function(a,b){this._activePointerCaptures.delete(b.pointerId);this._handleDefault(a,b)};b.prototype._handleDefault=function(a,b){var c={native:b};b.preventDefault();this._callback(a,c)};b.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};b.test={disableSubpixelCoordinates:!1};return b}();b.BrowserEventSource=
n;var p={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"}})},"esri/core/libs/pep/pep":function(){define(function(){function n(a,b){b=b||Object.create(null);var d=document.createEvent("Event");
d.initEvent(a,b.bubbles||!1,b.cancelable||!1);a=2;for(var e;a<f.length;a++)e=f[a],d[e]=b[e]||c[a];d.buttons=b.buttons||0;a=0;a=b.pressure&&d.buttons?b.pressure:d.buttons?.5:0;d.x=d.clientX;d.y=d.clientY;d.pointerId=b.pointerId||0;d.width=b.width||0;d.height=b.height||0;d.pressure=a;d.tiltX=b.tiltX||0;d.tiltY=b.tiltY||0;d.twist=b.twist||0;d.tangentialPressure=b.tangentialPressure||0;d.pointerType=b.pointerType||"";d.hwTimestamp=b.hwTimestamp||0;d.isPrimary=b.isPrimary||!1;return d}function b(){this.array=
[];this.size=0}function l(a,b,c,d){this.addCallback=a.bind(d);this.removeCallback=b.bind(d);this.changedCallback=c.bind(d);B&&(this.observer=new B(this.mutationWatcher.bind(this)))}function k(a){return"body /shadow-deep/ "+h(a)}function h(a){return'[touch-action\x3d"'+a+'"]'}function a(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; }"}function g(){if(I){D.forEach(function(b){String(b)===b?(K+=h(b)+a(b)+"\n",Q&&(K+=k(b)+a(b)+"\n")):(K+=b.selectors.map(h)+a(b.rule)+"\n",Q&&(K+=b.selectors.map(k)+
a(b.rule)+"\n"))});var b=document.createElement("style");b.textContent=K;document.head.appendChild(b)}}function e(a){if(!w.pointermap.has(a))throw a=Error("NotFoundError"),a.name="NotFoundError",a;}function d(a){for(var b=a.parentNode;b&&b!==a.ownerDocument;)b=b.parentNode;if(!b)throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var f="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),c=[!1,!1,
null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],q=window.Map&&window.Map.prototype.forEach?Map:b;b.prototype={set:function(a,b){if(void 0===b)return this.delete(a);this.has(a)||this.size++;this.array[a]=b},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,b){return this.array.forEach(function(c,d){a.call(b,c,d,this)},this)}};var p="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
r=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],t={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},x="undefined"!==typeof SVGElementInstance,w={pointermap:new q,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,b){var c=b.events;c&&(c.forEach(function(a){b[a]&&(this.eventMap[a]=b[a].bind(b))},this),this.eventSources[a]=b,this.eventSourceList.push(b))},register:function(a){for(var b=
this.eventSourceList.length,c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.register.call(d,a)},unregister:function(a){for(var b=this.eventSourceList.length,c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.unregister.call(d,a)},contains:function(a,b){try{return a.contains(b)}catch(oa){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var b=a.type;(b=this.eventMap&&
this.eventMap[b])&&b(a);a._handledByPE=!0}},listen:function(a,b){b.forEach(function(b){this.addEvent(a,b)},this)},unlisten:function(a,b){b.forEach(function(b){this.removeEvent(a,b)},this)},addEvent:function(a,b){a.addEventListener(b,this.boundHandler)},removeEvent:function(a,b){a.removeEventListener(b,this.boundHandler)},makeEvent:function(a,b){this.captureInfo[b.pointerId]&&(b.relatedTarget=null);a=new n(a,b);b.preventDefault&&(a.preventDefault=b.preventDefault);a._target=a._target||b.target;return a},
fireEvent:function(a,b){a=this.makeEvent(a,b);return this.dispatchEvent(a)},cloneEvent:function(a){for(var b=Object.create(null),c,d=0;d<p.length;d++)c=p[d],b[c]=a[c]||r[d],x&&("target"===c||"relatedTarget"===c)&&b[c]instanceof SVGElementInstance&&(b[c]=b[c].correspondingUseElement);a.preventDefault&&(b.preventDefault=function(){a.preventDefault()});return b},getTarget:function(a){var b=this.captureInfo[a.pointerId];if(!b)return a._target;if(a._target===b||!(a.type in t))return b},propagate:function(a,
b,c){for(var d=a.target,e=[];null!=d&&d!==document&&!d.contains(a.relatedTarget);)if(e.push(d),d=d.parentNode,!d)return;c&&e.reverse();e.forEach(function(c){a.target=c;b.call(this,a)},this)},setCapture:function(a,b,c){this.captureInfo[a]&&this.releaseCapture(a,c);this.captureInfo[a]=b;this.implicitRelease=this.releaseCapture.bind(this,a,c);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);var d=new n("gotpointercapture");d.pointerId=
a;d._target=b;c||this.asyncDispatchEvent(d)},releaseCapture:function(a,b){var c=this.captureInfo[a];if(c){this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);var d=new n("lostpointercapture");d.pointerId=a;d._target=c;b||this.asyncDispatchEvent(d)}},dispatchEvent:function(a){var b=this.getTarget(a);if(b)return b.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,
a))}};w.boundHandler=w.eventHandler.bind(w);var u={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var b=a.olderShadowRoot;!b&&(a=a.querySelector("shadow"))&&(b=a.olderShadowRoot);return b},allShadows:function(a){var b=[];for(a=this.shadow(a);a;)b.push(a),a=this.olderShadow(a);return b},searchRoot:function(a,b,c){if(a){var d=a.elementFromPoint(b,
c),e;for(e=this.targetingShadow(d);e;){if(a=e.elementFromPoint(b,c))return d=this.targetingShadow(a),this.searchRoot(d,b,c)||a;e=this.olderShadow(e)}return d}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var b=a.clientX,c=a.clientY;a=this.owner(a.target);a.elementFromPoint(b,c)||(a=document);return this.searchRoot(a,b,c)}},y=Array.prototype.forEach.call.bind(Array.prototype.forEach),
m=Array.prototype.map.call.bind(Array.prototype.map),v=Array.prototype.slice.call.bind(Array.prototype.slice),z=Array.prototype.filter.call.bind(Array.prototype.filter),B=window.MutationObserver||window.WebKitMutationObserver,C={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};l.prototype={watchSubtree:function(a){this.observer&&u.canTarget(a)&&this.observer.observe(a,C)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?
this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){y(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,b){this.changedCallback(a,b)},concatLists:function(a,b){return a.concat(v(b))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===
document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var b=m(a,this.findElements,this);b.push(z(a,this.isElement));return b.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,
this)):"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var D=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],K="",I=window.PointerEvent||window.MSPointerEvent,Q=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,J=w.pointermap,N=[1,4,2,8,16],L=!1;try{L=1===(new MouseEvent("test",{buttons:1})).buttons}catch(la){}var M={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){w.listen(a,
this.events)},unregister:function(a){w.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var b=this.lastTouches,c=a.clientX;a=a.clientY;for(var d=0,e=b.length,f;d<e&&(f=b[d]);d++){var g=Math.abs(a-f.y);if(25>=Math.abs(c-f.x)&&25>=g)return!0}},prepareEvent:function(a){var b=w.cloneEvent(a),c=b.preventDefault;b.preventDefault=function(){a.preventDefault();c()};b.pointerId=this.POINTER_ID;b.isPrimary=!0;b.pointerType=this.POINTER_TYPE;return b},prepareButtonsForMove:function(a,
b){var c=J.get(this.POINTER_ID);a.buttons=0!==b.which&&c?c.buttons:0;b.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=J.get(this.POINTER_ID),c=this.prepareEvent(a);L||(c.buttons=N[c.button],b&&(c.buttons|=b.buttons),a.buttons=c.buttons);J.set(this.POINTER_ID,a);b&&0!==b.buttons?w.move(c):w.down(c)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);L||this.prepareButtonsForMove(b,a);b.button=-1;J.set(this.POINTER_ID,a);w.move(b)}},
mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=J.get(this.POINTER_ID),c=this.prepareEvent(a);if(!L){var d=N[c.button];c.buttons=b?b.buttons&~d:0;a.buttons=c.buttons}J.set(this.POINTER_ID,a);c.buttons&=~N[c.button];0===c.buttons?w.up(c):w.move(c)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);L||this.prepareButtonsForMove(b,a);b.button=-1;J.set(this.POINTER_ID,a);w.enterOver(b)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=
this.prepareEvent(a);L||this.prepareButtonsForMove(b,a);b.button=-1;w.leaveOut(b)}},cancel:function(a){a=this.prepareEvent(a);w.cancel(a);this.deactivateMouse()},deactivateMouse:function(){J.delete(this.POINTER_ID)}},R=w.captureInfo,S=u.findTarget.bind(u),T=u.allShadows.bind(u),U=w.pointermap,Y,X={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){Y.enableOnSubtree(a)},unregister:function(){},elementAdded:function(a){var b=a.getAttribute("touch-action"),c=this.touchActionToScrollType(b);
c&&(a._scrollType=c,w.listen(a,this.events),T(a).forEach(function(a){a._scrollType=c;w.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;w.unlisten(a,this.events);T(a).forEach(function(a){a._scrollType=void 0;w.unlisten(a,this.events)},this)},elementChanged:function(a,b){var c=a.getAttribute("touch-action"),d=this.touchActionToScrollType(c);b=this.touchActionToScrollType(b);d&&b?(a._scrollType=d,T(a).forEach(function(a){a._scrollType=d},this)):b?this.elementRemoved(a):
d&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var b=this.scrollTypes;if("none"===a)return"none";if(a===b.XSCROLLER)return"X";if(a===b.YSCROLLER)return"Y";if(b.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===U.size||1===U.size&&U.has(1))this.firstTouch=
a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var b=0;if("touchstart"===a||"touchmove"===a)b=
1;return b},touchToPointer:function(a){var b=this.currentTouchEvent,c=w.cloneEvent(a),d=c.pointerId=a.identifier+2;c.target=R[d]||S(c);c.bubbles=!0;c.cancelable=!0;c.detail=this.clickCount;c.button=0;c.buttons=this.typeToButtons(b.type);c.width=2*(a.radiusX||a.webkitRadiusX||0);c.height=2*(a.radiusY||a.webkitRadiusY||0);c.pressure=a.force||a.webkitForce||.5;c.isPrimary=this.isPrimaryTouch(a);c.pointerType=this.POINTER_TYPE;c.altKey=b.altKey;c.ctrlKey=b.ctrlKey;c.metaKey=b.metaKey;c.shiftKey=b.shiftKey;
var e=this;c.preventDefault=function(){e.scrolling=!1;e.firstXY=null;b.preventDefault()};return c},processTouches:function(a,b){var c=a.changedTouches;this.currentTouchEvent=a;a=0;for(var d;a<c.length;a++)d=c[a],b.call(this,this.touchToPointer(d))},shouldScroll:function(a){if(this.firstXY){var b;b=a.currentTarget._scrollType;if("none"===b)b=!1;else if("XY"===b)b=!0;else{a=a.changedTouches[0];var c="Y"===b?"X":"Y";b=Math.abs(a["client"+b]-this.firstXY[b])>=Math.abs(a["client"+c]-this.firstXY[c])}this.firstXY=
null;return b}},findTouch:function(a,b){for(var c=0,d=a.length,e;c<d&&(e=a[c]);c++)if(e.identifier===b)return!0},vacuumTouches:function(a){var b=a.touches;if(U.size>=b.length){var c=[];U.forEach(function(a,d){1===d||this.findTouch(b,d-2)||c.push(a.out)},this);c.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){U.set(a.pointerId,
{target:a.target,out:a,outTarget:a.target});w.enterOver(a);w.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var b=U.get(a.pointerId);if(b){var c=b.out,d=b.outTarget;w.move(a);c&&d!==a.target&&(c.relatedTarget=a.target,a.relatedTarget=d,c.target=d,a.target?(w.leaveOut(c),w.enterOver(a)):(a.target=d,a.relatedTarget=null,this.cancelOut(a)));b.out=a;b.outTarget=
a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||(w.up(a),w.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){w.cancel(a);w.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){U.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var b=M.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},
b.push(a),b=function(a,b){b=a.indexOf(b);-1<b&&a.splice(b,1)}.bind(null,b,a),setTimeout(b,2500))}};Y=new l(X.elementAdded,X.elementRemoved,X.elementChanged,X);var P=w.pointermap,V=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,Z={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){w.listen(a,this.events)},unregister:function(a){w.unlisten(a,this.events)},
POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var b=a;V&&(b=w.cloneEvent(a),b.pointerType=this.POINTER_TYPES[a.pointerType]);return b},cleanup:function(a){P.delete(a)},MSPointerDown:function(a){P.set(a.pointerId,a);a=this.prepareEvent(a);w.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);w.move(a)},MSPointerUp:function(a){var b=this.prepareEvent(a);w.up(b);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);w.leaveOut(a)},MSPointerOver:function(a){a=
this.prepareEvent(a);w.enterOver(a)},MSPointerCancel:function(a){var b=this.prepareEvent(a);w.cancel(b);this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){a=w.makeEvent("lostpointercapture",a);w.dispatchEvent(a)},MSGotPointerCapture:function(a){a=w.makeEvent("gotpointercapture",a);w.dispatchEvent(a)}},ca,da,F;window.navigator.msPointerEnabled?(ca=function(a){e(a);d(this);0!==w.pointermap.get(a).buttons&&(w.setCapture(a,this,!0),this.msSetPointerCapture(a))},da=function(a){e(a);w.releaseCapture(a,
!0);this.msReleasePointerCapture(a)}):(ca=function(a){e(a);d(this);0!==w.pointermap.get(a).buttons&&w.setCapture(a,this)},da=function(a){e(a);w.releaseCapture(a)});F=function(a){return!!w.captureInfo[a]};var ea=window.PointerEvent||window.MSPointerEvent;return{dispatcher:w,Installer:l,PointerEvent:n,PointerMap:q,targetFinding:u,applyGlobal:function(){g();window.PointerEvent||(window.PointerEvent=n,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,
enumerable:!0}),w.registerSource("ms",Z)):(Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),w.registerSource("mouse",M),void 0!==window.ontouchstart&&w.registerSource("touch",X)),w.register(document));window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:ca},releasePointerCapture:{value:da},hasPointerCapture:{value:F}})},applyLocal:function(a){ea||(window.PointerEvent||(window.navigator.msPointerEnabled?
w.registerSource("ms",Z):(w.registerSource("mouse",M),void 0!==window.ontouchstart&&w.registerSource("touch",X)),w.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=ca.bind(a),a.releasePointerCapture=da.bind(a),a.hasPointerCapture=F.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action","none"))}}})},"esri/views/input/keys":function(){define(["require","exports","../../core/events","../../core/has"],function(n,b,l,k){Object.defineProperty(b,
"__esModule",{value:!0});b.primaryKey=k("mac")?"Meta":"Ctrl";var h={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(n=48;58>n;n++)h[n]=String.fromCharCode(n);for(n=1;25>n;n++)h[111+n]="F"+n;for(n=65;91>n;n++)h[n]=[String.fromCharCode(n+32),String.fromCharCode(n)];b.eventKey=function(a){if(void 0!==a.key)return l.eventKey(a);var b=h[a.keyCode];return Array.isArray(b)?a.shiftKey?
b[1]:b[0]:b};b.isSystemModifier=function(a){switch(a){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}return!1}})},"esri/views/input/gamepad/GamepadSource":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/scheduling ./GamepadInputDevice ./GamepadState".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,d){var e=this;this.element=b;this.input=d;this.handleGamepadConnectedEvent=function(a){e.handleGamepadConnected(a.gamepad)};
this.handleGamepadDisconnectedEvent=function(b){b=b.gamepad;var c=e.inputDevices[b.index];c&&(e.emitGamepadEvent(b,a.extractState(c),!1),e.inputDevices[b.index]=void 0,e.latestUpdate[b.index]=void 0,e.input.gamepad.devices.remove(c))};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(function(a){return e.handleGamepadConnected(a)}),window.addEventListener("gamepadconnected",this.handleGamepadConnectedEvent),
window.addEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent)}b.prototype.destroy=function(){this.pollingEnabled=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent))};Object.defineProperty(b.prototype,"onEvent",{set:function(a){this.callback=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"pollingEnabled",{set:function(a){this.supported&&
(a?this.startPolling():this.stopPolling())},enumerable:!0,configurable:!0});b.prototype.handleGamepadConnected=function(a){var b=new h(a);"unknown"!==b.deviceType&&(this.inputDevices[a.index]=b,this.input.gamepad.devices.add(b))};b.prototype.startPolling=function(){var a=this;null==this.frameTask&&(this.frameTask=k.addFrameTask({update:function(){return a.readGamepadState()}}))};b.prototype.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=
[])};b.prototype.readGamepadState=function(){var b=this,d=document.hasFocus(),f=this.element.contains(document.activeElement),c="document"===this.input.gamepad.enabledFocusMode&&!d||"view"===this.input.gamepad.enabledFocusMode&&!f;this.forEachGamepad(function(d){var e=b.inputDevices[d.index];if(e){var f=b.latestUpdate[d.index],e=a.extractState(e),g=c||a.stateIdle(e);f&&(f.timestamp===d.timestamp||!f.active&&g||a.stateEqual(f.state,e))||b.emitGamepadEvent(d,e,!g)}})};b.prototype.forEachGamepad=function(a){for(var b=
window.navigator.getGamepads(),e=0;e<b.length;e++){var c=b[e];this.validate(c)&&a(c)}};b.prototype.emitGamepadEvent=function(a,b,f){var c=this.latestUpdate[a.index];if((c=c&&c.active)||f)this.latestUpdate[a.index]={timestamp:a.timestamp,state:b,active:f},this.callback&&this.callback({device:this.inputDevices[a.index],state:b,action:!c&&f?"start":c&&f?"update":"end"})};b.prototype.validate=function(a){if(!a||!a.connected)return!1;for(var b=0;b<a.axes.length;b++)if(isNaN(a.axes[b]))return!1;return!0};
return b}();b.GamepadSource=n})},"esri/views/input/gamepad/GamepadState":function(){define(["require","exports","../../../core/mathUtils"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.extractState=function(b){var h=b.native;return{buttons:h.buttons.map(function(a){return a.pressed?a.value?a.value:1:0}),axes:h.axes.map(function(a){var g=b.axisThreshold,e=Math.abs(a);a=e<g?0:l.sign(a)*(e-g)/(1-g);return a})}};b.stateEqual=function(b,h){if(b.axes.length!==h.axes.length||b.buttons.length!==
h.buttons.length)return!1;for(var a=0;a<b.axes.length;a++)if(b.axes[a]!==h.axes[a])return!1;for(a=0;a<b.buttons.length;a++)if(b.buttons[a]!==h.buttons[a])return!1;return!0};b.stateIdle=function(b){for(var h=0;h<b.axes.length;h++)if(0!==b.axes[h])return!1;for(h=0;h<b.buttons.length;h++)if(0!==b.buttons[h])return!1;return!0}})},"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Logger ../../core/now ../../core/accessorSupport/decorators ./keys ./handlers/LatestPointerType".split(" "),
function(n,b,l,k,h,a,g,e,d,f){Object.defineProperty(b,"__esModule",{value:!0});var c=a.getLogger("esri.views.input.InputManager");n=function(a){function b(b,c){b=a.call(this)||this;b._pointerCaptures=new Map;b._nameToGroup={};b._handlers=[];b._currentPropagation=null;b._sourceEvents=new Set;b._keyModifiers=new Set;b._activeKeyModifiers=new Set;b.primaryKey=d.primaryKey;b.latestPointerType="mouse";b._installRecognizers();return b}l(b,a);b.prototype.normalizeCtorArgs=function(a,b){this._browserEvents=
a;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=b;return{}};b.prototype.destroy=function(){for(var a=0,b=Object.keys(this._nameToGroup);a<b.length;a++)this.uninstallHandlers(b[a]);this._browserEvents=null};Object.defineProperty(b.prototype,"hasPendingInputs",{get:function(){return this._handlers.some(function(a){return a.handler.hasPendingInputs})},enumerable:!0,configurable:!0});b.prototype.installHandlers=function(a,b){var d=this;if(this._nameToGroup[a])c.error("There is already an InputHandler group registered under the name `"+
a+"`");else if(0===b.length)c.error("Can't register a group of zero handlers");else{var e={name:a,handlers:b.map(function(a,b){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};this._nameToGroup[a]=e;a=function(a){var b=e.handlers[a];f._handlers.push(b);b.handler.onInstall({updateDependencies:function(){d.updateDependencies()},emit:function(a,c,e,f){d._emitInputEvent(b.priorityIndex,a,c,e,f)},setPointerCapture:function(a,c){d._setPointerCapture(e,
b,a,c)},setEventCallback:function(a){b.eventCallback=a},setUninstallCallback:function(a){b.uninstallCallback=a},refreshHasPendingInputs:function(){d.notifyChange("hasPendingInputs")}})};var f=this;for(b=e.handlers.length-1;0<=b;b--)a(b);this.updateDependencies()}};b.prototype.uninstallHandlers=function(a){var b=this._nameToGroup[a];b?(b.handlers.forEach(function(a){a.removed=!0;a.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=
!0:this._garbageCollectRemovedHandlers()):c.error("There is no InputHandler group registered under the name `"+a+"`")};b.prototype.hasHandlers=function(a){return void 0!==this._nameToGroup[a]};b.prototype.updateDependencies=function(){var a=new Set,b=new Set;this._handlersPriority=[];for(var c=this._handlers.length-1;0<=c;c--){var e=this._handlers[c];e.priorityIndex=c;this._handlersPriority.push(e)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(c=this._handlersPriority.length-
1;0<=c;c--){e=this._handlersPriority[c];e.priorityIndex=c;var f=e.handler.hasSideEffects;if(!f)for(var g=0,h=e.handler.outgoingEventTypes;g<h.length;g++)if(a.has(h[g])){f=!0;break}if(f)for(g=0,h=e.handler.incomingEventMatches;g<h.length;g++){var k=h[g];a.add(k.eventType);for(var p=0,k=k.keyModifiers;p<k.length;p++){var r=k[p];d.isSystemModifier(r)||b.add(r)}}e.active=f}this._sourceEvents=a;this._keyModifiers=b;0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&
(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};b.prototype._setLatestPointerType=function(a){this._set("latestPointerType",a)};b.prototype._onEventReceived=function(a,b){"pointer-capture-lost"===a&&this._pointerCaptures.delete(b.native.pointerId);this._updateKeyModifiers(a,b);this._emitInputEventFromSource(a,b,b.native?b.native.timestamp:void 0)};b.prototype._updateKeyModifiers=function(a,b){var c=this;
if(b){var d=!1,e=function(){if(!d){var a=new Set;c._activeKeyModifiers.forEach(function(b){a.add(b)});c._activeKeyModifiers=a;d=!0}},f=function(a,b){b&&!c._activeKeyModifiers.has(a)?(e(),c._activeKeyModifiers.add(a)):!b&&c._activeKeyModifiers.has(a)&&(e(),c._activeKeyModifiers.delete(a))};if("key-down"===a||"key-up"===a){var g=b.key;this._keyModifiers.has(g)&&f(g,"key-down"===a)}a=b.native;f("Alt",!(!a||!a.altKey));f("Ctrl",!(!a||!a.ctrlKey));f("Shift",!(!a||!a.shiftKey));f("Meta",!(!a||!a.metaKey));
f("Primary",this._activeKeyModifiers.has(this.primaryKey))}};b.prototype._installRecognizers=function(){var a=this;this._latestPointerTypeHandler=new f.LatestPointerType(function(b){return a._setLatestPointerType(b)});0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};b.prototype._setPointerCapture=function(a,b,c,d){a=a.name+"-"+b.priorityIndex;b=this._pointerCaptures.get(c.pointerId)||new Set;
this._pointerCaptures.set(c.pointerId,b);d?(b.add(a),1===b.size&&this._browserEvents&&this._browserEvents.setPointerCapture(c,!0)):b.has(a)&&(b.delete(a),0===b.size&&(this._pointerCaptures.delete(c.pointerId),this._browserEvents&&this._browserEvents.setPointerCapture(c,!1)))};b.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});this.updateDependencies()};b.prototype._emitInputEventFromSource=function(a,b,c){this._emitInputEvent(0,
a,b,c)};b.prototype._emitInputEvent=function(a,b,c,d,e){d=void 0!==d?d:this._currentPropagation?this._currentPropagation.timestamp:g();b=new q(b,c,d,e||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(b):this._doNewPropagation(a,b)};b.prototype._doNewPropagation=function(a,b){for(a=this._currentPropagation={events:[b],addedEvents:[],currentHandler:this._handlersPriority[a],needsHandlerGarbageCollect:!1,timestamp:b.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=
!0;else{b=a.events;var c=[];a.addedEvents=[];for(var d=0;d<b.length;d++){var e=b[d];a.currentHandler.active&&a.currentHandler.eventCallback(e);e.shouldStopPropagation()||c.push(e)}a.events=c.concat(a.addedEvents)}a.currentHandler=this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=null};b.prototype._compareHandlerPriority=function(a,b){if(a.handler.hasSideEffects!==b.handler.hasSideEffects)return a.handler.hasSideEffects?
1:-1;for(var c=0,d=a.handler.incomingEventMatches;c<d.length;c++)for(var e=d[c],f=function(a){if(e.eventType!==a.eventType)return"continue";var b=e.keyModifiers.filter(function(b){return-1!==a.keyModifiers.indexOf(b)});if(b.length===e.keyModifiers.length!==(b.length===a.keyModifiers.length))return{value:e.keyModifiers.length>a.keyModifiers.length?-1:1}},g=0,h=b.handler.incomingEventMatches;g<h.length;g++){var k=f(h[g]);if("object"===typeof k)return k.value}return a.priorityIndex>b.priorityIndex?-1:
1};b.prototype._sortHandlersPriority=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e=0;e<b.length&&0<=this._compareHandlerPriority(d,b[e]);)e++;b.splice(e,0,d)}return b};Object.defineProperty(b.prototype,"debug",{get:function(){var a=this,b=function(b){var c=a._setPointerCapture;a._setPointerCapture=function(){};b();a._setPointerCapture=c};return{injectEvent:function(c,d){b(function(){a._onEventReceived(c,d)})},disablePointerCapture:b}},enumerable:!0,configurable:!0});k([e.property({readOnly:!0})],
b.prototype,"hasPendingInputs",null);k([e.property({readOnly:!0})],b.prototype,"latestPointerType",void 0);return b=k([e.subclass("esri.views.input.InputManager")],b)}(e.declared(h));b.InputManager=n;var q=function(){function a(a,b,c,d){this.type=a;this.data=b;this.timestamp=c;this.modifiers=d;this._stopPropagation=!1}a.prototype.stopPropagation=function(){this._stopPropagation=!0};a.prototype.shouldStopPropagation=function(){return this._stopPropagation};return a}()})},"esri/views/input/handlers/LatestPointerType":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function a(a){var e=b.call(this,!0)||this;e._onChange=a;e._value="mouse";e.registerIncoming("pointer-down",function(a){e._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});e._moveHandler=e.registerIncoming("pointer-move",function(a){e._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});e._moveHandler.pause();return e}l(a,b);
a.prototype._setValue=function(a){a!==this._value&&("touch"===a?this._moveHandler.resume():this._moveHandler.pause(),this._value=a,this._onChange(a))};return a}(k.InputHandler);b.LatestPointerType=n})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function a(){var a=b.call(this,!0)||this;a.registerIncoming("context-menu",
function(a){a.data.native.preventDefault()});return a}l(a,b);return a}(k.InputHandler);b.PreventContextMenu=n;b.default=n})},"esri/views/input/recognizers/Drag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/screenUtils ../InputHandler ./support".split(" "),function(n,b,l,k,h,a){function g(b){var c=[];b.forEach(function(a){c.push(k.createScreenPoint(a.event.x,a.event.y))});return a.fitCircleLSQ(c)}function e(a){var b=g(a),c=0;a.forEach(function(a){for(var d=
f(a,b),d=d-a.lastAngle;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=a.lastAngle+d;a.lastAngle=d;c+=d-a.initialAngle});c/=a.size||1;return{angle:c,radius:b.radius,center:b.center}}function d(a){var b=new Map;a.forEach(function(a,c){return b.set(c,a.event)});return b}function f(a,b){a=a.event;return Math.atan2(a.y-b.center.y,a.x-b.center.x)}Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=a.call(this,!1)||this;b.startStateModifiers=new Set;b.activePointerMap=
new Map;b.isDragging=!1;b.drag=b.registerOutgoing("drag");b.registerIncoming("pointer-drag",b.handlePointerDrag.bind(b));b.registerIncoming("pointer-up",b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-capture-lost",b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-cancel",b.handlePointerUpAndPointerLost.bind(b));return b}l(b,a);b.prototype.createPayload=function(a,b,c,e){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:b.buttons,
timestamp:e,pointers:d(this.activePointerMap),pointer:b,angle:c.angle,radius:c.radius,center:c.center}};b.prototype.addPointer=function(a){var b=a.native.pointerId,c=e(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};this.activePointerMap.set(b,a);b=f(a,g(this.activePointerMap));a.initialAngle=b;a.lastAngle=b;this.updatePointerAngles(c)};b.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var b=this.activePointerMap.get(a.native.pointerId);b?b.event=a:this.addPointer(a)}};
b.prototype.removePointer=function(a){var b=e(this.activePointerMap).angle;this.activePointerMap.delete(a);this.updatePointerAngles(b)};b.prototype.updatePointerAngles=function(a){var b=e(this.activePointerMap);this.activePointerMap.forEach(function(c){c.initialAngle=f(c,b)-a;c.lastAngle=f(c,b)-a})};b.prototype.emitEvent=function(a,b,c){var d=e(this.activePointerMap);this.drag.emit(this.createPayload(a,b,d,c),void 0,this.startStateModifiers)};b.prototype.handlePointerUpAndPointerLost=function(a){var b=
a.data.native.pointerId,c=a.timestamp;this.activePointerMap.get(b)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),this.emitEvent("end",a.data,c),this.isDragging=!1,this.removePointer(b)):(this.removePointer(b),this.emitEvent("removed",a.data,a.timestamp)))};b.prototype.handlePointerDrag=function(a){var b=a.data,c=b.currentEvent,d=a.timestamp;switch(b.action){case "start":case "update":this.isDragging?this.activePointerMap.has(c.native.pointerId)?(this.updatePointer(c),this.emitEvent("update",
c,d)):(this.addPointer(c),this.emitEvent("added",c,d)):(this.updatePointer(c),this.pointerType=a.data.startEvent.pointerType,this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.emitEvent("start",c,d))}};return b}(h.InputHandler);b.Drag=n;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(b.Button||(b.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require",
"exports","../../../core/screenUtils"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.manhattanDistance=function(b,h){return Math.abs(h.x-b.x)+Math.abs(h.y-b.y)};b.euclideanDistance=function(b,h){var a=h.x-b.x;b=h.y-b.y;return Math.sqrt(a*a+b*b)};b.fitCircleLSQ=function(b,h){h?(h.radius=0,h.center.x=0,h.center.y=0):h={radius:0,center:l.createScreenPoint()};if(0===b.length)return h;if(1===b.length)return h.center.x=b[0].x,h.center.y=b[0].y,h;if(2===b.length){var a=b[0];b=b[1];var g=
[b.x-a.x,b.y-a.y],e=g[0],g=g[1];h.radius=Math.sqrt(e*e+g*g)/2;h.center.x=(a.x+b.x)/2;h.center.y=(a.y+b.y)/2;return h}for(var d=0,f=0,c=0;c<b.length;c++)d+=b[c].x,f+=b[c].y;for(var d=d/b.length,f=f/b.length,k=b.map(function(a){return a.x-d}),p=b.map(function(a){return a.y-f}),r=a=h=0,t=0,x=e=0,c=g=0;c<k.length;c++){var w=k[c],u=p[c],y=w*w,m=u*u;h+=y;a+=m;r+=w*u;t+=y*w;e+=m*u;x+=w*m;g+=u*y}c=h;k=r;p=a;t=.5*(t+x);e=.5*(e+g);g=c*p-r*k;x=(t*p-e*k)/g;e=(c*e-r*t)/g;g=l.createScreenPoint(x+d,e+f);return{radius:Math.sqrt(x*
x+e*e+(h+a)/b.length),center:g}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../InputHandler ./support".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};n=function(g){function e(a,e,c,h,p){void 0===a&&(a=b.DefaultParameters.maximumClickDelay);void 0===
e&&(e=b.DefaultParameters.movementUntilMouseDrag);void 0===c&&(c=b.DefaultParameters.movementUntilTouchDrag);void 0===h&&(h=b.DefaultParameters.holdDelay);void 0===p&&(p=k.default);var d=g.call(this,!1)||this;d.maximumClickDelay=a;d.movementUntilMouseDrag=e;d.movementUntilTouchDrag=c;d.holdDelay=h;d._clock=p;d._pointerState=new Map;d._pointerDrag=d.registerOutgoing("pointer-drag");d._immediateClick=d.registerOutgoing("immediate-click");d._pointerHold=d.registerOutgoing("hold");d.registerIncoming("pointer-down",
d._handlePointerDown.bind(d));d.registerIncoming("pointer-up",function(a){d._handlePointerLoss(a,"pointer-up")});d.registerIncoming("pointer-capture-lost",function(a){d._handlePointerLoss(a,"pointer-capture-lost")});d.registerIncoming("pointer-cancel",function(a){d._handlePointerLoss(a,"pointer-cancel")});d._moveHandle=d.registerIncoming("pointer-move",d._handlePointerMove.bind(d));d._moveHandle.pause();return d}l(e,g);e.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=
a.holdTimeout&&(a.holdTimeout.remove(),a.holdTimeout=null)});g.prototype.onUninstall.call(this)};e.prototype._handlePointerDown=function(a){var b=this,c=a.data,d=c.native.pointerId,e=null;0===this._pointerState.size&&(e=this._clock.setTimeout(function(){var c=b._pointerState.get(d);c&&(c.isDragging||(b._pointerHold.emit(c.previousEvent,void 0,a.modifiers),c.holdEmitted=!0),c.holdTimeout=null)},this.holdDelay));e={startEvent:c,previousEvent:c,startTimestamp:a.timestamp,isDragging:!1,downButton:c.native.button,
holdTimeout:e,modifiers:new Set};this._pointerState.set(d,e);this.startCapturingPointer(c.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(a)};e.prototype._createPointerDragData=function(a,b,c){return{action:a,startEvent:b.startEvent,previousEvent:b.previousEvent,currentEvent:c}};e.prototype._handlePointerMove=function(b){var d=b.data,c=this._pointerState.get(d.native.pointerId);c&&(c.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",c,d),void 0,
c.modifiers):a.euclideanDistance(d,c.startEvent)>("touch"===d.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&this.startDragging(b),c.previousEvent=d)};e.prototype.startDragging=function(a){var b=this,c=a.data,d=c.native.pointerId;this._pointerState.forEach(function(e){null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null);e.isDragging||(e.modifiers=a.modifiers,e.isDragging=!0,d===e.startEvent.native.pointerId?b._pointerDrag.emit(b._createPointerDragData("start",
e,c)):b._pointerDrag.emit(b._createPointerDragData("start",e,e.previousEvent),a.timestamp))})};e.prototype._handlePointerLoss=function(a,b){var c=a.data,d=c.native.pointerId,e=this._pointerState.get(d);e&&(null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null),e.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",e,"pointer-up"===b?c:e.previousEvent),void 0,e.modifiers):"pointer-up"===b&&e.downButton===c.native.button&&a.timestamp-e.startTimestamp<=this.maximumClickDelay&&
!e.holdEmitted&&this._immediateClick.emit(c),this._pointerState.delete(d),this.stopCapturingPointer(c.native),0===this._pointerState.size&&this._moveHandle.pause())};return e}(h.InputHandler);b.PointerClickHoldAndDrag=n})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../../../core/iteratorUtils ../InputHandler ./support".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});
b.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};n=function(a){function d(d,c,e,g,h){void 0===d&&(d=b.DefaultParameters.maximumDoubleClickDelay);void 0===c&&(c=b.DefaultParameters.maximumDoubleClickDistance);void 0===e&&(e=b.DefaultParameters.maximumDoubleTouchDelay);void 0===g&&(g=b.DefaultParameters.maximumDoubleTouchDistance);void 0===h&&(h=k.default);var f=a.call(this,!1)||this;f.maximumDoubleClickDelay=d;
f.maximumDoubleClickDistance=c;f.maximumDoubleTouchDelay=e;f.maximumDoubleTouchDistance=g;f._clock=h;f._pointerState=new Map;f._click=f.registerOutgoing("click");f._doubleClick=f.registerOutgoing("double-click");f.registerIncoming("immediate-click",f._handleImmediateClick.bind(f));f.registerIncoming("pointer-drag",f._handlePointerDrag.bind(f));f.registerIncoming("drag",f._handleDrag.bind(f));return f}l(d,a);d.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=a.doubleClickTimeout&&
(a.doubleClickTimeout.remove(),a.doubleClickTimeout=null)})};Object.defineProperty(d.prototype,"hasPendingInputs",{get:function(){return!h.everyMap(this._pointerState,function(a){return null==a.doubleClickTimeout})},enumerable:!0,configurable:!0});d.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};d.prototype._handleImmediateClick=function(a){var b=a.data,d=this._pointerId(b),e=this._pointerState.get(d);if(e){var f="touch"===b.native.pointerType?
this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;g.manhattanDistance(e.event.data,b)>f?(this._clearDoubleClickTimeout(d,!0),this._startClick(a)):(this._clearDoubleClickTimeout(d,!1),this._doubleClick.emit(b,void 0,e.event.modifiers))}else this._startClick(a)};d.prototype._startClick=function(a){var b=this,d=this._pointerId(a.data);this._pointerState.set(d,{event:a,doubleClickTimeout:this._clock.setTimeout(function(){return b._doubleClickTimeoutExceeded(d)},"touch"===a.data.native.pointerType?
this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};d.prototype._handlePointerDrag=function(a){a=this._pointerId(a.data.currentEvent);this._clearDoubleClickTimeout(a,!0)};d.prototype._handleDrag=function(a){a=this._pointerId(a.data.pointer);this._clearDoubleClickTimeout(a,!0)};d.prototype._clearDoubleClickTimeout=function(a,b){var c=this._pointerState.get(a);c&&(c.doubleClickTimeout.remove(),c.doubleClickTimeout=null,b&&this._doubleClickTimeoutExceeded(a),
this._pointerState.delete(a),this.refreshHasPendingInputs())};d.prototype._doubleClickTimeoutExceeded=function(a){var b=this._pointerState.get(a);this._click.emit(b.event.data,void 0,b.event.modifiers);b.doubleClickTimeout=null;this._pointerState.delete(a);this.refreshHasPendingInputs()};return d}(a.InputHandler);b.SingleAndDoubleClick=n})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../DragEventSeparator","../InputHandler"],
function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,d){void 0===b&&(b=20);void 0===d&&(d=40);var e=a.call(this,!1)||this;e._threshold=b;e._maxDelta=d;e.state="ready";e.emittedArtificalEnd2=!1;e._vertical=e.registerOutgoing("vertical-two-finger-drag");e._artificalDrag=e.registerOutgoing("drag");e.dragEventSeparator=new k.DragEventSeparator({start:function(a,b){return e.observeStart(a,b)},update:function(a,b,d){return e.observeUpdate(a,b,d)},end:function(a,
b){return e.observeEnd(a,b)}});e.registerIncoming("drag",function(a){return e.dragEventSeparator.handle(a)});return e}l(b,a);Object.defineProperty(b.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});b.prototype.observeStart=function(a,b){1===a&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,
pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),b.stopPropagation());this.state=2===a?"ready":"failed"};b.prototype.observeUpdate=function(a,b,f){"failed"!==this.state&&2===a&&("active"===this.state?(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"update"}),b.stopPropagation()):this.checkMovementWithinLimits(b.data,f.data)?this.checkVerticalThresholdReached(b.data,f.data)&&(this.state="active",this.emittedArtificalEnd2=
!0,this._thresholdReachedCenter=b.data.center,this._artificalDrag.emit({action:"end",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),b.stopPropagation()):this.state="failed")};b.prototype.observeEnd=function(a,b){"active"===this.state&&
(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",b.stopPropagation())};b.prototype.checkMovementWithinLimits=function(a,b){var d=-Infinity,c=Infinity,e=-Infinity,g=Infinity;b.pointers.forEach(function(a){d=Math.max(d,a.x);c=Math.min(c,a.x);e=Math.max(e,a.y);g=Math.min(g,a.y)});var h=-Infinity,k=Infinity,x=-Infinity,w=Infinity;a.pointers.forEach(function(a){h=Math.max(h,a.x);k=Math.min(k,a.x);x=Math.max(x,a.y);w=Math.min(w,a.y)});return Math.abs(a.center.x-
b.center.x)<this._threshold&&Math.abs(h-k-(d-c))<=this._maxDelta&&Math.abs(x-w-(e-g))<=this._maxDelta};b.prototype.checkVerticalThresholdReached=function(a,b){var d=Math.abs(a.center.y-b.center.y);a.pointers.forEach(function(a,e){e=b.pointers.get(e);d=Math.min(d,Math.abs(a.y-e.y))});return d>=this._threshold};return b}(h.InputHandler);b.VerticalTwoFingerDrag=n})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});
n=function(){function b(b){this.callbacks=b;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=function(){return!0})}b.prototype.handle=function(b){var h=b.data,a=h.pointers.size;switch(h.action){case "start":this.currentCount=a;this.emitStart(b);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=a;this.emitStart(b);break;case "update":this.emitUpdate(b);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=a;this.emitStart(b);
break;case "end":this.emitEnd(b),this.currentCount=0}this.previousEvent=b};b.prototype.emitStart=function(b){this.startEvent=b;this.callbacks.condition(this.currentCount,b)&&this.callbacks.start(this.currentCount,b,this.startEvent)};b.prototype.emitUpdate=function(b){this.callbacks.condition(this.currentCount,b)&&this.callbacks.update(this.currentCount,b,this.startEvent)};b.prototype.emitEnd=function(b){this.callbacks.condition(this.currentCount,b)&&this.callbacks.end(this.currentCount,b,this.startEvent);
this.startEvent=null};return b}();b.DragEventSeparator=n})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../support/debugFlags ../../support/earthUtils ../../support/geometryUtils ../../support/geometryUtils/sphere ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil ../../../support/index".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I){function Q(a){var b,c,d,e,f,g;return k(this,function(h){switch(h.label){case 0:if(!Map.prototype.entries)return[3,5];b=a.entries();c=b.next();h.label=1;case 1:return c.done?[3,4]:[4,c.value[1]];case 2:h.sent(),h.label=3;case 3:return c=b.next(),[3,1];case 4:return[3,9];case 5:d=Array(a.size),e=0,a.forEach(function(a){return d[e++]=a}),f=0,g=d,h.label=6;case 6:if(!(f<g.length))return[3,9];c=g[f];return[4,c];case 7:h.sent(),h.label=8;case 8:return f++,
[3,6];case 9:return[2]}})}Object.defineProperty(b,"__esModule",{value:!0});var J=x.vec4f64.create(),N=x.vec4f64.create(),L=x.vec4f64.create(),M=x.vec4f64.create(),R=v.sphere.create(),S=v.ray.create(),T=t.vec3f64.create(),U=w.create(),Y=w.create(),X=function(){return function(){this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.pooled=this.visible=this.culled=!1}}(),P=function(){return function(a,b,c){void 0===c&&(c={});this.graphics3DGraphic=a;this.slicePlaneEnabled=b;this.info=c}}(),V=function(){return function(a,
b){void 0===b&&(b=new Map);this.graphics3DCore=a;this.graphics=b}}();n=function(a){function b(){var b,c,d=null!==a&&a.apply(this,arguments)||this;d.handles=new g;d.dirty=!1;d.state=0;d.contexts=[];d.graphics=(b={},b[0]={active:new Map,visible:new f,remove:new f},b[1]={active:new Map,visible:new f,remove:new f},b);d.iterators=(c={},c[0]={active:null,visible:null,remove:null,sort:null},c[1]={active:null,visible:null,remove:null,sort:null},c);d.accBinsNumX=15;d.accBinsNumY=20;d.accBinsSizeX=0;d.accBinsSizeY=
0;d.accBins=null;d.accNumTests=0;d._iconMarginFactor=-.1;d.slicePlaneViewSpace=null;return d}l(b,a);Object.defineProperty(b.prototype,"iconMarginFactor",{get:function(){return this._iconMarginFactor},set:function(a){this._iconMarginFactor=a;this.setDirty()},enumerable:!0,configurable:!0});b.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch("state.camera",function(){a.updateSlicePlane();a.setDirtyUrgent()}),this.view.watch("map.ground.opacity",function(b,c){1!==b&&1!==c||
a.setDirtyUrgent()}),c.init(this.view,"slicePlane",function(){return a.updateSlicePlane()})]);this.frameWorker=this.view.resourceController.scheduler.registerTask(I.Task.DECONFLICTOR_DELAYED,function(b){return a.run(b)},function(){return a.needsUpdate()})};b.prototype.updateSlicePlane=function(){var a=this.view&&this.view.slicePlane;a?(this.slicePlaneViewSpace||(this.slicePlaneViewSpace=v.boundedPlane.create()),v.boundedPlane.transform(a,this.view.state.camera.viewMatrix,this.slicePlaneViewSpace),
this.slicePlaneChanged()):this.slicePlaneViewSpace&&(this.slicePlaneViewSpace=null,this.slicePlaneChanged())};b.prototype.slicePlaneChanged=function(){for(var a=0,b=this.contexts;a<b.length;a++)if(b[a].graphics3DCore.symbolCreationContext.slicePlaneEnabled){this.setDirty();break}};b.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.iterators=this.graphics=null};b.prototype.addGraphicsOwner=function(a){var b=
this,c=this.findDeconflictionContext(a),d;-1!==c?d=this.contexts[c]:(d=new V(a),this.contexts.push(d),this.setDirtyUrgent());return{addGraphic:function(a){return b.addGraphic(d,a)},removeGraphic:function(a){return b.removeGraphic(d,a)},labelingInfoChange:function(){return b.globalLabelingInfoChanged(d)},visibilityInfoChange:function(){},featureReductionChange:function(){return b.globalFeatureReductionChanged(d)},slicePlaneEnabledChange:function(){return b.globalSlicePlaneEnabledChanged(d)},clear:function(){return d.graphics.forEach(function(a){return b.removeGraphic(d,
a.graphics3DGraphic)})}}};b.prototype.removeGraphicsOwner=function(a){var b=this;a=this.findDeconflictionContext(a);if(-1!==a){var c=this.contexts.splice(a,1)[0];c.graphics.forEach(function(a){return b.removeGraphic(c,a.graphics3DGraphic)});this.setDirtyUrgent()}};b.prototype.setInitialIconVisibilityFlag=function(a,b){a=!(this.graphicSupportsDeconfliction(b)&&this.isFeatureReductionEnabled(a));b.setVisibilityFlag(3,a,0)};b.prototype.setDirtyUrgent=function(){!this.dirty&&0<this.contexts.length&&(this.dirty=
!0,this.notifyChange("updating"));this.frameWorker.task=I.Task.DECONFLICTOR_IMMEDIATE};b.prototype.setDirty=function(){!this.dirty&&0<this.contexts.length&&(this.dirty=!0,this.notifyChange("updating"),this.frameWorker.task=I.Task.DECONFLICTOR_DELAYED)};Object.defineProperty(b.prototype,"updating",{get:function(){return 0!==this.state||this.dirty},enumerable:!0,configurable:!0});b.prototype.needsUpdate=function(){return this.view.ready&&null!=this.view.state&&this.updating};b.prototype.run=function(a){switch(this.state){case 0:u.prepare(this.view),
this.dirty=!1,this.camera=this.view.state.camera,this.initBins(this.camera.fullWidth,this.camera.fullHeight),this.resetIterators(),a.madeProgress();case 1:if(this.state=1,!this.processActiveGraphics(0,a))break;case 3:if(this.state=3,!this.cleanVisibleGraphics(0,a))break;case 5:if(this.state=5,!this.sortVisibleGraphics(0,a))break;case 7:this.state=7;if(!this.deconflictVisibleGraphics(0,a))break;u.drawAccelerationStruct(this,this.graphics[0].visible);case 2:if(this.state=2,!this.processActiveGraphics(1,
a))break;case 4:if(this.state=4,!this.cleanVisibleGraphics(1,a))break;case 6:if(this.state=6,!this.sortVisibleGraphics(1,a))break;case 8:this.state=8;if(!this.deconflictVisibleGraphics(1,a))break;u.drawAccelerationStruct(this,this.graphics[1].visible);default:this.state=0,this.notifyChange("updating")}};b.prototype.findDeconflictionContext=function(a){for(var b=0;b<this.contexts.length;b++)if(this.contexts[b].graphics3DCore===a)return b;return-1};b.prototype.globalFeatureReductionChanged=function(a){var b=
this.isFeatureReductionEnabled(a.graphics3DCore);b||this.clearVisibilityFlags(a);this.modifyGraphics(a,b,0)};b.prototype.globalLabelingInfoChanged=function(a){this.modifyGraphics(a,a.graphics3DCore.labelsEnabled,1)};b.prototype.globalSlicePlaneEnabledChanged=function(a){var b=a.graphics3DCore.symbolCreationContext.slicePlaneEnabled;a.graphics.forEach(function(a){a.slicePlaneEnabled=b});this.setDirtyUrgent()};b.prototype.modifyGraphics=function(a,b,c){var d=this;b?a.graphics.forEach(function(a){return d.addToActiveGraphics(a,
c)}):a.graphics.forEach(function(a){return d.removeFromActiveGraphics(a,c)});this.setDirtyUrgent()};b.prototype.graphicSupportsDeconfliction=function(a){var b=a._graphics;if(!b||!b.length||a.isDraped())return!1;for(a=0;a<b.length;a++)if(this.graphics3DGraphicsLayerSupportsDeconfliction(b[a]))return!0;return!1};b.prototype.graphics3DGraphicsLayerSupportsDeconfliction=function(a){if(d.isNone(a)||"object3d"!==a.type)return!1;a=a.stageObject;return 1===(a?a.getNumGeometryRecords():0)&&a.getGeometryRecord(0).material instanceof
D?!0:!1};b.prototype.addGraphic=function(a,b){var c=b.graphic.uid;b=new P(b,a.graphics3DCore.symbolCreationContext.slicePlaneEnabled);a.graphics.set(c,b);this.isFeatureReductionEnabled(a.graphics3DCore)&&this.addToActiveGraphics(b,0);a.graphics3DCore.labelsEnabled&&this.addToActiveGraphics(b,1);this.setDirty()};b.prototype.removeGraphic=function(a,b){b=b.graphic.uid;var c=a.graphics.get(b);c&&(this.removeFromActiveGraphics(c,0),this.removeFromActiveGraphics(c,1),a.graphics.delete(b),this.setDirty())};
b.prototype.addToActiveGraphics=function(a,b){a.info[b]=new X;this.graphics[b].active.set(a.graphics3DGraphic.graphic.uid,a)};b.prototype.removeFromActiveGraphics=function(a,b){this.removeFromVisibleGraphics(a,b);this.clearGraphicVisibility(a,b);delete a.info[b];this.graphics[b].active.delete(a.graphics3DGraphic.graphic.uid)};b.prototype.addToVisibleGraphics=function(a,b){var c=a.info[b];c&&!c.pooled&&(this.graphics[b].visible.push(a),c.pooled=!0)};b.prototype.removeFromVisibleGraphics=function(a,
b){var c=a.info[b];c&&c.pooled&&(this.graphics[b].remove.push(a),c.pooled=!1)};b.prototype.processActiveGraphics=function(a,b){for(var c=this.getOrCreateActiveGraphicsIterator(a),d="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this.camera&&0<this.camera.relativeElevation;!b.done;){b.madeProgress();var e=c.next();if(e.done)return this.resetActiveGraphicsIterator(a),!0;var f=(e=e.value)&&e.info[a];f&&(this.collectGraphics3DGraphics(e,a,d),f.culled?this.removeFromVisibleGraphics(e,
a):this.addToVisibleGraphics(e,a))}return!1};b.prototype.cleanVisibleGraphics=function(a,b){for(var c=this.graphics[a],d=this.ensureRemoveGraphicsIterator(a);!b.done;){var e=d.next();b.madeProgress();if(e.done)return c.remove.clear(),this.resetRemoveGraphicsIterator(a),!0}return!1};b.prototype.sortVisibleGraphics=function(a,b){for(var c=this.ensureSortGraphicsIterator(a,function(b,c){return b.info[a]&&c.info[a]?c.info[a].posView-b.info[a].posView:Number.MAX_VALUE});!b.done;){var d=c.next();b.madeProgress();
if(d.done)return this.resetSortGraphicsIterator(a),!0}return!1};b.prototype.deconflictVisibleGraphics=function(a,b){for(var c=this.getOrCreateVisibleGraphicsIterator(a),d=1===a;!b.done;){b.madeProgress();var e=c.next();if(e.done)return this.resetVisibleGraphicsIterator(a),!0;var e=e.value,f=e.info[a];if(f&&!f.culled){var g=e.graphics3DGraphic,g=!(d&&!g.isVisible())&&!this.doesIntersectExistingPoly(e,a);(f.visible=g)&&this.addToBins(e,a);this.setGraphicVisibility(e,a,g);g&&u.drawPoly(f,g?"green":"red")}}return!1};
b.prototype.resetIterators=function(){this.iterators[0].active=null;this.iterators[0].visible=null;this.iterators[0].remove=null;this.iterators[0].sort=null;this.iterators[1].active=null;this.iterators[1].visible=null;this.iterators[1].remove=null;this.iterators[1].sort=null};b.prototype.getOrCreateActiveGraphicsIterator=function(a){var b=this.graphics[a];a=this.iterators[a];a.active||(a.active=Q(b.active));return a.active};b.prototype.resetActiveGraphicsIterator=function(a){this.iterators[a].active=
null};b.prototype.getOrCreateVisibleGraphicsIterator=function(a){var b=this.graphics[a];a=this.iterators[a];a.visible||(a.visible=b.visible.iterableForEach());return a.visible};b.prototype.resetVisibleGraphicsIterator=function(a){this.iterators[a].visible=null};b.prototype.ensureRemoveGraphicsIterator=function(a){var b=this.graphics[a];a=this.iterators[a];a.remove||(a.remove=b.visible.iterableRemoveMany(b.remove.data));return a.remove};b.prototype.resetRemoveGraphicsIterator=function(a){this.iterators[a].remove=
null};b.prototype.ensureSortGraphicsIterator=function(a,b){var c=this.graphics[a];a=this.iterators[a];a.sort||(a.sort=c.visible.iterableSort(b));return a.sort};b.prototype.resetSortGraphicsIterator=function(a){this.iterators[a].sort=null};b.prototype.collectGraphics3DGraphics=function(a,b,c){var d=a.graphics3DGraphic;if(!d.destroyed){var f=a.info[b];if(d.isVisible(0,3)){d=(b=1===b)?d._labelGraphics:d._graphics;b=b?0:this.iconMarginFactor;for(var g=w.empty(U),h,k,p=0;p<d.length;p++){var q=d[p];if(this.graphics3DGraphicsLayerSupportsDeconfliction(q)){var u=
q.stageObject,x=u.getGeometryRecord(0),l=x.material,D=this.camera,n=x.geometry.data.getVertexAttr();if(c&&(R.radius=m.earthRadius,r.vec3.sub(S.direction,u.getCenter(),this.camera.eye),r.vec3.copy(S.origin,this.camera.eye),z.intersectRay(R,S,T))){var I=1-Math.abs(Math.tan(r.vec3.angle(u.getCenter(),S.direction)))/this.view.width,I=Math.pow(I,4),Q=r.vec3.sqrDist(this.camera.eye,T),F=r.vec3.sqrDist(this.camera.eye,u.getCenter());if(I*F>Q){f.culled=!0;return}}if(!k){k=u.getCenter();x=x.origin.vec3;K.transformToWorld(k,
x,J);K.transformToView(J,x,D.viewMatrix,N);l.applyVerticalOffsetTransformation(N,n[C.VertexAttrConstants.NORMAL].data,u.objectTransformation,D,Z);if(a.slicePlaneEnabled&&this.slicePlaneViewSpace&&v.boundedPlane.extrusionContainsPoint(this.slicePlaneViewSpace,N)){f.culled=!0;return}u=n[C.VertexAttrConstants.AUXPOS1].data;n="screen"!==l.getParameters().centerOffsetUnits;K.transformToProjection(N,D.projectionMatrix,n?u:t.vec3f64.ZEROS,L);k=K.transformToNDC(L,M);n||(k[0]+=u[0]/D.fullWidth*2,k[1]+=u[1]/
D.fullHeight*2);if(-1>k[0]||-1>k[1]||-1>k[2]||1<=k[0]||1<=k[1])break;h=N[2];!y.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&f.visible&&(h*=.7)}q=q.getScreenSize(ca);q[0]*=D.pixelRatio;q[1]*=D.pixelRatio;B.applyPrecomputedScaleFactorVec2(q,Z.factor,q);l=w.offset(l.calculateRelativeScreenBounds(q,Z.factorAlignment.scale,Y),e.lerp(0,D.fullWidth,.5+.5*k[0]),e.lerp(0,D.fullHeight,.5+.5*k[1]));0!==b&&(D=b*Math.min(w.width(l),w.height(l)),l[0]-=D,l[1]-=D,l[2]+=D,l[3]+=D);w.expand(g,l)}}null==h?f.culled=!0:(f.xMin=
g[0],f.yMin=g[1],f.xMax=g[2],f.yMax=g[3],f.posView=h,f.culled=!1)}else f.culled=!0}};b.prototype.doesIntersectExistingPoly=function(a,b){var c=a.graphics3DGraphic.graphic.uid;a=a.info[b];for(var d=Math.floor(a.xMin/this.accBinsSizeX);d<=Math.floor(a.xMax/this.accBinsSizeX);d++)if(!(0>d||d>=this.accBinsNumX))for(var e=Math.floor(a.yMin/this.accBinsSizeY);e<=Math.floor(a.yMax/this.accBinsSizeY);e++)if(!(0>e||e>=this.accBinsNumY))for(var f=this.accBins[d][e],g=0;g<f.length;g++){var h=f.data[g],m=h.info[b];
if(m&&m.visible&&h.graphics3DGraphic.graphic.uid!==c&&(this.accNumTests++,!(m.xMin>a.xMax||m.xMax<a.xMin||m.yMin>a.yMax||m.yMax<a.yMin)))return!0}return!1};b.prototype.initBins=function(a,b){if(null==this.accBins){this.accBins=[];for(var c=0;c<this.accBinsNumX;c++){this.accBins.push([]);for(var d=this.accBins[this.accBins.length-1],e=0;e<this.accBinsNumY;e++)d.push(new f)}}for(c=0;c<this.accBinsNumX;c++)for(e=0;e<this.accBinsNumY;e++)this.accBins[c][e].clear();this.accBinsSizeX=a/this.accBinsNumX;
this.accBinsSizeY=b/this.accBinsNumY;this.accNumTests=0};b.prototype.addToBins=function(a,b){b=a.info[b];for(var c=Math.floor(b.xMin/this.accBinsSizeX);c<=Math.floor(b.xMax/this.accBinsSizeX);c++)if(!(0>c||c>=this.accBinsNumX))for(var d=Math.floor(b.yMin/this.accBinsSizeY);d<=Math.floor(b.yMax/this.accBinsSizeY);d++)0>d||d>=this.accBinsNumY||this.accBins[c][d].push(a)};b.prototype.isFeatureReductionEnabled=function(a){a=a.layer;return!(!a||!a.featureReduction||"selection"!==a.featureReduction.type)};
b.prototype.clearVisibilityFlags=function(a){(a=a.graphics3DCore.graphics3DGraphics)&&a.forEach(function(a){return a.clearVisibilityFlag(3)})};b.prototype.setGraphicVisibility=function(a,b,c){a=a.graphics3DGraphic;a.destroyed||(a.setVisibilityFlag(3,c,b),1===b&&this.view.labeler.setLabelGraphicVisibility(a,c))};b.prototype.clearGraphicVisibility=function(a,b){a=a.graphics3DGraphic;a.destroyed||a.clearVisibilityFlag(3,b)};h([q.property({constructOnly:!0})],b.prototype,"view",void 0);h([q.property({type:Boolean,
readOnly:!0})],b.prototype,"updating",null);return b=h([q.subclass("esri.views.3d.layers.graphics.Deconflictor")],b)}(q.declared(a));b.Deconflictor=n;var Z={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},ca=p.vec2f64.create()})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/debugFlags"],function(n,b,l,k){function h(a,b,g,
h,k){var c=e.height,f=d;f.beginPath();f.lineWidth=1;f.strokeStyle=k;f.moveTo(a,c-g);f.lineTo(b,c-g);f.stroke();f.lineTo(b,c-h);f.stroke();f.lineTo(b,c-g);f.stroke();f.lineTo(a,c-g);f.stroke();f.lineTo(a,c-g);f.stroke();f.closePath()}Object.defineProperty(b,"__esModule",{value:!0});var a=!1,g=!1,e,d;b.drawAccelerationStruct=function(a,b){if(g&&d){for(var c=d,e=0,f=0;f<a.accBinsNumX;f++)for(var k=0;k<a.accBinsNumY;k++){var x=a.accBins[f][a.accBinsNumY-1-k],e=e+x.length,w=f*a.accBinsSizeX,u=(f+1)*a.accBinsSizeX,
y=k*a.accBinsSizeY,m=(k+1)*a.accBinsSizeY;c.fillText(x.length.toFixed(),w+5,y+15);h(w,u,y,m,"blue")}c.fillText("total totalShownLabels: "+e,70,40);c.fillText("total visible labels: "+b.length,70,50);c.fillText("total numTests: "+a.accNumTests,70,30)}};b.prepare=function(b){a=k.DECONFLICTOR_SHOW_OUTLINES;g=k.DECONFLICTOR_SHOW_GRID;if(a||g){null==e&&(e=document.createElement("canvas"),e.setAttribute("id","canvas2d"),b.surface.parentElement.style.position="relative",b.surface.parentElement.appendChild(e));
var c=b.height*b.pixelRatio;e.setAttribute("width",b.width*b.pixelRatio+"px");e.setAttribute("height",c+"px");e.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:"+b.width+"px;height:"+b.height+"px");d=e.getContext("2d");d.clearRect(0,0,b.width,b.height);d.font="12px Arial"}};b.drawPoly=function(b,c){a&&h(b.xMin,b.xMax,b.yMin,b.yMax,c)}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(n,b,l,k,h,a){return new (function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;a.SCENEVIEW_LOCKING_LOG=!1;a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;a.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;a.DECONFLICTOR_SHOW_OUTLINES=!1;a.DECONFLICTOR_SHOW_GRID=!1;a.LABELS_SHOW_BORDER=!1;a.OVERLAY_DRAW_TEST_TEXTURE=!1;a.OVERLAY_SHOW_CENTER=!1;a.TESTS_DISABLE_UPDATE_THRESHOLDS=!1;a.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=
!1;a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;a.DRAW_MESH_GEOMETRY_NORMALS=!1;a.FEATURE_TILE_FETCH_SHOW_TILES=!1;a.FEATURE_TILE_TREE_SHOW_TILES=!1;a.TERRAIN_TILE_TREE_SHOW_TILES=!1;a.I3S_TREE_SHOW_TILES=!1;a.ENABLE_PROFILE_DEPTH_RANGE=!1;a.DISABLE_FAST_UPDATES=!1;a.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;a.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;a.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;return a}l(e,b);k([a.property()],e.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);k([a.property()],
e.prototype,"SCENEVIEW_LOCKING_LOG",void 0);k([a.property()],e.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);k([a.property()],e.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);k([a.property()],e.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);k([a.property()],e.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);k([a.property()],e.prototype,"DECONFLICTOR_SHOW_GRID",void 0);k([a.property()],e.prototype,"LABELS_SHOW_BORDER",void 0);k([a.property()],e.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);
k([a.property()],e.prototype,"OVERLAY_SHOW_CENTER",void 0);k([a.property()],e.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0);k([a.property()],e.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);k([a.property()],e.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);k([a.property()],e.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);k([a.property()],e.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);k([a.property()],e.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);k([a.property()],
e.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);k([a.property()],e.prototype,"I3S_TREE_SHOW_TILES",void 0);k([a.property()],e.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);k([a.property()],e.prototype,"DISABLE_FAST_UPDATES",void 0);k([a.property()],e.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);k([a.property()],e.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);k([a.property()],e.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);return e=k([a.subclass("esri.views.3d.support.DebugFlags")],
e)}(a.declared(h)))})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","../../../../core/mathUtils","../../support/earthUtils"],function(n,b,l,k){function h(a){return Math.abs(a*a*a)}function a(a,b,c,d){void 0===d&&(d=q);var e=c.parameters;c=c.paddingPixelsOverride;d.scale=Math.min(e.divisor/(b-e.offset),1);d.factor=h(a);d.minPixelSize=e.minPixelSize;d.paddingPixels=c;return d}function g(a,b){return 0===a?b.minPixelSize:b.minPixelSize*(1+2*b.paddingPixels/
a)}function e(a,b){return Math.max(l.lerp(a*b.scale,a,b.factor),g(a,b))}function d(b,c,d){b=a(b,c,d);b.minPixelSize=0;b.paddingPixels=0;return e(1,b)}Object.defineProperty(b,"__esModule",{value:!0});b.getSettings=function(a){return new f(a,b.defaultDescription)};b.getLabelSettings=function(a){var d=b.defaultDescription.curvatureDependent;return new f(a,{curvatureDependent:{min:{curvature:d.min.curvature,tiltAngle:d.min.tiltAngle,scaleFallOffFactor:c.curvatureDependent.min.scaleFallOffFactor},max:{curvature:d.max.curvature,
tiltAngle:d.max.tiltAngle,scaleFallOffFactor:c.curvatureDependent.max.scaleFallOffFactor}},scaleStart:b.defaultDescription.scaleStart,scaleFallOffRange:b.defaultDescription.scaleFallOffRange,minPixelSize:c.minPixelSize})};b.perspectiveFactor=h;b.scaleFactor=a;b.applyScaleFactor=e;b.applyScaleFactorVec2=function(a,b,c){void 0===c&&(c=[0,0]);var d=Math.min(Math.max(b.scale,g(a[1],b)/a[1]),1);c[0]=l.lerp(a[0]*d,a[0],b.factor);c[1]=l.lerp(a[1]*d,a[1],b.factor);return c};b.precomputeScale=d;b.precomputeScaleFactor=
function(a,b,c,e){e.scale=d(a,b,c);e.factor=0;e.minPixelSize=c.parameters.minPixelSize;e.paddingPixels=c.paddingPixelsOverride;return e};b.applyPrecomputedScaleFactorVec2=function(a,b,c){void 0===c&&(c=[0,0]);b=Math.min(Math.max(b.scale,g(a[1],b)/a[1]),1);c[0]=a[0]*b;c[1]=a[1]*b;return c};b.scale=function(b,c,d,f){return e(b,a(c,d,f))};var f=function(){function a(a,b,c,d){void 0===c&&(c={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=
b;this.parameters=c;this._paddingPixelsOverride=d;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||
this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};a.prototype.overridePadding=function(b){return b!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,b):this};a.prototype.calculateParameters=function(a,b){var c=this.description,d=c.scaleStart,e=c.scaleFallOffRange,
c=c.minPixelSize,f=a.fovY,g=a.distance,h=this.calculateCurvatureDependentParameters(a),k=this.coverageCompensation(a,h),p=h.tiltAngle,h=h.scaleFallOffFactor,g=Math.sin(p)*g,p=.5*Math.PI-p-f*(.5-d*k),d=g/Math.cos(p),e=(d-g/Math.cos(p+f*e*k)*h)/(1-h);b.camera.fovY=a.fovY;b.camera.distance=a.distance;b.offset=e;b.divisor=d-e;b.minPixelSize=c;return b};a.prototype.calculateCurvatureDependentParametersLocal=function(a,b){void 0===b&&(b=p);b.tiltAngle=this.description.curvatureDependent.min.tiltAngle;b.scaleFallOffFactor=
this.description.curvatureDependent.min.scaleFallOffFactor;return b};a.prototype.calculateCurvatureDependentParametersGlobal=function(a,b){void 0===b&&(b=p);var c=this.description.curvatureDependent;a=1+a.distance/k.earthRadius;var d=[c.min.curvature,c.max.curvature],e=d[0];a=l.clamp((Math.sqrt(a*a-1)-e)/(d[1]-e),0,1);d=[c.min,c.max];c=d[0];d=d[1];b.tiltAngle=l.lerp(c.tiltAngle,d.tiltAngle,a);b.scaleFallOffFactor=l.lerp(c.scaleFallOffFactor,d.scaleFallOffFactor,a);return b};a.prototype.surfaceCoverageCompensationLocal=
function(a,b){return(a.fovY-b.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,b){var c=k.earthRadius*k.earthRadius;b=b.tiltAngle+.5*Math.PI;var d=a.fovY;a=a.distance;a=a*a+c-2*Math.cos(b)*a*k.earthRadius;var e=Math.sqrt(a);return(Math.acos(Math.sqrt(a-c)/e)-Math.asin(k.earthRadius/(e/Math.sin(b)))+.5*d)/d};return a}();b.defaultDescription={curvatureDependent:{min:{curvature:l.deg2rad(10),tiltAngle:l.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:l.deg2rad(70),tiltAngle:l.deg2rad(40),
scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var c={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};b.copyParameters=function(a,b){b.camera.distance=a.camera.distance;b.camera.fovY=a.camera.fovY;b.divisor=a.divisor;b.offset=a.offset;b.minPixelSize=a.minPixelSize;return b};var q={scale:0,factor:0,minPixelSize:0,paddingPixels:0},p={tiltAngle:0,scaleFallOffFactor:0}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterialTexture ../lib/Material ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/HUDPrograms ../../../webgl/renderState".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D){function K(a,b,c){a.setUniform1f("cameraGroundRelative",c.cameraAboveGround?1:-1);a.setUniform1f("polygonOffset",b.shaderPolygonOffset);a.setUniform4fv("viewport",c.viewport);a.setUniform1f("perDistancePixelRatio",Math.tan(c.fovY/2)/(c.viewport[2]/2));z.bindVerticalOffset(b.verticalOffset,c,a);a.setUniformMatrix4fv("viewNormal",c.viewInvTransp);b.screenSizePerspective&&(z.bindScreenSizePerspective(b.screenSizePerspective,a,"screenSizePerspective"),
z.bindScreenSizePerspective(b.screenSizePerspectiveAlignment||b.screenSizePerspective,a,"screenSizePerspectiveAlignment"))}function I(a,b,c,d){c.occlusionTest&&(b.setUniform1i("hudVisibilityTexture",1),a.bindTexture(d.hudVisibilityTexture,1),a.setActiveTexture(0));b.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===d.renderTransparentlyOccludedHUD?1:"notOccluded"===d.renderTransparentlyOccludedHUD?0:.75);a=d.pixelRatio||1;b.setUniform4fv("overrideColor",c.color);b.setUniform1f("pixelRatio",
a);c.textureIsSignedDistanceField&&(b.setUniform4fv("outlineColor",c.outlineColor),b.setUniform1f("outlineSize",c.outlineSize));c.vvSizeEnabled&&(b.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),b.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),b.setUniform3fv("vvSizeOffset",c.vvSizeOffset),b.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(b.setUniform1fv("vvColorValues",c.vvColorValues),b.setUniform4fv("vvColorColors",c.vvColorColors));b.setUniform2f("screenOffset",2*c.screenOffset[0]*
a,2*c.screenOffset[1]*a);b.setUniform2fv("anchorPos",Q(c))}function Q(a,b){void 0===b&&(b=M);if(a.textureIsSignedDistanceField){var c=a.anchorPos;a=a.distanceFieldBoundingBox;var e=b;e[0]=c[0]*(a[2]-a[0])+a[0];e[1]=c[1]*(a[3]-a[1])+a[1]}else d.vec2.copy(b,a.anchorPos);return b}n=function(a){function b(b,c){c=a.call(this,c)||this;c.params=z.copyParameters(b,ka);return c}l(b,a);b.prototype.dispose=function(){};b.prototype.setParameterValues=function(a){for(var b in a)"textureId"===b&&m.assert(!!this.params.textureId,
"Can only change texture of material that already has a texture"),this.params[b]=a[b];this.notifyDirty("matChanged")};b.prototype.getParameters=function(){return this.params};b.prototype.intersect=function(a,b,c,d,e,f,g,h,m){m?this.intersectDrapedRenderHudGeometry(a,b,c,d,e,f,g,h):this.intersectHudGeometry(a,b,c,d,e,f,g,h)};b.prototype.intersectDrapedRenderHudGeometry=function(a,b,d,e,f,g,h,k){b=a.getAttribute(m.VertexAttrConstants.POSITION);d=a.getAttribute(m.VertexAttrConstants.SIZE);e=this.params;
f=Q(e);var p=1,v=1;k&&(v=k(ca),p=v[0],v=v[5]);p*=a.pixelRatio;v*=a.pixelRatio;k=F*a.pixelRatio;for(var q=0;q<b.data.length/b.size;q++){var r=q*b.size;c.vec3.set(R,b.data[r],b.data[r+1],b.data[r+2]);r=q*d.size;ea[0]=d.data[r]*p;ea[1]=d.data[r+1]*v;var r=R[0],z=R[1],y=void 0;e.textureIsSignedDistanceField&&(y=e.outlineSize*a.pixelRatio/2);this._isInsideIconBoundaries(g,r,z,k,y,e,f)&&h()}};b.prototype.intersectHudGeometry=function(a,b,d,e,f,k,p,v){if(e.enable.selectionMode&&e.enable.hud&&!x.isAllHidden(b.componentVisibilities,
a.componentOffsets)){var r=a.data;a=this.params;f=b=1;h.mat3.fromMat4(X,d);if(v){f=v(ca);b=f[0];f=f[5];v=X;k=v[0];var z=v[1],u=v[2],t=v[3],w=v[4],l=v[5],B=v[6],C=v[7],M=v[8],D=1/Math.sqrt(k*k+z*z+u*u),n=1/Math.sqrt(t*t+w*w+l*l),N=1/Math.sqrt(B*B+C*C+M*M);v[0]=k*D;v[1]=z*D;v[2]=u*D;v[3]=t*n;v[4]=w*n;v[5]=l*n;v[6]=B*N;v[7]=C*N;v[8]=M*N}v=r.getVertexAttr()[m.VertexAttrConstants.POSITION];k=r.getVertexAttr()[m.VertexAttrConstants.SIZE];z=r.getVertexAttr()[m.VertexAttrConstants.NORMAL];r=r.getVertexAttr()[m.VertexAttrConstants.AUXPOS1];
m.assert(3<=v.size);u=e.point;t=e.camera;w=Q(a);b*=t.pixelRatio;f*=t.pixelRatio;l="screen"===this.params.centerOffsetUnits;for(B=0;B<v.data.length/v.size;B++)C=B*v.size,c.vec3.set(R,v.data[C],v.data[C+1],v.data[C+2]),c.vec3.transformMat4(R,R,d),C=B*k.size,ea[0]=k.data[C]*b,ea[1]=k.data[C+1]*f,c.vec3.transformMat4(R,R,t.viewMatrix),C=B*r.size,c.vec3.set(V,r.data[C+0],r.data[C+1],r.data[C+2]),l||(R[0]+=V[0],R[1]+=V[1],0!==V[2]&&(C=V[2],c.vec3.normalize(V,R),c.vec3.subtract(R,R,c.vec3.scale(V,V,C)))),
C=B*z.size,c.vec3.set(S,z.data[C],z.data[C+1],z.data[C+2]),this.applyVerticalOffsetTransformation(R,S,X,t,L),t.applyProjection(R,T),-1<T[0]&&(C=Math.floor(T[0])+this.params.screenOffset[0],M=Math.floor(T[1])+this.params.screenOffset[1],l&&(C+=V[0],0!==V[1]&&(M+=y.applyScaleFactor(V[1],L.factorAlignment))),y.applyPrecomputedScaleFactorVec2(ea,L.factor,ea),D=da*t.pixelRatio,n=void 0,a.textureIsSignedDistanceField&&(n=a.outlineSize*t.pixelRatio/2),this._isInsideIconBoundaries(u,C,M,D,n,a,w)&&(M=e.ray,
c.vec3.transformMat4(Y,R,g.mat4.invert(P,t.viewMatrix)),T[0]=u[0],T[1]=u[1],t.unprojectPoint(T,R),C=q.vec3f64.create(),c.vec3.copy(C,M.direction),D=1/c.vec3.length(C),c.vec3.scale(C,C,D),M=c.vec3.distance(M.origin,R)*D,p(M,C,-1,1,!0,Y)))}};b.prototype._isInsideIconBoundaries=function(a,b,c,d,e,f,g){b=b-d-(0<g[0]?ea[0]*g[0]:0);var h=b+ea[0]+2*d;c=c-d-(0<g[1]?ea[1]*g[1]:0);d=c+ea[1]+2*d;f.textureIsSignedDistanceField&&(f=f.distanceFieldBoundingBox,b+=ea[0]*f[0],c+=ea[1]*f[1],h-=ea[0]*(1-f[2]),d-=ea[1]*
(1-f[3]),b-=e,h+=e,c-=e,d+=e);return a[0]>b&&a[0]<h&&a[1]>c&&a[1]<d};b.prototype.createBufferWriter=function(){return new va(this)};b.prototype.createRenderer=function(a,b){return new B(a,b,this)};b.prototype.normalAndViewAngle=function(a,b,d,e){void 0===e&&(e=Z);c.vec3.transformMat3(e.normal,a,b);c.vec3.transformMat4(e.normal,e.normal,d.viewInverseTransposeMatrix);e.cosAngle=c.vec3.dot(U,la);return e};b.prototype.updateScaleInfo=function(a,b,c){b=this.params;b.screenSizePerspective?a.factor=y.precomputeScaleFactor(Z.cosAngle,
c,b.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);b.screenSizePerspectiveAlignment?a.factorAlignment=y.precomputeScaleFactor(Z.cosAngle,c,b.screenSizePerspectiveAlignment,a.factorAlignment):(a.factorAlignment.factor=a.factor.factor,a.factorAlignment.scale=a.factor.scale,a.factorAlignment.minPixelSize=a.factor.minPixelSize,a.factorAlignment.paddingPixels=a.factor.paddingPixels)};b.prototype.applyVerticalOffsetTransformation=function(a,
b,d,e,f,g){var m=this.params;p.isMat4(d)&&(d=h.mat3.fromMat4(X,d));if(!m.verticalOffset||!m.verticalOffset.screenLength)return f&&(m.screenSizePerspective||m.screenSizePerspectiveAlignment)?(e=this.normalAndViewAngle(b,d,e),m=c.vec3.length(a),this.updateScaleInfo(f,e.cosAngle,m)):f&&(f.factor.scale=1,f.factorAlignment.scale=1),g?c.vec3.copy(g,a):a;b=this.normalAndViewAngle(b,d,e);d=c.vec3.length(a);e=z.verticalOffsetAtDistance(e,d,m.verticalOffset,b.cosAngle,m.screenSizePerspectiveAlignment||m.screenSizePerspective);
f&&this.updateScaleInfo(f,b.cosAngle,d);return c.vec3.add(g||a,a,c.vec3.scale(b.normal,b.normal,e))};b.prototype.getGLMaterials=function(){return{color:J,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:N}};b.prototype.calculateRelativeScreenBounds=function(a,b,c){void 0===c&&(c=r.create());var e=this.params,f=c;void 0===f&&(f=M);d.vec2.copy(f,e.anchorPos);f[0]*=-a[0];f[1]*=-a[1];f[0]+=e.screenOffset[0]*b;f[1]+=e.screenOffset[1]*b;c[2]=c[0]+a[0];c[3]=c[1]+a[1];return c};b.prototype.calculateAnchorPosForRendering=
function(a){return Q(this.params,a)};b.shouldRenderVisibilityDuringRenderPass=function(a){return 0===a||4};return b}(u.Material);var J=function(a){function b(b){b=a.call(this,w.makeCtorParameters(b,b.material.getParameters()))||this;b.isOcclusionSlot=!1;b.updateParameters();return b}l(b,a);b.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?17:16};b.prototype.selectProgram=function(){var a=this.params;this.occlusionProgram=this.programRep.getProgram(C.occlusionPass,{verticalOffset:!!a.verticalOffset,
screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.renderProgram=this.programRep.getProgram(C.colorPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,vvColor:!!a.vvColorEnabled,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,debugDrawBorder:!!a.debugDrawBorder,slice:a.slicePlaneEnabled});
this.renderPipelineState=D.makePipelineState({blending:D.simpleBlendingParams(1,771),polygonOffset:a.polygonOffset&&fa,depthTest:{func:515},depthWrite:D.defaultDepthWriteParams,colorWrite:D.defaultColorWriteParams});this.occlusionPipelineState=D.makePipelineState({depthTest:{func:515},depthWrite:D.defaultDepthWriteParams,colorWrite:D.defaultColorWriteParams})};b.prototype.beginSlot=function(a){if(this.params.occlusionTest)return this.isOcclusionSlot=11===a,11===a||a===this.mainSlot;this.isOcclusionSlot=
!1;return a===this.mainSlot};b.prototype.getProgram=function(){return this.isOcclusionSlot?this.occlusionProgram:this.renderProgram};b.prototype.getPrograms=function(){return[this.occlusionProgram,this.renderProgram]};b.prototype.updateParameters=function(){this.params=z.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram();this.selectSlot()};b.prototype.bind=function(a,b){if(this.isOcclusionSlot){var c=this.occlusionProgram;a.bindProgram(c);
a.setPipelineState(this.occlusionPipelineState);K(c,this.params,b);c.setUniform4f("color",1,1,1,1);c.setUniform1f("pixelRatio",b.pixelRatio||1)}else c=this.renderProgram,a.bindProgram(c),a.setPipelineState(this.renderPipelineState),this.bindTexture(a,c),this.bindTextureScale(a,c),K(c,this.params,b),I(a,c,this.params,b)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();z.bindView(a,b.view,c);z.bindCamPos(a,b.viewInvTransp,c);this.params.slicePlaneEnabled&&z.bindSlicePlane(b.origin,
b.slicePlane,c)};b.prototype.bindInstance=function(a,b){a=this.getProgram();a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.release=function(a){};b.prototype.getDrawMode=function(){return this.isOcclusionSlot?0:4};return b}(w),N=function(a){function b(b){b=a.call(this,w.makeCtorParameters(b,b.material.getParameters()))||this;b.updateParameters();return b}l(b,a);b.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?
17:16};b.prototype.beginSlot=function(a){return a===this.mainSlot};b.prototype.getProgram=function(){return this.program};b.prototype.updateParameters=function(){this.params=z.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram();this.selectSlot()};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(C.highlightPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,
vvColor:!!a.vvColorEnabled,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,binaryHighlightOcclusion:a.binaryHighlightOcclusion,slice:a.slicePlaneEnabled});this.pipelineState=D.makePipelineState({blending:D.separateBlendingParams(1,1,771,771),polygonOffset:a.polygonOffset&&fa,depthTest:{func:513},colorWrite:D.defaultColorWriteParams})};b.prototype.bind=function(a,b){var c=this.program;a.bindProgram(c);a.setPipelineState(this.pipelineState);
this.bindTexture(a,c);this.bindTextureScale(a,c);K(c,this.params,b);I(a,c,this.params,b);z.bindHighlightRendering(a,b,this.program)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();z.bindView(a,b.view,c);z.bindCamPos(a,b.viewInvTransp,c);this.params.slicePlaneEnabled&&z.bindSlicePlane(b.origin,b.slicePlane,c)};b.prototype.bindInstance=function(a,b){a=this.getProgram();a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};
b.prototype.release=function(a){};b.prototype.getDrawMode=function(){return 4};return b}(w),L={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},M=f.vec2f64.create(),R=q.vec3f64.create(),S=q.vec3f64.create(),T=k.createRenderScreenPointArray3(),U=q.vec3f64.create(),Y=q.vec3f64.create(),X=a.mat3f64.create(),P=e.mat4f64.create(),V=q.vec3f64.create(),Z={normal:U,cosAngle:0},ca=e.mat4f64.create();g.mat4.identity(ca);var da=1,F=2,
ea=[0,0],la=q.vec3f64.fromValues(0,0,1),ka={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],
verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:f.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},oa=t.newLayout().vec3f(m.VertexAttrConstants.POSITION).vec3f(m.VertexAttrConstants.NORMAL).vec2f(m.VertexAttrConstants.UV0).vec4u8(m.VertexAttrConstants.COLOR).vec2f(m.VertexAttrConstants.SIZE).vec4f(m.VertexAttrConstants.AUXPOS1).vec4f(m.VertexAttrConstants.AUXPOS2),
va=function(){function a(a){this.material=a;this.vertexBufferLayout=oa}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[m.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d){v.writePosition(b.indices[m.VertexAttrConstants.POSITION],b.vertexAttr[m.VertexAttrConstants.POSITION].data,a.transformation,c.position,d,6);v.writeNormal(b.indices[m.VertexAttrConstants.NORMAL],b.vertexAttr[m.VertexAttrConstants.NORMAL].data,
a.invTranspTransformation,c.normal,d,6);a=b.vertexAttr[m.VertexAttrConstants.UV0].data;var e=void 0,f=void 0,g=void 0,h=void 0;null==a||4>a.length?(a=this.material.getParameters(),f=e=0,g=a.texCoordScale[0],h=a.texCoordScale[1]):(e=a[0],f=a[1],g=a[2],h=a[3]);var g=Math.min(1.99999,g+1),h=Math.min(1.99999,h+1),k=b.indices[m.VertexAttrConstants.POSITION].length,p=c.uv0;a=d;for(var q=0;q<k;++q)p.set(a,0,e),p.set(a,1,f),a+=1,p.set(a,0,g),p.set(a,1,f),a+=1,p.set(a,0,g),p.set(a,1,h),a+=1,p.set(a,0,g),p.set(a,
1,h),a+=1,p.set(a,0,e),p.set(a,1,h),a+=1,p.set(a,0,e),p.set(a,1,f),a+=1;v.writeColor(b.indices[m.VertexAttrConstants.COLOR],b.vertexAttr[m.VertexAttrConstants.COLOR].data,4,c.color,d,6);e=b.indices[m.VertexAttrConstants.SIZE];f=b.vertexAttr[m.VertexAttrConstants.SIZE].data;g=e.length;h=c.size;a=d;for(q=0;q<g;++q)for(var k=f[2*e[q]],p=f[2*e[q]+1],r=0;6>r;++r)h.set(a,0,k),h.set(a,1,p),a+=1;b.indices[m.VertexAttrConstants.AUXPOS1]&&b.vertexAttr[m.VertexAttrConstants.AUXPOS1]&&v.writeBufferVec4(b.indices[m.VertexAttrConstants.AUXPOS1],
b.vertexAttr[m.VertexAttrConstants.AUXPOS1].data,c.auxpos1,d,6);b.indices[m.VertexAttrConstants.AUXPOS2]&&b.vertexAttr[m.VertexAttrConstants.AUXPOS2]&&v.writeBufferVec4(b.indices[m.VertexAttrConstants.AUXPOS2],b.vertexAttr[m.VertexAttrConstants.AUXPOS2].data,c.auxpos2,d,6)};return a}(),fa={factor:0,units:-4};return n})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["require","exports"],function(n,b){function l(b){return b instanceof Float32Array&&16<=b.length}function k(b){return Array.isArray(b)&&
16<=b.length}Object.defineProperty(b,"__esModule",{value:!0});b.isMat4f32=l;b.isMat4f64=k;b.isMat4=function(b){return l(b)||k(b)}})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ./DefaultTextureUnits ./GLMaterial ../materials/internal/MaterialUtil".split(" "),function(n,b,l,k,h,a,g){n=function(a){function b(b){var c=a.call(this,b)||this,d=b.textureRep;c.textureRep=d;c.textureId=
b.textureId;var e=!!b.initTransparent;c.initTransparent=e;c.glTextureRef=g.acquireIfNotUndefined(c.textureId,d,c.initTransparent);b.normalTextureId&&(c.glTextureRefNormal=g.acquireIfNotUndefined(b.normalTextureId,d,e));b.emissiveTextureId&&(c.glTextureRefEmission=g.acquireIfNotUndefined(b.emissiveTextureId,d,e));b.occlusionTextureId&&(c.glTextureRefOcclusion=g.acquireIfNotUndefined(b.occlusionTextureId,d,e));b.metallicRoughnessTextureId&&(c.glTextureRefRoughnessMetallness=g.acquireIfNotUndefined(b.metallicRoughnessTextureId,
d,e));return c}k(b,a);b.prototype.dispose=function(){g.releaseIfNotUndefined(this.textureId,this.textureRep)};b.prototype.updateTexture=function(a){a!==this.textureId&&(g.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=a,this.glTextureRef=g.acquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))};b.prototype.bindTexture=function(a,b){null!=this.glTextureRef&&(b.setUniform1i("tex",h.DefaultTextureUnits.DIFFUSE),a.bindTexture(this.glTextureRef.getGLTexture(),
h.DefaultTextureUnits.DIFFUSE));this.glTextureRefNormal&&(b.setUniform1i("texNormal",h.DefaultTextureUnits.NORMAL),a.bindTexture(this.glTextureRefNormal.getGLTexture(),h.DefaultTextureUnits.NORMAL));this.glTextureRefEmission&&(b.setUniform1i("texEmission",h.DefaultTextureUnits.EMISSION),a.bindTexture(this.glTextureRefEmission.getGLTexture(),h.DefaultTextureUnits.EMISSION));this.glTextureRefOcclusion&&(b.setUniform1i("texOcclusion",h.DefaultTextureUnits.OCCLUSION),a.bindTexture(this.glTextureRefOcclusion.getGLTexture(),
h.DefaultTextureUnits.OCCLUSION));this.glTextureRefRoughnessMetallness&&(b.setUniform1i("texMetallicRoughness",h.DefaultTextureUnits.METALLIC_ROUGHNESS),a.bindTexture(this.glTextureRefRoughnessMetallness.getGLTexture(),h.DefaultTextureUnits.METALLIC_ROUGHNESS))};b.prototype.bindTextureScale=function(a,b){(a=this.glTextureRef&&this.glTextureRef.getGLTexture())&&a.descriptor.textureCoordinateScaleFactor?b.setUniform2fv("textureCoordinateScaleFactor",a.descriptor.textureCoordinateScaleFactor):b.setUniform2f("textureCoordinateScaleFactor",
1,1)};return b}(a);(function(a){a.makeCtorParameters=function(a,b){return l({},a,b)}})(n||(n={}));return n})},"esri/views/3d/webgl-engine/lib/DefaultTextureUnits":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultTextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2,EMISSION:3,OCCLUSION:4,METALLIC_ROUGHNESS:5}})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ./AutoDisposable".split(" "),
function(n,b,l,k,h,a){return function(a){function b(b){var d=a.call(this)||this;d.material=b.material;d.programRep=b.programRep;return d}l(b,a);b.prototype.isVisible=function(){return this.material.isVisible()};b.prototype.isVisibleInPass=function(a){return this.material.isVisibleInPass(a)};b.prototype.getPrograms=function(){return[this.getProgram()]};b.prototype.getDrawMode=function(){return 4};b.prototype.release=function(a,b){};return b=k([h.subclass("esri.views.3d.webgl-engine.lib.GLMaterial")],
b)}(h.declared(a.AutoDisposable))})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["require","exports","../../../../core/tsSupport/declareExtendsHelper","../../../../core/tsSupport/decorateHelper","../../../../core/accessorSupport/decorators"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});b.AutoDisposableMixin=function(a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._isDisposed=!1;return b}l(b,a);b.prototype.dispose=function(){for(var a=
this.__proto__.__managedDisposables__||[],b=a.length-1;0<=b;b--){var c=a[b];this[c]&&"function"===typeof this[c].dispose&&this[c].dispose();this[c]=null}this._isDisposed=!0};Object.defineProperty(b.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0});return b=k([h.subclass("esri.views.3d.webgl-engine.lib.AutoDisposableMixin")],b)}(h.declared(a))};n=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);return b=k([h.subclass("esri.views.3d.webgl-engine.lib.AutoDisposable")],
b)}(h.declared(b.AutoDisposableMixin(function(){return function(){}}())));b.AutoDisposable=n;b.autoDispose=function(){return function(a,b){a.__managedDisposables__=a.__managedDisposables__||[];a.__managedDisposables__.push(b)}}})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../core/mathUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../../../geometry/support/aaBoundingBox ../../lib/ComponentUtils ../../lib/doublePrecisionUtils ../../lib/screenSizePerspectiveUtils ../../lib/Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(a,b,c,d,e){var g=u(b,c,D);f.setMin(B,a.getBBMin());f.setMax(B,a.getBBMax());if(y(B,b,g,d)){var g=a.getPrimitiveIndices(),h=a.getIndices(),m=a.getPosition(),k=g?g.length:h.length/3;if(k>S&&(a=a.getChildren(),void 0!==a)){for(g=0;8>g;++g)void 0!==a[g]&&t(a[g],b,c,d,e);return}x(b,c,0,k,h,m,g,e)}}function x(a,b,c,d,e,f,g,h){if(g){var m=f.data,k=f.offsetIdx;f=f.strideIdx;var p=a[0],v=a[1];a=a[2];var q=b[0]-p,r=b[1]-v;for(b=b[2]-a;c<d;++c){var z=g[c],y=3*
z,u=k+f*e[y++],x=m[u++],t=m[u++],l=m[u],u=k+f*e[y++],B=m[u++],L=m[u++],C=m[u],u=k+f*e[y],y=m[u++],M=m[u++],B=B-x,L=L-t,C=C-l,y=y-x,M=M-t,u=m[u]-l,D=r*u-M*b,n=b*y-u*q,N=q*M-y*r,R=B*D+L*n+C*N;if(!(Math.abs(R)<=K)){x=p-x;t=v-t;l=a-l;D=x*D+t*n+l*N;if(0<R){if(0>D||D>R)continue}else if(0<D||D<R)continue;n=t*C-L*l;l=l*B-C*x;t=x*L-B*t;x=q*n+r*l+b*t;if(0<R){if(0>x||D+x>R)continue}else if(0<x||D+x<R)continue;l=(y*n+M*l+u*t)/R;0<=l&&(B=w(B,L,C,y,M,u,I),h(l,B,z))}}}else for(g=f.data,m=f.offsetIdx,k=f.strideIdx,
f=a[0],p=a[1],v=a[2],a=b[0]-f,q=b[1]-p,r=b[2]-v,b=c,c*=3;b<d;++b)if(M=m+k*e[c++],R=g[M++],t=g[M++],l=g[M],M=m+k*e[c++],z=g[M++],B=g[M++],L=g[M],M=m+k*e[c++],C=g[M++],y=g[M++],z-=R,B-=t,L-=l,C-=R,y-=t,M=g[M]-l,x=q*M-y*r,D=r*C-M*a,n=a*y-C*q,u=z*x+B*D+L*n,!(Math.abs(u)<=K)){R=f-R;t=p-t;l=v-l;x=R*x+t*D+l*n;if(0<u){if(0>x||x>u)continue}else if(0<x||x<u)continue;D=t*L-B*l;l=l*z-L*R;t=R*B-z*t;R=a*D+q*l+r*t;if(0<u){if(0>R||x+R>u)continue}else if(0<R||x+R<u)continue;l=(C*D+y*l+M*t)/u;0<=l&&(z=w(z,B,L,C,y,
M,I),h(l,z,b))}}function w(a,b,c,d,e,f,h){g.vec3.set(Q,a,b,c);g.vec3.set(J,d,e,f);g.vec3.cross(h,Q,J);g.vec3.normalize(h,h);return h}function u(a,b,c){return g.vec3.set(c,1/(b[0]-a[0]),1/(b[1]-a[1]),1/(b[2]-a[2]))}function y(a,b,c,d){var e=(a[0]-d-b[0])*c[0],f=(a[3]+d-b[0])*c[0],g=Math.min(e,f),e=Math.max(e,f),f=(a[1]-d-b[1])*c[1],h=(a[4]+d-b[1])*c[1],g=Math.max(g,Math.min(f,h)),e=Math.min(e,Math.max(f,h));if(g>e)return!1;f=(a[2]-d-b[2])*c[2];a=(a[5]+d-b[2])*c[2];g=Math.max(g,Math.min(f,a));e=Math.min(e,
Math.max(f,a));return g<=e}function m(a,b){b=b?m(b):{};for(var c in a){var d=a[c];d&&d.forEach&&(d=v(d));null==d&&c in b||(b[c]=d)}return b}function v(a){var b=[];a.forEach(function(a){return b.push(a)});return b}Object.defineProperty(b,"__esModule",{value:!0});var z=a.mat4f64.create(),B=f.create(),C=r.VertexAttrConstants;b.IDENTITY=a.mat4f64.create();b.intersectTriangleGeometry=function(a,b,d,e,g,h){b=b&&b.componentVisibilities;d=d.tolerance;if(1<a.componentCount)a:{var m=u(e,g,D),k=a.componentCount,
p=a.componentOffsets,v=a.getIndices(C.POSITION),q=a.getAttribute(C.POSITION),z=a.boundingInfo;if(z&&(f.setMin(B,z.getBBMin()),f.setMax(B,z.getBBMax()),!y(B,e,m,d)))break a;for(z=0;z<k;z++)if(!b||c.getVisibility(b,z)){if(a.getComponentAABB){var w=a.getComponentAABB(z,B);if(!y(w,e,m,d))continue}x(e,g,p[z]/3,p[z+1]/3,v,q,void 0,h)}}else if(!b||c.getVisibility(b,0))a.boundingInfo?(r.assert("triangle"===a.data.primitiveType),t(a.boundingInfo,e,g,d,h)):(b=a.getIndices(C.POSITION),a=a.getAttribute(C.POSITION),
x(e,g,0,b.length/3,b,a,void 0,h))};var D=e.vec3f64.create(),K=Math.pow(2,-52),I=e.vec3f64.create();b.intersectTriangles=x;var Q=e.vec3f64.create(),J=e.vec3f64.create();b.computeNormal=w;b.intersectAabbInvDir=y;b.transformToWorld=function(a,b,c){return d.vec4.set(c,a[0]-b[0],a[1]-b[1],a[2]-b[2],1)};b.transformToView=function(a,b,c,e){k.mat4.translate(z,c,b);c=z;return d.vec4.transformMat4(e,a,c)};b.transformToProjection=function(a,b,c,e){e[0]=a[0]+c[0];e[1]=a[1]+c[1];e[2]=a[2]+c[2];e[3]=a[3];return d.vec4.transformMat4(e,
e,b)};b.transformToNDC=function(a,b){return d.vec4.scale(b,a,1/Math.abs(a[3]))};b.applyScreenSizePerspectiveScale=function(a,b,c,d,e){return p.scale(a,d,c,e)};b.verticalOffsetAtDistance=function(a,b,c,d,e){var f=(c.screenLength||0)*a.pixelRatio;e&&(f=p.scale(f,d,b,e));return l.clamp(f*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,c.minWorldLength||0,null!=c.maxWorldLength?c.maxWorldLength:Infinity)};b.acquireIfNotUndefined=function(a,b,c){if(void 0!==a)return b.acquire(a,c)};b.releaseIfNotUndefined=function(a,
b){void 0!==a&&b.release(a)};var N=h.mat4f32.create();b.bindView=function(a,b,c){k.mat4.translate(N,b,a);c.setUniform3fv("localOrigin",a);c.setUniformMatrix4fv("view",N)};b.bindCamPos=function(a,b,c){c.setUniform3f("camPos",b[3]-a[0],b[7]-a[1],b[11]-a[2])};var L=e.vec3f64.create(),M=e.vec3f64.create();b.bindViewOriginDouble=function(a,b){q.encodeDoubleArraySplit(a,L,M,3);b.setUniform3fv("viewOriginHi",L);b.setUniform3fv("viewOriginLo",M)};var R=e.vec3f64.create();b.bindSlicePlane=function(a,b,c){g.vec3.subtract(R,
b.origin,a);c.setUniform3fv("slicePlaneOrigin",R);c.setUniform3fv("slicePlaneBasis1",b.basis1);c.setUniform3fv("slicePlaneBasis2",b.basis2)};b.bindVerticalOffset=function(a,b,c){if(a){var d=b.fovY,e=b.viewport[3],f=void 0;void 0===f&&(f=T);f.screenLength=a.screenLength;f.perDistance=Math.tan(.5*d)/(.5*e);f.minWorldLength=a.minWorldLength;f.maxWorldLength=a.maxWorldLength;a=f;c.setUniform4f("verticalOffset",a.screenLength*(b.pixelRatio||1),a.perDistance,a.minWorldLength,a.maxWorldLength)}};b.bindHighlightRendering=
function(a,b,c){a.bindTexture(b.highlightDepthTexture,5);c.setUniform1i("depthTex",5);c.setUniform4f("highlightViewportPixelSz",0,0,1/b.viewport[2],1/b.viewport[3])};b.bindScreenSizePerspective=function(a,b,c){void 0===c&&(c="screenSizePerspectiveAlignment");if(a){var d=a.parameters;b.setUniform4f(c,d.divisor,d.offset,d.minPixelSize,a.paddingPixelsOverride)}};b.copyParameters=m;b.updateParameters=function(a,b){var c=!1,d;for(d in b){var e=b[d];void 0!==e&&(c=!0,Array.isArray(e)?a[d]=e.slice():a[d]=
e)}return c};(function(a){function b(a){return(a.shadowMappingEnabled?1:0)|(a.ssaoEnabled?2:0)}a.create=function(a,c){for(var d=[],e=0;2>e;e++)for(var f=0;2>f;f++){var g=b({shadowMappingEnabled:1===e,ssaoEnabled:1===f}),h=b({shadowMappingEnabled:1===e,ssaoEnabled:1===f&&a.receiveSSAO});d[g]=d[h]||c({receiveShadows:1===e,receiveSSAO:1===f&&a.receiveSSAO})}return{programs:d.filter(function(a){return null!=a}),byParameter:d}};a.lookup=function(a,c){return a.byParameter[b(c)]};a.programs=function(a){return a.programs}})(b.BindParametersMap||
(b.BindParametersMap={}));b.intersectDrapedRenderLineGeometry=function(a,b,c,d,e,f,g,h,m){if(d.enable.selectionMode){b=a.getAttribute(C.POSITION).data;d=a.getAttribute(C.SIZE);c=f[0];f=f[1];a=(((d&&d.data[0])+g)/2+4)*a.pixelRatio;g=Number.MAX_VALUE;for(d=0;d<b.length-5;d+=3){var k=b[d],p=b[d+1];m=c-k;e=f-p;var k=b[d+3]-k,p=b[d+4]-p,v=l.clamp((k*m+p*e)/(k*k+p*p),0,1);m=k*v-m;e=p*v-e;e=m*m+e*e;e<g&&(g=e)}g<a*a&&h()}};b.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var S=1E3,T={screenLength:0,
perDistance:0,minWorldLength:0,maxWorldLength:0};b.defaultPBRMaterialParameters={usePBR:!0,roughnessFactor:.6,metallicFactor:0,reflectanceFactor:.2};b.defaultPBRTreeMaterialParameters={usePBR:!0,roughnessFactor:1,metallicFactor:0,reflectanceFactor:.2};b.returnDefaultPBRMaterialParameters=function(a,c){return c&&a?b.defaultPBRTreeMaterialParameters:a?b.defaultPBRMaterialParameters:{usePBR:!1}}})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["require","exports","./factories/mat4f32"],function(n,
b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat4f32=l})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(16);b[0]=1;b[5]=1;b[10]=1;b[15]=1;return b};b.clone=function(b){var k=new Float32Array(16);k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=b[3];k[4]=b[4];k[5]=b[5];k[6]=b[6];k[7]=b[7];k[8]=b[8];k[9]=b[9];k[10]=b[10];k[11]=b[11];k[12]=b[12];k[13]=b[13];
k[14]=b[14];k[15]=b[15];return k};b.fromValues=function(b,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u){var y=new Float32Array(16);y[0]=b;y[1]=k;y[2]=h;y[3]=a;y[4]=g;y[5]=e;y[6]=d;y[7]=f;y[8]=c;y[9]=q;y[10]=p;y[11]=r;y[12]=t;y[13]=x;y[14]=w;y[15]=u;return y};b.createView=function(b,k){return new Float32Array(b,k,16)}})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require","exports"],function(n,b){function l(a,b,e){for(var d=0;d<e;++d)b[2*d]=a[d],b[2*d+1]=a[d]-b[2*d]}Object.defineProperty(b,
"__esModule",{value:!0});b.encodeDouble=function(a,b){h[0]=a;h[1]=a-h[0];b[0]=h[0];b[1]=h[1]};b.encodeDoubleArray=l;b.decodeDoubleArray=function(a,b,e){for(var d=0;d<e;++d)b[d]=a[2*d]+a[2*d+1]};b.encodeDoubleArraySplit=function(a,b,e,d){for(var f=0;f<d;++f)k[0]=a[f],l(k,h,1),b[f]=h[0],e[f]=h[1]};var k=new Float64Array(1),h=new Float32Array(2)})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require","exports","./IdGen"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});
n=function(){function b(h){this.supportsEdges=!1;this._parentStage=null;this._visible=!0;this._renderOccluded=1;this._renderPriority=0;this.id=b._idGen.gen(h)}b.prototype.update=function(b){return!1};Object.defineProperty(b.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0});b.prototype.addParentStage=function(b){this._parentStage=b};b.prototype.removeParentStage=function(b){this._parentStage=null};Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},
set:function(b){b!==this._visible&&(this._visible=b,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(b){b!==this._renderOccluded&&(this._renderOccluded=b,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(b){b!==this._renderPriority&&(this._renderPriority=
b,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});b.prototype.isVisibleInPass=function(b){return!0};b.prototype.isVisible=function(){return this._visible};b.prototype.notifyDirty=function(b){this.parentStage&&this.parentStage.notifyDirty(3,this,b)};b._idGen=new l.IdGen;return b}();b.Material=n})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["require","exports","../../../support/buffer/BufferView","../../lib/Util"],function(n,b,l,k){function h(a,
b,d,e,f){var c=d.typedBuffer;d=d.typedBufferStride;var g=a.length;e*=d;if(null==f||1===f)for(var h=0;h<g;++h){var k=2*a[h];c[e]=b[k];c[e+1]=b[k+1];e+=d}else for(h=0;h<g;++h)for(var k=2*a[h],m=0;m<f;++m)c[e]=b[k],c[e+1]=b[k+1],e+=d}function a(a,b,d,e,f){var c=d.typedBuffer;d=d.typedBufferStride;var g=a.length;e*=d;if(null==f||1===f)for(var h=0;h<g;++h){var k=3*a[h];c[e]=b[k];c[e+1]=b[k+1];c[e+2]=b[k+2];e+=d}else for(h=0;h<g;++h)for(var k=3*a[h],m=0;m<f;++m)c[e]=b[k],c[e+1]=b[k+1],c[e+2]=b[k+2],e+=
d}function g(a,b,d,e,f){var c=d.typedBuffer;d=d.typedBufferStride;var g=a.length;e*=d;if(null==f||1===f)for(var h=0;h<g;++h){var k=4*a[h];c[e]=b[k];c[e+1]=b[k+1];c[e+2]=b[k+2];c[e+3]=b[k+3];e+=d}else for(h=0;h<g;++h)for(var k=4*a[h],m=0;m<f;++m)c[e]=b[k],c[e+1]=b[k+1],c[e+2]=b[k+2],c[e+3]=b[k+3],e+=d}function e(b,d,e,f,g,h){if(e){var c=f.typedBuffer;f=f.typedBufferStride;var k=b.length;g*=f;if(null==h||1===h)for(var p=0;p<k;++p){var m=3*b[p],v=d[m],q=d[m+1],r=d[m+2];c[g]=e[0]*v+e[4]*q+e[8]*r+e[12];
c[g+1]=e[1]*v+e[5]*q+e[9]*r+e[13];c[g+2]=e[2]*v+e[6]*q+e[10]*r+e[14];g+=f}else for(p=0;p<k;++p)for(var m=3*b[p],v=d[m],q=d[m+1],r=d[m+2],m=e[0]*v+e[4]*q+e[8]*r+e[12],x=e[1]*v+e[5]*q+e[9]*r+e[13],v=e[2]*v+e[6]*q+e[10]*r+e[14],q=0;q<h;++q)c[g]=m,c[g+1]=x,c[g+2]=v,g+=f}else a(b,d,f,g,h)}function d(b,d,e,f,g,h){if(e){var c=f.typedBuffer;f=f.typedBufferStride;var k=b.length;g*=f;if(null==h||1===h)for(var p=0;p<k;++p){var m=3*b[p],v=d[m],q=d[m+1],r=d[m+2];c[g]=e[0]*v+e[4]*q+e[8]*r;c[g+1]=e[1]*v+e[5]*q+
e[9]*r;c[g+2]=e[2]*v+e[6]*q+e[10]*r;g+=f}else for(p=0;p<k;++p)for(var m=3*b[p],v=d[m],q=d[m+1],r=d[m+2],m=e[0]*v+e[4]*q+e[8]*r,x=e[1]*v+e[5]*q+e[9]*r,v=e[2]*v+e[6]*q+e[10]*r,q=0;q<h;++q)c[g]=m,c[g+1]=x,c[g+2]=v,g+=f}else a(b,d,f,g,h)}function f(a,b,d,e,f,g){var c=e.typedBuffer;e=e.typedBufferStride;var h=a.length;f*=e;if(null==g||1===g)if(4===d)for(d=0;d<h;++d){var k=4*a[d];c[f]=b[k];c[f+1]=b[k+1];c[f+2]=b[k+2];c[f+3]=b[k+3];f+=e}else{if(3===d)for(d=0;d<h;++d)k=3*a[d],c[f]=b[k],c[f+1]=b[k+1],c[f+
2]=b[k+2],c[f+3]=255,f+=e}else if(4===d)for(d=0;d<h;++d)for(var k=4*a[d],m=0;m<g;++m)c[f]=b[k],c[f+1]=b[k+1],c[f+2]=b[k+2],c[f+3]=b[k+3],f+=e;else if(3===d)for(d=0;d<h;++d)for(k=3*a[d],m=0;m<g;++m)c[f]=b[k],c[f+1]=b[k+1],c[f+2]=b[k+2],c[f+3]=255,f+=e}Object.defineProperty(b,"__esModule",{value:!0});b.writeBufferVec2=h;b.writeBufferVec3=a;b.writeBufferVec4=g;b.writeBufferMat3f=function(a,b,d,e){var c=d.typedBuffer;d=d.typedBufferStride;var f=a.length;e*=d;for(var g=0;g<f;++g){for(var h=9*a[g],k=0;9>
k;++k)c[e+k]=b[h+k];e+=d}};b.writeBufferMat4f=function(a,b,d,e){var c=d.typedBuffer;d=d.typedBufferStride;var f=a.length;e*=d;for(var g=0;g<f;++g){for(var h=16*a[g],k=0;16>k;++k)c[e+k]=b[h+k];e+=d}};b.writePosition=e;b.writeNormal=d;b.writeColor=f;b.writeMultipliedColor=function(a,b,d,e,f,g,h){var c=f.typedBuffer;f=f.typedBufferStride;var k=a.length;g*=f;if(null==h||1===h)if(4===d)for(d=0;d<k;++d){var m=4*a[d];c[g]=b[m]*e[0];c[g+1]=b[m+1]*e[1];c[g+2]=b[m+2]*e[2];c[g+3]=b[m+3]*e[3];g+=f}else{if(3===
d){var p=255*e[3];for(d=0;d<k;++d)m=3*a[d],c[g]=b[m]*e[0],c[g+1]=b[m+1]*e[1],c[g+2]=b[m+2]*e[2],c[g+3]=p,g+=f}}else if(4===d)for(d=0;d<k;++d)for(var m=4*a[d],q=0;q<h;++q)c[g]=b[m]*e[0],c[g+1]=b[m+1]*e[1],c[g+2]=b[m+2]*e[2],c[g+3]=b[m+3]*e[3],g+=f;else if(3===d)for(p=255*e[3],d=0;d<k;++d)for(m=3*a[d],q=0;q<h;++q)c[g]=b[m]*e[0],c[g+1]=b[m+1]*e[1],c[g+2]=b[m+2]*e[2],c[g+3]=p,g+=f};b.writeDefaultAttributes=function(a,b,p,r,t,x){var c=0;for(b=b.fieldNames;c<b.length;c++){var q=b[c],y=a.vertexAttr[q],m=
a.indices[q];if(y&&m)switch(q){case k.VertexAttrConstants.POSITION:k.assert(3===y.size);(q=t.getField(q,l.BufferViewVec3f))&&e(m,y.data,p,q,x);break;case k.VertexAttrConstants.NORMAL:k.assert(3===y.size);(q=t.getField(q,l.BufferViewVec3f))&&d(m,y.data,r,q,x);break;case k.VertexAttrConstants.UV0:k.assert(2===y.size);(q=t.getField(q,l.BufferViewVec2f))&&h(m,y.data,q,x);break;case k.VertexAttrConstants.REGION:k.assert(4===y.size);(q=t.getField(q,l.BufferViewVec4u16))&&g(m,y.data,q,x);break;case k.VertexAttrConstants.COLOR:k.assert(3===
y.size||4===y.size);(q=t.getField(q,l.BufferViewVec4u8))&&f(m,y.data,y.size,q,x);break;case k.VertexAttrConstants.SYMBOLCOLOR:k.assert(3===y.size||4===y.size);(q=t.getField(q,l.BufferViewVec4u8))&&f(m,y.data,y.size,q,x);break;case k.VertexAttrConstants.TANGENT:k.assert(4===y.size),(q=t.getField(q,l.BufferViewVec4f))&&g(m,y.data,q,x)}}}})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ../../lib/IntervalUtilities ../../lib/ResizableFloat32Array ../../lib/Util ../WaterGLMaterial ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){function x(a,b,c,d){for(var e=new Map,f=b.vertexBufferLayout.stride/4,g=function(c,d){var g=c.origin,h=a.get(g.id),m=e.get(g.id);null==m&&(m={optimalCount:null==h?0:h.optimalCount,sparseCount:null==h?0:h.buffer.getSize(),toAdd:[],toRemove:[],origin:g.vec3},e.set(g.id,m));g=b.elementCount(c.data)*f;d?(m.optimalCount+=g,m.sparseCount+=g,m.toAdd.push(c)):(m.optimalCount-=g,m.toRemove.push(c))},h=0;h<c.length;h++){var m=c[h];g(m,!0)}for(c=0;c<d.length;c++)m=d[c],
g(m,!1);return e}n=function(){function b(b,c,d,e){void 0===e&&(e=a.Default3D);this.type="MergedRenderer";this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=b;this._vertexAttributeLocations=e;this._material=d;this._materialRep=c;this._glMaterials=q.acquireMaterials(this._material,this._materialRep);this._bufferWriter=d.createBufferWriter()}b.prototype.dispose=function(){q.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0===
this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});b.prototype.hasWater=function(){var a=!1;this._glMaterials.forEach(function(b){a=a||b instanceof f.WaterGLMaterial});return a};b.prototype.renderPriority=function(){return this._material.renderPriority};b.prototype.modify=function(a){var b=this,c=z;c.clear();this.updateGeometries(a.toUpdate,c);this.addAndRemoveGeometries(a.toAdd,
a.toRemove,c);this.updateHighlightCount();c.forEach(function(a){return b.updateDisplayedIndexRanges(a)})};b.prototype.addAndRemoveGeometries=function(a,b,c){var e=this,f=this._material,g=this._bufferWriter,h=g.vertexBufferLayout,m=h.stride/4,k=this._dataByOrigin,p=x(k,g,a,b);p.forEach(function(a,b){p.delete(b);var g=a.optimalCount,v=a.sparseCount,q=k.get(b);null==q&&(d.assert(0<g),q=e.createData(h,g,a.origin),k.set(b,q));if(0===g)q.vao.dispose(!0),q.vao=null,k.delete(b);else{var r=(b=g<a.sparseCount/
2)?g:v,g=w,v=q.buffer.getSize(),z=q.buffer.getArray(),r=q.buffer.resize(r,!1);b||r?e.removeAndRebuild(q,a.toRemove,m,z,g):0<a.toRemove.length?(e.removeByErasing(q,a.toRemove,m,g),0<a.toAdd.length&&(g.end=v)):(g.begin=v,g.end=v);b=u;d.setMatrixTranslation3(b,-a.origin[0],-a.origin[1],-a.origin[2]);e.append(q,f,a.toAdd,m,b,g);a=q.vao.vertexBuffers.geometry;a.byteSize!==q.buffer.getArray().buffer.byteLength?a.setData(q.buffer.getArray()):(z=g.begin,b=g.end,z<b&&(v=q.buffer.getArray(),z*=4,a.setSubData(v,
z,z,4*b)));(g.updatedDisplayedIndexRange||q.displayedIndexRanges)&&c.add(q)}})};b.prototype.updateGeometries=function(a,b){for(var c=this._bufferWriter,e=c.vertexBufferLayout.stride/4,f=0;f<a.length;f++){var g=a[f],h=g.updateType,g=g.renderGeometry,k=this._dataByOrigin.get(g.origin.id),p=k&&k.instances.get(g.uniqueName);if(!p)break;h&1&&(p.displayedIndexRange=q.generateRenderGeometryVisibleIndexRanges(g),b.add(k));h&17&&(p.highlightedIndexRanges=q.generateRenderGeometryHighlightRanges(g),k.highlightCount=
null);h&6&&(h=k.buffer.getArray(),k=k.vao,q.calculateTransformRelToOrigin(g,y,m),c.write({transformation:y,invTranspTransformation:m},g.data,c.vertexBufferLayout.createView(h.buffer),p.from),d.assert(p.from+c.elementCount(g.data)===p.to,"material VBO layout has changed"),k.vertexBuffers.geometry.setSubData(h,p.from*e*4,p.from*e*4,p.to*e*4))}};b.prototype.updateDisplayedIndexRanges=function(a){var b=a.instances;a.displayedIndexRanges=[];var c=!0;b.forEach(function(b){b.displayedIndexRange?(a.displayedIndexRanges.push.apply(a.displayedIndexRanges,
g.offsetIntervals(b.displayedIndexRange,b.from)),c=!1):a.displayedIndexRanges.push([b.from,b.to-1])});a.displayedIndexRanges=c?null:g.mergeIntervals(a.displayedIndexRanges)};b.prototype.updateHighlightCount=function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(b){if(null==b.highlightCount){var c=0;b.instances.forEach(function(a){a.highlightedIndexRanges&&++c});b.highlightCount=c}a._highlightCount+=b.highlightCount})};b.prototype.updateLogic=function(a){return this._material.update(a)};
b.prototype.render=function(a,b,c,d){var e=this,f=this._rctx,g=this._glMaterials.get(b.pass),h=4===b.pass;2===b.pass&&null===a&&(a=20);if(!g||null!=a&&!g.beginSlot(a)||h&&0===this._highlightCount)return!1;g.bind(f,c);b=g.getProgram();b.setUniformMatrix4fv("model",v);b.hasUniform("modelNormal")&&b.setUniformMatrix4fv("modelNormal",v);var m=!1;this._dataByOrigin.forEach(function(a){h&&0===a.highlightCount||(c.origin=a.origin,g.bindView(f,c),m=h?e.renderHighlightPass(g,a,d)||m:e.renderDefaultPass(g,
a,d)||m)});g.release(f,c);return m};b.prototype.renderDefaultPass=function(a,b,c){var d=this._rctx,e=a.getProgram();a=a.getDrawMode();var f=b.displayedIndexRanges;if(f&&0===f.length)return!1;r.assertCompatibleVertexAttributeLocations(b.vao,e);d.bindVAO(b.vao);f?q.drawArraysFaceRange(d,f,0,a,c):(b=4*b.buffer.getSize()/r.getStride(b.vao.layout.geometry),q.drawArrays(d,a,0,b,c));return!0};b.prototype.renderHighlightPass=function(a,b,c){var d=this._rctx,e=a.getProgram(),f=a.getDrawMode();a=b.vao;r.assertCompatibleVertexAttributeLocations(a,
e);d.bindVAO(a);var g=!1;b.instances.forEach(function(a){var b=a.highlightedIndexRanges;if(b&&0!==b.length)for(var e=0;e<b.length;e++){var h=b[e];q.drawArrays(d,f,h.range?h.range[0]+a.from:a.from,h.range?h.range[1]-h.range[0]+1:a.to-a.from,c);g=!0}});return g};b.prototype.createData=function(a,b,c){return{instances:new Map,vao:new t(this._rctx,this._vertexAttributeLocations,{geometry:h.glLayout(a)},{geometry:p.createVertex(this._rctx,35044)}),buffer:new e.ResizableFloat32Array(b),optimalCount:0,origin:c,
highlightCount:0}};b.prototype.removeAndRebuild=function(a,b,c,d,e){for(var f=0;f<b.length;f++){var g=b[f].uniqueName,h=a.instances.get(g);a.optimalCount-=(h.to-h.from)*c;a.instances.delete(g)}var m=0,k=a.buffer.getArray();e.begin=0;e.end=0;var p=-1,v=-1,q=0;a.instances.forEach(function(a){var b=a.from*c,e=a.to*c,f=e-b;p!==v&&v!==b?(k.set(d.subarray(p,v),q),q+=v-p,p=b):-1===p&&(p=b);v=e;a.from=m/c;m+=f;a.to=m/c});p!==v&&k.set(d.subarray(p,v),q);e.end=m};b.prototype.removeByErasing=function(a,b,c,
d){d.begin=Infinity;d.end=-Infinity;for(var e=-1,f=-1,g=0;g<b.length;g++){var h=b[g].uniqueName,m=a.instances.get(h),k=m.from*c,m=m.to*c;e!==f&&f!==k?(a.buffer.erase(e,f),e=k):-1===e&&(e=k);f=m;a.instances.delete(h);a.optimalCount-=m-k;k<d.begin&&(d.begin=k);m>d.end&&(d.end=m)}e!==f&&a.buffer.erase(e,f)};b.prototype.append=function(a,b,e,f,g,h){h.updatedDisplayedIndexRange=!1;b=this._bufferWriter;for(var k=0;k<e.length;k++){var p=e[k],v=p.data;l.mat4.multiply(y,g,p.transformation);l.mat4.invert(m,
y);l.mat4.transpose(m,m);var r=h.end;b.write({transformation:y,invTranspTransformation:m},v,b.vertexBufferLayout.createView(a.buffer.getArray().buffer),h.end/f);var v=b.elementCount(v)*f,z=r+v;d.assert(null==a.instances.get(p.uniqueName));var u=q.generateRenderGeometryVisibleIndexRanges(p),x=q.generateRenderGeometryHighlightRanges(p);x&&(a.highlightCount=null);r=new c(p.name,r/f,z/f,u,x,void 0,void 0,p.idx);a.instances.set(p.uniqueName,r);u&&(h.updatedDisplayedIndexRange=!0);a.optimalCount+=v;h.end+=
v}};Object.defineProperty(b.prototype,"test",{get:function(){return{material:this._material}},enumerable:!0,configurable:!0});return b}();var w={updatedDisplayedIndexRange:!1,begin:0,end:0},u=k.mat4f64.create(),y=k.mat4f64.create(),m=k.mat4f64.create(),v=k.mat4f64.create(),z=new Set;return n})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(n,b){return function(){function b(){}b.copyIntervals=function(b){for(var h=[],a=0;a<b.length;a++){var g=b[a];
h.push([g[0],g[1]])}return h};b.convertFaceToIndexRange=function(b,h){for(var a=0;a<b.length;a++){var g=b[a];g[0]*=h;g[1]=g[1]*h+(h-1)}};b.sortIntervals=function(b){return b.sort(function(b,a){return b[0]===a[0]?b[1]>a[1]?1:b[1]<a[1]?-1:0:b[0]>a[0]?1:b[0]<a[0]?-1:0})};b.intersectIntervals=function(b,h){if(0>=b.length)return[];for(var a=[],g=0;g<b.length;g++){var e=b[g];e[1]<h[0]||e[0]>h[1]||(e=[e[0],e[1]],e[0]<h[0]&&(e[0]=h[0]),e[1]>h[1]&&(e[1]=h[1]),a.push(e))}return a};b.mergeIntervals=function(b){if(0>=
b.length)return[];var h=[];b=this.sortIntervals(b);h.push(b[0]);for(var a=1;a<b.length;a++){var g=h[h.length-1];g[1]+1<b[a][0]?h.push(b[a]):g[1]<b[a][1]&&(g[1]=b[a][1],h.pop(),h.push(g))}return h};b.invertIntervals=function(b,h){for(var a=[],g=0,e=0;e<b.length;e++){var d=b[e];d[0]>g&&a.push([g,d[0]-1]);g=d[1]+1}g<=h&&a.push([g,h]);return a};b.offsetIntervals=function(b,h){for(var a=[],g=0;g<b.length;g++){var e=b[g];a.push([e[0]+h,e[1]+h])}return a};return b}()})},"esri/views/3d/webgl-engine/lib/ResizableFloat32Array":function(){define(["require",
"exports","../../../../core/mathUtils"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){null==b?b=16:65536>b&&(b=l.nextHighestPowerOfTwo(b));this.array=new Float32Array(b);this.size=0}b.prototype.resize=function(b,a){this.size=b;var g;if(this.size>this.array.length){for(b=this.array.length||1;b<this.size;)b*=2;g=new Float32Array(b);a&&g.set(this.array);this.array=g;return!0}g=2*this.size;if(g<=this.array.length){for(b=this.array.length;b>=g;)b=Math.floor(b/
2);g=new Float32Array(b);a&&g.set(this.array.subarray(0,b));this.array=g;return!0}return!1};b.prototype.append=function(b){var a=this.size;this.resize(this.size+b.length,!0);this.array.set(b,a)};b.prototype.erase=function(b,a){for(;b<a;++b)this.array[b]=0};b.prototype.getArray=function(){return this.array};b.prototype.getSize=function(){return this.size};return b}();b.ResizableFloat32Array=n})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../lib/GLMaterial ./internal/MaterialUtil ./internal/waterMaterialUtils ../shaders/WaterSurfacePrograms ../../../webgl/renderState".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a){a=b.call(this,a)||this;a.updateParameters();return a}l(d,b);d.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters());this.selectProgram()};d.prototype._selectPipelineState=function(){this.pipelineState=e.makePipelineState({blending:this.params.transparent&&e.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:this.params.writeDepth&&e.defaultDepthWriteParams,
colorWrite:e.defaultColorWriteParams})};d.prototype.getProgramTemplate=function(){return g.color};d.prototype.selectProgram=function(){this.program=this.programRep.getProgram(this.getProgramTemplate(),{slice:this.params.slicePlaneEnabled,receiveShadows:this.params.receiveShadows});this._selectPipelineState()};d.prototype.beginSlot=function(a){var b=5;this.params.transparent&&(b=this.params.writeDepth?7:10);return a===b};d.prototype.getProgram=function(){return this.program};d.prototype._initTextures=
function(b){this.texturePaths=[this.params.waveTexture,this.params.perturbationTexture];a.waterTextureRepo.initialize(b,this.texturePaths)};d.prototype._bindUniforms=function(b,d){b.bindProgram(this.program);b.setPipelineState(this.pipelineState);a.waterTextureRepo.bindRepo(b);this.program.setUniform4fv("waterColor",this.params.color);this._setWaveUniforms(this.program)};d.prototype._setWaveUniforms=function(a){a.setUniform1i("texWaveNormal",0);a.setUniform1i("texWavePerturbation",1);a.setUniform4f("waveParams",
this.params.waveStrength,this.params.waveTextureRepeat,this.params.flowStrength,this.params.flowOffset);a.setUniform2f("waveDirection",this.params.waveDirection[0]*this.params.waveVelocity,this.params.waveDirection[1]*this.params.waveVelocity);a.setUniform1f("timeElapsed",.001*this.material.animation.time*this.params.animationSpeed)};d.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:a.shadowMappingEnabled}),
this.updateParameters())};d.prototype.bind=function(b,d){a.waterTextureRepo.ready()?(this._updateShadowState(d),this._bindUniforms(b,d)):a.waterTextureRepo.loading()||this._initTextures(b)};d.prototype.release=function(a){};d.prototype.bindView=function(a,b){a=this.program;a.setUniform3fv("localOrigin",b.origin);h.bindView(b.origin,b.view,a);h.bindCamPos(b.origin,b.viewInvTransp,a);this.params.slicePlaneEnabled&&h.bindSlicePlane(b.origin,b.slicePlane,a);b.shadowMappingEnabled&&(b.shadowMap.bind(a),
b.shadowMap.bindView(a,b.origin))};d.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};d.prototype.getDrawMode=function(){return 4};return d}(k);b.WaterGLMaterial=n;k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.prototype.bind=function(a,b){a.bindProgram(this.program);a.setPipelineState(this.pipelineState);this.program.setUniform4fv("waterColor",this.params.color)};b.prototype.bindView=function(a,b){this.program.setUniform3fv("localOrigin",
b.origin);h.bindView(b.origin,b.view,this.program)};b.prototype.beginSlot=function(a){return null==a};b.prototype.getProgramTemplate=function(){return g.drapedColor};return b}(n);b.WaterDrapedGLMaterial=k;n=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);d.prototype.bind=function(b,d){a.waterTextureRepo.ready()?(b.bindProgram(this.program),b.setPipelineState(this.pipelineState),a.waterTextureRepo.bindRepo(b),this._setWaveUniforms(this.program)):a.waterTextureRepo.loading()||
this._initTextures(b)};d.prototype.bindView=function(a,b){this.program.setUniform3fv("localOrigin",b.origin);h.bindView(b.origin,b.view,this.program)};d.prototype.beginSlot=function(a){return 20===a};d.prototype._selectPipelineState=function(){this.pipelineState=e.makePipelineState({depthTest:{func:513},depthWrite:this.params.writeDepth&&e.defaultDepthWriteParams,colorWrite:e.defaultColorWriteParams})};d.prototype.getProgramTemplate=function(){return g.drapedNormal};return d}(n);b.WaterNormalGLMaterial=
n})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Logger ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../support/imageUtils ../../../../webgl/Texture".split(" "),function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});var d=h.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");b.waterParameterDefaultsLocal=
{waveTexture:n.toUrl("../../../../../images/materials/water/normals.jpg"),perturbationTexture:n.toUrl("../../../../../images/materials/water/perturbation.jpg"),waveStrength:.06,waveTextureRepeat:32,waveDirection:a.vec2f64.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,.35686,.4,1],transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0};b.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},
"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,
perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,
waveVelocity:.15}};n=function(){function a(){this.loadingCount=0;this.data=[];this.loadingState=0}a.prototype.loadTexture=function(a,b,f){return k(this,void 0,void 0,function(){var c,h;return l(this,function(k){switch(k.label){case 0:this.loadingCount++,k.label=1;case 1:return k.trys.push([1,3,,4]),[4,g.requestImage(f)];case 2:return c=k.sent(),this.data[b]=new e(a,this.getTextureProps(c.width,c.height,!0),c),[3,4];case 3:return h=k.sent(),d.warn("Failed to load texture for water material.",h),this.data[b]=
new e(a,this.getTextureProps(1,1,!0)),[3,4];case 4:return this.loadingCount--,[2]}})})};a.prototype.getTextureProps=function(a,b,d){void 0===d&&(d=!1);return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:d,maxAnisotropy:8,width:a,height:b}};a.prototype.ready=function(){return 2===this.loadingState?!0:1===this.loadingState&&0===this.loadingCount?(this.loadingState=2,!0):!1};a.prototype.loading=function(){return 1===this.loadingState};a.prototype.initialize=function(a,
b){for(var c=0;c<b.length;c++)this.loadTexture(a,c,b[c]);this.loadingState=1};a.prototype.bindRepo=function(a){for(var b=0;b<this.data.length;b++)a.bindTexture(this.data[b],b)};return a}();b.waterTextureRepo=new n})},"esri/views/3d/webgl-engine/shaders/WaterSurfacePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(a){return h.glslifyDefineMap({SLICE:a.slice,
RECEIVE_SHADOWS:a.receiveShadows})};b.color={name:"water-ocean",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/water/colorPass.vert"),fragmentShader:a(b)+k.resolveIncludes("materials/water/colorPass.frag")}},attributes:l.Default3D};b.drapedColor={name:"water-drapedColor",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/water/drapedColorPass.vert"),fragmentShader:a(b)+k.resolveIncludes("materials/water/drapedColorPass.frag")}},attributes:l.Default3D};
b.drapedNormal={name:"water-drapedNormal",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/water/normalPass.vert"),fragmentShader:a(b)+k.resolveIncludes("materials/water/normalPass.frag")}},attributes:l.Default3D}})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/mat4","../../../../../core/libs/gl-matrix-2/mat4f64"],function(n,b,l,k){return function(){return function(b,a,g,e,d,f,c,q,p){this.name=
b;this.from=a;this.to=g;this.displayedIndexRange=e;this.highlightedIndexRanges=d;this.transformation=f;this.instanceParameters=c;this.idx=q;this.dataId=p;null!=f&&(this.transformationNormal=k.mat4f64.clone(f),l.mat4.invert(this.transformationNormal,this.transformationNormal),l.mat4.transpose(this.transformationNormal,this.transformationNormal))}}()})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../lib/ComponentUtils ../../lib/Util ../../../../webgl/Util".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});b.generateRenderGeometryVisibleIndexRanges=function(a){return a.instanceParameters.hidden?[]:h.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,a.componentOffsets)};b.generateRenderGeometryHighlightRanges=function(a){return a.instanceParameters.hidden?null:h.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets)};b.doesRenderGeometryHaveHighlights=
function(a){return a.instanceParameters.hidden?!1:h.hasHighlights(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets)};b.isRenderGeometryHidden=function(a){return a.instanceParameters.hidden?!0:h.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)};b.drawArrays=function(a,b,c,e,g){a.drawArrays(b,c,e);g&&(g.drawCalls++,4===b&&(g.triangles+=e))};b.drawElements=function(a,b,c,e,h,k){var d=g.getBytesPerElement(c);a.drawElements(b,
h,c,e*d);k&&(k.drawCalls++,4===b&&(k.triangles+=h))};b.drawArraysFaceRange=function(a,b,c,e,g){for(var d=0,f=0;f<b.length;f++){var h=b[f],k=h[0]+c,h=h[1]-h[0]+1,d=d+h;a.drawArrays(e,k,h)}g&&(g.drawCalls+=b.length,4===e&&(g.triangles=d/3))};b.drawElementsFaceRange=function(a,b,c,e,h,k){for(var d=g.getBytesPerElement(h),f=0,p=0;p<b.length;p++){var q=b[p],r=q[0]+c,q=q[1]-q[0]+1,f=f+q;a.drawElements(e,q,h,r*d)}k&&(k.drawCalls+=b.length,4===e&&(k.triangles+=f/3))};b.acquireMaterials=function(a,b){var c=
new Map;c.set(0,b.acquire(a,"color"));c.set(3,b.acquire(a,"depthShadowMap"));c.set(2,b.acquire(a,"normal"));c.set(1,b.acquire(a,"depth"));c.set(4,b.acquire(a,"highlight"));return c};b.releaseMaterials=function(a,b){b.release(a.id,"color");b.release(a.id,"depthShadowMap");b.release(a.id,"normal");b.release(a.id,"depth");b.release(a.id,"highlight")};b.calculateTransformRelToOrigin=function(b,f,c){var d=b.origin.vec3;a.setMatrixTranslation3(e,-d[0],-d[1],-d[2]);l.mat4.multiply(f,e,b.transformation);
c&&(l.mat4.invert(c,f),l.mat4.transpose(c,c))};var e=k.mat4f64.create()})},"esri/views/3d/webgl-engine/shaders/HUDPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(a){return h.glslifyDefineMap({OCCL_TEST:a.occlTest,SIGNED_DISTANCE_FIELD:a.sdf,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,
CENTER_OFFSET_UNITS_SCREEN:a.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:a.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:a.binaryHighlightOcclusion,SLICE:a.slice})};b.colorPass={name:"hud-color",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/hud/hud.vert"),fragmentShader:a(b)+k.resolveIncludes("materials/hud/colorPass.frag")}},attributes:l.Default3D};b.highlightPass={name:"hud-highlight",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/hud/hud.vert"),
fragmentShader:a(b)+k.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:l.Default3D};b.occlusionPass={name:"hud-occlusion",shaders:function(a){return{vertexShader:h.glslifyDefineMap({VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:a.centerOffsetUnitsScreen,SLICE:a.slice})+k.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:k.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:l.Default3D}})},"esri/views/support/index":function(){define(["require",
"exports","./Scheduler"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.noBudget=l.noBudget;b.Task=l.Task})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./graphicSymbolUtils ./labelPlacement ../../support/debugFlags ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../../support/index".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.idHint="__labeler";a._dirty=!1;a.labels=new Map;a.labelsToAdd=new Map;a.labelsToRemove=new Map;a.labelingContexts=[];return a}l(g,b);g.prototype.setup=function(){var a=this;this.handles||(this.handles=new d,this.handles.add([this.view.watch("state.camera",function(){return a.setDirty()}),this.view.watch("pixelRatio",
function(){return a.resetAllLabels()})]));this.textTextureAtlas||(this.textTextureAtlas=new C.default({idHint:this.idHint+"_atlas",view:this.view}),this.hudMaterialCollection=new v(this.view._stage),this.calloutMaterialCollection=new v(this.view._stage));this.handles.add(this.view.resourceController.scheduler.registerTask(D.Task.LABELER,function(b){return a.update(b)},function(){return a.needsUpdate()}))};g.prototype.dispose=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.textTextureAtlas&&
(this.textTextureAtlas.dispose(),this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=[];this.labels.clear();this.labelsToAdd.clear();this.labelsToRemove.clear()};g.prototype.isActiveLabelingContext=function(a){return a.active&&this.labelsEnabled(a)};g.prototype.activateLabelingContext=function(a){var b=
this;a.labels.forEach(function(a,c){b.labels.set(c,a);a.graphics3DGraphic.setVisibilityFlag(0,!0,1)});a.active=!0};g.prototype.deactivateLabelingContext=function(a){var b=this;a.labels.forEach(function(a,c){a.graphics3DGraphic.setVisibilityFlag(0,!1,1);a.rendered&&b.labelsToRemove.set(c,a);b.labels.delete(c);b.labelsToAdd.delete(c)});a.active=!1};g.prototype.addLabelTextureToAtlas=function(a){for(var b=0;b<a.graphics3DGraphic._labelGraphics.length;b++){var c=a.graphics3DGraphic._labelGraphics[b];
if(c._labelClass){var d=a.textRenderers[c._labelIndex];d&&this.textTextureAtlas.addTextTexture(d,c.stageObject)}}a.rendered=!0};g.prototype.removeLabelTextureFromAtlas=function(a){for(var b=a.graphics3DGraphic,c=0;c<b._labelGraphics.length;c++){var d=b._labelGraphics[c];d._labelClass&&(d=a.textRenderers[d._labelIndex])&&this.textTextureAtlas.removeTextTexture(d,b._labelGraphics[c].stageObject)}a.rendered=!1};g.prototype.needsUpdate=function(){return this.view.ready&&this.isDirty};g.prototype.update=
function(a){for(var b=this,c=this._dirty=!1,d=function(d){if(!e.isActiveLabelingContext(d))return"continue";if(!e.hasValidLabelClassContext(d)){if(e.hasInvalidLabelClassContext(d))return e.deactivateLabelingContext(d),"continue";e.createLabelClassContext(d);if(e.hasPendingLabelClassContext(d))return e._dirty=!0,"continue";if(!e.hasValidLabelClassContext(d))return"continue"}d.labelsToInitialize.forEach(function(e,f){b.ensureGraphics3DResources(e)&&(b.labels.set(f,e),c=!0);(e.visible&&e.hasTextTextureResources||
!e.visible&&e.hasGraphics3DResources)&&d.labelsToInitialize.delete(f);a&&(a.madeProgress(),a.done&&(b._dirty=!0))})},e=this,f=0,g=this.labelingContexts;f<g.length;f++)d(g[f]);a&&c&&this.view.deconflictor.setDirty();this.labelsToRemove.forEach(function(a){return b.removeLabelTextureFromAtlas(a)});this.labelsToRemove.clear();this.labelsToAdd.forEach(function(a){return b.addLabelTextureToAtlas(a)});this.labelsToAdd.clear();this._dirty||this.notifyChange("updating")};g.prototype.hasPendingLabelClassContext=
function(a){return a.labelClassPromise&&!!a.labelClassAbortController};g.prototype.hasValidLabelClassContext=function(a){return a.labelClassContexts&&a.labelClassContexts.length};g.prototype.hasInvalidLabelClassContext=function(a){return null===a.labelClassContexts};g.prototype.createLabelClassContextAsync=function(b){return a(this,void 0,void 0,function(){var d,f,g,m,k,p=this;return h(this,function(v){switch(v.label){case 0:return d=b.labelClassAbortController.signal,[4,b.layer.when()];case 1:v.sent();
c.throwIfAborted(d);b.scaleVisibility&&b.scaleVisibility.updateScaleRangeActive();f=b.graphics3DCore;g=f.layer;m=g.labelingInfo&&g.labelingInfo.filter(function(a){return!!a.symbol});if(!m||0===m.length)return[2,null];k=Array(m.length);return[4,e.forEach(m,function(g,m){return a(p,void 0,void 0,function(){var a,p,v,q;return h(this,function(h){switch(h.label){case 0:return a=g.symbol,p=w.getGraphics3DSymbol(f.getOrCreateGraphics3DSymbol(a)),[4,p.load()];case 1:h.sent();c.throwIfAborted(d);v=null;if(!t.isCalloutSupport(a)||
!a.hasVisibleCallout())return[3,3];v=x.make(a,f.symbolCreationContext);return[4,v.load()];case 2:h.sent(),c.throwIfAborted(d),h.label=3;case 3:return[4,e.result(r.createLabelFunction(g,b.layer.fields.map(function(a){return a.toJSON()}),this.view.spatialReference))];case 4:return q=h.sent(),c.throwIfAborted(d),!0===q.ok&&(k[m]={labelClass:g,labelFunction:q.value,graphics3DSymbol:p,graphics3DCalloutSymbolLayer:v,calloutSymbolLayerIndex:0,textRenderParameters:this.createTextRenderParameters(p.symbol)}),
[2]}})})})];case 2:return v.sent(),c.throwIfAborted(d),b.labelClassContexts=k,[2]}})})};g.prototype.createLabelClassContext=function(b){return a(this,void 0,void 0,function(){var a=this;return h(this,function(d){b.labelClassPromise||(b.labelClassPromise=this.createLabelClassContextAsync(b).catch(function(a){if(c.isAbortError(a))throw a;b.labelClassContexts=null}).then(function(){b.labelClassAbortController=null;a.notifyChange("updating")}),this.notifyChange("updating"));return[2,b.labelClassPromise]})})};
g.prototype.createTextRenderParameters=function(a){return(a=a.symbolLayers.getItemAt(0))&&"text"===a.type?B.default.fromSymbol(a,this.view.pixelRatio):null};g.prototype.destroyLabelClassContext=function(a){for(var b=0,d=a.labelClassContexts;b<d.length;b++){var e=d[b];--e.graphics3DSymbol.referenced;e.graphics3DSymbol=null}b=a.labelClassAbortController;a.labelClassAbortController=c.createAbortController();b&&b.abort();a.labelClassContexts=[];a.labelClassPromise=null;this.notifyChange("updating")};
g.prototype.createTextSymbolGraphic=function(a,b,c,d,e){a={text:a.text,centerOffset:c.centerOffset,translation:c.translation,elevationOffset:c.elevationOffset,screenOffset:c.screenOffset,anchor:c.anchor,centerOffsetUnits:c.centerOffsetUnits,verticalOffset:c.verticalOffset,debugDrawBorder:y.LABELS_SHOW_BORDER,displayWidth:a.displayWidth,displayHeight:a.displayHeight};K.graphic=b;K.renderingInfo=null;K.layer=d;return e.createLabel(K,a,this.hudMaterialCollection,this.textTextureAtlas)};g.prototype.createLineCalloutGraphic=
function(a,b,c,d,e){b={symbol:b,translation:d.translation,elevationOffset:d.elevationOffset,screenOffset:d.screenOffset,centerOffset:d.centerOffset,centerOffsetUnits:d.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};K.graphic=a;K.renderingInfo=b;K.layer=e;return c.createGraphics3DGraphic(K)};g.prototype.ensureGraphics3DResources=function(a){var b=a.graphics3DGraphic;if(b.destroyed||a.hasGraphics3DResources)return!1;this.ensureTextTextureResources(a);var c=a.labelingContext,d=
!1,e=b.graphic,g=c.labelClassContexts,h=c.layer,m=this.labelsEnabled(c);if(!g||0===g.length||!b._graphics[0])return!1;for(var k=0;k<g.length;k++){var p=g[k],v=p.labelClass,q=a.textRenderers[k];if(q){var r=p.graphics3DSymbol,z=null;r.symbol&&"label-3d"===r.symbol.type&&(z=r.symbol);var y=r.symbolLayers[0],r=u.get({graphics3DGraphic:b,labelSymbol:z,labelClass:p.labelClass});if(y&&!f.isNone(r)){if(d=this.createTextSymbolGraphic(q,e,r,h,y)){if(d._labelClass=v,d._labelIndex=k,b.addLabelGraphic(d,c.stageLayer,
this.view._stage),b.setVisibilityFlag(0,m,1),b.clearVisibilityFlag(1,1),b.setVisibilityFlag(3,!1,1),d=!0,p.graphics3DCalloutSymbolLayer&&r.hasLabelVerticalOffset&&(e=this.createLineCalloutGraphic(e,z,p.graphics3DCalloutSymbolLayer,r,h)))p.calloutSymbolLayerIndex=b._labelGraphics.length,b.addLabelGraphic(e,c.stageLayer,this.view._stage)}else return!1;break}}}c.scaleVisibility&&d&&c.scaleVisibility.updateGraphicLabelScaleVisibility(b);return a.hasGraphics3DResources=!0};g.prototype.destroyGraphics3DResources=
function(a){for(var b=a.labelingContext.labelClassContexts,c=0,d=a.graphics3DGraphic._labelGraphics;c<d.length;c++){var e=d[c];if(null!=e._labelClass){var f=b[e._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=f)f.onRemoveGraphic(e)}}a.graphics3DGraphic.clearLabelGraphics();a.hasGraphics3DResources=!1};g.prototype.ensureTextTextureResources=function(a){if(!a.hasTextTextureResources){var b=a.labelingContext,c=b.labelClassContexts,d=a.graphics3DGraphic.graphic;if(c&&0!==c.length){for(var e=0;e<
c.length;e++){var g=c[e];a.textRenderers[e]=null;if(g.textRenderParameters){var h=g.labelFunction,m=void 0;if("arcade"===h.type){var k=p.hydrateGraphic(d,b.layer);try{m=h.evaluate(k)}catch(X){m=null}}else m=h.evaluate(d);f.isNone(m)||""===m||(a.textRenderers[e]=new z.default(m,g.textRenderParameters))}}a.hasTextTextureResources=!0}}};g.prototype.destroyTextTextureResources=function(a){a.textRenderers=[];a.hasTextTextureResources=!1};g.prototype.addGraphic=function(a,b){var c={hasGraphics3DResources:!1,
hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:a,graphics3DGraphic:b,textRenderers:[]};b=b.graphic.uid;a.labels.set(b,c);this.isActiveLabelingContext(a)&&this.hasValidLabelClassContext(a)&&this.ensureGraphics3DResources(c)?this.labels.set(b,c):a.labelsToInitialize.set(b,c);this.setDirty(a.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};g.prototype.removeGraphic=function(a,b){b=b.graphic.uid;var c=a.labels.get(b);c&&(this.destroyGraphic(c,b),a.labels.delete(b),a.labelsToInitialize.delete(b),
this.setDirty(a.graphics3DCore.asyncUpdates),this.view.deconflictor.setDirty())};g.prototype.labelsEnabled=function(a){return!0===a.layer.labelsVisible&&null!=a.layer.labelingInfo&&0<a.layer.labelingInfo.length};g.prototype.destroyGraphic=function(a,b){this.labels.has(b)&&(this.labels.delete(b),this.labelsToAdd.delete(b),this.labelsToRemove.delete(b));a.hasTextTextureResources&&(this.removeLabelTextureFromAtlas(a),this.destroyTextTextureResources(a));a.hasGraphics3DResources&&this.destroyGraphics3DResources(a)};
g.prototype.labelingInfoChange=function(b,c){return a(this,void 0,void 0,function(){var a,d,e,f;return h(this,function(g){if(c){a=0;for(d=c;a<d.length;a++)if(e=d[a],f=b.labels.get(e))this.removeGraphic(b,f.graphics3DGraphic),this.addGraphic(b,f.graphics3DGraphic);return[2]}this.visibilityInfoChange(b);this.resetLabels(b);return[2,this.createLabelClassContext(b)]})})};g.prototype.globalPropertyChanged=function(a,b){for(var c=function(c){var d=new Map;b.labels.forEach(function(a){a=a.graphics3DGraphic;
d.set(a.graphic.uid,a)});f.expect(c.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(a,d,function(a){return a._labelGraphics[0]});c.graphics3DCalloutSymbolLayer&&c.graphics3DCalloutSymbolLayer.globalPropertyChanged(a,d,function(a){return a._labelGraphics[c.calloutSymbolLayerIndex]})},d=0,e=b.labelClassContexts;d<e.length;d++)c(e[d])};g.prototype.visibilityInfoChange=function(a){var b=a.layer.labelsVisible;b&&!a.active&&this.activateLabelingContext(a);!b&&a.active&&this.deactivateLabelingContext(a);
this.setDirty(a.graphics3DCore.asyncUpdates)};g.prototype.resetAllLabels=function(){for(var a=0,b=this.labelingContexts;a<b.length;a++)this.resetLabels(b[a])};g.prototype.resetLabels=function(a){var b=this;a.labels.forEach(function(c,d){b.destroyGraphic(c,d);c.visible=!1;c.rendered=!1;a.labelsToInitialize.set(d,c)});this.destroyLabelClassContext(a);this.setDirty(a.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};g.prototype.findLabelingContext=function(a){for(var b=0,c=this.labelingContexts;b<
c.length;b++){var d=c[b];if(d.graphics3DCore===a)return d}return null};g.prototype.addGraphicsOwner=function(a,b){var d=this;if(!this.findLabelingContext(a)){var e=a.layer,f={graphics3DCore:a,layer:e,scaleVisibility:b,active:a.layer.labelsVisible,labelClassPromise:null,labelClassAbortController:c.createAbortController(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new m(this.idHint+"_"+e.uid,{isPickable:!0},e.uid)};this.view._stage.add(0,f.stageLayer);this.view._stage.addToViewContent([f.stageLayer.id]);
this.labelingContexts.push(f);this.setDirty();return{addGraphic:function(a){return d.addGraphic(f,a)},removeGraphic:function(a){return d.removeGraphic(f,a)},featureReductionChange:function(){},layerLabelsEnabled:function(){return d.labelsEnabled(f)},labelingInfoChange:function(a){return d.labelingInfoChange(f,a)},elevationInfoChange:function(){return d.globalPropertyChanged("elevationInfo",f)},slicePlaneEnabledChange:function(){return d.globalPropertyChanged("slicePlaneEnabled",f)},visibilityInfoChange:function(){return d.visibilityInfoChange(f)},
reset:function(){return d.resetLabels(f)},clear:function(){},processStageDirty:function(){return d.view._stage.processDirtyLayer(f.stageLayer.id)}}}};g.prototype.removeGraphicsOwner=function(a){var b=this,c=this.findLabelingContext(a);c&&(a=this.labelingContexts.indexOf(c),this.labelingContexts.splice(a,1),c.labels.forEach(function(a){return b.removeGraphic(c,a.graphics3DGraphic)}),a=c.stageLayer.id,this.view._stage.removeFromViewContent([a]),this.view._stage.remove(0,a),c.stageLayer=null,this.setDirty())};
g.prototype.setLabelGraphicVisibility=function(a,b){a=a.graphic.uid;var c=this.labels.get(a);c&&(b&&!c.rendered?(this.labelsToAdd.set(a,c),this.labelsToRemove.delete(a),c.hasTextTextureResources||c.labelingContext.labelsToInitialize.set(a,c)):!b&&c.rendered&&(this.labelsToRemove.set(a,c),this.labelsToAdd.delete(a)),c.visible=b,this.setDirty(c.labelingContext.graphics3DCore.asyncUpdates))};Object.defineProperty(g.prototype,"isDirty",{get:function(){return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.isDirty},
enumerable:!0,configurable:!0});g.prototype.setDirty=function(a){void 0===a&&(a=!0);var b=this._dirty;this._dirty||(this._dirty=!0);a||this.update(null);b!==this._dirty&&this.notifyChange("updating")};Object.defineProperty(g.prototype,"updating",{get:function(){var a=this;return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.updating||this.labelingContexts.some(function(b){return a.hasPendingLabelClassContext(b)})},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"test",
{get:function(){return{textTextureAtlas:this.textTextureAtlas}},enumerable:!0,configurable:!0});k([q.property({constructOnly:!0})],g.prototype,"view",void 0);k([q.property()],g.prototype,"textTextureAtlas",void 0);k([q.property({type:Boolean,readOnly:!0,dependsOn:["textTextureAtlas.updating"]})],g.prototype,"updating",null);return g=k([q.subclass("esri.views.3d.layers.graphics.Labeler")],g)}(q.declared(g));b.Labeler=n;var K={graphic:null,renderingInfo:null,layer:null}})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/Logger ../../core/promiseUtils ../../intl/date ../../intl/number ./FieldsIndex ./fieldUtils ../../support/arcadeOnDemand".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(){return a(this,void 0,void 0,function(){return h(this,function(a){return[2,d.create(function(a){n(["../../core/sql/WhereClause"],a)})]})})}function x(a,b,d,e){a=p.getField(e,a);if(!a)return b;if(null==d[a.name])return"";if(b=a.domain)if("codedValue"===b.type||"coded-value"===b.type){e=d[a.name];var g=0;for(b=b.codedValues;g<b.length;g++){var h=b[g];if(h.code===e)return h.name}}else if("range"===b.type&&(e=+d[a.name],g="range"in b?b.range[1]:b.maxValue,
("range"in b?b.range[0]:b.minValue)<=e&&e<=g))return b.name;d=d[a.name];"date"===a.type||"esriFieldTypeDate"===a.type?d=f.formatDate(d,f.convertDateFormatToIntlOptions("short-date")):p.isNumericField(a)&&(d=c.formatNumber(+d));return d?d:""}Object.defineProperty(b,"__esModule",{value:!0});var w=e.getLogger("esri.layers.support.labelFormatUtils"),u={type:"simple",evaluate:function(a){return null}};b.createLabelFunction=function(b,c,d){return a(this,void 0,void 0,function(){var a,e,f,m,k,p,v,y;return h(this,
function(h){switch(h.label){case 0:if(!b||!b.symbol)return[2,u];a=b.where;e=b.getLabelExpression();return a?[4,t()]:[3,2];case 1:return m=h.sent(),[3,3];case 2:m=null,h.label=3;case 3:return f=m,"arcade"!==e.type?[3,5]:[4,r.createLabelExpression(e.expression,d,c)];case 4:return p=h.sent(),k={type:"arcade",evaluate:function(a){try{var b=p.evaluate({$feature:p.repurposeFeature(a)});if(null!=b)return b.toString()}catch(R){w.error(new g("bad-arcade-expression","Encountered an error when evaluating label expression for feature",
{feature:a,expression:e}))}return null}},[3,6];case 5:k={type:"simple",evaluate:function(a){var b=a&&a.attributes;return b?e.expression.replace(/{[^}]*}/g,function(a){return x(a.slice(1,-1),a,b,c)}):null}},h.label=6;case 6:if(a){try{v=f.WhereClause.create(a,new q(c))}catch(L){return[2,u]}y=k.evaluate;k.evaluate=function(a){return v.testFeature(a)?y(a):null}}return[2,k]}})})};b.formatField=x})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require","exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=l.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");b.make=function(b,d){if(!k.isCalloutSupport(b))return a.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+b.type+"' does not support callouts"),null;if(!b.callout)return null;var e=g[b.callout.type];return e?new e(b,d):
(a.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+b.callout.type),null)};var g={line:h.default}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./symbolComplexity ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u){Object.defineProperty(b,"__esModule",{value:!0});var y,m,v=w.VertexAttrConstants;n=function(b){function m(a,c){a=b.call(this,a,null,c,!0)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}l(m,b);m.prototype.doLoad=function(){return h(this,void 0,void 0,function(){return k(this,function(a){this._material=new u(this.materialParameters,this._getIdHint("_lineCallout_common"));this._context.stage.add(3,this._material);
return[2]})})};m.prototype.destroy=function(){b.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)};m.prototype.perInstanceMaterialParameters=function(a){var b=this.materialParameters;b.screenOffset=a.screenOffset||[0,0];b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};Object.defineProperty(m.prototype,"materialParameters",{get:function(){var b=this.symbol,c=b.callout,d=g.isSome(c.color)?a.toUnitRGBA(c.color):[0,0,0,0];d[3]*=
this._getLayerOpacity();var f=e.pt2px(c.size||0),h=null;if(b.verticalOffset)var h=b.verticalOffset,m=h.minWorldLength,k=h.maxWorldLength,h={screenLength:e.pt2px(h.screenLength),minWorldLength:m||0,maxWorldLength:null!=k?k:Infinity};c=g.isSome(c.border)&&g.isSome(c.border.color)?a.toUnitRGBA(c.border.color):null;m="object"===b.symbolLayers.getItemAt(0).type;return{color:d,size:f,verticalOffset:h,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:
null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:c,occlusionTest:!m,shaderPolygonOffset:m?0:void 0,depthHUDAlignStart:"label-3d"===b.type,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!0,configurable:!0});m.prototype._defaultElevationInfoNoZ=function(){return C};m.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;var c=this.getGraphicElevationContext(a,b.elevationOffset||0),d=b.symbol,e="on-the-ground"===this._elevationContext.mode&&("cim"===
d.type||!d.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type}));if("label-3d"!==d.type&&e)return null;d=p.computeCentroid(a.geometry);return g.isNone(d)?null:this._createAs3DShape(a,d,c,b,"graphic"+a.uid,a.uid)};m.prototype.layerOpacityChanged=function(){this._material.setParameterValues(this.materialParameters);return!0};m.prototype.layerElevationInfoChanged=function(a,b,d){var e=this;d=c.elevationModeChangeUpdateType(m.elevationModeChangeTypes,d,this._elevationContext.mode);
if(d!==c.SymbolUpdateType.UPDATE)return d;a.forEach(function(a){var c=b(a);g.isSome(c)&&e.updateGraphicElevationContext(a.graphic,c)});return d};m.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};m.prototype.physicalBasedRenderingChanged=function(a,b){return!0};m.prototype.pixelRatioChanged=function(a,b){return!0};m.prototype.getGraphicElevationContext=function(a,c){void 0===c&&(c=0);a=b.prototype.getGraphicElevationContext.call(this,
a);a.addOffsetRenderUnits(c);return a};m.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=c.needsElevationUpdates2D(a.mode)};m.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,estimated:!1,memory:r.emptySymbolComplexity.memory}};m.prototype.createVertexData=function(a){var b,c=a.translation;a=a.centerOffset;if(!c&&!a)return z;c=c?{size:3,
data:[c[0],c[1],c[2]]}:z[v.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:z[v.AUXPOS1];return b={},b[v.POSITION]=c,b[v.NORMAL]=z[v.NORMAL],b[v.AUXPOS1]=a,b};m.prototype.getOrCreateMaterial=function(a,b){var c=this.perInstanceMaterialParameters(a),d=u.uniqueMaterialIdentifier(c);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var e=a.materialCollection.getMaterial(d);e||(e=new u(c,b+"_lineCallout_shared"),a.materialCollection.addMaterial(d,
e));return{material:e,isUnique:!1}}e=new u(c,b+"_lineCallout_unique");return{material:e,isUnique:!0}};m.prototype._createAs3DShape=function(a,b,e,g,h,m){a=new x.GeometryData(this.createVertexData(g),B,x.GeometryData.DefaultOffsets,"point");a=[new t(a,h)];var k=this.getOrCreateMaterial(g,h);h=c.createStageObjectForPoint(this._context,b,a,[k.material],null,null,e,h,this._context.layer.uid,m,!0);if(null===h)return null;m=new f(this,h.object,a,k.isUnique?[k.material]:null,null,d.perObjectElevationAligner,
e);m.metadata={elevationOffset:g.elevationOffset||0};m.alignedTerrainElevation=h.terrainElevation;m.needsElevationUpdates=c.needsElevationUpdates2D(e.mode);c.extendPointGraphicElevationContext(m,b,this._context.elevationProvider);return m};m.elevationModeChangeTypes={definedChanged:c.SymbolUpdateType.UPDATE,staysOnTheGround:c.SymbolUpdateType.UPDATE,onTheGroundChanged:c.SymbolUpdateType.RECREATE};return m}(q.Graphics3DSymbolLayer);b.Graphics3DLineCalloutSymbolLayer=n;var z=(y={},y[v.POSITION]={size:3,
data:[0,0,0]},y[v.NORMAL]={size:3,data:[0,0,1]},y[v.AUXPOS1]={size:4,data:[0,0,0,1]},y);y=new Uint32Array([0]);var B=(m={},m[v.POSITION]=y,m[v.NORMAL]=y,m[v.AUXPOS1]=y,m),C={mode:"relative-to-ground",offset:0};b.default=n})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ./Graphics3DSymbolCommonCode ./graphicUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){Object.defineProperty(b,"__esModule",{value:!0});var p=q.VertexAttrConstants,r=new g,t=a.vec3f64.create(),x=a.vec3f64.create(),w=a.vec3f64.create(),u=k.mat4f64.create(),y=a.vec3f64.create(),m={verticalDistanceToGround:0,terrainElevation:0};b.perVertexElevationAligner=function(a,c,d,g){a=a.stageObject;r.spatialReference=d.spatialReference;for(var h=a.geometryRecords,k=h.length,v="absolute-height"!==c.mode,q=0,z=0;z<k;z++){var y=h[z].geometry,u=h[z].getShaderTransformation();
x[0]=u[12];x[1]=u[13];x[2]=u[14];y.invalidateBoundingInfo();for(var u=y.data.getVertexAttr(),l=u[p.POSITION],y=l.data,u=u.mapPos.data,l=l.size,B=y.length/l,C=0,n=0,D=!1,X=0,P=0;P<B;P++){r.x=u[n++];r.y=u[n++];r.z=u[n++];w[0]=y[C];w[1]=y[C+1];w[2]=y[C+2];var V=e.computeElevation(d,r,c,g,v?m:null);v&&(X+=m.terrainElevation);t[0]=y[C]+x[0];t[1]=y[C+1]+x[1];t[2]=y[C+2]+x[2];g.setAltitude(V,t);y[C]=t[0]-x[0];y[C+1]=t[1]-x[1];y[C+2]=t[2]-x[2];if(f.TESTS_DISABLE_UPDATE_THRESHOLDS)D=!0;else if(V=b.updateThresholdInMeters/
g.unitInMeters,Math.abs(w[0]-y[C])>=V||Math.abs(w[1]-y[C+1])>=V||Math.abs(w[2]-y[C+2])>=V)D=!0;C+=l}q+=X/B;D&&a.geometryVertexAttrsUpdated(z)}return q/k};b.perObjectElevationAligner=function(a,g,k,p,q){a=a.stageObject;var r=g.centerPointInElevationSR,z=0;q=0;if(a.metadata.usesVerticalDistanceToGround)z=e.computeElevation(k,r,g,p,m),d.updateVertexAttributeAuxpos1w(a,m.verticalDistanceToGround),q=m.terrainElevation;else{var u="absolute-height"!==g.mode,z=e.computeElevation(k,r,g,p,u?m:null);u&&(q=m.terrainElevation)}g=
l.mat4.copy(v,a.objectTransformation);k=h.vec3.set(y,g[12],g[13],g[14]);f.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(t[0]=r.x,t[1]=r.y,t[2]=z,c.computeLinearTransformation(r.spatialReference,t,g,p.spatialReference)&&(a.objectTransformation=g)):p.setAltitudeOfTransformation(z,g);p=b.updateThresholdInMeters/p.unitInMeters;if(Math.abs(g[12]-k[0])>=p||Math.abs(g[13]-k[1])>=p||Math.abs(g[14]-k[2])>=p)a.objectTransformation=g;return q};var v=k.mat4f64.create();b.perLodInstanceElevationAligner=function(a,
d,g,k,p){var v=d.centerPointInElevationSR,q=0;p=0;var r="absolute-height"!==d.mode,q=e.computeElevation(g,v,d,k,r?m:null);r&&(p=m.terrainElevation);d=a.graphics3DSymbolLayer.lodRenderer.instanceData;a=a.instanceIndex;d.getGlobalTransform(a,u);g=h.vec3.set(y,u[12],u[13],u[14]);f.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(t[0]=v.x,t[1]=v.y,t[2]=q,c.computeLinearTransformation(v.spatialReference,t,u,k.spatialReference)&&d.setGlobalTransform(a,u)):k.setAltitudeOfTransformation(q,u);k=b.updateThresholdInMeters/
k.unitInMeters;(Math.abs(u[12]-g[0])>=k||Math.abs(u[13]-g[1])>=k||Math.abs(u[14]-g[2])>=k)&&d.setGlobalTransform(a,u);return p};b.updateThresholdInMeters=.01;b.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../geometry ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/coordsUtils ../../../../geometry/support/triangulationUtils ../../../../layers/graphics/dehydratedFeatures ./graphicUtils ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){function r(a,b,c,d,e){var f=b.z||0,g=c.featureExpressionInfoContext;switch(c.mode){case "on-the-ground":return c=a.getElevation(b,"ground")||0,e&&(e.verticalDistanceToGround=0,e.terrainElevation=c),c;case "relative-to-ground":return a=a.getElevation(b,"ground")||0,c=c.calculateOffsetRenderUnits(d),null==g&&(c+=f),e&&(e.verticalDistanceToGround=c,e.terrainElevation=a),c+a;case "relative-to-scene":return a=a.getElevation(b,"scene")||0,c=c.calculateOffsetRenderUnits(d),
e&&(e.verticalDistanceToGround=c,e.terrainElevation=a),c+a;case "absolute-height":return c=c.calculateOffsetRenderUnits(d),null==g&&(c+=f),e&&(a=a.getElevation(b,"ground")||0,e.verticalDistanceToGround=c-a,e.terrainElevation=a),c;default:k.neverReached(c.mode)}return 0}function t(a,b,c,d,e,f,g,h){var m=h.mode,k=0,p=0,v=0;g=h.calculateOffsetRenderUnits(g);h=h.featureExpressionInfoContext;C.spatialReference=a.spatialReference;c*=3;e*=3;for(var q=0;q<f;++q){C.x=b[c+0];C.y=b[c+1];C.z=b[c+2];switch(m){case "on-the-ground":p=
k=a.getElevation(C)||0;v+=k;break;case "relative-to-ground":k=a.getElevation(C)||0;p=k+g;null==h&&(p+=C.z);v+=k;break;case "relative-to-scene":k=a.getElevation(C,"scene")||0;p=k+g;v+=k;break;case "absolute-height":p=g,null==h&&(p+=C.z)}d[e+0]=b[c+0];d[e+1]=b[c+1];d[e+2]=p;c+=3;e+=3}return{terrainElevation:v/f}}function x(a,b){a=d.pathsToTriangulationInfo(a,b);return{vertexData:a.position,polygons:a.polygons,outlines:a.outlines}}function w(a,b,c,d,e){b*=3;d*=3;for(var f=0;f<e;++f)c[d++]=a[b++],c[d++]=
a[b++],c[d++]=a[b++]}function u(a,b,c,d,e,f,g){return q.bufferToBuffer(a,c,b,d,f,e,g)}function y(a,b,c){q.pointToVector(a,b,c)}function m(a,b){return!(a[0]>b[3]||a[0]<b[0]||a[1]>b[4]||a[1]<b[1])}function v(a,b){return!(b[0]>a[3]||b[3]<a[0]||b[1]>a[4]||b[4]<a[1])}Object.defineProperty(b,"__esModule",{value:!0});var z=g.vec3f64.create(),B=a.mat4f64.create(),C=f.makeDehydratedPoint(0,0,0,null);b.createStageObjectForPoint=function(a,b,d,e,f,g,k,v,u,x,t,w){var l=d?d.length:0,C=a.clippingExtent;y(b,z,a.elevationProvider.spatialReference);
if(C&&!m(z,C))return null;y(b,z,a.renderSpatialReference);C=a.localOriginFactory.getOrigin(z);v=new p({castShadow:!1,metadata:{layerUid:u,graphicUid:x,usesVerticalDistanceToGround:!!t},idHint:v});for(u=0;u<l;u++)v.addGeometry(d[u],e[u],f?f[u]:B,g,C,w);d=a.renderSpatialReference;e=a.elevationProvider;f=a.renderCoordsHelper;a=0;var L;v.metadata.usesVerticalDistanceToGround?(a=r(e,b,k,f,I),c.updateVertexAttributeAuxpos1w(v,I.verticalDistanceToGround),L=I.terrainElevation):(g="absolute-height"!==k.mode,
a=r(e,b,k,f,g?I:null),g&&(L=I.terrainElevation));k=h.mat4.copy(D,v.objectTransformation);z[0]=b.x;z[1]=b.y;z[2]=a;q.computeLinearTransformation(b.spatialReference,z,k,d)?v.objectTransformation=k:console.warn("Could not locate symbol object properly, it might be misplaced");return{object:v,terrainElevation:L}};b.extendPointGraphicElevationContext=function(a,b,c){a=a.elevationContext;c=c.spatialReference;y(b,z,c);a.centerPointInElevationSR=f.makeDehydratedPoint(z[0],z[1],b.hasZ?z[2]:0,c)};b.placePointOnGeometry=
function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return c.computeCentroid(a);case "polyline":var b=a.paths[0];if(!b||0===b.length)break;b=e.getPointOnPath(b,e.getPathLength(b)/2);return f.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference);case "mesh":return a.extent.center}return null};b.computeElevation=r;b.applyElevation=t;var D=a.mat4f64.create();b.copyPathData=x;b.copyVertices=w;b.applyOrigin=function(a,b,c,d){var e=Math.floor(b+(c-1)/2);d[0]=a[3*e+0];d[1]=a[3*
e+1];d[2]=a[3*e+2];b*=3;for(e=0;e<c;++e)a[b++]-=d[0],a[b++]-=d[1],a[b++]-=d[2]};b.setZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]=d,b+=3};b.offsetZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]+=d,b+=3};b.scaleZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]*=d,b+=3};b.flatArrayToArrayOfArrays=function(a,b,c){var d=[];b*=3;for(var e=0;e<c;++e)d.push([a[b++],a[b++],a[b++]]);return d};b.reproject=u;b.reprojectPoint=y;b.getGeometryVertexData3D=function(a,b,c,d,e,f,g){var h=e.spatialReference;
a=x(a,b);b=a.vertexData;var m=b.length/3,k=new Float64Array(b.length),p=!0;c.equals(h)?w(b,0,k,0,b.length):p=u(b,0,c,k,0,h,m);c=t(e,k,0,b,0,m,f,g);h.equals(d)||u(b,0,h,b,0,d,m);return{geometryData:a,vertexData:b,projectionSuccess:p,eleVertexData:k,terrainElevation:c.terrainElevation}};b.getGeometryVertexDataDraped=function(a,b,c){a=x(a,!1);var d=a.vertexData,e=d.length/3,f=!0;b.equals(c)||(f=q.bufferToBuffer(d,b,0,d,c,0,e));return{geometryData:a,vertexData:d,projectionSuccess:f}};b.computeBoundingBox=
function(a,b,c,d){d[0]=Number.MAX_VALUE;d[1]=Number.MAX_VALUE;d[2]=Number.MAX_VALUE;d[3]=-Number.MAX_VALUE;d[4]=-Number.MAX_VALUE;d[5]=-Number.MAX_VALUE;b*=3;for(var e=0;e<c;++e){var f=a[b++],g=a[b++],h=a[b++];f<d[0]&&(d[0]=f);g<d[1]&&(d[1]=g);h<d[2]&&(d[2]=h);f>d[3]&&(d[3]=f);g>d[4]&&(d[4]=g);h>d[5]&&(d[5]=h)}return d};var K;(function(a){a[a.NONE=0]="NONE";a[a.UPDATE=1]="UPDATE";a[a.RECREATE=2]="RECREATE"})(K=b.SymbolUpdateType||(b.SymbolUpdateType={}));b.elevationModeChangeUpdateType=function(a,
b,c){return null==b||null==c?a.definedChanged:"on-the-ground"===b&&"on-the-ground"===c?a.staysOnTheGround:b===c||"on-the-ground"!==b&&"on-the-ground"!==c?K.UPDATE:a.onTheGroundChanged};b.getGeometryAsPolygon=function(a){switch(a.type){case "extent":return l.Polygon.fromExtent(a);case "polygon":return a}return null};b.getGeometryAsPoly=function(a){switch(a.type){case "extent":return l.Polygon.fromExtent(a);case "polygon":case "polyline":return a}return null};b.pointInBox2D=m;b.boxesIntersect2D=v;b.boundingBoxClipped=
function(a,b){return b?!v(a,b):!1};b.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};b.needsElevationUpdates3D=function(a){return"absolute-height"!==a};var I={verticalDistanceToGround:0,terrainElevation:0}})},"esri/geometry/support/triangulationUtils":function(){define(["require","exports","../../core/libs/earcut/earcut","./coordsUtils","./meshUtils/deduplicate"],function(n,b,l,k,h){function a(a,b,c){if(1===a.length)return a[0];b=new Float64Array(b);c=
new Uint32Array(c);for(var d=0,e=0,f=0,g=0;g<a.length;g++){for(var h=a[g],k=0;k<h.position.length;k++)b[d++]=h.position[k];for(k=0;k<h.faces.length;k++)c[e++]=h.faces[k]+f;f=d/3}return{position:b,faces:c}}function g(a,b){for(var c=a.length,d=Array(c),f=Array(c),g=Array(c),h=0,x=0,w=0,u=0,y=0;y<c;++y)u+=a[y].length;for(var u=new Float64Array(3*u),m=0,v=c-1;0<=v;v--){var z=a[v],l=!k.isClockwise(z,!1,!1);if(l&&1!==c)d[h++]=z;else{for(var C=z.length,y=0;y<h;++y)C+=d[y].length;y={index:m,pathLengths:Array(h+
1),count:C,holeIndices:Array(h)};y.pathLengths[0]=z.length;0<z.length&&(g[w++]={index:m,count:z.length});m=l?e(z,z.length-1,-1,u,m,z.length,b):e(z,0,1,u,m,z.length,b);for(z=0;z<h;++z)l=d[z],y.holeIndices[z]=m,y.pathLengths[z+1]=l.length,0<l.length&&(g[w++]={index:m,count:l.length}),m=e(l,0,1,u,m,l.length,b);h=0;0<y.count&&(f[x++]=y)}}for(z=0;z<h;++z)l=d[z],0<l.length&&(g[w++]={index:m,count:l.length}),m=e(l,0,1,u,m,l.length,b);x<c&&(f.length=x);w<c&&(g.length=w);return{position:u,polygons:f,outlines:g}}
function e(a,b,c,e,g,h,k){g*=3;for(var d=0;d<h;++d){var f=a[b];e[g++]=f[0];e[g++]=f[1];e[g++]=k?f[2]:0;b+=c}return g/3}Object.defineProperty(b,"__esModule",{value:!0});b.triangulate=function(b){var d=g(b.rings,b.hasZ),c=[],e=0,k=0;b=function(a){var b=a.index,f=new Float64Array(d.position.buffer,3*b*d.position.BYTES_PER_ELEMENT,3*a.count);a=a.holeIndices.map(function(a){return a-b});a=new Uint32Array(l(f,a,3));c.push({position:f,faces:a});e+=f.length;k+=a.length};for(var r=0,t=d.polygons;r<t.length;r++)b(t[r]);
b=a(c,e,k);r=h.default(b.position.buffer,6,b.faces);b.position=new Float64Array(r.buffer);b.faces=r.indices;return b};b.pathsToTriangulationInfo=g})},"esri/core/libs/earcut/earcut":function(){define([],function(){function n(c,e,f){f=f||2;var h=e&&e.length,m=h?e[0]*f:c.length,p=b(c,0,m,f,!0),v=[];if(!p||p.next===p.prev)return v;var q,r,z,y;if(h){var u=f,h=[],x,w,n;y=0;for(x=e.length;y<x;y++)w=e[y]*u,n=y<x-1?e[y+1]*u:c.length,w=b(c,w,n,u,!1),w===w.next&&(w.steiner=!0),h.push(d(w));h.sort(a);for(y=0;y<
h.length;y++){e=h[y];u=p;if(u=g(e,u))e=t(u,e),l(e,e.next);p=l(p,p.next)}}if(c.length>80*f){q=z=c[0];r=h=c[1];for(u=f;u<m;u+=f)y=c[u],e=c[u+1],y<q&&(q=y),e<r&&(r=e),y>z&&(z=y),e>h&&(h=e);z=Math.max(z-q,h-r);z=0!==z?1/z:0}k(p,v,f,q,r,z);return v}function b(a,b,c,d,e){var f;if(e===0<y(a,b,c,d))for(e=b;e<c;e+=d)f=x(e,a[e],a[e+1],f);else for(e=c-d;e>=b;e-=d)f=x(e,a[e],a[e+1],f);f&&q(f,f.next)&&(w(f),f=f.next);return f}function l(a,b){if(!a)return a;b||(b=a);var d;do if(d=!1,a.steiner||!q(a,a.next)&&0!==
c(a.prev,a,a.next))a=a.next;else{w(a);a=b=a.prev;if(a===a.next)break;d=!0}while(d||a!==b);return b}function k(a,b,d,g,y,u,x){if(a){if(!x&&u){var m=a,v=m;do null===v.z&&(v.z=e(v.x,v.y,g,y,u)),v.prevZ=v.prev,v=v.nextZ=v.next;while(v!==m);v.prevZ.nextZ=null;v.prevZ=null;var m=v,z,B,C,n,D,S,K=1;do{v=m;C=m=null;for(n=0;v;){n++;B=v;for(z=D=0;z<K&&(D++,B=B.nextZ,B);z++);for(S=K;0<D||0<S&&B;)0!==D&&(0===S||!B||v.z<=B.z)?(z=v,v=v.nextZ,D--):(z=B,B=B.nextZ,S--),C?C.nextZ=z:m=z,z.prevZ=C,C=z;v=B}C.nextZ=null;
K*=2}while(1<n)}for(m=a;a.prev!==a.next;){v=a.prev;B=a.next;if(u)C=h(a,g,y,u);else a:if(C=a,n=C.prev,D=C,K=C.next,0<=c(n,D,K))C=!1;else{S=z=C.next.next;for(var U=0;z!==C.prev&&(0===U||z!==S);){U++;if(f(n.x,n.y,D.x,D.y,K.x,K.y,z.x,z.y)&&0<=c(z.prev,z,z.next)){C=!1;break a}z=z.next}C=!0}if(C)b.push(v.i/d),b.push(a.i/d),b.push(B.i/d),w(a),m=a=B.next;else if(a=B,a===m){if(!x)k(l(a),b,d,g,y,u,1);else if(1===x){x=b;m=d;v=a;do B=v.prev,C=v.next.next,!q(B,C)&&p(B,v,v.next,C)&&r(B,C)&&r(C,B)&&(x.push(B.i/
m),x.push(v.i/m),x.push(C.i/m),w(v),w(v.next),v=a=C),v=v.next;while(v!==a);a=v;k(a,b,d,g,y,u,2)}else if(2===x)a:{x=a;do{for(m=x.next.next;m!==x.prev;){if(v=x.i!==m.i){v=x;B=m;C=void 0;if(C=v.next.i!==B.i&&v.prev.i!==B.i){C=void 0;b:{C=v;do{if(C.i!==v.i&&C.next.i!==v.i&&C.i!==B.i&&C.next.i!==B.i&&p(C,C.next,v,B)){C=!0;break b}C=C.next}while(C!==v);C=!1}C=!C}n=void 0;if(n=C&&r(v,B)&&r(B,v)){C=v;n=!1;D=(v.x+B.x)/2;B=(v.y+B.y)/2;do C.y>B!==C.next.y>B&&C.next.y!==C.y&&D<(C.next.x-C.x)*(B-C.y)/(C.next.y-
C.y)+C.x&&(n=!n),C=C.next;while(C!==v)}v=n}if(v){a=t(x,m);x=l(x,x.next);a=l(a,a.next);k(x,b,d,g,y,u);k(a,b,d,g,y,u);break a}m=m.next}x=x.next}while(x!==a)}break}}}}function h(a,b,d,g){var h=a.prev,m=a.next;if(0<=c(h,a,m))return!1;var k=h.x>a.x?h.x>m.x?h.x:m.x:a.x>m.x?a.x:m.x,p=h.y>a.y?h.y>m.y?h.y:m.y:a.y>m.y?a.y:m.y,v=e(h.x<a.x?h.x<m.x?h.x:m.x:a.x<m.x?a.x:m.x,h.y<a.y?h.y<m.y?h.y:m.y:a.y<m.y?a.y:m.y,b,d,g);b=e(k,p,b,d,g);d=a.prevZ;for(g=a.nextZ;d&&d.z>=v&&g&&g.z<=b;){if(d!==a.prev&&d!==a.next&&f(h.x,
h.y,a.x,a.y,m.x,m.y,d.x,d.y)&&0<=c(d.prev,d,d.next))return!1;d=d.prevZ;if(g!==a.prev&&g!==a.next&&f(h.x,h.y,a.x,a.y,m.x,m.y,g.x,g.y)&&0<=c(g.prev,g,g.next))return!1;g=g.nextZ}for(;d&&d.z>=v;){if(d!==a.prev&&d!==a.next&&f(h.x,h.y,a.x,a.y,m.x,m.y,d.x,d.y)&&0<=c(d.prev,d,d.next))return!1;d=d.prevZ}for(;g&&g.z<=b;){if(g!==a.prev&&g!==a.next&&f(h.x,h.y,a.x,a.y,m.x,m.y,g.x,g.y)&&0<=c(g.prev,g,g.next))return!1;g=g.nextZ}return!0}function a(a,b){return a.x-b.x}function g(a,b){var c=b,d=a.x,e=a.y,g=-Infinity,
h;do{if(e<=c.y&&e>=c.next.y&&c.next.y!==c.y){var m=c.x+(e-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(m<=d&&m>g){g=m;if(m===d){if(e===c.y)return c;if(e===c.next.y)return c.next}h=c.x<c.next.x?c:c.next}}c=c.next}while(c!==b);if(!h)return null;if(d===g)return h.prev;b=h;for(var m=h.x,k=h.y,p=Infinity,v,c=h.next;c!==b;)d>=c.x&&c.x>=m&&d!==c.x&&f(e<k?d:g,e,m,k,e<k?g:d,e,c.x,c.y)&&(v=Math.abs(e-c.y)/(d-c.x),(v<p||v===p&&c.x>h.x)&&r(c,a)&&(h=c,p=v)),c=c.next;return h}function e(a,b,c,d,e){a=32767*(a-c)*e;b=32767*
(b-d)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function d(a){var b=a,c=a;do{if(b.x<c.x||b.x===c.x&&b.y<c.y)c=b;b=b.next}while(b!==a);return c}function f(a,b,c,d,e,f,g,h){return 0<=(e-g)*(b-h)-(a-g)*(f-h)&&0<=(a-g)*(d-h)-(c-g)*(b-h)&&0<=(c-g)*(f-h)-(e-g)*(d-h)}function c(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function q(a,b){return a.x===b.x&&a.y===b.y}
function p(a,b,d,e){return q(a,b)&&q(d,e)||q(a,e)&&q(d,b)?!0:0<c(a,b,d)!==0<c(a,b,e)&&0<c(d,e,a)!==0<c(d,e,b)}function r(a,b){return 0>c(a.prev,a,a.next)?0<=c(a,b,a.next)&&0<=c(a,a.prev,b):0>c(a,b,a.prev)||0>c(a,a.next,b)}function t(a,b){var c=new u(a.i,a.x,a.y),d=new u(b.i,b.x,b.y),e=a.next,f=b.prev;a.next=b;b.prev=a;c.next=e;e.prev=c;d.next=c;c.prev=d;f.next=d;d.prev=f;return d}function x(a,b,c,d){a=new u(a,b,c);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):(a.prev=a,a.next=a);return a}function w(a){a.next.prev=
a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function u(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function y(a,b,c,d){for(var e=0,f=c-d;b<c;b+=d)e+=(a[f]-a[b])*(a[b+1]+a[f+1]),f=b;return e}n.deviation=function(a,b,c,d){var e=b&&b.length,f=Math.abs(y(a,0,e?b[0]*c:a.length,c));if(e)for(var e=0,g=b.length;e<g;e++)f-=Math.abs(y(a,b[e]*c,e<g-1?b[e+1]*c:a.length,c));for(e=b=0;e<d.length;e+=3){var g=
d[e]*c,h=d[e+1]*c,m=d[e+2]*c;b+=Math.abs((a[g]-a[m])*(a[h+1]-a[g+1])-(a[g]-a[h])*(a[m+1]-a[g+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)};n.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,e=0;e<a.length;e++){for(var f=0;f<a[e].length;f++)for(var g=0;g<b;g++)c.vertices.push(a[e][f][g]);0<e&&(d+=a[e-1].length,c.holes.push(d))}return c};return n})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["require","exports","../../../core/mathUtils"],function(n,
b,l){function k(a,b,e,d){void 0===d&&(d=0);var f=a.byteLength/(4*b),c=new Uint32Array(a,0,f*b);a=new Uint32Array(f);var g=Math.floor(1.1*f)+1;if(null==h||h.length<2*g)h=new Uint32Array(l.nextHighestPowerOfTwo(2*g));for(var k=0;k<2*g;k++)h[k]=0;for(var r=0,t=0!==d?Math.ceil(7.84*1.96/(d*d)*d*(1-d)):f,k=0;k<f;k++){if(k===t){var x=1-r/k;if(x+1.96*Math.sqrt(x*(1-x)/k)<d)return null;t*=2}for(var x=k*b,w,u=w=0;u<b;u++)w=c[x+u]+w|0,w=w+(w<<11)+(w>>>2)|0;w>>>=0;for(var u=w%g,y=r;0!==h[2*u+1];){if(h[2*u]===
w){var m=h[2*u+1]-1,v=m*b;a:{for(var z=0;z<b;z++)if(c[x+z]!==c[v+z]){v=!1;break a}v=!0}if(v){y=a[m];break}}u++;u>=g&&(u-=g)}y===r&&(h[2*u]=w,h[2*u+1]=k+1,r++);a[k]=y}if(0!==d&&1-r/f<d)return null;d=new Uint32Array(b*r);for(k=r=0;k<f;k++)if(a[k]===r){g=c;t=k*b;x=d;w=r*b;u=b;for(y=0;y<u;y++)x[w+y]=g[t+y];r++}if(e){b=new Uint32Array(e.length);for(k=0;k<b.length;k++)b[k]=a[e[k]];a=b}return{buffer:d.buffer,indices:a,uniqueCount:r}}Object.defineProperty(b,"__esModule",{value:!0});b.deduplicate=k;var h=
null;b.default=k})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../support/projectionUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){function w(a){var b=a.paths[0];if(!b||0===b.length)return null;b=r.getPointOnPath(b,r.getPathLength(b)/2);return t.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference)}function u(a,b,c){if(!b||!a)return a;c=c?a:t.clonePoint(a);return x.pointToPoint(a,c,b)?c:null}function y(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!y(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(b,"__esModule",{value:!0});b.computeCentroid=function(a,b){if("point"===
a.type)return u(a,b,!1);if(t.isHydratedGeometry(a))switch(a.type){case "extent":return u(a.center,b,!1);case "polygon":return u(a.centroid,b,!1);case "polyline":return u(w(a),b,!0);case "mesh":return u(a.extent.center,b,!1)}else switch(a.type){case "extent":var c=l.isFinite(a.zmin);a=t.makeDehydratedPoint(.5*(a.xmax+a.xmin),.5*(a.ymax+a.ymin),c?.5*(a.zmax+a.zmin):void 0,a.spatialReference);return u(a,b,!0);case "polygon":return(c=a.rings[0])&&0!==c.length?(c=p.ringsCentroid(a.rings,a.hasZ),a=t.makeDehydratedPoint(c[0],
c[1],c[2],a.spatialReference)):a=null,u(a,b,!0);case "polyline":return u(w(a),b,!0)}};b.enlargeExtent=function(a,b,c){if(a){b||(b=q.create());var e=.5*a.width*(c-1);c=.5*a.height*(c-1);a.width<1E-7*a.height?e+=c/20:a.height<1E-7*a.width&&(c+=e/20);d.vec4.set(b,a.xmin-e,a.ymin-c,a.xmax+e,a.ymax+c);return b}return null};b.updateVertexAttributeAuxpos1w=function(a,b){for(var c=0;c<a.geometries.length;++c){var d=a.geometries[c].data.vertexAttributes.auxpos1;d&&d.data[3]!==b&&(d.data[3]=b,a.geometryVertexAttrsUpdated(c))}};
b.mixinColorAndOpacity=function(a,b){var c=f.vec4f64.clone(f.vec4f64.ONES);k.isSome(a)&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]);k.isSome(b)?c[3]=b:k.isSome(a)&&3<a.length&&(c[3]=a[3]);return c};b.overrideColor=function(a,b,c,d,e,f){void 0===f&&(f=[0,0,0,0]);for(var g=0;3>g;++g)f[g]=a&&null!=a[g]?a[g]:c&&null!=c[g]?c[g]:e[g];f[3]=null!=b?b:null!=d?d:e[3];return f};b.computeObjectScale=function(a,b,c,d){void 0===a&&(a=e.vec3f64.ONES);void 0===d&&(d=1);var f=Array(3);if(null==b||null==c)f[0]=1,f[1]=1,f[2]=1;
else{for(var g=void 0,h=0,m=2;0<=m;m--){var k=a[m],p=void 0,v=null!=k,q=0===m&&!g&&!v,r=c[m];"symbolValue"===k||q?p=0!==r?b[m]/r:1:v&&"proportional"!==k&&isFinite(k)&&(p=0!==r?k/r:1);null!=p&&(g=f[m]=p,h=Math.max(h,Math.abs(p)))}for(m=2;0<=m;m--)null==f[m]?f[m]=g:0===f[m]&&(f[m]=.001*h)}for(m=2;0<=m;m--)f[m]/=d;return e.vec3f64.fromArray(f)};b.computeSizeWithResourceSize=function(a,b){var c=b.width,d=b.depth,f=b.height;b=b.isPrimitive?10:1;if(null==c&&null==f&&null==d)return[b*a[0],b*a[1],b*a[2]];
for(var c=e.vec3f64.fromValues(c,d,f),g,d=0;3>d;d++)if(f=c[d],null!=f){g=f/a[d];break}for(d=0;3>d;d++)null==c[d]&&(c[d]=a[d]*g);return c};b.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return y(a)?null:"Symbol sizes may not be negative values"};b.isValidSize=y;b.computeObjectRotation=function(b,c,d,e){void 0===e&&(e=a.mat4f64.create());b=b||0;c=c||0;d=d||0;0!==b&&h.mat4.rotateZ(e,e,-b/180*Math.PI);0!==c&&h.mat4.rotateX(e,e,c/180*Math.PI);0!==d&&h.mat4.rotateY(e,
e,d/180*Math.PI);return e};b.demResolutionForBoundingBox=function(a,b){return null!=b.minDemResolution?b.minDemResolution:c.isPoint(a)?b.minDemResolutionForPoints:.01*c.maximumDimension(a)};b.namedAnchorToHUDMaterialAnchorPos={"bottom-left":g.vec2f64.fromValues(0,0),bottom:g.vec2f64.fromValues(.5,0),"bottom-right":g.vec2f64.fromValues(1,0),left:g.vec2f64.fromValues(0,.5),center:g.vec2f64.fromValues(.5,.5),right:g.vec2f64.fromValues(1,.5),"top-left":g.vec2f64.fromValues(0,1),top:g.vec2f64.fromValues(.5,
1),"top-right":g.vec2f64.fromValues(1,1)}})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){function p(a){return a.isVisible?a.getParameters().transparent?1:2:0}n=function(){function b(a,d,e,f,g,h,k,p,q){this._edgeState=p;this.type="object3d";this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.uniqueMaterials=f;this.uniqueGeometries=e;this.uniqueTextures=g;this.stageObject=d;this.elevationAligner=h;this.elevationContext=new c(k);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=
null!=q?q:b.VisibilityModes.HIDE_FACERANGE}Object.defineProperty(b.prototype,"isElevationSource",{get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)},enumerable:!0,configurable:!0});b.prototype.initialize=function(a,b){this.stageLayer=a;this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(3,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)b.add(2,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=
0;a<this.uniqueTextures.length;a++)b.add(4,this.uniqueTextures[a]);b.add(1,this.stageObject)};b.prototype.layerOpacityChanged=function(b,c){if(!a.isNone(this._edgeState)){for(var d=p(this._edgeState.baseMaterial),e=!1,f=0,g=this._edgeState.edgeMaterials;f<g.length;f++){var h=g[f];h.objectTransparency!==d&&(h.objectTransparency=d,e=!0)}e&&this.resetEdgeObject(c);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[b])}};b.prototype.slicePlaneEnabledChanged=function(b,
c){a.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:b},!c),this._edgeState.slicePlaneEnabled=b)};b.prototype.setVisibility=function(c){if(null!=this.stage){if(this._visible!==c){(this._visible=c)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===b.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():
(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);if(a.isSome(this._edgeState)){var d=this.stage.renderView.ensureEdgeView();d.hasObject(this.stageObject)?d.updateObjectVisibility(this.stageObject,c):c&&this.addEdgeObject(d,this._edgeState,!1)}return!0}return!1}};Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0});b.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var b=
0;b<this.uniqueMaterials.length;b++)a.remove(3,this.uniqueMaterials[b].id);if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.remove(2,this.uniqueGeometries[b].id);if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(4,this.uniqueTextures[b].id)}a.remove(1,this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);a=this.stage.renderView.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);
this.stageObject.dispose();this._visible=!1;this.stage=this.stageLayer=null};b.prototype.alignWithElevation=function(a,b,c,d){null!=this.elevationAligner&&(f.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a),this.resetEdgeObject(d))};b.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=e.vec3f64.create());
return g.vec3.copy(a,this.stageObject.getCenter(!0))};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=d.create());var b=this.stageObject;a||(a=d.create());d.setMin(a,b.getBBMin(!0));d.setMax(a,b.getBBMax(!0));return a};b.prototype.getProjectedBoundingBox=function(a,b,c,e,f){return h(this,void 0,void 0,function(){var h,m,p,v,z,y,u,l,B,n;return k(this,function(k){switch(k.label){case 0:h=this.getBoundingBoxObjectSpace(f);m=w;p=d.isPoint(h)?1:m.length;for(v=0;v<p;v++)z=m[v],t[0]=h[z[0]],
t[1]=h[z[1]],t[2]=h[z[2]],g.vec3.transformMat4(t,t,this.stageObject.objectTransformation),r[3*v+0]=t[0],r[3*v+1]=t[1],r[3*v+2]=t[2];if(!a(r,0,p))return[2,null];d.empty(h);y=null;this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds());for(v=0;v<3*p;v+=3){for(u=0;3>u;u++)h[u]=Math.min(h[u],r[v+u]),h[u+3]=Math.max(h[u+3],r[v+u]);y&&c.push({location:r.slice(v,v+3),screenSpaceBoundingRect:y})}if(!b||!b.service||"absolute-height"===this.elevationContext.mode)return[3,5];d.center(h,
x);l="relative-to-scene"===this.elevationContext.mode?"scene":"ground";B=void 0;if(!b.useViewElevation)return[3,1];B=b.service.getElevation(x[0],x[1],l);return[3,4];case 1:return k.trys.push([1,3,,4]),n=q.demResolutionForBoundingBox(h,b),[4,b.service.queryElevation(x[0],x[1],e,n,l)];case 2:return B=k.sent(),[3,4];case 3:return k.sent(),B=null,[3,4];case 4:d.offset(h,0,0,-this.alignedTerrainElevation+B),k.label=5;case 5:return[2,h]}})})};b.prototype.addHighlight=function(a,b){b=this.stageObject.highlightAllComponents(b);
a.addObject(this.stageObject,b)};b.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};b.prototype.resetEdgeObject=function(b){if(!a.isNone(this._edgeState)){var c=this.stage.renderView.ensureEdgeView();c.removeObject(this.stageObject);this._visible&&this.addEdgeObject(c,this._edgeState,b)}};b.prototype.addEdgeObject=function(a,b,c){for(var d=p(b.baseMaterial),e=0,f=b.edgeMaterials;e<f.length;e++)f[e].objectTransparency=d;a.addObject(this.stageObject,b.edgeMaterials,{slicePlaneEnabled:b.slicePlaneEnabled},
!c,b.addObjectSettings)};return b}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";a[a.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(n||(n={}));var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=e.vec3f64.create(),x=e.vec3f64.create(),w=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return n})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require","exports","../../../../layers/graphics/dehydratedFeatures",
"../../../../support/arcadeUtils"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.createContext=function(b,a,g){var e=null;b=b&&b.expression;"string"===typeof b&&(e="0"===b?0:null,null!=e?e={cachedResult:e}:(e=k.createSyntaxTree(b),k.dependsOnView(e)?(null!=g&&g.error("Expressions containing '$view' are not supported on ElevationInfo"),e={cachedResult:0}):e={arcade:{func:k.createFunction(e),context:k.createExecContext(null,{sr:a})}}));return e};b.createFeature=function(b,a){return k.createFeature(b.attributes,
b.geometry,a)};b.setContextFeature=function(b,a){null!=b&&null==b.cachedResult&&(a._geometry&&(a._geometry=l.hydrateGeometry(a._geometry)),k.updateExecContext(b.arcade.context,a))};b.execute=function(b){if(null!=b){if(null!=b.cachedResult)return b.cachedResult;var a=b.arcade,a=k.executeFunction(a.func,a.context);"number"!==typeof a&&(a=b.cachedResult=0);return a}return 0};b.extractExpressionInfo=function(b,a){void 0===a&&(a=!1);var g=(b=b&&b.featureExpressionInfo)&&b.expression;a||"0"===g||(b=null);
return b};b.zeroContext={cachedResult:0}})},"esri/support/arcadeUtils":function(){define("require exports ../arcade/arcade ../arcade/Dictionary ../arcade/Feature ../core/lang ../core/promiseUtils ../renderers/visualVariables/support/sizeVariableUtils".split(" "),function(n,b,l,k,h,a,g,e){function d(a){var b;try{b=a?l.parseScript(a):null}catch(t){b=null}return b}function f(a){a=d(a);return!!a&&l.scriptUsesGeometryEngine(a)}Object.defineProperty(b,"__esModule",{value:!0});b.arcade=l;b.Dictionary=k;
b.arcadeFeature=h;var c=/^\$feature\./i,q={vars:{$feature:"any",$view:"any"},spatialReference:null};b.createSyntaxTree=d;b.createFunction=function(b,c){c=c||a.clone(q);b="string"===typeof b?d(b):b;if(!b)return null;var e;try{e=b?l.compileScript(b,c):null}catch(x){e=null}return e};b.createExecContext=function(a,b){return{vars:{$feature:null==a?new h:h.createFromGraphic(a),$view:b&&b.view},spatialReference:b&&b.sr}};b.createFeature=function(a,b,c){return h.createFromGraphicLikeObject(b,a,c)};b.updateExecContext=
function(a,b){a.vars.$feature=b};b.evalSyntaxTree=function(a,b){var c;try{c=l.executeScript(a,b)}catch(x){c=null}return c};b.executeFunction=function(a,b){var c;try{c=a?a(b):null}catch(x){c=null}return c};b.executeAsyncFunction=function(a,b){try{return a?a(b):g.resolve(null)}catch(t){return g.resolve(null)}};b.extractFieldNames=function(a){if(!a)return[];a="string"===typeof a?d(a):a;if(!a)return[];var b=[];l.extractFieldLiterals(a).forEach(function(a){c.test(a)&&(a=a.replace(c,""),b.push(a))});b.sort();
return b.filter(function(a,c){return 0===c||b[c-1]!==a})};b.dependsOnView=function(a){return l.referencesMember(a,"$view")};b.hasVariable=function(a,b){return a?l.referencesMember(a,b):!1};b.getViewInfo=function(a){if(a&&(null!=a.spatialReference||null!=a.scale&&null!=a.viewingMode))return{view:a.viewingMode&&null!=a.scale?new k({viewingMode:a.viewingMode,scale:a.scale}):null,sr:a.spatialReference}};b.convertServiceUrlToWorkspace=function(a,b){var c=l.featureSetUtils();return c?c.createFeatureSetCollectionFromService(a,
b):null};b.convertFeatureLayerToFeatureSet=function(a,b){if(null===a)return null;var c=l.featureSetUtils();return c?c.constructFeatureSet(a,b):null};b.convertMapToFeatureSetCollection=function(a){if(null===a||null===a.map)return null;var b=l.featureSetUtils();return b?b.createFeatureSetCollectionFromMap(a.map,a.spatialReference):null};b.loadScriptDependencies=function(a,b,c){void 0===c&&(c=[]);return l.loadScriptDependencies(a,b,c)};b.enableGeometryOperations=function(){return l.enableGeometrySupport()};
b.enableFeatureSetOperations=function(){return l.enableFeatureSetSupport()};b.applyTextFormattingHTML=function(a){var b=/(\n)/gi;return"string"===typeof a?a.replace(b,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):a};b.hasGeometryOperations=function(a){if(!a)return!1;if("string"===typeof a)return f(a);if("simple"===a.type||"class-breaks"===a.type||"unique-value"===a.type||"dot-density"===a.type||"dictionary"===a.type){if("dot-density"===a.type){var b=a.attributes.some(function(a){return f(a.valueExpression)});
if(b)return b}b=a.visualVariables;b=!!b&&b.some(function(a){var b=f(a.valueExpression);"size"===a.type&&(e.isSizeVariable(a.minSize)&&(b=b||f(a.minSize.valueExpression)),e.isSizeVariable(a.maxSize)&&(b=b||f(a.maxSize.valueExpression)));return b});return"valueExpression"in a&&f(a.valueExpression)?!0:b}return"esri.layers.support.LabelClass"===a.declaredClass?(a=a.labelExpressionInfo&&a.labelExpressionInfo.expression,!(!a||!f(a))||!1):"esri.PopupTemplate"===a.declaredClass?!!a.expressionInfos&&a.expressionInfos.some(function(a){return f(a.expression)}):
!1}})},"esri/arcade/arcade":function(){define("require exports ./arcadeCompiler ./arcadeRuntime ./languageUtils ./parser ./treeAnalysis ../core/has ../core/promiseUtils ../intl/moment".split(" "),function(n,b,l,k,h,a,g,e,d,f){function c(a,b){if(null===K)throw Error("Async Arcade must be enabled for this script");return e("csp-restrictions")||!1===B?function(b){return K.executeScript(a,b)}:l.compileScript(a,b,!0)}function q(b,c){void 0===c&&(c=[]);return a.parseScript(b,c)}function p(a,b){if(!0===
b.useAsync||!0===a.isAsync){if(null===K)throw Error("Async Arcade must be enabled for this script");return K.executeScript(a,b)}return k.executeScript(a,b)}function r(a,b){return k.referencesMember(a,b)}function t(a,b){void 0===b&&(b=[]);void 0===a.usesGeometry&&g.findScriptDependencies(a,b);return!0===a.usesGeometry}function x(){return Q?Q:Q=d.create(function(a,b){n(["../geometry/geometryEngine","./functions/geomsync"],function(b,c){D=!0;c.setGeometryEngine(b);a(!0)},function(a){b(a)})})}function w(){return null!==
J?J:J=l.enableAsyncSupport().then(function(){return d.create(function(a,b){n(["./arcadeAsyncRuntime"],function(c){try{K=c;c=0;for(var d=I;c<d.length;c++){var e=d[c];K.extend(e);l.extend(e,"async")}I=null;a(!0)}catch(X){b(X)}},b)})})}function u(){return K?!0:!1}function y(){return N?N:N=w().then(function(){return d.create(function(a,b){n(["./featureSetUtils","./functions/featuresetbase","./functions/featuresetgeom","./functions/featuresetstats","./functions/featuresetstring"],function(c,d,e,f,g){try{L=
c,K.extend([d,e,f,g]),l.extend([d,e,f,g],"async"),C=!0,a(!0)}catch(V){b(V)}},b)})})}function m(a,b){void 0===b&&(b=[]);void 0===a.usesFeatureSet&&g.findScriptDependencies(a,b);return!0===a.usesFeatureSet}function v(a,b){if(b)for(var c=0;c<b.length;c++)if(r(a,b[c]))return!0;return!1}function z(){return null!==M?M:M=f.loadMoment().then(function(a){h.MomentLibrary.Moment=a;return!0})}Object.defineProperty(b,"__esModule",{value:!0});var B=function(){if(e("csp-restrictions"))return!1;try{return(new Function("function* test() {}; return true"))()}catch(R){return!1}}(),
C=!1,D=!1,K=null,I=[];b.compileScript=function(a,b){return!0===b.useAsync||!0===a.isAsync?c(a,b):e("csp-restrictions")?function(b){return k.executeScript(a,b)}:l.compileScript(a,b)};b.extend=function(a){k.extend(a);l.extend(a,"sync");null===K?I.push(a):(l.extend(a,"async"),K.extend(a))};b.parseScript=q;b.validateScript=function(b,c,d){void 0===d&&(d="");return a.validateScript(b,c,d)};b.scriptCheck=function(b,c,d,e){void 0===e&&(e="");return a.scriptCheck(b,c,d,e)};b.parseAndExecuteScript=function(b,
c,d){void 0===d&&(d=[]);b=a.parseScript(b,d);return p(b,c)};b.executeScript=p;b.referencesMember=r;b.referencesFunction=function(a,b){return k.referencesFunction(a,b)};b.extractFieldLiterals=function(b,c){void 0===c&&(c=!1);return a.extractFieldLiterals(b,c)};b.scriptUsesGeometryEngine=t;var Q=null;b.enableGeometrySupport=x;var J=null;b.enableAsyncSupport=w;b.isFeatureSetSupportEnabled=function(){return C};b.isAsyncEnabled=u;b.isGeometryEnabled=function(){return D};var N=null;b.enableFeatureSetSupport=
y;b.scriptUsesFeatureSet=m;b.scriptIsAsync=function(a,b){void 0===b&&(b=[]);void 0===a.isAsync&&g.findScriptDependencies(a,b);return!0===a.isAsync};b.loadScriptDependencies=function(a,b,c,e){void 0===c&&(c=[]);void 0===e&&(e=!1);return d.create(function(f,g){var h="string"===typeof a?q(a):a,k=[];k.push(z());h&&(!1===D&&(t(h)||e)&&k.push(x()),!1===u()&&(!0===h.isAsync||b)&&k.push(w()),!1===C&&(m(h)||v(h,c))&&k.push(y()));k?d.all(k).then(function(){f(!0)},g):f(!0)})};b.scriptTouchesGeometry=function(a){if(t(a))return!0;
a=g.findFunctionCalls(a,!0);return-1<a.indexOf("geometry")||-1<a.indexOf("feature")?!0:!1};var L=null;b.featureSetUtils=function(){return L};b.load=z;var M=null})},"esri/arcade/arcadeCompiler":function(){define("require exports ./ArcadePortal ./Attachment ./Dictionary ./Feature ./ImmutablePathArray ./ImmutablePointArray ./languageUtils ./treeAnalysis ./functions/date ./functions/geometry ./functions/geomsync ./functions/maths ./functions/stats ./functions/string ../core/promiseUtils ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../geometry/SpatialReference".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C){function D(a,b,c){try{return c(a,null,b)}catch(G){throw G;}}function K(a){return a instanceof Error?w.reject(a):w.reject(Error(a))}function I(a,b){try{switch(b.type){case "EmptyStatement":return"lc.voidOperation";case "VariableDeclarator":return M(a,b);case "VariableDeclaration":for(var c=[],d=0;d<b.declarations.length;d++)c.push(I(a,b.declarations[d]));return c.join("\n")+" \n lastStatement\x3d  lc.voidOperation; \n";case "BlockStatement":return L(a,
b);case "FunctionDeclaration":var e=b.id.name.toLowerCase(),g={isAsync:a.isAsync,spatialReference:a.spatialReference,console:a.console,lrucache:a.lrucache,services:a.services,symbols:a.symbols,mangleMap:a.mangleMap,localScope:{_SymbolsMap:{}},depthCounter:a.depthCounter+1,globalScope:a.globalScope};if(64<g.depthCounter)throw Error("Exceeded maximum function depth");for(var c="new lc.SizzleFunction( lang.functionDepthchecker(function() { var lastStatement \x3d lc.voidOperation; \n   var lscope \x3d runtimeCtx.localStack[runtimeCtx.localStack.length-1];\n",
h=0;h<b.params.length;h++){var m=b.params[h].name.toLowerCase(),k=Z(m,a);g.localScope._SymbolsMap[m]=k;g.mangleMap[m]=k;c+="lscope['"+k+"']\x3darguments["+h.toString()+"];\n"}!0===a.isAsync?(c=c+"return lang.__awaiter(this, void 0, void 0, function* () {\n"+(L(g,b.body)+"\n return lastStatement; "),c+="});  }, runtimeCtx))\n lastStatement \x3d lc.voidOperation; \n"):(c+=L(g,b.body)+"\n return lastStatement; }, runtimeCtx))",c+="\n lastStatement \x3d lc.voidOperation; \n");void 0!==a.globalScope[e]?
d="gscope['"+e+"']\x3d"+c:void 0!==a.globalScope._SymbolsMap[e]?d="gscope['"+a.globalScope._SymbolsMap[e]+"']\x3d"+c:(k=Z(e,a),a.globalScope._SymbolsMap[e]=k,a.mangleMap[e]=k,d="gscope['"+k+"']\x3d"+c);return d;case "ReturnStatement":var p;p=null===b.argument?"return lc.voidOperation":"return "+I(a,b.argument)+"";return p;case "IfStatement":if("AssignmentExpression"===b.test.type||"UpdateExpression"===b.test.type)throw Error(f.nodeErrorMessage(b.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));
var v=I(a,b.test),q=ca(a),r="var "+q+" \x3d "+v+";\n if ("+q+" \x3d\x3d\x3d true) {\n"+N(a,b.consequent)+"\n }\n",r=null!==b.alternate?r+("else if ("+q+"\x3d\x3d\x3dfalse)   { \n"+N(a,b.alternate)+"}\n"):r+("else if ("+q+"\x3d\x3d\x3dfalse) { \n lastStatement \x3d lc.voidOperation;\n }\n");return r+="else { lang.error({type: '"+b.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION'); \n}\n";case "ExpressionStatement":var z;z="AssignmentExpression"===b.expression.type?"lastStatement \x3d lc.voidOperation; "+
I(a,b.expression)+"; \n ":"lastStatement \x3d "+I(a,b.expression)+"; ";return z;case "AssignmentExpression":return J(a,b);case "UpdateExpression":return Q(a,b);case "BreakStatement":return"break";case "ContinueStatement":return"continue";case "ForStatement":c="lastStatement \x3d lc.voidOperation; \n";null!==b.init&&(c+=I(a,b.init)+"; ");var y=ca(a),u=ca(a),c=c+("var "+y+" \x3d true; ")+"\n do { ";null!==b.update&&(c+=" if ("+y+"\x3d\x3d\x3dfalse) {\n "+I(a,b.update)+"  \n}\n "+y+"\x3dfalse; \n");
null!==b.test&&(c+="var "+u+" \x3d "+I(a,b.test)+"; ",c+="if ("+u+"\x3d\x3d\x3dfalse) { break; } else if ("+u+"!\x3d\x3dtrue) { lang.error({type: '"+b.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION');   }\n");c+=I(a,b.body);null!==b.update&&(c+="\n "+I(a,b.update));return c+("\n"+y+" \x3d true; \n} while(true);  lastStatement \x3d lc.voidOperation; ");case "ForInStatement":var x=ca(a),t=ca(a),w=ca(a),l="var "+x+" \x3d "+I(a,b.right)+";\n";"VariableDeclaration"===b.left.type&&(l+=I(a,b.left));
var B="VariableDeclaration"===b.left.type?b.left.declarations[0].id.name:b.left.name,B=B.toLowerCase(),c="";null!==a.localScope&&(void 0!==a.localScope[B]?c="lscope['"+B+"']":void 0!==a.localScope._SymbolsMap[B]&&(c="lscope['"+a.localScope._SymbolsMap[B]+"']"));""===c&&(void 0!==a.globalScope[B]?c="gscope['"+B+"']":void 0!==a.globalScope._SymbolsMap[B]&&(c="gscope['"+a.globalScope._SymbolsMap[B]+"']"));l=l+("if ("+x+"\x3d\x3d\x3dnull) {  lastStatement \x3d lc.voidOperation; }\n ")+("else if (lc.isArray("+
x+") || lc.isString("+x+")) {")+("var "+t+"\x3d"+x+".length; \n")+("for(var "+w+"\x3d0; "+w+"\x3c"+t+"; "+w+"++) {\n");l+=c+"\x3d"+w+";\n";l+=I(a,b.body);l+="\n}\n";l+=" lastStatement \x3d lc.voidOperation; \n";l+=" \n}\n";l+="else if (lc.isImmutableArray("+x+")) {";l=l+("var "+t+"\x3d"+x+".length(); \n")+("for(var "+w+"\x3d0; "+w+"\x3c"+t+"; "+w+"++) {\n");l+=c+"\x3d"+w+";\n";l+=I(a,b.body);l+="\n}\n";l+=" lastStatement \x3d lc.voidOperation; \n";l+=" \n}\n";l+="else if (( "+x+" instanceof lang.Dictionary) || ( "+
x+" instanceof lang.Feature)) {";l=l+("var "+t+"\x3d"+x+".keys(); \n")+("for(var "+w+"\x3d0; "+w+"\x3c"+t+".length; "+w+"++) {\n");l+=c+"\x3d"+t+"["+w+"];\n";l+=I(a,b.body);l+="\n}\n";l+=" lastStatement \x3d lc.voidOperation; \n";l+=" \n}\n";a.isAsync&&(l+="else if (lc.isFeatureSet("+x+")) {",l=l+("var "+t+"\x3d"+x+".iterator(runtimeCtx.abortSignal); \n")+("for(var "+w+"\x3dlang. graphicToFeature( yield "+t+".next(),"+x+"); "+w+"!\x3dnull; "+w+"\x3dlang. graphicToFeature( yield "+t+".next(),"+x+")) {\n")+
(c+"\x3d"+w+";\n"),l+=I(a,b.body),l+="\n}\n",l+=" lastStatement \x3d lc.voidOperation; \n",l+=" \n}\n");return l+"else { lastStatement \x3d lc.voidOperation; } \n";case "Identifier":return S(a,b);case "MemberExpression":var C;try{c=void 0,c=!0===b.computed?I(a,b.property):"'"+b.property.name+"'",C="lang.member("+I(a,b.object)+","+c+")"}catch(ra){throw ra;}return C;case "Literal":return null===b.value||void 0===b.value?"null":JSON.stringify(b.value);case "ThisExpression":throw Error(f.nodeErrorMessage(b,
"RUNTIME","NOTSUPPORTED"));case "CallExpression":try{if("Identifier"!==b.callee.type)throw Error(f.nodeErrorMessage(b,"RUNTIME","ONLYNODESSUPPORTED"));var n=b.callee.name.toLowerCase(),d="";null!==a.localScope&&(void 0!==a.localScope[n]?d="lscope['"+n+"']":void 0!==a.localScope._SymbolsMap[n]&&(d="lscope['"+a.localScope._SymbolsMap[n]+"']"));""===d&&(void 0!==a.globalScope[n]?d="gscope['"+n+"']":void 0!==a.globalScope._SymbolsMap[n]&&(d="gscope['"+a.globalScope._SymbolsMap[n]+"']"));if(""!==d){e=
"[";for(g=0;g<b.arguments.length;g++)0<g&&(e+=", "),e+=I(a,b.arguments[g]);e+="]";c=a.isAsync?"(yield lang.callfunc("+d+","+e+",runtimeCtx) )":"lang.callfunc("+d+","+e+",runtimeCtx)"}else throw Error(f.nodeErrorMessage(b,"RUNTIME","NOTFOUND"));}catch(ra){throw ra;}return c;case "UnaryExpression":var D;try{D="lang.unary("+I(a,b.argument)+",'"+b.operator+"')"}catch(ra){throw ra;}return D;case "BinaryExpression":var R;try{R="lang.binary("+I(a,b.left)+","+I(a,b.right)+",'"+b.operator+"')"}catch(ra){throw ra;
}return R;case "LogicalExpression":var K;try{if("AssignmentExpression"===b.left.type||"UpdateExpression"===b.left.type)throw Error(f.nodeErrorMessage(b.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===b.right.type||"UpdateExpression"===b.right.type)throw Error(f.nodeErrorMessage(b.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("\x26\x26"===b.operator||"||"===b.operator)K="(lang.logicalCheck("+I(a,b.left)+") "+b.operator+" lang.logicalCheck("+I(a,b.right)+
"))";else throw Error(f.nodeErrorMessage(b,"RUNTIME","ONLYORORAND"));}catch(ra){throw ra;}return K;case "ConditionalExpression":throw Error(f.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTED"));case "ArrayExpression":try{c=[];for(d=0;d<b.elements.length;d++)"Literal"===b.elements[d].type?c.push(I(a,b.elements[d])):c.push("lang.aCheck("+I(a,b.elements[d])+",'ArrayExpression')");h="["+c.join(",")+"]"}catch(ra){throw ra;}return h;case "ObjectExpression":c="lang.dictionary([";for(d=0;d<b.properties.length;d++){var F=
b.properties[d],T="Identifier"===F.key.type?"'"+F.key.name+"'":I(a,F.key),V=I(a,F.value);0<d&&(c+=",");c+="lang.strCheck("+T+",'ObjectExpression'),lang.aCheck("+V+", 'ObjectExpression')"}return c+"])";case "Property":throw Error("Should not get here");case "Array":throw Error(f.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTED"));default:throw Error(f.nodeErrorMessage(b,"RUNTIME","UNREOGNISED"));}}catch(ra){throw ra;}}function Q(a,b){var c=null,d="";if("MemberExpression"===b.argument.type)return c=I(a,b.argument.object),
d=!0===b.argument.computed?I(a,b.argument.property):"'"+b.argument.property.name+"'","lang.memberupdate("+c+","+d+",'"+b.operator+"',"+b.prefix+")";c=b.argument.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[c])return"lang.update(lscope, '"+c+"','"+b.operator+"',"+b.prefix+")";if(void 0!==a.localScope._SymbolsMap[c])return"lang.update(lscope, '"+a.localScope._SymbolsMap[c]+"','"+b.operator+"',"+b.prefix+")"}if(void 0!==a.globalScope[c])return"lang.update(gscope, '"+c+"','"+b.operator+
"',"+b.prefix+")";if(void 0!==a.globalScope._SymbolsMap[c])return"lang.update(gscope, '"+a.globalScope._SymbolsMap[c]+"','"+b.operator+"',"+b.prefix+")";throw Error("Variable not recognised");}function J(a,b){var c=I(a,b.right),d=null,e="";if("MemberExpression"===b.left.type)return d=I(a,b.left.object),e=!0===b.left.computed?I(a,b.left.property):"'"+b.left.property.name+"'","lang.assignmember("+d+","+e+",'"+b.operator+"',"+c+")";d=b.left.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[d])return"lscope['"+
d+"']\x3dlang.assign("+c+",'"+b.operator+"', lscope['"+d+"'])";if(void 0!==a.localScope._SymbolsMap[d])return"lscope['"+a.localScope._SymbolsMap[d]+"']\x3dlang.assign("+c+",'"+b.operator+"', lscope['"+a.localScope._SymbolsMap[d]+"'])"}if(void 0!==a.globalScope[d])return"gscope['"+d+"']\x3dlang.assign("+c+",'"+b.operator+"', gscope['"+d+"'])";if(void 0!==a.globalScope._SymbolsMap[d])return"gscope['"+a.globalScope._SymbolsMap[d]+"']\x3dlang.assign("+c+",'"+b.operator+"', gscope['"+a.globalScope._SymbolsMap[d]+
"'])";throw Error("Variable not recognised");}function N(a,b){return"BlockStatement"===b.type?I(a,b):"ReturnStatement"===b.type||"BreakStatement"===b.type||"ContinueStatement"===b.type?I(a,b)+"; ":"UpdateExpression"===b.type?"lastStatement \x3d "+I(a,b)+"; ":"ExpressionStatement"===b.type?I(a,b):"ObjectExpression"===b.type?"lastStatement \x3d "+I(a,b)+"; ":I(a,b)+"; "}function L(a,b){for(var c="",d=0;d<b.body.length;d++)c="ReturnStatement"===b.body[d].type?c+(I(a,b.body[d])+"; \n"):"BreakStatement"===
b.body[d].type?c+(I(a,b.body[d])+"; \n"):"ContinueStatement"===b.body[d].type?c+(I(a,b.body[d])+"; \n"):"UpdateExpression"===b.body[d].type?c+("lastStatement \x3d "+I(a,b.body[d])+"; \n"):"ObjectExpression"===b.body[d].type?c+("lastStatement \x3d "+I(a,b.body[d])+"; \n"):c+(I(a,b.body[d])+" \n");return c}function M(a,b){var c=null===b.init?null:I(a,b.init);c===d.voidOperation&&(c=null);b=b.id.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[b])return"lscope['"+b+"']\x3d"+c+"; ";
if(void 0!==a.localScope._SymbolsMap[b])return"lscope['"+a.localScope._SymbolsMap[b]+"']\x3d"+c+"; ";var e=Z(b,a);a.localScope._SymbolsMap[b]=e;a.mangleMap[b]=e;return"lscope['"+e+"']\x3d"+c+"; "}if(void 0!==a.globalScope[b])return"gscope['"+b+"']\x3d"+c+"; ";if(void 0!==a.globalScope._SymbolsMap[b])return"gscope['"+a.globalScope._SymbolsMap[b]+"']\x3d"+c+"; ";e=Z(b,a);a.globalScope._SymbolsMap[b]=e;a.mangleMap[b]=e;return"gscope['"+e+"']\x3d"+c+"; "}function R(a,b,c){b=b.toLowerCase();switch(b){case "hasz":return a=
a.hasZ,void 0===a?!1:a;case "hasm":return a=a.hasM,void 0===a?!1:a;case "spatialreference":return b=a.spatialReference._arcadeCacheId,void 0===b&&(c=!0,Object.freeze&&Object.isFrozen(a.spatialReference)&&(c=!1),c&&(ka++,b=a.spatialReference._arcadeCacheId=ka)),a=new h({wkt:a.spatialReference.wkt,wkid:a.spatialReference.wkid}),void 0!==b&&(a._arcadeCacheId="SPREF"+b.toString()),a}switch(a.type){case "extent":switch(b){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return a=
a[b],void 0!==a?a:null;case "type":return"Extent"}break;case "polygon":switch(b){case "rings":return b=a.cache._arcadeCacheId,void 0===b&&(ka++,b=ka,a.cache._arcadeCacheId=b),a=new g(a.rings,a.spatialReference,!0===a.hasZ,!0===a.hasM,b);case "type":return"Polygon"}break;case "point":switch(b){case "x":case "y":case "z":case "m":return void 0!==a[b]?a[b]:null;case "type":return"Point"}break;case "polyline":switch(b){case "paths":return b=a.cache._arcadeCacheId,void 0===b&&(ka++,b=ka,a.cache._arcadeCacheId=
b),a=new g(a.paths,a.spatialReference,!0===a.hasZ,!0===a.hasM,b);case "type":return"Polyline"}break;case "multipoint":switch(b){case "points":return b=a.cache._arcadeCacheId,void 0===b&&(ka++,b=ka,a.cache._arcadeCacheId=b),a=new e(a.points,a.spatialReference,!0===a.hasZ,!0===a.hasM,b,1);case "type":return"Multipoint"}}throw Error(f.nodeErrorMessage(c,"RUNTIME","PROPERTYNOTFOUND"));}function S(a,b){try{var c=b.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[c])return"lscope['"+
c+"']";if(void 0!==a.localScope._SymbolsMap[c])return"lscope['"+a.localScope._SymbolsMap[c]+"']"}if(void 0!==a.globalScope[c])return"gscope['"+c+"']";if(void 0!==a.globalScope._SymbolsMap[c])return"gscope['"+a.globalScope._SymbolsMap[c]+"']";throw Error(f.nodeErrorMessage(b,"RUNTIME","VARIABLENOTFOUND"));}catch(G){throw G;}}function T(b){return null===b?"":d.isArray(b)||d.isImmutableArray(b)?"Array":d.isDate(b)?"Date":d.isString(b)?"String":d.isBoolean(b)?"Boolean":d.isNumber(b)?"Number":b instanceof
k?"Attachment":b instanceof l?"Portal":b instanceof h?"Dictionary":b instanceof a?"Feature":b instanceof v?"Point":b instanceof z?"Polygon":b instanceof B?"Polyline":b instanceof m?"Multipoint":b instanceof u?"Extent":d.isFunctionParameter(b)?"Function":d.isFeatureSet(b)?"FeatureSet":d.isFeatureSetCollection(b)?"FeatureSetCollection":b===d.voidOperation?"":"number"===typeof b&&isNaN(b)?"Number":"Unrecognised Type"}function U(a,b,c,e){try{if(d.equalityTest(b[c],e))return b[c+1];var f=b.length-c;return 1===
f?b[c]:2===f?null:3===f?b[c+2]:U(a,b,c+2,e)}catch(za){throw za;}}function Y(a,b,c,e){try{if(!0===e)return b[c+1];if(3===b.length-c)return b[c+2];var f=b[c+2];if(!1===d.isBoolean(f))throw Error("WHEN needs boolean test conditions");return Y(a,b,c+2,f)}catch(za){throw za;}}function X(a,b){var c=a.length,d=Math.floor(c/2);if(0===c)return[];if(1===c)return[a[0]];var e=X(a.slice(0,d),b);a=X(a.slice(d,c),b);for(c=[];0<e.length||0<a.length;)0<e.length&&0<a.length?(d=b(e[0],a[0]),isNaN(d)&&(d=0),0>=d?(c.push(e[0]),
e=e.slice(1)):(c.push(a[0]),a=a.slice(1))):0<e.length?(c.push(e[0]),e=e.slice(1)):0<a.length&&(c.push(a[0]),a=a.slice(1));return c}function P(a,b){try{var c=a.length,d=Math.floor(c/2);if(0===c)return w.resolve([]);if(1===c)return w.resolve([a[0]]);var e=[P(a.slice(0,d),b),P(a.slice(d,c),b)];return w.all(e).then(function(a){return V(a[0],a[1],b,[])})}catch(za){return w.reject(za)}}function V(a,b,c,d){return w.create(function(e,f){0<a.length||0<b.length?0<a.length&&0<b.length?c(a[0],b[0]).then(function(g){try{isNaN(g)&&
(g=1),0>=g?(d.push(a[0]),a=a.slice(1)):(d.push(b[0]),b=b.slice(1)),V(a,b,c,d).then(function(a){e(a)},f)}catch(qa){f(qa)}},f):0<a.length?(d.push(a[0]),a=a.slice(1),V(a,b,c,d).then(function(a){e(a)},f)):0<b.length&&(d.push(b[0]),b=b.slice(1),V(a,b,c,d).then(function(a){e(a)},f)):e(d)})}function Z(a,b){b.symbols.symbolCounter++;return"_T"+b.symbols.symbolCounter.toString()}function ca(a){a.symbols.symbolCounter++;return"_Tvar"+a.symbols.symbolCounter.toString()}function da(a,b,c){var d={};a||(a={});
c||(c={});d._SymbolsMap={};d.textformatting=1;d.infinity=1;d.pi=1;for(var e in b)d[e]=1;for(e in c)d[e]=1;for(e in a)d[e]=1;return d}function F(a,b){for(var c={mode:b,compiled:!0,functions:{},signatures:[],failDefferred:K,standardFunction:D,standardFunctionAsync:D,evaluateIdentifier:ea},e=0;e<a.length;e++)a[e].registerFunctions(c);if("sync"===b){for(var g in c.functions)oa[g]=new d.NativeFunction(c.functions[g]),xa.prototype[g]=oa[g];for(e=0;e<c.signatures.length;e++)f.addFunctionDeclaration(c.signatures[e],
"sync")}else{for(g in c.functions)va[g]=new d.NativeFunction(c.functions[g]),ia.prototype[g]=va[g];for(e=0;e<c.signatures.length;e++)f.addFunctionDeclaration(c.signatures[e],"async")}}function ea(a,b){b=b.name;if("_SymbolsMap"===b)throw"Illegal";if(0<a.localStack.length){if("_t"!==b.substr(0,2).toLowerCase()&&void 0!==a.localStack[a.localStack.length-1][b])return a.localStack[a.localStack.length-1][b];var c=a.mangleMap[b];if(void 0!==c&&void 0!==a.localStack[a.localStack.length-1][c])return a.localStack[a.localStack.length-
1][c]}if("_t"!==b.substr(0,2).toLowerCase()&&void 0!==a.globalScope[b]||1===a.globalScope._SymbolsMap[b])return a.globalScope[b];b=a.mangleMap[b];if(void 0!==b)return a.globalScope[b]}function la(a){console.log(a)}Object.defineProperty(b,"__esModule",{value:!0});var ka=0,oa={};c.registerFunctions(oa,D);x.registerFunctions(oa,D);r.registerFunctions(oa,D);q.registerFunctions(oa,D);t.registerFunctions(oa,D);oa["typeof"]=function(a,b){return D(a,b,function(a,b,c){d.pcCheck(c,1,1);a=T(c[0]);if("Unrecognised Type"===
a)throw Error("Unrecognised Type");return a})};oa.iif=function(a,b){try{return D(a,b,function(a,b,c){d.pcCheck(c,3,3);if(!1===d.isBoolean(c[0]))throw Error("IF Function must have a boolean test condition");return c[0]?c[1]:c[2]})}catch(ya){throw ya;}};oa.decode=function(a,b){try{return D(a,b,function(b,c,d){if(2>d.length)throw Error("Missing Parameters");if(2===d.length)return d[1];if(0===(d.length-1)%2)throw Error("Must have a default value result.");return U(a,d,1,d[0])})}catch(ya){throw ya;}};
oa.when=function(a,b){try{return D(a,b,function(b,c,e){if(3>e.length)throw Error("Missing Parameters");if(0===e.length%2)throw Error("Must have a default value result.");b=e[0];if(!1===d.isBoolean(b))throw Error("WHEN needs boolean test conditions");return Y(a,e,0,b)})}catch(ya){throw ya;}};oa.top=function(a,b){return D(a,b,function(a,b,c){d.pcCheck(c,2,2);if(d.isArray(c[0]))return d.toNumber(c[1])>=c[0].length?c[0].slice(0):c[0].slice(0,d.toNumber(c[1]));if(d.isImmutableArray(c[0]))return d.toNumber(c[1])>=
c[0].length()?c[0].slice(0):c[0].slice(0,d.toNumber(c[1]));throw Error("Top cannot accept this parameter type");})};oa.first=function(a,b){return D(a,b,function(a,b,c){d.pcCheck(c,1,1);return d.isArray(c[0])?0===c[0].length?null:c[0][0]:d.isImmutableArray(c[0])?0===c[0].length()?null:c[0].get(0):null})};oa.sort=function(a,b){return D(a,b,function(b,c,e){d.pcCheck(e,1,2);c=e[0];d.isImmutableArray(c)&&(c=c.toArray());if(!1===d.isArray(c))throw Error("Illegal Argument");if(1<e.length){if(!1===d.isFunctionParameter(e[1]))throw Error("Illegal Argument");
var f=function(a,c){return wa.callfunc(e[1],[a,c],b)};return a.isAsync?P(c,f):c=X(c,function(a,b){return f(a,b)})}if(0===c.length)return[];for(var g={},h=0;h<c.length;h++){var m=T(c[h]);""!==m&&(g[m]=!0)}if(!0===g.Array||!0===g.Dictionary||!0===g.Feature||!0===g.Point||!0===g.Polygon||!0===g.Polyline||!0===g.Multipoint||!0===g.Extent||!0===g.Function)return c.slice(0);var h=0,m="",k;for(k in g)h++,m=k;return c=1<h||"String"===m?X(c,function(a,b){if(null===a||void 0===a||a===d.voidOperation)return null===
b||void 0===b||b===d.voidOperation?0:1;if(null===b||void 0===b||b===d.voidOperation)return-1;a=d.toString(a);b=d.toString(b);return a<b?-1:a===b?0:1}):"Number"===m?X(c,function(a,b){return a-b}):"Boolean"===m?X(c,function(a,b){return a===b?0:b?-1:1}):"Date"===m?X(c,function(a,b){return b-a}):c.slice(0)})};var va={},fa;for(fa in oa)va[fa]=new d.NativeFunction(oa[fa]);p.registerFunctions(oa,D);for(fa in oa)oa[fa]=new d.NativeFunction(oa[fa]);var xa=function(){};xa.prototype=oa;var ia=function(){};ia.prototype=
va;b.functionHelper={fixSpatialReference:d.fixSpatialReference,parseArguments:function(a,b){for(var c=[],d=0;d<b.arguments.length;d++)c.push(I(a,b.arguments[d]));return c},standardFunction:D};b.extend=F;b.executeScript=function(a,b){return a(b)};b.extractFieldLiterals=function(a,b){void 0===b&&(b=!1);return f.findFieldLiterals(a,b)};b.validateScript=function(a,b){return f.validateScript(a,b,"sync")};b.referencesMember=function(a,b){return f.referencesMember(a,b)};b.referencesFunction=function(a,b){return f.referencesFunction(a,
b)};var na=0,wa={error:function(a,b,c){throw Error(f.nodeErrorMessage(a,b,c));},__awaiter:function(a,b,c,d){return w.create(function(c,e){function f(a){try{h(d.next(a))}catch(ga){e(ga)}}function g(a){try{h(d["throw"](a))}catch(ga){e(ga)}}function h(a){a.done?c(a.value):a.value&&a.value.then?a.value.then(f,g):(na++,0===na%100?setTimeout(function(){na=0;f(a.value)},0):f(a.value))}h((d=d.apply(a,b||[])).next())})},functionDepthchecker:function(a,b){return function(){b.depthCounter++;b.localStack.push([]);
if(64<b.depthCounter)throw Error("Exceeded maximum function depth");var c=a.apply(this,arguments);if(w.isThenable(c))return c.then(function(a){b.depthCounter--;--b.localStack.length;return a});b.depthCounter--;--b.localStack.length;return c}},aCheck:function(a,b){if(d.isFunctionParameter(a))throw Error(f.nodeErrorMessage({type:b},"RUNTIME","FUNCTIONCONTEXTILLEGAL"));return a===d.voidOperation?null:a},Dictionary:h,Feature:a,dictionary:function(a){for(var b={},c=0;c<a.length;c+=2){if(d.isFunctionParameter(a[c+
1]))throw Error("Illegal Argument");if(!1===d.isString(a[c]))throw Error("Illegal Argument");b[a[c].toString()]=a[c+1]===d.voidOperation?null:a[c+1]}a=new h(b);a.immutable=!1;return a},strCheck:function(a,b){if(!1===d.isString(a))throw Error("Illegal Argument");return a},unary:function(a,b){if(d.isBoolean(a)){if("!"===b)return!a;if("-"===b)return-1*d.toNumber(a);if("+"===b)return 1*d.toNumber(a);throw Error(f.nodeErrorMessage({type:"UnaryExpression",operator:b,prefix:null,argument:null},"RUNTIME",
"NOTSUPPORTEDUNARYOPERATOR"));}if("-"===b)return-1*d.toNumber(a);if("+"===b)return 1*d.toNumber(a);throw Error(f.nodeErrorMessage({type:"UnaryExpression",operator:b,prefix:null,argument:null},"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));},logicalCheck:function(a){if(!1===d.isBoolean(a))throw Error(f.nodeErrorMessage({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"));return a},logical:function(a,b,c){if(d.isBoolean(a)&&d.isBoolean(b))switch(c){case "||":return a||b;
case "\x26\x26":return a&&b}throw Error(f.nodeErrorMessage({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"));},binary:function(a,b,c){switch(c){case "\x3d\x3d":return d.equalityTest(a,b);case "\x3d":return d.equalityTest(a,b);case "!\x3d":return!d.equalityTest(a,b);case "\x3c":return d.greaterThanLessThan(a,b,c);case "\x3e":return d.greaterThanLessThan(a,b,c);case "\x3c\x3d":return d.greaterThanLessThan(a,b,c);case "\x3e\x3d":return d.greaterThanLessThan(a,b,
c);case "+":return d.isString(a)||d.isString(b)?d.toString(a)+d.toString(b):d.toNumber(a)+d.toNumber(b);case "-":return d.toNumber(a)-d.toNumber(b);case "*":return d.toNumber(a)*d.toNumber(b);case "/":return d.toNumber(a)/d.toNumber(b);case "%":return d.toNumber(a)%d.toNumber(b);default:throw Error(f.nodeErrorMessage({type:"BinaryExpression",operator:c,left:a,right:b},"RUNTIME","OPERATORNOTRECOGNISED"));}},assign:function(a,b,c){switch(b){case "\x3d":return a===d.voidOperation?null:a;case "/\x3d":return d.toNumber(c)/
d.toNumber(a);case "*\x3d":return d.toNumber(c)*d.toNumber(a);case "-\x3d":return d.toNumber(c)-d.toNumber(a);case "+\x3d":return d.isString(c)||d.isString(a)?d.toString(c)+d.toString(a):d.toNumber(c)+d.toNumber(a);case "%\x3d":return d.toNumber(c)%d.toNumber(a);default:throw Error(f.nodeErrorMessage({type:"AssignmentExpression",operator:b,left:null,right:null},"RUNTIME","OPERATORNOTRECOGNISED"));}},update:function(a,b,c,e){var f=d.toNumber(a[b]);a[b]="++"===c?f+1:f-1;return!1===e?f:"++"===c?f+1:
f-1},graphicToFeature:function(b,c){return null===b?null:a.createFromGraphicLikeObject(b.geometry,b.attributes,c)},memberupdate:function(b,c,e,f){var g;if(d.isArray(b))if(d.isNumber(c)){0>c&&(c=b.length+c);if(0>c||c>=b.length)throw Error("Assignment outside of array bounds");g=d.toNumber(b[c]);b[c]="++"===e?g+1:g-1}else throw Error("Invalid Parameter");else if(b instanceof h){if(!1===d.isString(c))throw Error("Dictionary accessor must be a string");if(!0===b.hasField(c))g=d.toNumber(b.field(c)),b.setField(c,
"++"===e?g+1:g-1);else throw Error("Invalid Parameter");}else if(b instanceof a){if(!1===d.isString(c))throw Error("Feature accessor must be a string");if(!0===b.hasField(c))g=d.toNumber(b.field(c)),b.setField(c,"++"===e?g+1:g-1);else throw Error("Invalid Parameter");}else{if(d.isImmutableArray(b))throw Error("Array is Immutable");throw Error("Invalid Parameter");}return!1===f?g:"++"===e?g+1:g-1},assignmember:function(b,c,e,f){if(d.isArray(b))if(d.isNumber(c)){0>c&&(c=b.length+c);if(0>c||c>b.length)throw Error("Assignment outside of array bounds");
if(c===b.length&&"\x3d"!==e)throw Error("Invalid Parameter");b[c]=this.assign(f,e,b[c])}else throw Error("Invalid Parameter");else if(b instanceof h){if(!1===d.isString(c))throw Error("Dictionary accessor must be a string");if(!0===b.hasField(c))b.setField(c,this.assign(f,e,b.field(c)));else{if("\x3d"!==e)throw Error("Invalid Parameter");b.setField(c,this.assign(f,e,null))}}else if(b instanceof a){if(!1===d.isString(c))throw Error("Feature accessor must be a string");if(!0===b.hasField(c))b.setField(c,
this.assign(f,e,b.field(c)));else{if("\x3d"!==e)throw Error("Invalid Parameter");b.setField(c,this.assign(f,e,null))}}else{if(d.isImmutableArray(b))throw Error("Array is Immutable");throw Error("Invalid Parameter");}},member:function(b,c){if(null===b)throw Error(f.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","NOTFOUND"));if(b instanceof h||b instanceof a){if(d.isString(c))return b.field(c);throw Error(f.nodeErrorMessage({type:"MemberExpression",object:null,
property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(b instanceof y){if(d.isString(c))return R(b,c,"MemberExpression");throw Error(f.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(d.isArray(b)){if(d.isNumber(c)&&isFinite(c)&&Math.floor(c)===c){0>c&&(c=b.length+c);if(c>=b.length||0>c)throw Error(f.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"));return b[c]}throw Error(f.nodeErrorMessage({type:"MemberExpression",
object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(d.isString(b)){if(d.isNumber(c)&&isFinite(c)&&Math.floor(c)===c){0>c&&(c=b.length+c);if(c>=b.length||0>c)throw Error(f.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"));return b[c]}throw Error(f.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(d.isImmutableArray(b)&&d.isNumber(c)&&isFinite(c)&&Math.floor(c)===
c){0>c&&(c=b.length()+c);if(c>=b.length()||0>c)throw Error(f.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"));return b.get(c)}throw Error(f.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));},callfunc:function(a,b,c){return a instanceof d.NativeFunction?a.fn(c,b):a instanceof d.SizzleFunction?a.fn.apply(this,b):a.apply(this,b)}};b.compileScript=function(b,c,e){void 0===c&&(c=null);
void 0===e&&(e=!1);null===c&&(c={vars:{},customfunctions:{}});c={isAsync:e,globalScope:da(c.vars,e?va:oa,c.customfunctions),localScope:null,mangleMap:{},console:la,lrucache:c.lrucache,services:c.services,symbols:{symbolCounter:0}};b=I(c,b.body[0].body);""===b&&(b="lc.voidOperation; ");c={lc:d,lang:wa,mangles:c.mangleMap,postProcess:function(a){a instanceof d.ReturnResult&&(a=a.value);a instanceof d.ImplicitResult&&(a=a.value);a===d.voidOperation&&(a=null);if(a===d.breakResult)throw Error("Cannot return BREAK");
if(a===d.continueResult)throw Error("Cannot return CONTINUE");if(d.isFunctionParameter(a))throw Error("Cannot return FUNCTION");return a},prepare:function(b,c){var d=b.spatialReference;if(null===d||void 0===d)d=new C({wkid:102100});var e=b.vars,f=b.customfunctions,g=c?new ia:new xa;e||(e={});f||(f={});var m=new h({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});m.immutable=!1;g._SymbolsMap={textformatting:1,infinity:1,pi:1};g.textformatting=m;g.infinity=
Number.POSITIVE_INFINITY;g.pi=Math.PI;for(var k in f)g[k]=f[k],g._SymbolsMap[k]=1;for(k in e)g._SymbolsMap[k]=1,g[k]=e[k]&&"esri.Graphic"===e[k].declaredClass?a.createFromGraphic(e[k]):e[k];return{localStack:[],isAsync:c,mangleMap:this.mangles,spatialReference:d,globalScope:g,abortSignal:void 0===b.abortSignal||null===b.abortSignal?{aborted:!1}:b.abortSignal,localScope:null,services:b.services,console:b.console?b.console:la,lrucache:b.lrucache,symbols:{symbolCounter:0},depthCounter:1}}};return(new Function("context",
"spatialReference",e?"var runtimeCtx\x3dthis.prepare(context, true);\n var lc \x3d this.lc;  var lang \x3d this.lang; var gscope\x3druntimeCtx.globalScope; \nreturn lang.__awaiter(this, void 0, void 0, function* () {\n\n function mainBody() {\n var lastStatement\x3dlc.voidOperation;\n return lang.__awaiter(this, void 0, void 0, function* () {\n"+b+"\n return lastStatement; }); } \n return this.postProcess(yield mainBody()); }); ":"var runtimeCtx\x3dthis.prepare(context, false);\n var lc \x3d this.lc;  var lang \x3d this.lang; var gscope\x3druntimeCtx.globalScope; \n function mainBody() {\n var lastStatement\x3dlc.voidOperation;\n "+
b+"\n return lastStatement; } \n return this.postProcess(mainBody()); ")).bind(c)};b.enableAsyncSupport=function(){return w.create(function(a,b){n(["./functions/geomasync"],function(b){F([b],"async");a(!0)},function(a){b(a)})})}})},"esri/arcade/ArcadePortal":function(){define(["require","exports","../core/tsSupport/extendsHelper","./Dictionary"],function(n,b,l,k){return function(b){function a(a){var e=b.call(this)||this;e.immutable=!1;e.setField("url",a);e.immutable=!0;return e}l(a,b);return a}(k)})},
"esri/arcade/Dictionary":function(){define(["require","exports","./ImmutableArray","./languageUtils","../geometry/Geometry"],function(n,b,l,k,h){function a(b){var d=null;if(null!==b)if(k.isNumber(b))d=k.toNumber(b);else if(k.isBoolean(b))d=k.toBoolean(b);else if(k.isString(b))d=k.toString(b);else if(k.isDate(b))d=k.toDate(b);else if(k.isArray(b))for(var d=[],e=0;e<b.length;e++)d.push(a(b[e]));else{if(0===Object.keys(b).length)return null;d=new g;d.immutable=!1;for(var e=0,c=Object.keys(b);e<c.length;e++){var h=
c[e];d.setField(h,a(b[h]))}d.immutable=!0}return d}var g=function(){function b(a){this.declaredClass="esri.arcade.Dictionary";this.attributes=null;this.plain=!1;this.immutable=!0;this.attributes=a instanceof b?a.attributes:void 0===a?{}:null===a?{}:a}b.prototype.field=function(a){var b=a.toLowerCase();a=this.attributes[a];if(void 0!==a)return a;for(var c in this.attributes)if(c.toLowerCase()===b)return this.attributes[c];throw Error("Field not Found");};b.prototype.setField=function(a,b){if(this.immutable)throw Error("Dictionary is Immutable");
var c=a.toLowerCase();if(void 0===this.attributes[a])for(var d in this.attributes)if(d.toLowerCase()===c){this.attributes[d]=b;return}this.attributes[a]=b};b.prototype.hasField=function(a){var b=a.toLowerCase();if(void 0!==this.attributes[a])return!0;for(var c in this.attributes)if(c.toLowerCase()===b)return!0;return!1};b.prototype.keys=function(){var a=[],b;for(b in this.attributes)a.push(b);return a=a.sort()};b.prototype.castToText=function(){var a="",b;for(b in this.attributes){""!==a&&(a+=",");
var c=this.attributes[b];null==c?a+=JSON.stringify(b)+":null":k.isBoolean(c)||k.isNumber(c)||k.isString(c)?a+=JSON.stringify(b)+":"+JSON.stringify(c):c instanceof h?a+=JSON.stringify(b)+":"+k.toStringExplicit(c):c instanceof l?a+=JSON.stringify(b)+":"+k.toStringExplicit(c):c instanceof Array?a+=JSON.stringify(b)+":"+k.toStringExplicit(c):c instanceof Date?a+=JSON.stringify(b)+":"+JSON.stringify(c):null!==c&&"object"===typeof c&&void 0!==c.castToText&&(a+=JSON.stringify(b)+":"+c.castToText())}return"{"+
a+"}"};b.convertObjectToArcadeDictionary=function(d){var e=new b;e.immutable=!1;for(var c in d)e.setField(c.toString(),a(d[c]));e.immutable=!0;return e};return b}();return g})},"esri/arcade/ImmutableArray":function(){define(["require","exports"],function(n,b){return function(){function b(b){void 0===b&&(b=[]);this._elements=b}b.prototype.length=function(){return this._elements.length};b.prototype.get=function(b){return this._elements[b]};b.prototype.toArray=function(){for(var b=[],h=0;h<this.length();h++)b.push(this.get(h));
return b};return b}()})},"esri/arcade/languageUtils":function(){define("require exports dojo/number ./FunctionWrapper ./ImmutableArray ./ImmutablePathArray ./ImmutablePointArray ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../core/promiseUtils ../geometry/support/coordsUtils ../core/maybe".split(" "),function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){function w(a,b,c){return""===b||null===b||void 0===b||b===c||b===c?a:a=a.split(b).join(c)}
function u(a){return a instanceof P||a instanceof k||a instanceof V}function y(a){return m(a)||z(a)||D(a)||v(a)||null===a||a===b.voidOperation||"number"===typeof a?!0:!1}function m(a){return"string"===typeof a||a instanceof String}function v(a){return"boolean"===typeof a}function z(a){return"number"===typeof a}function B(a){return a instanceof Array}function C(a){return a instanceof h}function D(a){return a instanceof Date}function K(a,b){if(!1===isNaN(a)){if(void 0===b||null===b||""===b)return a.toString();
b=w(b,"\u2030","");b=w(b,"\u00a4","");return l.format(a,{pattern:b})}return a.toString()}function I(a,c){a=b.MomentLibrary.Moment(a);return void 0===c||null===c||""===c?a.format():a.format(Q(c))}function Q(a){return a.replace(/(LTS)|L|l/g,function(a){return"["+a+"]"})}function J(a,b,c){switch(c){case "\x3e":return a>b;case "\x3c":return a<b;case "\x3e\x3d":return a>=b;case "\x3c\x3d":return a<=b}return!1}function N(d,e){if(d===e||null===d&&e===b.voidOperation||null===e&&d===b.voidOperation)return!0;
if(D(d)&&D(e))return d.getTime()===e.getTime();if(d instanceof a||d instanceof g)return d.equalityTest(e);if(d instanceof c&&e instanceof c){var f=void 0,h=void 0,f=d.cache._arcadeCacheId,h=e.cache._arcadeCacheId;if(void 0!==f&&null!==f)return f===h}return void 0!==d&&void 0!==e&&null!==d&&null!==e&&"object"===typeof d&&"object"===typeof e&&(d._arcadeCacheId===e._arcadeCacheId&&void 0!==d._arcadeCacheId&&null!==d._arcadeCacheId||d._underlyingGraphic===e._underlyingGraphic&&void 0!==d._underlyingGraphic&&
null!==d._underlyingGraphic)?!0:!1}function L(a,b){if(m(a))return a;if(null===a)return"";if(z(a))return K(a,b);if(v(a))return a.toString();if(D(a))return I(a,b);if(a instanceof d)return JSON.stringify(a.toJSON());if(B(a)){b=[];for(var c=0;c<a.length;c++)b[c]=R(a[c]);return"["+b.join(",")+"]"}if(a instanceof h){b=[];for(c=0;c<a.length();c++)b[c]=R(a.get(c));return"["+b.join(",")+"]"}return null!==a&&"object"===typeof a&&void 0!==a.castToText?a.castToText():u(a)?"object, Function":""}function M(a,b){if(m(a))return a;
if(null===a)return"";if(z(a))return K(a,b);if(v(a))return a.toString();if(D(a))return I(a,b);if(a instanceof d)return a instanceof e?'{"xmin":'+a.xmin.toString()+',"ymin":'+a.ymin.toString()+","+(a.hasZ?'"zmin":'+a.zmin.toString()+",":"")+(a.hasM?'"mmin":'+a.mmin.toString()+",":"")+'"xmax":'+a.xmax.toString()+',"ymax":'+a.ymax.toString()+","+(a.hasZ?'"zmax":'+a.zmax.toString()+",":"")+(a.hasM?'"mmax":'+a.mmax.toString()+",":"")+'"spatialReference":'+U(a.spatialReference)+"}":U(a.toJSON(),function(a,
b){return a.key===b.key?0:"spatialReference"===a.key?1:"spatialReference"===b.key||a.key<b.key?-1:a.key>b.key?1:0});if(B(a)){b=[];for(var c=0;c<a.length;c++)b[c]=R(a[c]);return"["+b.join(",")+"]"}if(a instanceof h){b=[];for(c=0;c<a.length();c++)b[c]=R(a.get(c));return"["+b.join(",")+"]"}return null!==a&&"object"===typeof a&&void 0!==a.castToText?a.castToText():u(a)?"object, Function":""}function R(a){return null===a?"null":v(a)||z(a)||m(a)?JSON.stringify(a):a instanceof d||a instanceof h||a instanceof
Array?M(a):a instanceof Date?JSON.stringify(I(a,"")):null!==a&&"object"===typeof a&&void 0!==a.castToText?a.castToText():"null"}function S(a,c){return z(a)?a:null===a||""===a?0:D(a)?NaN:v(a)?a?1:0:B(a)||""===a||void 0===a?NaN:void 0!==c&&m(a)?(c=w(c,"\u2030",""),c=w(c,"\u00a4",""),l.parse(a,{pattern:c})):a===b.voidOperation?0:Number(a)}function T(a,b){var c;b.fields.some(function(b){b.name===a&&(c=b.domain);return!!c});return c}function U(a,b){b||(b={});"function"===typeof b&&(b={cmp:b});var c="boolean"===
typeof b.cycles?b.cycles:!1,d=b.cmp&&function(a){return function(b){return function(c,d){return a({key:c,value:b[c]},{key:d,value:b[d]})}}}(b.cmp),e=[];return function oa(a){a&&a.toJSON&&"function"===typeof a.toJSON&&(a=a.toJSON());if(void 0!==a){if("number"===typeof a)return isFinite(a)?""+a:"null";if("object"!==typeof a)return JSON.stringify(a);var b,f;if(Array.isArray(a)){f="[";for(b=0;b<a.length;b++)b&&(f+=","),f+=oa(a[b])||"null";return f+"]"}if(null===a)return"null";if(-1!==e.indexOf(a)){if(c)return JSON.stringify("__cycle__");
throw new TypeError("Converting circular structure to JSON");}var g=e.push(a)-1,h=Object.keys(a).sort(d&&d(a));f="";for(b=0;b<h.length;b++){var m=h[b],k=oa(a[m]);k&&(f&&(f+=","),f+=JSON.stringify(m)+":"+k)}e.splice(g,1);return"{"+f+"}"}}(a)}function Y(a,b){if(b instanceof c)a.push(b.hasZ?b.hasM?[b.x,b.y,b.z,b.m]:[b.x,b.y,b.z]:[b.x,b.y]);else throw Error("Invalid Argument");}Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(a){this.value=a}}();b.ReturnResultE=n;var X=function(){return function(a){this.value=
a}}();b.ImplicitResultE=X;var P=function(){return function(a){this.fn=a}}();b.NativeFunctionE=P;var V=function(){return function(a){this.fn=a}}();b.SizzleFunctionE=V;b.NativeFunction=P;b.ImplicitResult=X;b.ReturnResult=n;b.SizzleFunction=V;b.voidOperation={type:"VOID"};b.breakResult={type:"BREAK"};b.continueResult={type:"CONTINUE"};b.multiReplace=w;b.isFunctionParameter=u;b.isSimpleType=y;b.defaultUndefined=function(a,b){return void 0===a?b:a};b.isString=m;b.isBoolean=v;b.isNumber=z;b.isArray=B;b.isFeatureSet=
function(a){return!0===(a&&a.declaredRootClass&&"esri.arcade.featureset.support.FeatureSet"===a.declaredRootClass)};b.isFeatureSetCollection=function(a){return!0===(a&&a.declaredRootClass&&"esri.arcade.featureSetCollection"===a.declaredRootClass)};b.isImmutableArray=C;b.isDate=D;b.pcCheck=function(a,b,c){if(a.length<b||a.length>c)throw Error("Function called with wrong number of Parameters");};b.generateUUID=function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(b){var c=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"===b?c:c&3|8).toString(16)})};b.formatNumber=K;b.formatDate=I;b.standardiseDateFormat=Q;b.greaterThanLessThan=function(a,c,d){if(null===a){if(null===c||c===b.voidOperation)return J(null,null,d);if(z(c))return J(0,c,d);if(m(c)||v(c))return J(0,S(c),d);if(D(c))return J(0,c.getTime(),d)}if(a===b.voidOperation){if(null===c||c===b.voidOperation)return J(null,null,d);if(z(c))return J(0,c,d);if(m(c)||v(c))return J(0,S(c),d);if(D(c))return J(0,
c.getTime(),d)}else if(z(a)){if(z(c))return J(a,c,d);if(v(c))return J(a,S(c),d);if(null===c||c===b.voidOperation)return J(a,0,d);if(m(c))return J(a,S(c),d);if(D(c))return J(a,c.getTime(),d)}else if(m(a)){if(m(c))return J(L(a),L(c),d);if(D(c))return J(S(a),c.getTime(),d);if(z(c))return J(S(a),c,d);if(null===c||c===b.voidOperation)return J(S(a),0,d);if(v(c))return J(S(a),S(c),d)}else if(D(a)){if(D(c))return J(a,c,d);if(null===c||c===b.voidOperation)return J(a.getTime(),0,d);if(z(c))return J(a.getTime(),
c,d);if(v(c)||m(c))return J(a.getTime(),S(c),d)}else if(v(a)){if(v(c))return J(a,c,d);if(z(c))return J(S(a),S(c),d);if(D(c))return J(S(a),c.getTime(),d);if(null===c||c===b.voidOperation)return J(S(a),0,d);if(m(c))return J(S(a),S(c),d)}return!N(a,c)||"\x3c\x3d"!==d&&"\x3e\x3d"!==d?!1:!0};b.equalityTest=N;b.toString=L;b.toNumberArray=function(a){var b=[];if(!1===B(a))return null;if(a instanceof h){for(var c=0;c<a.length();c++)b[c]=S(a.get(c));return b}for(c=0;c<a.length;c++)b[c]=S(a[c]);return b};b.toStringExplicit=
M;b.toNumber=S;b.toDate=function(a,c){return D(a)?a:m(a)&&(a=b.MomentLibrary.Moment(a,[void 0===c||null===c||""===c?b.MomentLibrary.Moment.ISO_8601:c]),a.isValid())?a.toDate():null};b.toDateM=function(a,c){return D(a)?b.MomentLibrary.Moment(a):m(a)&&(a=b.MomentLibrary.Moment(a,[void 0===c||null===c||""===c?b.MomentLibrary.Moment.ISO_8601:c]),a.isValid())?a:null};b.toBoolean=function(a){return v(a)?a:m(a)?(a=a.toLowerCase(),"true"===a?!0:!1):z(a)?0===a||isNaN(a)?!1:!0:!1};b.fixSpatialReference=function(a,
b){if(x.isNone(a))return null;if(null===a.spatialReference||void 0===a.spatialReference)a.spatialReference=b;return a};b.fixNullGeometry=function(a){return null===a?null:a instanceof c?"NaN"===a.x||null===a.x||isNaN(a.x)?null:a:a instanceof q?0===a.rings.length?null:a:a instanceof p?0===a.paths.length?null:a:a instanceof f?0===a.points.length?null:a:a instanceof e?"NaN"===a.xmin||null===a.xmin||isNaN(a.xmin)?null:a:null};b.getDomainValue=function(a,b){if(!a||!a.domain)return b;var c=null;b="string"===
a.field.type||"esriFieldTypeString"===a.field.type?L(b):S(b);for(var d=0;d<a.domain.codedValues.length;d++){var e=a.domain.codedValues[d];e.code===b&&(c=e)}return null===c?b:c.name};b.getDomainCode=function(a,b){if(!a||!a.domain)return b;var c=null;b=L(b);for(var d=0;d<a.domain.codedValues.length;d++){var e=a.domain.codedValues[d];e.name===b&&(c=e)}return null===c?b:c.code};b.getDomain=function(a,b,c,d){void 0===c&&(c=null);if(!b||!b.fields)return null;for(var e=null,f=0;f<b.fields.length;f++){var g=
b.fields[f];g.name.toLowerCase()===a.toString().toLowerCase()&&(e=g)}if(null===e)throw Error("Field not found");var h,m;d||(d=c&&b.typeIdField&&c._field(b.typeIdField));null!=d&&b.types.some(function(a){return a.id===d?((h=a.domains&&a.domains[e.name])&&"inherited"===h.type&&(h=T(e.name,b),m=!0),!0):!1});m||h||(h=T(a,b));return{field:e,domain:h}};b.stableStringify=U;b.autoCastFeatureToGeometry=function(a){if(null===a)return null;for(var b=[],c=0;c<a.length;c++){var d=a[c];d&&d.declaredClass&&"esri.arcade.Feature"===
d.declaredClass?b.push(d.geometry()):b.push(d)}return b};b.autoCastArrayOfPointsToPolygon=function(a,b){if(B(a)||C(a)){var c=!1,d=!1,e=[];if(B(a)){for(var f=0;f<a.length;f++){var h=a[f];Y(e,h)}0<e.length&&(b=a[0].spatialReference,c=a[0].hasZ,d=a[0].hasM)}else if(a instanceof g)e=a._elements,0<e.length&&(c=a._hasZ,d=a._hasM,b=a.get(0).spatialReference);else if(C(a)){for(var f=0,m=a.toArray();f<m.length;f++)h=m[f],Y(e,h);0<e.length&&(b=a.get(0).spatialReference,c=!0===a.get(0).hasZ,d=!0===a.get(0).hasM)}else throw Error("Invalid Argument");
if(0===e.length)return null;!1===t.isClockwise(e,d,c)&&(e=e.slice(0).reverse());return new q({rings:[e],spatialReference:b,hasZ:c,hasM:d})}return a};b.autoCastArrayOfPointsToPolyline=function(a,b){if(B(a)||C(a)){var c=!1,d=!1,e=[];if(B(a)){for(var f=0;f<a.length;f++){var h=a[f];Y(e,h)}0<e.length&&(b=a[0].spatialReference,c=!0===a[0].hasZ,d=!0===a[0].hasM)}else if(a instanceof g)e=a._elements,0<e.length&&(c=a._hasZ,d=a._hasM,b=a.get(0).spatialReference);else if(C(a)){for(var f=0,m=a.toArray();f<m.length;f++)h=
m[f],Y(e,h);0<e.length&&(b=a.get(0).spatialReference,c=!0===a.get(0).hasZ,d=!0===a.get(0).hasM)}return 0===e.length?null:new p({paths:[e],spatialReference:b,hasZ:c,hasM:d})}return a};b.autoCastArrayOfPointsToMultiPoint=function(a,b){if(B(a)||C(a)){var c=!1,d=!1,e=[];if(B(a)){for(var h=0;h<a.length;h++){var m=a[h];Y(e,m)}0<e.length&&(b=a[0].spatialReference,c=!0===a[0].hasZ,d=!0===a[0].hasM)}else if(a instanceof g)e=a._elements,0<e.length&&(c=a._hasZ,d=a._hasM,b=a.get(0).spatialReference);else if(C(a)){for(var h=
0,k=a.toArray();h<k.length;h++)m=k[h],Y(e,m);0<e.length&&(b=a.get(0).spatialReference,c=!0===a.get(0).hasZ,d=!0===a.get(0).hasM)}return 0===e.length?null:new f({points:e,spatialReference:b,hasZ:c,hasM:d})}return a};b.toStringArray=function(a,b){void 0===b&&(b=!1);var c=[];if(null===a)return c;if(!0===B(a)){for(var d=0;d<a.length;d++){var e=L(a[d]);""===e&&!0!==b||c.push(e)}return c}if(a instanceof h){for(d=0;d<a.length();d++)e=L(a.get(d)),""===e&&!0!==b||c.push(e);return c}return y(a)?(e=L(a),""===
e&&!0!==b||c.push(e),c):[]};var Z=0;b.tick=function(a){Z++;return 0===Z%100?(Z=0,r.create(function(b,c){setTimeout(function(){b(a)},0)})):a};b.MomentLibrary={Moment:null}})},"dojo/number":function(){define(["./_base/lang","./i18n","./i18n!./cldr/nls/number","./string","./regexp"],function(n,b,l,k,h){var a={};n.setObject("dojo.number",a);a.format=function(e,d){d=n.mixin({},d||{});var f=b.normalizeLocale(d.locale),f=b.getLocalization("dojo.cldr","number",f);d.customs=f;f=d.pattern||f[(d.type||"decimal")+
"Format"];return isNaN(e)||Infinity==Math.abs(e)?null:a._applyPattern(e,f,d)};a._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;a._applyPattern=function(b,d,f){f=f||{};var c=f.customs.group,e=f.customs.decimal;d=d.split(";");var g=d[0];d=d[0>b?1:0]||"-"+g;if(-1!=d.indexOf("%"))b*=100;else if(-1!=d.indexOf("\u2030"))b*=1E3;else if(-1!=d.indexOf("\u00a4"))c=f.customs.currencyGroup||c,e=f.customs.currencyDecimal||e,d=d.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/,function(a,b,c,d){return(a=f[["symbol","currency",
"displayName"][c.length-1]]||f.currency||"")?b+a+d:""});else if(-1!=d.indexOf("E"))throw Error("exponential notation not supported");var h=a._numberPatternRE,g=g.match(h);if(!g)throw Error("unable to find a number expression in pattern: "+d);!1===f.fractional&&(f.places=0);return d.replace(h,a._formatAbsolute(b,g[0],{decimal:e,group:c,places:f.places,round:f.round}))};a.round=function(a,b,f){f=10/(f||10);return(f*+a).toFixed(b)/f};if(0==(.9).toFixed()){var g=a.round;a.round=function(a,b,f){var c=
Math.pow(10,-b||0),d=Math.abs(a);if(!a||d>=c)c=0;else if(d/=c,.5>d||.95<=d)c=0;return g(a,b,f)+(0<a?c:-c)}}a._formatAbsolute=function(b,d,f){f=f||{};!0===f.places&&(f.places=0);Infinity===f.places&&(f.places=6);d=d.split(".");var c="string"==typeof f.places&&f.places.indexOf(","),e=f.places;c?e=f.places.substring(c+1):0<=e||(e=(d[1]||[]).length);0>f.round||(b=a.round(b,e,f.round));b=String(Math.abs(b)).split(".");var g=b[1]||"";d[1]||f.places?(c&&(f.places=f.places.substring(0,c)),c=void 0!==f.places?
f.places:d[1]&&d[1].lastIndexOf("0")+1,c>g.length&&(b[1]=k.pad(g,c,"0",!0)),e<g.length&&(b[1]=g.substr(0,e))):b[1]&&b.pop();e=d[0].replace(",","");c=e.indexOf("0");-1!=c&&(c=e.length-c,c>b[0].length&&(b[0]=k.pad(b[0],c)),-1==e.indexOf("#")&&(b[0]=b[0].substr(b[0].length-c)));var e=d[0].lastIndexOf(","),h,t;-1!=e&&(h=d[0].length-e-1,d=d[0].substr(0,e),e=d.lastIndexOf(","),-1!=e&&(t=d.length-e-1));d=[];for(e=b[0];e;)c=e.length-h,d.push(0<c?e.substr(c):e),e=0<c?e.slice(0,c):"",t&&(h=t,t=void 0);b[0]=
d.reverse().join(f.group||",");return b.join(f.decimal||".")};a.regexp=function(b){return a._parseInfo(b).regexp};a._parseInfo=function(e){e=e||{};var d=b.normalizeLocale(e.locale),d=b.getLocalization("dojo.cldr","number",d),f=e.pattern||d[(e.type||"decimal")+"Format"],c=d.group,g=d.decimal,k=1;if(-1!=f.indexOf("%"))k/=100;else if(-1!=f.indexOf("\u2030"))k/=1E3;else{var r=-1!=f.indexOf("\u00a4");r&&(c=d.currencyGroup||c,g=d.currencyDecimal||g)}d=f.split(";");1==d.length&&d.push("-"+d[0]);d=h.buildGroupRE(d,
function(b){b="(?:"+h.escapeString(b,".")+")";return b.replace(a._numberPatternRE,function(b){var d={signed:!1,separator:e.strict?c:[c,""],fractional:e.fractional,decimal:g,exponent:!1};b=b.split(".");var f=e.places;1==b.length&&1!=k&&(b[1]="###");1==b.length||0===f?d.fractional=!1:(void 0===f&&(f=e.pattern?b[1].lastIndexOf("0")+1:Infinity),f&&void 0==e.fractional&&(d.fractional=!0),!e.places&&f<b[1].length&&(f+=","+b[1].length),d.places=f);b=b[0].split(",");1<b.length&&(d.groupSize=b.pop().length,
1<b.length&&(d.groupSize2=b.pop().length));return"("+a._realNumberRegexp(d)+")"})},!0);r&&(d=d.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/g,function(a,b,c,d){a=h.escapeString(e[["symbol","currency","displayName"][c.length-1]]||e.currency||"");if(!a)return"";b=b?"[\\s\\xa0]":"";d=d?"[\\s\\xa0]":"";return e.strict?b+a+d:(b&&(b+="*"),d&&(d+="*"),"(?:"+b+a+d+")?")}));return{regexp:d.replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:c,decimal:g,factor:k}};a.parse=function(b,d){d=a._parseInfo(d);b=(new RegExp("^"+
d.regexp+"$")).exec(b);if(!b)return NaN;var e=b[1];if(!b[1]){if(!b[2])return NaN;e=b[2];d.factor*=-1}e=e.replace(new RegExp("["+d.group+"\\s\\xa0]","g"),"").replace(d.decimal,".");return e*d.factor};a._realNumberRegexp=function(b){b=b||{};"places"in b||(b.places=Infinity);"string"!=typeof b.decimal&&(b.decimal=".");"fractional"in b&&!/^0/.test(b.places)||(b.fractional=[!0,!1]);"exponent"in b||(b.exponent=[!0,!1]);"eSigned"in b||(b.eSigned=[!0,!1]);var d=a._integerRegexp(b),e=h.buildGroupRE(b.fractional,
function(a){var c="";a&&0!==b.places&&(c="\\"+b.decimal,c=Infinity==b.places?"(?:"+c+"\\d+)?":c+("\\d{"+b.places+"}"));return c},!0),c=h.buildGroupRE(b.exponent,function(c){return c?"([eE]"+a._integerRegexp({signed:b.eSigned})+")":""}),d=d+e;e&&(d="(?:(?:"+d+")|(?:"+e+"))");return d+c};a._integerRegexp=function(a){a=a||{};"signed"in a||(a.signed=[!0,!1]);"separator"in a?"groupSize"in a||(a.groupSize=3):a.separator="";var b=h.buildGroupRE(a.signed,function(a){return a?"[-+]":""},!0),e=h.buildGroupRE(a.separator,
function(b){if(!b)return"(?:\\d+)";b=h.escapeString(b);" "==b?b="\\s":"\u00a0"==b&&(b="\\s\\xa0");var c=a.groupSize,d=a.groupSize2;return d?(b="(?:0|[1-9]\\d{0,"+(d-1)+"}(?:["+b+"]\\d{"+d+"})*["+b+"]\\d{"+c+"})",0<c-d?"(?:"+b+"|(?:0|[1-9]\\d{0,"+(c-1)+"}))":b):"(?:0|[1-9]\\d{0,"+(c-1)+"}(?:["+b+"]\\d{"+c+"})*)"},!0);return b+e};return a})},"dojo/string":function(){define(["./_base/kernel","./_base/lang"],function(n,b){var l=/[&<>'"\/]/g,k={"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;",
"'":"\x26#x27;","/":"\x26#x2F;"},h={};b.setObject("dojo.string",h);h.escape=function(a){return a?a.replace(l,function(a){return k[a]}):""};h.rep=function(a,b){if(0>=b||!a)return"";for(var e=[];;){b&1&&e.push(a);if(!(b>>=1))break;a+=a}return e.join("")};h.pad=function(a,b,e,d){e||(e="0");a=String(a);b=h.rep(e,Math.ceil((b-a.length)/e.length));return d?a+b:b+a};h.substitute=function(a,g,e,d){d=d||n.global;e=e?b.hitch(d,e):function(a){return a};return a.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,
function(a,c,h){if(""==c)return"$";a=b.getObject(c,!1,g);h&&(a=b.getObject(h,!1,d).call(d,a,c));h=e(a,c);if("undefined"===typeof h)throw Error('string.substitute could not find key "'+c+'" in template');return h.toString()})};h.trim=String.prototype.trim?b.trim:function(a){a=a.replace(/^\s+/,"");for(var b=a.length-1;0<=b;b--)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a};return h})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(n,b){var l={};b.setObject("dojo.regexp",
l);l.escapeString=function(b,h){return b.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(a){return h&&-1!=h.indexOf(a)?a:"\\"+a})};l.buildGroupRE=function(b,h,a){if(!(b instanceof Array))return h(b);for(var g=[],e=0;e<b.length;e++)g.push(h(b[e]));return l.group(g.join("|"),a)};l.group=function(b,h){return"("+(h?"?:":"")+b+")"};return l})},"esri/arcade/FunctionWrapper":function(){define(["require","exports"],function(n,b){return function(){return function(b,k){this.context=this.definition=null;this.definition=
b;this.context=k}}()})},"esri/arcade/ImmutablePathArray":function(){define(["require","exports","../core/tsSupport/extendsHelper","./ImmutableArray","./ImmutablePointArray"],function(n,b,l,k,h){return function(a){function b(b,d,f,c,g){b=a.call(this,b)||this;b._lazyPath=[];b._hasZ=!1;b._hasM=!1;b._hasZ=f;b._hasM=c;b._spRef=d;b._cacheId=g;return b}l(b,a);b.prototype.get=function(a){if(void 0===this._lazyPath[a]){var b=this._elements[a];if(void 0===b)return;this._lazyPath[a]=new h(b,this._spRef,this._hasZ,
this._hasM,this._cacheId,a)}return this._lazyPath[a]};b.prototype.equalityTest=function(a){return a===this?!0:null===a||!1===a instanceof b?!1:a.getUniqueHash()===this.getUniqueHash()};b.prototype.getUniqueHash=function(){return this._cacheId.toString()};return b}(k)})},"esri/arcade/ImmutablePointArray":function(){define(["require","exports","../core/tsSupport/extendsHelper","./ImmutableArray","../geometry/Point"],function(n,b,l,k,h){return function(a){function b(b,d,f,c,g,h){b=a.call(this,b)||this;
b._lazyPt=[];b._hasZ=!1;b._hasM=!1;b._spRef=d;b._hasZ=f;b._hasM=c;b._cacheId=g;b._partId=h;return b}l(b,a);b.prototype.get=function(a){if(void 0===this._lazyPt[a]){var b=this._elements[a];if(void 0===b)return;var e=this._hasZ,c=this._hasM,g=null,g=e&&!c?new h(b[0],b[1],b[2],void 0,this._spRef):c&&e?new h(b[0],b[1],void 0,b[2],this._spRef):e&&c?new h(b[0],b[1],b[2],b[3],this._spRef):new h(b[0],b[1],this._spRef);g.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+a.toString();
this._lazyPt[a]=g}return this._lazyPt[a]};b.prototype.equalityTest=function(a){return a===this?!0:null===a||!1===a instanceof b?!1:a.getUniqueHash()===this.getUniqueHash()};b.prototype.getUniqueHash=function(){return this._cacheId.toString()+"-"+this._partId.toString()};return b}(k)})},"esri/arcade/Attachment":function(){define(["require","exports","../core/tsSupport/extendsHelper","./Dictionary"],function(n,b,l,k){return function(b){function a(a,e,d,f,c){var g=b.call(this)||this;g.attachmentUrl=
c;g.immutable=!1;g.setField("id",a);g.setField("name",e);g.setField("contenttype",d);g.setField("size",f);g.immutable=!0;return g}l(a,b);return a}(k)})},"esri/arcade/Feature":function(){define("require exports ../core/tsSupport/assignHelper ./Dictionary ./ImmutableArray ./languageUtils ../geometry/Geometry ../geometry/Point ../geometry/support/jsonUtils ../layers/graphics/featureConversionUtils ../core/maybe".split(" "),function(n,b,l,k,h,a,g,e,d,f,c){return function(){function b(){this.declaredClass=
"esri.arcade.Feature";this._layer=this.attributes=this._geometry=this._optimizedGeomDefinition=null;this.immutable=this._datesfixed=!0;this._datefields=null;this.immutable=!0}b.createFromGraphic=function(a){var d=new b;d._geometry=c.isSome(a.geometry)?a.geometry:null;d.attributes=void 0===a.attributes?{}:null===a.attributes?{}:a.attributes;a._sourceLayer?(d._layer=a._sourceLayer,d._datesfixed=!1):a._layer?(d._layer=a._layer,d._datesfixed=!1):a.layer&&(d._layer=a.layer,d._datesfixed=!1);return d};
b.createFromArcadeFeature=function(a){var c=new b;c._datesfixed=a._datesfixed;c.attributes=a.attributes;c._geometry=a._geometry;c._optimizedGeomDefinition=a._optimizedGeomDefinition;a._layer&&(c._layer=a._layer);return c};b.createFromOptimisedFeature=function(a,c,d){var e=new b;e._geometry=a.geometry?{geometry:a.geometry}:null;e._optimizedGeomDefinition=d;e.attributes=a.attributes||{};e._layer=c;e._datesfixed=!1;return e};b.createFromArcadeDictionary=function(a){var c=new b;c.attributes=a.field("attributes");
null!==c.attributes?c.attributes instanceof k?(c.attributes=c.attributes.attributes,null===c.attributes&&(c.attributes={})):c.attributes={}:c.attributes={};c._geometry=a.field("geometry");null!==c._geometry&&(c._geometry instanceof k?c._geometry=b.parseGeometryFromDictionary(c._geometry):c._geometry instanceof g||(c._geometry=null));return c};b.createFromGraphicLikeObject=function(a,d,e){void 0===e&&(e=null);var f=new b;null===d&&(d={});f.attributes=d;f._geometry=c.isSome(a)?a:null;f._layer=e;f._layer&&
(f._datesfixed=!1);return f};b.prototype.repurposeFromGraphicLikeObject=function(a,b,c){void 0===c&&(c=null);null===b&&(b={});this.attributes=b;this._geometry=a?a:null;this._datesfixed=(this._layer=c)?!1:!0};b.prototype.castToText=function(){var b="",c;for(c in this.attributes){""!==b&&(b+=",");var d=this.attributes[c];null==d?b+=JSON.stringify(c)+":null":a.isBoolean(d)||a.isNumber(d)||a.isString(d)?b+=JSON.stringify(c)+":"+JSON.stringify(d):d instanceof g?b+=JSON.stringify(c)+":"+a.toStringExplicit(d):
d instanceof h?b+=JSON.stringify(c)+":"+a.toStringExplicit(d):d instanceof Array?b+=JSON.stringify(c)+":"+a.toStringExplicit(d):d instanceof Date?b+=JSON.stringify(c)+":"+JSON.stringify(d):null!==d&&"object"===typeof d&&void 0!==d.castToText&&(b+=JSON.stringify(c)+":"+d.castToText())}return'{"geometry":'+(null===this.geometry()?"null":a.toStringExplicit(this.geometry()))+',"attributes":{'+b+"}}"};b.prototype._fixDates=function(){if(null!==this._datefields)0<this._datefields.length&&this._fixDateFields(this._datefields);
else{for(var a=[],b=0;b<this._layer.fields.length;b++){var c=this._layer.fields[b];"date"!==c.type&&"esriFieldTypeDate"!==c.type||a.push(c.name)}this._datefields=a;0<a.length&&this._fixDateFields(a)}this._datesfixed=!0};b.prototype._fixDateFields=function(a){this.attributes=l({},this.attributes);for(var b=0;b<a.length;b++){var c=this.attributes[a[b]];if(null!==c)if(void 0===c)for(var d in this.attributes){if(d.toLowerCase()===a[b].toLowerCase()){c=this.attributes[d];null===c||c instanceof Date||(this.attributes[d]=
new Date(c));break}}else c instanceof Date||(this.attributes[a[b]]=new Date(c))}};b.prototype.geometry=function(){if(null===this._geometry||this._geometry instanceof g)return this._geometry;this._optimizedGeomDefinition?(this._geometry=c.unwrap(d.fromJSON(f.convertToGeometry(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM))),this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=
c.unwrap(d.fromJSON(this._geometry));return this._geometry};b.prototype.field=function(a){!1===this._datesfixed&&this._fixDates();var b=this.attributes[a];if(void 0!==b)return b;a=a.toLowerCase();for(var c in this.attributes)if(c.toLowerCase()===a)return this.attributes[c];if(this._hasFieldDefinition(a))return null;throw Error("Field not Found");};b.prototype._hasFieldDefinition=function(a){if(null===this._layer)return!1;for(var b=0;b<this._layer.fields.length;b++)if(this._layer.fields[b].name.toLowerCase()===
a)return!0;return!1};b.prototype._field=function(a){!1===this._datesfixed&&this._fixDates();var b=a.toLowerCase();a=this.attributes[a];if(void 0!==a)return a;for(var c in this.attributes)if(c.toLowerCase()===b)return this.attributes[c];return null};b.prototype.setField=function(b,c){if(this.immutable)throw Error("Feature is Immutable");if(!1===a.isSimpleType(c))throw Error("Illegal Value Assignment to Feature");var d=b.toLowerCase();if(void 0===this.attributes[b])for(var e in this.attributes)if(e.toLowerCase()===
d){this.attributes[e]=c;return}this.attributes[b]=c};b.prototype.hasField=function(a){var b=a.toLowerCase();if(void 0!==this.attributes[a])return!0;for(var c in this.attributes)if(c.toLowerCase()===b)return!0;return this._hasFieldDefinition(b)?!0:!1};b.prototype.keys=function(){var a=[],b={},c;for(c in this.attributes)a.push(c),b[c.toLowerCase()]=1;if(null!==this._layer)for(c=0;c<this._layer.fields.length;c++){var d=this._layer.fields[c];1!==b[d.name.toLowerCase()]&&a.push(d.name)}return a=a.sort()};
b.parseGeometryFromDictionary=function(a){a=b.convertDictionaryToJson(a,!0);void 0!==a.spatialreference&&(a.spatialReference=a.spatialreference,delete a.spatialreference);void 0!==a.rings&&(a.rings=this.fixPathArrays(a.rings,!0===a.hasZ,!0===a.hasM));void 0!==a.paths&&(a.paths=this.fixPathArrays(a.paths,!0===a.hasZ,!0===a.hasM));void 0!==a.points&&(a.points=this.fixPointArrays(a.points,!0===a.hasZ,!0===a.hasM));return d.fromJSON(a)};b.fixPathArrays=function(a,b,c){var d=[];if(a instanceof Array)for(var e=
0;e<a.length;e++)d.push(this.fixPointArrays(a[e],b,c));else if(a instanceof h)for(e=0;e<a.length();e++)d.push(this.fixPointArrays(a.get(e),b,c));return d};b.fixPointArrays=function(a,b,c){var d=[];if(a instanceof Array)for(var f=0;f<a.length;f++){var g=a[f];g instanceof e?b&&c?d.push([g.x,g.y,g.z,g.m]):b?d.push([g.x,g.y,g.z]):c?d.push([g.x,g.y,g.m]):d.push([g.x,g.y]):g instanceof h?d.push(g.toArray()):d.push(g)}else if(a instanceof h)for(f=0;f<a.length();f++)g=a.get(f),g instanceof e?b&&c?d.push([g.x,
g.y,g.z,g.m]):b?d.push([g.x,g.y,g.z]):c?d.push([g.x,g.y,g.m]):d.push([g.x,g.y]):g instanceof h?d.push(g.toArray()):d.push(g);return d};b.convertDictionaryToJson=function(a,c){void 0===c&&(c=!1);var d={},e;for(e in a.attributes){var f=a.attributes[e];f instanceof k&&(f=b.convertDictionaryToJson(f));c?d[e.toLowerCase()]=f:d[e]=f}return d};b.parseAttributesFromDictionary=function(b){var c={},d;for(d in b.attributes){var e=b.attributes[d];if(a.isSimpleType(e))c[d]=e;else throw Error("Illegal Argument");
}return c};b.fromJson=function(c){var e=null;null!==c.geometry&&void 0!==c.geometry&&(e=d.fromJSON(c.geometry));var f={};if(null!==c.attributes&&void 0!==c.attributes)for(var g in c.attributes){var h=c.attributes[g];if(null===h)f[g]=h;else if(a.isString(h)||a.isNumber(h)||a.isBoolean(h)||a.isDate(h))f[g]=h;else throw Error("Illegal Argument");}return b.createFromGraphicLikeObject(e,f,null)};b.prototype.domainValueLookup=function(b,c,d){if(null===this._layer||!this._layer.fields)return null;d=a.getDomain(b,
this._layer,this,d);if(void 0===c)try{c=this.field(b)}catch(x){return null}return a.getDomainValue(d,c)};b.prototype.domainCodeLookup=function(b,c,d){if(null===this._layer||!this._layer.fields)return null;if(void 0===c){try{c=this.field(b)}catch(x){return null}return c}b=a.getDomain(b,this._layer,this,d);return a.getDomainCode(b,c)};return b}()})},"esri/layers/graphics/featureConversionUtils":function(){define("require exports ../../core/Error ../../core/Logger ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),
function(n,b,l,k,h,a,g,e){function d(a,b){return a?b?4:3:b?3:2}function f(a,b){return Math.round((b-a.translate[0])/a.scale[0])}function c(a,b){return Math.round((a.translate[1]-b)/a.scale[1])}function q(a,b){return b*a.scale[0]+a.translate[0]}function p(a,b){return a.translate[1]-b*a.scale[1]}function r(a){a=a.coords;return{x:a[0],y:a[1]}}function t(a,b){a.coords[0]=b.x;a.coords[1]=b.y;return a}function x(a){a=a.coords;return{x:a[0],y:a[1],z:a[2]}}function w(a,b){a.coords[0]=b.x;a.coords[1]=b.y;
a.coords[2]=b.z;return a}function u(a){a=a.coords;return{x:a[0],y:a[1],m:a[2]}}function y(a,b){a.coords[0]=b.x;a.coords[1]=b.y;a.coords[2]=b.m;return a}function m(a){a=a.coords;return{x:a[0],y:a[1],z:a[2],m:a[3]}}function v(a,b){a.coords[0]=b.x;a.coords[1]=b.y;a.coords[2]=b.z;a.coords[3]=b.m;return a}function z(a,b){return a&&b?v:a?w:b?y:t}function B(a,b,c){if(!a)return null;for(var e=d(b,c),f=[],g=0;g<a.coords.length;g+=e){for(var h=[],m=0;m<e;m++)h.push(a.coords[g+m]);f.push(h)}return b?c?{points:f,
hasZ:b,hasM:c}:{points:f,hasZ:b}:c?{points:f,hasM:c}:{points:f}}function C(a,b,c){void 0===c&&(c=d(b.hasZ,b.hasM));a.lengths[0]=b.points.length;var e=a.coords,f=0,g=0;for(b=b.points;g<b.length;g++)for(var h=b[g],m=0;m<c;m++)e[f++]=h[m];return a}function D(a,b,c){if(!a)return null;var e=d(b,c),f=a.coords,g=[],h=0,m=0;for(a=a.lengths;m<a.length;m++){for(var k=a[m],p=[],v=0;v<k;v++){for(var q=[],r=0;r<e;r++)q.push(f[h++]);p.push(q)}g.push(p)}return b?c?{paths:g,hasZ:b,hasM:c}:{paths:g,hasZ:b}:c?{paths:g,
hasM:c}:{paths:g}}function K(a,b,c){void 0===c&&(c=d(b.hasZ,b.hasM));var e=a.lengths,f=a.coords,g=0,h=0;for(b=b.paths;h<b.length;h++){for(var m=b[h],k=0,p=m;k<p.length;k++)for(var v=p[k],q=0;q<c;q++)f[g++]=v[q];e.push(m.length)}return a}function I(a,b,c){if(!a)return null;var e=d(b,c),f=a.coords,g=[],h=0,m=0;for(a=a.lengths;m<a.length;m++){for(var k=a[m],p=[],v=0;v<k;v++){for(var q=[],r=0;r<e;r++)q.push(f[h++]);p.push(q)}g.push(p)}return b?c?{rings:g,hasZ:b,hasM:c}:{rings:g,hasZ:b}:c?{rings:g,hasM:c}:
{rings:g}}function Q(a,b,c,d){void 0===c&&(c=b.hasZ);void 0===d&&(d=b.hasM);J(a,b.rings,c,d);return a}function J(a,b,c,e){c=d(c,e);e=a.lengths;for(var f=a.coords,g=0,h=e.length=f.length=0;h<b.length;h++){for(var m=b[h],k=0,p=m;k<p.length;k++)for(var v=p[k],q=0;q<c;q++)f[g++]=v[q];e.push(m.length)}return a}function N(b,c,f,g,h,m){b.length=0;if(!f){for(g=0;g<c.length;g++)h=c[g],b.push(new a.default(null,h.attributes,null,h.attributes[m]));return b}switch(f){case "esriGeometryPoint":g=z(g,h);for(h=0;h<
c.length;h++){var k=c[h];f=k.geometry;var k=k.attributes,p=void 0;f&&(p=g(new e.default,f));b.push(new a.default(p,k,null,k[m]))}break;case "esriGeometryMultipoint":g=d(g,h);for(h=0;h<c.length;h++)k=c[h],f=k.geometry,k=k.attributes,p=void 0,f&&(p=C(new e.default,f,g)),b.push(new a.default(p,k,null,k[m]));break;case "esriGeometryPolyline":g=d(g,h);for(h=0;h<c.length;h++)k=c[h],f=k.geometry,k=k.attributes,p=void 0,f&&(p=K(new e.default,f,g)),b.push(new a.default(p,k,null,k[m]));break;case "esriGeometryPolygon":for(f=
0;f<c.length;f++){var v=c[f],k=v.geometry,p=v.centroid,v=v.attributes,q=void 0;k&&(q=Q(new e.default,k,g,h));p?b.push(new a.default(q,v,t(new e.default,p),v[m])):b.push(new a.default(q,v,null,v[m]))}break;default:T.error("convertToFeatureSet:unknown-geometry",new l("Unable to parse unknown geometry type '"+f+"'")),b.length=0}return b}function L(a,b,c,d,e){a.length=0;switch(c){case "esriGeometryPoint":c=r;d&&e?c=m:d?c=x:e&&(c=u);for(d=0;d<b.length;d++){var f=b[d];e=f.geometry;f=f.attributes;e=e?c(e):
null;a.push({attributes:f,geometry:e})}break;case "esriGeometryMultipoint":for(c=0;c<b.length;c++){var g=b[c],f=g.geometry,g=g.attributes,h=void 0;f&&(h=B(f,d,e));a.push({attributes:g,geometry:h})}break;case "esriGeometryPolyline":for(c=0;c<b.length;c++)g=b[c],f=g.geometry,g=g.attributes,h=void 0,f&&(h=D(f,d,e)),a.push({attributes:g,geometry:h});break;case "esriGeometryPolygon":for(c=0;c<b.length;c++){var h=b[c],g=h.geometry,f=h.attributes,k=h.centroid,h=void 0;g&&(h=I(g,d,e));k?(g=r(k),a.push({attributes:f,
centroid:g,geometry:h})):a.push({attributes:f,geometry:h})}break;default:T.error("convertToFeatureSet:unknown-geometry",new l("Unable to parse unknown geometry type '"+c+"'"))}return a}function M(a,b,e,g,h,m){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;h=U[h];var k=b.coords;b=b.lengths;var p=d(e,g);e=e?g?P:X:g?X:Y;if(!b.length)return e(a.coords,k,0,0,f(m,k[0]),c(m,k[1])),a.lengths.length&&(a.lengths.length=0),a.coords.length=p,a;
for(var v,q,r,z=0,y,u=0,x=0;x<b.length;x++){var w=b[x];if(!(w<h)){var t=0;y=u;q=g=f(m,k[z]);r=v=c(m,k[z+1]);e(a.coords,k,y,z,q,r);t++;z+=p;y+=p;for(var l=1;l<w;l++,z+=p)if(q=f(m,k[z]),r=c(m,k[z+1]),q!==g||r!==v)e(a.coords,k,y,z,q-g,r-v),y+=p,t++,g=q,v=r;t>=h&&(a.lengths.push(t),u=y)}}a.coords.length=u;return a.coords.length?a:null}function R(a,b,c,d,e,f,g){for(var h=g-c,m=0,k=0,p,v=f+c;v<g-c;v+=c){p=b[v];var q=b[v+1],r=b[f],z=b[f+1],y=b[h],u=b[h+1];r===y?p=Math.abs(p-r):(y=(u-z)/(y-r),p=Math.abs(y*
p-q+(z-y*r))/Math.sqrt(y*y+1));p>m&&(k=v,m=p)}m>d?(R(a,b,c,d,e,f,k+c),R(a,b,c,d,e,k,g)):(e(a,b,a.length,f,b[f],b[f+1]),e(a,b,a.length,h,b[h],b[h+1]))}function S(a,b,c,e,f){var g=b.coords,h=b.lengths,m=c?e?P:X:e?X:Y;c=d(c,e);if(!g.length)return a!==b&&(a.lengths.length=0,a.coords.length=0),a;if(!h.length)return m(a.coords,g,0,0,q(f,g[0]),p(f,g[1])),a!==b&&(a.lengths.length=0,a.coords.length=c),a;var k=f.scale;e=k[0];for(var k=k[1],v=0,r=0;r<h.length;r++){var z=h[r];a.lengths[r]=z;var y=q(f,g[v]),u=
p(f,g[v+1]);m(a.coords,g,v,v,y,u);for(var v=v+c,x=1;x<z;x++,v+=c)y+=g[v]*e,u-=g[v+1]*k,m(a.coords,g,v,v,y,u)}a!==b&&(a.lengths.length=h.length,a.coords.length=g.length);return a}Object.defineProperty(b,"__esModule",{value:!0});var T=k.getLogger("esri.tasks.support.optimizedFeatureSet"),U={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},Y=function(a,b,c,d,e,f){a[c]=e;a[c+1]=f},X=function(a,b,c,d,e,f){a[c]=e;a[c+1]=f;a[c+2]=b[d+2]},P=function(a,b,c,d,e,f){a[c]=
e;a[c+1]=f;a[c+2]=b[d+2];a[c+3]=b[d+3]};b.quantizeX=f;b.quantizeY=c;b.hydrateX=q;b.hydrateY=p;b.convertToPoint=function(a,b,c){return a?b?c?m(a):x(a):c?u(a):r(a):null};b.convertFromPoint=function(a,b,c){void 0===c&&(c=z(null!=b.z,null!=b.m));return c(a,b)};b.convertToMultipoint=B;b.convertFromMultipoint=C;b.convertToPolyline=D;b.convertFromPolyline=K;b.convertToPolygon=I;b.convertFromPolygon=Q;b.convertFromNestedArray=J;var V=[],Z=[];b.convertFromFeature=function(a,b,c,d,e){V[0]=a;a=N(Z,V,b,c,d,e)[0];
V.length=Z.length=0;return a};b.convertFromFeatures=N;b.convertToFeature=function(a,b,c,d){Z[0]=a;L(V,Z,b,c,d);a=V[0];V.length=Z.length=0;return a};b.convertFromGeometry=function(a,b,c){if(!a)return null;var f=new e.default;"hasZ"in a&&null==b&&(b=a.hasZ);"hasM"in a&&null==c&&(c=a.hasM);if(h.isPoint(a))return z(null!=b?b:null!=a.z,null!=c?c:null!=a.m)(f,a);if(h.isPolygon(a))return Q(f,a,b,c);if(h.isPolyline(a))return K(f,a,d(b,c));if(h.isMultipoint(a))return C(f,a,d(b,c));T.error("convertFromGeometry:unknown-geometry",
new l("Unable to parse unknown geometry type '"+a+"'"))};b.convertToGeometry=function(a,b,c,d){a=a&&("coords"in a?a:a.geometry);if(!a)return null;switch(b){case "esriGeometryPoint":return b=r,c&&d?b=m:c?b=x:d&&(b=u),b(a);case "esriGeometryMultipoint":return B(a,c,d);case "esriGeometryPolyline":return D(a,c,d);case "esriGeometryPolygon":return I(a,c,d);default:T.error("convertToGeometry:unknown-geometry",new l("Unable to parse unknown geometry type '"+b+"'"))}};b.convertToFeatures=L;b.convertToFeatureSet=
function(a){var b=a.objectIdFieldName,c=a.spatialReference,d=a.transform,e=a.fields,f=a.hasM,g=a.hasZ,h=a.geometryType,m=a.exceededTransferLimit;a={features:L([],a.features,h,g,f),fields:e,geometryType:h,objectIdFieldName:b,spatialReference:c};d&&(a.transform=d);m&&(a.exceededTransferLimit=m);f&&(a.hasM=f);g&&(a.hasZ=g);return a};b.convertFromFeatureSet=function(a,b){var c=new g.default,d=a.hasM,e=a.hasZ,f=a.features,h=a.objectIdFieldName,m=a.spatialReference,k=a.geometryType,v=a.exceededTransferLimit,
p=a.transform;c.fields=a.fields;c.geometryType=k;c.objectIdFieldName=h||b;c.spatialReference=m;if(!c.objectIdFieldName)return T.error(new l("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),c;f&&N(c.features,f,k,e,d,c.objectIdFieldName);v&&(c.exceededTransferLimit=v);d&&(c.hasM=d);e&&(c.hasZ=e);p&&(c.transform=p);return c};b.hydrateOptimizedFeatureSet=function(a){var b=a.transform,c=a.hasM,d=a.hasZ;if(!b)return a;for(var e=0,f=a.features;e<f.length;e++){var g=f[e];g.geometry&&
S(g.geometry,g.geometry,c,d,b);g.centroid&&S(g.centroid,g.centroid,c,d,b)}a.transform=null;return a};b.quantizeOptimizedFeatureSet=function(b,c){var d=c.geometryType,f=c.features,g=c.hasM,h=c.hasZ;if(!b)return c;for(var m=0;m<f.length;m++){var k=f[m],v=new a.default(new e.default,k.attributes);M(v.geometry,k.geometry,g,h,d,b);k.centroid&&(v.centroid=new e.default,M(v.centroid,k.centroid,g,h,"esriGeometryPoint",b));f[m]=v}c.transform=b;return c};b.quantizeOptimizedGeometry=M;b.quantizeOptimizedGeometryRemoveCollinear=
function(a,b,e,g,h,m){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;h=U[h];var k=b.coords;b=b.lengths;var v=d(e,g);e=e?g?P:X:g?X:Y;if(!b.length)return e(a.coords,k,0,0,f(m,k[0]),c(m,k[1])),a.lengths.length&&(a.lengths.length=0),a.coords.length=v,a;for(var p,q,r,z=0,y,u=0,x=0;x<b.length;x++){var w=b[x];if(!(w<h)){var t=0;y=u;g=p=f(m,k[z]);r=q=c(m,k[z+1]);e(a.coords,k,y,z,g,r);t++;for(var z=z+v,l=!1,B=0,C=0,n=1;n<w;n++,z+=v)if(g=f(m,
k[z]),r=c(m,k[z+1]),g!==p||r!==q)p=g-p,q=r-q,l&&(0===B&&0===p||0===C&&0===q)?(B+=p,C+=q):(l=!0,B=p,C=q,y+=v,t++),e(a.coords,k,y,z,B,C),p=g,q=r;l&&(y+=v,e(a.coords,k,y,z,B,C));t>=h&&(a.lengths.push(t),u=y)}}a.coords.length!==u&&(a.coords.length=u);return a.coords.length?a:null};b.generalizeOptimizedGeometry=function(a,b,c,e,f,g){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;f=U[f];var h=b.coords;b=b.lengths;var m=d(c,e);c=c?e?P:X:e?
X:Y;if(!b.length)return c(a.coords,h,0,0,h[0],h[1]),a.lengths.length&&(a.lengths.length=0),a.coords.length=m,a;for(var k=e=0;k<b.length;k++){var v=b[k];if(!(v<f)){var p=a.coords.length/m;R(a.coords,h,m,g,c,e,e+v*m);var q=a.coords.length/m-p;q>=f?a.lengths.push(q):a.coords.length=p*m}e+=v*m}return a.coords.length?a:null};b.getBoundsOptimizedGeometry=function(a,b,c,e){c=d(c,e);var f=e=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;if(b&&b.coords){b=b.coords;for(var m=
0;m<b.length;m+=c){var k=b[m],v=b[m+1];e=Math.min(e,k);g=Math.max(g,k);f=Math.min(f,v);h=Math.max(h,v)}}a[0]=e;a[1]=f;a[2]=g;a[3]=h;return a};b.getQuantizedBoundsOptimizedGeometry=function(a,b,c,e){c=d(c,e);e=b.coords;var f=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,m=Number.NEGATIVE_INFINITY,k=0,v=0;for(b=b.lengths;v<b.length;v++)for(var p=b[v],q=e[k],r=e[k+1],f=Math.min(q,f),g=Math.min(r,g),h=Math.max(q,h),m=Math.max(r,m),k=k+c,z=1;z<p;z++,k+=c){var y=e[k],u=
e[k+1],q=q+y,r=r+u;0>y&&(f=Math.min(f,q));0<y&&(h=Math.max(h,q));0>u?g=Math.min(g,r):0<u&&(m=Math.max(m,r))}a[0]=f;a[1]=g;a[2]=h;a[3]=m;return a};b.hydrateOptimizedGeometry=S})},"esri/arcade/treeAnalysis":function(){define(["require","exports"],function(n,b){function l(a,b,c,d){return"0"!==a.min&&c.length<Number(a.min)||"*"!==a.max&&c.length>Number(a.max)?-2:1}function k(a,b,c){if(null!==c.localScope&&void 0!==c.localScope[a.toLowerCase()]){var d=c.localScope[a.toLowerCase()];if("FormulaFunction"===
d.type||"any"===d.type)return void 0===d.signature&&(d.signature={min:"0",max:"*"}),l(d.signature,a,b,c)}return void 0!==c.globalScope[a.toLowerCase()]&&(d=c.globalScope[a.toLowerCase()],"FormulaFunction"===d.type||"any"===d.type)?(void 0===d.signature&&(d.signature={min:"0",max:"*"}),l(d.signature,a,b,c)):-1}function h(b,c){if(b)for(var d=0;d<b.length;d++)a(b[d],c)}function a(b,c){if(b&&!1!==c(b))switch(b.type){case "ArrayExpression":h(b.elements,c);break;case "AssignmentExpression":case "BinaryExpression":a(b.left,
c);a(b.right,c);break;case "BlockStatement":h(b.body,c);break;case "CallExpression":a(b.callee,c);h(b.arguments,c);break;case "ConditionalExpression":a(b.test,c);a(b.alternate,c);a(b.consequent,c);break;case "DoWhileStatement":a(b.test,c);a(b.body,c);break;case "ExpressionStatement":a(b.expression,c);break;case "ForInStatement":a(b.left,c);a(b.right,c);a(b.body,c);break;case "ForStatement":a(b.init,c);a(b.test,c);a(b.update,c);a(b.body,c);break;case "FunctionDeclaration":case "FunctionDeclaration":case "FunctionExpression":a(b.id,
c);h(b.params,c);a(b.body,c);break;case "IfStatement":a(b.test,c);a(b.consequent,c);a(b.alternate,c);break;case "LogicalExpression":a(b.left,c);a(b.right,c);break;case "MemberExpression":a(b.object,c);a(b.property,c);break;case "NewExpression":a(b.callee,c);h(b.arguments,c);break;case "ObjectExpression":h(b.properties,c);break;case "Program":h(b.body,c);break;case "Property":a(b.key,c);a(b.value,c);break;case "ReturnStatement":a(b.argument,c);break;case "UnaryExpression":a(b.argument,c);break;case "UpdateExpression":a(b.argument,
c);break;case "VariableDeclaration":h(b.declarations,c);break;case "VariableDeclarator":a(b.id,c),a(b.init,c)}}function g(a,b){void 0===b&&(b=!0);var c=p(a,"SYNTAX","UNREOGNISED");try{switch(a.type){case "VariableDeclarator":return null!==a.init&&"FunctionExpression"===a.init.type?p(a,"SYNTAX","FUNCTIONVARIABLEDECLARATOR"):"Identifier"!==a.id.type?p(a,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER"):null!==a.init?g(a.init,!1):"";case "VariableDeclaration":for(var d=0;d<a.declarations.length;d++)if(c=g(a.declarations[d],
b),""!==c)return c;return"";case "ForInStatement":c=g(a.left,b);if(""!==c)break;if("VariableDeclaration"===a.left.type){if(1<a.left.declarations.length)return p(a,"SYNTAX","ONLY1VAR");if(null!==a.left.declarations[0].init)return p(a,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==a.left.type)return p(a,"SYNTAX","LEFTNOTVAR");c=g(a.right,b);if(""!==c)break;c=g(a.body,b);if(""!==c)break;return"";case "ForStatement":if(null!==a.test&&(c=g(a.test,b),""!==c))break;if(null!==a.init&&(c=g(a.init,b),
""!==c))break;if(null!==a.update&&(c=g(a.update,b),""!==c))break;if(null!==a.body&&(c=g(a.body,b),""!==c))break;return"";case "ContinueStatement":return"";case "EmptyStatement":return"";case "BreakStatement":return"";case "IfStatement":c=g(a.test,b);if(""!==c)break;if(null!==a.consequent&&(c=g(a.consequent,!1),""!==c))break;if(null!==a.alternate&&(c=g(a.alternate,!1),""!==c))break;return"";case "BlockStatement":for(var e=[],d=0;d<a.body.length;d++)"EmptyStatement"!==a.body[d].type&&e.push(a.body[d]);
a.body=e;for(d=0;d<a.body.length;d++)if(c=g(a.body[d],b),""!==c)return c;return"";case "FunctionDeclaration":return!1===b?p(a,"SYNTAX","GLOBALFUNCTIONSONLY"):"Identifier"!==a.id.type?p(a,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER"):g(a.body,!1);case "ReturnStatement":return null!==a.argument?g(a.argument,b):"";case "UpdateExpression":return"Identifier"!==a.argument.type&&"MemberExpression"!==a.argument.type?p(a,"SYNTAX","ASSIGNMENTTOVARSONLY"):g(a.argument,b);case "AssignmentExpression":if("Identifier"!==
a.left.type&&"MemberExpression"!==a.left.type)return p(a,"SYNTAX","ASSIGNMENTTOVARSONLY");c=g(a.left,b);if(""!==c)break;switch(a.operator){case "\x3d":case "/\x3d":case "*\x3d":case "%\x3d":case "+\x3d":case "-\x3d":break;default:return p(a,"SYNTAX","OPERATORNOTRECOGNISED")}return g(a.right,!1);case "ExpressionStatement":return g(a.expression,!1);case "Identifier":c="";break;case "MemberExpression":c=g(a.object,b);if(""!==c)break;return!0===a.computed?g(a.property,b):"";case "Literal":return"";case "CallExpression":if("Identifier"!==
a.callee.type)return p(a,"SYNTAX","ONLYNODESSUPPORTED");c="";for(d=0;d<a.arguments.length;d++)if(c=g(a.arguments[d],b),""!==c)return c;return"";case "UnaryExpression":c=g(a.argument,b);break;case "BinaryExpression":c=g(a.left,b);if(""!==c)break;c=g(a.right,b);if(""!==c)break;switch(a.operator){case "\x3d\x3d":case "!\x3d":case "\x3c":case "\x3c\x3d":case "\x3e":case "\x3e\x3d":case "+":case "-":case "*":case "/":case "%":break;default:return p(a,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case "LogicalExpression":c=
g(a.left,b);if(""!==c)break;c=g(a.right);if(""!==c)break;switch(a.operator){case "\x26\x26":case "||":break;default:return p(a,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case "ConditionalExpression":return p(a,"SYNTAX","NOTSUPPORTED");case "ArrayExpression":c="";for(d=0;d<a.elements.length&&(c=g(a.elements[d],b),""===c);d++);break;case "ObjectExpression":c="";for(d=0;d<a.properties.length;d++){c="";if(null!==a.properties[d].key&&("Literal"!==a.properties[d].key.type&&"Identifier"!==a.properties[d].key.type&&
(c=p(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===a.properties[d].key.type)){var e=a.properties[d].key,f="value"in e?e.value:null;"string"===typeof f||f instanceof String||(c=p(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"))}""===c&&(c=g(a.properties[d],b));if(""!==c)break}break;case "Property":if("Literal"!==a.key.type&&"Identifier"!==a.key.type)return p(a,"SYNTAX","ONLYLITERAL");if("Identifier"!==a.key.type&&(c=g(a.key,b),""!==c))break;c=g(a.value,b)}return c}catch(I){throw I;}}function e(a,
b){var d=p(a,"SYNTAX","UNREOGNISED"),g=null,h="";try{switch(a.type){case "VariableDeclarator":if(null!==a.init&&"FunctionExpression"===a.init.type)return p(a,"SYNTAX","FUNCTIONVARIABLEDECLARATOR");var m=null===a.init?"":e(a.init,b);if(""!==m)return m;"Identifier"===a.id.type&&(null===b.localScope?b.globalScope[a.id.name.toLowerCase()]={type:"any"}:b.localScope[a.id.name.toLowerCase()]={type:"any"});return"";case "FunctionDeclaration":g=f(a.id.name.toLowerCase(),a,b);h=c(a,b);if(""!==h)return h;if(null!==
b.localScope)return p(a,"SYNTAX","GLOBALFUNCTIONSONLY");g.isnative=!1;b.globalScope[a.id.name.toLowerCase()]={type:"FormulaFunction",signature:[g]};return"";case "VariableDeclaration":for(var d="",q=0;q<a.declarations.length&&(d=e(a.declarations[q],b),""===d);q++);break;case "IfStatement":d=e(a.test,b);if(""!==d)break;if("AssignmentExpression"===a.test.type||"UpdateExpression"===a.test.type)return p(a.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION");if(null!==a.consequent&&(d=e(a.consequent,b),
""!==d))break;if(null!==a.alternate&&(d=e(a.alternate,b),""!==d))break;return"";case "EmptyStatement":return"";case "BlockStatement":for(q=0;q<a.body.length;q++)if(d=e(a.body[q],b),""!==d)return d;return"";case "ReturnStatement":return null!==a.argument?e(a.argument,b):"";case "ForInStatement":if("VariableDeclaration"===a.left.type){if(1<a.left.declarations.length)return p(a,"SYNTAX","ONLY1VAR");if(null!==a.left.declarations[0].init)return p(a,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==a.left.type)return p(a,
"SYNTAX","LEFTNOTVAR");d=e(a.left,b);if(""!==d)break;d=e(a.right,b);if(""!==d)break;d=e(a.body,b);if(""!==d)break;return"";case "ForStatement":if(null!==a.init&&(d=e(a.init,b),""!==d))break;if(null!==a.test&&(d=e(a.test,b),""!==d))break;if(null!==a.body&&(d=e(a.body,b),""!==d))break;if(null!==a.update&&(d=e(a.update,b),""!==d))break;return"";case "BreakStatement":return"";case "ContinueStatement":return"";case "UpdateExpression":if("Identifier"!==a.argument.type&&"MemberExpression"!==a.argument.type)return p(a,
"SYNTAX","ASSIGNMENTTOVARSONLY");var v=!1;if("MemberExpression"===a.argument.type)return e(a.argument,b);null!==b.localScope&&void 0!==b.localScope[a.argument.name.toLowerCase()]&&(v=!0);void 0!==b.globalScope[a.argument.name.toLowerCase()]&&(v=!0);return!1===v?"Identifier "+a.argument.name+" has not been declared.":"";case "AssignmentExpression":if("Identifier"!==a.left.type&&"MemberExpression"!==a.left.type)return p(a,"SYNTAX","ASSIGNMENTTOVARSONLY");var r=e(a.right,b);if(""!==r)return r;v=!1;if("MemberExpression"===
a.left.type)return r=e(a.left,b),""!==r?r:"";null!==b.localScope&&void 0!==b.localScope[a.left.name.toLowerCase()]&&(v=!0);void 0!==b.globalScope[a.left.name.toLowerCase()]&&(v=!0);return!1===v?"Identifier "+a.left.name+" has not been declared.":"";case "ExpressionStatement":return e(a.expression,b);case "Identifier":var y=a.name.toLowerCase();if(null!==b.localScope&&void 0!==b.localScope[y])return"";d=void 0!==b.globalScope[y]?"":p(a,"SYNTAX","VARIABLENOTFOUND");break;case "MemberExpression":d=e(a.object,
b);if(""!==d)break;return!0===a.computed?e(a.property,b):"";case "Literal":return"";case "CallExpression":if("Identifier"!==a.callee.type)return p(a,"SYNTAX","ONLYNODESSUPPORTED");d="";for(q=0;q<a.arguments.length;q++)if(d=e(a.arguments[q],b),""!==d)return d;var z=k(a.callee.name,a.arguments,b);-1===z&&(d=p(a,"SYNTAX","NOTFOUND"));-2===z&&(d=p(a,"SYNTAX","WRONGSIGNATURE"));break;case "UnaryExpression":d=e(a.argument,b);break;case "BinaryExpression":d=e(a.left,b);if(""!==d)break;d=e(a.right,b);if(""!==
d)break;return"";case "LogicalExpression":d=e(a.left,b);if(""!==d)break;if("AssignmentExpression"===a.left.type||"UpdateExpression"===a.left.type)return p(a.left,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION");d=e(a.right,b);if(""!==d)break;return"AssignmentExpression"===a.right.type||"UpdateExpression"===a.right.type?p(a.right,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):"";case "ConditionalExpression":return p(a,"SYNTAX","NOTSUPPORTED");case "ArrayExpression":d="";for(q=0;q<a.elements.length&&
(d=e(a.elements[q],b),""===d);q++);break;case "ObjectExpression":d="";for(q=0;q<a.properties.length;q++){d="";if(null!==a.properties[q].key&&("Literal"!==a.properties[q].key.type&&"Identifier"!==a.properties[q].key.type&&(d=p(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===a.properties[q].key.type)){var u=a.properties[q].key,x="value"in u?u.value:null;"string"===typeof x||x instanceof String||(d=p(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"))}""===d&&(d=e(a.properties[q],b));if(""!==d)break}break;
case "Property":if("Literal"!==a.key.type&&"Identifier"!==a.key.type)return p(a,"SYNTAX","ONLYLITERAL");if("Identifier"!==a.key.type&&(d=e(a.key,b),""!==d))break;d=e(a.value,b)}return d}catch(S){throw S;}}function d(b,c){var d=!1,e=c.toLowerCase();a(b,function(a){if(d)return!1;"Identifier"===a.type&&a.name&&a.name.toLowerCase()===e&&(d=!0);return!0});return d}function f(a,b,c){c=[];if(void 0!==b.params&&null!==b.params)for(var d=0;d<b.params.length;d++)c.push("any");return{name:a,return:"any",params:c}}
function c(a,b){b={globalScope:b.globalScope,localScope:{}};for(var c=0;c<a.params.length;c++)b.localScope[a.params[c].name.toLowerCase()]={type:"any"};return e(a.body,b)}function q(a,b,c,d){var e={};if(void 0===a||null===a)a={};if(void 0===c||null===c)c={};e.infinity={type:"any"};e.textformatting={type:"any"};e.pi={type:"any"};for(var f in b)"sync"===d&&void 0!==b[f].min?e[f]={type:"FormulaFunction",signature:{min:b[f].min,max:b[f].max}}:"sync"!==d&&void 0!==b[f].fmin&&(e[f]={type:"FormulaFunction",
signature:{min:b[f].fmin,max:b[f].fmax}});for(b=0;b<c.length;b++)f=c[b],e[f.name]={type:"FormulaFunction",signature:f};for(f in a)e[f]=a[f],e[f].type="any";return e}function p(a,b,c){var d="";switch(b){case "SYNTAX":d="Syntax Error: ";break;case "RUNTIME":d="Runtime Error: ";break;default:d="Syntax Error: "}try{switch(a.type){case "IfStatement":switch(c){case "CANNOT_USE_ASSIGNMENT_IN_CONDITION":d+=" Assignments not be made in logical tests";break;case "CANNOT_USE_NONBOOLEAN_IN_CONDITION":d+=" Non Boolean used as Condition"}break;
case "UpdateExpression":case "AssignmentExpression":switch(c){case "CANNOT_USE_ASSIGNMENT_IN_CONDITION":d+=" Assignments not be made in logical tests";break;case "ASSIGNMENTTOVARSONLY":d+=" Assignments can only be made to identifiers"}break;case "ExpressionStatement":d+=" Assignments can only be made to identifiers";break;case "FunctionDeclaration":switch(c){case "GLOBALFUNCTIONSONLY":d+=" Functions cannot be declared as variables";break;case "FUNCTIONMUSTHAVEIDENTIFIER":d+=" Function Definition must have an identifier"}break;
case "VariableDeclaration":d+=" Only 1 variable can be declared at a time";break;case "VariableDeclarator":switch(c){case "FUNCTIONVARIABLEDECLARATOR":d+=" Functions cannot be declared as variables";break;case "VARIABLEMUSTHAVEIDENTIFIER":d+=" Variable Definition must have an identifier"}break;case "Identifier":d+=" Identifier Not Found. ";d+=a.name;break;case "ObjectExpression":switch(c){case "OBJECTPROPERTYMUSTBESTRING":d+=" Property name must be a string"}break;case "ForStatement":switch(c){case "CANNOT_USE_NONBOOLEAN_IN_CONDITION":d+=
" Non Boolean used as Condition"}break;case "ForInStatement":switch(c){case "ONLY1VAR":d+=" Can only declare 1 var for use with IN";break;case "CANNOTDECLAREVAL":d+=" Can only declare value for use with IN";break;case "LEFTNOVAR":d+="Must provide a variable to iterate with.";break;case "VARIABLENOTDECLARED":d+="Variable must be declared before it is used..";break;case "CANNOTITERATETHISTYPE":d+="This type cannot be used in an IN loop"}break;case "MemberExpression":switch(c){case "PROPERTYNOTFOUND":d+=
"Cannot find member property. ";d+=!1===a.computed?"Identifier"===a.property.type?a.property.name:"":"";break;case "OUTOFBOUNDS":d+="Out of Bounds. ";d+=!1===a.computed?"Identifier"===a.property.type?a.property.name:"":"";break;case "NOTFOUND":d+="Cannot call member method on null. ";d+=!1===a.computed?"Identifier"===a.property.type?a.property.name:"":"";break;case "INVALIDTYPE":d+="Cannot call member property on object of this type. ",d+=!1===a.computed?"Identifier"===a.property.type?a.property.name:
"":""}break;case "Property":switch(c){case "ONLYLITERAL":d+="Property names must be literals or identifiers"}break;case "Literal":break;case "CallExpression":switch(c){case "WRONGSIGNATURE":d+="Function signature does not match: ";d+="Identifier"===a.callee.type?a.callee.name:"";break;case "ONLYNODESUPPORTED":d+="Functions must be declared.";d+="Identifier"===a.callee.type?a.callee.name:"";break;case "NOTAFUNCTION":d+="Not a Function: ";d+="Identifier"===a.callee.type?a.callee.name:"";break;case "NOTFOUND":d+=
"Function Not Found: "+("Identifier"===a.callee.type?a.callee.name:"")}break;case "UnaryExpression":switch(c){case "NOTSUPPORTEDUNARYOPERATOR":d+="Operator "+a.operator+" not allowed in this context. Only ! can be used with boolean, and - with a number";break;case "NOTSUPPORTEDTYPE":d+="Unary operator "+a.operator+" cannot be used with this argument."}case "BinaryExpression":switch(c){case "OPERATORNOTRECOGNISED":d+="Binary Operator not recognised "+a.operator}break;case "LogicalExpression":switch(c){case "ONLYBOOLEAN":d+=
"Operator "+a.operator+" cannot be used. Only || or \x26\x26 are allowed values";break;case "ONLYORORAND":d+="Logical Expression "+a.operator+" being applied to parameters that are not boolean."}break;case "ConditionalExpression":d+="Conditional statements not supported.";break;case "ArrayExpression":switch(c){case "FUNCTIONCONTEXTILLEGAL":d+=" Cannot Put Function inside Array."}break;default:d+="Expression contains unrecognised code structures."}}catch(D){throw D;}return d}function r(a,b,c){return{line:a.loc.start.line,
character:a.loc.start.column,reason:p(a,b,c)}}function t(a,b,c,d,e){void 0===e&&(e=!0);b={globalScope:b.globalScope,localScope:{}};for(e=0;e<a.params.length;e++)b.localScope[a.params[e].name.toLowerCase()]={type:"any"};x(a.body,b,c,d,!1)}function x(a,b,c,d,e){void 0===e&&(e=!0);if(null===a)throw Error("Unnexpexted Expression Syntax");var g=null;try{switch(a.type){case "VariableDeclarator":if(null!==a.init&&"FunctionExpression"===a.init.type){d.push(r(a,"SYNTAX","FUNCTIONVARIABLEDECLARATOR"));break}"Identifier"!==
a.id.type?d.push(r(a,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER")):(a.id.name.toLowerCase(),null===b.localScope?b.globalScope[a.id.name.toLowerCase()]={type:"any"}:b.localScope[a.id.name.toLowerCase()]={type:"any"});null!==a.init&&x(a.init,b,c,d,e);break;case "FunctionDeclaration":!1===e&&d.push(r(a,"SYNTAX","GLOBALFUNCTIONSONLY"));"Identifier"!==a.id.type&&d.push(r(a,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER"));g=f("",a,b);t(a,b,c,d,e);null!==b.localScope&&d.push(r(a,"SYNTAX","GLOBALFUNCTIONSONLY"));g.isnative=
!1;"Identifier"===a.id.type&&(b.globalScope[a.id.name.toLowerCase()]={type:"FormulaFunction",signature:[g]});break;case "VariableDeclaration":for(var h=0;h<a.declarations.length;h++)x(a.declarations[h],b,c,d,e);break;case "IfStatement":null!==a.test&&(x(a.test,b,c,d,e),"AssignmentExpression"!==a.test.type&&"UpdateExpression"!==a.test.type||d.push(r(a.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION")));null!==a.consequent&&x(a.consequent,b,c,d,e);null!==a.alternate&&x(a.alternate,b,c,d,e);break;
case "EmptyStatement":break;case "BlockStatement":if(null!==a.body)for(h=0;h<a.body.length;h++)x(a.body[h],b,c,d,e);break;case "ReturnStatement":null!==a.argument&&x(a.argument,b,c,d,e);break;case "ForInStatement":"VariableDeclaration"===a.left.type?(1<a.left.declarations.length&&d.push(r(a,"SYNTAX","ONLY1VAR")),null!==a.left.declarations[0].init&&d.push(r(a,"SYNTAX","CANNOTDECLAREVAL"))):"Identifier"!==a.left.type&&d.push(r(a,"SYNTAX","LEFTNOTVAR"));x(a.left,b,c,d,e);x(a.right,b,c,d,e);x(a.body,
b,c,d,e);break;case "ForStatement":null!==a.init&&x(a.init,b,c,d,e);null!==a.test&&x(a.test,b,c,d,e);null!==a.body&&x(a.body,b,c,d,e);null!==a.update&&x(a.update,b,c,d,e);break;case "BreakStatement":break;case "ContinueStatement":break;case "UpdateExpression":"Identifier"!==a.argument.type&&"MemberExpression"!==a.argument.type?d.push(r(a,"SYNTAX","ASSIGNMENTTOVARSONLY")):("Identifier"===a.argument.type&&(g=!1,!1===c&&(null!==b.localScope&&void 0!==b.localScope[a.argument.name.toLowerCase()]&&(g=!0),
void 0!==b.globalScope[a.argument.name.toLowerCase()]&&(g=!0),!1===g&&d.push({line:null===a?0:a.loc.start.line,character:null===a?0:a.loc.start.column,reason:"Identifier "+a.argument.name+" has not been declared."}))),"MemberExpression"===a.argument.type&&x(a.argument,b,c,d,e));break;case "AssignmentExpression":"Identifier"!==a.left.type&&"MemberExpression"!==a.left.type&&d.push(r(a,"SYNTAX","ASSIGNMENTTOVARSONLY"));switch(a.operator){case "\x3d":case "/\x3d":case "*\x3d":case "%\x3d":case "+\x3d":case "-\x3d":break;
default:d.push(r(a,"SYNTAX","OPERATORNOTRECOGNISED"))}x(a.right,b,c,d,e);g=!1;"Identifier"===a.left.type&&(null!==b.localScope&&void 0!==b.localScope[a.left.name.toLowerCase()]&&(g=!0),void 0!==b.globalScope[a.left.name.toLowerCase()]&&(g=!0),!1===c&&!1===g&&d.push({line:null===a?0:a.loc.start.line,character:null===a?0:a.loc.start.column,reason:"Identifier "+a.left.name+" has not been declared."}));"MemberExpression"===a.left.type&&x(a.left,b,c,d,e);break;case "ExpressionStatement":x(a.expression,
b,c,d,e);break;case "Identifier":var m=a.name.toLowerCase();if(null!==b.localScope&&void 0!==b.localScope[m]||void 0!==b.globalScope[m])break;!1===c&&d.push(r(a,"SYNTAX","VARIABLENOTFOUND"));break;case "MemberExpression":x(a.object,b,c,d,e);!0===a.computed&&x(a.property,b,c,d,e);break;case "Literal":break;case "CallExpression":"Identifier"!==a.callee.type&&d.push(r(a,"SYNTAX","ONLYNODESSUPPORTED"));for(h=0;h<a.arguments.length;h++)x(a.arguments[h],b,c,d,e);if("Identifier"===a.callee.type){var p=k(a.callee.name,
a.arguments,b);!1===c&&-1===p&&d.push(r(a,"SYNTAX","NOTFOUND"));-2===p&&d.push(r(a,"SYNTAX","WRONGSIGNATURE"))}break;case "UnaryExpression":x(a.argument,b,c,d,e);break;case "BinaryExpression":x(a.left,b,c,d,e);x(a.right,b,c,d,e);switch(a.operator){case "\x3d\x3d":case "!\x3d":case "\x3c":case "\x3c\x3d":case "\x3e":case "\x3e\x3d":case "+":case "-":case "*":case "/":case "%":break;default:d.push(r(a,"SYNTAX","OPERATORNOTRECOGNISED"))}break;case "LogicalExpression":switch(a.operator){case "\x26\x26":case "||":break;
default:d.push(r(a,"SYNTAX","OPERATORNOTRECOGNISED"))}x(a.left,b,c,d,e);"AssignmentExpression"!==a.left.type&&"UpdateExpression"!==a.left.type||d.push(r(a,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));x(a.right,b,c,d,e);"AssignmentExpression"!==a.right.type&&"UpdateExpression"!==a.right.type||d.push(r(a,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));break;case "ConditionalExpression":d.push(r(a,"SYNTAX","NOTSUPPORTED"));break;case "ArrayExpression":for(h=0;h<a.elements.length;h++)x(a.elements[h],
b,c,d,e);break;case "ObjectExpression":for(h=0;h<a.properties.length;h++)x(a.properties[h],b,c,d,e);break;case "Property":"Literal"!==a.key.type&&"Identifier"!==a.key.type&&d.push(r(a,"SYNTAX","ONLYLITERAL"));"Literal"===a.key.type&&x(a.key,b,c,d,e);x(a.value,b,c,d,e);break;default:d.push(r(a,"SYNTAX","UNRECOGNISED"))}}catch(N){d.push({line:null===a?0:a.loc.start.line,character:null===a?0:a.loc.start.column,reason:"Unnexpected Syntax"})}}function w(b,c){var d=[];a(b,function(a){"CallExpression"===
a.type&&"Identifier"===a.callee.type&&d.push(a.callee.name.toLowerCase());return!0});return d}Object.defineProperty(b,"__esModule",{value:!0});b.functionDecls={concatenate:{min:"0",max:"*"},split:{min:"2",max:"4"},guid:{min:"0",max:"1"},today:{min:"0",max:"0"},angle:{min:"2",max:"3"},bearing:{min:"2",max:"3"},urlencode:{min:"1",max:"1"},now:{min:"0",max:"0"},timestamp:{min:"0",max:"0"},day:{min:"1",max:"1"},month:{min:"1",max:"1"},year:{min:"1",max:"1"},hour:{min:"1",max:"1"},second:{min:"1",max:"1"},
millisecond:{min:"1",max:"1"},minute:{min:"1",max:"1"},weekday:{min:"1",max:"1"},toutc:{min:"1",max:"1"},tolocal:{min:"1",max:"1"},date:{min:"0",max:"7"},datediff:{min:"2",max:"3"},dateadd:{min:"2",max:"3"},trim:{min:"1",max:"1"},text:{min:"1",max:"2"},left:{min:"2",max:"2"},right:{min:"2",max:"2"},mid:{min:"2",max:"3"},upper:{min:"1",max:"1"},proper:{min:"1",max:"2"},lower:{min:"1",max:"1"},find:{min:"2",max:"3"},iif:{min:"3",max:"3"},decode:{min:"2",max:"*"},when:{min:"2",max:"*"},defaultvalue:{min:"2",
max:"2"},isempty:{min:"1",max:"1"},domaincode:{min:"2",max:"4"},domainname:{min:"2",max:"4"},polygon:{min:"1",max:"1"},point:{min:"1",max:"1"},polyline:{min:"1",max:"1"},extent:{min:"1",max:"1"},multipoint:{min:"1",max:"1"},ringisclockwise:{min:"1",max:"1"},geometry:{min:"1",max:"1"},count:{min:"0",max:"*"},number:{min:"1",max:"2"},acos:{min:"1",max:"1"},asin:{min:"1",max:"1"},atan:{min:"1",max:"1"},atan2:{min:"2",max:"2"},ceil:{min:"1",max:"2"},floor:{min:"1",max:"2"},round:{min:"1",max:"2"},cos:{min:"1",
max:"1"},exp:{min:"1",max:"1"},log:{min:"1",max:"1"},min:{min:"0",max:"*"},constrain:{min:"3",max:"3"},console:{min:"0",max:"*"},max:{min:"0",max:"*"},pow:{min:"2",max:"2"},random:{min:"0",max:"0"},sqrt:{min:"1",max:"1"},sin:{min:"1",max:"1"},tan:{min:"1",max:"1"},abs:{min:"1",max:"1"},isnan:{min:"1",max:"1"},stdev:{min:"0",max:"*"},average:{min:"0",max:"*"},mean:{min:"0",max:"*"},sum:{min:"0",max:"*"},variance:{min:"0",max:"*"},distinct:{min:"0",max:"*"},first:{min:"1",max:"1"},top:{min:"2",max:"2"},
boolean:{min:"1",max:"1"},dictionary:{min:"0",max:"*"},typeof:{min:"1",max:"1"},reverse:{min:"1",max:"1"},replace:{min:"3",max:"4"},sort:{min:"1",max:"2"},feature:{min:"1",max:"*"},haskey:{min:"2",max:"2"},indexof:{min:"2",max:"2"},disjoint:{min:"2",max:"2"},intersects:{min:"2",max:"2"},touches:{min:"2",max:"2"},crosses:{min:"2",max:"2"},within:{min:"2",max:"2"},contains:{min:"2",max:"2"},overlaps:{min:"2",max:"2"},equals:{min:"2",max:"2"},relate:{min:"3",max:"3"},intersection:{min:"2",max:"2"},union:{min:"1",
max:"2"},difference:{min:"2",max:"2"},symmetricdifference:{min:"2",max:"2"},clip:{min:"2",max:"2"},cut:{min:"2",max:"2"},area:{min:"1",max:"2"},areageodetic:{min:"1",max:"2"},length:{min:"1",max:"2"},lengthgeodetic:{min:"1",max:"2"},distancegeodetic:{min:"2",max:"3"},distance:{min:"2",max:"3"},densify:{min:"2",max:"3"},densifygeodetic:{min:"2",max:"3"},generalize:{min:"2",max:"4"},buffer:{min:"2",max:"3"},buffergeodetic:{min:"2",max:"3"},offset:{min:"2",max:"6"},rotate:{min:"2",max:"3"},issimple:{min:"1",
max:"1"},simplify:{min:"1",max:"1"},centroid:{min:"1",max:"1"},isselfintersecting:{min:"1",max:"1"},multiparttosinglepart:{min:"1",max:"1"},setgeometry:{min:"2",max:"2"},portal:{min:"1",max:"1"}};for(var u in b.functionDecls)b.functionDecls[u].fmin=b.functionDecls[u].min,b.functionDecls[u].fmax=b.functionDecls[u].max;var y="featureset featuresetbyid featuresetbyname featuresetbyrelationshipname featuresetbyurl attachments featuresetbyportalitem".split(" "),m="disjoint intersects touches crosses within contains overlaps equals relate intersection union difference symmetricdifference clip cut area areageodetic length lengthgeodetic distance distancegeodetic densify densifygeodetic generalize buffer buffergeodetic offset rotate issimple simplify multiparttosinglepart".split(" ");
b.addFunctionDeclaration=function(a,c){var d=b.functionDecls[a.name.toLowerCase()];void 0===d?"sync"===c?b.functionDecls[a.name.toLowerCase()]={min:a.min,max:a.max}:b.functionDecls[a.name.toLowerCase()]={fmin:a.min,fmax:a.max}:"sync"===c?(d.min=a.min,d.max=a.max):(d.fmin=a.min,d.fmax=a.max)};b.checkFunctionSignature=l;b.findFunction=k;b.walk=a;b.validateLanguageNode=g;b.testValidityOfExpression=e;b.referencesMember=d;b.referencesFunction=function(b,c){var d=!1,e=c.toLowerCase();a(b,function(a){return d?
!1:"CallExpression"===a.type&&"Identifier"===a.callee.type&&a.callee.name&&a.callee.name.toLowerCase()===e?(d=!0,!1):!0});return d};b.findFieldLiterals=function(b,c){var d=[];a(b,function(a){if("MemberExpression"!==a.type||"Identifier"!==a.object.type)return!0;!1===a.computed&&a.object&&a.object.name&&a.property&&"Identifier"===a.property.type&&a.property.name?d.push(a.object.name.toLowerCase()+"."+a.property.name.toLowerCase()):a.object&&a.object.name&&a.property&&"Literal"===a.property.type&&"string"===
typeof a.property.value&&d.push(a.object.name.toLowerCase()+"."+a.property.value.toString().toLowerCase());return!1});return d};b.extractFunctionDeclaration=f;b.validateFunction=c;b.constructGlobalScope=q;b.validateScript=function(a,c,d,f){void 0===d&&(d="async");void 0===f&&(f=b.functionDecls);c={globalScope:q(c.vars,f,c.customFunctions,d),localScope:null};return e(a.body[0].body,c)};b.validateLanguage=function(a){return"BlockStatement"!==a.body[0].body.type?"Invalid formula content.":g(a.body[0].body)};
b.nodeErrorMessage=p;b.makeError=r;b.extractAllIssuesInFunction=t;b.extractAllIssues=x;b.checkScript=function(a,c,d,e,f){void 0===e&&(e="async");void 0===f&&(f=b.functionDecls);var g=[];if("BlockStatement"!==a.body[0].body.type)return[{line:0,character:0,reason:"Invalid Body"}];if(null===c||void 0===c)c={vars:{},customFunctions:[]};c={globalScope:q(c.vars,f,c.customFunctions,e),localScope:null};try{x(a.body[0].body,c,d,g)}catch(I){}return g};b.findFunctionCalls=w;b.findScriptDependencies=function(a,
b){void 0===b&&(b=[]);var c=null;if(void 0===a.usesFeatureSet){null===c&&(c=w(a,!1));a.usesFeatureSet=!1;for(var e=0;e<c.length;e++)-1<y.indexOf(c[e])&&(a.usesFeatureSet=!0,a.isAsync=!0);if(!1===a.usesFeatureSet&&b&&0<b.length)for(e=0;e<b.length;e++)if(d(a,b[e])){a.usesFeatureSet=!0;a.isAsync=!0;break}}if(void 0===a.usesGeometry)for(a.usesGeometry=!1,null===c&&(c=w(a,!1)),e=0;e<c.length;e++)-1<m.indexOf(c[e])&&(a.usesGeometry=!0)};b.scriptUsesFeatureSet=function(a){a=w(a,!1);for(var b=0;b<a.length;b++)if(-1<
y.indexOf(a[b]))return!0;return!1}})},"esri/arcade/functions/date":function(){define(["require","exports","../languageUtils"],function(n,b,l){function k(b){return null===b?b:isNaN(b.getTime())?null:b}Object.defineProperty(b,"__esModule",{value:!0});b.registerFunctions=function(b,a){b.today=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,0,0);a=new Date;a.setHours(0,0,0,0);return a})};b.now=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,0,0);return new Date})};b.timestamp=function(b,
e){return a(b,e,function(a,b,c){l.pcCheck(c,0,0);a=new Date;return a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())})};b.toutc=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,1,1);a=l.toDate(c[0]);return null===a?null:new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())})};b.tolocal=function(b,e){return a(b,e,function(a,b,
c){l.pcCheck(c,1,1);a=l.toDate(c[0]);return null===a?null:l.MomentLibrary.Moment.utc([a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()]).toDate()})};b.day=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,1,1);a=l.toDate(c[0]);return null===a?NaN:a.getDate()})};b.month=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,1,1);a=l.toDate(c[0]);return null===a?NaN:a.getMonth()})};b.year=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,
1,1);a=l.toDate(c[0]);return null===a?NaN:a.getFullYear()})};b.hour=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,1,1);a=l.toDate(c[0]);return null===a?NaN:a.getHours()})};b.second=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,1,1);a=l.toDate(c[0]);return null===a?NaN:a.getSeconds()})};b.millisecond=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,1,1);a=l.toDate(c[0]);return null===a?NaN:a.getMilliseconds()})};b.minute=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,
1,1);a=l.toDate(c[0]);return null===a?NaN:a.getMinutes()})};b.weekday=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,1,1);a=l.toDate(c[0]);return null===a?NaN:a.getDay()})};b.date=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,0,7);if(3===c.length)return k(new Date(l.toNumber(c[0]),l.toNumber(c[1]),l.toNumber(c[2]),0,0,0,0));if(4===c.length)return k(new Date(l.toNumber(c[0]),l.toNumber(c[1]),l.toNumber(c[2]),l.toNumber(c[3]),0,0,0));if(5===c.length)return k(new Date(l.toNumber(c[0]),
l.toNumber(c[1]),l.toNumber(c[2]),l.toNumber(c[3]),l.toNumber(c[4]),0,0));if(6===c.length)return k(new Date(l.toNumber(c[0]),l.toNumber(c[1]),l.toNumber(c[2]),l.toNumber(c[3]),l.toNumber(c[4]),l.toNumber(c[5]),0));if(7===c.length)return k(new Date(l.toNumber(c[0]),l.toNumber(c[1]),l.toNumber(c[2]),l.toNumber(c[3]),l.toNumber(c[4]),l.toNumber(c[5]),l.toNumber(c[6])));if(2===c.length){a=l.toString(c[1]);if(""===a)return null;a=l.standardiseDateFormat(a);c=l.MomentLibrary.Moment(l.toString(c[0]),a,!0);
return!0===c.isValid()?c.toDate():null}if(1===c.length){if(l.isString(c[0])&&""===c[0].replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))return null;a=l.toNumber(c[0]);return!1===isNaN(a)?k(new Date(a)):l.toDate(c[0])}if(0===c.length)return new Date})};b.datediff=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,2,3);a=l.toDateM(c[0]);b=l.toDateM(c[1]);if(null===a||null===b)return NaN;switch(l.toString(c[2]).toLowerCase()){case "days":case "day":case "d":return a.diff(b,"days",!0);case "months":case "month":return a.diff(b,
"months",!0);case "minutes":case "minute":case "m":return"M"===c[2]?a.diff(b,"months",!0):a.diff(b,"minutes",!0);case "seconds":case "second":case "s":return a.diff(b,"seconds",!0);case "milliseconds":case "millisecond":case "ms":return a.diff(b);case "hours":case "hour":case "h":return a.diff(b,"hours",!0);case "years":case "year":case "y":return a.diff(b,"years",!0);default:return a.diff(b)}})};b.dateadd=function(b,e){return a(b,e,function(a,b,c){l.pcCheck(c,2,3);a=l.toDateM(c[0]);if(null===a)return null;
b="milliseconds";switch(l.toString(c[2]).toLowerCase()){case "days":case "day":case "d":b="days";break;case "months":case "month":b="months";break;case "minutes":case "minute":case "m":b="M"===c[2]?"months":"minutes";break;case "seconds":case "second":case "s":b="seconds";break;case "milliseconds":case "millisecond":case "ms":b="milliseconds";break;case "hours":case "hour":case "h":b="hours";break;case "years":case "year":case "y":b="years"}a.add(l.toNumber(c[1]),b);return a.toDate()})}}})},"esri/arcade/functions/geometry":function(){define("require exports ../Dictionary ../Feature ../ImmutablePointArray ../languageUtils ../../geometry/Extent ../../geometry/Geometry ../../geometry/Multipoint ../../geometry/Point ../../geometry/Polygon ../../geometry/Polyline ./centroid ../../geometry/support/jsonUtils ../../geometry/support/coordsUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});b.registerFunctions=function(b,w){b.ringisclockwise=function(b,c){return w(b,c,function(b,c,d){a.pcCheck(d,1,1);b=[];var e=c=!1;if(null===d[0])return!1;if(a.isArray(d[0])){for(var g=0,m=d[0];g<m.length;g++){var k=m[g];if(k instanceof f)b.push(k.hasZ?k.hasM?[k.x,k.y,k.z,k.m]:[k.x,k.y,k.z]:[k.x,k.y]);else throw Error("Invalid Argument");}0<b.length&&(c=d[0][0].hasZ,e=d[0][0].hasM)}else if(d[0]instanceof h)b=d[0]._elements,
0<b.length&&(c=d[0]._hasZ,e=d[0]._hasM);else if(a.isImmutableArray(d[0])){g=0;for(m=d[0].toArray();g<m.length;g++)if(k=m[g],k instanceof f)b.push(k.hasZ?k.hasM?[k.x,k.y,k.z,k.m]:[k.x,k.y,k.z]:[k.x,k.y]);else throw Error("Invalid Argument");0<b.length&&(c=d[0].get(0).hasZ,e=d[0].get(0).hasM)}else throw Error("Invalid Argument");return 3>b.length?!1:t.isClockwise(b,e,c)})};b.polygon=function(b,d){return w(b,d,function(d,e,f){a.pcCheck(f,1,1);d=null;if(f[0]instanceof l){if(d=a.fixSpatialReference(k.parseGeometryFromDictionary(f[0]),
b.spatialReference),!1===d instanceof c)throw Error("Illegal Parameter");}else d=f[0]instanceof c?r.fromJSON(f[0].toJSON()):a.fixSpatialReference(new c(JSON.parse(f[0])),b.spatialReference);if(null!==d&&!1===d.spatialReference.equals(b.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return a.fixNullGeometry(d)})};b.polyline=function(b,c){return w(b,c,function(c,d,e){a.pcCheck(e,1,1);c=null;if(e[0]instanceof l){if(c=a.fixSpatialReference(k.parseGeometryFromDictionary(e[0]),
b.spatialReference),!1===c instanceof q)throw Error("Illegal Parameter");}else c=e[0]instanceof q?r.fromJSON(e[0].toJSON()):a.fixSpatialReference(new q(JSON.parse(e[0])),b.spatialReference);if(null!==c&&!1===c.spatialReference.equals(b.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return a.fixNullGeometry(c)})};b.point=function(b,c){return w(b,c,function(c,d,e){a.pcCheck(e,1,1);c=null;if(e[0]instanceof l){if(c=a.fixSpatialReference(k.parseGeometryFromDictionary(e[0]),
b.spatialReference),!1===c instanceof f)throw Error("Illegal Parameter");}else c=e[0]instanceof f?r.fromJSON(e[0].toJSON()):a.fixSpatialReference(new f(JSON.parse(e[0])),b.spatialReference);if(null!==c&&!1===c.spatialReference.equals(b.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return a.fixNullGeometry(c)})};b.multipoint=function(b,c){return w(b,c,function(c,e,f){a.pcCheck(f,1,1);c=null;if(f[0]instanceof l){if(c=
a.fixSpatialReference(k.parseGeometryFromDictionary(f[0]),b.spatialReference),!1===c instanceof d)throw Error("Illegal Parameter");}else c=f[0]instanceof d?r.fromJSON(f[0].toJSON()):a.fixSpatialReference(new d(JSON.parse(f[0])),b.spatialReference);if(null!==c&&!1===c.spatialReference.equals(b.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return a.fixNullGeometry(c)})};b.extent=function(b,e){return w(b,e,function(e,
h,p){p=a.autoCastFeatureToGeometry(p);a.pcCheck(p,1,1);e=null;p[0]instanceof l?e=a.fixSpatialReference(k.parseGeometryFromDictionary(p[0]),b.spatialReference):p[0]instanceof f?(e={xmin:p[0].x,ymin:p[0].y,xmax:p[0].x,ymax:p[0].y,spatialReference:p[0].spatialReference.toJSON()},p[0].hasZ?(e.zmin=p[0].z,e.zmax=p[0].z):p[0].hasM&&(e.mmin=p[0].m,e.mmax=p[0].m),e=r.fromJSON(e)):e=p[0]instanceof c?r.fromJSON(p[0].extent.toJSON()):p[0]instanceof q?r.fromJSON(p[0].extent.toJSON()):p[0]instanceof d?r.fromJSON(p[0].extent.toJSON()):
p[0]instanceof g?r.fromJSON(p[0].toJSON()):a.fixSpatialReference(new g(JSON.parse(p[0])),b.spatialReference);if(null!==e&&!1===e.spatialReference.equals(b.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return a.fixNullGeometry(e)})};b.geometry=function(b,c){return w(b,c,function(c,d,e){a.pcCheck(e,1,1);c=null;c=e[0]instanceof k?a.fixSpatialReference(e[0].geometry(),b.spatialReference):e[0]instanceof l?a.fixSpatialReference(k.parseGeometryFromDictionary(e[0]),
b.spatialReference):a.fixSpatialReference(r.fromJSON(JSON.parse(e[0])),b.spatialReference);if(null!==c&&!1===c.spatialReference.equals(b.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return a.fixNullGeometry(c)})};b.setgeometry=function(b,c){return w(b,c,function(b,c,d){a.pcCheck(d,2,2);if(d[0]instanceof k){if(!0===d[0].immutable)throw Error("Feature is Immutable");if(d[1]instanceof e||null===d[1])d[0]._geometry=d[1];
else throw Error("Illegal Argument");}else throw Error("Illegal Argument");return a.voidOperation})};b.feature=function(b,c){return w(b,c,function(c,d,f){if(0===f.length)throw Error("Missing Parameters");c=null;if(1===f.length)if(a.isString(f[0]))c=k.fromJson(JSON.parse(f[0]));else if(f[0]instanceof k)c=k.createFromArcadeFeature(f[0]);else if(f[0]instanceof e)c=k.createFromGraphicLikeObject(f[0],null,null);else if(f[0]instanceof l)c=f[0].hasField("geometry")?f[0].field("geometry"):null,d=f[0].hasField("attributes")?
f[0].field("attributes"):null,null!==c&&c instanceof l&&(c=k.parseGeometryFromDictionary(c)),null!==d&&(d=k.parseAttributesFromDictionary(d)),c=k.createFromGraphicLikeObject(c,d,null);else throw Error("Illegal Argument");else{if(2===f.length){d=c=null;if(null!==f[0])if(f[0]instanceof e)c=f[0];else if(c instanceof l)c=k.parseGeometryFromDictionary(f[0]);else throw Error("Illegal Argument");if(null!==f[1])if(f[1]instanceof l)d=k.parseAttributesFromDictionary(f[1]);else throw Error("Illegal Argument");
}else{c=null;d={};if(null!==f[0])if(f[0]instanceof e)c=f[0];else if(c instanceof l)c=k.parseGeometryFromDictionary(f[0]);else throw Error("Illegal Argument");for(var g=1;g<f.length;g+=2){var h=a.toString(f[g]),m=f[g+1];if(null===m||void 0===m||a.isString(m)||isNaN(m)||a.isDate(m)||a.isNumber(m)||a.isBoolean(m)){if(a.isFunctionParameter(m)||!1===a.isSimpleType(m))throw Error("Illegal Argument");d[h]=m===a.voidOperation?null:m}else throw Error("Illegal Argument");}}c=k.createFromGraphicLikeObject(c,
d,null)}c._geometry=a.fixSpatialReference(c.geometry(),b.spatialReference);c.immutable=!1;return c})};b.dictionary=function(b,c){return w(b,c,function(b,c,d){if(0===d.length)return d=new l,d.immutable=!1,d;if(1===d.length&&a.isString(d[0]))try{var e=JSON.parse(d[0]),f=l.convertObjectToArcadeDictionary(e);f.immutable=!1;return f}catch(D){throw Error("Missing Parameters or Illegal Json");}if(0!==d.length%2)throw Error("Missing Parameters");b={};for(c=0;c<d.length;c+=2)if(e=a.toString(d[c]),f=d[c+1],
null===f||void 0===f||a.isString(f)||isNaN(f)||a.isDate(f)||a.isNumber(f)||a.isBoolean(f)||a.isArray(f)||a.isImmutableArray(f)){if(a.isFunctionParameter(f))throw Error("Illegal Argument");b[e]=f===a.voidOperation?null:f}else throw Error("Illegal Argument");d=new l(b);d.immutable=!1;return d})};b.haskey=function(b,c){return w(b,c,function(b,c,d){a.pcCheck(d,2,2);b=a.toString(d[1]);if(d[0]instanceof k||d[0]instanceof l)return d[0].hasField(b);throw Error("Illegal Argument");})};b.indexof=function(b,
c){return w(b,c,function(b,c,d){a.pcCheck(d,2,2);b=d[1];if(a.isArray(d[0])){for(c=0;c<d[0].length;c++)if(a.equalityTest(b,d[0][c]))return c;return-1}if(a.isImmutableArray(d[0])){var e=d[0].length();for(c=0;c<e;c++)if(a.equalityTest(b,d[0].get(c)))return c;return-1}throw Error("Illegal Argument");})};b.angle=function(b,c){return w(b,c,function(b,c,d){d=a.autoCastFeatureToGeometry(d);a.pcCheck(d,2,3);if(!(d[0]instanceof f))throw Error("Illegal Argument");if(!(d[1]instanceof f))throw Error("Illegal Argument");
if(2<d.length&&!(d[2]instanceof f))throw Error("Illegal Argument");return 2===d.length?p.angle2D(d[0],d[1]):p.angleBetween2D(d[0],d[1],d[2])})};b.bearing=function(b,c){return w(b,c,function(b,c,d){d=a.autoCastFeatureToGeometry(d);a.pcCheck(d,2,3);if(!(d[0]instanceof f))throw Error("Illegal Argument");if(!(d[1]instanceof f))throw Error("Illegal Argument");if(2<d.length&&!(d[2]instanceof f))throw Error("Illegal Argument");return 2===d.length?p.bearing2D(d[0],d[1]):p.bearingBetween2D(d[0],d[1],d[2])})};
b.isselfintersecting=function(b,e){return w(b,e,function(e,f,g){g=a.autoCastFeatureToGeometry(g);a.pcCheck(g,1,1);e=g[0];if(e instanceof c)return e.isSelfIntersecting;if(e instanceof q)return e=e.paths,p.pathsSelfIntersecting(e);if(e instanceof d)for(f=e.points,g=0;g<f.length;g++)for(var h=0;h<f.length;h++)if(h!==g){for(var k=!0,m=0;m<f[g].length;m++)if(f[g][m]!==f[h][m]){k=!1;break}if(!0===k)return!0}return a.isArray(e)||a.isImmutableArray(e)?(e=a.autoCastArrayOfPointsToPolyline(e,b.spatialReference),
null!==e&&(e=e.paths),p.pathsSelfIntersecting(e)):!1})}}})},"esri/arcade/functions/centroid":function(){define(["require","exports","../../geometry/Point","../../geometry/support/intersects"],function(n,b,l,k){function h(b,d,e){var c={x:0,y:0};d&&(c.z=0);e&&(c.m=0);for(var f=0,g=b[0],h=0;h<b.length;h++){var k=b[h],p;a:if(k.length!==g.length)p=!1;else{for(p=0;p<k.length;p++)if(k[p]!==g[p]){p=!1;break a}p=!0}if(!1===p){p=a(g,k,d);var m=k,q=d,l=e,B={x:(g[0]+m[0])/2,y:(g[1]+m[1])/2};q&&(B.z=(g[2]+m[2])/
2);q&&l?B.m=(g[3]+m[3])/2:l&&(B.m=(g[2]+m[2])/2);g=B;g.x*=p;g.y*=p;c.x+=g.x;c.y+=g.y;d&&(g.z*=p,c.z+=g.z);e&&(g.m*=p,c.m+=g.m);f+=p;g=k}}0<f?(c.x/=f,c.y/=f,d&&(c.z/=f),e&&(c.m/=f)):(c.x=b[0][0],c.y=b[0][1],d&&(c.z=b[0][2]),e&&d?c.m=b[0][3]:e&&(c.m=b[0][2]));return c}function a(a,b,d){var c=b[0]-a[0];a=b[1]-a[1];return d?(b=b[2]-b[2],Math.sqrt(c*c+a*a+b*b)):Math.sqrt(c*c+a*a)}function g(a,b,d){for(void 0===d&&(d=0);a<d;)a+=b;for(d+=b;a>=d;)a-=b;return a}function e(a,b){return Math.atan2(b.y-a.y,b.x-
a.x)}function d(a,b,d){var c=a.x-b.x;a=a.y-b.y;var e=d.x-b.x;b=d.y-b.y;return Math.atan2(e*a-c*b,e*c+b*a)}Object.defineProperty(b,"__esModule",{value:!0});b.centroidPolyline=function(b){for(var c={x:0,y:0,spatialReference:b.spatialReference.toJSON()},d={x:0,y:0,spatialReference:b.spatialReference.toJSON()},e=0,f=0,g=0;g<b.paths.length;g++)if(0!==b.paths[g].length){var k;k=b.paths[g];var u=!0===b.hasZ;if(1>=k.length)k=0;else{for(var y=0,m=1;m<k.length;m++)y+=a(k[m-1],k[m],u);k=y}0===k?(u=h(b.paths[g],
!0===b.hasZ,!0===b.hasM),c.x+=u.x,c.y+=u.y,!0===b.hasZ&&(c.z+=u.z),!0===b.hasM&&(c.m+=u.m),++e):(u=h(b.paths[g],!0===b.hasZ,!0===b.hasM),d.x+=u.x*k,d.y+=u.y*k,!0===b.hasZ&&(d.z+=u.z*k),!0===b.hasM&&(d.m+=u.m*k),f+=k)}return 0<f?(d.x/=f,d.y/=f,!0===b.hasZ&&(d.z/=f),!0===b.hasM&&(d.m/=f),new l(d)):0<e?(c.x/=e,c.y/=e,!0===b.hasZ&&(d.z/=e),!0===b.hasM&&(c.m/=e),new l(c)):null};b.centroidMultiPoint=function(a){if(0===a.points.length)return null;for(var b=0,c=0,d=0,e=0,f=0;f<a.points.length;f++){var g=
a.getPoint(f);!0===g.hasZ&&(d+=g.z);!0===g.hasM&&(e+=g.m);b+=g.x;c+=g.y;e+=g.m}b={x:b/a.points.length,y:c/a.points.length,spatialReference:null};b.spatialReference=a.spatialReference.toJSON();!0===a.hasZ&&(b.z=d/a.points.length);!0===a.hasM&&(b.m=e/a.points.length);return new l(b)};b.angleRad=e;b.angle2D=function(a,b){return g(e(a,b),2*Math.PI)*(180/Math.PI)};b.bearing2D=function(a,b){return g(Math.PI/2-e(a,b),2*Math.PI)*(180/Math.PI)};b.angleBetweenRad=d;b.angleBetween2D=function(a,b,e){return g(d(a,
b,e),2*Math.PI)*(180/Math.PI)};b.bearingBetween2D=function(a,b,e){return g(-1*d(a,b,e),2*Math.PI)*(180/Math.PI)};var f=[0,0];b.pathsSelfIntersecting=function(a){for(var b=0;b<a.length;b++){for(var c=a[b],d=0;d<c.length-1;d++)for(var e=c[d],g=c[d+1],h=b+1;h<a.length;h++)for(var u=0;u<a[h].length-1;u++){var y=a[h][u],m=a[h][u+1],v=k.segmentIntersects(e,g,y,m,f);if(v&&!(f[0]===e[0]&&f[1]===e[1]||f[0]===y[0]&&f[1]===y[1]||f[0]===g[0]&&f[1]===g[1]||f[0]===m[0]&&f[1]===m[1]))return!0}u=c.length;if(!(3>
u))for(d=0;d<=u-2;d++)for(e=c[d],g=c[d+1],h=d+2;h<=u-2;h++)if(y=c[h],m=c[h+1],(v=k.segmentIntersects(e,g,y,m,f))&&!(f[0]===e[0]&&f[1]===e[1]||f[0]===y[0]&&f[1]===y[1]||f[0]===g[0]&&f[1]===g[1]||f[0]===m[0]&&f[1]===m[1]))return!0}return!1}})},"esri/arcade/functions/geomsync":function(){define("require exports ../../kernel ../kernel ../languageUtils ./centroid ../../geometry/Extent ../../geometry/Geometry ../../geometry/Multipoint ../../geometry/Point ../../geometry/Polygon ../../geometry/Polyline ../../geometry/support/jsonUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){function r(a){return 0===l.version.indexOf("4.")?c.fromExtent(a):new c({spatialReference:a.spatialReference,rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]})}Object.defineProperty(b,"__esModule",{value:!0});var t=null;b.setGeometryEngine=function(a){t=a};b.registerFunctions=function(b,w){function u(a){h.pcCheck(a,2,2);if(!(a[0]instanceof e&&a[1]instanceof e||a[0]instanceof e&&null===a[1]||a[1]instanceof e&&null===a[0]||
null===a[0]&&null===a[1]))throw Error("Illegal Argument");}b.disjoint=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!0:t.disjoint(c[0],c[1])})};b.intersects=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:t.intersects(c[0],c[1])})};b.touches=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:t.touches(c[0],
c[1])})};b.crosses=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:t.crosses(c[0],c[1])})};b.within=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:t.within(c[0],c[1])})};b.contains=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:t.contains(c[0],c[1])})};b.overlaps=function(a,b){return w(a,b,function(a,
b,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:t.overlaps(c[0],c[1])})};b.equals=function(a,b){return w(a,b,function(a,b,c){h.pcCheck(c,2,2);return c[0]===c[1]?!0:c[0]instanceof e&&c[1]instanceof e?t.equals(c[0],c[1]):h.isDate(c[0])&&h.isDate(c[1])?c[0].getTime()===c[1].getTime():!1})};b.relate=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,3,3);if(c[0]instanceof e&&c[1]instanceof e)return t.relate(c[0],c[1],h.toString(c[2]));
if(c[0]instanceof e&&null===c[1]||c[1]instanceof e&&null===c[0]||null===c[0]&&null===c[1])return!1;throw Error("Illegal Argument");})};b.intersection=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?null:t.intersect(c[0],c[1])})};b.union=function(a,b){return w(a,b,function(b,c,d){d=h.autoCastFeatureToGeometry(d);b=[];if(0===d.length)throw Error("Function called with wrong number of Parameters");if(1===d.length)if(h.isArray(d[0]))for(d=
h.autoCastFeatureToGeometry(d[0]),c=0;c<d.length;c++){if(null!==d[c]){if(!(d[c]instanceof e))throw Error("Illegal Argument");b.push(d[c])}}else if(h.isImmutableArray(d[0]))for(d=h.autoCastFeatureToGeometry(d[0].toArray()),c=0;c<d.length;c++){if(null!==d[c]){if(!(d[c]instanceof e))throw Error("Illegal Argument");b.push(d[c])}}else{if(d[0]instanceof e)return h.fixSpatialReference(k.cloneGeometry(d[0]),a.spatialReference);if(null===d[0])return null;throw Error("Illegal Argument");}else for(c=0;c<d.length;c++)if(null!==
d[c]){if(!(d[c]instanceof e))throw Error("Illegal Argument");b.push(d[c])}return 0===b.length?null:t.union(b)})};b.difference=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);u(c);return null!==c[0]&&null===c[1]?k.cloneGeometry(c[0]):null===c[0]?null:t.difference(c[0],c[1])})};b.symmetricdifference=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]&&null===c[1]?null:null===c[0]?k.cloneGeometry(c[1]):null===c[1]?k.cloneGeometry(c[0]):
t.symmetricDifference(c[0],c[1])})};b.clip=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,2,2);if(!(c[1]instanceof g)&&null!==c[1])throw Error("Illegal Argument");if(null===c[0])return null;if(!(c[0]instanceof e))throw Error("Illegal Argument");return null===c[1]?null:t.clip(c[0],c[1])})};b.cut=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,2,2);if(!(c[1]instanceof q)&&null!==c[1])throw Error("Illegal Argument");if(null===
c[0])return[];if(!(c[0]instanceof e))throw Error("Illegal Argument");return null===c[1]?[k.cloneGeometry(c[0])]:t.cut(c[0],c[1])})};b.area=function(a,b){return w(a,b,function(b,c,d){h.pcCheck(d,1,2);d=h.autoCastFeatureToGeometry(d);if(null===d[0])return 0;if(h.isArray(d[0])||h.isImmutableArray(d[0]))return b=h.autoCastArrayOfPointsToPolygon(d[0],a.spatialReference),null===b?0:t.planarArea(b,k.convertSquareUnitsToCode(h.defaultUndefined(d[1],-1)));if(!(d[0]instanceof e))throw Error("Illegal Argument");
return t.planarArea(d[0],k.convertSquareUnitsToCode(h.defaultUndefined(d[1],-1)))})};b.areageodetic=function(a,b){return w(a,b,function(b,c,d){h.pcCheck(d,1,2);d=h.autoCastFeatureToGeometry(d);if(null===d[0])return 0;if(h.isArray(d[0])||h.isImmutableArray(d[0]))return b=h.autoCastArrayOfPointsToPolygon(d[0],a.spatialReference),null===b?0:t.geodesicArea(b,k.convertSquareUnitsToCode(h.defaultUndefined(d[1],-1)));if(!(d[0]instanceof e))throw Error("Illegal Argument");return t.geodesicArea(d[0],k.convertSquareUnitsToCode(h.defaultUndefined(d[1],
-1)))})};b.length=function(a,b){return w(a,b,function(b,c,d){h.pcCheck(d,1,2);d=h.autoCastFeatureToGeometry(d);if(null===d[0])return 0;if(h.isArray(d[0])||h.isImmutableArray(d[0]))return b=h.autoCastArrayOfPointsToPolyline(d[0],a.spatialReference),null===b?0:t.planarLength(b,k.convertLinearUnitsToCode(h.defaultUndefined(d[1],-1)));if(!(d[0]instanceof e))throw Error("Illegal Argument");return t.planarLength(d[0],k.convertLinearUnitsToCode(h.defaultUndefined(d[1],-1)))})};b.lengthgeodetic=function(a,
b){return w(a,b,function(b,c,d){h.pcCheck(d,1,2);d=h.autoCastFeatureToGeometry(d);if(null===d[0])return 0;if(h.isArray(d[0])||h.isImmutableArray(d[0]))return b=h.autoCastArrayOfPointsToPolyline(d[0],a.spatialReference),null===b?0:t.geodesicLength(b,k.convertLinearUnitsToCode(h.defaultUndefined(d[1],-1)));if(!(d[0]instanceof e))throw Error("Illegal Argument");return t.geodesicLength(d[0],k.convertLinearUnitsToCode(h.defaultUndefined(d[1],-1)))})};b.distance=function(a,b){return w(a,b,function(b,c,
d){d=h.autoCastFeatureToGeometry(d);h.pcCheck(d,2,3);b=d[0];if(h.isArray(d[0])||h.isImmutableArray(d[0]))b=h.autoCastArrayOfPointsToMultiPoint(d[0],a.spatialReference);c=d[1];if(h.isArray(d[1])||h.isImmutableArray(d[1]))c=h.autoCastArrayOfPointsToMultiPoint(d[1],a.spatialReference);if(!(b instanceof e))throw Error("Illegal Argument");if(!(c instanceof e))throw Error("Illegal Argument");return t.distance(b,c,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1)))})};b.distancegeodetic=function(a,
b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,2,3);a=c[0];b=c[1];if(!(a instanceof f))throw Error("Illegal Argument");if(!(b instanceof f))throw Error("Illegal Argument");var d=new q({paths:[],spatialReference:a.spatialReference});d.addPath([a,b]);return t.geodesicLength(d,k.convertLinearUnitsToCode(h.defaultUndefined(c[2],-1)))})};b.densify=function(a,b){return w(a,b,function(a,b,d){d=h.autoCastFeatureToGeometry(d);h.pcCheck(d,2,3);if(null===d[0])return null;if(!(d[0]instanceof
e))throw Error("Illegal Argument");a=h.toNumber(d[1]);if(isNaN(a))throw Error("Illegal Argument");if(0>=a)throw Error("Illegal Argument");return d[0]instanceof c||d[0]instanceof q?t.densify(d[0],a,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1))):d[0]instanceof g?t.densify(r(d[0]),a,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1))):d[0]})};b.densifygeodetic=function(a,b){return w(a,b,function(a,b,d){d=h.autoCastFeatureToGeometry(d);h.pcCheck(d,2,3);if(null===d[0])return null;if(!(d[0]instanceof
e))throw Error("Illegal Argument");a=h.toNumber(d[1]);if(isNaN(a))throw Error("Illegal Argument");if(0>=a)throw Error("Illegal Argument");return d[0]instanceof c||d[0]instanceof q?t.geodesicDensify(d[0],a,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1))):d[0]instanceof g?t.geodesicDensify(r(d[0]),a,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1))):d[0]})};b.generalize=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,2,4);if(null===c[0])return null;
if(!(c[0]instanceof e))throw Error("Illegal Argument");a=h.toNumber(c[1]);if(isNaN(a))throw Error("Illegal Argument");return t.generalize(c[0],a,h.toBoolean(h.defaultUndefined(c[2],!0)),k.convertLinearUnitsToCode(h.defaultUndefined(c[3],-1)))})};b.buffer=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,2,3);if(null===c[0])return null;if(!(c[0]instanceof e))throw Error("Illegal Argument");a=h.toNumber(c[1]);if(isNaN(a))throw Error("Illegal Argument");return 0===
a?k.cloneGeometry(c[0]):t.buffer(c[0],a,k.convertLinearUnitsToCode(h.defaultUndefined(c[2],-1)))})};b.buffergeodetic=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,2,3);if(null===c[0])return null;if(!(c[0]instanceof e))throw Error("Illegal Argument");a=h.toNumber(c[1]);if(isNaN(a))throw Error("Illegal Argument");return 0===a?k.cloneGeometry(c[0]):t.geodesicBuffer(c[0],a,k.convertLinearUnitsToCode(h.defaultUndefined(c[2],-1)))})};b.offset=function(a,b){return w(a,
b,function(a,b,d){d=h.autoCastFeatureToGeometry(d);h.pcCheck(d,2,6);if(null===d[0])return null;if(!(d[0]instanceof c||d[0]instanceof q))throw Error("Illegal Argument");a=h.toNumber(d[1]);if(isNaN(a))throw Error("Illegal Argument");b=h.toNumber(h.defaultUndefined(d[4],10));if(isNaN(b))throw Error("Illegal Argument");var e=h.toNumber(h.defaultUndefined(d[5],0));if(isNaN(e))throw Error("Illegal Argument");return t.offset(d[0],a,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1)),h.toString(h.defaultUndefined(d[3],
"round")).toLowerCase(),b,e)})};b.rotate=function(a,b){return w(a,b,function(a,b,d){d=h.autoCastFeatureToGeometry(d);h.pcCheck(d,2,3);a=d[0];if(null===a)return null;if(!(a instanceof e))throw Error("Illegal Argument");a instanceof g&&(a=c.fromExtent(a));b=h.toNumber(d[1]);if(isNaN(b))throw Error("Illegal Argument");d=h.defaultUndefined(d[2],null);if(null===d)return t.rotate(a,b);if(d instanceof f)return t.rotate(a,b,d);throw Error("Illegal Argument");})};b.centroid=function(b,m){return w(b,m,function(m,
p,r){r=h.autoCastFeatureToGeometry(r);h.pcCheck(r,1,1);if(null===r[0])return null;m=r[0];if(h.isArray(r[0])||h.isImmutableArray(r[0]))m=h.autoCastArrayOfPointsToMultiPoint(r[0],b.spatialReference);if(null===m)return null;if(!(m instanceof e))throw Error("Illegal Argument");return m instanceof f?h.fixSpatialReference(k.cloneGeometry(r[0]),b.spatialReference):m instanceof c?m.centroid:m instanceof q?a.centroidPolyline(m):m instanceof d?a.centroidMultiPoint(m):m instanceof g?m.center:null})};b.multiparttosinglepart=
function(a,b){return w(a,b,function(b,m,r){r=h.autoCastFeatureToGeometry(r);h.pcCheck(r,1,1);m=[];if(null===r[0])return null;if(!(r[0]instanceof e))throw Error("Illegal Argument");if(r[0]instanceof f||r[0]instanceof g)return[h.fixSpatialReference(k.cloneGeometry(r[0]),a.spatialReference)];b=t.simplify(r[0]);if(b instanceof c){m=[];var v=[];for(r=0;r<b.rings.length;r++)if(b.isClockwise(b.rings[r])){var y=p.fromJSON({rings:[b.rings[r]],hasZ:!0===b.hasZ,hasM:!0===b.hasM,spatialReference:b.spatialReference.toJSON()});
m.push(y)}else v.push({ring:b.rings[r],pt:b.getPoint(r,0)});for(b=0;b<v.length;b++)for(r=0;r<m.length;r++)if(m[r].contains(v[b].pt)){m[r].addRing(v[b].ring);break}return m}if(b instanceof q){m=[];for(r=0;r<b.paths.length;r++)v=p.fromJSON({paths:[b.paths[r]],hasZ:!0===b.hasZ,hasM:!0===b.hasM,spatialReference:b.spatialReference.toJSON()}),m.push(v);return m}if(r[0]instanceof d){b=h.fixSpatialReference(k.cloneGeometry(r[0]),a.spatialReference);for(r=0;r<b.points.length;r++)m.push(b.getPoint(r));return m}return null})};
b.issimple=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,1,1);if(null===c[0])return!0;if(!(c[0]instanceof e))throw Error("Illegal Argument");return t.isSimple(c[0])})};b.simplify=function(a,b){return w(a,b,function(a,b,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,1,1);if(null===c[0])return null;if(!(c[0]instanceof e))throw Error("Illegal Argument");return t.simplify(c[0])})}}})},"esri/arcade/kernel":function(){define(["require","exports","../geometry/Extent"],
function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.convertSquareUnitsToCode=function(b){if(void 0===b)return null;if("number"===typeof b)return b;switch(b.toLowerCase()){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":case "square-meter":case "square-meters":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":case "square-miles":case "square-mile":return 109413;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "square-kilometers":case "square-kilometer":case "km":return 109414;
case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;case "yard":case "yd":case "yards":case "square-yards":case "square-yard":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "square-feet":case "square-foot":case "squarefeet":case "squarefoot":return 109405}return null};b.shapeExtent=function(b){if(null===b)return null;switch(b.type){case "polygon":case "multipoint":case "polyline":return b.extent;case "point":return new l({xmin:b.x,
ymin:b.y,xmax:b.x,ymax:b.y,spatialReference:b.spatialReference});case "extent":return b}return null};b.convertLinearUnitsToCode=function(b){if(void 0===b)return null;if("number"===typeof b||"number"===typeof b)return b;switch(b.toLowerCase()){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":case "square-meter":case "square-meters":return 9001;case "miles":case "mile":case "squaremile":case "squaremiles":case "square-miles":case "square-mile":return 9035;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "square-kilometers":case "square-kilometer":case "km":return 9036;
case "yard":case "yd":case "yards":case "square-yards":case "square-yard":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "square-feet":case "square-foot":case "squarefeet":case "squarefoot":return 9002}return null};b.sameGeomType=function(b,h){return b===h||"point"===b&&"esriGeometryPoint"===h||"polyline"===b&&"esriGeometryPolyline"===h||"polygon"===b&&"esriGeometryPolygon"===h||"extent"===b&&"esriGeometryEnvelope"===h||"multipoint"===b&&"esriGeometryMultipoint"===
h||"point"===h&&"esriGeometryPoint"===b||"polyline"===h&&"esriGeometryPolyline"===b||"polygon"===h&&"esriGeometryPolygon"===b||"extent"===h&&"esriGeometryEnvelope"===b||"multipoint"===h&&"esriGeometryMultipoint"===b?!0:!1};b.cloneGeometry=function(b){if(null===b)return null;var h=b.clone();void 0!==b.cache._geVersion&&(h.cache._geVersion=b.cache._geVersion);return h}})},"esri/arcade/functions/maths":function(){define(["require","exports","dojo/number","../languageUtils"],function(n,b,l,k){function h(a,
b,e){if("undefined"===typeof e||0===+e)return Math[a](b);b=+b;e=+e;if(isNaN(b)||"number"!==typeof e||0!==e%1)return NaN;b=b.toString().split("e");b=Math[a](+(b[0]+"e"+(b[1]?+b[1]-e:-e)));b=b.toString().split("e");return+(b[0]+"e"+(b[1]?+b[1]+e:e))}Object.defineProperty(b,"__esModule",{value:!0});b.registerFunctions=function(a,b){function e(a,b,c){a=k.toNumber(a);return isNaN(a)?a:isNaN(b)||isNaN(c)||b>c?NaN:a<b?b:a>c?c:a}a.number=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,2);a=d[0];
return k.isNumber(a)?a:null===a?0:k.isDate(a)||k.isBoolean(a)?Number(a):k.isArray(a)?NaN:""===a||void 0===a?Number(a):k.isString(a)?void 0!==d[1]?(d=k.multiReplace(d[1],"\u2030",""),d=k.multiReplace(d,"\u00a4",""),l.parse(a,{pattern:d})):Number(a.trim()):Number(a)})};a.abs=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,1);return Math.abs(k.toNumber(d[0]))})};a.acos=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,1);return Math.acos(k.toNumber(d[0]))})};a.asin=function(a,e){return b(a,
e,function(a,b,d){k.pcCheck(d,1,1);return Math.asin(k.toNumber(d[0]))})};a.atan=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,1);return Math.atan(k.toNumber(d[0]))})};a.atan2=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,2,2);return Math.atan2(k.toNumber(d[0]),k.toNumber(d[1]))})};a.ceil=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,2);return 2===d.length?(a=k.toNumber(d[1]),isNaN(a)&&(a=0),h("ceil",k.toNumber(d[0]),-1*a)):Math.ceil(k.toNumber(d[0]))})};a.round=function(a,
e){return b(a,e,function(a,b,d){k.pcCheck(d,1,2);return 2===d.length?(a=k.toNumber(d[1]),isNaN(a)&&(a=0),h("round",k.toNumber(d[0]),-1*a)):Math.round(k.toNumber(d[0]))})};a.floor=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,2);return 2===d.length?(a=k.toNumber(d[1]),isNaN(a)&&(a=0),h("floor",k.toNumber(d[0]),-1*a)):Math.floor(k.toNumber(d[0]))})};a.cos=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,1);return Math.cos(k.toNumber(d[0]))})};a.isnan=function(a,e){return b(a,e,function(a,
b,d){k.pcCheck(d,1,1);return"number"===typeof d[0]&&isNaN(d[0])})};a.exp=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,1);return Math.exp(k.toNumber(d[0]))})};a.log=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,1);return Math.log(k.toNumber(d[0]))})};a.pow=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,2,2);return Math.pow(k.toNumber(d[0]),k.toNumber(d[1]))})};a.random=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,0,0);return Math.random()})};a.sin=function(a,
e){return b(a,e,function(a,b,d){k.pcCheck(d,1,1);return Math.sin(k.toNumber(d[0]))})};a.sqrt=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,1);return Math.sqrt(k.toNumber(d[0]))})};a.tan=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,1);return Math.tan(k.toNumber(d[0]))})};a.defaultvalue=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,2,2);return null===d[0]||""===d[0]||void 0===d[0]?d[1]:d[0]})};a.isempty=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,1);return null===
d[0]||""===d[0]||void 0===d[0]?!0:!1})};a["boolean"]=function(a,e){return b(a,e,function(a,b,d){k.pcCheck(d,1,1);return k.toBoolean(d[0])})};a.constrain=function(a,f){return b(a,f,function(a,b,d){k.pcCheck(d,3,3);a=k.toNumber(d[1]);b=k.toNumber(d[2]);if(k.isArray(d[0])){var c=[],f=0;for(d=d[0];f<d.length;f++)c.push(e(d[f],a,b));return c}if(k.isImmutableArray(d[0])){c=[];for(f=0;f<d[0].length();f++)c.push(e(d[0].get(f),a,b));return c}return e(d[0],a,b)})}}})},"esri/arcade/functions/stats":function(){define(["require",
"exports","../languageUtils","./fieldStats"],function(n,b,l,k){function h(a,b,e,d){if(1===d.length){if(l.isArray(d[0]))return k.calculateStat(a,d[0],-1);if(l.isImmutableArray(d[0]))return k.calculateStat(a,d[0].toArray(),-1)}return k.calculateStat(a,d,-1)}Object.defineProperty(b,"__esModule",{value:!0});b.registerFunctions=function(a,b){a.stdev=function(a,d){return b(a,d,function(a,b,d){return h("stdev",a,b,d)})};a.variance=function(a,d){return b(a,d,function(a,b,d){return h("variance",a,b,d)})};
a.average=function(a,d){return b(a,d,function(a,b,d){return h("mean",a,b,d)})};a.mean=function(a,d){return b(a,d,function(a,b,d){return h("mean",a,b,d)})};a.sum=function(a,d){return b(a,d,function(a,b,d){return h("sum",a,b,d)})};a.min=function(a,d){return b(a,d,function(a,b,d){return h("min",a,b,d)})};a.max=function(a,d){return b(a,d,function(a,b,d){return h("max",a,b,d)})};a.distinct=function(a,d){return b(a,d,function(a,b,d){return h("distinct",a,b,d)})};a.count=function(a,d){return b(a,d,function(a,
b,d){l.pcCheck(d,1,1);if(l.isArray(d[0])||l.isString(d[0]))return d[0].length;if(l.isImmutableArray(d[0]))return d[0].length();throw Error("Invalid Parameters for Count");})}}})},"esri/arcade/functions/fieldStats":function(){define(["require","exports","../languageUtils"],function(n,b,l){function k(a){for(var b=0,e=0;e<a.length;e++)b+=a[e];return b/a.length}function h(a){for(var b=k(a),e=0,d=0;d<a.length;d++)e+=Math.pow(b-a[d],2);return e/a.length}Object.defineProperty(b,"__esModule",{value:!0});
b.decodeStatType=function(a){switch(a.toLowerCase()){case "distinct":return"distinct";case "avg":case "mean":return"avg";case "min":return"min";case "sum":return"sum";case "max":return"max";case "stdev":case "stddev":return"stddev";case "var":case "variance":return"var";case "count":return"count"}return""};b.calculateStat=function(a,b,e){void 0===e&&(e=1E3);switch(a.toLowerCase()){case "distinct":a:{a=e;e=[];for(var d={},f=[],c=0;c<b.length;c++){if(void 0!==b[c]&&null!==b[c]&&b[c]!==l.voidOperation){var g=
b[c];if(l.isNumber(g)||l.isString(g))void 0===d[g]&&(e.push(g),d[g]=1);else{for(var p=!1,r=0;r<f.length;r++)!0===l.equalityTest(f[r],g)&&(p=!0);!1===p&&(f.push(g),e.push(g))}}if(e.length>=a&&-1!==a){b=e;break a}}b=e}return b;case "avg":case "mean":return k(l.toNumberArray(b));case "min":return Math.min.apply(Math,l.toNumberArray(b));case "sum":b=l.toNumberArray(b);for(e=a=0;e<b.length;e++)a+=b[e];return a;case "max":return Math.max.apply(Math,l.toNumberArray(b));case "stdev":case "stddev":return Math.sqrt(h(l.toNumberArray(b)));
case "var":case "variance":return h(l.toNumberArray(b));case "count":return b.length}return 0}})},"esri/arcade/functions/string":function(){define("require exports ../ArcadePortal ../Dictionary ../Feature ../languageUtils".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.registerFunctions=function(b,e){b.portal=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,1,1);return new l(a.toString(e[0]))})};b.trim=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,
1,1);return a.toString(e[0]).trim()})};b.upper=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,1,1);return a.toString(e[0]).toUpperCase()})};b.proper=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,1,2);b=1;2===e.length&&"firstword"===a.toString(e[1]).toLowerCase()&&(b=2);d=/\s/;e=a.toString(e[0]);for(var c="",f=!0,g=0;g<e.length;g++){var h=e[g];d.test(h)?1===b&&(f=!0):h.toUpperCase()!==h.toLowerCase()&&(f?(h=h.toUpperCase(),f=!1):h=h.toLowerCase());c+=h}return c})};b.lower=function(b,
f){return e(b,f,function(b,d,e){a.pcCheck(e,1,1);return a.toString(e[0]).toLowerCase()})};b.guid=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,0,1);if(0<e.length)switch(a.toString(e[0]).toLowerCase()){case "digits":return a.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case "digits-hyphen":return a.generateUUID();case "digits-hyphen-parentheses":return"("+a.generateUUID()+")"}return"{"+a.generateUUID()+"}"})};b.console=function(b,f){return e(b,f,function(c,
d,e){0!==e.length&&(1===e.length?b.console(a.toString(e[0])):b.console(a.toString(e)));return a.voidOperation})};b.mid=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,2,3);b=a.toNumber(e[1]);if(isNaN(b))return"";0>b&&(b=0);if(2===e.length)return a.toString(e[0]).substr(b);d=a.toNumber(e[2]);if(isNaN(d))return"";0>d&&(d=0);return a.toString(e[0]).substr(b,d)})};b.find=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,2,3);b=0;if(2<e.length){b=a.toNumber(a.defaultUndefined(e[2],0));if(isNaN(b))return-1;
0>b&&(b=0)}return a.toString(e[1]).indexOf(a.toString(e[0]),b)})};b.left=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,2,2);b=a.toNumber(e[1]);if(isNaN(b))return"";0>b&&(b=0);return a.toString(e[0]).substr(0,b)})};b.right=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,2,2);b=a.toNumber(e[1]);if(isNaN(b))return"";0>b&&(b=0);return a.toString(e[0]).substr(-1*b,b)})};b.split=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,2,4);b=a.toNumber(a.defaultUndefined(e[2],-1));d=a.toBoolean(a.defaultUndefined(e[3],
!1));-1===b||null===b||!0===d?e=a.toString(e[0]).split(a.toString(e[1])):(isNaN(b)&&(b=-1),-1>b&&(b=-1),e=a.toString(e[0]).split(a.toString(e[1]),b));if(!1===d)return e;d=[];for(var c=0;c<e.length&&!(-1!==b&&d.length>=b);c++)""!==e[c]&&void 0!==e[c]&&d.push(e[c]);return d})};b.text=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,1,2);return a.toStringExplicit(e[0],e[1])})};b.concatenate=function(b,f){return e(b,f,function(b,d,e){b=[];if(1>e.length)return"";if(a.isArray(e[0])){d=a.defaultUndefined(e[2],
"");for(var c=0;c<e[0].length;c++)b[c]=a.toStringExplicit(e[0][c],d);return 1<e.length?b.join(e[1]):b.join("")}if(a.isImmutableArray(e[0])){d=a.defaultUndefined(e[2],"");for(c=0;c<e[0].length();c++)b[c]=a.toStringExplicit(e[0].get(c),d);return 1<e.length?b.join(e[1]):b.join("")}for(c=0;c<e.length;c++)b[c]=a.toStringExplicit(e[c]);return b.join("")})};b.reverse=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,1,1);if(a.isArray(e[0]))return b=e[0].slice(0),b.reverse(),b;if(a.isImmutableArray(e[0]))return b=
e[0].toArray().slice(0),b.reverse(),b;throw Error("Invalid Parameter");})};b.replace=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,3,4);b=a.toString(e[0]);d=a.toString(e[1]);var c=a.toString(e[2]);return(4===e.length?a.toBoolean(e[3]):1)?a.multiReplace(b,d,c):b.replace(d,c)})};b.domainname=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,2,4);if(e[0]instanceof h)return e[0].domainValueLookup(a.toString(e[1]),e[2],void 0===e[3]?void 0:a.toNumber(e[3]));throw Error("Invalid Parameter");
})};b.domaincode=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,2,4);if(e[0]instanceof h)return e[0].domainCodeLookup(a.toString(e[1]),e[2],void 0===e[3]?void 0:a.toNumber(e[3]));throw Error("Invalid Parameter");})};b.urlencode=function(b,f){return e(b,f,function(b,d,e){a.pcCheck(e,1,1);if(null===e[0])return"";if(e[0]instanceof k){b="";d=0;for(var c=e[0].keys();d<c.length;d++){var f=c[d],g=e[0].field(f);""!==b&&(b+="\x26");b=null===g?b+(encodeURIComponent(f)+"\x3d"):b+(encodeURIComponent(f)+
"\x3d"+encodeURIComponent(g))}return b}return encodeURIComponent(a.toString(e[0]))})}}})},"esri/arcade/arcadeRuntime":function(){define("require exports ./ArcadePortal ./Attachment ./Dictionary ./Feature ./FunctionWrapper ./ImmutablePathArray ./ImmutablePointArray ./languageUtils ./treeAnalysis ./functions/date ./functions/geometry ./functions/geomsync ./functions/maths ./functions/stats ./functions/string ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../geometry/SpatialReference".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C){function D(a,b){for(var c=[],d=0;d<b.arguments.length;d++)c.push(I(a,b.arguments[d]));return c}function K(a,b,c){try{return c(a,b,D(a,b))}catch(ia){throw ia;}}function I(b,d){try{switch(d.type){case "EmptyStatement":return f.voidOperation;case "VariableDeclarator":var e=null===d.init?null:I(b,d.init);e===f.voidOperation&&(e=null);if("Identifier"!==d.id.type)throw Error("Can only assign a regular variable");var k=d.id.name.toLowerCase();null!==
b.localScope?b.localScope[k]={value:e,valueset:!0,node:d.init}:b.globalScope[k]={value:e,valueset:!0,node:d.init};return f.voidOperation;case "VariableDeclaration":for(var m=0;m<d.declarations.length;m++)I(b,d.declarations[m]);return f.voidOperation;case "BlockStatement":var p;a:{for(var r=f.voidOperation,m=0;m<d.body.length;m++)if(r=I(b,d.body[m]),r instanceof f.ReturnResult||r===f.breakResult||r===f.continueResult){p=r;break a}p=r}return p;case "FunctionDeclaration":var q=d.id.name.toLowerCase();
b.globalScope[q]={valueset:!0,node:null,value:new g(d,b)};return f.voidOperation;case "ReturnStatement":var v;if(null===d.argument)v=new f.ReturnResult(f.voidOperation);else{var y=I(b,d.argument);v=new f.ReturnResult(y)}return v;case "IfStatement":var u;if("AssignmentExpression"===d.test.type||"UpdateExpression"===d.test.type)throw Error(c.nodeErrorMessage(d.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var w=I(b,d.test);if(!0===w)u=I(b,d.consequent);else if(!1===w)u=null!==d.alternate?I(b,
d.alternate):f.voidOperation;else throw Error(c.nodeErrorMessage(d,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));return u;case "ExpressionStatement":var x;if("AssignmentExpression"===d.expression.type||"UpdateExpression"===d.expression.type)x=I(b,d.expression);else{var l=I(b,d.expression);x=l===f.voidOperation?f.voidOperation:new f.ImplicitResult(l)}return x;case "AssignmentExpression":var t;var z=I(b,d.right),m=null,B="";if("MemberExpression"===d.left.type){m=I(b,d.left.object);!0===d.left.computed?
B=I(b,d.left.property):"Identifier"===d.left.property.type&&(B=d.left.property.name);if(f.isArray(m))if(f.isNumber(B)){0>B&&(B=m.length+B);if(0>B||B>m.length)throw Error("Assignment outside of array bounds");if(B===m.length&&"\x3d"!==d.operator)throw Error("Invalid Parameter");m[B]=J(z,d.operator,m[B],d)}else throw Error("Invalid Parameter");else if(m instanceof h){if(!1===f.isString(B))throw Error("Dictionary accessor must be a string");if(!0===m.hasField(B))m.setField(B,J(z,d.operator,m.field(B),
d));else{if("\x3d"!==d.operator)throw Error("Invalid Parameter");m.setField(B,J(z,d.operator,null,d))}}else if(m instanceof a){if(!1===f.isString(B))throw Error("Feature accessor must be a string");if(!0===m.hasField(B))m.setField(B,J(z,d.operator,m.field(B),d));else{if("\x3d"!==d.operator)throw Error("Invalid Parameter");m.setField(B,J(z,d.operator,null,d))}}else{if(f.isImmutableArray(m))throw Error("Array is Immutable");throw Error("Invalid Parameter");}t=f.voidOperation}else if(m=d.left.name.toLowerCase(),
null!==b.localScope&&void 0!==b.localScope[m])b.localScope[m]={value:J(z,d.operator,b.localScope[m].value,d),valueset:!0,node:d.right},t=f.voidOperation;else if(void 0!==b.globalScope[m])b.globalScope[m]={value:J(z,d.operator,b.globalScope[m].value,d),valueset:!0,node:d.right},t=f.voidOperation;else throw Error("Variable not recognised");return t;case "UpdateExpression":var n;var C,m=null,B="";if("MemberExpression"===d.argument.type){m=I(b,d.argument.object);!0===d.argument.computed?B=I(b,d.argument.property):
"Identifier"===d.argument.property.type&&(B=d.argument.property.name);if(f.isArray(m))if(f.isNumber(B)){0>B&&(B=m.length+B);if(0>B||B>=m.length)throw Error("Assignment outside of array bounds");C=f.toNumber(m[B]);m[B]="++"===d.operator?C+1:C-1}else throw Error("Invalid Parameter");else if(m instanceof h){if(!1===f.isString(B))throw Error("Dictionary accessor must be a string");if(!0===m.hasField(B))C=f.toNumber(m.field(B)),m.setField(B,"++"===d.operator?C+1:C-1);else throw Error("Invalid Parameter");
}else if(m instanceof a){if(!1===f.isString(B))throw Error("Feature accessor must be a string");if(!0===m.hasField(B))C=f.toNumber(m.field(B)),m.setField(B,"++"===d.operator?C+1:C-1);else throw Error("Invalid Parameter");}else{if(f.isImmutableArray(m))throw Error("Array is Immutable");throw Error("Invalid Parameter");}n=!1===d.prefix?C:"++"===d.operator?C+1:C-1}else{m="Identifier"===d.argument.type?d.argument.name.toLowerCase():"";if(!m)throw Error("Invalid identifier");if(null!==b.localScope&&void 0!==
b.localScope[m])C=f.toNumber(b.localScope[m].value),b.localScope[m]={value:"++"===d.operator?C+1:C-1,valueset:!0,node:d},n=!1===d.prefix?C:"++"===d.operator?C+1:C-1;else if(void 0!==b.globalScope[m])C=f.toNumber(b.globalScope[m].value),b.globalScope[m]={value:"++"===d.operator?C+1:C-1,valueset:!0,node:d},n=!1===d.prefix?C:"++"===d.operator?C+1:C-1;else throw Error("Variable not recognised");}return n;case "BreakStatement":return f.breakResult;case "ContinueStatement":return f.continueResult;case "ForStatement":null!==
d.init&&I(b,d.init);B={testResult:!0,lastAction:f.voidOperation};do b:{t=b;z=d;n=B;if(null!==z.test){n.testResult=I(t,z.test);if(!1===n.testResult)break b;if(!0!==n.testResult)throw Error(c.nodeErrorMessage(z,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));}n.lastAction=I(t,z.body);n.lastAction===f.breakResult?n.testResult=!1:n.lastAction instanceof f.ReturnResult?n.testResult=!1:null!==z.update&&I(t,z.update)}while(!0===B.testResult);m=B.lastAction instanceof f.ReturnResult?B.lastAction:f.voidOperation;
return m;case "ForInStatement":return Q(b,d);case "Identifier":return T(b,d);case "MemberExpression":return L(b,d);case "Literal":return d.value;case "CallExpression":return U(b,d);case "UnaryExpression":return M(b,d);case "BinaryExpression":return R(b,d);case "LogicalExpression":return S(b,d);case "ConditionalExpression":throw Error(c.nodeErrorMessage(d,"RUNTIME","NOTSUPPORTED"));case "ArrayExpression":try{for(m=[],B=0;B<d.elements.length;B++){var D=I(b,d.elements[B]);if(f.isFunctionParameter(D))throw Error(c.nodeErrorMessage(d,
"RUNTIME","FUNCTIONCONTEXTILLEGAL"));D===f.voidOperation?m.push(null):m.push(D)}}catch(Ga){throw Ga;}return m;case "ObjectExpression":m={};for(B=0;B<d.properties.length;B++){var N=I(b,d.properties[B]);if(f.isFunctionParameter(N.value))throw Error("Illegal Argument");if(!1===f.isString(N.key))throw Error("Illegal Argument");m[N.key.toString()]=N.value===f.voidOperation?null:N.value}var K=new h(m);K.immutable=!1;return K;case "Property":return{key:"Identifier"===d.key.type?d.key.name:I(b,d.key),value:I(b,
d.value)};default:throw Error(c.nodeErrorMessage(d,"RUNTIME","UNREOGNISED"));}}catch(Ga){throw Ga;}}function Q(b,d){var e=I(b,d.right);"VariableDeclaration"===d.left.type&&I(b,d.left);var g=null,k="";if("VariableDeclaration"===d.left.type){var m=d.left.declarations[0].id;"Identifier"===m.type&&(k=m.name)}else"Identifier"===d.left.type&&(k=d.left.name);if(!k)throw Error(c.nodeErrorMessage(d,"RUNTIME","INVALIDVARIABLE"));k=k.toLowerCase();null!==b.localScope&&void 0!==b.localScope[k]&&(g=b.localScope[k]);
null===g&&void 0!==b.globalScope[k]&&(g=b.globalScope[k]);if(null===g)throw Error(c.nodeErrorMessage(d,"RUNTIME","VARIABLENOTDECLARED"));if(f.isArray(e)||f.isString(e)){e=e.length;for(m=0;m<e;m++){g.value=m;k=I(b,d.body);if(k===f.breakResult)break;if(k instanceof f.ReturnResult)return k}return f.voidOperation}if(f.isImmutableArray(e)){for(m=0;m<e.length();m++){g.value=m;k=I(b,d.body);if(k===f.breakResult)break;if(k instanceof f.ReturnResult)return k}return f.voidOperation}if(e instanceof h||e instanceof
a)for(e=e.keys(),m=0;m<e.length;m++){g.value=e[m];k=I(b,d.body);if(k===f.breakResult)break;if(k instanceof f.ReturnResult)return k}else return f.voidOperation}function J(a,b,d,e){switch(b){case "\x3d":return a===f.voidOperation?null:a;case "/\x3d":return f.toNumber(d)/f.toNumber(a);case "*\x3d":return f.toNumber(d)*f.toNumber(a);case "-\x3d":return f.toNumber(d)-f.toNumber(a);case "+\x3d":return f.isString(d)||f.isString(a)?f.toString(d)+f.toString(a):f.toNumber(d)+f.toNumber(a);case "%\x3d":return f.toNumber(d)%
f.toNumber(a);default:throw Error(c.nodeErrorMessage(e,"RUNTIME","OPERATORNOTRECOGNISED"));}}function N(a,b,f,g){b=b.toLowerCase();switch(b){case "hasz":return a=a.hasZ,void 0===a?!1:a;case "hasm":return a=a.hasM,void 0===a?!1:a;case "spatialreference":return b=a.spatialReference._arcadeCacheId,void 0===b&&(f=!0,Object.freeze&&Object.isFrozen(a.spatialReference)&&(f=!1),f&&(ea++,b=a.spatialReference._arcadeCacheId=ea)),a=new h({wkt:a.spatialReference.wkt,wkid:a.spatialReference.wkid}),void 0!==b&&
(a._arcadeCacheId="SPREF"+b.toString()),a}switch(a.type){case "extent":switch(b){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return a=a[b],void 0!==a?a:null;case "type":return"Extent"}break;case "polygon":switch(b){case "rings":return b=a.cache._arcadeCacheId,void 0===b&&(ea++,b=ea,a.cache._arcadeCacheId=b),a=new e(a.rings,a.spatialReference,!0===a.hasZ,!0===a.hasM,b);case "type":return"Polygon"}break;case "point":switch(b){case "x":case "y":case "z":case "m":return void 0!==
a[b]?a[b]:null;case "type":return"Point"}break;case "polyline":switch(b){case "paths":return b=a.cache._arcadeCacheId,void 0===b&&(ea++,b=ea,a.cache._arcadeCacheId=b),a=new e(a.paths,a.spatialReference,!0===a.hasZ,!0===a.hasM,b);case "type":return"Polyline"}break;case "multipoint":switch(b){case "points":return b=a.cache._arcadeCacheId,void 0===b&&(ea++,b=ea,a.cache._arcadeCacheId=b),a=new d(a.points,a.spatialReference,!0===a.hasZ,!0===a.hasM,b,1);case "type":return"Multipoint"}}throw Error(c.nodeErrorMessage(g,
"RUNTIME","PROPERTYNOTFOUND"));}function L(b,d){try{var e=I(b,d.object);if(null===e)throw Error(c.nodeErrorMessage(d,"RUNTIME","NOTFOUND"));if(!1===d.computed){if("Identifier"===d.property.type){if(e instanceof h||e instanceof a)return e.field(d.property.name);if(e instanceof y)return N(e,d.property.name,b,d)}throw Error(c.nodeErrorMessage(d,"RUNTIME","INVALIDTYPE"));}var g=I(b,d.property);if(e instanceof h||e instanceof a){if(f.isString(g))return e.field(g);throw Error(c.nodeErrorMessage(d,"RUNTIME",
"INVALIDTYPE"));}if(e instanceof y){if(f.isString(g))return N(e,g,b,d);throw Error(c.nodeErrorMessage(d,"RUNTIME","INVALIDTYPE"));}if(f.isArray(e)){if(f.isNumber(g)&&isFinite(g)&&Math.floor(g)===g){0>g&&(g=e.length+g);if(g>=e.length||0>g)throw Error(c.nodeErrorMessage(d,"RUNTIME","OUTOFBOUNDS"));return e[g]}throw Error(c.nodeErrorMessage(d,"RUNTIME","INVALIDTYPE"));}if(f.isString(e)){if(f.isNumber(g)&&isFinite(g)&&Math.floor(g)===g){0>g&&(g=e.length+g);if(g>=e.length||0>g)throw Error(c.nodeErrorMessage(d,
"RUNTIME","OUTOFBOUNDS"));return e[g]}throw Error(c.nodeErrorMessage(d,"RUNTIME","INVALIDTYPE"));}if(f.isImmutableArray(e)&&f.isNumber(g)&&isFinite(g)&&Math.floor(g)===g){0>g&&(g=e.length()+g);if(g>=e.length()||0>g)throw Error(c.nodeErrorMessage(d,"RUNTIME","OUTOFBOUNDS"));return e.get(g)}throw Error(c.nodeErrorMessage(d,"RUNTIME","INVALIDTYPE"));}catch(na){throw na;}}function M(a,b){try{var d=I(a,b.argument);if(f.isBoolean(d)){if("!"===b.operator)return!d;if("-"===b.operator)return-1*f.toNumber(d);
if("+"===b.operator)return 1*f.toNumber(d);throw Error(c.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}if("-"===b.operator)return-1*f.toNumber(d);if("+"===b.operator)return 1*f.toNumber(d);throw Error(c.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}catch(ia){throw ia;}}function R(a,b){try{var d=[I(a,b.left),I(a,b.right)],e=d[0],g=d[1];switch(b.operator){case "\x3d\x3d":return f.equalityTest(e,g);case "!\x3d":return!f.equalityTest(e,g);case "\x3c":return f.greaterThanLessThan(e,
g,b.operator);case "\x3e":return f.greaterThanLessThan(e,g,b.operator);case "\x3c\x3d":return f.greaterThanLessThan(e,g,b.operator);case "\x3e\x3d":return f.greaterThanLessThan(e,g,b.operator);case "+":return f.isString(e)||f.isString(g)?f.toString(e)+f.toString(g):f.toNumber(e)+f.toNumber(g);case "-":return f.toNumber(e)-f.toNumber(g);case "*":return f.toNumber(e)*f.toNumber(g);case "/":return f.toNumber(e)/f.toNumber(g);case "%":return f.toNumber(e)%f.toNumber(g);default:throw Error(c.nodeErrorMessage(b,
"RUNTIME","OPERATORNOTRECOGNISED"));}}catch(wa){throw wa;}}function S(a,b){try{if("AssignmentExpression"===b.left.type||"UpdateExpression"===b.left.type)throw Error(c.nodeErrorMessage(b.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===b.right.type||"UpdateExpression"===b.right.type)throw Error(c.nodeErrorMessage(b.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var d=I(a,b.left);if(f.isBoolean(d))switch(b.operator){case "||":if(!0===d)return d;var e=I(a,b.right);
if(f.isBoolean(e))return e;throw Error(c.nodeErrorMessage(b,"RUNTIME","ONLYORORAND"));case "\x26\x26":if(!1===d)return d;e=I(a,b.right);if(f.isBoolean(e))return e;throw Error(c.nodeErrorMessage(b,"RUNTIME","ONLYORORAND"));default:throw Error(c.nodeErrorMessage(b,"RUNTIME","ONLYORORAND"));}throw Error(c.nodeErrorMessage(b,"RUNTIME","ONLYBOOLEAN"));}catch(na){throw na;}}function T(a,b){var d;try{var e=b.name.toLowerCase();if(null!==a.localScope&&void 0!==a.localScope[e]){d=a.localScope[e];if(!0===d.valueset)return d.value;
d.value=I(a,d.node);d.valueset=!0;return d.value}if(void 0!==a.globalScope[e]){d=a.globalScope[e];if(!0===d.valueset)return d.value;d.value=I(a,d.node);d.valueset=!0;return d.value}throw Error(c.nodeErrorMessage(b,"RUNTIME","VARIABLENOTFOUND"));}catch(na){throw na;}}function U(a,b){try{if("Identifier"!==b.callee.type)throw Error(c.nodeErrorMessage(b,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==a.localScope&&void 0!==a.localScope[b.callee.name.toLowerCase()]){var d=a.localScope[b.callee.name.toLowerCase()];
if(d.value instanceof f.NativeFunction)return d.value.fn(a,b);if(d.value instanceof g)return ca(a,b,d.value.definition);throw Error(c.nodeErrorMessage(b,"RUNTIME","NOTAFUNCTION"));}if(void 0!==a.globalScope[b.callee.name.toLowerCase()]){d=a.globalScope[b.callee.name.toLowerCase()];if(d.value instanceof f.NativeFunction)return d.value.fn(a,b);if(d.value instanceof g)return ca(a,b,d.value.definition);throw Error(c.nodeErrorMessage(b,"RUNTIME","NOTAFUNCTION"));}throw Error(c.nodeErrorMessage(b,"RUNTIME",
"NOTFOUND"));}catch(ia){throw ia;}}function Y(b){return null==b?"":f.isArray(b)||f.isImmutableArray(b)?"Array":f.isDate(b)?"Date":f.isString(b)?"String":f.isBoolean(b)?"Boolean":f.isNumber(b)?"Number":b instanceof k?"Attachment":b instanceof l?"Portal":b instanceof h?"Dictionary":b instanceof a?"Feature":b instanceof v?"Point":b instanceof z?"Polygon":b instanceof B?"Polyline":b instanceof m?"Multipoint":b instanceof u?"Extent":f.isFunctionParameter(b)?"Function":f.isFeatureSet(b)?"FeatureSet":f.isFeatureSetCollection(b)?
"FeatureSetCollection":b===f.voidOperation?"":"number"===typeof b&&isNaN(b)?"Number":"Unrecognised Type"}function X(a,b,c,d){try{var e=I(a,b.arguments[c]);if(f.equalityTest(e,d))return I(a,b.arguments[c+1]);var g=b.arguments.length-c;return 1===g?I(a,b.arguments[c]):2===g?null:3===g?I(a,b.arguments[c+2]):X(a,b,c+2,d)}catch(Ca){throw Ca;}}function P(a,b,c,d){try{if(!0===d)return I(a,b.arguments[c+1]);if(3===b.arguments.length-c)return I(a,b.arguments[c+2]);var e=I(a,b.arguments[c+2]);if(!1===f.isBoolean(e))throw Error("WHEN needs boolean test conditions");
return P(a,b,c+2,e)}catch(wa){throw wa;}}function V(a,b){var c=a.length,d=Math.floor(c/2);if(0===c)return[];if(1===c)return[a[0]];var e=V(a.slice(0,d),b);a=V(a.slice(d,c),b);for(c=[];0<e.length||0<a.length;)0<e.length&&0<a.length?(d=b(e[0],a[0]),isNaN(d)&&(d=0),0>=d?(c.push(e[0]),e=e.slice(1)):(c.push(a[0]),a=a.slice(1))):0<e.length?(c.push(e[0]),e=e.slice(1)):0<a.length&&(c.push(a[0]),a=a.slice(1));return c}function Z(a,b,c){try{var d=a.body;if(c.length!==a.params.length)throw Error("Invalid Parameter calls to function.");
for(var e=0;e<c.length;e++)b.localScope[a.params[e].name.toLowerCase()]={value:c[e],valueset:!0,node:null};var g=I(b,d);if(g instanceof f.ReturnResult)return g.value;if(g===f.breakResult)throw Error("Cannot Break from a Function");if(g===f.continueResult)throw Error("Cannot Continue from a Function");return g instanceof f.ImplicitResult?g.value:g}catch(Ca){throw Ca;}}function ca(a,b,c){return K(a,b,function(b,d,e){b={spatialReference:a.spatialReference,globalScope:a.globalScope,depthCounter:a.depthCounter+
1,console:a.console,lrucache:a.lrucache,localScope:{}};if(64<b.depthCounter)throw Error("Exceeded maximum function depth");return Z(c,b,e)})}function da(a){return function(){var b={spatialReference:a.context.spatialReference,console:a.context.console,lrucache:a.context.lrucache,localScope:{},depthCounter:a.context.depthCounter+1,globalScope:a.context.globalScope};if(64<b.depthCounter)throw Error("Exceeded maximum function depth");return Z(a.definition,b,arguments)}}function F(a){console.log(a)}Object.defineProperty(b,
"__esModule",{value:!0});var ea=0,la={};q.registerFunctions(la,K);w.registerFunctions(la,K);t.registerFunctions(la,K);p.registerFunctions(la,K);x.registerFunctions(la,K);r.registerFunctions(la,K);la["typeof"]=function(a,b){return K(a,b,function(a,b,c){f.pcCheck(c,1,1);a=Y(c[0]);if("Unrecognised Type"===a)throw Error("Unrecognised Type");return a})};la.iif=function(a,b){try{f.pcCheck(null===b.arguments?[]:b.arguments,3,3);var c=I(a,b.arguments[0]);if(!1===f.isBoolean(c))throw Error("IF Function must have a boolean test condition");
var d=I(a,b.arguments[1]),e=I(a,b.arguments[2]);return!0===c?d:e}catch(wa){throw wa;}};la.decode=function(a,b){try{if(2>b.arguments.length)throw Error("Missing Parameters");if(2===b.arguments.length)return I(a,b.arguments[1]);if(0===(b.arguments.length-1)%2)throw Error("Must have a default value result.");var c=I(a,b.arguments[0]);return X(a,b,1,c)}catch(ia){throw ia;}};la.when=function(a,b){try{if(3>b.arguments.length)throw Error("Missing Parameters");if(0===b.arguments.length%2)throw Error("Must have a default value result.");
var c=I(a,b.arguments[0]);if(!1===f.isBoolean(c))throw Error("WHEN needs boolean test conditions");return P(a,b,0,c)}catch(ia){throw ia;}};la.top=function(a,b){return K(a,b,function(a,b,c){f.pcCheck(c,2,2);if(f.isArray(c[0]))return f.toNumber(c[1])>=c[0].length?c[0].slice(0):c[0].slice(0,f.toNumber(c[1]));if(f.isImmutableArray(c[0]))return f.toNumber(c[1])>=c[0].length()?c[0].slice(0):c[0].slice(0,f.toNumber(c[1]));throw Error("Top cannot accept this parameter type");})};la.first=function(a,b){return K(a,
b,function(a,b,c){f.pcCheck(c,1,1);return f.isArray(c[0])?0===c[0].length?null:c[0][0]:f.isImmutableArray(c[0])?0===c[0].length()?null:c[0].get(0):null})};la.sort=function(a,b){return K(a,b,function(a,b,c){f.pcCheck(c,1,2);a=c[0];f.isImmutableArray(a)&&(a=a.toArray());if(!1===f.isArray(a))throw Error("Illegal Argument");if(1<c.length){if(!1===f.isFunctionParameter(c[1]))throw Error("Illegal Argument");var d=da(c[1]);return a=V(a,function(a,b){return d(a,b)})}if(0===a.length)return[];c={};for(b=0;b<
a.length;b++){var e=Y(a[b]);""!==e&&(c[e]=!0)}if(!0===c.Array||!0===c.Dictionary||!0===c.Feature||!0===c.Point||!0===c.Polygon||!0===c.Polyline||!0===c.Multipoint||!0===c.Extent||!0===c.Function)return a.slice(0);b=0;var e="",g;for(g in c)b++,e=g;return a=1<b||"String"===e?V(a,function(a,b){if(null===a||void 0===a||a===f.voidOperation)return null===b||void 0===b||b===f.voidOperation?0:1;if(null===b||void 0===b||b===f.voidOperation)return-1;a=f.toString(a);b=f.toString(b);return a<b?-1:a===b?0:1}):
"Number"===e?V(a,function(a,b){return a-b}):"Boolean"===e?V(a,function(a,b){return a===b?0:b?-1:1}):"Date"===e?V(a,function(a,b){return b-a}):a.slice(0)})};for(var ka in la)la[ka]={value:new f.NativeFunction(la[ka]),valueset:!0,node:null};var oa=function(){};oa.prototype=la;oa.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};oa.prototype.pi={value:Math.PI,valueset:!0,node:null};b.functionHelper={fixSpatialReference:f.fixSpatialReference,parseArguments:D,standardFunction:K};
b.extend=function(a){for(var b={mode:"sync",compiled:!1,functions:{},signatures:[],standardFunction:K,evaluateIdentifier:T,arcadeCustomFunctionHandler:da},d=0;d<a.length;d++)a[d].registerFunctions(b);for(var e in b.functions)la[e]={value:new f.NativeFunction(b.functions[e]),valueset:!0,node:null},oa.prototype[e]=la[e];for(d=0;d<b.signatures.length;d++)c.addFunctionDeclaration(b.signatures[d],"async")};b.executeScript=function(b,c){var d=c.spatialReference;if(null===d||void 0===d)d=new C({wkid:102100});
var e=c.vars,k=c.customfunctions,m=new oa;e||(e={});k||(k={});var p=new h({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});p.immutable=!1;m.textformatting={value:p,valueset:!0,node:null};for(var r in k)m[r]={value:new f.NativeFunction(k[r]),native:!0,valueset:!0,node:null};for(r in e)m[r]=e[r]&&"esri.Graphic"===e[r].declaredClass?{value:a.createFromGraphic(e[r]),valueset:!0,node:null}:{value:e[r],valueset:!0,node:null};b=I({spatialReference:d,globalScope:m,
localScope:null,console:c.console?c.console:F,lrucache:c.lrucache,depthCounter:1},b.body[0].body);b instanceof f.ReturnResult&&(b=b.value);b instanceof f.ImplicitResult&&(b=b.value);b===f.voidOperation&&(b=null);if(b===f.breakResult)throw Error("Cannot return BREAK");if(b===f.continueResult)throw Error("Cannot return CONTINUE");if(b instanceof g)throw Error("Cannot return FUNCTION");if(b instanceof f.NativeFunction)throw Error("Cannot return FUNCTION");return b};b.extractFieldLiterals=function(a,
b){void 0===b&&(b=!1);return c.findFieldLiterals(a,b)};b.validateScript=function(a,b){return c.validateScript(a,b,"simple")};b.referencesMember=function(a,b){return c.referencesMember(a,b)};b.referencesFunction=function(a,b){return c.referencesFunction(a,b)};b.findFunctionCalls=function(a){return c.findFunctionCalls(a,!1)}})},"esri/arcade/parser":function(){define(["require","exports","./treeAnalysis","./lib/esprima"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.parseScript=
function(b,a){void 0===a&&(a=[]);b=k.parse("function _() { "+b+"\n}");if(null===b.body||void 0===b.body)throw Error("No formula provided.");if(0===b.body.length)throw Error("No formula provided.");if(0===b.body.length)throw Error("No formula provided.");if("BlockStatement"!==b.body[0].body.type)throw Error("Invalid formula content.");var g=l.validateLanguage(b);if(""!==g)throw Error(g);l.findScriptDependencies(b,a);return b};b.scriptCheck=function(b,a,g,e,d){var f=[];try{var c=k.parse("function _() { "+
b+"\n}",{tolerant:!0,loc:!0}),h=c.errors;if(0<h.length)for(var p=0;p<h.length;p++)f.push({line:h[p].lineNumber,character:h[p].column,reason:h[p].description});var r=l.checkScript(c,a,g,e,d);for(a=0;a<r.length;a++)f.push(r[a])}catch(t){try{"Unexpected token }"===t.description?(t.index=("function _() { "+b+"\n}").length-1,f.push({line:t.lineNumber,character:t.column,reason:"Unexpected end of script"})):f.push({line:t.lineNumber,character:t.column,reason:t.description})}catch(x){}}return f};b.extractFieldLiterals=
function(b,a){void 0===a&&(a=!1);return l.findFieldLiterals(b,a)};b.validateScript=function(b,a,g){return l.validateScript(b,a,g)};b.referencesMember=function(b,a){return l.referencesMember(b,a)};b.referencesFunction=function(b,a){return l.referencesFunction(b,a)}})},"esri/arcade/lib/esprima":function(){(function(n,b){"function"===typeof define&&define.amd?define(["exports"],b):"undefined"!==typeof exports?b(exports):b(n.esprima={})})(this,function(n){function b(a,b){if(!a)throw Error("ASSERT: "+
b);}function l(a){return 48<=a&&57>=a}function k(a){return 0<="0123456789abcdefABCDEF".indexOf(a)}function h(a){return 0<="01234567".indexOf(a)}function a(a){return 10===a||13===a||8232===a||8233===a}function g(a){return 36===a||95===a||65<=a&&90>=a||97<=a&&122>=a||92===a||128<=a&&Ya.NonAsciiIdentifierStart.test(String.fromCharCode(a))}function e(a){return 36===a||95===a||65<=a&&90>=a||97<=a&&122>=a||48<=a&&57>=a||92===a||128<=a&&Ya.NonAsciiIdentifierPart.test(String.fromCharCode(a))}function d(a){a=
a.toLowerCase();switch(a.length){case 2:return"if"===a||"in"===a;case 3:return"var"===a||"for"===a;case 4:return"else"===a;case 5:return"break"===a;case 6:return"return"===a;case 8:return"function"===a.toLowerCase()||"continue"===a;default:return!1}}function f(a,c,d,e,f){b("number"===typeof d,"Comment must have valid position");Aa.lastCommentStart>=d||(Aa.lastCommentStart=d,a={type:a,value:c},ja.range&&(a.range=[d,e]),ja.loc&&(a.loc=f),ja.comments.push(a),ja.attachComment&&(ja.leadingComments.push(a),
ja.trailingComments.push(a)))}function c(b){var c,d,e;c=aa-b;for(d={start:{line:Fa,column:aa-Ha-b}};aa<Ka;)if(e=ta.charCodeAt(aa),++aa,a(e)){ja.comments&&(b=ta.slice(c+b,aa-1),d.end={line:Fa,column:aa-Ha-1},f("Line",b,c,aa-1,d));13===e&&10===ta.charCodeAt(aa)&&++aa;++Fa;Ha=aa;return}ja.comments&&(b=ta.slice(c+b,aa),d.end={line:Fa,column:aa-Ha},f("Line",b,c,aa,d))}function q(){var b,d;for(d=0===aa;aa<Ka;)if(b=ta.charCodeAt(aa),32===b||9===b||11===b||12===b||160===b||5760<=b&&0<=[5760,6158,8192,8193,
8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(b))++aa;else if(a(b))++aa,13===b&&10===ta.charCodeAt(aa)&&++aa,++Fa,Ha=aa,d=!0;else if(47===b)if(b=ta.charCodeAt(aa+1),47===b)++aa,++aa,c(2),d=!0;else if(42===b){++aa;++aa;a:{var e=b=void 0,g=void 0,g=void 0;ja.comments&&(b=aa-2,e={start:{line:Fa,column:aa-Ha-2}});for(;aa<Ka;)if(g=ta.charCodeAt(aa),a(g))13===g&&10===ta.charCodeAt(aa+1)&&++aa,++Fa,++aa,Ha=aa,aa>=Ka&&S();else{if(42===g&&47===ta.charCodeAt(aa+1)){++aa;++aa;ja.comments&&
(g=ta.slice(b+2,aa-2),e.end={line:Fa,column:aa-Ha},f("Block",g,b,aa,e));break a}++aa}S()}}else break;else if(d&&45===b)if(45===ta.charCodeAt(aa+1)&&62===ta.charCodeAt(aa+2))aa+=3,c(3);else break;else if(60===b)if("!--"===ta.slice(aa+1,aa+4))++aa,++aa,++aa,++aa,c(4);else break;else break}function p(a){var b,c,d=0;b="u"===a?4:2;for(a=0;a<b;++a)if(aa<Ka&&k(ta[aa]))c=ta[aa++],d=16*d+"0123456789abcdef".indexOf(c.toLowerCase());else return"";return String.fromCharCode(d)}function r(){var a,b;a=ta.charCodeAt(aa++);
b=String.fromCharCode(a);92===a&&(117!==ta.charCodeAt(aa)&&S(),++aa,(a=p("u"))&&"\\"!==a&&g(a.charCodeAt(0))||S(),b=a);for(;aa<Ka;){a=ta.charCodeAt(aa);if(!e(a))break;++aa;b+=String.fromCharCode(a);92===a&&(b=b.substr(0,b.length-1),117!==ta.charCodeAt(aa)&&S(),++aa,(a=p("u"))&&"\\"!==a&&e(a.charCodeAt(0))||S(),b+=a)}return b}function t(){var a=aa,b=ta.charCodeAt(aa),c,d=ta[aa];switch(b){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++aa,ja.tokenize&&
(40===b?ja.openParenToken=ja.tokens.length:123===b&&(ja.openCurlyToken=ja.tokens.length)),{type:pa.Punctuator,value:String.fromCharCode(b),lineNumber:Fa,lineStart:Ha,start:a,end:aa};default:if(c=ta.charCodeAt(aa+1),61===c)switch(b){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return aa+=2,{type:pa.Punctuator,value:String.fromCharCode(b)+String.fromCharCode(c),lineNumber:Fa,lineStart:Ha,start:a,end:aa};case 33:case 61:return aa+=2,61===ta.charCodeAt(aa)&&++aa,{type:pa.Punctuator,
value:ta.slice(a,aa),lineNumber:Fa,lineStart:Ha,start:a,end:aa}}}b=ta.substr(aa,4);if("\x3e\x3e\x3e\x3d"===b)return aa+=4,{type:pa.Punctuator,value:b,lineNumber:Fa,lineStart:Ha,start:a,end:aa};b=b.substr(0,3);if("\x3e\x3e\x3e"===b||"\x3c\x3c\x3d"===b||"\x3e\x3e\x3d"===b)return aa+=3,{type:pa.Punctuator,value:b,lineNumber:Fa,lineStart:Ha,start:a,end:aa};b=b.substr(0,2);if(d===b[1]&&0<="+-\x3c\x3e\x26|".indexOf(d)||"\x3d\x3e"===b)return aa+=2,{type:pa.Punctuator,value:b,lineNumber:Fa,lineStart:Ha,start:a,
end:aa};if(0<="\x3c\x3e\x3d!+-*%\x26|^/".indexOf(d))return++aa,{type:pa.Punctuator,value:d,lineNumber:Fa,lineStart:Ha,start:a,end:aa};S()}function x(){var a,c,d;d=ta[aa];b(l(d.charCodeAt(0))||"."===d,"Numeric literal must start with a decimal digit or a decimal point");c=aa;a="";if("."!==d){a=ta[aa++];d=ta[aa];if("0"===a){if("x"===d||"X"===d){++aa;for(a="";aa<Ka&&k(ta[aa]);)a+=ta[aa++];0===a.length&&S();g(ta.charCodeAt(aa))&&S();return{type:pa.NumericLiteral,value:parseInt("0x"+a,16),lineNumber:Fa,
lineStart:Ha,start:c,end:aa}}if("b"===d||"B"===d){++aa;for(d="";aa<Ka;){a=ta[aa];if("0"!==a&&"1"!==a)break;d+=ta[aa++]}0===d.length&&S();aa<Ka&&(a=ta.charCodeAt(aa),(g(a)||l(a))&&S());return{type:pa.NumericLiteral,value:parseInt(d,2),lineNumber:Fa,lineStart:Ha,start:c,end:aa}}if("o"===d||"O"===d){h(d)?(d=!0,a="0"+ta[aa++]):(d=!1,++aa,a="");for(;aa<Ka&&h(ta[aa]);)a+=ta[aa++];d||0!==a.length||S();(g(ta.charCodeAt(aa))||l(ta.charCodeAt(aa)))&&S();return{type:pa.NumericLiteral,value:parseInt(a,8),octal:d,
lineNumber:Fa,lineStart:Ha,start:c,end:aa}}}for(;l(ta.charCodeAt(aa));)a+=ta[aa++];d=ta[aa]}if("."===d){for(a+=ta[aa++];l(ta.charCodeAt(aa));)a+=ta[aa++];d=ta[aa]}if("e"===d||"E"===d){a+=ta[aa++];d=ta[aa];if("+"===d||"-"===d)a+=ta[aa++];if(l(ta.charCodeAt(aa)))for(;l(ta.charCodeAt(aa));)a+=ta[aa++];else S()}g(ta.charCodeAt(aa))&&S();return{type:pa.NumericLiteral,value:parseFloat(a),lineNumber:Fa,lineStart:Ha,start:c,end:aa}}function w(){ra=null;q();L("Regular Expression language structures not supported")}
function u(){q();w()}function y(){var a;a=ja.tokens[ja.tokens.length-1];if(!a)return u();if("Punctuator"===a.type){if("]"===a.value)return t();if(")"===a.value)return a=ja.tokens[ja.openParenToken-1],!a||"Keyword"!==a.type||"if"!==a.value.toLowerCase()&&"while"!==a.value.toLowerCase()&&"for"!==a.value.toLowerCase()&&"with"!==a.value.toLowerCase()?t():u();if("}"===a.value){if(ja.tokens[ja.openCurlyToken-3]&&"Keyword"===ja.tokens[ja.openCurlyToken-3].type){if(a=ja.tokens[ja.openCurlyToken-4],!a)return t()}else if(ja.tokens[ja.openCurlyToken-
4]&&"Keyword"===ja.tokens[ja.openCurlyToken-4].type){if(a=ja.tokens[ja.openCurlyToken-5],!a)return u()}else return t();if(0<=hb.indexOf(a.value))return t()}return u()}return"Keyword"===a.type&&"this"!==a.value?u():t()}function m(){var c;q();if(aa>=Ka)return{type:pa.EOF,lineNumber:Fa,lineStart:Ha,start:aa,end:aa};c=ta.charCodeAt(aa);if(g(c)){var f;c=aa;if(92===ta.charCodeAt(aa))f=r();else a:{var m;for(f=aa++;aa<Ka;){m=ta.charCodeAt(aa);if(92===m){aa=f;f=r();break a}if(e(m))++aa;else break}f=ta.slice(f,
aa)}return{type:1===f.length?pa.Identifier:d(f)?pa.Keyword:"null"===f.toLowerCase()?pa.NullLiteral:"true"===f.toLowerCase()||"false"===f.toLowerCase()?pa.BooleanLiteral:pa.Identifier,value:f,lineNumber:Fa,lineStart:Ha,start:c,end:aa}}if(40===c||41===c||59===c)return t();if(39===c||34===c){var v="",u,w,z;m=!1;var B,n;B=Fa;n=Ha;c=ta[aa];b("'"===c||'"'===c,"String literal must starts with a quote");f=aa;for(++aa;aa<Ka;)if(u=ta[aa++],u===c){c="";break}else if("\\"===u)if((u=ta[aa++])&&a(u.charCodeAt(0)))++Fa,
"\r"===u&&"\n"===ta[aa]&&++aa,Ha=aa;else switch(u){case "u":case "x":if("{"===ta[aa]){++aa;w=u=void 0;u=ta[aa];w=0;for("}"===u&&S();aa<Ka;){u=ta[aa++];if(!k(u))break;w=16*w+"0123456789abcdef".indexOf(u.toLowerCase())}(1114111<w||"}"!==u)&&S();u=65535>=w?String.fromCharCode(w):String.fromCharCode((w-65536>>10)+55296,(w-65536&1023)+56320);v+=u}else z=aa,(w=p(u))?v+=w:(aa=z,v+=u);break;case "n":v+="\n";break;case "r":v+="\r";break;case "t":v+="\t";break;case "b":v+="\b";break;case "f":v+="\f";break;
case "v":v+="\x0B";break;default:h(u)?(w="01234567".indexOf(u),0!==w&&(m=!0),aa<Ka&&h(ta[aa])&&(m=!0,w=8*w+"01234567".indexOf(ta[aa++]),0<="0123".indexOf(u)&&aa<Ka&&h(ta[aa])&&(w=8*w+"01234567".indexOf(ta[aa++]))),v+=String.fromCharCode(w)):v+=u}else if(a(u.charCodeAt(0)))break;else v+=u;""!==c&&S();return{type:pa.StringLiteral,value:v,octal:m,startLineNumber:B,startLineStart:n,lineNumber:Fa,lineStart:Ha,start:f,end:aa}}return 46===c?l(ta.charCodeAt(aa+1))?x():t():l(c)?x():ja.tokenize&&47===c?y():
t()}function v(){var a,b,c;q();a={start:{line:Fa,column:aa-Ha}};b=m();a.end={line:Fa,column:aa-Ha};b.type!==pa.EOF&&(c=ta.slice(b.start,b.end),a={type:Ga[b.type],value:c,range:[b.start,b.end],loc:a},b.regex&&(a.regex={pattern:b.regex.pattern,flags:b.regex.flags}),ja.tokens.push(a));return b}function z(){var a;a=ra;aa=a.end;Fa=a.lineNumber;Ha=a.lineStart;ra="undefined"!==typeof ja.tokens?v():m();aa=a.end;Fa=a.lineNumber;Ha=a.lineStart;return a}function B(){var a,b,c;a=aa;b=Fa;c=Ha;ra="undefined"!==
typeof ja.tokens?v():m();aa=a;Fa=b;Ha=c}function C(){this.line=Fa;this.column=aa-Ha}function D(){this.start=new C;this.end=null}function K(a){this.start=a.type===pa.StringLiteral?{line:a.startLineNumber,column:a.start-a.startLineStart}:{line:a.lineNumber,column:a.start-a.lineStart};this.end=null}function I(){aa=ra.start;ra.type===pa.StringLiteral?(Fa=ra.startLineNumber,Ha=ra.startLineStart):(Fa=ra.lineNumber,Ha=ra.lineStart);ja.range&&(this.range=[aa,0]);ja.loc&&(this.loc=new D)}function Q(a){ja.range&&
(this.range=[a.start,0]);ja.loc&&(this.loc=new K(a))}function J(){var a,b,c,d;a=aa;b=Fa;c=Ha;q();d=Fa!==b;aa=a;Fa=b;Ha=c;return d}function N(a,b,c){var d=Error("Line "+a+": "+c);d.index=b;d.lineNumber=a;d.column=b-Ha+1;d.description=c;return d}function L(a){var c,d;c=Array.prototype.slice.call(arguments,1);d=a.replace(/%(\d)/g,function(a,d){b(d<c.length,"Message reference must be in range");return c[d]});throw N(Fa,aa,d);}function M(a){var c,d;c=Array.prototype.slice.call(arguments,1);d=a.replace(/%(\d)/g,
function(a,d){b(d<c.length,"Message reference must be in range");return c[d]});d=N(Fa,aa,d);if(ja.errors)ja.errors.push(d);else throw d;}function R(a,b){var c=Da.UnexpectedToken;a&&(c=b?b:a.type===pa.EOF?Da.UnexpectedEOS:a.type===pa.Identifier?Da.UnexpectedIdentifier:a.type===pa.NumericLiteral?Da.UnexpectedNumber:a.type===pa.StringLiteral?Da.UnexpectedString:Da.UnexpectedToken);c=c.replace("%0",a?a.value:"ILLEGAL");return a&&"number"===typeof a.lineNumber?N(a.lineNumber,a.start,c):N(Fa,aa,c)}function S(a,
b){throw R(a,b);}function T(a,b){a=R(a,b);if(ja.errors)ja.errors.push(a);else throw a;}function U(a){var b=z();b.type===pa.Punctuator&&b.value===a||S(b)}function Y(){var a;ja.errors?(a=ra,a.type===pa.Punctuator&&","===a.value?z():a.type===pa.Punctuator&&";"===a.value?(z(),T(a)):T(a,Da.UnexpectedToken)):U(",")}function X(a){var b=z();b.type===pa.Keyword&&b.value.toLowerCase()===a.toLowerCase()||S(b)}function P(a){return ra.type===pa.Punctuator&&ra.value===a}function V(a){return ra.type===pa.Keyword&&
ra.value.toLowerCase()===a.toLowerCase()}function Z(){var a;59===ta.charCodeAt(aa)||P(";")?z():(a=Fa,q(),Fa===a&&(ra.type===pa.EOF||P("}")||S(ra)))}function ca(a){return a.type===Ba.Identifier||a.type===Ba.MemberExpression}function da(a,b){var c,d=new I;b=Qa;c=W();Qa=b;return d.finishFunctionExpression(null,a,[],c)}function F(){var a,b;a=Qa;Qa=!0;b=Pa();b=da(b.params);Qa=a;return b}function ea(){var a,b=new I;a=z();return a.type===pa.StringLiteral||a.type===pa.NumericLiteral?(Qa&&a.octal&&T(a,Da.StrictOctalLiteral),
b.finishLiteral(a)):b.finishIdentifier(a.value)}function la(){var a,b,c,d=new I;a=ra;if(a.type===pa.Identifier)return b=ea(),"get"!==a.value||P(":")||P("(")?"set"!==a.value||P(":")||P("(")?P(":")?(z(),a=G(),d.finishProperty("init",b,a,!1,!1)):P("(")?(a=F(),d.finishProperty("init",b,a,!0,!1)):d.finishProperty("init",b,b,!1,!0):(b=ea(),U("("),a=ra,a.type!==pa.Identifier?(U(")"),T(a),a=da([])):(c=[za()],U(")"),a=da(c,a)),d.finishProperty("set",b,a,!1,!1)):(b=ea(),U("("),U(")"),a=da([]),d.finishProperty("get",
b,a,!1,!1));if(a.type===pa.EOF||a.type===pa.Punctuator)S(a);else{b=ea();if(P(":"))return z(),a=G(),d.finishProperty("init",b,a,!1,!1);if(P("("))return a=F(),d.finishProperty("init",b,a,!0,!1);S(z())}}function ka(a){var b=[],c,d,e={},f=String,g=new I;for(!0!==a&&U("{");!P("}");)a=la(),c=a.key.type===Ba.Identifier?a.key.name:f(a.key.value),d="init"===a.kind?Ua.Data:"get"===a.kind?Ua.Get:Ua.Set,c="$"+c,Object.prototype.hasOwnProperty.call(e,c)?(e[c]===Ua.Data?Qa&&d===Ua.Data?M(Da.StrictDuplicateProperty):
d!==Ua.Data&&M(Da.AccessorDataProperty):d===Ua.Data?M(Da.AccessorDataProperty):e[c]&d&&M(Da.AccessorGetSet),e[c]|=d):e[c]=d,b.push(a),P("}")||Y();U("}");return g.finishObjectExpression(b)}function oa(){var a,b,c,d;if(P("("))return U("("),P(")")?(z(),b=db.ArrowParameterPlaceHolder):(++Aa.parenthesisCount,b=Ea(),U(")")),b;if(P("[")){b=[];var e=new I;for(U("[");!P("]");)P(",")?(z(),b.push(null)):(b.push(G()),P("]")||U(","));z();return e.finishArrayExpression(b)}if(P("{"))return ka();a=ra.type;d=new I;
if(a===pa.Identifier)c=d.finishIdentifier(z().value);else if(a===pa.StringLiteral||a===pa.NumericLiteral)Qa&&ra.octal&&T(ra,Da.StrictOctalLiteral),c=d.finishLiteral(z());else if(a===pa.Keyword){if(V("function")){d=null;var f;c=[];var g=[],h,k=new I;X("function");P("(")||(d=za());f=Pa(b);c=f.params;g=f.defaults;a=f.stricted;b=f.firstRestricted;f.message&&(e=f.message);h=Qa;f=W();Qa&&b&&S(b,e);Qa&&a&&T(a,e);Qa=h;return k.finishFunctionExpression(d,c,g,f)}V("this")?(z(),c=d.finishThisExpression()):S(z())}else a===
pa.BooleanLiteral?(b=z(),b.value="true"===b.value.toLowerCase(),c=d.finishLiteral(b)):a===pa.NullLiteral?(b=z(),b.value=null,c=d.finishLiteral(b)):P("/")||P("/\x3d")?(c="undefined"!==typeof ja.tokens?d.finishLiteral(u()):d.finishLiteral(w()),B()):S(z());return c}function va(){var a=[];U("(");if(!P(")"))for(;aa<Ka;){a.push(G());if(P(")"))break;Y()}U(")");return a}function fa(){U(".");var a,b=new I;a=z();a.type===pa.Identifier||a.type===pa.Keyword||a.type===pa.BooleanLiteral||a.type===pa.NullLiteral||
S(a);return b.finishIdentifier(a.value)}function xa(){var a;U("[");a=Ea();U("]");return a}function ia(){var a,c,d=new I;X("new");var e;b(Aa.allowIn,"callee of new expression always allow in keyword.");e=ra;for(a=V("new")?ia():oa();;)if(P("["))c=xa(),a=(new Q(e)).finishMemberExpression("[",a,c);else if(P("."))c=fa(),a=(new Q(e)).finishMemberExpression(".",a,c);else break;c=P("(")?va():[];return d.finishNewExpression(a,c)}function na(){var a,b,c=ra,d,e=Aa.allowIn;b=ra;Aa.allowIn=!0;for(a=V("new")?ia():
oa();;)if(P("."))d=fa(),a=(new Q(b)).finishMemberExpression(".",a,d);else if(P("("))d=va(),a=(new Q(b)).finishCallExpression(a,d);else if(P("["))d=xa(),a=(new Q(b)).finishMemberExpression("[",a,d);else break;Aa.allowIn=e;ra.type!==pa.Punctuator||!P("++")&&!P("--")||J()||(ca(a)||M(Da.InvalidLHSInAssignment),b=z(),a=(new Q(c)).finishPostfixExpression(b.value,a));return a}function wa(){var a,b,c;ra.type!==pa.Punctuator&&ra.type!==pa.Keyword?b=na():P("++")||P("--")?(c=ra,a=z(),b=wa(),ca(b)||M(Da.InvalidLHSInAssignment),
b=(new Q(c)).finishUnaryExpression(a.value,b)):P("+")||P("-")||P("~")||P("!")?(c=ra,a=z(),b=wa(),b=(new Q(c)).finishUnaryExpression(a.value,b)):V("delete")||V("void")||V("typeof")?(c=ra,a=z(),b=wa(),b=(new Q(c)).finishUnaryExpression(a.value,b),Qa&&"delete"===b.operator&&b.argument.type===Ba.Identifier&&M(Da.StrictDelete)):b=na();return b}function Ca(a,b){var c=0;if(a.type!==pa.Punctuator&&a.type!==pa.Keyword)return 0;switch(a.value){case "||":c=1;break;case "\x26\x26":c=2;break;case "|":c=3;break;
case "^":c=4;break;case "\x26":c=5;break;case "\x3d\x3d":case "!\x3d":case "\x3d\x3d\x3d":case "!\x3d\x3d":c=6;break;case "\x3c":case "\x3e":case "\x3c\x3d":case "\x3e\x3d":case "instanceof":c=7;break;case "in":c=b?7:0;break;case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":c=8;break;case "+":case "-":c=9;break;case "*":case "/":case "%":c=11}return c}function ua(){var a,b,c,d,e,f;a=ra;b=wa();if(b===db.ArrowParameterPlaceHolder)return b;c=ra;d=Ca(c,Aa.allowIn);if(0===d)return b;c.prec=d;z();a=[a,
ra];f=wa();for(e=[b,c,f];0<(d=Ca(ra,Aa.allowIn));){for(;2<e.length&&d<=e[e.length-2].prec;)f=e.pop(),c=e.pop().value,b=e.pop(),a.pop(),b=(new Q(a[a.length-1])).finishBinaryExpression(c,b,f),e.push(b);c=z();c.prec=d;e.push(c);a.push(ra);b=wa();e.push(b)}d=e.length-1;b=e[d];for(a.pop();1<d;)b=(new Q(a.pop())).finishBinaryExpression(e[d-1].value,e[d-2],b),d-=2;return b}function ya(a){var b,c,d,e,f,g,h;e=[];f=[];g=0;h={paramSet:{}};b=0;for(c=a.length;b<c;b+=1)if(d=a[b],d.type===Ba.Identifier)e.push(d),
f.push(null),ga(h,d,d.name);else if(d.type===Ba.AssignmentExpression)e.push(d.left),f.push(d.right),++g,ga(h,d.left,d.left.name);else return null;h.message===Da.StrictParamDupe&&(a=Qa?h.stricted:h.firstRestricted,S(a,h.message));0===g&&(f=[]);return{params:e,defaults:f,rest:null,stricted:h.stricted,firstRestricted:h.firstRestricted,message:h.message}}function G(){var a,b,c,d,e;a=Aa.parenthesisCount;b=e=ra;var f,g;g=ra;c=ua();c!==db.ArrowParameterPlaceHolder&&P("?")&&(z(),f=Aa.allowIn,Aa.allowIn=!0,
b=G(),Aa.allowIn=f,U(":"),f=G(),c=(new Q(g)).finishConditionalExpression(c,b,f));if(c===db.ArrowParameterPlaceHolder||P("\x3d\x3e"))if(Aa.parenthesisCount===a||Aa.parenthesisCount===a+1)if(c.type===Ba.Identifier?d=ya([c]):c.type===Ba.AssignmentExpression?d=ya([c]):c.type===Ba.SequenceExpression?d=ya(c.expressions):c===db.ArrowParameterPlaceHolder&&(d=ya([])),d)return a=d,e=new Q(e),U("\x3d\x3e"),d=Qa,c=P("{")?W():G(),Qa&&a.firstRestricted&&S(a.firstRestricted,a.message),Qa&&a.stricted&&T(a.stricted,
a.message),Qa=d,e.finishArrowFunctionExpression(a.params,a.defaults,c,c.type!==Ba.BlockStatement);ra.type!==pa.Punctuator?a=!1:(a=ra.value,a="\x3d"===a||"*\x3d"===a||"/\x3d"===a||"%\x3d"===a||"+\x3d"===a||"-\x3d"===a||"\x3c\x3c\x3d"===a||"\x3e\x3e\x3d"===a||"\x3e\x3e\x3e\x3d"===a||"\x26\x3d"===a||"^\x3d"===a||"|\x3d"===a);a&&(ca(c)||M(Da.InvalidLHSInAssignment),b=z(),a=G(),c=(new Q(e)).finishAssignmentExpression(b.value,c,a));return c}function Ea(){var a,b=ra;a=G();if(P(",")){for(a=[a];aa<Ka&&P(",");)z(),
a.push(G());a=(new Q(b)).finishSequenceExpression(a)}return a}function za(){var a,b=new I;a=z();a.type!==pa.Identifier&&S(a);return b.finishIdentifier(a.value)}function H(a){var b=null,c,d=new I;c=za();"const"===a?(U("\x3d"),b=G()):P("\x3d")&&(z(),b=G());return d.finishVariableDeclarator(c,b)}function qa(a){var b=[];do{b.push(H(a));if(!P(","))break;z()}while(aa<Ka);return b}function sa(a){var b=ra.type,c,d;b===pa.EOF&&S(ra);if(b===pa.Punctuator&&"{"===ra.value){if(a){U("{");var e=ra;a=aa;c=Fa;d=Ha;
z();b=P(":");ra=e;aa=a;Fa=c;Ha=d;if((ra.type===pa.Identifier||ra.type===pa.StringLiteral)&&b)return ka(!0);a=new I;for(c=[];aa<Ka&&!P("}");){d=Ta();if("undefined"===typeof d)break;c.push(d)}U("}");return a.finishBlockStatement(c)}return ka()}a=new I;if(b===pa.Punctuator)switch(ra.value){case ";":return a=new I,U(";"),a.finishEmptyStatement();case "(":return c=Ea(),Z(),a.finishExpressionStatement(c)}else if(b===pa.Keyword)switch(ra.value.toLowerCase()){case "break":return c=null,X("break"),59===ta.charCodeAt(aa)?
(z(),Aa.inIteration||Aa.inSwitch||L(Da.IllegalBreak),a=a.finishBreakStatement(null)):J()?(Aa.inIteration||Aa.inSwitch||L(Da.IllegalBreak),a=a.finishBreakStatement(null)):(ra.type===pa.Identifier&&(c=za(),d="$"+c.name,Object.prototype.hasOwnProperty.call(Aa.labelSet,d)||L(Da.UnknownLabel,c.name)),Z(),null!==c||Aa.inIteration||Aa.inSwitch||L(Da.IllegalBreak),a=a.finishBreakStatement(c)),a;case "continue":return c=null,X("continue"),59===ta.charCodeAt(aa)?(z(),Aa.inIteration||L(Da.IllegalContinue),a=
a.finishContinueStatement(null)):J()?(Aa.inIteration||L(Da.IllegalContinue),a=a.finishContinueStatement(null)):(ra.type===pa.Identifier&&(c=za(),d="$"+c.name,Object.prototype.hasOwnProperty.call(Aa.labelSet,d)||L(Da.UnknownLabel,c.name)),Z(),null!==c||Aa.inIteration||L(Da.IllegalContinue),a=a.finishContinueStatement(c)),a;case "for":var f,h,k;h=Aa.allowIn;f=b=e=null;X("for");U("(");if(P(";"))z();else{if(V("var")){Aa.allowIn=!1;var m=new I;f=z();k=qa();f=m.finishVariableDeclaration(k,f.value);Aa.allowIn=
h;1===f.declarations.length&&V("in")&&(z(),c=f,d=Ea(),f=null)}else Aa.allowIn=!1,f=Ea(),Aa.allowIn=h,V("in")&&(ca(f)||M(Da.InvalidLHSInForIn),z(),c=f,d=Ea(),f=null);"undefined"===typeof c&&U(";")}"undefined"===typeof c&&(P(";")||(b=Ea()),U(";"),P(")")||(e=Ea()));U(")");k=Aa.inIteration;Aa.inIteration=!0;h=sa(!0);Aa.inIteration=k;return"undefined"===typeof c?a.finishForStatement(f,b,e,h):a.finishForInStatement(c,d,h);case "function":return Ra(a);case "if":return X("if"),U("("),c=Ea(),U(")"),d=sa(!0),
V("else")?(z(),b=sa(!0)):b=null,a.finishIfStatement(c,d,b);case "return":return c=null,X("return"),Aa.inFunctionBody||M(Da.IllegalReturn),32===ta.charCodeAt(aa)&&g(ta.charCodeAt(aa+1))?(c=Ea(),Z(),a=a.finishReturnStatement(c)):J()?a=a.finishReturnStatement(null):(P(";")||P("}")||ra.type===pa.EOF||(c=Ea()),Z(),a=a.finishReturnStatement(c)),a;case "var":return X("var"),c=qa(),Z(),a.finishVariableDeclaration(c,"var")}c=Ea();if(c.type===Ba.Identifier&&P(":"))return z(),b="$"+c.name,Object.prototype.hasOwnProperty.call(Aa.labelSet,
b)&&L(Da.Redeclaration,"Label",c.name),Aa.labelSet[b]=!0,d=sa(!1),delete Aa.labelSet[b],a.finishLabeledStatement(c,d);Z();return a.finishExpressionStatement(c)}function W(){var a,b=[],c,d,e,f,g,h=new I;for(U("{");aa<Ka&&ra.type===pa.StringLiteral;){c=ra;a=Ta();b.push(a);if(a.expression.type!==Ba.Literal)break;a=ta.slice(c.start+1,c.end-1);"use strict"===a?(Qa=!0,d&&T(d,Da.StrictOctalLiteral)):!d&&c.octal&&(d=c)}c=Aa.labelSet;d=Aa.inIteration;e=Aa.inSwitch;f=Aa.inFunctionBody;g=Aa.parenthesizedCount;
Aa.labelSet={};Aa.inIteration=!1;Aa.inSwitch=!1;Aa.inFunctionBody=!0;for(Aa.parenthesizedCount=0;aa<Ka&&!P("}");){a=Ta();if("undefined"===typeof a)break;b.push(a)}U("}");Aa.labelSet=c;Aa.inIteration=d;Aa.inSwitch=e;Aa.inFunctionBody=f;Aa.parenthesizedCount=g;return h.finishBlockStatement(b)}function ga(a,b,c){c="$"+c;Qa?Object.prototype.hasOwnProperty.call(a.paramSet,c)&&(a.stricted=b,a.message=Da.StrictParamDupe):!a.firstRestricted&&Object.prototype.hasOwnProperty.call(a.paramSet,c)&&(a.firstRestricted=
b,a.message=Da.StrictParamDupe);a.paramSet[c]=!0}function Pa(a){a={params:[],defaultCount:0,defaults:[],firstRestricted:a};U("(");if(!P(")"))for(a.paramSet={};aa<Ka;){var b=a,c=void 0,d=void 0,e=void 0,c=ra,d=za();ga(b,c,c.value);P("\x3d")&&(z(),e=G(),++b.defaultCount);b.params.push(d);b.defaults.push(e);if(P(")"))break;U(",")}U(")");0===a.defaultCount&&(a.defaults=[]);return{params:a.params,defaults:a.defaults,stricted:a.stricted,firstRestricted:a.firstRestricted,message:a.message}}function Ra(){var a,
b=[],c=[],d,e,f,g,h,k=new I;X("function");a=za();d=Pa(f);b=d.params;c=d.defaults;e=d.stricted;f=d.firstRestricted;d.message&&(g=d.message);h=Qa;d=W();Qa&&f&&S(f,g);Qa&&e&&T(e,g);Qa=h;return k.finishFunctionDeclaration(a,b,c,d)}function Ta(){if(ra.type===pa.Keyword)return"function"===ra.value.toLowerCase()?Ra():sa(!1);if(ra.type!==pa.EOF)return sa(!1)}function A(){var a,b,c,d=[];for(a=0;a<ja.tokens.length;++a)b=ja.tokens[a],c={type:b.type,value:b.value},b.regex&&(c.regex={pattern:b.regex.pattern,flags:b.regex.flags}),
ja.range&&(c.range=b.range),ja.loc&&(c.loc=b.loc),d.push(c);ja.tokens=d}var pa,Ga,hb,Ba,db,Ua,Da,Ya,ta,Qa,aa,Fa,Ha,Ka,ra,Aa,ja;pa={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9};Ga={};Ga[pa.BooleanLiteral]="Boolean";Ga[pa.EOF]="\x3cend\x3e";Ga[pa.Identifier]="Identifier";Ga[pa.Keyword]="Keyword";Ga[pa.NullLiteral]="Null";Ga[pa.NumericLiteral]="Numeric";Ga[pa.Punctuator]="Punctuator";Ga[pa.StringLiteral]="String";Ga[pa.RegularExpression]=
"RegularExpression";hb="( { [ in typeof instanceof new return case delete throw void \x3d +\x3d -\x3d *\x3d /\x3d %\x3d \x3c\x3c\x3d \x3e\x3e\x3d \x3e\x3e\x3e\x3d \x26\x3d |\x3d ^\x3d , + - * / % ++ -- \x3c\x3c \x3e\x3e \x3e\x3e\x3e \x26 | ^ ! ~ \x26\x26 || ? : \x3d\x3d\x3d \x3d\x3d \x3e\x3d \x3c\x3d \x3c \x3e !\x3d !\x3d\x3d".split(" ");Ba={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",
CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",
ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator"};db={ArrowParameterPlaceHolder:{type:"ArrowParameterPlaceHolder"}};Ua={Data:1,Get:2,Set:4};Da={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",
UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",
Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",
StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",
StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"};Ya={NonAsciiIdentifierStart:/[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u052f\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0-\u08b2\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191e\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua69d\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua7ad\ua7b0\ua7b1\ua7f7-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\ua9e0-\ua9e4\ua9e6-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa7e-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab5f\uab64\uab65\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/,
NonAsciiIdentifierPart:/[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0300-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u0483-\u0487\u048a-\u052f\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u05d0-\u05ea\u05f0-\u05f2\u0610-\u061a\u0620-\u0669\u066e-\u06d3\u06d5-\u06dc\u06df-\u06e8\u06ea-\u06fc\u06ff\u0710-\u074a\u074d-\u07b1\u07c0-\u07f5\u07fa\u0800-\u082d\u0840-\u085b\u08a0-\u08b2\u08e4-\u0963\u0966-\u096f\u0971-\u0983\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bc-\u09c4\u09c7\u09c8\u09cb-\u09ce\u09d7\u09dc\u09dd\u09df-\u09e3\u09e6-\u09f1\u0a01-\u0a03\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a59-\u0a5c\u0a5e\u0a66-\u0a75\u0a81-\u0a83\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abc-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ad0\u0ae0-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3c-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5c\u0b5d\u0b5f-\u0b63\u0b66-\u0b6f\u0b71\u0b82\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd0\u0bd7\u0be6-\u0bef\u0c00-\u0c03\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c58\u0c59\u0c60-\u0c63\u0c66-\u0c6f\u0c81-\u0c83\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbc-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0cde\u0ce0-\u0ce3\u0ce6-\u0cef\u0cf1\u0cf2\u0d01-\u0d03\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d-\u0d44\u0d46-\u0d48\u0d4a-\u0d4e\u0d57\u0d60-\u0d63\u0d66-\u0d6f\u0d7a-\u0d7f\u0d82\u0d83\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0de6-\u0def\u0df2\u0df3\u0e01-\u0e3a\u0e40-\u0e4e\u0e50-\u0e59\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb9\u0ebb-\u0ebd\u0ec0-\u0ec4\u0ec6\u0ec8-\u0ecd\u0ed0-\u0ed9\u0edc-\u0edf\u0f00\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e-\u0f47\u0f49-\u0f6c\u0f71-\u0f84\u0f86-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1049\u1050-\u109d\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u135d-\u135f\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176c\u176e-\u1770\u1772\u1773\u1780-\u17d3\u17d7\u17dc\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1820-\u1877\u1880-\u18aa\u18b0-\u18f5\u1900-\u191e\u1920-\u192b\u1930-\u193b\u1946-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u19d0-\u19d9\u1a00-\u1a1b\u1a20-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1aa7\u1ab0-\u1abd\u1b00-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1bf3\u1c00-\u1c37\u1c40-\u1c49\u1c4d-\u1c7d\u1cd0-\u1cd2\u1cd4-\u1cf6\u1cf8\u1cf9\u1d00-\u1df5\u1dfc-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u200c\u200d\u203f\u2040\u2054\u2071\u207f\u2090-\u209c\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d7f-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2de0-\u2dff\u2e2f\u3005-\u3007\u3021-\u302f\u3031-\u3035\u3038-\u303c\u3041-\u3096\u3099\u309a\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua62b\ua640-\ua66f\ua674-\ua67d\ua67f-\ua69d\ua69f-\ua6f1\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua7ad\ua7b0\ua7b1\ua7f7-\ua827\ua840-\ua873\ua880-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f7\ua8fb\ua900-\ua92d\ua930-\ua953\ua960-\ua97c\ua980-\ua9c0\ua9cf-\ua9d9\ua9e0-\ua9fe\uaa00-\uaa36\uaa40-\uaa4d\uaa50-\uaa59\uaa60-\uaa76\uaa7a-\uaac2\uaadb-\uaadd\uaae0-\uaaef\uaaf2-\uaaf6\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab5f\uab64\uab65\uabc0-\uabea\uabec\uabed\uabf0-\uabf9\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe00-\ufe0f\ufe20-\ufe2d\ufe33\ufe34\ufe4d-\ufe4f\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff3f\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/};
Q.prototype=I.prototype={processComment:function(){var a,b,c,d=ja.bottomRightStack,e,f,g=d[d.length-1];if(!(this.type===Ba.Program&&0<this.body.length)){if(0<ja.trailingComments.length){c=[];for(e=ja.trailingComments.length-1;0<=e;--e)f=ja.trailingComments[e],f.range[0]>=this.range[1]&&(c.unshift(f),ja.trailingComments.splice(e,1));ja.trailingComments=[]}else g&&g.trailingComments&&g.trailingComments[0].range[0]>=this.range[1]&&(c=g.trailingComments,delete g.trailingComments);if(g)for(;g&&g.range[0]>=
this.range[0];)a=g,g=d.pop();if(a)a.leadingComments&&a.leadingComments[a.leadingComments.length-1].range[1]<=this.range[0]&&(this.leadingComments=a.leadingComments,a.leadingComments=void 0);else if(0<ja.leadingComments.length)for(b=[],e=ja.leadingComments.length-1;0<=e;--e)f=ja.leadingComments[e],f.range[1]<=this.range[0]&&(b.unshift(f),ja.leadingComments.splice(e,1));b&&0<b.length&&(this.leadingComments=b);c&&0<c.length&&(this.trailingComments=c);d.push(this)}},finish:function(){ja.range&&(this.range[1]=
aa);ja.loc&&(this.loc.end=new C,ja.source&&(this.loc.source=ja.source));ja.attachComment&&this.processComment()},finishArrayExpression:function(a){this.type=Ba.ArrayExpression;this.elements=a;this.finish();return this},finishAssignmentExpression:function(a,b,c){this.type=Ba.AssignmentExpression;this.operator=a;this.left=b;this.right=c;this.finish();return this},finishBinaryExpression:function(a,b,c){this.type="||"===a||"\x26\x26"===a?Ba.LogicalExpression:Ba.BinaryExpression;this.operator=a;this.left=
b;this.right=c;this.finish();return this},finishBlockStatement:function(a){this.type=Ba.BlockStatement;this.body=a;this.finish();return this},finishBreakStatement:function(a){this.type=Ba.BreakStatement;this.label=a;this.finish();return this},finishCallExpression:function(a,b){this.type=Ba.CallExpression;this.callee=a;this.arguments=b;this.finish();return this},finishConditionalExpression:function(a,b,c){this.type=Ba.ConditionalExpression;this.test=a;this.consequent=b;this.alternate=c;this.finish();
return this},finishContinueStatement:function(a){this.type=Ba.ContinueStatement;this.label=a;this.finish();return this},finishEmptyStatement:function(){this.type=Ba.EmptyStatement;this.finish();return this},finishExpressionStatement:function(a){this.type=Ba.ExpressionStatement;this.expression=a;this.finish();return this},finishForStatement:function(a,b,c,d){this.type=Ba.ForStatement;this.init=a;this.test=b;this.update=c;this.body=d;this.finish();return this},finishForInStatement:function(a,b,c){this.type=
Ba.ForInStatement;this.left=a;this.right=b;this.body=c;this.each=!1;this.finish();return this},finishFunctionDeclaration:function(a,b,c,d){this.type=Ba.FunctionDeclaration;this.id=a;this.params=b;this.defaults=c;this.body=d;this.rest=null;this.expression=this.generator=!1;this.finish();return this},finishFunctionExpression:function(a,b,c,d){this.type=Ba.FunctionExpression;this.id=a;this.params=b;this.defaults=c;this.body=d;this.rest=null;this.expression=this.generator=!1;this.finish();return this},
finishIdentifier:function(a){this.type=Ba.Identifier;this.name=a;this.finish();return this},finishIfStatement:function(a,b,c){this.type=Ba.IfStatement;this.test=a;this.consequent=b;this.alternate=c;this.finish();return this},finishLiteral:function(a){this.type=Ba.Literal;this.value=a.value;this.raw=ta.slice(a.start,a.end);a.regex&&(this.regex=a.regex);this.finish();return this},finishMemberExpression:function(a,b,c){this.type=Ba.MemberExpression;this.computed="["===a;this.object=b;this.property=c;
this.finish();return this},finishObjectExpression:function(a){this.type=Ba.ObjectExpression;this.properties=a;this.finish();return this},finishPostfixExpression:function(a,b){this.type=Ba.UpdateExpression;this.operator=a;this.argument=b;this.prefix=!1;this.finish();return this},finishProgram:function(a){this.type=Ba.Program;this.body=a;this.finish();return this},finishProperty:function(a,b,c,d,e){this.type=Ba.Property;this.key=b;this.value=c;this.kind=a;this.method=d;this.shorthand=e;this.finish();
return this},finishReturnStatement:function(a){this.type=Ba.ReturnStatement;this.argument=a;this.finish();return this},finishUnaryExpression:function(a,b){this.type="++"===a||"--"===a?Ba.UpdateExpression:Ba.UnaryExpression;this.operator=a;this.argument=b;this.prefix=!0;this.finish();return this},finishVariableDeclaration:function(a,b){this.type=Ba.VariableDeclaration;this.declarations=a;this.kind=b;this.finish();return this},finishVariableDeclarator:function(a,b){this.type=Ba.VariableDeclarator;this.id=
a;this.init=b;this.finish();return this}};n.version="2.0.0-dev";n.tokenize=function(a,b){var c,d;c=String;"string"===typeof a||a instanceof String||(a=c(a));ta=a;aa=0;Fa=0<ta.length?1:0;Ha=0;Ka=ta.length;ra=null;Aa={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1};ja={};b=b||{};b.tokens=!0;ja.tokens=[];ja.tokenize=!0;ja.openParenToken=-1;ja.openCurlyToken=-1;ja.range="boolean"===typeof b.range&&b.range;ja.loc="boolean"===typeof b.loc&&b.loc;"boolean"===typeof b.comment&&
b.comment&&(ja.comments=[]);"boolean"===typeof b.tolerant&&b.tolerant&&(ja.errors=[]);try{B();if(ra.type===pa.EOF)return ja.tokens;for(z();ra.type!==pa.EOF;)try{z()}catch(vb){if(ja.errors){ja.errors.push(vb);break}else throw vb;}A();d=ja.tokens;"undefined"!==typeof ja.comments&&(d.comments=ja.comments);"undefined"!==typeof ja.errors&&(d.errors=ja.errors)}catch(vb){throw vb;}finally{ja={}}return d};n.parse=function(a,b){var c,d;d=String;"string"===typeof a||a instanceof String||(a=d(a));ta=a;aa=0;
Fa=0<ta.length?1:0;Ha=0;Ka=ta.length;ra=null;Aa={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1};ja={};"undefined"!==typeof b&&(ja.range="boolean"===typeof b.range&&b.range,ja.loc="boolean"===typeof b.loc&&b.loc,ja.attachComment="boolean"===typeof b.attachComment&&b.attachComment,ja.loc&&null!==b.source&&void 0!==b.source&&(ja.source=d(b.source)),"boolean"===typeof b.tokens&&b.tokens&&(ja.tokens=[]),"boolean"===typeof b.comment&&b.comment&&
(ja.comments=[]),"boolean"===typeof b.tolerant&&b.tolerant&&(ja.errors=[]),ja.attachComment&&(ja.range=!0,ja.comments=[],ja.bottomRightStack=[],ja.trailingComments=[],ja.leadingComments=[]));try{var e;q();B();e=new I;Qa=!1;var f;a=[];for(var g,h,k;aa<Ka;){g=ra;if(g.type!==pa.StringLiteral)break;f=Ta();a.push(f);if(f.expression.type!==Ba.Literal)break;h=ta.slice(g.start+1,g.end-1);"use strict"===h?(Qa=!0,k&&T(k,Da.StrictOctalLiteral)):!k&&g.octal&&(k=g)}for(;aa<Ka;){f=Ta();if("undefined"===typeof f)break;
a.push(f)}c=e.finishProgram(a);"undefined"!==typeof ja.comments&&(c.comments=ja.comments);"undefined"!==typeof ja.tokens&&(A(),c.tokens=ja.tokens);"undefined"!==typeof ja.errors&&(c.errors=ja.errors)}catch(nb){throw nb;}finally{ja={}}return c};n.Syntax=function(){var a,b={};"function"===typeof Object.create&&(b=Object.create(null));for(a in Ba)Ba.hasOwnProperty(a)&&(b[a]=Ba[a]);"function"===typeof Object.freeze&&Object.freeze(b);return b}()})},"esri/intl/moment":function(){define("require exports ../core/tsSupport/awaiterHelper ../core/tsSupport/generatorHelper ../core/iteratorUtils ./locale @dojo/framework/shim/Promise".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});var g=h.SetFromValues("ar ar-dz ar-kw ar-ly ar-ma ar-sa ar-tn bs ca cs da de de-at de-ch el en-au en-ca en-gb en-ie en-il en-nz es es-do es-us et fi fr fr-ca fr-ch he hi hr hu id it it-ch ja ko lt lv nb nl nl-be pl pt pt-br ro ru sl sr sr-cyrl sv th tr uk vi zh-cn zh-hk zh-tw".split(" "));b.loadMoment=function(b){void 0===b&&(b=a.getLocale());return l(this,void 0,void 0,function(){var a,e,c;return k(this,function(d){switch(d.label){case 0:return[4,
new Promise(function(a,b){n(["moment/moment"],a,b)})];case 1:return a=d.sent(),e=g.has(b),e||(c=b.split("-"),1<c.length&&g.has(c[0])&&(b=c[0],e=!0)),e?[4,new Promise(function(a,c){n(["moment/locale/"+b],a,c)})]:[3,3];case 2:return d.sent(),[3,4];case 3:b="en",d.label=4;case 4:return b!==a.locale()&&a.locale(b),[2,a]}})})}})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(n,
b,l,k){return function(b){function a(a){a=b.call(this,a)||this;a.centerPointInElevationSR=null;return a}l(a,b);return a}(k)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(n,b,l,k){return function(){function b(a){a?this.set(a):this.setDefaults()}Object.defineProperty(b.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0});b.prototype.setUnit=function(a){this._unit=a;this._metersPerElevationInfoUnit=l.getMetersPerUnit(a)};b.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.setUnit("meters")};b.prototype.set=function(a){this.mode=a.mode;this._meterUnitOffset=a._meterUnitOffset||0;this._renderUnitOffset=a._renderUnitOffset||
0;this.featureExpressionInfoContext=a.featureExpressionInfoContext;this.setUnit(a.unit)};b.prototype.setOffsetMeters=function(a){this._meterUnitOffset=a;this._renderUnitOffset=0};b.prototype.setOffsetElevationInfoUnits=function(a){this._meterUnitOffset=a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};b.prototype.addOffsetRenderUnits=function(a){this._renderUnitOffset+=a};b.prototype.mixinApi=function(a){null!=a.mode&&(this.mode=a.mode);null!=a.unit&&this.setUnit(a.unit);null!=a.offset&&
this.setOffsetElevationInfoUnits(a.offset)};b.prototype.calculateOffsetRenderUnits=function(a){var b=this._meterUnitOffset,e=this.featureExpressionInfoContext;null!=e&&(b+=k.execute(e)*this._metersPerElevationInfoUnit);return b/a.unitInMeters+this._renderUnitOffset};return b}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ./ElevationContext ./featureExpressionInfoUtils ./Graphics3DSymbolCommonCode ./graphicUtils ./Loadable ./symbolComplexity".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m){function v(a,b){a=null!=a?b.attributes[a]:0;return null!=a&&isFinite(a)?a:0}Object.defineProperty(b,"__esModule",{value:!0});var z=new t,B=d.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");n=function(b){function d(a,c,d,e){var f=b.call(this)||this;f.complexity=null;f.logger=B;f._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};f.symbol=a;f.symbolLayer=c;f._context=d;f._symbolLayerOrder=d.layerOrder;f._symbolLayerOrderDelta=
d.layerOrderDelta;f._elevationContext=new t;f._material=null;f.complexity=f.computeComplexity();f._geometryCreationWarningHandle=null;f._updateDrivenProperties(e);f._updateElevationContext();f._logWarning;return f}l(d,b);d.prototype.getCachedSize=function(){return null};d.prototype._logWarning=function(a){B.warn(a)};d.prototype._logGeometryCreationWarnings=function(a,b,c,d){var e=this;if(null==this._geometryCreationWarningHandle){var f=a.geometryData&&a.geometryData.polygons;d+=" geometry failed to be created";
var g=null;a.projectionSuccess?!b.length||1===b.length&&!b[0].length?g=d+" (no "+c+" were defined)":Array.isArray(b)&&Array.isArray(b[0])?b.some(function(a){return 1===a.length})?g=d+" ("+c+" should contain at least 2 vertices)":f&&0===f.length&&"rings"===c&&(g=d+" (filled "+c+" should use clockwise winding - try reversing the order of vertices)"):g=d+" ("+c+" should be defined as a 2D array)":g=d+" (failed to project geometry to view spatial reference)";g&&(this._geometryCreationWarningHandle=q.schedule(function(){return e._onNextTick()}),
B.warn(g))}};d.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null};d.prototype._validateGeometryType=function(a,b,c){if(g.includes(b,a.type))return!0;this.logger.warn("unsupported geometry type for "+c+(" symbol: "+a.type));return!1};d.prototype._validateGeometry=function(a){return"point"!==a.type||f.isFinite(a.x)&&f.isFinite(a.y)?!0:(B.warn("point coordinate is not a valid number, graphic skipped"),!1)};d.prototype._defaultElevationInfoNoZ=function(){return C};d.prototype._defaultElevationInfoZ=
function(){return D};d.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();var a=this._context.layer.elevationInfo;a&&this._elevationContext.mixinApi(a);this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext};d.prototype.getDefaultElevationInfo=function(a){return a.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};d.prototype.getGeometryElevationMode=function(a,b){void 0===b&&(b=this.getDefaultElevationInfo(a));
return this._elevationContext.mode||b.mode};d.prototype.getGraphicElevationContext=function(a){var b=c.expect(a.geometry),d=this.getDefaultElevationInfo(b);z.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:d.unit);z.mode=this.getGeometryElevationMode(b,d);z.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:d.offset);z.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;this._elevationOptions.supportsOnTheGround||
"on-the-ground"!==z.mode||(z.mode="relative-to-ground",z.setOffsetMeters(0),z.featureExpressionInfoContext=x.zeroContext);a=x.createFeature(a,this._context.layer);x.setContextFeature(z.featureExpressionInfoContext,a);return z};d.prototype.prepareSymbolLayerPatch=function(a){};d.prototype.updateGeometry=function(a,b){return!1};d.prototype.onRemoveGraphic=function(a){};d.prototype._getDrapedZ=function(){return-2};d.prototype._updateDrivenProperties=function(a){var b={color:!1,opacity:!1,size:!1};a||
(a=this._context.renderer)&&"visualVariables"in a&&a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":b.color=!0;if(a.stops)for(var c=0;c<a.stops.length;c++){var d=a.stops[c].color;d&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0)}break;case "opacity":b.opacity=!0;break;case "size":b.size=!0}});this._drivenProperties=b};d.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};d.prototype._getLayerOpacity=function(){if(this._context.layerView&&
"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};d.prototype._getCombinedOpacity=function(a,b){void 0===b&&(b=K);var d;d=1*this._getLayerOpacity();if(this._isPropertyDriven("opacity"))return d;c.isSome(a)?d*=a.a:b.hasIntrinsicColor||(d=0);return d};d.prototype._getCombinedOpacityAndColor=function(b,d){void 0===d&&(d=K);d=this._getCombinedOpacity(b,d);if(this._isPropertyDriven("color"))return u.mixinColorAndOpacity(null,
d);b=c.isSome(b)?a.toUnitRGB(b):p.vec3f64.ONES;return u.mixinColorAndOpacity(b,d)};d.prototype._getVertexOpacityAndColor=function(a,b,c){var d=this._isPropertyDriven("color")?a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;d=u.mixinColorAndOpacity(d,a);c&&(d[0]*=c,d[1]*=c,d[2]*=c,d[3]*=c);return b?new b(d):d};d.prototype._getIdHint=function(a){void 0===a&&(a="");return this._context.layer.id+"_symbol"+a};d.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};
d.prototype.updateSymbolLayerOrder=function(a,b){this._symbolLayerOrder=a;this._symbolLayerOrderDelta=b};d.prototype.computeComplexity=function(){return m.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};d.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a,c.add(this._material.id))};d.prototype.destroy=function(){this.abortLoad();this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=
null)};d.prototype.globalPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged(b,c);case "elevationInfo":return a=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(b,c,a)===w.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(b,c);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged(b,c);case "pixelRatio":return this.pixelRatioChanged(b,c);default:return e.neverReachedSilent(a),
!1}};d.prototype.updateGraphics3DGraphicElevationInfo=function(a,b,d){var e=this,f=w.SymbolUpdateType.UPDATE;a.forEach(function(a){var g=b(a);c.isSome(g)?(a=e.getGraphicElevationContext(a.graphic),g.needsElevationUpdates=d(a.mode),g.elevationContext.set(a)):f=w.SymbolUpdateType.RECREATE});return f};d.prototype.applyRendererDiff=function(a,b){return!1};d.prototype.getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var b=this._fastUpdates.visualVariables,c=b.size?v(b.size.field,
a):0,d=b.color?v(b.color.field,a):0;a=b.opacity?v(b.opacity.field,a):0;return r.vec4f64.fromValues(c,d,a,0)};return d}(y.Loadable);b.Graphics3DSymbolLayer=n;b.getAttributeValue=v;var C={mode:"on-the-ground",offset:0,unit:"meters"},D={mode:"absolute-height",offset:0,unit:"meters"},K={hasIntrinsicColor:!1};b.default=n})},"esri/views/3d/layers/graphics/Loadable":function(){define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../../../core/promiseUtils"],
function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(){this._abortController=null;this._loadStatus=0;this.logger=this._loader=null}Object.defineProperty(a.prototype,"loadStatus",{get:function(){return this._loadStatus},enumerable:!0,configurable:!0});a.prototype.load=function(){return k(this,void 0,void 0,function(){var a=this;return l(this,function(b){this._loader||(this._abortController=h.createAbortController(),this._loader=this.doLoad(this._abortController.signal).then(function(){a._abortController=
null;a._loadStatus=1},function(b){a._abortController=null;a._loadStatus=2;!h.isAbortError(b)&&a.logger&&b.message&&a.logger.warn(b.message);throw b;}));return[2,this._loader]})})};a.prototype.abortLoad=function(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2);this._loader=null};return a}();b.Loadable=n})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(n,b,l,k,h,a,g,e,d){function f(a){for(var b=0,c=0,d=!1,e={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}},f=0;f<a.length;f++){var g=a[f];g&&(b+=g.primitivesPerFeature,c+=g.primitivesPerCoordinate,e.bytesPerFeature+=g.memory.bytesPerFeature,e.bytesPerFeatureLabel+=g.memory.bytesPerFeatureLabel,e.bytesPerCoordinate+=g.memory.bytesPerCoordinate,e.draped.bytesPerFeature+=g.memory.bytesPerFeature,e.draped.bytesPerFeatureLabel+=
g.memory.bytesPerFeatureLabel,e.draped.bytesPerCoordinate+=g.memory.bytesPerCoordinate,d=d||g.estimated)}return{primitivesPerFeature:b,primitivesPerCoordinate:c,estimated:d,memory:e}}function c(b,c){var d=q(b,c);switch(c.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,estimated:!1,memory:d};case "fill":return"mesh-3d"===b.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!1,memory:d}:h.isSome(c.outline)&&0<c.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,
estimated:!1,memory:d}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:d};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:d};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,estimated:!1,memory:d};case "object":return c.resource&&c.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,estimated:!0,memory:d}:l({},p(c.resource&&c.resource.primitive||a.defaultPrimitive),{memory:d});case "path":var e=b=0;switch(c.profile){case "circle":b=
10;break;case "quad":b=4;break;default:k.neverReached(c.profile);return}switch(c.join){case "round":e=3;break;case "miter":case "bevel":e=1;break;default:k.neverReached(c.join);return}var f=2*b,e=b*e*2,g=-2*e-f;switch(c.cap){case "none":break;case "butt":case "square":g+=2*(b-1);break;case "round":g+=2*(4*b+b);break;default:k.neverReached(c.cap);return}return{primitivesPerFeature:g,primitivesPerCoordinate:e+f,estimated:!1,memory:d};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,
estimated:!1,memory:d};default:k.neverReached(c)}}function q(a,c){a="point-3d"===a.type;switch(c.type){case "extrude":return c.edges&&0<c.edges.size?b.memoryEstimators.EXTRUDE_EDGES:b.memoryEstimators.EXTRUDE;case "fill":return h.isSome(c.outline)&&0<c.outline.size?b.memoryEstimators.FILL_OUTLINE:b.memoryEstimators.FILL;case "water":return b.memoryEstimators.FILL;case "line":return"round"===c.join?b.memoryEstimators.LINE_ROUND:b.memoryEstimators.LINE_MITER;case "path":switch(c.join){case "round":switch(c.profile){case "circle":return b.memoryEstimators.PATH_ROUND_CIRCLE;
case "quad":return b.memoryEstimators.PATH_ROUND_QUAD;default:k.neverReached(c.profile);return}case "miter":case "bevel":switch(c.profile){case "circle":return b.memoryEstimators.PATH_MITER_CIRCLE;case "quad":return b.memoryEstimators.PATH_MITER_QUAD;default:k.neverReached(c.profile);return}default:k.neverReached(c.join);return}case "object":return a?b.memoryEstimators.OBJECT_POINT:b.memoryEstimators.OBJECT_POLYGON;case "icon":case "text":return a?b.memoryEstimators.ICON_POINT:b.memoryEstimators.ICON_POLYGON;
default:k.neverReached(c)}}function p(a){var b=r[a];if(b)return b;b=g.primitiveLodResources(a,null,null);b={primitivesPerFeature:d.geometriesFromLodLevelResources(b.levels[0]).reduce(function(a,b){return a+b.data.getIndices(e.VertexAttrConstants.POSITION).length/3},0),primitivesPerCoordinate:0,estimated:!1};return r[a]=b}Object.defineProperty(b,"__esModule",{value:!0});b.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,
bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};b.defaultSymbolComplexity=function(a){if("web-style"===a.type)return b.emptySymbolComplexity;var d=a.symbolLayers.toArray().map(function(b){return c(a,b)});return f(d)};b.totalSymbolComplexities=f;var r={};b.defaultSymbolLayerComplexity=c;b.defaultSymbolLayerMemoryComplexity=q;b.memoryEstimators={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,
bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,
bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},
LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,
bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,
draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,
bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,
bytesPerCoordinate:374.3725221561312}}}})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});var g=k.fromValues(-.5,-.5,-.5,.5,.5,.5),e=k.fromValues(-.5,-.5,0,.5,.5,1),d=k.fromValues(-.5,-.5,0,.5,.5,.5);b.isValidPrimitive=function(a){switch(a){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};
b.primitiveBoundingBox=function(a){switch(a){case "sphere":case "cube":case "diamond":return g;case "cylinder":case "cone":case "inverted-cone":return e;case "tetrahedron":return d;default:l.neverReached(a)}};b.primitiveGeometryData=function(b){switch(b){case "sphere":return a.createPolySphereGeometry(.5,2,!0);case "cube":return a.createBoxGeometry(1);case "cylinder":return a.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return a.cgToGIS(a.createConeGeometry(1,.5,15,!1));case "inverted-cone":return a.cgToGIS(a.createConeGeometry(1,
.5,15,!0));case "tetrahedron":return a.cgToGIS(a.createTetrahedronGeometry(1));case "diamond":return a.cgToGIS(a.createDiamondGeometry(1));default:l.neverReached(b)}};b.primitiveLodResources=function(b,d,e){var c=function(b,c,f){void 0===f&&(f=!1);return{levels:b.map(function(b,g){var k=c(b.tesselation);f&&a.cgToGIS(k);return{components:[{geometry:new h(k,e+("_lod"+g)),material:d}],faceCount:k.indexCount/3,minScreenSpaceRadius:b.minScreenSpaceRadius}})}};switch(b){case "sphere":return c([{tesselation:0,
minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],function(b){return a.createPolySphereGeometry(.5,b,!0)});case "cube":return c([{tesselation:0,minScreenSpaceRadius:0}],function(b){return a.createBoxGeometry(1)});case "cone":return c(f,function(b){return a.createConeGeometry(1,.5,b,!1)},!0);case "inverted-cone":return c(f,function(b){return a.createConeGeometry(1,
.5,b,!0)},!0);case "cylinder":return c(f,function(b){return a.createCylinderGeometry(1,.5,b,[0,0,1],[0,0,.5])});case "tetrahedron":return c([{tesselation:0,minScreenSpaceRadius:0}],function(b){return a.createTetrahedronGeometry(1)},!0);case "diamond":return c([{tesselation:0,minScreenSpaceRadius:0}],function(b){return a.createDiamondGeometry(1)},!0);default:l.neverReached(b)}};var f=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]})},
"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),function(n,b,l,k,h,a,g,e){return function(){function b(a,c,d){this.singleUse=!1;this._componentAABBs=this._boundingInfo=null;this._id=b.__idGen.gen(c);this._data=a;this._boundingInfo=d}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"data",{get:function(){return this._data},
enumerable:!0,configurable:!0});b.prototype.getIndices=function(a){return this.data.getIndices(a)};Object.defineProperty(b.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});b.prototype.getAttribute=function(a){return this.data.getAttribute(a)};Object.defineProperty(b.prototype,"componentCount",{get:function(){return k.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this.data.componentOffsets},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"boundingInfo",{get:function(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo},enumerable:!0,configurable:!0});b.prototype.invalidateBoundingInfo=
function(){this._componentAABBs=this._boundingInfo=null};b.prototype.getComponentAABB=function(a,b){null==this._componentAABBs&&(this._componentAABBs=this._computeComponentAABBs());for(var c=0;6>c;c++)b[c]=this._componentAABBs[6*a+c];return b};b.prototype._computeComponentAABBs=function(){for(var a=this.componentCount,b=new Float32Array(6*a),d=0;d<a;d++)this._calculateAABB(d,b,6*d);return b};b.prototype._calculateAABB=function(a,b,d){var c=this.data.getIndices(e.VertexAttrConstants.POSITION),f=this.data.getAttribute(e.VertexAttrConstants.POSITION),
g=this.data.componentOffsets,h=g.length?g[a+1]:c.length,k=Infinity,q=Infinity,y=Infinity,m=-Infinity,v=-Infinity,l=-Infinity,B=f.offsetIdx,n=f.strideIdx;for(a=g.length?g[a]:0;a<h;a++)var D=B+n*c[a],g=f.data[D],K=f.data[D+1],D=f.data[D+2],k=Math.min(k,g),q=Math.min(q,K),y=Math.min(y,D),m=Math.max(m,g),v=Math.max(v,K),l=Math.max(l,D);b[d]=k;b[d+1]=q;b[d+2]=y;b[d+3]=m;b[d+4]=v;b[d+5]=l};b.prototype._calculateBoundingInfo=function(){var a=this.data.getIndices(e.VertexAttrConstants.POSITION),b=this.data.getAttribute(e.VertexAttrConstants.POSITION),
d="triangle"===this.data.primitiveType?3:1;if(0===a.length)for(var a=new Uint32Array(d),k=0;k<d;++k)a[k]=k;k=a.length;g.assert(0===k%d,"Indexing error: "+k.toFixed(0)+" not divisible by "+d.toFixed(0));k=h.generateDefaultIndexArray(k/d);return new l(k,d,a,b)};b.__idGen=new a.IdGen;return b}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Util".split(" "),
function(n,b,l,k,h,a){n=function(){function b(e,d,f,c){this.primitiveIndices=e;this._numIndexPerPrimitive=d;this.indices=f;this._position=c;this.center=h.vec3f64.create();a.assert(1<=e.length);a.assert(0===f.length%this._numIndexPerPrimitive);a.assert(f.length>=e.length*this._numIndexPerPrimitive);a.assert(3===this._position.size||4===this._position.size);c=this._position;d=c.data;var g=c.offsetIdx,p=c.strideIdx;c=0;var r=e.length,l=g+p*f[this._numIndexPerPrimitive*e[c]];b.tmpIndices.clear();b.tmpIndices.push(l);
this.bbMin=h.vec3f64.fromValues(d[l],d[l+1],d[l+2]);for(this.bbMax=h.vec3f64.clone(this.bbMin);c<r;++c)for(var x=this._numIndexPerPrimitive*e[c],w=0;w<this._numIndexPerPrimitive;++w){l=g+p*f[x+w];b.tmpIndices.push(l);var u=d[l];this.bbMin[0]=Math.min(u,this.bbMin[0]);this.bbMax[0]=Math.max(u,this.bbMax[0]);u=d[l+1];this.bbMin[1]=Math.min(u,this.bbMin[1]);this.bbMax[1]=Math.max(u,this.bbMax[1]);u=d[l+2];this.bbMin[2]=Math.min(u,this.bbMin[2]);this.bbMax[2]=Math.max(u,this.bbMax[2])}k.vec3.lerp(this.center,
this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);e=this.bsRadius*this.bsRadius;for(c=0;c<b.tmpIndices.length;++c)l=b.tmpIndices.data[c],f=d[l]-this.center[0],g=d[l+1]-this.center[1],l=d[l+2]-this.center[2],p=f*f+g*g+l*l,p<=e||(p=Math.sqrt(p),r=.5*(p-this.bsRadius),this.bsRadius+=r,e=this.bsRadius*this.bsRadius,p=r/p,this.center[0]+=f*p,this.center[1]+=g*p,this.center[2]+=l*p);b.tmpIndices.clear()}b.prototype.getCenter=
function(){return this.center};b.prototype.getBSRadius=function(){return this.bsRadius};b.prototype.getBBMin=function(){return this.bbMin};b.prototype.getBBMax=function(){return this.bbMax};b.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};b.prototype.getIndices=function(){return this.indices};b.prototype.getPosition=function(){return this._position};b.prototype.getChildren=function(){if(this._children)return this._children;if(1<k.vec3.squaredDistance(this.bbMin,this.bbMax)){for(var a=
k.vec3.lerp(h.vec3f64.create(),this.bbMin,this.bbMax,.5),d=this.primitiveIndices.length,f=new Uint8Array(d),c=Array(8),g=0;8>g;++g)c[g]=0;for(var g=this._position,p=g.data,r=g.offsetIdx,l=g.strideIdx,g=0;g<d;++g){for(var x=0,w=this._numIndexPerPrimitive*this.primitiveIndices[g],u=r+l*this.indices[w],y=p[u],m=p[u+1],v=p[u+2],z=1;z<this._numIndexPerPrimitive;++z){var u=r+l*this.indices[w+z],B=p[u],n=p[u+1],u=p[u+2];B<y&&(y=B);n<m&&(m=n);u<v&&(v=u)}y<a[0]&&(x|=1);m<a[1]&&(x|=2);v<a[2]&&(x|=4);f[g]=x;
++c[x]}for(g=a=0;8>g;++g)0<c[g]&&++a;if(2>a)return;a=Array(8);for(g=0;8>g;++g)a[g]=0<c[g]?new Uint32Array(c[g]):void 0;for(g=0;8>g;++g)c[g]=0;for(g=0;g<d;++g)x=f[g],a[x][c[x]++]=this.primitiveIndices[g];this._children=Array(8);for(g=0;8>g;++g)void 0!==a[g]&&(this._children[g]=new b(a[g],this._numIndexPerPrimitive,this.indices,this._position))}return this._children};return b}();(n||(n={})).tmpIndices=new l({deallocator:null});return n})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require",
"exports","../../../../../core/arrayUtils"],function(n,b,l){function k(b){var a=[];b.components.forEach(function(b){a.push(b.geometry)});return l.unique(a)}Object.defineProperty(b,"__esModule",{value:!0});b.materialsFromLodResources=function(b){var a=[];b.levels.forEach(function(b){b.components.forEach(function(b){a.push(b.material)})});return l.unique(a)};b.texturesFromLodResources=function(b){var a=[];b.levels.forEach(function(b){b.components.forEach(function(b){b.textures&&a.push.apply(a,b.textures)})});
return l.unique(a)};b.geometriesFromLodLevelResources=k;b.geometriesFromLodResources=function(b){var a=[];b.levels.forEach(function(b){b.components.forEach(function(b){a.push(b.geometry)})});return l.unique(a)};b.computeFaceCount=function(b){var a=0;k(b).forEach(function(b){a+=b.data.indexCount/3});return a}})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/LineCalloutPrograms ../../../webgl/renderState".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){function r(a,b,c){3===c.length?a.setUniform4f(b,c[0],c[1],c[2],1):a.setUniform4fv(b,c)}n=function(a){function b(c,d){d=a.call(this,d)||this;d.params=f.copyParameters(c,x);d._uniqueMaterialIdentifier=b.uniqueMaterialIdentifier(d.params);return d}l(b,a);Object.defineProperty(b.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});b.prototype.dispose=function(){};b.prototype.getGLMaterials=function(){return{color:t,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};b.prototype.intersect=function(a,b,c,d,e,f,g,h){};b.prototype.createBufferWriter=function(){return new y};b.prototype.createRenderer=function(a,b){return new c(a,b,this)};b.prototype.setParameterValues=function(a){f.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=b.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};b.prototype.getParameters=function(){return this.params};b.uniqueMaterialIdentifier=
function(a){return JSON.stringify({screenOffset:a.screenOffset||[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};return b}(g.Material);var t=function(a){function b(b){b=a.call(this,b)||this;b.isRenderSlot=!0;b.updateParameters();return b}l(b,a);b.prototype.updateParameters=function(){this.params=f.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getProgram(q.program,{occlTest:!!a.occlusionTest,
verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,depthHud:!1,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.depthProgram=this.programRep.getProgram(q.program,{occlTest:!!a.occlusionTest,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});
this.renderPipelineState=p.makePipelineState({blending:p.separateBlendingParams(1,770,771,771),depthTest:{func:513},colorWrite:p.defaultColorWriteParams});this.depthPipelineState=p.makePipelineState({depthTest:{func:513},depthWrite:p.defaultDepthWriteParams})};b.prototype.beginSlot=function(a){switch(a){case 18:return this.isRenderSlot=!0;case 19:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(b.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},
enumerable:!0,configurable:!0});b.prototype.getProgram=function(){return this.program};b.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]};b.prototype.getDrawMode=function(){return 4};b.prototype.bind=function(a,b){var c=b.cameraAboveGround?1:-1,d=this.program,e=this.params;a.bindProgram(d);d.setUniform1f("cameraGroundRelative",c);d.setUniform1f("polygonOffset",e.shaderPolygonOffset);d.setUniform4fv("viewport",b.viewport);d.setUniform1f("perDistancePixelRatio",Math.tan(b.fovY/
2)/(b.viewport[2]/2));d.setUniformMatrix4fv("viewNormal",b.viewInvTransp);d.setUniform1i("hudVisibilityTexture",0);a.bindTexture(b.hudVisibilityTexture,0);r(d,"color",e.color);c=b.pixelRatio||1;d.setUniform1f("pixelRatio",c);d.setUniform2f("screenOffset",e.screenOffset[0]*c,e.screenOffset[1]*c);this.bindBorder(a,b);f.bindVerticalOffset(e.verticalOffset,b,d);this.bindSizing(a,b);f.bindScreenSizePerspective(e.screenSizePerspective,d);this.isRenderSlot?a.setPipelineState(this.renderPipelineState):a.setPipelineState(this.depthPipelineState)};
b.prototype.bindView=function(a,b){a=this.program;var c=this.params;f.bindView(b.origin,b.view,a);f.bindCamPos(b.origin,b.viewInvTransp,a);c.slicePlaneEnabled&&f.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.release=function(a,b){};b.prototype.bindSizing=function(a,b){a=this.program;var c=this.params;a.setUniform2f("pixelToNDC",2/
b.viewport[2],2/b.viewport[3]);a.setUniform1f("lineSize",Math.ceil(c.size)*(b.pixelRatio||1))};b.prototype.bindBorder=function(a,b){a=this.program;var c=this.params;b=b.pixelRatio||1;null!==c.borderColor?(r(a,"borderColor",c.borderColor),a.setUniform1f("borderSize",b)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return b}(a),x={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,
depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},w=h.newLayout().vec3f(e.VertexAttrConstants.POSITION).vec3f(e.VertexAttrConstants.NORMAL).vec2f(e.VertexAttrConstants.UV0).vec4f(e.VertexAttrConstants.AUXPOS1),u=[k.vec2f32.fromValues(0,0),k.vec2f32.fromValues(1,0),k.vec2f32.fromValues(0,1),k.vec2f32.fromValues(1,0),k.vec2f32.fromValues(1,1),k.vec2f32.fromValues(0,1)],y=function(){function a(){this.vertexBufferLayout=w}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return 6*a.indices[e.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,f){d.writePosition(b.indices[e.VertexAttrConstants.POSITION],b.vertexAttr[e.VertexAttrConstants.POSITION].data,a.transformation,c.position,f,6);d.writeNormal(b.indices[e.VertexAttrConstants.NORMAL],b.vertexAttr[e.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,c.normal,f,6);d.writeBufferVec4(b.indices[e.VertexAttrConstants.AUXPOS1],b.vertexAttr[e.VertexAttrConstants.AUXPOS1].data,
c.auxpos1,f,6);for(a=0;a<u.length;++a)c.uv0.setVec(f+a,u[a])};return a}();return n})},"esri/core/libs/gl-matrix-2/vec2f32":function(){define(["require","exports","./factories/vec2f32"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec2f32=l})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["require","exports"],function(n,b){function l(){return new Float32Array(2)}function k(a,b){var d=new Float32Array(2);d[0]=a;d[1]=b;return d}function h(){return k(1,1)}function a(){return k(1,
0)}function g(){return k(0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.clone=function(a){var b=new Float32Array(2);b[0]=a[0];b[1]=a[1];return b};b.fromValues=k;b.createView=function(a,b){return new Float32Array(a,b,2)};b.zeros=function(){return l()};b.ones=h;b.unitX=a;b.unitY=g;b.ZEROS=l();b.ONES=h();b.UNIT_X=a();b.UNIT_Y=g()})},"esri/views/3d/webgl-engine/shaders/LineCalloutPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver",
"../../../webgl/programUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(a){return h.glslifyDefineMap({OCCL_TEST:a.occlTest,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,DEPTH_HUD:a.depthHud,DEPTH_HUD_ALIGN_START:a.depthHudAlignStart,CENTER_OFFSET_UNITS_SCREEN:a.centerOffsetUnitsScreen,SLICE:a.slice})};b.program={name:"line-callout",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/lineCallout/lineCallout.vert"),
fragmentShader:a(b)+k.resolveIncludes("materials/lineCallout/lineCallout.frag")}},attributes:l.Default3D}})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["require","exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.getGraphics3DSymbol=function(b){return b instanceof k?b.graphics3DSymbol:b instanceof l?b:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./Loadable ./symbolComplexity".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){return function(b){function r(a,c,d){var e=b.call(this)||this;e._symbol=a;e._context=c;e._backgroundLayers=d;e._destroyed=!1;e.symbolLayers=[];e.referenced=0;return e}l(r,b);Object.defineProperty(r.prototype,"symbol",{get:function(){return this._symbol},set:function(a){this._symbol=a;if(this.symbolLayers)for(var b=0;b<a.symbolLayers.length;b++){var c=this.symbolLayers[b];g.isNone(c)||(c.symbol=a,c.symbolLayer=a.symbolLayers.items[b])}},enumerable:!0,configurable:!0});
r.prototype.doLoad=function(b){return h(this,void 0,void 0,function(){var d,f,p,m,r,q,l=this;return k(this,function(v){switch(v.label){case 0:d=this._symbol.symbolLayers;this._backgroundLayers&&(d=this._backgroundLayers.concat(d));for(f=d.length;this.symbolLayers.length<d.length;)this.symbolLayers.push(null);this.symbolLayers.length=d.length;p=this._context.layerOrder;m=function(a){var g=d.getItemAt(a);if(!1===g.enabled)return"continue";r._context.layerOrder=p+(1-(1+a)/f);r._context.layerOrderDelta=
1/f;var h=c.make(r.symbol,g,r._context,g._ignoreDrivers);e.onAbortOrThrow(b,function(){return h.destroy()});r.symbolLayers[a]=h};r=this;for(q=0;q<f;q++)m(q);this._context.layerOrder=p;return[4,a.forEach(this.symbolLayers,function(a,b){return h(l,void 0,void 0,function(){return k(this,function(c){switch(c.label){case 0:if(!g.isSome(a))return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,a.load()];case 2:return c.sent(),[3,4];case 3:return c.sent(),this.symbolLayers[b]=null,[3,4];case 4:return[2]}})})})];
case 1:v.sent();if(this.symbolLayers.length&&!this.symbolLayers.some(function(a){return!!a}))throw Error();return[2]}})})};r.prototype.whenSymbolLayerSize=function(a){return h(this,void 0,void 0,function(){var b;return k(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.load()];case 1:return c.sent(),[3,3];case 2:return c.sent(),[3,3];case 3:return b=this.symbolLayers[a],[2,g.isSome(b)?b.getCachedSize():null]}})})};r.prototype.createGraphics3DGraphic=function(a,b){for(var c=
a.graphic,e=Array(this.symbolLayers.length),f=0;f<this.symbolLayers.length;f++){var h=this.symbolLayers[f];e[f]=g.isSome(h)?h.createGraphics3DGraphic(a):null}return new d(c,b||this,e,a.layer)};Object.defineProperty(r.prototype,"complexity",{get:function(){return p.totalSymbolComplexities(this.symbolLayers.map(function(a){return g.isSome(a)&&a.complexity}))},enumerable:!0,configurable:!0});r.prototype.globalPropertyChanged=function(a,b){for(var c=this.symbolLayers.length,d=function(c){var d=e.symbolLayers[c],
h=function(a){a=a._graphics[c];return a instanceof f?a:null};if(g.isSome(d)&&!d.globalPropertyChanged(a,b,h))return{value:!1}},e=this,h=0;h<c;h++){var k=d(h);if("object"===typeof k)return k.value}return!0};r.prototype.applyRendererDiff=function(a,b){return 1!==this.loadStatus?!1:this.symbolLayers.reduce(function(c,d,e){return c&&(g.isNone(d)||d.applyRendererDiff(a,b))},!0)};r.prototype.prepareSymbolPatch=function(a){if(2!==this.loadStatus&&"partial"===a.diff.type){var b=a.diff.diff;if(b.symbolLayers&&
"partial"===b.symbolLayers.type){var c=b.symbolLayers.diff;this.symbolLayers.forEach(function(b,d){var e;if(!g.isNone(b)){var f=c[d];if(f){var h={diff:f,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};b.prepareSymbolLayerPatch(h);(e=a.symbolStatePatches).push.apply(e,h.symbolLayerStatePatches);h.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push(function(a,b){var c=a._graphics[d];g.isSome(c)&&h.graphics3DGraphicPatches.forEach(function(a){return a(c,b)})})}}})}}};r.prototype.updateGeometry=
function(a,b){for(var c=0;c<this.symbolLayers.length;c++){var d=this.symbolLayers[c];if(!g.isNone(d)){var e=a._graphics[c];if(g.isSome(e)&&!d.updateGeometry(e,b))return!1}}return!0};r.prototype.onRemoveGraphic=function(a){for(var b=0;b<this.symbolLayers.length;b++){var c=this.symbolLayers[b];if(!g.isNone(c)){var d=a._graphics[b];if(g.isSome(d))c.onRemoveGraphic(d)}}};r.prototype.getFastUpdateStatus=function(){var a=0,b=0,c=0;this.symbolLayers.forEach(function(d){g.isNone(d)||(0===d.loadStatus?a++:
d.isFastUpdatesEnabled()?c++:b++)});return{loading:a,slow:b,fast:c}};r.prototype.setDrawOrder=function(a,b){for(var c=this.symbolLayers.length,d=1/c,e=0;e<c;e++){var f=this.symbolLayers[e];g.isSome(f)&&f.setDrawOrder(a+(1-(1+e)/c),d,b)}};r.prototype.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(var a=0,b=this.symbolLayers;a<b.length;a++){var c=b[a];g.isSome(c)&&c.destroy()}this.symbolLayers.length=0;this._destroyed=
!0}};Object.defineProperty(r.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0});return r}(q.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){var x=new g(Array,function(a){return f.set(a,f.ZERO)},null,10,5),w=c.create();return function(){function b(b,c,d,e){this._labelGraphics=[];this._auxiliaryGraphics=[];for(var f=Array(2),g=0;g<f.length;g++)f[g]=Array(4);this._visibilityFlags=f;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this.extent=null;this.isElevationSource=!1;++c.referenced;this.graphics3DSymbol=c;this.graphic=b;this._graphics=d;this._featureExpressionFeature=
r.createFeature(b,e);b=0;for(c=this._graphics;b<c.length;b++)d=c[b],a.isSome(d)&&(this.isElevationSource=this.isElevationSource||d.isElevationSource)}b.prototype.initialize=function(a,b){var c=this;this._layer=a;this._stage=b;this.forEachSymbolLayerGraphic(function(d){d.initialize(a,b);d.setVisibility(c.isVisible())})};b.prototype.destroy=function(){this.forEachSymbolLayerGraphic(function(a){return a.destroy()});this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=
null};Object.defineProperty(b.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!0,configurable:!0});b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};b.prototype.addLabelGraphic=function(a,b,c){this._labelGraphics.push(a);a.initialize(b,c);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._layer,this._stage),
a.setVisibility(this.isVisible()))};b.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){"draped"===b.type&&(a=!0)});return a};b.prototype.isVisible=function(a,b){void 0===a&&(a=0);for(var c=0;c<=a;c++)for(var d=this._visibilityFlags[c],e=0;e<d.length;++e)if(!1===d[e]&&e!==b)return!1;return!0};b.prototype.hasVisibilityFlag=function(a,b){return null!=this._visibilityFlags[b][a]};b.prototype.setVisibilityFlag=function(a,b,c){var d=this.isVisible(c);this._visibilityFlags[c][a]=
b;var e=this.isVisible(c);if(d===e)return!1;if(1===c)this.forEachLabelGraphic(function(a){return a.setVisibility(e)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(e)});var f=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(f)})}return!0};b.prototype.clearVisibilityFlag=function(a,b){void 0===b&&(b=0);return this.setVisibilityFlag(a,void 0,b)};b.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});
return a};b.prototype.getCenterObjectSpace=function(b){void 0===b&&(b=e.vec3f64.create());var c=this._graphics[0];return a.isSome(c)?c.getCenterObjectSpace(b):b};b.prototype.computeExtent=function(b){if(!this.extent){this.extent=c.create();var d=this.graphic.geometry;if(a.isNone(d))return this.extent=null,!1;var e=d.spatialReference;q.computeAABR(d,this.extent);if(!e.equals(b)&&!t.boundingRectToBoundingRect(this.extent,e,this.extent,b))return this.extent=null,!1}return!0};b.prototype.getAsOptimizedGeometry=
function(a,b){if(this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===a&&this._optimizedGeometry.hasM===b)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,a,b);this._optimizedGeometry.hasZ=a;this._optimizedGeometry.hasM=b;return this._optimizedGeometry.geometry};b.prototype._convertGraphicToOptimizedGeometry=function(a,b,c){a=a.geometry;if("mesh"===a.type||"extent"===a.type)a=d.fromExtent("mesh"===a.type?a.extent:
a);return p.convertFromGeometry(a,b,c)};Object.defineProperty(b.prototype,"usedMemory",{get:function(){var a=this,b=q.estimateAttributesObjectSize(this.graphic.attributes);this.forEachSymbolLayerGraphic(function(c){var d=c.graphics3DSymbolLayer.complexity;c="draped"===c.type?d.memory.draped:d.memory;b+=c.bytesPerFeature;c.bytesPerCoordinate&&(b+=q.numVertices(a.graphic.geometry)*c.bytesPerCoordinate)});return b},enumerable:!0,configurable:!0});b.prototype.getProjectedBoundingBox=function(b,d,e,g,
p){return k(this,void 0,void 0,function(){var m=this;return l(this,function(r){switch(r.label){case 0:return p||(p={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),p.boundingBox?f.empty(p.boundingBox):p.boundingBox=f.empty(),p.requiresDrapedElevation=!1,[4,h.forEach(this._graphics,function(c){return k(m,void 0,void 0,function(){var h,k,m;return l(this,function(r){switch(r.label){case 0:if(a.isNone(c))return[2];h="draped"===c.type?d:b;k=x.acquire();return[4,c.getProjectedBoundingBox(h,
e,p.screenSpaceObjects,g,k)];case 1:return m=r.sent(),isFinite(m[2])&&isFinite(m[5])||(p.requiresDrapedElevation=!0),m&&f.expand(p.boundingBox,k),x.release(k),[2]}})})})];case 1:return r.sent(),f.allFinite(p.boundingBox)||c.allFinite(f.toRect(p.boundingBox,w))?[2,p]:[2,null]}})})};b.prototype.needsElevationUpdates=function(){for(var b=0,c=this._graphics;b<c.length;b++){var d=c[b];if(a.isSome(d)&&("object3d"===d.type||"lod-instance"===d.type)&&d.needsElevationUpdates)return!0}b=0;for(c=this._labelGraphics;b<
c.length;b++)if((d=c[b])&&d.needsElevationUpdates)return!0;return!1};b.prototype.alignWithElevation=function(a,b,c){var d=this;this.forEachRenderedGraphic(function(e){"object3d"!==e.type&&"lod-instance"!==e.type||e.alignWithElevation(a,b,d._featureExpressionFeature,c)})};b.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(c){return c.addHighlight(a,b)})};b.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};b.prototype.forEachGraphicList=
function(a,b){a.forEach(function(a,c){return a&&b(a,c)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return b}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){Object.defineProperty(b,"__esModule",{value:!0});var p=l.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");b.make=function(a,b,c,d){var e=t[a.type]&&t[a.type][b.type]||r[b.type];return e?new e(a,b,c,d):(p.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var r={icon:h.default,object:e.default,line:a.default,path:d.default,fill:f.default,extrude:k.default,text:c.default,water:q.default};b.setSymbolClass=function(a,b){r[a]=
b};var t={"mesh-3d":{fill:g.default}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/renderingInfoUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/edgeUtils ../../support/projectionUtils ../../support/buffer/BufferView ../../support/buffer/math/vec3 ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L){function M(a,b,c,d,e,f,g,h,k,m,p,q,v,u){var y=c.length/3,l=0;p+=2*d.count;var w=d.index,x=d.count,t=k,z=p;r.vec3.copy(Y,v);var B=0<q?1:-1,w=3*w,n=t;v=3*n;for(var L=t+x,t=3*L,C=0;C<x;++C)u&&(Y[0]=a[w+0],Y[1]=a[w+1],Y[2]=a[w+2],r.vec3.normalize(Y,Y)),e[v+0]=a[w+0],e[v+1]=a[w+1],e[v+2]=a[w+2],f[v+0]=b[w+0],f[v+1]=b[w+1],f[v+2]=b[w+2],g[v+0]=-B*Y[0],g[v+1]=-B*Y[1],g[v+2]=-B*Y[2],h[n]=0,e[t+0]=a[w+0]+q*Y[0],e[t+1]=a[w+1]+q*Y[1],e[t+
2]=a[w+2]+q*Y[2],f[t+0]=b[w+0],f[t+1]=b[w+1],f[t+2]=b[w+2],g[t+0]=B*Y[0],g[t+1]=B*Y[1],g[t+2]=B*Y[2],h[L]=q,v+=3,t+=3,w+=3,n+=1,L+=1;w=0;v=3*z;t=3*(z+y);v=3*(z+y);t=3*z;a=X;b=P;0>q&&(a=P,b=X);for(C=0;C<y;++C)m[v+0]=c[w+a[0]],m[v+1]=c[w+a[1]],m[v+2]=c[w+a[2]],m[t+0]=c[w+b[0]]+x,m[t+1]=c[w+b[1]]+x,m[t+2]=c[w+b[2]]+x,v+=3,t+=3,w+=3;k+=2*d.count;p=p+2*y-(2*d.count+2*y);S(e,f,h,g,l,d.pathLengths[0],d.count,k,m,p,q);k+=4*d.pathLengths[0];p+=2*d.pathLengths[0];l+=d.pathLengths[0];for(c=1;c<d.pathLengths.length;++c)S(e,
f,h,g,l,d.pathLengths[c],d.count,k,m,p,q),k+=4*d.pathLengths[c],p+=2*d.pathLengths[c],l+=d.pathLengths[c]}function R(a,b,c,d,e,f,g){d[f]=d[g];g*=3;f*=3;a[f+0]=a[g+0];a[f+1]=a[g+1];a[f+2]=a[g+2];b[f+0]=b[g+0];b[f+1]=b[g+1];b[f+2]=b[g+2];c[f+0]=e[0];c[f+1]=e[1];c[f+2]=e[2]}function S(a,b,c,d,e,f,g,h,k,m,p){var q=e,v=e+1,u=e+g,y=e+g+1,l=h,w=h+1,x=h+2*f;h=h+2*f+1;0>p&&(q=e+g+1,y=e);m*=3;for(var t=0;t<f;++t){t===f-1&&(0<p?(v=e,y=e+g):(v=e,q=e+g));var z=a,B=q,n=v,L=u,C=ca,B=3*B,n=3*n,L=3*L;r.vec3.set(da,
z[B++],z[B++],z[B++]);r.vec3.set(F,z[n++],z[n++],z[n++]);r.vec3.set(ea,z[L++],z[L++],z[L++]);r.vec3.subtract(la,F,da);r.vec3.subtract(ka,ea,da);r.vec3.cross(C,ka,la);r.vec3.normalize(C,C);R(a,b,d,c,ca,l,q);R(a,b,d,c,ca,w,v);R(a,b,d,c,ca,x,u);R(a,b,d,c,ca,h,y);k[m++]=l;k[m++]=x;k[m++]=h;k[m++]=l;k[m++]=h;k[m++]=w;q++;v++;u++;y++;l+=2;w+=2;x+=2;h+=2}}function T(a,b,c,d){a=a.stageObject;V.spatialReference=c.spatialReference;for(var e=a.geometryRecords,f=e.length,g="absolute-height"!==b.mode,h=0,k=a.objectTransformation,
m=q.mat4.invert(p.mat4f64.create(),k),v=0;v<f;v++){var u=e[v].geometry;u.invalidateBoundingInfo();for(var l=u.data.getVertexAttr(),u=l[J.VertexAttrConstants.POSITION].data,w=l[J.VertexAttrConstants.SIZE].data,l=l.mapPos.data,x=u.length/3,t=0,z=0,B=!1,n=0,L=0;L<x;L++){V.x=l[z];V.y=l[z+1];V.z=l[z+2];oa[0]=u[t];oa[1]=u[t+1];oa[2]=u[t+2];var C=y.computeElevation(c,V,b,d,g?Z:null);g&&(n+=Z.terrainElevation);r.vec3.set(U,u[t+0],u[t+1],u[t+2]);r.vec3.transformMat4(U,U,k);d.setAltitude(C+w[t/3],U);r.vec3.transformMat4(U,
U,m);u[t]=U[0];u[t+1]=U[1];u[t+2]=U[2];C=.01/d.unitInMeters;if(Math.abs(oa[0]-u[t])>C||Math.abs(oa[1]-u[t+1])>C||Math.abs(oa[2]-u[t+2])>C)B=!0;z+=3;t+=3}B&&a.geometryVertexAttrsUpdated(v);h+=n/x}return h/f}Object.defineProperty(b,"__esModule",{value:!0});var U=t.vec3f64.create(),Y=t.vec3f64.create(),X=[0,2,1],P=[0,1,2],V=x.makeDehydratedPoint(0,0,0,null),Z={verticalDistanceToGround:0,terrainElevation:0};n=function(b){function m(a,c,d,e){return b.call(this,a,c,d,e)||this}l(m,b);m.prototype.doLoad=
function(){return h(this,void 0,void 0,function(){var b,c,d,f,h,m;return k(this,function(k){if(!this._isPropertyDriven("size")&&(b=v.validateSymbolLayerSize(this._getSymbolSize())))throw new g("graphics3dextrudesymbollayer:invalid-size",b);c=e.get(this.symbolLayer,"material","color");d=this._getCombinedOpacityAndColor(c);f=t.vec3f64.fromArray(d);h=d[3];m={diffuse:f,ambient:f,opacity:h,transparent:1>h||this._isPropertyDriven("opacity"),vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows};this._material=new N(a({},m,L.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled),{offsetTransparentBackfaces:!0}),this._getIdHint("_3dlinemat"));this._context.stage.add(3,this._material);return[2]})})};m.prototype.destroy=function(){b.prototype.destroy.call(this);this._material&&this._context.stage.remove(3,this._material.id)};m.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,
m.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,d=this._getVertexOpacityAndColor(a.renderingInfo,Float32Array,255),e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,e,c,b.uid)};m.prototype.layerOpacityChanged=function(a,b){var c=this,d=e.get(this.symbolLayer,"material","color"),d=this._getCombinedOpacity(d),f=1>d||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:d,transparent:f});
var g=this._getLayerOpacity();a.forEach(function(a){a=b(a);e.isSome(a)&&a.layerOpacityChanged(g,c._context.isAsync)});return!0};m.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,y.needsElevationUpdates3D)};m.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});a.forEach(function(a){a=b(a);e.isSome(a)&&a.slicePlaneEnabledChanged(c._context.slicePlaneEnabled,
c._context.isAsync)});return!0};m.prototype.physicalBasedRenderingChanged=function(a,b){this._material.setParameterValues(L.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled));return!0};m.prototype.pixelRatioChanged=function(a,b){return!0};m.prototype._getExtrusionSize=function(a){a=a.size&&this._isPropertyDriven("size")?w.getDriverAxisSizeValue(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};m.prototype._getSymbolSize=function(){return this.symbolLayer.size||
1};m.prototype._createAs3DShape=function(a,b,g,h,k,m){var r=y.getGeometryAsPolygon(a.geometry);a=r.rings;var l=[],w=[],x=[],z=Array(6),n=this._context.renderSpatialReference===B.SphericalECEFSpatialReference,L=this._getExtrusionSize(b),R=t.vec3f64.create();n||this._context.renderCoordsHelper.worldUpAtPosition(null,R);b=y.getGeometryVertexData3D(a,r.hasZ,r.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,h);this._logGeometryCreationWarnings(b,
a,"rings","ExtrudeSymbol3DLayer");if(0===a.length||!a.some(function(a){return 0<a.length}))return null;var N=v.computeCentroid(r);if(e.isNone(N))return null;a=p.mat4f64.create();B.computeLinearTransformation(r.spatialReference,[N.x,N.y,0],a,this._context.renderSpatialReference);var S=p.mat4f64.create();q.mat4.invert(S,a);var J=c.mat3f64.create();f.mat3.normalFromMat4(J,S);for(var I=b.geometryData.polygons,Z=b.eleVertexData,V=b.vertexData,r=V.length/3,P=new Float64Array(18*r),U=new Float64Array(18*
r),F=new Float64Array(18*r),X=new Float64Array(6*r),ca=0,r=function(a){var b=I[a],c=b.count,e=b.index;if(ia._context.clippingExtent&&(y.computeBoundingBox(Z,e,c,z),y.boundingBoxClipped(z,ia._context.clippingExtent)))return"continue";var f=new Float64Array(Z.buffer,3*e*P.BYTES_PER_ELEMENT,3*c),h=b.holeIndices.map(function(a){return a-e}),f=d(f,h,3);if(0===f.length)return"continue";var h=new Uint32Array(6*c+2*f.length),m=6*c,r=3*P.BYTES_PER_ELEMENT,r=new C.BufferViewVec3f64(P.buffer,ca*r,r,(ca+m)*r),
q=3*U.BYTES_PER_ELEMENT,q=new C.BufferViewVec3f64(U.buffer,ca*q,q,(ca+m)*q),v=new Float64Array(F.buffer,3*ca*F.BYTES_PER_ELEMENT,3*m),m=new Float64Array(X.buffer,1*ca*X.BYTES_PER_ELEMENT,1*m);M(V,Z,f,b,r.typedBuffer,v,q.typedBuffer,m,0,h,0,L,R,n);D.transformMat4(r,r,S);D.transformMat3(q,q,J);ca+=6*c;b=ia._createExtrudeGeometry(h,{positions:r.typedBuffer,elevation:v,normals:q.typedBuffer,heights:m},g);a=new K(b,k+"path"+a);a.singleUse=!0;l.push(a);w.push(ia._material);x.push(p.mat4f64.create())},ia=
this,N=0;N<I.length;++N)r(N);if(0===l.length)return null;m=new Q({geometries:l,materials:w,transformations:x,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:m,isElevationSource:!0},idHint:k});m.objectTransformation=a;a=this._createEdgeMaterial();a=e.isSome(a)?{baseMaterial:this._material,edgeMaterials:[a],slicePlaneEnabled:this._context.slicePlaneEnabled}:null;m=new u(this,m,l,null,null,T,h,a);m.alignedTerrainElevation=b.terrainElevation;m.needsElevationUpdates=y.needsElevationUpdates3D(h.mode);
return m};m.prototype._createExtrudeGeometry=function(a,b,c){for(var d=a.length,e=new Uint32Array(d),f=0;f<d;f++)e[f]=0;d={};f={};d[J.VertexAttrConstants.POSITION]=a;d[J.VertexAttrConstants.NORMAL]=a;d[J.VertexAttrConstants.COLOR]=e;f[J.VertexAttrConstants.POSITION]={size:3,data:b.positions};f[J.VertexAttrConstants.NORMAL]={size:3,data:b.normals};f[J.VertexAttrConstants.COLOR]={size:4,data:c};f[J.VertexAttrConstants.SIZE]={size:1,data:b.heights};b.elevation&&(f.mapPos={size:3,data:b.elevation},d.mapPos=
a);return new I.GeometryData(f,d)};m.prototype._createEdgeMaterial=function(){var a={opacity:this._getLayerOpacity()};return z.createMaterial(this.symbolLayer,a)};m.validGeometryTypes=["polygon","extent"];return m}(m.default);b.Graphics3DExtrudeSymbolLayer=n;var ca=t.vec3f64.create(),da=t.vec3f64.create(),F=t.vec3f64.create(),ea=t.vec3f64.create(),la=t.vec3f64.create(),ka=t.vec3f64.create(),oa=t.vec3f64.create();b.default=n})},"esri/renderers/support/renderingInfoUtils":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Color ../../core/maybe ../visualVariables/support/visualVariableUtils ../../support/arcadeUtils".split(" "),
function(n,b,l,k,h,a,g,e,d){function f(a,b){if(!a||a.symbol)return null;b=b.renderer;return a&&b&&b.getObservationRenderer?b.getObservationRenderer(a):b}function c(a,b){if(g.isSome(a.symbol))return a.symbol;var c=f(a,b);return c&&c.getSymbol(a,l({},b,{arcadeUtils:d}))}function q(a,b){return h(this,void 0,void 0,function(){var c;return k(this,function(d){if(g.isSome(a.symbol))return[2,a.symbol];c=f(a,b);return[2,c&&c.getSymbolAsync(a,l({},b,{abortOptions:{signal:b.signal}}))]})})}Object.defineProperty(b,
"__esModule",{value:!0});b.getRenderer=f;b.getSymbol=c;b.getRenderingInfo=function(a,b){var d=f(a,b),g=c(a,b);if(!g)return null;g={renderer:d,symbol:g};if(!(d&&"visualVariables"in d&&d.visualVariables))return g;var h=["proportional","proportional","proportional"],k=0;for(a=e.getVisualVariableValues(d,a,b);k<a.length;k++){d=a[k];b=d.variable;var p=d.value;"color"===b.type?g.color=p.toRgba():"size"===b.type?"outline"===b.target?g.outlineSize=p:(d=b.axis,b=b.useSymbolValue?"symbolValue":p,"width"===
d?h[0]=b:"depth"===d?h[1]=b:"height"===d?h[2]=b:h[0]="width-and-depth"===d?h[1]=b:h[1]=h[2]=b):"opacity"===b.type?g.opacity=p:"rotation"===b.type&&"tilt"===b.axis?g.tilt=p:"rotation"===b.type&&"roll"===b.axis?g.roll=p:"rotation"===b.type&&(g.heading=p)}if(isFinite(h[0])||isFinite(h[1])||isFinite(h[2]))g.size=h;return g};b.getSymbolAsync=q;b.getRenderingInfoAsync=function(b,c){return h(this,void 0,void 0,function(){var d,g,h,p,r,m,v,l,B,n,D,K;return k(this,function(k){switch(k.label){case 0:return d=
f(b,c),[4,q(b,c)];case 1:g=k.sent();if(!g)return[2,null];h={renderer:d,symbol:g};if(!(d&&"visualVariables"in d&&d.visualVariables))return[2,h];p=e.getVisualVariableValues(d,b,c);r=["proportional","proportional","proportional"];m=0;for(v=p;m<v.length;m++)l=v[m],B=l.variable,n=l.value,"color"===B.type?h.color=a.toUnitRGBA(n):"size"===B.type?"outline"===B.target?h.outlineSize=n:(D=B.axis,K=B.useSymbolValue?"symbolValue":n,"width"===D?r[0]=K:"depth"===D?r[1]=K:"height"===D?r[2]=K:r[0]="width-and-depth"===
D?r[1]=K:r[1]=r[2]=K):"opacity"===B.type?h.opacity=n:"rotation"===B.type&&"tilt"===B.axis?h.tilt=n:"rotation"===B.type&&"roll"===B.axis?h.roll=n:"rotation"===B.type&&(h.heading=n);if(isFinite(r[0])||isFinite(r[1])||isFinite(r[2]))h.size=r;return[2,h]}})})};b.getDriverAxisSizeValue=function(a,b){void 0===b&&(b=0);a=a[b];return"number"===typeof a&&isFinite(a)?a:null}})},"esri/renderers/visualVariables/support/visualVariableUtils":function(){define("require exports ../../../Color ../../../Graphic ../../../core/Logger ../../support/utils ./sizeVariableUtils ../../../support/arcadeUtils".split(" "),
function(n,b,l,k,h,a,g,e){function d(a,b,c){if(a="visualVariables"in a&&a.visualVariables?a.visualVariables.filter(function(a){return"color"===a.type})[0]:a)if("esri.renderers.visualVariables.ColorVariable"!==a.declaredClass)u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");else{var d="number"===typeof b,f=d?null:b,g=f&&f.attributes,h=d?b:null,k=a.field,m=a.cache;b=m.ipData;var p=m.hasExpression,m=a.cache.compiledFunc;if(!k&&!p)return(c=a.stops)&&c[0]&&
c[0].color;"number"!==typeof h&&(p?(h=e.getViewInfo(c&&{viewingMode:c.viewingMode,scale:c.scale,spatialReference:c.spatialReference}),f=e.createExecContext(f,h),m||(h=e.createSyntaxTree(a.valueExpression),m=e.createFunction(h),a.cache.compiledFunc=m),h=e.executeFunction(m,f)):g&&(h=g[k]));f=a.normalizationField;g=g?parseFloat(g[f]):void 0;if(null!=h&&(!f||d||!isNaN(g)&&0!==g)&&(isNaN(g)||d||(h/=g),d=w(h,b)))return g=d[0],b=d[1],c=g===b?a.stops[g].color:l.blendColors(a.stops[g].color,a.stops[b].color,
d[2],c&&c.color),new l(c)}}function f(a,b,c){if(a="visualVariables"in a&&a.visualVariables?a.visualVariables.filter(function(a){return"opacity"===a.type})[0]:a)if("esri.renderers.visualVariables.OpacityVariable"!==a.declaredClass)u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");else{var d="number"===typeof b,f=d?null:b,g=f&&f.attributes,h=d?b:null,k=a.field,m=a.cache;b=m.ipData;var p=m.hasExpression,m=a.cache.compiledFunc;if(!k&&!p)return(a=a.stops)&&
a[0]&&a[0].opacity;"number"!==typeof h&&(p?(c=e.getViewInfo(c&&{viewingMode:c.viewingMode,scale:c.scale,spatialReference:c.spatialReference}),c=e.createExecContext(f,c),m||(f=e.createSyntaxTree(a.valueExpression),m=e.createFunction(f),a.cache.compiledFunc=m),h=e.executeFunction(m,c)):g&&(h=g[k]));c=a.normalizationField;g=g?parseFloat(g[c]):void 0;if(null!=h&&(!c||d||!isNaN(g)&&0!==g)&&(isNaN(g)||d||(h/=g),d=w(h,b))){b=d[0];g=d[1];if(b===g)return a.stops[b].opacity;b=a.stops[b].opacity;return b+(a.stops[g].opacity-
b)*d[2]}}}function c(a,b,c){if(a="visualVariables"in a&&a.visualVariables?a.visualVariables.filter(function(a){return"rotation"===a.type})[0]:a)if("esri.renderers.visualVariables.RotationVariable"!==a.declaredClass)u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");else{var d=a.axis||"heading",f="heading"===d&&"arithmetic"===a.rotationType?90:0,d="heading"===d&&"arithmetic"===a.rotationType?-1:1,g="number"===typeof b?null:b,h=g&&g.attributes,k=a.field,
m=a.cache.hasExpression;b=a.cache.compiledFunc;var p=0;if(!k&&!m)return p;m?(c=e.getViewInfo(c&&{viewingMode:c.viewingMode,scale:c.scale,spatialReference:c.spatialReference}),c=e.createExecContext(g,c),b||(b=e.createSyntaxTree(a.valueExpression),b=e.createFunction(b),a.cache.compiledFunc=b),p=e.executeFunction(b,c)):h&&(p=h[k]||0);return p="number"!==typeof p||isNaN(p)?null:f+d*p}}function q(a,b,c){var d="number"===typeof b,f=d?null:b,h=f&&f.attributes,k=d?b:null;b=a.cache.compiledFunc;if(a.cache.isScaleDriven)f=
c&&c.scale,c=c&&c.view,null==f||c&&"3d"===c.type?(f=c=null,(f=a.stops)?(c=f[0].value,f=f[f.length-1].value):(c=a.minDataValue||0,f=a.maxDataValue||0),c=(c+f)/2):c=f,k=c;else if(!d)switch(a.inputValueType){case "expression":c=e.getViewInfo(c&&{viewingMode:c.viewingMode,scale:c.scale,spatialReference:c.spatialReference});c=e.createExecContext(f,c);b||(f=e.createSyntaxTree(a.valueExpression),b=e.createFunction(f),a.cache.compiledFunc=b);k=e.executeFunction(b,c);break;case "field":h&&(k=h[a.field]);break;
case "unknown":k=null}if(!g.isValidNumber(k))return null;if(d||!a.normalizationField)return k;a=h?parseFloat(h[a.normalizationField]):null;return g.isValidNumber(a)&&0!==a?k/a:null}function p(a,b,c){if(a="visualVariables"in a&&a.visualVariables?a.visualVariables.filter(function(a){return"size"===a.type})[0]:a)if("esri.renderers.visualVariables.SizeVariable"!==a.declaredClass)u.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");else{var d=q(a,b,c);b=x(d,
a,b,c,a.cache.ipData);return null===b||void 0===b||isNaN(b)?0:b}}function r(a,b,c){return null==a?null:g.isSizeVariable(a)?p(a,b,c):g.isValidNumber(a)?a:null}function t(a,b,c){return g.isValidNumber(c)&&a>c?c:g.isValidNumber(b)&&a<b?b:a}function x(b,c,d,e,f){switch(c.transformationType){case "additive":return e=r(c.minSize,d,e),b+(e||c.minDataValue);case "constant":return b=(b=c.stops)&&b.length&&b[0].size,null==b&&(b=c.minSize),r(b,d,e);case "clamped-linear":f=(b-c.minDataValue)/(c.maxDataValue-
c.minDataValue);var g=r(c.minSize,d,e);d=r(c.maxSize,d,e);e=e&&e.shape;b<=c.minDataValue?c=g:b>=c.maxDataValue?c=d:"area"===c.scaleBy&&e?(e=(c="circle"===e)?m*Math.pow(g/2,2):g*g,e+=f*((c?m*Math.pow(d/2,2):d*d)-e),c=c?2*Math.sqrt(e/m):Math.sqrt(e)):c=g+f*(d-g);return c;case "proportional":return f=e&&e.shape,b/=c.minDataValue,g=r(c.minSize,d,e),c=r(c.maxSize,d,e),e=null,e="circle"===f?2*Math.sqrt(b*Math.pow(g/2,2)):"square"===f||"diamond"===f||"image"===f?Math.sqrt(b*Math.pow(g,2)):b*g,t(e,g,c);case "stops":return f=
w(b,f),g=f[0],b=f[1],f=f[2],g===b?c=r(c.stops[g].size,d,e):(g=r(c.stops[g].size,d,e),c=r(c.stops[b].size,d,e),c=g+(c-g)*f),c;case "real-world-size":return f=(e&&e.resolution?e.resolution:1)*a.meterIn[c.valueUnit],g=r(c.minSize,d,e),e=r(c.maxSize,d,e),c=c.valueRepresentation,d=null,d="area"===c?2*Math.sqrt(b/m)/f:"radius"===c||"distance"===c?2*b/f:b/f,t(d,g,e);case "identity":return b;case "unknown":return null}}function w(a,b){if(b){var c=0,d=b.length-1;b.some(function(b,e){if(a<b)return d=e,!0;c=
e;return!1});return[c,d,(a-b[c])/(b[d]-b[c])]}}Object.defineProperty(b,"__esModule",{value:!0});var u=h.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),y=new k,m=Math.PI;b.getColor=d;b.getOpacity=f;b.getRotationAngle=c;b.getSize=p;b.getSizeFromNumberOrVariable=r;b.getSizeForValue=x;b.getSizeRangeAtScale=function(a,b,c){var d=c&&"3d"===c.type;if(!(a.cache.isScaleDriven&&d||b))return null;c={scale:b,view:c};b=r(a.minSize,y,c);a=r(a.maxSize,y,c);if(null!=b||null!=a)return b>a&&
(c=a,a=b,b=c),{minSize:b,maxSize:a}};b.getVisualVariableValues=function(a,b,e){if(a.visualVariables){var g=[],h=[],k=[],m=[],r=[],q=0;for(a=a.visualVariables;q<a.length;q++){var u=a[q];switch(u.type){case "color":h.push(u);break;case "opacity":k.push(u);break;case "rotation":r.push(u);break;case "size":m.push(u)}}h.forEach(function(a){var c=d(a,b,e);g.push({variable:a,value:c})});k.forEach(function(a){var c=f(a,b,e);g.push({variable:a,value:c})});r.forEach(function(a){var d=c(a,b,e);g.push({variable:a,
value:d})});m.forEach(function(a){var c=p(a,b,e);g.push({variable:a,value:c})});return g.filter(function(a){return null!=a.value})}}})},"esri/views/3d/layers/support/edgeUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),function(n,b,l,k,h,a,g,e){function d(b,c){if(a.isNone(b))return null;var d=a.isSome(b.color)?e.vec4f64.fromArray(k.toUnitRGBA(b.color)):
e.vec4f64.fromValues(0,0,0,0),p=g.pt2px(b.size),r=g.pt2px(b.extensionLength);switch(b.type){case "solid":return f(l({color:d,size:p,extensionLength:r},c));case "sketch":return l({},q,l({color:d,size:p,extensionLength:r},c),{type:"sketch"});default:h.neverReached(b)}}function f(a){return l({},c,a,{type:"solid"})}Object.defineProperty(b,"__esModule",{value:!0});b.createMaterial=function(a,b){return d(a&&a.enabled&&a.edges||null,b)};b.createMaterialFromEdges=d;b.createSolidEdgeMaterial=f;var c={color:e.vec4f64.fromValues(0,
0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},q={color:e.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2}})},"esri/views/3d/support/buffer/math/vec3":function(){define(["require","exports","./common"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.transformMat4=function(b,h,a){if(b.count!==h.count)l.logger.error("source and destination buffers need to have the same number of elements");else{var g=b.count,e=a[0],d=a[1],f=a[2],
c=a[4],k=a[5],p=a[6],r=a[8],t=a[9],x=a[10],w=a[12],u=a[13];a=a[14];var y=b.typedBuffer;b=b.typedBufferStride;var m=h.typedBuffer;h=h.typedBufferStride;for(var v=0;v<g;v++){var z=v*b,B=v*h,n=m[B],D=m[B+1],B=m[B+2];y[z]=e*n+c*D+r*B+w;y[z+1]=d*n+k*D+t*B+u;y[z+2]=f*n+p*D+x*B+a}}};b.transformMat3=function(b,h,a){if(b.count!==h.count)l.logger.error("source and destination buffers need to have the same number of elements");else{var g=b.count,e=a[0],d=a[1],f=a[2],c=a[3],k=a[4],p=a[5],r=a[6],t=a[7];a=a[8];
var x=b.typedBuffer;b=b.typedBufferStride;var w=h.typedBuffer;h=h.typedBufferStride;for(var u=0;u<g;u++){var y=u*b,m=u*h,v=w[m],z=w[m+1],m=w[m+2];x[y]=e*v+c*z+r*m;x[y+1]=d*v+k*z+t*m;x[y+2]=f*v+p*z+a*m}}};b.scale=function(b,h,a){var g=Math.min(b.count,h.count),e=b.typedBuffer;b=b.typedBufferStride;var d=h.typedBuffer;h=h.typedBufferStride;for(var f=0;f<g;f++){var c=f*b,k=f*h;e[c]=a*d[k];e[c+1]=a*d[k+1];e[c+2]=a*d[k+2]}}})},"esri/views/3d/support/buffer/math/common":function(){define(["require","exports",
"../../../../../core/Logger"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.logger=l.getLogger("esri.views.3d.support.buffer.math")})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/buffer/InterleavedLayout ../lib/GLMaterialTexture ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/InstancedRenderer ./renderers/MergedRenderer ../shaders/DefaultPrograms ../../../webgl/renderState".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y){function m(a,b){var c=b.vvSizeEnabled;b.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor)):c&&a.setUniform3fv("vvSizeValue",b.vvSizeValue);c&&(a.setUniform3fv("vvSymbolAnchor",b.vvSymbolAnchor),a.setUniformMatrix3fv("vvSymbolRotationMatrix",b.vvSymbolRotationMatrix));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",
b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors))}var v=q.assert;n=function(a){function b(c,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.params=t.copyParameters(c,I);d.vertexBufferLayout=b.getVertexBufferLayout(d.params);d.instanceBufferLayout=c.instanced?b.getInstanceBufferLayout(d.params):null;return d}l(b,a);b.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};b.prototype.isVisible=function(){var b=this.params;if(!a.prototype.isVisible.call(this)||
0===b.layerOpacity)return!1;var c=b.instanced,d=b.vertexColors,e=b.symbolColors,c=!!c&&-1<c.indexOf("color"),f=b.vvColorEnabled,g="replace"===b.colorMixMode,h=0<b.opacity,b=b.externalColor&&0<b.externalColor[3];return d&&(c||f||e)?g?!0:h:d?g?b:h:c||f||e?g?!0:h:g?b:h};b.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"instanced"===c&&v(a.instanced===b.instanced,"Can not change instanced attributes"),"textureId"===c&&v(b.textureId,"Can only change texture of material that already has a texture"),
"vertexColors"===c&&!0===a[c]&&a[c]!==b[c]&&v(b.vertexColors,"Can not enable vertex colors after DefaultMaterial creation"),b[c]=a[c];this.notifyDirty("matChanged")};b.prototype.getParameters=function(){return this.params};b.prototype.intersect=function(a,b,c,d,e,f,h,k){if(null!==this.params.verticalOffset){k=d.camera;g.vec3.set(T,c[12],c[13],c[14]);var m=g.vec3.subtract(U,T,k.eye);c=g.vec3.length(m);var p=g.vec3.scale(m,m,1/c),r=null,m=null;switch(d.viewingMode){case "global":m=g.vec3.normalize(R,
T);break;case "local":m=g.vec3.copy(R,M)}this.params.screenSizePerspective&&(r=g.vec3.dot(m,p));k=t.verticalOffsetAtDistance(k,c,this.params.verticalOffset,r,this.params.screenSizePerspective);g.vec3.scale(m,m,k);g.vec3.transformMat3(S,m,d.transform.inverseRotation);e=g.vec3.subtract(N,e,S);f=g.vec3.subtract(L,f,S)}t.intersectTriangleGeometry(a,b,d,e,f,h)};b.prototype.getGLMaterials=function(){return{color:z,depthShadowMap:C,normal:D,depth:B,highlight:K}};b.prototype.createRenderer=function(a,b){return this.params.softwareInstanced?
new x(a,b,this):new w(a,b,this)};b.prototype.createBufferWriter=function(){return new Q(this.vertexBufferLayout,this.instanceBufferLayout)};b.getVertexBufferLayout=function(a){var b=a.textureId||a.normalTextureId||a.metallicRoughnessTextureId||a.emissiveTextureId||a.occlusionTextureId,c=d.newLayout().vec3f("position").vec3f("normal");a.vertexTangents&&c.vec4f("aTangent");b&&c.vec2f("uv0");a.vertexColors&&c.vec4u8("color");a.symbolColors&&c.vec4u8("symbolColor");return c};b.getInstanceBufferLayout=
function(a){var b=d.newLayout(),b=a.instancedDoublePrecision?b.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):b.mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(b=b.vec4f("instanceColor"));a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(b=b.vec4f("instanceFeatureAttribute"));return b};return b}(c.Material);var z=function(a){function b(b){var c=this,d=b.material.getParameters(),c=a.call(this,f.makeCtorParameters(b,d))||
this;c.params=t.copyParameters(d);b=c.params;c.slot=b.transparent?b.writeDepth?7:10:5;b=b.instanced;c.instanced=!!b;c.instancedColor=!!b&&-1<b.indexOf("color");c._createPrograms();c.selectPipeline();return c}l(b,a);b.prototype._createPrograms=function(){var a=this;this.programs=r.BindParametersMap.create(this.params,function(b){return a._createProgram(b)})};b.prototype._createProgram=function(a){var b=this.params;return this.programRep.getProgram(u.colorPass,{treeRendering:!!b.treeRendering,normalTexture:!!b.normalTextureId,
colorTexture:!!b.textureId,tangents:b.vertexTangents?"vertex":"none",vertexColors:b.vertexColors,symbolColors:b.symbolColors,flipV:b.flipV,doubleSided:b.doubleSided&&"normal"===b.doubleSidedType,windowOrderDoubleSided:b.doubleSided&&"winding-order"===b.doubleSidedType,instanced:!!this.instanced,instancedDoublePrecision:b.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,verticalOffset:null!==
b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,sliceHighlightDisabled:b.sliceHighlightDisabled,normals:b.normals,textureAlphaMode:b.textureAlphaMode,textureAlphaPremultiplied:!!b.textureAlphaPremultiplied,requiresFloatOperationsFix:!!h("ios"),roughnessMetallnessTexture:!!b.metallicRoughnessTextureId,emissionTexture:!!b.emissiveTextureId,occlusionTexture:!!b.occlusionTextureId,usePBR:b.usePBR,offsetBackfaces:!(!b.transparent||!b.offsetTransparentBackfaces)})};
b.prototype.selectPipeline=function(){var a=this.params;this.pipelineState=y.makePipelineState({blending:a.transparent&&y.separateBlendingParams(770,1,771,771),culling:J(a),depthTest:{func:513},depthWrite:a.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};b.prototype.getPrograms=function(){return r.BindParametersMap.programs(this.programs)};
b.prototype.updateParameters=function(){this.params=t.copyParameters(this.material.getParameters());this.slot=this.params.transparent?this.params.writeDepth?7:10:5;this.updateTexture(this.params.textureId);this._createPrograms();this.selectPipeline()};b.prototype.bind=function(a,b){var c=this.params,d=this.program=r.BindParametersMap.lookup(this.programs,b);a.bindProgram(d);a.setPipelineState(this.pipelineState);d.setUniform3fv("ambient",c.ambient);d.setUniform3fv("diffuse",c.diffuse);d.setUniform3fv("specular",
c.specular);d.setUniform4fv("externalColor",c.externalColor);d.setUniform1i("colorMixMode",t.colorMixModes[c.colorMixMode]);c.usePBR&&(d.setUniform1f("metalnessFactor",c.metallicFactor),d.setUniform1f("roughnessFactor",c.roughnessFactor),d.setUniform3fv("emissionFactor",c.emissiveFactor),d.setUniform1f("reflectanceFactor",c.reflectanceFactor));d.setUniform1f("opacity",c.opacity);d.setUniform1f("layerOpacity",c.layerOpacity);t.bindVerticalOffset(c.verticalOffset,b,d);t.bindScreenSizePerspective(c.screenSizePerspective,
d);m(d,c);this.bindTexture(a,d);"mask"!==c.textureAlphaMode&&"maskBlend"!==c.textureAlphaMode||d.setUniform1f("textureAlphaCutoff",c.textureAlphaCutoff)};b.prototype.release=function(a,b){};b.prototype.bindView=function(a,b){a=this.program=r.BindParametersMap.lookup(this.programs,b);var c=this.params,d=c.instancedDoublePrecision?e.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;t.bindView(d,b.view,a);t.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&
t.bindViewOriginDouble(d,a);c.slicePlaneEnabled&&t.bindSlicePlane(d,b.slicePlane,a);b.shadowMappingEnabled&&b.shadowMap.bindView(a,d)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return 4};return b}(f),B=function(a){function b(b){var c=this,c=a.call(this,f.makeCtorParameters(b,b.material.getParameters()))||this;c.biased=!!b.biased;c.updateParameters();
return c}l(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(u.depthPass,{normalTexture:!!a.normalTextureId,colorTexture:!!a.textureId,tangents:a.vertexTangents?"vertex":"none",flipV:a.flipV,instanced:!!a.instanced,instancedDoublePrecision:a.instancedDoublePrecision,shadowMap:this.biased,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,
screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,textureAlphaMode:a.textureAlphaMode,normals:a.normals,requiresFloatOperationsFix:!!h("ios")});this.pipelineState=y.makePipelineState({culling:J(a),depthTest:{func:513},depthWrite:a.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?7:10:5};b.prototype.updateParameters=function(){this.params=t.copyParameters(this.material.getParameters());
this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);c.setUniform2fv("nearFar",b.nearFar);t.bindVerticalOffset(d.verticalOffset,b,c);t.bindScreenSizePerspective(d.screenSizePerspective,c);m(c,d);"mask"!==d.textureAlphaMode&&"maskBlend"!==d.textureAlphaMode||c.setUniform1f("textureAlphaCutoff",d.textureAlphaCutoff);this.bindTexture(a,c)};b.prototype.release=
function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?e.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;t.bindView(d,b.view,a);c.slicePlaneEnabled&&t.bindSlicePlane(d,b.slicePlane,a);c.screenSizePerspective&&t.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&t.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=
function(){return 4};return b}(f),C=function(a){function b(b){return a.call(this,k({},b,{biased:!0}))||this}l(b,a);return b}(B),D=function(a){function b(b){var c=this,d=b.material.getParameters(),c=a.call(this,f.makeCtorParameters(b,d))||this;c.params=t.copyParameters(d);c.selectProgram();c.selectSlot();return c}l(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(u.normalPass,
{normalTexture:!!a.normalTextureId,colorTexture:!!a.textureId,tangents:a.vertexTangents?"vertex":"none",flipV:a.flipV,instanced:!!a.instanced,instancedDoublePrecision:a.instancedDoublePrecision,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,textureAlphaMode:a.textureAlphaMode,normals:a.normals,requiresFloatOperationsFix:!!h("ios")});this.pipelineState=y.makePipelineState({culling:J(a),depthTest:{func:513},
depthWrite:a.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?7:10:5};b.prototype.updateParameters=function(){this.params=t.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);this.bindTexture(a,
c);t.bindVerticalOffset(d.verticalOffset,b,c);t.bindScreenSizePerspective(d.screenSizePerspective,c);m(c,d);"mask"!==d.textureAlphaMode&&"maskBlend"!==d.textureAlphaMode||c.setUniform1f("textureAlphaCutoff",d.textureAlphaCutoff)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?e.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;t.bindView(d,b.view,a);a.setUniformMatrix4fv("viewNormal",
b.viewInvTransp);c.slicePlaneEnabled&&t.bindSlicePlane(d,b.slicePlane,a);c.screenSizePerspective&&t.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&t.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return 4};return b}(f),K=function(a){function b(b){var c=this,c=a.call(this,f.makeCtorParameters(b,b.material.getParameters()))||
this;c.updateParameters();return c}l(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(u.highlightPass,{normalTexture:!!a.normalTextureId,colorTexture:!!a.textureId,tangents:a.vertexTangents?"vertex":"none",flipV:a.flipV,instanced:!!a.instanced,instancedDoublePrecision:a.instancedDoublePrecision,vvSize:a.vvSizeEnabled,verticalOffset:null!==
a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,textureAlphaMode:a.textureAlphaMode,normals:a.normals,requiresFloatOperationsFix:!!h("ios")});this.pipelineState=y.makePipelineState({culling:J(a),depthTest:{func:513},depthWrite:a.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?7:10:5};b.prototype.updateParameters=function(){this.params=
t.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);t.bindHighlightRendering(a,b,c);this.bindTexture(a,c);t.bindVerticalOffset(d.verticalOffset,b,c);t.bindScreenSizePerspective(d.screenSizePerspective,c);m(c,d);"mask"!==d.textureAlphaMode&&"maskBlend"!==d.textureAlphaMode||c.setUniform1f("textureAlphaCutoff",
d.textureAlphaCutoff)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?e.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;t.bindView(d,b.view,a);c.slicePlaneEnabled&&t.bindSlicePlane(d,b.slicePlane,a);c.screenSizePerspective&&t.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&t.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",
b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return 4};return b}(f);(n||(n={})).COLOR_GAMMA=2.1;var I={textureId:void 0,textureInitTransparent:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],metallicFactor:0,roughnessFactor:1,reflectanceFactor:.5,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,
1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,softwareInstanced:!1,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,
1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:a.mat3f64.create(),transparent:!1,writeDepth:!0,textureAlphaMode:"blend",textureAlphaCutoff:.1,textureAlphaPremultiplied:!1},Q=function(){function a(a,b){this.vertexBufferLayout=a;this.instanceBufferLayout=b}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices.position.length};
a.prototype.write=function(a,b,c,d){p.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d)};return a}(),J=function(a){var b;b=a.cullFace?"none"!==a.cullFace:a.slicePlaneEnabled?!1:!a.transparent&&!a.doubleSided;return b&&{face:"front"===a.cullFace?1028:1029,mode:2305}},N=e.vec3f64.create(),L=e.vec3f64.create(),M=e.vec3f64.fromValues(0,0,1),R=e.vec3f64.create(),S=e.vec3f64.create(),T=e.vec3f64.create(),U=e.vec3f64.create();return n})},"esri/views/3d/webgl-engine/materials/renderers/InstancedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f){function c(a,b){var c=new Map,d=function(a,b){var d=a.origin.id,e=a.data.id,f=c.get(d);f||(f={origin:a.origin.vec3,deltaByGeometry:new Map},c.set(d,f));d=f.deltaByGeometry.get(e);d||(d={renderData:a.data,toAdd:[],toRemove:[]},f.deltaByGeometry.set(e,d));(b?d.toAdd:d.toRemove).push(a)};a.forEach(function(a){d(a,!0)});b.forEach(function(a){d(a,!1)});return c}function q(a,b,c){var d=b.elementCount(a),d=b.allocate(d);b.write({},a,d,0);c.setData(d.buffer)}return function(){function b(a,
b,c,d){void 0===d&&(d=h.Default3D);this.type="InstancedRenderer";this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=a;this._vertexAttributeLocations=d;this._material=c;this._materialRep=b;this._glMaterials=g.acquireMaterials(this._material,this._materialRep);this._bufferWriter=c.createBufferWriter()}b.prototype.dispose=function(){g.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});b.prototype.hasWater=function(){return!1};b.prototype.renderPriority=function(){return this._material.renderPriority};b.prototype.modify=function(a){this.updateGeometries(a.toUpdate);this.addAndRemoveGeometries(a.toAdd,a.toRemove);this.updateHighlightCount()};b.prototype.addAndRemoveGeometries=function(b,h){var p=this,r=this._rctx,u=this._bufferWriter,
y=this._dataByOrigin;b=c(b,h);var m=u.vertexBufferLayout;b.forEach(function(b,c){var h=y.get(c);h||(h={origin:b.origin,highlightCount:0,dataByGeometry:new Map},y.set(c,h));b.deltaByGeometry.forEach(function(b,c){var v=h.dataByGeometry.get(c);!v&&0<b.toAdd.length&&(v={vao:new f(r,p._vertexAttributeLocations,{geometry:k.glLayout(m)},{geometry:e.createVertex(r,35044)}),vertexCount:0,instances:new Map,highlightCount:0},q(b.renderData,u,v.vao.vertexBuffers.geometry),v.vertexCount=d.vertexCount(v.vao,"geometry"),
h.dataByGeometry.set(c,v));var y=v.instances;b.toAdd.forEach(function(b){var c=l.mat4f64.create();g.calculateTransformRelToOrigin(b,c);var d=g.generateRenderGeometryVisibleIndexRanges(b),e=g.generateRenderGeometryHighlightRanges(b),c=new a(b.name,0,v.vertexCount,d,e,c,b.instanceParameters,b.idx,b.data.id);y.set(b.uniqueName,c);h.highlightCount=null;v.highlightCount=null});b.toRemove.forEach(function(a){y.delete(a.uniqueName)});0===y.size&&(v.vao.dispose(),h.dataByGeometry.delete(c))});0===h.dataByGeometry.size&&
y.delete(c)})};b.prototype.updateGeometries=function(a){var b=this._dataByOrigin,c=this._bufferWriter;a.forEach(function(a){var d=a.updateType;a=a.renderGeometry;var e=b.get(a.origin.id),f=e&&e.dataByGeometry.get(a.data.id),h=f&&f.instances.get(a.uniqueName);h&&(d&1&&(h.displayedIndexRange=g.generateRenderGeometryVisibleIndexRanges(a)),d&17&&(h.highlightedIndexRanges=g.generateRenderGeometryHighlightRanges(a),e.highlightCount=null,f.highlightCount=null),d&2&&q(a.data,c,f.vao.vertexBuffers.geometry),
d&4&&g.calculateTransformRelToOrigin(a,h.transformation,h.transformationNormal))})};b.prototype.updateHighlightCount=function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(b){if(null==b.highlightCount){var c=0;b.dataByGeometry.forEach(function(a){if(null==a.highlightCount){var b=0;a.instances.forEach(function(a){a.highlightedIndexRanges&&++b});a.highlightCount=b}c+=a.highlightCount});b.highlightCount=c}a._highlightCount+=b.highlightCount})};b.prototype.render=function(a,
b,c,d){var e=this,f=this._rctx,g=this._glMaterials.get(b.pass),h=4===b.pass;if(!g||null!=a&&!g.beginSlot(a)||h&&0===this._highlightCount)return!1;g.bind(f,c);var k=!1;this._dataByOrigin.forEach(function(a){h&&0===a.highlightCount||(c.origin=a.origin,g.bindView(f,c),a.dataByGeometry.forEach(function(a){k=h?e.renderHighlightPass(g,a,d)||k:e.renderDefaultPass(g,a,d)||k}))});f.bindVAO(null);g.release(f,c);return k};b.prototype.renderDefaultPass=function(a,b,c){var e=this._rctx,f=a.getProgram(),h=a.getDrawMode(),
k=b.vao,p=b.vertexCount;d.assertCompatibleVertexAttributeLocations(k,f);e.bindVAO(k);var r=!1;b.instances.forEach(function(b){var d=b.displayedIndexRange;d&&0===d.length||(a.bindInstance(e,b),d?g.drawArraysFaceRange(e,d,0,h,c):g.drawArrays(e,h,0,p,c),r=!0)});return r};b.prototype.renderHighlightPass=function(a,b,c){var e=this._rctx,f=a.getProgram(),h=a.getDrawMode(),k=b.vao,p=b.vertexCount;if(0!==b.highlightCount){d.assertCompatibleVertexAttributeLocations(k,f);e.bindVAO(k);var r=!1;b.instances.forEach(function(b){var d=
b.highlightedIndexRanges;if(d&&0!==d.length)for(a.bindInstance(e,b),b=0;b<d.length;b++){var f=d[b];g.drawArrays(e,h,f.range?f.range[0]:0,f.range?f.range[1]-f.range[0]+1:p,c);r=!0}});return r}};return b}()})},"esri/views/3d/webgl-engine/shaders/DefaultPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(a){var b=!!a.roughnessMetallnessTexture||
!!a.emissionTexture||!!a.occlusionTexture||!!a.normalTexture||!!a.colorTexture;return h.glslifyDefineMap({VERTEXCOLORS:a.vertexColors,SYMBOLVERTEXCOLORS:a.symbolColors,FLIPV:a.flipV,DOUBLESIDED:a.doubleSided,WINDINGORDERDOUBLESIDED:a.windowOrderDoubleSided,INSTANCED:a.instanced,INSTANCED_DOUBLE_PRECISION:a.instancedDoublePrecision,INSTANCEDCOLOR:a.instancedColor,RECEIVE_SHADOWS:a.receiveShadows,RECEIVE_SSAO:a.receiveSSAO,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,
SLICE:a.slice,SLICE_HIGHLIGHT_DISABLED:a.sliceHighlightDisabled,GROUND_NORMAL_SHADING:a.groundNormalShading,NORMALS:{value:a.normals,options:{default:"NORMALS_DEFAULT",compressed:"NORMALS_COMPRESSED",screenDerivative:"NORMALS_SCREEN_DERIVATIVE"}},COMPONENTCOLORS:a.componentColor,TEXTURE_ALPHA_MODE_MASK:"mask"===a.textureAlphaMode,TEXTURE_ALPHA_MODE_MASK_BLEND:"maskBlend"===a.textureAlphaMode,TEXTURE_ALPHA_MODE_OPAQUE:"opaque"===a.textureAlphaMode,BIAS_SHADOWMAP:a.shadowMap,VERTEX_TANGENTS:"vertex"===
a.tangents,TEXTURE_COLOR:a.colorTexture,TEXTURE_NORMALS:!!a.normalTexture,TEXTURE_COORDINATES:b,TEXTURE_ATLAS:b&&a.textureAtlas,TREE_RENDERING:a.treeRendering,REQUIRES_FLOAT_OPERATIONS_FIX:a.requiresFloatOperationsFix,TEXTURE_ALPHA_PREMULTIPLIED:!!a.textureAlphaPremultiplied,PBR_TEX_METALLNESS_ROUGHNESS:!!a.roughnessMetallnessTexture,PBR_TEX_EMISSION:!!a.emissionTexture,PBR_TEX_OCCLUSION:!!a.occlusionTexture,USE_PBR:a.usePBR,VERTEX_TRANSPARENCY_DISCARD_ENABLED:!!a.vertexTransparencyDiscardEnabled,
OFFSET_BACKFACES:!!a.offsetBackfaces})};b.colorPass={name:"default-color",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/defaultMaterial/colorPass.vert"),fragmentShader:a(b)+k.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:l.Default3D};b.depthPass={name:"default-depth",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/defaultMaterial/depthPass.vert"),fragmentShader:a(b)+k.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},
attributes:l.Default3D};b.normalPass={name:"default-normal",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/defaultMaterial/normalPass.vert"),fragmentShader:a(b)+k.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:l.Default3D};b.highlightPass={name:"default-highlight",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),fragmentShader:a(b)+k.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},
attributes:l.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../symbols/cim/CIMSymbolRasterizer ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ./constants ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T,U,Y,X,P){function V(a){return r.isSome(a)?"cross"===a||"x"===a:!1}Object.defineProperty(b,"__esModule",{value:!0});var Z=u.mat4f64.create(),ca=m.vec3f64.fromValues(0,0,1),da=[.25,.25,.75,.75],F=[64,64];n=function(b){function u(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._cimLayers=null;a._cimSymbolMaterials=new Map;a._cimSymbolDrapedMaterials=new Map;a._cimSymbolTextures=new Map;a._cimMaterialParametersInfo=null;a._cimRequiredFields=
null;a._size=null;a._symbolTextureRatio=1;a._outlineSize=0;a._texture=null;a._drapedMaterial=null;a._releaseTexture=null;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return a}k(u,b);u.prototype.getCachedSize=function(){return{size:this._getIconSize()}};u.prototype.doLoad=function(b){return a(this,void 0,void 0,function(){var a,c,d,e;return h(this,function(f){switch(f.label){case 0:this._validateOrThrow();a=this._prepareMaterialParameters();c=this._getPrimitive();if(!r.isSome(c))return[3,
1];this._prepareResourcesPrimitive(a,c);return[3,5];case 1:return d=C.getIconHref(this.symbol,this.symbolLayer),(e=w.dataComponents(d))&&"application/json"===e.mediaType?[4,this._prepareResourcesCIM(a,JSON.parse(e.data),b)]:[3,3];case 2:return f.sent(),[3,5];case 3:return[4,this._prepareResourcesHref(a,d,b)];case 4:f.sent(),f.label=5;case 5:return[2]}})})};u.prototype._validateOrThrow=function(){if(!this._isPropertyDriven("size")){var a=L.validateSymbolLayerSize(this._getIconSize());if(a)throw new c("graphics3diconsymbollayer:invalid-size",
a);}};u.prototype._getIconSize=function(){var a=this.symbolLayer,a=Math.round(null!=a.size?x.pt2px(a.size):16);return this._isPropertyDriven("size")?Math.max(a,64):a};u.prototype._generateTextureCIM=function(a){var b=this._getGraphicHash(a),c=""===b?null:this._cimSymbolTextures.get(b);c||(a=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,a),this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",a.anchorPosition),c=new X(a.imageData,"symbol",{width:a.imageData.width,
height:a.imageData.height,powerOfTwoResizeMode:2}),this._cimSymbolTextures.set(b,c),this._context.stage.add(4,c));return c};u.prototype._computeSize=function(a,b){a=a.width/a.height;return 1<a?[b,Math.round(b/a)]:[Math.round(b*a),b]};u.prototype._prepareMaterialParameters=function(){var a={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},b=this.symbol;if(this._hasVisibleVerticalOffset(b)){var b=b.verticalOffset,c=b.minWorldLength,d=b.maxWorldLength;a.verticalOffset=
{screenLength:x.pt2px(b.screenLength),minWorldLength:c||0,maxWorldLength:null!=d?d:Infinity}}this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);return a};u.prototype._prepareResourcesPrimitive=function(a,b){var c=this,d=this._getOutlineSize();if(V(b)&&0===d)throw Error("Nothing to render");this._outlineSize=d;a.color=this._getFillColor();a.outlineColor=this._getOutlineColor();a.outlineSize=this._outlineSize;var e=this._context.sharedResources.textures.fromData(b,
function(){var a;switch(b){case "circle":a=M.createCircle(128,64);break;case "square":a=M.createSquare(128,64);break;case "kite":a=M.createKite(128,64);break;case "cross":a=M.createCross(128,64);break;case "x":a=M.createX(128,64);break;case "triangle":a=M.createTriangle(128,64);break;default:f.neverReached(b)}return new X(a,"sdf_"+b,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=e.texture;this._releaseTexture=function(){return c._context.sharedResources.textures.release(e.uid)};
a.textureIsSignedDistanceField=!0;a.distanceFieldBoundingBox=da;a.textureId=this._texture.id;d=this._getIconSize();this._size=[d,d];this._symbolTextureRatio=2;this._createMaterialsAndAddToStage(a,this._context.stage)};u.prototype._prepareResourcesHref=function(b,e,f){return a(this,void 0,void 0,function(){var a,g,k,m,p,r,u,v,l=this;return h(this,function(h){switch(h.label){case 0:if(!q("esri-canvas-svg-support")&&w.isSVG(e))throw a="IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)",
new c("graphics3diconsymbollayer:unsupported-image-format",a);this._outlineSize=this._getOutlineSize();b.color=this._getFillColor();b.outlineColor=this._getOutlineColor();b.outlineSize=this._outlineSize;b.textureIsSignedDistanceField=!1;g=this._getIconSize();k=g*this._context.layerView.view.pixelRatio;return[4,d.result(this._context.sharedResources.textures.fromUrl(e,k,{signal:f}))];case 1:m=h.sent();if(!1===m.ok)throw t.throwIfAbortError(m.error),a="Failed to load (Request for icon resource failed: "+
e+")",new c("graphics3diconsymbollayer:request-failed",a);p=m.value;r=p.uid;u=p.texture;this._releaseTexture=function(){return l._context.sharedResources.textures.release(r)};v=u.params;this._size=this._computeSize(v,g);b.textureId=u.id;this._createMaterialsAndAddToStage(b,this._context.stage);return[2]}})})};u.prototype._prepareResourcesCIM=function(b,c,d){return a(this,void 0,void 0,function(){var a,f,g,k,m;return h(this,function(h){switch(h.label){case 0:return a=new e.CIMSymbol({data:c}),this._context.sharedResources.cimSymbolRasterizer||
(this._context.sharedResources.cimSymbolRasterizer=new z(this._context.renderSpatialReference,!0)),f=this,[4,this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(a,this._context.layer.fields?this._context.layer.fields.map(function(a){return a.toJSON()}):null,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:d})];case 1:f._cimLayers=h.sent();if(this._context.renderer)return[3,2];k=[];return[3,4];case 2:return[4,
this._context.renderer.getRequiredFields(this._context.layer.fields)];case 3:k=h.sent(),h.label=4;case 4:return g=k,t.throwIfAborted(d),m=this._context.layer.fieldsIndex,this._cimRequiredFields=g.map(function(a){return m.get(a).name}),this._cimMaterialParametersInfo=b,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1,[2]}})})};
u.prototype._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||B.defaultPrimitive};u.prototype._getOutlineSize=function(){var a=0,a=this.symbolLayer;if(r.isSome(a.outline)&&null!=a.outline.size)return Math.max(x.pt2px(a.outline.size),0);a=this._getPrimitive();a=V(a)?1.5:0;return Math.max(a,0)};u.prototype._getOutlineColor=function(){var a=this._getLayerOpacity(),b=r.get(this.symbolLayer,"outline",
"color");if(r.isSome(b)){var c=g.toUnitRGB(b);return[c[0],c[1],c[2],b.a*a]}return[0,0,0,0]};u.prototype._getFillColor=function(){if(V(this._getPrimitive()))return D.TRANSPARENT;var a=r.isNone(this._getPrimitive()),b=r.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(b,{hasIntrinsicColor:a})};u.prototype._getAnchorPos=function(a,b){return"relative"===a?y.vec2f64.fromValues((b.x||0)+.5,-(b.y||0)+.5):a in L.namedAnchorToHUDMaterialAnchorPos?L.namedAnchorToHUDMaterialAnchorPos[a]:
L.namedAnchorToHUDMaterialAnchorPos.center};u.prototype._createMaterialsAndAddToStage=function(a,b){this._fastUpdates=this._cimLayers?{enabled:!1}:R.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&p.mixin(a,this._fastUpdates.materialParameters);var c=l({},a);c.verticalOffset=null;c.screenSizePerspective=null;c.occlusionTest=!1;c.slicePlaneEnabled=!1;c.shaderPolygonOffset=0;a.occlusionTest=!0;a.slicePlaneEnabled=this._context.slicePlaneEnabled;
if(this._cimLayers){var d=this._cimSymbolMaterials.get(a.textureId),e=this._cimSymbolDrapedMaterials.get(a.textureId);e||(e=new P(c,this._getIdHint("_iconDraped")),this._cimSymbolDrapedMaterials.set(a.textureId,e),b.add(3,e));d||(d=new P(a,this._getIdHint("_icon")),this._cimSymbolMaterials.set(a.textureId,d),b.add(3,d));return[d,e]}this._drapedMaterial=new P(c,this._getIdHint("_iconDraped"));b.add(3,this._drapedMaterial);this._material=new P(a,this._getIdHint("_icon"));b.add(3,this._material);return[this._material,
this._drapedMaterial]};u.prototype.destroy=function(){var a=this;b.prototype.destroy.call(this);this._forEachMaterial(0,function(b){a._context.stage.remove(3,b.id)});this._material&&(this._material=null);this._cimSymbolMaterials.clear();this._drapedMaterial&&(this._drapedMaterial=null);this._cimSymbolDrapedMaterials.clear();this._cimSymbolTextures.forEach(function(b){a._context.stage.remove(4,b.id)});this._cimSymbolTextures.clear();this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=
null)};u.prototype._getScaleFactor=function(a,b){if(this._isPropertyDriven("size")&&a.size){for(var c=0;3>c;c++){var d=a.size[c];d&&"symbolValue"!==d&&"proportional"!==d&&(a.size[c]=x.pt2px(d))}if("symbolValue"===a.size[0])return 1;if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}return 1};u.prototype.createGraphics3DGraphic=function(a){var b,c=a.renderingInfo,d=a.graphic,e,f;if(this._cimLayers){var g=this._generateTextureCIM(d);f=l({textureId:g.id},this._cimMaterialParametersInfo);
b=this._createMaterialsAndAddToStage(f,this._context.stage);f=b[0];b=b[1];e=[g.params.width,g.params.height]}else e=this._size,f=this._material,b=this._drapedMaterial;if(!this._validateGeometry(d.geometry))return null;g=J.placePointOnGeometry(d.geometry);if(r.isNone(g))return this.logger.warn("unsupported geometry type for icon symbol: "+d.geometry.type),null;var h="graphic"+d.uid,k=this._getVertexOpacityAndColor(c),m=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(m=this._getScaleFactor(c,
e[0]>e[1]?e[0]:e[1]));m*=this._symbolTextureRatio;c=[e[0]*m,e[1]*m];e=this.getGraphicElevationContext(d);return"on-the-ground"===e.mode?this._createAsOverlay(d,g,b,k,c,e,h,d.uid,a.layer.uid):this._createAs3DShape(d,g,f,k,c,e,h,d.uid)};u.prototype.layerOpacityChanged=function(){var a=this._getFillColor(),b=this._getOutlineColor();this._forEachMaterial(0,function(c){c.setParameterValues({color:a});c.setParameterValues({outlineColor:b})});return!0};u.prototype.layerElevationInfoChanged=function(a,b,
c){var d=this._elevationContext.mode;c=J.elevationModeChangeUpdateType(u.elevationModeChangeTypes,c,d);if(c!==J.SymbolUpdateType.UPDATE)return c;var e=J.needsElevationUpdates2D(d)||"absolute-height"===d;return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};u.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._forEachMaterial(1,function(a){a.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});return!0};u.prototype.physicalBasedRenderingChanged=
function(a,b){return!0};u.prototype.pixelRatioChanged=function(a,b){return this._getPrimitive()?!0:!1};u.prototype.applyRendererDiff=function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(R.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._material&&this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial&&this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;
default:return!1}return!0};u.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._forEachMaterial(2,function(b){b.renderPriority=a;c.add(b.id)})};u.prototype._defaultElevationInfoNoZ=function(){return ea};u.prototype._createAs3DShape=function(a,b,c,d,e,f,g,h){var k=this,m=this.getFastUpdateAttrValues(a);a=m?function(a){return R.evaluateModelTransform(k._fastUpdates.materialParameters,m,a)}:null;d=U.createPointGeometry(ca,null,d,e,la,null,m);d=[new T(d,g)];g=J.createStageObjectForPoint(this._context,
b,d,[c],null,null,f,g,this._context.layer.uid,h,!0,a);if(null===g)return null;var p=new Q(this,g.object,d,null,null,K.perObjectElevationAligner,f);p.alignedTerrainElevation=g.terrainElevation;p.needsElevationUpdates=J.needsElevationUpdates2D(f.mode)||"absolute-height"===f.mode;p.getScreenSize=this._createScreenSizeGetter(e,a);p.calculateRelativeScreenBounds=function(a){return c.calculateRelativeScreenBounds(p.getScreenSize(),1,a)};J.extendPointGraphicElevationContext(p,b,this._context.elevationProvider);
return p};u.prototype._createAsOverlay=function(a,b,c,d,e,f,g,h,k){var p=this;c.renderPriority=this._symbolLayerOrder;f=m.vec3f64.create();S.pointToVector(b,f,this._context.overlaySR);f[2]=this._getDrapedZ();if((b=this._context.clippingExtent)&&!J.pointInBox2D(f,b))return null;var r=this.getFastUpdateAttrValues(a);b=r?function(a){return R.evaluateModelTransform(p._fastUpdates.materialParameters,r,a)}:null;d=U.createPointGeometry(ca,f,d,e,null,null,r);h=new Y(d);h.material=c;h.center=f;h.bsRadius=
0;h.transformation=Z;h.name=g;h.uniqueName=g+"#"+d.id;h.data.layerUid=k;h.data.graphicUid=a.uid;h.calculateShaderTransformation=b;var q=new I(this,[h],null);q.getScreenSize=this._createScreenSizeGetter(e,b);q.calculateRelativeScreenBounds=function(a){return c.calculateRelativeScreenBounds(q.getScreenSize(),1,a)};return q};u.prototype._createScreenSizeGetter=function(a,b){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var d=a[0]/this._symbolTextureRatio,e=a[1]/this._symbolTextureRatio;return function(a){void 0===
a&&(a=y.vec2f64.create());var f=b(Z);a[0]=f[0]*d+c;a[1]=f[5]*e+c;return a}}var f=a[0]/this._symbolTextureRatio+c,g=a[1]/this._symbolTextureRatio+c;return function(a){void 0===a&&(a=y.vec2f64.create());a[0]=f;a[1]=g;return a}};u.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],b=m.vec3f64.fromValues(a,a,a),c=x.px2pt(1),a=a*c,a=m.vec3f64.fromValues(a,a,a);return{modelSize:b,symbolSize:a,unitInMeters:c,transformation:{anchor:m.vec3f64.ZEROS,
scale:m.vec3f64.ONES,rotation:m.vec3f64.ZEROS}}};u.prototype._hasVisibleVerticalOffset=function(a){return this.symbol&&"point-3d"===this.symbol.type&&this.symbol.hasVisibleVerticalOffset()};u.prototype._getGraphicHash=function(a){for(var b="",c=0,d=this._cimRequiredFields;c<d.length;c++)var e=d[c],b=b+(e+a.attributes[e]);return b};u.prototype._forEachMaterial=function(a,b){switch(a){case 0:this._forEachMaterial(1,b);this._forEachMaterial(2,b);break;case 1:this._material&&b(this._material);this._cimSymbolMaterials.forEach(b);
break;case 2:this._drapedMaterial&&b(this._drapedMaterial);this._cimSymbolDrapedMaterials.forEach(b);break;default:f.neverReached(a)}};u.PRIMITIVE_SIZE=F;u.elevationModeChangeTypes={definedChanged:J.SymbolUpdateType.UPDATE,staysOnTheGround:J.SymbolUpdateType.NONE,onTheGroundChanged:J.SymbolUpdateType.RECREATE};return u}(N.default);b.Graphics3DIconSymbolLayer=n;var ea={mode:"relative-to-ground",offset:0},la=v.vec4f64.fromValues(0,0,0,1);b.default=n})},"esri/symbols/cim/CIMSymbolRasterizer":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/promiseUtils ../../core/screenUtils ../../geometry/support/jsonUtils ./cimAnalyzer ./Rasterizer ./TextRasterizer ./utils ../support/cimSymbolUtils ../support/Symbol3DAnchorPosition2D".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(a,b,c){var d=(a?Object.keys(a):[]).map(function(b){return{name:b,alias:b,type:"string"===typeof a[b]?"esriFieldTypeString":"esriFieldTypeDouble"}});return{geometryType:b,spatialReference:c,fields:d}}return function(){function b(a,b){this._spatialReference=a;this._avoidSDF=b;this._resourceCache=new Map;this._rasterizer=new f.default;this._textRasterizer=new c.default;this._pictureMarkerCache=new Map}b.prototype.rasterizeCIMSymbolAsync=function(b,c,f,
g,h){return k(this,void 0,void 0,function(){var k,m,r,q,u,v,y,w,x,n;return l(this,function(l){switch(l.label){case 0:return[4,p.expandSymbol(b)];case 1:return k=l.sent(),m=[],r=null!==c.centroid?"esriGeometryPolygon":e.getJsonType(c.geometry),q=t(c.attributes,r,this._spatialReference),u=[],u.push(d.analyzeCIMSymbol(k.data,f,q,m,this._avoidSDF)),[4,a.all(u)];case 2:l.sent();v=[];y=0;for(w=m;y<w.length;y++)x=w[y],n=this._getRasterizedResource(x,c,g,h),null!=n&&v.push({cimLayer:x,rasterizedResource:n});
return[2,v]}})})};b.prototype.analyzeCIMSymbol=function(b,c,e,f,g){return k(this,void 0,void 0,function(){var k,m,r,q,u,v,y,w,x;return l(this,function(l){switch(l.label){case 0:return[4,p.expandSymbol(b,g)];case 1:return k=l.sent(),m=[],r=t(c,f,this._spatialReference),q=[],q.push(d.analyzeCIMSymbol(k.data,e,r,m,this._avoidSDF)),[4,a.all(q)];case 2:l.sent(),a.throwIfAborted(g),u=0,l.label=3;case 3:if(!(u<m.length))return[3,6];v=m[u];if("CIMPictureMarker"!==v.cim.type)return[3,5];y=v.materialHash;return this._pictureMarkerCache.get(y)?
[3,5]:[4,h(v.cim.url,{responseType:"image",signal:g.signal})];case 4:w=l.sent(),x=w.data,this._pictureMarkerCache.set(y,x),l.label=5;case 5:return u++,[3,3];case 6:return[2,m]}})})};b.prototype.rasterizeCIMSymbol=function(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=this._getRasterizedResource(g,b,c,d);null!=h&&e.push({cimLayer:g,rasterizedResource:h})}return this.getSymbolImage(e,b,c,d)};b.prototype.getSymbolImage=function(a,b,c,d){for(var e=document.createElement("canvas"),f=e.getContext("2d"),
h=0,k=0,m=0,p=0,u=null,l=[],y=0;y<a.length;y++){var w=a[y],x=w.rasterizedResource;if(x){var t=w.cimLayer;if("line"!==t.type&&"fill"!==t.type){var n=x.size,w=q.evaluateValueOrFunction(t.offsetX,b,c,d),S=q.evaluateValueOrFunction(t.offsetY,b,c,d),w=w?w:0,S=S?S:0,T=t.anchorPoint?{x:t.anchorPoint.x,y:t.anchorPoint.y}:{x:0,y:0},U=t.isAbsoluteAnchorPoint||!1,Y=!1,X=t.type,P=void 0,V=void 0;"marker"===t.type&&(P=q.evaluateValueOrFunction(t.rotation,b,c,d),Y=t.rotateClockwise?t.rotateClockwise:!1);if("text"===
t.type){P=q.evaluateValueOrFunction(t.angle,b,c,d);if(void 0!==t.horizontalAlignment)switch(t.horizontalAlignment){case "left":T.x=.5;break;case "right":T.x=-.5}if(void 0!==t.verticalAlignment)switch(t.verticalAlignment){case "top":T.y=.5;case "bottom":T.y=-.5}}var t=g.pt2px(w)+n[0]*(T.x-.5),Z=-g.pt2px(S)+n[1]*(T.y-.5),ca=t+n[0],da=Z+n[1];if(P){Y&&(P=360-P);var F=Math.sin(P*Math.PI/180),ea=Math.cos(P*Math.PI/180),V=t*ea+Z*F,n=-t*F+Z*ea,la=t*ea+da*F,ka=-t*F+da*ea,oa=ca*ea+da*F,da=-ca*F+da*ea,va=ca*
ea+Z*F,F=-ca*F+Z*ea,t=Math.min(V,la,oa,va),Z=Math.min(n,ka,da,F),ca=Math.max(V,la,oa,va),da=Math.max(n,ka,da,F),V={minX:t,minY:Z,maxX:ca,maxY:da}}h=t<h?t:h;k=Z<k?Z:k;m=ca>m?ca:m;p=da>p?da:p;t=f.createImageData(x.size[0],x.size[1]);t.data.set(new Uint8ClampedArray(x.image.buffer));x={offsetX:w,offsetY:S,anchorPoint:T,anchorPointAbsolute:U,rotateClockwise:Y,type:X,angle:P,rotatedBBox:V,rasterizedImage:t};l.push(x)}}}e.width=m-h;e.height=p-k;for(y=0;y<l.length;y++)b=a=0,x=l[y],c=this._imageDataToCanvas(x.rasterizedImage),
d=x.rasterizedImage.width,w=x.rasterizedImage.height,x.anchorPointAbsolute?(a=g.pt2px(x.offsetX)-h+x.anchorPoint.x,b=-g.pt2px(x.offsetY)-k+x.anchorPoint.y):(a=g.pt2px(x.offsetX)-h+d*(x.anchorPoint.x-.5),b=-g.pt2px(x.offsetY)-k+w*(x.anchorPoint.y-.5)),x.angle?(S=(360-x.angle)*Math.PI/180,f.translate(-d*(x.anchorPoint.x-.5)+a,-w*(x.anchorPoint.y-.5)+b),f.rotate(S),f.drawImage(c,d*(x.anchorPoint.x-.5),w*(x.anchorPoint.y-.5)),f.rotate(-S),f.translate(-(-d*(x.anchorPoint.x-.5)+a),-(-w*(x.anchorPoint.y-
.5)+b))):f.drawImage(c,a,b),u||"text"===x.type||(u=new r.default({x:(-d*(x.anchorPoint.x-.5)+a)/(m-h)-.5,y:(-w*(x.anchorPoint.y-.5)+b)/(p-k)-.5}));return{imageData:f.getImageData(0,0,e.width,e.height),anchorPosition:u}};b.prototype._imageDataToCanvas=function(a){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));var b=this._imageDataCanvas,c=b.getContext("2d");b.width=a.width;b.height=a.height;c.putImageData(a,0,0);return b};b.prototype._imageTo32Array=function(a,b,c){this._imageDataCanvas||
(this._imageDataCanvas=document.createElement("canvas"));var d=this._imageDataCanvas,e=d.getContext("2d");d.width=b;d.height=c;e.drawImage(a,0,0,b,c);return new Uint32Array(e.getImageData(0,0,b,c).data.buffer)};b.prototype._getRasterizedResource=function(a,b,c,e){var f;if("text"===a.type)f=a.cim,a=this._rasterizeTextResource(a,f,b,c,e);else{var h=this._resourceCache,k=void 0;"function"===typeof a.materialHash?(k=a.materialHash,k=k(b,c,e),f=d.analyzeCIMResource(b,a.cim,a.materialOverrides)):(k=a.materialHash,
f=a.cim);if(h.has(k))return h.get(k);if("CIMPictureMarker"===a.cim.type){c=q.evaluateValueOrFunction(a.cim.size,b,c,e);a=this._pictureMarkerCache.get(k);if(!a)return null;e=a.height/a.width;b=1<e?g.pt2px(c):g.pt2px(c)/e;c=1<e?g.pt2px(c)*e:g.pt2px(c);a={image:this._imageTo32Array(a,b,c),size:[b,c],sdf:!1,simplePattern:!1}}else a=this._rasterizer.rasterizeJSONResource(f,this._avoidSDF);h.set(k,a)}return a};b.prototype._rasterizeTextResource=function(a,b,c,d,e){b=q.evaluateValueOrFunction(a.text,c,d,
e);if(!b||0===b.length)return null;var f=q.evaluateValueOrFunction(a.fontName,c,d,e),g=q.evaluateValueOrFunction(a.style,c,d,e),h=q.evaluateValueOrFunction(a.weight,c,d,e),k=q.evaluateValueOrFunction(a.decoration,c,d,e),m=q.evaluateValueOrFunction(a.size,c,d,e),p=q.evaluateValueOrFunction(a.horizontalAlignment,c,d,e),r=q.evaluateValueOrFunction(a.verticalAlignment,c,d,e),u=q.colorToArray(q.evaluateValueOrFunction(a.color,c,d,e)),l=q.colorToArray(q.evaluateValueOrFunction(a.outlineColor,c,d,e));a=
q.evaluateValueOrFunction(a.outlineSize,c,d,e);return this._textRasterizer.rasterizeText(b,{color:u,size:m,horizontalAlignment:p,verticalAlignment:r,font:{family:f,style:g,weight:h,decoration:k},halo:{size:a||0,color:l,style:g},pixelRatio:1,premultiplyColors:!this._avoidSDF})};return b}()})},"esri/symbols/cim/cimAnalyzer":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../Color ../../core/Logger ../../core/promiseUtils ../../support/arcadeOnDemand ./CIMSymbolHelper ./enums ./SDFHelper ./utils ../../views/2d/arcade/utils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(a){return a?{r:a[0],g:a[1],b:a[2],a:a[3]/255}:{r:0,g:0,b:0,a:0}}function x(a){switch(a){case "Butt":return c.CapType.BUTT;case "Square":return c.CapType.SQUARE;default:return c.CapType.ROUND}}function w(a){switch(a){case "Bevel":return c.JoinType.BEVEL;case "Miter":return c.JoinType.MITER;default:return c.JoinType.ROUND}}function u(a){switch(a){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"justify"}}
function y(a){switch(a){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}}function m(a){var b="normal",c="normal";a&&(a=a.toLowerCase(),-1!==a.indexOf("italic")?b="italic":-1!==a.indexOf("oblique")&&(b="oblique"),-1!==a.indexOf("bold")?c="bold":-1!==a.indexOf("light")&&(c="lighter"));return{style:b,weight:c}}function v(a,b,d,e,g,h){return k(this,void 0,void 0,function(){var k,m,p,r,q,u,v;return l(this,function(l){switch(l.label){case 0:if(!a)return[2];
k=a.symbolLayers;if(!k)return[2];p=f.CIMSymbolHelper.getSize(a);"CIMPointSymbol"===a.type&&"Map"===a.angleAlignment&&(m=c.Alignment.MAP);r=k.length;l.label=1;case 1:if(!r--)return[3,23];q=k[r];if(!q||!1===q.enable)return[3,1];u=[];f.OverrideHelper.findApplicableOverrides(q,b,u);v=q.type;switch(v){case "CIMSolidFill":return[3,2];case "CIMPictureFill":return[3,4];case "CIMHatchFill":return[3,6];case "CIMGradientFill":return[3,8];case "CIMSolidStroke":return[3,10];case "CIMPictureStroke":return[3,12];
case "CIMGradientStroke":return[3,14];case "CIMCharacterMarker":return[3,16];case "CIMPictureMarker":return[3,17];case "CIMVectorMarker":return[3,19]}return[3,21];case 2:return[4,z(q,u,e,g)];case 3:return l.sent(),[3,22];case 4:return[4,B(q,u,e,g)];case 5:return l.sent(),[3,22];case 6:return[4,C(q,u,e,g)];case 7:return l.sent(),[3,22];case 8:return[4,D(q,u,e,g)];case 9:return l.sent(),[3,22];case 10:return[4,K(q,u,e,g,"CIMPolygonSymbol"===a.type,p)];case 11:return l.sent(),[3,22];case 12:return[4,
I(q,u,e,g,"CIMPolygonSymbol"===a.type,p)];case 13:return l.sent(),[3,22];case 14:return[4,Q(q,u,e,g,"CIMPolygonSymbol"===a.type,p)];case 15:return l.sent(),[3,22];case 16:return[3,22];case 17:return[4,J(q,u,e,g,m,p)];case 18:return l.sent(),[3,22];case 19:return[4,N(q,u,d,e,g,m,p,h)];case 20:return l.sent(),[3,22];case 21:V.error("Cannot analyze CIM layer",q.type),l.label=22;case 22:return[3,1];case 23:return[2]}})})}function z(a,b,c,d){return k(this,void 0,void 0,function(){var e,f,g,h,k,m;return l(this,
function(r){switch(r.label){case 0:return e=a.primitiveName,f=t(a.color),g=p.hashString(JSON.stringify(a)).toString(),k=(h=d).push,m={type:"fill",templateHash:g,materialHash:0===b.length?g:function(a,b,c){return g},cim:a,materialOverrides:null,colorLocked:a.colorLocked},[4,U(e,"Color",b,c,f,T)];case 1:return k.apply(h,[(m.color=r.sent(),m.height=0,m.angle=0,m.offsetX=0,m.offsetY=0,m.scaleX=1,m)]),[2]}})})}function B(a,b,c,d){return k(this,void 0,void 0,function(){var e,f,g,h,k,m,r;return l(this,function(q){switch(q.label){case 0:return e=
a.primitiveName,f=t(a.tintColor),g=p.hashString(JSON.stringify(a)).toString(),h=p.hashString(""+a.url+JSON.stringify(a.colorSubstitutions)).toString(),m=(k=d).push,r={type:"fill",templateHash:g,materialHash:0===b.length?h:function(a,b,c){return h},cim:a,materialOverrides:null,colorLocked:a.colorLocked},[4,U(e,"TintColor",b,c,f,T)];case 1:return r.color=q.sent(),[4,U(e,"Height",b,c,a.height)];case 2:return r.height=q.sent(),[4,U(e,"ScaleX",b,c,a.scaleX)];case 3:return r.scaleX=q.sent(),[4,U(e,"Rotation",
b,c,a.rotation)];case 4:return r.angle=q.sent(),[4,U(e,"OffsetX",b,c,a.offsetX)];case 5:return r.offsetX=q.sent(),[4,U(e,"OffsetY",b,c,a.offsetY)];case 6:return m.apply(k,[(r.offsetY=q.sent(),r)]),[2]}})})}function C(a,b,c,d){return k(this,void 0,void 0,function(){var e,f,g,h,k,m,r,q;return l(this,function(u){switch(u.label){case 0:e=["Rotation","OffsetX","OffsetY"];f=b.filter(function(b){return b.primitiveName!==a.primitiveName&&-1===e.indexOf(b.propertyName)});g=a.primitiveName;h=p.hashString(JSON.stringify(a)).toString();
m=(k=d).push;r={type:"fill",templateHash:h};if(0!==b.length)return[3,1];q=h;return[3,3];case 1:return[4,P(h,f,c)];case 2:q=u.sent(),u.label=3;case 3:return r.materialHash=q,r.cim=a,r.materialOverrides=f,r.colorLocked=a.colorLocked,r.color={r:128,g:128,b:128,a:1},r.height=0,r.scaleX=1,[4,U(g,"Rotation",b,c,a.rotation)];case 4:return r.angle=u.sent(),[4,U(g,"OffsetX",b,c,a.offsetX)];case 5:return r.offsetX=u.sent(),[4,U(g,"OffsetY",b,c,a.offsetY)];case 6:return m.apply(k,[(r.offsetY=u.sent(),r)]),[2]}})})}
function D(a,b,c,d){return k(this,void 0,void 0,function(){var e,f,g,h,k;return l(this,function(m){switch(m.label){case 0:e=p.hashString(JSON.stringify(a)).toString();g=(f=d).push;h={type:"fill",templateHash:e};if(0!==b.length)return[3,1];k=e;return[3,3];case 1:return[4,P(e,b,c)];case 2:k=m.sent(),m.label=3;case 3:return g.apply(f,[(h.materialHash=k,h.cim=a,h.materialOverrides=null,h.colorLocked=a.colorLocked,h.color={r:128,g:128,b:128,a:1},h.height=0,h.angle=0,h.offsetX=0,h.offsetY=0,h.scaleX=1,
h)]),[2]}})})}function K(a,b,c,d,e,f){return k(this,void 0,void 0,function(){var g,h,k,m,r,q,u,v,y,z;return l(this,function(l){switch(l.label){case 0:return g=p.hashString(JSON.stringify(a)).toString(),h=a.primitiveName,k=t(a.color),m=void 0!==a.width?a.width:4,r=x(a.capStyle),q=w(a.joinStyle),u=a.miterLimit,y=(v=d).push,z={type:"line",templateHash:g,materialHash:0===b.length?g:function(a,b,c){return g},cim:a,materialOverrides:null,isOutline:e,colorLocked:a.colorLocked},[4,U(h,"Color",b,c,k,T)];case 1:return z.color=
l.sent(),[4,U(h,"Width",b,c,m)];case 2:return z.width=l.sent(),[4,U(h,"CapStyle",b,c,r)];case 3:return z.cap=l.sent(),[4,U(h,"JoinStyle",b,c,q)];case 4:return z.join=l.sent(),[4,U(h,"MiterLimit",b,c,u)];case 5:return y.apply(v,[(z.miterLimit=l.sent(),z.referenceWidth=f,z.zOrder=S(a.name),z.isDashed=!1,z)]),[2]}})})}function I(a,b,c,d,e,f){return k(this,void 0,void 0,function(){var g,h,k,m,r,q,u,v,y,z,B;return l(this,function(l){switch(l.label){case 0:return g=p.hashString(""+a.url+JSON.stringify(a.colorSubstitutions)).toString(),
h=a.primitiveName,k=t(a.tintColor),m=void 0!==a.width?a.width:4,r=x(a.capStyle),q=w(a.joinStyle),u=a.miterLimit,v=p.hashString(JSON.stringify(a)).toString(),z=(y=d).push,B={type:"line",templateHash:v,materialHash:0===b.length?g:function(a,b,c){return g},cim:a,materialOverrides:null,isOutline:e,colorLocked:a.colorLocked},[4,U(h,"TintColor",b,c,k,T)];case 1:return B.color=l.sent(),[4,U(h,"Width",b,c,m)];case 2:return B.width=l.sent(),[4,U(h,"CapStyle",b,c,r)];case 3:return B.cap=l.sent(),[4,U(h,"JoinStyle",
b,c,q)];case 4:return B.join=l.sent(),[4,U(h,"MiterLimit",b,c,u)];case 5:return z.apply(y,[(B.miterLimit=l.sent(),B.referenceWidth=f,B.zOrder=S(a.name),B.isDashed=!1,B)]),[2]}})})}function Q(a,b,c,d,e,f){return k(this,void 0,void 0,function(){var g,h,k,m,r,q,u,v,y,t;return l(this,function(l){switch(l.label){case 0:g=a.primitiveName;h=void 0!==a.width?a.width:4;k=x(a.capStyle);m=w(a.joinStyle);r=a.miterLimit;q=p.hashString(JSON.stringify(a)).toString();v=(u=d).push;y={type:"line",templateHash:q};if(0!==
b.length)return[3,1];t=q;return[3,3];case 1:return[4,P(q,b,c)];case 2:t=l.sent(),l.label=3;case 3:return y.materialHash=t,y.cim=a,y.materialOverrides=null,y.isOutline=e,y.colorLocked=a.colorLocked,y.color={r:128,g:128,b:128,a:1},[4,U(g,"Width",b,c,h)];case 4:return y.width=l.sent(),[4,U(g,"CapStyle",b,c,k)];case 5:return y.cap=l.sent(),[4,U(g,"JoinStyle",b,c,m)];case 6:return y.join=l.sent(),[4,U(g,"MiterLimit",b,c,r)];case 7:return v.apply(u,[(y.miterLimit=l.sent(),y.referenceWidth=f,y.zOrder=S(a.name),
y.isDashed=!1,y)]),[2]}})})}function J(a,b,c,d,e,f){return k(this,void 0,void 0,function(){var g,h,k,m,r,q,u,v,y,x,w,z,B,n,L,C;return l(this,function(l){switch(l.label){case 0:g=a.primitiveName;h=a.size;k=a.scaleX;m=a.rotation;r=a.offsetX;q=a.offsetY;u=t(a.tintColor);v=p.hashString(""+a.url+JSON.stringify(a.colorSubstitutions)).toString();y=!1;x="";w=0;for(z=b;w<z.length;w++)B=z[w],B.primitiveName===g&&(void 0!==B.value?x+="|"+B.primitiveName+"|"+B.propertyName+"|"+JSON.stringify(B.value):B.valueExpressionInfo&&
(y=!0));L=(n=d).push;C={type:"marker",templateHash:p.hashString(JSON.stringify(a)+x).toString(),materialHash:y?function(a,b,c){return v}:v,cim:a,materialOverrides:null,colorLocked:a.colorLocked,scaleSymbolsProportionally:!1,alignment:e,anchorPoint:a.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==a.anchorPointUnits};return[4,U(g,"Size",b,c,h)];case 1:return C.size=l.sent(),[4,U(g,"ScaleX",b,c,k)];case 2:return C.scaleX=l.sent(),[4,U(g,"Rotation",b,c,m)];case 3:return C.rotation=l.sent(),[4,U(g,"OffsetX",
b,c,r)];case 4:return C.offsetX=l.sent(),[4,U(g,"OffsetY",b,c,q)];case 5:return C.offsetY=l.sent(),[4,U(g,"TintColor",b,c,u,T)];case 6:return L.apply(n,[(C.color=l.sent(),C.outlineColor={r:0,g:0,b:0,a:0},C.outlineWidth=0,C.frameHeight=0,C.rotateClockwise=a.rotateClockwise,C.referenceSize=f,C.sizeRatio=1,C)]),[2]}})})}function N(a,b,c,d,f,g,h,m){return k(this,void 0,void 0,function(){var k,p,r,q,u,v,y,x;return l(this,function(l){switch(l.label){case 0:k=a.markerGraphics;if(!k)return[2];p=0;a.scaleSymbolsProportionally&&
(r=a.frame)&&(p=r.ymax-r.ymin);q=[];u=0;for(v=k;u<v.length;u++)if(y=v[u])if(x=y.symbol)switch(x.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":q.push(M(a,y,b,d,f,g,h,p,m));break;case "CIMTextSymbol":q.push(L(a,y,b,c,d,f,g,h,p))}return[4,e.all(q)];case 1:return l.sent(),[2]}})})}function L(a,b,c,d,e,g,r,q,v){return k(this,void 0,void 0,function(){var k,x,w,z,B,n,L,C,M,R,D,S,N,J,K,I,T,Q,Z,V,F,P,ca,Y;return l(this,function(l){switch(l.label){case 0:k=[];f.OverrideHelper.findApplicableOverrides(b,
c,k);x=b.geometry;if(!("x"in x&&"y"in x))return[2];w=b.symbol;z=w.underline?"underline":w.strikethrough?"line-through":"none";B=m(w.fontStyleName);w.font=h({family:w.fontFamilyName,decoration:z},B);n=a.frame;L=x.x-.5*(n.xmin+n.xmax);C=x.y-.5*(n.ymin+n.ymax);M=a.size/v;R=a.primitiveName;D=(w.height||0)*M;S=w.angle||0;N=((w.offsetX||0)+L)*M;J=((w.offsetY||0)+C)*M;K=t(f.CIMSymbolHelper.getFillColor(w));I=t(f.CIMSymbolHelper.getStrokeColor(w));T=f.CIMSymbolHelper.getStrokeWidth(w);T||(I=t(f.CIMSymbolHelper.getFillColor(w.haloSymbol)),
T=w.haloSize*M);Q="";Z=0;for(V=c;Z<V.length;Z++)F=V[Z],F.primitiveName===R&&void 0!==F.value&&(Q+="|"+F.primitiveName+"|"+F.propertyName+"|"+JSON.stringify(F.value));ca=(P=g).push;Y={type:"text",templateHash:p.hashString(JSON.stringify(b)+Q).toString(),materialHash:function(a,b,c){return p.hashString(JSON.stringify(w.font)).toString()},cim:w,materialOverrides:null,colorLocked:a.colorLocked,alignment:r,anchorPoint:{x:a.anchorPoint?a.anchorPoint.x:0,y:a.anchorPoint?a.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==
a.anchorPointUnits,fontName:w.fontFamilyName,decoration:"none",weight:"normal",style:"normal"};return[4,U(R,"Height",c,e,D)];case 1:return Y.size=l.sent(),[4,U(R,"Rotation",c,e,S)];case 2:return Y.angle=l.sent(),[4,U(R,"OffsetX",c,e,N)];case 3:return Y.offsetX=l.sent(),[4,U(R,"OffsetY",c,e,J)];case 4:return ca.apply(P,[(Y.offsetY=l.sent(),Y.horizontalAlignment=u(w.horizontalAlignment),Y.verticalAlignment=y(w.verticalAlignment),Y.text=X(d,e,b.textString,w.textCase),Y.color=K,Y.outlineColor=I,Y.outlineSize=
T,Y.referenceSize=q,Y.sizeRatio=1,Y)]),[2]}})})}function M(a,b,c,d,e,g,h,m,r){return k(this,void 0,void 0,function(){var k,u,v,y,x,w;return l(this,function(z){switch(z.label){case 0:k=b.symbol;u=b.geometry;if(!u)return[2];v=q.getExtent(u);if("CIMTextSymbol"===k.type)return[2];y=k.symbolLayers;if(!y)return[2];x=y.length;w=function(){var k,w,z,B,n,L,C,M,D,S,N,J,K,I,Q,Z,V,F,P,X,Y,ca,la,da,ia,ka,ea,na,wa;return l(this,function(l){switch(l.label){case 0:return(k=y[x])&&!1!==k.enable?r?[4,R(a,b,c,d,e,g,
h,m)]:[3,2]:[2,"continue"];case 1:return l.sent(),[2,"continue"];case 2:w=k.type;switch(w){case "CIMSolidFill":return[3,3];case "CIMSolidStroke":return[3,3]}return[3,15];case 3:z=q.getSDFMetrics(v,a.frame,a.size,a.anchorPoint,"Relative"!==a.anchorPointUnits);B=z[0];n=z[1];L=z[2];C="CIMSolidFill"===k.type;M={type:"sdf",geom:u,asFill:C};D=a.primitiveName;S=a.size;N=a.rotation;J=a.offsetX;K=a.offsetY;I=k.primitiveName;Q=C?t(f.CIMSymbolHelper.getFillColor(k)):t(f.CIMSymbolHelper.getStrokeColor(k));Z=
C?{r:0,g:0,b:0,a:0}:t(f.CIMSymbolHelper.getStrokeColor(k));V=f.CIMSymbolHelper.getStrokeWidth(k);if(!C&&!V)return[3,16];F=!1;P="";X=0;for(Y=c;X<Y.length;X++)if(ca=Y[X],ca.primitiveName===I||ca.primitiveName===D)void 0!==ca.value?P+="|"+ca.primitiveName+"|"+ca.propertyName+"|"+JSON.stringify(ca.value):ca.valueExpressionInfo&&(F=!0);la=p.hashString(JSON.stringify(M)).toString();da=p.hashString(JSON.stringify(k)+JSON.stringify(b)+P).toString();ka=(ia=e).push;ea={type:"marker",templateHash:da,materialHash:F?
function(a,b,c){return la}:la,cim:M,materialOverrides:null,colorLocked:a.colorLocked,scaleSymbolsProportionally:a.scaleSymbolsProportionally,alignment:g,anchorPoint:{x:n,y:L},isAbsoluteAnchorPoint:!1};return[4,U(D,"Size",c,d,S)];case 4:return ea.size=l.sent(),ea.scaleX=1,[4,U(D,"Rotation",c,d,N)];case 5:return ea.rotation=l.sent(),[4,U(D,"OffsetX",c,d,J)];case 6:return ea.offsetX=l.sent(),[4,U(D,"OffsetY",c,d,K)];case 7:return ea.offsetY=l.sent(),[4,U(I,"Color",c,d,Q,T)];case 8:ea.color=l.sent();
if(!C)return[3,9];na={r:0,g:0,b:0,a:0};return[3,11];case 9:return[4,U(I,"Color",c,d,Z,T)];case 10:na=l.sent(),l.label=11;case 11:ea.outlineColor=na;if(!C)return[3,12];wa=0;return[3,14];case 12:return[4,U(I,"Width",c,d,V)];case 13:wa=l.sent(),l.label=14;case 14:return ka.apply(ia,[(ea.outlineWidth=wa,ea.frameHeight=m,ea.rotateClockwise=a.rotateClockwise,ea.referenceSize=h,ea.sizeRatio=B,ea)]),[3,16];case 15:return R(a,b,c,d,e,g,h,m),[3,16];case 16:return[2]}})};z.label=1;case 1:return x--?[5,w()]:
[3,3];case 2:return z.sent(),[3,1];case 3:return[2]}})})}function R(a,b,c,d,e,g,h,m){return k(this,void 0,void 0,function(){var k,r,q,u,v,y,x,w,t,z,B,n,L,C,M,R;return l(this,function(l){switch(l.label){case 0:k={type:a.type,enable:!0,name:a.name,colorLocked:a.colorLocked,primitiveName:a.primitiveName,anchorPoint:a.anchorPoint,anchorPointUnits:a.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:a.rotateClockwise,rotation:0,size:a.size,billboardMode3D:a.billboardMode3D,depth3D:a.depth3D,frame:a.frame,
markerGraphics:[b],scaleSymbolsProportionally:a.scaleSymbolsProportionally,respectFrame:a.respectFrame,clippingPath:a.clippingPath};r=[];q=["Rotation","OffsetX","OffsetY"];r=c.filter(function(b){return b.primitiveName===a.primitiveName&&-1===q.indexOf(b.propertyName)});u=f.CIMSymbolHelper.getTextureAnchor(k);v=u[0];y=u[1];x=JSON.stringify(k);w=a.primitiveName;t=a.rotation;z=a.offsetX;B=a.offsetY;n=p.hashString(JSON.stringify(k)).toString();C=(L=e).push;M={type:"marker",templateHash:n};if(0!==r.length)return[3,
1];R=n;return[3,3];case 1:return[4,P(x,r,d)];case 2:R=l.sent(),l.label=3;case 3:return M.materialHash=R,M.cim=k,M.materialOverrides=r,M.colorLocked=a.colorLocked,M.scaleSymbolsProportionally=a.scaleSymbolsProportionally,M.alignment=g,M.anchorPoint={x:v,y:y},M.isAbsoluteAnchorPoint=!1,M.size=a.size,M.scaleX=1,[4,U(w,"Rotation",c,d,t)];case 4:return M.rotation=l.sent(),[4,U(w,"OffsetX",c,d,z)];case 5:return M.offsetX=l.sent(),[4,U(w,"OffsetY",c,d,B)];case 6:return C.apply(L,[(M.offsetY=l.sent(),M.color=
{r:0,g:0,b:0,a:0},M.outlineColor={r:0,g:0,b:0,a:0},M.outlineWidth=0,M.frameHeight=m,M.rotateClockwise=a.rotateClockwise,M.referenceSize=h,M.sizeRatio=1,M)]),[2]}})})}function S(a){return a&&0===a.indexOf("Level_")?parseInt(a.substr(6),10):0}function T(b){if(!b||0===b.length)return null;b=(new a(b)).toRgba();return{r:b[0],g:b[1],b:b[2],a:b[3]}}function U(a,b,c,e,f,g){return k(this,void 0,void 0,function(){var h,k,m,p,q;return l(this,function(u){switch(u.label){case 0:if(!a)return[3,4];h=function(c){var h,
k,m;return l(this,function(p){switch(p.label){case 0:if(c.primitiveName!==a||c.propertyName!==b)return[3,2];if(void 0!==c.value)return[2,{value:g?g(c.value):c.value}];h=c.valueExpressionInfo;if(!h)return[3,2];k=h.expression;return[4,d.createRendererExpression(k,e.spatialReference,e.fields)];case 1:return m=p.sent(),[2,{value:function(a,b,c){a=r.callWithFeature(m,a,{$view:c},e.geometryType,b);null!==a&&g&&(a=g(a));return null!==a?a:f}}];case 2:return[2]}})};k=0;m=c;u.label=1;case 1:if(!(k<m.length))return[3,
4];p=m[k];return[5,h(p)];case 2:q=u.sent();if("object"===typeof q)return[2,q.value];u.label=3;case 3:return k++,[3,1];case 4:return[2,f]}})})}function Y(a,b){switch(b){case "LowerCase":return a.toLowerCase();case "Allcaps":return a.toUpperCase();default:return a}}function X(a,b,c,d){if(!a||-1===c.indexOf("["))return Y(c,d);b=function(a){for(var b=a.length;b--;)if(-1===" /-,\n".indexOf(a.charAt(b)))return!1;return!0};var e=[],f=0,g=-1;do g=c.indexOf("[",f),g>=f&&(g>f&&(f=c.substr(f,g-f),e.push([f,
null,b(f)])),f=g+1,g=c.indexOf("]",f),g>=f&&(g>f&&(f=c.substr(f,g-f),(f=a[f])&&e.push([null,f,!1])),f=g+1));while(-1!==g);f<c.length-1&&(f=c.substr(f),e.push([f,null,b(f)]));return function(a,b,c){b="";c=null;for(var f=0;f<e.length;f++){var g=e[f],h=g[0],k=g[1],g=g[2];if(h)g?c=h:(c&&(b+=c,c=null),b+=h);else if(h=a.attributes[k])c&&(b+=c,c=null),b+=h}return Y(b,d)}}function P(a,b,c){return k(this,void 0,void 0,function(){var e,g,h,k;return l(this,function(m){switch(m.label){case 0:e=function(a){var b,
e,f;return l(this,function(g){switch(g.label){case 0:b=a.valueExpressionInfo;if(!b)return[3,2];e=b.expression;return[4,d.createRendererExpression(e,c.spatialReference,c.fields)];case 1:f=g.sent(),a.fn=function(a,b,d){return r.callWithFeature(f,a,{$view:d},c.geometryType,b)},g.label=2;case 2:return[2]}})},g=0,h=b,m.label=1;case 1:if(!(g<h.length))return[3,4];k=h[g];return[5,e(k)];case 2:m.sent(),m.label=3;case 3:return g++,[3,1];case 4:return[2,function(c,d,e){for(var g=0;g<b.length;g++){var h=b[g];
h.fn&&(h.value=h.fn(c,d,e))}return p.hashString(a+f.OverrideHelper.buildOverrideKey(b)).toString()}]}})})}Object.defineProperty(b,"__esModule",{value:!0});var V=g.getLogger("esri.symbols.cim.cimAnalyzer");b.analyzeCIMSymbol=function(a,b,c,d,e){return k(this,void 0,void 0,function(){var f,g,h,k;return l(this,function(m){switch(m.label){case 0:f=d?d:[];if(!a)return[2,f];"CIMSymbolReference"===a.type?(g=a.symbol,h=a.primitiveOverrides):(g=a,h=null);k=g.type;switch(k){case "CIMPointSymbol":return[3,1];
case "CIMLineSymbol":return[3,1];case "CIMPolygonSymbol":return[3,1];case "CIMTextSymbol":return[3,3]}return[3,4];case 1:return[4,v(g,h,b,c,f,e)];case 2:return m.sent(),[3,4];case 3:return[3,4];case 4:return[2,f]}})})};b.analyzeCIMResource=function(a,b,c){if(!c||0===c.length)return b;a=JSON.parse(JSON.stringify(b));f.OverrideHelper.applyOverrides(a,c);return a};b.applyCIMLayerProperties=function(a,b){}})},"esri/symbols/cim/CIMSymbolHelper":function(){define("require exports ../../Color ../../core/Logger ../../geometry/support/jsonUtils ../cim/CIMCursor ../cim/CIMEffects ../cim/CIMOperators ../cim/CIMPlacements ./CIMSymbolDrawHelper ./packingUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){function q(a,b){switch(b.type){case "CIMSymbolReference":var c={type:"point",x:0,y:0};a.drawSymbol(b.symbol,c);break;case "CIMPointSymbol":c={type:"point",x:0,y:0};a.drawSymbol(b,c);break;case "CIMVectorMarker":c=new d.Placement,a.drawMarker(b,c)}return a.envelope()}Object.defineProperty(b,"__esModule",{value:!0});var p=Math.PI,r=p/2,t=k.getLogger("esri.symbols.cim.CIMSymbolHelper");n=function(){function b(){}b.getEnvelope=function(a){var b=new f.EnvDrawHelper;if(Array.isArray(a)){for(var c=
void 0,d=0;d<a.length;d++){var e=a[d];c?c.union(q(b,e)):c=q(b,e)}return c}return q(b,a)};b.getTextureAnchor=function(a){a=this.getEnvelope(a);if(!a||0>=a.width||0>=a.height)return[0,0];var b=96/72;return[(a.x+.5*a.width)*b/(a.width*b+2),-(a.y+.5*a.height)*b/(a.height*b+2)]};b.rasterize=function(a,b,c){void 0===c&&(c=!0);var e=this.getEnvelope(b);if(!e||0>=e.width||0>=e.height)return[null,0,0];var g=96/72,h=(e.x+.5*e.width)*g,k=-(e.y+.5*e.height)*g;a.width=e.width*g+2;a.height=e.height*g+2;e=a.getContext("2d");
g=f.Transformation.createScale(g,-g);g.translate(.5*a.width-h,.5*a.height-k);h=new f.CanvasDrawHelper(e,g);switch(b.type){case "CIMPointSymbol":h.drawSymbol(b,{type:"point",x:0,y:0});break;case "CIMVectorMarker":k=new d.Placement,h.drawMarker(b,k)}b=e.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);if(c)for(c=void 0,e=0;e<b.length;e+=4)c=b[e+3]/255,b[e]*=c,b[e+1]*=c,b[e+2]*=c;return[b,a.width,a.height]};b.fromSimpleMarker=function(a){var b,c,d=a.style;if("circle"===d||"esriSMSCircle"===
d){b=Math.acos(.995);c=Math.ceil(p/b/4);0===c&&(c=1);b=r/c;c*=4;d=[];d.push([50,0]);for(var e=1;e<c;e++)d.push([50*Math.cos(e*b),-50*Math.sin(e*b)]);d.push([50,0]);b={rings:[d]};c={xmin:-50,ymin:-50,xmax:50,ymax:50}}else if("cross"===d||"esriSMSCross"===d)b=0,b={rings:[[[b,50],[b,b],[50,b],[50,-b],[b,-b],[b,-50],[-b,-50],[-b,-b],[-50,-b],[-50,b],[-b,b],[-b,50],[b,50]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("diamond"===d||"esriSMSDiamond"===d)b={rings:[[[-50,0],[0,50],[50,0],[0,-50],[-50,
0]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("square"===d||"esriSMSSquare"===d)b={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],[-50,-50]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("x"===d||"esriSMSX"===d)b=0,b={rings:[[[0,b],[50-b,50],[50,50-b],[b,0],[50,b-50],[50-b,-50],[0,-b],[b-50,-50],[-50,b-50],[-b,0],[-50,50-b],[b-50,50],[0,b]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("triangle"===d||"esriSMSTriangle"===d)c=2/3*100,d=c-100,b={rings:[[[-57.735026918962575,d],[0,c],[57.735026918962575,
d],[-57.735026918962575,d]]]},c={xmin:-57.735026918962575,ymin:d,xmax:57.735026918962575,ymax:c};var f;b&&c&&(f=[{type:"CIMSolidFill",enable:!0,color:a.color}],a.outline&&f.push({type:"CIMSolidStroke",enable:!0,width:a.outline.width,color:a.outline.color}),f={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:a.angle,size:a.size,offsetX:a.xoffset,offsetY:a.yoffset,frame:c,markerGraphics:[{type:"CIMMarkerGraphic",geometry:b,symbol:{type:"CIMPolygonSymbol",symbolLayers:f}}]}]});
return f};b.getFillColor=function(a){if(!a)return null;switch(a.type){case "CIMPolygonSymbol":if(a.symbolLayers){var c=0;for(a=a.symbolLayers;c<a.length;c++){var d=b.getFillColor(a[c]);if(null!=d)return d}}break;case "CIMTextSymbol":return b.getFillColor(a.symbol);case "CIMSolidFill":return a.color}};b.getStrokeColor=function(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a.symbolLayers){var c=0;for(a=a.symbolLayers;c<a.length;c++){var d=b.getStrokeColor(a[c]);if(void 0!==
d)return d}}break;case "CIMTextSymbol":return b.getStrokeColor(a.symbol);case "CIMSolidStroke":return a.color}};b.getStrokeWidth=function(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a.symbolLayers){var c=0;for(a=a.symbolLayers;c<a.length;c++){var d=b.getStrokeWidth(a[c]);if(void 0!==d)return d}}break;case "CIMTextSymbol":return b.getStrokeWidth(a.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return a.width}};b.getSize=function(a){if(a)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":var c=
0;if(a.symbolLayers){var d=0;for(a=a.symbolLayers;d<a.length;d++){var e=b.getSize(a[d]);e>c&&(c=e)}}return c;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":return a.width;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":return a.size}};b.getMarkerScaleRatio=function(a){if(a)switch(a.type){case "CIMVectorMarker":if(!1!==a.scaleSymbolsProportionally&&a.frame)return a.size/(a.frame.ymax-a.frame.ymin)}return 1};b.executeEffects=function(a,b,c){void 0===
c&&(c=!1);var d=96/72,f=a?a.length:0;f&&c&&--f;for(c=0;c<f;++c){var g=a[c];if(g){var h=e.getEffectOperator(g);h&&(b=h.execute(b,g,d))}}return b};b.processEffects=function(c,d,e){var f;c.effects&&0<c.effects.length&&(f=a.deltaEncodeGeometry(e),f=new g.SimpleGeometryCursor(f),f=b.executeEffects(c.effects,f));c=c.symbolLayers[d];c.effects&&0<c.effects.length&&(d=!1,"CIMGeometricEffectDashes"===c.effects[c.effects.length-1].type&&(d=!0),f||(f=a.deltaEncodeGeometry(e),f=new g.SimpleGeometryCursor(f)),
f=b.executeEffects(c.effects,f,d));if(!f)return e;e=[];for(c=f.next();c;)e.push(c),c=f.next();f=e.length;switch(f){case 0:return null;case 1:return a.deltaEncodeGeometry(e[0]);default:c=e[0];for(d=1;d<f;++d){var k=e[d];h.isPolygon(c)&&h.isPolygon(k)&&Array.prototype.push.apply(c.rings,k.rings);h.isPolyline(c)&&h.isPolyline(k)&&Array.prototype.push.apply(c.paths,k.paths)}return a.deltaEncodeGeometry(c)}};return b}();b.CIMSymbolHelper=n;n=function(){function a(){}a.rasterizeSimpleFill=function(a,b){"solid"!==
b&&"none"!==b&&"esriSFSSolid"!==b&&"esriSFSNull"!==b||console.error("Unexpected: style does not require rasterization");a.width=8;a.height=8;var c=a.getContext("2d");c.strokeStyle="#FFFFFF";c.lineWidth=1;c.beginPath();if("vertical"===b||"cross"===b||"esriSFSCross"===b||"esriSFSVertical"===b)c.moveTo(0,0),c.lineTo(0,8);if("horizontal"===b||"cross"===b||"esriSFSCross"===b||"esriSFSHorizontal"===b)c.moveTo(0,0),c.lineTo(8,0);if("forward-diagonal"===b||"diagonal-cross"===b||"esriSFSDiagonalCross"===b||
"esriSFSForwardDiagonal"===b)c.moveTo(0,0),c.lineTo(8,8);if("backward-diagonal"===b||"diagonal-cross"===b||"esriSFSBackwardDiagonal"===b||"esriSFSDiagonalCross"===b)c.moveTo(8,0),c.lineTo(0,8);c.stroke();b=c.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);for(var d=0;d<b.length;d+=4)c=b[d+3]/255,b[d]*=c,b[d+1]*=c,b[d+2]*=c;return[b,a.width,a.height]};a.rasterizeSimpleLine=function(a,b,c){switch(c){case "butt":c="Butt";break;case "square":c="Square";break;default:c="Round"}var d="Butt"===
c;switch(b){case "dash":case "esriSLSDash":b=d?[4,3]:[3,4];break;case "dash-dot":case "esriSLSDashDot":b=d?[4,3,1,3]:[3,4,0,4];break;case "dot":case "esriSLSDot":b=d?[1,3]:[0,4];break;case "long-dash":case "esriSLSLongDash":b=d?[8,3]:[7,4];break;case "long-dash-dot":case "esriSLSLongDashDot":b=d?[8,3,1,3]:[7,4,0,4];break;case "long-dash-dot-dot":case "esriSLSDashDotDot":b=d?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case "short-dash":case "esriSLSShortDash":b=d?[4,1]:[3,2];break;case "short-dash-dot":case "esriSLSShortDashDot":b=
d?[4,1,1,1]:[3,2,0,2];break;case "short-dash-dot-dot":case "esriSLSShortDashDotDot":b=d?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case "short-dot":case "esriSLSShortDot":b=d?[1,1]:[0,2];break;case "solid":case "esriSLSSolid":case "none":t.error("Unexpected: style does not require rasterization");b=[0,0];break;default:t.error("Tried to rasterize SLS, but found an unexpected style: "+b+"!"),b=[0,0]}return this.rasterizeDash(a,b,c)};a.rasterizeDash=function(a,b,d){a="Butt"===d;var e="Square"===d;d=!a&&!e;for(var f=
0,g=0;g<b.length;g++)var h=b[g],f=f+h;for(var f=15*f,k=31*f,g=new Float32Array(k),p=d?225:15,h=0;h<k;++h)g[h]=p;for(var p=k=0,r=!0,q=0;q<b.length;q++){for(var h=b[q],k=p,p=p+15*h,l=k;l<p;){for(var u=0;31>u;){var h=u*f+l,y=d?(u-15)*(u-15):Math.abs(u-15);g[h]=r?a?Math.max(Math.max(k+7.5-l,y),Math.max(l-p+7.5,y)):y:d?Math.min((l-k)*(l-k)+y,(l-p)*(l-p)+y):e?Math.min(Math.max(l-k,y),Math.max(p-l,y)):Math.min(Math.max(l-k+7.5,y),Math.max(p+7.5-l,y));u++}l++}r=!r}b=g.length;a=new Uint8Array(4*b);for(h=0;h<
b;++h)c.packFloatRGBA((d?Math.sqrt(g[h]):g[h])/15,a,4*h);return[a,f,31]};return a}();b.SymbolHelper=n;n=function(){function a(){}a.findApplicableOverrides=function(b,c,d){if(c){if(b.primitiveName){for(var e=!1,f=0;f<d.length;f++){var g=d[f];if(g.primitiveName===b.primitiveName){e=!0;break}}if(!e)for(e=0;e<c.length;e++)g=c[e],g.primitiveName===b.primitiveName&&d.push(g)}switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(b.effects)for(e=0,f=b.effects;e<f.length;e++)g=
f[e],a.findApplicableOverrides(g,c,d);if(b.symbolLayers)for(g=0,b=b.symbolLayers;g<b.length;g++)a.findApplicableOverrides(b[g],c,d);break;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMSolidFill":case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":if(b.effects)for(e=0,f=b.effects;e<f.length;e++)g=f[e],a.findApplicableOverrides(g,c,d);b.markerPlacement&&a.findApplicableOverrides(b.markerPlacement,
c,d);if("CIMVectorMarker"===b.type){if(b.markerGraphics)for(g=0,b=b.markerGraphics;g<b.length;g++)e=b[g],a.findApplicableOverrides(e,c,d),a.findApplicableOverrides(e.symbol,c,d)}else"CIMCharacterMarker"===b.type?a.findApplicableOverrides(b.symbol,c,d):"CIMHatchFill"===b.type&&a.findApplicableOverrides(b.lineSymbol,c,d)}}};a.applyOverrides=function(b,c,d,e){if(c){if(b.primitiveName)for(var f=0;f<c.length;f++){var g=c[f];if(g.primitiveName===b.primitiveName){var h;h=(h=g.propertyName)?h.charAt(0).toLowerCase()+
h.substr(1):h;e&&e.push({cim:b,nocapPropertyName:h,value:b[h]});g.expression&&(g.value=a.toValue(g.propertyName,g.expression));if(d){for(var k=!1,m=0,p=d;m<p.length;m++)p[m].primitiveName===b.primitiveName&&(k=!0);k||d.push(g)}b[h]=g.value}}switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(b.effects)for(g=0,h=b.effects;g<h.length;g++)f=h[g],a.applyOverrides(f,c,d,e);if(b.symbolLayers)for(f=0,b=b.symbolLayers;f<b.length;f++)a.applyOverrides(b[f],c,d,e);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(b.effects)for(g=
0,h=b.effects;g<h.length;g++)f=h[g],a.applyOverrides(f,c,d,e);if("CIMVectorMarker"===b.type&&b.markerGraphics)for(f=0,b=b.markerGraphics;f<b.length;f++)g=b[f],a.applyOverrides(g,c,d,e),a.applyOverrides(g.symbol,c,d,e)}}};a.restoreOverrides=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.cim[c.nocapPropertyName]=c.value}};a.buildOverrideKey=function(a){for(var b="",c=0;c<a.length;c++){var d=a[c];void 0!==d.value&&(b+=""+d.primitiveName+d.propertyName+JSON.stringify(d.value))}return b};a.toValue=
function(a,b){return"DashTemplate"===a?b.split(" ").map(function(a){return Number(a)}):"Color"===a?(a=(new l(b)).toRgba(),a[3]*=255,a):b};return a}();b.OverrideHelper=n})},"esri/symbols/cim/CIMCursor":function(){define(["require","exports","../../geometry/support/jsonUtils","./CIMPlacements"],function(n,b,l,k){function h(a){if(a)for(var b=a.length-1;0<b;--b)a[b][0]-=a[b-1][0],a[b][1]-=a[b-1][1]}function a(a){if(a)for(var b=0;b<a.length;b++)h(a[b])}function g(a){if(a)for(var b=a.length,c=1;c<b;++c)a[c][0]+=
a[c-1][0],a[c][1]+=a[c-1][1]}function e(a){if(a)for(var b=0;b<a.length;b++)g(a[b])}function d(a){a&&a.reverse()}function f(a){return{rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]}}Object.defineProperty(b,"__esModule",{value:!0});b.deltaEncodePath=h;b.deltaEncodeMultipath=a;b.deltaDecodeGeometry=function(a){l.isPolygon(a)?e(a.rings):l.isPolyline(a)?e(a.paths):l.isMultipoint(a)&&g(a.points);return a};b.deltaEncodeGeometry=function(b){l.isPolygon(b)?a(b.rings):
l.isPolyline(b)?a(b.paths):l.isMultipoint(b)&&h(b.points);return b};b.reverseMultipath=function(a){if(a)for(var b=0;b<a.length;b++)d(a[b])};b.reversePath=d;b.getCoord2D=function(a,b,d){return[a[0]+(b[0]-a[0])*d,a[1]+(b[1]-a[1])*d]};b.isClosedPath=function(a){return a&&0!==a.length?a[0][0]===a[a.length-1][0]&&a[0][1]===a[a.length-1][1]:!1};b.getId=function(a){return a[4]};b.setId=function(a,b){a[4]=b};n=function(){function a(a,b,c,d){this.acceptPolygon=b;this.acceptPolyline=c;this.geomUnitsPerPoint=
d;this.pathIndex=this.pathCount=-1;this.iteratePath=!1;a&&(l.isPolygon(a)?b&&(this.multiPath=a.rings,this.isClosed=!0):l.isPolyline(a)?c&&(this.multiPath=a.paths,this.isClosed=!1):l.isExtent(a)&&b&&(this.multiPath=f(a).rings,this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length));this.internalPlacement=new k.Placement}a.prototype.next=function(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var a=this.processPath(this.multiPath[this.pathIndex]);
if(a)return a}this.pathIndex=this.pathCount=-1;return this.multiPath=null};a.prototype.processPath=function(a){return null};return a}();b.PathTransformationCursor=n;n=function(){function a(a,b,c,d){this.inputGeometries=a;this.acceptPolygon=b;this.acceptPolyline=c;this.geomUnitsPerPoint=d;this.pathIndex=this.pathCount=-1;this.iteratePath=!1}a.prototype.next=function(){for(;;){if(!this.multiPath){for(var a=this.inputGeometries.next();a;)if(l.isPolygon(a)?this.acceptPolygon&&(this.multiPath=a.rings,
this.isClosed=!0):l.isPolyline(a)?this.acceptPolyline&&(this.multiPath=a.paths,this.isClosed=!1):l.isExtent(a)&&this.acceptPolygon&&(this.multiPath=f(a).rings,this.isClosed=!0),this.multiPath){this.pathCount=this.multiPath.length;this.pathIndex=-1;break}else a=this.inputGeometries.next();if(!this.multiPath)return null}for(;this.iteratePath||this.pathIndex<this.pathCount-1;)if(this.iteratePath||this.pathIndex++,a=this.processPath(this.multiPath[this.pathIndex]))return a;this.pathIndex=this.pathCount=
-1;this.multiPath=null}};a.prototype.processPath=function(a){return null};return a}();b.PathGeometryCursor=n})},"esri/symbols/cim/CIMPlacements":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.setIdentity()}b.prototype.setIdentity=function(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rz_c=1;this.rz_s=0};b.prototype.setTranslate=function(b,h){this.tx=b;this.ty=h};b.prototype.setTranslateZ=function(b){this.tz=
b};b.prototype.setRotateCS=function(b,h){this.rz=void 0;this.rz_c=b;this.rz_s=h};b.prototype.setRotate=function(b){this.rz=b;this.rz_s=this.rz_c=void 0};b.prototype.setRotateY=function(b){this.ry=b};b.prototype.setScale=function(b){this.s=b};b.prototype.setMeasure=function(b){this.m=b};return b}();b.Placement=n;n=function(){function b(b){}b.prototype.next=function(){return null};return b}();b.EmptyPlacementCursor=n})},"esri/symbols/cim/CIMEffects":function(){define(["require","exports","../../core/lang"],
function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._geometry=b}b.prototype.next=function(){var b=this._geometry;this._geometry=null;return b};return b}();b.SimpleGeometryCursor=n;b.clone=function(b){return l.clone(b)}})},"esri/symbols/cim/CIMOperators":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.getEffectOperator=function(b){return null};b.getPlacementOperator=function(b){return null}})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/Logger ../../geometry/support/jsonUtils ../cim/CIMEffects ../cim/CIMOperators ../cim/CIMPlacements ./Rect".split(" "),
function(n,b,l,k,h,a,g,e,d,f){Object.defineProperty(b,"__esModule",{value:!0});b.C_DEG_TO_RAD=Math.PI/180;var c=h.getLogger("esri.symbols.cim.CIMSymbolDrawHelper"),q=function(){function a(a){this._t=a}a.createIdentity=function(){return new a([1,0,0,0,1,0])};a.prototype.clone=function(){return new a(this._t.slice())};a.prototype.transform=function(a){var b=this._t;return[b[0]*a[0]+b[1]*a[1]+b[2],b[3]*a[0]+b[4]*a[1]+b[5]]};a.createScale=function(b,c){return new a([b,0,0,0,c,0])};a.prototype.scale=function(a,
b){var c=this._t;c[0]*=a;c[1]*=a;c[2]*=a;c[3]*=b;c[4]*=b;c[5]*=b;return this};a.prototype.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};a.createTranslate=function(b,c){return new a([0,0,b,0,0,c])};a.prototype.translate=function(a,b){var c=this._t;c[2]+=a;c[5]+=b;return this};a.createRotate=function(b){var c=Math.cos(b);b=Math.sin(b);return new a([c,-b,0,b,c,0])};a.prototype.rotate=function(b){return this.multiply(a.createRotate(b))};a.prototype.multiply=function(a){var b=
this._t;a=a._t;var c=b[1]*a[0]+b[4]*a[1],d=b[2]*a[0]+b[5]*a[1]+a[2],e=b[0]*a[3]+b[3]*a[4],f=b[1]*a[3]+b[4]*a[4],g=b[2]*a[3]+b[5]*a[4]+a[5];b[0]=b[0]*a[0]+b[3]*a[1];b[1]=c;b[2]=d;b[3]=e;b[4]=f;b[5]=g;return this};return a}();b.Transformation=q;n=function(){function a(a){this._transfos=[];this._sizeTransfos=[];this._transfos.push(a||q.createIdentity());this._sizeTransfos.push(a?a.scaleRatio():1)}a.prototype.transformPt=function(a){return this._transfos[this._transfos.length-1].transform(a)};a.prototype.transformSize=
function(a){return a*this._sizeTransfos[this._sizeTransfos.length-1]};a.prototype.back=function(){return this._transfos[this._transfos.length-1]};a.prototype.push=function(a){var b=a.scaleRatio();a.multiply(this.back());this._transfos.push(a);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*b)};a.prototype.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)};a.prototype.drawSymbol=function(a,b){if(a)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(a,
b)}};a.prototype.drawMultiLayerSymbol=function(a,b){if(a){var c=a.symbolLayers;if(c)if(a=a.effects){if(b=this.executeEffects(a,b))for(a=b.next();a;)this.drawSymbolLayers(c,a),a=b.next()}else this.drawSymbolLayers(c,b)}};a.prototype.executeEffects=function(a,b){var c=96/72;b=new g.SimpleGeometryCursor(b);for(var d=a?a.length:0,f=0;f<d;++f){var h=a[f];if(h){var k=e.getEffectOperator(h);k&&(b=k.execute(b,h,c))}}return b};a.prototype.drawSymbolLayers=function(a,b){for(var c=a.length;c--;){var d=a[c];
if(d&&!1!==d.enable){var e=d.effects;if(e){if(e=this.executeEffects(e,b))for(var f=e.next();f;)this.drawSymbolLayer(d,f),f=e.next()}else this.drawSymbolLayer(d,b)}}};a.prototype.drawSymbolLayer=function(a,b){switch(a.type){case "CIMSolidFill":this.drawSolidFill(b,a.color);break;case "CIMSolidStroke":this.drawSolidStroke(b,a.color,a.width);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(a,b)}};a.prototype.drawMarkerLayer=function(a,b){var c=a.markerPlacement;
if(c){var f=96/72,g=e.getPlacementOperator(c);if(g&&(b=g.execute(b,c,f)))for(c=b.next();c;)this.drawMarker(a,c),c=b.next()}else c=new d.Placement,c.tx=b.x,c.ty=b.y,this.drawMarker(a,c)};a.prototype.drawMarker=function(a,b){switch(a.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(a,b);break;case "CIMVectorMarker":this.drawVectorMarker(a,b)}};a.prototype.drawPictureMarker=function(a,b){};a.prototype.drawVectorMarker=function(a,d){if(a){var e=a.markerGraphics;if(e){var f=
a.size,g=a.frame,h=g?g.ymax-g.ymin:0,f=f&&h?f/h:1,h=q.createIdentity();g&&h.translate(.5*-(g.xmax+g.xmin),.5*-(g.ymax+g.ymin));var k=a.anchorPoint;if(k){var p=k.x,k=k.y;"Absolute"!==a.anchorPointUnits&&g&&(p*=g.xmax-g.xmin,k*=g.ymax-g.ymin);h.translate(-p,-k)}1!==f&&h.scale(f,f);a.rotation&&h.rotate(a.rotation*b.C_DEG_TO_RAD);h.translate(a.offsetX||0,a.offsetY||0);h.translate(d.tx,d.ty);this.push(h);for(a=0;a<e.length;a++)(d=e[a])&&d.symbol&&d.geometry||c.error("Invalid marker graphic",d),this.drawSymbol(d.symbol,
d.geometry);this.pop()}}};a.prototype.drawSolidFill=function(a,b){};a.prototype.drawSolidStroke=function(a,b,c){};return a}();b.CIMSymbolDrawHelper=n;k=function(b){function c(){var a=b.call(this)||this;a.reset();return a}l(c,b);c.prototype.reset=function(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity};c.prototype.envelope=function(){return new f.default(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};c.prototype._merge=function(a,b){a[0]-b<this._xmin&&(this._xmin=
a[0]-b);a[0]+b>this._xmax&&(this._xmax=a[0]+b);a[1]-b<this._ymin&&(this._ymin=a[1]-b);a[1]+b>this._ymax&&(this._ymax=a[1]+b)};c.prototype.drawSolidFill=function(a,b){if(a&&a.rings)for(b=0,a=a.rings;b<a.length;b++){var c=a[b],d=c?c.length:0;if(2<d){this._merge(this.transformPt(c[0]),0);for(var e=1;e<d;++e)this._merge(this.transformPt(c[e]),0)}}};c.prototype.drawSolidStroke=function(b,c,d){c=.5*this.transformSize(d);if(b=a.isPolygon(b)?b.rings:b.paths)for(d=0;d<b.length;d++){var e=b[d],f=e?e.length:
0;if(1<f){this._merge(this.transformPt(e[0]),c);for(var g=1;g<f;++g)this._merge(this.transformPt(e[g]),c)}}};return c}(n);b.EnvDrawHelper=k;n=function(b){function c(a,c){c=b.call(this,c)||this;c._ctx=a;return c}l(c,b);c.prototype.drawSolidFill=function(a,b){if(a&&a.rings){var c=this._ctx;c.fillStyle="string"===typeof b?b:"rgba("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+","+b[3]/255+")";c.beginPath();b=0;for(a=a.rings;b<a.length;b++){var d=a[b],e=d?d.length:0;if(2<e){var f=this.transformPt(d[0]);
c.moveTo(f[0],f[1]);for(var g=1;g<e;++g)f=this.transformPt(d[g]),c.lineTo(f[0],f[1]);c.closePath()}}c.fill("evenodd")}};c.prototype.drawSolidStroke=function(b,c,d){var e=this._ctx;e.strokeStyle="string"===typeof c?c:"rgba("+Math.round(c[0])+","+Math.round(c[1])+","+Math.round(c[2])+","+c[3]/255+")";e.lineWidth=this.transformSize(d)+.5;e.beginPath();c=!1;a.isPolygon(b)?(d=b.rings,c=!0):d=b.paths;for(b=0;b<d.length;b++){var f=d[b],g=f?f.length:0;if(1<g){var h=this.transformPt(f[0]);e.moveTo(h[0],h[1]);
for(var k=1;k<g;++k)h=this.transformPt(f[k]),e.lineTo(h[0],h[1]);c&&e.closePath()}}e.stroke()};return c}(n);b.CanvasDrawHelper=n})},"esri/symbols/cim/Rect":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,h,a,g){void 0===b&&(b=0);void 0===h&&(h=0);void 0===a&&(a=0);void 0===g&&(g=0);this.x=b;this.y=h;this.width=a;this.height=g}Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},
enumerable:!0,configurable:!0});b.prototype.union=function(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);this.width=Math.max(this.width,b.width);this.height=Math.max(this.height,b.height)};return b}();b.default=n})},"esri/symbols/cim/packingUtils":function(){define(["require","exports"],function(n,b){function l(a){return a-Math.floor(a)}Object.defineProperty(b,"__esModule",{value:!0});var k=[1,256,65536,16777216],h=[1/256,1/65536,1/16777216,1/4294967296],a=function(a,b){void 0===b&&(b=
0);for(var d=0,e=0;4>e;e++)d+=a[b+e]*h[e];return d}(new Uint8ClampedArray([255,255,255,255]));b.packFloatRGBA=function(b,e,d){void 0===d&&(d=0);b=0>b?0:b>a?a:b;for(var f=0;4>f;f++)e[d+f]=Math.floor(256*l(b*k[f]))}})},"esri/symbols/cim/enums":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});(function(b){b[b.BUTT=0]="BUTT";b[b.ROUND=1]="ROUND";b[b.SQUARE=2]="SQUARE";b[b.UNKNOWN=4]="UNKNOWN"})(b.CapType||(b.CapType={}));(function(b){b[b.BEVEL=0]=
"BEVEL";b[b.ROUND=1]="ROUND";b[b.MITER=2]="MITER";b[b.UNKNOWN=4]="UNKNOWN"})(b.JoinType||(b.JoinType={}));(function(b){b[b.SCREEN=0]="SCREEN";b[b.MAP=1]="MAP"})(b.Alignment||(b.Alignment={}))})},"esri/symbols/cim/SDFHelper":function(){define(["require","exports","../../geometry/support/jsonUtils","./packingUtils","./Rect"],function(n,b,l,k,h){function a(b){if(!b)return null;switch(b.type){case "CIMPointSymbol":b=b.symbolLayers;if(!b||1!==b.length)break;return a(b[0]);case "CIMVectorMarker":b=b.markerGraphics;
if(!b||1!==b.length)break;var d=b[0];if(!d)break;b=d.geometry;if(!b)break;d=d.symbol;if(!d||"CIMPolygonSymbol"!==d.type&&"CIMLineSymbol"!==d.type)break;return{geom:b,asFill:"CIMPolygonSymbol"===d.type};case "sdf":return{geom:b.geom,asFill:b.asFill}}return null}function g(a){for(var b=Infinity,e=-Infinity,c=Infinity,g=-Infinity,h=0;h<a.length;h++)for(var k=0,l=a[h];k<l.length;k++){var x=l[k];x[0]<b&&(b=x[0]);x[0]>e&&(e=x[0]);x[1]<c&&(c=x[1]);x[1]>g&&(g=x[1])}return[b,c,e,g]}Object.defineProperty(b,
"__esModule",{value:!0});b.getSDFInfo=a;b.getSDFSymbol=function(a){a=a.markerGraphics;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;a=a.symbol;return!a||"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type?null:a};b.getExtent=function(a){return a?a.rings?g(a.rings):a.paths?g(a.paths):l.isExtent(a)?[a.xmin,a.ymin,a.xmax,a.ymax]:null:null};b.getSDFMetrics=function(a,b,f,c,g){var d=a[0],e=a[1],h=a[2];a=a[3];if(h<d||a<e)return[0,0,0];var k=h-d,q=a-e,h=Math.floor(31.5);a=(128-2*(h+1))/Math.max(k,
q);var k=Math.round(k*a),q=Math.round(q*a)+2*h,l=1;b&&(l=q/a/(b.ymax-b.ymin));var y=0,m=0;c&&(g?b&&f&&0<b.ymax-b.ymin&&(y=c.x/((b.xmax-b.xmin)/(b.ymax-b.ymin)*f),m=c.y/f):(y=c.x,m=c.y));y=.5*(b.xmax+b.xmin)+y*(b.xmax-b.xmin);m=.5*(b.ymax+b.ymin)+m*(b.ymax-b.ymin);y=(y-d)*a+h;m=(m-e)*a+h;return[l,y/(k+2*h)-.5,-(m/q-.5)]};b.buildSDF=function(a){var b,e=a.geom;b=e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,
e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null;var c,e=Infinity,g=-Infinity,p=Infinity,r=-Infinity;for(c=0;c<b.length;c++)for(var l=0,x=b[c];l<x.length;l++){var w=x[l];w[0]<e&&(e=w[0]);w[0]>g&&(g=w[0]);w[1]<p&&(p=w[1]);w[1]>r&&(r=w[1])}c=new h.default(e,p,g-e,r-p);p=Math.floor(31.5);l=(128-2*(p+1))/Math.max(c.width,c.height);e=Math.round(c.width*l)+2*p;g=Math.round(c.height*l)+2*p;r=[];for(x=0;x<b.length;x++){var u=b[x];if(u&&1<u.length){for(var w=[],y=0;y<u.length;y++){var m=u[y],v=m[0],m=m[1],
v=v-c.x,m=m-c.y,v=v*l,m=m*l,v=v+(p-.5),m=m+(p-.5);w.push([v,m])}a.asFill&&(y=w.length-1,w[0][0]===w[y][0]&&w[0][1]===w[y][1]||w.push(w[0]));r.push(w)}}c=e*g;b=Array(c);x=p*p+1;for(l=0;l<c;++l)b[l]=x;for(x=0;x<r.length;x++)for(w=r[x],y=w.length,l=1;l<y;++l){var u=w[l-1],v=w[l],z=void 0,m=void 0;u[0]<v[0]?(z=u[0],m=v[0]):(z=v[0],m=u[0]);var B=void 0,n=void 0;u[1]<v[1]?(B=u[1],n=v[1]):(B=v[1],n=u[1]);var D=Math.floor(z)-p,m=Math.floor(m)+p,B=Math.floor(B)-p,n=Math.floor(n)+p;0>D&&(D=0);m>e&&(m=e);0>
B&&(B=0);n>g&&(n=g);for(var z=v[0]-u[0],K=v[1]-u[1],I=z*z+K*K;D<m;D++)for(var Q=B;Q<n;Q++){var J=(D-u[0])*z+(Q-u[1])*K,N=void 0,L=void 0;0>J?(N=u[0],L=u[1]):J>I?(N=v[0],L=v[1]):(J/=I,N=u[0]+J*z,L=u[1]+J*K);J=(D-N)*(D-N)+(Q-L)*(Q-L);N=(g-Q-1)*e+D;J<b[N]&&(b[N]=J)}}for(l=0;l<c;++l)b[l]=Math.sqrt(b[l]);if(a.asFill)for(a=0;a<r.length;a++)for(c=r[a],l=c.length,x=1;x<l;++x)for(w=c[x-1],y=c[x],v=u=void 0,w[0]<y[0]?(u=w[0],v=y[0]):(u=y[0],v=w[0]),m=B=void 0,w[1]<y[1]?(B=w[1],m=y[1]):(B=y[1],m=w[1]),u=Math.floor(u),
v=Math.floor(v)+1,B=Math.floor(B),m=Math.floor(m)+1,u<p&&(u=p),v>e-p&&(v=e-p),B<p&&(B=p),m>g-p&&(m=g-p);B<m;++B)if(w[1]>B!==y[1]>B){n=(g-B-1)*e;for(z=u;z<v;++z)z<(y[0]-w[0])*(B-w[1])/(y[1]-w[1])+w[0]&&(b[n+z]=-b[n+z]);for(z=p;z<u;++z)b[n+z]=-b[n+z]}p*=2;r=b.length;a=new Uint8Array(4*r);for(c=0;c<r;++c)k.packFloatRGBA(.5-b[c]/p,a,4*c);return[a,e,g]}})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.evaluateValueOrFunction=
function(b,k,h,a){return"function"===typeof b?b(k,h,a):b};b.hashString=function(b){for(var k=0,h=0;h<b.length;h++)k=(k<<5)-k+b.charCodeAt(h),k|=0;return k};b.colorToArray=function(b){return[b.r,b.g,b.b,b.a]};b.resampleHermite=function(b,k,h,a,g,e,d){void 0===d&&(d=!0);var f=k/g;h/=e;for(var c=Math.ceil(f/2),q=Math.ceil(h/2),p=0;p<e;p++)for(var r=0;r<g;r++){for(var l=4*(r+(d?e-p-1:p)*g),x=0,w=0,u=0,y=0,m=0,v=0,z=0,B=(p+.5)*h,n=Math.floor(p*h);n<(p+1)*h;n++)for(var D=Math.abs(B-(n+.5))/q,K=(r+.5)*f,
D=D*D,I=Math.floor(r*f);I<(r+1)*f;I++){var Q=Math.abs(K-(I+.5))/c,x=Math.sqrt(D+Q*Q);-1<=x&&1>=x&&(x=2*x*x*x-3*x*x+1,0<x&&(Q=4*(I+n*k),z+=x*b[Q+3],u+=x,255>b[Q+3]&&(x=x*b[Q+3]/250),y+=x*b[Q],m+=x*b[Q+1],v+=x*b[Q+2],w+=x))}a[l]=y/w;a[l+1]=m/w;a[l+2]=v/w;a[l+3]=z/u}}})},"esri/views/2d/arcade/utils":function(){define("require exports ../../../core/tsSupport/assignHelper @dojo/framework/shim/WeakMap ../../../core/Error ../../../core/Logger ../../../geometry/support/quantizationUtils ../../../layers/graphics/featureConversionUtils".split(" "),
function(n,b,l,k,h,a,g,e){function d(a,b,c,d){var e=d.transform,g=d.hasZ;d=d.hasM;q.has(a)||q.set(a,f(c));a=q.get(a)(b.geometry,e,g,d);return l({},b,{geometry:a})}function f(a){var b={};switch(a){case "esriGeometryPoint":return function(a,c,d,e){return g.hydratePoint(c,b,a,d,e)};case "esriGeometryPolygon":return function(a,c,d,e){return g.hydratePolygon(c,b,a,d,e)};case "esriGeometryPolyline":return function(a,c,d,e){return g.hydratePolyline(c,b,a,d,e)};case "esriGeometryMultipoint":return function(a,
c,d,e){return g.hydrateMultipoint(c,b,a,d,e)};default:return c.error(new h("mapview-arcade","Unable to handle geometryType: "+a)),function(a,b,c,d){return a}}}Object.defineProperty(b,"__esModule",{value:!0});var c=a.getLogger("esri.views.2d.support.arcadeOnDemand");b.callWithOptimizedFeature=function(a,b,f,g,h){var k=g.geometryType,p=g.hasZ;g=g.hasM;b=a.referencesGeometry()?h?d(a,e.convertToFeature(b,k,p,g),k,h):e.convertToFeature(b,k,p,g):b;b=a.repurposeFeature(b);try{return a.evaluate(l({},f,{$feature:b}))}catch(m){return c.warn("Feature arcade evaluation failed:",
m),null}};b.callWithFeature=function(a,b,e,f,g){b=a.referencesGeometry()&&g?d(a,b,f,g):b;b=a.repurposeFeature(b);try{return a.evaluate(l({},e,{$feature:b}))}catch(u){return c.warn("Feature arcade evaluation failed:",u),null}};var q=new k.default;b.createHydrateFactory=f})},"esri/symbols/cim/Rasterizer":function(){define(["require","exports","./CIMSymbolHelper","./SDFHelper","./utils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(){}a.prototype.dispose=
function(){this._rasterizationCanvas=null};a.prototype.rasterizeJSONResource=function(a,b){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===a.type||"esriSFS"===a.type)return b=l.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,a.style),{size:[b[1],b[2]],image:new Uint32Array(b[0].buffer),sdf:!1,simplePattern:!0};if("simple-line"===a.type||"esriSLS"===a.type)return b=l.SymbolHelper.rasterizeSimpleLine(this._rasterizationCanvas,a.style,
a.cap),{size:[b[1],b[2]],image:new Uint32Array(b[0].buffer),sdf:!0,simplePattern:!0};var d;a="simple-marker"===a.type||"esriSMS"===a.type?l.CIMSymbolHelper.fromSimpleMarker(a):a;if((d=k.getSDFInfo(a))&&!b)return b=k.buildSDF(d),(a=b[0])?{size:[b[1],b[2]],image:new Uint32Array(a.buffer),sdf:!0,simplePattern:!0}:null;b=l.CIMSymbolHelper.rasterize(this._rasterizationCanvas,a,!b);return(a=b[0])?{size:[b[1],b[2]],image:new Uint32Array(a.buffer),sdf:!1,simplePattern:!1}:null};a.prototype.rasterizeImageResource=
function(a,b){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=a.width;this._rasterizationCanvas.height=a.height;var d=this._rasterizationCanvas.getContext("2d");d.drawImage(a,0,0,a.width,a.height);d=d.getImageData(0,0,a.width,a.height);d=new Uint8Array(d.data);if(b)for(var e=0;e<b.length;e++){var c=b[e];if(c&&c.oldColor&&4===c.oldColor.length&&c.newColor&&4===c.newColor.length){var g=c.oldColor,k=g[0],r=g[1],l=g[2],g=g[3],x=c.newColor,
c=x[0],w=x[1],u=x[2],y=x[3];if(k!==c||r!==w||l!==u||g!==y)for(x=0;x<d.length;x+=4)k===d[x]&&r===d[x+1]&&l===d[x+2]&&g===d[x+3]&&(d[x]=c,d[x+1]=w,d[x+2]=u,d[x+3]=y)}}for(x=0;x<d.length;x+=4)b=d[x+3]/255,d[x]*=b,d[x+1]*=b,d[x+2]*=b;b=a.width;e=a.height;k=d;if(512<=b||512<=e)k=a.width/a.height,1<k?(b=512,e=Math.round(512/k)):(e=512,b=Math.round(512*k)),k=new Uint8Array(4*b*e),h.resampleHermite(d,a.width,a.height,new Uint8ClampedArray(k.buffer),b,e,!1);return{size:[b,e],image:new Uint32Array(k.buffer),
sdf:!1,simplePattern:!1}};return a}();b.default=n})},"esri/symbols/cim/TextRasterizer":function(){define(["require","exports","../../core/screenUtils"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(){}a.prototype.rasterizeText=function(a,b){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));var d=this._textRasterizationCanvas,e=d.getContext("2d");this.setFontProperties(e,b);this.parameters=b;this.textLines=a.split(/\r?\n/);
this.lineHeight=this.computeLineHeight();a=this.computeTextWidth(e,b);var c=this.lineHeight*this.textLines.length;d.width=a;d.height=c;this.renderedLineHeight=Math.round(this.lineHeight*b.pixelRatio);this.renderedHaloSize=b.halo.size*b.pixelRatio;this.renderedWidth=a*b.pixelRatio;this.renderedHeight=c*b.pixelRatio;d=b.color;this.fillStyle="rgba("+d.slice(0,3).toString()+","+d[3]+")";this.haloStyle="rgb("+b.halo.color.slice(0,3).toString()+")";var d=this.renderedLineHeight,g=this.renderedHaloSize;
this.setFontProperties(e,b);a=e.textAlign;var c=this.renderedWidth,h=("center"===a?.5*c:"right"===a?c:0)+g,c=a=0;0<g&&this.renderHalo(e,h,g,a,c,b);c+=g;a+=h;g=0;for(h=this.textLines;g<h.length;g++){var k=h[g];e.globalCompositeOperation="destination-out";e.fillStyle="rgb(0, 0, 0)";e.fillText(k,a,c);e.globalCompositeOperation="source-over";e.fillStyle=this.fillStyle;e.fillText(k,a,c);c+=d}e=e.getImageData(0,0,this.renderedWidth,this.renderedHeight);e=new Uint8Array(e.data);if(b.premultiplyColors)for(b=
void 0,d=0;d<e.length;d+=4)b=e[d+3]/255,e[d]*=b,e[d+1]*=b,e[d+2]*=b;return{size:[this.renderedWidth,this.renderedHeight],image:new Uint32Array(e.buffer),sdf:!1,simplePattern:!1}};a.prototype.renderHalo=function(a,b,d,f,c,h){var e=this.renderedWidth,g=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));this._haloRasterizationCanvas.width=e;this._haloRasterizationCanvas.height=g;var k=this._haloRasterizationCanvas,q=k.getContext("2d");
q.clearRect(0,0,e,g);this.setFontProperties(q,h);q.fillStyle=this.haloStyle;q.strokeStyle=this.haloStyle;h=3>this.renderedHaloSize;q.lineJoin=h?"miter":"round";h?this.renderHaloEmulated(q,b,d):this.renderHaloNative(q,b,d);a.globalAlpha=this.parameters.halo.color[3];a.drawImage(k,0,0,e,g,f,c,e,g);a.globalAlpha=1};a.prototype.renderHaloEmulated=function(a,b,d){for(var e=this.renderedLineHeight,c=this.renderedHaloSize,g=0,h=this.textLines;g<h.length;g++){for(var r=h[g],l=0,x=k;l<x.length;l++){var w=
x[l];a.fillText(r,b+c*w[0],d+c*w[1])}d+=e}};a.prototype.renderHaloNative=function(a,b,d){for(var e=this.renderedLineHeight,c=this.renderedHaloSize,g=0,h=this.textLines;g<h.length;g++){for(var k=h[g],l=2*c,x=0;5>x;x++)a.lineWidth=(.6+.1*x)*l,a.strokeText(k,b,d);d+=e}};a.prototype.setFontProperties=function(a,b){var d=b.font;b=d.style+" "+d.weight+" "+l.pt2px(b.size*b.pixelRatio)+"px "+d.family+", sans-serif";a.font=b;a.textAlign="left";a.textBaseline="top"};a.prototype.computeTextWidth=function(a,
b){for(var d=0,e=0,c=this.textLines;e<c.length;e++)d=Math.max(d,a.measureText(c[e]).width);b=b.font;if("italic"===b.style||"oblique"===b.style||"string"===typeof b.weight&&("bold"===b.weight||"bolder"===b.weight)||"number"===typeof b.weight&&600<b.weight)d+=.3*a.measureText("A").width;d+=2*this.parameters.halo.size;return Math.round(d)};a.prototype.computeLineHeight=function(){return Math.round(1.275*this.parameters.size+2*this.parameters.halo.size)};return a}();b.TextRasterizer=n;for(var k=[],h=
0;360>h;h+=22.5)k.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);b.default=n})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/compilerUtils ../../core/has ../../core/Logger ../../core/maybe ../../core/screenUtils ./gfxUtils ./Symbol3DMaterial".split(" "),function(n,b,l,k,h,a,g,e,d,f,c){function q(a,b){if(null==b)return a;a=a.toRgba();a[3]*=b;return new l(a)}function p(a,b,d){if(a=a.symbolLayers){var f=function(a){a=e.isSome(a)?a:null;
b=b||a||null!=d&&w;return q(b,d)};a.forEach(function(a){if("water"===a.type)a.color=f(a.color);else{var b=e.isSome(a.material)?a.material.color:null,b=f(b);e.isNone(a.material)?a.material=new c.default({color:b}):a.material.color=b;null!=d&&"outline"in a&&e.isSome(a.outline)&&e.isSome(a.outline.color)&&(a.outline.color=q(a.outline.color,d))}})}}function r(a,b,c){(a=a.symbolLayers)&&a.forEach(function(a){if(a)switch(a.type){case "icon":case "line":case "path":case "extrude":case "text":a.size=b;break;
case "object":switch(c){case "width":a.width=b;break;case "depth":a.depth=b;break;case "height":a.height=b;break;case "width-and-depth":a.width=b;a.depth=b;break;default:a.width=b,a.depth=b,a.height=b}break;default:t.warn("symbolUtils: applySizeToSymbol","symbolLayer not supported")}})}Object.defineProperty(b,"__esModule",{value:!0});var t=g.getLogger("esri.symbols.support.utils"),x=/\/resource\/(.*?)\.svg$/,w=new l("white");b.getSymbolOutlineSize=function(a){if(!a)return 0;if(k.isSymbol3D(a)){var b=
a.symbolLayers&&a.symbolLayers.length;b?(a=a.symbolLayers.getItemAt(b-1),a="outline"in a?e.get(a,"outline","size"):void 0):a=void 0;return e.isSome(a)?a:0}return(a=f.getStroke(a))&&d.px2pt(a.width)||0};b.isVolumetricSymbol=function(a){if(!a||!a.symbolLayers)return!1;switch(a.type){case "point-3d":return a.symbolLayers.some(function(a){return"object"===a.type});case "line-3d":return a.symbolLayers.some(function(a){return"path"===a.type});case "polygon-3d":return a.symbolLayers.some(function(a){return"object"===
a.type||"extrude"===a.type});default:return!1}};b.getIconHref=function(b,c){c=c.resource.href;return!a("esri-canvas-svg-support")&&b.styleOrigin&&x.test(c)?c.replace(x,"/resource/png/$1.png"):c};b.applyOpacityToColor=q;b.applyColorToSymbol=function(a,b,c){if(a&&(b||null!=c))if(b&&(b=new l(b)),k.isSymbol3D(a))p(a,b,c);else if(k.isSymbol2D(a)){if(b=b||a.color)a.color=q(b,c);null!=c&&"outline"in a&&a.outline&&a.outline.color&&(a.outline.color=q(a.outline.color,c))}};b.applySizeToSymbol=function(a,b,
c){if(a&&null!=b)if(k.isSymbol3D(a))r(a,b,c);else if(k.isSymbol2D(a))switch(a.type){case "simple-marker":a.size=b;break;case "picture-marker":c=a.width/a.height;1<c?(a.width=b,a.height=b*c):(a.width=b*c,a.height=b);break;case "simple-line":a.width=b;break;case "text":a.font.size=b;break;case "simple-fill":case "picture-fill":break;case "cim":break;default:h.neverReached(a)}};b.applyRotationToSymbol=function(a,b,c){a&&null!=b&&(k.isSymbol3D(a)?(a=a.symbolLayers)&&a.forEach(function(a){if(a&&"object"===
a.type)switch(c){case "tilt":a.tilt=b;break;case "roll":a.roll=b;break;default:a.heading=b}}):!k.isSymbol2D(a)||"simple-marker"!==a.type&&"picture-marker"!==a.type&&"text"!==a.type||(a.angle=b))}})},"esri/symbols/support/gfxUtils":function(){define("require exports ../../core/tsSupport/assignHelper ../../Color ../../request ../../core/ItemCache ../../core/promiseUtils ../../core/screenUtils".split(" "),function(n,b,l,k,h,a,g,e){function d(a){if(!a)return null;var b;switch(a.type){case "simple-fill":case "picture-fill":case "simple-marker":b=
d(a.outline);break;case "simple-line":var c=e.pt2px(a.width);"none"!==a.style&&0!==c&&(b={color:a.color,style:r(a.style),width:c,cap:a.cap,join:"miter"===a.join?e.pt2px(a.miterLimit):a.join});break;default:b=null}return b}Object.defineProperty(b,"__esModule",{value:!0});var f=n.toUrl("../../symbols/patterns/"),c={left:"start",center:"middle",right:"end",justify:"start"},q={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},p=new a(1E3);b.getSVGAlign=function(a){return a=
(a=a.horizontalAlignment)&&c[a.toLowerCase()]||"middle"};b.getSVGBaseline=function(a){return(a=a.verticalAlignment)&&q[a.toLowerCase()]||"alphabetic"};b.getSVGBaselineShift=function(a){return"bottom"===a.verticalAlignment?"super":null};b.getFill=function(a){var b=a.style,c=null;if(a)switch(a.type){case "simple-marker":"cross"!==b&&"x"!==b&&(c=a.color);break;case "simple-fill":"solid"===b?c=a.color:"none"!==b&&(c={type:"pattern",x:0,y:0,src:f+b+".png",width:8,height:8});break;case "picture-fill":c=
{type:"pattern",src:a.url,width:e.pt2px(a.width)*a.xscale,height:e.pt2px(a.height)*a.yscale,x:e.pt2px(a.xoffset),y:e.pt2px(a.yoffset)};break;case "text":c=a.color}return c};b.getPatternUrlWithColor=function(a,b){var c=a+"-"+b;return void 0!==p.get(c)?g.resolve(p.get(c)):h(a,{responseType:"image"}).then(function(a){a=a.data;var d=a.naturalWidth,e=a.naturalHeight,f=document.createElement("canvas");f.width=d;f.height=e;var g=f.getContext("2d");g.fillStyle=b;g.fillRect(0,0,d,e);g.globalCompositeOperation=
"destination-in";g.drawImage(a,0,0);a=f.toDataURL();p.put(c,a);return a})};b.getStroke=d;var r=function(){var a={};return function(b){if(a[b])return a[b];var c=b.replace(/-/g,"");return a[b]=c}}();b.defaultThematicColor=new k([128,128,128])})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(n,b,l){return function(){function b(b,a){this._storage=new l.MemCacheStorage;this._storage.maxSize=b;a&&this._storage.registerRemoveFunc("",a)}b.prototype.put=function(b,a){this._storage.put(b,
a,1,1)};b.prototype.pop=function(b){return this._storage.pop(b)};b.prototype.get=function(b){return this._storage.get(b)};b.prototype.clear=function(){this._storage.clearAll()};b.prototype.destroy=function(){this._storage.clearAll()};return b}()})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec4f64"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.defaultIconElevationOffset=1;b.SUSPEND_RESUME_EXTENT_OPTIMISM=
1.2;b.WHITE=new Float32Array([1,1,1,1]);b.TRANSPARENT=l.vec4f64.ZEROS})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/ComponentUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){n=function(){function b(a,b,c){this.type="draped";this.isElevationSource=this._addedToStage=!1;this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.stage=null;this._visible=!1}b.prototype.initialize=function(a,b){this.stage=b};b.prototype.setVisibility=function(a){if(null!=this.stage){if(this._visible!==a){this._visible=a;var b=this.stage.renderView.getDrapedRenderer();if(a&&!this._addedToStage)return this._addedToStage=!0,b.addRenderGeometries(this.renderGeometries),
!0;if(!a&&!this._addedToStage)return!1;for(var d=0,e=this.renderGeometries;d<e.length;d++){var f=e[d],g=f.instanceParameters.componentVisibilities,g=a?c.unhideAllComponents(g):c.hideAllComponents(g);f.instanceParameters.componentVisibilities=g}b.updateRenderGeometries(this.renderGeometries,1);return!0}return!1}};b.prototype.destroy=function(){this.stage&&this._addedToStage&&this.stage.renderView.getDrapedRenderer().removeRenderGeometries(this.renderGeometries);this._visible=this._addedToStage=!1;
this.stage=null};b.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};b.prototype.getCenterObjectSpace=function(b){void 0===b&&(b=g.vec3f64.create());return a.vec3.set(b,0,0,0)};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=e.create());return e.empty(a)};b.prototype.addHighlight=function(a,b){var c=this;this.renderGeometries.forEach(function(d){var e=d.addHighlight(b);a.addRenderGeometry(d,e,c)});this._addedToStage&&
this.stage.renderView.getDrapedRenderer().updateHighlights(this.renderGeometries)};b.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};b.prototype.removeRenderGeometryHighlight=function(a,b){a.removeHighlight(b);this._addedToStage&&this.stage.renderView.getDrapedRenderer().updateHighlights(this.renderGeometries)};b.prototype.getProjectedBoundingBox=function(a,b,c,d,g){return h(this,void 0,void 0,function(){var h,m,p,l;return k(this,function(k){switch(k.label){case 0:e.empty(g);
for(h=0;h<this.renderGeometries.length;h++)m=this.renderGeometries[h],this._getRenderGeometryProjectedBoundingRect(m,a,q,c),e.expand(g,q);if(!b)return[3,5];e.center(g,r);p=void 0;l=f.demResolutionForBoundingBox(g,b);k.label=1;case 1:return k.trys.push([1,3,,4]),[4,b.service.queryElevation(r[0],r[1],d,l)];case 2:return p=k.sent(),[3,4];case 3:return k.sent(),p=null,[3,4];case 4:null!=p&&(g[2]=Math.min(g[2],p),g[5]=Math.max(g[5],p)),k.label=5;case 5:return[2,g]}})})};b.prototype._getRenderGeometryProjectedBoundingRect=
function(a,b,c,d){if(this.boundingBox)e.set(p,this.boundingBox);else{var f=a.center;a=a.bsRadius;p[0]=f[0]-a;p[1]=f[1]-a;p[2]=f[2]-a;p[3]=f[0]+a;p[4]=f[1]+a;p[5]=f[2]+a}b(p,0,2);this.calculateRelativeScreenBounds&&d.push({location:e.center(p),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return e.toRect(p,c)};return b}();var q=d.create(),p=e.create(),r=[0,0,0];return n})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["require","exports","../../webgl-engine/lib/Util"],
function(n,b,l){function k(a,b,e){e&&(b/=Math.SQRT2);for(var d=new Uint8Array(4*a*a),f=0;f<a;f++)for(var c=0;c<a;c++){var g=c-.5*a+.25,h=-f+.5*a-.75,k=f*a+c;if(e)var t=(g+h)/Math.SQRT2,h=(h-g)/Math.SQRT2,g=t;g=Math.max(Math.abs(g),Math.abs(h))-.5*b;g=g/a+.5;l.packFloatRGBA(g,d,4*k)}return d}function h(a,b,e){e&&(b*=Math.SQRT2);b*=.5;for(var d=new Uint8Array(4*a*a),f=0;f<a;f++)for(var c=0;c<a;c++){var g=c-.5*a,h=-f+.5*a-1,k=f*a+c;if(e)var t=(g+h)/Math.SQRT2,h=(h-g)/Math.SQRT2,g=t;t=void 0;g=Math.abs(g);
h=Math.abs(h);t=g>h?g>b?Math.sqrt((g-b)*(g-b)+h*h):h:h>b?Math.sqrt(g*g+(h-b)*(h-b)):g;t=t/a+.5;l.packFloatRGBA(t,d,4*k)}return d}Object.defineProperty(b,"__esModule",{value:!0});b.createCircle=function(a,b){var e=new Uint8Array(4*a*a),d=a/2-.5;b/=2;for(var f=0;f<a;f++)for(var c=0;c<a;c++){var g=c+a*f,h=c-d,k=f-d,h=Math.sqrt(h*h+k*k)-b,h=h/a+.5;l.packFloatRGBA(h,e,4*g)}return e};b.createSquare=function(a,b){return k(a,b,!1)};b.createKite=function(a,b){return k(a,b,!0)};b.createCross=function(a,b){return h(a,
b,!1)};b.createX=function(a,b){return h(a,b,!0)};b.createTriangle=function(a,b){for(var e=new Uint8Array(4*a*a),d=Math.sqrt(1.25),f=(a-b)/2,c=0;c<a;c++)for(var g=0;g<a;g++){var h=(g-f)/b,k=(c-f+.75)/b;l.packFloatRGBA(Math.max(-(1*h+-.5*k)/d,(1*(h-1)+-.5*-k)/d,-k)*b/a+.5,e,4*(c*a+g))}return e}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){function p(a){return null!==a&&void 0!==a}function r(a){return"number"===typeof a}function t(a){return"string"===typeof a}function x(a,b){a&&a.push(b)}function w(a,b,d,e,f){var g=a.minSize,h=a.maxSize;if(a.expression)return x(f,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=e.symbolSize[d],b.minSize[d]=a,b.maxSize[d]=a,b.offset[d]=b.minSize[d],b.factor[d]=0,b.type[d]=1,!0;if(p(a.field)){if(p(a.stops)){if(2===a.stops.length&&
r(a.stops[0].size)&&r(a.stops[1].size))return u(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,b,d),b.type[d]=1,!0;x(f,"Could not convert size info: stops only supported with 2 elements");return!1}if(r(g)&&r(h)&&p(a.minDataValue)&&p(a.maxDataValue))return u(g,h,a.minDataValue,a.maxDataValue,b,d),b.type[d]=1,!0;if(null!=c.meterIn[a.valueUnit])return b.minSize[d]=-Infinity,b.maxSize[d]=Infinity,b.offset[d]=0,b.factor[d]=1/c.meterIn[a.valueUnit],b.type[d]=1,!0;if("unknown"===a.valueUnit)return x(f,
"Could not convert size info: proportional size not supported"),!1;x(f,"Could not convert size info: scale-dependent size not supported");return!1}if(!p(a.field)){if(a.stops&&a.stops[0]&&r(a.stops[0].size))return b.minSize[d]=a.stops[0].size,b.maxSize[d]=a.stops[0].size,b.offset[d]=b.minSize[d],b.factor[d]=0,b.type[d]=1,!0;if(r(g))return b.minSize[d]=g,b.maxSize[d]=g,b.offset[d]=g,b.factor[d]=0,b.type[d]=1,!0}x(f,"Could not convert size info: unsupported variant of sizeInfo");return!1}function u(a,
b,c,d,e,f){d=0<Math.abs(d-c)?(b-a)/(d-c):0;e.minSize[f]=0<d?a:b;e.maxSize[f]=0<d?b:a;e.offset[f]=a-c*d;e.factor[f]=d}function y(a,b,c,d){if(a.normalizationField||a.valueRepresentation)return x(d,"Could not convert size info: unsupported property"),null;var e=a.field;if(null!=e&&!t(e))return x(d,"Could not convert size info: field is not a string"),null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=
a.field;else if(a.field!==b.size.field)return x(d,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(e=w(a,b.size,0,c,d))?b:null;case "height":return(e=w(a,b.size,2,c,d))?b:null;case "depth":return(e=w(a,b.size,1,c,d))?b:null;case "width-and-depth":return(e=w(a,b.size,0,c,d))&&w(a,b.size,1,c,d),e?b:null;case null:case void 0:case "all":return(e=(e=(e=w(a,b.size,0,c,d))&&w(a,b.size,1,c,d))&&w(a,b.size,2,c,d))?b:null;default:return x(d,'Could not convert size info: unknown axis "'+
a.axis+'""'),null}}function m(a,b,c){for(var d=0;3>d;++d){var e=b.unitInMeters;1===a.type[d]&&(e*=b.modelSize[d],a.type[d]=2);a.minSize[d]/=e;a.maxSize[d]/=e;a.offset[d]/=e;a.factor[d]/=e}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return x(c,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[b],a.maxSize[d]=a.maxSize[b],a.offset[d]=a.offset[b],a.factor[d]=a.factor[b],a.type[d]=a.type[b]);return!0}function v(a,
b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function z(a,b,c){if(a.normalizationField)return x(c,"Could not convert color info: unsupported property"),null;if(t(a.field))if(a.stops){if(8<a.stops.length)return x(c,"Could not convert color info: too many color stops"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var d=c[Math.min(a,c.length-1)];b.color.values[a]=d.value;
v(b.color.colors,a,d.color)}}else return x(c,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length)for(c=a.stops&&0<=a.stops.length&&a.stops[0].color,b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=0;8>a;a++)b.color.values[a]=Infinity,v(b.color.colors,a,c);else return x(c,"Could not convert color info: no field and no colors/stops"),null;return b}function B(a,b,c){if(a.normalizationField)return x(c,
"Could not convert opacity info: unsupported property"),null;if(t(a.field))if(a.stops){if(8<a.stops.length)return x(c,"Could not convert opacity info: too many opacity stops"),null;b.opacity={field:a.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var d=c[Math.min(a,c.length-1)];b.opacity.values[a]=d.value;b.opacity.opacityValues[a]=d.opacity}}else return x(c,"Could not convert opacity info: missing stops or opacities"),null;else if(a.stops&&0<=a.stops.length)for(c=
a.stops&&0<=a.stops.length&&a.stops[0].opacity,b.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},a=0;8>a;a++)b.opacity.values[a]=Infinity,b.opacity.opacityValues[a]=c;else return x(c,"Could not convert opacity info: no field and no opacities/stops"),null;return b}function C(a,b,c,d){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=1}function D(a,b,c){if(!t(a.field))return x(c,"Could not convert rotation info: field is not a string"),
null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return x(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return C(a,b.rotation,0,c),b;case "roll":return C(a,b.rotation,1,c),b;case null:case void 0:case "heading":return C(a,b.rotation,2,c),b;default:return x(c,'Could not convert rotation info: unknown axis "'+a.axis+
'""'),null}}function K(a,b,c){if(!a)return null;var d=!b.supportedTypes||!!b.supportedTypes.size,e=!b.supportedTypes||!!b.supportedTypes.color,f=!b.supportedTypes||!!b.supportedTypes.rotation,g=!!b.supportedTypes&&!!b.supportedTypes.opacity,h=a.reduce(function(a,h){if(!a)return a;if(h.valueExpression)return x(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(h.type){case "size":return d?y(h,a,b,c):a;case "color":return e?z(h,a,c):a;case "opacity":return g?B(h,a,
c):null;case "rotation":return f?D(h,a,c):a;default:return l.neverReached(h),null}},{size:null,color:null,opacity:null,rotation:null});return 0<a.length&&h&&!h.size&&!h.color&&!h.opacity&&!h.rotation||h&&h.size&&!m(h.size,b,c)?null:h}function I(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function Q(b,c){var d={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,
vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},f=b&&null!=b.size;b&&b.size?(d.vvSizeEnabled=!0,d.vvSizeMinSize=b.size.minSize,d.vvSizeMaxSize=b.size.maxSize,d.vvSizeOffset=b.size.offset,d.vvSizeFactor=b.size.factor):b&&f&&(d.vvSizeValue=c.transformation.scale);if(b&&f){d.vvSymbolAnchor=c.transformation.anchor;d.vvSymbolRotationMatrix=
a.mat3f64.create();g.mat4.identity(N);var k=c.transformation.rotation[2],f=c.transformation.rotation[0],m=c.transformation.rotation[1];c=N;void 0===c&&(c=e.mat4f64.create());k=k||0;f=f||0;m=m||0;0!==k&&g.mat4.rotateZ(c,c,-k/180*Math.PI);0!==f&&g.mat4.rotateX(c,c,f/180*Math.PI);0!==m&&g.mat4.rotateY(c,c,m/180*Math.PI);h.mat3.fromMat4(d.vvSymbolRotationMatrix,N)}b&&b.color&&(d.vvColorEnabled=!0,d.vvColorValues=b.color.values,d.vvColorColors=b.color.colors);b&&b.opacity&&(d.vvOpacityEnabled=!0,d.vvOpacityValues=
b.opacity.values,d.vvOpacityOpacities=b.opacity.opacityValues);return d}Object.defineProperty(b,"__esModule",{value:!0});b.convertVisualVariables=K;b.initFastSymbolUpdatesState=function(a,b){return!a||q.DISABLE_FAST_UPDATES?{enabled:!1}:(a=K(a.visualVariables,b))?{enabled:!0,visualVariables:a,materialParameters:Q(a,b),requiresShaderTransformation:a&&null!=a.size}:{enabled:!1}};b.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var d=a.visualVariables;b=K(b.visualVariables,c);
if(!(b&&I(d.size,b.size,"size")&&I(d.color,b.color,"color")&&I(d.rotation,b.rotation,"rotation")&&I(d.opacity,b.opacity,"opacity")))return!1;a.visualVariables=b;a.materialParameters=Q(b,c);a.requiresShaderTransformation=b&&null!=b.size;return!0};b.getMaterialParams=Q;var J;(function(a){var b=e.mat4f64.create(),c=f.vec3f64.create();a.evaluateModelTransform=function(a,d,e){if(!a.vvSizeEnabled)return e;g.mat4.copy(b,e);e=a.vvSymbolRotationMatrix;g.mat4.set(N,e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],
e[8],0,0,0,0,1);g.mat4.multiply(b,b,N);for(e=0;3>e;++e)c[e]=k.clamp(a.vvSizeOffset[e]+d[0]*a.vvSizeFactor[e],a.vvSizeMinSize[e],a.vvSizeMaxSize[e]);g.mat4.scale(b,b,c);g.mat4.translate(b,b,a.vvSymbolAnchor);return b};a.evaluateModelTransformScale=function(a,b,c){if(!b.vvSizeEnabled)return d.vec3.set(a,1,1,1);for(var e=0;3>e;++e)a[e]=k.clamp(b.vvSizeOffset[e]+c[0]*b.vvSizeFactor[e],b.vvSizeMinSize[e],b.vvSizeMaxSize[e]);return a}})(J||(J={}));var N=e.mat4f64.create();b.evaluateModelTransform=J.evaluateModelTransform;
b.evaluateModelTransformScale=J.evaluateModelTransformScale})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./ComponentUtils ./HighlightUtils".split(" "),function(n,b,l,k,h,a,g,e,d){return function(){function b(b,d,e,f,g,h,k,l,y,m,v){this.shaderTransformationDirty=!0;this.data=
b.toRenderData();this.componentOffsets=b.componentOffsets;this.boundingInfo=d;this.material=e;this.origin=null;this.center=a.vec3f64.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=g;f&&this.updateTransformation(f,h);this.castShadow=k;this.singleUse=l;this.name=y;this.uniqueName=m;this.idx=v;this.instanceParameters={}}b.prototype.updateTransformation=function(a,b){this.transformation=a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,b,
this.center)};b.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};b.prototype.getBoundingSphere=function(a,b,d){b=b||g.maxScale(a);h.vec3.transformMat4(d,this.boundingInfo.getCenter(),a);return this.boundingInfo.getBSRadius()*b};Object.defineProperty(b.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentCount",{get:function(){return e.componentCount(this.componentOffsets)},
enumerable:!0,configurable:!0});b.prototype.getShaderTransformation=function(){if(!this.calculateShaderTransformation)return this.transformation;this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=k.mat4f64.create()),l.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(this.transformation)),this.shaderTransformationDirty=!1);return this.shaderTransformation};b.prototype.getIndices=function(a){return"indices"in this.data?this.data.indices[a]:null};
b.prototype.getAttribute=function(a){return"vertexAttr"in this.data?this.data.vertexAttr[a]:null};b.prototype.addHighlight=function(a){var b=d.generateHighlightId(),c=this.instanceParameters;c.componentHighlights=e.addHighlight(c.componentHighlights,null,a,b);return b};b.prototype.removeHighlight=function(a){var b=this.instanceParameters;b.componentHighlights=e.removeHighlight(b.componentHighlights,a)};return b}()})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/mathUtils ../../../../core/typedArrayUtil ../../support/imageUtils ./DDSUtil ./DefaultVertexBufferLayouts ./glUtil3D ./IdGen ./Util ../shaders/MiscPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y){var m=k.getLogger("esri.views.3d.webgl-engine.lib.Texture");n=function(){function b(a,c,d){this.data=a;this.id=b.idGen.gen(c);this.unloadFunc=void 0;this.params=d||{};this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.params.wrap=this.params.wrap||{s:10497,t:10497};this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1;this.estimatedTexMemRequired=
b.estimateTexMemRequired(this.data,this.params)}b.estimateTexMemRequired=function(a,b){return null==a?0:g.isArrayBuffer(a)||g.isUint8Array(a)?a.byteLength:a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement?(b.mipmap?4/3:1)*a.width*a.height*(b.components||4):(b.mipmap?4/3:1)*b.width*b.height*(b.components||4)||0};b.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired};b.prototype.dispose=function(){this.data=void 0};b.prototype.deferredLoading=
function(){return"string"===typeof this.data};b.prototype.getWidth=function(){return this.params.width};b.prototype.getHeight=function(){return this.params.height};b.prototype.initializeThroughUpload=function(a,c,e,f,h){var k=this.data;c.flipped=!this.params.noUnpackFlip;c.samplingMode=this.params.mipmap?9987:9729;c.hasMipmap=this.params.mipmap;c.wrapMode=this.params.wrap;c.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof k)this.loadTextureFromUri(a,k,c,e,f,h);else if(k instanceof
Image||k instanceof ImageData||k instanceof HTMLCanvasElement)this.loadTextureFromImageData(a,k,c,e,f,h);else{if(g.isArrayBuffer(k)&&this.params.encoding===b.DDS_ENCODING)c=d.createDDSTexture(a,c,k,this.params.mipmap);else if(g.isUint8Array(k)&&this.params.encoding===b.DDS_ENCODING)c=d.createDDSTexture(a,c,k.buffer,this.params.mipmap);else if(g.isUint8Array(k))p.assert(0<this.params.width&&0<this.params.height),c.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,c.width=
this.params.width,c.height=this.params.height,c=new w(a,c,k);else{if(null!==k)throw console.warn("Unsupported image data"),Error("Unsupported image data");c=new w(a,c,null)}a.bindTexture(c);h(c)}this.data=void 0};b.prototype.loadTextureFromImageData=function(b,c,d,e,f,g){this.params.width=c.width;this.params.height=c.height;d.pixelFormat=3===this.params.components?6407:6408;var h=33071===this.params.wrap.s&&33071===this.params.wrap.t;y.default(b.gl)||!this.params.mipmap&&h||a.isPowerOfTwo(c.width)&&
a.isPowerOfTwo(c.height)?(d.width=c.width,d.height=c.height,c=new w(b,d,c)):c=this.makePowerOfTwoTexture(b,c,d,e,f);b.bindTexture(c);g(c)};b.prototype.loadTextureFromUri=function(b,c,d,f,g,h){var k=this,r=!1!==this.params.mipmap;e.requestImage(c).then(function(c){p.assert(1<=c.width&&1<=c.height);d.samplingMode=r?9987:9729;d.hasMipmap=r;!r&&33071===d.wrapMode||a.isPowerOfTwo(c.width)&&a.isPowerOfTwo(c.height)?(d.width=c.width,d.height=c.height,c=new w(b,d,c)):c=k.makePowerOfTwoTexture(b,c,d,f,g);
b.bindTexture(c);h(c)}).catch(function(a){var b=200<c.length?c.slice(0,100)+"..."+c.slice(c.length-100):c;m.error("Failed to load image from uri",b,a);h(null)})};b.prototype.makePowerOfTwoTexture=function(a,b,c,d,e){var f=b.width,g=b.height,k=h.nextHighestPowerOfTwo(f),m=h.nextHighestPowerOfTwo(g);c.width=k;c.height=m;var p;switch(this.params.powerOfTwoResizeMode){case 2:c.textureCoordinateScaleFactor=[f/k,g/m];p=new w(a,c);p.updateData(0,0,0,f,g,b);break;case 1:case null:case void 0:p=this.stretchToPowerOfTwo(a,
b,c,d,e);break;default:l.neverReached(this.params.powerOfTwoResizeMode)}c.hasMipmap&&p.generateMipmap();return p};b.prototype.stretchToPowerOfTwo=function(a,b,d,e,g){var h=new w(a,d),k=t.createWithAttachments(a,h,{colorTarget:0,depthStencilTarget:0});b=new w(a,{target:3553,pixelFormat:d.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!d.flipped,maxAnisotropy:8,preMultiplyAlpha:d.preMultiplyAlpha},b);a.bindFramebuffer(k);void 0===g&&(g=a.getViewport(),g=[g.x,g.y,g.width,g.height]);
a.setViewport(0,0,d.width,d.height);d=e.getProgram(r.texOnly);a.bindProgram(d);d.setUniform4f("color",1,1,1,1);d.setUniform1i("tex",0);d=c.createQuadVAO(a,f.Pos3Tex);a.bindTexture(b,0);a.bindVAO(d);a.setPipelineState(v);a.drawArrays(5,0,u.vertexCount(d,"geometry"));a.bindFramebuffer(null);a.setViewport(g[0],g[1],g[2],g[3]);d.dispose(!0);b.dispose();a.bindFramebuffer(null);k.detachColorTexture();k.dispose();return h};b.prototype.setUnloadFunc=function(a){this.unloadFunc=a};b.prototype.unload=function(){void 0!==
this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};b.createEmpty=function(a){void 0===a&&(a="emptyTexture");return new b(new Uint8Array([0,0,0,0]),a,{width:1,height:1,wrap:{s:33071,t:33071}})};b.idGen=new q.IdGen;b.DDS_ENCODING="image/vnd-ms.dds";return b}();var v=x.makePipelineState({colorWrite:x.defaultColorWriteParams});return n})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../../core/Logger","../../../../core/mathUtils","../../../webgl/Texture"],
function(n,b,l,k,h){function a(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}Object.defineProperty(b,"__esModule",{value:!0});var g=l.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),e=a("DXT1"),d=a("DXT3"),f=a("DXT5");b.createDDSTexture=function(a,b,p,r){var c=new Int32Array(p,0,31);if(542327876!==c[0])return g.error("Invalid magic number in DDS header"),null;if(!(c[20]&4))return g.error("Unsupported format, must contain a FourCC code"),null;var q=
c[21],l;switch(q){case e:q=8;l=33776;break;case d:q=16;l=33778;break;case f:q=16;l=33779;break;default:return g.error("Unsupported FourCC code:",String.fromCharCode(q&255,q>>8&255,q>>16&255,q>>24&255)),null}var u=1,y=c[4],m=c[3];if(0!==(y&3)||0!==(m&3))g.warn("Rounding up compressed texture size to nearest multiple of 4."),y=y+3&-4,m=m+3&-4;b.width=y;b.height=m;c[2]&131072&&!1!==r&&(u=Math.max(1,c[7]));1===u||k.isPowerOfTwo(y)&&k.isPowerOfTwo(m)||(g.warn("Ignoring mipmaps of non power of two sized compressed texture."),
u=1);for(var v=c[1]+4,z=[],n=0;n<u;++n)c=(y+3>>2)*(m+3>>2)*q,r=new Uint8Array(p,v,c),z.push(r),v+=c,y=Math.max(1,y>>1),m=Math.max(1,m>>1);b.samplingMode=1<u?9987:9729;b.hasMipmap=1<u;b.internalFormat=l;b=new h(a,b,{type:"compressed",levels:z});a.bindTexture(b);return b}})},"esri/views/3d/webgl-engine/shaders/MiscPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.blendLayers=
{name:"blend-layers",shaders:{vertexShader:k.resolveIncludes("misc/blendLayers.vert"),fragmentShader:k.resolveIncludes("misc/blendLayers.frag")},attributes:l.Default3D};b.texOnly={name:"tex-only",shaders:{vertexShader:k.resolveIncludes("misc/texOnly.vert"),fragmentShader:k.resolveIncludes("misc/texOnly.frag")},attributes:l.Default3D}})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","../../core/has","./Renderbuffer","./Texture"],function(n,b,l,k,h){return function(){function a(b,
e,d,f){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=b;this._desc={colorTarget:e.colorTarget,depthStencilTarget:e.depthStencilTarget,width:e.width,height:e.height,multisampled:e.multisampled};this._id=a._nextId++;d&&(b=void 0,d instanceof h?(this._colorAttachment=d,b=d.descriptor):(b=d,this._colorAttachment=new h(this._context,b)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),
a._validateTextureDimensions(b,this._desc));f instanceof k?(2===e.depthStencilTarget?this._stencilAttachment=f:1===e.depthStencilTarget||3===e.depthStencilTarget?this._depthAttachment=f:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),a._validateBufferDimensions(f.descriptor,this._desc)):f&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),
e=void 0,f instanceof h?(this._depthStencilTexture=f,e=this._depthStencilTexture.descriptor):(e=f,this._depthStencilTexture=new h(this._context,e)),a._validateTextureDimensions(e,this._desc))}a.create=function(b,e){return new a(b,e)};a.createWithAttachments=function(b,e,d,f){return new a(b,d,e,f)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof h?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorAttachment",{get:function(){return this._colorAttachment},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilAttachment",{get:function(){return this._depthStencilTexture||
this._depthAttachment||this._stencilAttachment},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});a.prototype.dispose=function(){if(this._context){var a=
this._context,b=a.getBoundFramebufferObject();this._disposeColorAttachment();this._disposeDepthStencilAttachments();this._glName&&(a.gl.deleteFramebuffer(this._glName),this._glName=null);a.bindFramebuffer(b);this._context=null}};a.prototype.attachColorTexture=function(b){if(b){a._validateTextureDimensions(b.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var e=this._context.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,
e.TEXTURE_2D,b.glName,0)}this._colorAttachment=b}};a.prototype.detachColorTexture=function(){var a=void 0;if(this._colorAttachment instanceof h){a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}this._colorAttachment=null}return a};a.prototype.attachDepthStencilTexture=function(b){if(b){var e=b.descriptor;34041!==e.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");
34042!==e.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");a._validateTextureDimensions(e,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),e=this._context.gl,e.framebufferTexture2D(e.FRAMEBUFFER,
e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,b.glName,0));this._depthStencilTexture=b}};a.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};a.prototype.attachDepthStencilBuffer=function(b){if(b){var e=b.descriptor;34041!==e.internalFormat&&33189!==e.internalFormat&&
console.error("Depth/Stencil buffer must have correct internalFormat");a._validateBufferDimensions(e,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===e.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),e=this._context.gl,e.framebufferRenderbuffer(e.FRAMEBUFFER,1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,b.glName));this._depthAttachment=b}};a.prototype.detachDepthStencilBuffer=function(){var a=
this._context.gl,b=this._depthAttachment;b&&this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null));this._depthAttachment=null;return b};a.prototype.copyToTexture=function(a,b,d,f,c,h,k){(0>a||0>b||0>c||0>h)&&console.error("Offsets cannot be negative!");(0>=d||0>=f)&&console.error("Copy width and height must be greater than zero!");var e=this._desc,g=k.descriptor;
3553!==k.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+d>e.width||b+f>e.height||c+d>g.width||h+f>g.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");e=this._context;e.bindTexture(k);e.bindFramebuffer(this);e.gl.copyTexSubImage2D(3553,0,c,h,a,b,d,f)};a.prototype.readPixels=function(a,b,d,f,c,h,k){(0>=d||0>=f)&&console.error("Copy width and height must be greater than zero!");k||console.error("Target memory is not initialized!");
this._context.bindFramebuffer(this);this._context.gl.readPixels(a,b,d,f,c,h,k)};a.prototype.resize=function(b,e){var d=this._desc;if(d.width!==b||d.height!==e)if(this._initialized)d.width=b,d.height=e,this._colorAttachment instanceof h?(f=this._colorAttachment,d=f.descriptor,d.width=b,d.height=e,this._colorAttachment.dispose(),this._colorAttachment=new h(this._context,d),a._validateTextureDimensions(f.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?
(d=this._depthStencilTexture.descriptor,d.width=b,d.height=e,this._depthStencilTexture.dispose(),this._depthStencilTexture=new h(this._context,d)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1;else{d.width=b;d.height=e;if(this._colorAttachment instanceof h){var f=this._colorAttachment;f.resize(b,e)}this._depthStencilTexture&&this._depthStencilTexture.resize(b,
e)}};a.prototype.initialize=function(){if(this._initialized)return!1;var a=this._context.gl;this._glName&&a.deleteFramebuffer(this._glName);var b=a.createFramebuffer(),d=this._desc;a.bindFramebuffer(a.FRAMEBUFFER,b);if(!this._colorAttachment)if(0===d.colorTarget)this._colorAttachment=new h(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:d.width,height:d.height});else{var f=new k(this._context,{internalFormat:32854,width:d.width,height:d.height});a.framebufferRenderbuffer(a.FRAMEBUFFER,
a.COLOR_ATTACHMENT0,a.RENDERBUFFER,f.glName);this._colorAttachment=f}this._colorAttachment instanceof h&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._colorAttachment.glName,0);switch(d.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new k(this._context,{internalFormat:1===d.depthStencilTarget?33189:34041,width:d.width,height:d.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,1===d.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,
a.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new k(this._context,{internalFormat:36168,width:d.width,height:d.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),
this._depthStencilTexture=new h(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:d.width,height:d.height})),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,this._depthStencilTexture.glName,0)}a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=b;return this._initialized=!0};a.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof
h){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,b=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=
null};a.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,
a.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};a._validateBufferDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||
console.error("Renderbuffer dimensions must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};a._validateTextureDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Color attachment texture must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};a._nextId=0;return a}()})},"esri/views/webgl/Renderbuffer":function(){define(["require",
"exports","../../core/has"],function(n,b,l){return function(){function b(h,a){this._context=h;this._desc=a;this._glName=null;this._id=-1;h=this._context.gl;this._id=++b._nextId;this._glName=h.createRenderbuffer();this._context.bindRenderbuffer(this);h.renderbufferStorage(h.RENDERBUFFER,a.internalFormat,a.width,a.height)}Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this._id},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});b.prototype.resize=function(b,a){var g=this._context.gl,e=this._desc;if(e.width!==b||e.height!==a)e.width=b,e.height=a,this._context.bindRenderbuffer(this),g.renderbufferStorage(g.RENDERBUFFER,e.internalFormat,e.width,e.height)};b.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context=
null};b._nextId=0;return b}()})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.default=function(b){return window.WebGL2RenderingContext&&b instanceof window.WebGL2RenderingContext}})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/lang ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./lineUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/shaders/RibbonLinePrograms".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function n(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._lineWidthLOD=1;return a}l(n,b);n.prototype.doLoad=function(){return h(this,void 0,void 0,function(){var b,c,e,h;return k(this,function(k){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,
rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?C.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};b=this._getCombinedOpacityAndColor(d.get(this.symbolLayer,"material","color"));c=b[3];e={width:1,color:b,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:1>c||this._isPropertyDriven("opacity"),slicePlaneEnabled:this._context.slicePlaneEnabled};
if(this._isPropertyDriven("size"))this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(e.width=f.pt2px(1));else{h=null!=this.symbolLayer.size?this.symbolLayer.size:f.px2pt(1);if(0>h)throw new a("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");e.width=f.pt2px(h);"round"===e.join&&(this._lineWidthLOD=1.863798+-2.0062872/Math.pow(1+h/18.2313,.8856294))}this._fastUpdates&&this._fastUpdates.visualVariables&&g.mixin(e,this._fastUpdates.materialParameters,
{});this._material=new Q(e,this._getIdHint("_ribbonlinemat"));this._context.stage.add(3,this._material);return[2]})})};n.prototype.destroy=function(){b.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)};n.prototype.getDrivenSize=function(a){var b=new Float32Array(1);this._isPropertyDriven("size")&&a.size?b[0]=f.pt2px(w.getDriverAxisSizeValue(a.size)):b[0]=1;return b};n.prototype.getSizeFeatureAttribute=function(a){var b=new Float32Array(1);
b[0]=z.getAttributeValue(this._fastUpdates.visualVariables.size.field,a);return b};n.prototype.getDrivenColor=function(a,b){b=t.vec4f32.fromValues(1,1,1,1);this._isPropertyDriven("color")&&a.color&&(b[0]=a.color[0],b[1]=a.color[1],b[2]=a.color[2],0<a.color.length&&(b[3]=a.color[3]));this._isPropertyDriven("opacity")&&a.opacity&&(b[3]=a.opacity);return b};n.prototype.getColorFeatureAttribute=function(a){var b=new Float32Array(1);b[0]=z.getAttributeValue(this._fastUpdates.visualVariables.color.field,
a);return b};n.prototype.getOpacityFeatureAttribute=function(a){var b=new Float32Array(1);b[0]=z.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,a);return b};n.prototype.createGraphics3DGraphic=function(a){var b=a.graphic,c=b.geometry;if(!this._validateGeometryType(b.geometry,n.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(c))return null;var c="polygon"===c.type||"extent"===c.type?"rings":"paths",d="graphic"+b.uid,e=this.getGraphicElevationContext(b);return"on-the-ground"===
e.mode?this._createAsOverlay(a,c,e,d,this._context.layer.uid):this._createAs3DShape(a,c,e,d,b.uid)};n.prototype.applyRendererDiff=function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(C.updateFastSymbolUpdatesState(this._fastUpdates,b,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};n.prototype.layerOpacityChanged=function(){var a=this._material.getParameters().color,b=d.get(this.symbolLayer,
"material","color"),b=this._getCombinedOpacity(b),c=1>b||this._isPropertyDriven("opacity");this._material.setParameterValues({color:[a[0],a[1],a[2],b],transparent:c});return!0};n.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=v.elevationModeChangeUpdateType(n.elevationModeChangeTypes,c,d);if(c!==v.SymbolUpdateType.UPDATE)return c;var e=v.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};n.prototype.slicePlaneEnabledChanged=
function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};n.prototype.physicalBasedRenderingChanged=function(a,b){return!0};n.prototype.pixelRatioChanged=function(a,b){return!0};n.prototype._createAs3DShape=function(a,b,d,e,f){var g=v.getGeometryAsPoly(a.graphic.geometry),h=g[b],k=[],p=[],l=[],y=r.vec3f64.create(),x=Array(6),g=v.getGeometryVertexData3D(h,g.hasZ,g.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,
this._context.renderCoordsHelper,d);this._logGeometryCreationWarnings(g,h,b,"LineSymbol3DLayer");if(0<h.length){for(var h=g.geometryData.outlines,t=g.eleVertexData,w=g.vertexData,z=0;z<h.length;++z){var n=h[z];if(!(1>=n.count)){var B=n.index,L=n.count;if(this._context.clippingExtent&&(v.computeBoundingBox(t,B,L,x),v.boundingBoxClipped(x,this._context.clippingExtent)))continue;v.applyOrigin(w,B,L,y);n=new Float64Array(t.buffer,3*B*t.BYTES_PER_ELEMENT,3*L);B=new Float64Array(w.buffer,3*B*w.BYTES_PER_ELEMENT,
3*L);B=this._createGeometryData(a,B,n,"rings"===b);B=new D(B,e+"path"+z);B.singleUse=!0;k.push(B);p.push(this._material);B=q.mat4f64.create();c.mat4.translate(B,B,y);l.push(B)}}if(0<k.length)return a=new K({geometries:k,materials:p,transformations:l,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:f},idHint:e}),k=new m(this,a,k,null,null,u.perVertexElevationAligner,d),k.alignedTerrainElevation=g.terrainElevation,k.needsElevationUpdates=v.needsElevationUpdates2D(d.mode),k}return null};
n.prototype._createGeometryData=function(a,b,c,d){b=B.createPolylineGeometryData(b,c,d);if("round"===this._material.getParameters().join){c=b.vertexAttributes[J.VertexAttrConstants.POSITION].data;d=c.length/3;var f=new Float32Array(d),g=N,h=L;p.vec3.set(g,0,0,0);for(var k=0;k<d-1;++k){var m=k+1;p.vec3.set(h,c[3*m+0]-c[3*k+0],c[3*m+1]-c[3*k+1],c[3*m+2]-c[3*k+2]);p.vec3.normalize(h,h);m=1*(Math.PI-e.acosClamped(p.vec3.dot(g,h)))*M*this._lineWidthLOD;f[k]=Math.max(Math.floor(m),0);p.vec3.scale(g,h,-1)}b.vertexAttributes[J.VertexAttrConstants.SUBDIVISIONS]=
{size:1,data:f,offsetIdx:0,strideIdx:1};b.indices[J.VertexAttrConstants.SUBDIVISIONS]=b.indices[J.VertexAttrConstants.POSITION]}c=new Uint32Array(b.vertexAttributes[J.VertexAttrConstants.POSITION].data.length);b.indices[J.VertexAttrConstants.SIZE]=c;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?(b.vertexAttributes[J.VertexAttrConstants.SIZEFEATUREATTRIBUTE]={size:1,data:this.getSizeFeatureAttribute(a.graphic),offsetIdx:0,strideIdx:1},b.indices[J.VertexAttrConstants.SIZEFEATUREATTRIBUTE]=
c):(b.vertexAttributes[J.VertexAttrConstants.SIZE]={size:1,data:this.getDrivenSize(a.renderingInfo),offsetIdx:0,strideIdx:1},b.indices[J.VertexAttrConstants.SIZE]=c);this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?(b.vertexAttributes[J.VertexAttrConstants.COLORFEATUREATTRIBUTE]={size:1,data:this.getColorFeatureAttribute(a.graphic),offsetIdx:0,strideIdx:1},b.indices[J.VertexAttrConstants.COLORFEATUREATTRIBUTE]=c):(b.vertexAttributes[J.VertexAttrConstants.COLOR]={size:4,data:this.getDrivenColor(a.renderingInfo,
a.graphic),offsetIdx:0,strideIdx:4},b.indices[J.VertexAttrConstants.COLOR]=c);this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity&&(b.vertexAttributes[J.VertexAttrConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:this.getOpacityFeatureAttribute(a.graphic),offsetIdx:0,strideIdx:1},b.indices[J.VertexAttrConstants.OPACITYFEATUREATTRIBUTE]=c);return b};n.prototype._createAsOverlay=function(a,b,d,e,f){d=a.graphic;var g=v.getGeometryAsPoly(d.geometry),h=g[b];this._material.renderPriority=
this._symbolLayerOrder;var k=[],m=Array(6),p=x.empty(),l=r.vec3f64.create(),g=v.getGeometryVertexDataDraped(h,g.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(g,h,b,"LineSymbol3DLayer");if(0<h.length){for(var h=g.vertexData,g=g.geometryData.outlines,u=0;u<g.length;++u){var t=g[u],w=t.index,t=t.count;v.computeBoundingBox(h,w,t,m);if(!v.boundingBoxClipped(m,this._context.clippingExtent)){x.expand(p,m);v.applyOrigin(h,w,t,l);v.setZ(h,w,t,this._getDrapedZ());t=new Float64Array(h.buffer,
3*w*h.BYTES_PER_ELEMENT,3*t);w=q.mat4f64.create();c.mat4.translate(w,w,l);var t=this._createGeometryData(a,t,null,"rings"===b),z=new I(t);z.data.layerUid=f;z.data.graphicUid=d.uid;z.material=this._material;z.center=[.5*(m[0]+m[3]),.5*(m[1]+m[4]),0];z.bsRadius=.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]));z.transformation=w;z.name=e;z.uniqueName=e+"#"+t.id;k.push(z)}}return new y(this,k,p)}return null};n.validGeometryTypes=["polyline","polygon","extent"];n.elevationModeChangeTypes=
{definedChanged:v.SymbolUpdateType.RECREATE,staysOnTheGround:v.SymbolUpdateType.NONE,onTheGroundChanged:v.SymbolUpdateType.RECREATE};return n}(z.Graphics3DSymbolLayer);b.Graphics3DLineSymbolLayer=n;var N=r.vec3f64.create(),L=r.vec3f64.create(),M=4/Math.PI;b.default=n})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["require","exports","./factories/vec4f32"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec4f32=l})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["require",
"exports"],function(n,b){function l(){return new Float32Array(4)}function k(a,b,d,e){var c=new Float32Array(4);c[0]=a;c[1]=b;c[2]=d;c[3]=e;return c}function h(){return k(1,1,1,1)}function a(){return k(1,0,0,0)}function g(){return k(0,1,0,0)}function e(){return k(0,0,1,0)}function d(){return k(0,0,0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.clone=function(a){var b=new Float32Array(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};b.fromValues=k;b.createView=function(a,b){return new Float32Array(a,
b,4)};b.zeros=function(){return l()};b.ones=h;b.unitX=a;b.unitY=g;b.unitZ=e;b.unitW=d;b.ZEROS=l();b.ONES=h();b.UNIT_X=a();b.UNIT_Y=g();b.UNIT_Z=e();b.UNIT_W=d()})},"esri/views/3d/layers/graphics/lineUtils":function(){define(["require","exports","../../webgl-engine/lib/GeometryData","../../webgl-engine/lib/Util"],function(n,b,l,k){function h(a){var b=a.length;return a[0]===a[b-3]&&a[1]===a[b-2]&&a[2]===a[b-1]}function a(a,b,f){var c,d;if(f=f&&!h(a)){f=new Float32Array(a.length+3);for(d=0;d<a.length;d++)f[d]=
a[d];d=f.length;f[d-3]=a[0];f[d-2]=a[1];f[d-1]=a[2];c=a.length/3+1;d=new Uint32Array(2*(c-1))}else c=a.length/3,d=new Uint32Array(2*(c-1)),f=a;for(var e=a=0;e<c-1;e++)d[a++]=e,d[a++]=e+1;a={};c={};a[g.POSITION]=d;c[g.POSITION]={size:3,data:f,offsetIdx:0,strideIdx:3};b&&(a.mapPos=d,c.mapPos={size:3,data:b,offsetIdx:0,strideIdx:3});return new l.GeometryData(c,a,l.GeometryData.DefaultOffsets,"line")}Object.defineProperty(b,"__esModule",{value:!0});var g=k.VertexAttrConstants;b.isClosed=h;b.createPolylineGeometryData=
a;b.createPolylineGeometry=function(b,d,f,c,h){b=a(b,d,f);b.vertexAttributes[g.COLOR]={size:4,data:c,offsetIdx:0,strideIdx:4};c=new Float32Array(1);c[0]=h;b.vertexAttributes[g.SIZE]={size:1,data:c,offsetIdx:0,strideIdx:1};h=new Uint32Array(b.vertexAttributes[g.POSITION].data.length);b.indices[g.COLOR]=h;b.indices[g.SIZE]=h;return b}})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./VisualVariableMaterialParameters ./internal/MaterialUtil ./renderers/InstancedRenderer ./renderers/MergedRenderer ../shaders/RibbonLinePrograms ../../../webgl/renderState".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z){function B(a,b){b.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors));b.vvOpacityEnabled&&(a.setUniform1fv("vvOpacityValues",b.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",
b.vvOpacityOpacities))}var C=h.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");n=function(b){function f(a,c){c=b.call(this,c)||this;c.params=u.copyParameters(a,I);"miter"!==c.params.join&&(c.params.miterLimit=0);c.params.transparent=1>c.params.color[3]||c.params.transparent;c.canBeMerged=null==c.params.stippleLength;c.layout=c.createLayout();return c}l(f,b);f.prototype.dispose=function(){};f.prototype.setParameterValues=function(a){for(var b in a)x.assert("cap"!==b,"RibbonLineMaterial: cap cannot be changed after creation"),
x.assert("stippleLength"!==b||null!=a[b]===(null!=this.params[b]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[b]=a[b];"miter"!==this.params.join&&(this.params.miterLimit=0);this.notifyDirty("matChanged")};f.prototype.getParameters=function(){return this.params};f.prototype.intersect=function(a,b,c,d,e,f,g,h,k){k?u.intersectDrapedRenderLineGeometry(a,b,c,d,e,f,this.params.width,g):this.intersectLineGeometry(a,b,c,d,e,f,this.params.width,g)};f.prototype.intersectLineGeometry=
function(b,f,g,h,k,m,r,q,l){if(h.enable.selectionMode&&!p.isAllHidden(f.componentVisibilities,b.componentOffsets))if(x.isTranslationMatrix(g)){f=b.data.getVertexAttr();b=f[v.VertexAttrConstants.POSITION].data;this.params.vvSizeEnabled?r*=a.clamp(this.params.vvSizeOffset[0]+f[v.VertexAttrConstants.SIZEFEATUREATTRIBUTE].data[0]*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0]):f[v.VertexAttrConstants.SIZE]&&(r*=f[v.VertexAttrConstants.SIZE].data[0]);k=h.camera;m=
U;e.vec2.copy(m,h.point);r=r*k.pixelRatio/2+4*k.pixelRatio;d.vec3.set(la[0],m[0]-r,m[1]+r,0);d.vec3.set(la[1],m[0]+r,m[1]+r,0);d.vec3.set(la[2],m[0]+r,m[1]-r,0);d.vec3.set(la[3],m[0]-r,m[1]-r,0);for(l=0;4>l;l++)k.unprojectPoint(la[l],ka[l]);c.plane.fromPoints(k.eye,ka[0],ka[1],oa);c.plane.fromPoints(k.eye,ka[1],ka[2],va);c.plane.fromPoints(k.eye,ka[2],ka[3],fa);c.plane.fromPoints(k.eye,ka[3],ka[0],xa);f=Number.MAX_VALUE;for(l=0;l<b.length-5;l+=3)if(M[0]=b[l]+g[12],M[1]=b[l+1]+g[13],M[2]=b[l+2]+g[14],
R[0]=b[l+3]+g[12],R[1]=b[l+4]+g[13],R[2]=b[l+5]+g[14],!(0>c.plane.signedDistance(oa,M)&&0>c.plane.signedDistance(oa,R)||0>c.plane.signedDistance(va,M)&&0>c.plane.signedDistance(va,R)||0>c.plane.signedDistance(fa,M)&&0>c.plane.signedDistance(fa,R)||0>c.plane.signedDistance(xa,M)&&0>c.plane.signedDistance(xa,R))){k.projectPoint(M,Y);k.projectPoint(R,X);if(0>Y[2]&&0<X[2]){d.vec3.subtract(S,M,R);var u=k.frustum,y=-c.plane.signedDistance(u.planes[4],M),u=y/d.vec3.dot(S,u.planes[4]);d.vec3.scale(S,S,u);
d.vec3.add(M,M,S);k.projectPoint(M,Y)}else if(0<Y[2]&&0>X[2])d.vec3.subtract(S,R,M),u=k.frustum,y=-c.plane.signedDistance(u.planes[4],R),u=y/d.vec3.dot(S,u.planes[4]),d.vec3.scale(S,S,u),d.vec3.add(R,R,S),k.projectPoint(R,X);else if(0>Y[2]&&0>X[2])continue;Y[2]=0;X[2]=0;u=c.lineSegment.distance2(c.lineSegment.fromPoints(Y,X,Z),m);u<f&&(f=u,d.vec3.copy(P,M),d.vec3.copy(V,R))}g=h.rayBeginPoint;h=h.rayEndPoint;f<r*r&&(b=Number.MAX_VALUE,c.lineSegment.closestLineSegmentPoint(c.lineSegment.fromPoints(P,
V,Z),c.lineSegment.fromPoints(g,h,ca),T)&&(d.vec3.subtract(T,T,g),b=d.vec3.length(T),d.vec3.scale(T,T,1/b),b/=d.vec3.distance(g,h)),q(b,T))}else C.error("intersection assumes a translation-only matrix")};f.prototype.createLayout=function(){var a=q.newLayout().vec3f(v.VertexAttrConstants.POSITION).f32(v.VertexAttrConstants.SUBDIVISIONFACTOR).vec2f(v.VertexAttrConstants.UV0).vec3f(v.VertexAttrConstants.AUXPOS1).vec3f(v.VertexAttrConstants.AUXPOS2);this.params.vvSizeEnabled?a.f32(v.VertexAttrConstants.SIZEFEATUREATTRIBUTE):
a.f32(v.VertexAttrConstants.SIZE);this.params.vvColorEnabled?a.f32(v.VertexAttrConstants.COLORFEATUREATTRIBUTE):a.vec4f(v.VertexAttrConstants.COLOR);this.params.vvOpacityEnabled&&a.f32(v.VertexAttrConstants.OPACITYFEATUREATTRIBUTE);return a};f.prototype.createBufferWriter=function(){return new Q(this.layout,this.params)};f.prototype.createRenderer=function(a,b){return this.canBeMerged?new m(a,b,this,v.vertexAttributeLocations):new y(a,b,this,v.vertexAttributeLocations)};f.prototype.getGLMaterials=
function(){return{color:D,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:K}};return f}(t.Material);var D=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}l(b,a);b.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.beginSlot=function(a){return a===(this.params.writeDepth?7:10)};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;
this.program=this.programRep.getProgram(v.colorPass,{stipple:null!=a.stippleLength,slice:a.slicePlaneEnabled,join:a.join,cap:a.cap,vvSize:a.vvSizeEnabled,vvColor:a.vvColorEnabled,vvOpacity:a.vvOpacityEnabled});this.pipelineState=z.makePipelineState({blending:z.separateBlendingParams(770,1,771,771),polygonOffset:a.polygonOffset&&J,depthTest:{func:513},depthWrite:!a.transparent&&a.writeDepth&&z.defaultDepthWriteParams,colorWrite:z.defaultColorWriteParams})};b.prototype.bind=function(a,b){var c=this.program,
d=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);c.setUniform1f("symbolLineWidth",d.width);c.setUniform4fv("symbolColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);c.setUniform1f("pixelRatio",b.pixelRatio);c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);B(c,d)};b.prototype.release=function(a){};b.prototype.bindView=
function(a,b){a=this.program;var c=this.params;u.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&u.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 5};return b}(r),K=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}l(b,a);b.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram()};
b.prototype.beginSlot=function(a){return 5===a};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(v.highlightPass,{stipple:null!=a.stippleLength,slice:a.slicePlaneEnabled,join:a.join,cap:a.cap,vvSize:a.vvSizeEnabled,vvColor:a.vvColorEnabled,vvOpacity:a.vvOpacityEnabled});this.pipelineState=z.makePipelineState({polygonOffset:a.polygonOffset&&J,depthTest:{func:513},depthWrite:!a.transparent&&a.writeDepth&&
z.defaultDepthWriteParams,colorWrite:z.defaultColorWriteParams})};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);u.bindHighlightRendering(a,b,c);c.setUniform1f("symbolLineWidth",d.width);c.setUniform4fv("symbolColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);c.setUniform1f("pixelRatio",b.pixelRatio);c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]);null!=d.stippleLength&&
c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);B(c,d)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;u.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&u.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 5};return b}(r),I=k({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,
writeDepth:!0,polygonOffset:!1,stippleLength:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1},w.Default),Q=function(){function a(a,b){this.parms=b;this.numJoinSubdivisions=this.numCapSubdivisions=0;this.canBeMerged=!1;this.vertexBufferLayout=a;this.canBeMerged=null==this.parms.stippleLength;switch(this.parms.cap){case "butt":this.numCapSubdivisions=0;break;case "square":this.numCapSubdivisions=1;break;case "round":this.numCapSubdivisions=N}switch(this.parms.join){case "miter":case "bevel":this.numJoinSubdivisions=
0;break;case "round":this.numJoinSubdivisions=L}}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){var b=a.indices[v.VertexAttrConstants.POSITION].length/2+1,c=2*(2*this.numCapSubdivisions+2);if(a.vertexAttr[v.VertexAttrConstants.SUBDIVISIONS]){a=a.vertexAttr[v.VertexAttrConstants.SUBDIVISIONS].data;for(var d=1;d<b-1;++d)c+=4+2*a[d]}else c+=(b-2)*(2*this.numJoinSubdivisions+4);this.canBeMerged&&(c+=2);return c};a.prototype.write=
function(a,b,c,e){var f=this,g=da,h=F,k=ea,m=b.vertexAttr[v.VertexAttrConstants.POSITION].data,p=b.indices&&b.indices[v.VertexAttrConstants.POSITION];p&&p.length!==2*(m.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");p=null;b.vertexAttr[v.VertexAttrConstants.SUBDIVISIONS]&&(p=b.vertexAttr[v.VertexAttrConstants.SUBDIVISIONS].data);var r=1,q=0;this.parms.vvSizeEnabled?q=b.vertexAttr[v.VertexAttrConstants.SIZEFEATUREATTRIBUTE].data[0]:b.vertexAttr[v.VertexAttrConstants.SIZE]&&
(r=b.vertexAttr[v.VertexAttrConstants.SIZE].data[0]);var l=[1,1,1,1],u=0;this.parms.vvColorEnabled?u=b.vertexAttr[v.VertexAttrConstants.COLORFEATUREATTRIBUTE].data[0]:b.vertexAttr[v.VertexAttrConstants.COLOR]&&(l=b.vertexAttr[v.VertexAttrConstants.COLOR].data);var y=0;this.parms.vvOpacityEnabled&&(y=b.vertexAttr[v.VertexAttrConstants.OPACITYFEATUREATTRIBUTE].data[0]);b=m.length/3;a=a.transformation;var x=new Float32Array(c.buffer),t=0;c=this.vertexBufferLayout.stride/4;var w=e*c,z=w,n=function(a,
b,c,d,e,g){x[w++]=b[0];x[w++]=b[1];x[w++]=b[2];x[w++]=d;x[w++]=e;x[w++]=g;x[w++]=a[0];x[w++]=a[1];x[w++]=a[2];x[w++]=c[0];x[w++]=c[1];x[w++]=c[2];f.parms.vvSizeEnabled?x[w++]=q:x[w++]=r;f.parms.vvColorEnabled?x[w++]=u:(x[w++]=l[0],x[w++]=l[1],x[w++]=l[2],x[w++]=l[3]);f.parms.vvOpacityEnabled&&(x[w++]=y)};this.canBeMerged&&(w+=c);d.vec3.set(g,m[0],m[1],m[2]);a&&d.vec3.transformMat4(g,g,a);d.vec3.set(k,m[3],m[4],m[5]);a&&d.vec3.transformMat4(k,k,a);d.vec3.copy(h,g);for(e=0;e<this.numCapSubdivisions;++e){var B=
1-e/this.numCapSubdivisions;n(g,h,k,B,t,-4);n(g,h,k,B,t,4)}n(g,h,k,0,t,-4);n(g,h,k,0,t,4);d.vec3.copy(g,h);d.vec3.copy(h,k);for(e=1;e<b-1;e++){B=3*e;d.vec3.set(k,m[B+3],m[B+4],m[B+5]);a&&d.vec3.transformMat4(k,k,a);t+=d.vec3.distance(g,h);n(g,h,k,0,t,-1);n(g,h,k,0,t,1);for(var L=p?p[e]:this.numJoinSubdivisions,C=0;C<L;++C)B=(C+1)/(L+1),n(g,h,k,B,t,-2),n(g,h,k,B,t,2);n(g,h,k,1,t,-2);n(g,h,k,1,t,2);d.vec3.copy(g,h);d.vec3.copy(h,k)}t+=d.vec3.distance(g,h);n(g,h,k,0,t,-5);n(g,h,k,0,t,5);for(e=0;e<this.numCapSubdivisions;++e)B=
(e+1)/this.numCapSubdivisions,n(g,h,k,B,t,-5),n(g,h,k,B,t,5);if(this.canBeMerged){for(e=z;e<z+c;e++)x[e]=x[e+c];g=w-c;for(e=0;e<c;e++)x[w++]=x[g++]}};return a}(),J={factor:0,units:-4},N=3,L=1,M=f.vec3f64.create(),R=f.vec3f64.create(),S=f.vec3f64.create(),T=f.vec3f64.create(),U=f.vec3f64.create(),Y=g.createRenderScreenPointArray3(),X=g.createRenderScreenPointArray3(),P=f.vec3f64.create(),V=f.vec3f64.create(),Z=c.lineSegment.create(),ca=c.lineSegment.create(),da=f.vec3f64.create(),F=f.vec3f64.create(),
ea=f.vec3f64.create(),la=[g.createRenderScreenPointArray3(),g.createRenderScreenPointArray3(),g.createRenderScreenPointArray3(),g.createRenderScreenPointArray3()],ka=[f.vec3f64.create(),f.vec3f64.create(),f.vec3f64.create(),f.vec3f64.create()],oa=c.plane.create(),va=c.plane.create(),fa=c.plane.create(),xa=c.plane.create();return n})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat3f64","../../../../core/libs/gl-matrix-2/vec3f32"],
function(n,b,l,k){var h;(h||(h={})).Default={vvSizeEnabled:!1,vvSizeMinSize:k.vec3f32.fromValues(1,1,1),vvSizeMaxSize:k.vec3f32.fromValues(100,100,100),vvSizeOffset:k.vec3f32.fromValues(0,0,0),vvSizeFactor:k.vec3f32.fromValues(1,1,1),vvSizeValue:k.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,
0,0],vvSymbolRotationMatrix:l.mat3f64.create()};return h})},"esri/views/3d/webgl-engine/shaders/RibbonLinePrograms":function(){define(["require","exports","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.VertexAttrConstants={POSITION:"position",SUBDIVISIONFACTOR:"subdivisionFactor",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",SUBDIVISIONS:"subdivisions",COLOR:"color",COLORFEATUREATTRIBUTE:"colorFeatureAttribute",SIZE:"size",
SIZEFEATUREATTRIBUTE:"sizeFeatureAttribute",OPACITYFEATUREATTRIBUTE:"opacityFeatureAttribute"};b.vertexAttributeLocations={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15};var h=function(a){return k.glslifyDefineMap({STIPPLE:a.stipple,SLICE:a.slice,JOIN_ROUND:"round"===a.join,CAP_ROUND:"round"===a.cap,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VV_OPACITY:a.vvOpacity})};
b.colorPass={name:"ribbon-line-color",shaders:function(a){return{vertexShader:h(a)+l.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:h(a)+l.resolveIncludes("materials/ribbonLine/colorPass.frag")}},attributes:b.vertexAttributeLocations};b.highlightPass={name:"ribbon-line-highlight",shaders:function(a){return{vertexShader:h(a)+l.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:h(a)+l.resolveIncludes("materials/ribbonLine/highlightPass.frag")}},attributes:b.vertexAttributeLocations}})},
"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T,U){Object.defineProperty(b,"__esModule",{value:!0});var Y=R.VertexAttrConstants;n=function(b){function c(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._materials=new Map;a._textures=new Map;return a}l(c,b);c.prototype.doLoad=function(){return h(this,void 0,void 0,function(){return k(this,function(a){I.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new T({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=
new T({color:[0,1,1,1]},"debugFAceNormal"));return[2]})})};c.prototype.destroy=function(){var a=this;b.prototype.destroy.call(this);this._materials.forEach(function(b){a._context.stage.remove(3,b.material.id)});this._textures.forEach(function(b){a._context.stage.remove(4,b.id)});this._materials.clear();this._textures.clear()};c.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,c.validGeometryTypes,"fill on mesh-3d")||!this._validateGeometry(b.geometry))return null;
var d="graphic"+b.uid,e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,e,d,b.uid)};c.prototype.layerOpacityChanged=function(a,b){var c=this,e=this._getLayerOpacity();this._materials.forEach(function(a){a.material.setParameterValues({layerOpacity:e});var b=a.material.getParameters();c._setMaterialTransparentParameter(b,a);a.material.setParameterValues({transparent:b.transparent})});a.forEach(function(a){a=b(a);d.isSome(a)&&a.layerOpacityChanged(e,c._context.isAsync)});
return!0};c.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,B.needsElevationUpdates3D)};c.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._materials.forEach(function(a){a.material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});a.forEach(function(a){a=b(a);d.isSome(a)&&a.slicePlaneEnabledChanged(c._context.slicePlaneEnabled,c._context.isAsync)});return!0};c.prototype.physicalBasedRenderingChanged=function(a,
b){var c=this;this._materials.forEach(function(a){a.material.setParameterValues(U.returnDefaultPBRMaterialParameters(c._context.physicalBasedRenderingEnabled))});return!0};c.prototype.pixelRatioChanged=function(a,b){return!0};c.prototype._requiresSymbolVertexColors=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};c.prototype._colorOrTextureUid=function(a){return a?a instanceof g?a.toHex():a.contentHash:"-"};c.prototype._materialProperties=function(a,b,c){var d=
this._requiresSymbolVertexColors(),e,f,g,h,k,m,p,r,q;b.material&&(f=b.material.color,e=this._colorOrTextureUid(b.material.color),g=b.material.colorTexture,h=this._colorOrTextureUid(b.material.colorTexture),k=b.material.normalTexture,m=this._colorOrTextureUid(b.material.normalTexture),p=b.material.doubleSided,r=b.material.alphaCutoff,q=b.material.alphaMode);b=!!a.vertexAttributes.color;a=!!a.vertexAttributes.tangent;return{hasSymbolVertexColors:d,hasVertexColors:b,hasVertexTangents:a,color:f,colorTexture:g,
normalTexture:k,uid:"vc:"+b+",vt:"+a+",vct"+c+",svc:"+d+",cmuid:"+e+",ctmuid:"+h+",ntmuid:"+m+",ds:"+p+",ac:"+r+",am:"+q}};c.prototype._setInternalColorValueParameters=function(a,b){b.diffuse=g.toUnitRGB(a);b.opacity=a.a};c.prototype._getLoadableTextureResource=function(a){return a.data?a.data instanceof HTMLImageElement?a.data.complete?a.data:a.data.src:a.data:a.url};c.prototype._getInternalTextureId=function(a,b){var c=this._getLoadableTextureResource(a);if(c){var d=a.contentHash,e=this._textures.get(d);
e||(e=new M(c,b+"_"+d+"_tex",{mipmap:!0,wrap:this._castTextureWrap(a.wrap),noUnpackFlip:!0}),this._textures.set(d,e),this._context.stage.add(4,e));return e.id}};c.prototype._castTextureWrap=function(a){void 0===a&&(a="repeat");return"string"===typeof a?(a=this._castTextureWrapIndividual(a),{s:a,t:a}):{s:this._castTextureWrapIndividual(a.horizontal),t:this._castTextureWrapIndividual(a.vertical)}};c.prototype._castTextureWrapIndividual=function(a){switch(a){case "clamp":return 33071;case "mirror":return 33648;
default:return 10497}};c.prototype._setInternalMaterialParameters=function(a,b,c){a.color&&this._setInternalColorValueParameters(a.color,c);a.colorTexture&&(c.textureId=this._getInternalTextureId(a.colorTexture,b));a.normalTexture&&(c.normalTextureId=this._getInternalTextureId(a.normalTexture,b))};c.prototype._setExternalMaterialParameters=function(a){var b=this._isPropertyDriven("color"),c=d.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;b?a.externalColor=x.vec4f64.ONES:
(b=d.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,d.isSome(b)?a.externalColor=g.toUnitRGBA(b):(c=null,a.externalColor=x.vec4f64.ONES));c&&(a.colorMixMode=c)};c.prototype._hasTransparentVertexColors=function(a){a=a.vertexAttributes.color;if(!a)return!1;for(var b=3;b<a.length;b+=4)if(255!==a[b])return!0;return!1};c.prototype._getOrCreateMaterial=function(b,c){var d=c.material&&c.material.color,e=c.material&&c.material.colorTexture,f=c.material&&"blend"===c.material.alphaMode,
d=!(c.material&&"opaque"===c.material.alphaMode)&&(this._hasTransparentVertexColors(b)||d&&1>d.a||e&&e.transparent||f);b=this._materialProperties(b,c,d);if(e=this._materials.get(b.uid))return e.material;d={material:null,isComponentTransparent:d,alphaMode:c.material?c.material.alphaMode:"opaque"};e=this._getIdHint();f={specular:t.vec3f64.ZEROS,vertexColors:b.hasVertexColors,symbolColors:b.hasSymbolVertexColors,vertexTangents:b.hasVertexTangents,ambient:t.vec3f64.ZEROS,diffuse:t.vec3f64.ONES,opacity:1,
doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,textureInitTransparent:!0};f=a({},f,U.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled));c.material&&(f.doubleSided=c.material.doubleSided,f.cullFace=c.material.doubleSided?"none":"back",f.textureAlphaCutoff=c.material.alphaCutoff);this._setInternalMaterialParameters(b,e,f);this._setExternalMaterialParameters(f);this._setMaterialTransparentParameter(f,
d);c=new S(f,e+"_"+b.uid+"_mat");d.material=c;this._materials.set(b.uid,d);this._context.stage.add(3,c);return c};c.prototype._setMaterialTransparentParameter=function(a,b){var c=this._isPropertyDriven("opacity");a.transparent=c||b.isComponentTransparent||1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3];a.textureAlphaMode="auto"===b.alphaMode?a.transparent?"maskBlend":"opaque":b.alphaMode};c.prototype._addDebugNormals=function(a,b,c,d){var e,f,g,h,k=b.length,m=a.spatialReference.isGeographic?
20015077/180:1,q=.1*Math.max(a.extent.width*m,a.extent.height*m,a.extent.zmax-a.extent.zmin),l=[],v=[];a=[];for(var m=[],u=0;u<k;u++)for(var y=b[u],x=y.data.getAttribute(Y.POSITION),t=y.data.getAttribute(Y.NORMAL),w=y.data.getIndices(Y.POSITION),y=y.data.getIndices(Y.NORMAL),x=x.data,t=t.data,z=0;z<w.length;z++){for(var n=3*w[z],B=3*y[z],L=0;3>L;L++)l.push(x[n+L]);for(L=0;3>L;L++)l.push(x[n+L]+t[B+L]*q);v.push(v.length);v.push(v.length);if(0===z%3){this._calculateFaceNormal(x,w,z,ca);this._getFaceVertices(x,
w,z,P,V,Z);r.vec3.add(P,P,V);r.vec3.add(P,P,Z);r.vec3.scale(P,P,1/3);for(L=0;3>L;L++)a.push(P[L]);for(L=0;3>L;L++)a.push(P[L]+ca[L]*q);m.push(m.length);m.push(m.length)}}k=(e={},e[Y.POSITION]={data:new Float64Array(l),size:3},e);e=(f={},f[Y.POSITION]=new Uint32Array(v),f);f=new N.GeometryData(k,e,void 0,"line");f=new J(f,"debugVertexNormal");f.singleUse=!0;b.push(f);c.push(this._debugVertexNormalMaterial);d.push(p.mat4f64.clone(d[0]));k=(g={},g[Y.POSITION]={data:new Float64Array(a),size:3},g);e=(h=
{},h[Y.POSITION]=new Uint32Array(m),h);f=new N.GeometryData(k,e,void 0,"line");f=new J(f,"debugFaceNormal");f.singleUse=!0;b.push(f);c.push(this._debugFaceNormalMaterial);d.push(p.mat4f64.clone(d[0]))};c.prototype._createAs3DShape=function(a,b,c,e,f){a=a.geometry;if("mesh"!==a.type)return null;var g=this._createGeometryInfo(a,b,e);if(!g)return null;b=g.geometries;var h=g.materials,k=g.transformations,g=g.objectTransformation;I.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,b,h,k);f=new L({geometries:b,
materials:h,transformations:k,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:f},idHint:e});f.objectTransformation=g;e=v.perObjectElevationAligner;k=this._createEdgeMaterial();h=d.isSome(k)?{baseMaterial:h[0],edgeMaterials:[k],addObjectSettings:{mergeGeometries:!0},slicePlaneEnabled:this._context.slicePlaneEnabled}:null;b=new z(this,f,b,null,null,e,c,h);b.needsElevationUpdates=B.needsElevationUpdates3D(c.mode);c=a.extent.center.clone();c.z=0;b.elevationContext.centerPointInElevationSR=
c;b.alignedTerrainElevation=e(b,b.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext);return b};c.prototype._createComponentNormals=function(a,b,c,d){var f=c.shading||"flat";switch(f){case "source":return this._createComponentNormalsSource(a,b,c,d);case "flat":return this._createComponentNormalsFlat(a,c,d);case "smooth":return this._createComponentNormalsSmooth(a,c,d);default:e.neverReached(f)}};c.prototype._createComponentNormalsSource=
function(a,b,c,d){if(!b)return this._createComponentNormalsFlat(a,c,d);var e=!1;if(!c.trustSourceNormals)for(c=0;c<d.length;c+=3){this._calculateFaceNormal(a,d,c,ca);for(var f=0;3>f;f++){var g=3*d[c+f];P[0]=b[g+0];P[1]=b[g+1];P[2]=b[g+2];0>r.vec3.dot(ca,P)&&(b[g+0]=-b[g+0],b[g+1]=-b[g+1],b[g+2]=-b[g+2],e=!0)}}return{normals:b,indices:d,didFlipNormals:e}};c.prototype._createComponentNormalsFlat=function(a,b,c){b=new Float32Array(c.length);for(var d=new Uint32Array(3*c.length),e=0;e<c.length;e+=3)for(var f=
this._calculateFaceNormal(a,c,e,ca),g=0;3>g;g++)b[e+g]=f[g],d[e+g]=e/3;return{normals:b,indices:d,didFlipNormals:!1}};c.prototype._createComponentNormalsSmooth=function(a,b,c){b={};for(var d=0;d<c.length;d+=3)for(var e=this._calculateFaceNormal(a,c,d,ca),f=0;3>f;f++){var g=c[d+f],h=b[g];h||(h={normal:t.vec3f64.create(),count:0},b[g]=h);r.vec3.add(h.normal,h.normal,e);h.count++}a=new Float32Array(3*c.length);e=new Uint32Array(3*c.length);for(d=0;d<c.length;d++){g=c[d];h=b[g];1!==h.count&&(r.vec3.normalize(h.normal,
h.normal),h.count=1);for(f=0;3>f;f++)a[3*d+f]=h.normal[f];e[d]=d}return{normals:a,indices:e,didFlipNormals:!1}};c.prototype._getFaceVertices=function(a,b,c,d,e,f){var g=3*b[c+0],h=3*b[c+1];b=3*b[c+2];d[0]=a[g+0];d[1]=a[g+1];d[2]=a[g+2];e[0]=a[h+0];e[1]=a[h+1];e[2]=a[h+2];f[0]=a[b+0];f[1]=a[b+1];f[2]=a[b+2]};c.prototype._calculateFaceNormal=function(a,b,c,d){this._getFaceVertices(a,b,c,P,V,Z);r.vec3.subtract(V,V,P);r.vec3.subtract(Z,Z,P);r.vec3.cross(P,V,Z);r.vec3.normalize(d,P);return d};c.prototype._getOrCreateComponents=
function(a){return a.components?a.components:la};c.prototype._createPositionBuffer=function(a){var b=a.vertexAttributes.position,c=new Float64Array(b.length);B.reproject(a.vertexAttributes.position,0,a.spatialReference,c,0,this._context.renderSpatialReference,b.length/3);return c};c.prototype._createNormalBuffer=function(a,b){var c=a.vertexAttributes.normal;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=a.vertexAttributes.position,e=new Float32Array(c.length);
return m.projectNormalToECEF(c,d,b,a.spatialReference,e)};c.prototype._createTangentBuffer=function(a,b){var c=a.vertexAttributes.tangent;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=a.vertexAttributes.position,e=new Float32Array(c.length);return m.projectTangentToECEF(c,d,b,a.spatialReference,e)};c.prototype._createColorBuffer=function(a){return a.vertexAttributes.color};c.prototype._createSymbolColorBuffer=function(a){if(this._requiresSymbolVertexColors()){a=
this._getVertexOpacityAndColor(a);var b=d.get(this.symbolLayer,"material","colorMixMode"),c=new Uint8Array(4);K.encodeSymbolColor(a,b,c);return c}return null};c.prototype._createColorIndices=function(a,b){a=new Uint32Array(b.length);for(b=0;b<a.length;b++)a[b]=0;return a};c.prototype._createBuffers=function(a,b){var c=a.vertexAttributes&&a.vertexAttributes.position;if(!c)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,e=a.vertexAttributes.uv,
f=a.vertexAttributes.tangent;if(d&&d.length!==c.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(f&&f.length/4!==c.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(e&&e.length/2!==c.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;c=this._createPositionBuffer(a);
d=this._createColorBuffer(a);b=this._createSymbolColorBuffer(b);var f=this._createNormalBuffer(a,c),g=this._createTangentBuffer(a,c);a=this._transformCenterLocal(a,c,f);return{positionBuffer:c,normalBuffer:f,tangentBuffer:g,uvBuffer:e,colorBuffer:d,symbolColorBuffer:b,objectTransformation:a}};c.prototype._transformCenterLocal=function(a,b,c){var d=a.extent.center,e=this._context.renderSpatialReference;X[0]=d.x;X[1]=d.y;X[2]=0;d=p.mat4f64.create();Q.computeLinearTransformation(a.spatialReference,X,
d,e);q.mat4.invert(da,d);for(a=0;a<b.length;a+=3)P[0]=b[a+0],P[1]=b[a+1],P[2]=b[a+2],r.vec3.transformMat4(P,P,da),b[a+0]=P[0],b[a+1]=P[1],b[a+2]=P[2];if(c)for(f.mat3.fromMat4(F,d),f.mat3.transpose(F,F),a=0;a<c.length;a+=3)P[0]=c[a+0],P[1]=c[a+1],P[2]=c[a+2],r.vec3.transformMat3(P,P,F),c[a+0]=P[0],c[a+1]=P[1],c[a+2]=P[2];return d};c.prototype._validateFaces=function(a,b){a=a.vertexAttributes.position.length/3;if(b=b.faces){for(var c=-1,d=0;d<b.length;d++){var e=b[d];e>c&&(c=e)}if(a<=c)return this.logger.warn("Vertex index "+
c+" is out of bounds of the mesh position buffer"),!1}else if(0!==a%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};c.prototype._getOrCreateFaces=function(a,b){if(b.faces)return b.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(b=0;b<a.length;b++)a[b]=b;return a};c.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var b=
a.vertexAttributes&&a.vertexAttributes.position;if(!b)return!1;var c=this._context.elevationProvider.spatialReference,d=b.length/3;a.spatialReference.equals(c)||(b=new Float64Array(b.length),B.reproject(a.vertexAttributes.position,0,a.spatialReference,b,0,c,d));B.computeBoundingBox(b,0,d,ea);return B.boundingBoxClipped(ea,this._context.clippingExtent)};c.prototype._createGeometryInfo=function(a,b,c){var d,e;if(!y.canProject(a,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),
null;if(this._isOutsideClippingArea(a))return null;var f=this._createBuffers(a,b);if(!f)return null;b=f.positionBuffer;for(var g=f.uvBuffer,h=f.colorBuffer,k=f.symbolColorBuffer,m=f.normalBuffer,r=f.tangentBuffer,f=f.objectTransformation,q=[],l=[],v=[],u=!1,x=0,t=this._getOrCreateComponents(a);x<t.length;x++){var w=t[x];if(!this._validateFaces(a,w))return null;var z=this._getOrCreateFaces(a,w);if(0!==z.length){var n=this._createComponentNormals(b,m,w,z);n.didFlipNormals&&(u=!0);var B=(d={},d[Y.POSITION]=
{size:3,data:b},d[Y.NORMAL]={size:3,data:n.normals},d),n=(e={},e[Y.POSITION]=z,e[Y.NORMAL]=n.indices,e);h&&(B[Y.COLOR]={size:4,data:h},n[Y.COLOR]=z);k&&(B[Y.SYMBOLCOLOR]={size:4,data:k},n[Y.SYMBOLCOLOR]=this._createColorIndices(w,z));a.vertexAttributes.uv&&(B[Y.UV0]={size:2,data:g},n[Y.UV0]=z);a.vertexAttributes.tangent&&(B[Y.TANGENT]={size:4,data:r},n[Y.TANGENT]=z);z=new N.GeometryData(B,n);z=new J(z,c+"_mesh");z.singleUse=!0;q.push(z);l.push(p.mat4f64.create());v.push(this._getOrCreateMaterial(a,
w))}}u&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:q,transformations:l,materials:v,objectTransformation:f}};c.prototype._createEdgeMaterial=function(){var a={opacity:this._getLayerOpacity()};return D.createMaterial(this.symbolLayer,a)};c.validGeometryTypes=["mesh"];return c}(C.default);b.Graphics3DMeshFillSymbolLayer=n;var X=t.vec3f64.create(),
P=t.vec3f64.create(),V=t.vec3f64.create(),Z=t.vec3f64.create(),ca=t.vec3f64.create(),da=p.mat4f64.create(),F=c.mat3f64.create(),ea=w.create(),la=[new u];b.default=n})},"esri/geometry/support/MeshComponent":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ./MeshMaterial ./MeshVertexAttributes".split(" "),function(n,b,l,k,h,a,g,e,d,f){var c=g.getLogger("esri.geometry.support.MeshComponent");
return function(b){function g(a){a=b.call(this)||this;a.faces=null;a.material=null;a.shading="source";a.trustSourceNormals=!1;return a}l(g,b);h=g;g.prototype.castFaces=function(a){return f.castArray(a,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},c)};g.prototype.clone=function(){return new h({faces:a.clone(this.faces),shading:this.shading,material:a.clone(this.material),trustSourceNormals:this.trustSourceNormals})};g.prototype.cloneWithDeduplication=function(b,c){return new h({faces:a.clone(this.faces),
shading:this.shading,material:this.material?this.material.cloneWithDeduplication(b,c):null,trustSourceNormals:this.trustSourceNormals})};var h;k([e.property({json:{write:!0}})],g.prototype,"faces",void 0);k([e.cast("faces")],g.prototype,"castFaces",null);k([e.property({type:d,json:{write:!0}})],g.prototype,"material",void 0);k([e.property({type:String,json:{write:!0}})],g.prototype,"shading",void 0);k([e.property({type:Boolean})],g.prototype,"trustSourceNormals",void 0);return g=h=k([e.subclass("esri.geometry.support.MeshComponent")],
g)}(e.declared(h))})},"esri/geometry/support/MeshMaterial":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./ImageMeshColor ./MeshTexture ./ValueMeshColor".split(" "),function(n,b,l,k,h,a,g,e,d,f,c,q,p){function r(){t.warn('Assigning ImageMeshColor to "MeshMaterial.color" is deprecated. Assigning to "MeshMaterial.colorTexture" instead.')}
var t=e.getLogger("esri.geometry.support.MeshMaterial"),x=/^\s*(#|rgba?\()/;return function(a){function b(b){b=a.call(this)||this;b.color=null;b.colorTexture=null;b.normalTexture=null;b.alphaMode="auto";b.alphaCutoff=.5;b.doubleSided=!0;return b}l(b,a);e=b;b.prototype.castColor=function(a){if(!a)return a;if(Array.isArray(a))return new h(a);if(a instanceof h||a instanceof q)return a;if("string"===typeof a){if(x.test(a)||h.named[a])return new h(a);r();this.colorTexture=new q({url:a});return null}return a instanceof
HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData?(r(),this.colorTexture=new q({data:a}),null):a instanceof c?(r(),this.colorTexture=new q({url:a.url,data:a.data}),null):"image"===a.type?(r(),this.colorTexture=new q(a),null):a instanceof p?(t.warn('Assigning ValueMeshColor to "MeshMaterial.color" is deprecated. Automatically converting it to esri.Color.'),new h(a.value)):f.ensureType(h,a)};b.prototype.castColorTexture=function(a){return a?"string"===typeof a?new q({url:a}):
a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData?new q({data:a}):f.ensureType(q,a):a};b.prototype.readColorTexture=function(a,b,c){if(a)return new q(a)};b.prototype.castNormalTexture=function(a){return a?"string"===typeof a?new q({url:a}):a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData?new q({data:a}):f.ensureType(q,a):a};b.prototype.readNormalTexture=function(a,b,c){if(a)return new q(a)};b.prototype.clone=function(){return new e({color:g.clone(this.color),
colorTexture:g.clone(this.colorTexture),normalTexture:g.clone(this.normalTexture),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided})};b.prototype.cloneWithDeduplication=function(a,b){var c=a.get(this);if(c)return c;b=new e({color:g.clone(this.color),colorTexture:this.colorTexture?this.colorTexture.cloneWithDeduplication(b):null,normalTexture:this.normalTexture?this.normalTexture.cloneWithDeduplication(b):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,
doubleSided:this.doubleSided});a.set(this,b);return b};var e;k([d.property({type:h,json:{write:!0}})],b.prototype,"color",void 0);k([d.cast("color")],b.prototype,"castColor",null);k([d.property({json:{write:!0}})],b.prototype,"colorTexture",void 0);k([d.cast("colorTexture")],b.prototype,"castColorTexture",null);k([d.reader("colorTexture")],b.prototype,"readColorTexture",null);k([d.property({json:{write:!0}})],b.prototype,"normalTexture",void 0);k([d.cast("normalTexture")],b.prototype,"castNormalTexture",
null);k([d.reader("normalTexture")],b.prototype,"readNormalTexture",null);k([d.property({json:{write:!0}})],b.prototype,"alphaMode",void 0);k([d.property({json:{write:!0}})],b.prototype,"alphaCutoff",void 0);k([d.property({json:{write:!0}})],b.prototype,"doubleSided",void 0);return b=e=k([d.subclass("esri.geometry.support.MeshMaterial")],b)}(d.declared(a.JSONSupport))})},"esri/geometry/support/ImageMeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Identifiable ../../core/Logger ../../core/urlUtils ../../core/accessorSupport/decorators ./MeshColor ../../views/support/screenshotUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){var q=g.getLogger("esri.geometry.support.ImageMeshColor");return function(a){function b(b){b=a.call(this)||this;b.type="image";q.warn("esri/geometry/support/ImageMeshColor is deprecated since version 4.11. Use esri/geometry/support/MeshTexture instead.");return b}l(b,a);f=b;Object.defineProperty(b.prototype,"url",{get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!0,configurable:!0});b.prototype.writeData=function(a,b,c,d){a instanceof HTMLImageElement?a={type:"image-element",src:e.toJSON(a.src,d)}:a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a={type:"image-data",imageData:this.encodeImageData(a)};b[c]=a};b.prototype.readData=function(a,
b){switch(a.type){case "image-element":return b=new Image,b.src=a.src,b;case "canvas-element":return a=this.decodeImageData(a.imageData),b=document.createElement("canvas"),b.width=a.width,b.height=a.height,b.getContext("2d").putImageData(a,0,0),b;case "image-data":return this.decodeImageData(a.imageData);default:h.neverReached(a)}};Object.defineProperty(b.prototype,"transparent",{get:function(){var a=this.data,b=this.url;return a instanceof HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,
0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):b&&(a=b.substr(b.length-4,4).toLowerCase(),b=b.substr(0,15).toLocaleLowerCase(),".png"===a||"data:image/png;"===b)?!0:!1},set:function(a){null!=a?this._override("transparent",a):this._clearOverride("transparent")},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new f({url:this.url,data:this.data})};b.prototype.encodeImageData=function(a){for(var b="",c=0;c<a.data.length;c++)b+=String.fromCharCode(a.data[c]);
return{data:btoa(b),width:a.width,height:a.height}};b.prototype.decodeImageData=function(a){for(var b=atob(a.data),d=new Uint8ClampedArray(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return c.wrapImageData(d,a.width,a.height)};b.prototype.imageDataContainsTransparent=function(a){for(var b=3;b<a.data.length;b+=4)if(255!==a.data[b])return!0;return!1};var f;k([d.property()],b.prototype,"type",void 0);k([d.property({type:String,json:{write:e.write}})],b.prototype,"url",null);k([d.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),
d.property()],b.prototype,"data",null);k([d.writer("data")],b.prototype,"writeData",null);k([d.reader("data")],b.prototype,"readData",null);k([d.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null);return b=f=k([d.subclass("esri.geometry.support.ImageMeshColor")],b)}(d.declared(a.IdentifiableMixin(f.default)))})},"esri/geometry/support/MeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(a){return b.call(this)||this}l(e,b);e.prototype.clone=function(){throw Error("not implemented");};k([a.property({readOnly:!0,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0,enabled:!0}}})],e.prototype,"type",void 0);return e=k([a.subclass("esri.geometry.support.MeshColor")],e)}(a.declared(h.JSONSupport));b.MeshColor=n;b.default=n})},"esri/views/support/screenshotUtils":function(){define(["require","exports",
"../../core/tsSupport/assignHelper","../../core/compilerUtils","../../core/mathUtils"],function(n,b,l,k,h){function a(a,b){var c=a||{},e=c.format,g=c.quality,p=c.rotation,c=c.disableSlice,q=a&&!a.ignorePadding&&b.padding||x,l;l=b.width-q.left-q.right;b=b.height-q.top-q.bottom;var u=q=0,w=l,n=b;if(a&&a.area){var q=Math.floor(a.area.x)||0,u=Math.floor(a.area.y)||0,Q=null!=a.area.width?Math.floor(a.area.width):null,J=null!=a.area.height?Math.floor(a.area.height):null,w=w-q,n=n-u;null!=Q&&null!=J?(w=
Math.min(w,Q),n=Math.min(n,J)):null==Q&&null!=J?(Q=Math.min(w,Q),n*=Q/w,w=Q):null!=Q&&null==J&&(Q=Math.min(n,J),w*=Q/n,n=Q)}q=f({x:q,y:u,width:w,height:n},a);u=Math.floor(Math.max(q.x,0));w=Math.floor(Math.max(q.y,0));l={x:u,y:w,width:Math.floor(Math.min(q.width,l-u)),height:Math.floor(Math.min(q.height,b-w))};b=l.width/l.height;q=q.width/q.height;q!==b&&(q>b?(b=Math.floor(l.width/q),l={x:l.x,y:Math.floor(l.y+(l.height-b)/2),width:l.width,height:b}):(b=Math.floor(l.height*q),l={x:Math.floor(l.x+(l.width-
b)/2),y:l.y,width:b,height:l.height}));q=d(a,l);b=q.width;q=q.height;a:switch(e){case "png":case "jpg":case "jpeg":break a;case null:case void 0:e=r;break a;default:k.neverReached(e),e=r}u=t[e];g=h.clamp(null!=g?g:u,0,100);return{format:e,quality:g,area:l,width:b,height:q,rotation:p,disableSlice:c||!1,ignoreBackground:a&&a.ignoreBackground}}function g(a,b){return a.toDataURL(p[b.format],b.quality/100)}function e(a,b,d){d||(c||(c=document.createElement("canvas"),c.width=1,c.height=1),d=c);return d.getContext("2d").createImageData(a,
b)}function d(a,b){if(!a)return b;var c=a.width;a=a.height;if(null!=c&&null!=a)return{width:Math.floor(c),height:Math.floor(a)};if(null==c&&null==a)return b;b=b.width/b.height;return null==a?{width:Math.floor(c),height:Math.floor(c/b)}:{width:Math.floor(a*b),height:Math.floor(a)}}function f(a,b){if(!b||null==b.width||null==b.height)return a;b=b.width/b.height;var c=a.width/a.height;if(c===b)return a;if(c<b)return a.width=Math.floor(a.height*b),a.height=a.height,a;a.width=a.width;a.height=Math.floor(a.width/
b);return a}Object.defineProperty(b,"__esModule",{value:!0});b.completeUserSettings=a;b.toRenderSettings=function(b,c){var d=a(b,c),e=d.area,f=d.width/e.width,g=b&&!b.ignorePadding&&c.padding||x,h=g.left+g.right,k=g.top+g.bottom;return{framebufferWidth:Math.floor((c.width-h)*f+h),framebufferHeight:Math.floor((c.height-k)*f+k),region:{x:Math.floor(e.x*f)+g.left,y:Math.floor(e.y*f)+g.top,width:d.width,height:d.height},format:d.format,quality:d.quality,rotation:d.rotation,pixelRatio:f,layers:b&&b.layers?
b.layers:[],disableSlice:d.disableSlice,ignoreBackground:d.ignoreBackground}};b.encodeResult=function(a,b,c,d){if(d.premultipliedAlpha)for(var e=a.data,f=e.length,h=0;h<f;h+=4){var k=e[h+3];0<k&&(k/=255,e[h+0]/=k,e[h+1]/=k,e[h+2]/=k)}c.width=a.width;c.height=a.height;e=c.getContext("2d");e.putImageData(a,0,0);d.flipY&&(e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore());a=e.getImageData(0,0,a.width,a.height);b=g(c,b);c.width=
0;c.height=0;return{dataUrl:b,data:a}};b.toDataUrl=g;b.createEmptyImageData=function(a,b,c){if(!a||!b)throw Error("Cannot construct image data without dimensions");if(q)try{return new ImageData(a,b)}catch(m){q=!1}return e(a,b,c)};b.wrapImageData=function(a,b,c,d){if(!b||!c)throw Error("Cannot construct image data without dimensions");if(q)try{return new ImageData(a,b,c)}catch(v){q=!1}b=e(b,c,d);b.data.set(a,0);return b};b.resampleHermite=function(a,b,c,d,e,f,g,h){void 0===d&&(d=0);void 0===e&&(e=
0);void 0===f&&(f=a.width-d);void 0===g&&(g=a.height-e);void 0===h&&(h=!1);var k=a.data,m=b.width,p=b.height,q=b.data;f/=m;g/=p;var r=Math.ceil(f/2),l=Math.ceil(g/2);a=a.width;for(var v=0;v<p;v++)for(var y=0;y<m;y++){for(var u=4*(y+(h?p-v-1:v)*m),t=0,x=0,z=0,w=0,n=0,B=0,C=(v+.5)*g,Z=Math.floor(v*g);Z<(v+1)*g;Z++)for(var ca=Math.abs(C-(Z+.5))/l,da=(y+.5)*f,ca=ca*ca,F=Math.floor(y*f);F<(y+1)*f;F++){var ea=Math.abs(da-(F+.5))/r,ea=Math.sqrt(ca+ea*ea);if(!(1<=ea)){var ea=2*ea*ea*ea-3*ea*ea+1,la=4*(d+
F+(e+Z)*a),B=B+ea*k[la+3],x=x+ea;!c&&255>k[la+3]&&(ea=ea*k[la+3]/255);z+=ea*k[la];w+=ea*k[la+1];n+=ea*k[la+2];t+=ea}}q[u]=z/t;q[u+1]=w/t;q[u+2]=n/t;q[u+3]=B/x}return b};b.screenshotSuperSampleSettings=function(a,b){if(!b)return a;b=a.framebufferWidth;var c=a.framebufferHeight,d=a.region,e=Math.min(8,2048/Math.max(b,c));return 1.5>e?a:l({},a,{framebufferWidth:Math.round(b*e),framebufferHeight:Math.round(c*e),pixelRatio:a.pixelRatio*e,resample:{region:{x:Math.round(d.x*e),y:Math.round(d.y*e),width:Math.round(d.width*
e),height:Math.round(d.height*e)},width:b,height:c}})};var c=null,q=!0,p={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},r="jpg",t={png:100,jpg:98,jpeg:98},x={top:0,right:0,bottom:0,left:0}})},"esri/geometry/support/MeshTexture":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper @dojo/framework/shim/WeakMap ../../core/compilerUtils ../../core/JSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators ../../views/support/screenshotUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f){var c=new h.default,q=0;return function(b){function g(a){a=b.call(this)||this;a.wrap="repeat";return a}l(g,b);h=g;Object.defineProperty(g.prototype,"url",{get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!0,configurable:!0});
g.prototype.writeData=function(a,b,c,d){a instanceof HTMLImageElement?a={type:"image-element",src:e.toJSON(a.src,d)}:a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a={type:"image-data",imageData:this.encodeImageData(a)};b[c]=a};g.prototype.readData=function(b,c){switch(b.type){case "image-element":return c=new Image,c.src=b.src,c;case "canvas-element":return b=this.decodeImageData(b.imageData),c=
document.createElement("canvas"),c.width=b.width,c.height=b.height,c.getContext("2d").putImageData(b,0,0),c;case "image-data":return this.decodeImageData(b.imageData);default:a.neverReached(b)}};Object.defineProperty(g.prototype,"transparent",{get:function(){var a=this.data,b=this.url;return a instanceof HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):b&&(a=b.substr(b.length-4,4).toLowerCase(),
b=b.substr(0,15).toLocaleLowerCase(),".png"===a||"data:image/png;"===b)?!0:!1},set:function(a){null!=a?this._override("transparent",a):this._clearOverride("transparent")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"contentHash",{get:function(){var a=this,b="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?this.wrap.horizontal+"/"+this.wrap.vertical:"",d=function(c){void 0===c&&(c="");return"d:"+c+",t:"+a.transparent+",w:"+b};if(null!=this.url)return d(this.url);
if(null!=this.data){if(this.data instanceof HTMLImageElement)return d(this.data.src);c.has(this.data)||c.set(this.data,++q);return d(c.get(this.data))}return d()},enumerable:!0,configurable:!0});g.prototype.clone=function(){return new h({url:this.url,data:this.data,wrap:this.cloneWrap()})};g.prototype.cloneWithDeduplication=function(a){var b=a.get(this);if(b)return b;b=new h({url:this.url,data:this.data,wrap:this.cloneWrap()});a.set(this,b);return b};g.prototype.cloneWrap=function(){return"string"===
typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};g.prototype.encodeImageData=function(a){for(var b="",c=0;c<a.data.length;c++)b+=String.fromCharCode(a.data[c]);return{data:btoa(b),width:a.width,height:a.height}};g.prototype.decodeImageData=function(a){for(var b=atob(a.data),c=new Uint8ClampedArray(b.length),d=0;d<b.length;d++)c[d]=b.charCodeAt(d);return f.wrapImageData(c,a.width,a.height)};g.prototype.imageDataContainsTransparent=function(a){for(var b=3;b<
a.data.length;b+=4)if(255!==a.data[b])return!0;return!1};var h;k([d.property({type:String,json:{write:e.write}})],g.prototype,"url",null);k([d.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),d.property()],g.prototype,"data",null);k([d.writer("data")],g.prototype,"writeData",null);k([d.reader("data")],g.prototype,"readData",null);k([d.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],
g.prototype,"transparent",null);k([d.property({json:{write:!0}})],g.prototype,"wrap",void 0);k([d.property({readOnly:!0,dependsOn:["url","data","wrap","transparent"]})],g.prototype,"contentHash",null);return g=h=k([d.subclass("esri.geometry.support.MeshTexture")],g)}(d.declared(g.JSONSupport))})},"esri/geometry/support/ValueMeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ./MeshColor".split(" "),
function(n,b,l,k,h,a,g,e,d){var f=g.getLogger("esri.geometry.support.ValueMeshColor");return function(b){function c(a){a=b.call(this)||this;a.type="value";a.value=null;f.warn("esri/geometry/support/ValueMeshColor is deprecated since version 4.11. Use esri/Color instead.");return a}l(c,b);d=c;c.prototype.clone=function(){return new d({value:a.clone(this.value)})};var d;k([e.property()],c.prototype,"type",void 0);k([e.property({type:h})],c.prototype,"value",void 0);return c=d=k([e.subclass("esri.geometry.support.ValueMeshColor")],
c)}(e.declared(d.default))})},"esri/geometry/support/MeshVertexAttributes":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a,g,e){function d(a,b,c,d){var e=b.loggerTag;b=b.stride;return 0!==a.length%b?(d.error(e,"Invalid array length, expected a multiple of "+b),new c([])):a}function f(a,b,c,e,f){if(!a)return a;
if(a instanceof b)return d(a,e,b,f);for(var g=0;g<c.length;g++)if(a instanceof c[g])return d(new b(a),e,b,f);if(Array.isArray(a))return d(new b(a),e,b,f);c=c.map(function(a){return"'"+a.name+"'"});f.error("Failed to set property, expected one of "+c+", but got "+a.constructor.name);return new b([])}function c(a,b,c){for(var d=Array(a.length),e=0;e<a.length;e++)d[e]=a[e];b[c]=d}Object.defineProperty(b,"__esModule",{value:!0});var q=g.getLogger("esri.geometry.support.MeshVertexAttributes");n=function(b){function d(a){a=
b.call(this)||this;a.color=null;a.position=new Float64Array(0);a.uv=null;a.normal=null;a.tangent=null;return a}l(d,b);g=d;d.prototype.castColor=function(a){return f(a,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},q)};d.prototype.castPosition=function(a){a&&a instanceof Float32Array&&q.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return f(a,Float64Array,[Float32Array],
{loggerTag:".position\x3d",stride:3},q)};d.prototype.castUv=function(a){return f(a,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},q)};d.prototype.castNormal=function(a){return f(a,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},q)};d.prototype.castTangent=function(a){return f(a,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},q)};d.prototype.clone=function(){var b={position:a.clone(this.position),uv:a.clone(this.uv),normal:a.clone(this.normal),tangent:a.clone(this.tangent),
color:a.clone(this.color)};return new g(b)};var g;k([e.property({json:{write:c}})],d.prototype,"color",void 0);k([e.cast("color")],d.prototype,"castColor",null);k([e.property({nonNullable:!0,json:{write:c}})],d.prototype,"position",void 0);k([e.cast("position")],d.prototype,"castPosition",null);k([e.property({json:{write:c}})],d.prototype,"uv",void 0);k([e.cast("uv")],d.prototype,"castUv",null);k([e.property({json:{write:c}})],d.prototype,"normal",void 0);k([e.cast("normal")],d.prototype,"castNormal",
null);k([e.property({json:{write:c}})],d.prototype,"tangent",void 0);k([e.cast("tangent")],d.prototype,"castTangent",null);return d=g=k([e.subclass("esri.geometry.support.MeshVertexAttributes")],d)}(e.declared(h.JSONSupport));b.MeshVertexAttributes=n;b.castArray=f;b.default=n})},"esri/geometry/support/meshUtils/projection":function(){define("require exports ../../../core/Logger ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../views/3d/support/projectionUtils ../../../views/3d/support/buffer/BufferView".split(" "),
function(n,b,l,k,h,a,g,e,d,f){function c(a,b,c,e,f,h){if(b){var m=c.count;if(f.isWGS84)for(f=0;f<m;f++)e.getVec(f,p),b.getVec(f,r),d.computeLinearTransformation(d.SphericalECEFSpatialReference,p,t,d.SphericalECEFSpatialReference),k.mat3.fromMat4(x,t),1===a&&k.mat3.transpose(x,x),g.vec3.transformMat3(r,r,x),h.setVec(f,r);else for(f=0;f<m;f++){e.getVec(f,p);b.getVec(f,r);d.computeLinearTransformation(d.SphericalECEFSpatialReference,p,t,d.SphericalECEFSpatialReference);k.mat3.fromMat4(x,t);var q=d.webMercator.y2lat(c.get(f,
1)),q=Math.cos(q);0===a&&(q=1/q);x[0]*=q;x[1]*=q;x[2]*=q;x[3]*=q;x[4]*=q;x[5]*=q;1===a&&k.mat3.transpose(x,x);g.vec3.transformMat3(r,r,x);g.vec3.normalize(r,r);h.setVec(f,r)}return h}}Object.defineProperty(b,"__esModule",{value:!0});var q=l.getLogger("esri.geometry.support.meshUtils.normalProjection");b.projectNormalToECEF=function(a,b,d,e,g){if(!e.isWebMercator&&!e.isWGS84)return q.error("Cannot convert PCS spatial reference buffer to ECEF"),g;c(0,f.BufferViewVec3f.fromTypedArray(a),f.BufferViewVec3f64.fromTypedArray(b),
f.BufferViewVec3f64.fromTypedArray(d),e,f.BufferViewVec3f.fromTypedArray(g));return g};b.projectNormalFromECEF=function(a,b,d,e,g){if(!e.isWebMercator&&!e.isWGS84)return q.error("Cannot convert to PCS spatial reference buffer from ECEF"),g;c(1,f.BufferViewVec3f.fromTypedArray(a),f.BufferViewVec3f64.fromTypedArray(b),f.BufferViewVec3f64.fromTypedArray(d),e,f.BufferViewVec3f.fromTypedArray(g));return g};b.projectToECEF=function(a,b,c){d.bufferToBuffer(a,b,0,c,d.SphericalECEFSpatialReference,0,a.length/
3);return c};b.projectFromECEF=function(a,b,c){d.bufferToBuffer(a,d.SphericalECEFSpatialReference,0,b,c,0,a.length/3);return b};b.transformBufferInPlace=function(a,b,c){void 0===c&&(c=!1);if(a)for(var d=0;d<a.length;d+=3){for(var e=0;3>e;e++)p[e]=a[d+e];g.vec3.transformMat4(p,p,b);c&&g.vec3.normalize(p,p);for(e=0;3>e;e++)a[d+e]=p[e]}};b.projectTangentToECEF=function(a,b,d,e,g){if(!e.isWebMercator&&!e.isWGS84)return q.error("Cannot convert PCS spatial reference buffer to ECEF"),g;c(0,f.BufferViewVec3f.fromTypedArray(a,
4*Float32Array.BYTES_PER_ELEMENT),f.BufferViewVec3f64.fromTypedArray(b),f.BufferViewVec3f64.fromTypedArray(d),e,f.BufferViewVec3f.fromTypedArray(g,4*Float32Array.BYTES_PER_ELEMENT));for(b=3;b<a.length;b+=4)g[b]=a[b];return g};b.projectTangentFromECEF=function(a,b,d,e,g){if(!e.isWebMercator&&!e.isWGS84)return q.error("Cannot convert to PCS spatial reference buffer from ECEF"),g;c(1,f.BufferViewVec3f.fromTypedArray(a,16),f.BufferViewVec3f64.fromTypedArray(b),f.BufferViewVec3f64.fromTypedArray(d),e,
f.BufferViewVec3f.fromTypedArray(g,16));for(b=3;b<a.length;b+=4)g[b]=a[b];return g};var p=e.vec3f64.create(),r=e.vec3f64.create(),t=a.mat4f64.create(),x=h.mat3f64.create()})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports"],function(n,b){function l(b,d){void 0===d&&(d=0);b=b[d+3];return b>a?0:b>h?2:0<b?3:0}Object.defineProperty(b,"__esModule",{value:!0});b.encodeSymbolColor=function(b,d,f,c){void 0===c&&(c=0);null==b||"ignore"===d?(f[c+0]=255,f[c+1]=255,f[c+
2]=255,f[c+3]=255):(f[c+0]=Math.floor(255*b[0]),f[c+1]=Math.floor(255*b[1]),f[c+2]=Math.floor(255*b[2]),b=Math.floor(b[3]*k),f[c+3]=0===b?0:"tint"===d?b:"replace"===d?b+h:b+a)};b.decodeSymbolColor=function(b,d){void 0===d&&(d=0);var e=0,c=b[d+3],g;switch(l(b,d)){case 0:e=(c-a)/k;g="multiply";break;case 2:e=(c-h)/k;g="replace";break;case 3:e=c/k,g="tint"}return{color:[b[d+0]/255,b[d+1]/255,b[d+2]/255,e],colorMixMode:g}};b.decodeSymbolColorMixMode=l;b.isOpaqueSymbolColor=function(b,d){void 0===d&&(d=
0);b=b[d+3];return b===h||b===a||b===g};var k=85,h=k,a=2*k,g=3*k})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/NativeLinePrograms ../../../webgl/renderState".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y){var m=k.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");n=function(b){function e(a,c){c=b.call(this,c)||this;c.params=x.copyParameters(a,B);return c}l(e,b);e.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)b[c]=a[c];this.notifyDirty("matChanged")};e.prototype.getParameters=function(){return this.params};e.prototype.intersect=function(a,b,c,d,e,f,g,h,k){k?this.intersectLineGeometry(a,b,c,d,e,f,g):x.intersectDrapedRenderLineGeometry(a,
b,c,d,e,f,1,g)};e.prototype.intersectLineGeometry=function(b,e,f,h,k,p,q,l){if(h.enable.selectionMode&&!c.isAllHidden(e.componentVisibilities,b.componentOffsets))if(r.isTranslationMatrix(f)){e=b.data.getVertexAttr().position.data;k=h.camera;p=U;a.vec2.copy(p,h.point);g.vec3.set(Y[0],p[0]-2,p[1]+2,0);g.vec3.set(Y[1],p[0]+2,p[1]+2,0);g.vec3.set(Y[2],p[0]+2,p[1]-2,0);g.vec3.set(Y[3],p[0]-2,p[1]-2,0);for(l=0;4>l;l++)k.unprojectPoint(Y[l],X[l]);d.plane.fromPoints(k.eye,X[0],X[1],P);d.plane.fromPoints(k.eye,
X[1],X[2],V);d.plane.fromPoints(k.eye,X[2],X[3],Z);d.plane.fromPoints(k.eye,X[3],X[0],ca);b=Number.MAX_VALUE;for(l=0;l<e.length-5;l+=3)if(K[0]=e[l]+f[12],K[1]=e[l+1]+f[13],K[2]=e[l+2]+f[14],I[0]=e[l+3]+f[12],I[1]=e[l+4]+f[13],I[2]=e[l+5]+f[14],!(0>d.plane.signedDistance(P,K)&&0>d.plane.signedDistance(P,I)||0>d.plane.signedDistance(V,K)&&0>d.plane.signedDistance(V,I)||0>d.plane.signedDistance(Z,K)&&0>d.plane.signedDistance(Z,I)||0>d.plane.signedDistance(ca,K)&&0>d.plane.signedDistance(ca,I))){k.projectPoint(K,
N);k.projectPoint(I,L);if(0>N[2]&&0<L[2]){g.vec3.subtract(Q,K,I);var v=k.frustum,y=-d.plane.signedDistance(v.planes[4],K),v=y/g.vec3.dot(Q,v.planes[4]);g.vec3.scale(Q,Q,v);g.vec3.add(K,K,Q);k.projectPoint(K,N)}else if(0<N[2]&&0>L[2])g.vec3.subtract(Q,I,K),v=k.frustum,y=-d.plane.signedDistance(v.planes[4],I),v=y/g.vec3.dot(Q,v.planes[4]),g.vec3.scale(Q,Q,v),g.vec3.add(I,I,Q),k.projectPoint(I,L);else if(0>N[2]&&0>L[2])continue;N[2]=0;L[2]=0;v=d.lineSegment.distance2(d.lineSegment.fromPoints(N,L,S),
p);v<b&&(b=v,g.vec3.copy(M,K),g.vec3.copy(R,I))}f=h.rayBeginPoint;h=h.rayEndPoint;4>b&&(b=Number.MAX_VALUE,d.lineSegment.closestLineSegmentPoint(d.lineSegment.fromPoints(M,R,S),d.lineSegment.fromPoints(f,h,T),J)&&(g.vec3.subtract(J,J,f),b=g.vec3.length(J),g.vec3.scale(J,J,1/b),b/=g.vec3.distance(f,h)),q(b,J))}else m.error("intersection assumes a translation-only matrix")};e.prototype.createBufferWriter=function(){return new D(this.params)};e.prototype.createRenderer=function(a,b){return new w(a,b,
this)};e.prototype.getGLMaterials=function(){return{color:v,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:z}};return e}(p.Material);var v=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}l(b,a);b.prototype.updateParameters=function(){this.params=x.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(u.colorPass,{slice:a.slicePlaneEnabled,vertexColors:this.params.vertexColors});
this.pipelineState=y.makePipelineState({blending:1>a.color[3]&&y.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})};b.prototype.beginSlot=function(a){return 5===a};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);b.setUniform4fv("constantColor",c.color)};b.prototype.release=function(a){};b.prototype.bindView=
function(a,b){a=this.program;var c=this.params;x.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&x.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 1};return b}(q),z=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}l(b,a);b.prototype.updateParameters=function(){this.params=x.copyParameters(this.material.getParameters());this.selectProgram()};
b.prototype.beginSlot=function(a){return 5===a};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(u.highlightPass,{slice:this.params.slicePlaneEnabled,vertexColors:this.params.vertexColors});this.pipelineState=y.makePipelineState({depthTest:{func:513},colorWrite:y.defaultColorWriteParams})};b.prototype.bind=function(a,b){a.bindProgram(this.program);a.setPipelineState(this.pipelineState);x.bindHighlightRendering(a,b,
this.program)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;x.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&x.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 1};return b}(q),B={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1},C=f.newLayout().vec3f(r.VertexAttrConstants.POSITION),D=function(){function a(a){this.vertexBufferLayout=
f.newLayout().vec3f(r.VertexAttrConstants.POSITION);a.vertexColors&&(this.vertexBufferLayout=C.vec4u8(r.VertexAttrConstants.COLOR))}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[r.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d){t.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d)};return a}(),K=e.vec3f64.create(),I=e.vec3f64.create(),Q=e.vec3f64.create(),
J=e.vec3f64.create(),N=h.createRenderScreenPointArray3(),L=h.createRenderScreenPointArray3(),M=e.vec3f64.create(),R=e.vec3f64.create(),S=d.lineSegment.create(),T=d.lineSegment.create(),U=e.vec3f64.create(),Y=[h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3()],X=[e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create()],P=d.plane.create(),V=d.plane.create(),Z=d.plane.create(),ca=d.plane.create();
return n})},"esri/views/3d/webgl-engine/shaders/NativeLinePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(a){return h.glslifyDefineMap({SLICE:a.slice,VERTEXCOLORS:a.vertexColors})};b.colorPass={name:"native-line-color",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:a(b)+
k.resolveIncludes("materials/nativeLine/colorPass.frag")}},attributes:l.Default3D};b.highlightPass={name:"native-line-highlight",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:a(b)+k.resolveIncludes("materials/nativeLine/highlightPass.frag")}},attributes:l.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/lang ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ./ElevationAligners ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./objectResourceUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function q(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._optionalFields=[];a._instanceIndexToGraphicUid=new Map;return a}l(q,b);q.prototype.getCachedSize=function(){var a=this._symbolSize;return{width:a[0],depth:a[1],height:a[2]}};q.prototype.doLoad=function(a){return h(this,void 0,void 0,function(){var b,c,d,e;return k(this,function(f){switch(f.label){case 0:b=this._getIdHint("_objectmat");
if(!this._isPropertyDriven("size")&&(c=z.validateSymbolLayerSize(this.symbolLayer)))throw Error();d=this.symbolLayer;return this.isByResource?[4,this._prepareModelResources(d.resource.href,a)]:[3,2];case 1:return f.sent(),[3,4];case 2:return e=d.resource?d.resource.primitive:w.defaultPrimitive,[4,this._preparePrimitiveResources(e,b)];case 3:f.sent(),f.label=4;case 4:return[2]}})})};Object.defineProperty(q.prototype,"isByResource",{get:function(){return!(!this.symbolLayer.resource||!this.symbolLayer.resource.href)},
enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0});q.prototype._preparePrimitiveResources=function(b,c){return h(this,void 0,void 0,function(){var h,m,p,q,l,v,y,u,w,n,B,C;return k(this,function(k){if(!D.isValidPrimitive(b))throw Error("Unknown object symbol primitive: "+b);h=this.symbolLayer;this._resourceBoundingBox=x.create(D.primitiveBoundingBox(b));this._resourceSize=r.vec3f64.fromArray(x.size(this._resourceBoundingBox));
this._symbolSize=r.vec3f64.fromArray(z.computeSizeWithResourceSize(this._resourceSize,h));this._isWosr=this._isEsriSymbolResource=!1;m=d.get(this.symbolLayer,"material","color");p=this._getCombinedOpacity(m);q={specular:[0,0,0],opacity:p,transparent:1>p||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:r.vec3f64.ONES,diffuse:r.vec3f64.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows};l=this.symbol;"point-3d"===
l.type&&l.verticalOffset&&(v=l.verticalOffset,y=v.screenLength,u=v.minWorldLength,w=v.maxWorldLength,q.verticalOffset={screenLength:f.pt2px(y),minWorldLength:u||0,maxWorldLength:null!=w?w:Infinity},q.castShadows=!1);this._context.screenSizePerspectiveEnabled&&(q.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?q.externalColor=t.vec4f64.ONES:(n=d.isSome(h.material)&&h.material.color,B=d.isSome(n)?g.toUnitRGBA(n):t.vec4f64.ONES,q.externalColor=
B);this._fastUpdates=I.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(e.mixin(q,this._fastUpdates.materialParameters),q.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(q.instanced.push("color"),this._optionalFields.push("color"));C=new M(a({},q,R.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled),{offsetTransparentBackfaces:this.symbolLayer.isPrimitive}),
c);this._lodResources=D.primitiveLodResources(b,C,c);this._originalOpacities=L.materialsFromLodResources(this._lodResources).map(function(){return 1});if(!this._lodResources)throw Error("Unknown object symbol primitive: "+b);this._finalizeSymbolResources();this._initializeLodRenderer();this.complexity=this.computeComplexity();return[2]})})};q.prototype._prepareModelResources=function(a,b){return h(this,void 0,void 0,function(){var c,g,h,m,p,q,l,v,y,u,t,w,n,M,D,R,N,S=this;return k(this,function(k){switch(k.label){case 0:return c=
["transformation"],g={instanced:c,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},h={materialParamsMixin:g,streamDataRequester:this._context.streamDataRequester},this._fastUpdates=I.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(e.mixin(h.materialParamsMixin,this._fastUpdates.materialParameters),c.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&
(c.push("color"),this._optionalFields.push("color")),m=this.symbol,"point-3d"===m.type&&m.verticalOffset&&(p=m.verticalOffset,q=p.screenLength,l=p.minWorldLength,v=p.maxWorldLength,h.materialParamsMixin.verticalOffset={screenLength:f.pt2px(q),minWorldLength:l||0,maxWorldLength:null!=v?v:Infinity},h.materialParamsMixin.castShadows=!1),h.signal=b,h.usePBR=this._context.physicalBasedRenderingEnabled,[4,C.fetch(a,h)];case 1:return y=k.sent(),this._isEsriSymbolResource=y.isEsriSymbolResource,this._isWosr=
y.isWosr,u=B.makeLodResources(y.lods),B.fillEstimatedMinScreenSpaceRadius(u),u.levels.sort(function(a,b){return a.minScreenSpaceRadius-b.minScreenSpaceRadius}),u.levels[0].minScreenSpaceRadius=Math.min(2,u.levels[0].minScreenSpaceRadius),this._lodResources=u,t=this._context,w=this.symbolLayer.material,n=this._getExternalColorParameters(w),M=d.get(this.symbolLayer,"material","color"),D=this._getCombinedOpacity(M,{hasIntrinsicColor:!0}),R=this._isPropertyDriven("opacity"),N=L.materialsFromLodResources(this._lodResources),
this._originalOpacities=N.map(function(a){return a.getParameters().opacity||1}),N.forEach(function(a){var b=a.getParameters();a.setParameterValues(n);var c=b.opacity*D;a.setParameterValues({opacity:c,transparent:1>c||R||b.transparent});t.screenSizePerspectiveEnabled&&a.setParameterValues({screenSizePerspective:t.sharedResources.screenSizePerspectiveSettings})}),this._resourceBoundingBox=y.referenceBoundingBox,this._resourceSize=r.vec3f64.fromArray(x.size(this._resourceBoundingBox)),this._pivotOffset=
r.vec3f64.fromArray(this._lodResources.levels[0].pivotOffset),this._symbolSize=r.vec3f64.fromArray(z.computeSizeWithResourceSize(this._resourceSize,this.symbolLayer)),I.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions())&&N.forEach(function(a){return a.setParameterValues(S._fastUpdates.materialParameters)}),this._finalizeSymbolResources(),this._initializeLodRenderer(),this.complexity=this.computeComplexity(),[2]}})})};q.prototype._finalizeSymbolResources=
function(){var a=this._context.stage;this._materials=L.materialsFromLodResources(this._lodResources);this._materials.forEach(function(b){a.add(3,b)});this._textures=L.texturesFromLodResources(this._lodResources);this._textures.forEach(function(b){a.add(4,b)});this._geometries=L.geometriesFromLodResources(this._lodResources);this._geometries.forEach(function(b){a.add(2,b)})};q.prototype._initializeLodRenderer=function(){var a=this,b=this._context.stage;this._lodRenderer=new N.LodRenderer(this._lodResources,
this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:function(b){return a._instanceIndexToGraphicUid.get(b)}},this._fastUpdates.enabled?{applyTransform:function(b,d,e){b.getFeatureAttribute(d,Y);c.mat4.copy(e,I.evaluateModelTransform(a._fastUpdates.materialParameters,Y,e))},scaleFactor:function(b,c,d){c.getFeatureAttribute(d,Y);return I.evaluateModelTransformScale(b,a._fastUpdates.materialParameters,Y)}}:null);this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;b.addRenderPlugin(this._lodRenderer.slots,
this._lodRenderer)};q.prototype._getExternalColorParameters=function(a){var b={};this._isPropertyDriven("color")?b.externalColor=t.vec4f64.ONES:d.isSome(a)&&d.isSome(a.color)?b.externalColor=g.toUnitRGBA(a.color):(b.externalColor=t.vec4f64.ONES,b.colorMixMode="ignore");return b};q.prototype.destroy=function(){b.prototype.destroy.call(this);var a=this._context.stage;this._lodRenderer&&(a.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy());this._materials&&this._materials.forEach(function(b){return a.remove(3,
b.id)});this._textures&&this._textures.forEach(function(b){return a.remove(4,b.id)});this._geometries&&this._geometries.forEach(function(b){return a.remove(2,b.id)})};q.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var c=m.placePointOnGeometry(b.geometry);if(d.isNone(c))return this.logger.warn("unsupported geometry type for icon symbol: "+b.geometry.type),null;var e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,
c,a.renderingInfo,e,b.uid)};q.prototype.notifyDestroyGraphicLayer=function(a){this._instanceIndexToGraphicUid.delete(a.instanceIndex)};q.prototype.graphicLayerToGraphicId=function(a){return 0};q.prototype.layerOpacityChanged=function(){var a=this,b=this._isPropertyDriven("opacity"),c=this.isByResource;this._materials.forEach(function(e,f){var g=d.get(a.symbolLayer,"material","color");f=a._getCombinedOpacity(g,{hasIntrinsicColor:c})*a._originalOpacities[f];e.setParameterValues({opacity:f,transparent:1>
f||b})});return!0};q.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,m.needsElevationUpdates3D)};q.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;this._materials.forEach(function(a){a.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});return!0};q.prototype.physicalBasedRenderingChanged=function(a,b){var c=this;this._materials.forEach(function(a){c.isByResource?
c._isEsriSymbolResource&&!c._isWosr&&a.setParameterValues(R.returnDefaultPBRMaterialParameters(c._context.physicalBasedRenderingEnabled,a.getParameters().treeRendering)):a.setParameterValues(R.returnDefaultPBRMaterialParameters(c._context.physicalBasedRenderingEnabled))});return!0};q.prototype.pixelRatioChanged=function(a,b){return!0};q.prototype.applyRendererDiff=function(a,b){var c=this,d;for(d in a.diff)switch(d){case "visualVariables":if(I.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._materials.forEach(function(a){return a.setParameterValues(c._fastUpdates.materialParameters)}),
this._lodRenderer.notifyShaderTransformationChanged();else return!1;break;default:return!1}return!0};q.prototype.computeComplexity=function(){if(!this._lodResources)return b.prototype.computeComplexity.call(this);var a=L.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(a,b){return a+b.data.getIndices(J.VertexAttrConstants.POSITION).length},0)/3,c=K.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer);return{primitivesPerFeature:a,primitivesPerCoordinate:0,
estimated:!1,memory:c}};q.prototype._createAs3DShape=function(a,b,c,d,e){a=this.getFastUpdateAttrValues(a);var f=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?z.mixinColorAndOpacity(c.color,c.opacity):null,g=this._context.clippingExtent;Q.pointToVector(b,S,this._context.elevationProvider.spatialReference);if(g&&!m.pointInBox2D(S,g))return null;var g=this._requiresTerrainElevation(d),h=this._computeGlobalTransform(b,d,U,g?X:null);c=this._computeLocalTransform(this.symbolLayer,c,T);var k=
this._lodRenderer.instanceData,p=k.addInstance();this._instanceIndexToGraphicUid.set(p,e);k.setLocalTransform(p,c,!1);k.setGlobalTransform(p,h);a&&k.setFeatureAttribute(p,a);f&&k.setColor(p,f);e=new y(this,p,u.perLodInstanceElevationAligner,d);g&&(e.alignedTerrainElevation=X.terrainElevation);e.needsElevationUpdates=m.needsElevationUpdates3D(d.mode);m.extendPointGraphicElevationContext(e,b,this._context.elevationProvider);return e};q.prototype._computeGlobalTransform=function(a,b,c,d){b=m.computeElevation(this._context.elevationProvider,
a,b,this._context.renderCoordsHelper,d);S[0]=a.x;S[1]=a.y;S[2]=b;Q.computeLinearTransformation(a.spatialReference,S,c,this._context.renderSpatialReference);return c};q.prototype._computeLocalTransform=function(a,b,d){c.mat4.identity(d);this._applyObjectRotation(b,!1,d);this._applyObjectRotation(a,!0,d);this._applyObjectScale(b,d);this._applyAnchor(a,d);return d};q.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._isPropertyDriven("size")&&
a.size?a.size:this._symbolSize,a=z.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||c.mat4.scale(b,b,a))};q.prototype.prepareSymbolLayerPatch=function(a){if("partial"===a.diff.type){var b=a.diff.diff;this._preparePatchTransform(a,b);this._preparePatchColor(a,b)}};q.prototype.updateGeometry=function(a,b){var c=b&&m.placePointOnGeometry(b);if(d.isNone(c))return!1;b=this.getGeometryElevationMode(b);if(a.elevationContext.mode!==
b)return!1;b=this._requiresTerrainElevation(a.elevationContext);this._computeGlobalTransform(c,a.elevationContext,U,b?X:null);b&&(a.alignedTerrainElevation=X.terrainElevation);this._lodRenderer.instanceData.setGlobalTransform(a.instanceIndex,U,!0);m.extendPointGraphicElevationContext(a,c,this._context.elevationProvider);return!0};q.prototype._preparePatchTransform=function(a,b){var c=this;if(b.heading||b.tilt||b.roll||b.width||b.height||b.depth||b.anchor||b.anchorPosition){var d=function(a,b,c){return(null!=
a&&"complete"===a.type?a.newValue:b)||c},e=d(b.heading,this.symbolLayer.heading,0),f=d(b.tilt,this.symbolLayer.tilt,0),g=d(b.roll,this.symbolLayer.roll,0),h=d(b.width,this.symbolLayer.width,void 0),k=d(b.height,this.symbolLayer.height,void 0),m=d(b.depth,this.symbolLayer.depth,void 0),p=d(b.anchor,this.symbolLayer.anchor,void 0),d=d(b.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete b.heading;delete b.tilt;delete b.roll;delete b.width;delete b.height;delete b.depth;delete b.anchor;delete b.anchorPosition;
var q={heading:e,tilt:f,roll:g,anchor:p,anchorPosition:d};1===this.loadStatus&&a.symbolLayerStatePatches.push(function(){c._symbolSize=r.vec3f64.fromArray(z.computeSizeWithResourceSize(c._resourceSize,{width:h,height:k,depth:m,isPrimitive:c.symbolLayer.isPrimitive}))});a.graphics3DGraphicPatches.push(function(a,b){b=c._computeLocalTransform(q,b,T);c._lodRenderer.instanceData.setLocalTransform(a.instanceIndex,b,!0)})}};q.prototype._preparePatchColor=function(a,b){var c=this;if(b.material&&"partial"===
b.material.type&&(b=b.material.diff,b.color&&"complete"===b.color.type)){var e=b.color.newValue,f=d.isSome(e)?g.toUnitRGBA(e):t.vec4f64.ONES;delete b.color;a.graphics3DGraphicPatches.push(function(a,b){if(c._hasPerInstanceColor())c._lodRenderer.instanceData.setColor(a.instanceIndex,f);else for(a=0,b=c._materials;a<b.length;a++)b[a].setParameterValues({externalColor:f})})}};q.prototype._requiresTerrainElevation=function(a){return"absolute-height"!==a.mode};q.prototype._applyObjectRotation=function(a,
b,c){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&b))return z.computeObjectRotation(a.heading,a.tilt,a.roll,c)};q.prototype._computeAnchor=function(a){var b=r.vec3f64.create();switch(a.anchor){case "center":p.vec3.copy(b,x.center(this._resourceBoundingBox));p.vec3.negate(b,b);break;case "top":var c=x.center(this._resourceBoundingBox);p.vec3.set(b,-c[0],-c[1],-this._resourceBoundingBox[5]);break;case "bottom":c=x.center(this._resourceBoundingBox);p.vec3.set(b,-c[0],
-c[1],-this._resourceBoundingBox[2]);break;case "relative":var c=x.center(this._resourceBoundingBox),d=x.size(this._resourceBoundingBox);a=(a=a.anchorPosition)?r.vec3f64.fromValues(a.x,a.y,a.z):r.vec3f64.ZEROS;p.vec3.multiply(b,d,a);p.vec3.add(b,b,c);p.vec3.negate(b,b);break;default:this._pivotOffset?p.vec3.negate(b,this._pivotOffset):p.vec3.copy(b,r.vec3f64.ZEROS)}return b};q.prototype._applyAnchor=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._computeAnchor(a))&&
c.mat4.translate(b,b,a)};q.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};q.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?r.vec3f64.fromArray(x.size(this._resourceBoundingBox)):r.vec3f64.ONES,b=this._resourceBoundingBox?this._computeAnchor(this.symbolLayer):r.vec3f64.ZEROS,c=this._context.renderCoordsHelper.unitInMeters,d=z.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,
c),e=r.vec3f64.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:a,symbolSize:this._symbolSize||r.vec3f64.ONES,unitInMeters:c,transformation:{anchor:b,scale:d,rotation:e}}};return q}(v.default);b.Graphics3DObjectSymbolLayer=n;var S=r.vec3f64.create(),T=q.mat4f64.create(),U=q.mat4f64.create(),Y=t.vec4f64.create(),X={verticalDistanceToGround:0,terrainElevation:0};b.default=n})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../webgl-engine/lib/HighlightUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){n=function(){function a(a,b,d,e){this.type="lod-instance";this.alignedTerrainElevation=0;this.needsElevationUpdates=this.isElevationSource=!1;this.graphics3DSymbolLayer=a;this.instanceIndex=b;this.elevationAligner=d;this.elevationContext=new c(e)}a.prototype.initialize=function(a,b){};a.prototype.setVisibility=function(a){var b=this.lodRenderer.instanceData;return a!==b.getVisible(this.instanceIndex)?(b.setVisible(this.instanceIndex,a),!0):!1};a.prototype.destroy=
function(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};a.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(f.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};a.prototype.getBSRadius=function(){var a=this.lodRenderer;return a.baseBoundingSphere.radius*
a.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)};a.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=e.vec3f64.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,u);return g.vec3.transformMat4(a,this.lodRenderer.baseBoundingSphere.center,u)};a.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=d.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,u);var b=this.lodRenderer.baseBoundingBox;d.empty(a);
for(var c=0;8>c;++c)g.vec3.set(t,0===(c&1)?b[0]:b[3],0===(c&2)?b[1]:b[4],0===(c&4)?b[2]:b[5]),g.vec3.transformMat4(t,t,u),d.expandPointInPlace(a,t);return a};a.prototype.getProjectedBoundingBox=function(a,b,c,e,f){return h(this,void 0,void 0,function(){var h,m,p,l,v,y,z,n,B;return k(this,function(k){switch(k.label){case 0:h=this.getBoundingBoxObjectSpace(f);m=w;p=d.isPoint(h)?1:m.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,u);for(l=0;l<p;l++)v=m[l],t[0]=h[v[0]],t[1]=
h[v[1]],t[2]=h[v[2]],g.vec3.transformMat4(t,t,u),r[3*l+0]=t[0],r[3*l+1]=t[1],r[3*l+2]=t[2];if(!a(r,0,p))return[2,null];d.empty(h);y=null;this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds());for(l=0;l<3*p;l+=3){for(z=0;3>z;z++)h[z]=Math.min(h[z],r[l+z]),h[z+3]=Math.max(h[z+3],r[l+z]);y&&c.push({location:r.slice(l,l+3),screenSpaceBoundingRect:y})}if(!b)return[3,5];d.center(h,x);if("absolute-height"===this.elevationContext.mode)return[3,5];n=void 0;B=q.demResolutionForBoundingBox(h,
b);k.label=1;case 1:return k.trys.push([1,3,,4]),[4,b.service.queryElevation(x[0],x[1],e,B)];case 2:return n=k.sent(),[3,4];case 3:return k.sent(),n=null,[3,4];case 4:null!=n&&d.offset(h,0,0,-this.alignedTerrainElevation+n),k.label=5;case 5:return[2,h]}})})};a.prototype.addHighlight=function(a,b){var c=this;b=p.generateHighlightId();this.addHighlightId(b);a.addExternal(function(a){c.removeHighlightId(a)},b)};a.prototype.removeHighlight=function(a){this.highlights&&this.highlights.forEach(function(b){return a.remove(b)})};
a.prototype.addHighlightId=function(a){this.highlights=this.highlights||new Set;this.highlights.add(a);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};a.prototype.removeHighlightId=function(a){this.highlights&&(this.highlights.delete(a),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};Object.defineProperty(a.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},
enumerable:!0,configurable:!0});return a}();var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=e.vec3f64.create(),x=e.vec3f64.create(),w=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],u=a.mat4f64.create();return n})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../webgl-engine/lib/lodRendering/LodResources"],function(n,b,l,k,h){function a(a){var b=
[];a.stageResources.geometries.forEach(function(c,d){b.push({material:a.stageResources.materials[d],geometry:c,textures:a.stageResources.textures})});return{components:b,minScreenSpaceRadius:a.lodThreshold,pivotOffset:a.pivotOffset}}function g(a,b){void 0===b&&(b=e);a=h.computeFaceCount(a);return Math.sqrt(a/(b*Math.PI))}Object.defineProperty(b,"__esModule",{value:!0});b.makeLodLevelResources=a;b.makeLodResources=function(b){return{levels:b.map(function(b){return a(b)})}};b.estimateMinScreenSpaceRadius=
g;b.fillEstimatedMinScreenSpaceRadius=function(a){a.levels.forEach(function(a){a.minScreenSpaceRadius||(a.minScreenSpaceRadius=g(a))})};var e=.05})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/mathUtils ../../../../core/maybe ../../../../core/string ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../glTF/DefaultLoadingContext ../../glTF/esriProvidedModelParameters ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../support/buffer/BufferView ../../support/buffer/math ../../support/buffer/utils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I){function Q(a){var b=a.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return b?{fileType:"gltf",url:b[1],specifiedLodIndex:null!=b[4]?Number(b[4]):null}:a.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:a,specifiedLodIndex:null}:{fileType:"unknown",url:a,specifiedLodIndex:null}}function J(b,d,g){var h=b.model,k=c.mat4f64.create(),p=[],q=new Map,l=new Map;h.lods.forEach(function(b,c){if(void 0===g||c===g){var y=0,t={name:b.name,stageResources:{textures:[],
materials:[],geometries:[]},lodThreshold:e.isSome(b.lodThreshold)?b.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:r.empty()};p.push(t);b.parts.forEach(function(c){var g=c.material+(c.attributes.normal?"_normal":"")+(c.attributes.color?"_color":"")+(c.attributes.texCoord0?"_texCoord0":"")+(c.attributes.tangent?"_tangent":""),p=h.materials.get(c.material),x=e.isSome(c.attributes.texCoord0),w=e.isSome(c.attributes.normal);if(!q.has(g)){if(x){if(e.isSome(p.textureColor)&&!l.has(p.textureColor)){var n=
h.textures.get(p.textureColor),L=a({},n.parameters,{preMultiplyAlpha:!0});l.set(p.textureColor,new D(n.data,p.textureColor,L))}e.isSome(p.textureNormal)&&!l.has(p.textureNormal)&&(n=h.textures.get(p.textureNormal),L=a({},n.parameters,{preMultiplyAlpha:!0}),l.set(p.textureNormal,new D(n.data,p.textureNormal,L)));e.isSome(p.textureOcclusion)&&!l.has(p.textureOcclusion)&&(n=h.textures.get(p.textureOcclusion),L=a({},n.parameters,{preMultiplyAlpha:!0}),l.set(p.textureOcclusion,new D(n.data,p.textureOcclusion,
L)));e.isSome(p.textureEmissive)&&!l.has(p.textureEmissive)&&(n=h.textures.get(p.textureEmissive),L=a({},n.parameters,{preMultiplyAlpha:!0}),l.set(p.textureEmissive,new D(n.data,p.textureEmissive,L)));e.isSome(p.textureMetallicRoughness)&&!l.has(p.textureMetallicRoughness)&&(n=h.textures.get(p.textureMetallicRoughness),L=a({},n.parameters,{preMultiplyAlpha:!0}),l.set(p.textureMetallicRoughness,new D(n.data,p.textureMetallicRoughness,L)))}var M=K.COLOR_GAMMA,n=Math.pow(p.color[0],1/M),L=Math.pow(p.color[1],
1/M),R=Math.pow(p.color[2],1/M),S=Math.pow(p.emissiveFactor[0],1/M),J=Math.pow(p.emissiveFactor[1],1/M),M=Math.pow(p.emissiveFactor[2],1/M);q.set(g,new K(a({transparent:"BLEND"===p.alphaMode,textureAlphaMode:N(p.alphaMode),textureAlphaCutoff:p.alphaCutoff,diffuse:[n,L,R],ambient:[n,L,R],opacity:p.opacity,doubleSided:p.doubleSided,doubleSidedType:"winding-order",cullFace:p.doubleSided?"none":"back",vertexColors:!!c.attributes.color,vertexTangents:!!c.attributes.tangent,normals:w?"default":"screenDerivative",
castShadows:!0,receiveSSAO:!0,textureId:e.isSome(p.textureColor)&&x?l.get(p.textureColor).id:void 0,colorMixMode:p.colorMixMode,normalTextureId:e.isSome(p.textureNormal)&&x?l.get(p.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:e.isSome(p.textureOcclusion)&&x?l.get(p.textureOcclusion).id:void 0,emissiveTextureId:e.isSome(p.textureEmissive)&&x?l.get(p.textureEmissive).id:void 0,metallicRoughnessTextureId:e.isSome(p.textureMetallicRoughness)&&x?l.get(p.textureMetallicRoughness).id:
void 0,emissiveFactor:[S,J,M],metallicFactor:p.metallicFactor,roughnessFactor:p.roughnessFactor,usePBR:!0},d),g))}a:{w=c.indices||c.attributes.position.count;switch(c.primitiveType){case 4:n=u.trianglesToTriangles(w);break a;case 5:n=u.triangleStripToTriangles(w);break a;case 6:n=u.triangleFanToTriangles(w);break a}n=void 0}L={};R={};w=c.attributes.position.count;S=z.createBuffer(m.BufferViewVec3f,w);v.vec3.transformMat4(S,c.attributes.position,c.transform);R.position={data:S.typedBuffer,size:S.elementCount};
L.position=n;e.isSome(c.attributes.normal)&&(S=z.createBuffer(m.BufferViewVec3f,w),f.mat4.invert(k,c.transform),f.mat4.transpose(k,k),v.vec3.transformMat4(S,c.attributes.normal,k),R.normal={data:S.typedBuffer,size:S.elementCount},L.normal=n);e.isSome(c.attributes.tangent)&&(S=z.createBuffer(m.BufferViewVec4f,w),f.mat4.invert(k,c.transform),f.mat4.transpose(k,k),v.vec4.transformMat4(S,c.attributes.tangent,k),R.aTangent={data:S.typedBuffer,size:S.elementCount},L.aTangent=n);e.isSome(c.attributes.texCoord0)&&
(S=z.createBuffer(m.BufferViewVec2f,w),z.vec2.normalizeIntegerBuffer(S,c.attributes.texCoord0),R.uv0={data:S.typedBuffer,size:S.elementCount},L.uv0=n);e.isSome(c.attributes.color)&&(S=z.createBuffer(m.BufferViewVec4u8,w),4===c.attributes.color.elementCount?c.attributes.color instanceof m.BufferViewVec4f?v.vec4.scale(S,c.attributes.color,255):c.attributes.color instanceof m.BufferViewVec4u8?z.vec4.copy(S,c.attributes.color):c.attributes.color instanceof m.BufferViewVec4u16&&v.vec4.scale(S,c.attributes.color,
1/256):(z.vec4.fill(S,255,255,255,255),J=new m.BufferViewVec3u8(S.buffer,0,4),c.attributes.color instanceof m.BufferViewVec3f?v.vec3.scale(J,c.attributes.color,255):c.attributes.color instanceof m.BufferViewVec3u8?z.vec3.copy(J,c.attributes.color):c.attributes.color instanceof m.BufferViewVec3u16&&v.vec3.scale(J,c.attributes.color,1/256)),R.color={data:S.typedBuffer,size:S.elementCount},L.color=n);c=new B(new C.GeometryData(R,L),"gltf_"+b.name+"_"+y++);t.stageResources.geometries.push(c);t.stageResources.materials.push(q.get(g));
x&&(e.isSome(p.textureColor)&&t.stageResources.textures.push(l.get(p.textureColor)),e.isSome(p.textureNormal)&&t.stageResources.textures.push(l.get(p.textureNormal)),e.isSome(p.textureOcclusion)&&t.stageResources.textures.push(l.get(p.textureOcclusion)),e.isSome(p.textureEmissive)&&t.stageResources.textures.push(l.get(p.textureEmissive)),e.isSome(p.textureMetallicRoughness)&&t.stageResources.textures.push(l.get(p.textureMetallicRoughness)));t.numberOfVertices+=w;g=c.boundingInfo;r.expand(t.boundingBox,
g.getBBMin());r.expand(t.boundingBox,g.getBBMax())})}});return p}function N(a){switch(a){case "BLEND":return"blend";case "MASK":return"mask";case "OPAQUE":return"opaque";default:return"blend"}}function L(a){var b=a.model.lods.length;a.meta.isEsriSymbolResource&&a.model.lods.forEach(function(a){if(!e.isSome(a.lodThreshold)){var c=(a.name||"").replace("Imposter","Realistic_LOD0").split("_LOD")[0],d=a.parts.reduce(function(a,b){return a+b.attributes.position.count},0);a.lodThreshold=M(c,d,b)}})}function M(a,
b,c){void 0===a&&(a="");if(1===c)return null;if(a in x.lodThresholdLUT){c=x.lodThresholdLUT[a].vertexCounts;a=x.lodThresholdLUT[a].thresholds;var d=c.length;if(1>=d)return null;if(b<=c[0]){var e=(c[1]-c[0])/(a[1]-a[0]);b-=c[0];return Math.max(0,a[0]+b*e)}if(b>=c[d-1])return e=(c[d-1]-c[d-2])/(a[d-1]-a[d-2]),b-=c[d-1],a[d-1]+b*e;for(var f=1;f<c.length;++f){var g=c[f-1],h=c[f],d=a[f-1],e=a[f];if(b<h)return b=(b-g)/(h-g),d*(1-b)+e*b}}return null}Object.defineProperty(b,"__esModule",{value:!0});b.fetch=
function(b,r){void 0===r&&(r={});return h(this,void 0,void 0,function(){var h,l,v,u,n,B,C,M,D,R;return k(this,function(k){switch(k.label){case 0:return h=Q(b),"wosr"!==h.fileType?[3,2]:[4,y.load(h.url,r)];case 1:return l=k.sent(),[2,{lods:[l],referenceBoundingBox:l.boundingBox,isEsriSymbolResource:!1,isWosr:!0}];case 2:return v=new t.DefaultLoadingContext(r.streamDataRequester),[4,w.load(v,h.url,r)];case 3:u=k.sent();a:if(k=u,k.meta.isEsriSymbolResource)for(var N=0,S=k.model.lods;N<S.length;N++){var K=
S[N],T;b:{var V=K.name,U=k.meta.uri;void 0===V&&(V="");void 0===U&&(U="");T=d.endsWith(V,"Imposter");V=V.split("__")[0];if(-1!==U.indexOf("/RealisticTrees/")&&(U=x.treeParamsTable[V])){T={crownCenter:U.center,crownDimensions:U.radius,imposter:T};break b}T=void 0}if(!T)break a;k.customMeta.esriTreeRendering=!0;U=0;for(K=K.parts;U<K.length;U++){var V=K[U],P=V.attributes.normal;if(e.isNone(P))break a;for(var Z=V.attributes.position,F=Z.count,X=p.vec3f64.create(),Y=p.vec3f64.create(),ca=p.vec3f64.create(),
da=z.createBuffer(m.BufferViewVec4u8,F),ea=z.createBuffer(m.BufferViewVec3f,F),za=f.mat4.invert(c.mat4f64.create(),V.transform),H=q.vec3.transformMat4(p.vec3f64.create(),T.crownCenter,za),za=q.vec3.transformMat4(p.vec3f64.create(),T.crownDimensions,za),qa=0;qa<F;qa++){Z.getVec(qa,Y);P.getVec(qa,X);q.vec3.subtract(ca,Y,H);q.vec3.divide(ca,ca,za);var sa=g.clamp(q.vec3.length(ca),0,1),sa=.6+.4*sa*sa;q.vec3.lerp(ca,ca,X,.2);ea.setVec(qa,ca);da.set(qa,0,255*sa);da.set(qa,1,255*sa);da.set(qa,2,255*sa);
da.set(qa,3,255)}V.attributes.normal=ea;V.attributes.color=da}}L(u);n=a({},r.materialParamsMixin,{treeRendering:u.customMeta.esriTreeRendering},u.meta.isEsriSymbolResource?r.usePBR?!0===u.customMeta.esriTreeRendering?I.defaultPBRTreeMaterialParameters:I.defaultPBRMaterialParameters:{usePBR:!1}:{usePBR:!0});if(null!=h.specifiedLodIndex)return B=J(u,n,h.specifiedLodIndex),C=B[0].boundingBox,0!==h.specifiedLodIndex&&(M=J(u,n,h.specifiedLodIndex),C=M[0].boundingBox),[2,{lods:B,referenceBoundingBox:C,
isEsriSymbolResource:u.meta.isEsriSymbolResource,isWosr:!1}];D=J(u,n);R=D[0].boundingBox;return[2,{lods:D,referenceBoundingBox:R,isEsriSymbolResource:u.meta.isEsriSymbolResource,isWosr:!1}]}})})};b.parseUrl=Q;b.gltfToEngineResources=J})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.streamDataRequester=a}b.prototype.loadJSON=function(a,b){return l(this,void 0,void 0,function(){return k(this,function(c){return[2,this.load("json",a,b)]})})};b.prototype.loadBinary=function(a,b){return l(this,void 0,void 0,function(){return k(this,function(d){return c.isDataProtocol(a)?(f.throwIfAborted(b),[2,c.dataToArrayBuffer(a)]):[2,this.load("binary",a,b)]})})};b.prototype.loadImage=
function(a,b){return l(this,void 0,void 0,function(){return k(this,function(c){return[2,this.load("image",a,b)]})})};b.prototype.load=function(b,c,h){return l(this,void 0,void 0,function(){var p;return k(this,function(k){switch(k.label){case 0:return d.isNone(this.streamDataRequester)?[4,a(c,q[b])]:[3,2];case 1:return[2,k.sent().data];case 2:return[4,g.result(this.streamDataRequester.request(c,b,h))];case 3:p=k.sent();if(!0===p.ok)return[2,p.value];f.throwIfAbortError(p.error);throw new e("","Request for resource failed: "+
p.error);}})})};return b}();b.DefaultLoadingContext=n;var q={image:{responseType:"image"},binary:{responseType:"array-buffer"},json:void 0}})},"esri/views/3d/glTF/esriProvidedModelParameters":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.treeParamsTable={Alder_Buckthorn:{center:[0,0,2.5],radius:[2,2,3.5]},American_Chestnut:{center:[0,0,12],radius:[10,10,10]},American_Sycamore:{center:[0,0,16],radius:[6.3,6.3,11.5]},Apricot:{center:[0,0,5],
radius:[4.5,4.5,4]},Australian_Pine:{center:[0,0,8],radius:[3,3,11.5]},Baldcypress:{center:[0,0,11.5],radius:[4.2,4.2,16.5]},Balsam_Fir:{center:[0,0,2.9],radius:[3,3,9.7]},Basswood:{center:[0,0,19],radius:[9,9,11]},Bay_Laurel:{center:[0,0,1.4],radius:[.6,.6,2.7]},Black_Locust:{center:[0,0,15],radius:[9.5,9.5,9.5]},Blue_Gum_Eucalyptus:{center:[0,0,12],radius:[5,5,10]},Boxwood:{center:[0,0,.5],radius:[.3,.3,.5]},California_Bay:{center:[0,0,16],radius:[9,9,9.6]},California_Incense_Cedar:{center:[0,0,
6.6],radius:[3.8,3.8,14]},California_Redwood:{center:[0,0,55],radius:[6.5,6.5,19]},California_Walnut:{center:[0,0,5.3],radius:[5,5,4.5]},Common_Hawthorn:{center:[0,0,2.8],radius:[1.9,1.9,2.8]},Common_Whitebeam:{center:[0,0,4.5],radius:[2.5,2.5,3.5]},Conker_Tree:{center:[0,0,10],radius:[6,6,10]},Desert_Willow:{center:[0,0,3],radius:[2.4,2.4,2.8]},Douglas_Fir:{center:[0,0,40],radius:[4.5,4.5,22]},European_Beech:{center:[0,0,12],radius:[7.5,7.5,11.5]},European_Larch:{center:[0,0,9],radius:[3,3,9]},Ficus:{center:[0,
0,10],radius:[12,12,18.5]},Field_Elm:{center:[0,0,12.5],radius:[10,10,9.5]},Flannelbush:{center:[0,0,0],radius:[1.3,1.3,1.7]},Flowering_Dogwood:{center:[0,0,2.5],radius:[2.4,2.4,3]},Generic_Unknown:{center:[0,0,11.5],radius:[5,5,6.5]},Giant_Sequoia:{center:[0,0,35.5],radius:[11,11,26]},Japanese_Angelica_Tree:{center:[0,0,3.8],radius:[2.8,2.8,2]},Leyland_Cypress:{center:[0,0,2.8],radius:[1,1,4]},Lodgepole_Pine:{center:[0,0,23.25],radius:[4.7,4.7,19]},Mediterranean_Buckthorn:{center:[0,0,1.5],radius:[1.2,
1.2,2.5]},Mountain_Mahogany:{center:[0,0,2],radius:[1.3,1.3,1.5]},Northern_Red_Oak:{center:[0,0,11.5],radius:[7.2,7.2,9]},Norway_Maple:{center:[0,0,12.2],radius:[6,6,8.2]},Norway_Spruce:{center:[0,0,5],radius:[6.5,6.5,20]},Oval_Leaved_Privet:{center:[0,0,0],radius:[.45,.45,2.95]},Palo_Verde:{center:[0,0,4.25],radius:[4,4,2.75]},Paper_Birch:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Alder:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Hickory:{center:[0,0,9],radius:[4.5,4.5,7.5]},Rhododendron_Azaleas:{center:[0,
0,.55],radius:[.4,.4,.35]},Rose:{center:[0,0,.55],radius:[.45,.45,.55]},Ruffle_Palm:{center:[0,0,6.4],radius:[3,3,3]},Sassafras:{center:[0,0,8],radius:[3,3,7]},Scots_Pine:{center:[0,0,18],radius:[3,3,9]},Shadbush:{center:[0,0,1.5],radius:[1.5,1.5,1.5]},Southern_Magnolia:{center:[0,0,10.5],radius:[5.5,5.5,8]},Spanish_Broom:{center:[0,0,1.5],radius:[2.5,2.5,1.5]},Strawberry_Tree:{center:[0,0,4],radius:[2.8,2.8,3.3]},Sugar_Maple:{center:[0,0,8],radius:[4.5,4.5,7]},Sweetgum:{center:[0,0,8],radius:[4,
4,6.5]},Umbrella_Acacia:{center:[0,0,10.8],radius:[15,15,6.8]},Western_Juniper:{center:[0,0,3.2],radius:[2.5,2.5,7]},White_Ash:{center:[0,0,14.5],radius:[9.5,9.5,11]},White_Oak:{center:[0,0,15],radius:[14,14,14]},White_Poplar:{center:[0,0,10],radius:[4.3,4.3,8.2]},White_Willow:{center:[0,0,12],radius:[8.9,8.9,9]},Witch_Hazel:{center:[0,0,1.5],radius:[1.5,1.5,2]}};b.lodThresholdLUT={Alder_Buckthorn__Realistic:{thresholds:[2,65.698,384.294],vertexCounts:[18,2034,8220]},Amazon_Sword_Plant__Realistic:{thresholds:[2,
22.848,88.819,200.491],vertexCounts:[18,246,888,3246]},American_Chestnut__Realistic:{thresholds:[2,27.57,59.244,360.286],vertexCounts:[18,444,1782,10332]},American_Sycamore__Realistic:{thresholds:[2,60.765,228.586],vertexCounts:[18,1740,8562]},Apricot__Realistic:{thresholds:[2,33.695,132.332],vertexCounts:[18,1776,10626]},Australian_Pine__Realistic:{thresholds:[2,131.057],vertexCounts:[18,8094]},Baldcypress__Realistic:{thresholds:[2,31.791,212.226],vertexCounts:[18,1638,10164]},Balsam_Fir__Realistic:{thresholds:[2,
64.674],vertexCounts:[18,10266]},Bamboo__Realistic:{thresholds:[2,22.347,90.113,213.818],vertexCounts:[18,216,978,7740]},Banana_Tree__Realistic:{thresholds:[2,28.096,88.837,345.976],vertexCounts:[18,372,1986,10743]},Basswood__Realistic:{thresholds:[2,59.387,199.555],vertexCounts:[18,1662,7998]},Bay_Laurel__Realistic:{thresholds:[2,28.653,204.352],vertexCounts:[18,1728,10938]},Black_Locust__Realistic:{thresholds:[2,28.546,88.164,229.447],vertexCounts:[18,384,1638,9768]},Blue_Gum_Eucalyptus__Realistic:{thresholds:[2,
56.98,201.358],vertexCounts:[18,1530,9762]},Boxwood__Realistic:{thresholds:[2,28.768,62.215,191.034],vertexCounts:[18,390,1824,9876]},Cabbage_Palm_Fern__Realistic:{thresholds:[2,26.932,215.221],vertexCounts:[18,150,1314]},California_Bay__Realistic:{thresholds:[2,30.627,204.223],vertexCounts:[18,1878,9054]},California_Incense_Cedar__Realistic:{thresholds:[2,30.533,197.262],vertexCounts:[18,1644,11214]},California_Palm__Realistic:{thresholds:[2,30.538,210.616],vertexCounts:[18,612,5760]},California_Redwood__Realistic:{thresholds:[2,
110.805],vertexCounts:[18,10260]},California_Walnut__Realistic:{thresholds:[2,26.702,64.525,199.228],vertexCounts:[18,336,1962,10992]},Coconut_Palm__Realistic:{thresholds:[2,21.77,63.23,199.556],vertexCounts:[18,402,1884,9240]},Common_Hawthorn__Realistic:{thresholds:[2,45.588,205.35],vertexCounts:[18,300,9492]},Common_Whitebeam__Realistic:{thresholds:[2,56.42,186.382],vertexCounts:[18,2142,10524]},Conker_Tree__Realistic:{thresholds:[2,25.977,58.524,195.139],vertexCounts:[18,318,1614,8886]},Date_Palm__Realistic:{thresholds:[2,
31.107,67.609,186.723],vertexCounts:[18,456,2154,9054]},Desert_Willow__Realistic:{thresholds:[2,29.425,59.815,203.238],vertexCounts:[18,408,1686,9720]},Douglas_Fir__Realistic:{thresholds:[2,69.576],vertexCounts:[18,8544]},European_Beech__Realistic:{thresholds:[2,29.854,201.521],vertexCounts:[18,420,7572]},European_Larch__Realistic:{thresholds:[2,65.346],vertexCounts:[18,10314]},Ficus__Realistic:{thresholds:[2,28.768,58.849,210.62],vertexCounts:[18,390,1632,7728]},Field_Elm__Realistic:{thresholds:[2,
34.435,192.436],vertexCounts:[18,1746,10950]},Flannelbush__Realistic:{thresholds:[2,27.408,55.566,196.843],vertexCounts:[18,354,1455,8706]},Flowering_Dogwood__Realistic:{thresholds:[2,28.768,194.687],vertexCounts:[18,390,8664]},Generic_Dead_Tree__Realistic:{thresholds:[2,67.891],vertexCounts:[18,2172]},Generic_Stump__Realistic:{thresholds:[2,19.544,57.757,171.552],vertexCounts:[18,180,1572,2634]},Generic_Unknown__Realistic:{thresholds:[2,32.379,221.987],vertexCounts:[18,1572,9006]},Giant_Sequoia__Realistic:{thresholds:[2,
30.664,204.84],vertexCounts:[18,2160,8232]},Hedgehog_Agave__Realistic:{thresholds:[2,28.546,96.141,228.435],vertexCounts:[18,384,1980,11094]},Japanese_Angelica_Tree__Realistic:{thresholds:[2,25.482,61.287,202.909],vertexCounts:[18,306,1770,7806]},Lacy_Tree_Philodendron__Realistic:{thresholds:[2,28.768,62.974,231.634],vertexCounts:[18,390,1752,10227]},Leyland_Cypress__Realistic:{thresholds:[2,66.246],vertexCounts:[18,10182]},Lily_Of_The_Valley__Realistic:{thresholds:[2,28.322,55.738,198.232],vertexCounts:[18,
378,1464,4152]},Scots_Pine__Realistic:{thresholds:[2,60.554],vertexCounts:[18,7524]},Mediterranean_Buckthorn__Realistic:{thresholds:[2,31.82,211.856],vertexCounts:[18,2196,9030]},Mexican_Palmetto__Realistic:{thresholds:[2,29.425,68.358,212.659],vertexCounts:[18,408,2202,10194]},Mountain_Mahogany__Realistic:{thresholds:[2,31.199,198.614],vertexCounts:[18,1614,8094]},White_Oak__Realistic:{thresholds:[2,15.204,33.801,129.392],vertexCounts:[18,372,1674,9222]},Sugar_Maple__Realistic:{thresholds:[2,28.322,
59.495,216.901],vertexCounts:[18,378,1668,9462]},Norway_Spruce__Realistic:{thresholds:[2,63.101],vertexCounts:[18,9630]},Orchid__Realistic:{thresholds:[2,30.383,63.93,198.664],vertexCounts:[18,435,1926,8346]},Other__Realistic:{thresholds:[2,30.504,194.487],vertexCounts:[18,1572,9006]},Oval_Leaved_Privet__Realistic:{thresholds:[2,59.468],vertexCounts:[18,9162]},Palm_Lily__Realistic:{thresholds:[2,57.977,200.406],vertexCounts:[18,1584,8112]},Palo_Verde__Realistic:{thresholds:[2,65.31,198.124],vertexCounts:[18,
2010,7668]},Paper_Birch__Realistic:{thresholds:[2,117.074],vertexCounts:[18,10578]},Parlour_Palm__Realistic:{thresholds:[2,30.695,60.974,194.832],vertexCounts:[18,444,1752,8388]},Prickly_Pear_Cactus__Realistic:{thresholds:[2,28.657,66.946,214.478],vertexCounts:[18,387,2112,11028]},Red_Alder__Realistic:{thresholds:[2,30.518,192.513],vertexCounts:[18,1770,8274]},Red_Hickory__Realistic:{thresholds:[2,31.604,192.085],vertexCounts:[18,1680,7908]},Rhododendron_Azaleas__Realistic:{thresholds:[2,47.068,192.681],
vertexCounts:[18,1044,8160]},Rose__Realistic:{thresholds:[2,66.085,212.061],vertexCounts:[18,2058,10968]},Ruffle_Palm__Realistic:{thresholds:[2,64.994],vertexCounts:[18,9534]},Saguaro_Cactus__Realistic:{thresholds:[2,34.779,56.703,197.566],vertexCounts:[18,570,1050,1992]},Sassafras__Realistic:{thresholds:[2,110.697],vertexCounts:[18,10944]},Sea_Islands_Yucca__Realistic:{thresholds:[2,61.287,219.899],vertexCounts:[18,1770,10176]},Shadbush__Realistic:{thresholds:[2,26.702,64.03,201.856],vertexCounts:[18,
336,1932,9030]},Snake_Plant__Realistic:{thresholds:[2,23.803,68.265,193.203],vertexCounts:[18,267,2196,5280]},Southern_Magnolia__Realistic:{thresholds:[2,63.431,212.165],vertexCounts:[18,1896,8472]},Spanish_Broom__Realistic:{thresholds:[2,29.854,192.889],vertexCounts:[18,420,7896]},Strawberry_Tree__Realistic:{thresholds:[2,16.772,32.081,186.987],vertexCounts:[18,300,1560,8148]},Sunflower__Realistic:{thresholds:[2,28.768,66.373,194.987],vertexCounts:[18,390,2076,7902]},Sweetgum__Realistic:{thresholds:[2,
31.436,201.223],vertexCounts:[18,1848,7674]},Umbrella_Acacia__Realistic:{thresholds:[2,62.137],vertexCounts:[18,8880]},Western_Juniper__Realistic:{thresholds:[2,62.683],vertexCounts:[18,9120]},White_Ash__Realistic:{thresholds:[2,33.326,192.138],vertexCounts:[18,2070,10542]},White_Poplar__Realistic:{thresholds:[2,30.615,196.71],vertexCounts:[18,1530,9888]},White_Willow__Realistic:{thresholds:[2,62.983],vertexCounts:[18,10422]},Witch_Hazel__Realistic:{thresholds:[2,26.463,66.277,200.916],vertexCounts:[18,
330,2070,10386]},ATM_:{thresholds:[2,46.933],vertexCounts:[150,1038]},Bus_Stop_1_:{thresholds:[2,42.67],vertexCounts:[150,858]},Bus_Stop_2_:{thresholds:[2,46.112],vertexCounts:[138,1002]},Dumpster_:{thresholds:[2,48.006],vertexCounts:[138,1086]},Newspaper_Vending_Machine_:{thresholds:[2,57.203],vertexCounts:[144,1542]},Overhanging_Sidewalk_Light_Off_:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Sidewalk_Light_On_:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Street_And_Sidewalk_Light_Off_:{thresholds:[2,
46.524],vertexCounts:[147,1020]},Overhanging_Street_And_Sidewalk_Light_On_:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_Light_Off_:{thresholds:[2,34.225],vertexCounts:[144,552]},Overhanging_Street_Light_On_:{thresholds:[2,34.225],vertexCounts:[144,552]},Park_Bench_1_:{thresholds:[2,23.669],vertexCounts:[96,264]},Park_Bench_2_:{thresholds:[2,44.71],vertexCounts:[144,942]},Park_Bench_3_:{thresholds:[2,41.917],vertexCounts:[120,828]},Park_Bench_4_:{thresholds:[2,69.923],vertexCounts:[144,
2304]},Payphone_:{thresholds:[2,58.524],vertexCounts:[156,1614]},Picnic_Table_:{thresholds:[2,35.504],vertexCounts:[90,594]},Planter_Circular_:{thresholds:[2,99.368],vertexCounts:[153,4653]},Planter_Square_:{thresholds:[2,65.212],vertexCounts:[150,2004]},Planter_Tapered_:{thresholds:[2,89.669],vertexCounts:[141,3789]},Rock_1_:{thresholds:[2,28.768,50.463],vertexCounts:[132,390,1200]},Rock_2_:{thresholds:[2,43.556,73.127],vertexCounts:[150,894,2520]},Rock_3_:{thresholds:[2,37.931,70.286],vertexCounts:[144,
678,2328]},Rock_4_:{thresholds:[2,41.613,70.738],vertexCounts:[150,816,2358]},Street_Light_Off_:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Street_Light_On_:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Traffic_Barrier_2_:{thresholds:[2,42.819],vertexCounts:[132,864]},Trash_Bin_1_:{thresholds:[2,50.019],vertexCounts:[132,1179]},Trash_Bin_2_:{thresholds:[2,36.038,63.028],vertexCounts:[108,612,1872]},Trash_Bin_3_:{thresholds:[2,42.371,64.03],vertexCounts:[102,846,1932]},
Trash_Can_1_:{thresholds:[2,58.524,98.628],vertexCounts:[150,1614,4584]},Trash_Can_2_:{thresholds:[2,53.166],vertexCounts:[84,1332]},US_Mailbox_:{thresholds:[2,48.402],vertexCounts:[156,1104]},Ambulance_:{thresholds:[2,67.121,343.733],vertexCounts:[294,3285,13758]},Audi_A6_:{thresholds:[2,63.823,484.156],vertexCounts:[300,4311,14280]},Backhoe_:{thresholds:[2,60.173,391.986],vertexCounts:[453,5895,14679]},BMW_3Series_:{thresholds:[2,68.886,417.563],vertexCounts:[294,4188,14727]},Bobcat_:{thresholds:[2,
61.105,269.127],vertexCounts:[438,4476,14952]},Bus_:{thresholds:[2,63.803,402.682],vertexCounts:[300,4398,14988]},Crane_:{thresholds:[2,65.969,386.67],vertexCounts:[438,4497,14487]},Dumptruck_:{thresholds:[2,66.91,354.365],vertexCounts:[456,6294,14052]},Eurocopter_AS365_:{thresholds:[2,227.817],vertexCounts:[432,14733]},Eurocopter_AS365_Flying_:{thresholds:[2,96.244,380.211],vertexCounts:[306,4365,10575]},Eurocopter_H125_:{thresholds:[2,96.567,378.995],vertexCounts:[438,4440,14763]},Eurocopter_H125_Flying_:{thresholds:[2,
94.002,366.378],vertexCounts:[294,4164,13569]},Firetruck_:{thresholds:[2,65.762,383.645],vertexCounts:[276,4482,14901]},Ford_Edge_:{thresholds:[2,68.763,419.635],vertexCounts:[294,4368,14733]},Ford_Expedition_:{thresholds:[2,62.994,388.251],vertexCounts:[276,4410,14868]},Ford_F150_:{thresholds:[2,60.495,394.682],vertexCounts:[300,4950,14988]},Ford_Fiesta_:{thresholds:[2,64.994,355.46],vertexCounts:[282,4185,14223]},Ford_Focus_Hatchback_:{thresholds:[2,62.072,387.932],vertexCounts:[300,4470,14925]},
Ford_Fusion_:{thresholds:[2,64.485,370.289],vertexCounts:[294,4500,14955]},Ford_Mustang_:{thresholds:[2,64.812,351.721],vertexCounts:[288,4197,14574]},Ford_Taurus_:{thresholds:[2,67.461,379.324],vertexCounts:[282,4404,15042]},Ford_Transit_Commercial_Van_:{thresholds:[2,88.6,384.491],vertexCounts:[276,4443,14721]},Ford_Transit_Connect_:{thresholds:[2,67.006,336.74],vertexCounts:[258,4344,14328]},Mercedes_SClass_:{thresholds:[2,66.188,349.491],vertexCounts:[300,4377,14721]},Motorboat_:{thresholds:[2,
67.436,364.325],vertexCounts:[315,4491,14958]},Motorcycle_:{thresholds:[2,35.435,357.215],vertexCounts:[294,4806,14865]},Police_Car_:{thresholds:[2,68.116,350.794],vertexCounts:[294,3987,14580]},Porsche_Boxter_:{thresholds:[2,67.717,361.95],vertexCounts:[312,6225,14676]},Porsche_Carrera_:{thresholds:[2,66.588,392.685],vertexCounts:[306,4473,14571]},Sailboat_:{thresholds:[2,97.329,383.075],vertexCounts:[294,4464,14937]},Sailboat_Sails_Up_:{thresholds:[2,97.46,360.432],vertexCounts:[300,4476,14967]},
Taxi_:{thresholds:[2,64.415,381.491],vertexCounts:[300,4305,14721]},Taxi_Van_:{thresholds:[2,64.614,364.475],vertexCounts:[288,4341,11949]},Tesla_P7_:{thresholds:[2,58.155],vertexCounts:[300,16062]},Tower_Crane_:{thresholds:[2,106.34,419.821],vertexCounts:[432,4488,14832]},Toyota_Prius_:{thresholds:[2,66.448,357.251],vertexCounts:[288,4266,14370]},Tram_:{thresholds:[2,65.43,369.937],vertexCounts:[420,5610,19605]},Volkswagen_Jetta_Wagon_:{thresholds:[2,65.925,354.416],vertexCounts:[294,4443,14466]},
Traffic_Light_1_:{thresholds:[2,75.315],vertexCounts:[135,2673]},Traffic_Light_3_:{thresholds:[2,49.12],vertexCounts:[132,1137]},Traffic_Light_4_:{thresholds:[2,70.962,115.735],vertexCounts:[96,2373,6312]},Cell_Phone_Antenna_:{thresholds:[2,53.05602049838099,225.75567007367763],vertexCounts:[150,894,4242]},Electricity_Box_:{thresholds:[2,56.48433069112405,207.14360140104995],vertexCounts:[108,744,1026]},Electricity_Meter_:{thresholds:[2,53.4669717168887,215.04066673528195],vertexCounts:[120,384,960]},
Powerline_Pole_:{thresholds:[2,28.11004122822377,58.29783783397482],vertexCounts:[120,840,3678]},Radio_Antenna_:{thresholds:[2,32.2179270951266,462.06696540941175],vertexCounts:[297,1815,9009]},Wind_Turbine_:{thresholds:[2,56.15679308163878,247.66420622007408],vertexCounts:[291,1806,7974]},Bike_Rack_:{thresholds:[2,33.4134686118416,742.2476610265626],vertexCounts:[138,900,3948]},Fire_Hydrant_:{thresholds:[2,30.215510249190537,390.42722821984944],vertexCounts:[156,894,2676]},Fountain_1_:{thresholds:[2,
52.36907652663328,221.4335455931077],vertexCounts:[300,1782,8052]},Fountain_2_:{thresholds:[2,58.20077988776262,254.01846725224388],vertexCounts:[288,1794,8526]},Fountain_3_:{thresholds:[2,30.089436161855176,215.0465007031079],vertexCounts:[306,1800,8880]},Fountain_4_:{thresholds:[2,90.06038366113779,351.6045839690371],vertexCounts:[252,1656,2136]},Mailbox_:{thresholds:[2,52.806020498381045,378.6213345953622],vertexCounts:[150,894,4494]},Sewer_Grate_:{thresholds:[2,32.31186201200472,388.7801192944885],
vertexCounts:[60,492,1788]},Storm_Drain_:{thresholds:[2,93.440164912895,355.73135487536024],vertexCounts:[150,840,3300]},Traffic_Pylon_:{thresholds:[2,59.30348706874729,388.12062237971986],vertexCounts:[138,756,1740]},Airplane_Large_Passenger_:{thresholds:[2,32.63681118513339,229.25055778384916],vertexCounts:[303,1614,7086]},Airplane_Large_Passenger_With_Wheels_:{thresholds:[2,57.56132180109627,219.23679864871204],vertexCounts:[450,2550,9186]},Airplane_Private_:{thresholds:[2,55.15153188839752,218.4051249478359],
vertexCounts:[300,1209,6894]},Airplane_Private_With_Wheels_:{thresholds:[2,54.962671511046956,225.3801611565773],vertexCounts:[366,1737,8454]},Airplane_Propeller_:{thresholds:[2,55.03627391751588,214.63956781455144],vertexCounts:[291,1560,8502]},Airplane_Propeller_With_Wheels_:{thresholds:[2,57.1404638556843,221.48743600008154],vertexCounts:[303,1776,9006]},Airplane_Small_Passenger_:{thresholds:[2,56.98035485213009,217.0648860940108],vertexCounts:[300,1530,8946]},Airplane_Small_Passenger_With_Wheels_:{thresholds:[2,
56.402226419354996,227.53633450087503],vertexCounts:[456,1698,11400]},Cargo_Box_:{thresholds:[2,180.55115902122088,360.2534460453696],vertexCounts:[132,672,3738]},Cargo_Ship_Empty_:{thresholds:[2,58.00721049029622,327.1185961587389],vertexCounts:[444,2616,10896]},Cargo_Ship_Full_:{thresholds:[2,55.386139460867525,346.87126261041203],vertexCounts:[450,2670,10950]},City_Bike_:{thresholds:[2,56.670817449986885,242.3113495346381],vertexCounts:[300,1785,8736]},Delivery_Truck_:{thresholds:[2,34.92797405514993,
120.33485126686935],vertexCounts:[408,2130,13248]},High_Speed_Train_:{thresholds:[2,58.255981072570464,405.19492233117126],vertexCounts:[276,1908,11928]},Mountain_Bike_:{thresholds:[2,30.151936161855172,115.15158622172994],vertexCounts:[294,1800,8994]},Pickup_Truck_Ford_F250_:{thresholds:[2,31.705838007504713,69.25663661786093],vertexCounts:[300,1770,8976]},Pickup_Truck_Toyota_Hilux_:{thresholds:[2,56.84455317543219,128.81569681781366],vertexCounts:[306,1716,9048]},Road_Bike_:{thresholds:[2,44.97251491181105,
127.30122549350301],vertexCounts:[297,1788,8916]},Semi_Trailer_Truck_:{thresholds:[2,35.382538898732484,127.42462492550419],vertexCounts:[282,1740,8997]},Tractor_:{thresholds:[2,33.01181118513338,128.39790644030703],vertexCounts:[306,1614,8961]},Tractor_And_Trailer_:{thresholds:[2,33.18284541984615,130.95719106637375],vertexCounts:[450,2502,12894]},Trailer_:{thresholds:[2,30.327031957706836,119.19765978853422],vertexCounts:[270,1440,9E3]},Train_Europe_:{thresholds:[2,31.15174353437363,105.3408295387661],
vertexCounts:[138,756,3846]},Train_Europe_With_Carriages_:{thresholds:[2,57.97062023935375,355.8054399222865],vertexCounts:[408,2682,10596]},Train_US_:{thresholds:[2,27.776264387000953,61.24231873858716],vertexCounts:[156,618,3648]},Tricycle_:{thresholds:[2,31.87237750582925,132.64683491853526],vertexCounts:[297,1746,8136]},Truck_With_Trailer_:{thresholds:[2,57.64037298915464,361.21271516459444],vertexCounts:[438,2478,13476]},Orange_Tree__Realistic:{thresholds:[2,25.470734736913386,62.118518915365755,
128.10642692525323],vertexCounts:[18,354,1524,10302]},American_Football_Goal_:{thresholds:[2,34.76135530828228,712.2046360848831],vertexCounts:[147,588,2688]},Basketball_Hoop_:{thresholds:[2,52.74512035232253,208.15783725757558],vertexCounts:[123,768,4260]},Jungle_Gym_:{thresholds:[2,47.5885918871016,256.602450987006],vertexCounts:[294,1773,8916]},Slide_:{thresholds:[2,29.23625745590553,729.2078902902748],vertexCounts:[252,1788,7440]},Soccer_Goal_:{thresholds:[2,33.671199284957794,364.5834082156921],
vertexCounts:[138,870,4266]},Swing_:{thresholds:[2,32.70510997459713,449.6062391021012],vertexCounts:[300,1734,7176]},Teeter_Totter_:{thresholds:[2,53.23896332520353,456.4221097287286],vertexCounts:[294,1710,7794]},Balsam_Fir__Schematic:{thresholds:[2,107.63596252927391,859.3878782201409],vertexCounts:[66,126,222]},Umbrella_Acacia__Schematic:{thresholds:[2,28.236981042654023,770.1463507109006],vertexCounts:[138,630,2238]},Sugar_Maple__Schematic:{thresholds:[2,14.35031627906977,881.1466235565822],
vertexCounts:[108,852,3396]},Conker_Tree__Schematic:{thresholds:[2,15.284392361111118,832.0115049504952],vertexCounts:[108,852,3396]},Hedgehog_Agave__Schematic:{thresholds:[2,14.987731203007513,823.8048558262012],vertexCounts:[72,792,3312]},Ruffle_Palm__Schematic:{thresholds:[2,12.135573455233287,817.5737099621688],vertexCounts:[108,852,3396]},Red_Alder__Schematic:{thresholds:[2,14.01284931506851,780.2679999999996],vertexCounts:[108,852,3396]},Shadbush__Schematic:{thresholds:[2,29.80464285714286,
842.6101098901099],vertexCounts:[72,792,3312]},Japanese_Angelica_Tree__Schematic:{thresholds:[2,15.115126024590165,799.501264413519],vertexCounts:[108,852,3396]},Strawberry_Tree__Schematic:{thresholds:[2,15.083150000000003,818.0121967213113],vertexCounts:[108,852,3396]},Paper_Birch__Schematic:{thresholds:[2,10.303635227272727,878.0123272727276],vertexCounts:[108,780,2100]},Orchid__Schematic:{thresholds:[2,26.07269215291752,923.3067065420558],vertexCounts:[108,780,2100]},Boxwood__Schematic:{thresholds:[2,
15.198452928870296,830.9156959761549],vertexCounts:[108,852,3396]},California_Incense_Cedar__Schematic:{thresholds:[2,12.739357933579337,864.1071448275861],vertexCounts:[138,630,2238]},Saguaro_Cactus__Schematic:{thresholds:[2,27.560375000000015,919.7996596551259],vertexCounts:[108,780,2100]},Red_Hickory__Schematic:{thresholds:[2,16.855436823104693,800.57046628131],vertexCounts:[108,852,3396]},American_Chestnut__Schematic:{thresholds:[2,17.239219730941716,846.5782343859651],vertexCounts:[108,852,3396]},
Australian_Pine__Schematic:{thresholds:[2,16.529950965824664,803.2413670133733],vertexCounts:[138,630,2238]},Mountain_Mahogany__Schematic:{thresholds:[2,13.008124060150381,917.9049999999999],vertexCounts:[108,852,3396]},Parlour_Palm__Schematic:{thresholds:[2,14.524522935779814,819.898849909584],vertexCounts:[108,780,2100]},Desert_Willow__Schematic:{thresholds:[2,14.02700704225353,920.7354144884243],vertexCounts:[108,852,3396]},Orange_Tree__Schematic:{thresholds:[2,14.192646264057018,861.1305417111394],
vertexCounts:[108,852,3396]},Coconut_Palm__Schematic:{thresholds:[2,16.367034412955462,902.0106492659056],vertexCounts:[108,852,3396]},Lily_Of_The_Valley__Schematic:{thresholds:[2,51.11744751381218,792.1491071428572],vertexCounts:[138,630,2238]},Palm_Lily__Schematic:{thresholds:[2,15.243925287356316,799.762794117647],vertexCounts:[108,780,2100]},Flowering_Dogwood__Schematic:{thresholds:[2,15.508128172588837,810.379933284989],vertexCounts:[108,852,3396]},Common_Hawthorn__Schematic:{thresholds:[2,15.159807441253282,
889.5056919060053],vertexCounts:[72,792,3312]},Leyland_Cypress__Schematic:{thresholds:[2,14.94957231404959,805.2679669421484],vertexCounts:[108,852,3396]},Amazon_Sword_Plant__Schematic:{thresholds:[2,17.358711448598132,824],vertexCounts:[108,852,3396]},Blue_Gum_Eucalyptus__Schematic:{thresholds:[2,26.441309523809522,820.3575976676384],vertexCounts:[138,630,2238]},European_Beech__Schematic:{thresholds:[2,25.26955788590608,871.8532751677853],vertexCounts:[138,630,2238]},Ficus__Schematic:{thresholds:[2,
15.364387681159425,800.1358897637797],vertexCounts:[108,852,3396]},Alder_Buckthorn__Schematic:{thresholds:[2,16.64437797619048,1028.757943743938],vertexCounts:[108,852,3396]},White_Ash__Schematic:{thresholds:[2,14.981912280701744,776.9208385269121],vertexCounts:[108,852,3396]},Flannelbush__Schematic:{thresholds:[2,15.24620504087194,805.9792635498547],vertexCounts:[72,792,3312]},Generic_Dead_Tree__Schematic:{thresholds:[2,15.068557103064066,858],vertexCounts:[108,852,3396]},Witch_Hazel__Schematic:{thresholds:[2,
15.320549999999995,801.9632958152956],vertexCounts:[108,852,3396]},Sunflower__Schematic:{thresholds:[2,30.66128647686832,796.1051534500516],vertexCounts:[108,852,3396]},California_Walnut__Schematic:{thresholds:[2,16.488717712177117,895.3309873754151],vertexCounts:[108,852,3396]},Western_Juniper__Schematic:{thresholds:[2,26.945806855636135,767.2468292682922],vertexCounts:[138,630,2238]},European_Larch__Schematic:{thresholds:[2,13.155643356643353,830.1452680652685],vertexCounts:[138,630,2238]},Bay_Laurel__Schematic:{thresholds:[2,
14.695218421052633,808.1161693811073],vertexCounts:[138,630,2238]},Oval_Leaved_Privet__Schematic:{thresholds:[2,14.822584645669306,828.4657637795276],vertexCounts:[72,792,3312]},Sweetgum__Schematic:{thresholds:[2,14.500420491803279,792.8281936148301],vertexCounts:[138,630,2238]},Southern_Magnolia__Schematic:{thresholds:[2,15.046679712460072,778.8604087591239],vertexCounts:[108,852,3396]},Banana_Tree__Schematic:{thresholds:[2,14.268900557620823,855.4758067831449],vertexCounts:[108,780,2100]},Prickly_Pear_Cactus__Schematic:{thresholds:[2,
14.461720869565228,817.0421426086955],vertexCounts:[72,720,2016]},Generic_Unknown__Schematic:{thresholds:[2,14.366287644787645,899.208477804681],vertexCounts:[108,852,3396]},Palo_Verde__Schematic:{thresholds:[2,28.513162650602432,932.5919321314955],vertexCounts:[138,630,2238]},Lacy_Tree_Philodendron__Schematic:{thresholds:[2,15.89430837004405,797.5864920353984],vertexCounts:[102,570,2154]},Cabbage_Palm_Fern__Schematic:{thresholds:[2,29.3428324742268,1016],vertexCounts:[102,570,2154]},Date_Palm__Schematic:{thresholds:[2,
13.186208480565373,956.3961600000001],vertexCounts:[108,852,3396]},Bamboo__Schematic:{thresholds:[2,114.71951515151522,843.8529763779525],vertexCounts:[60,132,276]},Norway_Spruce__Schematic:{thresholds:[2,129.71889887640438,911.9744719101127],vertexCounts:[66,126,222]},Scots_Pine__Schematic:{thresholds:[2,31.596748201438846,802.180143884892],vertexCounts:[138,630,2238]},American_Sycamore__Schematic:{thresholds:[2,17.793048780487815,818.0204116094988],vertexCounts:[108,852,3396]},White_Poplar__Schematic:{thresholds:[2,
15.577301587301578,793.0779038047372],vertexCounts:[108,780,2100]},Apricot__Schematic:{thresholds:[2,17.03619453924915,796.0093830508479],vertexCounts:[108,852,3396]},Douglas_Fir__Schematic:{thresholds:[2,6.898190007037297,871.0619788881072],vertexCounts:[126,636,1956]},White_Oak__Schematic:{thresholds:[2,13.248768433179723,895.745945945946],vertexCounts:[108,852,3396]},Mediterranean_Buckthorn__Schematic:{thresholds:[2,15.481177685950412,814.9279016681298],vertexCounts:[108,852,3396]},Rhododendron_Azaleas__Schematic:{thresholds:[2,
14.877305555555564,813.5712917369306],vertexCounts:[108,852,3396]},Black_Locust__Schematic:{thresholds:[2,16.01144497607656,791.7159498154983],vertexCounts:[108,852,3396]},Rose__Schematic:{thresholds:[2,14.787227941176468,800.0478006734006],vertexCounts:[108,852,3396]},Mexican_Palmetto__Schematic:{thresholds:[2,13.546397993311047,909.3318618618619],vertexCounts:[108,852,3396]},White_Willow__Schematic:{thresholds:[2,15.464474625144176,821.6042260668969],vertexCounts:[108,852,3396]},Snake_Plant__Schematic:{thresholds:[2,
116.3567710843375,792.3341835147744],vertexCounts:[60,132,276]},Sassafras__Schematic:{thresholds:[2,28.228858319604583,870.7394179022517],vertexCounts:[138,630,2238]},California_Redwood__Schematic:{thresholds:[2,12.938791007615702,889.7742940831868],vertexCounts:[108,780,2100]},Giant_Sequoia__Schematic:{thresholds:[2,13.939714285714274,828.8460395256916],vertexCounts:[138,630,2238]},Common_Whitebeam__Schematic:{thresholds:[2,15.902902542372882,872.9050708661416],vertexCounts:[108,852,3396]},Spanish_Broom__Schematic:{thresholds:[2,
14.866623996789723,815.3769117174961],vertexCounts:[72,792,3312]},Generic_Stump__Schematic:{thresholds:[2,121.01622222222227,923.740137931034],vertexCounts:[60,132,276]},Baldcypress__Schematic:{thresholds:[2,16.348127777777776,817.8199690358902],vertexCounts:[138,630,2238]},Basswood__Schematic:{thresholds:[2,15.118691605839418,835.9789696969701],vertexCounts:[108,852,3396]},Field_Elm__Schematic:{thresholds:[2,15.185642361111121,804.1571316818777],vertexCounts:[108,852,3396]},California_Bay__Schematic:{thresholds:[2,
14.085977419354833,841.5876923076921],vertexCounts:[108,852,3396]},California_Palm__Schematic:{thresholds:[2,13.896321678321671,843.3262657342657],vertexCounts:[138,630,2238]},Sea_Islands_Yucca__Schematic:{thresholds:[2,28.116965753424623,870.5225410421126],vertexCounts:[102,570,2154]}}})},"esri/views/3d/glTF/loader":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){function q(a,b){return l(this,void 0,void 0,function(){function c(e,f){return l(this,void 0,void 0,function(){var g,h,m,p,q,r,l,v,y;return k(this,function(k){switch(k.label){case 0:g=d.nodes[e];h=a.getNodeTransform(e);x.warnUnsupportedIf(null!=g.weights,"Morph targets are not supported.");if(null==g.mesh)return[3,4];m=d.meshes[g.mesh];p=0;q=m.primitives;k.label=1;case 1:if(!(p<q.length))return[3,4];r=q[p];return[4,b(r,h,f,m.name)];case 2:k.sent(),k.label=3;case 3:return p++,
[3,1];case 4:l=0,v=g.children||[],k.label=5;case 5:if(!(l<v.length))return[3,8];y=v[l];return[4,c(y,f)];case 6:k.sent(),k.label=7;case 7:return l++,[3,5];case 8:return[2]}})})}var d,e,f,h,m,p,q,r,y,u;return k(this,function(b){switch(b.label){case 0:d=a.json,e=d.scenes[d.scene||0],f=e.nodes,h=1<f.length,m=0,p=f,b.label=1;case 1:if(!(m<p.length))return[3,4];q=p[m];r=d.nodes[q];y=[c(q,0)];r.extensions&&r.extensions.MSFT_lod&&Array.isArray(r.extensions.MSFT_lod.ids)&&!h&&(u=r.extensions.MSFT_lod.ids,
y.push.apply(y,u.map(function(a,b){return c(a,b+1)})));return[4,g.all(y)];case 2:b.sent(),b.label=3;case 3:return m++,[3,1];case 4:return[2]}})})}function p(a,b,c){var d=function(b){var d=c+"_tex_"+(b&&b.id)+(b&&b.name?"_"+b.name:"");if(b&&!a.textures.has(d)){var e=f.makeTextureSource(b.data,{wrap:{s:r(b.wrapS),t:r(b.wrapT)},mipmap:w.some(function(a){return a===b.minFilter}),noUnpackFlip:!0});a.textures.set(d,e)}return d},e=c+"_mat_"+b.id+"_"+b.name;a.materials.has(e)||(b=f.makeMaterialParameters({color:[b.color[0],
b.color[1],b.color[2]],opacity:b.color[3],alphaMode:b.alphaMode,alphaCutoff:b.alphaCutoff,doubleSided:b.doubleSided,colorMixMode:b.ESRI_externalColorMixMode,textureColor:b.colorTexture?d(b.colorTexture):void 0,textureNormal:b.normalTexture?d(b.normalTexture):void 0,textureOcclusion:b.occlusionTexture?d(b.occlusionTexture):void 0,textureEmissive:b.emissiveTexture?d(b.emissiveTexture):void 0,textureMetallicRoughness:b.metallicRoughnessTexture?d(b.metallicRoughnessTexture):void 0,emissiveFactor:[b.emissiveFactor[0],
b.emissiveFactor[1],b.emissiveFactor[2]],metallicFactor:b.metallicFactor,roughnessFactor:b.roughnessFactor}),a.materials.set(e,b));return e}function r(a){if(33071===a||33648===a||10497===a)return a;x.error("Unexpected TextureSampler WrapMode: "+a)}Object.defineProperty(b,"__esModule",{value:!0});var t=0;b.load=function(b,d,f){void 0===f&&(f={});return l(this,void 0,void 0,function(){var g,h,m,r,v=this;return k(this,function(y){switch(y.label){case 0:return[4,c.Resource.load(b,x,d,f)];case 1:return g=
y.sent(),h="gltf_"+t++,m={lods:[],materials:new Map,textures:new Map},r=!(!g.json.asset.extras||"symbolResource"!==g.json.asset.extras.ESRI_type),[4,q(g,function(b,c,d,q){return l(v,void 0,void 0,function(){var r,l,v,y,t,z,w,n,B,L;return k(this,function(k){switch(k.label){case 0:r=void 0!==b.mode?b.mode:4;a:switch(r){case 4:case 5:case 6:l=r;break a;default:l=null}return a.isNone(l)?(x.warnUnsupported("Unsupported primitive mode ("+u[r]+"). Skipping primitive."),[2]):g.hasPositions(b)?[4,g.getMaterial(b,
f)]:(x.warn("Skipping primitive without POSITION vertex attribute."),[2]);case 1:return v=k.sent(),t={transform:e.mat4f64.clone(c)},z={},[4,g.getPositionData(b,f)];case 2:return t.attributes=(z.position=k.sent(),z.normal=null,z.texCoord0=null,z.color=null,z.tangent=null,z),[4,g.getIndexData(b,f)];case 3:y=(t.indices=k.sent(),t.primitiveType=l,t.material=p(m,v,h),t);if(!g.hasNormals(b))return[3,5];w=y.attributes;return[4,g.getNormalData(b,f)];case 4:w.normal=k.sent(),k.label=5;case 5:if(!g.hasTangents(b))return[3,
7];n=y.attributes;return[4,g.getTangentData(b,f)];case 6:n.tangent=k.sent(),k.label=7;case 7:if(!g.hasTextureCoordinates(b))return[3,9];B=y.attributes;return[4,g.getTextureCoordinates(b,f)];case 8:B.texCoord0=k.sent(),k.label=9;case 9:if(!g.hasVertexColors(b))return[3,11];L=y.attributes;return[4,g.getVertexColors(b,f)];case 10:L.color=k.sent(),k.label=11;case 11:return m.lods[d]=m.lods[d]||{parts:[],name:q,lodThreshold:null},m.lods[d].parts.push(y),[2]}})})})];case 2:return y.sent(),[2,{model:m,meta:{isEsriSymbolResource:r,
uri:g.uri},customMeta:{}}]}})})};var x=new d.DefaultErrorContext,w=[9987,9985],u="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ")})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["require","exports","../../../core/Error","../../../core/Logger"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});var h=k.getLogger("esri.views.3d.glTF");n=function(){function a(){}a.prototype.error=function(a){throw new l("gltf-loader-error",a);};a.prototype.errorUnsupported=
function(a){throw new l("gltf-loader-unsupported-feature",a);};a.prototype.errorUnsupportedIf=function(a,b){a&&this.errorUnsupported(b)};a.prototype.assert=function(a,b){a||this.error(b)};a.prototype.warn=function(a){h.warn(a)};a.prototype.warnUnsupported=function(a){this.warn("[Unsupported Feature] "+a)};a.prototype.warnUnsupportedIf=function(a,b){a&&this.warnUnsupported(b)};return a}();b.DefaultErrorContext=n})},"esri/views/3d/glTF/LoaderResult":function(){define(["require","exports","../../../core/tsSupport/assignHelper"],
function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.makeMaterialParameters=function(b){void 0===b&&(b={});return l({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},b)};b.makeTextureSource=function(b,h){void 0===
h&&(h={});return{data:b,parameters:l({wrap:l({s:10497,t:10497},h.wrap),noUnpackFlip:!0,mipmap:!1},h)}}})},"esri/views/3d/glTF/internal/Resource":function(){define("require exports ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/promiseUtils ../../../../core/string ../../../../core/urlUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ./BinaryStreamReader ./fillDefaults ./pathUtils ../../support/buffer/BufferView ../../support/buffer/utils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y){function m(b){switch(b.componentType){case 5120:return new u.BufferViewVec2i8(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5121:return new u.BufferViewVec2u8(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5122:return new u.BufferViewVec2i16(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5123:return new u.BufferViewVec2u16(b.raw,b.byteOffset,b.byteStride,b.byteOffset+
b.byteStride*b.entryCount);case 5125:return new u.BufferViewVec2u32(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5126:return new u.BufferViewVec2f(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);default:a.neverReached(b.componentType)}}function v(a){return l(this,void 0,void 0,function(){return k(this,function(b){return[2,g.create(function(b,c){var d=new Blob([a]),e=new FileReader;e.onload=function(){b(JSON.parse(e.result))};e.onerror=function(a){c(a)};
e.readAsText(d)})]})})}function z(a,b){return l(this,void 0,void 0,function(){return k(this,function(c){return[2,g.create(function(c,d){var e=new Blob([a],{type:b}),f=URL.createObjectURL(e),g=new Image;g.addEventListener("load",function(){URL.revokeObjectURL(f);c(g)});g.addEventListener("error",function(a){URL.revokeObjectURL(f);d(a)});g.src=f})]})})}Object.defineProperty(b,"__esModule",{value:!0});var B;n=function(){function a(a,b,c,d,e){this.context=a;this.errorContext=b;this.uri=c;this.json=d;
this.glbBuffer=e;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=w.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();b.errorUnsupportedIf(null==d.scenes,"Scenes must be defined.");b.errorUnsupportedIf(null==d.meshes,"Meshes must be defined");b.errorUnsupportedIf(null==d.nodes,"Nodes must be defined.");this.computeNodeParents()}a.load=function(b,c,d,f){return l(this,
void 0,void 0,function(){var g,h,m,p,q,r;return k(this,function(k){switch(k.label){case 0:return e.endsWith(d,".gltf")?[4,b.loadJSON(d,f)]:[3,2];case 1:return g=k.sent(),[2,new a(b,c,d,g)];case 2:return e.endsWith(d,".glb")?[4,b.loadBinary(d,f)]:[3,5];case 3:return h=k.sent(),[4,a.parseGLB(c,h)];case 4:return m=k.sent(),[2,new a(b,c,d,m.json,m.binaryData)];case 5:return[4,b.loadBinary(d,f)];case 6:return p=k.sent(),q=new t.BinaryStreamReader(p),4<=q.remainingBytes()&&1179937895===q.readUint32()?[4,
a.parseGLB(c,p)]:[3,8];case 7:return m=k.sent(),[2,new a(b,c,d,m.json,m.binaryData)];case 8:return[4,b.loadJSON(d,f)];case 9:return r=k.sent(),[2,new a(b,c,d,r)]}})})};a.parseGLB=function(a,b){return l(this,void 0,void 0,function(){var c,d,e,f,g,h,m,p,q;return k(this,function(k){switch(k.label){case 0:c=new t.BinaryStreamReader(b),a.assert(12<=c.remainingBytes(),"GLB binary data is insufficiently large."),d=c.readUint32(),e=c.readUint32(),f=c.readUint32(),a.assert(1179937895===d,"Magic first 4 bytes do not fit to expected GLB value."),
a.assert(b.byteLength>=f,"GLB binary data is smaller than header specifies."),a.errorUnsupportedIf(2!==e,"An unsupported GLB container version was detected. Only version 2 is supported."),g=0,k.label=1;case 1:if(!(8<=c.remainingBytes()))return[3,5];p=c.readUint32();q=c.readUint32();if(0!==g)return[3,3];a.assert(1313821514===q,"First GLB chunk must be JSON.");a.assert(0<=p,"No JSON data found.");return[4,v(c.readUint8Array(p))];case 2:return h=k.sent(),[3,4];case 3:1===g?(a.errorUnsupportedIf(5130562!==
q,"Second GLB chunk expected to be BIN."),m=c.readUint8Array(p)):a.warnUnsupported("More than 2 GLB chunks detected. Skipping."),k.label=4;case 4:return g+=1,[3,1];case 5:return h||a.error("No GLB JSON chunk detected."),[2,{json:h,binaryData:m}]}})})};a.prototype.getBuffer=function(a,b){return l(this,void 0,void 0,function(){var c,d,e,f;return k(this,function(g){switch(g.label){case 0:return c=this.json.buffers[a],d=this.errorContext,null==c.uri?(d.assert(null!=this.glbBuffer,"GLB buffer not present"),
[2,this.glbBuffer]):(e=this.bufferCache.get(a))?[3,2]:[4,this.context.loadBinary(this.resolveUri(c.uri),b)];case 1:f=g.sent(),e=new Uint8Array(f),this.bufferCache.set(a,e),d.assert(e.byteLength===c.byteLength,"Buffer byte lengths should match."),g.label=2;case 2:return[2,e]}})})};a.prototype.getAccessor=function(a,b){return l(this,void 0,void 0,function(){var c,d,e,f,g,h,m,p;return k(this,function(k){switch(k.label){case 0:return c=this.json.accessors[a],d=this.errorContext,d.errorUnsupportedIf(null==
c.bufferView,"Some accessor does not specify a bufferView."),d.errorUnsupportedIf(c.type in["MAT2","MAT3","MAT4"],"AttributeType "+c.type+" is not supported"),e=this.json.bufferViews[c.bufferView],[4,this.getBuffer(e.buffer,b)];case 1:return f=k.sent(),g=I[c.type],h=Q[c.componentType],m=g*h,p=e.byteStride||m,[2,{raw:f.buffer,byteStride:p,byteOffset:f.byteOffset+(e.byteOffset||0)+(c.byteOffset||0),entryCount:c.count,isDenselyPacked:p===m,componentCount:g,componentByteSize:h,componentType:c.componentType,
min:c.min,max:c.max,normalized:!!c.normalized}]}})})};a.prototype.getIndexData=function(a,b){return l(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return null==a.indices?[2,null]:[4,this.getAccessor(a.indices,b)];case 1:c=d.sent();if(c.isDenselyPacked)switch(c.componentType){case 5121:return[2,new Uint8Array(c.raw,c.byteOffset,c.entryCount)];case 5123:return[2,new Uint16Array(c.raw,c.byteOffset,c.entryCount)];case 5125:return[2,new Uint32Array(c.raw,c.byteOffset,
c.entryCount)]}else switch(c.componentType){case 5121:return[2,y.scalar.makeDense(this.wrapAccessor(u.BufferViewUint8,c))];case 5123:return[2,y.scalar.makeDense(this.wrapAccessor(u.BufferViewUint16,c))];case 5125:return[2,y.scalar.makeDense(this.wrapAccessor(u.BufferViewUint32,c))]}return[2,void 0]}})})};a.prototype.getPositionData=function(a,b){return l(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==a.attributes.POSITION,
"No POSITION vertex data found."),[4,this.getAccessor(a.attributes.POSITION,b)];case 1:return d=e.sent(),c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+J[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,"POSITION vertex attribute must have 3 components, but found "+d.componentCount.toFixed()),[2,this.wrapAccessor(u.BufferViewVec3f,d)]}})})};a.prototype.getNormalData=function(a,b){return l(this,void 0,void 0,function(){var c,d;
return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.NORMAL,"No NORMAL vertex data found."),[4,this.getAccessor(a.attributes.NORMAL,b)];case 1:return d=e.sent(),c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+J[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,"NORMAL vertex attribute must have 3 components, but found "+d.componentCount.toFixed()),[2,this.wrapAccessor(u.BufferViewVec3f,
d)]}})})};a.prototype.getTangentData=function(a,b){return l(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.TANGENT,"No TANGENT vertex data found."),[4,this.getAccessor(a.attributes.TANGENT,b)];case 1:return d=e.sent(),c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+J[d.componentType]),c.errorUnsupportedIf(4!==d.componentCount,"TANGENT vertex attribute must have 4 components, but found "+
d.componentCount.toFixed()),[2,new u.BufferViewVec4f(d.raw,d.byteOffset,d.byteStride,d.byteOffset+d.byteStride*d.entryCount)]}})})};a.prototype.getTextureCoordinates=function(a,b){return l(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found."),[4,this.getAccessor(a.attributes.TEXCOORD_0,b)];case 1:d=e.sent();c.errorUnsupportedIf(2!==d.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+
d.componentCount.toFixed());if(5126===d.componentType)return[2,this.wrapAccessor(u.BufferViewVec2f,d)];c.errorUnsupportedIf(!d.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return[2,m(d)]}})})};a.prototype.getVertexColors=function(a,b){return l(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.COLOR_0,"No COLOR_0 vertex data found."),[4,this.getAccessor(a.attributes.COLOR_0,
b)];case 1:d=e.sent();c.errorUnsupportedIf(4!==d.componentCount&&3!==d.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+d.componentCount.toFixed());if(4===d.componentCount){if(5126===d.componentType)return[2,this.wrapAccessor(u.BufferViewVec4f,d)];if(5121===d.componentType)return[2,this.wrapAccessor(u.BufferViewVec4u8,d)];if(5123===d.componentType)return[2,this.wrapAccessor(u.BufferViewVec4u16,d)]}else if(3===d.componentCount){if(5126===d.componentType)return[2,this.wrapAccessor(u.BufferViewVec3f,
d)];if(5121===d.componentType)return[2,this.wrapAccessor(u.BufferViewVec3u8,d)];if(5123===d.componentType)return[2,this.wrapAccessor(u.BufferViewVec3u16,d)]}c.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+J[d.componentType]);return[2,void 0]}})})};a.prototype.hasPositions=function(a){return void 0!==a.attributes.POSITION};a.prototype.hasNormals=function(a){return void 0!==a.attributes.NORMAL};a.prototype.hasVertexColors=function(a){return void 0!==a.attributes.COLOR_0};a.prototype.hasTextureCoordinates=
function(a){return void 0!==a.attributes.TEXCOORD_0};a.prototype.hasTangents=function(a){return void 0!==a.attributes.TANGENT};a.prototype.getMaterial=function(a,b){return l(this,void 0,void 0,function(){var c,d,e,f,g,h,m,p,q,r,l;return k(this,function(k){switch(k.label){case 0:c=this.errorContext;if(d=this.materialCache.get(a.material))return[3,15];e=null!=a.material?x.material(this.json.materials[a.material]):x.material();f=e.pbrMetallicRoughness;g=this.hasVertexColors(a);h=void 0;if(!f.baseColorTexture)return[3,
2];c.errorUnsupportedIf(0!==(f.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported.");return[4,this.getTexture(f.baseColorTexture.index,b)];case 1:h=k.sent(),k.label=2;case 2:m=void 0;if(!e.normalTexture)return[3,5];if(0===(e.normalTexture.texCoord||0))return[3,3];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture.");return[3,5];case 3:return[4,this.getTexture(e.normalTexture.index,b)];case 4:m=k.sent(),k.label=5;case 5:p=void 0;if(!e.occlusionTexture)return[3,
8];if(0===(e.occlusionTexture.texCoord||0))return[3,6];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture.");return[3,8];case 6:return[4,this.getTexture(e.occlusionTexture.index,b)];case 7:p=k.sent(),k.label=8;case 8:q=void 0;if(!e.emissiveTexture)return[3,11];if(0===(e.emissiveTexture.texCoord||0))return[3,9];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture.");return[3,11];case 9:return[4,this.getTexture(e.emissiveTexture.index,
b)];case 10:q=k.sent(),k.label=11;case 11:r=void 0;if(!f.metallicRoughnessTexture)return[3,14];if(0===(f.metallicRoughnessTexture.texCoord||0))return[3,12];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture.");return[3,14];case 12:return[4,this.getTexture(f.metallicRoughnessTexture.index,b)];case 13:r=k.sent(),k.label=14;case 14:l=null!=a.material?a.material:-1,d={alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,color:f.baseColorFactor,doubleSided:!!e.doubleSided,
colorTexture:h,normalTexture:m,name:e.name,id:l,occlusionTexture:p,emissiveTexture:q,emissiveFactor:e.emissiveFactor,metallicFactor:f.metallicFactor,roughnessFactor:f.roughnessFactor,metallicRoughnessTexture:r,vertexColors:g,ESRI_externalColorMixMode:e.extras.ESRI_externalColorMixMode},k.label=15;case 15:return[2,d]}})})};a.prototype.getTexture=function(a,b){return l(this,void 0,void 0,function(){var c,d,e,f,g,h,m,p;return k(this,function(k){switch(k.label){case 0:c=this.errorContext;d=this.json.textures[a];
e=x.textureSampler(null!=d.sampler?this.json.samplers[d.sampler]:{});c.errorUnsupportedIf(null==d.source,"Source is expected to be defined for a texture.");f=this.json.images[d.source];if(g=this.textureCache.get(a))return[3,6];h=void 0;return f.uri?[4,this.context.loadImage(this.resolveUri(f.uri),b)]:[3,2];case 1:return h=k.sent(),[3,5];case 2:return c.errorUnsupportedIf(null==f.bufferView,"Image bufferView must be defined."),c.errorUnsupportedIf(null==f.mimeType,"Image mimeType must be defined."),
m=this.json.bufferViews[f.bufferView],[4,this.getBuffer(m.buffer,b)];case 3:return p=k.sent(),c.errorUnsupportedIf(null!=m.byteStride,"byteStride not supported for image buffer"),[4,z(new Uint8Array(p.buffer,p.byteOffset+(m.byteOffset||0),m.byteLength),f.mimeType)];case 4:h=k.sent(),k.label=5;case 5:g={data:h,wrapS:e.wrapS,wrapT:e.wrapT,minFilter:e.minFilter,name:f.name,id:a},this.textureCache.set(a,g),k.label=6;case 6:return[2,g]}})})};a.prototype.getNodeTransform=function(a){if(void 0===a)return D;
var b=this.nodeTransformCache.get(a);if(!b){var b=this.getNodeTransform(this.getNodeParent(a)),d=this.json.nodes[a];if(d.matrix)b=c.mat4.multiply(q.mat4f64.create(),b,d.matrix);else if(d.translation||d.rotation||d.scale)b=q.mat4f64.clone(b),d.translation&&c.mat4.translate(b,b,d.translation),d.rotation&&(K[3]=p.quat.getAxisAngle(K,d.rotation),c.mat4.rotate(b,b,K[3],K)),d.scale&&c.mat4.scale(b,b,d.scale);this.nodeTransformCache.set(a,b)}return b};a.prototype.wrapAccessor=function(a,b){return new a(b.raw,
b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*(b.entryCount-1)+b.componentByteSize*b.componentCount)};a.prototype.resolveUri=function(a){return d.makeAbsolute(a,this.baseUri)};a.prototype.getNodeParent=function(a){return this.nodeParentMap.get(a)};a.prototype.checkVersionSupported=function(){var a=f.Version.parse(this.json.asset.version,"glTF");C.validate(a)};a.prototype.checkRequiredExtensionsSupported=function(){var a=this.json,b=this.errorContext;a.extensionsRequired&&0!==a.extensionsRequired.length&&
b.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+a.extensionsRequired.join(", "))};a.prototype.computeNodeParents=function(){var a=this;this.json.nodes.forEach(function(b,c){b.children&&b.children.forEach(function(b){a.nodeParentMap.set(b,c)})})};return a}();b.Resource=n;var C=new f.Version(2,0,"glTF"),D=c.mat4.fromXRotation(q.mat4f64.create(),Math.PI/2),K=r.quatf64.create(),I={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Q=(B={},B[5120]=1,B[5121]=1,B[5122]=2,B[5123]=
2,B[5126]=4,B[5125]=4,B),J={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}})},"esri/core/Version":function(){define(["require","exports","./Error"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a,g){void 0===g&&(g="");this.major=b;this.minor=a;this._context=g}b.prototype.lessThan=function(b,a){return this.major<b||b===this.major&&this.minor<a};b.prototype.since=function(b,a){return!this.lessThan(b,
a)};b.prototype.validate=function(b){if(this.major!==b.major)throw new l((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:b});};b.prototype.clone=function(){return new b(this.major,this.minor,this._context)};b.parse=function(h,a){void 0===a&&(a="");var g=h.split("."),e=g[0],g=g[1],d=/^\s*\d+\s*$/;if(!e||!e.match||!e.match(d))throw new l((a&&a+":")+"invalid-version",
"Expected major version to be a number, but got '${version}'",{version:h});if(!g||!g.match||!g.match(d))throw new l((a&&a+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:h});h=parseInt(e,10);e=parseInt(g,10);return new b(h,e,a)};return b}();b.Version=n})},"esri/core/libs/gl-matrix-2/quat":function(){define(["require","exports","./math/quat"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.quat=l})},"esri/core/libs/gl-matrix-2/math/quat":function(){define("require exports ../factories/mat3f64 ../factories/quatf64 ../factories/vec3f64 ./common ./vec3 ./vec4".split(" "),
function(n,b,l,k,h,a,g,e){function d(a,b,c){c*=.5;var d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c);return a}function f(a,b,c){var d=b[0],e=b[1],f=b[2];b=b[3];var g=c[0],h=c[1],k=c[2];c=c[3];a[0]=d*c+b*g+e*k-f*h;a[1]=e*c+b*h+f*g-d*k;a[2]=f*c+b*k+d*h-e*g;a[3]=b*c-d*g-e*h-f*k;return a}function c(b,c,d,e){var f=c[0],g=c[1],h=c[2];c=c[3];var k=d[0],m=d[1],p=d[2];d=d[3];var q,r,l;r=f*k+g*m+h*p+c*d;0>r&&(r=-r,k=-k,m=-m,p=-p,d=-d);1-r>a.EPSILON?(q=Math.acos(r),l=Math.sin(q),r=Math.sin((1-
e)*q)/l,e=Math.sin(e*q)/l):r=1-e;b[0]=r*f+e*k;b[1]=r*g+e*m;b[2]=r*h+e*p;b[3]=r*c+e*d;return b}function q(a,b){var c=b[0]+b[4]+b[8];if(0<c)c=Math.sqrt(c+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var d=0;b[4]>b[0]&&(d=1);b[8]>b[3*d+d]&&(d=2);var e=(d+1)%3,f=(d+2)%3,c=Math.sqrt(b[3*d+d]-b[3*e+e]-b[3*f+f]+1);a[d]=.5*c;c=.5/c;a[3]=(b[3*e+f]-b[3*f+e])*c;a[e]=(b[3*e+d]+b[3*d+e])*c;a[f]=(b[3*f+d]+b[3*d+f])*c}return a}Object.defineProperty(b,"__esModule",{value:!0});
b.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};b.setAxisAngle=d;b.getAxisAngle=function(b,c){var d=2*Math.acos(c[3]),e=Math.sin(d/2);e>a.EPSILON?(b[0]=c[0]/e,b[1]=c[1]/e,b[2]=c[2]/e):(b[0]=1,b[1]=0,b[2]=0);return d};b.multiply=f;b.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+b*g;a[1]=e*c+f*g;a[2]=f*c-e*g;a[3]=b*c-d*g;return a};b.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=
d*c-f*g;a[1]=e*c+b*g;a[2]=f*c+d*g;a[3]=b*c-e*g;return a};b.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+e*g;a[1]=e*c-d*g;a[2]=f*c+b*g;a[3]=b*c-f*g;return a};b.calculateW=function(a,b){var c=b[0],d=b[1];b=b[2];a[0]=c;a[1]=d;a[2]=b;a[3]=Math.sqrt(Math.abs(1-c*c-d*d-b*b));return a};b.slerp=c;b.random=function(b){var c=a.RANDOM(),d=a.RANDOM(),e=a.RANDOM(),f=Math.sqrt(1-c),c=Math.sqrt(c);b[0]=f*Math.sin(2*Math.PI*d);b[1]=f*Math.cos(2*Math.PI*d);
b[2]=c*Math.sin(2*Math.PI*e);b[3]=c*Math.cos(2*Math.PI*e);return b};b.invert=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=c*c+d*d+e*e+b*b,f=f?1/f:0;a[0]=-c*f;a[1]=-d*f;a[2]=-e*f;a[3]=b*f;return a};b.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};b.fromMat3=q;b.fromEuler=function(a,b,c,d){var e=.5*Math.PI/180;b*=e;c*=e;d*=e;e=Math.sin(b);b=Math.cos(b);var f=Math.sin(c);c=Math.cos(c);var g=Math.sin(d);d=Math.cos(d);a[0]=e*c*d-b*f*g;a[1]=b*f*d+e*c*g;a[2]=b*c*g-e*
f*d;a[3]=b*c*d+e*f*g;return a};b.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.copy=e.copy;b.set=e.set;b.add=e.add;b.mul=f;b.scale=e.scale;b.dot=e.dot;b.lerp=e.lerp;b.length=e.length;b.len=b.length;b.squaredLength=e.squaredLength;b.sqrLen=b.squaredLength;b.normalize=e.normalize;b.exactEquals=e.exactEquals;b.equals=e.equals;b.rotationTo=function(a,c,e){var f=g.dot(c,e);if(-.999999>f)return g.cross(p,r,c),1E-6>g.len(p)&&g.cross(p,t,c),g.normalize(p,p),d(a,p,Math.PI),a;if(.999999<
f)return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a;g.cross(p,c,e);a[0]=p[0];a[1]=p[1];a[2]=p[2];a[3]=1+f;return b.normalize(a,a)};var p=h.create(),r=h.fromValues(1,0,0),t=h.fromValues(0,1,0);b.sqlerp=function(a,b,d,e,f,g){c(x,b,f,g);c(w,d,e,g);c(a,x,w,2*g*(1-g));return a};var x=k.create(),w=k.create();b.setAxes=function(a,c,d,e){var f=u;f[0]=d[0];f[3]=d[1];f[6]=d[2];f[1]=e[0];f[4]=e[1];f[7]=e[2];f[2]=-c[0];f[5]=-c[1];f[8]=-c[2];return b.normalize(a,q(a,f))};var u=l.create()})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.data=b;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}b.prototype.readUint32=function(){var b=this.offset4;this.offset4+=1;return this.dataUint32[b]};b.prototype.readUint8Array=function(b){var h=4*this.offset4;this.offset4+=b/4;return new Uint8Array(this.data,h,b)};b.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4};
return b}();b.BinaryStreamReader=n})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});var k={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},h={pbrMetallicRoughness:k,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},a={ESRI_externalColorMixMode:"tint"};b.material=function(b){void 0===b&&(b={});var d=l({},k,b.pbrMetallicRoughness),
e=l({},a,b.extras);switch(e.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":break;default:e.ESRI_externalColorMixMode="tint"}return l({},h,b,{pbrMetallicRoughness:d,extras:e})};var g={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};b.textureSampler=function(a){return l({},g,a)}})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.splitURI=function(b){var k,h;b.replace(/^(.*\/)?([^/]*)$/,
function(a,b,e){k=b||"";h=e||"";return""});return{dirPart:k,filePart:h}}})},"esri/views/3d/support/buffer/utils":function(){define("require exports ./types ./utils/mat3 ./utils/mat4 ./utils/scalar ./utils/vec2 ./utils/vec3 ./utils/vec4".split(" "),function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});b.mat3=k;b.mat4=h;b.scalar=a;b.vec2=g;b.vec3=e;b.vec4=d;b.createBuffer=function(a,b){return new a(new ArrayBuffer(b*a.ElementCount*l.elementTypeSize(a.ElementType)))}})},"esri/views/3d/support/buffer/utils/mat3":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,k,h){var a=b.typedBuffer;b=b.typedBufferStride;var g=k.typedBuffer,e=k.typedBufferStride;k=h?h.count:k.count;var d=(h&&h.dstIndex?h.dstIndex:0)*b;h=(h&&h.srcIndex?h.srcIndex:0)*e;for(var f=0;f<k;++f){for(var c=0;9>c;++c)a[d+c]=g[h+c];d+=b;h+=e}}})},"esri/views/3d/support/buffer/utils/mat4":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,
k,h){var a=b.typedBuffer;b=b.typedBufferStride;var g=k.typedBuffer,e=k.typedBufferStride;k=h?h.count:k.count;var d=(h&&h.dstIndex?h.dstIndex:0)*b;h=(h&&h.srcIndex?h.srcIndex:0)*e;for(var f=0;f<k;++f){for(var c=0;16>c;++c)a[d+c]=g[h+c];d+=b;h+=e}}})},"esri/views/3d/support/buffer/utils/scalar":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,k,h){var a=b.typedBuffer;b=b.typedBufferStride;var g=k.typedBuffer,e=k.typedBufferStride;
k=h?h.count:k.count;var d=(h&&h.dstIndex?h.dstIndex:0)*b;h=(h&&h.srcIndex?h.srcIndex:0)*e;for(var f=0;f<k;++f)a[d]=g[h],d+=b,h+=e};b.makeDense=function(b,k){var h=b.count;k||(k=new b.TypedArrayConstructor(h));for(var a=0;a<h;a++)k[a]=b.get(a);return k}})},"esri/views/3d/support/buffer/utils/vec2":function(){define(["require","exports","../types"],function(n,b,l){function k(b,a,g){var e=b.typedBuffer;b=b.typedBufferStride;var d=a.typedBuffer,f=a.typedBufferStride;a=g?g.count:a.count;var c=(g&&g.dstIndex?
g.dstIndex:0)*b;g=(g&&g.srcIndex?g.srcIndex:0)*f;for(var h=0;h<a;++h)e[c]=d[g],e[c+1]=d[g+1],c+=b,g+=f}Object.defineProperty(b,"__esModule",{value:!0});b.copy=k;b.normalizeIntegerBuffer=function(b,a,g){var e=b.typedBuffer,d=b.typedBufferStride,f=a.typedBuffer,c=a.typedBufferStride,h=g?g.count:a.count,p=(g&&g.dstIndex?g.dstIndex:0)*d,r=(g&&g.srcIndex?g.srcIndex:0)*c;if(l.isInteger(a.elementType))if(g=l.maximumValue(a.elementType),l.isSigned(a.elementType))for(a=0;a<h;++a)e[p]=Math.max(f[r]/g,-1),e[p+
1]=Math.max(f[r+1]/g,-1),p+=d,r+=c;else for(a=0;a<h;++a)e[p]=f[r]/g,e[p+1]=f[r+1]/g,p+=d,r+=c;else k(b,a,g);return b}})},"esri/views/3d/support/buffer/utils/vec3":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,k,h){var a=b.typedBuffer;b=b.typedBufferStride;var g=k.typedBuffer,e=k.typedBufferStride;k=h?h.count:k.count;var d=(h&&h.dstIndex?h.dstIndex:0)*b;h=(h&&h.srcIndex?h.srcIndex:0)*e;for(var f=0;f<k;++f)a[d]=g[h],a[d+1]=g[h+
1],a[d+2]=g[h+2],d+=b,h+=e}})},"esri/views/3d/support/buffer/utils/vec4":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,k,h){var a=b.typedBuffer;b=b.typedBufferStride;var g=k.typedBuffer,e=k.typedBufferStride;k=h?h.count:k.count;var d=(h&&h.dstIndex?h.dstIndex:0)*b;h=(h&&h.srcIndex?h.srcIndex:0)*e;for(var f=0;f<k;++f)a[d]=g[h],a[d+1]=g[h+1],a[d+2]=g[h+2],a[d+3]=g[h+3],d+=b,h+=e};b.fill=function(b,k,h,a,g,e){var d=b.typedBuffer,
f=b.typedBufferStride;b=e?e.count:b.count;e=(e&&e.dstIndex?e.dstIndex:0)*f;for(var c=0;c<b;++c)d[e]=k,d[e+1]=h,d[e+2]=a,d[e+3]=g,e+=f}})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["require","exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(n,b,l,k){function h(a){return k.generateDefaultIndexArray(a)}Object.defineProperty(b,"__esModule",{value:!0});b.linearIndexArray=h;b.trianglesToTriangles=function(a){return"number"===typeof a?h(a):
l.isUint16Array(a)||l.isUint8Array(a)?new Uint32Array(a):a};b.triangleStripToTriangles=function(a){var b="number"===typeof a?a:a.length;if(3>b)return new Uint32Array(0);var b=b-2,e=new Uint32Array(3*b);if("number"===typeof a)for(var d=0,f=0;f<b;f+=1)0===f%2?(e[d++]=f,e[d++]=f+1):(e[d++]=f+1,e[d++]=f),e[d++]=f+2;else for(f=d=0;f<b;f+=1){if(0===f%2)var c=a[f],h=a[f+1],k=a[f+2];else c=a[f+1],h=a[f],k=a[f+2];e[d++]=c;e[d++]=h;e[d++]=k}return e};b.triangleFanToTriangles=function(a){var b="number"===typeof a?
a:a.length;if(3>b)return new Uint32Array(0);var b=b-2,e=new Uint32Array(3*b);if("number"===typeof a){for(var d=0,f=0;f<b;++f)e[d++]=0,e[d++]=f+1,e[d++]=f+2;return e}for(var c=a[0],h=a[1],f=d=0;f<b;++f){var k=a[f+2];e[d++]=c;e[d++]=h;h=e[d++]=k}return e}})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/lang ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../support/imageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m){function v(b,d){return h(this,void 0,void 0,function(){var e,f;return k(this,function(h){switch(h.label){case 0:return(e=c.isSome(d)&&d.streamDataRequester)?[2,z(b,e,d)]:[4,g.result(a(b,c.unwrap(d)))];case 1:f=h.sent();if(!0===f.ok)return[2,f.value.data];q.throwIfAbortError(f.error);B(f.error);return[2,void 0]}})})}function z(a,b,c){return h(this,void 0,void 0,function(){var d;return k(this,function(e){switch(e.label){case 0:return[4,g.result(b.request(a,
"json",c))];case 1:d=e.sent();if(!0===d.ok)return[2,d.value];q.throwIfAbortError(d.error);B(d.error.details.url);return[2,void 0]}})})}function B(a){throw new e("","Request for object resource failed: "+a);}function C(a,b){return h(this,void 0,void 0,function(){var e,f,g,h,q,l,v,t,y,x,z,n,B,L,C,N,oa,va,fa,xa,ia,na,wa,Ca,ua,ya,G,Ea,za,H,qa,sa,W,ga,Pa;return k(this,function(k){switch(k.label){case 0:return g=[],h=[],q=[],l=[],v=p.Version.parse(a.version||"1.0","wosr"),J.validate(v),t="meshsymbol_"+
a.model.name,y=a.textureDefinitions,[4,K(t,y,b)];case 1:x=k.sent();for(z in x)l.push(x[z].engineTexObj);n=a.model.geometries;B=a.materialDefinitions;for(C=L=0;C<n.length;C++){var M=N=n[C],R=M.params,S=R.topology;k=!0;R.vertexAttributes||(Q.warn("Geometry must specify vertex attributes"),k=!1);switch(R.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:S=R.faces;if(!S)Q.warn("Indexed geometries must specify faces"),k=!1;else if(R.vertexAttributes){var T=void 0;for(T in R.vertexAttributes)(R=
S[T])&&R.values?(null!=R.valueType&&"UInt32"!==R.valueType&&(Q.warn("Unsupported indexed geometry indices type '"+R.valueType+"', only UInt32 is currently supported"),k=!1),null!=R.valuesPerElement&&1!==R.valuesPerElement&&(Q.warn("Unsupported indexed geometry values per element '"+R.valuesPerElement+"', only 1 is currently supported"),k=!1)):(Q.warn("Indexed geometry does not specify face indices for '"+T+"' attribute"),k=!1)}break;default:Q.warn("Unsupported topology '"+S+"'"),k=!1}M.params.material||
(Q.warn("Geometry requires material"),k=!1);M=M.params.vertexAttributes;R=void 0;for(R in M)M[R].values||(Q.warn("Geometries with externally defined attributes are not yet supported"),k=!1);if(k){k=N.params;e=k.material;f=k.texture;oa=N.params.vertexAttributes;va={};for(fa in oa)xa=oa[fa],ia=xa.values,va[fa]={data:ia,size:xa.valuesPerElement};na={};if("PerAttributeArray"===N.params.topology){k=wa=va.position.data.length/va.position.size;M=new Uint32Array(k);for(R=0;R<k;R++)M[R]=R;Ca=M;for(ua in va)na[ua]=
Ca}else for(G in ya=N.params.faces,ya)na[G]=new Uint32Array(ya[G].values);Ea=f?x[f]:null;za=q[e]?q[e][f]:null;za||(H=e.substring(e.lastIndexOf("/")+1),qa=B[H].params,1===qa.transparency&&(qa.transparency=0),sa=Ea&&Ea.alphaChannelUsage,W=0<qa.transparency||"transparency"===sa||"maskAndTransparency"===sa,ga={ambient:r.vec3f64.fromArray(qa.diffuse),diffuse:r.vec3f64.fromArray(qa.diffuse),specular:[0,0,0],opacity:1-(qa.transparency||0),transparent:W,textureAlphaMode:Ea?I(Ea.alphaChannelUsage):void 0,
textureAlphaCutoff:.33,textureId:Ea?Ea.engineTexObj.id:void 0,textureInitTransparent:!0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:qa.externalColorMixMode||"tint",textureAlphaPremultiplied:!0},c.isSome(b)&&b.materialParamsMixin&&d.mixin(ga,b.materialParamsMixin),za=new m(ga,t),q[e]||(q[e]={}),q[e][f]=za);h.push(za);Pa=new w(new u.GeometryData(va,na),t);L+=na.position?na.position.length:0;g.push(Pa)}}return[2,{name:t,stageResources:{textures:l,materials:h,geometries:g},pivotOffset:a.model.pivotOffset,
boundingBox:D(g),numberOfVertices:L,lodThreshold:null}]}})})}function D(a){var b=t.empty();a.forEach(function(a){a=a.boundingInfo;t.expand(b,a.getBBMin());t.expand(b,a.getBBMax())});return b}function K(a,b,d){return h(this,void 0,void 0,function(){var e,f,g,h,m,p,r,l;return k(this,function(k){switch(k.label){case 0:e=[];f=function(f){var g=b[f],h=g.images[0].data;if(!h)return Q.warn("Externally referenced texture data is not yet supported"),"continue";var h=g.encoding+";base64,"+h,k="/textureDefinitions/"+
f,m={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0};f=c.isSome(d)&&d.disableTextures?q.resolve(null):x.requestImage(h,d);e.push(f.then(function(b){return{refId:k,engineTexObj:new y(b,a,m),alphaChannelUsage:"rgba"===g.channels?g.alphaChannelUsage||"transparency":"none"}}))};for(g in b)f(g);return[4,q.all(e)];case 1:h=k.sent();m={};p=0;for(r=h;p<r.length;p++)l=r[p],m[l.refId]=l;return[2,m]}})})}function I(a){switch(a){case "mask":return"mask";case "maskAndTransparency":return"maskBlend";
case "none":return"opaque";case "transparency":return"blend";default:return"blend"}}Object.defineProperty(b,"__esModule",{value:!0});var Q=f.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");b.load=function(a,b){return h(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return[4,v(a,b)];case 1:return c=d.sent(),[2,C(c,b)]}})})};b.createStageResources=C;var J=new p.Version(1,2,"wosr")})},"esri/views/3d/support/buffer/math":function(){define(["require",
"exports","./math/vec3","./math/vec4"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.vec3=l;b.vec4=k})},"esri/views/3d/support/buffer/math/vec4":function(){define(["require","exports","./common"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.transformMat4=function(b,h,a){if(b.count!==h.count)l.logger.error("source and destination buffers need to have the same number of elements");else{var g=b.count,e=a[0],d=a[1],f=a[2],c=a[3],k=a[4],p=a[5],r=a[6],t=a[7],
x=a[8],w=a[9],u=a[10],y=a[11],m=a[12],v=a[13],z=a[14];a=a[15];var n=b.typedBuffer;b=b.typedBufferStride;var C=h.typedBuffer;h=h.typedBufferStride;for(var D=0;D<g;D++){var K=D*b,I=D*h,Q=C[I],J=C[I+1],N=C[I+2],I=C[I+3];n[K]=e*Q+k*J+x*N+m*I;n[K+1]=d*Q+p*J+w*N+v*I;n[K+2]=f*Q+r*J+u*N+z*I;n[K+3]=c*Q+t*J+y*N+a*I}}};b.transformMat3=function(b,h,a){if(b.count!==h.count)l.logger.error("source and destination buffers need to have the same number of elements");else{var g=b.count,e=a[0],d=a[1],f=a[2],c=a[3],k=
a[4],p=a[5],r=a[6],t=a[7];a=a[8];var x=b.typedBuffer;b=b.typedBufferStride;var w=h.typedBuffer;h=h.typedBufferStride;for(var u=0;u<g;u++){var y=u*b,m=u*h,v=w[m],z=w[m+1],n=w[m+2],m=w[m+3];x[y]=e*v+c*z+r*n;x[y+1]=d*v+k*z+t*n;x[y+2]=f*v+p*z+a*n;x[y+3]=m}}};b.scale=function(b,h,a){var g=Math.min(b.count,h.count),e=b.typedBuffer;b=b.typedBufferStride;var d=h.typedBuffer;h=h.typedBufferStride;for(var f=0;f<g;f++){var c=f*b,k=f*h;e[c]=a*d[k];e[c+1]=a*d[k+1];e[c+2]=a*d[k+2];e[c+3]=a*d[k+3]}}})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../../../geometry/support/aaBoundingBox ../../../support/debugFlags ../../../support/buffer/glUtil ../Camera ../DefaultVertexAttributeLocations ../intersectorUtils ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ./utils ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C){function D(a,b,c,d){y.encodeDoubleVec3(a.modelOrigin,b,c.modelOriginHi,c.modelOriginLo,d);c.model.copyFrom(d,a.model,b);c.modelNormal.copyFrom(d,a.modelNormal,b);a.color&&c.color&&c.color.copyFrom(d,a.color,b);a.featureAttribute&&c.featureAttribute&&c.featureAttribute.copyFrom(d,a.featureAttribute,b)}Object.defineProperty(b,"__esModule",{value:!0});var K=function(a){var b=a.baseBoundingSphere.radius;a=a.levels.map(function(a){return a.minScreenSpaceRadius});
return new w.LevelSelector(b,a)};b.setLevelSelectorFactory=function(a){K=a};var I=function(){function a(a,b){this.glMaterials={};var c=a.rctx,d=b.geometry;b=b.material;var e=d.data.toRenderData();this.materialRep=a.materialRep;b.setParameterValues({instancedDoublePrecision:!0});a=b.createBufferWriter();var g=a.vertexBufferLayout,h=a.elementCount(e),k=a.allocate(h);a.write({},e,k,0);this.geometry=d;this.material=b;this.glMaterials=y.acquireGLMaterials(b,this.materialRep);this.vertexBufferLayout=g;
this.vbo=z.createVertex(c,35044,k.buffer);this.vao=new C(c,q.Default3D,{geometry:f.glLayout(g)},{geometry:this.vbo});this.vertexCount=h}a.prototype.destroy=function(){y.releaseGLMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(a.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0});
a.prototype.intersect=function(a,b,c,d,e,f){var g=this.geometry.id,h=e.toString();this.material.intersect(this.geometry,null,a.transform.transform,a,c,d,function(c,d,k,m,q,r){if(0<=c&&(null==b||b(a.rayBeginPoint,a.rayEndPoint,c))){q={type:"external",metadata:{layerUid:f.layerUid,graphicUid:f.graphicUid(e)}};if(null==a.results.min.drapedLayerOrder||m>=a.results.min.drapedLayerOrder)if(null==a.results.min.dist||c<a.results.min.dist)a.results.min.set(q,h,c,d,a.transform.transform,m,null,g,k),a.results.min.intersector=
"LodRenderer";if(null==a.results.max.drapedLayerOrder||m>=a.results.max.drapedLayerOrder)if(null==a.results.max.dist||c>a.results.max.dist)a.results.max.set(q,h,c,d,a.transform.transform,m,null,g,k),a.results.min.intersector="LodRenderer";a.enable.storeAll&&(r=new p.IntersectorResult(a.results.min.ray),r.set(q,h,c,d,a.transform.transform,m,null,g,k),r.intersector="LodRenderer",a.results.all.push(r))}},null)};return a}();b.LodComponentData=I;var Q=function(){function b(a,b){var c=this;this.components=
[];this.minScreenSpaceRadius=b.minScreenSpaceRadius;b.components.forEach(function(b){c.components.push(new I(a,b))})}b.prototype.destroy=function(){this.components.forEach(function(a){a.destroy()})};b.prototype.intersect=function(a,b,c,d,e,f){this.components.forEach(function(g){g.intersect(a,b,c,d,e,f)})};Object.defineProperty(b.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var a=e.empty();this.components.forEach(function(b){e.expand(a,b.boundingInfo.bbMin);e.expand(a,b.boundingInfo.bbMax)});
this._boundingBox=a}return this._boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var b=this.boundingBox,c=a.vec3f64.create();e.center(b,c);this._boundingSphere={center:c,radius:.5*e.diameter(b)}}return this._boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"triangleCount",{get:function(){return this.components.reduce(function(a,b){return a+b.triangleCount},0)},enumerable:!0,configurable:!0});
return b}();b.LodLevelData=Q;n=function(){function e(a,d,e,g){var h=this;this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlaneEnabled=!1;this._enableLevelSelection=!0;this._lastCamera=new c.default;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.canRender=!0;this._symbol=a;this._optionalFields=d;this._metadata=e;this._instanceBufferLayout=m.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:d});this._glInstanceBufferLayout=
f.glLayout(this._instanceBufferLayout,{divisor:1});this._instanceData=new t.InstanceData(this._optionalFields,g);this._instanceData.on("instance-added",function(a){h.requestUpdateCycle()});this._instanceData.on("instance-removed",function(a){h.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",function(a){h.requestUpdateCycle()});this._instanceData.on("instance-visibility-changed",function(a){h.requestUpdateCycle(!0)});this._instanceData.on("instance-highlight-changed",function(a){h.requestUpdateCycle(!0)});
this._enableLevelSelection=1<this._symbol.levels.length;b.lodRenderers.push(this)}e.prototype.destroy=function(){b.lodRenderers.splice(b.lodRenderers.indexOf(this),1)};Object.defineProperty(e.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"baseBoundingBox",{get:function(){return this._levels[this._levels.length-1].boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-
1].boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-1].components[0].material},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled=a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"intersectionHandlerId",{get:function(){return this._metadata.layerUid},enumerable:!0,
configurable:!0});Object.defineProperty(e.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"memoryUsage",{get:function(){var a={cpu:0,gpu:0};this._renderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});this._highlightRenderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});return a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"renderStats",
{get:function(){var a=this,b=this._instanceData.size,c=[];this._levels.forEach(function(b,d){d=a._renderInstanceData[d].size+a._highlightRenderInstanceData[d].size;b=b.triangleCount;c.push({renderedInstances:d,renderedTriangles:d*b,trianglesPerInstance:b})});return{totalInstances:b,renderedInstances:c.reduce(function(a,b){return a+b.renderedInstances},0),renderedTriangles:c.reduce(function(a,b){return a+b.renderedTriangles},0),levels:c}},enumerable:!0,configurable:!0});e.prototype.initializeRenderContext=
function(a){var b=this;this._initContext=a;var c=a.rctx;this._symbol.levels.forEach(function(d){b._levels.push(new Q(a,d));b._renderInstanceData.push(new u.RenderInstanceData(c,b._instanceBufferLayout));b._highlightRenderInstanceData.push(new u.RenderInstanceData(c,b._instanceBufferLayout))});this._levelSelector=K(this)};e.prototype.uninitializeRenderContext=function(a){this.invalidateOctree();this._levels.forEach(function(a){a.destroy()});this._renderInstanceData.forEach(function(a){a.destroy()});
this._highlightRenderInstanceData.forEach(function(a){a.destroy()})};Object.defineProperty(e.prototype,"slots",{get:function(){return[6,8]},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(a,b){return a+b.size},0)},enumerable:!0,configurable:!0});e.prototype.prepareRender=function(a){this.runUpdates(a)};e.prototype.render=function(a){var b=a.rctx,c=6===a.slot?5:8===a.slot?7:null;if(c){if(!this.baseMaterial.isVisible()||
!this.baseMaterial.isVisibleInPass(a.pass))return!1;var d=a.camera,d={view:d.viewMatrix,proj:d.projectionMatrix,origin:[0,0,0],viewInvTransp:d.viewInverseTransposeMatrix,viewport:d.viewport,fovY:d.fovY,nearFar:[d.near,d.far],shadowMap:a.shadowMap,shadowMappingEnabled:!!a.shadowMap&&a.shadowMap.enabled,ssaoEnabled:!!a.ssaoHelper&&a.ssaoHelper.enabled,pixelRatio:d.pixelRatio,slicePlane:a.sliceHelper&&a.sliceHelper.plane,cameraAboveGround:d.aboveGround,hudVisibilityTexture:a.offscreenRenderingHelper?
a.offscreenRenderingHelper.hudVisibilityTexture:null};b.bindVAO();for(b=0;b<this._levels.length;++b)this.renderLevel(a,c,d,a.isHighlightPass?this._highlightRenderInstanceData[b]:this._renderInstanceData[b],b);return!0}};e.prototype.intersect=function(b,c,d,e,f){var g=this;if(this.baseMaterial.isVisible()){f=a.vec3f64.create();h.vec3.subtract(f,e,d);var k=function(a){g._instanceData.getCombinedModelTransform(a,L);b.transform.set(L);h.vec3.transformMat4(M,d,b.transform.inverse);h.vec3.transformMat4(R,
e,b.transform.inverse);var f=g._instanceData.getState(a),k=g._instanceData.getLodLevel(a);r.assert(f&t.StateFlags.ACTIVE,"invalid instance state");r.assert(0<=k&&k<g._levels.length,"invaid lod level");g._levels[k].intersect(b,c,M,R,a,g._metadata)};this.baseMaterial.getParameters().verticalOffset?this.octree.forEach(k):this.octree.forEachAlongRay(d,f,k)}};e.prototype.queryDepthRange=function(a){return this.queryDepthRangeOctree(a)};e.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()};
e.prototype.requestUpdateCycle=function(a){void 0===a&&(a=!1);this._updateCyclesWithStaticCamera=-1;a&&(this._needFullCycle=!0);this.needsUpdates&&this._initContext.requestRender()};Object.defineProperty(e.prototype,"needsUpdates",{get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera},enumerable:!0,configurable:!0});e.prototype.runUpdates=function(a){if(!d.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var b=a.equals(this._lastCamera);this._lastCamera.copyFrom(a);
b||this.requestUpdateCycle()}b=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(a,b);this.needsUpdates&&this._initContext.requestRender()}};Object.defineProperty(e.prototype,"octree",{get:function(){this._octree||(this._octree=this.buildOctree());return this._octree},enumerable:!0,configurable:!0});e.prototype.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};e.prototype.buildOctree=function(){for(var a=new x.InstanceOctree(this._instanceData,
this.baseBoundingSphere),b=this._instanceData,b=b.view?b.view.state:null,c=0;c<this._instanceData.capacity;++c)b.get(c)&t.StateFlags.ACTIVE&&a.addInstance(c);return a};e.prototype.queryDepthRangeOctree=function(a){var b=a.eye,c=a.viewForward,d=this.octree.findClosest(c,"front-to-back",a.frustum),e=this.octree.findClosest(c,"back-to-front",a.frustum);return null!=d&&null!=e?(this._instanceData.view.boundingSphere.getVec(d,N),h.vec3.subtract(N,N,b),d=h.vec3.dot(N,c)-N[3],this._instanceData.view.boundingSphere.getVec(e,
N),h.vec3.subtract(N,N,b),b=h.vec3.dot(N,c)+N[3],{near:Math.max(a.near,d),far:Math.min(a.far,b)}):{near:Infinity,far:-Infinity}};e.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._renderInstanceData.forEach(function(a){a.startUpdateCylce()});this._highlightRenderInstanceData.forEach(function(a){a.startUpdateCylce()});this.needsUpdates&&this._initContext.requestRender()};e.prototype.updateInstances=function(a,b){var c=this._enableLevelSelection,d=this._levelSelector;
d.updateCamera(a);this._renderInstanceData.forEach(function(a){a.beginUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.beginUpdate()});a=this._instanceData;var e=this._instanceData.view,f=a.capacity,g=this._instanceIndex;b=Math.min(a.size,b);for(var h=0;h<b;++h){0===g&&this.startUpdateCycle();var k=e.state.get(g),m=0;if(k&t.StateFlags.ALLOCATED){var p=e.lodLevel.get(g);k&t.StateFlags.ACTIVE&&this._renderInstanceData[p].freeTail();k&t.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[p].freeTail();
if(k&t.StateFlags.REMOVE)a.freeInstance(g);else if(k&t.StateFlags.VISIBLE){p=0;c&&(e.modelOrigin.getVec(g,J),p=d.selectLevel(J,a.getCombinedMedianScaleFactor(g)));m=k&~(t.StateFlags.ACTIVE|t.StateFlags.HIGHLIGHT_ACTIVE|t.StateFlags.TRANSFORM_CHANGED);if(0<=p){var q=this._renderInstanceData[p],r=q.allocateHead();D(e,g,q.view,r);m|=t.StateFlags.ACTIVE;k&t.StateFlags.HIGHLIGHT&&(q=this._highlightRenderInstanceData[p],r=q.allocateHead(),D(e,g,q.view,r),m|=t.StateFlags.HIGHLIGHT_ACTIVE)}e.state.set(g,
m);e.lodLevel.set(g,p)}else m=k&~(t.StateFlags.ACTIVE|t.StateFlags.HIGHLIGHT_ACTIVE|t.StateFlags.TRANSFORM_CHANGED),e.state.set(g,m);this._octree&&(p=!!(k&t.StateFlags.ACTIVE),m=!!(m&t.StateFlags.ACTIVE),!p&&m?this._octree.addInstance(g):p&&!m?this._octree.removeInstance(g):p&&m&&k&t.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(g),this._octree.addInstance(g)));g=(g+1)%f}else g=(g+1)%f,b++}this._instanceIndex=g;this._renderInstanceData.forEach(function(a){a.endUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.endUpdate()})};
e.prototype.renderLevel=function(a,b,c,d,e){var f=this;this._levels[e].components.forEach(function(g){f.renderComponent(a,b,c,d,g,e)})};e.prototype.renderComponent=function(a,b,c,e,f,g){var h=f.glMaterials[a.pass];if(h&&h.beginSlot(b)&&h.isVisible()&&h.isVisibleInPass(a.pass)&&0!==e.size){var k=a.rctx,m=k.capabilities.instancing,p=h.getDrawMode();c.origin=[0,0,0];h.bind(k,c);k.bindVAO(f.vao);b=h.getProgram();B.assertCompatibleVertexAttributeLocations(f.vao,b);a.isHighlightPass&&(k.bindTexture(a.offscreenRenderingHelper?
a.offscreenRenderingHelper.depthTexture:null,5),b.setUniform1i("depthTex",5),b.setUniform4f("highlightViewportPixelSz",0,0,1/c.viewport[2],1/c.viewport[3]));h.bindView(k,c);d.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===a.pass&&(b.setUniform4fv("externalColor",S[Math.min(g,S.length-1)]),b.setUniform1i("colorMixMode",v.colorMixModes.replace));a=e.capacity;g=e.headIndex;b=e.tailIndex;var l=e.firstIndex,u=this._glInstanceBufferLayout,t=function(a,b){B.bindVertexBufferLayout(k,q.Default3D,e.buffer,u,
a);m.drawArraysInstanced(p,0,f.vertexCount,b-a);B.unbindVertexBufferLayout(k,q.Default3D,e.buffer,u)};f.material.getParameters().transparent&&null!=l?g>b?(r.assert(l>=b&&l<=g,"invalid firstIndex"),t(l,g),t(b,l)):g<b&&(l<=g?(r.assert(0<=l&&l<=g,"invalid firstIndex"),t(l,g),t(b,a),t(0,l)):(r.assert(l>=b&&l<=a,"invalid firstIndex"),t(l,a),t(0,g),t(b,l))):g>b?t(b,g):g<b&&(t(0,g),t(b,a));k.bindVAO(null);h.release(k,c)}};return e}();b.LodRenderer=n;b.lodRenderers=[];var J=a.vec3f64.create(),N=g.vec4f64.create(),
L=k.mat4f64.create(),M=a.vec3f64.create(),R=a.vec3f64.create(),S=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/Evented ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){Object.defineProperty(b,"__esModule",{value:!0});var t;(function(a){a[a.ALLOCATED=1]="ALLOCATED";a[a.ACTIVE=2]="ACTIVE";a[a.VISIBLE=4]="VISIBLE";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";a[a.REMOVE=32]="REMOVE";a[a.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(t=b.StateFlags||(b.StateFlags={}));var x=function(){return function(a){this.localTransform=a.getField("localTransform",q.BufferViewMat4f64);this.globalTransform=a.getField("globalTransform",
q.BufferViewMat4f64);this.modelOrigin=a.getField("modelOrigin",q.BufferViewVec3f64);this.model=a.getField("model",q.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",q.BufferViewMat3f);this.modelScaleFactors=a.getField("modelScaleFactors",q.BufferViewVec2f);this.boundingSphere=a.getField("boundingSphere",q.BufferViewVec4f64);this.color=a.getField("color",q.BufferViewVec4f);this.featureAttribute=a.getField("featureAttribute",q.BufferViewVec4f);this.state=a.getField("state",q.BufferViewUint8);
this.lodLevel=a.getField("lodLevel",q.BufferViewUint8)}}();b.View=x;n=function(a){function b(b,c){var d=a.call(this)||this;d._capacity=0;d._size=0;d._next=0;var e=p.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=b.indexOf("color")&&(e=e.vec4f("color"));0<=b.indexOf("featureAttribute")&&(e=e.vec4f("featureAttribute"));e=e.u8("state").u8("lodLevel").alignTo(8);d._layout=
e;d._shaderTransformation=c;return d}l(b,a);Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});b.prototype.addInstance=
function(){this._size+1>this._capacity&&this.grow();var a=this.findSlot();this._view.state.set(a,t.ALLOCATED);this._size++;this.emit("instance-added",{index:a});return a};b.prototype.removeInstance=function(a){var b=this._view.state;r.assert(0<=a&&a<this._capacity&&b.get(a)&t.ALLOCATED,"invalid instance handle");this.getStateFlag(a,t.ACTIVE)?this.setStateFlags(a,t.REMOVE):this.freeInstance(a);this.emit("instance-removed",{index:a})};b.prototype.freeInstance=function(a){var b=this._view.state;r.assert(0<=
a&&a<this._capacity&&b.get(a)&t.ALLOCATED,"invalid instance handle");b.set(a,0);this._size--};b.prototype.setLocalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.localTransform.setMat(a,b);c&&this.updateModelTransform(a)};b.prototype.getLocalTransform=function(a,b){this._view.localTransform.getMat(a,b)};b.prototype.setGlobalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.globalTransform.setMat(a,b);c&&this.updateModelTransform(a)};b.prototype.getGlobalTransform=function(a,b){this._view.globalTransform.getMat(a,
b)};b.prototype.updateModelTransform=function(a){var b=this._view,e=y,f=m;b.localTransform.getMat(a,v);b.globalTransform.getMat(a,z);var k=g.mat4.multiply(z,z,v);d.vec3.set(e,k[12],k[13],k[14]);b.modelOrigin.setVec(a,e);h.mat3.fromMat4(f,k);b.model.setMat(a,f);e=c.scaleFromMatrix(y,k);e.sort();b.modelScaleFactors.set(a,0,e[1]);b.modelScaleFactors.set(a,1,e[2]);h.mat3.invert(f,f);h.mat3.transpose(f,f);b.modelNormal.setMat(a,f);this.setStateFlags(a,t.TRANSFORM_CHANGED);this.emit("instance-transform-changed",
{index:a})};b.prototype.getModelTransform=function(a,b){var c=this._view;c.model.getMat(a,m);c.modelOrigin.getVec(a,y);b[0]=m[0];b[1]=m[1];b[2]=m[2];b[3]=0;b[4]=m[3];b[5]=m[4];b[6]=m[5];b[7]=0;b[8]=m[6];b[9]=m[7];b[10]=m[8];b[11]=0;b[12]=y[0];b[13]=y[1];b[14]=y[2];b[15]=1};b.prototype.applyShaderTransformation=function(a,b){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b)};b.prototype.getCombinedModelTransform=function(a,b){this.getModelTransform(a,b);this._shaderTransformation&&
this._shaderTransformation.applyTransform(this,a,b);return b};b.prototype.getCombinedLocalTransform=function(a,b){this._view.localTransform.getMat(a,b);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b);return b};b.prototype.getCombinedMaxScaleFactor=function(a){var b=this._view.modelScaleFactors.get(a,1);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(y,this,a),b*=Math.max(a[0],a[1],a[2]));return b};b.prototype.getCombinedMedianScaleFactor=function(a){var b=
this._view.modelScaleFactors.get(a,0);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(y,this,a),a.sort(),b*=a[1]);return b};b.prototype.getModel=function(a,b){this._view.model.getMat(a,b)};b.prototype.setFeatureAttribute=function(a,b){this._view.featureAttribute.setVec(a,b)};b.prototype.getFeatureAttribute=function(a,b){this._view.featureAttribute.getVec(a,b)};b.prototype.setColor=function(a,b){this._view.color.setVec(a,b)};b.prototype.getColor=function(a,b){this._view.color.getVec(a,
b)};b.prototype.setVisible=function(a,b){b!==this.getVisible(a)&&(this.setStateFlag(a,t.VISIBLE,b),this.emit("instance-visibility-changed",{index:a}))};b.prototype.getVisible=function(a){return this.getStateFlag(a,t.VISIBLE)};b.prototype.setHighlight=function(a,b){b!==this.getHighlight(a)&&(this.setStateFlag(a,t.HIGHLIGHT,b),this.emit("instance-highlight-changed",{index:a}))};b.prototype.getHighlight=function(a){return this.getStateFlag(a,t.HIGHLIGHT)};b.prototype.getState=function(a){return this._view.state.get(a)};
b.prototype.getLodLevel=function(a){return this._view.lodLevel.get(a)};b.prototype.countFlags=function(a){for(var b=0,c=0;c<this._capacity;++c)this.getState(c)&a&&++b;return b};b.prototype.setStateFlags=function(a,b){var c=this._view.state;b|=c.get(a);c.set(a,b)};b.prototype.clearStateFlags=function(a,b){var c=this._view.state;b=c.get(a)&~b;c.set(a,b)};b.prototype.setStateFlag=function(a,b,c){c?this.setStateFlags(a,b):this.clearStateFlags(a,b)};b.prototype.getStateFlag=function(a,b){return!!(this._view.state.get(a)&
b)};b.prototype.grow=function(){var a=Math.max(w,Math.floor(this._capacity*u)),b=this._layout.createBuffer(a);if(this._buffer){var c=new Uint8Array(this._buffer.buffer);(new Uint8Array(b.buffer)).set(c)}this._capacity=a;this._buffer=b;this._view=new x(this._buffer)};b.prototype.findSlot=function(){for(var a=this._view.state,b=this._next;a.get(b)&t.ALLOCATED;)b=(b+1)%this._capacity;this._next=(b+1)%this._capacity;return b};return b}(k);b.InstanceData=n;var w=1024,u=2,y=f.vec3f64.create(),m=a.mat3f64.create(),
v=e.mat4f64.create(),z=e.mat4f64.create()})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../Octree".split(" "),function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(c,d){var e=b.call(this,[0,0,0],1,{getCenter:function(a){var b=
e._instanceData.view.boundingSphere,c=e._tmpCenter;c[0]=b.get(a,0);c[1]=b.get(a,1);c[2]=b.get(a,2);return c},getRadius:function(a){return e._instanceData.view.boundingSphere.get(a,3)}},{maximumDepth:25})||this;e._tmpCenter=a.vec3f64.create();e._tmpMat4=k.mat4f64.create();e._instanceData=c;e._boundingSphere=d;return e}l(d,b);d.prototype.addInstance=function(a){var b=this._instanceData.view.boundingSphere,c=this._instanceData.getCombinedModelTransform(a,this._tmpMat4),d=h.vec3.transformMat4(this._tmpCenter,
this._boundingSphere.center,c),c=this._boundingSphere.radius*g.maxScale(c);b.set(a,0,d[0]);b.set(a,1,d[1]);b.set(a,2,d[2]);b.set(a,3,c);this.add(a)};d.prototype.removeInstance=function(a){this.remove(a)};return d}(e);b.InstanceOctree=n})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./Util".split(" "),function(n,
b,l,k,h,a,g,e){function d(a,b,c){c=c||a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c}function f(a,b,c){return!g.frustum.intersectsSphere(c.planes,g.sphere.wrap(b,a))}function c(a,b,c){if(!J.length)for(var d=0;8>d;++d)J.push({index:0,distance:0});for(d=0;8>d;++d){var e=t[d];J.data[d].index=d;J.data[d].distance=p(a,b,e)}J.sort(function(a,b){return a.distance-b.distance});c.clear();for(d=0;8>d;++d)c.push(J.data[d].index)}function q(a,b){for(var c=Infinity,d=null,e=0;8>e;++e){var f=p(a,b,x[e]);f<c&&(c=
f,d=x[e])}return d}function p(a,b,c){return b*(a[0]*c[0]+a[1]*c[1]+a[2]*c[2])}n=function(){function b(b,c,d,e){this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._objectCount=0;this._objectToBoundingSphere=d;e&&(void 0!==e.maximumObjectsPerNode&&(this._maximumObjectsPerNode=e.maximumObjectsPerNode),void 0!==e.maximumDepth&&(this._maximumDepth=e.maximumDepth));isNaN(b[0])||isNaN(b[1])||isNaN(b[2])||isNaN(c)?this._root=new r(null,a.vec3f64.fromValues(0,0,0),.5):
this._root=new r(null,b,c/2)}Object.defineProperty(b.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this._degenerateObjects.clear();this._root=null;r.clearPool();u=[null];B.prune();J.prune();N.prune()};b.prototype.add=function(a,b){a=this._objectOrObjectsArray(a);b=null==b?a.length:b;this._objectCount+=b;
this._grow(a,b);for(var c=r.acquire(),d=0;d<b;d++){var e=a[d];c.init(this._root);this._isDegenerate(e)?this._degenerateObjects.add(e):this._add(e,c)}r.release(c)};b.prototype.remove=function(a,b){a=this._objectOrObjectsArray(a);this._objectCount-=a.length;for(var c=r.acquire(),d=0;d<a.length;d++){var e=a[d],f=b||this._boundingSphereFromObject(e,C);this._isValidRadius(f.radius)?(c.init(this._root),this._remove(e,f,c)):this._degenerateObjects.delete(e)}r.release(c);this._shrink()};b.prototype.update=
function(a,b){if(this._isValidRadius(b.radius)||!this._isDegenerate(a))this.remove(a,b),this.add(a)};b.prototype.forEachAlongRay=function(a,b,c){var d=this;this._forEachNode(this._root,function(e){if(!d._intersectsNode(a,b,e))return!1;e=e.node;e.terminals.forEach(function(e){d._intersectsObject(a,b,e)&&c(e)});null!==e.residents&&e.residents.forEach(function(e){d._intersectsObject(a,b,e)&&c(e)});return!0})};b.prototype.forEach=function(a){this._forEachNode(this._root,function(b){b=b.node;b.terminals.forEach(a);
null!==b.residents&&b.residents.forEach(a);return!0});this._degenerateObjects.forEach(a)};b.prototype.forEachDegenerateObject=function(a){this._degenerateObjects.forEach(a)};b.prototype.findClosest=function(a,b,c,d,e){return this._findClosest(a,"front-to-back"===b?1:-1,c,d,e)};b.prototype.forEachInDepthRange=function(a,b,c,d,e,f,g,h){this._forEachInDepthRange(a,b,"front-to-back"===c?1:-1,d,e,f,g,h)};b.prototype.forEachNode=function(a){this._forEachNode(this._root,function(b){return a(b.node,b.center,
2*b.halfSize)})};b.prototype._intersectsNode=function(a,b,c){d(c.center,2*-c.halfSize,v);d(c.center,2*c.halfSize,z);return e.rayBoxTest(a,b,v,z)};b.prototype._intersectsObject=function(a,b,c){var d=this._objectToBoundingSphere.getRadius(c);return 0<d?g.sphere.intersectsRay(g.sphere.wrap(d,this._objectToBoundingSphere.getCenter(c)),g.ray.wrap(a,b)):!0};b.prototype._forEachNode=function(a,b){a=r.acquire().init(a);for(var c=[a];0!==c.length;){a=c.pop();if(b(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&
c.push(r.acquire().init(a).advance(d));r.release(a)}};b.prototype._forEachNodeDepthOrdered=function(a,b,d,e){void 0===e&&(e=1);a=r.acquire().init(a);var f=[a];for(c(d,e,N);0!==f.length;){a=f.pop();if(b(a)&&!a.isLeaf())for(d=7;0<=d;--d)e=N.data[d],e>=a.node.children.length||a.node.children[e]&&f.push(r.acquire().init(a).advance(e));r.release(a)}};b.prototype._findClosest=function(a,b,c,d,e){var g=this,k=Infinity,r=Infinity,l=null,v=q(a,b),u=0,t=function(e){++u;if(!d||d(e)){var h=g._objectToBoundingSphere.getCenter(e),
m=g._objectToBoundingSphere.getRadius(e);if(!c||!f(h,m,c)){var h=p(a,b,h),q=h-m;q<k&&(k=q,r=h+m,l=e)}}};this._forEachNodeDepthOrdered(this._root,function(d){if(null!=e&&u>=e||c&&f(d.center,d.halfSize*w,c))return!1;h.vec3.scale(m,v,d.halfSize);h.vec3.add(m,m,d.center);if(p(a,b,m)>r)return!1;d=d.node;d.terminals.forEach(function(a){t(a)});null!==d.residents&&d.residents.forEach(function(a){t(a)});return!0},a,b);return l};b.prototype._forEachInDepthRange=function(a,b,c,d,e,g,k,r){var l=this,v=-Infinity,
u=Infinity,t={setRange:function(a){1===c?(v=Math.max(v,a.near),u=Math.min(u,a.far)):(v=Math.max(v,-a.far),u=Math.min(u,-a.near))}};t.setRange(d);var y=p(b,c,a),x=q(b,c),z=q(b,-1*c),n=0,B=function(a){++n;if(!k||k(a)){var d=l._objectToBoundingSphere.getCenter(a),h=l._objectToBoundingSphere.getRadius(a),m=p(b,c,d)-y;m-h>u||m+h<v||g&&f(d,h,g)||e(a,t)}};this._forEachNodeDepthOrdered(this._root,function(a){if(null!=r&&n>=r||g&&f(a.center,a.halfSize*w,g))return!1;h.vec3.scale(m,x,a.halfSize);h.vec3.add(m,
m,a.center);if(p(b,c,m)-y>u)return!1;h.vec3.scale(m,z,a.halfSize);h.vec3.add(m,m,a.center);if(p(b,c,m)-y<v)return!1;a=a.node;a.terminals.forEach(function(a){B(a)});null!==a.residents&&a.residents.forEach(function(a){B(a)});return!0},b,c)};b.prototype._objectOrObjectsArray=function(a){if(Array.isArray(a))return a;u[0]=a;return u};b.prototype._remove=function(a,b,c){B.clear();b=c.advanceTo(b,function(a,b){B.push(a.node);B.push(b)})?c.node.terminals:c.node.residents;b.removeUnordered(a);if(0===b.length)for(a=
B.length-2;0<=a&&this._purge(B.data[a],B.data[a+1]);a-=2);};b.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;return!0};b.prototype._purge=function(a,b){0<=b&&(a.children[b]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=new k({shrink:!0})),!0):!1};b.prototype._add=function(a,b){b.advanceTo(this._boundingSphereFromObject(a,C))?b.node.terminals.push(a):
(b.node.residents.push(a),b.node.residents.length>this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))};b.prototype._split=function(a){var b=a.node.residents;a.node.residents=null;for(var c=0;c<b.length;c++){var d=r.acquire().init(a);this._add(b.data[c],d);r.release(d)}};b.prototype._grow=function(a,b){var c=this;0!==b&&(a=this._boundingSphereFromObjects(a,b,function(a,b){return c._boundingSphereFromObject(a,b)},D),this._isValidRadius(a.radius)&&!this._fitsInsideTree(a)&&(this._nodeIsEmpty(this._root.node)?
(h.vec3.copy(this._root.center,a.center),this._root.halfSize=1.25*a.radius):(b=r.acquire(),this._rootBoundsForRootAsSubNode(a,b),this._placingRootViolatesMaxDepth(b)?this._rebuildTree(a,b):this._growRootAsSubNode(b),r.release(b))))};b.prototype._rebuildTree=function(a,b){var c=this;h.vec3.copy(K.center,b.center);K.radius=b.halfSize;a=this._boundingSphereFromObjects([a,K],2,function(a){return a},I);b=r.acquire().init(this._root);this._root.initFrom(null,a.center,1.25*a.radius);this._forEachNode(b,
function(a){c.add(a.node.terminals.data,a.node.terminals.length);null!==a.node.residents&&c.add(a.node.residents.data,a.node.residents.length);return!0});r.release(b)};b.prototype._placingRootViolatesMaxDepth=function(a){var b=0;this._forEachNode(this._root,function(a){b=Math.max(b,a.depth);return!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};b.prototype._rootBoundsForRootAsSubNode=function(a,b){var c=a.radius,d=a.center;a=-Infinity;for(var e=this._root.center,
f=this._root.halfSize,g=0;3>g;g++){var h=Math.max(0,Math.ceil((e[g]-f-(d[g]-c))/(2*f))),k=Math.max(0,Math.ceil((d[g]+c-(e[g]+f))/(2*f)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(h+k)*Math.LOG2E)));Q[g].min=h;Q[g].max=k}for(g=0;3>g;g++)h=Q[g].min,k=Q[g].max,c=(a-(h+k))/2,h+=Math.ceil(c),k+=Math.floor(c),y[g]=e[g]-f-h*f*2+(k+h)*f;return b.initFrom(null,y,a*f,0)};b.prototype._growRootAsSubNode=function(a){var b=this._root.node;h.vec3.copy(D.center,this._root.center);D.radius=this._root.halfSize;
this._root.init(a);a.advanceTo(D,null,!0);a.node.children=b.children;a.node.residents=b.residents;a.node.terminals=b.terminals};b.prototype._shrink=function(){for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=0}};b.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,d=0;d<b.length&&null==a;)c=d++,a=b[c];for(;d<b.length;)if(b[d++])return-1;return c};b.prototype._isDegenerate=
function(a){a=this._objectToBoundingSphere.getRadius(a);return!this._isValidRadius(a)};b.prototype._isValidRadius=function(a){return!isNaN(a)&&-Infinity!==a&&Infinity!==a&&0<a};b.prototype._fitsInsideTree=function(a){var b=this._root.center,c=this._root.halfSize,d=a.center;return a.radius<=c&&d[0]>=b[0]-c&&d[0]<=b[0]+c&&d[1]>=b[1]-c&&d[1]<=b[1]+c&&d[2]>=b[2]-c&&d[2]<=b[2]+c};b.prototype._boundingSphereFromObject=function(a,b){h.vec3.copy(b.center,this._objectToBoundingSphere.getCenter(a));b.radius=
this._objectToBoundingSphere.getRadius(a);return b};b.prototype._boundingSphereFromObjects=function(a,b,c,d){if(1===b){var e=c(a[0],D);h.vec3.copy(d.center,e.center);d.radius=e.radius}else{v[0]=Infinity;v[1]=Infinity;v[2]=Infinity;z[0]=-Infinity;z[1]=-Infinity;z[2]=-Infinity;for(var f=0;f<b;f++)if(e=c(a[f],D),this._isValidRadius(e.radius)){var g=v,k=e.center,m=e.radius;g[0]=Math.min(g[0],k[0]-m);g[1]=Math.min(g[1],k[1]-m);g[2]=Math.min(g[2],k[2]-m);g=z;k=e.center;e=e.radius;g[0]=Math.max(g[0],k[0]+
e);g[1]=Math.max(g[1],k[1]+e);g[2]=Math.max(g[2],k[2]+e)}h.vec3.lerp(d.center,v,z,.5);d.radius=Math.max(z[0]-v[0],z[1]-v[1],z[2]-v[2])/2}return d};return b}();var r=function(){function b(b,c,d,e){void 0===d&&(d=0);void 0===e&&(e=0);this.center=a.vec3f64.create();this.initFrom(b,c,d,0)}b.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};b.prototype.initFrom=function(a,c,d,e){void 0===a&&(a=null);void 0===d&&(d=this.halfSize);void 0===e&&(e=this.depth);this.node=a||
b.createEmptyNode();c&&h.vec3.copy(this.center,c);this.halfSize=d;this.depth=e;return this};b.prototype.advance=function(a){var c=this.node.children[a];c||(c=b.createEmptyNode(),this.node.children[a]=c);this.node=c;this.halfSize/=2;this.depth++;a=t[a];this.center[0]+=a[0]*this.halfSize;this.center[1]+=a[1]*this.halfSize;this.center[2]+=a[2]*this.halfSize;return this};b.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&b(this,-1),!0;if(this.isLeaf()&&
!c)return b&&b(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var d=this._childIndex(a);b&&b(this,d);this.advance(d)}};b.prototype.isLeaf=function(){return null!=this.node.residents};b.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2};b.prototype._childIndex=function(a){a=a.center;for(var b=this.center,c=0,d=0;3>d;d++)b[d]<a[d]&&(c|=1<<d);return c};b.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new k({shrink:!0}),residents:new k({shrink:!0})}};
b.acquire=function(){return b._pool.acquire()};b.release=function(a){b._pool.release(a)};b.clearPool=function(){b._pool.prune()};b._pool=new l(b);return b}(),t=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(1,1,-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(1,-1,1),a.vec3f64.fromValues(-1,1,1),a.vec3f64.fromValues(1,1,1)],x=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(-1,
1,1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(1,-1,1),a.vec3f64.fromValues(1,1,-1),a.vec3f64.fromValues(1,1,1)],w=Math.sqrt(3),u=[null],y=a.vec3f64.create(),m=a.vec3f64.create(),v=a.vec3f64.create(),z=a.vec3f64.create(),B=new k,C={center:a.vec3f64.create(),radius:0},D={center:a.vec3f64.create(),radius:0},K={center:a.vec3f64.create(),radius:0},I={center:a.vec3f64.create(),radius:0},Q=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],J=new k,N=new k;return n})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require",
"exports","../Camera"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a){this.thresholdScale=1;this._camera=new l.default;this._worldSpaceRadius=b;this._thresholds=a.map(function(a){return a})}b.prototype.updateCamera=function(b){this._camera.copyFrom(b)};b.prototype.selectLevel=function(b,a){b=this._camera.computeScreenPixelSizeAt(b);a=this._worldSpaceRadius*a/b;b=this._thresholds;for(var g=-1,e=0;e<b.length;++e)a>=b[e]*this.thresholdScale&&(g=e);return g};
return b}();b.LevelSelector=n})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require","exports","../../../support/buffer/BufferView","../Util","./BackedBufferObject"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(){return function(a){this.modelOriginHi=a.getField("modelOriginHi",l.BufferViewVec3f);this.modelOriginLo=a.getField("modelOriginLo",l.BufferViewVec3f);this.model=a.getField("model",l.BufferViewMat3f);this.modelNormal=
a.getField("modelNormal",l.BufferViewMat3f);this.color=a.getField("instanceColor",l.BufferViewVec4f);this.featureAttribute=a.getField("instanceFeatureAttribute",l.BufferViewVec4f)}}();b.View=a;n=function(){function b(a,b){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=a;this._instanceBufferLayout=b;this._elementSize=b.stride;this._capacity=1}b.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(b.prototype,
"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){var a=this._headIndex,b=this._tailIndex;return a>=b?a-b:a+this._capacity-b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0});b.prototype.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};b.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};b.prototype.beginUpdate=function(){k.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=
this._headIndex};b.prototype.endUpdate=function(){k.assert(this._updating,"not updating");this.size<d*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};b.prototype.allocateHead=function(){k.assert(this._updating,"not updating");this.isFull&&this.grow();var a=this.headIndex;this._captureFirstIndex&&(this._firstIndex=a,this._captureFirstIndex=!1);this.incrementHead();k.assert(this._headIndex!==
this._tailIndex,"invalid pointers");return a};b.prototype.freeTail=function(){k.assert(this._updating,"not updating");k.assert(0<this.size,"invalid size");var a=this._tailIndex===this._firstIndex;this.incrementTail();a&&(this._firstIndex=this._tailIndex)};b.prototype.grow=function(){this.resize(Math.max(g,Math.floor(this._capacity*e)))};b.prototype.shrink=function(){c&&this.resize(Math.max(g,Math.floor(this._capacity*f)))};b.prototype.resize=function(b){k.assert(this._updating,"not updating");if(b!==
this._capacity){var c=new h(this._rctx,34962,35044,this._elementSize,b);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var d=this.size,e=this.compactInstances(c);k.assert(e===d,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=e;this._prevHeadIndex=0}this._resized=!0;this._capacity=b;this._buffer=c;this._view=new a(this._instanceBufferLayout.createView(this._buffer.array))}};b.prototype.compactInstances=
function(a){var b=this._headIndex,c=this._tailIndex;return c<b?(this._buffer.copyRange(c,b,a),b-c):c>b?(this._buffer.copyRange(c,this._capacity,a),0<b&&this._buffer.copyRange(0,b,a,this._capacity-c),b+(this._capacity-c)):0};b.prototype.incrementHead=function(a){void 0===a&&(a=1);this._headIndex=(this._headIndex+a)%this._capacity};b.prototype.incrementTail=function(a){void 0===a&&(a=1);this._tailIndex=(this._tailIndex+a)%this._capacity};b.prototype.transferRange=function(a,b){a<b?this._buffer.transferRange(a,
b):a>b&&(0<b&&this._buffer.transferRange(0,b),this._buffer.transferRange(a,this._capacity))};return b}();b.RenderInstanceData=n;var g=1024,e=2,d=.3,f=.5,c=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require","exports","../../../../webgl/BufferObject"],function(n,b,l){return function(){function b(b,a,g,e,d){this._elementSize=e;this._buffer=new l(b,a,g);this.resize(d)}b.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(b.prototype,
"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*
this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0});b.prototype.copyRange=function(b,a,g,e){void 0===e&&(e=0);b=new Uint8Array(this.array,b*this.elementSize,(a-b)*this.elementSize);(new Uint8Array(g.array,e*this.elementSize)).set(b)};b.prototype.transferAll=function(){this._buffer.setData(this._array)};b.prototype.transferRange=function(b,a){b*=this._elementSize;this._buffer.setSubData(this._array,b,b,a*this._elementSize)};b.prototype.resize=function(b){var a=
b*this._elementSize,g=new ArrayBuffer(a);this._array&&(b>=this._capacity?(new Uint8Array(g)).set(new Uint8Array(this._array)):(new Uint8Array(g)).set((new Uint8Array(this._array)).subarray(0,b*this._elementSize)));this._array=g;this._buffer.setData(a);this._capacity=b};return b}()})},"esri/views/3d/webgl-engine/lib/lodRendering/utils":function(){define(["require","exports","../doublePrecisionUtils"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.acquireGLMaterials=function(a,b){var e=
{};e[0]=b.acquire(a,"color");e[3]=b.acquire(a,"depthShadowMap");e[2]=b.acquire(a,"normal");e[1]=b.acquire(a,"depth");e[4]=b.acquire(a,"highlight");return e};b.releaseGLMaterials=function(a,b){b.release(a.id,"color");b.release(a.id,"depthShadowMap");b.release(a.id,"normal");b.release(a.id,"depth");b.release(a.id,"highlight")};b.encodeDoubleVec3=function(a,b,e,d,f){k[0]=a.get(b,0);k[1]=a.get(b,1);k[2]=a.get(b,2);l.encodeDoubleArray(k,h,3);e.set(f,0,h[0]);d.set(f,0,h[1]);e.set(f,1,h[2]);d.set(f,1,h[3]);
e.set(f,2,h[4]);d.set(f,2,h[5])};var k=new Float64Array(3),h=new Float32Array(6)})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/lang ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../layers/graphics/dehydratedFeatures ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q){function J(a,b,e){switch(b){case "world":for(var f=0,g=a.vertices;f<g.length;f++)b=g[f],r.vec3.add(U,b.pos,a.offset),e.worldUpAtPosition(U,T),b.setFrameFromUpVector(T),b.computeRotationAxisAndAngleFromUpVector();break;case "path":for(r.vec3.add(U,a.vertices[0].pos,a.offset),e.worldUpAtPosition(U,T),D.computeMinimumRotationTangentFrame(a,T),e=0,a=a.vertices;e<a.length;e++){b=a[e];f=d.sign(r.vec3.dot(b.frame.right,b.vRight));r.vec3.cross(b.rotationFrame.up,
b.vRight,b.vLeft);r.vec3.scale(b.rotationFrame.up,b.rotationFrame.up,f);r.vec3.normalize(b.rotationFrame.up,b.rotationFrame.up);var g=r.vec3.dot(b.rotationFrame.up,b.frame.up),h=r.vec3.dot(b.rotationFrame.up,b.frame.right);r.vec3.scale(U,b.frame.up,-h);r.vec3.scale(Y,b.frame.right,g);r.vec3.add(U,U,Y);r.vec3.normalize(b.rotationFrame.right,U);D.vertexSpaceToProfileSpace(b.rotationRight,b.frame,b.rotationFrame.right);r.vec3.negate(U,b.vLeft);b.rotationAngle=-f*(Math.PI-d.acosClamped(r.vec3.dot(U,b.vRight)));
0<Math.abs(b.rotationAngle)&&(f=1/Math.cos(.5*b.rotationAngle),c.mat2.set(b.miterStretch,1+(f-1)*b.rotationRight[0]*b.rotationRight[0],(f-1)*b.rotationRight[0]*b.rotationRight[1],(f-1)*b.rotationRight[0]*b.rotationRight[1],1+(f-1)*b.rotationRight[1]*b.rotationRight[1]));b.maxStretchDistance=Math.abs(Math.min(b.vLeftLength,b.vRightLength)/Math.cos(.5*(Math.PI-b.rotationAngle)))}}}function N(a,b,c){switch(a){case "symbolValue":return c;case "proportional":return b;default:return a}}function L(a,b,c,
d){a=a.stageObject;var e=a.geometryRecords,f=e.length,g=0;R.spatialReference=c.spatialReference;M.spatialReference=d.spatialReference;for(var h=0;h<f;h++){var k=e[h].geometry,m=k.metadata,p=m.pathGeometry,q=p.builder.path;S.spatialReference=m.geometrySR;for(var l=q,v=b,u=c,t=d,x=0,z=0,w=l.vertices;z<w.length;z++){var n=w[z];R.x=n.posES[0];R.y=n.posES[1];R.z=n.posES[2];var B=y.computeElevation(u,R,v,t,X),x=x+X.terrainElevation;r.vec3.add(T,n.pos,l.offset);t.setAltitude(B,T);r.vec3.subtract(n.pos,T,
l.offset)}l.updatePathVertexInformation();g+=x/l.vertices.length;"world"!==q.upVector&&J(q,m.upVectorAlignment,d);p.onPathChanged();k.invalidateBoundingInfo();a.geometryVertexAttrsUpdated(h)}return g/f}Object.defineProperty(b,"__esModule",{value:!0});n=function(c){function d(a,b,d,e){a=c.call(this,a,b,d,e)||this;a._intrinsicSize=p.vec2f64.fromValues(1,1);a.upVectorAlignment="path";a.stencilWidth=.1;return a}l(d,c);d.prototype.doLoad=function(){return a(this,void 0,void 0,function(){var a,c,d,k,m,
p,r,l,u,t,y,w,n,B;return h(this,function(h){a=f.isSome(this.symbolLayer.width)?this.symbolLayer.width:f.isSome(this.symbolLayer.height)?this.symbolLayer.height:this.symbolLayer.size;c=f.isSome(this.symbolLayer.height)?this.symbolLayer.height:a;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[a,1,c],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=
this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?z.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};d=this.symbolLayer.anchor||"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");k=this.symbolLayer.profile||"circle";switch(k){default:this._profile=D.Profile.circle(b.NUM_CIRCLE_PROFILE_SUBDIVISIONS);break;case "quad":this._profile=D.Profile.rect()}m=
[0,0];"center"!==d&&(m={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[d],this._profile.translate(m[0],m[1]));p=this.symbolLayer.join||"simple";switch(p){case "round":this._extruder=new D.MiterExtruder(0,b.NUM_ROUND_JOIN_SUBDIVISIONS);break;case "bevel":this._extruder=new D.MiterExtruder(0,1);break;case "miter":this._extruder=new D.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new D.SimpleExtruder}r=this.symbolLayer.cap||"butt";switch(r){case "none":this._startCap=new D.NoCapBuilder;
this._endCap=new D.NoCapBuilder;break;default:this._startCap=new D.TriangulationCapBuilder(this._profile,0);this._endCap=new D.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new D.TriangulationCapBuilder(this._profile,-.5);this._endCap=new D.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":l="quad"===k?!0:!1,this._startCap=new D.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:l,subdivisions:b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS}),this._endCap=
new D.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:l,subdivisions:b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS})}u=this._getIdHint();t=f.get(this.symbolLayer,"material","color");y=this._getCombinedOpacityAndColor(t);w=x.vec3f64.fromArray(y);n=y[3];B={diffuse:w,ambient:w,opacity:n,transparent:1>n||this._isPropertyDriven("opacity"),vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:"none"===r?"none":void 0,offsetTransparentBackfaces:!0};
if(!this._isPropertyDriven("size")&&(q.vec2.set(this._intrinsicSize,a,c),!v.isValidSize(this._intrinsicSize[0])||!v.isValidSize(this._intrinsicSize[1])))throw new g("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||q.vec2.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates.enabled?(e.mixin(B,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],
this._intrinsicSize[1],0]}),this._material=new I(B,u+"_pathmat")):(B.vertexColors=this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),this._material=new K(B,u+"_pathmat"));this._material.setParameterValues(Q.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled));this._context.stage.add(3,this._material);return[2]})})};d.prototype.destroy=function(){c.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=
null)};d.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,d.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,e,c,b.uid)};d.prototype.layerOpacityChanged=function(){var a=f.get(this.symbolLayer,"material","color"),a=this._getCombinedOpacity(a),b=1>a||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:a,
transparent:b});return!0};d.prototype.layerElevationInfoChanged=function(a,b,c){var d=this;a.forEach(function(a){var c=b(a);f.isSome(c)&&(a=d.getGraphicElevationContext(a.graphic),c.needsElevationUpdates=y.needsElevationUpdates3D(a.mode),c.elevationContext.set(a))});return y.SymbolUpdateType.UPDATE};d.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};d.prototype.physicalBasedRenderingChanged=function(a,
b){this._material.setParameterValues(Q.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled));return!0};d.prototype.pixelRatioChanged=function(a,b){return!0};d.prototype.applyRendererDiff=function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,b,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};d.prototype.getVertexData=
function(a){for(var b=0,c=a.paths,d=[],e=a.spatialReference,f=this._context.elevationProvider.spatialReference,g=this._context.renderSpatialReference,h=0;h<c.length;h++)var k=c[h],b=b+k.length;for(var h=new Float64Array(3*b),m=new Float64Array(3*b),p=new Float64Array(3*b),q=0,r=0;r<c.length;r++){k=c[r];d.push({index:q,numVertices:k.length});for(var l=0;l<k.length;l++){var v=k[l];h[q++]=v[0];h[q++]=v[1];h[q++]=a.hasZ?v[2]:0}}a=!0;e.equals(f)?y.copyVertices(h,0,m,0,b):a=y.reproject(h,0,e,m,0,f,b);f.equals(g)?
y.copyVertices(m,0,p,0,b):y.reproject(m,0,f,p,0,g,b);return{pathVertexDataInfos:d,vertexDataGS:h,vertexDataES:m,vertexDataRS:p,projectionSuccess:a,terrainElevation:0}};d.prototype._createAs3DShape=function(a,b,c,d,e){var f=a.geometry,g=[],h=[],k=[],p=f.spatialReference,q=this._context.elevationProvider.spatialReference,l=Array(6),v=this._context.renderCoordsHelper;S.spatialReference=p;R.spatialReference=q;f=this.getVertexData(f);if(!f.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),
null;if(0<f.pathVertexDataInfos.length){for(q=0;q<f.pathVertexDataInfos.length;++q){var t=f.pathVertexDataInfos[q],x=t.index,t=t.numVertices;if(2>t)this.logger.warn("PathSymbol3DLayer geometry failed to be created (paths should contain at least 2 vertices)");else{if(this._context.clippingExtent&&(y.computeBoundingBox(f.vertexDataES,x,t,l),y.boundingBoxClipped(l,this._context.clippingExtent)))continue;for(var z=[],w=x;w<x+3*t;){var n=w++,M=w++,K=w++,I=new D.PathVertex;r.vec3.set(I.posGS,f.vertexDataGS[n],
f.vertexDataGS[M],f.vertexDataGS[K]);r.vec3.set(I.posES,f.vertexDataES[n],f.vertexDataES[M],f.vertexDataES[K]);R.x=I.posES[0];R.y=I.posES[1];R.z=I.posES[2];var Q=y.computeElevation(this._context.elevationProvider,R,c,v,null);r.vec3.set(T,f.vertexDataRS[n],f.vertexDataRS[M],f.vertexDataRS[K]);v.setAltitude(Q,T);r.vec3.set(I.pos,T[0],T[1],T[2]);z.push(I)}x=new D.Path(z);J(x,this.upVectorAlignment,this._context.renderCoordsHelper);x=new D.Builder(x,this._profile,this._extruder,this._startCap,this._endCap);
t=null;this._fastUpdates.enabled?(w=this._fastUpdates.visualVariables,t=w.size?m.getAttributeValue(w.size.field,a):0,z=w.color?m.getAttributeValue(w.color.field,a):0,w=w.opacity?m.getAttributeValue(w.opacity.field,a):0,t=new D.FastUpdatePathGeometry(x,t,z,w)):(t=[this._intrinsicSize[0],this._intrinsicSize[1]],this._isPropertyDriven("size")&&(t[0]*=N(b.size[0],b.size[2],this.symbolLayer.width),t[1]*=N(b.size[2],b.size[0],this.symbolLayer.height)),z=null,this._isPropertyDriven("color")&&(z=b.color),
this._isPropertyDriven("opacity")&&null!=b.opacity&&(z=z?[z[0],z[1],z[2],b.opacity]:[1,1,1,b.opacity]),x=new D.StaticPathGeometry(x),x.bake(t),z&&x.bakeVertexColors(z),t=x);x=t.createGeometryData();x=new B(x,d+"path"+q);z={pathGeometry:t,geometrySR:p,upVectorAlignment:this.upVectorAlignment,stencilWidth:this.stencilWidth};x.singleUse=!0;x.metadata=z;g.push(x);h.push(this._material);k.push(t.xform)}}a={layerUid:this._context.layer.uid,graphicUid:e};if(0<g.length)return d=new C({geometries:g,materials:h,
transformations:k,castShadow:!0,metadata:a,idHint:d}),g=new u(this,d,g,null,null,L,c),g.alignedTerrainElevation=f.terrainElevation,g.needsElevationUpdates=y.needsElevationUpdates3D(c.mode),g}else this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};d.validGeometryTypes=["polyline"];return d}(m.Graphics3DSymbolLayer);b.Graphics3DPathSymbolLayer=n;var M=w.makeDehydratedPoint(0,0,0,null),R=w.makeDehydratedPoint(0,0,0,null),S=w.makeDehydratedPoint(0,
0,0,null),T=x.vec3f64.create(),U=t.vec3f32.create(),Y=t.vec3f32.create();b.NUM_ROUND_JOIN_SUBDIVISIONS=3;b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;b.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;var X={verticalDistanceToGround:0,terrainElevation:0};b.default=n})},"esri/core/libs/gl-matrix-2/mat2":function(){define(["require","exports","./math/mat2"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat2=l})},"esri/core/libs/gl-matrix-2/math/mat2":function(){define(["require","exports","./common"],
function(n,b,l){function k(a,b,e){var d=b[0],f=b[1],c=b[2];b=b[3];var g=e[0],h=e[1],k=e[2];e=e[3];a[0]=d*g+c*h;a[1]=f*g+b*h;a[2]=d*k+c*e;a[3]=f*k+b*e;return a}function h(a,b,e){a[0]=b[0]-e[0];a[1]=b[1]-e[1];a[2]=b[2]-e[2];a[3]=b[3]-e[3];return a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};b.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a};b.set=function(a,b,e,d,f){a[0]=b;a[1]=e;a[2]=d;a[3]=f;return a};b.transpose=
function(a,b){if(a===b){var e=b[1];a[1]=b[2];a[2]=e}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a};b.invert=function(a,b){var e=b[0],d=b[1],f=b[2];b=b[3];var c=e*b-f*d;if(!c)return null;c=1/c;a[0]=b*c;a[1]=-d*c;a[2]=-f*c;a[3]=e*c;return a};b.adjoint=function(a,b){var e=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=e;return a};b.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};b.multiply=k;b.rotate=function(a,b,e){var d=b[0],f=b[1],c=b[2];b=b[3];var g=Math.sin(e);e=Math.cos(e);a[0]=d*e+c*g;
a[1]=f*e+b*g;a[2]=d*-g+c*e;a[3]=f*-g+b*e;return a};b.scale=function(a,b,e){var d=b[1],f=b[2],c=b[3],g=e[0];e=e[1];a[0]=b[0]*g;a[1]=d*g;a[2]=f*e;a[3]=c*e;return a};b.fromRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=-e;a[3]=b;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];return a};b.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],
2))};b.LDU=function(a,b,e,d){a[2]=d[2]/d[0];e[0]=d[0];e[1]=d[1];e[3]=d[3]-a[2]*e[1];return[a,b,e]};b.add=function(a,b,e){a[0]=b[0]+e[0];a[1]=b[1]+e[1];a[2]=b[2]+e[2];a[3]=b[3]+e[3];return a};b.subtract=h;b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};b.equals=function(a,b){var e=a[0],d=a[1],f=a[2];a=a[3];var c=b[0],g=b[1],h=b[2];b=b[3];return Math.abs(e-c)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(c))&&Math.abs(d-g)<=l.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&
Math.abs(f-h)<=l.EPSILON*Math.max(1,Math.abs(f),Math.abs(h))&&Math.abs(a-b)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.multiplyScalar=function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;return a};b.multiplyScalarAndAdd=function(a,b,e,d){a[0]=b[0]+e[0]*d;a[1]=b[1]+e[1]*d;a[2]=b[2]+e[2]*d;a[3]=b[3]+e[3]*d;return a};b.mul=k;b.sub=h})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/mat2f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./GeometryData ./GeometryUtil ./Util ../materials/internal/MaterialUtil ../shaders/PathPrograms".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y){var m;(function(b){function m(){return{up:p.vec3f64.create(),right:p.vec3f64.create()}}b.makeFrame=m;b.profileSpaceToVertexSpace=function(a,b,c){a[0]=c[0]*b.right[0]+c[1]*b.up[0];a[1]=c[0]*b.right[1]+c[1]*b.up[1];a[2]=c[0]*b.right[2]+c[1]*b.up[2]};b.vertexSpaceToProfileSpace=function(a,b,c){f.vec2.set(a,q.vec3.dot(c,b.right),q.vec3.dot(c,b.up))};var l=function(){function b(){this.pos=p.vec3f64.create();this.posES=p.vec3f64.create();this.posGS=p.vec3f64.create();
this.vRight=p.vec3f64.create();this.vLeft=p.vec3f64.create();this.frame=m();this.rotationFrame=m();this.rotationRight=c.vec2f64.create();this.rotationAngle=0;this.miterStretch=g.mat2f64.create()}b.prototype.setFrameFromUpVector=function(a){q.vec3.copy(this.frame.up,a);q.vec3.add(K,this.vLeft,this.vRight);q.vec3.normalize(K,K);q.vec3.scale(D,this.frame.up,q.vec3.dot(K,this.frame.up));q.vec3.subtract(J,K,D);q.vec3.normalize(J,J);q.vec3.cross(this.frame.right,J,this.frame.up)};b.prototype.computeRotationAxisAndAngleFromUpVector=
function(){q.vec3.copy(this.rotationFrame.up,this.frame.up);q.vec3.copy(this.rotationFrame.right,this.frame.right);f.vec2.set(this.rotationRight,1,0);q.vec3.scale(D,this.frame.up,q.vec3.dot(this.frame.up,this.vLeft));q.vec3.subtract(D,this.vLeft,D);q.vec3.negate(D,D);q.vec3.normalize(D,D);q.vec3.scale(K,this.frame.up,q.vec3.dot(this.frame.up,this.vRight));q.vec3.subtract(K,this.vRight,K);q.vec3.normalize(K,K);q.vec3.cross(I,this.rotationFrame.up,this.vLeft);this.rotationAngle=h.sign(q.vec3.dot(I,
this.vRight))*(Math.PI-h.acosClamped(q.vec3.dot(D,K)));0<Math.abs(this.rotationAngle)&&a.mat2.set(this.miterStretch,1+(1/Math.cos(.5*this.rotationAngle)-1),0,0,1);this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return b}();b.PathVertex=l;l=function(){function a(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=[];this.uvIndices=this.uvs=null}a.prototype.addVertex=function(a,b){this.vertices.push(c.vec2f64.clone(a));
this.vertexNormals.push(c.vec2f64.clone(b));return this.vertices.length-1};a.prototype.addUV=function(a){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(a);return this.uvs.length-1};a.prototype.addPole=function(a,b){void 0===b&&(b=null);this.poles.push({position:c.vec2f64.clone(a),normal:b?c.vec2f64.clone(b):null});return this.poles.length-1};a.prototype.addSegment=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);this.vertexIndices.push(a.v0);this.vertexIndices.push(a.v1);b&&(this.uvIndices.push(b.v0),
this.uvIndices.push(b.v1));c&&(this.poleIndices.push(c.v0),this.poleIndices.push(c.v1))};Object.defineProperty(a.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0});a.prototype.hasUV=function(){return null!=this.uvs};a.prototype.translate=function(a,b){for(var c=0,d=this.vertices;c<d.length;c++){var e=d[c];e[0]+=a;e[1]+=b}c=0;for(d=this.poles;c<d.length;c++)e=d[c],e.position[0]+=a,e.position[1]+=b};a.circle=function(b){void 0===b&&(b=20);var d=
new a,e={v0:0,v1:0};d.addPole(c.vec2f64.fromValues(0,0));for(var f=0;f<b;++f){var g=2*f*Math.PI/b,h=Math.cos(g),k=Math.sin(g),g=c.vec2f64.fromValues(.5*h,.5*k),h=c.vec2f64.fromValues(h,k);d.addVertex(g,h);d.addUV(f/b)}d.addUV(1);for(f=0;f<b-1;++f)h={v0:f,v1:f+1},d.addSegment(h,h,e);d.addSegment({v0:b-1,v1:0},{v0:b-1,v1:b},e);return d};a.rect=function(){var b=new a,d=c.vec2f64.fromValues(-.5,-.5),e=c.vec2f64.fromValues(.5,-.5),f=c.vec2f64.fromValues(.5,.5),g=c.vec2f64.fromValues(-.5,.5),h=c.vec2f64.fromValues(0,
-1),k=c.vec2f64.fromValues(1,0),m=c.vec2f64.fromValues(0,1),p=c.vec2f64.fromValues(-1,0);b.addUV(0);b.addUV(1);b.addPole(c.vec2f64.fromValues(0,.5),m);b.addPole(c.vec2f64.fromValues(0,.5));b.addPole(c.vec2f64.fromValues(0,-.5));b.addPole(c.vec2f64.fromValues(0,-.5),h);var q={v0:0,v1:1};b.addVertex(d,h);b.addVertex(e,h);b.addSegment({v0:0,v1:1},q,{v0:3,v1:3});b.addVertex(e,k);b.addVertex(f,k);b.addSegment({v0:2,v1:3},q,{v0:2,v1:1});b.addVertex(f,m);b.addVertex(g,m);b.addSegment({v0:4,v1:5},q,{v0:0,
v1:0});b.addVertex(g,p);b.addVertex(d,p);b.addSegment({v0:6,v1:7},q,{v0:1,v1:2});return b};return a}();b.Profile=l;l=function(){function a(a){this.vertices=[];this.offset=p.vec3f64.create();this.xform=d.mat4f64.create();this.vertices=a;q.vec3.copy(this.offset,this.vertices[Math.floor((a.length-1)/2)].pos);a=0;for(var b=this.vertices;a<b.length;a++){var c=b[a];q.vec3.subtract(c.pos,c.pos,this.offset)}e.mat4.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}a.prototype.updatePathVertexInformation=
function(){var a=this.vertices.length,b=this.vertices[0];b.index=0;q.vec3.set(b.vLeft,0,0,0);b.vLeftLength=0;q.vec3.subtract(b.vRight,this.vertices[1].pos,b.pos);b.vRightLength=q.vec3.length(b.vRight);q.vec3.normalize(b.vRight,b.vRight);for(var c=b,d=1;d<a;++d)b=this.vertices[d],b.index=d,q.vec3.copy(b.vLeft,c.vRight),b.vLeftLength=c.vRightLength,d<a-1?(q.vec3.subtract(b.vRight,this.vertices[d+1].pos,b.pos),b.vRightLength=q.vec3.length(b.vRight),q.vec3.normalize(b.vRight,b.vRight)):(q.vec3.copy(b.vRight,
b.vLeft),b.vRightLength=b.vLeftLength),c=b};return a}();b.Path=l;b.computeMinimumRotationTangentFrame=function(a,b){var c=null,d=a.vertices.length,e=p.vec3f64.create(),f=p.vec3f64.create(),g=p.vec3f64.create(),h=p.vec3f64.create(),k=p.vec3f64.create(),m=p.vec3f64.create(),l=r.plane.create(),v=a.vertices[0];q.vec3.copy(f,b);q.vec3.set(e,0,1,0);x.makeOrthoBasisDirUpFallback(v.vRight,f,e,e,g,f,.99619469809);q.vec3.copy(v.frame.up,f);q.vec3.copy(v.frame.right,g);c=v;for(b=1;b<d;++b){v=a.vertices[b];q.vec3.add(k,
v.vLeft,v.vRight);var u=q.vec3.length(k);0<u?(u=1/Math.sqrt(u),k[0]*=u,k[1]*=u,k[2]*=u):(k[0]=v.vRight[0],k[1]=v.vRight[1],k[2]=v.vRight[2]);q.vec3.add(m,c.pos,c.frame.up);r.plane.fromPositionAndNormal(v.pos,k,l);r.plane.intersectRay(l,r.ray.wrap(m,v.vLeft),h)?(q.vec3.subtract(h,h,v.pos),q.vec3.normalize(f,h),q.vec3.cross(g,k,f),q.vec3.normalize(g,g)):x.makeOrthoBasisDirUpFallback(k,c.frame.up,c.frame.right,e,g,f,.99619469809);q.vec3.copy(v.frame.up,f);q.vec3.copy(v.frame.right,g);c=v}};l=function(){return function(){}}();
b.Extruder=l;l=function(){function a(){}a.prototype.numProfilesPerJoin=function(){return 1};a.prototype.extrude=function(a,b,c){for(var d=0;d<b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],!1)};return a}();b.SimpleExtruder=l;l=function(){function a(a,b){void 0===a&&(a=.8*Math.PI);void 0===b&&(b=1);this.cutoffAngle=a;this.numBendSubdivisions=b}a.prototype.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};a.prototype.extrude=function(a,b,c){var d=N;if(Math.abs(a.rotationAngle)>=
this.cutoffAngle)for(var g=0;g<this.numBendSubdivisions+1;++g){e.mat4.identity(L);e.mat4.rotate(L,L,.5*-a.rotationAngle+g*a.rotationAngle/this.numBendSubdivisions,a.rotationFrame.up);var h=d,k=a.frame,m=L;q.vec3.transformMat4(h.up,k.up,m);q.vec3.transformMat4(h.right,k.right,m);for(h=0;h<b.vertices.length;++h)k=f.vec2.dot(b.vertices[h],a.rotationRight),(k=0<=k*a.rotationAngle)?c(a.index,d,b.vertices[h],b.vertexNormals[h],!1):(f.vec2.transformMat2(z,b.vertices[h],a.miterStretch),c(a.index,a.frame,
z,b.vertexNormals[h],!0))}else for(g=0;g<this.numBendSubdivisions+1;++g)for(h=0;h<b.vertices.length;++h)k=f.vec2.dot(b.vertices[h],a.rotationRight),k=0<=k*a.rotationAngle,f.vec2.transformMat2(z,b.vertices[h],a.miterStretch),c(a.index,a.frame,z,b.vertexNormals[h],k?!1:!0)};return a}();b.MiterExtruder=l;var n={generateUV:!1},l=function(){function a(){}a.prototype.rebuildConnectingProfileGeometry=function(a,b,c){for(var d=0;d<b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],0,
0)};return a}();b.CapBuilder=l;var M=function(a){function b(){return a.call(this)||this}k(b,a);b.prototype.getNumVertices=function(){return 0};b.prototype.getNumIndices=function(){return 0};b.prototype.rebuildCapGeometry=function(a,b){};b.prototype.buildTopology=function(a,b){};return b}(l);b.NoCapBuilder=M;M=function(a){function b(b,c,d){void 0===c&&(c=0);void 0===d&&(d=!1);var e=a.call(this)||this;e.profile=b;e.profilePlaneOffset=c;e.flip=d;return e}k(b,a);b.prototype.getNumVertices=function(){return this.profile.vertices.length};
b.prototype.getNumIndices=function(){return 3*this.profile.numSegments};b.prototype.rebuildConnectingProfileGeometry=function(a,b,c){for(var d=0;d<b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],this.profilePlaneOffset,0)};b.prototype.rebuildCapGeometry=function(a,b){var c=B;f.vec2.set(c,0,0);for(var d=this.flip?1:-1,e=0;e<this.profile.vertices.length;++e)b(a.index,a.frame,this.profile.vertices[e],c,this.profilePlaneOffset,d)};b.prototype.buildTopology=function(a,b){a=this.vertexBufferStart+
this.profile.vertexIndices[0];for(var c=1;c<this.profile.numSegments;++c){var d=this.vertexBufferStart+this.profile.vertexIndices[2*c+0],e=this.vertexBufferStart+this.profile.vertexIndices[2*c+1];this.flip?b(e,d,a):b(a,d,e)}};return b}(l);b.TriangulationCapBuilder=M;l=function(a){function b(b){var c=a.call(this)||this;c.flip=!1;c.sign=0;c.breakNormals=!1;c.numSegments=3;c.profile=b.profile;c.flip=b.flip;c.sign=c.flip?1:-1;c.breakNormals=b.breakNormals;c.numSegments=b.subdivisions;return c}k(b,a);
b.prototype.getNumVertices=function(){var a=0,a=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(a+=this.profile.vertices.length);return a+=this.profile.poles.length};b.prototype.getNumIndices=function(){var a;a=0+2*this.profile.numSegments*(this.numSegments-1);for(var b=0;b<this.profile.numSegments;++b)a=this.profile.poleIndices[this.profile.vertexIndices[2*b+0]]===this.profile.poleIndices[this.profile.vertexIndices[2*b+1]]?a+1:a+2;return 3*a};b.prototype.rebuildCapGeometry=
function(a,b){var c=a.frame,d=.5*this.sign,e=z,g=B;f.vec2.set(g,0,0);for(var h=0;h<this.profile.poles.length;++h){var k=this.profile.poles[h];k.normal?b(a.index,c,k.position,k.normal,d,0):b(a.index,c,k.position,g,d,this.sign)}if(this.breakNormals)for(h=0;h<this.profile.vertices.length;++h)b(a.index,c,this.profile.vertices[h],this.profile.vertexNormals[h],0,0);for(h=0;h<this.numSegments-1;++h)for(var k=(1-(h+1)/this.numSegments)*Math.PI*.5,m=Math.sin(k),p=Math.cos(k),q=0;q<this.profile.vertices.length;++q)k=
this.profile.poles[this.profile.poleIndices[q]],f.vec2.subtract(e,this.profile.vertices[q],k.position),f.vec2.scale(e,e,m),k.normal?(f.vec2.add(e,e,k.position),b(a.index,c,e,k.normal,d*p,0)):(f.vec2.normalize(g,e),f.vec2.scale(g,g,m),f.vec2.add(e,e,k.position),b(a.index,c,e,g,d*p,this.sign*p))};b.prototype.buildTopology=function(a,b){a=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;for(var c=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+
this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length,d=0;d<this.profile.numSegments;++d){for(var e=this.profile.vertexIndices[2*d+0],f=this.profile.vertexIndices[2*d+1],g=this.vertexBufferStart+this.profile.poleIndices[e],h=this.vertexBufferStart+this.profile.poleIndices[f],k=a+e,m=a+f,p=0;p<this.numSegments-1;++p){var q=c+p*this.profile.vertices.length+e,r=c+p*this.profile.vertices.length+f;this.flip?(b(q,m,k),b(m,q,r)):(b(k,m,q),b(r,q,m));k=q;m=r}this.flip?(b(g,m,k),g!==
h&&b(g,h,m)):(b(k,m,g),g!==h&&b(m,h,g))}};return b}(l);b.RoundCapBuilder=l;l=function(){function a(a,b,c,d,e,f){void 0===f&&(f=n);this.options=f;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=b;this.path=a;this.extruder=c;this.startCap=d;this.endCap=e;a=this.path.vertices.length-2;this.numExtrusionProfiles=c.numProfilesPerJoin()*a+2;this.numNormalsTotal=this.numVerticesTotal=b.vertices.length*this.numExtrusionProfiles;
this.startCap.vertexBufferStart=this.numVerticesTotal;b=this.startCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.endCap.vertexBufferStart=this.numVerticesTotal;b=this.endCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*
this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}a.prototype.emitVertex=function(a,b,c,d,e){this.profileRightAxisData[4*this._extrusionVertexCount+0]=b.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=b.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+
2]=b.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=c[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=
a;e?(a=this.path.vertices[a],this.profileRightAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[0]*a.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[1]*a.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};a.prototype.emitCapVertex=function(a,b,c,d,e,f){this.profileRightAxisData[4*this._extrusionVertexCount+0]=b.right[0];this.profileRightAxisData[4*
this._extrusionVertexCount+1]=b.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=b.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=c[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=
d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=a;this.profileRightAxisData[4*this._extrusionVertexCount+3]=e;this.profileUpAxisData[4*this._extrusionVertexCount+3]=f;++this._extrusionVertexCount};a.prototype.emitTriangle=function(a,b,c){this.vertexIndices[3*this._triangleCount+0]=a;this.vertexIndices[3*this._triangleCount+1]=b;this.vertexIndices[3*this._triangleCount+2]=c;this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[a];
this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[b];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[c];this.normalIndices[3*this._triangleCount+0]=a;this.normalIndices[3*this._triangleCount+1]=b;this.normalIndices[3*this._triangleCount+2]=c;++this._triangleCount};a.prototype.rebuildGeometry=function(){for(var a=this.emitVertex.bind(this),b=this.emitCapVertex.bind(this),c=this._extrusionVertexCount=0,d=this.path.vertices;c<d.length;c++){var e=d[c];this.originData[3*
e.index+0]=e.pos[0];this.originData[3*e.index+1]=e.pos[1];this.originData[3*e.index+2]=e.pos[2]}this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,b);for(c=1;c<this.path.vertices.length-1;++c)this.extruder.extrude(this.path.vertices[c],this.profile,a);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,b);this.startCap.rebuildCapGeometry(this.path.vertices[0],b);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-
1],b);if(this.profile.hasUV()&&this.options.generateUV)for(c=0;c<this.profile.uvs.length;++c)this.uvData[2*c+0]=this.profile.uvs[c],this.uvData[2*c+1]=0};a.prototype.buildTopology=function(){var a=this.emitTriangle.bind(this);this._triangleCount=0;var b=this.profile.vertices.length,c=this.profile.numSegments,d=this.numExtrusionProfiles-1,e=c*d*6;this.startCap.indexBufferStart=e;this.startCap.firstProfileVertexIndex=0;e+=this.startCap.getNumIndices();this.endCap.indexBufferStart=e;this.endCap.firstProfileVertexIndex=
b*(this.numExtrusionProfiles-1);e+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(e);this.normalIndices=new Uint32Array(e);this.pathVertexIndices=new Uint32Array(e);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(e));for(e=0;e<c;++e)for(var f=this.profile.vertexIndices[2*e],g=this.profile.vertexIndices[2*e+1],h=0;h<d;++h){var k=h*b+f,m=(h+1)*b+g,p=h*b+g;a(k,(h+1)*b+f,m);a(k,m,p)}this.startCap.buildTopology(this.path.vertices[0],a);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-
1],a)};a.prototype.onPathChanged=function(){this.rebuildGeometry()};return a}();b.Builder=l;l=function(){function a(a){this.builder=a}Object.defineProperty(a.prototype,"xform",{get:function(){return this.builder.path.xform},enumerable:!0,configurable:!0});a.prototype.onPathChanged=function(){this.builder.onPathChanged()};return a}();b.PathGeometry=l;var Y=function(a){function b(b){b=a.call(this,b)||this;b.vertexAttributePosition=null;b.vertexAttributeNormal=null;b.vertexAttributeColor=null;b.vertexAttributePosition=
new Float32Array(3*b.builder.numVerticesTotal);b.vertexAttributeNormal=new Float32Array(3*b.builder.numNormalsTotal);b.vertexAttributeColor=new Uint8Array(4);b.vertexAttributeColor[0]=255;b.vertexAttributeColor[1]=255;b.vertexAttributeColor[2]=255;b.vertexAttributeColor[3]=255;return b}k(b,a);b.prototype.bakeVertexColors=function(a){this.vertexAttributeColor[0]=255*a[0];this.vertexAttributeColor[1]=255*a[1];this.vertexAttributeColor[2]=255*a[2];this.vertexAttributeColor[3]=255*(3<a.length?a[3]:1)};
b.prototype.bake=function(a){this.size=a;for(var b=0;b<this.builder.numVerticesTotal;++b){var c=this.builder.pathVertexData[b],d=0===c||c===this.builder.path.vertices.length-1,e=v;q.vec3.set(e,this.builder.originData[3*c+0],this.builder.originData[3*c+1],this.builder.originData[3*c+2]);var g=D,k=z,c=K,m=I,p=Q,r=0,l=0;q.vec3.set(m,this.builder.profileRightAxisData[4*b+0],this.builder.profileRightAxisData[4*b+1],this.builder.profileRightAxisData[4*b+2]);q.vec3.set(p,this.builder.profileUpAxisData[4*
b+0],this.builder.profileUpAxisData[4*b+1],this.builder.profileUpAxisData[4*b+2]);f.vec2.set(k,this.builder.profileVertexAndNormalData[4*b+0]*a[0],this.builder.profileVertexAndNormalData[4*b+1]*a[1]);if(d)q.vec3.cross(c,p,m),r=this.builder.profileRightAxisData[4*b+3]*a[0],l=this.builder.profileUpAxisData[4*b+3];else{var d=B,u=C;f.vec2.set(d,this.builder.profileRightAxisData[4*b+3],this.builder.profileUpAxisData[4*b+3]);var t=f.vec2.length(d);f.vec2.normalize(d,d);var y=f.vec2.dot(k,d);if(Math.abs(y)>
t){f.vec2.set(u,-d[1],d[0]);var x=f.vec2.dot(k,u);f.vec2.scale(d,d,t*h.sign(y));f.vec2.scale(u,u,x);f.vec2.add(k,d,u)}q.vec3.set(c,0,0,0)}q.vec3.set(g,m[0]*k[0]+p[0]*k[1],m[1]*k[0]+p[1]*k[1],m[2]*k[0]+p[2]*k[1]);this.vertexAttributePosition[3*b+0]=e[0]+g[0]+c[0]*r;this.vertexAttributePosition[3*b+1]=e[1]+g[1]+c[1]*r;this.vertexAttributePosition[3*b+2]=e[2]+g[2]+c[2]*r;e=z;f.vec2.set(e,this.builder.profileVertexAndNormalData[4*b+2],this.builder.profileVertexAndNormalData[4*b+3]);this.vertexAttributeNormal[3*
b+0]=m[0]*e[0]+p[0]*e[1]+c[0]*l;this.vertexAttributeNormal[3*b+1]=m[1]*e[0]+p[1]*e[1]+c[1]*l;this.vertexAttributeNormal[3*b+2]=m[2]*e[0]+p[2]*e[1]+c[2]*l}};b.prototype.createGeometryData=function(){var a={};a[w.VertexAttrConstants.POSITION]=this.builder.vertexIndices;a[w.VertexAttrConstants.NORMAL]=this.builder.normalIndices;this.vertexAttributeColor&&(a[w.VertexAttrConstants.COLOR]=new Uint32Array(a[w.VertexAttrConstants.POSITION].length));var b={};b[w.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition};
b[w.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal};this.vertexAttributeColor&&(b[w.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor});return new t.GeometryData(b,a,t.GeometryData.DefaultOffsets,"triangle")};b.prototype.onPathChanged=function(){a.prototype.onPathChanged.call(this);this.bake(this.size)};b.prototype.intersect=function(a,b,c){var d=this.builder.vertexIndices;u.intersectTriangles(a,b,0,d.length/3,d,{size:3,offsetIdx:0,strideIdx:3,data:this.vertexAttributePosition},
void 0,c)};return b}(l);b.StaticPathGeometry=Y;l=function(a){function b(b,c,d,e){var f=a.call(this,b)||this;f.sizeAttributeValue=c;f.colorAttributeValue=d;f.opacityAttributeValue=e;f.vvData=null;f.baked=new Y(b);f.vvData=new Float32Array(4*f.builder.path.vertices.length);for(b=0;b<f.builder.path.vertices.length;++b)f.vvData[4*b+0]=c,f.vvData[4*b+1]=d,f.vvData[4*b+2]=e,f.vvData[4*b+3]=0===b||b===f.builder.path.vertices.length-1?1:0;return f}k(b,a);b.prototype.createGeometryData=function(){var a={};
a[y.VertexAttrConstants.POSITION]=this.builder.pathVertexIndices;a[y.VertexAttrConstants.PROFILERIGHT]=this.builder.vertexIndices;a[y.VertexAttrConstants.PROFILEUP]=this.builder.vertexIndices;a[y.VertexAttrConstants.PROFILEVERTEXANDNORMAL]=this.builder.vertexIndices;a[y.VertexAttrConstants.FEATUREVALUE]=this.builder.pathVertexIndices;var b={};b[y.VertexAttrConstants.POSITION]={size:3,data:this.builder.originData};b[y.VertexAttrConstants.PROFILERIGHT]={size:4,data:this.builder.profileRightAxisData};
b[y.VertexAttrConstants.PROFILEUP]={size:4,data:this.builder.profileUpAxisData};b[y.VertexAttrConstants.PROFILEVERTEXANDNORMAL]={size:4,data:this.builder.profileVertexAndNormalData};b[y.VertexAttrConstants.FEATUREVALUE]={size:4,data:this.vvData};return new t.GeometryData(b,a,t.GeometryData.DefaultOffsets,"triangle")};return b}(l);b.FastUpdatePathGeometry=l})(m||(m={}));var v=p.vec3f64.create(),z=c.vec2f64.create(),B=c.vec2f64.create(),C=c.vec2f64.create(),D=p.vec3f64.create(),K=p.vec3f64.create(),
I=p.vec3f64.create(),Q=p.vec3f64.create(),J=p.vec3f64.create(),N=m.makeFrame(),L=d.mat4f64.create();return m})},"esri/core/libs/gl-matrix-2/mat2f64":function(){define(["require","exports","./factories/mat2f64"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat2f64=l})},"esri/core/libs/gl-matrix-2/factories/mat2f64":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,1]};b.clone=function(b){return[b[0],
b[1],b[2],b[3]]};b.fromValues=function(b,k,h,a){return[b,k,h,a]};b.createView=function(b,k){return new Float64Array(b,k,4)}})},"esri/views/3d/webgl-engine/shaders/PathPrograms":function(){define(["require","exports","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.VertexAttrConstants={POSITION:"position",PROFILERIGHT:"profileRight",PROFILEUP:"profileUp",PROFILEVERTEXANDNORMAL:"profileVertexAndNormal",FEATUREVALUE:"featureValue"};
b.vertexAttributeLocations={position:0,profileRight:1,profileUp:2,profileVertexAndNormal:3,featureValue:4};var h=function(a){return k.glslifyDefineMap({FLIPV:a.flipV,DOUBLESIDED:a.doubleSided,WINDINGORDERDOUBLESIDED:a.windowOrderDoubleSided,RECEIVE_SHADOWS:a.receiveShadows,RECEIVE_SSAO:a.receiveSSAO,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VV_OPACITY:a.vvOpacity,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,SLICE:a.slice,TRANSPARENCY_DISCARD:a.transparencyDiscard,BIAS_SHADOWMAP:a.shadowMap,WIREFRAME:a.wireframe})};
b.colorPass={name:"path-color",shaders:function(a){return{vertexShader:h(a)+l.resolveIncludes("materials/pathMaterial/colorPass.vert"),fragmentShader:h(a)+l.resolveIncludes("materials/pathMaterial/colorPass.frag")}},attributes:b.vertexAttributeLocations};b.depthPass={name:"path-depth",shaders:function(a){return{vertexShader:h(a)+l.resolveIncludes("materials/pathMaterial/depthPass.vert"),fragmentShader:h(a)+l.resolveIncludes("materials/pathMaterial/depthPass.frag")}},attributes:b.vertexAttributeLocations};
b.normalPass={name:"path-normal",shaders:function(a){return{vertexShader:h(a)+l.resolveIncludes("materials/pathMaterial/normalPass.vert"),fragmentShader:h(a)+l.resolveIncludes("materials/pathMaterial/normalPass.frag")}},attributes:b.vertexAttributeLocations};b.highlightPass={name:"path-highlight",shaders:function(a){return{vertexShader:h(a)+l.resolveIncludes("materials/pathMaterial/highlightPass.vert"),fragmentShader:h(a)+l.resolveIncludes("materials/pathMaterial/highlightPass.frag")}},attributes:b.vertexAttributeLocations}})},
"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./VisualVariableMaterialParameters ./internal/bufferWriterUtils ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/PathPrograms ../../../webgl/renderState".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u){function y(a,b){b.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors));b.vvOpacityEnabled&&(a.setUniform1fv("vvOpacityValues",b.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",
b.vvOpacityOpacities))}var m=c.assert;n=function(b){function c(a,d){d=b.call(this,d)||this;d.supportsEdges=!0;d.params=t.copyParameters(a,K);d.vertexBufferLayout=c.getVertexBufferLayout(d.params);return d}k(c,b);c.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};c.prototype.isVisible=function(){var a=this.params;if(!b.prototype.isVisible.call(this)||0===a.layerOpacity)return!1;var c="replace"===a.colorMixMode,d=0<a.opacity,e=a.externalColor&&0<a.externalColor[3];return a.vvColorEnabled?
c?!0:d:c?e:d};c.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)b[c]=a[c];this.notifyDirty("matChanged")};c.prototype.getParameters=function(){return this.params};c.prototype.intersect=function(b,c,d,e,f,g,k,m){if(b.metadata){c=b.metadata.pathGeometry;d=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){m=this.params.vvSizeOffset;var p=this.params.vvSizeFactor,q=this.params.vvSizeMinSize,r=this.params.vvSizeMaxSize,l=c.sizeAttributeValue;d[0]*=h.clamp(m[0]+
l*p[0],q[0],r[0]);d[1]*=h.clamp(m[1]+l*p[1],q[1],r[1])}m=Math.max(d[0],d[1]);b=a.fromValues(b.boundingInfo.bbMin[0]-m,b.boundingInfo.bbMin[1]-m,b.boundingInfo.bbMin[2]-m,b.boundingInfo.bbMax[0]+m,b.boundingInfo.bbMax[1]+m,b.boundingInfo.bbMax[2]+m);m=[g[0]-f[0],g[1]-f[1],g[2]-f[2]];p=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]);t.intersectAabbInvDir(b,f,[p/m[0],p/m[1],p/m[2]],e.tolerance)&&(c.baked.size&&c.baked.size[0]===d[0]&&c.baked.size[1]===d[1]||c.baked.bake(d),c.baked.intersect(f,g,k))}};c.prototype.createBufferWriter=
function(){return new I(this.vertexBufferLayout)};c.prototype.createRenderer=function(a,b){return new x(a,b,this,w.vertexAttributeLocations)};c.prototype.getGLMaterials=function(){return{color:v,depth:z,depthShadowMap:this.params.castShadows?B:null,normal:C,highlight:D}};c.getVertexBufferLayout=function(a){var b=e.newLayout().vec3f(w.VertexAttrConstants.POSITION).vec4f(w.VertexAttrConstants.PROFILERIGHT).vec4f(w.VertexAttrConstants.PROFILEUP).vec4f(w.VertexAttrConstants.PROFILEVERTEXANDNORMAL);if(a.vvColorEnabled||
a.vvSizeEnabled||a.vvOpacityEnabled)b=b.vec4f(w.VertexAttrConstants.FEATUREVALUE);return b};return c}(f.Material);var v=function(a){function b(b){var c=a.call(this,b)||this;c.params=t.copyParameters(b.material.getParameters());c.slot=c.params.transparent?7:5;c._createPrograms();c.selectPipeline();return c}k(b,a);b.prototype._createPrograms=function(){var a=this;this.programs=r.BindParametersMap.create(this.params,function(b){return a._createProgram(b)})};b.prototype._createProgram=function(a){var b=
this.params;return this.programRep.getProgram(w.colorPass,{flipV:b.flipV,doubleSided:b.doubleSided&&"normal"===b.doubleSidedType,windowOrderDoubleSided:b.doubleSided&&"winding-order"===b.doubleSidedType,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,vvOpacity:b.vvOpacityEnabled,verticalOffset:null!==b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,transparencyDiscard:b.transparent,wireframe:b.wireframe})};
b.prototype.selectPipeline=function(){var a=this.params;this.pipelineState=u.makePipelineState({blending:a.transparent&&u.separateBlendingParams(770,1,771,771),culling:J(a),polygonOffset:a.polygonOffset&&Q,depthTest:{func:513},depthWrite:u.defaultDepthWriteParams,colorWrite:u.defaultColorWriteParams})};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};b.prototype.getPrograms=function(){return r.BindParametersMap.programs(this.programs)};
b.prototype.updateParameters=function(){this.params=t.copyParameters(this.material.getParameters());this.slot=this.params.transparent?7:5;this._createPrograms();this.selectPipeline()};b.prototype.bind=function(a,b){var c=this.params,d=this.program=r.BindParametersMap.lookup(this.programs,b);a.bindProgram(d);a.setPipelineState(this.pipelineState);d.setUniform3fv("size",c.size);d.setUniform3fv("ambient",c.ambient);d.setUniform3fv("diffuse",c.diffuse);d.setUniform3fv("specular",c.specular);d.setUniform4fv("externalColor",
c.externalColor);d.setUniform1i("colorMixMode",t.colorMixModes[c.colorMixMode]);d.setUniform1f("opacity",c.opacity);d.setUniform1f("layerOpacity",c.layerOpacity);t.bindVerticalOffset(c.verticalOffset,b,d);t.bindScreenSizePerspective(c.screenSizePerspective,d);y(d,c)};b.prototype.release=function(a,b){};b.prototype.bindView=function(a,b){a=this.program=r.BindParametersMap.lookup(this.programs,b);var c=this.params,d=b.origin;t.bindView(d,b.view,a);t.bindCamPos(d,b.viewInvTransp,a);c.slicePlaneEnabled&&
t.bindSlicePlane(d,b.slicePlane,a);b.shadowMappingEnabled&&b.shadowMap.bindView(a,d)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return b}(d),z=function(a){function b(b){var c=a.call(this,b)||this;c.biased=!!b.biased;c.updateParameters();return c}k(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=
function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(w.depthPass,{flipV:a.flipV,shadowMap:this.biased,vvSize:a.vvSizeEnabled,vvColor:a.vvColorEnabled,vvOpacity:a.vvOpacityEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,transparencyDiscard:a.transparent});this.pipelineState=u.makePipelineState({culling:J(a),polygonOffset:a.polygonOffset&&Q,depthTest:{func:513},
depthWrite:u.defaultDepthWriteParams,colorWrite:u.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?7:5};b.prototype.updateParameters=function(){this.params=t.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot()};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);c.setUniform3fv("size",d.size);c.setUniform2fv("nearFar",b.nearFar);t.bindVerticalOffset(d.verticalOffset,
b,c);t.bindScreenSizePerspective(d.screenSizePerspective,c);y(c,d)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=b.origin;t.bindView(d,b.view,a);c.slicePlaneEnabled&&t.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&t.bindCamPos(d,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return b}(d),
B=function(a){function b(b){return a.call(this,l({},b,{biased:!0}))||this}k(b,a);return b}(z),C=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}k(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(w.normalPass,{flipV:a.flipV,vvSize:a.vvSizeEnabled,vvColor:a.vvColorEnabled,vvOpacity:a.vvOpacityEnabled,verticalOffset:null!==
a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,transparencyDiscard:a.transparent});this.pipelineState=u.makePipelineState({polygonOffset:a.polygonOffset&&Q,culling:J(a),depthTest:{func:513},depthWrite:u.defaultDepthWriteParams,colorWrite:u.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?7:5};b.prototype.updateParameters=function(){this.params=t.copyParameters(this.material.getParameters());this.selectProgram();
this.selectSlot()};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);c.setUniform3fv("size",d.size);t.bindVerticalOffset(d.verticalOffset,b,c);t.bindScreenSizePerspective(d.screenSizePerspective,c);y(c,d)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=b.origin;t.bindView(d,b.view,a);a.setUniformMatrix4fv("viewNormal",b.viewInvTransp);c.slicePlaneEnabled&&t.bindSlicePlane(b.origin,
b.slicePlane,a);c.screenSizePerspective&&t.bindCamPos(d,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return b}(d),D=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}k(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};
b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(w.highlightPass,{flipV:a.flipV,vvSize:a.vvSizeEnabled,vvColor:a.vvColorEnabled,vvOpacity:a.vvOpacityEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,transparencyDiscard:a.transparent});this.pipelineState=u.makePipelineState({polygonOffset:a.polygonOffset&&Q,culling:J(a),depthTest:{func:513},depthWrite:u.defaultDepthWriteParams,
colorWrite:u.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?7:5};b.prototype.updateParameters=function(){this.params=t.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot()};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);c.setUniform3fv("size",d.size);t.bindVerticalOffset(d.verticalOffset,b,c);t.bindScreenSizePerspective(d.screenSizePerspective,c);
y(c,d)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=b.origin;t.bindView(d,b.view,a);c.slicePlaneEnabled&&t.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&t.bindCamPos(d,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return b}(d),
K=l({size:[1,1,1],wireframe:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,transparent:!1,polygonOffset:!1},q.Default),I=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=
function(a){return a.indices[w.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d){if(w.VertexAttrConstants.PROFILERIGHT in b.vertexAttr){var e=b.vertexAttr[w.VertexAttrConstants.PROFILERIGHT],f=b.indices[w.VertexAttrConstants.PROFILERIGHT];m(4===e.size);var h=c.getField(w.VertexAttrConstants.PROFILERIGHT,g.BufferViewVec4f);if(h)p.writeBufferVec4(f,e.data,h,d);else throw Error("unable to acquire view for "+w.VertexAttrConstants.PROFILERIGHT);}if(w.VertexAttrConstants.PROFILEUP in
b.vertexAttr)if(e=b.vertexAttr[w.VertexAttrConstants.PROFILEUP],f=b.indices[w.VertexAttrConstants.PROFILEUP],m(4===e.size),h=c.getField(w.VertexAttrConstants.PROFILEUP,g.BufferViewVec4f))p.writeBufferVec4(f,e.data,h,d);else throw Error("unable to acquire view for "+w.VertexAttrConstants.PROFILEUP);if(w.VertexAttrConstants.PROFILEVERTEXANDNORMAL in b.vertexAttr)if(e=b.vertexAttr[w.VertexAttrConstants.PROFILEVERTEXANDNORMAL],f=b.indices[w.VertexAttrConstants.PROFILEVERTEXANDNORMAL],m(4===e.size),h=
c.getField(w.VertexAttrConstants.PROFILEVERTEXANDNORMAL,g.BufferViewVec4f))p.writeBufferVec4(f,e.data,h,d);else throw Error("unable to acquire view for "+w.VertexAttrConstants.PROFILEVERTEXANDNORMAL);if(this.vertexBufferLayout.hasField(w.VertexAttrConstants.FEATUREVALUE)&&w.VertexAttrConstants.FEATUREVALUE in b.vertexAttr)if(e=b.vertexAttr[w.VertexAttrConstants.FEATUREVALUE],f=b.indices[w.VertexAttrConstants.FEATUREVALUE],m(4===e.size),h=c.getField(w.VertexAttrConstants.FEATUREVALUE,g.BufferViewVec4f))p.writeBufferVec4(f,
e.data,h,d);else throw Error("unable to acquire view for "+w.VertexAttrConstants.FEATUREVALUE);p.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d)};return a}(),Q={factor:2,units:2},J=function(a){var b;b=a.slicePlaneEnabled?!1:a.cullFace?"none"!==a.cullFace:!a.transparent&&!a.doubleSided;return b&&{face:"front"===a.cullFace?1028:1029,mode:2305}};return n})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./constants ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function q(a,c,d,e){return b.call(this,a,c,d,e)||this}l(q,b);q.prototype.doLoad=function(){return h(this,void 0,void 0,function(){return k(this,function(a){this._prepareFillResources();this._prepareOutlineResources();return[2]})})};q.prototype._prepareFillResources=function(){var a=g.get(this.symbolLayer,"material","color"),a=this._getCombinedOpacityAndColor(a);this._material=
new K({color:a,transparent:1>a[3]||this._isPropertyDriven("opacity"),polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},this._getIdHint("_colormat"));this._context.stage.add(3,this._material)};q.prototype._prepareOutlineResources=function(){var a=this.symbolLayer.outline;if(this._hasOutline=!!(g.isSome(a)&&a.size&&0<a.size&&g.isSome(a.color)))a=e.pt2px(g.isSome(a)?a.size:0),a=1.5<=a?new Q({width:a,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},
this._getIdHint("_outline_ribbonlinemat")):new I({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled},this._getIdHint("_outline_nativelinemat")),this._outlineMaterial=a,this._context.stage.add(3,this._outlineMaterial)};q.prototype.destroy=function(){b.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null);this._outlineMaterial&&(this._context.stage.remove(3,this._outlineMaterial.id),this._outlineMaterial=null)};
q.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,q.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var d=this.getGraphicElevationContext(b);return"on-the-ground"===d.mode?this._createAsOverlay(b,a,d,c):this._createAs3DShape(b,a,d,c,b.uid)};q.prototype.layerOpacityChanged=function(){var a=this._material.getParameters().color,
b=g.get(this.symbolLayer,"material","color"),b=this._getCombinedOpacity(b);this._material.setParameterValues({color:[a[0],a[1],a[2],b],transparent:1>b||this._isPropertyDriven("opacity")});this._outlineMaterial&&(a=this._outlineMaterial.getParameters().color,this._outlineMaterial.setParameterValues({color:[a[0],a[1],a[2],this._getOutlineOpacity()]}));return!0};q.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=u.elevationModeChangeUpdateType(q.elevationModeChangeTypes,
c,d);if(c!==u.SymbolUpdateType.UPDATE)return c;var e=u.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};q.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._outlineMaterial&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};q.prototype.physicalBasedRenderingChanged=function(a,b){return!0};q.prototype.pixelRatioChanged=
function(a,b){return!0};q.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a+b/2,c.add(this._material.id));this._outlineMaterial&&(this._outlineMaterial.renderPriority=a,c.add(this._outlineMaterial.id))};q.prototype._createAs3DShape=function(a,b,c,d,e){var f=u.getGeometryAsPolygon(a.geometry);a=u.getGeometryVertexData3D(f.rings,f.hasZ,f.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,
c);L.idHint=d;L.color=b;L.data=a;var g;this._hasOutline&&(g=new Float64Array(a.vertexData));L.outNum=0;L.outGeometries=[];L.outTransforms=[];L.outMaterials=[];this._createAs3DShapeFill(L);L.data.vertexData=g;this._createAs3DShapeOutline(L);this._logGeometryCreationWarnings(L.data,f.rings,"rings","FillSymbol3DLayer");if(0===L.outNum)return null;b=new C({geometries:L.outGeometries,materials:L.outMaterials,transformations:L.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e},
idHint:d});b=new w(this,b,L.outGeometries,null,null,t.perVertexElevationAligner,c);b.alignedTerrainElevation=a.terrainElevation;b.needsElevationUpdates=u.needsElevationUpdates2D(c.mode);return b};q.prototype._createAs3DShapeFill=function(a){for(var b=a.data.geometryData.polygons,e=a.data.eleVertexData,g=a.data.vertexData,h=function(h){var m=b[h],p=m.count,q=m.index;if(k._context.clippingExtent&&(u.computeBoundingBox(e,q,p,J),u.boundingBoxClipped(J,k._context.clippingExtent)))return"continue";h=new Float64Array(e.buffer,
3*q*e.BYTES_PER_ELEMENT,3*p);m=m.holeIndices.map(function(a){return a-q});m=d(h,m,3);if(0===m.length)return"continue";u.applyOrigin(g,q,p,N);m=new Uint32Array(m);p=new Float64Array(g.buffer,3*q*g.BYTES_PER_ELEMENT,3*p);h=z.createPolygonGeometryData({indices:m,vertices:p,color:a.color,eleVertices:h});h=new B(h,a.idHint);h.singleUse=!0;p=c.mat4f64.create();f.mat4.translate(p,p,N);a.outGeometries.push(h);a.outMaterials.push(k._material);a.outTransforms.push(p);a.outNum++},k=this,m=0;m<b.length;++m)h(m)};
q.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var b=a.data.geometryData.outlines,d=a.data.eleVertexData,e=a.data.vertexData,g=0;g<b.length;++g){var h=b[g],k=h.index,m=h.count;if(this._context.clippingExtent&&(u.computeBoundingBox(d,k,m,J),u.boundingBoxClipped(J,this._context.clippingExtent)))continue;u.applyOrigin(e,k,m,N);h=new Float64Array(d.buffer,3*k*d.BYTES_PER_ELEMENT,3*m);k=new Float64Array(e.buffer,3*k*e.BYTES_PER_ELEMENT,3*m);k=v.createPolylineGeometry(k,h,!1,r.WHITE,
1);k=new B(k,a.idHint+"outline"+g);k.singleUse=!0;h=c.mat4f64.create();f.mat4.translate(h,h,N);a.outGeometries.push(k);a.outMaterials.push(this._outlineMaterial);a.outTransforms.push(h);a.outNum++}};q.prototype._createAsOverlay=function(a,b,c,d){c=u.getGeometryAsPolygon(a.geometry);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);var e=u.getGeometryVertexDataDraped(c.rings,c.spatialReference,
this._context.overlaySR);L.idHint=d;L.color=b;L.data=e;var f;this._hasOutline&&(f=new Float64Array(e.vertexData));L.outNum=0;L.outGeometries=[];L.outBoundingBox=p.empty();L.layerUid=this._context.layer.uid;L.graphicsUid=a.uid;this._createAsOverlayFill(L);L.data.vertexData=f;this._createAsOverlayOutline(L);this._logGeometryCreationWarnings(L.data,c.rings,"rings","FillSymbol3DLayer");return 0<L.outNum?new x(this,L.outGeometries,L.outBoundingBox):null};q.prototype._createAsOverlayFill=function(a){for(var b=
a.data.vertexData,e=a.data.geometryData.polygons,g=function(g){var k=e[g];g=k.count;var m=k.index;u.computeBoundingBox(b,m,g,J);if(u.boundingBoxClipped(J,h._context.clippingExtent))return"continue";var q=new Float64Array(b.buffer,3*m*b.BYTES_PER_ELEMENT,3*g),k=k.holeIndices.map(function(a){return a-m}),q=d(q,k,3);if(0===q.length)return"continue";p.expand(a.outBoundingBox,J);u.applyOrigin(b,m,g,N);u.setZ(b,m,g,h._getDrapedZ());g=new Uint32Array(q.length);for(k=0;k<q.length;k++)g[k]=q[k]+m;g=z.createPolygonGeometryData({indices:g,
vertices:b,color:a.color});q=new D(g);q.data.layerUid=a.layerUid;q.data.graphicUid=a.graphicsUid;q.material=h._material;k=J;q.center=[.5*(k[0]+k[3]),.5*(k[1]+k[4]),0];q.bsRadius=.5*Math.sqrt((k[3]-k[0])*(k[3]-k[0])+(k[4]-k[1])*(k[4]-k[1]));k=c.mat4f64.create();f.mat4.translate(k,k,N);q.transformation=k;q.name=a.idHint;q.uniqueName=a.idHint+"#"+g.id;a.outGeometries.push(q);a.outNum++},h=this,k=0;k<e.length;++k)g(k)};q.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var b=a.data.vertexData,
d=a.data.geometryData.outlines,e=0;e<d.length;++e){var g=d[e],h=g.index,g=g.count;u.computeBoundingBox(b,h,g,J);if(!u.boundingBoxClipped(J,this._context.clippingExtent)){p.expand(a.outBoundingBox,J);u.applyOrigin(b,h,g,N);u.setZ(b,h,g,this._getDrapedZ());h=new Float64Array(b.buffer,3*h*b.BYTES_PER_ELEMENT,3*g);h=v.createPolylineGeometry(h,null,!0,r.WHITE,1);g=new D(h);g.data.layerUid=a.layerUid;g.data.graphicUid=a.graphicsUid;g.material=this._outlineMaterial;var k=J;g.center=[.5*(k[0]+k[3]),.5*(k[1]+
k[4]),0];g.bsRadius=.5*Math.sqrt((k[3]-k[0])*(k[3]-k[0])+(k[4]-k[1])*(k[4]-k[1]));k=c.mat4f64.create();f.mat4.translate(k,k,N);g.transformation=k;g.name=a.idHint+"outline";g.uniqueName=a.idHint+"outline#"+h.id;a.outGeometries.push(g);a.outNum++}}};q.prototype._getOutlineOpacity=function(){var a=g.get(this.symbolLayer,"outline","color");return this._getLayerOpacity()*(g.isSome(a)?a.a:0)};q.prototype._getOutlineColor=function(){var b=g.get(this.symbolLayer,"outline","color"),c=this._getOutlineOpacity();
return m.mixinColorAndOpacity(g.isSome(b)?a.toUnitRGB(b):null,c)};q.validGeometryTypes=["polyline","polygon","extent"];q.elevationModeChangeTypes={definedChanged:u.SymbolUpdateType.RECREATE,staysOnTheGround:u.SymbolUpdateType.NONE,onTheGroundChanged:u.SymbolUpdateType.RECREATE};return q}(y.default);b.Graphics3DPolygonFillSymbolLayer=n;var J=p.create(),N=q.vec3f64.create(),L={idHint:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null,color:null};b.default=
n})},"esri/views/3d/layers/graphics/polygonUtils":function(){define(["require","exports","../../webgl-engine/lib/GeometryData","../../webgl-engine/lib/Util"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.createPolygonGeometryData=function(b){var a={},g={};g[k.VertexAttrConstants.POSITION]={size:3,data:b.vertices};a[k.VertexAttrConstants.POSITION]=b.indices;if(b.color){var e=new Uint32Array(b.indices.length);g[k.VertexAttrConstants.COLOR]={size:4,data:b.color};a[k.VertexAttrConstants.COLOR]=
e}b.uv0&&(g[k.VertexAttrConstants.UV0]={size:2,data:b.uv0},a[k.VertexAttrConstants.UV0]=b.indices);b.eleVertices&&(g.mapPos={size:3,data:b.eleVertices},a.mapPos=b.indices);return new l.GeometryData(g,a)}})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../lib/GLMaterial ../lib/Material ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/ColorPrograms ../../../webgl/renderState".split(" "),
function(n,b,l,k,h,a,g,e,d,f){n=function(b){function d(a,c){c=b.call(this,c)||this;c.supportsEdges=!0;c.params=g.copyParameters(a,p);return c}l(d,b);d.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)b[c]=a[c];this.notifyDirty("matChanged")};d.prototype.getParameters=function(){return this.params};d.prototype.intersect=function(a,b,c,d,e,f,h,k,p){g.intersectTriangleGeometry(a,b,d,e,f,h)};d.prototype.getGLMaterials=function(){return{color:c,depthShadowMap:void 0,normal:void 0,
depth:void 0,highlight:q}};d.prototype.createBufferWriter=function(){return new a.DefaultBufferWriter(a.PositionColorLayout)};d.prototype.createRenderer=function(a,b){return new e(a,b,this)};return d}(h.Material);var c=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}l(b,a);b.prototype.updateParameters=function(){this.params=g.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(d.colorPass,
{vertexColors:a.vertexColors,slice:a.slicePlaneEnabled});this.pipelineState=f.makePipelineState({blending:a.transparent&&f.separateBlendingParams(770,1,771,771),polygonOffset:a.polygonOffset&&r,culling:t(a.cullFace),depthTest:a.testDepth&&{func:513},depthWrite:a.writeDepth&&f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams})};b.prototype.beginSlot=function(a){var b=5;this.params.transparent&&(b=this.params.writeDepth?7:10);return a===b};b.prototype.getProgram=function(){return this.program};
b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);b.setUniform4fv("eColor",c.color)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;g.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&g.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 4};return b}(k),
q=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}l(b,a);b.prototype.updateParameters=function(){this.params=g.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(d.colorPass,{vertexColors:a.vertexColors,slice:a.slicePlaneEnabled});this.pipelineState=f.makePipelineState({polygonOffset:a.polygonOffset&&r,culling:t(a.cullFace),depthTest:a.testDepth&&{func:513},
depthWrite:a.writeDepth&&f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams})};b.prototype.beginSlot=function(a){return 5===a};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);g.bindHighlightRendering(a,b,c);c.setUniform4fv("eColor",d.color)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;g.bindView(b.origin,
b.view,a);c.slicePlaneEnabled&&g.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 4};return b}(k),p={color:[1,1,1,1],transparent:!1,writeDepth:!0,testDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:"none"},r={factor:1,units:1},t=function(a){return"none"!==a&&{face:"front"===a?1028:1029,mode:2305}};return n})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["require",
"exports","../../../support/buffer/InterleavedLayout","../../lib/Util","./bufferWriterUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});b.PositionUVLayout=l.newLayout().vec3f(k.VertexAttrConstants.POSITION).vec2f(k.VertexAttrConstants.UV0);b.PositionColorLayout=l.newLayout().vec3f(k.VertexAttrConstants.POSITION).vec4u8(k.VertexAttrConstants.COLOR);n=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return a.indices[k.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,d,f){h.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,d,f)};return a}();b.DefaultBufferWriter=n})},"esri/views/3d/webgl-engine/shaders/ColorPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",
{value:!0});var a=function(a){return h.glslifyDefineMap({VERTEX_COLORS:a.vertexColors,SLICE:a.slice})};b.colorPass={name:"color-color",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("materials/color/color.vert"),fragmentShader:a(b)+k.resolveIncludes("materials/color/color.frag")}},attributes:l.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z){function B(a,b,c){a&&a.forEach(function(a){var d=b(a);g.isSome(d)&&c(d,a.graphic)})}Object.defineProperty(b,"__esModule",{value:!0});var C=[0,0,1];n=function(b){function t(a,c,d,f){a=b.call(this,a,c,d,f)||this;a._geometryDataPool=new e(u.GeometryData,function(a,b,c){var d=b.translation;c=g.isSome(c)?[c.displayWidth,c.displayHeight]:[0,0];b=b.centerOffset;0===a.indexCount?y.createPointGeometry(C,d,null,c,b,[0,0],null,a):y.updatePointGeometry(null,
d,null,c,b,null,null,a)});a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}l(t,b);t.prototype.doLoad=function(){return h(this,void 0,void 0,function(){var b;return k(this,function(c){if(!this._isPropertyDriven("size")&&(b=x.validateSymbolLayerSize(this.symbolLayer.size)))throw new a("graphics3dtextsymbollayer:invalid-size",b);this._createTextRenderParameters();return[2]})})};t.prototype._createTextRenderParameters=function(){this._textRenderParameters=m.default.fromSymbol(this.symbolLayer,
this._context.layerView.view.pixelRatio)};t.prototype.destroy=function(){b.prototype.destroy.call(this);this._geometryDataPool.destroy()};t.prototype.createGraphics3DGraphic=function(a){a=a.graphic;var b=r.placePointOnGeometry(a.geometry);if(g.isNone(b))return this.logger.warn("unsupported geometry type for text symbol: "+a.geometry.type),null;var d=this.symbolLayer.text;if(!d)return null;var e=c.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(a,
b,d,e)};t.prototype.onRemoveGraphic=function(a){this._geometryDataPool.release(a.stageObject.geometries[0].data)};t.prototype.createLabel=function(a,b,c,d){a=a.graphic;var e=r.placePointOnGeometry(a.geometry);if(g.isNone(e))return this.logger.warn("unsupported geometry type for label: "+a.geometry.type),null;var f=b.text;return f?this._createAs3DShape(a,e,f,b,b,c,d):null};t.prototype.getGraphicElevationContext=function(a,c){void 0===c&&(c=0);a=b.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(c);
return a};t.prototype.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};t.prototype.layerElevationInfoChanged=function(a,b){var c=this;B(a,b,function(a,b){c.updateGraphicElevationContext(b,a)});return r.SymbolUpdateType.UPDATE};t.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;B(a,b,function(a){var b=0;for(a=a.stageObject.geometryRecords;b<a.length;b++)a[b].material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});
return!0};t.prototype.physicalBasedRenderingChanged=function(a,b){return!0};t.prototype.pixelRatioChanged=function(a,b){return!1};t.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=r.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};t.prototype._defaultElevationInfoNoZ=function(){return D};t.prototype._createAs3DShape=function(a,b,c,e,h,k,m){void 0===h&&(h=K);var l=this.getGraphicElevationContext(a,
h.elevationOffset),t=this._context.layer.id+"_label_"+a.uid,u="polyline"===g.get(a.geometry,"type"),y=a.uid;a=this._context.stage.renderView.renderingContext;var n=x.namedAnchorToHUDMaterialAnchorPos[h.anchor in x.namedAnchorToHUDMaterialAnchorPos?h.anchor:"center"];a=g.isNone(m)?new v(a,c,this._textRenderParameters,t):null;n={occlusionTest:!0,screenOffset:h.screenOffset,anchorPos:n,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:h.centerOffsetUnits,debugDrawBorder:h.debugDrawBorder,drawInSecondSlot:!0};
g.isSome(a)&&(n.textureId=a.id,n.texCoordScale=a.texcoordScale);g.isSome(m)&&(n.textureId=m.textureId);if(g.isSome(e)&&g.isSome(e.verticalOffset)){e=e.verticalOffset;m=e.minWorldLength;var B=e.maxWorldLength;n.verticalOffset={screenLength:d.pt2px(e.screenLength),minWorldLength:m||0,maxWorldLength:null!=B?B:Infinity}}this._context.screenSizePerspectiveEnabled&&(e=this._context.sharedResources,m=e.screenSizePerspectiveSettings,n.screenSizePerspective=e.screenSizePerspectiveSettingsLabels.overridePadding(this._textRenderParameters.haloSize),
n.screenSizePerspectiveAlignment=m);u&&(n.shaderPolygonOffset=1E-4);n.slicePlaneEnabled=this._context.slicePlaneEnabled;u=null;e=JSON.stringify(n);g.isSome(k)?(u=k.getMaterial(e),null==u&&(u=new z(n,t),k.addMaterial(e,u))):u=new z(n,t);u=[u];n=this._geometryDataPool.acquire(h,a);n=[new w(n,t)];t=r.createStageObjectForPoint(this._context,b,n,u,null,null,l,t,this._context.layer.uid,y,!0);if(null===t)return null;y=q.perObjectElevationAligner;k=new p(this,t.object,n,g.isNone(k)?u:null,g.isSome(a)?[a]:
null,y,l);k.alignedTerrainElevation=t.terrainElevation;k.needsElevationUpdates=r.needsElevationUpdates2D(l.mode)||"absolute-height"===l.mode;var l=g.isSome(a)?a:h,C=l.displayWidth,L=l.displayHeight;k.getScreenSize=function(a){void 0===a&&(a=f.vec2f64.create());a[0]=C;a[1]=L;return a};k.metadata={labelText:c,elevationOffset:h.elevationOffset};r.extendPointGraphicElevationContext(k,b,this._context.elevationProvider);return k};return t}(t.default);b.Graphics3DTextSymbolLayer=n;var D={mode:"relative-to-ground",
offset:0},K={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};b.default=n})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("require exports ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",
{value:!0});n=function(){function b(a){this.definition=a;this.key=JSON.stringify(a);this.haloSize=Math.round(a.halo.size);this.fillStyle=this.colorToRGBA(a.color);this.haloStyle=this.colorToRGB(a.halo.color)}b.prototype.colorToRGB=function(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"};b.prototype.colorToRGBA=function(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"};b.fromSymbol=function(e,d){void 0===d&&(d=
1);var f=k.get(e,"material","color"),f=k.isSome(f)?l.toUnitRGBA(f):a.ZEROS,c=e.halo,g=null!=e.size?h.pt2px(e.size):12;e={family:e.font&&e.font.family?e.font.family:"sans-serif",weight:e.font&&e.font.weight?e.font.weight:"normal",style:e.font&&e.font.style?e.font.style:"normal"};c=k.isSome(c)&&k.isSome(c.color)&&0<c.size?{size:h.pt2px(c.size),color:l.toUnitRGBA(c.color)}:{size:0,color:a.ZEROS};return new b({size:g,color:f,font:e,halo:c,pixelRatio:d})};return b}();b.TextRenderParameters=n;b.default=
n})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ../../../../core/mathUtils ./TextRenderer ./Texture ../../../webgl/Texture ../../../webgl/capabilities/isWebGL2Context".split(" "),function(n,b,l,k,h,a,g){var e={canvas:null};return function(){function b(a,b,d,e){this._idHint=e;this._requiresPowerOfTwo=!g.default(a.gl);this._renderer=new k.default(b,d)}Object.defineProperty(b.prototype,"id",{get:function(){null==this._id&&(this._id=h.idGen.gen(this._idHint));return this._id},
enumerable:!0,configurable:!0});b.prototype.deferredLoading=function(){return!1};b.prototype.getWidth=function(){return this._renderer.renderedWidth};b.prototype.getHeight=function(){return this._renderer.renderedHeight};Object.defineProperty(b.prototype,"textureWidth",{get:function(){var a=this.getWidth();return this._requiresPowerOfTwo?l.nextHighestPowerOfTwo(a):a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureHeight",{get:function(){var a=this.getHeight();return this._requiresPowerOfTwo?
l.nextHighestPowerOfTwo(a):a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"displayWidth",{get:function(){return this._renderer.displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"displayHeight",{get:function(){return this._renderer.displayHeight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"texcoordScale",{get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]},
enumerable:!0,configurable:!0});b.prototype.initializeThroughRender=function(b,c){var d=k.getTextHelperCanvas(e,this.textureWidth,this.textureHeight),f=d.getContext("2d");f.save();c.samplingMode=9987;c.wrapMode=33071;c.flipped=!0;c.preMultiplyAlpha=!0;c.hasMipmap=!0;this._renderer.render(f,0,this.textureHeight-this._renderer.renderedHeight);b=new a(b,c,d);f.restore();return b};b.prototype.setUnloadFunc=function(a){this._unloadFunc=a};b.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),
this._unloadFunc=null)};return b}()})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["require","exports","../../../../core/maybe","./TextRenderParameters"],function(n,b,l,k){function h(a,b,d){a.canvas||(a.canvas=document.createElement("canvas"));a.canvas.width=b;a.canvas.height=d;return a.canvas}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,d){void 0===d&&(d=2048);this.text=a;this.maxSize=d;this._displayWidth=this._renderPixelRatio=null;this.parameters=
b instanceof k.default?b:new k.default(b);this.key=this.parameters.key+"--"+a;this.textLines=a.split(/\r?\n/);this.lineHeight=this.computeLineHeight()}Object.defineProperty(b.prototype,"displayWidth",{get:function(){l.isNone(this._displayWidth)&&(this._displayWidth=this.computeTextWidth());return this._displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"displayHeight",{get:function(){return this.lineHeight*this.textLines.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"renderedWidth",{get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderedHeight",{get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderedLineHeight",{get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderedFontSize",{get:function(){return this.parameters.definition.size*
this.renderPixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderedHaloSize",{get:function(){return this.parameters.haloSize*this.renderPixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderPixelRatio",{get:function(){if(l.isNone(this._renderPixelRatio)){var a=this.parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(a,Math.min(this.maxSize/(this.displayWidth*a),this.maxSize/(this.displayHeight*a))):a}return this._renderPixelRatio},
enumerable:!0,configurable:!0});b.prototype.render=function(a,b,d){void 0===b&&(b=0);void 0===d&&(d=0);var c=this.renderedLineHeight,e=this.renderedHaloSize,f=a.textAlign,g=this.renderedWidth,f=("center"===f?.5*g:"right"===f?g:0)+e;a.save();0<e&&this.renderHalo(a,f,e,b,d);this.setFontProperties(a,this.renderedFontSize);d+=e;b+=f;e=0;for(f=this.textLines;e<f.length;e++)g=f[e],a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",a.fillText(g,b,d),a.globalCompositeOperation="source-over",
a.fillStyle=this.parameters.fillStyle,a.fillText(g,b,d),d+=c;a.restore()};b.prototype.renderHalo=function(a,b,f,g,k){var c=this.renderedWidth,p=this.renderedHeight,q=h(e,Math.max(c,d),Math.max(p,d)),r=q.getContext("2d");r.clearRect(0,0,c,p);this.setFontProperties(r,this.renderedFontSize);r.fillStyle=this.parameters.haloStyle;r.strokeStyle=this.parameters.haloStyle;var m=3>this.renderedHaloSize;r.lineJoin=m?"miter":"round";m?this.renderHaloEmulated(r,b,f):this.renderHaloNative(r,b,f);a.globalAlpha=
this.parameters.definition.halo.color[3];a.drawImage(q,0,0,c,p,g,k,c,p);a.globalAlpha=1};b.prototype.renderHaloEmulated=function(b,d,e){for(var c=this.renderedLineHeight,f=this.renderedHaloSize,g=0,h=this.textLines;g<h.length;g++){for(var k=h[g],p=0,m=a;p<m.length;p++){var q=m[p];b.fillText(k,d+f*q[0],e+f*q[1])}e+=c}};b.prototype.renderHaloNative=function(a,b,d){for(var c=this.renderedLineHeight,e=this.renderedHaloSize,f=0,g=this.textLines;f<g.length;f++){for(var h=g[f],k=2*e,m=0;5>m;m++)a.lineWidth=
(.6+.1*m)*k,a.strokeText(h,b,d);d+=c}};b.prototype.setFontProperties=function(a,b){var c=this.parameters.definition.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family+", sans-serif";a.textAlign="left";a.textBaseline="top"};b.prototype.computeTextWidth=function(){var a=h(e,d,d).getContext("2d");this.setFontProperties(a,this.parameters.definition.size);for(var b=0,f=0,g=this.textLines;f<g.length;f++)b=Math.max(b,a.measureText(g[f]).width);f=this.parameters.definition.font;if("italic"===f.style||
"oblique"===f.style||"string"===typeof f.weight&&("bold"===f.weight||"bolder"===f.weight)||"number"===typeof f.weight&&600<f.weight)b+=.3*a.measureText("A").width;b+=2*this.parameters.haloSize;return Math.round(b)};b.prototype.computeLineHeight=function(){return Math.floor(1.275*this.parameters.definition.size+2*this.parameters.haloSize)};return b}();b.TextRenderer=n;for(var a=[],g=0;360>g;g+=22.5)a.push([Math.cos(Math.PI*g/180),Math.sin(Math.PI*g/180)]);b.getTextHelperCanvas=h;var e={canvas:null},
d=512;b.default=n})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/math/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function t(a,c,d,e){return b.call(this,a,c,d,e)||this}k(t,b);t.prototype.doLoad=function(){return a(this,void 0,void 0,function(){var a,b;return h(this,function(c){a=N.waterParameterDefaultsLocal;b=l({},a);this._updateMaterialParameters(b);b.isDraped=!0;this._drapedMaterial=new J.WaterMaterial(b,"waterDraped");this._context.stage.add(3,this._drapedMaterial);this._updateMaterialParameters(a);
this._material=new J.WaterMaterial(a,"water");this._context.stage.add(3,this._material);return[2]})})};t.prototype.destroy=function(){b.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null);this._drapedMaterial&&(this._context.stage.remove(3,this._drapedMaterial.id),this._drapedMaterial=null)};t.prototype.createGraphics3DGraphic=function(a){a=a.graphic;if(!this._validateGeometryType(a.geometry,t.validGeometryTypes,this.symbolLayer.type)||
!this._validateGeometry(a.geometry))return null;var b="graphic"+a.uid,c=this.getGraphicElevationContext(a);return"on-the-ground"===c.mode?this._createAsOverlay(a,b):this._createAs3DShape(a,c,b,a.uid)};t.prototype.layerOpacityChanged=function(){var a=this._material.getParameters().color,b=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),c=1>b||this._isPropertyDriven("opacity");this._material.setParameterValues({color:[a[0],a[1],a[2],b],transparent:c});this._drapedMaterial.setParameterValues({color:[a[0],
a[1],a[2],b],transparent:c});return!0};t.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=B.elevationModeChangeUpdateType(t.elevationModeChangeTypes,c,d);if(c!==B.SymbolUpdateType.UPDATE)return c;var e=B.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};t.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._drapedMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};t.prototype.physicalBasedRenderingChanged=function(a,b){return!0};t.prototype.pixelRatioChanged=function(a,b){return!0};t.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a+b/2,c.add(this._material.id));this._drapedMaterial&&(this._drapedMaterial.renderPriority=a+b/2,c.add(this._drapedMaterial.id))};t.prototype._createAs3DShape=function(a,b,c,d){var e=B.getGeometryAsPolygon(a.geometry);a=B.getGeometryVertexData3D(e.rings,
e.hasZ,e.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,b);var f=a.vertexData.length/3;a.uvCoords=new Float64Array(2*f);U.idHint=c;U.data=a;U.outNum=0;U.outGeometries=[];U.outTransforms=[];U.outMaterials=[];this._create3DShapeGeometries(U);this._logGeometryCreationWarnings(U.data,e.rings,"rings","WaterSymbol3DLayer");if(0===U.outNum)return null;this._createUVCoordsFromVertices(U.data.uvCoords,U.data.eleVertexData,f,this._context.elevationProvider.spatialReference);
c=new I({geometries:U.outGeometries,materials:U.outMaterials,transformations:U.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:d},idHint:c});c=new z(this,c,U.outGeometries,null,null,m.perVertexElevationAligner,b);c.alignedTerrainElevation=a.terrainElevation;c.needsElevationUpdates=B.needsElevationUpdates2D(b.mode);return c};t.prototype._createUVCoordsFromVertices=function(a,b,c,e){e=d.getMetersPerUnitForSR(e);y.empty(M);for(var f=0;f<c;f++)p.vec2.set(R,b[3*f+0],b[3*
f+1]),y.expandPointInPlace(M,R);x.vec4.scale(M,M,e);f=M[1]%t.unitSizeOfTexture;L[0]=M[0]-M[0]%t.unitSizeOfTexture;L[1]=M[1]-f;for(f=0;f<c;f++)a[2*f+0]=(b[3*f+0]*e-L[0])/t.unitSizeOfTexture,a[2*f+1]=(b[3*f+1]*e-L[1])/t.unitSizeOfTexture};t.prototype._create3DShapeGeometries=function(a){for(var b=a.data.eleVertexData,d=a.data.vertexData,e=a.data.uvCoords,f=0,g=a.data.geometryData.polygons;f<g.length;f++){var h=g[f],k=h.count,m=h.index;if(this._context.clippingExtent&&(B.computeBoundingBox(b,m,k,S),
B.boundingBoxClipped(S,this._context.clippingExtent)))continue;var p=new Float64Array(b.buffer,3*m*b.BYTES_PER_ELEMENT,3*k),h=this._runEarcut(p,h);if(0!==h.length){h=new Uint32Array(h);B.applyOrigin(d,m,k,T);var r=new Float64Array(d.buffer,3*m*d.BYTES_PER_ELEMENT,3*k),k=new Float64Array(e.buffer,2*m*e.BYTES_PER_ELEMENT,2*k),p=D.createPolygonGeometryData({indices:h,vertices:r,uv0:k,eleVertices:p}),p=new K(p,a.idHint);p.singleUse=!0;k=q.mat4f64.create();c.mat4.translate(k,k,T);a.outGeometries.push(p);
a.outMaterials.push(this._material);a.outTransforms.push(k);a.outNum++}}};t.prototype._updateMaterialParameters=function(a){var b=this.symbolLayer.color;e.isSome(b)&&(a.color=g.toUnitRGBA(b));b=this._getCombinedOpacity(b,{hasIntrinsicColor:!0});a.color=[a.color[0],a.color[1],a.color[2],b];a.transparent=1>b||this._isPropertyDriven("opacity");a.waveDirection=e.isSome(this.symbolLayer.waveDirection)?t.headingVectorFromAngle(this.symbolLayer.waveDirection):r.vec2f64.fromValues(0,0);b=N.wavePresets[this.symbolLayer.waveStrength+
"-"+this.symbolLayer.waterbodySize];a.waveStrength=b.waveStrength;a.waveTextureRepeat=b.textureRepeat;a.waveVelocity=b.waveVelocity;a.flowStrength=b.perturbationStrength};t.prototype._createAsOverlay=function(a,b){var c=B.getGeometryAsPolygon(a.geometry);this._drapedMaterial.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;var d=B.getGeometryVertexDataDraped(c.rings,c.spatialReference,this._context.overlaySR);U.idHint=b;U.data=d;b=d.vertexData.length/3;d.uvCoords=new Float64Array(2*
b);U.outNum=0;U.outGeometries=[];U.outBoundingBox=u.empty();U.layerUid=this._context.layer.uid;U.graphicsUid=a.uid;this._createAsOverlayWater(U);this._logGeometryCreationWarnings(U.data,c.rings,"rings","WaterSymbol3DLayer");if(0===U.outNum)return null;this._createUVCoordsFromVertices(U.data.uvCoords,U.data.vertexData,b,c.spatialReference);return 0<U.outNum?new v(this,U.outGeometries,U.outBoundingBox):null};t.prototype._runEarcut=function(a,b){var c=b.holeIndices.map(function(a){return a-b.index});
return f(a,c,3)};t.prototype._createAsOverlayWater=function(a){for(var b=a.data.vertexData,d=a.data.uvCoords,e=0,f=a.data.geometryData.polygons;e<f.length;e++){var g=f[e],h=g.count,k=g.index;B.computeBoundingBox(b,k,h,S);if(!B.boundingBoxClipped(S,this._context.clippingExtent)){u.expand(a.outBoundingBox,S);var m=new Float64Array(b.buffer,3*k*b.BYTES_PER_ELEMENT,3*h),g=this._runEarcut(m,g);0!==g.length&&(g=new Uint32Array(g),B.applyOrigin(b,k,h,T),B.setZ(b,k,h,this._getDrapedZ()),h=new Float64Array(d.buffer,
2*k*d.BYTES_PER_ELEMENT,2*h),m=D.createPolygonGeometryData({indices:g,vertices:m,uv0:h}),h=new Q(m),h.data.layerUid=a.layerUid,h.data.graphicUid=a.graphicsUid,h.material=this._drapedMaterial,k=S,h.center=[.5*(k[0]+k[3]),.5*(k[1]+k[4]),0],h.bsRadius=.5*Math.sqrt((k[3]-k[0])*(k[3]-k[0])+(k[4]-k[1])*(k[4]-k[1])),k=q.mat4f64.create(),c.mat4.translate(k,k,T),h.transformation=k,h.name=a.idHint,h.uniqueName=a.idHint+"#"+m.id,a.outGeometries.push(h),a.outNum++)}}};t.headingVectorFromAngle=function(a){var b=
r.vec2f64.create();a=w.toRadian(a);b[0]=Math.sin(a);b[1]=Math.cos(a);return b};Object.defineProperty(t.prototype,"test",{get:function(){var a=this;return{create3DShape:function(b){return a._createAs3DShape(b.graphic,b.elevationContext,b.idHint,b.graphicUid)}}},enumerable:!0,configurable:!0});t.validGeometryTypes=["polyline","polygon","extent"];t.unitSizeOfTexture=100;t.elevationModeChangeTypes={definedChanged:B.SymbolUpdateType.RECREATE,staysOnTheGround:B.SymbolUpdateType.NONE,onTheGroundChanged:B.SymbolUpdateType.RECREATE};
return t}(C.default);b.Graphics3DWaterSymbolLayer=n;var L=r.vec2f64.create(),M=y.create(),R=r.vec2f64.create(),S=u.create(),T=t.vec3f64.create(),U={idHint:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};b.default=n})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../lib/AnimationTimer ../lib/Material ./WaterGLMaterial ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/waterMaterialUtils ./renderers/MergedRenderer".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,c){c=a.call(this,c)||this;c.animation=new h.AnimationTimer;c.params=d.copyParameters(b,f.waterParameterDefaultsLocal);return c}l(b,a);b.prototype.setParameterValues=function(a){this.params=k({},this.params,a);this.notifyDirty("matChanged")};b.prototype.getParameters=function(){return this.params};b.prototype.update=function(a){this.animation.enabled=Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*
Math.min(a.camera.relativeElevation,a.camera.distance)<q;this.animation.advance(a.dt);return this.animation.enabled};b.prototype.intersect=function(a,b,c,e,f,g,h,k,p){d.intersectTriangleGeometry(a,b,e,f,g,h)};b.prototype.getGLMaterials=function(){return{color:this.params.isDraped?g.WaterDrapedGLMaterial:g.WaterGLMaterial,depthShadowMap:void 0,normal:g.WaterNormalGLMaterial,depth:void 0,highlight:void 0}};b.prototype.createBufferWriter=function(){return new e.DefaultBufferWriter(e.PositionUVLayout)};
b.prototype.createRenderer=function(a,b){return new c(a,b,this)};return b}(a.Material);b.WaterMaterial=n;var q=35E3})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["require","exports","../../../../core/maybe"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){void 0===b&&(b=!0);this.enabled=b;this._time=0}Object.defineProperty(b.prototype,"time",{get:function(){return l.isSome(this._forcedTime)?this._forcedTime:this._time},enumerable:!0,
configurable:!0});b.prototype.advance=function(b){this.enabled&&(this._time+=b)};b.prototype.forceTime=function(b){this._forcedTime=b};return b}();b.AnimationTimer=n})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./Loadable ./symbolComplexity".split(" "),function(n,b,l,k,h,a,g){return function(a){function b(b,c){var d=a.call(this)||
this;d.symbol=b;d.convert=c;d.graphics3DSymbol=null;d.referenced=0;return d}l(b,a);b.prototype.whenSymbolLayerSize=function(a){return h(this,void 0,void 0,function(){return k(this,function(b){switch(b.label){case 0:return[4,this.load()];case 1:return b.sent(),[2,this.graphics3DSymbol.whenSymbolLayerSize(a)]}})})};b.prototype.doLoad=function(a){return h(this,void 0,void 0,function(){var b;return k(this,function(c){switch(c.label){case 0:return[4,this.symbol.fetchSymbol({signal:a})];case 1:return b=
c.sent(),b.id=this.symbol.id,this.graphics3DSymbol=this.convert(b),[4,this.graphics3DSymbol.load()];case 2:return c.sent(),[2]}})})};b.prototype.createGraphics3DGraphic=function(a){return this.graphics3DSymbol.createGraphics3DGraphic(a,this)};Object.defineProperty(b.prototype,"complexity",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.complexity:g.emptySymbolComplexity},enumerable:!0,configurable:!0});b.prototype.globalPropertyChanged=function(a,b){return this.graphics3DSymbol.globalPropertyChanged(a,
b)};b.prototype.applyRendererDiff=function(a,b){return this.graphics3DSymbol.applyRendererDiff(a,b)};b.prototype.prepareSymbolPatch=function(a){this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(a)};b.prototype.updateGeometry=function(a,b){return this.graphics3DSymbol?this.graphics3DSymbol.updateGeometry(a,b):!1};b.prototype.onRemoveGraphic=function(a){};b.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,
slow:0}};b.prototype.setDrawOrder=function(a,b){this.graphics3DSymbol&&this.graphics3DSymbol.setDrawOrder(a,b)};b.prototype.destroy=function(){this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;this.abortLoad()};Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!0,configurable:!0});return b}(a.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){function r(a){return q.getGraphics3DSymbol(a.graphics3DGraphic.graphics3DSymbol).symbol.symbolLayers.getItemAt(0)}function t(a){var b=a.graphics3DGraphic.graphic.geometry;if(h.isNone(b))return null;b=b.type;switch(b){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return"extrude"===r(a).type?z["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return z["above-center"];
case "mesh":return z["above-center"];default:l.neverReached(b)}}function x(b,c){null==v&&(m.log(b,c),v=a.schedule(function(){v.remove();v=null}))}function w(a,b,c){c=c.graphics3DGraphic._graphics[0];c=h.isSome(c)?c.getBoundingBoxObjectSpace(I):I;c=d.vec3f64.fromValues(c[3]-c[0],c[4]-c[1],c[5]-c[2]);a.centerOffset[0]=1.1*Math.sqrt(c[0]*c[0]+c[1]*c[1])/2*b.normalizedOffset[0];var f=a.translation[2],g=c[2]/2*b.normalizedOffset[1];a.translation[2]=g*(1.1-1);a.elevationOffset=f+g;c=e.vec3.length(c);a.centerOffset[2]=
1.1*c/2*b.normalizedOffset[2]}function u(a){var b=a.labelClass.labelPlacement,c=a.labelSymbol,d=a.graphics3DGraphic,e=q.getGraphics3DSymbol(d.graphics3DSymbol).symbol;a=z[b]||t(a);if("point-3d"===e.type&&e.supportsCallout()&&e.hasVisibleVerticalOffset()&&!d.isDraped())return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:y(e.verticalOffset),anchor:null,normalizedOffset:null};if(c&&c.hasVisibleVerticalOffset()&&("point-3d"!==e.type||!e.supportsCallout()||!e.verticalOffset||d.isDraped())){a:switch(a.placement){case "above-center":d=
!0;break a;default:d=!1}return d?{placement:"above-center",verticalOffset:y(c.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(x("error","Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+b+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function y(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,
maxWorldLength:a.maxWorldLength}}Object.defineProperty(b,"__esModule",{value:!0});var m=k.getLogger("esri.views.3d.layers.graphics.labelPlacement"),v=null;b.get=function(a){var b=u(a);if(h.isNone(b))return null;var e;if(b.anchor)e=b;else{var k=a.labelClass.labelPlacement,m=z[k];e=m||t(a);k&&!m&&x("warn","the requested label placement '"+k+"' is not currently supported in SceneView");k=a.graphics3DGraphic.graphic.geometry;if(h.isNone(k))e=null;else switch(k=k.type,k){case "polyline":case "polygon":case "extent":case "multipoint":a.labelClass.labelPlacement&&
(x("warn","the requested label placement '"+e.placement+"' is currently unsupported for '"+k+"' geometries in SceneView"),e=t(a));break;case "point":case "mesh":break;default:l.neverReached(k)}}if(h.isNone(e))return null;k=!!b.hasLabelVerticalOffset;b={anchor:e.anchor,verticalOffset:b.verticalOffset,screenOffset:g.vec2f64.create(),centerOffset:f.vec4f64.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:d.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:k};k=a.graphics3DGraphic.graphic.geometry;
if(h.isNone(k))a=null;else{switch(k.type){case "point":k=a.graphics3DGraphic;m=r(a);k.getCenterObjectSpace(b.translation);switch(m.type){case "icon":case "text":m=a.graphics3DGraphic;k=m._graphics[0].getScreenSize();m.isDraped()?b.hasLabelVerticalOffset||"center"===b.anchor||(z[a.labelClass.labelPlacement]&&x("warn","the requested placement '"+e.placement+"' is currently unsupported for draped graphics"),b.anchor="center"):(m=void 0,void 0===m&&(m=K),a=a.graphics3DGraphic._graphics[0].stageObject.geometryRecords[0].material,
a instanceof p?(a=a.getParameters().anchorPos,m[0]=2*(a[0]-.5),m[1]=2*(a[1]-.5)):(m[0]=0,m[1]=0),a=m,D[0]=k[0]/2*(e.normalizedOffset[0]-a[0]),D[1]=k[1]/2*(e.normalizedOffset[1]-a[1]),b.screenOffset[0]=D[0],b.hasLabelVerticalOffset?(b.centerOffset[1]=D[1],b.centerOffsetUnits="screen"):b.screenOffset[1]=D[1]);break;case "object":w(b,e,a)}break;case "polygon":switch(r(a).type){case "extrude":k=a.graphics3DGraphic._graphics[0],h.isSome(k)&&k.getBoundingBoxObjectSpace(I),c.center(I,b.translation),b.translation[2]=
c.height(I)/2,w(b,e,a)}break;case "mesh":w(b,e,a)}a=b}return a};var z={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",
normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},B={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],
"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};n=function(a){var b=z[a];B[a].forEach(function(a){z[a]=b})};for(var C in B)n(C);Object.freeze&&(Object.freeze(z),Object.keys(z).forEach(function(a){Object.freeze(z[a]);Object.freeze(z[a].normalizedOffset)}));
var D=[0,0],K=[0,0],I=c.create()})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/arrayUtils ../../../../core/Evented ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./IdGen ./Octree".split(" "),function(n,b,l,k,h,a,g,e,d){return function(b){function c(a,d,e){var f=b.call(this)||this;f._parentStages=new Map;f._children=new Set;f.id=c._idGen.gen(a);f.apiLayerUid=e;f.name=a;d=d||{};
f.group=d.group||"";f.isVisible=null!=d.isVisible?d.isVisible:!0;f.isPickable=null!=d.isPickable?d.isPickable:!0;f.isSliceable=!1;f.translation=d.translation?g.vec3f64.clone(d.translation):g.vec3f64.create();f._extent=[g.vec3f64.fromValues(0,0,0),g.vec3f64.fromValues(1E3,1E3,1E3)];f._extentDirty=!0;return f}l(c,b);c.prototype.addParentStage=function(a){if(!this._parentStages.has(a)){var b=this.on("dirty",function(b){a.notifyDirty(b.contentType,b.origin,b.dirtyType,b.subObject)});this._parentStages.set(a,
b)}};c.prototype.removeParentStage=function(a){var b=this._parentStages.get(a);b&&(b.remove(),this._parentStages.delete(a));this.invalidateSpatialQueryAccelerator()};c.prototype.getName=function(){return this.name};c.prototype.getGroup=function(){return this.group};c.prototype.getTranslation=function(){return this.translation};c.prototype.getObjectIds=function(){return k.keysOfSet(this._children,function(a){return a.id})};c.prototype.getObjects=function(){return k.keysOfSet(this._children)};c.prototype.getExtent=
function(){this._updateExtent();return this._extent};c.prototype.addObject=function(a){this._children.add(a);a.parentLayer=this;this.notifyDirty("layerObjectAdded",a);this._invalidateExtent();this._octree&&this._octree.add(a)};c.prototype.hasObject=function(a){return this._children.has(a)};c.prototype.removeObject=function(a){return this._children.delete(a)?(a.parentLayer=null,this.notifyDirty("layerObjectRemoved",a),this._invalidateExtent(),this._octree&&this._octree.remove(a),!0):!1};c.prototype.notifyObjectBBChanged=
function(a,b){this._octree&&this._octree.update(a,b)};c.prototype.getCenter=function(){this._updateExtent();var b=g.vec3f64.create();return a.vec3.lerp(b,this._extent[0],this._extent[1],.5)};c.prototype.getBSRadius=function(){this._updateExtent();return.5*a.vec3.distance(this._extent[0],this._extent[1])};c.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._children.size&&this._createOctree();return this._octree};c.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",
null)};c.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)};c.prototype.notifyDirty=function(a,b,c,d){this.emit("dirty",{contentType:c||0,origin:d||this,dirtyType:a,subObject:b})};c.prototype._createOctree=function(){for(var b=this.getExtent(),c=0,e=0;3>e;e++)c=Math.max(c,b[1][e]-b[0][e]);e=g.vec3f64.create();a.vec3.lerp(e,b[0],b[1],.5);this._octree=new d(e,1.2*c,{getRadius:function(a){return a.getBSRadius()},getCenter:function(a){return a.getCenter()}});
this._octree.add(k.keysOfSet(this._children))};c.prototype._invalidateExtent=function(){this._extentDirty=!0};c.prototype._updateExtent=function(){var a=this;if(this._extentDirty)if(this._extentDirty=!1,0===this._children.size)this._extent=[[0,0,0],[0,0,0]];else{var b=null;this._children.forEach(function(c){var d=c.getBBMin();c=c.getBBMax();if(b)for(var e=0;3>e;++e)a._extent[0][e]=Math.min(a._extent[0][e],d[e]),a._extent[1][e]=Math.max(a._extent[1][e],c[e]);else b=[g.vec3f64.clone(d),g.vec3f64.clone(c)]});
this._extent=b}};c._idGen=new e.IdGen;return c}(h)})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require","exports"],function(n,b){return function(){function b(b){this.materials={};this.stage=b}b.prototype.getMaterial=function(b){return this.materials[b]};b.prototype.addMaterial=function(b,h){this.materials[b]=h;this.stage.add(3,h)};b.prototype.dispose=function(){for(var b in this.materials)this.stage.remove(3,this.materials[b].id);this.materials={}};return b}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/iteratorUtils ../../../../core/mathUtils ../../../../core/accessorSupport/decorators ./Texture ../../../support/index ../../../webgl/Texture".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function h(a){a=b.call(this)||this;a.dirty=!1;a.needsClear=!1;a.elementsToAdd=new Map;a.elementsToRemove=new Map;a.elementsToRender=new Map;a.elements=new Map;a.stageObjects=new Map;return a}l(h,b);t=h;h.prototype.initialize=function(){this.id=d.idGen.gen(this.idHint);this.stage=this.view._stage;this.scheduler=this.view.resourceController.scheduler;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");
this.stage.add(4,this);var a=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(a);this.update2DCanvasSize();this.resetAtlasCursor()};h.prototype.setUnloadFunc=function(a){this.unloadFunc=a};h.prototype.unload=function(){null!=this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=null)};h.prototype.deferredLoading=function(){return!1};h.prototype.getWidth=function(){return this.atlas.size.width};h.prototype.getHeight=function(){return this.atlas.size.height};
h.prototype.initializeThroughRender=function(a,b){var d=this;b.wrapMode=33071;b.samplingMode=9987;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;this.glTexture=new c(a,b,this.canvas);this.frameWorker=this.scheduler.registerTask(f.Task.TEXT_TEXTURE_ATLAS,function(a){return d.run(d.makeRunContext(a))},function(){return d.dirty});return this.glTexture};h.prototype.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAdd=this.elements=null;this.frameWorker&&(this.frameWorker.remove(),
this.frameWorker=null);this.glTexture&&(this.glTexture=null,this.stage.remove(4,this.id));this.canvas.width=0;this.canvas.height=0;this.ctx=this.canvas=null};h.prototype.create2DCanvas=function(){var a=document.createElement("canvas");a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",(512).toString());return a};h.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());
this.canvas.setAttribute("height",this.atlas.size.height.toString())};h.prototype.createAtlasRegion=function(a){void 0===a&&(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};h.prototype.computeAtlasResolution=function(a,b){a=Math.max(a,b);a=g.nextHighestPowerOfTwo(a+256);return a=Math.min(a,4096)};h.prototype.resizeAtlas=function(a,b){b=b||a;var c=this.atlas;c.size.width=a;c.size.height=b;this.glTexture&&this.glTexture.resize(a,b);this.update2DCanvasSize()};h.prototype.resetAtlasCursor=
function(){var a=this.atlas;a.cursor.x=q;a.cursor.y=q+p;a.lineHeight=0;this.needsClear=!0};h.prototype.getAtlasUsage=function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};h.prototype.getExpectedAtlasUsage=function(){var a=this.elementsToRemove.size,b=this.elementsToAdd.size,c=this.elements.size;return this.getAtlasUsage()/c*(c+b-a)};h.prototype.addAtlasElement=function(a,b,c,d){var e=this.atlas,f=a.textRenderer,g=f.renderedWidth,h=f.renderedHeight,k=
f.displayWidth,f=f.displayHeight;a.placement.offset.x=e.cursor.x;a.placement.offset.y=e.cursor.y;a.placement.size.width=g;a.placement.size.height=h;a.placement.size.displayWidth=k;a.placement.size.displayHeight=f;a.placement.uvMinMax=[a.placement.offset.x/e.size.width,1-(a.placement.offset.y+h)/e.size.height,(a.placement.offset.x+g)/e.size.width,1-a.placement.offset.y/e.size.height];e.cursor.x+=c;e.lineHeight=Math.max(e.lineHeight,d);this.elements.set(b,a)};h.prototype.removeAtlasElement=function(a){if(a&&
this.elements.has(a.textId)){var b=a.placement.offset,c=a.placement.size;this.ctx.clearRect(b.x,b.y,c.width,c.height);this.elements.delete(a.textId)}};h.prototype.ensureStageObjects=function(a){var b=this.stageObjects.get(a);if(b)return b;b=new Set;this.stageObjects.set(a,b);return b};h.prototype.addStageObject=function(a,b){this.ensureStageObjects(a).add(b)};h.prototype.removeStageObject=function(a,b){(a=this.stageObjects.get(a))&&a.delete(b)&&(b.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,
0]),b.geometryVertexAttrsUpdated(0))};h.prototype.processAdditionRequest=function(a,b){var c=this.atlas,d=a.textId,e=a.textRenderer.renderedWidth+q,f=a.textRenderer.renderedHeight+q+p;b=b.repackingEnabled;if(c.cursor.x+e<c.size.width&&c.cursor.y+f<c.size.height)this.addAtlasElement(a,d,e,f),this.elementsToRender.set(d,a),this.elementsToAdd.delete(d);else if(c.cursor.y+f+c.lineHeight<c.size.height)c.cursor.x=q,c.cursor.y+=c.lineHeight,c.lineHeight=0,this.addAtlasElement(a,d,e,f),this.elementsToRender.set(d,
a),this.elementsToAdd.delete(d);else{a=this.getExpectedAtlasUsage();(d=.85<a&&4096>c.size.width)&&this.resizeAtlas(2*c.size.width,2*c.size.height);if(!b||!d&&.95<a&&4096===c.size.width)return this.processRemovals(),0;this.repack();return 1}return 0};h.prototype.processRemovals=function(){var a=this;this.elementsToRemove.forEach(function(b,c){var d=a.stageObjects.get(c);d&&0!==d.size||a.removeAtlasElement(b);d&&0===d.size&&a.stageObjects.delete(c)});this.elementsToRemove.clear()};h.prototype.repack=
function(){var a=this;this.processRemovals();this.elements.forEach(function(b,c){b.rendered=!1;a.elementsToAdd.set(c,b)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};h.prototype.processRenderingRequest=function(a){this.ctx.clearRect(a.placement.offset.x,a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textRenderer.render(this.ctx,a.placement.offset.x,a.placement.offset.y);var b=this.stageObjects.get(a.textId);b&&b.forEach(function(b){b.geometries[0].data.vertexAttributes.uv0.data=
new Float32Array(a.placement.uvMinMax);b.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.displayWidth,a.placement.size.displayHeight]);b.geometryVertexAttrsUpdated(0)});a.rendered=!0};h.prototype.run=function(b){var c=this;if(this.glTexture){var d=b.budget,e=!1;a.everyMap(this.elementsToAdd,function(a,d){return(a=c.elements.get(d))&&a.rendered?((a=c.stageObjects.get(d))&&a.forEach(function(a){var b=a.geometries[0].data.vertexAttributes,e=c.elements.get(d);b.uv0.data=
new Float32Array(e.placement.uvMinMax);b.size.data=new Float32Array([e.placement.size.displayWidth,e.placement.size.displayHeight]);a.geometryVertexAttrsUpdated(0)}),c.elementsToAdd.delete(d),!0):1===c.processAdditionRequest(c.elementsToAdd.get(d),b)?(e=!0,!1):!0});if(e)b.budget=null,b.repackingEnabled=!1,this.run(b);else{var f=!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);a.everyMap(this.elementsToRender,function(a,
b){c.processRenderingRequest(a);c.elementsToRender.delete(b);f=!0;return d&&(d.madeProgress(),d.done)?!1:!0});f&&this.glTexture.setData(this.canvas);this.dirty=0<this.elementsToRender.size;this.dirty||(t.test.orderedRepackingEnabled&&this.repackOrdered(),this.notifyChange("updating"))}}};h.prototype.makeRunContext=function(a){void 0===a&&(a=null);r.budget=a;r.repackingEnabled=!0;return r};h.prototype.addTextTexture=function(a,b){var c=a.key;this.elementsToAdd.has(c)||this.elementsToAdd.set(c,{textId:c,
placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:a,rendered:!1});this.addStageObject(c,b);this.elementsToRemove.delete(c);this.setDirty()};h.prototype.removeTextTexture=function(a,b){a=a.key;this.elementsToRemove.set(a,this.elements.get(a));this.elementsToAdd.delete(a);this.removeStageObject(a,b)};Object.defineProperty(h.prototype,"textureId",{get:function(){return this.id},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"isDirty",{get:function(){return this.dirty},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return this.isDirty},enumerable:!0,configurable:!0});h.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.notifyChange("updating"))};Object.defineProperty(h.prototype,"test",{get:function(){return{elements:this.elements,stageObjects:this.stageObjects,elementsToRemove:this.elementsToRemove,atlas:this.atlas,resizeAtlas:this.resizeAtlas.bind(this)}},enumerable:!0,
configurable:!0});h.prototype.repackOrdered=function(){if(0!==this.elements.size){var a=[];this.elements.forEach(function(b,c){return a.push({element:b,key:c})});for(var b=!0,c=0;c<a.length-1;c++)if(0<a[c].key.localeCompare(a[c+1].key)){b=!1;break}if(!b){a.sort(function(a,b){return a.key.localeCompare(b.key)});this.elements.clear();for(b=0;b<a.length;b++)c=a[b],this.elements.set(c.key,c.element);this.repack();this.setDirty()}}};var t;h.test={orderedRepackingEnabled:!1};k([e.property({constructOnly:!0})],
h.prototype,"idHint",void 0);k([e.property({constructOnly:!0})],h.prototype,"view",void 0);k([e.property({type:Boolean,readOnly:!0})],h.prototype,"updating",null);return h=t=k([e.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],h)}(e.declared(h));b.TextTextureAtlas=n;var q=2,p=2,r={budget:null,repackingEnabled:!0};b.default=n})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/projectionUtils ../../../support/index".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){Object.defineProperty(b,"__esModule",{value:!0});var w=e.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");n=function(b){function e(c){c=b.call(this,c)||this;c.tiles=new a;c.tileSize=512;c.idToTile=new Map;c.handles=new g;c.clients=new Set;c._dirty=!1;c._newTiles=new d;return c}l(e,b);Object.defineProperty(e.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},enumerable:!0,configurable:!0});
Object.defineProperty(e.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))w.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this._setDirty())}},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||!this.tilingScheme)return null;
var a=q.create();t.extentToBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),this._setDirty())},enumerable:!0,configurable:!0});
Object.defineProperty(e.prototype,"updating",{get:function(){return this._dirty||!!this._pendingTiles},enumerable:!0,configurable:!0});e.prototype.initialize=function(){var a=this;this.handles.add(this.watch(["tilingScheme","tileSize"],function(){return a._reset()},!0));this.handles.add(f.init(this,["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"],function(){return a._setDirty()}));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(x.Task.FEATURE_TILE_TREE,
function(b){return a._update(b)},function(){return a.updating}))};e.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.handles&&(this.handles.destroy(),this.handles=null)};e.prototype.addClient=function(){var a=this,b=u++;this.clients.add(b);1===this.clients.size&&this._setDirty();return{remove:function(){return a._removeClient(b)}}};e.prototype._removeClient=function(a){this.clients.delete(a);this._hasClients||this._clear()};Object.defineProperty(e.prototype,
"_hasClients",{get:function(){return 0<this.clients.size},enumerable:!0,configurable:!0});e.prototype._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this._update(x.noBudget))};e.prototype._clear=function(){this.tiles.removeAll();this.idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};e.prototype._update=function(a){this._dirty=!1;this._pendingTiles||(this._startUpdate(a),this._frameWorker&&
(this._frameWorker.task=x.Task.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(a);!this._pendingTiles&&this._frameWorker&&(this._frameWorker.task=x.Task.FEATURE_TILE_TREE);this.notifyChange("updating")};e.prototype._startUpdate=function(a){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new r.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:m})),a=this.cameraOnSurface.location,
this._tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:a,a.z),this._pendingTiles=this._getRootTiles()):this._clear())};e.prototype._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};e.prototype._getRootTiles=function(){var a=this;return this.rootTileIds.map(function(b){return new p.FeatureTileDescriptor3D(b[0],b[1],b[2],a.tilingScheme)})};e.prototype._purgeHorizonTiles=function(a){a.sort(function(a,b){a=a.measures.screen.rect;
b=b.measures.screen.rect;return a[1]+a[3]-(b[1]+b[3])});q.empty(y);for(var b=0;b<a.length;b++)if(q.expand(y,a.data[b].measures.screen.rect),q.height(y)>m)return a.data.slice(b,a.length);return[]};e.prototype._subdivideTilesForView=function(a){var b;if(this._pendingTiles){for(;0<this._pendingTiles.length&&!a.done;){var c=this._pendingTiles.pop();a.madeProgress();if(!this.filterExtentRect||q.intersects(this.filterExtentRect,c.extent))this._tileMeasurements.updateTile(c),0!==c.measures.visibility&&(c.measures.shouldSplit?
(this.tilingScheme.ensureMaxLod(c.lij[0]+1),(b=this._pendingTiles).push.apply(b,c.getChildren())):this._newTiles.push(c))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};e.prototype._updateTiles=function(a){for(var b=this,c=0,d=this.tiles.items;c<d.length;c++)d[c].used=!1;a=a.filter(function(a){var c=b.idToTile.get(a.id);c?(c.copyMeasurementsFrom(a),c.used=!0):b.idToTile.set(a.id,
a);return!c});c=this.tiles.items.filter(function(a){return a.used?!1:(b.idToTile.delete(a.id),!0)});this.tiles.removeMany(c);this.tiles.addMany(a);this.sortTiles()};e.prototype.sortTiles=function(){this.tiles.sort(function(a,b){return a.measures.visibility!==b.measures.visibility?2===a.measures.visibility?-1:1:a.measures.distance-b.measures.distance});this.tiles.forEach(function(a,b){return a.loadPriority=b})};k([c.property({constructOnly:!0})],e.prototype,"scheduler",void 0);k([c.property({constructOnly:!0})],
e.prototype,"renderCoordsHelper",void 0);k([c.property({constructOnly:!0})],e.prototype,"tilingSchemeOwner",void 0);k([c.property({constructOnly:!0})],e.prototype,"cameraOnSurface",void 0);k([c.property({constructOnly:!0})],e.prototype,"focus",void 0);k([c.property({constructOnly:!0})],e.prototype,"viewState",void 0);k([c.property()],e.prototype,"tiles",void 0);k([c.property()],e.prototype,"tileSize",void 0);k([c.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],e.prototype,"tilingScheme",
null);k([c.property()],e.prototype,"filterExtent",null);k([c.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],e.prototype,"filterExtentRect",null);k([c.property({readOnly:!0,dependsOn:["filterExtentRect"]})],e.prototype,"rootTileIds",null);k([c.property({value:!1})],e.prototype,"suspended",null);k([c.property({readOnly:!0})],e.prototype,"updating",null);return e=k([c.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],e)}(c.declared(h));b.FeatureTileTree3D=n;var u=0,y=q.create(),
m=10;b.default=n})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require","exports","../../../../geometry/support/aaBoundingRect"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a,g,e){void 0===e&&(e=null);this.lij=[0,0,0];this.extent=l.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screen:{rect:l.create()},distance:0,shouldSplit:!1};this.used=!1;e&&this.acquire(b,a,g,e)}b.prototype.acquire=function(h,
a,g,e){this.tilingScheme=e;this.id=b.id(h,a,g);this.lij[0]=h;this.lij[1]=a;this.lij[2]=g;e.getExtent(h,a,g,this.extent);this.resolution=e.resolutionAtLevel(h)};b.prototype.release=function(){this.tilingScheme=null};b.prototype.getChildren=function(h){var a=this.lij[0]+1,g=2*this.lij[1],e=2*this.lij[2];if(!h)return[new b(a,g,e,this.tilingScheme),new b(a,g+1,e,this.tilingScheme),new b(a,g,e+1,this.tilingScheme),new b(a,g+1,e+1,this.tilingScheme)];h[0].acquire(a,g,e,this.tilingScheme);h[1].acquire(a,
g+1,e,this.tilingScheme);h[2].acquire(a,g,e+1,this.tilingScheme);h[3].acquire(a,g+1,e+1,this.tilingScheme);return h};b.prototype.copyMeasurementsFrom=function(b){this.measures.visibility=b.measures.visibility;this.measures.shouldSplit=b.measures.shouldSplit;this.measures.distance=b.measures.distance;l.set(b.measures.screen.rect,this.measures.screen.rect)};b.id=function(b,a,g){return b+"/"+a+"/"+g};return b}();b.FeatureTileDescriptor3D=n;b.default=n})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../support/geometryUtils ../../webgl-engine/lib/Camera".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.camera=new d.default;this.pointOfInterestInMap=[0,0];this.screenRect=a.create();this.tileSize=b.tileSize;this.maxVerticalScreenSize=b.maxVerticalScreenSize;this.renderCoordsHelper=b.renderCoordsHelper;this.tilingScheme=b.tilingScheme;this.visibility=new g.FeatureTileVisibility3D({renderCoordsHelper:b.renderCoordsHelper})}b.prototype.begin=function(b,c,d){this.camera.copyFrom(b);this.z=d;this.pointOfInterestInMap[0]=
c.x;this.pointOfInterestInMap[1]=c.y;a.fromValues(0,0,b.fullWidth,b.fullHeight,this.screenRect);this.visibility.begin(this.camera,d)};b.prototype.end=function(){this.visibility.end()};b.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};b.prototype.updateDistanceMeasure=function(b){b.measures.distance=a.distance(b.extent,this.pointOfInterestInMap)};b.prototype.updateScreenMeasure=
function(b){var c=q,d=1<<c,e=b.measures.screen.rect;a.empty(e);for(var f=0,g=b.lij[0]+c,h=b.lij[1]<<c,c=b.lij[2]<<c,k=this.tileSizeWithBias(b),k=k*k,m=!1,p=0;p<d;p++){for(var r=0;r<d&&!(m=this.computeScreenArea(b,g,h+p,c+r,e),f+=m.area,m=f>k&&a.height(e)>this.maxVerticalScreenSize);r++);if(m)break}b.measures.shouldSplit=f>k};b.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*p:this.tileSize};b.prototype.computeScreenArea=function(b,d,g,h,k){var m=r.points;this.projectToScreen(d,
g,h,1===b.measures.visibility,m);a.empty(f);for(b=0;4>b;b++)a.expandPointInPlace(f,m[b]);a.expand(k,f);a.intersection(f,this.screenRect,c);r.screenOverlap=a.area(c)/a.area(f);r.area=e.triangle.areaPoints2d(m[0],m[1],m[2])+e.triangle.areaPoints2d(m[0],m[2],m[3]);return r};b.prototype.projectToScreen=function(a,b,c,d,e){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,b,c,t);this.toRenderCoords(t,0,3,w[0]);this.toRenderCoords(t,2,3,w[1]);this.toRenderCoords(t,2,1,w[2]);this.toRenderCoords(t,
0,1,w[3]);d&&(this.projectToPlane(w,this.camera.frustum.planes[4]),this.projectToPlane(w,this.camera.frustum.planes[3]),this.projectToPlane(w,this.camera.frustum.planes[2]));for(a=0;4>a;a++)this.camera.projectPoint(w[a],y),this.camera.renderToScreen(y,e[a])};b.prototype.projectToPlane=function(a,b){for(var c=0;4>c;c++)u[c]=e.plane.signedDistance(b,a[c]);c=Math.max(u[0],u[1],u[2],u[3]);if(0<c)for(b=k.vec3.scale(x,b,-c),c=0;4>c;c++)k.vec3.add(a[c],a[c],b)};b.prototype.toRenderCoords=function(a,b,c,
d){x[0]=a[b];x[1]=a[c];x[2]=this.z;this.renderCoordsHelper.toRenderCoords(x,this.tilingScheme.spatialReference,d);return d};return b}();b.FeatureTileMeasurements3D=n;var f=a.create(),c=a.create(),q=2,p=5,r={points:[l.createScreenPointArray(),l.createScreenPointArray(),l.createScreenPointArray(),l.createScreenPointArray()],area:0,screenOverlap:0},t=a.create(),x=h.vec3f64.create(),w=[h.vec3f64.create(),h.vec3f64.create(),h.vec3f64.create(),h.vec3f64.create()],u=[0,0,0,0],y=l.createRenderScreenPointArray3();
b.default=n})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils".split(" "),function(n,b,l,k,h,a,g,e,d,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this.surfaceElevation=0;this.cache=
new Map;a=a.renderCoordsHelper;this.frustum=new e.Frustum({renderCoordsHelper:a});this.extendedFrustum=new e.Frustum({renderCoordsHelper:a});this.intersector=new d.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}a.prototype.begin=function(a,b){this.surfaceElevation=b;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>b;this.frustum.update(a);this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,b)};a.prototype.end=function(){this.cache.clear()};
a.prototype.calculate=function(a){if(this.allTilesInvisible)return 0;var b="global"===this.renderCoordsHelper.type&&a.lij[0]>=c&&a.lij[0]<q,d=this.getOrCalculateSingleTileVisibility(a,!b);return 0!==d&&b?this.calculateAggregatedChildrenVisibility(a):d};a.prototype.shortenFrustumFarPlane=function(a){for(var b=a.mutablePoints,c=0,d=e.Frustum.nearFarLineIndices;c<d.length;c++){var f=d[c],g=f[1],f=b[f[0]];h.vec3.subtract(t,b[g],f);h.vec3.scale(t,t,r);h.vec3.add(b[g],f,t)}a.updatePoints(b)};a.prototype.calculateAggregatedChildrenVisibility=
function(a){var b=0,c=this.cache.get(a.id);if(null!=c)return c;c=u.acquire();a.getChildren(c);for(var d=0;d<c.length;d++){var e=this.calculate(c[d]);if(0!==e&&(b=e,2===e))break}u.release(c);this.cache.set(a.id,b);return b};a.prototype.getOrCalculateSingleTileVisibility=function(a,b){var c=this.cache.get(a.id);if(null!=c)return c;c=this.calculateSingleTileVisibility(a);b&&this.cache.set(a.id,c);return c};a.prototype.calculateSingleTileVisibility=function(a){if(!this.aboveGround&&"global"===this.renderCoordsHelper.type&&
a.lij[0]<p){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};a.prototype.calculateSingleTileVisibilitySided=function(a,b){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,b);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};a.prototype.updateExtendedFrustum=
function(a,b){var c=this.renderCoordsHelper;this.extendedFrustum.update(a);this.shortenFrustumFarPlane(this.extendedFrustum);var d=this.renderCoordsHelper.worldUpAtPosition(a.eye,t);this.aboveGround||h.vec3.negate(d,d);d=l.acosClamped(-h.vec3.dot(d,a.viewForward));this.allTilesInvisible=d>(Math.PI+a.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=d>a.fovY/2)){a=this.extendedFrustumParameters(b);b=this.extendedFrustum.mutablePoints;for(d=0;4>d;d++){var e=a.pointIndices[d],g=b[e],k=c.getAltitude(g);
if(a.needsAltitudeAdjustment(k)){this.renderCoordsHelper.worldUpAtPosition(g,t);switch(e){case 4:case 7:case 0:case 3:f.plane.projectVector(this.extendedFrustum.planes[0],t,t);break;case 5:case 6:case 1:case 2:f.plane.projectVector(this.extendedFrustum.planes[1],t,t)}h.vec3.scale(t,t,a.direction);this.renderCoordsHelper.intersectInfiniteManifold(f.ray.wrap(g,t),a.zWithMargin,g)}}this.extendedFrustum.updatePoints(b);f.plane.fromPoints(b[0],b[1],b[2],x);f.plane.fromPoints(b[1],b[2],b[3],w);0>h.vec3.dot(x,
w)&&(c=this.extendedFrustum.mutablePoints,this.aboveGround?(a=[c[1],c[0]],c[0]=a[0],c[1]=a[1]):(a=[c[2],c[3]],c[3]=a[0],c[2]=a[1]),this.extendedFrustum.updatePoints(c))}};a.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};a.prototype.extendedFrustumParametersAboveSurface=function(a,b){var c=a-b;return{zWithMargin:c,pointIndices:e.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:function(a){return a>
c}}};a.prototype.extendedFrustumParametersBelowSurface=function(a,b){var c=a+b;return{zWithMargin:c,pointIndices:e.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<c}}};return a}();b.FeatureTileVisibility3D=n;var c=2,q=6,p=12,r=.95,t=a.vec3f64.create(),x=f.plane.create(),w=f.plane.create(),u=new k(Array,function(a){4!==a.length&&(a[0]=new g.FeatureTileDescriptor3D,a[1]=new g.FeatureTileDescriptor3D,a[2]=new g.FeatureTileDescriptor3D,a[3]=new g.FeatureTileDescriptor3D)},
function(a){a[0].release();a[1].release();a[2].release();a[3].release()});b.default=n})},"esri/views/3d/state/Frustum":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/mathUtils ../support/geometryUtils/frustum".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.frustum=a.create();this.lines=Array(12);this.origin=k.vec3f64.create();this.direction=k.vec3f64.create();
this._altitude=null;this.renderCoordsHelper=b?b.renderCoordsHelper:null;for(b=0;12>b;b++)this.lines[b]={origin:null,direction:k.vec3f64.create(),endpoint:null}}Object.defineProperty(b.prototype,"planes",{get:function(){return this.frustum.planes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"points",{get:function(){return this.frustum.points},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mutablePoints",{get:function(){return this.frustum.points},enumerable:!0,
configurable:!0});b.prototype.update=function(b){a.fromMatrix(b.viewMatrix,b.projectionMatrix,this.frustum);l.vec3.copy(this.origin,b.eye);l.vec3.copy(this.direction,b.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};b.prototype.updatePoints=function(b){for(var d=0;d<this.frustum.points.length;d++)l.vec3.copy(this.frustum.points[d],b[d]);a.recomputePlanes(this.frustum);this.updateLines()};Object.defineProperty(b.prototype,"altitude",{get:function(){return this._altitude},
enumerable:!0,configurable:!0});b.prototype.intersectsSphere=function(b){return a.intersectsSphere(this.frustum.planes,b)};b.prototype.intersectsRay=function(b){return a.intersectsRay(this.frustum.planes,b)};b.prototype.intersectsLineSegment=function(b,d){return a.intersectsLineSegment(this.frustum.planes,b,d)};b.prototype.intersectsPoint=function(b){return a.intersectsPoint(this.frustum.planes,b)};b.prototype.updateLines=function(){for(var a=this.frustum.points,b=0;4>b;b++){var f=b,c=b+4;this.updateLine(this.lines[b],
a[f],a[c]);this.updateLine(this.lines[b+4],a[f],3===b?a[0]:a[f+1]);this.updateLine(this.lines[b+8],a[c],3===b?a[4]:a[c+1])}};b.prototype.updateLine=function(a,b,f){a.origin=b;a.endpoint=f;h.directionFromTo(a.direction,b,f)};b.planePointIndices=a.planePointIndices;b.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return b}();b.Frustum=n;b.default=n})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../core/compilerUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});n=.5*Math.PI;var x=n/Math.PI*180,w=n*c.earthRadius,u=.9*c.earthRadius;c=function(){function a(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:e.vec3f64.create(),direction:e.vec3f64.create()};for(a=0;4>a;a++)this.extent[a]={origin:e.vec3f64.create(),direction:e.vec3f64.create(),cap:{next:null,direction:e.vec3f64.create()}},this.planes[a]=
q.plane.create();this.planes[4]=q.plane.create();this.planes[5]=q.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}a.prototype.update=function(a,b,c,d){void 0===d&&(d=!0);var e=this.extent;this.toRenderBoundingExtent(a,b,c);g.vec3.add(this.center.origin,e[0].origin,e[2].origin);g.vec3.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);d||g.vec3.scale(this.center.direction,this.center.direction,-1);for(c=0;4>
c;c++){var f=e[c];this.renderCoordsHelper.worldUpAtPosition(f.origin,f.direction);var h=e[3===c?0:c+1];f.cap.next=h.origin;r.directionFromTo(f.cap.direction,f.origin,h.origin);q.plane.fromVectorsAndPoint(f.direction,f.cap.direction,f.origin,this.planes[c]);d||g.vec3.scale(f.direction,f.direction,-1)}q.plane.fromVectorsAndPoint(e[0].cap.direction,e[1].cap.direction,e[0].origin,this.planes[4]);d?q.plane.negate(this.planes[4],this.planes[5]):(q.plane.copy(this.planes[4],this.planes[5]),q.plane.negate(this.planes[4],
this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));this.maxSpanSpatialReference=b};a.prototype.isVisibleInFrustum=function(a,b){void 0===b&&(b=!1);if(null==a)return!1;if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?x:w))return!0;if(a.altitude>=u)return this.isVisibleInFrustumGlobal(a)}if(0===this.maxSpan){var c=this.extent[0];return!b&&a.intersectsRay(q.ray.wrap(c.origin,c.direction))?!0:!1}for(var d=0;d<this.extent.length;d++)if(c=
this.extent[d],!b&&a.intersectsRay(q.ray.wrap(c.origin,c.direction))||a.intersectsLineSegment(q.lineSegment.fromPoints(c.origin,c.cap.next,C),c.cap.direction))return!0;b=b?this.planes:this.planesWithoutFar;for(d=0;d<a.lines.length;d++)if(c=a.lines[d],p.frustumLineSegment(b,c.origin,c.endpoint,c.direction))return!0;return!1};a.prototype.toRenderBoundingExtentGlobal=function(a,b,c){f.center(a,m);m[2]=c;t.computeLinearTransformation(b,m,v,this.renderCoordsHelper.spatialReference);h.mat4.invert(z,v);
d.empty(B);for(var e=0,p=y;e<p.length;e++)for(var q=p[e],r=q.x0,l=q.x1,u=q.y0,q=q.y1,x=0;5>x;x++){var w=x/4;m[0]=k.lerp(a[r],a[l],w);m[1]=k.lerp(a[u],a[q],w);m[2]=c;t.vectorToVector(m,b,m,this.renderCoordsHelper.spatialReference);g.vec3.transformMat4(m,m,z);d.expandPointInPlace(B,m)}g.vec3.set(this.extent[0].origin,B[0],B[1],B[2]);g.vec3.set(this.extent[1].origin,B[3],B[1],B[2]);g.vec3.set(this.extent[2].origin,B[3],B[4],B[2]);g.vec3.set(this.extent[3].origin,B[0],B[4],B[2]);for(x=0;4>x;++x)g.vec3.transformMat4(this.extent[x].origin,
this.extent[x].origin,v)};a.prototype.toRenderBoundingExtentLocal=function(a,b,c){g.vec3.set(this.extent[0].origin,a[0],a[1],c);g.vec3.set(this.extent[1].origin,a[2],a[1],c);g.vec3.set(this.extent[2].origin,a[2],a[3],c);g.vec3.set(this.extent[3].origin,a[0],a[3],c)};a.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,b,c);break;case "local":this.toRenderBoundingExtentLocal(a,b,c);break;default:l.neverReached(this.renderCoordsHelper.type)}};
a.prototype.isVisibleInFrustumGlobal=function(a){if(0>g.vec3.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>g.vec3.dot(this.extent[b].direction,a.direction))return!0;return!1};return a}();b.FrustumExtentIntersection=c;var y=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],m=e.vec3f64.create(),v=a.mat4f64.create(),z=a.mat4f64.create(),B=d.create(),C=q.lineSegment.create();b.default=c})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isMemoryManagedLayerView=function(b){return"function"===typeof b.getUsedMemory}})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Evented ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3f64 ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function h(c){c=b.call(this,c)||this;c.propertiesPool=new r.default({camera:t.default},c);c.lastSeenCameraProjectionValues=new t.default;c.events=new a;c.updateQueue=[];c.processingUpdates=!1;return c}l(h,b);h.prototype.destroy=function(){this.cameraController=null;this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};h.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),
mode:a.viewingMode,spatialReference:a.spatialReference,constraints:new f.default({mode:a.viewingMode})}};Object.defineProperty(h.prototype,"animation",{get:function(){return this.cameraController instanceof c.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==x&&x.copyFrom(a);x.markViewDirty();x.computeUp(this.mode);w.camera=x;this.events.emit("before-camera-change",
w);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,x)&&(this.lastSeenCameraProjectionValues.copyFrom(x),u.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",u));a&&a.equals(x)||this._set("camera",this.propertiesPool.get("camera").copyFrom(x))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isLocal",
{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"interacting",{get:function(){return!!this.cameraController&&this.cameraController.isInteractive},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(c){if(c===q.State.Finished||c===q.State.Stopped)b._set("cameraController",
null),b.updateCamera(function(b){return a.onControllerEnd(b)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=q.State.Rejected)},enumerable:!0,configurable:!0});h.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==q.State.Rejected};h.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};h.prototype.cameraChanged=function(){this.updateCamera(function(){})};
h.prototype.updateCamera=function(a){this.updateQueue.push(a);this.processUpdateQueue()};h.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();x.copyFrom(this._get("camera"));a(x);this.camera=x;this.processingUpdates=!1;this.processUpdateQueue()}};h.prototype.createInitialCamera=function(a){return"global"===a?new t.default(e.vec3f64.fromValues(4*p.earthRadius,0,0),e.vec3f64.fromValues(p.earthRadius,
0,0),e.vec3f64.fromValues(0,0,1)):new t.default(e.vec3f64.fromValues(0,0,100),e.vec3f64.fromValues(0,0,0),e.vec3f64.fromValues(0,1,0))};h.prototype.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};k([g.property({readOnly:!0,
type:d,dependsOn:["cameraController"]})],h.prototype,"animation",null);k([g.property({type:t.default})],h.prototype,"camera",null);k([g.property({constructOnly:!0})],h.prototype,"constraints",void 0);k([g.property({readOnly:!0})],h.prototype,"events",void 0);k([g.property({readOnly:!0,dependsOn:["isLocal"]})],h.prototype,"isGlobal",null);k([g.property({readOnly:!0,dependsOn:["mode"]})],h.prototype,"isLocal",null);k([g.property({constructOnly:!0})],h.prototype,"mode",void 0);k([g.property({constructOnly:!0})],
h.prototype,"spatialReference",void 0);k([g.property({readOnly:!0,dependsOn:["cameraController"]})],h.prototype,"interacting",null);k([g.property()],h.prototype,"cameraController",null);return h=k([g.subclass("esri.views.3d.state.ViewState")],h)}(g.declared(h));b.ViewState=n;var x=new t.default,w={camera:null},u={camera:null};b.default=n})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],function(n,
b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){var e=this;this.owner=b;this.properties={};this.afterDispatchHandle=null;for(var d in a)b=new l.ReentrantObjectPool(a[d],null,null,2,2),this.properties[d]={pool:b,acquired:[]};this.afterDispatchHandle=k.afterDispatch(function(){return e.release()})}b.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(var a in this.properties){for(var b=this.properties[a],
e=0,d=b.acquired;e<d.length;e++){var f=d[e];k.isValueInUse(f)||b.pool.release(f)}b.pool.destroy();b.pool=null;b.acquired=null}this.owner=this.properties=null};b.prototype.get=function(a){var b=this.owner._get(a);a=this.properties[a];var e=a.pool.acquire();for(a.acquired.push(e);e===b;)a.acquired.push(e),e=a.pool.acquire();return e};b.prototype.release=function(){for(var a in this.properties){for(var b=this.properties[a],e=0,d=0,f=b.acquired;d<f.length;d++){var c=f[d];k.isValueInUse(c)?b.acquired[e++]=
c:b.pool.release(c)}b.acquired.length=e}};return b}();b.PropertiesPool=n;b.default=n})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T){Object.defineProperty(b,"__esModule",{value:!0});var U=p.getLogger("esri.views.3d.state.ViewStateManager");n=function(b){function f(a){a=b.call(this)||this;a.propertiesPool=new M.default({frustum:Q.default},a);a.handles=new q;a.cameraSetByUser=!1;a.internalSetOrder=[];a.immediateGoToController=null;a.animatedGoToController=null;a.ready=!1;a.updateDevicePixelRatio=null;return a}k(f,b);Object.defineProperty(f.prototype,
"camera",{get:function(){return this.ready?L.internalToExternal(this.view,this.view.state.camera):this._get("camera")},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(L.externalToInternal(this.view,a),{applyConstraints:!1})||U.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",
a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.update():U.error("#center\x3d","Invalid center",a):U.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):U.error("#center\x3d","Center may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"extent",
{get:function(){return this.ready?L.toExtent(this.view,null,null,null,V):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||U.error("#extent\x3d","Invalid extent",a):U.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):U.error("#extent\x3d","Extent may not be null or undefined"))},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");
var a=this.view.pointsOfInterest.centerOnContent;return L.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||U.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera,b=a.padding,c=a.pixelRatio,a=this._get("padding"),d=b[0]/
c,e=b[1]/c,f=b[2]/c,b=b[3]/c;return null!=a&&a.top===d&&a.right===e&&a.bottom===f&&a.left===b?a:{top:d,right:e,bottom:f,left:b}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(this.paddingToArray(a,this.view.state.camera.pixelRatio,ca),this.view.state.updateCamera(function(a){return a.padding=ca}))},enumerable:!0,configurable:!0});f.prototype.paddingToArray=function(a,b,c){a?m.vec4.set(c,a.top||0,a.right||0,a.bottom||0,a.left||0):m.vec4.set(c,0,0,0,0);for(a=0;4>a;a++)c[a]=Math.round(c[a]*
b)};Object.defineProperty(f.prototype,"screenCenter",{get:function(){var a=this.padding;return w.createScreenPoint((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewpoint",{get:function(){return this.ready?R.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),
{applyConstraints:!a.camera})||U.error("#viewpoint\x3d","Invalid viewpoint",a);else{var b=a.camera?a.camera.position:a.targetGeometry,b=b&&b.spatialReference;U.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(b?b.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else U.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"zoom",{get:function(){return this.ready?L.scaleToZoom(this.view,
this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||U.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});f.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch("state.camera",function(b){return a.cameraChangedSync(b)},!0),u.on(this.view,"state.events","before-camera-change",function(b){return a.updateElevation(b.camera)})]);u.once(this.view,"state.camera",
function(b){return a.updateElevation(b)},!0);this.handles.add(x.addFrameTask({prepare:function(){return a.prepareFrame()}}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(da);a.cancelImmediateGoTo()}));this.handles.add(u.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};f.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),
this.propertiesPool=null)};f.prototype.init=function(){var a=this;this.constraintsManager=new I.default({view:this.view});this.prepareFrame();var b=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(var c=0;c<b.length;c++){var d=b[c];this.set(d.name,d.value)}this.cameraSetByUser||((b=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(b)?this.setInitialView(b):"local"===this.view.state.mode&&this.handles.add(u.whenOnce(this.view.basemapTerrain,
"ready",function(){a.handles.remove(da);a.setInitialView(a.view.groundExtent)}),da))};f.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(da),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};f.prototype.goTo=function(b,c){return g(this,void 0,
void 0,function(){var d;return a(this,function(a){d=l({animate:!0},c);return d.animate?[2,this.goToAnimated(b,d)]:[2,this.goToImmediate(b,d)]})})};f.prototype.debugSetCameraOnContent=function(){this.setStateCamera(K.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};f.prototype.step=function(a){var b=this.view.state,c=b&&this.view.state.cameraController;c&&(b.updateCamera(function(b){c.stepController(a,b)}),c.steppingFinished&&c.finishController())};f.prototype.cancelImmediateGoTo=
function(){var a=this.immediateGoToController;r.isSome(a)&&(this.immediateGoToController=null,a.abort())};f.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToController;r.isSome(a)&&(this.animatedGoToController=null,a.abort())};f.prototype.getInitialProperties=function(){for(var a=this,b=new Set,c=[],d=0,e=X;d<e.length;d++){var f=e[d],g=f.propertyName,f=f.overrides,h=b.has(g),k=this._isOverridden(g);!h&&k&&c.push({name:g,value:this._get(g)});this._clearOverride(g);(h||k)&&f.forEach(function(a){return b.add(a)})}return c.sort(function(b,
c){b=a.internalSetOrder.indexOf(b.name);c=a.internalSetOrder.indexOf(c.name);return b<c?-1:b>c?1:0})};f.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser)if(a instanceof e)this.setStateCamera(L.externalToInternal(this.view,a),{applyConstraints:!1});else if(a instanceof d)if(a.targetGeometry instanceof z){var b=L.fromExtent(this.view,a.targetGeometry,0,.5,L.OrientationMode.LOCKED);this.setStateCamera(L.externalToInternal(this.view,b),{applyConstraints:!0})}else b={applyConstraints:!a.camera},
a=this.viewpointToCamera(a),this.setStateCamera(a,b);else b=L.fromExtent(this.view,a,0,.5,L.OrientationMode.LOCKED),this.setStateCamera(L.externalToInternal(this.view,b),{applyConstraints:!0})};f.prototype.updatePropertyBeforeReady=function(a,b){if(!this.ready){this._override(a,b);var c=this.internalSetOrder.indexOf(a);-1!==c&&(this.internalSetOrder=this.internalSetOrder.splice(c,1));b&&(this.internalSetOrder.push(a),-1!==Y.indexOf(a)&&this._override("hasInitialView",!0));return!0}return!1};f.prototype.isCompatible=
function(a){return a?a instanceof d?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof e?this.isCompatible(a.position):a.spatialReference&&C.canProject(a.spatialReference,this.view.spatialReference):!1};f.prototype.getPreservingHeadingTilt=function(a){void 0===a&&(a=P);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};f.prototype.centerPointAtDistanceToCamera=function(a,b,c){void 0===c&&(c=Z);var d=this.getPreservingHeadingTilt();
return(a=L.getObserverForPointAtDistance(this.view,d.heading,d.tilt,a,b,L.OrientationMode.ADJUST))?(c.copyFrom(this.view.state.camera),c.eye=a.eye,c.center=a.center,c.up=a.up,c):null};f.prototype.centerToCamera=function(a){var b=this.view.pointsOfInterest.centerOnContent;b.update();return this.centerPointAtDistanceToCamera(a,b.distance)};f.prototype.extentToCamera=function(a){var b=this.getPreservingHeadingTilt();a=L.fromExtent(this.view,a,b.heading,b.tilt,L.OrientationMode.ADJUST,V);return L.externalToInternal(this.view,
a)};f.prototype.scaleToCamera=function(a){if(null==a)return null;var b=this.view.pointsOfInterest.centerOnContent;b.update();var c=b.renderLocation;a=L.scaleToDistance(this.view,a,b.location.latitude);return this.centerPointAtDistanceToCamera(c,a)};f.prototype.zoomToCamera=function(a){return this.scaleToCamera(L.zoomToScale(this.view,a))};f.prototype.viewpointToCamera=function(a){return(a=R.toCamera(this.view,a))?L.externalToInternal(this.view,a):null};f.prototype.setStateCamera=function(a,b){var c=
this;if(!a||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(d){d.copyFrom(a);b.applyConstraints&&D.applyAll(c.view,d)});b.applyConstraints||(this.view.state.cameraController=new N.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};f.prototype.prepareFrame=function(){var a=this.view,b=a.container,c=a.canvas;if(b&&c){r.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();
var a=this.view.pixelRatio,d=Math.round(b.clientWidth*a),b=Math.round(b.clientHeight*a);0!==d&&0!==b&&(c.width=d,c.height=b,this.view.state&&(c=this.view.state.camera,c.fullWidth!==d||c.fullHeight!==b||c.pixelRatio!==a))&&(Z.copyFrom(c),Z.pixelRatio!==a&&(this.paddingToArray(this.padding,a,ca),Z.padding=ca),Z.fullWidth=d,Z.fullHeight=b,Z.pixelRatio=a,this.view.state.camera=Z)}};f.prototype.updateElevation=function(a){var b=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,c=this.view.renderCoordsHelper.getAltitude(a.eye),
b=b?K.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=c-b};f.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};f.prototype.createGoToCamera=function(b,f){return g(this,void 0,void 0,function(){var g,h,k,m,p,q,r,l;return a(this,function(a){switch(a.label){case 0:return[4,u.whenOnce(this,"ready",f.signal,!0)];case 1:return a.sent(),t.throwIfAborted(f),[4,R.create(this.view,b,f.signal)];case 2:g=a.sent();h=!!(b instanceof d&&b.camera||b instanceof
e);k=g.camera;if(!this.isCompatible(k))throw q=(p=(m=k.position)&&m.spatialReference)?p.wkid:"none",r=this.view.spatialReference.wkid,new c("goto:incompatible-spatialreference","Resulting camera has an incompatible spatial reference (camera: "+q+", view: "+r+")",{camera:k});l=L.externalToInternal(this.view,k);if(!l)throw new c("goto:invalid-camera","Resulting camera is invalid");return[2,{viewpoint:g,camera:l,isFullySpecified:h}]}})})};f.prototype.cancellableGoTo=function(a,b){var c=this,d,e=function(){c.view.state.cameraController===
a&&a.active&&a.asyncResult===d&&a.stopController()};return t.create(function(c,f){d={resolve:c,reject:f};a.asyncResult=d;t.onAbort(b,e)},e)};f.prototype.goToImmediate=function(b,d){return g(this,void 0,void 0,function(){var e,f,g,h=this;return a(this,function(a){this.cancelAnimatedGoTo();this.cancelImmediateGoTo();e=t.createAbortController();t.onAbort(d,function(){return e.abort()});f=this.createGoToCamera(b,l({},d,{signal:e.signal}));g=function(){h.immediateGoToController===e&&(h.immediateGoToController=
null)};this.immediateGoToController=e;return[2,f.then(function(a){g();h.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified})}).catch(function(a){g();!t.isAbortError(a)&&a instanceof c&&a.message&&U.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));throw a;})]})})};f.prototype.goToAnimatedBeforeReady=function(b,c){return g(this,void 0,void 0,function(){var d;return a(this,function(a){switch(a.label){case 0:return this.cancelAnimatedGoTo(),
d=t.createAbortController(),t.onAbort(c,function(){return d.abort()}),this.animatedGoToController=d,c=l({},c,{signal:d.signal}),[4,u.whenOnce(this.view,"ready",d.signal)];case 1:return a.sent(),this.animatedGoToController=null,[2,this.goToAnimated(b,c)]}})})};f.prototype.goToAnimated=function(b,d){return g(this,void 0,void 0,function(){var e,f,h,k,m,p,q=this;return a(this,function(r){this.cancelAnimatedGoTo();if(!this.ready)return[2,this.goToAnimatedBeforeReady(b,d)];e=this.view.state.cameraController;
e instanceof J.PointToPointAnimationController&&(e.updateStateFromViewAnimation(),e.active&&(f=e));null==f&&(f=new J.PointToPointAnimationController(this.view.state,this.view.sceneIntersectionHelper));h=f.viewAnimation;k=this.createGoToCamera(b,d);h.update(k.then(function(a){return a.viewpoint}));if(f!==e&&!this.view.state.switchCameraController(f))return h.stop(),U.error("#goTo()","Cannot start an animation while interacting"),[2,t.reject(new c("view:goto-cannot-interrupt","Cannot start an animation while interacting"))];
m=h.target;p=function(){return q.view.state.cameraController===f&&f.viewAnimation.target===m&&f.active};k.then(function(b){var c=b.viewpoint,e=b.camera,k=b.isFullySpecified;return g(q,void 0,void 0,function(){var b,g;return a(this,function(a){switch(a.label){case 0:if(!p())return[2];f.viewAnimation.update(c);m=f.viewAnimation.target;k?(b=new N.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:e}),D.applySurfaceCollision(this.view,e,1)):D.applyAll(this.view,e);f.begin(e,this.internalAnimateOptions(d));
return[4,h.when()];case 1:return a.sent(),g=this.view.state.cameraController,b&&(g&&g.active?g instanceof J.PointToPointAnimationController&&g.viewAnimation.target===m&&(this.view.state.cameraController=b):f.viewAnimation.target===m&&(this.view.state.cameraController=b)),[2]}})})}).catch(function(a){!t.isAbortError(a)&&a instanceof c&&a.message&&U.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));if(p())throw q.view.state.cameraController.stopController(),
a;});return[2,this.cancellableGoTo(f,d)]})})};f.prototype.internalAnimateOptions=function(a){var b={};a&&(null!=a.speedFactor&&(b.speedFactor=a.speedFactor),null!=a.duration&&(b.duration=a.duration/1E3),null!=a.maxDuration&&(b.maxDuration=a.maxDuration/1E3),null!=a.easing&&(b.easing="string"===typeof a.easing?T.named[a.easing]:a.easing));return b};h([y.property({type:e,dependsOn:["view.state.camera","ready"]})],f.prototype,"camera",null);h([y.property({type:B,dependsOn:["view.pointsOfInterest.centerOnContent.location",
"ready"]})],f.prototype,"center",null);h([y.property({type:z,dependsOn:["view.state.camera","ready"]})],f.prototype,"extent",null);h([y.property({readOnly:!0,dependsOn:["view.state.camera","ready"]})],f.prototype,"frustum",null);h([y.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],f.prototype,"hasInitialView",null);h([y.property({readOnly:!0,type:Boolean})],f.prototype,"ready",void 0);h([y.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],
type:Number})],f.prototype,"scale",null);h([y.property({dependsOn:["view.state.camera","ready"]})],f.prototype,"padding",null);h([y.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],f.prototype,"screenCenter",null);h([y.property({constructOnly:!0})],f.prototype,"view",void 0);h([y.property({type:d,dependsOn:["camera","ready"]})],f.prototype,"viewpoint",null);h([y.property({type:Number,dependsOn:["scale"]})],f.prototype,"zoom",null);h([y.property({constructOnly:!0})],f.prototype,
"updateDevicePixelRatio",void 0);return f=h([y.subclass("esri.views.3d.state.ViewStateManager")],f)}(y.declared(f));b.ViewStateManager=n;var Y="camera viewpoint extent scale center zoom".split(" "),X=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"center",overrides:[]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],
P={heading:0,tilt:0},V=new e,Z=new S.default,ca=v.vec4f64.create(),da="pending-initial-view";b.default=n})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function h(c){var d=b.call(this)||this;d.handles=new a;d.nearFarHeuristic=q.createNearFarHeuristic(c.view.state.mode,c.view.basemapTerrain,c.view.renderCoordsHelper.spatialReference);return d}l(h,b);h.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),this.view.watch("constraints.clipDistance.mode",
function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(b){return a.cameraUpdateNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)]);this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)]);this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},!0),this.view.watch("constraints.tilt.mode",
function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)]);this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a.updateCollision()},!0));this.view.state.isLocal&&this.handles.add(e.init(this.view,"dataExtent",function(b){return a.updateLocalSurfaceDistance(b)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();this.updateTilt();this.updateCollision();
this._set("surfaceCollisionConstraint",new p.default({view:this.view}))};h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};h.prototype.handleClipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a.cameraUpdateNearFarManual(c,
b);return!0})};h.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};h.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a.cameraUpdateNearFar(b);return!0})};h.prototype.cameraUpdateNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this.cameraUpdateNearFarManual(a,b):this.cameraUpdateNearFarAuto(a,b)};h.prototype.cameraUpdateNearFarAuto=function(a,b){this.nearFarHeuristic.compute(a.eye,
a.center,this.view.dataExtent,c.surfaceElevationBelowEye(this.view,a),a);b&&b.autoUpdate(a.near,a.far)};h.prototype.cameraUpdateNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};h.prototype.updateCollision=function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,b=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===a.type:b,b=this.view.state.constraints.collision;a!==b.enabled&&((b.enabled=a)&&this.reapplyConstraints(8),
(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this.updateTiltAuto(a))};h.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};h.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};h.prototype.handleTiltModeChanged=function(){this.updateTilt()};h.prototype.handleTiltMaxChanged=function(){var a=
this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};h.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto(a);this.reapplyConstraints()};h.prototype.updateTiltManual=function(a){var b=this.view.state.constraints;b.tilt=b.createConstantMaxTilt(g.deg2rad(a.max))};h.prototype.updateTiltAuto=function(a){a=this.view.state.constraints;
a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};h.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(g.rad2deg(b)))}};h.prototype.updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);0>=b||(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&
(a.constraints.distance=b))};h.prototype.reapplyConstraints=function(a){var b=this;void 0===a&&(a=15);this.view.state.updateCamera(function(c){return f.applyAll(b.view,c,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})})};k([d.property({constructOnly:!0})],h.prototype,"view",void 0);k([d.property({readOnly:!0})],h.prototype,"surfaceCollisionConstraint",void 0);return h=k([d.subclass("esri.views.3d.state.ConstraintsManager")],
h)}(d.declared(h));b.ConstraintsManager=n;b.default=n})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../core/mathUtils ../../../core/mathUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils".split(" "),function(n,b,l,k,h,a,g,e){function d(a,b,c,d){c=p/c;a/b>c?(d.far=a,d.near=d.far/b):(d.near=c,d.far=d.near*b);return d}Object.defineProperty(b,"__esModule",{value:!0});b.createNearFarHeuristic=
function(a,b,d){return"global"===a?new c:new f(b,d)};var f=function(){function b(a,b){this.elevationProvider=a;this.unitInMeters=h.getMetersPerUnitForSR(b)}b.prototype.compute=function(b,c,f,g,h){h||(h={near:0,far:0});var m=e.earthRadius,p=b[2]*this.unitInMeters,v=p;g=p-g;var u=this.elevationProvider?this.elevationProvider.elevationBounds:null;u&&(p=0<=g?v-this.unitInMeters*u.min:this.unitInMeters*u.max-v);v=Math.max(f.xmax-f.xmin,f.ymax-f.ymin,4*Math.max(f.xmax-f.xmin,f.ymax-f.ymin));a.vec3.subtract(w,
c,b);x[0]=0<w[0]?f.xmax:f.xmin;x[1]=0<w[1]?f.ymax:f.ymin;x[2]=0<w[2]?v/2:-v/2;a.vec3.subtract(x,x,b);a.vec3.normalize(w,w);b=1.1*a.vec3.dot(x,w)*this.unitInMeters;m=Math.sqrt(p*(p+2*m));f=Math.max(f.xmax-f.xmin,f.ymax-f.ymin);c=f*t*this.unitInMeters;p=l.clamp((p-c)/(f*r*this.unitInMeters-c),0,1);p=k.lerp(m,b,p*p*p);p*=Math.max(Math.log(Math.abs(g)),1);p=Math.min(p,Math.max(34064E4,v));p/=this.unitInMeters;return d(p,q,this.unitInMeters,h)};return b}(),c=function(){function b(){}b.prototype.compute=
function(b,c,f,g,h){h||(h={near:0,far:0});c=e.earthRadius;b=a.vec3.length(b)-c;b=Math.max(Math.abs(b-g),Math.abs(b));g=Math.sqrt(b*(b+2*(c+Math.min(0,g))));b=l.clamp(2E4-(Math.log(b)-7.983)/9.011*19E3,1E3,2E4);return d(1.2*g,b,1,h)};return b}(),q=2E4,p=2,r=.001,t=1E-4,x=g.vec3f64.create(),w=g.vec3f64.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(c){c=b.call(this)||this;c.handles=new a;return c}l(c,b);c.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};c.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};c.prototype.handleElevationChangeEvent=function(a){this.view.state.cameraController||d.eyeWithinExtent(this.view,
this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};c.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){e.applySurfaceCollision(a.view,b,1)})};k([g.property({constructOnly:!0})],c.prototype,"view",void 0);return c=k([g.subclass("esri.views.3d.state.ElevationCollisionConstraint")],c)}(g.declared(h));b.SurfaceCollisionConstraint=n;b.default=n})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a){var c=b.call(this)||this;c.handles=new k;c.view=a.view;c.desiredCamera=a.desiredCamera.clone();return c}l(d,b);Object.defineProperty(d.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0});d.prototype.onControllerStart=function(a){var c=
this;b.prototype.onControllerStart.call(this,a);this.handles.add(this.view.basemapTerrain.on("elevation-change",function(a){return c.handleElevationChangeEvent(a)}));this.applyCorrection()};d.prototype.onControllerEnd=function(a){this.handles.removeAll();this.view=null;b.prototype.onControllerEnd.call(this,a)};d.prototype.handleElevationChangeEvent=function(b){a.eyeWithinExtent(this.view,this.desiredCamera,b.extent,b.spatialReference)&&this.applyCorrection()};d.prototype.applyCorrection=function(){var a=
this;this.view.state.updateCamera(function(b){b.copyViewFrom(a.desiredCamera);h.applySurfaceCollision(a.view,b,1)||a.constraintEnabled||(a.state=g.State.Stopped)})};return d}(g.CameraController);b.SurfaceCollisionCorrectionController=n})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/compilerUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./geometryUtils ./mathUtils ./projectionUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K){function I(a){return 360-D.cyclicalDeg.normalize(a)}function Q(a){return D.cyclicalDeg.normalize(360-a)}function J(a,b){a&&a.resolver&&(null==b?a.resolver.reject():a.resolver.resolve(b));return b}function N(b,c,d,e){if(!c)return J(e);var f=b.spatialReference||a.SpatialReference.WGS84;if(c.camera){b=c.get("camera.position.spatialReference");if(!v.canProject(b,f))return J(e);c=c.camera.clone();b.equals(f)||(c.position=v.project(c.position,
f));return J(e,c)}var g=c.get("targetGeometry.spatialReference");if(g&&!v.canProject(g,f))return J(e);f=B.internalToExternal(b,b.state.camera);g=B.OrientationMode.ADJUST;null!=c.rotation&&(f.heading=I(c.rotation),g=B.OrientationMode.LOCKED);null!=d&&(f.tilt=d);if("point"===c.targetGeometry.type){d=c.targetGeometry;var h=void 0,k=c.targetGeometry.clone(),h=null!=c.scale?B.scaleToDistance(b,c.scale,d.latitude):b.state.camera.distance;return B.fromCenterDistance(b,k,h,f,g,e)}return B.fromExtent(b,c.targetGeometry.extent,
f.heading,f.tilt,g,e)}function L(a,b){return null==b.scale&&null!=b.zoom?B.zoomToScale(a,b.zoom):b.scale}function M(a,b){var c=!1;null!=b.heading?(a.heading=b.heading,c=!0):null!=b.rotation&&(a.heading=I(b.rotation),c=!0);null!=b.tilt&&(a.tilt=b.tilt,c=!0);null!=b.fov&&(a.fov=b.fov);return c}function R(b,c,d){var e=b.spatialReference||a.SpatialReference.WGS84;c=c||B.externalToInternal(b,d.camera);d.targetGeometry=K.vectorToPoint(c.center,b.renderSpatialReference,e);d.scale=B.computeScale(b,c);d.rotation=
Q(d.camera.heading);return d}function S(a,b,d){if(b){if(!v.canProject(b.spatialReference,a.spatialReference))throw new c("viewpointutils:incompatible-spatialreference","Spatial reference ("+(b.spatialReference?b.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:b});var e=[];if(!b.hasZ&&a.basemapTerrain){var g=void 0;switch(b.type){case "point":g=b;break;case "multipoint":case "polyline":case "mesh":g=b.extent.center;break;case "extent":g=b.center;
break;case "polygon":g=b.centroid;break;default:f.neverReached(b)}g&&v.canProject(g,a.basemapTerrain.spatialReference)?F[2]=a.basemapTerrain.getElevation(g)||0:F[2]=0}(0,wa[b.type])(b,function(a){e.push(a[0],a[1],a[2])},F);var h=e.length/3;if(0!==h&&(g=Array(e.length),K.bufferToBuffer(e,b.spatialReference,0,g,a.spatialReference,0,h)))for(b.hasZ&&(d.hasZ=!0),a=0;a<g.length;a+=3)b.hasZ?(F[0]=g[a+0],F[1]=g[a+1],F[2]=g[a+2]):(F[0]=g[a+0],F[1]=g[a+1]),y.expand(d.boundingBox,F)}}function T(a,b,c,e){return k(this,
void 0,void 0,function(){var f,g,h,k,m,p;return l(this,function(r){switch(r.label){case 0:return[4,d.result(a.whenViewForGraphic(b))];case 1:f=r.sent();if(!1===f.ok||q.isNone(f.value)||!("whenGraphicBounds"in f.value))return S(a,b.geometry,e),[2];g=f.value;return[4,d.result(g.whenGraphicBounds(b,{minDemResolution:c}))];case 2:h=r.sent();if(!1===h.ok)return S(a,b.geometry,e),[2];k=h.value;m=k.screenSpaceObjects;p=k.boundingBox;y.expand(e.boundingBox,p);m&&m.forEach(function(a){e.screenSpaceObjects.push(a)});
isFinite(p[2])&&(e.hasZ=!0);return[2]}})})}function U(b,c,d,e){return k(this,void 0,void 0,function(){var f,h;return l(this,function(k){switch(k.label){case 0:return Array.isArray(c)&&2===c.length&&(f=c[0],h=c[1],"number"===typeof f&&"number"===typeof h)?(na.x=f,na.y=h,na.z=void 0,na.spatialReference=b.spatialReference.isGeographic?b.spatialReference:a.SpatialReference.WGS84,S(b,na,e),[2]):c&&"function"===typeof c.map?[4,p.eachAlways(c.map(function(a){return U(b,a,d,e)}))]:[3,2];case 1:return k.sent(),
[2];case 2:if(!(c instanceof a.BaseGeometry))return[3,3];S(b,c,e);return[3,5];case 3:return c instanceof g?[4,T(b,c,d,e)]:[3,5];case 4:k.sent(),k.label=5;case 5:return[2]}})})}function Y(a,b,c,d,e){return k(this,void 0,void 0,function(){var f,g,h;return l(this,function(k){switch(k.label){case 0:if(b.camera)return[2,X(a,c,b.camera,e)];e.scale=b.scale;e.rotation=b.rotation;e.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;e.camera=null;null!=c.heading?e.rotation=Q(c.heading):null!=c.rotation&&
(e.rotation=c.rotation);f=L(a,c);null!=f&&(e.scale=f);g=B.createAsyncContext(d);N(a,e,c.tilt,g);h=e;return[4,g.resolver.promise];case 1:return h.camera=k.sent(),[2,e]}})})}function X(a,b,c,d){d.camera=c.clone();d.camera.fov=a.camera.fov;b=a.spatialReference;c=d.camera.position.spatialReference;if(!v.canProject(c,b))return null;c.equals(b)||(d.camera.position=v.project(d.camera.position,b));return R(a,null,d)}function P(b,d,e,f,g){return k(this,void 0,void 0,function(){var h,k,m,p,q,r;return l(this,
function(l){switch(l.label){case 0:if(!e)throw new c("createfromcenter","invalid point");g.targetGeometry=e.clone();h=z.cameraOnContentAlongViewDirection(b);if(d.position){l=g.targetGeometry;var t=h,v=b.renderSpatialReference;K.pointToVector(d.position,fa,v);K.pointToVector(l,xa,v);g.targetGeometry=new a.Point(l);g.camera.position=new a.Point(d.position);w.vec3.subtract(va,xa,fa);B.directionToHeadingTilt(b,fa,va,t.up,g.camera);g.scale=B.distanceToScale(b,w.vec3.distance(fa,xa),g.targetGeometry.latitude);
g.rotation=Q(g.camera.heading);return[2,g]}d.zoomFactor&&(k=h.distance/d.zoomFactor,m=w.vec3.scale(F,h.viewForward,-k),w.vec3.add(h.eye,h.center,m),h.markViewDirty(),g.scale=B.distanceToScale(b,k,e.latitude));B.internalToExternal(b,h,g.camera);p=M(g.camera,d)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;if(d.zoomFactor)return[3,2];g.scale=L(b,d);null==g.scale&&(K.pointToVector(e,F,b.renderSpatialReference),C.frustum.intersectsPoint(h.frustum.planes,F)?g.scale=B.distanceToScale(b,w.vec3.distance(h.eye,
F),e.latitude):g.scale=B.computeScale(b,h));q=B.createAsyncContext(f);B.fromCenterScale(b,g.targetGeometry,g.scale,g.camera,p,q);r=g;return[4,q.resolver.promise];case 1:r.camera=l.sent(),l.label=2;case 2:return[2,g]}})})}function V(a,b,c,d){return k(this,void 0,void 0,function(){var e,f;return l(this,function(g){e=z.cameraOnContentAlongViewDirection(a);f=K.vectorToPoint(e.center,a.renderSpatialReference,na,a.spatialReference);return[2,P(a,b,f,c,d)]})})}function Z(a,b,c,d,e){return k(this,void 0,void 0,
function(){var f,g,h,k;return l(this,function(m){switch(m.label){case 0:return e.targetGeometry=c.clone(),f=z.cameraOnContentAlongViewDirection(a),B.internalToExternal(a,f,e.camera),g=M(e.camera,b)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST,h=B.createAsyncContext(d),B.fromExtent(a,c,e.camera.heading,e.camera.tilt,g,h),k=e,[4,h.resolver.promise];case 1:return k.camera=m.sent(),[2,e]}})})}function ca(a,b,c,d,e,f,g){return k(this,void 0,void 0,function(){var h,k,m,p,q;return l(this,function(l){switch(l.label){case 0:g.targetGeometry=
c.clone();l=h=z.cameraOnContentAlongViewDirection(a);var t=0;c.hasZ?t=c.z:a.basemapTerrain&&(t=a.basemapTerrain.getElevation(c));w.vec3.set(F,c.x,c.y,t);K.computeLinearTransformation(a.spatialReference,F,ea,a.renderSpatialReference);r.mat3.fromMat4(la,ea);r.mat3.transpose(la,la);y.empty(ka);for(var v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],u=0;u<v.length;u++){var x=v[u],n=d[x[2]];isFinite(n)||(n=t);w.vec3.set(F,d[x[0]],d[x[1]],n);K.vectorToVector(F,a.spatialReference,F,a.renderSpatialReference);
y.expand(ka,w.vec3.transformMat3(F,F,la))}t=y.width(ka);v=y.height(ka);u=y.depth(ka);x=1/Math.tan(l.fovY/2);k=Math.max(.5*Math.sqrt(t*t+u*u)*Math.max(x,1/Math.tan(l.fovX/2))+.5*v,.5*v*x+.5*Math.max(t,u))/e;B.internalToExternal(a,h,g.camera);m=M(g.camera,b)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;g.scale=B.distanceToScale(a,k,g.targetGeometry.latitude);p=B.createAsyncContext(f);B.fromCenterScale(a,g.targetGeometry,g.scale,g.camera,m,p);q=g;return[4,p.resolver.promise];case 1:return q.camera=
l.sent(),[2,g]}})})}function da(a){a&&(a.rotation=Q(a.camera.heading));return a}Object.defineProperty(b,"__esModule",{value:!0});b.DEFAULT_FRAME_COVERAGE=.66;b.rotationToHeading=I;b.headingToRotation=Q;b.toCamera=N;b.fromInternalCamera=function(a,b,c){c||(c=new e({camera:new h}));B.internalToExternal(a,b,c.camera);return R(a,b,c)};b.fromCamera=function(a,b,c){c||(c=new e);c.camera=b.clone();return R(a,null,c)};b.create=function(d,f,g){return k(this,void 0,void 0,function(){var k,p,q,r,t,v,u,x,n,C,
D,N,J;return l(this,function(l){switch(l.label){case 0:if(f&&d.spatialReference){l={target:null};if("declaredClass"in f||Array.isArray(f))l.target=f;else{for(var I in f)l[I]=f[I];f.center&&!l.target&&(l.target=f.center)}k=l}else k=null;if(!k)throw new c("viewpointutils-create:no-target","Missing target for creating viewpoint");p=new e({camera:new h({fov:d.camera.fov})});return k.target instanceof e?[4,Y(d,k.target,k,g,p)]:[3,2];case 1:return q=l.sent(),[2,da(q)];case 2:if(k.target instanceof h)return[2,
da(X(d,k,k.target,p))];r=null!=k.scale||null!=k.zoom;if(!(k.target instanceof a.Extent))return[3,6];t=k.target.xmin===k.target.xmax||k.target.ymin===k.target.ymax;if(!r&&!t)return[3,4];v=da;return[4,P(d,k,k.target.center,g,p)];case 3:return[2,v.apply(void 0,[l.sent()])];case 4:return u=da,[4,Z(d,k,k.target,g,p)];case 5:return[2,u.apply(void 0,[l.sent()])];case 6:return x={boundingBox:y.empty(),hasZ:!1,screenSpaceObjects:[]},n=r?B.scaleToResolution(d,L(d,k)):void 0,[4,U(d,k.target,n,x)];case 7:l.sent();
if(!isFinite(x.boundingBox[0]))return[3,11];y.center(x.boundingBox,F);na.x=F[0];na.y=F[1];na.z=F[2];na.spatialReference=d.spatialReference;t=void 0;isFinite(na.z)&&x.hasZ?t=y.isPoint(x.boundingBox):(na.z=void 0,t=m.isPoint(y.toRect(x.boundingBox,oa)));if(!r&&!t)return[3,9];C=da;return[4,P(d,k,na,g,p)];case 8:return[2,C.apply(void 0,[l.sent()])];case 9:I=x.screenSpaceObjects;l=b.DEFAULT_FRAME_COVERAGE;if(I.length){for(var K=Number.NEGATIVE_INFINITY,M=0;M<I.length;M++)var S=I[M].screenSpaceBoundingRect,
K=Math.max(K,Math.abs(S[0]),Math.abs(S[1]),Math.abs(S[2]),Math.abs(S[3]));D=l-K/Math.min(d.width,d.height)*2}else D=l;N=da;return[4,ca(d,k,na,x.boundingBox,D,g,p)];case 10:return[2,N.apply(void 0,[l.sent()])];case 11:if(k.position)return I=k,l=p,K=z.cameraOnContentAlongViewDirection(d),w.vec3.copy(va,K.viewForward),B.directionToHeadingTilt(d,K.eye,va,K.up,ia),l.camera.position=new a.Point(I.position),l.camera.heading=null!=I.heading?I.heading:ia.heading,l.camera.tilt=null!=I.tilt?I.tilt:ia.tilt,I=
R(d,null,l),[2,da(I)];J=da;return[4,V(d,k,g,p)];case 12:return[2,J.apply(void 0,[l.sent()])]}})})};var F=u.vec3f64.create(),ea=x.mat4f64.create(),la=t.mat3f64.create(),ka=y.create(),oa=m.create(),va=u.vec3f64.create(),fa=u.vec3f64.create(),xa=u.vec3f64.create(),ia={heading:0,tilt:0},na=new a.Point,wa={point:function(a,b,c){c[0]=a.x;c[1]=a.y;a.hasZ&&(c[2]=a.z);b(c)},polygon:function(a,b,c){for(var d=a.hasZ,e=0;e<a.rings.length;e++)for(var f=a.rings[e],g=0;g<f.length;g++)c[0]=f[g][0],c[1]=f[g][1],d&&
(c[2]=f[g][2]),b(c)},polyline:function(a,b,c){for(var d=a.hasZ,e=0;e<a.paths.length;e++)for(var f=a.paths[e],g=0;g<f.length;g++)c[0]=f[g][0],c[1]=f[g][1],d&&(c[2]=f[g][2]),b(c)},multipoint:function(a,b,c){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)c[0]=d[e][0],c[1]=d[e][1],a&&(c[2]=d[e][2]),b(c)},extent:function(a,b,c){a.hasZ?(b(w.vec3.set(c,a.xmin,a.ymin,a.zmin)),b(w.vec3.set(c,a.xmax,a.ymin,a.zmin)),b(w.vec3.set(c,a.xmin,a.ymax,a.zmin)),b(w.vec3.set(c,a.xmax,a.ymax,a.zmin)),b(w.vec3.set(c,
a.xmin,a.ymin,a.zmax)),b(w.vec3.set(c,a.xmax,a.ymin,a.zmax)),b(w.vec3.set(c,a.xmin,a.ymax,a.zmax)),b(w.vec3.set(c,a.xmax,a.ymax,a.zmax))):(b(w.vec3.set(c,a.xmin,a.ymin,c[2])),b(w.vec3.set(c,a.xmax,a.ymin,c[2])),b(w.vec3.set(c,a.xmin,a.ymax,c[2])),b(w.vec3.set(c,a.xmax,a.ymax,c[2])))},mesh:function(a,b,c){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)b(w.vec3.set(c,a[d+0],a[d+1],a[d+2]))}}})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("require exports ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../support/geometryUtils ../../support/stack ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),
function(n,b,l,k,h,a,g,e,d){function f(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];b&&!b(e)||c.push(e)}return c}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,c,d){this.viewingMode=b;this.layerProvider=c;this.view=d;this.tmpIntersector=new e(this.viewingMode);this.tmpRay=a.ray.create();this.externalIntersectionHandlers=new Set;this.intersectionTolerance=e.DEFAULT_TOLERANCE;this.validateHUDIntersector=new e(this.viewingMode);this.validateHUDIntersector.enable.hud=!1}b.prototype.intersectScreen=
function(a,b,c,d){return this.intersectRay(this.getPickRay(a,this.tmpRay),b,c,d)};b.prototype.intersectScreenFreePointFallback=function(a,b,c,d){return this.intersectRayFreePointFallback(this.getPickRay(a,this.tmpRay),b,c,d)};b.prototype.intersectRay=function(a,b,c,d){d=this.computeIntersection(a,c,!1,d||this.tmpIntersector);b=d?(a=d.results.min)?a.getIntersectionPoint(b):!1:!1;return b};b.prototype.intersectRayFreePointFallback=function(a,b,c,d){return this.intersectRay(a,b,c,d)||this.intersectRayFreePointLocal(a,
b)};b.prototype.intersectIntersectorScreen=function(a,b,c,d,e){void 0===d&&(d=!1);void 0===e&&(e=!1);return this.computeIntersection(this.getPickRay(a,this.tmpRay),c,d,b,e)};b.prototype.intersectToolIntersectorScreen=function(a,b,c){a=this.getPickRay(a,this.tmpRay);var d=this.computeIntersection(a,c,!0,b),e=d.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.isOpaque()||e.hasIntersectionPoint&&"TerrainRenderer"!==e.intersector||(d=this.computeIntersection(a,c,!1,b));return d};b.prototype.setTolerance=
function(a){void 0===a&&(a=e.DEFAULT_TOLERANCE);this.intersectionTolerance=a};b.prototype.addIntersectionHandler=function(a){this.externalIntersectionHandlers.add(a)};b.prototype.removeIntersectionHandler=function(a){this.externalIntersectionHandlers.delete(a)};b.prototype.getPickRay=function(b,c){void 0===c&&(c=a.ray.create());return a.ray.fromScreen(this.view.state.camera,b,c)};b.prototype.intersectRayFreePointLocal=function(a,b){if("local"!==this.viewingMode)return!1;var c=this.view.dataExtent,
d=Math.max(c.xmax-c.xmin,c.ymax-c.ymin,8*Math.max(c.xmax-c.xmin,c.ymax-c.ymin));if(0===d)return h.vec3.add(b,a.origin,h.vec3.normalize(g.sv3d.get(),a.direction)),!0;var e=this.view.state.camera,f=Math.max(0,c.xmin-e.eye[0],e.eye[0]-c.xmax),c=Math.max(0,c.ymin-e.eye[1],e.eye[1]-c.ymax),e=d/Math.max(1,Math.pow(Math.max(0,Math.log(d/(Math.abs(e.relativeElevation)+Number.MIN_VALUE))),2)),e=Math.max(e,Math.min(Math.sqrt(f*f+c*c),d)),d=h.vec3.scale(g.sv3d.get(),a.direction,e/h.vec3.length(a.direction));
h.vec3.add(b,a.origin,d);return!0};b.prototype.computeIntersection=function(a,b,f,q,l){var p=this,r=this.view.state.camera,m=k.castRenderScreenPointArray3(g.sv3d.get());r.projectPoint(a.origin,m);var v=this.prepareFilters(b,c);q=q||new e(this.viewingMode);q.enable.storeAll=b&&b.allEnabled;q.enable.storeTerrainResults=v.filterLayerUid(d.TERRAIN_ID);q.enable.selectOpaqueTerrainOnly=!b||!("include"in b||"exclude"in b);var t=a.origin,x=h.vec3.add(g.sv3d.get(),a.origin,a.direction);q.intersect(v.layers,
t,x,m,r,this.intersectionTolerance,f,null);var w=(a=this.view.slicePlane)?d.sliceFilterPredicate(a):null;q.intersect(v.sliceableLayers,t,x,m,r,this.intersectionTolerance,f,w,!1);var n=b&&b.terrainLocationFeedbackEnabled||l;this.externalIntersectionHandlers.forEach(function(a){if(a.intersectionHandlerId===d.TERRAIN_ID){if(!n&&!v.filterLayerUid(d.TERRAIN_ID))return}else if(!v.filterLayerUid(a.intersectionHandlerId))return;a.intersect(q,a.slicePlaneEnabled?w:null,t,x,m)});b=g.sv3d.get();l&&q.results.terrain.getIntersectionPoint(b)&&
(l=this.view._stage.renderView.getDrapedRenderer(),a=g.sv3d.get(),this.view.renderCoordsHelper.fromRenderCoords(b,a,this.view.spatialReference),a[2]=this.view.basemapTerrain.getElevation(b)||0,l.intersect(q,a,v.filterRenderGeometry));q.sortResults();l=q.results.hud;if(l.hasIntersectionPoint){var K=k.castRenderScreenPointArray3(g.sv3d.get()),I=g.sv3d.get(),Q=g.sv3d.get();this.unprojectHUDResultRay(l.center,K,I,Q);b=h.vec3.distance(l.center,I)/h.vec3.distance(I,Q)*.99;this.validateHUDIntersector.intersect(v.layers,
I,Q,K,r,this.intersectionTolerance,f,null);this.validateHUDIntersector.intersect(v.sliceableLayers,I,Q,K,r,this.intersectionTolerance,f,w,!1);this.externalIntersectionHandlers.forEach(function(a){v.filterLayerUid(a.intersectionHandlerId)&&a.intersect(p.validateHUDIntersector,a.slicePlaneEnabled?w:null,I,Q,K)});f=this.validateHUDIntersector.results.min;if(null==f.dist||b<=f.dist)q.results.min.copyFrom(l),q.results.all.splice(0,0,l)}return q};b.prototype.prepareFilters=function(a,b){var c=[],d=[];this.layerProvider.forEachLayer(function(a){a.isPickable&&
(a.isSliceable?d:c).push(a)});b.include=a&&a.include;b.exclude=a&&a.exclude;b.layers.length=0;b.sliceableLayers.length=0;f(c,b.filterLayer,b.layers);f(d,b.filterLayer,b.sliceableLayers);return b};b.prototype.unprojectHUDResultRay=function(a,b,c,d){var e=this.view.state.camera;e.projectPoint(a,b);a=k.castRenderScreenPointArray3(g.sv3d.get());a[0]=b[0];a[1]=b[1];a[2]=0;e.unprojectPoint(a,c);a[2]=1;e.unprojectPoint(a,d)};return b}();b.SceneIntersectionHelper=n;var c={include:null,exclude:null,layers:[],
sliceableLayers:[],filterLayer:function(a){return c.filterLayerUid(a.apiLayerUid)},filterLayerUid:function(a){var b=c.include,d=c.exclude;return l.isNone(a)?null==b&&null==d:(null==b||b.has(a))&&(null==d||!d.has(a))},filterRenderGeometry:function(a){return c.filterLayerUid(a.data.layerUid)}}})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/Evented ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){return function(a){function b(b){b=a.call(this)||this;b.providers={im:[],ground:[],scene:[]};b.handles=new Map;return b}l(b,a);b.prototype.getElevation=function(a,b){var c=null,d=!0;"scene"===b&&(c=this._updateElevation(c,this.providers.im,a,b),null!=c&&(d=!1));d&&(c=this._updateElevation(c,this.providers.ground,a,b));"scene"===b&&(c=this._updateElevation(c,this.providers.scene,a,b));return c};b.prototype._updateElevation=function(a,b,c,d){for(var e=0;e<b.length;e++){var f=
b[e].getElevation(c,d);null!=f&&(a=null!=a?Math.max(f,a):f)}return a};b.prototype.queryElevation=function(a,b,e,f){var g=this;void 0===e&&(e=0);this._elevationService||(this._elevationService=new q.ElevationQuery(this.view.spatialReference,function(){return g.view.map&&g.view.map.ground},{maximumAutoTileRequests:4}));var h=d.createResolver();(c.isPoint(a)?this._elevationService.queryElevation(a.x,a.y,b,e):this._elevationService.queryElevation(a[0],a[1],b,e)).then(function(b){"scene"===f&&(b=g._updateElevation(b,
g.providers.scene,a,f));h.resolve(b)}).catch(function(b){d.isAbortError(b)?h.reject(b):h.resolve(g.getElevation(a))});return h.promise};b.prototype.register=function(a,b){var c=this;this.handles.set(b,b.on("elevation-change",function(a){return c.emit("elevation-change",a)}));this.providers[a].push(b)};b.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var d=c[b],e=this.providers[d].indexOf(a);
-1<e&&this.providers[d].splice(e,1)}};k([f.property({constructOnly:!0})],b.prototype,"view",void 0);k([f.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],b.prototype,"spatialReference",void 0);return b=k([f.subclass("esri.views.3d.support.CombinedElevationProvider")],b)}(f.declared(e.EventedMixin(g)))})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,c){this.spatialReference=b;this.view=c;this.point=new a.Point;this.point.spatialReference=b}b.prototype.getElevation=function(a,b,c){this.point.x=a;this.point.y=b;return this.view.elevationProvider.getElevation(this.point,c)};b.prototype.queryElevation=function(a,b,c,d,e){return k(this,void 0,void 0,function(){return l(this,function(f){this.point.x=a;this.point.y=b;return[2,this.view.elevationProvider.queryElevation(this.point,
c,d,e)]})})};return b}();b.ViewElevationProvider=n;n=function(){function b(a,b,c){this.spatialReference=a;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=h({},c,{ignoreInvisibleLayers:!0})}b.prototype.queryElevation=function(a,b,c,d,e){void 0===d&&(d=0);return k(this,void 0,void 0,function(){var e=this;return l(this,function(h){return[2,f.create(function(h,k){var m={x:a,y:b,minDemResolution:d,result:{resolve:h,reject:k},signal:c};e._queries.push(m);f.onAbort(c,
function(){g.remove(e._queries,m);k(f.createAbortError())});e._scheduleDoQuery()})]})})};b.prototype._scheduleDoQuery=function(){var a=this;this._isScheduled||(c.schedule(function(){return a._doQuery()}),this._isScheduled=!0)};b.prototype._doQuery=function(){return k(this,void 0,void 0,function(){var b,c,g,k,q,u,y,m,v,z,n,C;return l(this,function(p){switch(p.label){case 0:this._isScheduled=!1;b=this._queries;this._queries=[];if(0===b.length)return[2];c=b.map(function(a){return[a.x,a.y]});g=b.reduce(function(a,
b){return Math.min(a,b.minDemResolution)},Infinity);k=new a.Multipoint({points:c,spatialReference:this.spatialReference});q=this._getElevationQueryProvider();if(!q)return b.forEach(function(a,b){return a.result.reject()}),[2];u=1<b.length&&b.some(function(a){return!!a.signal})?f.createAbortController():null;y=d.isSome(u)?u.signal:b[0].signal;d.isSome(u)&&(m=0,b.forEach(function(a){return f.onAbort(a.signal,function(){m++;a.result.reject(f.createAbortError());m===b.length&&u.abort()})}));v=h({},this._queryOptions,
{minDemResolution:g,signal:y});return[4,e.result(q.queryElevation(k,v))];case 1:z=p.sent();for(n=0;n<b.length;n++)C=b[n],d.isSome(C.signal)&&C.signal.aborted?C.result.reject(f.createAbortError()):!1===z.ok?C.result.reject(z.error):C.result.resolve(z.value.geometry.points[n][2]);return[2]}})})};return b}();b.ElevationQuery=n})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/has"],function(n,b,l){function k(){var b=!!l("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,
maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,
maxTotalNumberOfPrimitives:17E5,polygonLodFactor:b?.8:1,polylineLodFactor:b?1.2:1.5},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:b},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!l("disable-feature:reduce-map-tile-levels")},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!1,memoryLimit:b?400:500,additionalCacheMemory:b?0:100,frameRate:0,maximumRenderResolution:null,
maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:b?1.2:2,polylineLodFactor:b?1.2:2},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!l("disable-feature:reduce-map-tile-levels")},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,memoryLimit:b?600:1E3,
additionalCacheMemory:0,frameRate:0,maximumRenderResolution:b?null:4096,maximumPixelRatio:b?1:null}}}n=function(){function b(){}b.isValidProfile=function(a){return a in b.profiles};b.getDefaultProfile=function(){return l("trident")||l("esri-iPhone")?"low":"medium"};b.apply=function(a,g){a=b.profiles[a];g.graphics3D.maxTotalNumberOfFeatures=a.graphics3D.maxTotalNumberOfFeatures;g.graphics3D.maxTotalNumberOfPrimitives=a.graphics3D.maxTotalNumberOfPrimitives;g.graphics3D.polygonLodFactor=a.graphics3D.polygonLodFactor;
g.graphics3D.polylineLodFactor=a.graphics3D.polylineLodFactor;g.sceneService["3dObject"].lodFactor=a.sceneService["3dObject"].lodFactor;g.sceneService.point.lodFactor=a.sceneService.point.lodFactor;g.sceneService.integratedMesh.lodFactor=a.sceneService.integratedMesh.lodFactor;g.sceneService.pointCloud.lodFactor=a.sceneService.pointCloud.lodFactor;g.sceneService.uncompressedTextureDownsamplingEnabled=a.sceneService.uncompressedTextureDownsamplingEnabled;g.tiledSurface.lodBias=a.tiledSurface.lodBias;
g.tiledSurface.angledSplitBias=a.tiledSurface.angledSplitBias;g.tiledSurface.reduceTileLevelDifferences=a.tiledSurface.reduceTileLevelDifferences;g.antialiasingEnabled=a.antialiasingEnabled;g.physicallyBasedRenderingEnabled=a.physicalBasedRenderingEnabled;g.memoryLimit=a.memoryLimit;g.additionalCacheMemory=a.additionalCacheMemory;g.frameRate=a.frameRate;g.maximumRenderResolution=a.maximumRenderResolution;g.maximumPixelRatio=a.maximumPixelRatio};b.debug={reset:function(){var a=k(),g;for(g in a)b.profiles[g]=
a[g]}};return b}();(n||(n={})).profiles=k();return n})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4f32".split(" "),function(n,b,l,k,h,a,g,e,d){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.color=new h([0,255,255]);b.haloColor=
null;b.haloOpacity=1;b.fillOpacity=.25;return b}l(b,a);b.toEngineOptions=function(a){var b=h.toUnitRGBA(a.color),c=g.isSome(a.haloColor)?h.toUnitRGBA(a.haloColor):b;return{color:d.vec4f32.fromValues(b[0],b[1],b[2],b[3]),haloColor:d.vec4f32.fromValues(c[0],c[1],c[2],c[3]),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};k([e.property({type:h})],b.prototype,"color",void 0);k([e.property({type:h})],b.prototype,"haloColor",
void 0);k([e.property()],b.prototype,"haloOpacity",void 0);k([e.property()],b.prototype,"fillOpacity",void 0);return b=k([e.subclass("esri.views.3d.support.HighlightOptions")],b)}(e.declared(a))})},"esri/views/3d/support/index":function(){define(["require","exports","./ResourceController","./MemoryController"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.ResourceControllerMaster=l.ResourceControllerMaster;b.newResourceController=l.newResourceController;b.newMemoryController=
k.newMemoryController;n=new Map;l=0;for(k=[[0,15],[1,20],[2,5]];l<k.length;l++){var h=k[l];n.set(h[0],h[1])}b.downloadSlotsPerClient=n})},"esri/views/3d/support/ResourceController":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/Handles ../../../core/now ../../../core/scheduling ../../../core/accessorSupport/decorators ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});var r=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.updating=!1;return b}k(b,a);l([d.property({readOnly:!0})],b.prototype,"updating",void 0);return b=l([d.subclass("esri.views.3d.support.ResourceController")],b)}(d.declared(h));b.ResourceControllerMaster=r;b.newResourceController=function(a,b){void 0===b&&(b=g);return new t.ResourceController({view:a,now:b})};var t;(function(b){var g=function(b){function g(){var c=
null!==b&&b.apply(this,arguments)||this;c._scheduler=null;c._memoryController=null;c._streamDataLoader=null;c._lastTargetChangeTime=0;c._handles=new a;c._frameTask=null;return c}k(g,b);g.prototype.initialize=function(){var a=this;this._lastTargetChangeTime=this.now();this._scheduler=p.newScheduler(this.now);this._memoryController=c.newMemoryController(this.view);this._streamDataLoader=new q.default;this._streamDataLoader.setup(f.downloadSlotsPerClient,this._scheduler);this._handles.add([this.view.watch("state.camera",
function(){return a._cameraChangedHandler()},!0),this.view.watch("stationary",function(){return a._stationaryChangedHandler()}),this._memoryController.events.on("updating-changed",function(){return a.notifyChange("updating")})]);this._frameTask=e.addFrameTask({update:function(b){return a.frame(b)}})};g.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=
null);this._memoryController.destroy();this._memoryController=null;this._scheduler.destroy();this._scheduler=null};Object.defineProperty(g.prototype,"updating",{get:function(){return!!(this._memoryController&&this._memoryController.updating||this._streamDataLoader&&this._streamDataLoader.updating)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"scheduler",{get:function(){return this._scheduler},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"memoryController",
{get:function(){return this._memoryController},enumerable:!0,configurable:!0});g.prototype.createStreamDataRequester=function(a){var b=this._streamDataLoader;return{request:function(c,d,e){return b.request(c,d,a,e)},get busy(){return b.busy}}};g.prototype.frame=function(a){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(a.deltaTime/1E3),!this._scheduler))return;this._scheduler.state=this.state;this._scheduler.updateBudget(a)?(this._memoryController.update(),this._scheduler.frame()):
this._memoryController.updating&&this._memoryController.update()}};g.prototype._cameraChangedHandler=function(){this._lastTargetChangeTime=this._scheduler.now;this._scheduler.state=this.state};g.prototype._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};Object.defineProperty(g.prototype,"state",{get:function(){return this._scheduler.now-this._lastTargetChangeTime>h?2:this.view.animation?0:1},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"test",{get:function(){var a=
this;return{getQueueStats:function(b){return a._streamDataLoader.test.loadQueue.getStatsForType(b)}}},enumerable:!0,configurable:!0});l([d.property({constructOnly:!0})],g.prototype,"view",void 0);l([d.property({constructOnly:!0})],g.prototype,"now",void 0);l([d.property()],g.prototype,"_streamDataLoader",void 0);l([d.property({readOnly:!0,dependsOn:["_streamDataLoader.updating"]})],g.prototype,"updating",null);return g=l([d.subclass("esri.views.3d.support.ResourceController")],g)}(d.declared(r));
b.ResourceController=g;var h=300})(t||(t={}))})},"esri/views/3d/support/MemoryController":function(){define("require exports ../../../core/Evented ../../../core/Logger ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});var g=k.getLogger("esri.views.3d.support.MemoryController");b.newMemoryController=function(a){return new e(a)};var e=function(){function b(a){this._view=a;this.events=new l;this.minQuality=
.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new h.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}b.prototype.destroy=function(){this.events=null};b.prototype.getMemCache=function(a,b){return new h.MemCache(a,this._cacheStorage,b)};Object.defineProperty(b.prototype,"maxMemory",{get:function(){return this._maxMemory},set:function(a){null!=
a&&0<a&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<a&&this._updateQuality(1),this._maxMemory=a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"additionalCacheMemory",{set:function(a){null!=a&&0<=a&&(this._additionalCacheMemory=a)},enumerable:!0,configurable:!0});b.prototype.disableMemCache=function(){this._additionalCacheMemory=-4096};Object.defineProperty(b.prototype,"memoryFactor",{get:function(){return this._quality},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"updating",{get:function(){return this._updating},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"usedMemory",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});b.prototype.resetStableQuality=function(){this._stableQuality=0};b.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var a=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=
!1,this._updateQuality(1);else if(a){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,a=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=
this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,a=this._updateQuality(this._quality+.1*(.75-this._memoryUsed+.1))):1>this._quality&&(this._canFastRecover=!0));this.updating!==a&&(this._updating=a,this.events.emit("updating-changed",this.updating))}};b.prototype._updateQuality=function(a){a=Math.min(Math.max(a,this.minQuality),1);if(a===this._quality)return!1;this._quality=a;this.events.emit("quality-changed",this._quality);
++this._numQualityChanges;return!0};b.prototype._layersUpdating=function(){return this._view.allLayerViews.some(function(a){return!!a.updating})};b.prototype._updateMemory=function(){var b=this,c=0,d=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(c+=this._view.basemapTerrain.getUsedMemory());var e=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;e&&(c+=e.getUsedMemory());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(e){if(a.isMemoryManagedLayerView(e)){var f=
e.ignoresMemoryFactor()?b._quality:1;c+=e.getUsedMemory()*f;d+=e.getUnloadedMemory()*f}});var h=null==this._warnMemoryUsage||Math.round(10*c)!==Math.round(10*this._warnMemoryUsage),e=1048576*this._maxMemory;if(c>e&&h){this._warnMemoryUsage=c;var h=function(a){return(a/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},k=Math.round(100*this._quality);g.warn("Memory Limit exceeded! Limit: "+h(e)+" Current: "+h(c)+" Projected: "+h(c+d)+" Quality: "+k+"%")}this._memoryUsed=c/e;this._memoryPredicted=
(c+d)/e;this._cacheStorage.maxSize=Math.max(0,e-c+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};Object.defineProperty(b.prototype,"test",{get:function(){return{cacheStorage:this._cacheStorage,numQualityChanges:this._numQualityChanges}},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/now ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./AsyncQuotaRoundRobinQueue ../webgl-engine/lib/Util ../../../views/support/Scheduler".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.tasks=new Map;b.doneQueue=[];b.updating=!1;return b}k(b,a);b.prototype.setup=function(a,b){var c=this;this.loadQueue=new r.AsyncQuotaRoundRobinQueue(function(a,b){return c.startLoading(a,b)},function(a,b){return c.doneLoadingCallback(a,b)},a);b&&(this.taskHandle=b.registerTask(x.Task.STREAM_DATA_LOADER,function(a){return c.update(a)},
function(){return 0<c.doneQueue.length}))};b.prototype.destroy=function(){this.taskHandle&&(this.taskHandle.remove(),this.taskHandle=null);this.tasks.forEach(function(a){a.abortController&&a.abortController.abort()});this.loadQueue.clear();this.tasks=this.doneQueue=this.loadQueue=null};Object.defineProperty(b.prototype,"busy",{get:function(){return this.loadQueue.busy},enumerable:!0,configurable:!0});b.prototype.request=function(a,b,c,d){var e=this,g=q.createResolver();g.__signal=f.isSome(d)?d.signal:
null;var h=f.isSome(d)&&d.uid||a,k=this.createOrUpdateTask(a,b,c,h,g);q.onAbort(d,function(){return e.cancelRequest(k,g)});return g.promise};b.prototype.createTask=function(a,b,c,d,e){a={url:a,docType:b,clientType:c,key:d,result:null,status:1,resourceRequest:null,abortController:null,resolvers:[],_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.updateTask(a,e);this.tasks.set(d,a);1===this.tasks.size&&this._set("updating",!0);this.loadQueue.push(a);return a};b.prototype.cancelRequest=function(a,
b){g.removeUnordered(a.resolvers,b);b.reject(q.createAbortError());0===a.resolvers.length&&(2===a.status&&(a.status=4,this.loadQueue.workerCancelled(a),a.abortController.abort(),a.resourceRequest=null,a.abortController=null),a.status=4,this.tasks.delete(a.key),0===this.tasks.size&&this._set("updating",!1))};b.prototype.taskKey=function(a,b,c){return a+":"+b+":"+c};b.prototype.updateTask=function(a,b){a.resolvers.push(b)};b.prototype.createOrUpdateTask=function(a,b,c,d,e){d=this.taskKey(d,b,c);var f=
this.tasks.get(d);return f?(this.updateTask(f,e),f):this.createTask(a,b,c,d,e)};b.prototype.doneLoadingCallback=function(a,b){t.assert(2===a.status);a.status=3;this.taskHandle?this.doneQueue.push({task:a,err:b}):this.doneLoading(a,b)};b.prototype.update=function(a){for(;!a.done&&0<this.doneQueue.length;){var b=this.doneQueue.shift();3!==b.task.status&&(b.err=b.err||q.createAbortError());this.doneLoading(b.task,b.err);a.madeProgress()}};b.prototype.doneLoading=function(a,b){for(var c=a.result instanceof
HTMLImageElement?0:a.resolvers.length,f=0,g=a.resolvers;f<g.length;f++){var h=g[f];if(b)q.isAbortError(b)?h.reject(b):h.reject(new e("stream-data-loader:request-error","Failed to request resource at '"+a.url+"'. "+b,{url:a.url,error:b}));else{--c;var k=0>=c?a.result:d.clone(a.result);h.resolve(k)}}this.tasks.delete(a.key);0===this.tasks.size&&this._set("updating",!1)};b.prototype.startLoading=function(a,b){if(4===a.status)return!1;a.status=2;var d,e;switch(a.docType){case "binary":e="array-buffer";
d=0;break;case "image":e="image";break;default:e="json"}a.startTime=c();a.abortController=q.createAbortController();a.resourceRequest=h(a.url,{responseType:e,timeout:d,signal:a.abortController.signal});a.resourceRequest.then(function(d){a.duration=c()-a.startTime;a.size="binary"===a.docType?d.data.byteLength:0;a.result=d.data;a.abortController=null;b(a)},function(c){2===a.status&&b(a,c)});return!0};Object.defineProperty(b.prototype,"test",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,
configurable:!0});l([p.property({readOnly:!0})],b.prototype,"updating",void 0);return b=l([p.subclass("esri.views.3d.support.StreamDataLoader")],b)}(p.declared(a));b.StreamDataLoader=n;b.default=n})},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["require","exports","../webgl-engine/lib/Util"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a,g){var e=this;this.workerFunc=b;this.callbackFunc=a;this.robin=0;this.type2id=new Map;this.tasks=
[];this.typeNumWorkers=[];this.typeWorkerQuota=[];this.typeStatistics=[];this.maxTotalNumWorkers=this.totalNumWorkers=0;g.forEach(function(a,b){e.type2id.set(b,e.tasks.length);e.tasks.push([]);e.typeNumWorkers.push(0);e.typeStatistics.push({requests:0,size:0,duration:0,speed:0});e.typeWorkerQuota.push(a);e.maxTotalNumWorkers+=a})}Object.defineProperty(b.prototype,"numTypes",{get:function(){return this.tasks.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"busy",{get:function(){return this.totalNumWorkers>=
this.maxTotalNumWorkers},enumerable:!0,configurable:!0});b.prototype.push=function(b){var a=this,g=this.type2id.get(b.clientType);this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[g]++,this.totalNumWorkers++,this.workerFunc(b,function(b,d){return a._taskCallback(b,d)})):this.tasks[g].push(b)};b.prototype.getStatsForType=function(b){b=this.type2id.get(b);return{quota:this.typeWorkerQuota[b],workers:this.typeNumWorkers[b],queueSize:this.tasks[b].length,requestStats:this.typeStatistics[b]}};
b.prototype.removeTasks=function(b,a){for(var g=[],e=0,d=this.tasks[this.type2id.get(a)];e<d.length;e++){var f=d[e];-1===b.indexOf(f)&&g.push(f)}this.tasks[this.type2id.get(a)]=g};b.prototype.workerCancelled=function(b){this.taskFinished(b);b._cancelledInQueue=!0};b.prototype.clear=function(){for(var b=0;b<this.tasks.length;b++)this.tasks[b]=[]};b.prototype.taskFinished=function(b){var a=this.type2id.get(b.clientType);this.typeNumWorkers[a]--;this.totalNumWorkers--;this.typeStatistics[a].requests++;
this.typeStatistics[a].size+=b.size||0;this.typeStatistics[a].duration+=b.duration||0;this.typeStatistics[a].speed=0<this.typeStatistics[a].duration?this.typeStatistics[a].size/this.typeStatistics[a].duration:0;l.assert(0<=this.typeNumWorkers[a]);this.next()};b.prototype.next=function(){var b=this.robin,a=!1;do this.typeNumWorkers[b]<this.typeWorkerQuota[b]&&this.processQueue(b)&&(a=!0),b=(b+1)%this.numTypes;while(!a&&b!==this.robin);if(!a){do this.processQueue(b)&&(a=!0),b=(b+1)%this.numTypes;while(!a&&
b!==this.robin)}this.robin=b};b.prototype.processQueue=function(b){for(var a=this;0<this.tasks[b].length;)if(this.workerFunc(this.tasks[b].shift(),function(b,e){return a._taskCallback(b,e)}))return this.typeNumWorkers[b]++,this.totalNumWorkers++,!0;return!1};b.prototype._taskCallback=function(b,a){b._cancelledInQueue||(this.callbackFunc(b,a),this.taskFinished(b))};Object.defineProperty(b.prototype,"test",{get:function(){var b=this;return{set workerFunc(a){b.workerFunc=a}}},enumerable:!0,configurable:!0});
return b}();b.AsyncQuotaRoundRobinQueue=n})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,d){void 0===d&&(d=null);this.spatialReference=
b;this.unitInMeters=g.getMetersPerUnitForSR(this.spatialReference);this._geometryServicePromise=this.loadGeometryService(a,d)}b.prototype.loadGeometryService=function(b,d){return k(this,void 0,void 0,function(){return l(this,function(c){switch(c.label){case 0:if(d)return[2,d];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,e.create(b&&b.get("portalItem"))];case 2:return[2,c.sent()];case 3:throw c.sent(),new a("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");
case 4:return[2]}})})};b.prototype.toGeographic=function(a){return k(this,void 0,void 0,function(){var b,c,e,f,g,k,u,y=this;return l(this,function(m){switch(m.label){case 0:return[4,this._geometryServicePromise];case 1:return b=m.sent(),c=!0,Array.isArray(a[0])&&"number"!==typeof a[0]?e=a:(e=[a],c=!1),f=e.map(function(a){return a instanceof h.Point?a:new h.Point(a,y.spatialReference)}),g=new d({geometries:f,outSpatialReference:h.SpatialReference.WGS84}),[4,b.project(g)];case 2:return k=m.sent(),u=
k.map(function(a){return"point"===a.type?[a.x,a.y]:void 0}),[2,c?u:u[0]]}})})};return b}();b.MapCoordsHelper=n;b.default=n})},"esri/portal/support/geometryServiceUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../config ../../core/Error ../Portal ../PortalItem ../../tasks/GeometryService ../../tasks/support/ProjectParameters @dojo/framework/shim/Promise".split(" "),function(n,b,l,k,h,a,g,e,d,f){function c(b,c){void 0===b&&(b=null);
return k(this,void 0,void 0,function(){var f;return l(this,function(k){switch(k.label){case 0:if(h.geometryServiceUrl)return[2,new d({url:h.geometryServiceUrl})];if(!b)throw new a("internal:geometry-service-url-not-configured");b.isInstanceOf(e)?f=b.portal||g.getDefault():b.isInstanceOf(g)&&(f=b);return[4,f.load({signal:c})];case 1:k.sent();if(f.helperServices&&f.helperServices.geometry&&f.helperServices.geometry.url)return[2,new d({url:f.helperServices.geometry.url})];throw new a("internal:geometry-service-url-not-configured");
}})})}Object.defineProperty(b,"__esModule",{value:!0});b.create=c;b.projectGeometry=function(b,d,e,g){void 0===e&&(e=null);return k(this,void 0,void 0,function(){var h,k,p;return l(this,function(q){switch(q.label){case 0:return[4,c(e,g)];case 1:return h=q.sent(),k=new f,k.geometries=[b],k.outSpatialReference=d,[4,h.project(k,{signal:g})];case 2:if((p=q.sent())&&Array.isArray(p)&&1===p.length)return[2,p[0]];throw new a("internal:geometry-service-projection-failed");}})})}})},"esri/tasks/GeometryService":function(){define("../core/lang ../core/jsonMap ../core/accessorSupport/ensureType ../geometry/Extent ../geometry/Multipoint ../geometry/Polyline ../geometry/Polygon ../geometry/support/jsonUtils ../request ./Task ./support/ProjectParameters".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){var q=new b.JSONMap({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"}),p=l.ensureType(c);b=f.createSubclass({declaredClass:"esri.tasks.GeometryService",areasAndLengths:function(a,b){a={query:n.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON())};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/areasAndLengths",a).then(function(a){return a.data})},autoComplete:function(a,b,c){var e=
a[0].spatialReference;a={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(e.toJSON()),polygons:JSON.stringify(this._encodeGeometries(a).geometries),polylines:JSON.stringify(this._encodeGeometries(b).geometries)})};if(this.requestOptions||c)a=n.mixin({},this.requestOptions,c,a);return d(this.parsedUrl.path+"/autoComplete",a).then(function(a){return(a.data.geometries||[]).map(function(a){return new g({spatialReference:e,rings:a.rings})})})},buffer:function(a,b){var c=n.mixin({},this.parsedUrl.query,
{f:"json"},a.toJSON()),e=a.outSpatialReference||a.geometries[0].spatialReference;a={query:c};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/buffer",a).then(function(a){return(a.data.geometries||[]).map(function(a){return new g({spatialReference:e,rings:a.rings})})})},cut:function(a,b,c){var f=a[0].spatialReference,g=a.map(function(a){return a.toJSON()});a={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(f.toJSON()),target:JSON.stringify({geometryType:e.getJsonType(a[0]),
geometries:g}),cutter:JSON.stringify(b.toJSON())})};if(this.requestOptions||c)a=n.mixin({},this.requestOptions,c,a);return d(this.parsedUrl.path+"/cut",a).then(function(a){a=a.data;return{cutIndexes:a.cutIndexes,geometries:(a.geometries||[]).map(function(a){return e.fromJSON(a).set("spatialReference",f)})}})},convexHull:function(a,b){var c=a[0].spatialReference;a={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(c.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))})};
if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/convexHull",a).then(function(a){return e.fromJSON(a.data.geometry).set("spatialReference",c)})},densify:function(a,b){var c=n.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),f=a.geometries[0].spatialReference;a={query:c};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/densify",a).then(function(a){return(a.data.geometries||[]).map(function(a){return e.fromJSON(a).set("spatialReference",
f)})})},difference:function(a,b,c){var f=a[0].spatialReference;a={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(f.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a)),geometry:JSON.stringify({geometryType:e.getJsonType(b),geometry:b.toJSON()})})};if(this.requestOptions||c)a=n.mixin({},this.requestOptions,c,a);return d(this.parsedUrl.path+"/difference",a).then(function(a){return(a.data.geometries||[]).map(function(a){return e.fromJSON(a).set("spatialReference",f)})})},
distance:function(a,b){a={query:n.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON())};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/distance",a).then(this._handleDistanceResponse)},fromGeoCoordinateString:function(a,b){var c={};c.sr=null!=a.sr&&"object"===typeof a.sr?a.sr.wkid||JSON.stringify(a.sr):a.sr;c.strings=JSON.stringify(a.strings);c.conversionType=q.toJSON(a.conversionType||"mgrs");c.conversionMode=a.conversionMode;a={query:n.mixin({},this.parsedUrl.query,
{f:"json"},c)};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/fromGeoCoordinateString",a).then(this._handleFromGeoCoordinateResponse)},generalize:function(a,b){var c=n.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),f=a.geometries[0].spatialReference;a={query:c};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/generalize",a).then(function(a){return(a.data.geometries||[]).map(function(a){return e.fromJSON(a).set("spatialReference",
f)})})},intersect:function(a,b,c){var f=a[0].spatialReference;a={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(f.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a)),geometry:JSON.stringify({geometryType:e.getJsonType(b),geometry:b.toJSON()})})};if(this.requestOptions||c)a=n.mixin({},this.requestOptions,c,a);return d(this.parsedUrl.path+"/intersect",a).then(function(a){return(a.data.geometries||[]).map(function(a){return e.fromJSON(a).set("spatialReference",f)})})},lengths:function(a,
b){a={query:n.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON())};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/lengths",a).then(function(a){return a.data})},labelPoints:function(a,b){var c=a.map(function(a){return a.toJSON()}),f=a[0].spatialReference;a={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:f.wkid?f.wkid:JSON.stringify(f.toJSON()),polygons:JSON.stringify(c)})};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+
"/labelPoints",a).then(function(a){return(a.data.labelPoints||[]).map(function(a){return e.fromJSON(a).set("spatialReference",f)})})},offset:function(a,b){var c=n.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),f=a.geometries[0].spatialReference;a={query:c};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/offset",a).then(function(a){return(a.data.geometries||[]).map(function(a){return e.fromJSON(a).set("spatialReference",f)})})},project:function(a,
b){a=p(a);var c=n.mixin({},a.toJSON(),this.parsedUrl.query,{f:"json"}),f=a.outSpatialReference,g=e.getJsonType(a.geometries[0]),h=this._decodeGeometries;a={query:c};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/project",a).then(function(a){return h(a.data,g,f)})},relation:function(a,b){a={query:n.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON())};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/relation",
a).then(this._handleRelationResponse)},reshape:function(a,b,c){var f=a.spatialReference;a={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(f.toJSON()),target:JSON.stringify({geometryType:e.getJsonType(a),geometry:a.toJSON()}),reshaper:JSON.stringify(b.toJSON())})};if(this.requestOptions||c)a=n.mixin({},this.requestOptions,c,a);return d(this.parsedUrl.path+"/reshape",a).then(function(a){return e.fromJSON(a.data.geometry).set("spatialReference",f)})},simplify:function(a,b){var c=a[0].spatialReference,
f=n.mixin({},this.parsedUrl.query,{f:"json",sr:c.wkid?c.wkid:JSON.stringify(c.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))}),g=e.getJsonType(a[0]),h=this._decodeGeometries;a={query:f};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/simplify",a).then(function(a){return h(a.data,g,c)})},toGeoCoordinateString:function(a,b){var c={};c.sr=null!=a.sr&&"object"===typeof a.sr?a.sr.wkid||JSON.stringify(a.sr):a.sr;c.coordinates=JSON.stringify(a.coordinates);
c.conversionType=q.toJSON(a.conversionType||"mgrs");c.conversionMode=a.conversionMode;c.numOfDigits=a.numOfDigits;c.rounding=a.rounding;c.addSpaces=a.addSpaces;a={query:n.mixin({},this.parsedUrl.query,{f:"json"},c)};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/toGeoCoordinateString",a).then(this._handleToGeoCoordinateResponse)},trimExtend:function(b,c){var e=n.mixin({},this.parsedUrl.query,{f:"json"},b.toJSON()),f=b.sr;b={query:e};if(this.requestOptions||
c)b=n.mixin({},this.requestOptions,c,b);return d(this.parsedUrl.path+"/trimExtend",b).then(function(b){return(b.data.geometries||[]).map(function(b){return new a({spatialReference:f,paths:b.paths})})})},union:function(a,b){var c=a[0].spatialReference;a={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(c.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))})};if(this.requestOptions||b)a=n.mixin({},this.requestOptions,b,a);return d(this.parsedUrl.path+"/union",a).then(function(a){return e.fromJSON(a.data.geometry).set("spatialReference",
c)})},_handleRelationResponse:function(a){return a.data.relations},_handleDistanceResponse:function(a){return(a=a.data)&&a.distance},_handleToGeoCoordinateResponse:function(a){return a.data.strings},_handleFromGeoCoordinateResponse:function(a){return a.data.coordinates},_encodeGeometries:function(a){var b=[],c,d=a.length;for(c=0;c<d;c++)b.push(a[c].toJSON());return{geometryType:e.getJsonType(a[0]),geometries:b}},_decodeGeometries:function(a,b,c){var d=e.getGeometryType(b);a=a.geometries;var f=[],
g={spatialReference:c.toJSON()},h=n.mixin;a.forEach(function(a,b){f[b]=new d(h(a,g))});return f},_toProjectGeometry:function(b){var c=b.spatialReference.toJSON();return b instanceof k?new g({rings:[[[b.xmin,b.ymin],[b.xmin,b.ymax],[b.xmax,b.ymax],[b.xmax,b.ymin],[b.xmin,b.ymin]]],spatialReference:c}):new a({paths:[[].concat(b.points)],spatialReference:c})},_fromProjectedGeometry:function(a,b,c){return"extent"===b?(a=a.rings[0],new k(a[0][0],a[0][1],a[2][0],a[2][1],c)):new h({points:a.paths[0],spatialReference:c.toJSON()})}});
n.mixin(b,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,
UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,
UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,
UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});return b})},"esri/tasks/support/ProjectParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/jsonUtils".split(" "),
function(n,b,l,k,h,a,g,e){var d=a.getLogger("esri.tasks.support.ProjectParameters");return function(a){function b(b){b=a.call(this)||this;b.geometries=null;b.outSpatialReference=null;b.transformation=null;b.transformForward=null;return b}l(b,a);Object.defineProperty(b.prototype,"outSR",{get:function(){d.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");return this.outSpatialReference},set:function(a){d.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");
this.outSpatialReference=a},enumerable:!0,configurable:!0});b.prototype.toJSON=function(){var a=this.geometries.map(function(a){return a.toJSON()}),b=this.geometries[0],c={};c.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());c.inSR=b.spatialReference.wkid||JSON.stringify(b.spatialReference.toJSON());c.geometries=JSON.stringify({geometryType:e.getJsonType(b),geometries:a});this.transformation&&(c.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(c.transformForward=this.transformForward);return c};k([g.property()],b.prototype,"geometries",void 0);k([g.property({json:{read:{source:"outSR"}}})],b.prototype,"outSpatialReference",void 0);k([g.property({json:{read:!1}})],b.prototype,"outSR",null);k([g.property()],b.prototype,"transformation",void 0);k([g.property()],b.prototype,"transformForward",void 0);return b=k([g.subclass("esri.tasks.support.ProjectParameters")],b)}(g.declared(h.JSONSupport))})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(n,b,l,k,h,a){var g=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.minTotalNumberOfFeatures=2E3;a.maxTotalNumberOfFeatures=5E4;a.maxTotalNumberOfPrimitives=17E5;a.polygonLodFactor=1;a.polylineLodFactor=1;return a}l(c,b);k([a.property()],c.prototype,"minTotalNumberOfFeatures",void 0);k([a.property()],c.prototype,"maxTotalNumberOfFeatures",void 0);k([a.property()],c.prototype,"maxTotalNumberOfPrimitives",void 0);k([a.property()],c.prototype,"polygonLodFactor",void 0);
k([a.property()],c.prototype,"polylineLodFactor",void 0);return c=k([a.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],c)}(a.declared(h)),e=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.lodFactor=1;return a}l(c,b);k([a.property()],c.prototype,"lodFactor",void 0);return c=k([a.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],c)}(a.declared(h)),d=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a["3dObject"]=
new e;a.point=new e;a.integratedMesh=new e;a.pointCloud=new e;a.uncompressedTextureDownsamplingEnabled=!1;return a}l(c,b);k([a.property({type:e})],c.prototype,"3dObject",void 0);k([a.property({type:e})],c.prototype,"point",void 0);k([a.property({type:e})],c.prototype,"integratedMesh",void 0);k([a.property({type:e})],c.prototype,"pointCloud",void 0);k([a.property()],c.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return c=k([a.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],
c)}(a.declared(h)),f=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.lodBias=0;a.angledSplitBias=1;a.reduceTileLevelDifferences=!0;return a}l(c,b);k([a.property()],c.prototype,"lodBias",void 0);k([a.property()],c.prototype,"angledSplitBias",void 0);k([a.property()],c.prototype,"reduceTileLevelDifferences",void 0);return c=k([a.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],c)}(a.declared(h));return function(b){function c(){var a=null!==b&&b.apply(this,
arguments)||this;a.graphics3D=new g;a.sceneService=new d;a.tiledSurface=new f;a.antialiasingEnabled=!0;return a}l(c,b);k([a.property({type:g})],c.prototype,"graphics3D",void 0);k([a.property({type:d})],c.prototype,"sceneService",void 0);k([a.property({type:f})],c.prototype,"tiledSurface",void 0);k([a.property()],c.prototype,"antialiasingEnabled",void 0);k([a.property()],c.prototype,"physicallyBasedRenderingEnabled",void 0);k([a.property()],c.prototype,"memoryLimit",void 0);k([a.property()],c.prototype,
"additionalCacheMemory",void 0);k([a.property()],c.prototype,"frameRate",void 0);k([a.property()],c.prototype,"maximumRenderResolution",void 0);k([a.property()],c.prototype,"maximumPixelRatio",void 0);return c=k([a.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],c)}(a.declared(h))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/compilerUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../geometry/SpatialReference ../../../layers/graphics/dehydratedFeatures ./earthUtils ./geometryUtils ./projectionUtils ./stack ./geometryUtils/coordinateSystem".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,c,d){this.type=a;this.spatialReference=b;this.unitInMeters=c;this.coordinateSystem=d;this.tmpCoordinateSystem=r.create(d)}Object.defineProperty(b.prototype,"extent",{set:function(a){a&&r.setExtent(this.coordinateSystem,a,this.coordinateSystem)},enumerable:!0,configurable:!0});b.prototype.getAltitude=function(a){return r.altitudeAt(this.coordinateSystem,a)};b.prototype.setAltitude=function(a,
b){r.setAltitudeAt(this.coordinateSystem,b,a,b)};b.prototype.setAltitudeOfTransformation=function(a,b){r.setAltitudeOfTransformation(this.coordinateSystem,b,a,b)};b.prototype.worldUpAtPosition=function(a,b){return r.normalAt(this.coordinateSystem,a,b)};b.prototype.worldBasisAtPosition=function(a,b,c){return r.axisAt(this.coordinateSystem,a,b,c)};b.prototype.basisMatrixAtPosition=function(b,c){var d=this.worldBasisAtPosition(b,0,p.sv3d.get()),e=this.worldBasisAtPosition(b,1,p.sv3d.get());b=this.worldBasisAtPosition(b,
2,p.sv3d.get());a.mat4.set(c,d[0],d[1],d[2],0,e[0],e[1],e[2],0,b[0],b[1],b[2],0,0,0,0,1);return c};b.prototype.intersectManifoldClosestSilhouette=function(a,b,c){r.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);r.intersectRayClosestSilhouette(this.tmpCoordinateSystem,a,c);return c};b.prototype.intersectManifold=function(a,b,c){r.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);b=p.sv3d.get();return r.intersectRay(this.tmpCoordinateSystem,a,b)?(g.vec3.copy(c,b),!0):!1};b.prototype.intersectInfiniteManifold=
function(a,b,d){if("global"===this.type)return this.intersectManifold(a,b,d);r.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);b=this.tmpCoordinateSystem.value;var e=p.sv3d.get();return c.plane.intersectRay(b.plane,a,e)?(g.vec3.copy(d,e),!0):!1};b.prototype.toRenderCoords=function(a,b,c){return d.isPoint(a)?q.pointToVector(a,b,this.spatialReference):q.vectorToVector(a,b,c,this.spatialReference)};b.prototype.fromRenderCoords=function(a,b,c){return d.isPoint(b)?q.vectorToPoint(a,this.spatialReference,
b,c):b instanceof e?q.vectorToPoint(a,this.spatialReference,b):q.vectorToVector(a,this.spatialReference,b,c)};b.createGlobal=function(a){void 0===a&&(a=q.SphericalECEFSpatialReference);var d=r.fromValues(c.sphere,c.sphere.fromValues(f.earthRadius,[0,0,0]));return new b("global",a,1,d)};b.createLocal=function(a){var d=r.fromValues(c.boundedPlane,c.boundedPlane.fromValues([0,0,0],[t,0,0],[0,t,0])),e=h.getMetersPerUnitForSR(a);return new b("local",a,e,d)};b.createMode=function(a,c){switch(a){case "local":return b.createLocal(c);
case "global":return b.createGlobal();default:k.neverReached(a)}};return b}();b.RenderCoordsHelper=n;var t=Math.pow(2,50)})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=
this.screenSizePerspectiveHandles=null;this.viewState=b.viewState;this.stage=b.stage;this.pointsOfInterest=b.pointsOfInterest;this.resourceController=b.resourceController;this.streamDataRequester=this.resourceController.createStreamDataRequester(2);this.textures=new h.default(this.streamDataRequester,b.stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});this.screenSizePerspectiveSettings=a.getSettings(b.viewingMode);this.screenSizePerspectiveSettingsLabels=a.getLabelSettings(b.viewingMode)}b.prototype.destroy=
function(){this.textures.destroy();this.streamDataRequester=this.textures=null};b.prototype.addGraphicsOwner=function(a){var b=this;if(!a)return{remove:function(){}};this.graphicsOwners.push(a);var c="layer"in a?a.watch("layer.screenSizePerspectiveEnabled",function(){return b.updateScreenSizePerspectiveEnabled()}):null;this.updateScreenSizePerspectiveEnabled();return{remove:function(){c&&(c.remove(),l.removeUnordered(b.graphicsOwners,a),b.updateScreenSizePerspectiveEnabled())}}};b.prototype.updateScreenSizePerspectiveEnabled=
function(){var a=this,b=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});b&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new k,b=function(){return a.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",b,!0),this.viewState.events.on("camera-projection-changed",b)]),this.updateScreenSizePerspectiveSettings()):!b&&this.screenSizePerspectiveHandles&&
(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};b.prototype.updateScreenSizePerspectiveSettings=function(){g.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;g.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(g);this.screenSizePerspectiveSettingsLabels.update(g);this.stage.renderView.setNeedsRender()};return b}();b.SharedSymbolResources=n;var g={distance:0,fovY:0};b.default=n})},"esri/views/3d/support/TextureCollection":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/urlUtils ../webgl-engine/lib/Texture".split(" "),
function(n,b,l,k,h,a,g,e,d,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,c,d){void 0===d&&(d=e.schedule);this._streamDataRequester=a;this._stage=b;this._textureOptions=c;this._schedule=d;this._textureRequests=new Map}b.prototype.destroy=function(){var a=this;this._textureRequests.forEach(function(b){return a.releaseTextureRequest(b)});this._textureRequests=null};b.prototype.fromUrl=function(b,c,d){return h(this,void 0,void 0,function(){var e,f,h,p,q,m=this;return k(this,
function(k){g.throwIfAborted(d);e=a.isSome(d)&&d.signal;f=this.makeUid(b,c);h=this._textureRequests.get(f);h||(p=g.createAbortController(),q=this._streamDataRequester.request(b,"image",{uid:f,signal:p.signal}),h={referenceCount:0,texture:null,textureAsync:null,abortController:p},this._textureRequests.set(f,h),h.textureAsync=q.then(function(a){a=m.createTexture(b,a,c);h.texture=a;h.abortController=null;m.addToStage(a);return{uid:f,texture:a}},function(a){h.abortController=null;throw a;}));h.referenceCount++;
return[2,g.create(function(a,b){g.onAbort(e,function(){b(g.createAbortError())});h.textureAsync.then(a,b)}).catch(function(a){m.release(f);throw a;})]})})};b.prototype.fromData=function(a,b){a=this.makeUid(a);var c=this._textureRequests.get(a);c||(c={referenceCount:0,texture:b(),textureAsync:null,abortController:null},this.addToStage(c.texture),this._textureRequests.set(a,c));c.referenceCount++;return{uid:a,texture:c.texture}};b.prototype.release=function(a){var b=this;if(this._textureRequests){var c=
this._textureRequests.get(a);c?(1>c.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),c.referenceCount--,1>c.referenceCount&&this._schedule(function(){return b.releaseNow(a)})):console.warn("TextureCollection: texture doesn't exist: '"+a+"'")}};Object.defineProperty(b.prototype,"test",{get:function(){return{textureRequests:this._textureRequests}},enumerable:!0,configurable:!0});b.prototype.releaseNow=function(a){if(this._textureRequests){var b=this._textureRequests.get(a);
!b||0<b.referenceCount||(this.releaseTextureRequest(b),this._textureRequests.delete(a))}};b.prototype.releaseTextureRequest=function(a){a.texture?this.removeFromStage(a.texture):a.abortController&&(a.abortController.abort(),a.abortController=null)};b.prototype.createTexture=function(a,b,c){d.isSVG(a)&&(c||0===b.width&&0===b.height)&&(a=b.width?b.height/b.width:1,c=c||64,1<a?(b.width=Math.round(c/a),b.height=c):(b.width=c,b.height=Math.round(c*a)));c=l({},this._textureOptions,{width:b.width,height:b.height,
powerOfTwoResizeMode:2});return new f(b,"symbol",c)};b.prototype.addToStage=function(a){this._stage.add(4,a)};b.prototype.removeFromStage=function(a){this._stage.remove(4,a.id)};b.prototype.makeUid=function(a,b){return null!=b?a+"."+b+"px":a};return b}();b.TextureCollection=n;b.default=n})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../PropertiesPool ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils ../../../support/index".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b){b=a.call(this,b)||this;b.handles=new g;b.surfaceAltitudeAtCenter=0;b.surfaceAltitudeAtCenterDirty=!0;b.surfaceAltitudeAtCenterWithContent=0;b.surfaceAltitudeAtCenterWithContentDirty=!0;b.propertiesPool=new q.PropertiesPool({renderPointOfView:B},b);b.renderPointOfView=c.vec3f64.create();return b}l(b,a);b.prototype.initialize=function(){var a=this,b=this.view,c=b.state,
d=b.basemapTerrain,f=b.renderCoordsHelper,b=b.map;this.surfaceIntersector=new m(c.mode);this.surfaceIntersector.enable.backfacesTerrain=c.isGlobal?!1:!0;this.surfaceIntersector.enable.invisibleTerrain=!1;this.contentIntersector=new m(c.mode);this.contentIntersectorOptions={exclude:e.SetFromValues([v.TERRAIN_ID])};var g=this.estimateSurfaceAltitudeAtCenter.bind(this),k={state:c,scheduler:this.view.resourceController.scheduler,surface:d,renderCoordsHelper:f};this._set("centerOnSurfaceInfrequent",new r.default(h({},
k,{task:z.Task.POINT_OF_INTEREST_SLOW,estimateSurfaceAltitudeAtCenter:g})));this._set("centerOnSurfaceFrequent",new r.default(h({},k,{task:z.Task.POINT_OF_INTEREST_FAST,estimateSurfaceAltitudeAtCenter:g})));this._set("centerOnContent",new r.default(h({},k,{task:z.Task.POINT_OF_INTEREST_FAST,estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this)})));this._set("cameraOnSurface",new p.default(h({},k,{task:z.Task.POINT_OF_INTEREST_SLOW,map:b})));this._set("surfaceGeometryUpdates",
new y.default(h({},k,{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})));this._set("contentGeometryUpdates",new t.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:f}));this._set("surfaceOrigin",new u.default({view:this.view}));this._set("focus",new w.default({state:c,surface:d,renderCoordsHelper:f,centerOnSurface:this.centerOnSurfaceFrequent}));this.handles.add([c.watch("camera",function(b){return a.cameraChanged(b)},!0),d.watch("extent",
function(){return a.updateCenterPointsOfInterest()}),this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}),this.contentGeometryUpdates.events.on("request-update",function(){return a.updateCenterOnContent()})]);this.cameraChanged(this.view.state.camera);this.centerOnContent.update();this.centerOnSurfaceFrequent.update();this.centerOnSurfaceInfrequent.update();this.cameraOnSurface.update()};b.prototype.destroy=function(){x.default(this,"handles",
"centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(b.prototype,"updating",{get:function(){return!!(this.surfaceGeometryUpdates&&this.surfaceGeometryUpdates.updating||this.centerOnContent&&this.centerOnContent.updating||this.centerOnSurfaceInfrequent&&this.centerOnSurfaceInfrequent.updating||this.centerOnSurfaceFrequent&&this.centerOnSurfaceFrequent.updating||this.cameraOnSurface&&this.cameraOnSurface.updating||
this.focus&&this.focus.updating)},enumerable:!0,configurable:!0});b.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;this.view.sceneIntersectionHelper.intersectRay(this.view.state.camera.ray,C,this.contentIntersectorOptions,this.contentIntersector)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(C):this.surfaceAltitudeAtCenterWithContent=
this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};b.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var a=this.view.state.camera;this.surfaceIntersector.intersect(null,a.eye,a.center,null,a,null,!1);this.view.basemapTerrain.intersect(this.surfaceIntersector,null,a.eye,a.center);this.surfaceIntersector.results.min.getIntersectionPoint(C)&&
(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(C));return this.surfaceAltitudeAtCenter};b.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest();a=a.eye;f.vec3.equals(this.renderPointOfView,a)||this._set("renderPointOfView",f.vec3.copy(this.propertiesPool.get("renderPointOfView"),a))};b.prototype.updateCenterPointsOfInterest=function(){this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.updateRenderLocation();
this.centerOnSurfaceInfrequent.updateRenderLocation();this.cameraOnSurface.updateRenderLocation();this.focus.updateRenderLocation();this.centerOnContent.updateRenderLocation()};b.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.updateRenderLocation()};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{update:function(){a.surfaceGeometryUpdates.update();a.centerOnSurfaceFrequent.update();a.centerOnSurfaceInfrequent.update()},
surfaceGeometryUpdates:this.surfaceGeometryUpdates}},enumerable:!0,configurable:!0});k([d.property({readOnly:!0})],b.prototype,"centerOnContent",void 0);k([d.property({readOnly:!0})],b.prototype,"centerOnSurfaceFrequent",void 0);k([d.property({readOnly:!0})],b.prototype,"centerOnSurfaceInfrequent",void 0);k([d.property({readOnly:!0})],b.prototype,"cameraOnSurface",void 0);k([d.property({readOnly:!0})],b.prototype,"focus",void 0);k([d.property({readOnly:!0})],b.prototype,"renderPointOfView",void 0);
k([d.property({readOnly:!0})],b.prototype,"surfaceOrigin",void 0);k([d.property({readOnly:!0})],b.prototype,"contentGeometryUpdates",void 0);k([d.property({readOnly:!0})],b.prototype,"surfaceGeometryUpdates",void 0);k([d.property({constructOnly:!0})],b.prototype,"view",void 0);k([d.property({readOnly:!0,dependsOn:"surfaceGeometryUpdates.updating centerOnContent.updating centerOnSurfaceInfrequent.updating centerOnSurfaceFrequent.updating cameraOnSurface.updating focus.updating".split(" ")})],b.prototype,
"updating",null);return b=k([d.subclass("esri.views.3d.support.PointsOfInterest")],b)}(d.declared(a));b.PointsOfInterest=n;var B=Array,C=c.vec3f64.create();b.default=n})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../PropertiesPool ./PointOfInterest".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){Object.defineProperty(b,"__esModule",{value:!0});var p=Array;n=function(b){function q(a){a=b.call(this,a)||this;a._dirty=!1;a._propertiesPool=new c.default({location:f,renderLocation:p},a);a._estimatedSurfaceAltitude=0;a._pendingElevationQueryController=null;a.renderLocation=d.vec3f64.create();return a}l(q,b);q.prototype.initialize=function(){var b=this;this.handles.add(this.scheduler.registerTask(this.task,function(){return b._measureSurfaceAltitude()},function(){return b._needsUpdate()}));
this._measureSurfaceAltitude();if(this.map){var c=function(){return b._setDirty()};this.handles.add([a.on(this.map,"ground.layers","change",c,c,c)])}};q.prototype.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};Object.defineProperty(q.prototype,"location",{get:function(){var a=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});
Object.defineProperty(q.prototype,"updating",{get:function(){return this._dirty||null!=this._pendingElevationQueryController},enumerable:!0,configurable:!0});q.prototype.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};q.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};q.prototype._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};q.prototype._needsUpdate=function(){return!this._pendingElevationQueryController&&
this._dirty};q.prototype._cancelPendingRequest=function(){var a=this._pendingElevationQueryController;a&&(this._pendingElevationQueryController=null,a.abort(),this.notifyChange("updating"))};q.prototype._measureSurfaceAltitude=function(){var a=this;this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,t,this.state.spatialReference);var b=h.createAbortController();this.map.ground.queryElevation(t,
{signal:b.signal}).then(function(b){return a._updateSurfaceAltitude(b.geometry.z)}).catch(function(b){h.isAbortError(b)||a._updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a._pendingElevationQueryController===b&&(a._pendingElevationQueryController=null,a.notifyChange("updating"));b=null});this._pendingElevationQueryController=b}else this._updateSurfaceAltitude(0)};q.prototype._updateSurfaceAltitude=function(a){this._estimatedSurfaceAltitude!==a&&(this._estimatedSurfaceAltitude=a,this._updateRenderLocation())};
q.prototype._updateRenderLocation=function(){e.vec3.copy(r,this.state.camera.eye);this.renderCoordsHelper.setAltitude(this._estimatedSurfaceAltitude,r);e.vec3.equals(this._get("renderLocation"),r)||this._set("renderLocation",e.vec3.copy(this._propertiesPool.get("renderLocation"),r))};k([g.property({constructOnly:!0})],q.prototype,"scheduler",void 0);k([g.property({constructOnly:!0})],q.prototype,"task",void 0);k([g.property({readOnly:!0,dependsOn:["renderLocation"]})],q.prototype,"location",null);
k([g.property({constructOnly:!0})],q.prototype,"map",void 0);k([g.property({readOnly:!0})],q.prototype,"renderLocation",void 0);k([g.property({readOnly:!0})],q.prototype,"updating",null);return q=k([g.subclass("esri.views.3d.support.CameraOnSurface")],q)}(g.declared(q.PointOfInterest));b.CameraOnSurface=n;var r=d.vec3f64.create(),t=new f;b.default=n})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(c){c=b.call(this)||this;c.handles=new a;return c}l(d,b);d.prototype.destroy=function(){e.default(this,"handles")};k([g.property({constructOnly:!0})],d.prototype,"renderCoordsHelper",void 0);k([g.property({constructOnly:!0})],d.prototype,"surface",void 0);k([g.property({constructOnly:!0})],d.prototype,"state",void 0);return d=k([g.subclass("esri.views.3d.support.PointOfInterest")],d)}(g.declared(h));
b.PointOfInterest=n;b.default=n})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(n,b,l){function k(b){for(var a=[],g=1;g<arguments.length;g++)a[g-1]=arguments[g];if(b instanceof l&&b.destroyed)try{throw Error("instance is already destroyed");}catch(f){console.warn(f.stack)}else for(g=0;g<a.length;g++){var e=a[g];if(!(e in b))throw Error("Property '"+e+"' does not exist and cannot be disposed");var d=b[e];d&&("function"===
typeof d.destroy?d.destroy():"function"===typeof d.dispose?d.dispose():"function"===typeof d.remove&&d.remove());b instanceof l&&e in b.__accessor__.metadatas?b._set(e,null):b[e]=null}}Object.defineProperty(b,"__esModule",{value:!0});b.disposeMembers=k;b.default=k})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/mathUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../debugFlags ../earthUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});var r=Array;n=function(b){function p(a){a=b.call(this,a)||this;a.propertiesPool=new q.default({location:d,renderLocation:r},a);a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=e.vec3f64.create();a.updating=!1;return a}l(p,b);p.prototype.initialize=function(){var a=this;this._frameWorker=this.scheduler.registerTask(this.task,function(){return a._measureSurfaceAltitude()},function(){return a.updating});
this._measureSurfaceAltitude()};p.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(p.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});p.prototype.updateRenderLocation=function(){this._set("updating",!0);this._updateRenderLocation()};
p.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};Object.defineProperty(p.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});p.prototype._measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this._set("updating",!1)};p.prototype._updateRenderLocation=function(){var a=x,b=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,
a),c=this.currentSurfaceAltitude!==this.latestSurfaceAltitude;!b&&c&&(b=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);c=w;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,c)&&(g.vec3.copy(a,c),this.currentSurfaceAltitude=this.latestSurfaceAltitude);b?(b=g.vec3.distance(this.state.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.state.camera,g.vec3.scale(a,b.viewForward,this._get("distance")),
g.vec3.add(a,a,b.eye));g.vec3.equals(this._get("renderLocation"),a)||this._set("renderLocation",g.vec3.copy(this.propertiesPool.get("renderLocation"),a))};p.prototype.calculateSurfaceIntersection=function(a,b){var d=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(d.ray,a,b))return!1;if(this.state.isGlobal){a=c.earthRadius+a;var e=g.vec3.squaredLength(d.eye),f=e<a*a,k=g.vec3.distance(d.eye,b);f&&k>c.earthRadius/4&&(g.vec3.scale(b,d.viewForward,a-Math.sqrt(e)),g.vec3.add(b,b,d.eye))}else if(d=
this.surface.ready&&this.surface.extent)b[0]=h.clamp(b[0],d[0],d[2]),b[1]=h.clamp(b[1],d[1],d[3]);return!0};p.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,b)){var c=this.state.camera.eye;a=g.vec3.distance(c,a);b=g.vec3.distance(c,b);if(f.TESTS_DISABLE_UPDATE_THRESHOLDS||Math.abs(b-a)/a>t)return!0}return!1};k([a.property({constructOnly:!0})],
p.prototype,"scheduler",void 0);k([a.property({constructOnly:!0})],p.prototype,"task",void 0);k([a.property({readOnly:!0})],p.prototype,"distance",void 0);k([a.property({constructOnly:!0})],p.prototype,"estimateSurfaceAltitudeAtCenter",void 0);k([a.property({readOnly:!0,dependsOn:["renderLocation"]})],p.prototype,"location",null);k([a.property({readOnly:!0})],p.prototype,"renderLocation",void 0);k([a.property({readOnly:!0})],p.prototype,"updating",void 0);return p=k([a.subclass("esri.views.3d.support.CenterOnSurface")],
p)}(a.declared(p.PointOfInterest));b.CenterOnSurface=n;var t=.05,x=e.vec3f64.create(),w=e.vec3f64.create();b.default=n})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/Evented","../../../../core/Handles"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this.handles=new k;this.events=new l;this.contentLayerViews=a.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",
this.layerViewsChanged.bind(this)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}a.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};a.prototype.layerViewsChanged=function(a){var b=this;a.added.forEach(function(a){"esri.views.3d.layers.SceneLayerView3D"===a.declaredClass&&b.handles.add(a.on("visible-geometry-changed",b.contentChanged.bind(b)),a.uid)});a.removed.forEach(function(a){return b.handles.remove(a.uid)})};
a.prototype.contentChanged=function(){this.events.emit("request-update",h)};return a}();b.ContentGeometryUpdates=n;var h={};b.default=n})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../geometryUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});var r=Array;n=function(b){function d(a){a=b.call(this,a)||this;a.propertiesPool=new q.default({locationOnSurface:f,renderLocationOnSurface:r},a);a.centerOnSurface=null;return a}l(d,b);d.prototype.destroy=function(){this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(d.prototype,"locationOnSurface",{get:function(){var a=this.propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,
a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderLocationOnSurface",{get:function(){var a=this.centerOnSurface.renderLocation,b=this.renderCoordsHelper,c=this.calculateScreenHorizontalEdgeOnSurface(u);e.vec3.subtract(t,a,this.state.camera.eye);e.vec3.normalize(t,t);b.worldUpAtPosition(a,x);var d=Math.abs(Math.acos(e.vec3.dot(x,t))-.5*Math.PI),b=this.propertiesPool.get("renderLocationOnSurface"),d=1-h.clamp(d/(.5*Math.PI),0,1);e.vec3.lerp(b,
a,c,d*d*d);return b},enumerable:!0,configurable:!0});d.prototype.calculateScreenHorizontalEdgeOnSurface=function(b){var d=this.state.camera,f=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),g=this.renderCoordsHelper.getAltitude(d.eye)>=f,h=d.getRenderCenter(a.createRenderScreenPointArray3());h[1]=g?d.padding[2]:d.fullHeight-d.padding[0];d.unprojectPoint(h,w);e.vec3.subtract(w,w,d.eye);g=e.vec3.normalize(w,w);if(this.renderCoordsHelper.intersectManifold(c.ray.wrap(d.eye,g),
f,b))return b;e.vec3.copy(b,d.eye);this.renderCoordsHelper.setAltitude(f,b);return b};d.prototype.updateRenderLocation=function(){};k([g.property({constructOnly:!0})],d.prototype,"centerOnSurface",void 0);k([g.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],d.prototype,"locationOnSurface",null);k([g.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],d.prototype,"renderLocationOnSurface",null);k([g.property({readOnly:!0,aliasOf:"centerOnSurface.updating"})],d.prototype,
"updating",void 0);return d=k([g.subclass("esri.views.3d.support.CenterOnSurface")],d)}(g.declared(p.PointOfInterest));b.Focus=n;var t=d.vec3f64.create(),x=d.vec3f64.create(),w=d.vec3f64.create(),u=d.vec3f64.create();b.default=n})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function h(c){c=b.call(this,c)||this;c.location=null;c._updateController=null;c._handles=new a;return c}l(h,b);Object.defineProperty(h.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=f.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this.view.state.isLocal&&
(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],function(){return a._update()}),e.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};h.prototype.destroy=function(){this._handles.destroy()};h.prototype._update=function(){var a=this;this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var b=q.center(this.surfaceView.extent),
b=new c({x:b[0],y:b[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=g.createAbortController(),this.surface.queryElevation(b,{noDataValue:0,signal:this._updateController.signal}).then(function(b){a._updateController=null;a._set("location",b.geometry)}).catch(function(a){g.isAbortError(a)||a&&"elevation-query:invalid-layer"===a.name||console.error("StableSurfaceCenter failed to update: ",a)})):
this._set("location",b)}else this._set("location",null)};k([d.property({constructOnly:!0})],h.prototype,"view",void 0);k([d.property({readOnly:!0,aliasOf:"view.map.ground"})],h.prototype,"surface",void 0);k([d.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],h.prototype,"surfaceView",void 0);k([d.property({readOnly:!0})],h.prototype,"location",void 0);k([d.property({readOnly:!0,dependsOn:["location"]})],h.prototype,"renderLocation",null);return h=k([d.subclass("esri.views.3d.terrain.StableSurfaceCenter")],
h)}(d.declared(h));b.StableSurfaceCenter=n;b.default=n})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/index".split(" "),function(n,b,
l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c.handles=new g;c._tileGeometryUpdateExtent=f.empty();c._tileGeometryUpdateSpatialReference=null;c.events=new a;c.updating=!1;return c}k(d,b);d.prototype.initialize=function(){var a=this;this.handles.add([this.surface.on("elevation-change",function(b){return a._tileGeometryChanged(b)}),this.scheduler.registerTask(c.Task.SURFACE_GEOMETRY_UPDATES,function(){return a.update()},
function(){return a.updating})])};d.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};d.prototype.update=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",q),f.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};d.prototype._tileGeometryChanged=function(a){this._tileGeometryUpdateSpatialReference=a.spatialReference;f.expand(this._tileGeometryUpdateExtent,
a.tile.extent);this._set("updating",!0)};d.prototype._furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaces[0],b=1;b<this.centerOnSurfaces.length;b++){var c=this.centerOnSurfaces[b];c.distance>a.distance&&(a=c)}return a};d.prototype._centerIntersectsExtent=function(a,b){var c=this.state.camera.eye,d=t,e=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(c,p,b);this.renderCoordsHelper.fromRenderCoords(e.renderLocation,r,b);p[0]<r[0]?(d[0]=p[0],d[2]=r[0]):(d[0]=r[0],
d[2]=p[0]);p[1]<r[1]?(d[1]=p[1],d[3]=r[1]):(d[1]=r[1],d[3]=p[1]);return f.intersects(d,a)};l([e.property({constructOnly:!0})],d.prototype,"state",void 0);l([e.property({constructOnly:!0})],d.prototype,"centerOnSurfaces",void 0);l([e.property({constructOnly:!0})],d.prototype,"renderCoordsHelper",void 0);l([e.property({constructOnly:!0})],d.prototype,"scheduler",void 0);l([e.property({constructOnly:!0})],d.prototype,"surface",void 0);l([e.property({readOnly:!0})],d.prototype,"updating",void 0);return d=
l([e.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],d)}(e.declared(h));b.SurfaceGeometryUpdates=n;var q={},p=d.vec3f64.create(),r=d.vec3f64.create(),t=f.empty();b.default=n})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../../layers/support/LercWorker ../../../layers/support/TilemapCache ../../2d/engine/vectorTiles/VectorTileDisplayObject ../support/debugFlags ../support/geometryUtils ../support/projectionUtils ./ElevationBounds ./ElevationData ./ElevationTileAgent ./MapTileAgent ./OverlayManager ./PlanarPatch ./SphericalPatch ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./Tile ./TilemapOnlyTile ./tileUtils ./tileUtils ./UpsampleInfo ../../support/index ../../webgl/Texture ../../webgl/Util @dojo/framework/shim/Promise".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T,U,Y,X,P,V,Z,ca,da,F,ea,la,ka,oa,va,fa,xa,ia,na){function wa(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function Ca(a,b){var c=!1;b=b||a;var d=0;for(a=a.children;d<a.length;d++){var e=a[d];if(e){for(var f=0;f<e.layerInfo.length;f++)for(var g=0,h=e.layerInfo[f];g<h.length;g++){var k=h[g].upsampleFromTile;if(k&&k.tile===b)return!0}c=c||Ca(e,b)}}return c}function ua(a){return a.isLeaf?!1:a.children[0].shouldRender||
a.children[1].shouldRender||a.children[2].shouldRender||a.children[3].shouldRender||ua(a.children[0])||ua(a.children[1])||ua(a.children[2])||ua(a.children[3])}var ya=p.getLogger("esri.views.3d.terrain.TerrainSurface");b=function(b){function c(a,c){c=b.call(this)||this;c.defaultTileBackground=da.DEFAULT_TILE_BACKGROUND;c.hideSkirtsDistanceFromExtentMargin=G;c.hideSkirtsMinimumCameraTilt=Ea;c.hideSkirtsMaximumCameraTilt=za;c._clippingExtent=null;c._dataExtent=null;c._elevationBounds=new S.ElevationBounds;
c._rootExtent=I.create();c._iteratorPool=new x(va.IteratorPreorder);c._postorderIterator=new va.IteratorPostorder;c._visible=!1;c._pendingUpdates=!1;c._asyncWorkItems=0;c._usedMemory=H;c._isFrameProcessing=!1;c._viewChangeUpdateDirty=!1;c._overlayOpacity=1;c._eyePosRenderSR=D.vec3f64.create();c._eyePosSurfaceSR=D.vec3f64.create();c._splitLimits=new la.SplitLimits;c._snapLevel=Infinity;c._frustum=M.frustum.create();c._viewProjectionMatrix=B.mat4f64.create();c._layerViews=[[],[]];c._layerIndexByLayerViewId=
[new Map,new Map];c._basemapLayerViewHandles=new Map;c._handles=new q;c._lowPrioUpdates=new w;c._topLevelTilemapOnlyTiles=[];c._upsampleInfoPool=new x(fa);c._visibleLevels=new w({deallocator:null});c._getElevationData={spatialReference:null,rootTiles:null};c.maxTextureScale=1.2;c.rootTiles=null;c.backgroundImage=da.DEFAULT_TILE_BACKGROUND;c.backgroundColor=null;c._scheduledLayerViewChangesHandle=null;c._lercWorker=Q.acquireInstance(a.resourceController.scheduler);return c}k(c,b);c.prototype.normalizeCtorArgs=
function(a,b){this._view=a;this._stage=a._stage;this._set("manifold",b);return{}};c.prototype.initialize=function(){var a=this;this._tilePool="planar"===this.manifold?new x(P.PlanarPatch):new x(V.SphericalPatch);this._memCache=this._view.resourceController.memoryController.getMemCache("esri.views.3d.terrain",function(b){return a._renderer.releaseTileGeometry(b.renderData)});this._renderer=new F({manifold:this.manifold,memCache:this._memCache});this._renderer.install(this._view._stage);m.init(this,
"_background",function(){a._renderer.setTileBackground(a._background)});this._handles.add([this._view.watch("pointsOfInterest",function(b){a._renderer.pointsOfInterest=b}),m.init(L,"TERRAIN_TILE_TREE_SHOW_TILES",function(b){b&&!a._treeDebugger?(new Promise(function(a,b){n(["../layers/support/TerrainTileTree3DDebugger"],a,b)})).then(function(b){b=b.TerrainTileTree3DDebugger;!a._treeDebugger&&L.TERRAIN_TILE_TREE_SHOW_TILES&&(a._treeDebugger=new b({view:a._view}))}):b||!a._treeDebugger||L.TERRAIN_TILE_TREE_SHOW_TILES||
(a._treeDebugger.destroy(),a._treeDebugger=null)})]);this._set("overlayManager",new X.OverlayManager({terrainSurface:this,view:this._view}));this._handles.add(this.watch("overlayManager.hasHighlights",function(b){return a._handleHasHighlights(b)}),"overlayManager");var b={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};this.extentHelper="spherical"===this.manifold?new Z.SurfaceExtentHelperGlobal(b):new Z.SurfaceExtentHelperLocal(b);
this._handles.add(m.init(this.extentHelper,"stencilEnabledExtents",function(b){a._renderer.setStencilEnabledLayerExtents(b)}),"extentHelper");b=this._view.defaultsFromMap?new f({root:this._view.map,rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;b=new ca({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",
this._updateTilingSchemeAndExtent.bind(this),!0),this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._streamDataRequester=this._view.resourceController.createStreamDataRequester(0);this._handles.add(this._view.resourceController.scheduler.registerTask(xa.Task.TERRAIN_SURFACE,function(b){return a._frame(b)},function(){return a.updating}));this._view.resourceController.memoryController.events.on("quality-changed",
function(){return a._viewChangeUpdate()});this._handles.add([this._view.on("resize",function(){return a._viewChangeUpdate()}),this._view.watch("state.camera",function(){return a._viewChangeUpdate()},!0),this._view.watch("qualitySettings.tiledSurface.lodBias",function(){return a._viewChangeUpdate()}),this._view.watch("qualitySettings.tiledSurface.reduceTileLevelDifferences",function(){return a._viewChangeUpdate()}),this._view.watch("clippingArea",function(){return a._clippingChanged()})]);this._handles.add(this._view.allLayerViews.on("after-changes",
function(){return a._scheduleLayerViewChangesUpdate()}));this._handleLayerViewChanges();this._updateClippingExtent();this.notifyChange("extent")};c.prototype.destroy=function(){var a=this;this._handles.destroy();Q.releaseInstance(this._lercWorker);this._lercWorker=null;this._removeAllTiles();this._memCache.destroy();this._memCache=null;this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;this._basemapLayerViewHandles.forEach(function(b,
c){return a._unregisterTiledLayerView(c)});this._streamDataRequester=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._tilePool.destroy();this._tilePool=null;U.Pool.prune(0);Y.Pool.prune(0);this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this._renderer.uninstall(this._stage);this._renderer.destroy();this._renderer=null;this._iteratorPool.destroy();this._stage=this._view=this._iteratorPool=null;this._upsampleInfoPool.destroy();
this._upsampleInfoPool=null};Object.defineProperty(c.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"frustum",{get:function(){return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"snapLevel",{get:function(){return Math.round(this._snapLevel)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"upsampleInfoPool",{get:function(){return this._upsampleInfoPool},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"cullBackFaces",{set:function(a){this._renderer.cullBackFaces=a;this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return!(!(this._pendingUpdates||this._renderer.updating||this._scheduledLayerViewChangesHandle)||!this.ready||this._get("suspended"))},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"baseOpacity",{set:function(a){var b=this._renderer.opaque;this._renderer.opaque=1<=a;this._set("baseOpacity",a);this._updateTileTextures(b!==this._renderer.opaque)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",a)},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"skirtScale",{set:function(a){this._renderer.skirtScale=a;this._set("skirtScale",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"spatialReference",{get:function(){var a=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_background",{get:function(){return null!=this.backgroundColor?this.backgroundColor:
this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"slicePlaneEnabled",{set:function(a){this._renderer.slicePlaneEnabled=a;this._set("slicePlaneEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOvergroundEnabled=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);
this._set("wireframe",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"visible",{set:function(a){a!==this._visible&&(this._visible=a,this._renderer.setVisibility(a),this.suspended=!a)},enumerable:!0,configurable:!0});c.prototype.isOpaque=function(){return this._renderer.opaque};Object.defineProperty(c.prototype,"suspended",{set:function(a){this._set("suspended",a);this._viewChangeUpdate()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"reduceTileLevelDifferences",
{get:function(){return this._view.qualitySettings.tiledSurface.reduceTileLevelDifferences},enumerable:!0,configurable:!0});c.prototype.intersect=function(a,b,c,d){this._renderer.intersect(a,b,c,d,null)};c.prototype.getElevation=function(a){var b=this._getElevationData.rootTiles;if(!b||!b.length||0===b[0].layerInfo[0].length)return null;var c=qa;if(Array.isArray(a))c=a;else if("point"===a.type&&!R.pointToVector(a,c,this._getElevationData.spatialReference))return ya.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null;for(var d=0;d<b.length;d++)if(a=b[d],a.containsPoint(c)){for(;a&&!a.rendered&&!a.isLeaf;)b=0,c[0]>.5*(a.extent[0]+a.extent[2])&&(b+=1),c[1]<.5*(a.extent[1]+a.extent[3])&&(b+=2),a=a.children[b];if(b=(b=a.renderData)&&b.geometryState?b.geometryState.samplerData:null)return T.sample(c[0],c[1],b);break}return null};Object.defineProperty(c.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});c.prototype.getScale=function(a){if(this.tilingScheme){if(!R.pointToVector(a,
qa,this.spatialReference))return ya.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;var b=this.rootTiles;if(b)for(var c=0;c<b.length;c++)if(a=b[c],a.containsPoint(qa)){for(;null!=a.children[0];)b=0,qa[0]>a.children[0].extent[2]&&(b+=1),qa[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.level)}}return 1E100};c.prototype.queryVisibleScaleRange=function(a,b,c,d){b=b?this.tilingScheme.levelAtScale(b):
0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var e=this._getLodBias();this._renderer.queryVisibleLevelRange(a,b+e,c+e,d)};c.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,b=a&&!I.equals(a,this._dataExtent);b&&(this._dataExtent?I.set(this._dataExtent,a):this._dataExtent=I.create(a));var a=this.tilingSchemeLogic.tilingScheme,c=a!==this.tilingScheme;c&&(ea.weakAssert(!!a,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),
this._set("tilingScheme",a),this._updateClippingExtent(),a&&(this._updateTiledLayers(),this._renderer.setTileSize(a.pixelSize),this.overlayManager.setSpatialReference(a.spatialReference,"spherical"===this.manifold)));(b||c)&&this._updateRootTiles()};c.prototype._acquireTile=function(a,b,c,d){var e=this._tilePool.acquire();W[0]=a;W[1]=b;W[2]=c;e.init(W,d,this);return e};c.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,c=this.tilingScheme;if(b&&c){this._memCache.clear();
var d=sa,f=c.rootTilesInExtent(b,d,Infinity),g=function(b){b=a._acquireTile(0,b[1],b[2],null);1===b.shouldSplit(a._splitLimits,a._eyePosRenderSR,0)&&b.setPendingUpdate(1);a._loadTile(b);return b};if(this.rootTiles){if(f.length>da.MAX_ROOT_TILES){ya.warn(da.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),h=e.difference(b,f,wa);if(0<h.removed.length||0<h.added.length){var k=this.rootTiles.filter(function(b){return-1<e.findIndex(h.removed,wa.bind(null,
b.lij))?(a._purgeTile(b),!1):!0});h.added.forEach(function(a){return k.push(g(a))});this._setRootTiles(k)}}else f.length>da.MAX_ROOT_TILES&&(ya.warn(da.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),f=c.rootTilesInExtent(b,d,da.MAX_ROOT_TILES)),this._setRootTiles(f.map(function(a){return g(a)}));I.equals(d,this._rootExtent)||(this._rootExtent=I.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setOverlayPlacementDirty();this.notifyChange("ready")}};
c.prototype._setRootTiles=function(a){this._set("rootTiles",a);this._getElevationData.rootTiles=a;this._renderer.setRootTiles(this.rootTiles);this._updateTiles(a)};c.prototype._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};c.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this._visible&&(this._isFrameProcessing?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),
this._updateSkirts(),this.updateOverlayOpacity(),this._updateTiles(this.rootTiles)))};c.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.resetPendingUpdate(16)&&this._updateTileGeometry(a)};c.prototype._updateTiles=function(a){if(a){var b=this._iteratorPool.acquire();b.reset(a);var c;oa.hasVisibleSiblings(a)?(a=this._elevationBounds.min,c=this._elevationBounds.max):(a=Infinity,c=-Infinity);for(;!b.done;){var d=b.next();this._updateClippingStatus(d);d.updateVisibility();
d.setPendingUpdate(8);if(d.visible){d.updateScreenDepth(this._viewProjectionMatrix);d.renderData&&(a=Math.min(d.elevationBounds[0],a),c=Math.max(d.elevationBounds[1],c));var e=d.shouldSplit(this._splitLimits,this._eyePosRenderSR,0);if(1===e){d.resetPendingUpdate(4);d.isLeaf&&(d.setPendingUpdate(1),b.skipSubtree());this._pendingUpdates=this._pendingUpdates||d.updating;continue}d.resetPendingUpdate(1)&&d.updateAgentSuspension();2===e&&d.updateAgents(0)}b.skipSubtree();if(!d.isLeaf){d.setPendingUpdate(4);
d.resetPendingUpdate(1);e=this._iteratorPool.acquire();for(e.resetOne(d);!e.done;){var f=e.next();this._updateClippingStatus(f);f.updateVisibility();f.visible&&f.updateScreenDepth(this._viewProjectionMatrix)}this._iteratorPool.release(e)}this._pendingUpdates=this._pendingUpdates||d.updating}this._iteratorPool.release(b);isFinite(a)&&isFinite(c)&&(this._elevationBounds.min!==a||this._elevationBounds.max!==c)&&(this._elevationBounds.min=a,this._elevationBounds.max=c,this.emit("elevation-bounds-change",
null))}};c.prototype._updateViewDependentParameters=function(){var a=this._view.state.camera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this._getLodBias())*a.pixelRatio;this._splitLimits.aboveGround=a.aboveGround;this._splitLimits.fovX=b;this._splitLimits.fovY=c;this._splitLimits.relativeWidthLimit=d/a.width*this.maxTextureScale*e;this._splitLimits.relativeHeightLimit=d/a.height*this.maxTextureScale*e;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();
this._splitLimits.angledSplitBias=this._view.qualitySettings.tiledSurface.angledSplitBias;M.frustum.copy(a.frustum,this._frustum);z.mat4.multiply(this._viewProjectionMatrix,a.projectionMatrix,a.viewMatrix);C.vec3.copy(this._eyePosRenderSR,a.eye);R.vectorToVector(this._eyePosRenderSR,this._view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};c.prototype._updateSnapLevel=function(){if(this.reduceTileLevelDifferences){var a=L.TESTS_DISABLE_UPDATE_THRESHOLDS?0:.1,b=this._findSnapLevel();
Math.abs(this._snapLevel-b)<a||(a=this._snapLevel,this._snapLevel=b,a!==this._snapLevel&&this._updateTiles(this.rootTiles))}};c.prototype._findSnapLevel=function(){if(0>=this._visibleLevels.length)return this._snapLevel;var a=this._visibleLevels,b=Math.round(a.length*(Math.abs(this._view.camera.tilt-90)/90*.4+.3));if(b>=a.length)return this._snapLevel;a.sort(function(a,b){return a-b});for(var c=0,d=b;d<a.length;++d)c+=a.getItemAt(d);d=a.getItemAt(Math.round(.95*a.length)-1);b=c/(a.length-b);a.clear();
return Math.max(b,d-1)};c.prototype._updateSkirts=function(){ea.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this._view.state.camera.near)};c.prototype._updateRender=function(a){a.rendered&&!a.shouldRender&&(ua(a)?this._loadChildren(a):a.isLeaf&&a.parent&&a.parent.shouldRender&&this._loadParent(a))};c.prototype._updateTileGeometry=function(a){a.updateVisibility();this._renderer.updateTileGeometry(a);this._elevationUpdate(a);this._usedMemory=H};c.prototype._elevationUpdate=function(a){Pa.spatialReference=
this.spatialReference;Pa.tile=a;Pa.extent=a.extent;this.emit("elevation-change",Pa);I.containsPoint(a.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};c.prototype._frame=function(a){var b=this;this._isFrameProcessing=!0;this._frameTraversal(a);a.run(function(){oa.sortTiles(b._renderer.renderOrder,b._lowPrioUpdates);return!1});a.run(function(){return b._processElevation(a)});a.run(function(){return b._processTextures(a)});0!==this._asyncWorkItems&&(this._pendingUpdates=!0);this._lowPrioUpdates.clear();
this._isFrameProcessing=!1;this._runViewChangeUpdateIfDirty();this.notifyChange("updating")};c.prototype._frameTraversal=function(a){var b=this;if(!this.suspended&&this._pendingUpdates){this._pendingUpdates=!1;this._lowPrioUpdates.clear();var c=this._iteratorPool.acquire(),d=this._eyePosRenderSR;c.reset(this.rootTiles,d);var e=0,f=!1,g=!1,h=[];this._visibleLevels.clear();for(var k=function(){},m=this.reduceTileLevelDifferences?function(a){a.visible&&1!==a.shouldSplit(b._splitLimits,d,1)&&a.parent&&
1===a.parent.shouldSplit(b._splitLimits,d,1)&&b._visibleLevels.push(a.level)}:k;!c.done&&!a.done;){var p=c.next(),e=e+p.usedMemory;m(p);p.resetPendingUpdate(4)?(this._mergeTile(p),g=!0,a.madeProgress(),c.skipSubtree()):p.resetPendingUpdate(1)&&(this._splitTile(p)&&h.push(p),f=!0,a.madeProgress());p.resetPendingUpdate(8)&&(this._updateRender(p),a.madeProgress());p.hasPendingUpdates&&this._lowPrioUpdates.push(p);this._pendingUpdates=this._pendingUpdates||p.updating;c.done&&(c.reset(h),h.length=0,m!==
k&&(this._updateSnapLevel(),m=k))}this._pendingUpdates=this._pendingUpdates||!c.done||0<this._lowPrioUpdates.length;f||g?this._treeDebugger&&this._treeDebugger.update():c.done&&(this._usedMemory=e);this._iteratorPool.release(c);this._visibleLevels.clear()}};c.prototype._processElevation=function(a){var b=this;this._lowPrioUpdates.some(function(c){if(a.done)return!0;c.resetPendingUpdate(16)&&(b._updateTileGeometry(c),a.madeProgress());return!1});return a.hasProgressed};c.prototype._processTextures=
function(a){var b=this;this._lowPrioUpdates.some(function(c){if(a.done)return!0;c.resetPendingUpdate(32)&&(b._renderer.updateTileTexture(c),b._usedMemory=H,a.madeProgress());return!1});return a.hasProgressed};c.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=I.create(),b=null;R.extentToBoundingRect(this._view.clippingArea,a,this.spatialReference)&&(b=a);if(I.equals(b,this._clippingExtent))return!1;this._memCache.clear();this._clippingExtent=b;this._renderer.clippingExtent=
b;this.notifyChange("extent");this.updateTileOverlayParams();this.overlayManager.setOverlayPlacementDirty();return!0};c.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};c.prototype._getLodBias=function(){return this._view.qualitySettings.tiledSurface.lodBias-(1-this._view.resourceController.memoryController.memoryFactor)*da.MAX_MEMORY_LOD_BIAS};c.prototype._getLodBiasCorrectedScale=function(a){var b=this.tilingScheme.levels;a=r.clamp(a-this._getLodBias(),
0,b.length-1);var c=a-Math.floor(a);return b[Math.floor(a)].scale*(1-c)+b[Math.ceil(a)].scale*c};c.prototype._cancelTilemapRequests=function(a){var b=0;for(a=a.layerInfo;b<a.length;b++){var c=a[b];if(c)for(var d=0;d<c.length;d++)c[d].abortTilemapRequest()}};c.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){return a._purgeTile(b)}),this._setRootTiles(null),this.notifyChange("ready"));for(var b=0,c=this._topLevelTilemapOnlyTiles;b<c.length;b++){var d=
c[b];t.isSome(d)&&this._cancelTilemapRequests(d)}this.visible=!1};c.prototype._purgeChildTiles=function(a){if(a.isLeaf)return!1;var b=this._purgeTile(a.children[0]),b=this._purgeTile(a.children[1])||b,b=this._purgeTile(a.children[2])||b,b=this._purgeTile(a.children[3])||b;a.unsetChildren();return b};c.prototype._purgeTile=function(a){var b=this._purgeChildTiles(a)||a.rendered;a.unload(this._renderer);this._cancelTilemapRequests(a);a.dispose();this._tilePool.release(a);return b};c.prototype._splitTile=
function(a){ea.weakAssert(a.isLeaf,"tile that is already split should not be split again!");var b=a.level+1,c=2*a.lij[1],d=2*a.lij[2];a.setChildren(this._createTile(b,c,d,a),this._createTile(b,c,d+1,a),this._createTile(b,c+1,d,a),this._createTile(b,c+1,d+1,a));a.setPendingUpdate(8);a.updateAgentSuspension();Ra.spatialReference=this.spatialReference;Ra.extent=a.extent;Ra.scale=this._getLodBiasCorrectedScale(b);this._pendingUpdates=!0;this.emit("scale-change",Ra);return a.children[0].hasPendingUpdate(1)||
a.children[1].hasPendingUpdate(1)||a.children[2].hasPendingUpdate(1)||a.children[3].hasPendingUpdate(1)};c.prototype._createTile=function(a,b,c,d){ea.weakAssert(!!d,"_createTile sanity check");a=this._acquireTile(a,b,c,d);a.updateClippingStatus(this._clippingExtent);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),1===a.shouldSplit(this._splitLimits,this._eyePosRenderSR,0)&&a.setPendingUpdate(1));return a};c.prototype._mergeTile=function(a){ea.weakAssert(!a.hasPendingUpdate(1),"_mergeTile sanity check");
this._purgeChildTiles(a)&&(ea.weakAssert(!a.renderData,"_mergeTile sanity check"),this._loadTile(a));Ra.spatialReference=this.spatialReference;Ra.extent=a.extent;Ra.scale=this._getLodBiasCorrectedScale(a.level);this._pendingUpdates=!0;this.emit("scale-change",Ra)};c.prototype._loadChildren=function(a){ea.weakAssert(a.rendered,"parent should be rendered");a.unload(this._renderer);this._loadTile(a.children[0]);this._loadTile(a.children[1]);this._loadTile(a.children[2]);this._loadTile(a.children[3])};
c.prototype._loadParent=function(a){a=a.parent;this._unloadChildren(a);this._loadTile(a)};c.prototype._unloadChildren=function(a){a.isLeaf||(this._unloadChildren(a.children[0]),a.children[0].unload(this._renderer),this._unloadChildren(a.children[1]),a.children[1].unload(this._renderer),this._unloadChildren(a.children[2]),a.children[2].unload(this._renderer),this._unloadChildren(a.children[3]),a.children[3].unload(this._renderer))};c.prototype._loadTile=function(a){a.load(this._renderer);a.setPendingUpdate(8);
this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,a.renderData,this._overlayOpacity);this._elevationUpdate(a)};c.prototype._handleHasHighlights=function(a){this._renderer.setNeedsHighlight(a)};c.prototype._elevationDataUpdated=function(a,b){var c=a.layerInfo[0][b],d=[a],e=a.level,f=this._iteratorPool.acquire();for(f.reset(d);!f.done;){var g=f.next();g.findElevationBoundsForLayer(b,e);g.computeElevationBounds()}this._iteratorPool.release(f);a.dataArrived(b,
0,c.data);this._updateTiles(d)};c.prototype._scheduleLayerViewChangesUpdate=function(){var a=this;this._scheduledLayerViewChangesHandle||(this._scheduledLayerViewChangesHandle=y.schedule(function(){return a._handleLayerViewChanges()}),this._handles.add(this._scheduledLayerViewChangesHandle,"scheduledLayerViewChangesHandle"))};c.prototype._handleLayerViewChanges=function(){var a=this;this._handles.remove("scheduledLayerViewChangesHandle");this._scheduledLayerViewChangesHandle=null;for(var b=!1,c=new Set,
d=-1,e=0,f=this._view.allLayerViews.items;e<f.length;e++){var g=f[e];c.add(g.uid);if(ea.isTiledLayerView(g))if(this._basemapLayerViewHandles.has(g.uid)){var h=this.layerClassFromLayerView(g),g=this._layerIndexByLayerViewId[h].get(g.uid);g<d&&(b=!0);d=g}else this._registerTiledLayerView(g),g.layer.loaded&&(b=!0)}this._basemapLayerViewHandles.forEach(function(d,e){c.has(e)||(a._unregisterTiledLayerView(e),b=!0)});this.overlayManager&&this.overlayManager.updateLayerViews(c);b&&this._updateTiledLayers()};
c.prototype.layerClassFromLayerView=function(a){return ea.isElevationLayerView(a)?0:1};c.prototype._registerTiledLayerView=function(a){var b=this,c=[],d=this.layerClassFromLayerView(a);c.push(a.watch("suspended",function(){return b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures(!1)}));c.push(a.layer.watch("scaleRangeId",function(){return b._restartAllAgents(d)}));a.on("data-changed",function(){var c=b._layerIndexByLayerViewId[d].get(a.uid);null!=c&&b._invalidateLayerData(c,
d)});this._basemapLayerViewHandles.set(a.uid,c)};c.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles.get(a);if(b){for(var c=0;c<b.length;c++)b[c].remove();this._basemapLayerViewHandles.delete(a)}};c.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme&&!this._view.suspended){var b=this._view.allLayerViews,c=[[],[]],d=null,e=I.empty();b.forEach(function(b){var f=b.layer;if(f&&!b.suspended&&ea.isTiledLayerView(b)){var g=b.fullExtent;g?a.tilingScheme.compatibleWith(b.tileInfo)?
(I.expand(e,g),f=a.layerClassFromLayerView(b),1===f&&(g=b.displayLevelRange,Infinity!==g.maxLevel&&(null===d||g.maxLevel>d)&&(d=g.maxLevel)),c[f].push(b)):ya.warn("Terrain: tiling scheme of layer "+f.id+" is incompatible with other tiled layers, will not be drawn"):ya.warn("Terrain: Map or elevation layer does not have fullExtent: "+f.id)}});for(b=0;2>b;b++){var f=this._layerViews[b],g=c[b];g.reverse();var h=g.length,k=f.length!==h,m=Array(h),p=Array(f.length);this._layerIndexByLayerViewId[b].clear();
for(var q=0;q<h;q++){this._layerIndexByLayerViewId[b].set(g[q].uid,q);var l=f.indexOf(g[q]);m[q]=l;q!==l&&(k=!0);-1<l&&(p[l]=q)}if(k){f=0;for(h=this._topLevelTilemapOnlyTiles;f<h.length;f++)k=h[f],t.isSome(k)&&k.modifyLayers(p,m,b);f=this._postorderIterator;for(f.reset(this.rootTiles);!f.done;)f.next().modifyLayers(p,m,b);this._layerViews[b]=g;0===b&&this._memCache.clear();this._restartAllAgents(b);this._updateTiles(this.rootTiles)}}this.tilingScheme.ensureMaxLod(d)&&this._viewChangeUpdate()}};c.prototype._restartAllAgents=
function(a){var b=this._postorderIterator;for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.restartAgents(a);0===a&&c.computeElevationBounds()}};c.prototype._hasFixedExtent=function(){return!!this._clippingExtent};c.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};c.prototype.numLayers=function(a){return this._layerViews[a].length};c.prototype._updateTileTextures=function(a){var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.updateAgents(1);
a?this.renderer.updateTileTexture(c):c.updateRenderData(1)}this._iteratorPool.release(b)};c.prototype._invalidateLayerData=function(a,b){var c=this._iteratorPool.acquire();for(c.reset(this.rootTiles);!c.done;)c.next().removeLayerAgent(a,b);for(c.reset(this.rootTiles);!c.done;)c.next().invalidateLayerData(a,b);this._iteratorPool.release(c);0===b&&this._memCache.clear()};c.prototype.requestRender=function(a){void 0===a&&(a=1);this.renderer.setNeedsRender(a)};c.prototype.setPendingUpdates=function(){this._pendingUpdates||
(this._pendingUpdates=!0,this.notifyChange("updating"))};c.prototype.requestTileData=function(a,b,c,d){var e=this,f=this.layerViewByIndex(b,c),g=f.layer;if(g.tilemapCache&&!ea.isVectorTileLayerView(f)){var h=this.getTilemapTile(a),k=h.layerInfo[c][b];if(k.tilemap){if(!h.hasDataAvailable(a,b,c))return this._dispatchDataEvent(a,"dataMissing",c,f,{notInTilemap:!0}),u.reject()}else return k.tilemapRequestPromise||(k.tilemapRequestAbort=u.createAbortController(),k.tilemapRequestPromise=this.requestTilemap(h,
b,c,f,g,{signal:k.tilemapRequestAbort.signal})),++this._asyncWorkItems,k.tilemapRequestPromise.catch(function(){}).then(function(){--e._asyncWorkItems;k.tilemapRequestPromise=null;k.tilemapRequestAbort=null;u.throwIfAborted(d);var b=e._layerIndexByLayerViewId[c].get(f.uid);if(null!=b){if(h.hasDataAvailable(a,b,c))return e._requestTileData(a,b,c,f,d);e._dispatchDataEvent(a,"dataMissing",c,f,{notInTilemap:!0});return u.reject()}})}return this._requestTileData(a,b,c,f,d)};c.prototype._requestTileData=
function(a,b,c,d,e){return 0===c?this._requestElevationTileData(a,b,c,d,e):this._requestMapTileData(a,c,d,e)};c.prototype._requestElevationTileData=function(a,b,c,d,e){var f=this;if(ea.isElevationLayerView(d)){var g=function(e){--f._asyncWorkItems;var g=f._layerIndexByLayerViewId[c].get(d.uid);null==g?ya.warn("TerrainSurface: received data from unknown layer %d %s",c,a.lij.toString()):(f._usedMemory=H,f._pendingUpdates=!0,a.layerInfo[c][g].data=T.create(a.lij,a.extent,e),f._elevationDataUpdated(a,
b))},h=function(b){--f._asyncWorkItems;u.isAbortError(b)||f._dispatchDataEvent(a,"dataMissing",c,d,b)};++this._asyncWorkItems;if(ea.useFetchTileForLayer(d.layer))return d.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],{noDataValue:da.ELEVATION_NODATA_VALUE,signal:e.signal}).then(function(a){return g(a)},h);var k=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);return this._streamDataRequester.request(k,"binary",e).then(function(a){return f._lercWorker.decode(a,{noDataValue:da.ELEVATION_NODATA_VALUE},e.signal)}).then(function(a){g({values:a.pixelData,
width:a.width,height:a.height,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue})}).catch(function(a){return h(a)})}ea.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};c.prototype._requestMapTileData=function(a,b,c,e){var f=this;++this._asyncWorkItems;var g=function(d){--f._asyncWorkItems;f._dispatchDataEvent(a,"dataArrived",b,c,d)},h=function(d){--f._asyncWorkItems;u.isAbortError(d)||f._dispatchDataEvent(a,"dataMissing",b,c,d)};if(ea.isVectorTileLayerView(c)){var k=
c.tileHandler,m=c.schemaHelper.getLevelRowColumn(a.lij);return d.safeCast(k.getVectorTile(m[0],m[1],m[2])).then(function(a){u.isAborted(e)?--f._asyncWorkItems:g(a)},h)}if(ea.useFetchTileForLayer(c.layer)&&ea.isTileLayerView(c))return c.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],e).then(g,h);k=c.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);null!=c.refreshInterval&&c.refreshTimestamp&&(k+=(-1<k.indexOf("?")?"\x26":"?")+"_ts\x3d"+c.refreshTimestamp);return this._streamDataRequester.request(k,"image",e).then(g,
h)};c.prototype.requestTilemap=function(a,b,c,d,e,f){var g=this;return e.tilemapCache.fetchTilemap(a.lij[0]+J.TILEMAP_SIZE_EXP,Math.round(a.lij[1]*Math.pow(2,J.TILEMAP_SIZE_EXP)),Math.round(a.lij[2]*Math.pow(2,J.TILEMAP_SIZE_EXP)),l({},f,{timeout:6E3})).then(function(e){b=g._layerIndexByLayerViewId[c].get(d.uid);null!=b&&(a.layerInfo[c][b].tilemap=e)}).catch(function(a){})};c.prototype.getTilemapTile=function(a){var b=a.level;if(b>J.TILEMAP_SIZE_EXP)return oa.getTileNLevelsUp(a,J.TILEMAP_SIZE_EXP);
var c=this._topLevelTilemapOnlyTiles[b];if(t.isSome(c))return c;a=oa.getRootTile(a);c=J.TILEMAP_SIZE_EXP-b+a.level;c=new ka([b-J.TILEMAP_SIZE_EXP,a.lij[1]/Math.pow(2,c),a.lij[2]/Math.pow(2,c)],this._upsampleInfoPool,[this._layerViews[0].length,this._layerViews[1].length]);return this._topLevelTilemapOnlyTiles[b]=c};c.prototype._dispatchDataEvent=function(a,b,c,d,e){d=this._layerIndexByLayerViewId[c].get(d.uid);if(null!=d)a[b](d,c,e);else ya.warn("TerrainSurface: received data from unknown layer")};
c.prototype.updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();b.renderData&&this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(b,b.renderData,this._overlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};c.prototype.updateOverlayOpacity=function(){if(this.overlayManager){var a=this.overlayManager.updateOpacity(this._eyePosSurfaceSR[2]);if(!isNaN(a)&&a!==this._overlayOpacity){var b=
this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.renderData&&(c.renderData.overlayOpacity=a)}this._iteratorPool.release(b);this._overlayOpacity=a;this._renderer.setNeedsRender()}}};c.prototype.getStats=function(){var a={numNodes:0,numLeaves:0,numVisible:0,numRendered:0,numVisiblePerLevel:[],numLoadedPerLevel:[]},b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var c=b.next();a.numNodes++;c.isLeaf&&a.numLeaves++;var d=c.level;c.rendered&&(a.numRendered++,
a.numLoadedPerLevel[d]=(a.numLoadedPerLevel[d]||0)+1);c.visible&&(a.numVisible++,a.numVisiblePerLevel[d]=(a.numVisiblePerLevel[d]||0)+1)}this._iteratorPool.release(b);return a};c.prototype.getUsedMemory=function(){if(!this.tilingScheme)return 0;if(this._usedMemory===H){var a=this._iteratorPool.acquire();a.reset(this.rootTiles);for(this._usedMemory=0;!a.done;){var b=a.next();this._usedMemory+=b.usedMemory}this._iteratorPool.release(a)}return this._usedMemory};c.prototype.getMemoryUsage=function(){if(!this.tilingScheme)return{};
var a=0,b=0,c=0,d=this._iteratorPool.acquire();d.reset(this.rootTiles);for(var e=this.tilingScheme.pixelSize,e=e*e*4;!d.done;){for(var f=d.next(),g=Ca(f),h=0,k=f.layerInfo[1];h<k.length;h++){var m=k[h],m=m.data,p=0,q=0;m instanceof ia?p+=na.getGpuMemoryUsage(m):m instanceof HTMLImageElement?q+=e:m instanceof N&&(c+=m.getMemoryUsage());f.renderData||g?(a+=q,a+=p):(b+=q,b+=p)}g=0;for(h=f.layerInfo[0];g<h.length;g++)m=h[g],m=m.data,a+=m?e:0;f.renderData&&(m=f.renderData.textureDescriptor,a+=m?na.getGpuMemoryUsage(m):
0,f=f.renderData.estimatedGeometryMemoryUsage,c+=f,c+=f)}this._iteratorPool.release(d);return{visibleImageData:a,invisibleImageData:b,geometryData:c}};c.prototype.getTile=function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return e.find(this.rootTiles,function(a){return a.lij[1]===b[1]&&a.lij[2]===b[2]});var c=Math.pow(2,b[0]),d=Math.floor(b[1]/c),f=Math.floor(b[2]/c),g;this.rootTiles.some(function(a){return a.lij[1]===d&&a.lij[2]===f?(g=a,!0):!1});if(g){for(c=1<<b[0]-1;g.lij[0]<
b[0];){var h=b[1]&c?2:0;0<(b[2]&c)&&h++;if(!g.children[h])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+oa.tile2str(g)),null;g=g.children[h];c>>=1}ea.weakAssert(g.lij[0]===b[0]&&g.lij[1]===b[1]&&g.lij[2]===b[2],"not the right tile?");return g}return null};c.prototype.setBorders=function(a){this._renderer.renderPatchBorders=a};c.prototype.setDisableRendering=function(a){this._renderer.renderingDisabled=a};c.prototype.getRenderedTiles=function(){ga.clear();var a=this._iteratorPool.acquire();
for(a.reset(this.rootTiles);!a.done;){var b=a.next();b.visible&&b.rendered&&ga.push(b)}this._iteratorPool.release(a);oa.sortTiles(this.renderOrder,ga);return ga.toArray()};Object.defineProperty(c.prototype,"test",{get:function(){var a=this;return{renderer:this._renderer,lercWorker:this._lercWorker,mergeTile:function(b){return a._mergeTile(b)},updateTiles:function(b){return a._updateTiles(b)}}},enumerable:!0,configurable:!0});h([v.property()],c.prototype,"_renderer",void 0);h([v.property({value:!1})],
c.prototype,"cullBackFaces",null);h([v.property({readOnly:!0})],c.prototype,"extent",null);h([v.property({readOnly:!0,dependsOn:["ready","_renderer.updating","_scheduledLayerViewChangesHandle"]})],c.prototype,"updating",null);h([v.property({value:1})],c.prototype,"baseOpacity",null);h([v.property({readOnly:!0})],c.prototype,"overlayManager",void 0);h([v.property({readOnly:!0})],c.prototype,"manifold",void 0);h([v.property()],c.prototype,"maxTextureScale",void 0);h([v.property({readOnly:!0})],c.prototype,
"ready",null);h([v.property({value:1})],c.prototype,"renderOrder",null);h([v.property({readOnly:!0})],c.prototype,"rootTiles",void 0);h([v.property({value:!0})],c.prototype,"skirtScale",null);h([v.property({readOnly:!0,dependsOn:["tilingScheme.spatialReference"]})],c.prototype,"spatialReference",null);h([v.property({})],c.prototype,"backgroundImage",void 0);h([v.property({type:a})],c.prototype,"backgroundColor",void 0);h([v.property({dependsOn:["backgroundColor","backgroundImage"]})],c.prototype,
"_background",null);h([v.property({value:!1})],c.prototype,"slicePlaneEnabled",null);h([v.property({readOnly:!0})],c.prototype,"tilingScheme",void 0);h([v.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],c.prototype,"tilingSchemeLocked",void 0);h([v.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],c.prototype,"tilingSchemeDone",void 0);h([v.property({readOnly:!0})],c.prototype,"tilingSchemeLogic",void 0);h([v.property({value:!0})],c.prototype,"velvetOverground",
null);h([v.property({value:!1})],c.prototype,"wireframe",null);h([v.property({value:!1})],c.prototype,"suspended",null);h([v.property()],c.prototype,"_scheduledLayerViewChangesHandle",void 0);return c=h([v.subclass("esri.views.3d.terrain.TerrainSurface")],c)}(v.declared(c.EventedMixin(g)));var G=1.2,Ea=80/180*Math.PI,za=110/180*Math.PI,H=-1,qa=K.vec4f64.create(),sa=I.create(),W=[0,0,0],ga=new w,Pa={spatialReference:null,tile:null,extent:null,context:"ground"},Ra={spatialReference:null,extent:null,
scale:0};return b})},"esri/layers/support/LercWorker":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/extendsHelper ../../core/promiseUtils ../../core/requireUtils ../../core/workers module".split(" "),function(n,b,l,k,h,a,g,e){function d(){return h.create(function(a){return n(["./rasterFormats/LercCodec"],a)})}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(){}a.prototype._decode=function(a){return d().then(function(b){b=b.decode;
b=b(a.buffer,a.options);return{result:b,transferList:[b.pixelData.buffer]}})};return a}(),c=function(b){function c(c){var d=b.call(this)||this;d.scheduler=c;d._threadInitialized=h.create(function(b,f){g.open(a.getAbsMid("./LercWorker",n,e),{strategy:"dedicated",scheduler:c}).then(function(a){void 0===d._thread?(d._thread=a,b()):(a.close(),f())})});return d}k(c,b);c.prototype.destroy=function(){this._thread&&this._thread.close();this._thread=null};Object.defineProperty(c.prototype,"test",{get:function(){return{threadInitialized:this._threadInitialized}},
enumerable:!0,configurable:!0});c.prototype.decode=function(a,b,c){return a&&0!==a.byteLength?this._thread?this._thread.invoke("_decode",{buffer:a,options:b},{transferList:[a],signal:c}):d().then(function(d){d=d.decode;h.throwIfAborted(c);return d(a,b)}):h.resolve(null)};return c}(f);b.LercWorkerMaster=c;var q=new Map;b.acquireInstance=function(a){var b=q.get(a);b||(b={instance:new c(a),ref:0},q.set(a,b));++b.ref;return b.instance};b.releaseInstance=function(a){if(null!=a){a=a.scheduler;var b=q.get(a);
b&&0>=--b.ref&&(b.instance.destroy(),q.delete(a))}};b.default=function(){return new f}})},"esri/views/2d/engine/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../geometry/support/spatialReferenceUtils ../../../webgl ../../engine ./RenderBucket".split(" "),function(n,b,l,k,h,a,g,e,d,f){var c="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ");
return function(b){function d(){for(var c,d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];e=b.call(this)||this;e._renderBuckets=[];e._vectorTileData=null;e._symbolUpdateData=null;e._memoryUsed=-1;e.coords=[0,0];e.bounds=[0,0,0,0];e.tileTransform={transform:h.mat4f32.create(),displayCoord:a.vec2f32.create()};e.stencilData={mask:0,reference:0};e._referenced=0;e.triangleCount=0;0<d.length&&(c=e.acquire).call.apply(c,[e].concat(d));return e}l(d,b);Object.defineProperty(d.prototype,"stencilRef",{get:function(){return this.stencilData.reference},
enumerable:!0,configurable:!0});d.prototype.acquire=function(a,b,c,d){this.key=a;this._referenced=1;this._memoryUsed=-1;this._vectorTileData=this._symbolUpdateData=null;var e=b.lodAt(a.level),e=null!==e?e.resolution:0,f=b.size[0]*e,h=b.origin,k=a.col*f,p=a.row*f,q=b.spatialReference,l=0;q&&(q._isWrappable?q._isWrappable():q.isWrappable)&&(q=g.getInfo(q),l=q.valid[1]-q.valid[0]);k=h.x+k+a.world*l;h=h.y-p;this.coords[0]=k;this.coords[1]=h;this.bounds[0]=k;this.bounds[1]=h;this.bounds[2]=k+f;this.bounds[3]=
h-f;this.widthInPixels=b.size[1];this.coordRange=4096;this.resolution=e;this.rotation=d;this.styleLayers=c;this.id=a.id};d.prototype.setData=function(a,b,c){this._vectorTileData=a;this.client=b;this.refKeys=c;this._memoryUsed=-1};d.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};d.prototype.updateTileData=function(a){this._vectorTileData=a;this.stage.requestRender();this._memoryUsed=-1};d.prototype.dispose=function(){for(var a=0,b="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" ");a<
b.length;a++){var c=b[a];this[c]&&(this[c].dispose(),this[c]=null)}this._renderBuckets.length=0;this._memoryUsed=-1};d.prototype.release=function(){return 0===--this._referenced?(this.dispose(),this.attached=!1,this.stage=null,!0):!1};d.prototype.reference=function(){++this._referenced};Object.defineProperty(d.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0});d.prototype.getMemoryUsage=function(){var a=this;-1===this._memoryUsed&&(this._memoryUsed=c.reduce(function(b,
c){return a[c]?b+a[c].size:b},0),this.texture&&(this._memoryUsed+=this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce(function(a,b){return a+b.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength));return this._memoryUsed/(this._referenced||1)};d.prototype.attach=function(){return this._vectorTileData?(this.ready(),!0):
!1};d.prototype.attachWithContext=function(a){this.stage={context:a};this.attached=this.attach()};d.prototype._commitChanges=function(){this._vectorTileData&&(this.dispose(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null,this._memoryUsed=-1)};d.prototype._createRenderBuckets=function(){for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,c=0;c<b;){var d=a[c];switch(a[c+1]){case 0:var e=new f.BackgroundRenderBucket;e.layerID=d;this._renderBuckets.push(e);
c+=2;break;case 1:e=new f.FillRenderBucket;e.layerID=d;e.triangleElementStart=a[c+2];e.triangleElementCount=a[c+3];e.outlineElementStart=a[c+4];e.outlineElementCount=a[c+5];this._renderBuckets.push(e);c+=6;break;case 2:e=new f.LineRenderBucket;e.layerID=d;e.triangleElementStart=a[c+2];e.triangleElementCount=a[c+3];this._renderBuckets.push(e);c+=4;break;case 3:e=new f.SymbolRenderBucket;e.layerID=d;e.isSDF=0!==a[c+2];var g=c+3,d=a[g];g++;for(var h=0;h<d;h++){var k=a[g],p=a[g+1],q=a[g+2];e.markerPerPageElementsMap.set(k,
[p,q]);g+=3}var l=a[g];g++;for(h=0;h<l;h++)k=a[g],p=a[g+1],q=a[g+2],e.glyphPerPageElementsMap.set(k,[p,q]),g+=3;this._renderBuckets.push(e);c+=5+3*d+3*l;break;case 4:e=new f.CircleRenderBucket;e.layerID=d;e.triangleElementStart=a[c+2];e.triangleElementCount=a[c+3];this._renderBuckets.push(e);c+=4;break;default:console.error("Bad bucket type!"),c+=2}}};d._createBufferToObject=function(){var a=[];a[1]={create:e.BufferObject.createVertex,var:"fillVertexBuffer"};a[2]={create:e.BufferObject.createVertex,
var:"fillDDVertexBuffer"};a[3]={create:e.BufferObject.createIndex,var:"fillIndexBuffer"};a[4]={create:e.BufferObject.createVertex,var:"outlineVertexBuffer"};a[5]={create:e.BufferObject.createVertex,var:"outlineDDVertexBuffer"};a[6]={create:e.BufferObject.createIndex,var:"outlineIndexBuffer"};a[7]={create:e.BufferObject.createVertex,var:"lineVertexBuffer"};a[8]={create:e.BufferObject.createVertex,var:"lineDDVertexBuffer"};a[9]={create:e.BufferObject.createIndex,var:"lineIndexBuffer"};a[10]={create:e.BufferObject.createVertex,
var:"iconVertexBuffer"};a[11]={create:e.BufferObject.createVertex,var:"iconDDVertexBuffer"};a[12]={create:e.BufferObject.createIndex,var:"iconIndexBuffer"};a[13]={create:e.BufferObject.createVertex,var:"textVertexBuffer"};a[14]={create:e.BufferObject.createVertex,var:"textDDVertexBuffer"};a[15]={create:e.BufferObject.createIndex,var:"textIndexBuffer"};a[16]={create:e.BufferObject.createVertex,var:"circleVertexBuffer"};a[17]={create:e.BufferObject.createIndex,var:"circleIndexBuffer"};return a};d.prototype._createBufferObjects=
function(){for(var a=this.stage.context,b=new Uint32Array(this._vectorTileData.bufferDataInfo),c=b.length,e=0;e<c;e+=2){var f=e/2;if(!(0>=b[e+1]||0===this._vectorTileData.bufferData[f].byteLength)){var g=b[e],h=d.bufferToObject[g];h?this[h.var]?this[h.var].setData(this._vectorTileData.bufferData[f]):this[h.var]=h.create(a,35044,this._vectorTileData.bufferData[f]):console.error("Bad buffer type "+g)}}};d.prototype.detach=function(){this.isReady&&this.client&&this.client.invoke("destructTileData",this.id);
this.dispose();b.prototype.detach.call(this)};d.prototype.doRender=function(a){if(this.visible&&this.isReady){var b=this.stage.context,c=a.renderer;if(b&&c){this._commitChanges();var d=a.drawphase;this._symbolUpdateData&&(this._updateSymbolData(a,this._symbolUpdateData),this._symbolUpdateData=null);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var e=this.styleLayers,f=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==f){var g=this._renderBuckets.length;if(1===d)for(var h=
g-1;0<=h;h--){var k=this._renderBuckets[h],p=e.layers[k.layerID];if(!k||!p)break;1!==k.type&&0!==k.type||!k.hasData()||(this.triangleCount+=c.renderBucket(b,k,a.displayLevel,a.requiredLevel,d,this,p,f))}else for(h=0;h<g;h++){k=this._renderBuckets[h];p=e.layers[k.layerID];if(!k||!p)break;k.hasData()&&(this.triangleCount+=c.renderBucket(b,k,a.displayLevel,a.requiredLevel,d,this,p,f))}}}}};d.prototype._updateSymbolData=function(a,b){if(!b||!b.bucketDataInfo)return!0;a=new Uint32Array(b.bucketDataInfo);
var c=a.length;if(0===c)return!0;this._memoryUsed=-1;if(!this.isReady)return this.requestRender(),!1;for(var d=this.stage.context,g=new Uint32Array(b.bufferDataInfo),h=g.length,k=0,p=0;p<h;p+=2,k++)switch(g[p]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=e.BufferObject.createVertex(d,35044,b.bufferData[k]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=
e.BufferObject.createVertex(d,35044,b.bufferData[k]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=e.BufferObject.createIndex(d,35044,b.bufferData[k]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=e.BufferObject.createVertex(d,35044,b.bufferData[k]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=
e.BufferObject.createVertex(d,35044,b.bufferData[k]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=e.BufferObject.createIndex(d,35044,b.bufferData[k])}b=[];for(d=0;d<this._renderBuckets.length;d++)this._renderBuckets[d]instanceof f.SymbolRenderBucket||b.push(this._renderBuckets[d]);this._renderBuckets=b;for(d=0;d<c;){h=a[d];g=new f.SymbolRenderBucket;g.layerID=h;g.isSDF=0!==a[d+2];this.styleLayers.layers.length>g.layerID&&this.styleLayers.layers[g.layerID].type===
g.type&&b.push(g);var q=d+3,h=a[q];q++;for(k=0;k<h;k++){var p=a[q],l=a[q+1],r=a[q+2];g.markerPerPageElementsMap.set(p,[l,r]);q+=3}var t=a[q];q++;for(k=0;k<t;k++)p=a[q],l=a[q+1],r=a[q+2],g.glyphPerPageElementsMap.set(p,[l,r]),q+=3;d+=5+3*h+3*t}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),
this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};d.pool=new k(d);d.bufferToObject=d._createBufferToObject();return d}(d.DisplayObject)})},"esri/views/webgl":function(){define("require exports ./webgl/BufferObject ./webgl/enums ./webgl/FramebufferObject ./webgl/Program ./webgl/Renderbuffer ./webgl/RenderingContext ./webgl/ShaderCompiler ./webgl/Texture ./webgl/VertexArrayObject ./webgl/ProgramCache ./webgl/programUtils ./webgl/context-util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){Object.defineProperty(b,"__esModule",{value:!0});b.BufferObject=l;b.enums=k;b.FramebufferObject=h;b.Program=a;b.Renderbuffer=g;b.RenderingContext=e;b.ShaderCompiler=d;b.Texture=f;b.VertexArrayObject=c;b.ProgramCache=q.ProgramCache;b.createProgram=p.createProgram;b.glslifyDefineMap=p.glslifyDefineMap;b.createContextOrErrorHTML=r.createContextOrErrorHTML})},"esri/views/webgl/enums":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",
{value:!0});b.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ./enums ./InstanceCounter ./renderState ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(n,b,l,k,h,a,g,e){return function(){function b(b,c){var d=this;this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState=
{r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=
1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=g.default(b)?"webgl2":"webgl";this.gl=b;b instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=e.loadCapabilities(b,
c);b=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:b[0],y:b[1],width:b[2],height:b[3]};this._stateTracker=new a.StateTracker({setBlending:function(a){a?(d.setBlendingEnabled(!0),d.setBlendEquationSeparate(a.opRgb,a.opAlpha),d.setBlendFunctionSeparate(a.srcRgb,a.dstRgb,a.srcAlpha,a.dstAlpha),a=a.color,d.setBlendColor(a.r,a.g,a.b,a.a)):d.setBlendingEnabled(!1)},setCulling:function(a){a?(d.setFaceCullingEnabled(!0),d.setCullFace(a.face),d.setFrontFace(a.mode)):d.setFaceCullingEnabled(!1)},
setPolygonOffset:function(a){a?(d.setPolygonOffsetFillEnabled(!0),d.setPolygonOffset(a.factor,a.units)):d.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(a){a?(d.setDepthTestEnabled(!0),d.setDepthFunction(a.func)):d.setDepthTestEnabled(!1)},setStencilTest:function(a){if(a){d.setStencilTestEnabled(!0);var b=a.function;d.setStencilFunction(b.func,b.ref,b.mask);a=a.operation;d.setStencilOp(a.fail,a.zFail,a.zPass)}else d.setStencilTestEnabled(!1)},setDepthWrite:function(a){a?(d.setDepthWriteEnabled(!0),
d.setDepthRange(a.zNear,a.zFar)):d.setDepthWriteEnabled(!1)},setColorWrite:function(a){a?d.setColorMask(a.r,a.g,a.b,a.a):d.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(a){a?d.setStencilWriteMask(a.mask):d.setStencilWriteMask(0)}});this.enforceState()}Object.defineProperty(b.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"parameters",{get:function(){if(!this._parameters){var a=this.capabilities.textureFilterAnisotropic;
this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)}}return this._parameters},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);
this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};b.prototype.setPipelineState=function(a){this._stateTracker.setPipeline(a)};b.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a,this._stateTracker.invalidateBlending())};b.prototype.setBlendColor=function(a,b,d,e){if(a!==this._blendColorState.r||b!==this._blendColorState.g||d!==this._blendColorState.b||e!==this._blendColorState.a)this.gl.blendColor(a,
b,d,e),this._blendColorState.r=a,this._blendColorState.g=b,this._blendColorState.b=d,this._blendColorState.a=e,this._stateTracker.invalidateBlending()};b.prototype.setBlendFunction=function(a,b){if(a!==this._blendFunctionState.srcRGB||b!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,b),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=b,this._stateTracker.invalidateBlending()};b.prototype.setBlendFunctionSeparate=
function(a,b,d,e){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==d||this._blendFunctionState.dstRGB!==b||this._blendFunctionState.dstAlpha!==e)this.gl.blendFuncSeparate(a,b,d,e),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=d,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=e,this._stateTracker.invalidateBlending()};b.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=
a,this._blendEquationState.modeAlpha=a,this._stateTracker.invalidateBlending())};b.prototype.setBlendEquationSeparate=function(a,b){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==b)this.gl.blendEquationSeparate(a,b),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=b,this._stateTracker.invalidateBlending()};b.prototype.setColorMask=function(a,b,d,e){if(this._colorMaskState.r!==a||this._colorMaskState.g!==b||this._colorMaskState.b!==d||this._colorMaskState.a!==
e)this.gl.colorMask(a,b,d,e),this._colorMaskState.r=a,this._colorMaskState.g=b,this._colorMaskState.b=d,this._colorMaskState.a=e,this._stateTracker.invalidateColorWrite()};b.prototype.setClearColor=function(a,b,d,e){if(this._clearColor.r!==a||this._clearColor.g!==b||this._clearColor.b!==d||this._clearColor.a!==e)this.gl.clearColor(a,b,d,e),this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=d,this._clearColor.a=e};b.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==
a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a,this._stateTracker.invalidateCulling())};b.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=a,this._stateTracker.invalidatePolygonOffset())};b.prototype.setPolygonOffset=function(a,b){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==
b)this._polygonOffset[0]=a,this._polygonOffset[1]=b,this.gl.polygonOffset(a,b),this._stateTracker.invalidatePolygonOffset()};b.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a,this._stateTracker.invalidateCulling())};b.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a,this._stateTracker.invalidateCulling())};b.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):
this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};b.prototype.setScissorRect=function(a,b,d,e){if(this._scissorRect.x!==a||this._scissorRect.y!==b||this._scissorRect.width!==d||this._scissorRect.height!==e)this.gl.scissor(a,b,d,e),this._scissorRect.x=a,this._scissorRect.y=b,this._scissorRect.width=d,this._scissorRect.height=e};b.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=
a,this._stateTracker.invalidateDepthTest())};b.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};b.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a,this._stateTracker.invalidateDepthTest())};b.prototype.setDepthWriteEnabled=function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a,this._stateTracker.invalidateDepthWrite())};b.prototype.setDepthRange=function(a,
b){if(this._depthRange.zNear!==a||this._depthRange.zFar!==b)this.gl.depthRange(a,b),this._depthRange.zNear=a,this._depthRange.zFar=b,this._stateTracker.invalidateDepthWrite()};b.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a,this._stateTracker.invalidateStencilTest())};b.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=
a)};b.prototype.setStencilFunction=function(a,b,d){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==b||this._stencilFunction.mask!==d)this.gl.stencilFunc(a,b,d),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=b,this._stencilFunction.mask=d,this._stateTracker.invalidateStencilTest()};b.prototype.setStencilFunctionSeparate=function(a,b,d,e){if(this._stencilFunction.face!==a||this._stencilFunction.func!==b||this._stencilFunction.ref!==d||this._stencilFunction.mask!==
e)this.gl.stencilFuncSeparate(a,b,d,e),this._stencilFunction.face=a,this._stencilFunction.func=b,this._stencilFunction.ref=d,this._stencilFunction.mask=e,this._stateTracker.invalidateStencilTest()};b.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=a,this._stateTracker.invalidateStencilWrite())};b.prototype.setStencilOp=function(a,b,d){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==
d)this.gl.stencilOp(a,b,d),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=b,this._stencilOperation.zPass=d,this._stateTracker.invalidateStencilTest()};b.prototype.setStencilOpSeparate=function(a,b,d,e){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==b||this._stencilOperation.zFail!==d||this._stencilOperation.zPass!==e)this.gl.stencilOpSeparate(a,b,d,e),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=
b,this._stencilOperation.zFail=d,this._stencilOperation.zPass=e,this._stateTracker.invalidateStencilTest()};b.prototype.setActiveTexture=function(a){var b=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(k.BASE_TEXTURE_UNIT+a),this._activeTextureUnit=a);return b};b.prototype.clear=function(a){a&&this.gl.clear(a)};b.prototype.clearSafe=function(a){a&&(a&16384&&this.setColorMask(!0,!0,!0,!0),a&256&&this.setDepthWriteEnabled(!0),a&1024&&this.setStencilWriteMask(255),
this.gl.clear(a))};b.prototype.drawArrays=function(a,b,d){this.gl.drawArrays(a,b,d)};b.prototype.drawElements=function(a,b,d,e){5123===d?this.gl.drawElements(a,b,d,e):5125===d&&this.gl.drawElements(a,b,d,e)};b.prototype.logIno=function(){};Object.defineProperty(b.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});b.prototype.setViewport=function(a,b,d,e){var c=this._viewport;if(c.x!==a||c.y!==b||c.width!==d||c.height!==e)c.x=a,c.y=b,c.width=d,c.height=
e,this.gl.viewport(a,b,d,e)};b.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};b.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};b.prototype.bindTexture=function(a,c){void 0===c&&(c=0);-1===b._MAX_TEXTURE_IMAGE_UNITS&&(b._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));
(c>=b._MAX_TEXTURE_IMAGE_UNITS||0>c)&&console.error("Input texture unit is out of range of available units!");var d=this._textureUnitMap[c];this.setActiveTexture(c);null==a||null==a.glName?(null!=d&&(this.gl.bindTexture(d.descriptor.target,null),d.setBoundToUnit(c,!1)),this._textureUnitMap[c]=null):d&&d.id===a.id?a.applyChanges():(d&&d.setBoundToUnit(c,!1),this.gl.bindTexture(a.descriptor.target,a.glName),a.setBoundToUnit(c,!0),a.applyChanges(),this._textureUnitMap[c]=a)};b.prototype.bindFramebuffer=
function(a){a?this._activeFramebuffer!==a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};b.prototype.bindBuffer=function(a){a&&(34962===a.bufferType?this._activeVertexBuffer=b._bindBuffer(this.gl,a,a.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=b._bindBuffer(this.gl,a,a.bufferType,this._activeIndexBuffer))};b.prototype.bindRenderbuffer=function(a){var b=
this.gl;a||(b.bindRenderbuffer(b.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(b.bindRenderbuffer(b.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};b.prototype.unbindBuffer=function(a){34962===a?this._activeVertexBuffer=b._bindBuffer(this.gl,null,a,this._activeVertexBuffer):this._activeIndexBuffer=b._bindBuffer(this.gl,null,a,this._activeIndexBuffer)};b.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),
this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};b.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};b.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};b.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};b.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);
for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,
1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};b.prototype.enforceState=function(){var a=this.gl,b=this.capabilities.vao;b&&b.bindVertexArray(null);for(var d=0;d<this.parameters.maxVertexAttributes;d++)a.disableVertexAttribArray(d);
this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(b&&this._activeVertexArrayObject){if(b=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(b)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:
null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);a.bindRenderbuffer(a.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,
this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?
a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);a.lineWidth(1);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?a.enable(a.SCISSOR_TEST):
a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(b=0;b<this.parameters.maxTextureImageUnits;b++)a.activeTexture(k.BASE_TEXTURE_UNIT+b),a.bindTexture(3553,null),(d=this._textureUnitMap[b])&&
a.bindTexture(d.descriptor.target,d.glName);a.activeTexture(k.BASE_TEXTURE_UNIT+this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};b._bindBuffer=function(a,b,d,e){if(!b)return a.bindBuffer(d,null),null;if(e===b)return e;a.bindBuffer(d,b.glName);return b};b._MAX_TEXTURE_IMAGE_UNITS=-1;return b}()})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(n,b){return function(){function b(){this._instanceCount=
{textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}b.prototype.incrementCount=function(b){switch(b){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}};b.prototype.decrementCount=function(b){switch(b){case 0:this._instanceCount.textureCount--;
break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}};b.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._instanceCount.textureCount);console.log("Buffers: "+this._instanceCount.bufferCount);console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+
this._instanceCount.programCount);console.log("Framebuffers: "+this._instanceCount.framebufferCount);console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)};return b}()})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./LoseContext ./VertexArrayObjects".split(" "),function(n,b,l,k,h,a,g){function e(a,b,c,e,g){if(e&&h.default(a))return!0;if(b[c])return!1;for(b=0;b<g.length;b++)if(a.getExtension(g[b]))return!0;
return!1}Object.defineProperty(b,"__esModule",{value:!0});b.loadCapabilities=function(b,f){var c=f&&f.disabledExtensions||{},d=f&&f.debugWebGLExtensions||{},p,r,t,x,w,u,y,m,v,z=null,n=null,C=null,D=null;return{get instancing(){p||(p=k.load(b));return p},get vao(){r||(r=g.load(b,c));return r},get compressedTextureS3TC(){if(!t)if(c.compressedTextureS3TC)t=null;else{var a=b.getExtension("WEBGL_compressed_texture_s3tc");t=a?{COMPRESSED_RGB_S3TC_DXT1:a.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:a.COMPRESSED_RGBA_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT3:a.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:a.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}return t},get textureFilterAnisotropic(){if(!x)if(c.textureFilterAnisotropic)x=null;else{var a=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");x=a?{MAX_TEXTURE_MAX_ANISOTROPY:a.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:a.TEXTURE_MAX_ANISOTROPY_EXT}:null}return x},
get disjointTimerQuery(){w||(w=l.load(b,c));return w},get textureFloat(){if(!u)if(h.default(b))u={textureFloat:!0,textureFloatLinear:!c.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!c.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:b.HALF_FLOAT};else if(b instanceof WebGLRenderingContext){var a=!c.textureHalfFloat&&b.getExtension("OES_texture_half_float");u={textureFloat:!c.textureFloat&&!!b.getExtension("OES_texture_float"),
textureFloatLinear:!c.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!!a,textureHalfFloatLinear:!c.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:a?a.HALF_FLOAT_OES:void 0}}else u=null;return u},get colorBufferFloat(){if(!y)if(h.default(b)){var a=!c.colorBufferFloat&&b.getExtension("EXT_color_buffer_half_float"),d=!c.colorBufferFloat&&b.getExtension("EXT_color_buffer_float");y=a||d?{textureFloat:!!d,textureHalfFloat:!!a,R16F:b.R16F,
RG16F:b.RG16F,RGBA16F:b.RGBA16F,R32F:b.R32F,RG32F:b.RG32F,RGBA32F:b.RGBA32F,R11F_G11F_B10F:b.R11F_G11F_B10F,RGB16F:b.RGB16F}:null}else b instanceof WebGLRenderingContext?(a=!c.colorBufferFloat&&b.getExtension("EXT_color_buffer_half_float"),d=!c.colorBufferFloat&&b.getExtension("WEBGL_color_buffer_float"),y=a||d?{textureFloat:!!d,textureHalfFloat:!!a,RGBA16F:a?a.RGBA16F_EXT:void 0,RGB16F:a?a.RGB16F_EXT:void 0,RGBA32F:d?d.RGBA32F_EXT:void 0}:null):y=null;return y},get blendMinMax(){if(!m)if(h.default(b))m=
{MIN:b.MIN,MAX:b.MAX};else if(c.blendMinMax)m=null;else{var a=b.getExtension("EXT_blend_minmax");m=a?{MIN:a.MIN_EXT,MAX:a.MAX_EXT}:null}return m},get depthTexture(){null===z&&(z=e(b,c,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return z},get standardDerivatives(){null===n&&(n=e(b,c,"standardDerivatives",!0,["OES_standard_derivatives"]));return n},get shaderTextureLOD(){null===C&&(C=e(b,c,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return C},
get fragDepth(){null===D&&(D=e(b,c,"fragDepth",!0,["EXT_frag_depth"]));return D},get loseContext(){v||(v=a.load(b,d));return v}}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,h){if(h.disjointTimerQuery)return null;var a=b.getExtension("EXT_disjoint_timer_query")||b.getExtension("EXT_disjoint_timer_query_webgl2");return a?l.default(b)?{createQuery:function(){return b.createQuery()},
resultAvailable:function(a){return b.getQueryParameter(a,b.QUERY_RESULT_AVAILABLE)},getResult:function(a){return b.getQueryParameter(a,b.QUERY_RESULT)},disjoint:function(){return b.getParameter(a.GPU_DISJOINT_EXT)},beginTimeElapsed:function(g){return b.beginQuery(a.TIME_ELAPSED_EXT,g)},endTimeElapsed:function(){return b.endQuery(a.TIME_ELAPSED_EXT)},createTimestamp:function(b){return a.queryCounterEXT(b,a.TIMESTAMP_EXT)},timestampBits:function(){return b.getQuery(a.TIMESTAMP_EXT,a.QUERY_COUNTER_BITS_EXT)}}:
{createQuery:function(){return a.createQueryEXT()},resultAvailable:function(b){return a.getQueryObjectEXT(b,a.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(b){return a.getQueryObjectEXT(b,a.QUERY_RESULT_EXT)},disjoint:function(){return b.getParameter(a.GPU_DISJOINT_EXT)},beginTimeElapsed:function(b){return a.beginQueryEXT(a.TIME_ELAPSED_EXT,b)},endTimeElapsed:function(){return a.endQueryEXT(a.TIME_ELAPSED_EXT)},createTimestamp:function(b){return a.queryCounterEXT(b,a.TIMESTAMP_EXT)},timestampBits:function(){return a.getQueryEXT(a.TIMESTAMP_EXT,
a.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b){return l.default(b)?{drawArraysInstanced:b.drawArraysInstanced.bind(b),drawElementsInstanced:b.drawElementsInstanced.bind(b),vertexAttribDivisor:b.vertexAttribDivisor.bind(b)}:(b=b.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:b.drawArraysInstancedANGLE.bind(b),
drawElementsInstanced:b.drawElementsInstancedANGLE.bind(b),vertexAttribDivisor:b.vertexAttribDivisorANGLE.bind(b)}:null}})},"esri/views/webgl/capabilities/LoseContext":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,k){var h=k.loseContext&&b.getExtension("WEBGL_lose_context");return h?{loseRenderingContext:function(){return h.loseContext()}}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require",
"exports","./isWebGL2Context"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,h){return l.default(b)?{createVertexArray:b.createVertexArray.bind(b),deleteVertexArray:b.deleteVertexArray.bind(b),bindVertexArray:b.bindVertexArray.bind(b)}:h.vao?null:(b=b.getExtension("OES_vertex_array_object")||b.getExtension("MOZ_OES_vertex_array_object")||b.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:b.createVertexArrayOES.bind(b),deleteVertexArray:b.deleteVertexArrayOES.bind(b),
bindVertexArray:b.bindVertexArrayOES.bind(b)}:null}})},"esri/views/webgl/ProgramCache":function(){define(["require","exports","./programUtils"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._programCacheByTemplate=new Map;this._rctx=b}b.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(b){b.programs.forEach(function(a){a.dispose()})});this._programCacheByTemplate=null};b.prototype.getProgram=function(b,a){var g=this;this._programCacheByTemplate.has(b)||
this.addProgramTemplate(b,function(a){return l.createProgram(g._rctx,b,a)});return this.getProgramTemplateInstance(b,a)};b.prototype.addProgramTemplate=function(b,a){this._programCacheByTemplate.set(b,{constructor:a,programs:new Map})};b.prototype.getProgramTemplateInstance=function(b,a){if(b=this._programCacheByTemplate.get(b)){var g=a?JSON.stringify(a):"default";b.programs.has(g)||(a=b.constructor(a),b.programs.set(g,a));return b.programs.get(g)}return null};return b}();b.ProgramCache=n})},"esri/views/2d/engine":function(){define("require exports ./engine/Bitmap ./engine/BitmapContainer ./engine/BitmapTile ./engine/Container ./engine/webgl/TileContainer ./engine/DisplayObject ./engine/Stage ./engine/webgl/AttributeStoreView ./engine/webgl/collisions/CollisionGrid ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter ./engine/webgl/Geometry ./engine/webgl/alignmentUtils ./engine/webgl/color ./engine/webgl/definitions ./engine/webgl/enums ./engine/webgl/fontUtils ./engine/webgl/Utils ./engine/webgl/brushes/BrushBitmap ./engine/webgl/brushes/BrushClip ./engine/webgl/brushes/WGLBrushStencil ./engine/webgl/brushes/WGLGeometryBrush ./engine/webgl/brushes/WGLGeometryBrushFill ./engine/webgl/brushes/WGLGeometryBrushLabel ./engine/webgl/brushes/WGLGeometryBrushLine ./engine/webgl/brushes/WGLGeometryBrushMarker ./engine/webgl/brushes/WGLGeometryBrushText ./engine/webgl/util/debug ./engine/webgl/TileClipper ./engine/webgl/TurboLine ./engine/webgl/mesh/factories/matcherUtils ./engine/webgl/mesh/factories/WGLMeshFactory ./engine/webgl/mesh/MeshData ./engine/webgl/mesh/templates/WGLTemplateStore ./engine/webgl/Painter ./engine/webgl/TextShaping ./engine/webgl/TextShapingNew ./engine/webgl/TileData ./engine/webgl/util/BidiText ./engine/webgl/util/Matcher ./engine/webgl/util/vvFlagUtils ./engine/webgl/visualVariablesUtils ./engine/webgl/WGLRendererInfo ./engine/webgl/WGLTile ./engine/webgl/BitBlitRenderer ./engine/webgl/shaders/MagnifierPrograms ../../symbols/cim/CIMSymbolHelper ./engine/webgl/Rect ./engine/webgl/mesh/templates/util ./engine/webgl/painter/RenderPass ./engine/webgl/TiledDisplayObject ./engine/BitmapTileContainer".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T,U,Y,X,P,V,Z,ca,da,F,ea,la,ka,oa,va,fa,xa,ia,na,wa){Object.defineProperty(b,"__esModule",{value:!0});b.Bitmap=l.Bitmap;b.BitmapContainer=k.BitmapContainer;b.BitmapTile=h.BitmapTile;b.Container=a.Container;b.TileContainer=g.default;b.DisplayObject=e.DisplayObject;b.Stage=d.Stage;b.AttributeStoreView=f.AttributeStoreView;b.CollisionGrid=c.CollisionGrid;b.CollisionEngine=q.CollisionEngine;b.LayerViewSorter=p.LayerViewSorter;
b.Point=r.Point;b.alignmentUtils=t;b.color=x;b.definitions=w;b.enums=u;b.fontUtils=y;b.Utils=m;b.debug=N;b.TileClipper=L.TileClipper;b.SimpleBuilder=L.SimpleBuilder;b.tessellate=M.tessellate;b.TessellationState=M.TessellationState;b.splitVertex=M.splitVertex;b.createMatcher=R.createMatcher;b.WGLMeshFactory=S.WGLMeshFactory;b.MeshData=T.MeshData;b.WGLTemplateStore=U.WGLTemplateStore;b.Painter=Y.default;b.PainterOptions=Y.PainterOptions;b.TextShaping=X.TextShaping;b.TextShapingNew=P.TextShaping;b.TileData=
V.TileData;b.bidiText=Z.bidiText;b.FeatureMatcher=ca.FeatureMatcher;b.getVVFlags=da.getVVFlags;b.getTypeOfSizeVisualVariable=F.getTypeOfSizeVisualVariable;b.WGLRendererInfo=ea.WGLRendererInfo;b.WGLTile=la.WGLTile;b.BitBlitRenderer=ka.BitBlitRenderer;b.createMagnifierProgram=oa.createMagnifierProgram;b.magnifier=oa.magnifier;b.CIMSymbolHelper=va.CIMSymbolHelper;b.Rect=fa.default;b.getLimitCosine=xa.getLimitCosine;n=b.brushes||(b.brushes={});n.Geometry=C.default;n.Marker=Q.default;n.Line=I.default;
n.Fill=D.default;n.Text=J.default;n.Label=K.default;n.Clip=z.default;n.Stencil=B.default;n.Bitmap=v.default;b.RenderPass=ia.default;b.TiledDisplayObject=na.TiledDisplayObject;b.BitmapTileContainer=wa.BitmapTileContainer})},"esri/views/2d/engine/Bitmap":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/vec2f32 ../../webgl ./DisplayObject ./ImageryBitmapSource".split(" "),
function(n,b,l,k,h,a,g,e,d){function f(a){var b=document.createElement("canvas");b.width=a.width;b.height=a.height;a.render(b.getContext("2d"));return b}function c(a,b,c){var d={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};b&&c&&(d.width=b,d.height=c);return new g.Texture(a,d)}function q(a){r.has(a)&&(p.splice(p.indexOf(a),1),r.delete(a))}Object.defineProperty(b,"__esModule",{value:!0});var p=[],r=new Set;n=function(b){function e(a,c){void 0===a&&(a=null);void 0===
c&&(c=function(){return null});var d=b.call(this)||this;d.stencilRef=0;d.coordScale=[1,1];d._height=void 0;d.pixelRatio=1;d.resolution=0;d.rotation=0;d._source=null;d._width=void 0;d.x=0;d.y=0;d.transforms={dvs:h.mat3f32.create()};d.source=a;d.requestRender=c;return d}l(e,b);Object.defineProperty(e.prototype,"isSourceScaled",{get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"height",{get:function(){return void 0!==
this._height?this._height:this.sourceHeight},set:function(a){this._height=a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"source",{get:function(){return this._source},set:function(a){this._source=a;this.invalidateTexture()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"sourceHeight",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"sourceWidth",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"width",{get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(a){this._width=a},enumerable:!0,configurable:!0});e.prototype.attach=function(){this.updateTexture();return!0};e.prototype.detach=function(){this._texture.dispose();this._texture=null;q(this)};e.prototype.invalidateTexture=
function(){this.attached?this.updateTexture():q(this)};e.prototype.setTransform=function(b){var c=k.mat3.identity(this.transforms.dvs),d=b.toScreenNoRotation([0,0],this.x,this.y),e=this.resolution/this.pixelRatio/b.resolution,f=e*this.width,e=e*this.height,g=Math.PI*this.rotation/180;k.mat3.translate(c,c,a.vec2f32.fromValues(d[0],d[1]));k.mat3.translate(c,c,a.vec2f32.fromValues(f/2,e/2));k.mat3.rotate(c,c,-g);k.mat3.translate(c,c,a.vec2f32.fromValues(-f/2,-e/2));k.mat3.scaleByVec2(c,c,a.vec2f32.fromValues(f,
e));k.mat3.multiply(this.transforms.dvs,b.displayViewMat3,c)};e.prototype.updateTexture=function(){this._texture||(this._texture=this.source?c(this.stage.context,this.sourceWidth,this.sourceHeight):c(this.stage.context));var a=this.source;a?(this._texture.resize(this.sourceWidth,this.sourceHeight),a&&"render"in a?a instanceof d.default?(a=a.getRenderedRasterPixels(),this._texture.setData(a.renderedRasterPixels)):this._texture.setData(f(a)):!a||"render"in a||this._texture.setData(a),this.ready(),this.requestRender()):
this._texture.setData(null)};e.prototype.setSamplingProfile=function(a){this._texture&&(a.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(a.samplingMode))};e.prototype.bind=function(a){this._texture&&this.stage.context.bindTexture(this._texture,a)};return e}(e.DisplayObject);b.Bitmap=n})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/Evented"],function(n,b,l,
k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a._renderRequestedCalled=!1;a._attached=!1;a._isReady=!1;a._opacity=1;a.renderRequested=!1;a._visible=!0;return a}l(a,b);Object.defineProperty(a.prototype,"attached",{get:function(){return this._attached},set:function(a){this._attached!==a&&((this._attached=a)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"isReady",{get:function(){return this._attached&&this._isReady},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},enumerable:!0,
configurable:!0});a.prototype.attach=function(){this.ready();return!0};a.prototype.setTransform=function(a){};a.prototype.detach=function(){};a.prototype.processRender=function(a){this.visible&&this.attached&&(this._renderRequestedCalled=!1,this.doRender(a),this._renderRequestedCalled||(this.renderRequested=!1),this.hasEventListener("post-render")&&this.emit("post-render"))};a.prototype.requestRender=function(){var a=this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&
this.parent.requestChildRender(this);a!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};a.prototype.dispose=function(){};a.prototype.doRender=function(a){};a.prototype.ready=function(){this._isReady=!0;this.emit("isReady")};return a}(k);b.DisplayObject=n})},"esri/views/2d/engine/ImageryBitmapSource":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,h,a){this.pixelBlock=b;this.extent=
h;this.originalPixelBlock=a}Object.defineProperty(b.prototype,"width",{get:function(){return this.pixelBlock?this.pixelBlock.width:0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this.pixelBlock?this.pixelBlock.height:0},enumerable:!0,configurable:!0});b.prototype.render=function(b){if(this.pixelBlock){var h=this.filter({pixelBlock:this.pixelBlock}),a=h.pixelBlock.getAsRGBA(),h=b.createImageData(h.pixelBlock.width,h.pixelBlock.height);h.data.set(a);
b.putImageData(h,0,0)}};b.prototype.getRenderedRasterPixels=function(){var b=this.filter({pixelBlock:this.pixelBlock});return{width:b.pixelBlock.width,height:b.pixelBlock.height,renderedRasterPixels:new Uint8Array(b.pixelBlock.getAsRGBA().buffer)}};return b}();b.default=n})},"esri/views/2d/engine/BitmapContainer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../engine ./webgl/WGLContainer".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,
"__esModule",{value:!0});n=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.prototype.prepareRenderPasses=function(b){var d=this,c=b.registerRenderPass({name:"bitmap",brushes:[h.brushes.Bitmap],target:function(){return d.children}});return a.prototype.prepareRenderPasses.call(this,b).concat([c])};return b}(a.default);b.BitmapContainer=n})},"esri/views/2d/engine/webgl/WGLContainer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../engine ../Container ./ClippingInfo ./enums".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(a){var c=b.call(this)||this;c.name=c.constructor.name;c._lastTime=null;c.setClips(a);return c}l(c,b);c.prototype.setClips=function(a){var b=this;h.isSome(this._clippingInfos)&&(this._clippingInfos.forEach(function(a){return a.destroy()}),this._clippingInfos=null);h.isSome(a)&&a.length&&(this._clippingInfos=a.items.map(function(a){return e.default.fromClipArea(b,a)}));this.requestRender()};c.prototype.doRender=
function(a){this.attachChildren();this.detachChildren();var b=this.createRenderParams(a),c=b.context,e=b.painter,f=b.globalOpacity,g=b.profiler,f=b.drawPhase===d.WGLDrawPhase.LABEL?1:f*this.opacity;g.recordContainerStart(this.name);e.beforeRenderLayer(c,this._clippingInfos?255:0,f);this.updateTransforms(a.state);this.renderChildren(b);e.compositeLayer(c,f);g.recordContainerEnd(this.name)};c.prototype.renderChildren=function(a){h.isNone(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(this.stage.painter));
for(var b=0,c=this._renderPasses;b<c.length;b++)c[b].render(a)};c.prototype.createRenderParams=function(a){var b=Date.now(),c=(h.isSome(this._lastTime)?b-this._lastTime:0)/1E3;this._lastTime=b;return k({},a,{context:this.stage.context,painter:this.stage.painter,profiler:this.stage.profiler,renderingOptions:this.stage.renderingOptions,driverTestResult:this.stage.driverTestResult,timeDelta:c,timeline:this.stage.timeline})};c.prototype.prepareRenderPasses=function(b){var c=this;return[b.registerRenderPass({name:"clip",
brushes:[a.brushes.Clip],target:function(){return c._clippingInfos},drawPhase:d.WGLDrawPhase.MAP|d.WGLDrawPhase.LABEL|d.WGLDrawPhase.LABEL_ALPHA})]};c.prototype.updateTransforms=function(a){for(var b=0,c=this.children;b<c.length;b++)c[b].setTransform(a)};return c}(g.Container);b.default=n})},"esri/views/2d/engine/Container":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./DisplayObject"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function a(){var a=
null!==b&&b.apply(this,arguments)||this;a._childrenSet=new Set;a._childrenToAttach=[];a._childrenToDetach=[];a.children=[];return a}l(a,b);Object.defineProperty(a.prototype,"numChildren",{get:function(){return this.children.length},enumerable:!0,configurable:!0});a.prototype.detach=function(){for(var a=0,b=this.children.concat(this._childrenToDetach);a<b.length;a++){var d=b[a];d.attached&&(this.detachChild(d),d.attached=!1,d.parent=null)}};a.prototype.doRender=function(a){var b=a.globalOpacity;a.globalOpacity*=
this.opacity;this.attachChildren();this.detachChildren();this.renderChildren(a);a.globalOpacity=b};a.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)};a.prototype.addChildAt=function(a,b){void 0===b&&(b=this.numChildren);if(!a||this.contains(a))return a;var d=a.parent;d&&d!==this&&d.removeChild(a);b>=this.numChildren?this.children.push(a):this.children.splice(b,0,a);this._childrenSet.add(a);b=this._childrenToDetach.indexOf(a);-1<b&&this._childrenToDetach.splice(b,1);this._childrenToAttach.push(a);
this.requestRender();return a};a.prototype.contains=function(a){return this._childrenSet.has(a)};a.prototype.getChildIndex=function(a){return this.children.indexOf(a)};a.prototype.getChildAt=function(a){return 0>a||a>this.children.length?null:this.children[a]};a.prototype.removeAllChildren=function(){for(var a=this.numChildren;a--;)this.removeChildAt(0)};a.prototype.removeChild=function(a){return this.contains(a)?this.removeChildAt(this.getChildIndex(a)):a};a.prototype.removeChildAt=function(a){if(0>
a||a>=this.children.length)return null;a=this.children.splice(a,1)[0];this._childrenSet["delete"](a);if(a.attached)this._childrenToDetach.push(a);else{var b=this._childrenToAttach.indexOf(a);-1<b&&this._childrenToAttach.splice(b,1)}return a};a.prototype.requestChildRender=function(a){this.requestRender()};a.prototype.setChildIndex=function(a,b){var d=this.getChildIndex(a);-1<d&&(this.children.splice(d,1),this.children.splice(b,0,a))};a.prototype.sortChildren=function(a){return this.children.sort(a)};
a.prototype.attachChildren=function(){var a=this._childrenToAttach;if(0!==a.length)for(var b=0,d=!1;!d;)d=a[b],d.parent=this,d.stage=this.stage,this.attachChild(d)?(d.attached=!0,a.splice(b,1)):++b,d=a.length===b};a.prototype.detachChildren=function(){for(var a=this._childrenToDetach;0<a.length;){var b=a.shift();this.detachChild(b);b.attached=!1;b.parent=null;b.stage=null}};a.prototype.renderChildren=function(a){for(var b=this.children,d=b.length,f=0;f<d;f++)b[f].processRender(a)};a.prototype.attachChild=
function(a){return a.attach()};a.prototype.detachChild=function(a){a.detach()};return a}(k.DisplayObject);b.Container=n})},"esri/views/2d/engine/webgl/ClippingInfo":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../DisplayObject ./Mesh2D ../../../webgl/VertexArrayObject".split(" "),function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});var f=h.getLogger("esri.views.2d.engine.webgl.ClippingInfo");
n=function(b){function c(a,c){var d=b.call(this)||this;d._cache={};d.parent=a;d._handle=c.watch("version",function(){return d._invalidate()});d._clip=c;d.attach();d.attached=!0;return d}l(c,b);c.fromClipArea=function(a,b){return new c(a,b)};c.prototype._destroyGL=function(){a.isSome(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null);a.isSome(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)};c.prototype.destroy=function(){this._destroyGL();this._handle.remove()};
c.prototype.doRender=function(a){};c.prototype.getVAO=function(b,c,e,f){var g=c.size,h=g[0],g=g[1];if("geometry"===this._clip.type||this._lastWidth!==h||this._lastHeight!==g)this._lastWidth=h,this._lastHeight=g,this._destroyGL();a.isNone(this._cache.vao)&&(c=this._createMesh(c,this._clip),h=c.getIndexBuffer(b),g=c.getVertexBuffers(b),this._cache.mesh=c,this._cache.vao=new d(b,e,f,g,h));return this._cache.vao};c.prototype._invalidate=function(){this._destroyGL();this.requestRender()};c.prototype._createScreenRect=
function(a,b){var c=a.size;a=c[0];var c=c[1],d="string"===typeof b.left?parseFloat(b.left)/100*a:b.left,e="string"===typeof b.right?parseFloat(b.right)/100*a:b.right,f="string"===typeof b.top?parseFloat(b.top)/100*c:b.top;b="string"===typeof b.bottom?parseFloat(b.bottom)/100*c:b.bottom;return{x:d,y:f,width:Math.max(a-e-d,0),height:Math.max(c-b-f,0)}};c.prototype._createMesh=function(a,b){switch(b.type){case "rect":return e.default.fromRect(this._createScreenRect(a,b));case "path":return e.default.fromPath(b);
case "geometry":return e.default.fromGeometry(a,b);default:return f.error(new k("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),e.default.fromRect({x:0,y:0,width:1,height:1})}};return c}(g.DisplayObject);b.default=n})},"esri/views/2d/engine/webgl/Mesh2D":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./number ../../../webgl/BufferObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});var r=h.getLogger("esri.views.2d.engine.webgl.Mesh2D"),t=function(a,b){var c=a.coords;a=a.lengths;for(var d=[],e=0,f=0;e<a.length;f+=a[e],e+=1){for(var h=f,k=[];e<a.length-1;e+=1,f+=a[e]){for(var p=f+a[e],l=0,q=1;q<a[e+1];q++)l+=(c[2*(p+q)]-c[2*(p+q-1)])*(c[2*(p+q)+1]+c[2*(p+q-1)+1]);if(!(b?0<l:0>l))break;k.push(f+a[e]-h)}l=c.slice(2*h,2*(f+a[e]));p=0;for(k=g(l,k,2);p<k.length;p++)d.push(k[p]+h)}return d};n=function(){function b(a,
b,c,d){void 0===d&&(d=!1);this._cache={};this.vertices=a;this.indices=b;this.primitiveType=c;this.isMapSpace=d}b.fromRect=function(a){var c=a.x,d=a.y;return b.fromScreenExtent({xmin:c,ymin:d,xmax:c+a.width,ymax:d+a.height})};b.fromPath=function(a){var d=f.convertFromNestedArray(new c.default,a.path,!1,!1);a=d.coords;for(var d=new Uint32Array(t(d,!0)),e=new Uint32Array(a.length/2),g=0;g<e.length;g++)e[g]=q.i1616to32(Math.floor(a[2*g]),Math.floor(a[2*g+1]));return new b({geometry:e},d,4)};b.fromGeometry=
function(a,c){var d=c.geometry.type;switch(d){case "polygon":return b.fromPolygon(a,c.geometry);case "extent":return b.fromMapExtent(a,c.geometry);default:return r.error(new k("mapview-bad-type","Unable to create a mesh from type "+d,c)),b.fromRect({x:0,y:0,width:1,height:1})}};b.fromPolygon=function(a,g){var h=f.convertFromPolygon(new c.default,g,!1,!1);g=h.coords;for(var h=new Uint32Array(t(h,!1)),k=new Uint32Array(g.length/2),p=d.vec2f64.create(),l=d.vec2f64.create(),r=0;r<k.length;r++)e.vec2.set(p,
g[2*r],g[2*r+1]),a.toScreen(l,p),k[r]=q.i1616to32(Math.floor(l[0]),Math.floor(l[1]));return new b({geometry:k},h,4,!0)};b.fromScreenExtent=function(a){var c=a.xmin,d=a.xmax,e=a.ymin;a=a.ymax;c={geometry:new Uint32Array([q.i1616to32(c,e),q.i1616to32(d,e),q.i1616to32(c,a),q.i1616to32(c,a),q.i1616to32(d,e),q.i1616to32(d,a)])};d=new Uint32Array([0,1,2,3,4,5]);return new b(c,d,4)};b.fromMapExtent=function(a,c){var d=a.toScreen([0,0],[c.xmin,c.ymin]),e=d[0],d=d[1];c=a.toScreen([0,0],[c.xmax,c.ymax]);a=
c[0];c=c[1];e={geometry:new Uint32Array([q.i1616to32(e,d),q.i1616to32(a,d),q.i1616to32(e,c),q.i1616to32(e,c),q.i1616to32(a,d),q.i1616to32(a,c)])};d=new Uint32Array([0,1,2,3,4,5]);return new b(e,d,4)};b.prototype.destroy=function(){a.isSome(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(var b in this._cache.vertexBuffers)a.isSome(this._cache.vertexBuffers[b])&&this._cache.vertexBuffers[b].dispose()};Object.defineProperty(b.prototype,"elementType",{get:function(){var a;a:switch(this.indices.BYTES_PER_ELEMENT){case 1:a=
5121;break a;case 2:a=5123;break a;case 4:a=5125;break a;default:throw new k("Cannot get DataType of array");}return a},enumerable:!0,configurable:!0});b.prototype.getIndexBuffer=function(a,b){void 0===b&&(b=35044);this._cache.indexBuffer||(this._cache.indexBuffer=p.createIndex(a,b,this.indices));return this._cache.indexBuffer};b.prototype.getVertexBuffers=function(a,b){var c=this;void 0===b&&(b=35044);this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(function(d,
e){var f;return l({},d,(f={},f[e]=p.createVertex(a,b,c.vertices[e]),f))},{}));return this._cache.vertexBuffers};return b}();b.default=n})},"esri/views/2d/engine/webgl/number":function(){define(["require","exports"],function(n,b){function l(a,b,e){return Math.round(Math.max(Math.min(a,e),b))}Object.defineProperty(b,"__esModule",{value:!0});var k=new Float32Array(1),h=new Uint32Array(k.buffer);b.i8=function(a){return l(a,-128,127)};b.i16=function(a){return l(a,-32768,32767)};b.i32=function(a){return l(a,
-2147483648,2147483647)};b.u8=function(a){return l(a,0,255)};b.u16=function(a){return l(a,0,65535)};b.u32=function(a){return l(a,0,4294967295)};b.toUint32=function(a){k[0]=a;return h[0]};b.toFloat32=function(a){h[0]=a;return k[0]};b.i1616to32=function(a,b){return 65535&a|b<<16};b.i8888to32=function(a,b,e,d){return a&255|(b&255)<<8|(e&255)<<16|d<<24};b.i8816to32=function(a,b,e){return a&255|(b&255)<<8|e<<16};b.numTo32=function(a){return a|0}})},"esri/views/2d/engine/webgl/enums":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});(function(b){b[b.FILL=0]="FILL";b[b.LINE=1]="LINE";b[b.MARKER=2]="MARKER";b[b.TEXT=3]="TEXT";b[b.LABEL=4]="LABEL"})(b.WGLGeometryType||(b.WGLGeometryType={}));(function(b){b[b.SUCCEEDED=0]="SUCCEEDED";b[b.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"})(b.WGLGeometryTransactionStatus||(b.WGLGeometryTransactionStatus={}));(function(b){b[b.NONE=0]="NONE";b[b.MAP=1]="MAP";b[b.LABEL=2]="LABEL";b[b.LABEL_ALPHA=4]="LABEL_ALPHA";b[b.HITTEST=
8]="HITTEST";b[b.HIGHLIGHT=16]="HIGHLIGHT";b[b.CLIP=32]="CLIP";b[b.DEBUG=64]="DEBUG";b[b.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"})(b.WGLDrawPhase||(b.WGLDrawPhase={}));(function(b){b[b.SIZE=0]="SIZE";b[b.COLOR=1]="COLOR";b[b.OPACITY=2]="OPACITY";b[b.ROTATION=3]="ROTATION"})(b.VVType||(b.VVType={}));(function(b){b[b.NONE=0]="NONE";b[b.OPACITY=1]="OPACITY";b[b.COLOR=2]="COLOR";b[b.ROTATION=4]="ROTATION";b[b.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE";b[b.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS";b[b.SIZE_FIELD_STOPS=
32]="SIZE_FIELD_STOPS";b[b.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"})(b.WGLVVFlag||(b.WGLVVFlag={}));(function(b){b[b.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE";b[b.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE";b[b.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE";b[b.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(b.WGLVVTarget||(b.WGLVVTarget={}));(function(b){b[b.SPRITE=0]="SPRITE";b[b.GLYPH=1]="GLYPH"})(b.MosaicType||(b.MosaicType={}))})},"esri/views/2d/engine/BitmapTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Bitmap ./webgl/TiledDisplayObject".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,e,c,g){void 0===g&&(g=null);var d=a.call(this,b,e,c)||this;b=d.requestRender.bind(d);d.bitmap=new h.Bitmap(g,b);d.bitmap.coordScale=c;d.bitmap.once("isReady",function(){return d.ready()});return d}l(b,a);Object.defineProperty(b.prototype,"stencilRef",{get:function(){return this.bitmap.stencilRef},set:function(a){this.bitmap.stencilRef=a},enumerable:!0,configurable:!0});b.prototype.setTransform=function(b,
e){a.prototype.setTransform.call(this,b,e);this.bitmap.transforms.dvs=this.transforms.dvs};b.prototype.attach=function(){this.bitmap.stage=this.stage;var a=this.bitmap.attach();a&&(this.bitmap.attached=!0);return a};b.prototype.detach=function(){this.bitmap.detach()};return b}(a.TiledDisplayObject);b.BitmapTile=n})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ../DisplayObject ../../tiling/TileKey".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(c,d,f){var g=b.call(this)||this;g.transforms={dvs:a.mat3f32.create(),tileMat3:a.mat3f32.create()};g.key=e.pool.acquire(c);g.bounds=d;g.size=f;return g}l(d,b);d.prototype.destroy=function(){e.pool.release(this.key);this.texture&&this.texture.dispose()};Object.defineProperty(d.prototype,"coords",{get:function(){return this._coords},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"bounds",
{get:function(){return this._bounds},set:function(a){this._coords=[a[0],a[3]];this._bounds=a},enumerable:!0,configurable:!0});d.prototype.setTransform=function(a,b){b/=a.resolution*a.pixelRatio;var c=this.transforms.tileMat3,d=a.toScreenNoRotation([0,0],this.coords);h.mat3.set(this.transforms.tileMat3,b,0,0,0,b,0,d[0],d[1],1);h.mat3.multiply(this.transforms.dvs,a.displayViewMat3,c)};return d}(g.DisplayObject);b.TiledDisplayObject=n})},"esri/views/2d/engine/webgl/TileContainer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ./WGLContainer ./brushes/WGLBrushInfo ./brushes/WGLBrushStencil".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});var e=function(a,b){return 0!==a.key.level-b.key.level?a.key.level-b.key.level:0!==a.key.row-b.key.row?a.key.row-b.key.row:a.key.col-b.key.col};n=function(b){function d(a,d){d=b.call(this,d)||this;d._tileInfoView=a;return d}l(d,b);d.prototype.renderChildren=function(a){this.sortChildren(e);this._setStencilReference(this.children);b.prototype.renderChildren.call(this,a)};d.prototype.createRenderParams=function(a){var c=a.state;
return k({},b.prototype.createRenderParams.call(this,a),{requiredLevel:this._tileInfoView.getClosestInfoForScale(c.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(c.scale)})};d.prototype.prepareRenderPasses=function(c){var d=this,e=c.registerRenderPass({name:"stencil",brushes:[g.default],target:function(){return d.children}}),f=c.registerRenderPass({name:"tileInfo",brushes:[a.default],target:function(){return d.children},has:"esri-feature-tiles-debug"});return b.prototype.prepareRenderPasses.call(this,
c).concat([e,f])};d.prototype.updateTransforms=function(a){for(var b=0,c=this.children;b<c.length;b++){var d=c[b],e=this._tileInfoView.getTileResolution(d.key);d.setTransform(a,e)}};d.prototype._setStencilReference=function(a){a=1;for(var b=0,c=this.children;b<c.length;b++)c[b].stencilRef=a++};return d}(h.default);b.default=n})},"esri/views/2d/engine/webgl/brushes/WGLBrushInfo":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._initialized=!1;a._color=k.vec4f32.fromValues(1,0,0,1);a._maxWidth=0;return a}l(c,b);c.prototype.dispose=function(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),
this._outlineVertexArrayObject=null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null);this._canvas=null};c.prototype.prepareState=function(a,b){a=a.context;a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,b.stencilRef,255)};c.prototype.draw=function(a,b){a=a.context;if(b.isReady){this._initialized||this._initialize(a);
a.bindVAO(this._outlineVertexArrayObject);a.bindProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);this._outlineProgram.setUniform2f("u_coord_range",b.size[0],b.size[1]);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);a.drawArrays(3,0,4);a.bindVAO();var c=this._getTexture(a,b);c&&(a.bindVAO(this._tileInfoVertexArrayObject),a.bindProgram(this._tileInfoProgram),a.bindTexture(c,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",
b.transforms.dvs),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",1,1),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",c.descriptor.width,c.descriptor.height),a.drawArrays(5,0,4),a.bindVAO())}};c.prototype._initialize=function(a){if(this._initialized)return!0;var b=h.createProgram(a,e.background),c=h.createProgram(a,d.tileInfo),f={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,
divisor:0}]},g=new Int8Array([0,0,1,0,1,1,0,1]),g=h.BufferObject.createVertex(a,35044,g),g=new h.VertexArrayObject(a,e.background.attributes,f,{geometry:g}),k=new Int8Array([0,0,1,0,0,1,1,1]),k=h.BufferObject.createVertex(a,35044,k);a=new h.VertexArrayObject(a,d.tileInfo.attributes,f,{geometry:k});this._outlineProgram=b;this._tileInfoProgram=c;this._outlineVertexArrayObject=g;this._tileInfoVertexArrayObject=a;return this._initialized=!0};c.prototype._getTexture=function(b,c){if(c.texture)return c.texture;
this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","256"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var d=c.key.id,e=this._canvas.getContext("2d");e.font="24px sans-serif";e.textAlign="left";e.textBaseline="middle";var f=e.measureText(d),f=Math.pow(2,Math.ceil(a.log2(f.width+2)));f>this._maxWidth&&(this._maxWidth=f);e.clearRect(0,0,this._maxWidth,32);e.fillStyle=
"blue";e.fillText(d,0,16);c.texture=new h.Texture(b,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas);return c.texture};return c}(g.default);b.default=n})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["require","exports"],function(n,b){function l(b,a){b%=a;return 0<=b?b:b+a}Object.defineProperty(b,"__esModule",{value:!0});b.C_INFINITY=Number.POSITIVE_INFINITY;b.C_PI=Math.PI;b.C_2PI=2*b.C_PI;b.C_PI_BY_2=b.C_PI/2;b.C_RAD_TO_256=128/b.C_PI;b.C_256_TO_RAD=b.C_PI/
128;b.C_DEG_TO_256=256/360;b.C_DEG_TO_RAD=b.C_PI/180;b.C_SQRT2=1.414213562;b.C_SQRT2_INV=1/b.C_SQRT2;var k=1/Math.LN2;b.positiveMod=l;b.radToByte=function(h){return l(h*b.C_RAD_TO_256,256)};b.degToByte=function(h){return l(h*b.C_DEG_TO_256,256)};b.log2=function(b){return Math.log(b)*k};b.sqr=function(b){return b*b};b.interpolate=function(b,a,g){return b*(1-g)+a*g};b.between=function(b,a,g){return b>=a&&b<=g||b>=g&&b<=a}})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.name=this.constructor.name||"UnnamedBrush"}b.prototype.prepareState=function(b,h,a){};return b}();b.default=n})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["require","exports","./sources/resolver"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.background={name:"background",shaders:{vertexShader:l.resolveIncludes("background/background.vert"),
fragmentShader:l.resolveIncludes("background/background.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["require","exports","../../../../../webgl","./shaderRepository"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});var h=new l.ShaderCompiler(function(a){var b=k;a.split("/").forEach(function(a){b&&(b=b[a])});return b});b.resolveIncludes=function(a){return h.resolveIncludes(a)}})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(["require",
"exports"],function(n,b){return{background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\n  gl_FragColor \x3d u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\n  vec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\n  lowp vec4 color \x3d texture2D(u_tex, v_uv);\n  gl_FragColor \x3d color *  u_opacity;\n}",
"bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n  v_uv \x3d a_tex;\n}"},filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\n  float b \x3d 1.0 / 6.0;\n  float v2 \x3d v * v;\n  float v3 \x3d v2 * v;\n  float w0 \x3d b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\n  float w1 \x3d b * (3.0 * v3  - 6.0 * v2 + 4.0);\n  float w2 \x3d b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\n  float w3 \x3d b * v3;\n  return vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\n  vec4 w \x3d computeWeights(v);\n  float g0 \x3d w.x + w.y;\n  float g1 \x3d w.z + w.w;\n  float h0 \x3d 1.0 - (w.y / g0) + v;\n  float h1 \x3d 1.0 + (w.w / g1) - v;\n  return vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 eX \x3d vec2(1.0 / texSize.x, 0.0);\n  vec2 eY \x3d vec2(0.0, 1.0 / texSize.y);\n  vec2 texel \x3d coords * texSize - 0.5;\n  vec3 hgX \x3d bicubicOffsetsAndWeights(fract(texel).x).xyz;\n  vec3 hgY \x3d bicubicOffsetsAndWeights(fract(texel).y).xyz;\n  vec2 coords10 \x3d coords + hgX.x * eX;\n  vec2 coords00 \x3d coords - hgX.y * eX;\n  vec2 coords11 \x3d coords10 + hgY.x * eY;\n  vec2 coords01 \x3d coords00 + hgY.x * eY;\n  coords10 \x3d coords10 - hgY.y * eY;\n  coords00 \x3d coords00 - hgY.y * eY;\n  vec4 color00 \x3d texture2D(sampler, coords00);\n  vec4 color10 \x3d texture2D(sampler, coords10);\n  vec4 color01 \x3d texture2D(sampler, coords01);\n  vec4 color11 \x3d texture2D(sampler, coords11);\n  color00 \x3d mix(color00, color01, hgY.z);\n  color10 \x3d mix(color10, color11, hgY.z);\n  color00 \x3d mix(color00, color10, hgX.z);\n  return color00;\n}",
"bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 texelStart \x3d floor(coords * texSize);\n  vec2 coord0 \x3d texelStart / texSize;\n  vec2 coord1 \x3d (texelStart +  vec2(1.0, 0.0)) / texSize;\n  vec2 coord2 \x3d (texelStart +  vec2(0.0, 1.0)) / texSize;\n  vec2 coord3 \x3d (texelStart +  vec2(1.0, 1.0)) / texSize;\n  vec4 color0 \x3d texture2D(sampler, coord0);\n  vec4 color1 \x3d texture2D(sampler, coord1);\n  vec4 color2 \x3d texture2D(sampler, coord2);\n  vec4 color3 \x3d texture2D(sampler, coord3);\n  vec2 blend \x3d fract(coords * texSize);\n  vec4 color01 \x3d mix(color0, color1, blend.x);\n  vec4 color23 \x3d mix(color2, color3, blend.x);\n  return mix(color01, color23, blend.y);\n}",
"epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\n  vec2 invSize \x3d 1.0 / texSize;\n  vec2 texel \x3d coords * texSize;\n  vec2 texel_i \x3d floor(texel);\n  vec2 texel_frac \x3d fract(texel);\n  vec4 colorP \x3d texture2D(sampler, texel_i * invSize);\n  vec4 colorP1 \x3d vec4(colorP);\n  vec4 colorP2 \x3d vec4(colorP);\n  vec4 colorP3 \x3d vec4(colorP);\n  vec4 colorP4 \x3d vec4(colorP);\n  vec4 colorA \x3d texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\n  vec4 colorB \x3d texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\n  vec4 colorC \x3d texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\n  vec4 colorD \x3d texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\n  if (colorC \x3d\x3d colorA \x26\x26 colorC !\x3d colorD \x26\x26 colorA !\x3d colorB) {\n    colorP1 \x3d colorA;\n  }\n  if (colorA \x3d\x3d colorB \x26\x26 colorA !\x3d colorC \x26\x26 colorB !\x3d colorD) {\n    colorP2 \x3d colorB;\n  }\n  if (colorD \x3d\x3d colorC \x26\x26 colorD !\x3d colorB \x26\x26 colorC !\x3d colorA) {\n    colorP3 \x3d colorC;\n  }\n  if (colorB \x3d\x3d colorD \x26\x26 colorB !\x3d colorA \x26\x26 colorD !\x3d colorC) {\n    colorP4 \x3d colorD;\n  }\n  vec4 colorP12 \x3d mix(colorP1, colorP2, texel_frac.x);\n  vec4 colorP34 \x3d mix(colorP1, colorP2, texel_frac.x);\n  return mix(colorP12, colorP34, texel_frac.y);\n}"},
fx:{integrate:{"integrate.frag":"precision mediump float;\nuniform lowp sampler2D u_sourceTexture;\nuniform lowp sampler2D u_maskTexture;\nuniform mediump float u_zoomLevel;\nuniform highp float u_timeDelta;\nuniform highp float u_animationTime;\nvarying highp vec2 v_texcoord;\n#include \x3cmaterials/utils.glsl\x3e\nvoid main()\n{\n#ifdef DELTA\n  vec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\n  vec4 data0 \x3d texture2D(u_maskTexture, v_texcoord);\n  float flags \x3d data0.r * 255.0;\n  float groupMinZoom \x3d data0.g * 255.0;\n  float isVisible \x3d getFilterBit(flags, 0);\n  float wouldClip \x3d step(groupMinZoom, u_zoomLevel);\n  float direction \x3d wouldClip * 1.0 + (1.0 - wouldClip) * -1.0;\n  float dt \x3d u_timeDelta / max(u_animationTime, 0.0001);\n  vec4 nextState \x3d vec4(texel + direction * dt);\n  gl_FragColor \x3d  vec4(nextState);\n#elif defined(UPDATE)\n  vec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\n  gl_FragColor \x3d texel;\n#endif\n}",
"integrate.vert":"precision mediump float;\nattribute vec2 a_pos;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_texture;\nmediump vec4 gauss4(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas * u_sigmas));\n}\nmediump float gauss1(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas[3] * u_sigmas[3]));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\n  return u_channelSelector * sample;\n}\nvoid accumGauss4(mediump float i, inout mediump vec4 tot, inout mediump vec4 weight) {\n  mediump vec4 w \x3d gauss4(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw)) * w;\n  weight +\x3d w;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\n  mediump float w \x3d gauss1(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\n  weight +\x3d w;\n}\nvoid main(void) {\n  mediump float tot \x3d 0.0;\n  mediump float weight \x3d 0.0;\n  accumGauss1(-4.0, tot, weight);\n  accumGauss1(-3.0, tot, weight);\n  accumGauss1(-2.0, tot, weight);\n  accumGauss1(-1.0, tot, weight);\n  accumGauss1(0.0, tot, weight);\n  accumGauss1(1.0, tot, weight);\n  accumGauss1(2.0, tot, weight);\n  accumGauss1(3.0, tot, weight);\n  accumGauss1(4.0, tot, weight);\n  gl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\n}",
"highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\n  mediump float sigma \x3d u_sigmas[3];\n  mediump float y \x3d texture2D(u_texture, v_texcoord)[3];\n  const mediump float y0 \x3d 0.5;\n  mediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * sigma);\n  mediump float d \x3d (y - y0) / m0;\n  return d;\n}\nmediump vec4 shade(mediump float d) {\n  mediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\n  mappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\n  return texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\n  mediump float d \x3d estimateDistance();\n  gl_FragColor \x3d shade(d);\n}",
"textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\n  gl_Position \x3d vec4(a_position, 0.0, 1.0);\n  v_texcoord \x3d a_texcoord;\n}"},magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\nuniform mediump sampler2D u_readbackTexture;\nuniform mediump sampler2D u_maskTexture;\nuniform mediump sampler2D u_overlyTexture;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  lowp vec4 color \x3d texture2D(u_readbackTexture, v_texCoord);\n  color \x3d color + (1.0 - color.a) * u_background;\n  lowp vec4 mask_color \x3d texture2D(u_maskTexture, v_texCoord);\n  lowp float gray \x3d 1.0 - dot(mask_color, vec4(0.3, 0.59, 0.11, 0));\n  color *\x3d gray;\n  lowp vec4 overley_color \x3d texture2D(u_overlyTexture, v_texCoord);\n  overley_color.rgb *\x3d overley_color.a;\n  gl_FragColor \x3d overley_color + (1.0 - overley_color.a) * color;\n}",
"magnifier.vert":"precision mediump float;\nattribute mediump vec2 a_pos;\nuniform mediump vec2 u_drawPos;\nuniform mediump float u_width;\nuniform mediump float u_height;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  v_texCoord \x3d a_pos;\n  vec2 coord \x3d u_drawPos + vec2(a_pos - 0.5) * vec2(u_width, u_height);\n  gl_Position \x3d vec4(coord, 0.0, 1.0);\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D u_attributeData0;\nuniform highp sampler2D u_attributeData1;\nuniform highp sampler2D u_attributeData2;\nuniform highp sampler2D u_attributeData3;\nuniform highp int u_attributeTextureSize;\nhighp vec2 getAttributeDataCoords(in highp vec4 id) {\n  float size \x3d float(u_attributeTextureSize);\n  highp float u32 \x3d float(int(id.r) + int(id.g) * 256 + int(id.b) * 256 * 256 + int(id.a) * 256 * 256 * 256);\n  highp float col \x3d mod(u32, size);\n  highp float row \x3d (u32 - col) / size;\n  highp float u \x3d col / size;\n  highp float v \x3d row / size;\n  return vec2(u, v);\n}\nhighp vec4 getAttributeData0(in highp vec4 id) {\n  vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData0, coords);\n}\nhighp vec4 getAttributeData1(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData1, coords);\n}\nhighp vec4 getAttributeData2(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData2, coords);\n}\nhighp vec4 getAttributeData3(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData3, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\n  bool isMagic \x3d v.x \x3d\x3d 255.0 \x26\x26 v.y \x3d\x3d 255.0;\n  if (isMagic) {\n    return NAN_MAGIC_NUMBER;\n  }\n  return (v.x + v.y * float(0x100)) - 32768.0;\n}",
"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float SIGNED_BYTE_TO_UNSIGNED \x3d 128.0;\nconst float SOFT_EDGE_RATIO \x3d 1.0;\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\nconst float SDF_FONT_SIZE \x3d 24.0;\nconst float MAX_SDF_DISTANCE \x3d 8.0;\nconst float PLACEMENT_PADDING \x3d 8.0;\nconst float EPSILON \x3d 0.0000001;\nconst int MAX_FILTER_COUNT \x3d 2;\nconst int ATTR_VV_SIZE \x3d 0;\nconst int ATTR_VV_COLOR \x3d 1;\nconst int ATTR_VV_OPACITY \x3d 2;\nconst int ATTR_VV_ROTATION \x3d 3;\nconst highp float NAN_MAGIC_NUMBER \x3d 1e-30;",
"effects.glsl":"uniform highp mat4 u_insideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp mat4 u_outsideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp float u_insideOpacities[ MAX_FILTER_COUNT ];\nuniform highp float u_outsideOpacities[ MAX_FILTER_COUNT ];\nvec4 getEffectColor(in vec4 color, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  return vec4(rgbw.rgb * a, a);\n}\nvec3 applyFilter(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 0; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  color.rgb \x3d rgbw.rgb * a;\n  color.a \x3d a;\n  pos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef HIGHLIGHT\n  pos.z +\x3d 2.0 * (1.0 - getHighlightBit(filterFlags));\n#endif\n  return pos;\n}\nvec3 applyFilterLabels(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  float bit \x3d getFilterBit(filterFlags, 0);\n  pos.z +\x3d 2.0 * (1.0 - bit);\n#ifndef OUTSIDE_LABELS_VISIBLE\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    pos.z +\x3d 2.0 * (1.0 - bit);\n  }\n#endif\n  return pos;\n}",
fill:{"common.glsl":"#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\n#endif\n#ifdef DOT_DENSITY\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying vec3 v_pos;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying highp vec4 v_id;\nvarying highp float v_flags;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef DOT_DENSITY\nvarying vec4 v_dotThresholds[ 2 ];\nvarying vec2 v_dotTextureCoords;\n#endif",
"fill.frag":"precision highp float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef DOT_DENSITY\n#include \x3cmaterials/effects.glsl\x3e\n#endif\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#ifdef DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\nvoid main() {\n#ifdef ID\n  gl_FragColor \x3d v_id;\n#elif defined(PATTERN)\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d v_opacity * v_color * color;\n#elif defined(DOT_DENSITY) \x26\x26 !defined(HIGHLIGHT)\n  vec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\n  vec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\n  vec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\n  vec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\n  vec4 isPositive0 \x3d step(0.0, difference0);\n  vec4 isPositive1 \x3d step(0.0, difference1);\n  float weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\n  float lessThanEqZero \x3d step(weightSum, 0.0);\n  float greaterThanZero \x3d 1.0 - lessThanEqZero ;\n  float divisor \x3d (weightSum + lessThanEqZero);\n  vec4 weights0 \x3d difference0 * isPositive0 / divisor;\n  vec4 weights1 \x3d difference1 * isPositive1 / divisor;\n  vec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\n  vec4 preEffectColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\n  float diffMax \x3d max(max4(difference0), max4(difference1));\n  float lessThanZero \x3d step(diffMax, 0.0);\n  float greaterOrEqZero \x3d 1.0 - lessThanZero;\n  vec4 isMax0 \x3d step(diffMax, difference0);\n  vec4 isMax1 \x3d step(diffMax, difference1);\n  vec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\n  vec4 preEffectColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\n  gl_FragColor \x3d getEffectColor(preEffectColor, v_flags);\n#else\n  gl_FragColor \x3d v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d 1.0;\n#endif\n}",
"fill.vert":"precision mediump float;\n#ifdef DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\nvec4 a_aux3 \x3d vec4(0.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_tlbr;\nattribute vec4 a_aux1;\nattribute vec2 a_aux2;\nattribute vec4 a_aux3;\n#endif\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\n  return featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef PATTERN\nmat3 getPatternMatrix() {\n  mat3 patternMatrix \x3d mat3(1.0);\n  vec2 aux2 \x3d (1.0 / SIGNED_BYTE_TO_UNSIGNED) * a_aux2;\n  patternMatrix[0][0] \x3d 1.0 / (u_zoomFactor * a_aux1.x * aux2.x);\n  patternMatrix[1][1] \x3d 1.0 / (u_zoomFactor * a_aux1.y * aux2.y);\n  return patternMatrix;\n}\n#endif\nvoid main()\n{\n  INIT;\n  float a_bitSet \x3d a_aux3.a;\n  v_color     \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity   \x3d getOpacity(a_bitSet, 1);\n  v_id        \x3d norm(a_id);\n  v_pos       \x3d u_dvsMat3 * vec3(a_pos, 1.);\n  v_flags     \x3d getFilterFlags();\n#ifdef PATTERN\n  vec2 symbolOffset \x3d u_zoomFactor * (a_aux1.zw - SIGNED_BYTE_TO_UNSIGNED);\n  v_tileTextureCoord \x3d (getPatternMatrix() * vec3(a_pos + symbolOffset, 1.0)).xy;\n  v_tlbr \x3d a_tlbr / u_mosaicSize.xyxy;\n#elif defined(DOT_DENSITY)\n  vec4 ddAttributeData0 \x3d getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\n  vec4 ddAttributeData1 \x3d getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\n  float size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\n  v_dotThresholds[0] \x3d dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\n  v_dotThresholds[1] \x3d dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\n  v_dotTextureCoords \x3d (a_pos + 0.5) / size;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, v_flags), 1.0);\n}"},
icon:{"common.glsl":"uniform vec2 u_mosaicSize;\nvarying vec3 v_pos;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying highp vec4 v_id;\nvarying vec2 v_tex;\nvarying vec2 v_size;\nvarying float v_filters;\n#ifdef SDF\nvarying float v_isThin;\nvarying float v_overridingOutlineColor;\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\n#endif","icon.frag":"precision mediump float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n#ifdef SDF\n  lowp vec4 fillPixelColor \x3d v_color;\n  float d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\n  float size \x3d max(v_size.x, v_size.y);\n  float dist \x3d d * size * SOFT_EDGE_RATIO * v_distRatio;\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  float outlineWidth \x3d v_outlineWidth;\n  #ifdef HIGHLIGHT\n    outlineWidth \x3d max(outlineWidth, 4.0 * v_isThin);\n  #endif\n  if (outlineWidth \x3e 0.25) {\n    lowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\n    float clampedOutlineSize \x3d min(outlineWidth, size);\n    outlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\n    gl_FragColor \x3d v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n  }\n  else {\n    gl_FragColor \x3d v_opacity * fillPixelColor;\n  }\n#else\n   lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\n   gl_FragColor \x3d v_opacity * getEffectColor(texColor, v_filters);\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"precision mediump float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec4 a_bitSetAndDistRatio;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float referenceSize, in float bitSet) {\n#ifdef VV_SIZE\n  float r \x3d getSize(baseSize.y) / referenceSize;\n  baseSize.xy *\x3d r;\n  offset.xy *\x3d r;\n  float scaleSymbolProportionally \x3d getBit(bitSet, 3);\n  outlineSize *\x3d scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\n  return baseSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\n  float isMapAligned \x3d getBit(a_bitSet, 0);\n  vec3  offset       \x3d getRotation() * vec3(in_offset, 0.0);\n  return getMatrix(isMapAligned) * offset;\n}\nvoid main()\n{\n  INIT;\n  vec2  a_size   \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 256.0;\n  vec2  a_offset \x3d a_vertexOffset / 16.0;\n  float a_outlineSize \x3d a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 256.0;\n  float a_bitSet \x3d a_bitSetAndDistRatio.z;\n  v_color    \x3d getColor(a_color, a_bitSet, 1);\n  v_opacity  \x3d getOpacity(a_bitSet, 1);\n  v_size     \x3d getMarkerSize(a_offset, a_size, a_outlineSize, a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 256.0, a_bitSet);\n  v_id       \x3d norm(a_id);\n  v_filters  \x3d getFilterFlags();\n  v_tex      \x3d a_texCoords / u_mosaicSize;\n  v_pos      \x3d u_dvsMat3 * vec3(a_pos, 1.0) + getOffset(a_offset, a_bitSet);\n#ifdef SDF\n  v_isThin   \x3d getBit(a_bitSet, 2);\n  #ifdef VV_COLOR\n    v_overridingOutlineColor \x3d v_isThin;\n  #else\n    v_overridingOutlineColor \x3d 0.0;\n  #endif\n  v_outlineWidth \x3d min(a_outlineSize, max(max(v_size.x, v_size.y) - 0.99, 0.0));\n  v_outlineColor \x3d getEffectColor(a_outlineColor, v_filters);\n  v_distRatio \x3d a_bitSetAndDistRatio.w / 126.0;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, v_filters), 1.0);\n}"},
label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nuniform vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"precision mediump float;\n#include \x3cmaterials/label/common.glsl\x3e\nuniform mediump vec2 u_screenSize;\nuniform highp float u_pixelRatio;\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  mediump vec2 refTextPos \x3d gl_FragCoord.xy / (u_pixelRatio * u_screenSize.xy);\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\n  lowp float sdfAlpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist);\n  gl_FragColor \x3d v_animation.r * sdfAlpha * v_color;\n}",
"label.vert":"precision mediump float;\nattribute vec4 a_color;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_zoomRangeAndEmpty;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/label/common.glsl\x3e\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\n  float glyphAngle \x3d angle * 360.0 / 254.0;\n  float mapAngle \x3d u_mapRotation * 360.0 / 254.0;\n  float diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\n  float z \x3d 0.0;\n  z +\x3d u_mapAligned * (2.0 * (1.0 - step(minZoom, u_zoomLevel)));\n  z +\x3d u_mapAligned * 2.0 * step(90.0, diffAngle);\n  z +\x3d 2.0 * (1.0 - step(u_zoomLevel, maxZoom));\n  return z;\n}\nvoid main()\n{\n  INIT;\n  float groupMinZoom    \x3d getMinZoom();\n  float glyphMinZoom    \x3d a_zoomRangeAndEmpty.x;\n  float a_minZoom       \x3d max(groupMinZoom, glyphMinZoom);\n  float a_maxZoom       \x3d a_zoomRangeAndEmpty.y;\n  vec2  a_placementDir  \x3d a_refSymbolAndPlacementOffset.zw - 1.0;\n  float a_refSymbolSize \x3d a_refSymbolAndPlacementOffset.y;\n  float fontSize        \x3d a_texAndSize.z;\n  float isHalo          \x3d mod(a_pos, 2.0).x;\n  vec2  vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\n  vec3  pos          \x3d vec3(floor(a_pos * 0.5), 1.0);\n  float z            \x3d getZ(a_minZoom, a_maxZoom, a_refSymbolAndPlacementOffset.x);\n  float fontScale    \x3d fontSize / SDF_FONT_SIZE;\n  float halfSize     \x3d getSize(a_refSymbolSize) / 2.0;\n  v_color     \x3d a_color;\n  v_tex       \x3d a_texAndSize.xy / u_mosaicSize;\n  v_animation \x3d pow(getAnimationState(), vec4(2.0));\n  v_edgeDistanceOffset \x3d isHalo * OUTLINE_SCALE * a_texAndSize.w / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.106 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  vec2 placementOffset \x3d a_placementDir * (halfSize + PLACEMENT_PADDING);\n  vec3 glyphOffset     \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\n  vec3 v_pos           \x3d vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\n  gl_Position \x3d vec4(applyFilterLabels(v_color, v_pos, getFilterFlags()), 1.0);\n#ifdef DEBUG\n  v_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);\n#endif\n}"},
line:{"common.glsl":"varying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying highp vec4 v_id;\nvarying vec3 v_pos;\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif","line.frag":"precision lowp float;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nuniform lowp float u_blur;\nuniform mediump float u_zoomFactor;\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\n#endif\n#ifdef SDF\nconst float sdfPatternHalfWidth \x3d 15.5;\nconst float widthFactor \x3d 2.0;\n#endif\nvoid main()\n{\n  mediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(v_lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\n  lowp float alpha \x3d clamp(thinLineFactor * (v_lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  mediump float lineHalfWidth \x3d widthFactor * v_lineHalfWidth;\n  mediump float lineWidthRatio \x3d lineHalfWidth / sdfPatternHalfWidth;\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / (lineWidthRatio * v_patternSize.x), 1.0);\n  mediump float relativeTexY \x3d 0.5 + 0.5 * v_normal.y;\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  mediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\n  float dist \x3d d * lineHalfWidth;\n  lowp vec4 fillPixelColor \x3d v_opacity * alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n  gl_FragColor \x3d fillPixelColor;\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT)\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * v_lineHalfWidth) / v_patternSize.x, 1.0);\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / v_patternSize.y);\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n  gl_FragColor \x3d v_opacity * alpha * v_color * color;\n#else\n  gl_FragColor \x3d v_opacity * alpha * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"precision mediump float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nconst float SCALE \x3d 1.0 / 31.0;\nfloat getBaseLineHalfWidth(in float in_lineHalfWidth) {\n#ifdef VV_SIZE\n  float referenceHalfWidth \x3d a_aux.x * SCALE;\n  float lineWidth \x3d 2.0 * in_lineHalfWidth;\n  return 0.5 * (in_lineHalfWidth / referenceHalfWidth) * getSize(lineWidth);\n#else\n  return in_lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\n  float halfWidth \x3d max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\n  halfWidth \x3d max(halfWidth, 2.0);\n#endif\n  return halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\n  float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  thinLineFactor *\x3d 2.0;\n#endif\n  return thinLineFactor * halfWidth * offset * SCALE;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet          \x3d a_segmentDirection.w;\n  float a_accumulatedDist \x3d a_accumulatedDistanceAndHalfWidth.x;\n  float a_lineHalfWidth   \x3d a_accumulatedDistanceAndHalfWidth.y * SCALE;\n  float aa                \x3d 0.5 * u_antialiasing;\n  vec2  a_offset          \x3d a_offsetAndNormal.xy;\n  float baseWidth \x3d getBaseLineHalfWidth(a_lineHalfWidth);\n  float halfWidth \x3d getLineHalfWidth(baseWidth, aa);\n  float z         \x3d 2.0 * step(baseWidth, 0.0);\n  vec2  dist      \x3d getDist(a_offset, halfWidth);\n  vec3  offset    \x3d u_displayViewMat3 * vec3(dist, 0.0);\n  vec3  pos       \x3d u_dvsMat3 * vec3(a_pos.xy, 1.0) + offset;\n  v_color         \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity       \x3d getOpacity(a_bitSet, 0);\n  v_lineHalfWidth \x3d halfWidth;\n  v_id            \x3d norm(a_id);\n  v_normal        \x3d a_offsetAndNormal.zw * SCALE;\n  v_pos           \x3d vec3(pos.xy, z);\n#ifdef PATTERN\n  v_tlbr          \x3d a_tlbr / u_mosaicSize.xyxy;\n  v_patternSize   \x3d vec2(a_tlbr.z - a_tlbr.x, a_tlbr.w - a_tlbr.y);\n#endif\n#if defined(PATTERN) || defined(SDF)\n  v_accumulatedDistance \x3d a_accumulatedDist + dot(SCALE * a_segmentDirection.xy, dist / u_zoomFactor);\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
text:{"common.glsl":"uniform vec2 u_mosaicSize;\nvarying highp vec4 v_id;\nvarying vec3 v_pos;\nvarying vec4 v_color;\nvarying vec2 v_tex;\nvarying float v_opacity;\nvarying float v_antialiasingWidth;\nvarying float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","text.frag":"precision mediump float;\n#include \x3cmaterials/text/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\n  #ifdef HIGHLIGHT\n    glyphEdgeDistance /\x3d 2.0;\n  #endif\n  lowp float alpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist) * v_opacity;\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"precision mediump float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nfloat getTextSize(inout vec2 offset, in float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\n   float ratio \x3d baseSize / referenceSize;\n   baseSize \x3d ratio * getSize(baseSize);\n#endif\n  return baseSize;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet    \x3d a_aux.w;\n  float a_fontSize  \x3d a_texFontSize.z;\n  vec2  a_offset    \x3d a_vertexOffset * OFFSET_PRECISION;\n  float a_isHalo    \x3d getBit(a_pos.x, 0);\n  vec3  in_pos      \x3d vec3(floor(a_pos * 0.5), 1.0);\n  float fontSize    \x3d getTextSize(a_offset, a_fontSize, a_aux.z * a_aux.z / 256.0);\n  float scaleFactor \x3d fontSize / a_fontSize;\n  float fontScale   \x3d fontSize / SDF_FONT_SIZE;\n  vec3  offset      \x3d getRotation() * vec3(scaleFactor * a_offset, 0.0);\n  v_color   \x3d a_isHalo * a_color + (1.0 - a_isHalo) * getColor(a_color, a_bitSet, 0);\n  v_opacity \x3d getOpacity(a_bitSet, 0);\n  v_id      \x3d norm(a_id);\n  v_tex     \x3d a_texFontSize.xy / u_mosaicSize;\n  v_pos     \x3d u_dvsMat3 * in_pos + u_displayMat3 * offset;\n  v_edgeDistanceOffset \x3d a_isHalo * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  gl_Position \x3d  vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
"utils.glsl":"float rshift(in float u32, in int amount) {\n  return floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\nfloat getFilterBit(in float bitset, in int bitIndex) {\n  return getBit(bitset, bitIndex + 1);\n}\nfloat getHighlightBit(in float bitset) {\n  return getBit(bitset, 0);\n}\nvec4 unpack(in float u32) {\n  float r \x3d mod(rshift(u32, 0), 255.0);\n  float g \x3d mod(rshift(u32, 8), 255.0);\n  float b \x3d mod(rshift(u32, 16), 255.0);\n  float a \x3d mod(rshift(u32, 24), 255.0);\n  return vec4(r, g, b, a);\n}\nvec4 norm(in vec4 v) {\n  return v /\x3d 255.0;\n}\nfloat max4(vec4 target) {\n  return max(max(max(target.x, target.y), target.z), target.w);\n}",
"vcommon.glsl":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\nattribute vec2 a_pos;\nattribute highp vec4 a_id;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform highp float u_pixelRatio;\nuniform mediump float u_zoomFactor;\nuniform mediump float u_antialiasing;\nvec4 VV_ADATA \x3d vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\n#ifdef OES_TEXTURE_FLOAT\n  target.rgba \x3d getAttributeData2(a_id);\n#else\n  vec4 data0 \x3d getAttributeData2(a_id);\n  vec4 data1 \x3d getAttributeData3(a_id);\n  target.r \x3d u88VVToFloat(data0.rg * 255.0);\n  target.g \x3d u88VVToFloat(data0.ba * 255.0);\n  target.b \x3d u88VVToFloat(data1.rg * 255.0);\n  target.a \x3d u88VVToFloat(data1.ba * 255.0);\n#endif\n}\n#ifdef VV\n  #define INIT loadVisualVariableData(VV_ADATA)\n#else\n  #define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\n  float isColorLocked   \x3d getBit(a_bitSet, index);\n  return getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\n  return a_color;\n#endif\n}\nfloat getOpacity(in float a_bitSet, in int index) {\n#ifdef VV_OPACITY\n  float isOpacityLocked \x3d getBit(a_bitSet, index);\n  return getVVOpacity(VV_ADATA[ATTR_VV_OPACITY], isOpacityLocked);\n#else\n  return 1.0;\n#endif\n}\nfloat getSize(in float in_size) {\n#ifdef VV_SIZE\n  return getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE]);\n#else\n  return in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\n  return getVVRotationMat3(VV_ADATA[ATTR_VV_ROTATION]);\n#else\n  return mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\n  return ceil(getAttributeData0(a_id).x * 255.0);\n#else\n  return getAttributeData0(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\n  return getAttributeData1(a_id);\n}\nfloat getMinZoom() {\n  vec4 data0 \x3d getAttributeData0(a_id) * 255.0;\n  return data0.g;\n}\nmat3 getMatrix(float isMapAligned) {\n  return isMapAligned * u_displayViewMat3 + (1.0 - isMapAligned) * u_displayMat3;\n}",
"vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n  #define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n  #define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float u_vvColorValues[8];\nuniform vec4 u_vvColors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 u_vvSizeMinMaxValue;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float u_vvSizeScaleStopsValue;\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float u_vvSizeFieldStopsValues[6];\nuniform float u_vvSizeFieldStopsSizes[6];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float u_vvSizeUnitValueWorldToPixelsRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float u_vvOpacityValues[8];\nuniform float u_vvOpacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float u_vvRotationType;\n#endif\nbool isNan(float val) {\n  return (val \x3d\x3d NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  float interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\n  interpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\n  return u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N \x3d 6;\nfloat getVVStopsSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\n    return u_vvSizeFieldStopsSizes[0];\n  }\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\n    }\n  }\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N \x3d 8;\nfloat getVVOpacity(float opacityValue, float isOpacityLocked) {\n  if (isNan(opacityValue) || isOpacityLocked \x3d\x3d 1.0) {\n    return 1.0;\n  }\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\n    return u_vvOpacities[0];\n  }\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\n    }\n  }\n  return u_vvOpacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat4(1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat4(cosA, sinA, 0, 0,\n              -sinA,  cosA, 0, 0,\n              0,     0, 1, 0,\n              0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat3(1, 0, 0,\n                0, 1, 0,\n                0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * -rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat3(cosA, -sinA, 0,\n             sinA, cosA, 0,\n              0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N \x3d 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\n  if (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\n    return fallback;\n  }\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\n    return u_vvColors[0];\n  }\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\n    }\n  }\n  return u_vvColors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\n  return getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\n  return u_vvSizeScaleStopsValue;\n#elif defined(VV_SIZE_FIELD_STOPS)\n  return getVVStopsSize(vvSize, size);\n#elif defined(VV_SIZE_UNIT_VALUE)\n  return getVVUnitValue(vvSize, size);\n#else\n  return size;\n#endif\n}"},
raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\n#include \x3cfiltering/bicubic.glsl\x3e\nvoid main() {\n#ifdef BICUBIC\n  vec4 color \x3d sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\n  vec4 color \x3d texture2D(u_texture, v_texcoord);\n#endif\n  gl_FragColor \x3d vec4(color.rgb * color.a, color.a);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},
stencil:{"stencil.frag":"void main() {\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nvoid main() {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d 0.75 * color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\n  mediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  vec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n  v_tex \x3d a_pos;\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["require","exports","./sources/resolver"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.tileInfo={name:"tileInfo",shaders:{vertexShader:l.resolveIncludes("tileInfo/tileInfo.vert"),
fragmentShader:l.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ./WGLBrush ../shaders/BackgroundPrograms".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._color=k.vec4f32.fromValues(1,
0,0,1);b._initialized=!1;return b}l(b,a);b.prototype.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)};b.prototype.prepareState=function(a,b){a=a.context;a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255);a.setStencilFunctionSeparate(1032,
516,b.stencilRef,255)};b.prototype.draw=function(a,b){a=a.context;this._initialized||this._initialize(a);a.bindVAO(this._solidVertexArrayObject);a.bindProgram(this._solidProgram);this._solidProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);this._solidProgram.setUniform2fv("u_coord_range",b.size);this._solidProgram.setUniform1f("u_depth",0);this._solidProgram.setUniform4fv("u_color",this._color);a.drawArrays(5,0,4);a.bindVAO()};b.prototype._initialize=function(a){if(this._initialized)return!0;
var b=h.createProgram(a,g.background);if(!b)return!1;var d=new Int8Array([0,0,1,0,0,1,1,1]),d=h.BufferObject.createVertex(a,35044,d);a=new h.VertexArrayObject(a,g.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:d});this._solidProgram=b;this._solidVertexArrayObject=a;return this._initialized=!0};return b}(a.default);b.default=n})},"esri/views/2d/engine/Stage":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/events ../../../core/has ../../../core/promiseUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/libs/gl-matrix-2/common ../../../core/libs/gl-matrix-2/mat2d ../../../core/libs/gl-matrix-2/mat2df64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../webgl ./Container ./webgl/BitBlitRenderer ./webgl/definitions ./webgl/enums ./webgl/Painter ./webgl/Profiler ./webgl/WebGLDriverTest ./webgl/shaders/StencilPrograms ../support/Timeline ../../support/screenshotUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function k(c,e){var f=b.call(this)||this;f._renderParameters={drawPhase:0,state:f.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1};f._clipData=new Float32Array(8);f._upperLeft=t.vec2f64.create();f._upperRight=t.vec2f64.create();f._lowerLeft=t.vec2f64.create();f._lowerRight=t.vec2f64.create();f._mat2=p.mat2df64.create();f._clipRendererInitialized=!1;f._supersampleScreenshots=
!0;f.stage=f;f._stationary=!0;f.attached=!0;var k=e.canvas,k=void 0===k?document.createElement("canvas"):k,m=e.alpha,l=e.stencil,q=e.renderContext,r=e.supersampleScreenshots,r=void 0===r?!0:r,u=e.contextOptions,u=void 0===u?{}:u;f._canvas=k;m=x.createContextOrErrorHTML(k,{alpha:void 0===m?!0:m,antialias:!1,depth:!0,stencil:void 0===l?!0:l},void 0===q?"webgl":q);f.context=new x.RenderingContext(m,u);f.painter=new v.default(f.context);f._taskHandle=d.addFrameTask({render:function(){return f.renderFrame()}});
f._taskHandle.pause();f._supersampleScreenshots=r;f._lostWebGLContextHandle=a.on(k,"webglcontextlost",function(){f.emit("webgl-error",{error:new h("webgl-context-lost")})});g("esri-2d-profiler")&&(f._debugOutput=document.createElement("div"),f._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),c.appendChild(f._debugOutput));k.setAttribute("style","width: 100%; height:100%; display:block;");f.profiler=new z.Profiler(f.context,f._debugOutput);f.renderingOptions=
e.renderingOptions;f.timeline=e.timeline||new D.Timeline;f.driverTestResult=B.testWebGLDriver(f.context);c.appendChild(k);return f}l(k,b);k.prototype.destroy=function(){this.removeAllChildren();this.renderFrame();this._taskHandle.remove();this._boundFBO=this._taskHandle=null;this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null);this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._clipVAO&&(this._clipVAO.dispose(),this._clipVBO=this._clipVAO=null);this._clipStencilProgram&&
(this._clipStencilProgram.dispose(),this._clipStencilProgram=null);this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null);this.painter.dispose();this.context.dispose();this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas);this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput);this._canvas=null};Object.defineProperty(k.prototype,"background",{get:function(){return this._background},
set:function(a){this._background=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"highlightOptions",{get:function(){return this._highlightOptions},set:function(a){var b=this;this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null);if(this._highlightOptions=a)this._highlightOptionsHandle=f.init(this._highlightOptions,"version",function(){b.painter.setHighlightOptions(a);b.requestRender()})},enumerable:!0,configurable:!0});
Object.defineProperty(k.prototype,"renderingOptions",{get:function(){return this._renderingOptions},set:function(a){this._renderingOptions=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"state",{get:function(){return this._state},set:function(a){this._state=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"stationary",{get:function(){return this._stationary},set:function(a){this._stationary!==a&&(this._stationary=
a,this.requestRender())},enumerable:!0,configurable:!0});k.prototype.requestRender=function(){this._lastRenderRequestTime=Date.now();this._taskHandle&&this._taskHandle.resume()};k.prototype.renderFrame=function(){var a=Date.now()-this._lastRenderRequestTime;this._renderParameters.state=this._state;this._renderParameters.stationary=this.stationary;this._renderParameters.pixelRatio=window.devicePixelRatio;this._renderParameters.globalOpacity=1;this.processRender(this._renderParameters);a>=y.MAX_ANIMATION_TIME_MS&&
this._taskHandle.pause()};k.prototype.renderChildren=function(a){var b=this.context,c=this.children,c=a.children?a.children:c;this.profiler.recordStart("drawLayers");this.beforeRenderChildren(a);a.drawPhase=m.WGLDrawPhase.MAP;this.painter.beforeRenderLayers(b);for(var d=0;d<c.length;d++){var e=c[d];e.attached&&e.processRender(a)}this.painter.renderLayers(b);a.drawPhase=m.WGLDrawPhase.LABEL;this.painter.beforeRenderLayers(b);for(d=0;d<c.length;d++)e=c[d],e.attached&&e.processRender(a);this.painter.renderLayers(b);
this.profiler.recordEnd("drawLayers");this.afterRenderChildren()};k.prototype.beforeRenderChildren=function(a){var b=this.context,d=a.state,e=a.pixelRatio;if(this.painter){b.enforceState();var f=d.size;a=d.rotation;var g=Math.round(f[0]*e),f=Math.round(f[1]*e);this._boundFBO=b.getBoundFramebufferObject();if(d.spatialReference&&(d.spatialReference._isWrappable?d.spatialReference._isWrappable():d.spatialReference.isWrappable)){var h=c.common.toRadian(a),k=Math.abs(Math.cos(h)),m=Math.abs(Math.sin(h)),
p=Math.round(d.worldScreenWidth);if(Math.round(g*k+f*m)<=p)this._clipFrame=!1;else{this._clipFBO&&this._clipFBO.width===g&&this._clipFBO.height===f||(this._clipFBO=new x.FramebufferObject(b,{colorTarget:0,depthStencilTarget:3,width:g,height:f}));var l=(this.state.padding.left-this.state.padding.right)/2,v=(this.state.padding.bottom-this.state.padding.top)/2,t=.5*g,u=.5*f,d=1/g,z=1/f,e=.5*p*e,y=.5*(g*m+f*k),g=this._upperLeft,k=this._upperRight,m=this._lowerLeft,p=this._lowerRight;r.vec2.set(g,-e,-y);
r.vec2.set(k,e,-y);r.vec2.set(m,-e,y);r.vec2.set(p,e,y);q.mat2d.identity(this._mat2);q.mat2d.translate(this._mat2,this._mat2,[t+l,u+v]);0!==a&&q.mat2d.rotate(this._mat2,this._mat2,h);r.vec2.transformMat2d(g,g,this._mat2);r.vec2.transformMat2d(k,k,this._mat2);r.vec2.transformMat2d(m,m,this._mat2);r.vec2.transformMat2d(p,p,this._mat2);a=this._clipData;a.set([2*m[0]*d-1,2*(f-m[1])*z-1,2*p[0]*d-1,2*(f-p[1])*z-1,2*g[0]*d-1,2*(f-g[1])*z-1,2*k[0]*d-1,2*(f-k[1])*z-1]);this._clipRendererInitialized||this._initializeClipRenderer(b);
this._clipVBO.setData(a);this._boundFBO=b.getBoundFramebufferObject();b.bindFramebuffer(this._clipFBO);b.setDepthWriteEnabled(!0);b.setStencilWriteMask(255);b.setClearColor(0,0,0,0);b.setClearDepth(1);b.setClearStencil(0);b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT|b.gl.STENCIL_BUFFER_BIT);b.setDepthWriteEnabled(!1);this._clipFrame=!0}}else this._clipFrame=!1}};k.prototype.afterRenderChildren=function(){var a=this.context;a.logIno();this._clipFrame&&this._clipRendererInitialized&&(a.bindFramebuffer(this._boundFBO),
this._boundFBO=null,a.bindVAO(this._clipVAO),a.bindProgram(this._clipStencilProgram),a.setDepthWriteEnabled(!1),a.setDepthTestEnabled(!1),a.setStencilTestEnabled(!0),a.setBlendingEnabled(!1),a.setColorMask(!1,!1,!1,!1),a.setStencilOp(7680,7680,7681),a.setStencilWriteMask(255),a.setStencilFunction(519,1,255),a.drawElements(4,6,5123,0),a.bindVAO(),a.setColorMask(!0,!0,!0,!0),a.setBlendingEnabled(!0),a.setStencilFunction(514,1,255),this._blitRenderer.render(a,this._clipFBO.colorTexture,9728,1),a.setStencilTestEnabled(!1))};
k.prototype.doRender=function(a){var c=this.context,d=a.state,e=a.pixelRatio;this._resizeCanvas(a);this.context.enforceState();c.setViewport(0,0,e*d.size[0],e*d.size[1]);c.setDepthWriteEnabled(!0);c.setStencilWriteMask(255);this.background&&this.background.color?(d=this.background.color,c.setClearColor(d.r/255,d.g/255,d.b/255,d.a)):c.setClearColor(0,0,0,0);c.setClearDepth(1);c.setClearStencil(0);c.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT|c.gl.STENCIL_BUFFER_BIT);c.setDepthWriteEnabled(!1);
b.prototype.doRender.call(this,a)};k.prototype.takeScreenshot=function(a,b){var c=K.screenshotSuperSampleSettings(a,this._supersampleScreenshots),d=c.framebufferWidth,f=c.framebufferHeight,g=this.context,h=a.layers,k={drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),pixelRatio:c.pixelRatio};if(null!=a.rotation){var m=k.state.viewpoint;m.rotation=a.rotation;k.state.viewpoint=m}0<h.length&&(k.children=[],h.forEach(function(a){var c=b.find(function(b){return b.layer.id===
a.id});c&&c.container&&c.attached&&k.children.push(c.container)}));var p=x.FramebufferObject.create(g,{colorTarget:0,depthStencilTarget:3,width:d,height:f}),h=g.getBoundFramebufferObject(),m=g.getViewport();g.bindFramebuffer(p);g.setViewport(0,0,d,f);d=g.gl;!a.ignoreBackground&&this.background&&this.background.color?(f=this.background.color,g.setClearColor(f.r/255,f.g/255,f.b/255,f.a)):g.setClearColor(0,0,0,0);g.setClearDepth(1);g.setClearStencil(0);g.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);
this.renderChildren(k);c=this._readbackScreenshot(c);g.bindFramebuffer(h);g.setViewport(m.x,m.y,m.width,m.height);this.requestRender();g=this._ensureScreenshotEncodeCanvas();a=K.encodeResult(c,a,g,{flipY:!0,premultipliedAlpha:!0});return e.resolve(a)};k.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};k.prototype._readbackScreenshot=function(a){var b=a.framebufferWidth,
c=a.framebufferHeight,d=a.region;a=a.resample;var e=this.context.gl;if(a){var f=K.createEmptyImageData(b,c,this._ensureScreenshotEncodeCanvas());e.readPixels(0,0,b,c,6408,5121,new Uint8Array(f.data.buffer));b=K.createEmptyImageData(d.width,d.height,this._ensureScreenshotEncodeCanvas());return K.resampleHermite(f,b,!0,a.region.x,c-(a.region.y+a.region.height),a.region.width,a.region.height)}f=K.createEmptyImageData(d.width,d.height,this._ensureScreenshotEncodeCanvas());e.readPixels(d.x,c-(d.y+d.height),
d.width,d.height,6408,5121,new Uint8Array(f.data.buffer));return f};k.prototype._resizeCanvas=function(a){var b=this._canvas,c=b.style,d=a.state.size,e=a.pixelRatio;a=d[0];var d=d[1],f=Math.round(a*e),e=Math.round(d*e);if(b.width!==f||b.height!==e)b.width=f,b.height=e;c.width=a+"px";c.height=d+"px"};k.prototype._initializeClipRenderer=function(a){if(this._clipRendererInitialized)return!0;this._blitRenderer=new u.BitBlitRenderer;var b=C.stencil.attributes,c=x.createProgram(a,C.stencil);if(!c)return!1;
var d=x.BufferObject.createVertex(a,35040,32),e=new Uint16Array([0,1,2,2,1,3]),e=x.BufferObject.createIndex(a,35044,e);a=new x.VertexArrayObject(a,b,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:d},e);this._clipStencilProgram=c;this._clipVBO=d;this._clipVAO=a;return this._clipRendererInitialized=!0};return k}(w.Container);b.Stage=n})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define(["require","exports","../../../webgl","./shaders/BitBlitPrograms"],
function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._initialized=!1}b.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};b.prototype.render=function(a,b,e,d){a&&(this._initialized||this._initialize(a),a.setBlendFunctionSeparate(1,771,1,771),a.bindVAO(this._vertexArrayObject),a.bindProgram(this._program),b.setSamplingMode(e),
a.bindTexture(b,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",d),a.drawArrays(5,0,4),a.bindVAO())};b.prototype._initialize=function(a){if(this._initialized)return!0;var b=k.bitBlit.attributes,e=l.createProgram(a,k.bitBlit);if(!e)return!1;var d=new Int8Array(16);d[0]=-1;d[1]=-1;d[2]=0;d[3]=0;d[4]=1;d[5]=-1;d[6]=1;d[7]=0;d[8]=-1;d[9]=1;d[10]=0;d[11]=1;d[12]=1;d[13]=1;d[14]=1;d[15]=1;a=new l.VertexArrayObject(a,b,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,
normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:l.BufferObject.createVertex(a,35044,d)});this._program=e;this._vertexArrayObject=a;return this._initialized=!0};return b}();b.BitBlitRenderer=n})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["require","exports","./sources/resolver"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.bitBlit={name:"bitBlit",shaders:{vertexShader:l.resolveIncludes("bitBlit/bitBlit.vert"),
fragmentShader:l.resolveIncludes("bitBlit/bitBlit.frag")},attributes:{a_pos:0,a_tex:1}}})},"esri/views/2d/engine/webgl/definitions":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.WEBGL_MAX_STOPS=8;b.WEBGL_MAX_INNER_STOPS=b.WEBGL_MAX_STOPS-2;b.NAN_MAGIC_NUMBER=1E-30;b.EXTRUDE_SCALE=64;b.PICTURE_FILL_COLOR=4294967295;b.TILE_SIZE=512;b.RASTER_TILE_SIZE=256;b.ANGLE_FACTOR_256=256/360;b.DEBUG_LABELS=!1;b.COLLISION_BUCKET_SIZE=128;b.DOT_DENSITY_MAX_FIELDS=
8;b.COLLISION_MAX_ZOOM_DELTA=3;b.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;b.COLLISION_BOX_PADDING=16;b.COLLISION_TILE_BOX_SIZE=b.TILE_SIZE/b.COLLISION_BUCKET_SIZE;b.COLLISION_PLACEMENT_PADDING=8;b.HEURISTIC_GLYPHS_PER_LINE=50;b.HEURISTIC_GLYPHS_PER_FEATURE=10;b.GLYPH_SIZE=24;b.TEXT_LINE_HEIGHT=1.2*b.GLYPH_SIZE;b.TEXT_MAX_WIDTH=10*b.GLYPH_SIZE;b.TEXT_SPACING=0;b.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};b.ATTRIBUTE_STORE_TEXTURE_SIZE=1024;b.TEXTURE_BINDING_SPRITE_ATLAS=
0;b.TEXTURE_BINDING_GLYPH_ATLAS=0;b.TEXTURE_BINDING_BITMAP=0;b.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1;b.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2;b.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3;b.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4;b.TEXTURE_BINDING_HIGHLIGHT_0=5;b.TEXTURE_BINDING_HIGHLIGHT_1=6;b.TEXTURE_BINDING_RENDERER_0=5;b.TEXTURE_BINDING_RENDERER_1=6;b.ATTRIBUTE_DATA_FILTER_FLAGS=0;b.ATTRIBUTE_DATA_ANIMATION=1;b.ATTRIBUTE_DATA_VV=2;b.ATTRIBUTE_DATA_DD0=3;b.ATTRIBUTE_DATA_DD1=3;b.MAX_FILTERS=2;b.HIGHLIGHT_FLAG=1;b.FILTER_FLAG_0=
2;b.EFFECT_FLAG_0=4;b.THIN_LINE_THRESHOLD=2.5;b.HITTEST_SEARCH_SIZE=24;b.MAX_ANIMATION_TIME_MS=2E3})},"esri/views/2d/engine/webgl/Painter":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl ../../engine ./BitBlitRenderer ./enums ./MaterialManager ./TextureManager ./effects/AnimationEffect ./effects/HighlightEffect ./effects/HittestEffect ./painter/RenderPass".split(" "),function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(){}}();
b.PainterOptions=n;n=function(){function b(b){this.context=b;this._blitRenderer=new a.BitBlitRenderer;this._brushCache=new Map;this.textureManager=new d;this.effects={highlight:new c.default,hittest:new q.HittestEffect,integrate:new f.AnimationEffect};this.materialManager=new e(b)}b.prototype.getFbos=function(a,b,c){if(b!==this._lastWidth||c!==this._lastHeight){this._lastWidth=b;this._lastHeight=c;if(this._fbos)for(var d in this._fbos)this._fbos[d].dispose();a={target:3553,pixelFormat:6408,dataType:5121,
samplingMode:9728,wrapMode:33071,width:b,height:c};d={colorTarget:0,depthStencilTarget:3};b=new k.Renderbuffer(this.context,{width:b,height:c,internalFormat:34041});this._fbos={output:k.FramebufferObject.createWithAttachments(this.context,a,d,b),alpha:k.FramebufferObject.createWithAttachments(this.context,a,d,b),effect0:k.FramebufferObject.createWithAttachments(this.context,a,d,b)}}return this._fbos};b.prototype.beforeRenderLayers=function(a){var b=a.getViewport(),b=this.getFbos(a,b.width,b.height);
this._prevFBO=a.getBoundFramebufferObject();a.bindFramebuffer(b.output);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT)};b.prototype.beforeRenderLayer=function(a,b,c){1!==c?(a.bindFramebuffer(this._fbos.alpha),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT)):a.bindFramebuffer(this._fbos.output);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setStencilTestEnabled(!0);a.setClearStencil(b);a.setStencilWriteMask(255);a.clear(a.gl.STENCIL_BUFFER_BIT)};b.prototype.compositeLayer=
function(a,b){1!==b&&(a.bindFramebuffer(this._fbos.output),a.setStencilTestEnabled(!1),a.setStencilWriteMask(0),a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(1,771,1,771),a.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(a,this._fbos.alpha.colorTexture,9728,b))};b.prototype.renderLayers=function(a){a.bindFramebuffer(this._prevFBO);this._fbos&&(a.setStencilTestEnabled(!1),a.setStencilWriteMask(0),a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(1,771,1,771),a.setColorMask(!0,!0,!0,!0),
this._blitRenderer.render(a,this._fbos.output.colorTexture,9728,1))};b.prototype.dispose=function(){this.materialManager.dispose();this.textureManager.dispose();this.effects.highlight.dispose();this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null)};b.prototype.getGeometryBrush=function(a){var b;a=(b={},b[g.WGLGeometryType.FILL]=h.brushes.Fill,b[g.WGLGeometryType.LINE]=h.brushes.Line,b[g.WGLGeometryType.MARKER]=h.brushes.Marker,b[g.WGLGeometryType.TEXT]=h.brushes.Text,b)[a];this._brushCache.has(a)||
this._brushCache.set(a,new a);return this._brushCache.get(a)};b.prototype.registerRenderPass=function(a){var b=this,c=a.brushes.map(function(a){b._brushCache.has(a)||b._brushCache.set(a,new a);return b._brushCache.get(a)});return new p.default(c,a)};b.prototype.setHighlightOptions=function(a){this.effects.highlight.setHighlightOptions(a)};return b}();b.default=n})},"esri/views/2d/engine/webgl/MaterialManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../webgl ./enums ./shaders/MaterialPrograms".split(" "),
function(n,b,l,k,h,a,g){var e=function(b){return b===a.WGLDrawPhase.HITTEST||b===a.WGLDrawPhase.LABEL_ALPHA},d=function(b,c,d,g){g=g.reduce(function(a,c){var d;return l({},a,(d={},d[c]=b.driverTestResult[c],d))},{});c=l({},c.getVariation(),b.rendererInfo.getVariation(),{highlight:b.drawPhase===a.WGLDrawPhase.HIGHLIGHT,id:e(b.drawPhase)},g);if(k.isSome(d))for(g=0;g<d.length;g++)c[d[g]]=!0;return c};return function(){function b(a){this._programByKey=new Map;this._programCache=new h.ProgramCache(a)}
b.prototype.dispose=function(){this._programCache&&this._programCache.dispose()};b.prototype.getProgram=function(a,b,d,e){void 0===d&&(d=[]);void 0===e&&(e=[]);var c=b.path+d.join(".")+e.join(".");if(this._programByKey.has(c))return this._programByKey.get(c);e=e.reduce(function(b,c){var d;return l({},b,(d={},d[c]=a.driverTestResult[c],d))},{});d=l({},d.reduce(function(a,b){var c;return l({},a,(c={},c[b]=!0,c))},{}),e);b=this._programCache.getProgram(g.createProgramTemplate(b.path,b.attributes),d);
if(!b)throw Error("Unable to get program for key: ${key}");this._programByKey.set(c,b);return b};b.prototype.getMaterialProgram=function(b,f,h,l,t,x){void 0===x&&(x=["ignoresSamplerPrecision"]);var c,p=x;c=b.rendererInfo;var q=b.drawPhase,p=f.getVariationHash()+"-"+p.join(".")+"-",q=(e(q)?1:0)|(q===a.WGLDrawPhase.HIGHLIGHT?2:0);c=p+q+"-"+c.getVariationHash()+"-"+(k.isSome(t)&&t.join("."));if(this._programByKey.has(c))return this._programByKey.get(c);b=d(b,f,t,x);h=this._programCache.getProgram(g.createProgramTemplate(h,
l),b);if(!h)throw Error("Unable to get program for key: ${key}");this._programByKey.set(c,h);return h};return b}()})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});var h=function(a){var b={},e;for(e in a){for(var d=e,f=void 0,f=""+d[0].toUpperCase(),c=1;c<d.length;c++){var h=d[c];h===h.toUpperCase()?(f+="_",f+=h):f+=h.toUpperCase()}b[f]=a[e]}return l.glslifyDefineMap(b)};
b.createProgramTemplate=function(a,b){var e=a+a.substring(a.lastIndexOf("/"));return{name:name,attributes:b,shaders:function(a){return{vertexShader:h(a)+k.resolveIncludes(e+".vert"),fragmentShader:h(a)+k.resolveIncludes(e+".frag")}}}}})},"esri/views/2d/engine/webgl/TextureManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../config ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../symbols/cim/Rasterizer ./definitions ./enums ./fontUtils ./GlyphMosaic ./GlyphSource ./SDFConverter ./SpriteMosaic ./util/Result ./util/symbolUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B){var C=p.vec2f32.create(),D=f.getLogger("esri.views.2d.engine.webgl.TextureManager"),K=function(){function a(a,b,c){this.mosaicType=a;this.page=b;this.sdf=c}a.fromMosaic=function(b,c){return new a(b,c.page,c.sdf)};return a}();return function(){function b(){this._invalidFontsMap=new Map;this._sdfConverter=new m.default(126);this._bindingInfos=[];this._hashToBindingIndex=new Map;this._rasterizer=new r.default;this._spriteMosaic=new v(2048,2048,
500);this._glyphSource=new y(a.fontsUrl+"/{fontstack}/{range}.pbf");this._glyphMosaic=new u(1024,1024,this._glyphSource)}Object.defineProperty(b.prototype,"sprites",{get:function(){return this._spriteMosaic},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glyphs",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();this._rasterizer.dispose();this._rasterizer=this._glyphMosaic=
this._spriteMosaic=null};b.prototype._hashMosaic=function(a,b){return 1|a<<1|(b.sdf?1:0)<<2|b.page<<3};b.prototype._setTextureBinding=function(a,b){var c=this._hashMosaic(a,b);this._hashToBindingIndex.has(c)||(a=K.fromMosaic(a,b),this._hashToBindingIndex.set(c,this._bindingInfos.length+1),this._bindingInfos.push(a));b.textureBinding=this._hashToBindingIndex.get(c)};b.prototype.rasterizeItem=function(a,b,f){var g=this;void 0===b&&(b=null);return a?a.type&&-1!==a.type.toLowerCase().indexOf("3d")?(D.error(new d("mapview-invalid-type",
"MapView does not support 3d symbol type: "+a.type,a)),c.resolve({glyphMosaicItems:[],spriteMosaicItem:null})):!a.type||"text"!==a.type&&"esriTS"!==a.type&&"CIMTextSymbol"!==a.type?e.safeCast(this._rasterizeSpriteSymbol(a,f)).then(function(a){z.ok(a)&&a&&g._setTextureBinding(x.MosaicType.SPRITE,a);return{spriteMosaicItem:a}}):this._rasterizeTextSymbol(a,b,f).then(function(a){a.forEach(function(a){return g._setTextureBinding(x.MosaicType.GLYPH,a)});return{glyphMosaicItems:a}}):(D.error(new d("mapview-null-resource",
"Unable to rasterize null resource")),c.resolve(null))};b.prototype.bindTextures=function(a,b,c,d){void 0===d&&(d=1);if(0!==c.textureBinding){var e=this._bindingInfos[c.textureBinding-1];c=e.page;switch(e.mosaicType){case x.MosaicType.SPRITE:e=this.sprites.getWidth(c)/d;d=this.sprites.getHeight(c)/d;d=q.vec2.set(C,e,d);this._bindSpritePage(a,c,t.TEXTURE_BINDING_SPRITE_ATLAS,9729);b.setUniform1i("u_texture",t.TEXTURE_BINDING_SPRITE_ATLAS);b.setUniform2fv("u_mosaicSize",d);break;case x.MosaicType.GLYPH:e=
this.glyphs.width/d;d=this.glyphs.height/d;d=q.vec2.set(C,e,d);this._bindGlyphsPage(a,c,t.TEXTURE_BINDING_GLYPH_ATLAS);b.setUniform1i("u_texture",t.TEXTURE_BINDING_GLYPH_ATLAS);b.setUniform2fv("u_mosaicSize",d);break;default:D.error("mapview-texture-manager","Cannot handle unknown type "+e.mosaicType)}}};b.prototype._bindSpritePage=function(a,b,c,d){d||(d=9729);this._spriteMosaic.bind(a,d,b,c)};b.prototype._bindGlyphsPage=function(a,b,c){this._glyphMosaic.bind(a,9729,b,c)};b.prototype._rasterizeTextSymbol=
function(a,b,c){var e=this,f=w.getFullyQualifiedFontName(a.font);a=this._invalidFontsMap.has(f);return this._glyphMosaic.getGlyphItems(a?"arial-unicode-ms-regular":f,b,c).catch(function(a){D.error(new d("mapview-invalid-resource","Couldn't find font "+f+". Falling back to Arial Unicode MS Regular"));e._invalidFontsMap.set(f,!0);return e._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",b,c)})};b.prototype._rasterizeSpriteSymbol=function(a,b){return k(this,void 0,void 0,function(){var c,e,f,g,
k,m;return h(this,function(h){h="CIMSolidStroke"===a.type||"CIMSolidFill"===a.type?!0:a&&(B.isFillSymbol(a)||B.isLineSymbol(a))&&"style"in a&&("solid"===a.style||"esriSFSSolid"===a.style||"esriSLSSolid"===a.style||"none"===a.style||"esriSFSNull"===a.style||"esriSLSNull"===a.style);if(h)return[2,null];c=B.keyFromSymbol(a);return this._spriteMosaic.has(c)?[2,this._spriteMosaic.getSpriteItem(c)]:"simple-marker"!==a.type&&"esriSMS"!==a.type||!a.path?a.url||a.imageData?[2,this._handleImage(a,c,b)]:(e=
this._rasterizer.rasterizeJSONResource(a))?(f=e.size,g=e.image,k=e.sdf,m=e.simplePattern,[2,this._addItemToMosaic(c,f,g,!B.isMarkerSymbol(a),k,m)]):[2,new d("TextureManager","unrecognized or null rasterized image")]:[2,this._handleSVG(a,c,b)]})})};b.prototype._handleSVG=function(a,b,c){return k(this,void 0,void 0,function(){var d,e;return h(this,function(f){switch(f.label){case 0:return d=[126,126],[4,this._sdfConverter.draw(a.path,c)];case 1:return e=f.sent(),[2,this._addItemToMosaic(b,d,new Uint32Array(e.buffer),
!1,!0,!0)]}})})};b.prototype._handleImage=function(a,b,e){return k(this,void 0,void 0,function(){var f,k,m,p,q,r,v;return h(this,function(h){switch(h.label){case 0:f=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,g(f,l({responseType:"image"},e))];case 2:return k=h.sent().data,m=this._rasterizer.rasterizeImageResource(k,a.colorSubstitutions),p=m.size,q=m.sdf,r=m.image,[2,this._addItemToMosaic(b,p,r,!B.isMarkerSymbol(a),q,!1)];case 3:return v=
h.sent(),c.isAbortError(v)?[3,4]:[2,new d("mapview-invalid-resource","Could not fetch requested resource at "+f)];case 4:return[2,void 0]}})})};b.prototype._addItemToMosaic=function(a,b,c,d,e,f){return this._spriteMosaic.addSpriteItem(a,b,c,d,e,f)};return b}()})},"esri/views/2d/engine/webgl/fontUtils":function(){define(["require","exports"],function(n,b){function l(b){b=b.toLowerCase().split(" ").join("-");switch(b){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";
case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return b}}Object.defineProperty(b,"__esModule",{value:!0});b.getFullyQualifiedFontName=function(b){var h;a:{if(b.weight)switch(b.weight.toLowerCase()){case "bold":case "bolder":h="-bold";break a}h=""}var a;a:{if(b.style)switch(b.style.toLowerCase()){case "italic":case "oblic":a="-italic";break a}a=""}h+=a;return l(b.family)+(0<h.length?h:"-regular")};b.getFontDecorationTop=function(b){switch(b){case "underline":return-26;
case "line-through":return-18}return NaN}})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("require exports ../../../../core/has ../../../../core/promiseUtils ../../../webgl ./Rect ./RectangleBinPack".split(" "),function(n,b,l,k,h,a,g){return function(){function b(a,b,c){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=a;this.height=b;this._glyphSource=c;this._binPack=new g(a-
4,b-4);this._glyphData.push(new Uint8Array(a*b));this._dirties.push(!0);this._textures.push(void 0);this._addDecorationGlyph()}b.prototype.getGlyphItems=function(a,b,c){for(var d=this,e=[],f=this._glyphSource,g=new Set,h=1/256,l=0;l<b.length;l++)g.add(Math.floor(b[l]*h));var u=[];g.forEach(function(b){if(256>=b){var e=a+b;d._rangePromises.has(e)?u.push(d._rangePromises.get(e)):(b=f.getRange(a,b,c).then(function(){d._rangePromises["delete"](e)}).catch(function(a){d._rangePromises["delete"](e);if(!k.isAbortError(a))throw Error("Unable to query resource");
}),d._rangePromises.set(e,b),u.push(b))}});return k.all(u).then(function(c){var g=d._glyphIndex[a];g||(g={},d._glyphIndex[a]=g);for(var h=0;h<b.length;h++){c=b[h];var k=g[c];if(k)e[c]={sdf:!0,rect:k.rect,metrics:k.metrics,page:k.page};else if((k=f.getGlyph(a,c))&&k.metrics){var p=d._recordGlyph(k,c);g[c]={rect:p,metrics:k.metrics,tileIDs:null,page:d._currentPage};e[c]={sdf:!0,rect:p,metrics:k.metrics,page:d._currentPage};d._dirties[d._currentPage]=!0}}return e})};b.prototype._recordGlyph=function(b,
e){var c=b.metrics;if(0===c.width)c=new a.default(0,0,0,0);else{e=c.width+6;var d=c.height+6,f=e%4?4-e%4:4,h=d%4?4-d%4:4;1===f&&(f=5);1===h&&(h=5);c=this._binPack.allocate(e+f,d+h);c.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new g(this.width-4,this.height-4),c=this._binPack.allocate(e+f,d+
h));f=this._glyphData[this._currentPage];b=b.bitmap;var k=h=void 0;if(b)for(var l=0;l<d;l++)for(var h=e*l,k=this.width*(c.y+l+1)+c.x,n=0;n<e;n++)f[k+n+1]=b[h+n]}return c};b.prototype._addDecorationGlyph=function(){for(var a=[117,149,181,207,207,181,149,117],b=[],c=0;c<a.length;c++)for(var e=a[c],g=0;11>g;g++)b.push(e);a={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(b)};this._recordGlyph(a,0)};b.prototype.bind=function(a,b,c,e){this._textures[c]||(this._textures[c]=new h.Texture(a,
{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var d=this._textures[c];d.setSamplingMode(b);this._dirties[c]&&d.setData(this._glyphData[c]);a.bindTexture(d,e);this._dirties[c]=!1};b.prototype.dispose=function(){this._binPack=null;for(var a=0,b=this._textures;a<b.length;a++){var c=b[a];c&&c.dispose()}this._textures.length=0;this._glyphData.length=0};return b}()})},"esri/views/2d/engine/webgl/Rect":function(){define(["require","exports"],
function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,h,a,g){void 0===b&&(b=0);void 0===h&&(h=0);void 0===a&&(a=0);void 0===g&&(g=0);this.x=b;this.y=h;this.width=a;this.height=g}Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});b.prototype.union=function(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);this.width=Math.max(this.width,b.width);this.height=Math.max(this.height,
b.height)};return b}();b.default=n})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["require","exports","./Rect"],function(n,b,l){return function(){function b(b,a){this._height=this._width=0;this._free=[];this._width=b;this._height=a;this._free.push(new l.default(0,0,b,a))}Object.defineProperty(b.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});
b.prototype.allocate=function(b,a){if(b>this._width||a>this._height)return new l.default;for(var g=null,e=-1,d=0;d<this._free.length;++d){var f=this._free[d];b<=f.width&&a<=f.height&&(null===g||f.y<=g.y&&f.x<=g.x)&&(g=f,e=d)}if(null===g)return new l.default;this._free.splice(e,1);g.width<g.height?(g.width>b&&this._free.push(new l.default(g.x+b,g.y,g.width-b,a)),g.height>a&&this._free.push(new l.default(g.x,g.y+a,g.width,g.height-a))):(g.width>b&&this._free.push(new l.default(g.x+b,g.y,g.width-b,g.height)),
g.height>a&&this._free.push(new l.default(g.x,g.y+a,b,g.height-a)));return new l.default(g.x,g.y,b,a)};b.prototype.release=function(b){for(var a=0;a<this._free.length;++a){var g=this._free[a];if(g.y===b.y&&g.height===b.height&&g.x+g.width===b.x)g.width+=b.width;else if(g.x===b.x&&g.width===b.width&&g.y+g.height===b.y)g.height+=b.height;else if(b.y===g.y&&b.height===g.height&&b.x+b.width===g.x)g.x=b.x,g.width+=b.width;else if(b.x===g.x&&b.width===g.width&&b.y+b.height===g.y)g.y=b.y,g.height+=b.height;
else continue;this._free.splice(a,1);this.release(b)}this._free.push(b)};return b}()})},"esri/views/2d/engine/webgl/GlyphSource":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../request ../../../../core/pbf ../../../../core/promiseUtils".split(" "),function(n,b,l,k,h,a){var g=function(){function a(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:for(var b=a.getMessage();b.next();)switch(b.tag()){case 3:for(var d=b.getMessage(),e=void 0,
f=void 0,g=void 0,h=void 0,k=void 0,l=void 0,y=void 0;d.next();)switch(d.tag()){case 1:e=d.getUInt32();break;case 2:f=d.getBytes();break;case 3:g=d.getUInt32();break;case 4:h=d.getUInt32();break;case 5:k=d.getSInt32();break;case 6:l=d.getSInt32();break;case 7:y=d.getUInt32();break;default:d.skip()}d.release();e&&(this._metrics[e]={width:g,height:h,left:k,top:l,advance:y},this._bitmaps[e]=f);break;default:b.skip()}b.release();break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};
a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),e=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,b){this._ranges[a]=b};return a}();return function(){function b(a){this._glyphInfo={};this._baseURL=a}b.prototype.getRange=function(b,c,d){var e=this._getFontStack(b);if(e.getRange(c))return a.resolve();var f=256*c,q=f+255;b=this._baseURL.replace("{fontstack}",b).replace("{range}",f+"-"+q);return k(b,
l({responseType:"array-buffer"},d)).then(function(a){e.addRange(c,new g(new h(new Uint8Array(a.data),new DataView(a.data))))})};b.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}};b.prototype._getFontStack=function(a){var b=this._glyphInfo[a];b||(b=this._glyphInfo[a]=new e);return b};return b}()})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["require","exports",
"../../../../core/promiseUtils","../../../../core/promiseUtils","./packingUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this.size=a;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=a;this.context=this.canvas.getContext("2d");this._gridOuter=new Float64Array(a*a);this._gridInner=new Float64Array(a*a);this._f=new Float64Array(a);this._d=new Float64Array(a);this._z=new Float64Array(a+1);this._v=new Int16Array(a)}
a.prototype.draw=function(a,b,d){var e=this;void 0===d&&(d=31);this._initSVG();var c=this._createSVGString(a);return l.create(function(a,f){var g=new Image;g.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(c);g.onload=function(){e.context.clearRect(0,0,e.size,e.size);e.context.drawImage(g,0,0,e.size,e.size);for(var b=e.context.getImageData(0,0,e.size,e.size),c=new Uint8Array(e.size*e.size*4),f=0;f<e.size*e.size;f++){var k=b.data[4*f+3]/255;e._gridOuter[f]=1===k?0:0===k?1E20:Math.pow(Math.max(0,
.5-k),2);e._gridInner[f]=1===k?1E20:0===k?0:Math.pow(Math.max(0,k-.5),2)}e._edt(e._gridOuter,e.size,e.size);e._edt(e._gridInner,e.size,e.size);for(f=0;f<e.size*e.size;f++)h.packFloatRGBA(.5-(e._gridOuter[f]-e._gridInner[f])/(2*d),c,4*f);a(c)};var p=b&&b.signal;if(p)k.onAbort(p,function(){return f(k.createAbortError())})})};a.prototype._initSVG=function(){if(!this._svg){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("style","position: absolute;");a.setAttribute("width",
"0");a.setAttribute("height","0");a.setAttribute("aria-hidden","true");a.setAttribute("role","presentation");document.body.appendChild(a);this._svg=a}};a.prototype._createSVGString=function(a){var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d",a);this._svg.appendChild(b);a=b.getBBox();var d=a.width/a.height,f=this.size/2,c,g,h;1<d?(g=c=f/a.width,h=this.size/4,d=f-1/d*f/2):(c=g=f/a.height,h=f-f*d/2,d=this.size/4);b.setAttribute("style","transform: matrix("+c+", 0, 0, "+
g+", "+(-a.x*c+h)+", "+(-a.y*g+d)+")");a='\x3csvg style\x3d"fill:red;" height\x3d"'+this.size+'" width\x3d"'+this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(b);return a};a.prototype._edt=function(a,b,d){for(var e=this._f,c=this._d,g=this._v,h=this._z,k=0;k<b;k++){for(var l=0;l<d;l++)e[l]=a[l*b+k];this._edt1d(e,c,g,h,d);for(l=0;l<d;l++)a[l*b+k]=c[l]}for(l=0;l<d;l++){for(k=0;k<b;k++)e[k]=a[l*b+k];this._edt1d(e,c,g,h,b);for(k=0;k<b;k++)a[l*
b+k]=Math.sqrt(c[k])}};a.prototype._edt1d=function(a,b,d,f,c){d[0]=0;f[0]=-1E20;f[1]=1E20;for(var e=1,g=0;e<c;e++){for(var h=(a[e]+e*e-(a[d[g]]+d[g]*d[g]))/(2*e-2*d[g]);h<=f[g];)g--,h=(a[e]+e*e-(a[d[g]]+d[g]*d[g]))/(2*e-2*d[g]);g++;d[g]=e;f[g]=h;f[g+1]=1E20}for(g=e=0;e<c;e++){for(;f[g+1]<e;)g++;b[e]=(e-d[g])*(e-d[g])+a[d[g]]}};return a}();b.default=n})},"esri/views/2d/engine/webgl/packingUtils":function(){define(["require","exports"],function(n,b){function l(a){return a-Math.floor(a)}Object.defineProperty(b,
"__esModule",{value:!0});var k=[1,256,65536,16777216],h=[1/256,1/65536,1/16777216,1/4294967296],a=function(a,b){void 0===b&&(b=0);for(var d=0,e=0;4>e;e++)d+=a[b+e]*h[e];return d}(new Uint8ClampedArray([255,255,255,255]));b.packFloatRGBA=function(b,e,d){void 0===d&&(d=0);b=0>b?0:b>a?a:b;for(var f=0;4>f;f++)e[d+f]=Math.floor(256*l(b*k[f]))}})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("require exports ../../../../core/has ../../../webgl ./GeometryUtils ./Rect ./RectangleBinPack".split(" "),
function(n,b,l,k,h,a,g){return function(){function b(a,b,c){void 0===c&&(c=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._currentPage=this._maxItemSize=0;this._fixSpriteLocationsTable=l("fix-sprite-locations");this._testId=l("test-id");this._pageHeight=this._pageWidth=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=a||0>=b)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=
b;0<c&&(this._maxItemSize=c);this.pixelRatio=window.devicePixelRatio||1;if(this._fixSpriteLocationsTable){a=[];for(var d in this._fixSpriteLocationsTable[this._testId])b=this._fixSpriteLocationsTable[this._testId][d],a[b.page]=b.pageSize;for(d=0;d<a.length;d++)b=a[d],this._mosaicsData.push(new Uint32Array(b[0]*b[1])),this._dirties.push(!0),this._size.push([b[0],b[1]]),this._textures.push(void 0)}this._binPack=new g(this._pageWidth,this._pageHeight);this._mosaicsData.push(new Uint32Array(Math.floor(this._pageWidth)*
Math.floor(this._pageHeight)));this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}b.prototype.getWidth=function(a){return a>=this._size.length?-1:this._size[a][0]};b.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};b.prototype.getPage=function(a){return a<this._textures.length?this._textures[a]:null};b.prototype.has=function(a){return this._mosaicRects.has(a)};Object.defineProperty(b.prototype,"itemCount",{get:function(){return this._mosaicRects.size},
enumerable:!0,configurable:!0});b.prototype.getSpriteItem=function(a){return this._mosaicRects.get(a)};b.prototype.addSpriteItem=function(a,b,c,e,g,h){var d;if(this._mosaicRects.has(a))return this._mosaicRects.get(a);var f,k;this._fixSpriteLocationsTable&&this._fixSpriteLocationsTable[this._testId]&&this._fixSpriteLocationsTable[this._testId][a]?(d=this._fixSpriteLocationsTable[this._testId][a],f=d.rect,k=d.page,d=d.pageSize):(d=this._allocateImage(b[0],b[1]),f=d[0],k=d[1],d=d[2]);if(0>=f.width||
0>=f.height)return null;h={rect:f,width:b[0],height:b[1],sdf:g,simplePattern:h,pixelRatio:1,page:k};this._mosaicRects.set(a,h);this._copy({rect:f,spriteSize:b,spriteData:c,page:k,pageSize:d,repeat:e,sdf:g});return h};b.prototype.hasItemsToProcess=function(){return 0!==this._spriteCopyQueue.length};b.prototype.processNextItem=function(){var a=this._spriteCopyQueue.pop();a&&this._copy(a)};b.prototype.getSpriteItems=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d]=this.getSpriteItem(d)}return b};
b.prototype.getMosaicItemPosition=function(a,b){b=(a=this.getSpriteItem(a))&&a.rect;if(!b)return null;b.width=a.width;b.height=a.height;return{size:[a.width,a.height],tl:[(b.x+1)/this._size[a.page][0],(b.y+1)/this._size[a.page][1]],br:[(b.x+1+a.width)/this._size[a.page][0],(b.y+1+a.height)/this._size[a.page][1]],page:a.page}};b.prototype.bind=function(a,b,c,e){void 0===c&&(c=0);void 0===e&&(e=0);this._textures[c]||(this._textures[c]=new k.Texture(a,{pixelFormat:6408,dataType:5121,width:this._size[c][0],
height:this._size[c][1]},new Uint8Array(this._mosaicsData[c].buffer)));var d=this._textures[c];d.setSamplingMode(b);this._dirties[c]&&(d.setData(new Uint8Array(this._mosaicsData[c].buffer)),d.generateMipmap());a.bindTexture(d,e);this._dirties[c]=!1};b._copyBits=function(a,b,c,e,g,h,k,l,n,u,y){var d=e*b+c;k=l*h+k;if(y)for(k-=h,y=-1;y<=u;y++,d=((y+u)%u+e)*b+c,k+=h)for(l=-1;l<=n;l++)g[k+l]=a[d+(l+n)%n];else for(y=0;y<u;y++){for(l=0;l<n;l++)g[k+l]=a[d+l];d+=b;k+=h}};b.prototype._copy=function(a){if(!(a.page>=
this._mosaicsData.length)){var d=a.spriteData,c=this._mosaicsData[a.page];c&&d||console.error("Source or target images are uninitialized!");b._copyBits(d,a.spriteSize[0],0,0,c,a.pageSize[0],a.rect.x+1,a.rect.y+1,a.spriteSize[0],a.spriteSize[1],a.repeat);this._dirties[a.page]=!0}};b.prototype._allocateImage=function(b,e){b+=2;e+=2;var c=Math.max(b,e);if(this._maxItemSize&&this._maxItemSize<c){var c=Math.pow(2,Math.ceil(h.log2(b))),d=Math.pow(2,Math.ceil(h.log2(e)));b=new a.default(0,0,b,e);this._mosaicsData.push(new Uint32Array(c*
d));this._dirties.push(!0);this._size.push([c,d]);this._textures.push(void 0);return[b,this._mosaicsData.length-1,[c,d]]}c=this._binPack.allocate(b,e);return 0>=c.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new g(this._pageWidth,
this._pageHeight),this._allocateImage(b,e)):[c,this._currentPage,[this._pageWidth,this._pageHeight]]};b.prototype.dispose=function(){this._binPack=null;for(var a=0,b=this._textures;a<b.length;a++){var c=b[a];c&&c.dispose()}this._textures.length=0;this._mosaicsData.length=0;this._mosaicRects.clear()};return b}()})},"esri/views/2d/engine/webgl/util/Result":function(){define(["require","exports","../../../../../core/Error"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.ok=function(b,
h){return b&&"name"in b?(h&&h.error(new l(b.name,b.message,b.details)),!1):!0}})},"esri/views/2d/engine/webgl/util/symbolUtils":function(){define(["require","exports"],function(n,b){function l(b){switch(b){case "esriSMS":return"simple-marker";case "esriPMS":return"picture-marker";case "esriSLS":return"simple-line";case "esriPLS":return"picture-line";case "esriSFS":return"simple-fill";case "esriPFS":return"picture-fill";case "esriTS":return"text"}return b}function k(b){if(b=l(b.type))switch(b){case "picture-marker":case "picture-line":case "picture-fill":return!0;
case "CIMPictureMarker":return!0}return!1}Object.defineProperty(b,"__esModule",{value:!0});b.keyFromSymbol=function(b){if(b.type){switch(l(b.type)){case "simple-marker":return b.path?"simple-marker"+b.style+b.path:"simple-marker"+b.style;case "simple-line":return"simple-line"+b.style+b.cap;case "simple-fill":return"simple-fill"+b.style}if(b.mosaicHash)return b.mosaicHash;if(k(b))return b.imageData?b.imageData:b.url+(""+b.width+b.height)}return JSON.stringify(b)};b.normalizeSymbolType=l;b.isMarkerSymbol=
function(b){if(b=l(b.type)){switch(b){case "simple-marker":case "picture-marker":return!0;case "CIMPointSymbol":return!0;case "CIMVectorMarker":case "CIMPictureMarker":case "CIMCharacterMarker":return!0}return!1}};b.isFillSymbol=function(b){if(b=l(b.type)){switch(b){case "simple-fill":case "picture-fill":return!0;case "CIMPolygonSymbol":return!0}return!1}};b.isLineSymbol=function(b){if(b=l(b.type)){switch(b){case "simple-line":case "picture-line":return!0;case "CIMLineSymbol":return!0}return!1}};
b.isPictureSymbol=k;b.isTextSymbol=function(b){if(b=l(b.type)){switch(b){case "text":return!0;case "CIMTextSymbol":return!0}return!1}}})},"esri/views/2d/engine/webgl/effects/AnimationEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/maybe ../definitions ../VertexStream ./Effect".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.defines=
[];a._desc={path:"fx/integrate",attributes:{a_position:0}};return a}l(d,b);d.prototype.bind=function(a){};d.prototype.unbind=function(a){};d.prototype.draw=function(b,c){if(c.size){var d=b.context,e=b.renderingOptions;this._quad||(this._quad=new a(d,[0,0,1,0,0,1,1,1]));var f=d.getBoundFramebufferObject(),g=d.getViewport(),l=g.x,n=g.y,u=g.width,g=g.height;c.bindTextures(d);var y=c.getBlock(h.ATTRIBUTE_DATA_ANIMATION);if(!k.isNone(y)){var m=y.getFBO(d),y=y.getFBO(d,1);d.setViewport(0,0,c.size,c.size);
this._computeDelta(b,y,e.labelsAnimationTime);this._updateAnimationState(b,y,m);d.bindFramebuffer(f);d.setViewport(l,n,u,g)}}};d.prototype._computeDelta=function(a,b,d){var c=a.context,e=a.displayLevel,f=a.painter.materialManager.getProgram(a,this._desc,["delta"]);c.bindFramebuffer(b);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(f);f.setUniform1i("u_maskTexture",h.TEXTURE_BINDING_ATTRIBUTE_DATA_0);f.setUniform1i("u_sourceTexture",h.TEXTURE_BINDING_ATTRIBUTE_DATA_1);f.setUniform1f("u_timeDelta",
a.timeDelta);f.setUniform1f("u_animationTime",d/1E3);f.setUniform1f("u_zoomLevel",Math.round(10*e));this._quad.draw()};d.prototype._updateAnimationState=function(a,b,d){var c=a.context;a=a.painter.materialManager.getProgram(a,this._desc,["update"]);c.bindTexture(b.colorTexture,1);c.bindProgram(a);a.setUniform1i("u_sourceTexture",1);c.bindFramebuffer(d);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);this._quad.draw()};return d}(g.Effect);b.AnimationEffect=n})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["require",
"exports","../../../../core/tsSupport/declareExtendsHelper","../../../webgl"],function(n,b,l,k){return function(){function b(a,b){this.rctx=a;this._vertexBuffer=k.BufferObject.createVertex(a,35044,new Uint16Array(b));this._vao=new k.VertexArrayObject(a,{a_position:0},{geometry:[{name:"a_position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:this._vertexBuffer})}b.prototype.bind=function(){this._vao.bind()};b.prototype.unbind=function(){this._vao.unbind()};b.prototype.dispose=function(){this._vao.dispose(!1);
this._vertexBuffer.dispose()};b.prototype.draw=function(){this.rctx.bindVAO(this._vao);this.rctx.drawArrays(5,0,4)};return b}()})},"esri/views/2d/engine/webgl/effects/Effect":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(){this.name=this.constructor.name}}();b.Effect=n})},"esri/views/2d/engine/webgl/effects/HighlightEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/has ../BitBlitRenderer ../effects/Effect ./highlight/HighlightGradient ./highlight/HighlightRenderer ./highlight/HighlightSurfaces".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.defines=["highlight"];b._hlRenderer=new e.default;b._hlGradient=new g.default;b._width=void 0;b._height=void 0;b._hlSurfaces=new d.default;b._adjustedWidth=void 0;b._adjustedHeight=void 0;b._blitRenderer=new h.BitBlitRenderer;return b}l(b,a);b.prototype.dispose=function(){this._hlSurfaces&&this._hlSurfaces.dispose();this._hlRenderer&&this._hlRenderer.dispose();
this._hlGradient&&this._hlGradient.destroy();this._boundFBO=null};b.prototype.bind=function(a){var b=a.context,c=a.painter,d=b.getViewport(),e=d.width,d=d.height,c=c.getFbos(b,e,d).effect0;this.setup(a,e,d);b.bindFramebuffer(c);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT)};b.prototype.unbind=function(a){};b.prototype.setup=function(a,b,c){a=a.context;this._width=b;this._height=c;var d=b%4,e=c%4;b+=2>d?-d:4-d;c+=2>e?-e:4-e;this._adjustedWidth=b;this._adjustedHeight=c;this._boundFBO=a.getBoundFramebufferObject();
b=Math.round(.75*b);c=Math.round(.75*c);this._hlRenderer.setup(a,b,c);this._hlSurfaces.setup(a,b,c)};b.prototype.draw=function(a){a=a.context;var b=a.getBoundFramebufferObject();a.setViewport(0,0,.75*this._adjustedWidth,.75*this._adjustedHeight);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setStencilTestEnabled(!1);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._blitRenderer.render(a,b.colorTexture,9728,1);a.setStencilTestEnabled(!1);a.setBlendingEnabled(!1);a.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);
a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.preBlur(a,this._hlSurfaces.sharedBlur1Tex);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex);a.bindFramebuffer(this._boundFBO);a.setBlendingEnabled(!0);a.setViewport(0,0,this._width,this._height);this._hlRenderer.renderHighlight(a,this._hlSurfaces.sharedBlur1Tex,this._hlGradient);this._boundFBO=null};b.prototype.setHighlightOptions=
function(a){this._hlGradient.setHighlightOptions(a)};return b}(a.Effect);b.default=n})},"esri/views/2d/engine/webgl/effects/highlight/HighlightGradient":function(){define("require exports ../../../../../../core/Logger ../../../../../webgl ../../definitions ./parameters".split(" "),function(n,b,l,k,h,a){function g(b,c){c.fillColor[0]=b.color.r/255;c.fillColor[1]=b.color.g/255;c.fillColor[2]=b.color.b/255;c.fillColor[3]=b.color.a;b.haloColor?(c.outlineColor[0]=b.haloColor.r/255,c.outlineColor[1]=b.haloColor.g/
255,c.outlineColor[2]=b.haloColor.b/255,c.outlineColor[3]=b.haloColor.a):(c.outlineColor[0]=c.fillColor[0],c.outlineColor[1]=c.fillColor[1],c.outlineColor[2]=c.fillColor[2],c.outlineColor[3]=c.fillColor[3]);c.fillColor[3]*=b.fillOpacity;c.outlineColor[3]*=b.haloOpacity;c.fillColor[0]*=c.fillColor[3];c.fillColor[1]*=c.fillColor[3];c.fillColor[2]*=c.fillColor[3];c.outlineColor[0]*=c.outlineColor[3];c.outlineColor[1]*=c.outlineColor[3];c.outlineColor[2]*=c.outlineColor[3];c.outlineWidth=a.HIGHLIGHT_SIZING.outlineWidth;
c.outerHaloWidth=a.HIGHLIGHT_SIZING.outerHaloWidth;c.innerHaloWidth=a.HIGHLIGHT_SIZING.innerHaloWidth;c.outlinePosition=a.HIGHLIGHT_SIZING.outlinePosition}Object.defineProperty(b,"__esModule",{value:!0});var e=l.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),d=[0,0,0,0];n=function(){function b(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:a.HIGHLIGHT_SIZING.outlinePosition,outlineWidth:a.HIGHLIGHT_SIZING.outlineWidth,
innerHaloWidth:a.HIGHLIGHT_SIZING.innerHaloWidth,outerHaloWidth:a.HIGHLIGHT_SIZING.outerHaloWidth};this.shadeTexChanged=!0;this.texelData=new Uint8Array(4*a.SHADE_TEXTURE_SIZE);this.minMaxDistance=[0,0]}b.prototype.setHighlightOptions=function(b){function c(a,b,c){m[0]=(1-c)*a[0]+c*b[0];m[1]=(1-c)*a[1]+c*b[1];m[2]=(1-c)*a[2]+c*b[2];m[3]=(1-c)*a[3]+c*b[3]}var f,h=this._convertedHighlightOptions;g(b,h);b=h.outlinePosition-h.outlineWidth/2-h.outerHaloWidth;var k=h.outlinePosition-h.outlineWidth/2,l=
h.outlinePosition+h.outlineWidth/2,n=h.outlinePosition+h.outlineWidth/2+h.innerHaloWidth,u=Math.sqrt(Math.PI/2)*a.SIGMAS[3],y=Math.abs(b)>u?Math.round(10*(Math.abs(b)-u))/10:0,u=Math.abs(n)>u?Math.round(10*(Math.abs(n)-u))/10:0;y&&!u?e.error("The outer rim of the highlight is "+y+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!y&&u?e.error("The inner rim of the highlight is "+u+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):
y&&u&&e.error("The highlight is "+Math.max(y,u)+"px away from the edge of the feature; consider reducing some width values.");for(var m=[void 0,void 0,void 0,void 0],y=this.texelData,u=0;u<a.SHADE_TEXTURE_SIZE;++u)f=b+u/(a.SHADE_TEXTURE_SIZE-1)*(n-b),f<b?(m[4*u+0]=0,m[4*u+1]=0,m[4*u+2]=0,m[4*u+3]=0):f<k?c(d,h.outlineColor,(f-b)/(k-b)):f<l?(f=h.outlineColor,m[0]=f[0],m[1]=f[1],m[2]=f[2],m[3]=f[3]):f<n?c(h.outlineColor,h.fillColor,(f-l)/(n-l)):(f=h.fillColor,m[4*u+0]=f[0],m[4*u+1]=f[1],m[4*u+2]=f[2],
m[4*u+3]=f[3]),y[4*u+0]=255*m[0],y[4*u+1]=255*m[1],y[4*u+2]=255*m[2],y[4*u+3]=255*m[3];this.minMaxDistance[0]=b;this.minMaxDistance[1]=n;this.shadeTexChanged=!0};b.prototype.applyHighlightOptions=function(b,d){this.shadeTex||(this.shadeTex=new k.Texture(b,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:a.SHADE_TEXTURE_SIZE,height:1,samplingMode:9729}));this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,a.SHADE_TEXTURE_SIZE,1,this.texelData),this.shadeTexChanged=!1);b.bindTexture(this.shadeTex,
h.TEXTURE_BINDING_HIGHLIGHT_1);d.setUniform2fv("u_minMaxDistance",this.minMaxDistance)};b.prototype.destroy=function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)};return b}();b.default=n})},"esri/views/2d/engine/webgl/effects/highlight/parameters":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.SIGMAS=[void 0,void 0,void 0,1];b.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1];b.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=
[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];b.SHADE_TEXTURE_SIZE=256;b.HIGHLIGHT_SIZING={outlineWidth:.7,outerHaloWidth:.7,innerHaloWidth:.7,outlinePosition:0}})},"esri/views/2d/engine/webgl/effects/highlight/HighlightRenderer":function(){define("require exports ../../../../../webgl ../../definitions ./parameters ../../shaders/HighlightPrograms".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._height=this._width=void 0;this._resources=null}b.prototype.dispose=
function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)};b.prototype.preBlur=function(a,b){a.bindTexture(b,k.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",h.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);
a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};b.prototype.finalBlur=function(a,b){a.bindTexture(b,k.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",h.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};b.prototype.renderHighlight=function(a,b,f){a.bindTexture(b,
k.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.highlightProgram);f.applyHighlightOptions(a,this._resources.highlightProgram);a.bindVAO(this._resources.quadVAO);a.setBlendingEnabled(!0);a.setBlendFunction(1,771);a.drawArrays(5,0,4);a.bindVAO()};b.prototype._initialize=function(b,d,f){this._width=d;this._height=f;d=new l.BufferObject(b,34962,35044,(new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);f=new l.VertexArrayObject(b,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",
count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:d});var c=l.createProgram(b,a.highlight);b=l.createProgram(b,a.blur);c.setUniform1i("u_texture",k.TEXTURE_BINDING_HIGHLIGHT_0);c.setUniform1i("u_shade",k.TEXTURE_BINDING_HIGHLIGHT_1);c.setUniform4fv("u_sigmas",h.SIGMAS);b.setUniform1i("u_texture",k.TEXTURE_BINDING_HIGHLIGHT_0);b.setUniform4fv("u_sigmas",h.SIGMAS);this._resources={quadGeometry:d,quadVAO:f,highlightProgram:c,
blurProgram:b}};b.prototype.setup=function(a,b,f){this._resources?(this._width=b,this._height=f):this._initialize(a,b,f)};return b}();b.default=n})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["require","exports","./sources/resolver"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.highlight={name:"highlight",shaders:{vertexShader:l.resolveIncludes("highlight/textured.vert"),fragmentShader:l.resolveIncludes("highlight/highlight.frag")},attributes:{a_position:0,
a_texcoord:1}};b.blur={name:"blur",shaders:{vertexShader:l.resolveIncludes("highlight/textured.vert"),fragmentShader:l.resolveIncludes("highlight/blur.frag")},attributes:{a_position:0,a_texcoord:1}}})},"esri/views/2d/engine/webgl/effects/highlight/HighlightSurfaces":function(){define(["require","exports","../../../../../webgl"],function(n,b,l){function k(b,a,g){a=new l.Texture(b,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:a,height:g,samplingMode:9729});b=l.FramebufferObject.createWithAttachments(b,
a,{colorTarget:0,depthStencilTarget:2});return[a,b]}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._height=this._width=void 0;this._resources=null}b.prototype.dispose=function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)};b.prototype._initialize=function(a,b,e){this._width=b;this._height=e;var d=k(a,b,e),f=
d[0],d=d[1];a=k(a,b,e);this._resources={sharedBlur1Tex:f,sharedBlur1Fbo:d,sharedBlur2Tex:a[0],sharedBlur2Fbo:a[1]}};b.prototype.setup=function(a,b,e){!this._resources||this._width===b&&this._height===e||this.dispose();this._resources||this._initialize(a,b,e)};Object.defineProperty(b.prototype,"sharedBlur1Tex",{get:function(){return this._resources.sharedBlur1Tex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sharedBlur1Fbo",{get:function(){return this._resources.sharedBlur1Fbo},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sharedBlur2Tex",{get:function(){return this._resources.sharedBlur2Tex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sharedBlur2Fbo",{get:function(){return this._resources.sharedBlur2Fbo},enumerable:!0,configurable:!0});return b}();b.default=n})},"esri/views/2d/engine/webgl/effects/HittestEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/iteratorUtils ../../../../../core/maybe ../definitions ./Effect".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(){var d=null!==b&&b.apply(this,arguments)||this;d.name=d.constructor.name;d.defines=["id"];d._buf=new Uint8Array(4*a.HITTEST_SEARCH_SIZE*a.HITTEST_SEARCH_SIZE);d._buf32=new Uint32Array(d._buf.buffer);return d}l(d,b);d.prototype.destroy=function(){h.isSome(this._fbo)&&this._fbo.dispose()};d.prototype.bind=function(a){var b=a.context;a=a.painter;var d=b.getViewport();a=a.getFbos(b,d.width,d.height).effect0;
b.bindFramebuffer(a);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT)};d.prototype.unbind=function(a){};d.prototype.draw=function(b,c){var d=this,e=b.state,f=b.pixelRatio,g=a.HITTEST_SEARCH_SIZE,h=b.context.getBoundFramebufferObject(),l=e.size[1],u=g/2,y=g/2;c.forEach(function(b,e){var m=new Map;h.readPixels(Math.floor((e[0]-a.HITTEST_SEARCH_SIZE/2)*f),Math.floor((l-e[1]-a.HITTEST_SEARCH_SIZE/2)*f),g,g,6408,5121,d._buf);for(var p=0;p<d._buf32.length;p++){var q=d._buf32[p];if(4294967295!==q&&
0!==q){var r=p%g,v=g-Math.floor(p/g),r=(u-r)*(u-r)+(y-v)*(y-v),v=m.has(q)?m.get(q):4294967295;m.set(q,Math.min(r,v))}}m=k.pairsOfMap(m).sort(function(a,b){return a[1]-b[1]}).map(function(a){return a[0]});b.resolve(m);c.delete(e)})};return d}(g.Effect);b.HittestEffect=n})},"esri/views/2d/engine/webgl/painter/RenderPass":function(){define("require exports @dojo/framework/shim/iterator ../../../../../core/has ../../../../../core/maybe ../enums".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,
"__esModule",{value:!0});n=function(){function b(b,d){this.brushes=b;this.name=d.name;this.drawPhase=d.drawPhase||a.WGLDrawPhase.MAP;this._targetFn=d.target;this.effects=d.effects||[];this.has=d.has}b.prototype.render=function(a){var b=a.context,e=a.profiler,c=this._targetFn(),g=this.drawPhase&a.drawPhase;e.recordPassStart(this.name);if(g&&(!this.has||k(this.has))){this._doRender(a,c);e.recordPassEnd(this.name);for(var g=0,h=this.effects;g<h.length;g++){var l=h[g];if(l.enable()){var t=l.apply;e.recordPassStart(this.name+
"."+t.name);e.recordBrushStart(t.name);var l=l.args&&l.args(),n=b.getViewport(),w=n.x,u=n.y,y=n.width,n=n.height,m=b.getBoundFramebufferObject();t.bind(a,l);this._doRender(a,c,t.defines);t.draw(a,l);t.unbind(a,l);b.bindFramebuffer(m);b.setViewport(w,u,y,n);e.recordBrushEnd(t.name);e.recordPassEnd(this.name+"."+t.name)}}}};b.prototype._doRender=function(a,b,f){if(!h.isNone(b))if(l.isArrayLike(b))for(var c=0;c<b.length;c++){var d=b[c];if(d.isReady)for(var e=0,g=this.brushes;e<g.length;e++){var k=g[e];
a.profiler.recordBrushStart(k.name);k.prepareState(a,d,f);k.draw(a,d,f);a.profiler.recordBrushEnd(k.name)}}else for(c=0,d=this.brushes;c<d.length;c++)k=d[c],a.profiler.recordBrushStart(k.name),k.prepareState(a,b,f),k.draw(a,b,f),a.profiler.recordBrushEnd(k.name)};return b}();b.default=n})},"esri/views/2d/engine/webgl/Profiler":function(){define("require exports ../../../../core/CircularArray ../../../../core/Evented ../../../../core/has ../../../../core/maybe ../../../webgl/capabilities/DisjointTimerQuery".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});var e=h("esri-2d-profiler");n=function(){function b(a,b){var c=this;this._events=new k;this._entries=new Map;this._timings=new l.default(10);if(e){this._ext=g.load(a.gl,{});this._debugOutput=b;var d=a.gl;if(this.enableCommandLogging){a=function(a){if("function"===typeof d[a]){var b=d[a],e=-1!==a.indexOf("draw");d[a]=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];c._events.emit("command",{container:c._currentContainer,
pass:c._currentPass,brush:c._currentBrush,method:a,args:f,isDrawCommand:e});c._currentSummary&&(c._currentSummary.commands++,e&&c._currentSummary.drawCommands++);return b.apply(d,f)}}};for(var f in d)a(f)}}}Object.defineProperty(b.prototype,"enableCommandLogging",{get:function(){return!("object"===typeof e&&e.disableCommands)},enumerable:!0,configurable:!0});b.prototype.recordContainerStart=function(a){e&&(this._currentContainer=a)};b.prototype.recordContainerEnd=function(a){e&&(this._currentContainer=
null)};b.prototype.recordPassStart=function(a){e&&(this._currentPass=a,this._initSummary())};b.prototype.recordPassEnd=function(a){e&&(this._currentPass=null,this._emitSummary())};b.prototype.recordBrushStart=function(a){e&&(this._currentBrush=a)};b.prototype.recordBrushEnd=function(a){e&&(this._currentBrush=null)};b.prototype.recordStart=function(b){if(e&&a.isSome(this._ext)){if(this._entries.has(b)){var c=this._entries.get(b),d=this._ext.resultAvailable(c.query),f=this._ext.disjoint();if(d&&!f){d=
this._ext.getResult(c.query)/1E6;f=0;if(a.isSome(this._timings.enqueue(d))){for(var f=this._timings.entries,g=f.length,h=0,k=0;k<f.length;k++)h+=f[k];f=h/g}d=d.toFixed(2);f=f?f.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed("Frame report for "+b+", "+d+" ms ("+f+" last 10 avg)\n"+c.commandsLen+" Commands ("+c.drawCommands+" draw)"),console.log("RenderPass breakdown: "),console.table(c.summaries),console.log("Commands: ",c.commands),console.groupEnd()):console.log("Frame report for "+
b+", "+d+" ms ("+f+" last 10 avg)");this._debugOutput.innerHTML=d+" ("+f+")"}d=0;for(c=c.handles;d<c.length;d++)c[d].remove();this._entries.delete(b)}var l={name:b,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(l.handles.push(this._events.on("command",function(a){l.commandsLen++;l.commands.push(a);a.isDrawCommand&&l.drawCommands++})),l.handles.push(this._events.on("summary",function(a){delete a.target;l.summaries.push(a)})));
this._ext.beginTimeElapsed(l.query);this._entries.set(b,l)}};b.prototype.recordEnd=function(b){e&&a.isSome(this._ext)&&this._entries.has(b)&&this._ext.endTimeElapsed()};b.prototype._initSummary=function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})};b.prototype._emitSummary=function(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)};return b}();b.Profiler=n})},"esri/core/CircularArray":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._start=this.size=0;this.maxSize=b;this._buffer=Array(b)}Object.defineProperty(b.prototype,"entries",{get:function(){return this._buffer},enumerable:!0,configurable:!0});b.prototype.enqueue=function(b){if(this.size===this.maxSize){var h=this._buffer[this._start];this._buffer[this._start]=b;this._start=(this._start+1)%this.maxSize;return h}this._buffer[(this._start+this.size++)%this.maxSize]=b;
return null};b.prototype.dequeue=function(){if(0===this.size)throw Error("Cannot dequeue from empty buffer");var b=this._buffer[this._start];this.size--;this._start=(this._start+1)%this.maxSize;return b};return b}();b.default=n})},"esri/views/2d/engine/webgl/WebGLDriverTest":function(){define("require exports ../../../../core/Logger ../../../../core/maybe ../../../webgl ./VertexStream".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});var g=l.getLogger("esri.views.2d.engine.webgl.WebGLDriverTest"),
e=function(){function a(a){this._ignoresSamplerPrecision=null;this._context=a}Object.defineProperty(a.prototype,"ignoresSamplerPrecision",{get:function(){k.isNone(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=b.testSamplerPrecision(this._context));return this._ignoresSamplerPrecision},enumerable:!0,configurable:!0});return a}();b.testWebGLDriver=function(a){return new e(a)};b.testSamplerPrecision=function(b){var d=h.FramebufferObject.createWithAttachments(b,{target:3553,wrapMode:33071,
pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},{colorTarget:0,depthStencilTarget:0}),c=new Uint8Array(4),e=new a(b,[0,0,1,0,0,1,1,1]),k=new h.Program(b,"\nprecision highp float; \n\nattribute vec2 a_pos;\n\nuniform highp sampler2D u_texture;\nvarying vec4 v_color; \n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value \x3d texture2D(u_texture, vec2(0.0));\n  \n  float bit \x3d getBit(value.x * 255.0, 1);\n\n  v_color \x3d bit * vec4(1.0);\n  \n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0); \n}\n",
"\nprecision highp float; \n\nvarying vec4 v_color; \n\nvoid main() {\n  gl_FragColor \x3d v_color;\n}\n",{a_pos:0}),l=new h.Texture(b,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));k.setUniform1i("u_texture",0);b.bindTexture(l,0);b.bindFramebuffer(d);b.bindProgram(k);var t=b.getViewport(),l=t.x,n=t.y,w=t.width,t=t.height;b.setViewport(0,0,1,1);e.draw();b.setViewport(l,n,w,t);d.readPixels(0,0,1,1,6408,5121,c);k.dispose();
e.dispose();d.dispose();(b=255!==c[0]||255!==c[1]||255!==c[2]||255!==c[3])&&g.warn("A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. ["+c[0]+"."+c[1]+"."+c[2]+"."+c[3]+"]");return b}})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["require",
"exports","./sources/resolver"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.stencil={name:"stencil",shaders:{vertexShader:l.resolveIncludes("stencil/stencil.vert"),fragmentShader:l.resolveIncludes("stencil/stencil.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../webgl ./definitions ./Utils ./util/debug ../../../webgl/FramebufferObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){Object.defineProperty(b,"__esModule",{value:!0});var t=g.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),x=p.createDebugLogger(p.DEBUG_ATTR_UPDATES,t),w=function(){function b(a,b,c){this._lastTexture=this._texture=null;this._fbos={};this.texelSize=4;var d=a.buffer,f=a.pixelType;a=a.textureOnly;var g=q.getPixelArrayCtor(f);this.shared=c;this.pixelType=f;this.size=b;this.textureOnly=a;a||(this.data=new g(e.expect(d)));this._resetRange()}b.prototype.destroy=
function(){e.andThen(this._texture,function(a){return a.dispose()});var a=function(a){e.andThen(b._fbos[a],function(b){"0"===a&&b.detachColorTexture();b.dispose()});b._fbos[a]=null},b=this,c;for(c in this._fbos)a(c);this._texture=null};Object.defineProperty(b.prototype,"_textureDesc",{get:function(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}},enumerable:!0,configurable:!0});b.prototype.setData=function(a,b,c){var d=
e.expect(this.data);b=a*this.texelSize+b;!d||b>=d.length||(d[b]=c,this.dirtyStart=Math.min(this.dirtyStart,a),this.dirtyEnd=Math.max(this.dirtyEnd,a))};b.prototype.getData=function(a,b){if(e.isNone(this.data))return null;a=a*this.texelSize+b;return!this.data||a>=this.data.length?null:this.data[a]};b.prototype.getTexture=function(a){var b=this;return e.unwrapOr(this._texture,function(){return b._initTexture(a)})};b.prototype.getFBO=function(a,b){void 0===b&&(b=0);if(e.isNone(this._fbos[b])){var c=
0===b?this.getTexture(a):this._textureDesc;this._fbos[b]=r.createWithAttachments(a,c,{colorTarget:0,depthStencilTarget:0})}return this._fbos[b]};Object.defineProperty(b.prototype,"locked",{get:function(){return 5121===this.pixelType&&this.shared&&!this.textureOnly&&a("esri-atomics")&&this.data?1===Atomics.load(this.data,0):!1},enumerable:!0,configurable:!0});b.prototype.updateTexture=function(a){if(!this.locked)try{var b=this.dirtyStart,c=this.dirtyEnd;if(!(b>c)){this._resetRange();var d=e.expect(this.data).buffer,
f=this.getTexture(a),g=(b-b%this.size)/this.size,k=(c-c%this.size)/this.size,l=g*this.size*4,p=4*(this.size+k*this.size)-l,r=q.getPixelArrayCtor(this.pixelType),u=r.BYTES_PER_ELEMENT;try{new r(d,l*u,p)}catch(M){console.debug(M)}var y=new r(d,l*u,p),n=this.size;a=k-g+1;a>this.size?t.error(new h("mapview-webgl","Out-of-bounds index when updating AttributeData")):f.updateData(0,0,g,n,a,y)}}catch(M){console.debug(M)}};b.prototype.update=function(a){var b=a.data,c=a.start,d=a.end;if(e.isSome(b))for(var f=
this.data,g=c*this.texelSize,h=0;h<b.length;h++)a.layout&1<<h%this.texelSize&&(f[g+h]=b[h]);this.dirtyStart=Math.min(this.dirtyStart,c);this.dirtyEnd=Math.max(this.dirtyEnd,d)};b.prototype.resize=function(a,b){var c=this.size;this.size=b;this.textureOnly?c!==this.size&&(this._lastTexture=this._texture,this._texture=null):(b=q.getPixelArrayCtor(this.pixelType),this.destroy(),this.data=new b(e.expect(a.buffer)))};b.prototype._resetRange=function(){this.dirtyStart=4294967295;this.dirtyEnd=0};b.prototype._initTexture=
function(a){var b=new f.Texture(a,this._textureDesc,e.unwrapOr(this.data,void 0));if(e.isSome(this._lastTexture)&&this._fbos[0]){var c=this._lastTexture.descriptor.width,d=this._lastTexture.descriptor.height,g=this._lastTexture.descriptor.dataType,h=this._lastTexture.descriptor.pixelFormat,k=this.getFBO(a),l=q.getPixelBytes(g),p=q.getPixelArrayCtor(g),l=new ArrayBuffer(c*d*l*this.texelSize),p=new p(l),l=a.getBoundFramebufferObject(),r=a.getViewport(),t=r.x,u=r.y,y=r.width,r=r.height;a.bindFramebuffer(k);
k.readPixels(0,0,c,d,h,g,p);b.updateData(0,0,0,2*c,d/2,p);a.setViewport(t,u,y,r);a.bindFramebuffer(l)}this.destroy();return this._texture=b};return b}();n=function(){function a(){this._locked=this._forceNextUpload=this._initialized=!1}a.prototype.initialize=function(a){var b=a.blocks,c=a.shared,d=a.size;this.shared=c;this.size=d;x("Initializing AttributeStoreView",a);if(e.isNone(this._data))this._data=e.mapMany(b,function(a){return new w(a,d,c)});else for(a=0;a<this._data.length;a++){var f=this._data[a],
g=b[a];e.isSome(g)&&(e.isNone(f)?this._data[a]=new w(g,d,c):f.resize(g,d))}this._initialized=!0};a.prototype.destroy=function(){e.andThen(this._data,function(a){return e.mapMany(a,function(a){return a.destroy()})});e.andThen(this._defaultTexture,function(a){return a.dispose()})};a.prototype.getBlock=function(a){return e.isNone(this._data)?null:this._data[a]};a.prototype.setLabelMinZoom=function(a,b){this.setData(a,0,1,b)};a.prototype.getLabelMinZoom=function(a){return this.getData(a,0,1,255)};a.prototype.getFilterFlags=
function(a){return this.getData(a,0,0,0)};a.prototype.getVVSize=function(a){return this.getData(a,c.ATTRIBUTE_DATA_VV,0,0)};a.prototype.getData=function(a,b,c,d){if(!this._data)return 0;b=e.expect(this._data)[b];if(e.isNone(b))return 0;a=b.getData(a,c);return e.isSome(a)?a:d};a.prototype.setData=function(a,b,c,d){b=e.expect(this._data)[b];e.expect(b).setData(a,c,d)};a.prototype.lockTextureUpload=function(){this._locked=!0};a.prototype.unlockTextureUpload=function(){this._locked=!1};a.prototype.forceTextureUpload=
function(){this._forceNextUpload=!0};a.prototype.requestUpdate=function(a){return k(this,void 0,void 0,function(){var b;return l(this,function(c){if(this._pendingAttributeUpdate)return t.error(new h("mapview-webgl","Tried to update attribute data with a pending update")),[2];b=d.createResolver();x("AttributeStoreView Update Requested",a);this._pendingAttributeUpdate={data:a,resolver:b};return[2,b.promise]})})};a.prototype.update=function(){if(this._initialized&&e.isSome(this._pendingAttributeUpdate)){for(var a=
this._pendingAttributeUpdate,b=a.data,a=a.resolver,c=e.expect(this._data),d=function(a){var d=b.blocks[a];e.andThen(c[a],function(b){return e.andThen(d,function(c){x("Updating block "+a,c);b.update(c)})})},f=0;f<b.blocks.length;f++)d(f);this._pendingAttributeUpdate=null;a()}};a.prototype.bindTextures=function(a){this.update();var b=this._getDefaultTexture(a);if(this._initialized){var d=e.expect(this._data);if(!this._locked||this._forceNextUpload)e.forEachSome(d,function(b){return b.updateTexture(a)}),
this._forceNextUpload=!1;a.bindTexture(e.mapOr(d[0],b,function(b){return b.getTexture(a)}),c.TEXTURE_BINDING_ATTRIBUTE_DATA_0);a.bindTexture(e.mapOr(d[1],b,function(b){return b.getTexture(a)}),c.TEXTURE_BINDING_ATTRIBUTE_DATA_1);a.bindTexture(e.mapOr(d[2],b,function(b){return b.getTexture(a)}),c.TEXTURE_BINDING_ATTRIBUTE_DATA_2);a.bindTexture(e.mapOr(d[3],b,function(b){return b.getTexture(a)}),c.TEXTURE_BINDING_ATTRIBUTE_DATA_3)}else a.bindTexture(b,c.TEXTURE_BINDING_ATTRIBUTE_DATA_0),a.bindTexture(b,
c.TEXTURE_BINDING_ATTRIBUTE_DATA_1),a.bindTexture(b,c.TEXTURE_BINDING_ATTRIBUTE_DATA_2),a.bindTexture(b,c.TEXTURE_BINDING_ATTRIBUTE_DATA_3)};a.prototype._getDefaultTexture=function(a){e.isNone(this._defaultTexture)&&(this._defaultTexture=new f.Texture(a,{wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array(4)));return this._defaultTexture};return a}();b.AttributeStoreView=n})},"esri/views/2d/engine/webgl/Utils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../symbols/cim/enums ../../../webgl ./color ./enums ./SymbolProperties".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){function p(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d.name]=d.strideInBytes}return b}function r(a){switch(a){case c.WGLGeometryType.MARKER:return v;case c.WGLGeometryType.FILL:return z;case c.WGLGeometryType.LINE:return B;case c.WGLGeometryType.TEXT:return C;case c.WGLGeometryType.LABEL:return D}return null}function t(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function x(a){return"string"===typeof a}function w(a){switch(a){case 5120:case 5121:return 1;
case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function u(a){var b={},c=function(c){var d=0;b[c]=a[c].map(function(a){var b=l({},a,{normalized:a.normalized||!1,divisor:a.divisor||0,offset:d,stride:0});d+=a.count*w(a.type);return b});b[c].forEach(function(a){return a.stride=d})},d;for(d in a)c(d);return b}Object.defineProperty(b,"__esModule",{value:!0});var y,m=h.getLogger("esri.views.2d.engine.webgl.Utils");b.C_VBO_GEOMETRY="geometry";b.C_VBO_PERINSTANCE="per_instance";b.C_VBO_PERINSTANCE_VV=
"per_instance_vv";b.C_ICON_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];b.C_FILL_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];b.C_FILL_VERTEX_DEF_DD=[{name:b.C_VBO_GEOMETRY,strideInBytes:12,divisor:0}];b.C_LINE_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];b.C_TEXT_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:24,divisor:0}];b.C_LABEL_VERTEX_DEF=[{name:b.C_VBO_GEOMETRY,strideInBytes:28,divisor:0}];b.C_ICON_STRIDE_SPEC=p(b.C_ICON_VERTEX_DEF);
b.C_FILL_STRIDE_SPEC=p(b.C_FILL_VERTEX_DEF);b.C_FILL_STRIDE_SPEC_DD=p(b.C_FILL_VERTEX_DEF_DD);b.C_LINE_STRIDE_SPEC=p(b.C_LINE_VERTEX_DEF);b.C_TEXT_STRIDE_SPEC=p(b.C_TEXT_VERTEX_DEF);b.C_LABEL_STRIDE_SPEC=p(b.C_LABEL_VERTEX_DEF);b.getStrides=function(a,d){switch(a){case c.WGLGeometryType.MARKER:return b.C_ICON_STRIDE_SPEC;case c.WGLGeometryType.FILL:return d?b.C_FILL_STRIDE_SPEC_DD:b.C_FILL_STRIDE_SPEC;case c.WGLGeometryType.LINE:return b.C_LINE_STRIDE_SPEC;case c.WGLGeometryType.TEXT:return b.C_TEXT_STRIDE_SPEC;
case c.WGLGeometryType.LABEL:return b.C_LABEL_STRIDE_SPEC}return null};var v=[b.C_VBO_GEOMETRY],z=[b.C_VBO_GEOMETRY],B=[b.C_VBO_GEOMETRY],C=[b.C_VBO_GEOMETRY],D=[b.C_VBO_GEOMETRY];b.getNamedBuffers=r;b.strideToPackingFactor=t;b.allocateTypedArrayBuffer=function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(Math.floor(a*b/4));case 1:case 3:return new Uint8Array(a*b)}};b.allocateTypedArrayBufferwithData=function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(a);case 1:case 3:return new Uint8Array(a)}};
b.getTextProperties=function(a){return q.TextProperties.pool.acquire(a.color?f.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?f.copyAndPremultiply(a.haloColor):[255,255,255,255],g.pt2px(a.haloSize),g.pt2px(a.font.size),a.angle*Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};b.isDefined=function(a){return null!=a};b.isNumber=function(a){return"number"===
typeof a};b.isString=x;b.isStringOrNull=function(a){return null==a||x(a)};n=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(b)};a.prototype.getKeys=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();b.KeysGetter=n;n=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(a)};a.prototype.getValues=function(a){this._arr.length=0;a&&a.forEach(this._push);
return this._arr};return a}();b.ValuesGetter=n;b.getCapType=function(a,b){switch(a){case "butt":return e.CapType.BUTT;case "round":return b?e.CapType.SQUARE:e.CapType.ROUND;case "square":return e.CapType.SQUARE;default:return m.error(new k("mapview-invalid-type","Cap type "+a+" is not a valid option. Defaulting to round")),e.CapType.ROUND}};b.getJoinType=function(a){switch(a){case "miter":return e.JoinType.MITER;case "bevel":return e.JoinType.BEVEL;case "round":return e.JoinType.ROUND;default:return m.error(new k("mapview-invalid-type",
"Join type "+a+" is not a valid option. Defaulting to round")),e.JoinType.ROUND}};b.getVVType=function(a){switch(a){case "opacity":return c.VVType.OPACITY;case "color":return c.VVType.COLOR;case "rotation":return c.VVType.ROTATION;case "size":return c.VVType.SIZE;default:return m.error("Cannot interpret unknown vv: "+a),null}};b.getTransformParams=function(a){return{transform:a.transform,hasZ:a.hasZ,hasM:a.hasM}};b.copyMeshData=function(a,b,c,d,e,f,g){for(var h in f)for(var k=f[h].stride,m=t(k),l=
f[h].data,p=c[h].data,q=k*e.vertexCount/m,r=k*a/m,m=k*e.vertexFrom/m,k=0;k<q;++k)p[k+r]=l[k+m];c=e.indexCount;for(k=0;k<c;++k)d[k+b]=g[k+e.indexFrom]-e.vertexFrom+a};b.C_VBO_INFO=(y={},y[b.C_VBO_GEOMETRY]=35044,y);b.createGeometryData=function(a,b){for(var c=[],d=0;5>d;++d){for(var e={},f=0,g=r(d);f<g.length;f++){var h=g[f];e[h]={data:b(d,h)}}c.push({data:a(d),buffers:e})}return c};b.createTextureFromTexelData=function(b,c){var e,f;a.isPowerOfTwo(c.width)&&a.isPowerOfTwo(c.height)?(e=!0,f=9987):(e=
!1,f=9729);return new d.Texture(b,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:e,samplingMode:f,wrapMode:33071,flipped:!0},c)};b.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,vertexTo:void 0,geometry:a}};b.getBytes=w;b.getPixelBytes=function(a){switch(a){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:m.error(new k("webgl-utils","Unable to handle type "+a))}};b.getPixelArrayCtor=function(a){switch(a){case 5121:return Uint8Array;case 32819:return Uint16Array;
case 5126:return Float32Array;default:m.error(new k("webgl-utils","Unable to handle type "+a))}};var K=new Map;b.createProgramDescriptor=function(a,b){if(!K.has(a)){var c=u(b),d={},e;for(e in c){var f=c[e];d[e]=f.length?f[0].stride:0}e={};for(var g in b)for(var f=0,h=b[g];f<h.length;f++){var k=h[f];e[k.name]=k.location}K.set(a,{strides:d,bufferLayouts:c,attributes:e})}return K.get(a)}})},"esri/views/2d/engine/webgl/color":function(){define(["require","exports","./number"],function(n,b,l){function k(a,
b){Array.isArray(b)?(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]):(a[0]=b.r,a[1]=b.g,a[2]=b.b,a[3]=b.a);return a}function h(a,b,d){void 0===b&&(b=0);void 0===d&&(d=!1);var e=a[b+3];a[b+0]*=e;a[b+1]*=e;a[b+2]*=e;d||(a[b+3]*=255);return a}Object.defineProperty(b,"__esModule",{value:!0});b.white=[255,255,255,1];var a=[0,0,0,0];b.premultiplyAlpha=h;b.copyAndPremultiply=function(a){return h(k([],a))};b.premultiplyAlphaUint32=function(b){h(k(a,b));return l.i8888to32(a[0],a[1],a[2],a[3])};b.premultiplyAlphaRGBA=
function(a){var b=a.a;return l.i8888to32(a.r*b,a.g*b,a.b*b,255*b)}})},"esri/views/2d/engine/webgl/SymbolProperties":function(){define(["require","exports","../../../../core/ObjectPool"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.color=[0,0,0,0];this.haloColor=[0,0,0,0];this.haloSize=0;this.size=12;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=0}b.prototype.acquire=function(b,a,g,e,d,f,c,k,l){this.color=b;this.haloColor=a;this.haloSize=
g;this.size=e;this.angle=d;this.offsetX=f;this.offsetY=c;this.hAnchor=k;this.vAnchor=l};b.prototype.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=this.size=this.haloSize=this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0};b.pool=new l(b);return b}();b.TextProperties=n})},"esri/views/2d/engine/webgl/util/debug":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,
"__esModule",{value:!0});b.createDebugLogger=function(b,k){return b&&function(){for(var b=[],a=0;a<arguments.length;a++)b[a]=arguments[a];return k.warn.apply(k,["DEBUG:"].concat(b))}||function(){return null}};b.DEBUG_ATTR_UPDATES=!1})},"esri/views/2d/engine/webgl/collisions/CollisionGrid":function(){define(["require","exports","../definitions"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._bucketSize=b;this._rowsLength=l.TILE_SIZE/b;this._colsLength=
l.TILE_SIZE/b;this._grid=this._initGrid()}b.prototype.checkOverlap=function(b,a){b=Math.floor(b/this._bucketSize);a=Math.floor(a/this._bucketSize);if(0>b||b>=this._rowsLength||0>a||a>=this._colsLength||this._grid[a][b])return!0;this._grid[a][b]=!0;return!1};b.prototype.reset=function(){this._grid=this._initGrid()};b.prototype._initGrid=function(){for(var b=[],a=0;a<this._rowsLength;a++)b.push(Array(this._colsLength));return b};return b}();b.CollisionGrid=n})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define("require exports ../../../../../core/Error ../../../../../core/iteratorUtils ../../../../../core/Logger ../../../../../core/mathUtils ../definitions ./CollisionBucket ./LayerCollisionInfo".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});var f=g.TILE_SIZE/g.COLLISION_BUCKET_SIZE,c=h.getLogger("esri.views.2d.engine.webgl.collisions.CollisionEngine");n=function(){function b(a){this._layers=new Map;this._collisionBuckets=new Map;this._didError=!1;this._tilingScheme=a}Object.defineProperty(b.prototype,"collisionInfos",{get:function(){return k.valuesOfMap(this._layers)},enumerable:!0,configurable:!0});b.prototype.registerLayerView=function(a,b){if(!this._layers.has(a)){var c=
d.default.create(a,b,this.collisionInfos,this._tilingScheme);this._layers.set(a,c);this._collisionBuckets.forEach(function(a){return a.onRegisterLayer(c.index)})}};b.prototype.unregisterLayerView=function(a){var b=this;if(this._layers.has(a)){var c=this._layers.get(a);d.default.delete(c.index,this.collisionInfos);this._layers.delete(a);this._collisionBuckets.forEach(function(a,d){var e=a.getTile(c.index);e&&(a.onUnregisterLayer(c.index),a.canDelete()&&b._collisionBuckets.delete(d),e.reference&&(e.reference.isDirty=
!1))})}};b.prototype.addTile=function(a,b){var c=b.key.id;this._layers.has(a)&&(this._collisionBuckets.has(c)||this._collisionBuckets.set(c,new e.default(b.key,this._layers.size)),a=this._getIndex(a),this._collisionBuckets.get(c).getTile(a).reference=b)};b.prototype.removeTile=function(a,b){this._layers.has(a)&&this._collisionBuckets.has(b)&&(a=this._getIndex(a),b=this._collisionBuckets.get(b).getTile(a),b.dirty=!1,b.reference=null)};b.prototype.run=function(a,b){var e=k.valuesOfMap(this._collisionBuckets).sort(function(a,
b){return a.key.compareRowMajor(b.key)}),f=!0,g=a.renderingOptions.labelCollisionsEnabled&&!this._didError,h=this.collisionInfos;try{for(var p=0;p<e.length;p++)for(var m=e[p],f=f||m.isDirty,q=0;q<this._layers.size;q++){var r=d.default.find(q,h);m.computeNeighbors(this._collisionBuckets);m.reset(a,f,r)}for(a=0;a<this._layers.size;a++)for(r=d.default.find(a,h),f=0,p=e;f<p.length;f++)m=p[f],this._run(g,m,r,b)}catch(B){c.error(new l("mapview-labeling","Encountered an error during decluttering. Disabling collisions",
B)),this._didError=!0}for(b=0;b<e.length;b++)m=e[b],m.ready()};b.prototype._run=function(a,b,c,d){var e=b.getReference(c.index);e&&e.hasData&&(e.key.level!==d?this._resetLabelsMinZoom(b,c):this._runVisibility(a,b,e,c,d))};b.prototype._resetLabelsMinZoom=function(a,b){if(a&&"polyline"!==b.geometryType&&(a=a.getReference(b.index))&&a.hasData){b=b.layerView.tileRenderer.featuresView.attributeView;var c=0;for(a=a.displayObjects;c<a.length;c++)b.setLabelMinZoom(a[c].id,255)}};b.prototype._checkLabelsVisible=
function(a,b){var c=!b.effect||b.effect.excludedLabelsVisible||!!(a&g.EFFECT_FLAG_0);return(!b.filter||!!(a&g.FILTER_FLAG_0))&&c};b.prototype._runVisibility=function(a,b,c,d,e){for(var f=d.layerView.tileRenderer.featuresView.attributeView,g=0,h=c.displayObjects.sort(function(a,b){a=f.getLabelMinZoom(a.id);b=f.getLabelMinZoom(b.id);return a-b});g<h.length;g++){var k=h[g];if(k.metrics.length){var l="polyline"===d.geometryType?0:10*(e-1),p=f.getFilterFlags(k.id),q=this._checkLabelsVisible(p,d.layerView);
if(a)for(var r=0;r<k.metrics.length;r++)p=k.metrics[r],p=q?-1!==p.minZoom?p.minZoom:this._computeLabelVisibility(k,p,d.index,b,c,p.baseZoom,e):255,l=Math.max(p,l);f.setLabelMinZoom(k.id,l);q=0;for(k=k.metrics;q<k.length;q++)p=k[q],p.minZoom=l}}};b.prototype._computeLabelVisibility=function(a,b,c,d,e,g,h){for(var k=b.xBucket,l=b.yBucket,p=b.xOverflow,q=b.yOverflow,r=k-p,k=k+p+1,p=l+q+1,l=l-q;l<p;l++)for(q=r;q<k;q++)if(!(q<-f||l<-f||q>f||l>f))for(var t=0;t<=c;t++){var u=this._getRelativeSubBucket(t,
d,e,q,l);if(u)for(var n=0;n<u.length;n++){var y=u[n];y.id!==a.id&&(y=this._compareLabels(b,y,g,h),g=Math.max(y,g))}}return g};b.prototype._compareLabels=function(b,c,d,e){if(-1===c.minZoom||c.minZoom>10*(e+1))return d;b=b.findCollisionDelta(c);e=a.clamp(Math.floor(10*(b+e)),0,255);return c.minZoom>=e?d:Math.max(d,e)};b.prototype._getNeighboringTile=function(a,b,c,d,e){return(b=b.neighbors[3*(1+e)+(1+d)])&&b.getTile(a)};b.prototype._getRelativeSubBucket=function(b,c,d,e,f){var g=a.sign(Math.floor(e/
4)),h=a.sign(Math.floor(f/4));return(b=this._getNeighboringTile(b,c,d,g,h))&&b.reference&&b.index&&b.reference.hasData?b.index[f-4*h][e-4*g]:null};b.prototype._getIndex=function(a){return this._layers.get(a).index};return b}();b.CollisionEngine=n})},"esri/views/2d/engine/webgl/collisions/CollisionBucket":function(){define(["require","exports","../../../tiling","./CollisionBucketEntry"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){this.neighbors=Array(9);
this._tiles=Array(b);for(var e=0;e<b;e++)this._tiles[e]=new k.default;this.key=a}Object.defineProperty(b.prototype,"isDirty",{get:function(){for(var a=0,b=this._tiles;a<b.length;a++)if(b[a].dirty)return!0;return!1},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._tiles.length},enumerable:!0,configurable:!0});b.prototype.getTile=function(a){return this._tiles[a]};b.prototype.getReference=function(a){return(a=this._tiles[a])&&a.reference};b.prototype.onRegisterLayer=
function(a){this.invalidateRange(a);this._add(a)};b.prototype.onUnregisterLayer=function(a){this.invalidateRange(a);this._remove(a)};b.prototype.onLabelsRendered=function(){};b.prototype.invalidateRange=function(a){for(;a<this._tiles.length;a++)this._tiles[a].dirty=!0};b.prototype.add=function(a){this._add(a)};b.prototype.remove=function(a){this._remove(a)};b.prototype.canDelete=function(){return 0===this._tiles.length};b.prototype.ready=function(){for(var a=0,b=this._tiles;a<b.length;a++)b[a].dirty=
!1};b.prototype.computeNeighbors=function(a){this.neighbors[0]=this._getNeighbor(a,-1,-1);this.neighbors[1]=this._getNeighbor(a,0,-1);this.neighbors[2]=this._getNeighbor(a,1,-1);this.neighbors[3]=this._getNeighbor(a,-1,0);this.neighbors[4]=this;this.neighbors[5]=this._getNeighbor(a,1,0);this.neighbors[6]=this._getNeighbor(a,-1,1);this.neighbors[7]=this._getNeighbor(a,0,1);this.neighbors[8]=this._getNeighbor(a,1,1)};b.prototype.reset=function(a,b,e){for(var d=0,f=this._tiles;d<f.length;d++){var c=
f[d];c&&c.reset(a,b,e)}};b.prototype._add=function(a){var b=[];if(a>=this._tiles.length)this._tiles.push(new k.default);else{for(var e=0;e<this._tiles.length;e++)e===a&&b.push(new k.default),b.push(this._tiles[e]);this._tiles=b}};b.prototype._remove=function(a){for(var b=[],e=0;e<this._tiles.length;e++)e!==a&&b.push(this._tiles[e]);this._tiles=b};b.prototype._getNeighbor=function(a,b,e){var d=this.key;b=l.TileKey.getId(d.level,d.row+e,d.col+b,d.world);return a.has(b)?a.get(b):null};return b}();b.default=
n})},"esri/views/2d/engine/webgl/collisions/CollisionBucketEntry":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._reference=null}Object.defineProperty(b.prototype,"dirty",{get:function(){return this.reference&&this.reference.isDirty},set:function(b){this.reference&&this.reference.hasData&&(b||this.reference.isDirty)&&(this.reference.isDirty=b)},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"index",{get:function(){return this._reference&&this._reference.labelIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"reference",{get:function(){return this._reference},set:function(b){this._reference=b},enumerable:!0,configurable:!0});b.prototype.reset=function(b,a,g){var e=b.state;b=b.renderingOptions;var d=g.layerView.tileRenderer,f=this.reference;if(!f||!f.hasData)return!1;a&&(f.isDirty=!0);a=f.transforms.labelMat2d;for(var c=a[4],h=a[5],
k=0,r=f.displayObjects;k<r.length;k++)for(var t=r[k],n=d.featuresView.attributeView,n=g.hasVV()?n.getVVSize(t.id):0,w=0,t=t.metrics;w<t.length;w++){var u=t[w];g.hasVV()&&u.computeOffset(n,g.vvEval);var y=u.bounds.center,m=u.bounds.centerT;f.isDirty&&(u.minZoom=-1);var v=l.vec2.copy(m,u.anchor);e.rotation?l.vec2.transformMat2d(v,v,a):(m[0]=v[0]+c,m[1]=v[1]+h);l.vec2.add(m,v,y);m[0]+=u.offsetX;m[1]+=u.offsetY;var v=e.size,y=v[0],v=v[1],z=u.bounds,B=z.halfHeight,z=z.halfWidth,C=b.edgeLabelsVisible?-1:
1;"polyline"!==g.geometryType&&(0>m[0]-z*C||m[0]+z*C>y||0>m[1]-B*C||m[1]+B*C>v)&&(u.minZoom=255);if(u.boxes)for(m=0,y=u.boxes;m<y.length;m++)v=y[m],B=v.centerT,l.vec2.add(B,u.anchor,v.center),e.rotation?l.vec2.transformMat2d(B,B,a):(B[0]+=c,B[1]+=h)}return!0};return b}();b.default=n})},"esri/views/2d/engine/webgl/collisions/LayerCollisionInfo":function(){define("require exports ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/screenUtils ./visualVariableSimpleUtils".split(" "),
function(n,b,l,k,h,a){function g(b){return function(c){return h.pt2px(a.getSizeForValueSimple(c,b))}}function e(a){if(!a)return null;for(var b=0;b<a.length;b++){var c=a[b];if("size"===c.type)return g(c)}return null}Object.defineProperty(b,"__esModule",{value:!0});var d=function(a,b){return a.order-b.order},f=function(a,b){return a.index-b.index},c=l.getLogger("esri/views/2d/engine/webgl/collisions/CollisionEngine");b.createLabelVVEvaluator=e;n=function(){function a(a,b,c,d){var f=this;this._vvHandle=
null;var g=a.layer,h=g.geometryType,m=g.labelingInfo,l=g.renderer;this.vvEval=e("visualVariables"in l&&l.visualVariables);this._vvHandle=g.watch("visualVariables",function(a){f.vvEval=e(a)});g=m.map(function(a){var b=!!a.maxScale,c=!!a.minScale&&d.scaleToZoom(a.minScale)||0;a=b&&d.scaleToZoom(a.maxScale)||255;return{minZoom:k.clamp(Math.floor(10*c),0,255),maxZoom:k.clamp(Math.floor(10*a),0,255)}});this.layerView=a;this.geometryType=h;this.index=b;this.order=c;this.zoomRanges=g;this.layerView=a}a.prototype.hasVV=
function(){return!!this.vvEval};a.prototype.allOrNothing=function(){return"polyline"!==this.geometryType};a.prototype.destroy=function(){this._vvHandle.remove()};a.create=function(b,c,e,f){e=e.sort(d);for(var g=!1,h=-1,k=0;k<e.length;k++){var m=e[k];!g&&m.order>c&&(h=m.index,g=!0);g&&m.index++}g||(h=e.length);return new a(b,h,c,f)};a.delete=function(a,b){for(var c=b.sort(f),d=a+1;d<c.length;d++)b[d].index--;b[a].destroy();b.splice(a,1)};a.find=function(a,b){for(var d=0;d<b.length;d++){var e=b[d];
if(e.index===a)return e}c.error("Tried to get a LayerCollisionInfo for an index that doesn't exist!");return null};return a}();b.default=n})},"esri/views/2d/engine/webgl/collisions/visualVariableSimpleUtils":function(){define(["require","exports","../../../../../core/mathUtils","../../../../../renderers/support/utils"],function(n,b,l,k){function h(b,f){switch(f.transformationType){case "additive":var c=a(f.minSize,b);return b+(c||f.minDataValue);case "constant":return c=(c=f.stops)&&c.length&&c[0].size,
null==c&&(c=f.minSize),a(c,b);case "clamped-linear":var c=(b-f.minDataValue)/(f.maxDataValue-f.minDataValue),d=a(f.minSize,b),h=a(f.maxSize,b);b=b<=f.minDataValue?d:b>=f.maxDataValue?h:d+c*(h-d);return b;case "proportional":return c=b/f.minDataValue,d=a(f.minSize,b),b=a(f.maxSize,b),l.clamp(c*d,d,b);case "stops":return d=g(b,f.cache.ipData),h=d[0],c=d[1],d=d[2],h===c?b=a(f.stops[h].size,b):(h=a(f.stops[h].size,b),b=a(f.stops[c].size,b),b=h+(b-h)*d),b;case "real-world-size":c=k.meterIn[f.valueUnit];
d=a(f.minSize,b);h=a(f.maxSize,b);f=f.valueRepresentation;var r=null,r="area"===f?2*Math.sqrt(b/e)/c:"radius"===f||"distance"===f?2*b/c:b/c;return l.clamp(r,d,h);case "identity":return b;case "unknown":return null}}function a(a,b){return"number"===typeof a?a:h(b,a)}function g(a,b){if(b){var c=0,d=b.length-1;b.some(function(b,e){if(a<b)return d=e,!0;c=e;return!1});return[c,d,(a-b[c])/(b[d]-b[c])]}}Object.defineProperty(b,"__esModule",{value:!0});var e=Math.PI;b.getSizeForValueSimple=h})},"esri/views/2d/engine/webgl/collisions/LayerViewSorter":function(){define(["require",
"exports"],function(n,b){function l(b){return"esri.views.2d.layers.FeatureLayerView2D"===b.declaredClass||"esri.views.2d.layers.StreamLayerView2D"===b.declaredClass}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a){this.registerLayer=b;this.unregisterLayer=a;this._layerViewState=new Map}b.prototype.findIndex=function(b){return b.view.allLayerViews.findIndex(function(a){return a.uid===b.uid})};b.prototype.update=function(b){for(var a=b.added,g=0,e=b.removed;g<e.length;g++)b=
e[g],l(b)&&this._layerViewState.has(b)&&this._deleteState(b);for(g=0;g<a.length;g++){b=a[g];if(e=l(b))a:switch(b.get("layer.renderer.type")){case "class-breaks":case "simple":case "unique-value":e=!0;break a;default:e=!1}e&&!this._layerViewState.has(b)&&this._createState(b)}this._recomputeOrder()};b.prototype.destroy=function(){this._layerViewState.forEach(function(b,a){return b.handle.remove()})};b.prototype._createState=function(b){var a={priority:-1,handle:null};a.handle=b.watch("labelsVisible",
this._recomputeOrder.bind(this));this._layerViewState.set(b,a);return a};b.prototype._deleteState=function(b){if(this._layerViewState.has(b)){var a=this._layerViewState.get(b);a.handle.remove();-1!==a.priority&&this.unregisterLayer(b);this._layerViewState.delete(b)}};b.prototype._recomputeOrder=function(){var b=this;this._layerViewState.forEach(function(a,g){var e=g.view.map.allLayers.findIndex(function(a){return a.uid===g.layer.uid}),d=g.layer,e=d.visible&&d.labelsVisible&&d.labelingInfo?4294967295-
e:-1;e!==a.priority&&(a.priority=e,b.unregisterLayer(g),-1!==e&&b.registerLayer(g,e))})};return b}();b.LayerViewSorter=n})},"esri/views/2d/engine/webgl/Geometry":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,h){this.x=b;this.y=h}b.prototype.clone=function(){return new b(this.x,this.y)};b.prototype.equals=function(b,h){return b===this.x&&h===this.y};b.prototype.isEqual=function(b){return b.x===this.x&&b.y===this.y};
b.prototype.setCoords=function(b,h){this.x=b;this.y=h};b.prototype.normalize=function(){var b=this.x,h=this.y,b=Math.sqrt(b*b+h*h);this.x/=b;this.y/=b};b.prototype.rightPerpendicular=function(){var b=this.x;this.x=this.y;this.y=-b};b.prototype.move=function(b,h){this.x+=b;this.y+=h};b.prototype.assign=function(b){this.x=b.x;this.y=b.y};b.prototype.assignAdd=function(b,h){this.x=b.x+h.x;this.y=b.y+h.y};b.prototype.assignSub=function(b,h){this.x=b.x-h.x;this.y=b.y-h.y};b.prototype.rotate=function(b,
h){var a=this.x,g=this.y;this.x=a*b-g*h;this.y=a*h+g*b};b.prototype.scale=function(b){this.x*=b;this.y*=b};b.prototype.length=function(){var b=this.x,h=this.y;return Math.sqrt(b*b+h*h)};b.distance=function(b,h){var a=h.x-b.x;b=h.y-b.y;return Math.sqrt(a*a+b*b)};b.add=function(k,h){return new b(k.x+h.x,k.y+h.y)};b.sub=function(k,h){return new b(k.x-h.x,k.y-h.y)};return b}();b.Point=n})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,
"__esModule",{value:!0});b.getXAnchorDirection=function(b){switch(b){case "left":return 1;case "right":return-1;case "center":case "justify":return 0}};b.getYAnchorDirection=function(b){switch(b){case "top":return-1;case "middle":return 0;case "baseline":case "bottom":return 1}};b.getJustification=function(b){switch(b){case "left":return 0;case "right":return 1;case "center":case "justify":return.5}}})},"esri/views/2d/engine/webgl/brushes/BrushBitmap":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../definitions ../VertexStream ./WGLBrush".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});var g={nearest:{defines:[],samplingMode:9728,mips:!1},bilinear:{defines:[],samplingMode:9729,mips:!1},bicubic:{defines:["bicubic"],samplingMode:9729,mips:!1},trilinear:{defines:[],samplingMode:9987,mips:!0}};n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._desc={path:"raster/bitmap",attributes:{a_position:0,a_texcoord:1}};return b}l(b,a);b.prototype.dispose=function(){this._quad&&this._quad.dispose()};
b.prototype.prepareState=function(a,b){a=a.context;a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,b.stencilRef,255)};b.prototype.draw=function(a,b){var c=a.context,d=a.renderingOptions,e=a.painter;if(b.source){a.timeline.begin(this.name);this._quad||(this._quad=new h(c,[0,0,1,0,0,1,1,1]));if("dynamic"===d.samplingMode)var d=a.state,f=b.resolution/b.pixelRatio/d.resolution,l=
Math.round(a.pixelRatio)!==a.pixelRatio,d=d.rotation||1.05<f||.95>f||l||b.isSourceScaled||b.rotation?g.bilinear:g.nearest;else d=g[d.samplingMode];e=e.materialManager.getProgram(a,this._desc,d.defines);b.setSamplingProfile(d);b.bind(k.TEXTURE_BINDING_BITMAP);c.bindProgram(e);e.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);e.setUniform1i("u_texture",k.TEXTURE_BINDING_BITMAP);e.setUniform2fv("u_coordScale",b.coordScale);this._quad.draw();a.timeline.end(this.name)}};return b}(a.default);b.default=
n})},"esri/views/2d/engine/webgl/brushes/BrushClip":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../Utils ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/programUtils".split(" "),function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._color=k.vec4f32.fromValues(0,1,0,1);return b}l(b,a);b.prototype.dispose=function(){this._program&&
this._program.dispose()};b.prototype.prepareState=function(a,b){a=a.context;a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setFaceCullingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255);a.setStencilFunction(519,0,255)};b.prototype.draw=function(a,b){var c=a.context;a=a.state;this._program||(this._program=e.createProgram(c,g.background));var d=this._program,f=h.createProgramDescriptor("clip",{geometry:[{location:0,name:"a_pos",count:2,type:5122}]});
b=b.getVAO(c,a,f.attributes,f.bufferLayouts);c.bindProgram(this._program);d.setUniform2fv("u_coord_range",[1,1]);d.setUniform4fv("u_color",this._color);d.setUniformMatrix3fv("u_dvsMat3",a.displayMat3);c.bindVAO(b);c.drawElements(4,b.indexBuffer.size,5125,0);c.bindVAO()};return b}(a.default);b.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrush":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../definitions ./WGLBrush".split(" "),function(n,
b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.prototype.prepareState=function(a,b,c){a=a.context;c=c&&-1!==c.indexOf("id");a.setBlendingEnabled(!c);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,b.stencilRef,255)};b.prototype.draw=function(a,b,c){var d=this;if(b.isReady&&b.hasData){b.commitChanges(a);var e=
this.getGeometryType(),f=b.getDisplayList(a.drawPhase),g=b.getGeometry(a,e);g&&f&&(a.timeline.begin(this.name),f.byType(e,function(e){d.drawGeometry(a,b,e,g,c)}),a.timeline.end(this.name))}};b.prototype._getVAO=function(a,b,c,e){e.vao||(e.vao=new k.VertexArrayObject(a,c,b,e.vertexBufferMap,e.indexBuffer));return e.vao};b.prototype._setSharedUniforms=function(a,b,c){a.setUniform1f("u_pixelRatio",b.pixelRatio);a.setUniformMatrix3fv("u_dvsMat3",c.transforms.dvs);a.setUniformMatrix3fv("u_displayViewMat3",
b.state.displayViewMat3);a.setUniformMatrix4fv("u_insideEffectMat4",b.rendererInfo.insideEffect);a.setUniformMatrix4fv("u_outsideEffectMat4",b.rendererInfo.outsideEffect);a.setUniform1fv("u_insideOpacities",b.rendererInfo.insideOpacities);a.setUniform1fv("u_outsideOpacities",b.rendererInfo.outsideOpacities);a.setUniform1i("u_attributeTextureSize",b.attributeView.size);a.setUniform1i("u_attributeData0",h.TEXTURE_BINDING_ATTRIBUTE_DATA_0);a.setUniform1i("u_attributeData1",h.TEXTURE_BINDING_ATTRIBUTE_DATA_1);
a.setUniform1i("u_attributeData2",h.TEXTURE_BINDING_ATTRIBUTE_DATA_2);a.setUniform1i("u_attributeData3",h.TEXTURE_BINDING_ATTRIBUTE_DATA_3)};return b}(a.default);b.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushFill":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/RandomLCG ../../../../webgl ../definitions ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(n,
b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a._dotTextureSize=0;a._dotTextures=null;a._dotSamplers=new Int32Array([g.TEXTURE_BINDING_RENDERER_0,g.TEXTURE_BINDING_RENDERER_1]);return a}l(f,b);f.prototype.dispose=function(){this._disposeTextures()};f.prototype.getGeometryType=function(){return e.WGLGeometryType.FILL};f.prototype.drawGeometry=function(a,b,e,f,h){var k=a.context,m=a.painter,l=a.rendererInfo,
p=a.requiredLevel,q=e.indexCount,r=e.indexFrom;e=c.FillMaterialKey.load(e.materialKey);var t=d.createProgramDescriptor(e.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121}].concat(e.dotDensity?[]:[{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_tlbr",count:4,type:5123},{location:4,name:"a_aux1",count:4,type:5121},{location:5,name:"a_aux2",count:2,type:5123},{location:6,name:"a_aux3",count:4,type:5121}],e.dotDensity?
[{location:2,name:"a_inverseArea",count:1,type:5126}]:[])}),u=t.bufferLayouts,t=t.attributes;h=m.materialManager.getMaterialProgram(a,e,"materials/fill",t,h);f=this._getVAO(k,u,t,f);k.bindProgram(h);k.bindVAO(f);this._setSharedUniforms(h,a,b);e.textureBinding&&(m.textureManager.bindTextures(k,h,e),m=1/Math.pow(2,p-b.key.level)/a.pixelRatio,h.setUniform1f("u_zoomFactor",m));e.vvColor&&(h.setUniform1fv("u_vvColorValues",l.vvColorValues),h.setUniform4fv("u_vvColors",l.vvColors));e.vvOpacity&&(h.setUniform1fv("u_vvOpacityValues",
l.vvOpacityValues),h.setUniform1fv("u_vvOpacities",l.vvOpacities));e.dotDensity&&(e=g.TILE_SIZE/l.ddDotSize,f=e*window.devicePixelRatio*e*window.devicePixelRatio,m=1/Math.pow(2,p-b.key.level),b=1/m*(1/m),a=l.ddDotScale?a.state.scale/l.ddDotScale:1,h.setUniform1f("u_tileZoomFactor",m),h.setUniform1f("u_tileDotsOverArea",f/(g.TILE_SIZE*window.devicePixelRatio*g.TILE_SIZE*window.devicePixelRatio)),h.setUniformMatrix4fv("u_dotColors",l.ddColors),h.setUniform4fv("u_isActive",l.ddActiveDots),h.setUniform4fv("u_dotBackgroundColor",
l.ddBackgroundColor),h.setUniform1f("u_dotValue",Math.max(1,l.ddDotValue*a*b)),this._bindDotDensityTextures(k,h,l,e));k.drawElements(4,q,5125,4*r);k.bindVAO(null)};f.prototype._disposeTextures=function(){if(this._dotTextures){for(var a=0;a<this._dotTextures.length;a++)this._dotTextures[a].dispose();this._dotTextures=null}};f.prototype._bindDotDensityTextures=function(a,b,c,d){c=this._createDotDensityTextures(a,d,c.ddSeed);b.setUniform1iv("u_dotTextures",this._dotSamplers);for(b=0;b<c.length;b++)a.bindTexture(c[b],
this._dotSamplers[b])};f.prototype._createDotDensityTextures=function(a,b,c){if(this._dotTextureSize!==b||this._seed!==c)this._disposeTextures(),this._dotTextureSize=b,this._seed=c;null===this._dotTextures&&(c=new h(c),this._dotTextures=[this._allocDotDensityTexture(a,b,c),this._allocDotDensityTexture(a,b,c)]);return this._dotTextures};f.prototype._allocDotDensityTexture=function(b,c,d){for(var e=new Float32Array(c*c*4),f=0;f<e.length;f++)e[f]=d.getFloat();return new a.Texture(b,{wrapMode:10497,pixelFormat:6408,
dataType:5126,samplingMode:9728,width:c,height:c},e)};return f}(f.default);b.default=n})},"esri/views/2d/engine/webgl/materialKey/MaterialKey":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../renderers ../../../../../core/Error ../../../../../core/maybe ../enums ../mesh/templates/WGLLabelTemplate ../util/vvFlagUtils".split(" "),function(n,b,l,k,h,a,g,e,d,f){Object.defineProperty(b,"__esModule",{value:!0});b.createMaterialKey=
function(a,b,c,d){if(g.isSome(b)){a:{if("heatmap"===b.type)throw Error("Symbol processor does not support heatmap renderer");switch(a){case e.WGLGeometryType.FILL:a=r.from(b);break a;case e.WGLGeometryType.LINE:a=x.from(b,c);break a;case e.WGLGeometryType.MARKER:if("dot-density"===b.type)throw Error("Dot Density renderer does not support Marker GeometryTypes");a=t.from(b);break a;case e.WGLGeometryType.TEXT:if("dot-density"===b.type)throw Error("Dot Density renderer does not support Text GeometryTypes");
a=w.from(b);break a;case e.WGLGeometryType.LABEL:if("dot-density"===b.type)throw Error("Dot Density renderer does not support Label GeometryTypes");a=u.from(b,d);break a;default:throw Error("Unable to createMaterialKey for unknown geometryType "+a);}}return a}switch(a){case e.WGLGeometryType.FILL:return r.from(null);case e.WGLGeometryType.LINE:return x.from(null,c);case e.WGLGeometryType.MARKER:return t.from(null);case e.WGLGeometryType.TEXT:return w.from(null);case e.WGLGeometryType.LABEL:return u.from(null,
d);default:throw Error("Unable to createMaterialKey for unknown geometryType "+a);}};n=function(){function b(a){this._data=0;this._data=a}b.load=function(a){var b=this.shared;b.data=a;return b};Object.defineProperty(b.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometryType",{get:function(){return this.bits(5,8)},set:function(a){this.setBits(a,5,8)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"mapAligned",{get:function(){return!!this.bit(17)},set:function(a){this.setBit(17,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sdf",{get:function(){return!!this.bit(8)},set:function(a){this.setBit(8,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"pattern",{get:function(){return!!this.bit(9)},set:function(a){this.setBit(9,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureBinding",{get:function(){return this.bits(0,5)},set:function(a){this.setBits(a,
0,5)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometryTypeString",{get:function(){switch(this.geometryType){case e.WGLGeometryType.FILL:return"fill";case e.WGLGeometryType.MARKER:return"marker";case e.WGLGeometryType.LINE:return"line";case e.WGLGeometryType.TEXT:return"text";case e.WGLGeometryType.LABEL:return"label";default:throw new a("Unable to handle unknown geometryType: "+this.geometryType);}},enumerable:!0,configurable:!0});b.prototype.setBit=function(a,b){a=1<<a;
this._data=b?this._data|a:this._data&~a};b.prototype.bit=function(a){return(this._data&1<<a)>>a};b.prototype.setBits=function(a,b,c){for(var d=0;b<c;b++,d++)this.setBit(b,0!==(a&1<<d))};b.prototype.bits=function(a,b){for(var c=0,d=0;a<b;a++,d++)c|=this.bit(a)<<d;return c};b.prototype.hasVV=function(){return!1};b.prototype.setVV=function(a,b){};b.prototype.getVariation=function(){var a={},b;for(b in this)"boolean"===typeof this[b]&&(a[b]=this[b]);return a};b.prototype.getVariationHash=function(){return this._data&
~(4&this.textureBinding)};b.shared=new b(0);return b}();b.MaterialKeyBase=n;k=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);Object.defineProperty(b.prototype,"vvSizeMinMaxValue",{get:function(){return 0!==this.bit(13)},set:function(a){this.setBit(13,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeScaleStops",{get:function(){return 0!==this.bit(14)},set:function(a){this.setBit(14,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"vvSizeFieldStops",{get:function(){return 0!==this.bit(15)},set:function(a){this.setBit(15,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeUnitValue",{get:function(){return 0!==this.bit(16)},set:function(a){this.setBit(16,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,
b,c);b&=f.getSizeFlagsMask(b,c);this.vvSizeMinMaxValue=!!(b&e.WGLVVFlag.SIZE_MINMAX_VALUE);this.vvSizeFieldStops=!!(b&e.WGLVVFlag.SIZE_FIELD_STOPS);this.vvSizeUnitValue=!!(b&e.WGLVVFlag.SIZE_UNIT_VALUE);this.vvSizeScaleStops=!!(b&e.WGLVVFlag.SIZE_SCALE_STOPS)};return b}(a)};var c=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);Object.defineProperty(b.prototype,"vvRotation",{get:function(){return 0!==this.bit(12)},set:function(a){this.setBit(12,a)},
enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvRotation};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);this.vvRotation=!c&&!!(b&e.WGLVVFlag.ROTATION)};return b}(a)},q=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);Object.defineProperty(b.prototype,"vvColor",{get:function(){return 0!==this.bit(10)},set:function(a){this.setBit(10,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=
function(){return a.prototype.hasVV.call(this)||this.vvColor};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);this.vvColor=!c&&!!(b&e.WGLVVFlag.COLOR)};return b}(a)},p=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);Object.defineProperty(b.prototype,"vvOpacity",{get:function(){return 0!==this.bit(11)},set:function(a){this.setBit(11,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||
this.vvOpacity};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);this.vvOpacity=!c&&!!(b&e.WGLVVFlag.OPACITY)};return b}(a)},r=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a){var b=this.load(0);b.geometryType=e.WGLGeometryType.FILL;g.isSome(a)&&(a instanceof h.DotDensityRenderer?b.dotDensity=!0:(a=f.getVVFlags(a.visualVariables),b.setVV(a,!1)));return b.data};b.prototype.getVariation=
function(){return a.prototype.getVariation.call(this)};Object.defineProperty(b.prototype,"dotDensity",{get:function(){return!!this.bit(12)},set:function(a){this.setBit(12,a)},enumerable:!0,configurable:!0});b.shared=new b(0);return b}(q(p(n)));b.FillMaterialKey=r;var t=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a){var b=this.load(0);b.geometryType=e.WGLGeometryType.MARKER;g.isSome(a)&&(a=f.getVVFlags(a.visualVariables),
b.setVV(a,!1));return b.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(q(p(c(k(n)))));b.MarkerMaterialKey=t;var x=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a,b){var c=this.load(0);c.geometryType=e.WGLGeometryType.LINE;g.isSome(a)&&(a=f.getVVFlags(a.visualVariables),c.setVV(a,b));return c.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};
b.shared=new b(0);return b}(q(p(k(n))));b.LineMaterialKey=x;var w=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a){var b=this.load(0);b.geometryType=e.WGLGeometryType.TEXT;g.isSome(a)&&(a=f.getVVFlags(a.visualVariables),b.setVV(a,!1));return b.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(q(p(c(k(n)))));b.TextMaterialKey=w;var u=
function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a,b){var c=this.load(0);c.geometryType=e.WGLGeometryType.LABEL;g.isSome(a)&&(a=f.getVVFlags(a.visualVariables),c.setVV(a,!1));c.mapAligned=!!d.isMapAligned(b.labelPlacement);return c.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(k(n));b.LabelMaterialKey=u})},"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/mathUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../vectorTiles/GeometryUtils ../../color ../../definitions ../../enums ../../number ../../TextShaping ../../collisions/Metric ../../materialKey/MaterialKey ./GlyphGroup ./util ./WGLTextTemplate".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z){function B(a){switch(a){case "above-left":return[-1,-1];case "above-center":case "above-along":return[0,-1];case "above-right":return[1,-1];case "center-left":return[-1,0];case "center-center":case "center-along":return[0,0];case "center-right":return[1,0];case "below-left":return[-1,1];case "below-center":case "below-along":return[0,1];case "below-right":return[1,1];case "always-horizontal":return[0,0];default:Q("Found invalid placement type "+
a)}}Object.defineProperty(b,"__esModule",{value:!0});var C=h.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),D=c.vec2f32.create(),K=d.mat2df32.create(),I={xOffset:0,yOffset:0,width:0,height:0},Q=function(a,b){void 0===b&&(b="mapview-labeling");return C.error(new k(b,a))};b.isMapAligned=function(a){switch(a){case "above-along":case "below-along":case "center-along":return 1;default:return 0}};n=function(b){function c(c,d,e,f){e=b.call(this,c,e.font.size,e.haloSize||0,e.font.size,e.color&&
p.premultiplyAlphaRGBA(e.color)||0,e.haloColor&&p.premultiplyAlphaRGBA(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.id)||this;e._refTemplate=I;e.geometryType=t.WGLGeometryType.LABEL;var g=d.symbol,h;h=!!d.minScale&&f.scaleToZoom(d.minScale)||0;h=a.clamp(h,0,25.5);f=!!d.maxScale&&f.scaleToZoom(d.maxScale)||255;f=a.clamp(f,0,25.5);var k=B(d.labelPlacement),m=k[0],k=k[1];e._justify=(-1*m+1)/2;e._xAlignD=m;e._yAlignD=k;e._xPlacementD=
m;e._yPlacementD=k;e._minZoom=h;e._maxZoom=f;c=y.LabelMaterialKey.load(y.createMaterialKey(e.geometryType,c,!1,d));c.sdf=!0;e._materialKey=c.data;c=g.font.decoration.toLowerCase();"underline"===c?e._decorationTop=6:"line-through"===c&&(e._decorationTop=-5);return e}l(c,b);c.fromLabelClass=function(a,b,d){return new c(a,b,b.symbol,d)};c.prototype.bindTextInfo=function(a,b,c){a=this._computeShaping(a,this._justify).getShaping(b,c);isNaN(this._decorationTop)||w.TextShaping.addDecoration(a,this._decorationTop);
this._shapedGlyphs=a;this._shapedBox=w.TextShaping.getBox(a)};c.prototype._computeShaping=function(a,b){return new w.TextShaping([a],r.TEXT_MAX_WIDTH,r.TEXT_LINE_HEIGHT,r.TEXT_SPACING,[0,0],.5,.5,b)};Object.defineProperty(c.prototype,"bounds",{get:function(){return this._bounds},enumerable:!0,configurable:!0});c.prototype.bindReferenceTemplate=function(a){this._refTemplate=a||I};c.prototype._placeGlyphs=function(a,b,c,d){var e=this._size,f=this._haloSize,h=this._shapedBox,k=this._shapedGlyphs,m=this._computeGlyphTransform(h);
if("esriGeometryPolyline"!==a)for(var l=0;l<c.length;l++)for(var p=c[l],q=0,r=k;q<r.length;q++){var v=r[q];p.place(v,a,b,m,this._materialKey,e,f,h,d,this._minZoom,this._maxZoom)}else for(l=0;l<c.length;l++)for(var p=c[l],q=v=p.order,r=q-(q-1)/2-1,t=r-(r-1)/2-1,u=t-(t-1)/2-1,v=-1===v?0:q%2?r%2?t%2?u%2?0:d-3.1:d-2.1:d-1.1:d-.1,q=Math.max(d+g.log2((this._shapedBox.width*this._scale+48)/p.pathLen),Math.max(v,this._minZoom)),r=0,t=k;r<t.length;r++)v=t[r],p.place(v,a,b,m,this._materialKey,e,f,h,d,q,this._maxZoom)};
c.prototype.writeMesh=function(a,b,c,d,e,f,g){var h=this,k=this._computeAnchors(c,e),m=x.i8888to32(0,0,0,this._bitset);if(k.length&&this._shapedGlyphs.length){this._placeGlyphs(c,e,k,f);var l=y.LabelMaterialKey.load(this._materialKey);if("esriGeometryPolyline"!==c){c=k[0];e=this._computeGlyphTransform(this._shapedBox);e=this._createBounds(this._shapedBox,e);f=c.glyphs.get(0);var p=f[0],q=p.anchorX,v=p.anchorY,t=Math.floor(10*p.minZoom),p=Math.floor(10*p.maxZoom),z=a.length;f.forEach(function(a){a.minZoom=
25.5;a.maxZoom=25.5});z=new u.default(d,{from:z,count:a.length-z},q,v,t);q=Math.floor(q/r.COLLISION_BUCKET_SIZE);v=Math.floor(v/r.COLLISION_BUCKET_SIZE);q>=r.COLLISION_TILE_BOX_SIZE||v>=r.COLLISION_TILE_BOX_SIZE||0>q||0>v||(this._writeVertices(a,b,d,f,l,m,t,p),f=Math.max(this._refTemplate.height,this._refTemplate.width),l.vvSizeFieldStops||l.vvSizeMinMaxValue||l.vvSizeScaleStops||l.vvSizeUnitValue?z.setVV(f,this._xPlacementD,this._yPlacementD):(z.offsetX=(f/2+r.COLLISION_PLACEMENT_PADDING)*this._xPlacementD,
z.offsetY=(f/2+r.COLLISION_PLACEMENT_PADDING)*this._yPlacementD),z.bounds=e,g.push(z),c.clear())}else{c=function(c){var e=k[c],f=e.x,p=e.y;c=a.length;var q=new u.default(d,{from:c,count:-1},f,p,25.5);e.glyphs.forEach(function(c){for(var g=0;g<c.length;g++){var k=c[g];k.minZoom=Math.max(e.minZoom,k.minZoom);if(k.bounds){var r=k.anchorY-p;k.bounds.center[0]+=k.anchorX-f;k.bounds.center[1]+=r;q.add(k.bounds)}}q.bounds&&h._writeHalos(a,b,d,c,l,m)});e.glyphs.forEach(function(c){q.bounds&&h._writeText(a,
b,d,c,l,m)});q.range.count=a.length-c;q.bounds&&g.push(q);e.clear()};for(e=0;e<k.length;e++)c(e);this._computedGlyphs=[]}}};c.prototype._outsideTile=function(a,b){return 0>a||512<=a||0>b||512<=b};c.prototype._smoothVertices=function(a,b){if(!(0>=b)){var c=a.length;if(!(3>c)){var d=[],e=0;d.push(0);for(var f=1;f<c;f++)e+=v.dist(a[f],a[f-1]),d.push(e);b=Math.min(b,.2*e);e=[];e.push(a[0][0]);e.push(a[0][1]);var g=a[c-1][0],h=a[c-1][1],f=v.sub([0,0],a[0],a[1]);v.normalize(f);a[0][0]+=b*f[0];a[0][1]+=
b*f[1];v.sub(f,a[c-1],a[c-2]);v.normalize(f);a[c-1][0]+=b*f[0];a[c-1][1]+=b*f[1];for(f=1;f<c;f++)d[f]+=b;d[c-1]+=b;for(var k=.5*b,f=1;f<c-1;f++){for(var m=0,l=0,p=0,q=f-1;0<=q&&!(d[q+1]<d[f]-k);q--){var r=k+d[q+1]-d[f],t=d[q+1]-d[q],u=d[f]-d[q]<k?1:r/t;if(1E-6>Math.abs(u))break;var z=u*u,n=u*r-.5*z*t,y=u*t/b,w=a[q+1],x=a[q][0]-w[0],B=a[q][1]-w[1],m=m+y/n*(w[0]*u*r+.5*z*(r*x-t*w[0])-z*u*t*x/3),l=l+y/n*(w[1]*u*r+.5*z*(r*B-t*w[1])-z*u*t*B/3),p=p+y}for(q=f+1;q<c&&!(d[q-1]>d[f]+k);q++){r=k-d[q-1]+d[f];
t=d[q]-d[q-1];u=d[q]-d[f]<k?1:r/t;if(1E-6>Math.abs(u))break;z=u*u;n=u*r-.5*z*t;y=u*t/b;w=a[q-1];x=a[q][0]-w[0];B=a[q][1]-w[1];m+=y/n*(w[0]*u*r+.5*z*(r*x-t*w[0])-z*u*t*x/3);l+=y/n*(w[1]*u*r+.5*z*(r*B-t*w[1])-z*u*t*B/3);p+=y}e.push(m/p);e.push(l/p)}e.push(g);e.push(h);for(q=f=0;f<c;f++)a[f][0]=e[q++],a[f][1]=e[q++]}}};c.prototype._computeLineAnchors=function(a,b,c){b=b.paths;var d=this._scale*this._shapedBox.width;c=d/2+c;for(var d=d/2+16,e=this._shapedBox.width*this._scale,f=0;f<b.length;f++){var g=
b[f],h=[];h.push(g[0]);for(var k=1;k<g.length;k++){var l=h[k-1],p=l[0],l=l[1],p=p+g[k][0],l=l+g[k][1];h.push([p,l])}this._smoothVertices(h,e);g=[];g.push(h[0]);for(k=1;k<h.length;k++){var l=h[k-1],q=h[k],p=Math.round(q[0]-l[0]),l=Math.round(q[1]-l[1]);g.push([p,l])}b[f]=g;h=this._getPathLength(g);if(!(h<2*d))for(var k=h/2,r=0,q=g[0][0],v=g[0][1],t=1;t<g.length;t++){var p=g[t][0],l=g[t][1],u=Math.sqrt(p*p+l*l),r=r+u;if(0<=r-k){var z=r-k,n=u-z,y=n/u,w=q+p*y,x=v+l*y;this._outsideTile(w,x)||(r=new m.default(w,
x,y,f,t,q,v,u,h,-1),a.push(r));for(var B=-1,x=0,x=n-c;0<=x;x-=c){var y=x/u,w=q+p*y,C=v+l*y;B++;this._outsideTile(w,C)||(r=new m.default(w,C,y,f,t,q,v,u,h,B),a.push(r))}r=x+c;x=u-z;y=q;w=v;for(C=t-1;0!==C;C--){var D=g[C][0],L=g[C][1],N=Math.sqrt(D*D+L*L);if(r+N>=c){for(var K=r=c-r;K<N;K+=c){var J=K/N,I=y-D*J,R=w-L*J;B++;(r=K+x+d<k)&&!this._outsideTile(I,R)&&(r=new m.default(I,R,1-J,f,C,y-D,w-L,N,h,B),a.push(r))}r=N-(K-c)}else r+=N;x+=N;y-=D;w-=L}B=-1;for(x=n+c;x<=u;x+=c)y=x/u,w=q+p*y,n=v+l*y,B++,this._outsideTile(w,
n)||(r=new m.default(w,n,y,f,t,q,v,u,h,B),a.push(r));y=q+p;w=v+l;r=u-(x-c);x=z;for(C=t+1;C<g.length;C++){p=g[C][0];l=g[C][1];q=Math.sqrt(p*p+l*l);if(r+q>=c){for(v=r=c-r;v<q;v+=c)t=v/q,u=y+p*t,z=w+l*t,B++,(r=v+x+d<k)&&!this._outsideTile(u,z)&&(r=new m.default(u,z,t,f,C,y,w,q,h,B),a.push(r));r=q-(v-c)}else r+=q;x+=q;y+=p;w+=l}break}q+=p;v+=l}}return a};c.prototype._computeAnchors=function(a,b){var c=[];switch(a){case "esriGeometryPoint":return b=b.geometry,a=b.x,b=b.y,a=new m.default(a,b),c.push(a),
c;case "esriGeometryPolygon":if(b.centroid)return b=b.centroid,a=b.x,b=b.y,a=new m.default(a,b),c.push(a),c;Q("Non-centroid polygon anchor placement not supported");break;case "esriGeometryPolyline":return this._computeLineAnchors(c,b.geometry,376);default:return Q("Unable to handle geometryType: "+a),c}};c.prototype._getPathLength=function(a){for(var b=0,c=1;c<a.length;c++)var d=a[c][0],e=a[c][1],b=b+Math.sqrt(d*d+e*e);return b};c.prototype._computeGlyphTransform=function(a){var b=this._scale,c=
this._angle*q.C_DEG_TO_RAD,d=a.width/2,g=a.height/2,d=this._xAlignD*d*b+(this._xOffset+this._refTemplate.xOffset)+(a.x+d);a=this._yAlignD*g*b-(this._yOffset+this._refTemplate.yOffset)-(a.y+g);g=e.mat2d.identity(K);e.mat2d.translate(g,g,f.vec2.set(D,d,a));e.mat2d.scale(g,g,f.vec2.set(D,b,b));e.mat2d.rotate(g,g,c);return g};c.prototype._writeVertex=function(a,b,c,d,e,f,g,h,k){b=b.get("geometry");g=Math.min(Math.floor(Math.max(this._refTemplate.width,this._refTemplate.height)),255);var m=this._xPlacementD+
1,l=this._yPlacementD+1;h=x.i8888to32(h,k,0,0);this._refSymbolAndPlacementOffset=x.i8888to32(f.angle,g,m,l);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetUpperLeft);b.push(f.texFontSizeUpperLeft);b.push(this._refSymbolAndPlacementOffset);b.push(h);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetUpperRight);b.push(f.texFontSizeUpperRight);b.push(this._refSymbolAndPlacementOffset);b.push(h);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetLowerLeft);b.push(f.texFontSizeLowerLeft);b.push(this._refSymbolAndPlacementOffset);
b.push(h);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetLowerRight);b.push(f.texFontSizeLowerRight);b.push(this._refSymbolAndPlacementOffset);b.push(h);a.vertexCount+=4};return c}(z.default);b.default=n})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(n,b){function l(b,a){b%=a;return 0<=b?b:b+a}Object.defineProperty(b,"__esModule",{value:!0});b.C_INFINITY=Number.POSITIVE_INFINITY;b.C_PI=Math.PI;b.C_2PI=2*b.C_PI;b.C_PI_BY_2=b.C_PI/2;b.C_RAD_TO_256=
128/b.C_PI;b.C_256_TO_RAD=b.C_PI/128;b.C_DEG_TO_256=256/360;b.C_DEG_TO_RAD=b.C_PI/180;b.C_SQRT2=1.414213562;b.C_SQRT2_INV=1/b.C_SQRT2;var k=1/Math.LN2;b.positiveMod=l;b.radToByte=function(h){return l(h*b.C_RAD_TO_256,256)};b.degToByte=function(h){return l(h*b.C_DEG_TO_256,256)};b.log2=function(b){return Math.log(b)*k};b.sqr=function(b){return b*b};b.interpolate=function(b,a,g){return b*(1-g)+a*g};b.between=function(b,a,g){return b>=a&&b<=g||b>=g&&b<=a}})},"esri/views/2d/engine/webgl/TextShaping":function(){define(["require",
"exports","./Rect"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a,g,e,d,f,c,k){this._glyphItems=b;this._maxWidth=a;this._lineHeight=g;this._letterSpacing=e;this._offset=d;this._hAnchor=f;this._vAnchor=c;this._justify=k}b.prototype.getShaping=function(b,a){for(var g=this._letterSpacing,e=this._lineHeight,d=this._justify,f=this._maxWidth,c=[],h=0,k=0,l=0,t=0,n=-1,w=0,u=-1,y=b.length,m=0;m<y;m++){var v=b.charCodeAt(m);if(10===v){if(m!==y-1){if(n>=t){var h=
c[n],z=h.x+h.glyphMosaicItem.metrics.advance,w=Math.max(z,w);d&&this._applyJustification(c,t,n);t=c.length}k=a?k-e:k+e;h=0;++l}}else{for(var z=void 0,B=0,C=this._glyphItems;B<C.length&&!(z=C[B][v]);B++);if(z){c.push({codePoint:v,x:h,y:k,glyphMosaicItem:z});h+=z.metrics.advance+g;if(0<f&&h>f&&0<=u){B=u+1;z=c[B].x;w=Math.max(z,w);for(C=B;C<c.length;C++)c[C].y=a?c[C].y-e:c[C].y+e,c[C].x-=z;d&&this._applyJustification(c,t,u);k=a?k-e:k+e;h-=z;++l;t=B;u=-1}++n;32===v&&(u=c.length-1)}}}n>=t&&(h=c[n],w=Math.max(w,
h.x+h.glyphMosaicItem.metrics.advance),d&&this._applyJustification(c,t,n));if(0<c.length)for(b=(d-this._hAnchor)*w,g=(-this._vAnchor*(l+1)+.5)*e,a&&l&&(g+=l*e),b+=this._offset[0],g+=this._offset[1],a=0;a<c.length;a++)e=c[a],e.x+=b,e.y+=g;return c};b.getBox=function(b){if(!b.length)return null;for(var a=Infinity,g=Infinity,e=0,d=0,f=0;f<b.length;f++)var c=b[f],h=c.glyphMosaicItem.metrics,k=h.height,l=c.x,c=c.y-(k-Math.abs(h.top)),h=l+h.width+h.left,k=c+k,a=Math.min(a,l),e=Math.max(e,h),g=Math.min(g,
c),d=Math.max(d,k);return{x:a,y:g,width:e-a,height:d-g}};b.addDecoration=function(b,a){var g=b.length;if(0!==g){for(var e=b[0].x+b[0].glyphMosaicItem.metrics.left,d=b[0].y,f=1;f<g;f++){var c=b[f];if(c.y!==d){var h=b[f-1].x+b[f-1].glyphMosaicItem.metrics.left+b[f-1].glyphMosaicItem.metrics.width;b.push({codePoint:0,x:e,y:d+a-3,glyphMosaicItem:{sdf:!0,rect:new l.default(4,0,4,8),metrics:{width:h-e,height:8,left:0,top:0,advance:0},page:0}});d=c.y;e=c.x+c.glyphMosaicItem.metrics.left}}g=b[g-1].x+b[g-
1].glyphMosaicItem.metrics.left+b[g-1].glyphMosaicItem.metrics.width;b.push({codePoint:0,x:e,y:d+a-3,glyphMosaicItem:{sdf:!0,rect:new l.default(4,0,4,8),metrics:{width:g-e,height:8,left:0,top:0,advance:0},page:0}})}};b.prototype._applyJustification=function(b,a,g){for(var e=b[g],e=(e.x+e.glyphMosaicItem.metrics.advance)*this._justify;a<=g;a++)b[a].x-=e};return b}();b.TextShaping=n})},"esri/views/2d/engine/webgl/collisions/Metric":function(){define("require exports ../../../../../core/Logger ../../../../../core/libs/gl-matrix-2/vec2f32 ../definitions ./BoundingBox ../util/serializationUtils".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});var e=l.getLogger("esri/views/2d/engine/webgl/collisions/Metric");n=function(){function b(a,b,d,e,g){this.id=a;this.range=b;this.boxes=null;this.minZoom=-1;this.offsetY=this.offsetX=this.directionY=this.directionX=this.size=0;this.anchor=k.vec2f32.fromValues(d,e);this.baseZoom=g}b.prototype.add=function(a){this.bounds?(this.boxes?this.boxes.push(a):(this.boxes=[this.bounds,a],this.bounds=this.bounds.clone()),this.bounds.extend(a)):
this.bounds=a};b.prototype.computeIndex=function(){var a=this.bounds,b=this.anchor[0],d=this.anchor[1],e=Math.floor(b/h.COLLISION_BUCKET_SIZE),g=Math.floor(d/h.COLLISION_BUCKET_SIZE),k=0;if(e>h.COLLISION_TILE_BOX_SIZE||g>h.COLLISION_TILE_BOX_SIZE)g=e=h.COLLISION_TILE_BOX_SIZE,k=1;if(0>e||0>g)g=e=0,k=1;a=2*Math.max(a.halfWidth+Math.abs(a.center[0]),a.halfHeight+Math.abs(a.center[1]));b%=h.COLLISION_BUCKET_SIZE;d%=h.COLLISION_BUCKET_SIZE;this.xBucket=e;this.yBucket=g;this.xOverflow=Math.ceil(Math.abs((a-
b)/h.COLLISION_BUCKET_SIZE))+k;this.yOverflow=Math.ceil(Math.abs((a-d)/h.COLLISION_BUCKET_SIZE))+k};b.prototype.findCollisionDelta=function(a){var b=this.bounds.findCollisionDelta(a.bounds),d=this.boxes&&this.boxes.length,e=a.boxes&&a.boxes.length;return Math.abs(b)>h.COLLISION_MAX_ZOOM_DELTA||!d&&!e?b:d&&e?this._boxesToBoxes(a):d?this._boxesToBox(a):this._boxToBoxes(a)};b.prototype.computeOffset=function(a,b){b||e.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found "+
b);var c=this.size;this.hasVV&&(a=b(a),c=isNaN(a)||null==a||Infinity===a?this.size:a);this.offsetX=this.directionX*(c/2+h.COLLISION_PLACEMENT_PADDING);this.offsetY=this.directionY*(c/2+h.COLLISION_PLACEMENT_PADDING)};b.prototype.setVV=function(a,b,d){this.hasVV=!0;this.size=a;this.directionX=b;this.directionY=d};b.prototype.clone=function(){var a=new b(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);a.minZoom=this.minZoom;this.bounds&&(a.bounds=this.bounds.clone());this.boxes&&(a.boxes=
this.boxes.map(function(a){return a.clone()}));a.xBucket=this.xBucket;a.yBucket=this.yBucket;a.xOverflow=this.xOverflow;a.yOverflow=this.yOverflow;a.hasVV=this.hasVV;a.size=this.size;a.directionX=this.directionX;a.directionY=this.directionY;a.offsetX=this.offsetX;a.offsetY=this.offsetY;return a};b.prototype._boxToBoxes=function(a){var b=-Infinity,d=0;for(a=a.boxes;d<a.length;d++)var e=this.bounds.findCollisionDelta(a[d]),b=Math.max(e,b);return b};b.prototype._boxesToBox=function(a){for(var b=this.boxes[0].findCollisionDelta(a.bounds),
d=1;d<this.boxes.length;d++)var e=this.boxes[d].findCollisionDelta(a.bounds),b=Math.max(e,b);return b};b.prototype._boxesToBoxes=function(a){for(var b=-Infinity,d=0;d<this.boxes.length;d++)for(var e=this.boxes[d],f=0,g=a.boxes;f<g.length;f++)var h=e.findCollisionDelta(g[f]),b=Math.max(h,b);return b};b.prototype.serialize=function(a){a.push(this.id);this.bounds.serialize(a);a.push(this.range.from);a.push(this.range.count);a.push(this.anchor[0]);a.push(this.anchor[1]);a.push(this.baseZoom);a.push(this.hasVV?
1:0);a.push(this.size);a.push(this.directionX);a.push(this.directionY);a.push(this.offsetX);a.push(this.offsetY);g.serializeList(a,this.boxes);return a};b.deserialize=function(d){var c=d.readInt32(),e=a.default.deserialize(d),f=d.readInt32(),h=d.readInt32(),k={from:f,count:h},l=d.readInt32(),n=d.readInt32(),u=d.readInt32(),f=d.readInt32(),h=d.readInt32(),y=d.readInt32(),m=d.readInt32(),v=d.readInt32(),z=d.readInt32();d=g.deserializeList(d,a.default);c=new b(c,k,l,n,u);c.bounds=e;c.boxes=d;c.computeIndex();
f&&c.setVV(h,y,m);c.offsetX=v;c.offsetY=z;return c};return b}();b.default=n})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["require","exports","../../../../../core/mathUtils","../../../../../core/libs/gl-matrix-2/vec2f32"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,e,d){this.center=k.vec2f32.fromValues(a,b);this.centerT=k.vec2f32.create();this.halfWidth=e/2;this.halfHeight=d/2;this.width=e;this.height=d}Object.defineProperty(b.prototype,
"x",{get:function(){return this.center[0]},set:function(a){this.center[0]=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"y",{get:function(){return this.center[1]},set:function(a){this.center[1]=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"blX",{get:function(){return this.center[0]-this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"blY",{get:function(){return this.center[1]-this.halfHeight},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"trX",{get:function(){return this.center[0]+this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"trY",{get:function(){return this.center[1]+this.halfHeight},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new b(this.x,this.y,this.width,this.height)};b.prototype.serialize=function(a){a.writeF32(this.center[0]);a.writeF32(this.center[1]);a.push(this.width);a.push(this.height);return a};b.prototype.findCollisionDelta=
function(a){return l.log2(Math.min((a.halfWidth+this.halfWidth)/Math.abs(a.centerT[0]-this.centerT[0]),(a.halfHeight+this.halfHeight)/Math.abs(a.centerT[1]-this.centerT[1])))};b.prototype.extend=function(a){var b=Math.min(this.blX,a.blX),e=Math.min(this.blY,a.blY),d=Math.max(this.trY,a.trY);this.width=Math.max(this.trX,a.trX)-b;this.height=d-e;this.halfWidth=this.width/2;this.halfHeight=this.height/2;this.x=b+this.halfWidth;this.y=e+this.halfHeight};b.deserialize=function(a){var g=a.readF32(),e=a.readF32(),
d=a.readInt32();a=a.readInt32();return new b(g,e,d,a)};return b}();b.default=n})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.serializeList=function(b,k){if(null===k)b.push(0);else{b.push(k.length);for(var h=0;h<k.length;h++)k[h].serialize(b);return b}};b.deserializeList=function(b,k,h){for(var a=b.readInt32(),a=Array(a),g=0;g<a.length;g++)a[g]=k.deserialize(b,h);return a}})},"esri/views/2d/engine/webgl/mesh/templates/GlyphGroup":function(){define("require exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../definitions ../../materialKey/MaterialKey ./ComputedGlyph ./util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});var q=k.getLogger("esri.views.2d.engine.webgl.GlyphGroup");n=function(){function b(a,b,c,d,e,f,g,h,k,l){void 0===c&&(c=0);void 0===d&&(d=-1);void 0===e&&(e=-1);void 0===f&&(f=-1);void 0===g&&(g=-1);void 0===h&&(h=-1);void 0===k&&(k=0);void 0===l&&(l=-1);this.x=a;this.y=b;this.t=c;this.i=d;this.j=e;this.segmentPosX=f;this.segmentPosY=g;this.segmentLen=h;this.pathLen=k;this.order=l;this._glyphs=new Map;this.minZoom=0}Object.defineProperty(b.prototype,
"glyphs",{get:function(){return this._glyphs},enumerable:!0,configurable:!0});b.prototype.add=function(a,b){var c=this._glyphs.get(b);c?c.push(a):this._glyphs.set(b,[a])};b.prototype.clear=function(){this._glyphs.clear()};b.prototype.place=function(a,b,c,e,g,h,k,p,z,n,C){var m=a.x,r=a.y,v=a.codePoint,t=a.glyphMosaicItem;g=d.MaterialKeyBase.load(g);g.textureBinding=a.glyphMosaicItem.textureBinding;switch(b){case "esriGeometryPoint":case "esriGeometryPolygon":a=f.default.from(m,r,this.x,this.y,-1,n,
C,t,v,g.data,e,h,k);this.add(a,0);break;case "esriGeometryPolyline":b=c.geometry;this._placeGlyphAlongLine(a,g.data,b,e,p,h,k,z,n,C,-1);this._placeGlyphAlongLine(a,g.data,b,e,p,h,k,z,n,C,1);break;case "esriGeometryMultipoint":case "esriGeometryEnvelope":a=void 0,void 0===a&&(a="mapview-labeling"),q.error(new l(a,"Cannot place for unsupported geometryType: "+b))}};b.prototype._findLabelTheta=function(a,b,c,d){b*=d;a=Math.acos((0*b+-1*d*-a)/(1*c));0<b&&(a=2*Math.PI-a);return a};b.prototype._placeGlyphAlongLine=
function(b,d,k,l,p,q,m,v,z,n,C){k=k.paths[this.i];var r=k[this.j],t=r[0],u=r[1],r=b.x,y=b.y,w=b.glyphMosaicItem,x=b.codePoint,B=b.glyphMosaicItem.metrics,B=(b.x+B.left+B.width/2)*q/24;b=C*h.sign(B)||1;var B=Math.abs(B),M=c.len(t,u),R=this._findLabelTheta(t,u,M,C),S=(b+1)/2,M=-b*(-1*S+this.t)*M,T=a.mat2d.rotate(g.mat2df32.create(),l,-R),U=48<p.height;p=0===M?n:Math.max(Math.max(v+h.log2(Math.abs(B/M)),0),z);U&&(p=z);n=f.default.from(r,y,this.x,this.y,R,p,n,w,x,d,T,q,m,U||p<=v&&n>=v&&1===C);this.add(n,
this.j);if(!U)for(n=this.segmentPosX+S*t,t=this.segmentPosY+S*u,T=p,u=this.j+b;0<u&&u<k.length;u+=b){var Y=n,X=t,S=k[u];p=S[0];var S=S[1],P=c.len(p,S),U=this._findLabelTheta(p,S,P,C),U=a.mat2d.rotate(g.mat2df32.create(),l,-U),Y=Y+-b*p/P*M,X=X+-b*S/P*M,M=M+P,P=T-.1,T=0===M?P:Math.max(Math.max(v+h.log2(Math.abs(B/M)),0),z),U=f.default.from(r,y,Y,X,R,T,P,w,x,d,U,q,m,T<=v&&P>=v&&1===C);this.add(U,u);if(T<v-e.COLLISION_MAX_ZOOM_DELTA){this.minZoom=Math.max(T,this.minZoom);break}n+=b*p;t+=b*S}};return b}();
b.default=n})},"esri/views/2d/engine/webgl/mesh/templates/ComputedGlyph":function(){define("require exports ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../definitions ../../number ../../collisions/BoundingBox".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});var e=k.vec2f32.create();n=function(){function b(a,b,d,e,g,h,k,l,u,n,m,v,z,B,C){this.anchorX=a;this.anchorY=b;this.angle=d;this.bounds=e;this.minZoom=g;this.maxZoom=
h;this.materialKey=k;this.vertexOffsetUpperLeft=l;this.vertexOffsetUpperRight=u;this.vertexOffsetLowerLeft=n;this.vertexOffsetLowerRight=m;this.texFontSizeUpperLeft=v;this.texFontSizeUpperRight=z;this.texFontSizeLowerLeft=B;this.texFontSizeLowerRight=C}b.from=function(d,c,k,p,r,t,n,w,u,y,m,v,z,B,C){void 0===B&&(B=!1);void 0===C&&(C=!1);var f=w.rect,q=w.metrics;r=-1===r?255:Math.floor(180*r/Math.PI/360*254);var x=Math.round(f.x/4),Q=Math.round(f.y/4);w=x+Math.round(f.width/4);var J=Q+Math.round(f.height/
4),N=-24-q.top,L=q.left,M=-q.top,R=f.width,f=f.height;u||(C||(N=0),L=4,R=q.width);d+=L;u=C?c+M:c+N;R=d+R;N=u;c=d;M=u+f;f=R;C=M;var L=c+q.width,S=M-q.height,T=q.width*v/24,q=q.height*v/24;m&&(l.vec2.transformMat2d(e,l.vec2.set(e,d,u),m),d=e[0],u=e[1],l.vec2.transformMat2d(e,l.vec2.set(e,R,N),m),R=e[0],N=e[1],l.vec2.transformMat2d(e,l.vec2.set(e,c,M),m),c=e[0],M=e[1],l.vec2.transformMat2d(e,l.vec2.set(e,f,C),m),f=e[0],C=e[1],l.vec2.transformMat2d(e,l.vec2.set(e,L,S),m),L=e[0],S=e[1]);m=B?new g.default(L,
S,T+h.COLLISION_BOX_PADDING,q+h.COLLISION_BOX_PADDING):null;B=a.i1616to32(8*d,8*u);q=a.i1616to32(8*R,8*N);d=a.i1616to32(8*c,8*M);c=a.i1616to32(8*f,8*C);f=a.i8888to32(x,Q,v,z);Q=a.i8888to32(w,Q,v,z);x=a.i8888to32(x,J,v,z);v=a.i8888to32(w,J,v,z);return new b(k|0,p|0,r,m,t,n,y,B,q,d,c,f,Q,x,v)};return b}();b.default=n})},"esri/views/2d/engine/webgl/mesh/templates/util":function(){define(["require","exports"],function(n,b){function l(b,h){return Math.sqrt(b*b+h*h)}Object.defineProperty(b,"__esModule",
{value:!0});b.sub=function(b,h,a){b[0]=h[0]-a[0];b[1]=h[1]-a[1];return b};b.len=l;b.normalize=function(b){var h=l(b[0],b[1]);b[0]/=h;b[1]/=h};b.dist=function(b,h){return l(b[0]-h[0],b[1]-h[1])};b.isFunction=function(b){return"function"===typeof b};b.getLimitCosine=function(b){return 1/Math.max(b,1)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../fontUtils ../../materialKey/MaterialKey ./WGLBaseTextTemplate ./WGLMeshTemplate ../../util/BidiText".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c,d,f,l,p,m,q,z,n,C,D,K,I){f=b.call(this)||this;f._xOffset=k.pt2px(D);f._yOffset=k.pt2px(K);f._decorationTop=g.getFontDecorationTop(z);f._color=l;f._haloColor=p;f._haloSize=Math.min(Math.floor(5*k.pt2px(k.toPt(d))),127);f._size=Math.min(Math.round(k.pt2px(c)),127);c=Math.min(Math.round(k.pt2px(c)),127);f._referenceSize=Math.round(Math.sqrt(256*c));f._scale=f._size/24;f._angle=C;f._justify=h.getJustification(m||
"center");f._xAlignD=h.getXAnchorDirection(m||"center");f._yAlignD=-h.getYAnchorDirection(q||"baseline");f._baseline="baseline"===(q||"baseline");f._bitset=n?1:0;a=e.MaterialKeyBase.load(e.createMaterialKey(f.geometryType,a,!1));a.sdf=!0;f._materialKey=a.data;f.symbolId=I;return f}l(d,b);d.fromText=function(b,e,f){b=new d(b,e.font.size,e.haloSize||0,e.font.size,e.color&&a.premultiplyAlphaRGBA(e.color)||0,e.haloColor&&a.premultiplyAlphaRGBA(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,
e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.id);e=c.bidiText(e.text);b.bindTextInfo(f,e[0],e[1]);b._computeGlyphs(b._shapedGlyphs,b._shapedBox);return b};d.fromCIMText=function(b,e,f){b=new d(b,e.size*e.sizeRatio,e.outlineSize*e.sizeRatio,e.referenceSize*e.sizeRatio,a.premultiplyAlphaRGBA(e.color),a.premultiplyAlphaRGBA(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio,e.offsetY*e.sizeRatio,e.materialHash);e=c.bidiText(e.text);
b.bindTextInfo(f,e[0],e[1]);b._computeGlyphs(b._shapedGlyphs,b._shapedBox);return b};return d}(d.default(f.default));b.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../definitions ../../enums ../../number ../../TextShapingNew ../../WGLDisplayRecord ../../collisions/BoundingBox ../../materialKey/MaterialKey ./ComputedGlyph".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w){Object.defineProperty(b,"__esModule",{value:!0});var u=h.getLogger("esri.views.2d.engine.webgl.WGLTextTemplate"),y=Math.PI/180,m=g.mat2df32.create(),v=d.vec2f32.create();b.default=function(b){return function(b){function g(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];a=b.apply(this,a)||this;a.geometryType=c.WGLGeometryType.TEXT;return a}l(g,b);g.prototype.bindTextInfo=function(a,b,c){a=this._computeShaping(a,this._justify).getShaping(b,c);
isNaN(this._decorationTop)||p.TextShaping.addDecoration(a,this._decorationTop);this._shapedGlyphs=a;this._shapedBox=p.TextShaping.getBox(a)};g.prototype.writeMesh=function(a,b,c,d,e){var f=this._computedGlyphs;if(f){var g=x.TextMaterialKey.load(this._materialKey),h=q.i8888to32(0,0,this._referenceSize,this._bitset);switch(c){case "esriGeometryPoint":e=e.geometry;c=e.x;e=e.y;for(var m=0;m<f.length;m++){var l=f[m];l.anchorX=c;l.anchorY=e}this._writeVertices(a,b,d,f,g,h,0,0);break;case "esriGeometryPolygon":if(e.centroid){e=
e.centroid;c=e.x;e=e.y;for(m=0;m<f.length;m++)l=f[m],l.anchorX=c,l.anchorY=e;this._writeVertices(a,b,d,f,g,h,0,0);break}case "esriGeometryMultipoint":for(var m=e.geometry.points,p=e=c=0;p<m.length;p++){l=m[p];c+=l[0];e+=l[1];for(var r=0,v=f;r<v.length;r++)l=v[r],l.anchorX=c,l.anchorY=e;this._writeVertices(a,b,d,f,g,h,0,0)}break;default:a=void 0,void 0===a&&(a="mapview-processing"),u.error(new k(a,"Unable to handle geometryType: "+c))}}};g.prototype._computeGlyphs=function(a,b){if(a&&0!==a.length){var c=
Array(a.length);b=this._computeGlyphTransform(b);for(var d=x.MaterialKeyBase.load(this._materialKey),e=0;e<a.length;e++){var f=a[e],g=f.x,h=f.y,k=f.codePoint,f=f.glyphMosaicItem;d.textureBinding=f.textureBinding;c[e]=w.default.from(g,h,0,0,-1,0,25,f,k,d.data,b,this._size,this._haloSize,!1,!0)}this._computedGlyphs=c}};g.prototype._createBounds=function(a,b){var c=a.width/2,g=a.height/2,h=b[4],k=b[5],m;if(this._angle){a=d.vec2f32.fromValues(-c,-g);m=d.vec2f32.fromValues(c,-g);var l=d.vec2f32.fromValues(-c,
g),p=d.vec2f32.fromValues(c,g);e.vec2.transformMat2d(a,a,b);e.vec2.transformMat2d(m,m,b);e.vec2.transformMat2d(l,l,b);e.vec2.transformMat2d(p,p,b);b=g=Infinity;var q=0,r=c=0;for(a=[a,m,l,p];r<a.length;r++)m=a[r],g=Math.min(m[0],g),q=Math.max(m[0],q),b=Math.min(m[1],b),c=Math.max(m[1],c);m=q-g;a=c-b}else m=a.width*this._scale,a=a.height*this._scale;return new t.default(h,k,m+f.COLLISION_BOX_PADDING,a+f.COLLISION_BOX_PADDING)};g.prototype._computeShaping=function(a,b){return new p.TextShaping([a],512,
f.TEXT_LINE_HEIGHT,f.TEXT_SPACING,[0,.5*-f.TEXT_LINE_HEIGHT],.5*(1-this._xAlignD),0,b)};g.prototype._computeGlyphTransform=function(b){var c=this._scale,d=this._angle*y,f=a.mat2d.identity(m);a.mat2d.rotate(f,f,d);a.mat2d.translate(f,f,e.vec2.set(v,this._xOffset,-this._yOffset));a.mat2d.scale(f,f,e.vec2.set(v,c,c));a.mat2d.translate(f,f,e.vec2.set(v,-4,-4-(this._baseline?25:b.y+(1-this._yAlignD)*b.height*.5)));return f};g.prototype._writeVertices=function(a,b,c,d,e,f,g,h){this._writeHalos(a,b,c,d,
e,f,g,h);this._writeText(a,b,c,d,e,f,g,h)};g.prototype._writeHalos=function(a,b,c,d,e,f,g,h){e=b.indexVector;var k=b.getVector("geometry").vertexCount,m=0;if(this._haloSize)for(var l=0;l<d.length;l++,m+=4){var p=d[l],v=q.i1616to32(2*p.anchorX+1,2*p.anchorY),u=null==g?Math.floor(10*p.minZoom):g,t=null==h?Math.floor(10*p.maxZoom):h,n=new r(c,this.geometryType,p.materialKey,u,t);n.vertexFrom=k+m;n.indexFrom=e.length;this._writeVertex(n,b,c,v,this._haloColor,p,f,u,t);this._writeIndices(n,e,k+m);a.push(n)}};
g.prototype._writeText=function(a,b,c,d,e,f,g,h){e=b.indexVector;for(var k=b.getVector("geometry").vertexCount,m=0,l=0;l<d.length;l++,m+=4){var p=d[l],v=q.i1616to32(2*p.anchorX,2*p.anchorY),u=null==g?Math.floor(10*p.minZoom):g,t=null==h?Math.floor(10*p.maxZoom):h,n=new r(c,this.geometryType,p.materialKey,u,t);n.vertexFrom=k+m;n.indexFrom=e.length;this._writeVertex(n,b,c,v,this._color,p,f,u,t);this._writeIndices(n,e,k+m);a.push(n)}};g.prototype._writeVertex=function(a,b,c,d,e,f,g,h,k){b=b.get("geometry");
b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetUpperLeft);b.push(f.texFontSizeUpperLeft);b.push(g);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetUpperRight);b.push(f.texFontSizeUpperRight);b.push(g);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetLowerLeft);b.push(f.texFontSizeLowerLeft);b.push(g);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetLowerRight);b.push(f.texFontSizeLowerRight);b.push(g);a.vertexCount+=4};g.prototype._writeIndices=function(a,b,c){b.push(c+0);b.push(c+1);b.push(c+
2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return g}(b)}})},"esri/views/2d/engine/webgl/TextShapingNew":function(){define(["require","exports","./Rect"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a,g,e,d,f,c,k){this._glyphItems=b;this._maxWidth=a;this._lineHeight=g;this._letterSpacing=e;this._offset=d;this._hAnchor=f;this._vAnchor=c;this._justify=k}b.prototype.getShaping=function(b,a){for(var g=this._letterSpacing,e=this._lineHeight,d=this._justify,
f=this._maxWidth,c=[],h=0,k=0,l=0,t=0,n=-1,w=0,u=-1,y=b.length,m=0;m<y;m++){var v=b.charCodeAt(m);if(10===v){if(m!==y-1){if(n>=t){var h=c[n],z=h.x+h.glyphMosaicItem.metrics.advance,w=Math.max(z,w);d&&this._applyJustification(c,t,n);t=c.length}k=a?k-e:k+e;h=0;++l}}else{for(var z=void 0,B=0,C=this._glyphItems;B<C.length&&!(z=C[B][v]);B++);if(z){c.push({codePoint:v,x:h,y:k,glyphMosaicItem:z});h+=z.metrics.advance+g;if(0<f&&h>f&&0<=u){B=u+1;z=c[B].x;w=Math.max(z,w);for(C=B;C<c.length;C++)c[C].y=a?c[C].y-
e:c[C].y+e,c[C].x-=z;d&&this._applyJustification(c,t,u);k=a?k-e:k+e;h-=z;++l;t=B;u=-1}++n;32===v&&(u=c.length-1)}}}n>=t&&(h=c[n],w=Math.max(w,h.x+h.glyphMosaicItem.metrics.advance),d&&this._applyJustification(c,t,n));if(0<c.length)for(b=(d-this._hAnchor)*w,g=(-this._vAnchor*(l+1)+.5)*e,a&&l&&(g+=l*e),b+=this._offset[0],g+=this._offset[1],a=0;a<c.length;a++)e=c[a],e.x+=b,e.y+=g;return c};b.prototype.getEstimatedShaping=function(b,a,g){for(var e=this._letterSpacing,d=this._lineHeight,f=this._justify,
c=this._maxWidth,h=[],k=0,l=0,t=0,n=0,w=-1,u=0,y=-1,m=b.length,v=0;v<m;v++){var z=b.charCodeAt(v);if(10===z){if(v!==m-1){if(w>=n){var k=h[w],B=k.x+k.glyphMosaicItem.metrics.advance,u=Math.max(B,u);f&&this._applyJustification(h,n,w);n=h.length}l=a?l-d:l+d;k=0;++t}}else{B=g;h.push({codePoint:z,x:k,y:l,glyphMosaicItem:B});k+=B.metrics.advance+e;if(0<c&&k>c&&0<=y){for(var C=y+1,B=h[C].x,u=Math.max(B,u),D=C;D<h.length;D++)h[D].y=a?h[D].y-d:h[D].y+d,h[D].x-=B;f&&this._applyJustification(h,n,y);l=a?l-d:
l+d;k-=B;++t;n=C;y=-1}++w;32===z&&(y=h.length-1)}}w>=n&&(k=h[w],u=Math.max(u,k.x+k.glyphMosaicItem.metrics.advance),f&&this._applyJustification(h,n,w));if(0<h.length)for(b=(f-this._hAnchor)*u,g=(-this._vAnchor*(t+1)+.5)*d,a&&t&&(g+=t*d),b+=this._offset[0],g+=this._offset[1],a=0;a<h.length;a++)d=h[a],d.x+=b,d.y+=g;return h};b.getBox=function(b){if(!b.length)return null;for(var a=Infinity,g=Infinity,e=-Infinity,d=-Infinity,f=0;f<b.length;f++)var c=b[f],h=c.glyphMosaicItem.metrics,k=c.x+h.left,c=c.y-
h.top,l=k+h.width,h=c+h.height,a=Math.min(a,k),e=Math.max(e,l),g=Math.min(g,c),d=Math.max(d,h);return{x:a,y:g,width:e-a,height:d-g}};b.addDecoration=function(b,a){var g=b.length;if(0!==g){for(var e=b[0].x+b[0].glyphMosaicItem.metrics.left,d=b[0].y,f=1;f<g;f++){var c=b[f];if(c.y!==d){var h=b[f-1].x+b[f-1].glyphMosaicItem.metrics.left+b[f-1].glyphMosaicItem.metrics.width;b.push({codePoint:0,x:e,y:d,glyphMosaicItem:{sdf:!0,rect:new l.default(4,0,4,8),metrics:{width:h-e,height:2,left:0,top:a,advance:0},
page:0}});d=c.y;e=c.x+c.glyphMosaicItem.metrics.left}}g=b[g-1].x+b[g-1].glyphMosaicItem.metrics.left+b[g-1].glyphMosaicItem.metrics.width;b.push({codePoint:0,x:e,y:d,glyphMosaicItem:{sdf:!0,rect:new l.default(4,0,4,8),metrics:{width:g-e,height:2,left:0,top:a,advance:0},page:0}})}};b.prototype._applyJustification=function(b,a,g){for(var e=b[g],e=(e.x+e.glyphMosaicItem.metrics.advance)*this._justify;a<=g;a++)b[a].x-=e};return b}();b.TextShaping=n})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define(["require",
"exports","./MeshData","./Utils"],function(n,b,l,k){return function(){function b(a,b,e,d,f){void 0===d&&(d=0);void 0===f&&(f=0);this.id=a;this.geometryType=b;this.materialKey=e;this.minZoom=d;this.maxZoom=f;this.meshData=null;this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0}Object.defineProperty(b.prototype,"sortKey",{get:function(){void 0===this._sortKey&&this._computeSortKey();return this._sortKey},enumerable:!0,configurable:!0});b.prototype.clone=function(){return this.copy()};
b.prototype.copy=function(){var a=new b(this.id,this.geometryType,this.materialKey);a.vertexFrom=this.vertexFrom;a.vertexCount=this.vertexCount;a.indexFrom=this.indexFrom;a.indexCount=this.indexCount;a.zOrder=this.zOrder;a.symbolLevel=this.symbolLevel;a.meshData=this.meshData;a.minZoom=this.minZoom;a.maxZoom=this.maxZoom;return a};b.prototype.setMeshDataFromBuffers=function(a,b,e){var d=new l,f;for(f in b){for(var c=b[f].stride,g=b[f].data,h=[],r=k.strideToPackingFactor(c),n=0;n<c*a.vertexCount/r;++n)h[n]=
g[n+c*a.vertexFrom/r];d.vertexData.set(f,h)}for(n=d.indexData.length=0;n<a.indexCount;++n)d.indexData[n]=e[n+a.indexFrom]-a.vertexFrom;d.vertexCount=a.vertexCount;this.meshData=d};b.prototype.readMeshDataFromBuffers=function(a,b){this.meshData?this.meshData.clear():this.meshData=new l;for(var e in a){for(var d=a[e].stride,f=a[e].data,c=[],g=k.strideToPackingFactor(d),h=0;h<d*this.vertexCount/g;++h)c[h]=f[h+d*this.vertexFrom/g];this.meshData.vertexData.set(e,c)}for(h=this.meshData.indexData.length=
0;h<this.indexCount;++h)this.meshData.indexData[h]=b[h+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount};b.prototype.writeMeshDataToBuffers=function(a,b,e,d){for(var f in b)for(var c=b[f].stride,g=this.meshData.vertexData.get(f),h=b[f].data,l=k.strideToPackingFactor(c),n=0;n<c*this.meshData.vertexCount/l;++n)h[n+c*a/l]=g[n];for(n=0;n<this.meshData.indexData.length;++n)d[n+e]=this.meshData.indexData[n]+a;this.vertexFrom=a;this.vertexCount=this.meshData.vertexCount;this.indexFrom=
e;this.indexCount=this.meshData.indexData.length};b.writeAllMeshDataToBuffers=function(a,b,e){for(var d=0,f=0,c=0;c<a.length;c++){var g=a[c];g.writeMeshDataToBuffers(d,b,f,e);d+=g.vertexCount;f+=g.indexCount}};b.prototype._computeSortKey=function(){this._sortKey=(this.symbolLevel&31)<<12|(this.zOrder&127)<<4|this.geometryType&7};b.prototype.serialize=function(a){a.push(this.geometryType);a.push(this.materialKey);a.push(this.symbolLevel);a.push(this.zOrder);a.push(this.vertexFrom);a.push(this.vertexCount);
a.push(this.indexFrom);a.push(this.indexCount);a.push(this.minZoom);a.push(this.maxZoom);return a};b.deserialize=function(a,g){var e=a.readInt32(),d=a.readInt32();g=new b(g.id,e,d);g.symbolLevel=a.readInt32();g.zOrder=a.readInt32();g.vertexFrom=a.readInt32();g.vertexCount=a.readInt32();g.indexFrom=a.readInt32();g.indexCount=a.readInt32();g.minZoom=a.readInt32();g.maxZoom=a.readInt32();return g};return b}()})},"esri/views/2d/engine/webgl/MeshData":function(){define(["require","exports"],function(n,
b){return function(){function b(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}b.prototype.clear=function(){this.vertexData.clear();this.vertexCount=0;this.indexData=[]};b.prototype.update=function(b,h,a){for(var g in b)this.vertexData.set(g,b[g]);for(g in this.vertexData)null===b[g]&&this.vertexData.delete(g);this.vertexCount=h;this.indexData=a};return b}()})},"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":function(){define(["require","exports","../../../../../../core/tsSupport/extendsHelper"],
function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){}b.prototype.writeMesh=function(b,a,g,e,d){};b.prototype.bindFeature=function(b,a,g){};return b}();b.default=n})},"esri/views/2d/engine/webgl/util/BidiText":function(){define(["require","exports","dojox/string/BidiEngine"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});var k=new l;b.bidiText=function(b){if(!k.hasBidiChar(b))return[b,!1];var a;a="rtl"===k.checkContextual(b)?"IDNNN":"ICNNN";
return[k.bidiTransform(b,a,"VLYSN"),!0]}})},"dojox/string/BidiEngine":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/Stateful"],function(n,b,l){function k(b,c,d,f,g){var m=b;void 0===c&&(c=g.defInFormat);void 0===d&&(d=g.defOutFormat);void 0===f&&(f=g.defSwap);if(c!==d){var l,p=c.substring(0,1);l=c.substring(1,4);var q=d.substring(0,1),r=d.substring(1,4);"C"===l.charAt(0)&&(l=h(m),l="ltr"===l||"rtl"===l?l.toUpperCase():"L"===c.charAt(2)?"LTR":"RTL",c=p+l);"C"===r.charAt(0)&&(l=h(m),
"rtl"===l?r="RTL":"ltr"===l?(m=m.split(""),m.reverse(),l=h(m.join("")),r=l.toUpperCase()):r="L"===d.charAt(2)?"LTR":"RTL",d=q+r)}if(c===d)return b;q=c.substring(0,1);m=c.substring(1,4);p=d.substring(0,1);r=d.substring(1,4);g.inFormat=c;g.outFormat=d;g.swap=f;if("L"===q&&"VLTR"===d){if("LTR"===m)return g.dir=C,a(b,g);if("RTL"===m)return g.dir=D,a(b,g)}if("V"===q&&"V"===p)return g.dir="RTL"===m?D:C,e(b,g);if("L"===q&&"VRTL"===d)return g.dir="LTR"===m?C:D,b=a(b,g),e(b);if("VLTR"===c&&"LLTR"===d)return g.dir=
C,a(b,g);if("V"===q&&"L"===p&&m!==r)return b=e(b),"RTL"===m?k(b,"LLTR","VLTR",f,g):k(b,"LRTL","VRTL",f,g);if("VRTL"===c&&"LRTL"===d)return k(b,"LRTL","VRTL",f,g);if("L"===q&&"L"===p)return c=g.swap,g.swap=c.substr(0,1)+"N","RTL"===m?(g.dir=D,b=a(b,g),g.swap="N"+c.substr(1,2),g.dir=C,b=a(b,g)):(g.dir=C,b=a(b,g),g.swap="N"+c.substr(1,2),b=k(b,"VLTR","LRTL",g.swap,g)),b}function h(a){return(a=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(a))?"z">=a[0]?"ltr":"rtl":""}
function a(a,b){a=a.split("");var d=[];g(a,d,b);if(0!==b.hiLevel&&b.swap.substr(0,1)!==b.swap.substr(1,2))for(var e=0;e<a.length;e++)if(1===d[e]){var f=e,h;b:{h=a[e];for(var k=void 0,l=0,p=Q.length-1;l<=p;)if(k=Math.floor((l+p)/2),h<Q[k][0])p=k-1;else if(h>Q[k][0])l=k+1;else{h=Q[k][1];break b}}a[f]=h}c(2,a,d,b);c(1,a,d,b);m=d;return a.join("")}function g(a,b,c){var d=a.length,e=c.dir?ca:Z,f=null,g=null,h=null,f=0,g=g=null,k=-1,m=g=null,l=[],p=[];c.hiLevel=c.dir;c.lastArabic=!1;c.hasUbatAl=!1;c.hasUbatB=
!1;c.hasUbatS=!1;for(g=0;g<d;g++){var m=g,h=a[g].charCodeAt(0),r=ga[h>>8];l[m]=r<Ca?r:Pa[r-Ca][h&255]}for(m=0;m<d;m++){p[m]=g=q(a,l,p,m,c);f=e[f][g];g=f&240;f&=15;b[m]=h=e[f][z];if(0<g){if(16===g)for(g=k;g<m;g++)b[g]=1;k=-1}if(g=e[f][B])-1===k&&(k=m);else if(-1<k){for(g=k;g<m;g++)b[g]=h;k=-1}l[m]===oa&&(b[m]=0);c.hiLevel|=h}if(c.hasUbatS)for(a=0;a<d;a++)if(l[a]===va)for(b[a]=c.dir,e=a-1;0<=e;e--)if(l[e]===xa)b[e]=c.dir;else break}function e(a,b){a=a.split("");if(b){var c=[];g(a,c,b);m=c}a.reverse();
u.reverse();return a.join("")}function d(a){for(var b=0;b<P.length;b++)if(a>=P[b]&&a<=V[b])return!0;return!1}function f(a,b,c,e){for(;b*c<e&&r(a[b]);)b+=c;return b*c<e&&d(a[b])?!0:!1}function c(a,b,c,d){if(!(d.hiLevel<a))if(1!==a||d.dir!==D||d.hasUbatB){d=b.length;for(var e=0,f,g,h;e<d;){if(c[e]>=a){for(f=e+1;f<d&&c[f]>=a;)f++;for(g=f-1;e<g;e++,g--)h=b[e],b[e]=b[g],b[g]=h,h=u[e],u[e]=u[g],u[g]=h;e=f}e++}}else b.reverse(),u.reverse()}function q(a,b,c,d,e){return{UBAT_L:function(){e.lastArabic=!1;return da},
UBAT_R:function(){e.lastArabic=!1;return F},UBAT_ON:function(){return ka},UBAT_AN:function(){return la},UBAT_EN:function(){return e.lastArabic?la:ea},UBAT_AL:function(){e.lastArabic=!0;e.hasUbatAl=!0;return F},UBAT_WS:function(){return ka},UBAT_CS:function(){var a,f;if(1>d||d+1>=b.length||(a=c[d-1])!==ea&&a!==la||(f=b[d+1])!==ea&&f!==la)return ka;e.lastArabic&&(f=la);return f===a?f:ka},UBAT_ES:function(){return(0<d?c[d-1]:oa)===ea&&d+1<b.length&&b[d+1]===ea?ea:ka},UBAT_ET:function(){if(0<d&&c[d-1]===
ea)return ea;if(e.lastArabic)return ka;for(var a=d+1,f=b.length;a<f&&b[a]===ia;)a++;return a<f&&b[a]===ea?ea:ka},UBAT_NSM:function(){if("VLTR"===e.inFormat){for(var f=b.length,g=d+1;g<f&&b[g]===na;)g++;if(g<f&&(f=a[d],g=b[g],(1425<=f&&2303>=f||64286===f)&&(g===F||g===fa)))return F}return 1>d||b[d-1]===oa?ka:c[d-1]},UBAT_B:function(){e.lastArabic=!0;e.hasUbatB=!0;return e.dir},UBAT_S:function(){e.hasUbatS=!0;return ka},UBAT_LRE:function(){e.lastArabic=!1;return ka},UBAT_RLE:function(){e.lastArabic=
!1;return ka},UBAT_LRO:function(){e.lastArabic=!1;return ka},UBAT_RLO:function(){e.lastArabic=!1;return ka},UBAT_PDF:function(){e.lastArabic=!1;return ka},UBAT_BN:function(){return ka}}[wa[b[d]]]()}function p(a,b){for(var c=0;c<M.length;c++)if(a===M[c])return b[c];return a}function r(a){return"\u064b"<=a&&"\u0655">=a?!0:!1}function t(a){if("L"===a)return"LTR";if("R"===a)return"RTL";if("C"===a)return"CLR";if("D"===a)return"CRL"}function x(a,b){for(var c=0;c<J.length;c++)if(a===J[c])return b[c];return a}
function w(a,b,c,d){for(var e=0;e<a.length;e++)if(a[e]>b||!c&&a[e]===b)a[e]+=d}n.getObject("string",!0,dojox);n=b("dojox.string.BidiEngine",l,{inputFormat:"ILYNN",outputFormat:"VLNNN",sourceToTarget:[],targetToSource:[],levels:[],bidiTransform:function(a,b,c){this.sourceToTarget=[];this.targetToSource=[];if(!a)return"";var e=this.sourceToTarget,g=this.targetToSource,h=a.length;u=[];m=[];for(var l=0;l<h;l++)e[l]=l,g[l]=l,u[l]=l;if(!this.checkParameters(b,c))return a;b=this.inputFormat;c=this.outputFormat;
var e=a,e=v,l=t(b.charAt(1)),g=t(c.charAt(1)),q="I"===b.charAt(0)?"L":b.charAt(0),h="I"===c.charAt(0)?"L":c.charAt(0),l=q+l,g=h+g,h=b.charAt(2)+c.charAt(2);e.defInFormat=l;e.defOutFormat=g;e.defSwap=h;a=k(a,l,g,h,e);e=!1;if("R"===c.charAt(1))e=!0;else if("C"===c.charAt(1)||"D"===c.charAt(1))e=this.checkContextual(a);g=this.sourceToTarget=u;h=Array(g.length);for(l=0;l<g.length;l++)h[g[l]]=l;y=this.targetToSource=h;if(b.charAt(3)===c.charAt(3))e=a;else if("S"===c.charAt(3))if(b=e,c=!0,0===a.length)e=
void 0;else{void 0===b&&(b=!0);void 0===c&&(c=!0);a=String(a);a=a.split("");var n=0,g=1,e=a.length;b||(n=a.length-1,g=-1,e=1);for(var h=e,l=c,z=0,e=[],q=0;n*g<h;n+=g)if(d(a[n])||r(a[n])){var B;if(B="\u0644"===a[n])b:{for(var C=a,D=n+g,K=g,I=h;D*K<I&&r(C[D]);)D+=K;B=" ";if(D*K<I)for(B=C[D],C=0;C<J.length;C++)if(J[C]===B){B=!0;break b}B=!1}if(B){a[n]=0===z?x(a[n+g],N):x(a[n+g],L);n+=g;z=a;B=n;C=g;for(D=h;B*C<D&&r(z[B]);)B+=C;B*C<D&&(z[B]=" ");l&&(e[q]=n,q++);z=0}else{B=a[n];if(1===z){C=n;if(f(a,n+g,
g,h))b:for(D=a[n],K=0;K<M.length;K++){if(D===M[K]){D=T[K];break b}}else D=p(a[n],S);a[C]=D}else!0===f(a,n+g,g,h)?a[n]=p(a[n],U):a[n]=p(a[n],R);r(B)||(z=1);b:{for(C=0;C<Y.length;C++)if(Y[C]===B){B=!0;break b}B=!1}!0===B&&(z=0)}}else z=0;g="";for(h=0;h<a.length;h++){if(l=c){b:{for(l=0;l<e.length;l++)if(e[l]===h)break b;l=-1}l=-1<l}l?(w(y,h,!b,-1),u.splice(h,1)):g+=a[h]}e=g}else if(b=a,c=e,a=!0,0===b.length)e=void 0;else for(void 0===a&&(a=!0),void 0===c&&(c=!0),b=String(b),e="",g=[],g=b.split(""),h=
0;h<b.length;h++)l=!1,"\ufe70"<=g[h]&&"\ufeff">g[h]?(q=b.charCodeAt(h),"\ufef5"<=g[h]&&"\ufefc">=g[h]?(c?(0<h&&a&&" "===g[h-1]?e=e.substring(0,e.length-1)+"\u0644":(e+="\u0644",l=!0),e+=J[(q-65269)/2]):(e+=J[(q-65269)/2],e+="\u0644",h+1<b.length&&a&&" "===g[h+1]?h++:l=!0),l&&(w(y,h,!0,1),u.splice(h,0,u[h]))):e+=X[q-65136]):e+=g[h];this.sourceToTarget=u;this.targetToSource=y;this.levels=m;return e},_inputFormatSetter:function(a){if(!K.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");
this.inputFormat=a},_outputFormatSetter:function(a){if(!K.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=a},checkParameters:function(a,b){a?this.set("inputFormat",a):a=this.inputFormat;b?this.set("outputFormat",b):b=this.outputFormat;return a===b?!1:!0},checkContextual:function(a){a=h(a);if("ltr"!==a&&"rtl"!==a){try{a=document.dir.toLowerCase()}catch(Ta){}"ltr"!==a&&"rtl"!==a&&(a="ltr")}return a},hasBidiChar:function(a){return I.test(a)}});var u=
[],y=[],m=[],v={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1},z=5,B=6,C=0,D=1,K=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,I=/[\u0591-\u06ff\ufb1d-\ufefc]/,Q=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],
["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]],J=["\u0622","\u0623","\u0625","\u0627"],N=["\ufef5","\ufef7","\ufef9","\ufefb"],L=["\ufef6","\ufef8","\ufefa","\ufefc"],M="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split(""),
R="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split(""),S="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split(""),
T="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split(""),U="\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split(""),
Y="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split(""),X="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split(""),
P=["\u0621","\u0641"],V=["\u063a","\u064a"],Z=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],ca=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],da=0,F=1,ea=2,la=3,ka=4,oa=5,va=6,fa=7,xa=8,ia=11,na=12,wa="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" "),Ca=100;b=da;l=F;var ua=ea,ya=la,G=ka,Ea=oa,za=va,H=fa,qa=xa,
sa=ia,W=na,ga=[Ca+0,b,b,b,b,Ca+1,Ca+2,Ca+3,l,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,Ca+4,G,G,G,b,G,b,G,b,G,G,G,b,b,G,G,b,b,b,b,b,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,b,b,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,b,b,b,b,b,b,b,b,b,b,b,b,b,b,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,b,b,G,G,b,b,G,G,b,b,G,G,G,G,G,G,G,G,G,G,G,
G,G,G,G,G,G,G,G,G,G,G,G,b,b,b,Ca+5,H,H,Ca+6,Ca+7],Pa=[[18,18,18,18,18,18,18,18,18,za,Ea,za,qa,Ea,18,18,18,18,18,18,18,18,18,18,18,18,18,18,Ea,Ea,Ea,za,qa,G,G,sa,sa,sa,G,G,G,G,G,10,9,10,9,9,ua,ua,ua,ua,ua,ua,ua,ua,ua,ua,9,G,G,G,G,G,G,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,G,G,G,G,G,G,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,G,G,G,G,18,18,18,18,18,18,Ea,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,G,sa,sa,sa,sa,G,G,G,G,b,G,G,18,G,G,sa,sa,ua,
ua,G,b,G,G,G,ua,b,G,G,G,G,G,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,G,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,G,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,G,G,G,G,G,G,G,G,G,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,G,G,b,b,b,b,b,b,b,G,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,G,b,G,G,G,G,G,G,G,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,
W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,l,W,l,W,W,l,W,W,l,W,G,G,G,G,G,G,G,G,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,G,G,G,G,G,l,l,l,l,l,G,G,G,G,G,G,G,G,G,G,G],[ya,ya,ya,ya,G,G,G,G,H,sa,sa,H,9,H,G,G,W,W,W,W,W,W,W,W,W,W,W,H,G,G,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,ya,ya,ya,ya,ya,ya,ya,ya,ya,ya,sa,ya,ya,H,H,H,W,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,
H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,W,W,W,W,W,W,W,ya,G,W,W,W,W,W,W,H,H,W,W,G,W,W,W,W,H,H,ua,ua,ua,ua,ua,ua,ua,ua,ua,ua,H,H,H,H,H,H],[H,H,H,H,H,H,H,H,H,H,H,H,H,H,G,H,H,W,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,G,G,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,
H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,W,W,W,W,W,W,W,W,W,W,W,H,G,G,G,G,G,G,G,G,G,G,G,G,G,G,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,W,W,W,W,W,W,W,W,W,l,l,G,G,G,G,l,G,G,G,G,G],[qa,qa,qa,qa,qa,qa,qa,qa,qa,qa,qa,18,18,18,b,l,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,qa,Ea,13,14,15,16,17,9,sa,sa,sa,sa,sa,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,9,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,qa,18,18,18,18,18,G,G,G,G,G,18,18,18,18,18,18,ua,b,G,G,ua,ua,
ua,ua,ua,ua,10,10,G,G,G,b,ua,ua,ua,ua,ua,ua,ua,ua,ua,ua,10,10,G,G,G,G,b,b,b,b,b,b,b,b,b,b,b,b,b,G,G,G,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,sa,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G],[b,b,b,b,b,b,b,G,G,G,G,G,G,G,G,G,G,G,G,b,b,b,b,b,G,G,G,G,G,l,W,l,l,l,l,l,l,l,l,l,l,10,l,l,l,l,l,l,l,l,l,l,l,l,l,G,l,l,l,l,l,G,l,G,l,l,G,l,l,G,l,l,l,l,l,l,l,l,l,l,H,H,H,H,H,H,H,H,H,
H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H],[W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,W,W,W,W,W,W,W,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,9,G,9,
G,G,9,G,G,G,G,G,G,G,G,G,sa,G,G,10,10,G,G,G,G,G,sa,sa,G,G,G,G,G,H,H,H,H,H,G,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,G,G,18],[G,G,G,sa,sa,sa,G,G,G,G,G,10,9,10,9,9,ua,ua,ua,ua,ua,ua,ua,ua,ua,ua,9,G,G,G,G,G,G,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,G,G,G,G,G,G,b,
b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,G,G,G,G,G,G,G,G,G,G,G,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,G,G,G,b,b,b,b,b,b,G,G,b,b,b,b,b,b,G,G,b,b,b,b,b,b,G,G,b,b,b,G,G,G,sa,sa,G,G,G,sa,sa,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G,G]];return n})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(n,
b,l,k){return n("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(b){var a=this._attrPairNames;return a[b]?a[b]:a[b]={s:"_"+b+"Setter",g:"_"+b+"Getter"}},postscript:function(b){b&&this.set(b)},_get:function(b,a){return"function"===typeof this[a.g]?this[a.g]():this[b]},get:function(b){return this._get(b,this._getAttrNames(b))},set:function(b,a){if("object"===typeof b){for(var g in b)b.hasOwnProperty(g)&&"_watchCallbacks"!=g&&this.set(g,b[g]);return this}g=this._getAttrNames(b);var e=this._get(b,
g);g=this[g.s];var d;"function"===typeof g?d=g.apply(this,Array.prototype.slice.call(arguments,1)):this[b]=a;if(this._watchCallbacks){var f=this;k(d,function(){f._watchCallbacks(b,e,a)})}return this},_changeAttrValue:function(b,a){var g=this.get(b);this[b]=a;this._watchCallbacks&&this._watchCallbacks(b,g,a);return this},watch:function(b,a){var g=this._watchCallbacks;if(!g)var e=this,g=this._watchCallbacks=function(a,b,d,h){var c=function(c){if(c){c=c.slice();for(var f=0,g=c.length;f<g;f++)c[f].call(e,
a,b,d)}};c(g["_"+a]);h||c(g["*"])};a||"function"!==typeof b?b="_"+b:(a=b,b="*");var d=g[b];"object"!==typeof d&&(d=g[b]=[]);d.push(a);b={};b.unwatch=b.remove=function(){var b=l.indexOf(d,a);-1<b&&d.splice(b,1)};return b}})})},"esri/views/2d/engine/webgl/util/vvFlagUtils":function(){define(["require","exports","../enums","../visualVariablesUtils"],function(n,b,l,k){function h(a,b){void 0===b&&(b=!1);var d=l.WGLVVFlag.SIZE_FIELD_STOPS|l.WGLVVFlag.SIZE_MINMAX_VALUE|l.WGLVVFlag.SIZE_SCALE_STOPS|l.WGLVVFlag.SIZE_UNIT_VALUE;
a=(a&(l.WGLVVTarget.FIELD_TARGETS_OUTLINE|l.WGLVVTarget.MINMAX_TARGETS_OUTLINE|l.WGLVVTarget.SCALE_TARGETS_OUTLINE|l.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return b?d&a:d&~a}function a(a){var b=h(a,!1);return a&(l.WGLVVFlag.COLOR|l.WGLVVFlag.OPACITY|l.WGLVVFlag.ROTATION|b)}Object.defineProperty(b,"__esModule",{value:!0});b.getVVFlags=function(a){if(!a)return l.WGLVVFlag.NONE;for(var b=0,d=0;d<a.length;d++){var f=a[d];if("size"===f.type){var c=k.getTypeOfSizeVisualVariable(f),b=b|c;"outline"===f.target&&
(b|=c<<4)}else"color"===f.type?b|=l.WGLVVFlag.COLOR:"opacity"===f.type?b|=l.WGLVVFlag.OPACITY:"rotation"===f.type&&(b|=l.WGLVVFlag.ROTATION)}return b};b.getSizeFlagsMask=h;b.getMarkerVVFlags=a;b.getFillVVFlags=function(a){return a&(l.WGLVVFlag.COLOR|l.WGLVVFlag.OPACITY)};b.getLineVVFlags=function(a,b){if(b)return b=h(a,!0),a&b;b=h(a,!1);return a&(l.WGLVVFlag.COLOR|l.WGLVVFlag.OPACITY|b)};b.getTextVVFlags=function(b){return a(b)};b.getLabelVVFlags=function(a){var b=h(a,!1);return a&b}})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define("require exports ../../../../core/Error ../../../../core/Logger ./enums ./Utils".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});var g=k.getLogger("esri.views.2d.engine.webgl");b.getTypeOfSizeVisualVariable=function(b){if(a.isNumber(b.minDataValue)&&a.isNumber(b.maxDataValue)&&null!=b.minSize&&null!=b.maxSize)return h.WGLVVFlag.SIZE_MINMAX_VALUE;if((b.expression&&"view.scale"===b.expression||b.valueExpression&&"$view.scale"===b.valueExpression)&&Array.isArray(b.stops))return h.WGLVVFlag.SIZE_SCALE_STOPS;if((null!=b.field||b.expression&&"view.scale"!==b.expression||
b.valueExpression&&"$view.scale"!==b.valueExpression)&&Array.isArray(b.stops))return h.WGLVVFlag.SIZE_FIELD_STOPS;if((null!=b.field||b.expression&&"view.scale"!==b.expression||b.valueExpression&&"$view.scale"!==b.valueExpression)&&null!=b.valueUnit)return h.WGLVVFlag.SIZE_UNIT_VALUE;g.error(new l("mapview-bad-type","Found invalid size VisualVariable",b));return h.WGLVVFlag.NONE}})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return h.WGLGeometryType.LABEL};d.prototype.drawGeometry=function(b,d,f,g,h){var c=b.context,k=b.painter,l=b.state,p=b.rendererInfo,m=f.indexCount,q=f.indexFrom;f=e.LabelMaterialKey.load(f.materialKey);var r=f.mapAligned?1:0;if(r||!(1<=Math.abs(d.key.level-Math.round(100*b.displayLevel)/
100))){var n=a.createProgramDescriptor(f.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_vertexOffset",count:2,type:5122},{location:4,name:"a_texAndSize",count:4,type:5121},{location:5,name:"a_refSymbolAndPlacementOffset",count:4,type:5121},{location:6,name:"a_zoomRangeAndEmpty",count:4,type:5121}]}),t=n.bufferLayouts,n=n.attributes;h=k.materialManager.getMaterialProgram(b,
f,"materials/label",n,h);g=this._getVAO(c,t,n,g);b.context.setStencilFunction(514,0,255);c.bindProgram(h);c.bindVAO(g);this._setSharedUniforms(h,b,d);k.textureManager.bindTextures(c,h,f,4);d=1===r?l.displayViewMat3:l.displayMat3;f.vvSizeMinMaxValue&&h.setUniform4fv("u_vvSizeMinMaxValue",p.vvSizeMinMaxValue);f.vvSizeScaleStops&&h.setUniform1f("u_vvSizeScaleStopsValue",p.vvSizeScaleStopsValue);f.vvSizeFieldStops&&(h.setUniform1fv("u_vvSizeFieldStopsValues",p.vvSizeFieldStopsValues),h.setUniform1fv("u_vvSizeFieldStopsSizes",
p.vvSizeFieldStopsSizes));f.vvSizeUnitValue&&h.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",p.vvSizeUnitValueToPixelsRatio);h.setUniform1f("u_mapRotation",Math.floor(l.rotation/360*254));h.setUniform1f("u_mapAligned",r);h.setUniformMatrix3fv("u_displayMat3",d);h.setUniform1f("u_opacity",1);h.setUniform1f("u_zoomLevel",Math.round(10*b.displayLevel));h.setUniform2fv("u_screenSize",b.state.size);c.drawElements(4,m,5125,4*q);c.bindVAO(null);c.setStencilTestEnabled(!0);c.setBlendingEnabled(!0)}};
return d}(g.default);b.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLine":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return h.WGLGeometryType.LINE};
d.prototype.drawGeometry=function(b,d,f,g,h){var c=b.context,k=b.painter,l=b.rendererInfo,p=b.requiredLevel,m=f.indexFrom,q=f.indexCount;f=e.LineMaterialKey.load(f.materialKey);var r=a.createProgramDescriptor(f.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_offsetAndNormal",count:4,type:5120},{location:4,name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123},
{location:5,name:"a_tlbr",count:4,type:5123},{location:6,name:"a_segmentDirection",count:4,type:5120},{location:7,name:"a_aux",count:2,type:5123}]}),n=r.bufferLayouts,r=r.attributes;h=k.materialManager.getMaterialProgram(b,f,"materials/line",r,h);g=this._getVAO(c,n,r,g);n=1/b.pixelRatio;c.bindProgram(h);c.bindVAO(g);this._setSharedUniforms(h,b,d);f.textureBinding&&k.textureManager.bindTextures(c,h,f);h.setUniform1f("u_zoomFactor",Math.pow(2,p-d.key.level)/b.pixelRatio);h.setUniform1f("u_blur",0+n);
h.setUniform1f("u_antialiasing",n);f.vvSizeMinMaxValue&&h.setUniform4fv("u_vvSizeMinMaxValue",l.vvSizeMinMaxValue);f.vvSizeScaleStops&&h.setUniform1f("u_vvSizeScaleStopsValue",l.vvSizeScaleStopsValue);f.vvSizeFieldStops&&(h.setUniform1fv("u_vvSizeFieldStopsValues",l.vvSizeFieldStopsValues),h.setUniform1fv("u_vvSizeFieldStopsSizes",l.vvSizeFieldStopsSizes));f.vvSizeUnitValue&&h.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",l.vvSizeUnitValueToPixelsRatio);f.vvColor&&(h.setUniform1fv("u_vvColorValues",
l.vvColorValues),h.setUniform4fv("u_vvColors",l.vvColors));f.vvOpacity&&(h.setUniform1fv("u_vvOpacityValues",l.vvOpacityValues),h.setUniform1fv("u_vvOpacities",l.vvOpacities));c.setFaceCullingEnabled(!0);c.setFrontFace(2305);c.setCullFace(1029);c.drawElements(4,q,5125,4*m);c.setFaceCullingEnabled(!1);c.bindVAO(null)};return d}(g.default);b.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return a.WGLGeometryType.MARKER};c.prototype.drawGeometry=function(a,b,c,e,f){var h=a.context,k=a.painter,l=a.rendererInfo,m=a.state,p=c.indexCount,q=c.indexFrom;c=d.MarkerMaterialKey.load(c.materialKey);var r=g.createProgramDescriptor(c.data,{geometry:[{location:0,name:"a_pos",
count:2,type:5122},{location:1,name:"a_vertexOffset",count:2,type:5122},{location:2,name:"a_texCoords",count:2,type:5123},{location:3,name:"a_bitSetAndDistRatio",count:4,type:5121},{location:4,name:"a_id",count:4,type:5121},{location:5,name:"a_color",count:4,type:5121,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:5121,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:5121}]}),n=r.bufferLayouts,r=r.attributes;f=k.materialManager.getMaterialProgram(a,c,"materials/icon",
r,f);e=this._getVAO(h,n,r,e);h.bindProgram(f);h.bindVAO(e);c.textureBinding&&k.textureManager.bindTextures(h,f,c,1);this._setSharedUniforms(f,a,b);f.setUniformMatrix3fv("u_displayMat3",c.vvRotation?m.displayViewMat3:m.displayMat3);c.vvSizeMinMaxValue&&f.setUniform4fv("u_vvSizeMinMaxValue",l.vvSizeMinMaxValue);c.vvSizeScaleStops&&f.setUniform1f("u_vvSizeScaleStopsValue",l.vvSizeScaleStopsValue);c.vvSizeFieldStops&&(f.setUniform1fv("u_vvSizeFieldStopsValues",l.vvSizeFieldStopsValues),f.setUniform1fv("u_vvSizeFieldStopsSizes",
l.vvSizeFieldStopsSizes));c.vvSizeUnitValue&&f.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",l.vvSizeUnitValueToPixelsRatio);c.vvColor&&(f.setUniform1fv("u_vvColorValues",l.vvColorValues),f.setUniform4fv("u_vvColors",l.vvColors));c.vvOpacity&&(f.setUniform1fv("u_vvOpacityValues",l.vvOpacityValues),f.setUniform1fv("u_vvOpacities",l.vvOpacities));c.vvRotation&&f.setUniform1f("u_vvRotationType","geographic"===l.vvMaterialParameters.vvRotationType?0:1);h.drawElements(4,p,5125,4*q);h.bindVAO(null)};
return c}(e.default);b.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushText":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return h.WGLGeometryType.TEXT};
d.prototype.drawGeometry=function(b,d,f,g,h){var c=b.context,k=b.painter,l=b.rendererInfo,p=b.state,m=f.indexCount,q=f.indexFrom;f=e.TextMaterialKey.load(f.materialKey);var r=a.createProgramDescriptor(f.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_vertexOffset",count:2,type:5122},{location:4,name:"a_texFontSize",count:4,type:5120},{location:5,name:"a_aux",count:4,
type:5120}]}),n=r.bufferLayouts,r=r.attributes;h=k.materialManager.getMaterialProgram(b,f,"materials/text",r,h);g=this._getVAO(c,n,r,g);c.bindProgram(h);c.bindVAO(g);this._setSharedUniforms(h,b,d);k.textureManager.bindTextures(c,h,f,4);h.setUniformMatrix3fv("u_displayMat3",p.displayMat3);f.vvSizeMinMaxValue&&h.setUniform4fv("u_vvSizeMinMaxValue",l.vvSizeMinMaxValue);f.vvSizeScaleStops&&h.setUniform1f("u_vvSizeScaleStopsValue",l.vvSizeScaleStopsValue);f.vvSizeFieldStops&&(h.setUniform1fv("u_vvSizeFieldStopsValues",
l.vvSizeFieldStopsValues),h.setUniform1fv("u_vvSizeFieldStopsSizes",l.vvSizeFieldStopsSizes));f.vvSizeUnitValue&&h.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",l.vvSizeUnitValueToPixelsRatio);f.vvColor&&(h.setUniform1fv("u_vvColorValues",l.vvColorValues),h.setUniform4fv("u_vvColors",l.vvColors));f.vvOpacity&&(h.setUniform1fv("u_vvOpacityValues",l.vvOpacityValues),h.setUniform1fv("u_vvOpacities",l.vvOpacities));f.vvRotation&&h.setUniform1f("u_vvRotationType","geographic"===l.vvMaterialParameters.vvRotationType?
0:1);c.drawElements(4,m,5125,4*q);c.bindVAO(null)};return d}(g.default);b.default=n})},"esri/views/2d/engine/webgl/TileClipper":function(){define(["require","exports","./definitions","./Geometry","./GeometryUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(){return function(a,b,f){this.ratio=a;this.x=b;this.y=f}}();n=function(){function b(a,b,c,e,g){void 0===e&&(e=8);void 0===g&&(g=8);this.lines=[];this.starts=[];this.pixelRatio=e;this.pixelMargin=g;this.tileSize=
l.TILE_SIZE*e;this.dz=a;this.yPos=b;this.xPos=c}b.prototype.setExtent=function(a){this.finalRatio=this.tileSize/a*(1<<this.dz);var b=this.pixelRatio*this.pixelMargin,b=b/this.finalRatio;a>>=this.dz;b>a&&(b=a);this.margin=b;this.xmin=a*this.xPos-b;this.ymin=a*this.yPos-b;this.xmax=this.xmin+a+2*b;this.ymax=this.ymin+a+2*b};b.prototype.reset=function(a){this.type=a;this.lines=[];this.starts=[];this.line=null;this.start=0};b.prototype.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,
b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new k.Point(a,b);this._firstPt=new k.Point(a,b);this._dist=0};b.prototype.lineTo=function(b,e){var c=this._isIn(b,e),d=new k.Point(b,e),f=k.Point.distance(this._prevPt,d),g,h,l;if(c)this._prevIsIn?this._lineTo(b,e,!0):(g=this._prevPt,h=d,b=this._intersect(h,g),this.start=this._dist+f*(1-this._r),this._lineTo(b.x,b.y,!0),this._lineTo(h.x,h.y,!0));else if(this._prevIsIn)h=this._prevPt,g=d,b=this._intersect(h,g),this._lineTo(b.x,b.y,!0),this._lineTo(g.x,
g.y,!1);else{var n=this._prevPt;if(!(n.x<=this.xmin&&d.x<=this.xmin||n.x>=this.xmax&&d.x>=this.xmax||n.y<=this.ymin&&d.y<=this.ymin||n.y>=this.ymax&&d.y>=this.ymax)){b=[];if(n.x<this.xmin&&d.x>this.xmin||n.x>this.xmin&&d.x<this.xmin)e=(this.xmin-n.x)/(d.x-n.x),l=n.y+e*(d.y-n.y),l<=this.ymin?h=!1:l>=this.ymax?h=!0:b.push(new a(e,this.xmin,l));if(n.x<this.xmax&&d.x>this.xmax||n.x>this.xmax&&d.x<this.xmax)e=(this.xmax-n.x)/(d.x-n.x),l=n.y+e*(d.y-n.y),l<=this.ymin?h=!1:l>=this.ymax?h=!0:b.push(new a(e,
this.xmax,l));if(n.y<this.ymin&&d.y>this.ymin||n.y>this.ymin&&d.y<this.ymin)e=(this.ymin-n.y)/(d.y-n.y),l=n.x+e*(d.x-n.x),l<=this.xmin?g=!1:l>=this.xmax?g=!0:b.push(new a(e,l,this.ymin));if(n.y<this.ymax&&d.y>this.ymax||n.y>this.ymax&&d.y<this.ymax)e=(this.ymax-n.y)/(d.y-n.y),l=n.x+e*(d.x-n.x),l<=this.xmin?g=!1:l>=this.xmax?g=!0:b.push(new a(e,l,this.ymax));if(0===b.length)g?h?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):h?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,
this.ymin,!0);else if(1<b.length&&b[0].ratio>b[1].ratio)this.start=this._dist+f*b[1].ratio,this._lineTo(b[1].x,b[1].y,!0),this._lineTo(b[0].x,b[0].y,!0);else for(this.start=this._dist+f*b[0].ratio,g=0;g<b.length;g++)this._lineTo(b[g].x,b[g].y,!0)}this._lineTo(d.x,d.y,!1)}this._dist+=f;this._prevIsIn=c;this._prevPt=d};b.prototype.close=function(){if(2<this.line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this.line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&
a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;else break}};b.prototype.result=function(a){void 0===a&&(a=!0);this._pushLine();if(0===this.lines.length)return null;3===this.type&&a&&g.simplify(this.tileSize,this.margin*this.finalRatio,this.lines);return this.lines};b.prototype.resultWithStarts=function(){if(2!==this.type)throw Error("Only valid for lines");this._pushLine();var a=this.lines,b=a.length;if(0===b)return null;for(var c=[],e=0;e<b;e++)c.push({line:a[e],
start:this.starts[e]||0});return c};b.prototype._isIn=function(a,b){return a>=this.xmin&&a<=this.xmax&&b>=this.ymin&&b<=this.ymax};b.prototype._intersect=function(a,b){var c,d,e;if(b.x>=this.xmin&&b.x<=this.xmax)d=b.y<=this.ymin?this.ymin:this.ymax,e=(d-a.y)/(b.y-a.y),c=a.x+e*(b.x-a.x);else if(b.y>=this.ymin&&b.y<=this.ymax)c=b.x<=this.xmin?this.xmin:this.xmax,e=(c-a.x)/(b.x-a.x),d=a.y+e*(b.y-a.y);else{d=b.y<=this.ymin?this.ymin:this.ymax;c=b.x<=this.xmin?this.xmin:this.xmax;var f=(c-a.x)/(b.x-a.x),
g=(d-a.y)/(b.y-a.y);f<g?(e=f,d=a.y+f*(b.y-a.y)):(e=g,c=a.x+g*(b.x-a.x))}this._r=e;return new k.Point(c,d)};b.prototype._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?1<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&3<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)));this.line=[];this.start=0};b.prototype._moveTo=function(a,b,c){3!==this.type?
c&&(a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new k.Point(a,b))):(c||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new k.Point(a,b)),this._is_v=this._is_h=!1)};b.prototype._lineTo=function(a,b,c){if(3!==this.type)if(c){a=
Math.round((a-(this.xmin+this.margin))*this.finalRatio);b=Math.round((b-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(c=this.line[this.line.length-1],c.equals(a,b)))return;this.line.push(new k.Point(a,b))}else this.line&&0<this.line.length&&this._pushLine();else if(c||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),
this.line&&0<this.line.length){c=this.line[this.line.length-1];var d=c.x===a,e=c.y===b;d&&e||(this._is_h&&d?(c.x=a,c.y=b,c=this.line[this.line.length-2],c.x===a&&c.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(c=this.line[this.line.length-2],this._is_h=c.x===a,this._is_v=c.y===b)):(this._is_h=c.x===a,this._is_v=c.y===b)):this._is_v&&e?(c.x=a,c.y=b,c=this.line[this.line.length-2],c.x===a&&c.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(c=this.line[this.line.length-
2],this._is_h=c.x===a,this._is_v=c.y===b)):(this._is_h=c.x===a,this._is_v=c.y===b)):(this.line.push(new k.Point(a,b)),this._is_h=d,this._is_v=e))}else this.line.push(new k.Point(a,b))};return b}();b.TileClipper=n;n=function(){function a(){}a.prototype.setExtent=function(a){this._ratio=4096===a?1:4096/a};a.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};a.prototype.moveTo=function(a,b){this.line&&this.lines.push(this.line);this.line=[];var c=this._ratio;this.line.push(new k.Point(Math.round(a*
c),Math.round(b*c)))};a.prototype.lineTo=function(a,b){var c=this._ratio;this.line.push(new k.Point(Math.round(a*c),Math.round(b*c)))};a.prototype.close=function(){var a=this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};a.prototype.result=function(){this.line&&this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&g.simplify(4096,64,this.lines);return this.lines};return a}();b.SimpleBuilder=n;var g=function(){function a(){}a.simplify=function(b,e,c){if(c){var d=
-e,f=b+e,g=-e,h=b+e;b=[];e=[];for(var k=c.length,l=0;l<k;++l){var n=c[l];if(n&&!(2>n.length))for(var y=n[0],m=void 0,v=n.length,z=1;z<v;++z)m=n[z],y.x===m.x&&(y.x<=d&&(y.y>m.y?(b.push(l),b.push(z),b.push(0),b.push(-1)):(e.push(l),e.push(z),e.push(0),e.push(-1))),y.x>=f&&(y.y<m.y?(b.push(l),b.push(z),b.push(1),b.push(-1)):(e.push(l),e.push(z),e.push(1),e.push(-1)))),y.y===m.y&&(y.y<=g&&(y.x<m.x?(b.push(l),b.push(z),b.push(2),b.push(-1)):(e.push(l),e.push(z),e.push(2),e.push(-1))),y.y>=h&&(y.x>m.x?
(b.push(l),b.push(z),b.push(3),b.push(-1)):(e.push(l),e.push(z),e.push(3),e.push(-1)))),y=m}0!==b.length&&0!==e.length&&(a.fillParent(c,e,b),a.fillParent(c,b,e),d=[],a.calcDeltas(d,e,b),a.calcDeltas(d,b,e),a.addDeltas(d,c))}};a.fillParent=function(a,b,c){for(var d=c.length,e=b.length,f=0;f<e;f+=4){for(var g=b[f],k=b[f+1],l=b[f+2],n=a[g][k-1],g=a[g][k],k=8092,y=-1,m=0;m<d;m+=4)if(c[m+2]===l){var v=c[m],z=c[m+1],B=a[v][z-1],v=a[v][z];switch(l){case 0:case 1:h.between(n.y,B.y,v.y)&&h.between(g.y,B.y,
v.y)&&(B=Math.abs(v.y-B.y),B<k&&(k=B,y=m));break;case 2:case 3:h.between(n.x,B.x,v.x)&&h.between(g.x,B.x,v.x)&&(B=Math.abs(v.x-B.x),B<k&&(k=B,y=m))}}b[f+3]=y}};a.calcDeltas=function(b,e,c){for(var d=e.length,f=0;f<d;f+=4){var g=a.calcDelta(f,e,c,[]);b.push(e[f]);b.push(e[f+1]);b.push(e[f+2]);b.push(g)}};a.calcDelta=function(b,e,c,g){b=e[b+3];if(-1===b)return 0;var d=g.length;if(1<d&&g[d-2]===b)return 0;g.push(b);return a.calcDelta(b,c,e,g)+1};a.addDeltas=function(a,b){for(var c=a.length,d=0,e=0;e<
c;e+=4){var f=a[e+3];f>d&&(d=f)}for(e=0;e<c;e+=4){var g=b[a[e]],h=a[e+1],f=d-a[e+3];switch(a[e+2]){case 0:g[h-1].x-=f;g[h].x-=f;1===h&&(g[g.length-1].x-=f);h===g.length-1&&(g[0].x-=f);break;case 1:g[h-1].x+=f;g[h].x+=f;1===h&&(g[g.length-1].x+=f);h===g.length-1&&(g[0].x+=f);break;case 2:g[h-1].y-=f;g[h].y-=f;1===h&&(g[g.length-1].y-=f);h===g.length-1&&(g[0].y-=f);break;case 3:g[h-1].y+=f,g[h].y+=f,1===h&&(g[g.length-1].y+=f),h===g.length-1&&(g[0].y+=f)}}};return a}()})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["require",
"exports","../../../../symbols/cim/enums","./mesh/templates/util"],function(n,b,l,k){function h(){if(m.cosine<q.innerBisectorAutoSplitThreshold){m.splitInner=!0;m.gapInner=!0;var a=Math.max(q.innerBisectorAutoSplitThreshold,m.cosine),a=Math.sqrt(1-a*a)/a;m.leftInner.x=m.nextNormal.x+m.sign*a*m.outbound.x;m.leftInner.y=m.nextNormal.y+m.sign*a*m.outbound.y;m.rightInner.x=m.prevNormal.x-m.sign*a*m.inbound.x;m.rightInner.y=m.prevNormal.y-m.sign*a*m.inbound.y}else q.enableInnerBisectorSplit&&(m.splitInner=
!0,m.gapInner=!1,m.leftInner.x=m.rightInner.x=m.bisector.x/m.cosine,m.leftInner.y=m.rightInner.y=m.bisector.y/m.cosine);m.cosine<q.outerBisectorAutoSplitThreshold?(m.splitOuter=!0,m.gapOuter=!0,a=Math.max(q.outerBisectorAutoSplitThreshold,m.cosine),a=Math.sqrt(1-a*a)/a,m.leftOuter.x=m.prevNormal.x-m.sign*a*m.inbound.x,m.leftOuter.y=m.prevNormal.y-m.sign*a*m.inbound.y,m.rightOuter.x=m.nextNormal.x+m.sign*a*m.outbound.x,m.rightOuter.y=m.nextNormal.y+m.sign*a*m.outbound.y):q.enableOuterBisectorSplit&&
(m.splitOuter=!0,m.gapOuter=!1,m.leftOuter.x=m.rightOuter.x=m.bisector.x/m.cosine,m.leftOuter.y=m.rightOuter.y=m.bisector.y/m.cosine)}function a(){if(w)m.distance=0,w=m.isCap=m.isFirstVertex=m.isLastVertex=!1;else{if(0===t)if(m.isFirstVertex=0===r,y=c[r],0===r){if(t=0,m.closed){m.inbound.x=y.x-c[c.length-2].x;m.inbound.y=y.y-c[c.length-2].y;var a=Math.sqrt(m.inbound.x*m.inbound.x+m.inbound.y*m.inbound.y);m.inbound.x/=a;m.inbound.y/=a}}else m.inbound.x=y.x-u.x,m.inbound.y=y.y-u.y,t=Math.sqrt(m.inbound.x*
m.inbound.x+m.inbound.y*m.inbound.y),m.inbound.x/=t,m.inbound.y/=t;m.distance+t-x<=q.wrapDistance?(r<c.length-1?(m.outbound.x=c[r+1].x-y.x,m.outbound.y=c[r+1].y-y.y,a=Math.sqrt(m.outbound.x*m.outbound.x+m.outbound.y*m.outbound.y),m.outbound.x/=a,m.outbound.y/=a):m.closed?(m.outbound.x=c[1].x-y.x,m.outbound.y=c[1].y-y.y,a=Math.sqrt(m.outbound.x*m.outbound.x+m.outbound.y*m.outbound.y),m.outbound.x/=a,m.outbound.y/=a):(m.outbound.x=m.inbound.x,m.outbound.y=m.inbound.y),0!==r||m.closed||(m.inbound.x=
m.outbound.x,m.inbound.y=m.outbound.y),++r,m.isLastVertex=r===c.length,m.isCap=!m.closed&&(m.isFirstVertex||m.isLastVertex),m.distance+=t-x,x=t=0,w=m.distance+t-x===q.wrapDistance,m.currentVertex.x=y.x,m.currentVertex.y=y.y,u=y,y=null):(m.outbound.x=m.inbound.x,m.outbound.y=m.inbound.y,x+=q.wrapDistance-m.distance,m.distance=q.wrapDistance,w=!0,a=x/t,m.currentVertex.x=(1-a)*u.x+a*y.x,m.currentVertex.y=(1-a)*u.y+a*y.y)}}function g(){m.prevNormal.x=-m.inbound.y;m.prevNormal.y=m.inbound.x;m.nextNormal.x=
-m.outbound.y;m.nextNormal.y=m.outbound.x}function e(){g();m.bisector.x=m.prevNormal.x+m.nextNormal.x;m.bisector.y=m.prevNormal.y+m.nextNormal.y;var a=Math.sqrt(m.bisector.x*m.bisector.x+m.bisector.y*m.bisector.y);.001>a?(m.bisector.x=void 0,m.bisector.y=void 0,m.cosine=0,m.sign=void 0):(m.bisector.x/=a,m.bisector.y/=a,m.cosine=m.bisector.x*m.nextNormal.x+m.bisector.y*m.nextNormal.y,m.sign=0<=m.prevNormal.x*m.nextNormal.y-m.prevNormal.y*m.nextNormal.x?1:-1)}function d(a){p.vertex(m);1===a?(m.leftEntry0=
m.entry0,m.leftEntry1=m.entry1,m.leftEntry2=m.entry2,m.leftExit0=m.exit0,m.leftExit1=m.exit1,m.leftExit2=m.exit2):2===a&&(m.rightEntry0=m.entry0,m.rightEntry1=m.entry1,m.rightEntry2=m.entry2,m.rightExit0=m.exit0,m.rightExit1=m.exit1,m.rightExit2=m.exit2)}function f(a){p.vertex(m);1===a?(m.leftEntry0=m.entry0,m.leftEntry2=m.entry2,m.leftExit0=m.exit0,m.leftExit2=m.exit2):2===a&&(m.rightEntry0=m.entry0,m.rightEntry2=m.entry2,m.rightExit0=m.exit0,m.rightExit2=m.exit2)}Object.defineProperty(b,"__esModule",
{value:!0});n=function(){return function(){this.isCap=this.isLastVertex=this.isFirstVertex=this.closed=void 0;this.currentVertex={x:void 0,y:void 0};this.inbound={x:void 0,y:void 0};this.outbound={x:void 0,y:void 0};this.prevNormal={x:void 0,y:void 0};this.nextNormal={x:void 0,y:void 0};this.bisector={x:void 0,y:void 0};this.leftInner={x:void 0,y:void 0};this.rightInner={x:void 0,y:void 0};this.leftOuter={x:void 0,y:void 0};this.rightOuter={x:void 0,y:void 0}}}();b.TessellationState=n;b.tessellate=
function(b,h,k){q.trackDistance=null!=h.trackDistance?h.trackDistance:!1;q.wrapDistance=null!=h.wrapDistance?h.wrapDistance:65535;q.thin=null!=h.thin?h.thin:!1;q.initialDistance=null!=h.initialDistance?h.initialDistance:0;q.enableOuterBisectorSplit=null!=h.enableOuterBisectorSplit?h.enableOuterBisectorSplit:!1;q.outerBisectorAutoSplitThreshold=null!=h.outerBisectorAutoSplitThreshold?h.outerBisectorAutoSplitThreshold:0;q.enableInnerBisectorSplit=null!=h.enableOuterBisectorSplit?h.enableOuterBisectorSplit:
!1;q.innerBisectorAutoSplitThreshold=null!=h.innerBisectorAutoSplitThreshold?h.innerBisectorAutoSplitThreshold:0;c=b;p=k;x=t=r=0;w=!1;y=u=null;m.currentVertex.x=null;m.currentVertex.y=null;m.distance=q.initialDistance;b=c[0];h=c[c.length-1];m.canSplit=!1;m.closed=b.x===h.x&&b.y===h.y;if(!(2>c.length||2===c.length&&m.closed))if(q.thin)if(q.trackDistance)for(a(),g(),f(1);t-x>q.wrapDistance||r<c.length;)a(),g(),f(2),p.bridge(m),m.leftExit0=m.rightExit0,m.leftExit2=m.rightExit2;else for(;r<c.length;)0<
r&&(m.inbound.x=m.outbound.x,m.inbound.y=m.outbound.y),r<c.length-1?(m.outbound.x=c[r+1].x-c[r].x,m.outbound.y=c[r+1].y-c[r].y,b=Math.sqrt(m.outbound.x*m.outbound.x+m.outbound.y*m.outbound.y),m.distance+=b,m.outbound.x/=b,m.outbound.y/=b):(m.outbound.x=m.inbound.x,m.outbound.y=m.inbound.y),0===r&&(m.inbound.x=m.outbound.x,m.inbound.y=m.outbound.y),m.currentVertex.x=c[r].x,m.currentVertex.y=c[r].y,m.prevNormal.x=-m.inbound.y,m.prevNormal.y=m.inbound.x,m.nextNormal.x=-m.outbound.y,m.nextNormal.y=m.outbound.x,
0===r?(p.vertex(m),m.leftEntry0=m.entry0,m.leftEntry2=m.entry2,m.leftExit0=m.exit0,m.leftExit2=m.exit2):(p.vertex(m),m.rightEntry0=m.entry0,m.rightEntry2=m.entry2,m.rightExit0=m.exit0,m.rightExit2=m.exit2,p.bridge(m),m.leftExit0=m.rightExit0,m.leftExit2=m.rightExit2),++r;else{if(q.enableOuterBisectorSplit||0<q.outerBisectorAutoSplitThreshold||q.enableInnerBisectorSplit||0<q.innerBisectorAutoSplitThreshold)for(m.canSplit=!0,a(),e(),m.splitInner=m.gapInner=m.splitOuter=m.gapOuter=!1,d(1),m.closure0=
m.leftEntry0,m.closure1=m.leftEntry1,m.closure2=m.leftEntry2;t-x>q.wrapDistance||r<c.length-1||r<c.length&&(!m.closed||q.trackDistance);)a(),e(),m.splitInner=m.gapInner=m.splitOuter=m.gapOuter=!1,d(2),p.bridge(m),m.leftExit0=m.rightExit0,m.leftExit1=m.rightExit1,m.leftExit2=m.rightExit2;else for(a(),e(),d(1),m.closure0=m.leftEntry0,m.closure1=m.leftEntry1,m.closure2=m.leftEntry2;t-x>q.wrapDistance||r<c.length-1||r<c.length&&(!m.closed||q.trackDistance);)a(),e(),d(2),p.bridge(m),m.leftExit0=m.rightExit0,
m.leftExit1=m.rightExit1,m.leftExit2=m.rightExit2;m.closed&&!q.trackDistance&&(m.rightEntry0=m.closure0,m.rightEntry1=m.closure1,m.rightEntry2=m.closure2,p.bridge(m),m.leftExit0=m.rightExit0,m.leftExit1=m.rightExit1,m.leftExit2=m.rightExit2)}};b.cleanup=function(){p=c=null};b.splitVertex=h;var c,q={},p,r=void 0,t,x,w,u,y,m=new n;n=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b;this.capType=l.CapType.BUTT;this.joinType=l.JoinType.MITER;this.miterLimitCosine=k.getLimitCosine(2);
this.roundLimitCosine=Math.cos(23*Math.PI/180);this.almostParallelCosine=.97;this.radsPerSlice=.8;this.joinOnUTurn=this.textured=!1}a.prototype.vertex=function(a){var b=this.joinType===l.JoinType.MITER?this.miterLimitCosine:this.roundLimitCosine,c=a.isCap&&this.capType!==l.CapType.BUTT,d=!1;a.cosine>this.almostParallelCosine?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):a.cosine<1-this.almostParallelCosine?(d=!a.isCap&&this.joinOnUTurn,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.canSplit?(h(),0<a.sign?(a.splitInner?(a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.leftInner.x,a.leftInner.y,0,-1,a.distance),a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.rightInner.x,a.rightInner.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/
a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.leftOuter.x,-a.leftOuter.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,
a.outbound.y,-a.rightOuter.x,-a.rightOuter.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.splitInner?(a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,-a.leftInner.x,-a.leftInner.y,0,1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.rightInner.x,-a.rightInner.y,0,1,a.distance)):a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.leftOuter.x,a.leftOuter.y,0,-1,a.distance),a.exit0=
this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.rightOuter.x,a.rightOuter.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance))):0<a.sign?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,
0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance));b=a.canSplit&&(a.splitInner||a.splitOuter)||d||c?a.entry1=a.exit1=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,0,0,0,0,a.distance):a.entry1=a.exit1=null;if(d&&this.joinType!==
l.JoinType.ROUND)this.writeTriangle(b,0<a.sign?a.exit2:a.entry0,0<a.sign?a.entry2:a.exit0);else if(c&&this.capType===l.CapType.ROUND||d&&this.joinType===l.JoinType.ROUND){var e=d=c=void 0,g=void 0,f=void 0,k=void 0;if(a.isCap){var m=Math.PI,f=Math.ceil(m/this.radsPerSlice),k=m/f;a.isFirstVertex?(c=a.prevNormal.x,d=a.prevNormal.y,e=a.entry0,g=a.entry2):a.isLastVertex&&(c=-a.nextNormal.x,d=-a.nextNormal.y,e=a.exit2,g=a.exit0)}else m=2*Math.acos(a.cosine),f=Math.ceil(m/this.radsPerSlice),k=m/f,c=0<a.sign?
-a.prevNormal.x:a.nextNormal.x,d=0<a.sign?-a.prevNormal.y:a.nextNormal.y,e=0<a.sign?a.entry2:a.exit0,g=0<a.sign?a.exit2:a.entry0;for(var m=Math.cos(k),k=Math.sin(k),p=k*c+m*d,c=m*c-k*d,d=p,q,p=void 0,r=0;r<f;++r)q=p,r<f-1&&(p=a.isCap?this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,a.isFirstVertex?-1:1,0,a.distance):this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,0,a.sign,a.distance)),this.writeTriangle(0===r?e:q,b,r===f-1?g:p),q=k*c+m*d,c=m*c-k*d,d=q}else c&&this.capType===
l.CapType.SQUARE&&(c=a.isFirstVertex?1:-1,e=d=void 0,this.textured?(d=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-c*a.inbound.y,-c,-1,a.distance),e=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,-c,1,a.distance)):(d=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-c*a.inbound.y,0,-1,a.distance),e=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,0,1,a.distance)),0<c?(this.writeTriangle(b,a.entry2,e),this.writeTriangle(b,e,d),this.writeTriangle(b,d,a.entry0)):(this.writeTriangle(b,e,a.exit2),this.writeTriangle(b,d,e),this.writeTriangle(b,a.exit0,d)))};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,null!=a.leftExit1?a.leftExit1:a.leftExit2);this.writeTriangle(a.rightEntry0,null!=a.rightEntry1?a.rightEntry1:a.rightEntry2,null!=a.leftExit1?
a.leftExit1:a.leftExit2);null!=a.leftExit1&&null!=a.rightEntry1?(this.writeTriangle(a.leftExit1,a.rightEntry1,a.leftExit2),this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)):null!=a.leftExit1?this.writeTriangle(a.leftExit1,a.rightEntry2,a.leftExit2):null!=a.rightEntry1&&this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)};return a}();b.StandardTessellationCallbacks=n;n=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b}a.prototype.vertex=function(a){a.entry0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance);a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance);a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance);a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,a.leftExit2);this.writeTriangle(a.rightEntry0,
a.rightEntry2,a.leftExit2)};return a}();b.ThinTessellationCallbacks=n})},"esri/views/2d/engine/webgl/mesh/factories/matcherUtils":function(){define("require exports ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/Error ../../../../../../core/Logger ../../util/Matcher".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});var e=a.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");b.createMatcher=
function(a,b,c){return k(this,void 0,void 0,function(){return l(this,function(d){switch(a.type){case "simple":case "dot-density":return[2,g.FeatureMatcher.fromBasicRenderer(a,b,c)];case "unique-value":return[2,g.MapMatcher.fromUVRenderer(a,b,c)];case "class-breaks":return[2,g.IntervalMatcher.fromCBRenderer(a,b,c)];case "dictionary":return[2,g.DictionaryMatcher.fromDictionaryRenderer(a,b,c)];default:return e.error(new h("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),[2,
null]}})})}})},"esri/views/2d/engine/webgl/util/Matcher":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Logger ../../../../../core/promiseUtils ../../../../../support/arcadeOnDemand ../../../../../symbols/support/cimSymbolUtils ../../../arcade/utils".split(" "),function(n,b,l,k,h,a,g,e,d,f){Object.defineProperty(b,"__esModule",{value:!0});var c=a.getLogger("esri/views/2d/engine/webgl/util/Matcher");
n=function(){function a(){this._defaultResult=null}a.fromBasicRenderer=function(b,c,e){return h(this,void 0,void 0,function(){var g,f,h;return k(this,function(k){switch(k.label){case 0:return[4,d.expandSymbols(b.getSymbols())];case 1:return g=k.sent(),f=new a,g.length?[4,c.createTemplateGroup(g[0],null,b,e)]:[3,3];case 2:h=k.sent(),f.setDefault(h),k.label=3;case 3:return[2,f]}})})};a.prototype.size=function(){return 1};a.prototype.getDefault=function(){return this._defaultResult};a.prototype.setDefault=
function(a){this._defaultResult=a};a.prototype.match=function(a,b,c,d,e){return this.getDefault()};a.prototype.analyze=function(a,b,c,d,e){return h(this,void 0,void 0,function(){return k(this,function(a){return[2]})})};return a}();b.FeatureMatcher=n;a=function(a){function b(b,c,d,e){var g=a.call(this)||this;g._intervals=[];g._isMaxInclusive=c;e?g._getValue=f.callWithFeature.bind(null,e):b&&b.length?"function"===typeof b?(g._field=null,g._getValue=b):(g._field=b,g._normalizationInfo=d,g._getValue=
g._getValueFromField.bind(g)):g._field=null;return g}l(b,a);b.fromCBRenderer=function(a,c,g){return h(this,void 0,void 0,function(){var f,h,l,m,p,q,r,n,t,x,I,Q,J,N,L,M,R,S,T;return k(this,function(k){switch(k.label){case 0:return f=a.isMaxInclusive,h=a.normalizationField,l=a.normalizationTotal,m=a.normalizationType,p=a.field,q={normalizationField:h,normalizationTotal:l,normalizationType:m},(t=r=a.valueExpression)?[4,e.createRendererExpression(r,g.spatialReference,g.fields)]:[3,2];case 1:t=k.sent(),
k.label=2;case 2:return n=t,x=new b(p,f,q,n),[4,d.expandSymbol(a.backgroundFillSymbol)];case 3:I=k.sent(),Q=0,J=a.classBreakInfos,k.label=4;case 4:if(!(Q<J.length))return[3,8];N=J[Q];return[4,d.expandSymbol(N.symbol)];case 5:return L=k.sent(),[4,c.createTemplateGroup(L,I,a,g)];case 6:M=k.sent(),R={min:N.minValue,max:N.maxValue},x.add(R,M),k.label=7;case 7:return Q++,[3,4];case 8:return[4,d.expandSymbol(a.defaultSymbol)];case 9:return(S=k.sent())?[4,c.createTemplateGroup(S,I,a,g)]:[3,11];case 10:T=
k.sent(),x.setDefault(T),k.label=11;case 11:return[2,x]}})})};b.prototype.add=function(a,b){this._intervals.push({interval:a,result:b});this._intervals.sort(function(a,b){return a.interval.min-b.interval.min})};b.prototype.size=function(){return a.prototype.size.call(this)+this._intervals.length};b.prototype.match=function(a,b,c,d,e){if(!this._getValue)return this.getDefault();a=this._getValue(b,{$view:e},c,d);if(!a&&(null===a||void 0===a||isNaN(a)))return this.getDefault();for(b=0;b<this._intervals.length;b++)if(d=
this._intervals[b],c=d.interval,d=d.result,e=this._isMaxInclusive?a<=c.max:a<c.max,a>=c.min&&e)return d;return this.getDefault()};b.prototype._needsNormalization=function(){var a=this._normalizationInfo;return a&&(a.normalizationField||a.normalizationTotal||a.normalizationType)};b.prototype._getValueFromField=function(a){var b=a.attributes[this._field];if(!this._needsNormalization())return b;var d=this._normalizationInfo,e=d.normalizationField,g=d.normalizationTotal,d=d.normalizationType;a=!!e&&a.attributes[e];
if(d)switch(d){case "field":return(a||void 0)&&b/a;case "log":return Math.log(b)*Math.LOG10E;case "percent-of-total":return b/g*100;default:c.error("Found unknown normalization type: "+d)}else c.error("Normalization is required, but no type was set!")};return b}(n);b.IntervalMatcher=a;a=function(a){function b(b,c,d){var e=a.call(this)||this;e._resultsMap=new Map;d?e._getValue=f.callWithFeature.bind(null,d):b&&b.length?"function"===typeof b[0]?(e._fields=null,e._getValue=b[0]):(e._fields=b,e._seperator=
c||"",e._getValue=e._getValueFromFields.bind(e)):e._fields=null;return e}l(b,a);b.fromUVRenderer=function(a,c,g){return h(this,void 0,void 0,function(){var f,h,l,m,p,q,r,n,t,x,I,Q,J,N,L;return k(this,function(k){switch(k.label){case 0:return f=a.uniqueValueInfos,h=a.fieldDelimiter,l=[a.field],m=a.valueExpression,a.field2&&l.push(a.field2),a.field3&&l.push(a.field3),[4,d.expandSymbol(a.backgroundFillSymbol)];case 1:return p=k.sent(),(r=m)?[4,e.createRendererExpression(m,g.spatialReference,g.fields)]:
[3,3];case 2:r=k.sent(),k.label=3;case 3:q=r,n=new b(l,h,q),t=0,x=f,k.label=4;case 4:if(!(t<x.length))return[3,8];I=x[t];return[4,d.expandSymbol(I.symbol)];case 5:return Q=k.sent(),[4,c.createTemplateGroup(Q,p,a,g)];case 6:J=k.sent(),n.add(I.value,J),k.label=7;case 7:return t++,[3,4];case 8:return[4,d.expandSymbol(a.defaultSymbol)];case 9:return(N=k.sent())?[4,c.createTemplateGroup(a.defaultSymbol,p,a,g)]:[3,11];case 10:L=k.sent(),n.setDefault(L),k.label=11;case 11:return[2,n]}})})};b.prototype.add=
function(a,b){this._resultsMap.set(a.toString(),b)};b.prototype.size=function(){return a.prototype.size.call(this)+this._resultsMap.size};b.prototype.match=function(a,b,c,d,e){if(!this._getValue)return this.getDefault();a=this._getValue(b,{$view:e},c,d);if(!a&&(null===a||void 0===a))return this.getDefault();a=a.toString();return this._resultsMap.has(a)?this._resultsMap.get(a):this.getDefault()};b.prototype._getValueFromFields=function(a){for(var b=[],c=0,d=this._fields;c<d.length;c++)b.push(a.attributes[d[c]]);
return b.join(this._seperator)};return b}(n);b.MapMatcher=a;n=function(a){function b(b,c,d){var e=a.call(this)||this;e._fidToAttributeHash=new Map;e._attributeHashToGroup=new Map;e._renderer=b;e._fieldMap=b.fieldMap;e._templates=c;e._info=d;return e}l(b,a);b.fromDictionaryRenderer=function(a,c,d){return h(this,void 0,void 0,function(){return k(this,function(e){a.fetchResources({spatialReference:d.spatialReference,fields:d.fields});return[2,new b(a,c,d)]})})};b.prototype.analyze=function(a,b,c,d,e){return h(this,
void 0,void 0,function(){var c,f,h,l,p,q,r=this;return k(this,function(k){switch(k.label){case 0:c=[];f=function(b){var g=b.attributes[a],f=h._fidToAttributeHash.get(g),k=h._hashAttributes(b);if(f===k)return"continue";h._fidToAttributeHash.set(g,k);h._attributeHashToGroup.has(k)||(b=h._renderer.getSymbolAsync(b,{scale:d&&d.scale,viewingMode:d&&d.viewingMode,spatialReference:h._info.spatialReference,abortOptions:e,fields:h._info.fields}).then(function(a){return r._templates.createTemplateGroup(a,null,
r._renderer,r._info).then(function(a){return r._attributeHashToGroup.set(k,a)})}),c.push(b))};h=this;l=0;for(p=b;l<p.length;l++)q=p[l],f(q);return[4,g.all(c)];case 1:return k.sent(),[2]}})})};b.prototype.match=function(a,b,c,d,e){a=this._fidToAttributeHash.get(b.attributes[a]);return this._attributeHashToGroup.get(a)};b.prototype._hashAttributes=function(a){var b="",c;for(c in this._fieldMap)b+=". "+a.attributes[this._fieldMap[c]];return b};return b}(n);b.DictionaryMatcher=n})},"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/Error ../../../../../../core/has ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/promiseUtils ../../../../../../geometry/SpatialReference ../../../../../../geometry/support/jsonUtils ../../../../../../symbols/SimpleLineSymbol ../../definitions ../../enums ../../WGLDisplayObject ../MeshData ../VertexVector ../templates/WGLLabelTemplate ../templates/WGLLineTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z){function B(a){var b=(a.attributes?Object.keys(a.attributes):[]).map(function(b){return{name:b,alias:b,type:"string"===typeof a.attributes[b]?"esriFieldTypeString":"esriFieldTypeDouble"}});return{geometryType:null!=a.centroid?"esriGeometryPolygon":q.getJsonType(a.geometry),spatialReference:c.fromJSON(a.geometry.spatialReference),fields:b}}Object.defineProperty(b,"__esModule",{value:!0});var C=e.getLogger("esri.views.2d.engine.webgl.WGLMeshFactory"),
D={esriGeometryPoint:"above-right above-center above-left center-center center-left center-right below-center below-left below-right".split(" "),esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};n=function(){function b(a,b,c,e,g,f){this._isDD=!1;this._labelsDebugTemplate=null;this._isDD=d.isSome(c)&&"dot-density"===c.type;this._geometryType=a;this._idField=b;this._templateStore=e;g&&this._validateLabelingInfo(g)&&
(this._labelTemplates=g.map(function(a){return y.default.fromLabelClass(c,a,f)}))}Object.defineProperty(b.prototype,"templates",{get:function(){return this._templateStore},enumerable:!0,configurable:!0});b.prototype.createMeshData=function(a){var b=Array(5),c=this._labelTemplates&&0<this._labelTemplates.length,d="esriGeometryPolyline"===this._geometryType?r.HEURISTIC_GLYPHS_PER_LINE:r.HEURISTIC_GLYPHS_PER_FEATURE;b[t.WGLGeometryType.MARKER]=new u.VertexVectors(t.WGLGeometryType.MARKER,a);b[t.WGLGeometryType.FILL]=
new u.VertexVectors(t.WGLGeometryType.FILL,a,this._isDD);b[t.WGLGeometryType.LINE]=new u.VertexVectors(t.WGLGeometryType.LINE,a);b[t.WGLGeometryType.TEXT]=new u.VertexVectors(t.WGLGeometryType.TEXT,a);b[t.WGLGeometryType.LABEL]=new u.VertexVectors(t.WGLGeometryType.LABEL,c?d:0);return new w.MeshData([],b)};b.prototype.analyze=function(a,b,c,e,g,m){return h(this,void 0,void 0,function(){var h,l,p,q,r,v,n,u,t,y,w;return k(this,function(k){switch(k.label){case 0:return h=a,f.isAborted(m)?[2,[]]:d.isSome(c)?
[4,c.analyze(this._idField,a,e,g,m)]:[3,2];case 1:k.sent(),k.label=2;case 2:l=0,p=h,k.label=3;case 3:if(!(l<p.length))return[3,10];q=p[l];r=-1;if(!b)return[3,7];v=q;if(null==v.symbol)return[3,5];n=null;"cim"===v.symbol.type&&(n=B(q));return[4,this._templateStore.createTemplateGroup(v.symbol,null,null,n)];case 4:return r=k.sent(),[3,6];case 5:d.isSome(c)&&(r=c.match(this._idField,q,null,null,g)),k.label=6;case 6:return[3,8];case 7:d.isSome(c)&&(r=c.match(this._idField,q,this._geometryType,e,g)),k.label=
8;case 8:if(z.isDynamicId(r))for(u=this._templateStore.getDynamicTemplateGroup(r),t=0,y=u;t<y.length;t++)(w=y[t])&&w.analyze&&w.analyze(this._templateStore,q,e,g);q.groupId=r;k.label=9;case 9:return l++,[3,3];case 10:return[2,this._templateStore.finalize(m).then(function(){return h})]}})})};b.prototype.write=function(a,b,c,d,e,g,f){var h=this._templateStore.getTemplateGroup(b.groupId),k=b.localId;if(null!=k){var m=new x(k),l=!!g&&!!this._labelTemplates&&g.has(k);if(z.isDynamicId(b.groupId))for(var p=
0;p<h.length;p++){var r=h[p];r.bindFeature(b,c,d)}if(h&&(b.geometry||b.centroid)){d=m.displayRecords;r=b.insertAfter;void 0!==r&&(m.insertAfter=r);(c=this._geometryType)||(c=null!=b.centroid?"esriGeometryPolygon":q.getJsonType(b.geometry));for(p=0;p<h.length;p++){var r=h[p],v=a.get(r.geometryType);r.writeMesh(d,v,c,k,b)}l&&(h=this._getLabelReference(h),g=g.get(k),this._writeLabelMesh(m,a,k,b,f,g,h,e,c));a.pushDisplayObject(m)}}};b.prototype._hasBadLabelClass=function(b,c){var d=b.labelPlacement,e=
D[c];if(!b.symbol)return C.warn("No LabelClass symbol specified."),!0;if(!e)return C.error(new a("mapview-labeling:unsupported-geometry-type","Unable to create labels for Feature Layer, "+c+" is not supported")),!0;e.some(function(a){return a===d})||(e=e[0],d&&C.warn("Found invalid label placement type "+d+" for "+c+". Defaulting to "+e),b.labelPlacement=e);return!1};b.prototype._validateLabelingInfo=function(a){var b=this;return!a.some(function(a){return b._hasBadLabelClass(a,b._geometryType)})};
b.prototype._getLabelReference=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c instanceof v.default)return c}return null};b.prototype._writeLabelMesh=function(a,b,c,d,e,g,f,h,k){for(var m=a.displayRecords,l=[],p=0;p<g.length;p++){var q=g[p],v=q.text,n=q.rtl,q=this._labelTemplates[q.id],u=b.get(q.geometryType),t=e.get(q.symbolId).glyphMosaicItems;q.bindReferenceTemplate(f);q.bindTextInfo(t,v,n);q.writeMesh(m,u,k,c,d,h,l)}a.metrics=l;r.DEBUG_LABELS&&this._debugLabels(a,b)};b.prototype._debugLabels=
function(a,b){var c=a.displayRecords,d=a.id,e=0;for(a=a.metrics;e<a.length;e++)for(var g=a[e],f=0,h=g.boxes?g.boxes.concat([g.bounds]):[g.bounds];f<h.length;f++){var k=h[f],k={geometry:{paths:[[[g.anchor[0]+g.offsetX+k.center[0]-k.width/2,g.anchor[1]+g.offsetY+k.center[1]+k.height/2],[0,-k.height],[k.width,0],[0,k.height],[-k.width,0]]]},attributes:{}},m=this._getLabelDebugTemplate(),l=b.get(m.geometryType);m.writeMesh(c,l,"esriGeometryPolyline",d,k)}};b.prototype._getLabelDebugTemplate=function(){this._labelsDebugTemplate||
(this._labelsDebugTemplate=this._createLabelsDebugTemplate());return this._labelsDebugTemplate};b.prototype._createLabelsDebugTemplate=function(){var a=new p({style:"solid",width:1,color:[255,0,0,1]});return m.default.fromSimpleLine(null,!1,a,null,!1)};return b}();b.WGLMeshFactory=n})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["require","exports","./WGLDisplayRecord","./collisions/Metric","./util/serializationUtils"],function(n,b,l,k,h){return function(){function a(a){this.insertAfter=
null;this.id=a;this.displayRecords=[];this.metrics=[]}a.prototype.copy=function(){var b=new a(this.id);b.set(this);return b};a.prototype.clone=function(){var b=new a(this.id);b.displayRecords=this.displayRecords.map(function(a){return a.clone()});b.metrics=this.metrics.map(function(a){return a.clone()});b.insertAfter=this.insertAfter;return b};a.prototype.set=function(a){this.id=a.id;this.displayRecords=a.displayRecords;this.metrics=a.metrics;this.insertAfter=a.insertAfter};a.prototype.serialize=
function(a){a.push(this.id);h.serializeList(a,this.metrics);h.serializeList(a,this.displayRecords);return a};a.deserialize=function(b){var e=b.readInt32(),d=new a(e),e={id:e},g=h.deserializeList(b,k.default);g.length&&(d.metrics=g);d.displayRecords=h.deserializeList(b,l,e);return d};return a}()})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["require","exports","../util/serializationUtils","../util/Writer"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,
b){this.displayObjects=a;this.vertexVectorsMap=b}Object.defineProperty(b.prototype,"vertexBuffersMap",{get:function(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(var a=0;a<this.vertexVectorsMap.length;a++)this._vertexBuffersMap[a]=this.vertexVectorsMap[a].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap},enumerable:!0,configurable:!0});b.prototype.get=function(a){return this.vertexVectorsMap[a]};b.prototype.pushDisplayObject=function(a){this.displayObjects.push(a)};
b.prototype.encode=function(a,b){var e=l.serializeList(new k.default(Uint32Array,this._guessSize()),this.displayObjects).buffer(),d={};b.push(e);for(var g=0;g<this.vertexVectorsMap.length;g++){var c=this.vertexVectorsMap[g];d[g]={};c.transfer(d[g],b)}a.displayObjects=e;a.vertexBuffersMap=d;this.destroy()};b.prototype.destroy=function(){this.displayObjects=this.vertexVectorsMap=null};b.prototype._guessSize=function(){for(var a=this.displayObjects,b=Math.min(a.length,4),e=0,d=0;d<b;d++)e=Math.max(e,
a[d].displayRecords.length);return 2*(12*a.length+a.length*e*40)};return b}();b.MeshData=n})},"esri/views/2d/engine/webgl/util/Writer":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,h){this._pos=0;h=h?this._roundToNearest(h,b.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(h);this._buffer=new b(this._array);this._ctor=b}Object.defineProperty(b.prototype,"length",{get:function(){return this._pos},enumerable:!0,configurable:!0});
b.prototype._roundToNearest=function(b,h){b=Math.round(b);return b+(h-b%h)};b.prototype._ensureSize=function(b){if(this._pos+b>=this._buffer.length){b=this._roundToNearest(1.5*(this._array.byteLength+b*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);b=new ArrayBuffer(b);var h=new this._ctor(b);h.set(this._buffer,0);this._array=b;this._buffer=h}};b.prototype.writeF32=function(b){this._ensureSize(1);var h=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=b;this._pos++;return h};
b.prototype.push=function(b){this._ensureSize(1);var h=this._pos;this._buffer[this._pos++]=b;return h};b.prototype.writeRegion=function(b){this._ensureSize(b.length);var h=this._pos;this._buffer.set(b,this._pos);this._pos+=b.length;return h};b.prototype.buffer=function(){var b=this._array.slice(0,4*this._pos);this.destroy();return b};b.prototype.seek=function(b){this._pos=b};b.prototype.destroy=function(){this._buffer=this._array=null};return b}();b.default=n})},"esri/views/2d/engine/webgl/mesh/VertexVector":function(){define(["require",
"exports","../Utils","./VertexBuffer","../util/Writer"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(){function a(a,b){this.data=a;this.stride=b}Object.defineProperty(a.prototype,"vertexCount",{get:function(){return this.data.length/(this.stride/4)},enumerable:!0,configurable:!0});a.prototype.transfer=function(a,b){var d=this.data.buffer();a.vertexCount=this.vertexCount;a.data=d;a.stride=this.stride;b.push(d)};return a}();b.default=a;n=function(){function b(b,
d,g){void 0===g&&(g=!1);this.geometryType=b;this.indexVector=new h.default(Uint32Array,d);this.namedVectors={};b=l.getStrides(b,g);for(var c in b){g=b[c];var e=void 0;switch(g%4){case 0:case 2:e=new h.default(Uint32Array,g/4*d);break;case 1:case 3:e=new h.default(Uint8Array,g*d)}this.namedVectors[c]=new a(e,g)}}b.prototype.get=function(a){return this.namedVectors[a].data};b.prototype.getVector=function(a){return this.namedVectors[a]};b.prototype.transfer=function(a,b){var d=this.indexVector.buffer(),
c={};b.push(d);for(var e in this.namedVectors){var g=this.namedVectors[e];c[e]={};g.transfer(c[e],b)}a.geometryType=this.geometryType;a.indexBuffer=d;a.namedBuffers=c;this.destroy()};b.prototype.intoBuffers=function(){var a=k.VertexBuffers.fromVertexVectors(this);this.destroy();return a};b.prototype.destroy=function(){this.namedVectors=this.indexVector=null};return b}();b.VertexVectors=n})},"esri/views/2d/engine/webgl/mesh/VertexBuffer":function(){define(["require","exports","../Utils"],function(n,
b,l){Object.defineProperty(b,"__esModule",{value:!0});var k=function(){function b(a,b,e){this.data=a;this.stride=b;this.vertexCount=e}b.decode=function(a){var g=l.allocateTypedArrayBufferwithData(a.data,a.stride);return new b(g,a.stride,a.vertexCount)};b.fromVertexVector=function(a){var g=l.allocateTypedArrayBufferwithData(a.data.buffer(),a.stride);return new b(g,a.stride,a.vertexCount)};return b}();b.default=k;n=function(){function b(a,b,e){this.geometryType=a;this.indexBuffer=new Uint32Array(b);
this.namedBuffers=e}b.decode=function(a){var g=a.geometryType,e=a.indexBuffer,d={},f;for(f in a.namedBuffers)d[f]=k.decode(a.namedBuffers[f]);return new b(g,e,d)};b.fromVertexVectors=function(a){var g=a.geometryType,e=a.indexVector.buffer(),d={},f;for(f in a.namedVectors)d[f]=k.fromVertexVector(a.namedVectors[f]);return new b(g,e,d)};return b}();b.VertexBuffers=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../color ../../number ../../Utils ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLMeshTemplate".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});var r=k.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");n=function(b){function k(a,d,e,g,h,k,l,p,q,r,n,t,x,N,L,M){var m=b.call(this)||this;a=f.LineMaterialKey.load(f.createMaterialKey(m.geometryType,a,x));d&&(a.sdf=d.sdf,a.pattern=!0,a.textureBinding=d.textureBinding);m._capType=g;m._joinType=h;m._miterLimitCosine=c.getLimitCosine(k);m.tessellationProperties._fillColor=l;m.tessellationProperties._tl=p;m.tessellationProperties._br=
q;m._hasPattern=r;m._isDashed=n;m._joinOnUTurn=M;m._isColorLocked=t;m._isOutline=x;m._zOrder=L;m._materialKey=a.data;m.tessellationProperties._bitset=t?1:0;m.tessellationProperties._halfWidth=.5*e;m.tessellationProperties._halfReferenceWidth=.5*N;m._initializeTessellator(!1);return m}l(k,b);k.fromCIMLine=function(b,c,d,f,l){var m=c.color,p=c.isDashed,q=c.cap;p&&q===a.CapType.ROUND&&(q=a.CapType.SQUARE);var r=c.join,v=h.pt2px(c.width),n=h.pt2px(c.referenceWidth),u=h.pt2px(c.miterLimit),m=m&&g.premultiplyAlphaRGBA(m)||
0;if(!d)return new k(b,d,v,q,r,u,m,0,0,!1,p,c.colorLocked,f,n,c.zOrder,l);var t=d.rect,y=t.x+1+d.width,w=t.y+1+d.height,t=e.i1616to32(t.x+1,t.y+1),y=e.i1616to32(y,w);return new k(b,d,v,q,r,u,m,t,y,!0,p,c.colorLocked,f,n,c.zOrder,l)};k.fromSimpleLine=function(a,b,c,f,l){var m=c.color,p="solid"!==c.style&&"none"!==c.style,q=d.getCapType(c.cap||"round",p),r=d.getJoinType(c.join||"round"),m=m&&"none"!==c.style&&g.premultiplyAlphaRGBA(m)||0;"none"===c.style&&(m=0);var v=h.pt2px(c.width);c=c.miterLimit;
if(!f)return new k(a,f,v,q,r,c,m,0,0,!1,p,!1,b,v,0,l);var n=f.rect,u=n.x+1+f.width,t=n.y+1+f.height,n=e.i1616to32(n.x+1,n.y+1),u=e.i1616to32(u,t);return new k(a,f,v,q,r,c,m,n,u,!0,p,!1,b,v,0,l)};k.fromPictureLineSymbol=function(a,b,c,d){r.error("PictureLineSymbol support does not exist!");return null};return k}(q.default(p.default));b.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/has ../../../../../../core/Logger ../../definitions ../../enums ../../number ../../TileClipper ../../TurboLine ../../WGLDisplayRecord ../../materialKey/MaterialKey".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){Object.defineProperty(b,"__esModule",{value:!0});var p=h.getLogger("esri.views.2d.engine.webgl.WGLLineTemplateBase"),r=a.TILE_SIZE+16,t=1/3.8,x=new d.TileClipper(0,0,0,1,16);x.setExtent(a.TILE_SIZE);var w=new Uint32Array(9),u=new Uint32Array(36),y=new Uint32Array(3),m=new Uint32Array(6),v=function(a){return function(b){b.entry0=a.offset+a.vertexCount++;var c=e.i1616to32(b.distance,31*a._halfWidth),d=e.i8888to32(Math.round(31*b.prevNormal.x),Math.round(31*b.prevNormal.y),
Math.round(0),Math.round(-31)),g=e.i8888to32(0,0,0,a._bitset);u[0]=e.i1616to32(b.currentVertex.x,b.currentVertex.y);u[1]=a.id;u[2]=a._fillColor;u[3]=d;u[4]=c;u[5]=a._tl;u[6]=a._br;u[7]=g;u[8]=e.i1616to32(31*a._halfReferenceWidth,0);b.entry2=a.offset+a.vertexCount++;c=e.i1616to32(b.distance,31*a._halfWidth);d=e.i8888to32(Math.round(31*-b.prevNormal.x),Math.round(31*-b.prevNormal.y),Math.round(0),Math.round(31));g=e.i8888to32(0,0,0,a._bitset);u[9]=e.i1616to32(b.currentVertex.x,b.currentVertex.y);u[10]=
a.id;u[11]=a._fillColor;u[12]=d;u[13]=c;u[14]=a._tl;u[15]=a._br;u[16]=g;u[17]=e.i1616to32(31*a._halfReferenceWidth,0);b.exit0=a.offset+a.vertexCount++;c=e.i1616to32(b.distance,31*a._halfWidth);d=e.i8888to32(Math.round(31*b.nextNormal.x),Math.round(31*b.nextNormal.y),Math.round(0),Math.round(-31));g=e.i8888to32(0,0,0,a._bitset);u[18]=e.i1616to32(b.currentVertex.x,b.currentVertex.y);u[19]=a.id;u[20]=a._fillColor;u[21]=d;u[22]=c;u[23]=a._tl;u[24]=a._br;u[25]=g;u[26]=e.i1616to32(31*a._halfReferenceWidth,
0);b.exit2=a.offset+a.vertexCount++;c=e.i1616to32(b.distance,31*a._halfWidth);d=e.i8888to32(Math.round(31*-b.nextNormal.x),Math.round(31*-b.nextNormal.y),Math.round(0),Math.round(31));g=e.i8888to32(0,0,0,a._bitset);u[27]=e.i1616to32(b.currentVertex.x,b.currentVertex.y);u[28]=a.id;u[29]=a._fillColor;u[30]=d;u[31]=c;u[32]=a._tl;u[33]=a._br;u[34]=g;u[35]=e.i1616to32(31*a._halfReferenceWidth,0);a.geometryBuf.writeRegion(u)}},z=function(a){return function(b){m[0]=b.leftExit0;m[1]=b.rightEntry0;m[2]=b.leftExit2;
m[3]=b.rightEntry0;m[4]=b.rightEntry2;m[5]=b.leftExit2;a.indexCount+=6;a.indexBuf.writeRegion(m)}},B=function(a){return function(b,c,d,g,f,h,k,m,l){l=e.i1616to32(l,31*a._halfWidth);f=e.i8888to32(Math.round(31*f),Math.round(31*h),Math.round(31*k),Math.round(31*m));d=e.i8888to32(31*d,31*g,0,a._bitset);w[0]=e.i1616to32(b,c);w[1]=a.id;w[2]=a._fillColor;w[3]=f;w[4]=l;w[5]=a._tl;w[6]=a._br;w[7]=d;w[8]=e.i1616to32(31*a._halfReferenceWidth,0);a.geometryBuf.writeRegion(w);return a.offset+a.vertexCount++}},
C=function(a){return function(b,c,d){y[0]=b;y[1]=c;y[2]=d;a.indexCount+=3;a.indexBuf.writeRegion(y)}};b.default=function(b){return function(b){function d(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a.tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,geometryBuf:null,vertexCount:null,offset:null};a._tessellationOptions={};a.geometryType=g.WGLGeometryType.LINE;
return a}l(d,b);d.prototype.writeMesh=function(a,b,d,e,g){var f=b.indexVector,h=b.get("geometry"),k=new c(e,this.geometryType,this._materialKey);b=b.getVector("geometry").vertexCount;k.vertexFrom=b;k.indexFrom=f.length;switch(d){case "esriGeometryPolyline":d=this._clipLines(g.geometry.paths);if(0===d.length)break;this._write(k,f,h,b,e,d);a.push(k);break;case "esriGeometryPolygon":d=this._clipLines(g.geometry.rings);if(0===d.length)break;this._write(k,f,h,b,e,d);a.push(k);break;default:p.error("Unable to handle geometryType: "+
d)}};d.prototype._clipLines=function(a){for(var b=[],c=!1,d=0;d<a.length;){var e=[],g=a[d];x.reset(2);var f=g[0],h=f[0],f=f[1];if(c)x.moveTo(h,f);else{if(-16>h||h>r||-16>f||f>r){c=!0;continue}e.push({x:h,y:f})}for(var k=!1,m=g.length,l=1;l<m;++l)if(h+=g[l][0],f+=g[l][1],c)x.lineTo(h,f);else{if(-16>h||h>r||-16>f||f>r){k=!0;break}e.push({x:h,y:f})}if(k)c=!0;else{if(c){if(e=x.resultWithStarts())for(c=0;c<e.length;c++)b.push(e[c])}else b.push({line:e,start:0});d++;c=!1}}return b};d.prototype._write=function(a,
b,c,d,e,g){this.tessellationProperties.id=e;this.tessellationProperties.indexBuf=b;this.tessellationProperties.indexCount=0;this.tessellationProperties.geometryBuf=c;this.tessellationProperties.vertexCount=0;this.tessellationProperties.offset=d;for(b=0;b<g.length;b++)c=g[b],d=c.line,2>d.length||(this._tessellationOptions.initialDistance=c.start%65535,this._tessellationCallbacks instanceof f.StandardTessellationCallbacks&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=
this._joinType),f.tessellate(d,this._tessellationOptions,this._tessellationCallbacks),f.cleanup());a.vertexCount=this.tessellationProperties.vertexCount;a.indexCount=this.tessellationProperties.indexCount;a.zOrder=this._zOrder};d.prototype._initializeTessellator=function(b){var c=q.LineMaterialKey.load(this._materialKey);this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern;this._tessellationOptions.thin=!b&&this.tessellationProperties._halfWidth<a.THIN_LINE_THRESHOLD/2&&!(c.vvSizeFieldStops||
c.vvSizeMinMaxValue||c.vvSizeScaleStops||c.vvSizeUnitValue);this._tessellationOptions.wrapDistance=65535;this._tessellationOptions.outerBisectorAutoSplitThreshold=t;this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.innerBisectorAutoSplitThreshold=t;this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.thin?this._tessellationCallbacks={vertex:v(this.tessellationProperties),bridge:z(this.tessellationProperties)}:
(b=new f.StandardTessellationCallbacks(B(this.tessellationProperties),C(this.tessellationProperties)),b.miterLimitCosine=this._miterLimitCosine,b.textured=this._isDashed||this._hasPattern,b.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=b)};return d}(b)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function r(c,f,k,l,r,n,t,w,x,I,Q,J,N,L,M,R,S,T){var m=b.call(this)||this;m.height=t;m.width=n;m.xOffset=f;m.yOffset=k;var v=e.vec2f32.create(),u=a.mat2df32.create();Q=(L===d.Alignment.MAP?1:0)|(Q?1:0)<<1|(N?1:0)<<2|(J?1:0)<<3;J=M&&M.sdf;h.mat2d.translate(u,u,e.vec2f32.fromValues(f,-k));l&&h.mat2d.rotate(u,u,3.14159265359/180*l);c=p.MarkerMaterialKey.load(p.createMaterialKey(m.geometryType,c,!1));
c.sdf=J;c.pattern=!0;c.textureBinding=M.textureBinding;m._materialKey=c.data;m._fillColor=r;m._outlineColor=x;m._sizeOutlineWidth=q.i8888to32(Math.round(Math.sqrt(256*n)),Math.round(Math.sqrt(256*t)),Math.round(Math.sqrt(256*I)),Math.round(Math.sqrt(256*w)));r=M.rect.x;w=M.rect.y;x=r+M.rect.width;I=w+M.rect.height;R=.5-((.5+R)*M.width+1)/M.rect.width;S=.5-((.5+S)*M.height+1)/M.rect.height;c=Math.round(Math.min(64*T,255));n*=M.rect.width/M.width*T;t*=M.rect.height/M.height*T;M=(R-.5)*n;S=(S-.5)*t;
m._bitestAndDistRatio=q.i8888to32(0,0,Q,c);g.vec2.set(v,M,S);g.vec2.transformMat2d(v,v,u);m._offsetUpperLeft=q.i1616to32(16*v[0],16*v[1]);m._texUpperLeft=q.i1616to32(r,w);g.vec2.set(v,M+n,S);g.vec2.transformMat2d(v,v,u);m._offsetUpperRight=q.i1616to32(16*v[0],16*v[1]);m._texUpperRight=q.i1616to32(x,w);g.vec2.set(v,M,S+t);g.vec2.transformMat2d(v,v,u);m._offsetBottomLeft=q.i1616to32(16*v[0],16*v[1]);m._texBottomLeft=q.i1616to32(r,I);g.vec2.set(v,M+n,S+t);g.vec2.transformMat2d(v,v,u);m._offsetBottomRight=
q.i1616to32(16*v[0],16*v[1]);m._texBottomRight=q.i1616to32(x,I);return m}l(r,b);r.fromCIMMarker=function(a,b,c){var e=b.size,g=(c&&c.width||1)/(c&&c.height||1)*b.scaleX,h=b.scaleSymbolsProportionally&&b.frameHeight?e/b.frameHeight:1,m=f.premultiplyAlphaRGBA(b.color),l=f.premultiplyAlphaRGBA(b.outlineColor),p=k.pt2px(e),q=p*g,n=k.pt2px(b.offsetX||0),u=k.pt2px(b.offsetY||0),h=k.pt2px(b.outlineWidth||0)*h,t=b.alignment||d.Alignment.SCREEN,y=k.pt2px(b.referenceSize),w=b.rotation||0;b.rotateClockwise||
(w=-w);var x=0,S=0,T=b.anchorPoint;T&&(b.isAbsoluteAnchorPoint?e&&(x=-T.x/(e*g),S=T.y/e):(x=T.x,S=T.y));return new r(a,n,u,w,m,q,p,y,l,h,b.colorLocked,b.scaleSymbolsProportionally,!1,t,c,x,S,b.sizeRatio)};r.fromPictureMarker=function(a,b,e){var g=Math.round(k.pt2px(b.width)),f=Math.round(k.pt2px(b.height)),h=c.PICTURE_FILL_COLOR,m=Math.round(k.pt2px(b.xoffset||0)),l=Math.round(k.pt2px(b.yoffset||0));return new r(a,m,l,b.angle,h,g,f,f,0,0,!1,!1,!1,d.Alignment.SCREEN,e,0,0,1)};r.fromSimpleMarker=function(a,
b,c){var e=f.premultiplyAlphaRGBA(b.color),g=Math.round(k.pt2px(b.size)),h=Math.round(k.pt2px(b.xoffset||0)),m=Math.round(k.pt2px(b.yoffset||0)),l=b.style,p=b.outline,q=(p&&p.color&&f.premultiplyAlphaRGBA(p.color))|0,p=(p&&p.width&&Math.round(k.pt2px(p.width)))|0;return new r(a,h,m,b.angle,e,g,g,g,q,p,!1,!1,"cross"===l||"x"===l,d.Alignment.SCREEN,c,0,0,1.96875)};return r}(r.default(t.default));b.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../enums ../../number ../../WGLDisplayRecord ../../materialKey/MaterialKey".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});var d=k.getLogger("esri.views.2d.engine.webgl.WGLMarkerTemplateBase");b.default=function(b){return function(b){function c(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a.xOffset=0;a.yOffset=0;a.width=0;a.height=0;a.geometryType=h.WGLGeometryType.MARKER;return a}l(c,b);c.prototype.writeMesh=function(a,b,c,f,h){var k=e.MarkerMaterialKey.load(this._materialKey),l=b.indexVector,m=b.get("geometry"),
p=new g(f,this.geometryType,this._materialKey);b=b.getVector("geometry").vertexCount;a.push(p);p.vertexFrom=b;p.indexFrom=l.length;switch(c){case "esriGeometryPoint":c=h.geometry;a=c.x;c=c.y;this._writeVertices(p,m,f,this._getPos(a,c),k);this._writeIndices(p,l,b);break;case "esriGeometryPolyline":this._writeMany(p,l,m,b,f,h.geometry.paths[0],k);break;case "esriGeometryPolygon":(c=h.centroid)?(a=c.x,c=c.y,this._writeVertices(p,m,f,this._getPos(a,c),k),this._writeIndices(p,l,b)):d.error("Tried to render polygon geometries as markers, but found no centroid!");
break;case "esriGeometryMultipoint":this._writeMany(p,l,m,b,f,h.geometry.points,k);break;default:d.error("Unable to handle geometryType: "+c)}};c.prototype._getPos=function(b,c){return a.i1616to32(b,c)};c.prototype._writeMany=function(a,b,c,d,e,g,f){for(var h=0,k=0,l=0,p=0;p<g.length;p++){var q=g[p],r=q[0],q=q[1],n=this._getPos(r+h,q+k);this._writeVertices(a,c,e,n,f);this._writeIndices(a,b,d+l);h+=r;k+=q;l+=4}};c.prototype._writeVertices=function(a,b,c,d,e){b.push(d);b.push(this._offsetUpperLeft);
b.push(this._texUpperLeft);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetUpperRight);b.push(this._texUpperRight);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetBottomLeft);b.push(this._texBottomLeft);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);
b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetBottomRight);b.push(this._texBottomRight);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);a.vertexCount+=4};c.prototype._writeIndices=function(a,b,c){b.push(c+0);b.push(c+1);b.push(c+2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return c}(b)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":function(){define("require exports ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/cim/cimAnalyzer ../../../../../../symbols/support/defaults ./WGLDynamicLineTemplate ./WGLDynamicMarkerTemplate ./WGLDynamicTextTemplate ./WGLFillTemplate ./WGLLineTemplate ./WGLMarkerTemplate ./WGLTextTemplate ../../util/BidiText ../../util/Lock ../../util/Result".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y){function m(a,b){var c=a.length;a.push(null);b.then(function(b){return a[c]=b});return a}function v(a){return!!(a&1)}Object.defineProperty(b,"__esModule",{value:!0});var z=a.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),B=[];b.isDynamicId=v;n=function(){function a(a,b){this._templateIdCounter=this._idCounter=0;this._idToTemplateGroup=new Map;this._symbolToTemplate=new Map;this._fetchQueue=[];this._idToResolver=new Map;this._cimTemplateCache=
new Map;this._cimAnalyses=[];this._lock=new u.default;this._fetchResource=a;this._joinOnUTurn=b}Object.defineProperty(a.prototype,"_markerError",{get:function(){return this._errorTemplates.marker[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_fillError",{get:function(){return this._errorTemplates.fill[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_lineError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"_textError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});a.prototype.createTemplateGroup=function(a,b,c,d){return l(this,void 0,void 0,function(){var e,g,f;return k(this,function(h){switch(h.label){case 0:return[4,this._initErrorTemplates()];case 1:h.sent();e=JSON.stringify(a);if(this._symbolToTemplate.has(e))return[2,this._symbolToTemplate.get(e)];g=[];return b?[4,this._createMeshTemplates(g,b,c,d,!0)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,this._createMeshTemplates(g,
a,c,d,!1)];case 4:return h.sent(),f=this._createGroupId("cim"===a.type),this._idToTemplateGroup.set(f,g),this._symbolToTemplate.set(e,f),[2,f]}})})};a.prototype.getCIMMosaicItem=function(a,b){var c=this,d=this._createTemplateId(),e=g.create(function(a){return c._idToResolver.set(d,a)});this._fetchQueue.push({symbol:a,id:d,glyphIds:b});return e};a.prototype.getTemplateGroup=function(a){return this._idToTemplateGroup.has(a)?this._idToTemplateGroup.get(a):B};a.prototype.getDynamicTemplateGroup=function(a){if(!this._idToTemplateGroup.has(a))return B;
v(a)||z.error("mapview-template-store","Id "+a+" does not refer to a dynamic template");return this._idToTemplateGroup.get(a)};a.prototype.finalize=function(a){return this._fetchQueue.length||this._lock.isHeld()?u.withLock(this._lock,this._fetchAllQueuedResources.bind(this),a):g.resolve()};a.prototype._initErrorTemplates=function(){return l(this,void 0,void 0,function(){var a,b,c,e;return k(this,function(f){switch(f.label){case 0:if(this._errorTemplates)return[2];a=this._createMeshTemplates([],d.errorPolygonSymbol2D,
null,null,!1);b=this._createMeshTemplates([],d.errorPointSymbol2D,null,null,!1);c=this._createMeshTemplates([],d.errorPolylineSymbol2D,null,null,!1);return[4,g.all([a,b,c])];case 1:return e=f.sent(),this._errorTemplates={fill:e[0],marker:e[1],line:e[2]},[2]}})})};a.prototype._fetchAllQueuedResources=function(a){var b=this;if(!this._fetchQueue.length)return g.resolve();var c=this._fetchQueue,d=this._cimAnalyses;this._fetchQueue=[];this._cimAnalyses=[];return g.all(d).then(function(){return b._fetchResource(c,
a).then(function(a){for(var c=0;c<a.length;c++){var d=a[c],e=d.id,d=d.mosaicItem;b._idToResolver.get(e)(d);b._idToResolver.delete(e)}})}).catch(function(a){g.isAbortError(a)?b._fetchQueue=b._fetchQueue.concat(c):z.error(new h("mapview-template-store","Unable to fetch requested texture resources",a))})};a.prototype._createGroupId=function(a){return this._idCounter++<<1|(a?1:0)};a.prototype._createTemplateId=function(){return this._templateIdCounter++};a.prototype._getCodepoints=function(a){a=w.bidiText(a.text)[0];
for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c));return b};a.prototype._getMosaicItem=function(a){var b=this,c=this._createTemplateId(),d="text"===a.type&&this._getCodepoints(a),e=g.create(function(a){return b._idToResolver.set(c,a)});this._fetchQueue.push({symbol:a.toJSON(),id:c,glyphIds:d});return e};a.prototype._createSMS=function(a,b){return l(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().spriteMosaicItem,
y.ok(c,z)?[2,t.default.fromSimpleMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createPMS=function(a,b){return l(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().spriteMosaicItem,y.ok(c,z)?[2,t.default.fromPictureMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createSFS=function(a,b,c){return l(this,void 0,void 0,function(){var d,e;return k(this,function(g){switch(g.label){case 0:return[4,
this._getMosaicItem(a)];case 1:return d=g.sent().spriteMosaicItem,e=a,y.ok(d,z)?[2,p.default.fromSimpleFill(b,e,d,c)]:[2,this._fillError]}})})};a.prototype._createPFS=function(a,b,c){return l(this,void 0,void 0,function(){var d,e;return k(this,function(g){switch(g.label){case 0:return[4,this._getMosaicItem(a)];case 1:return d=g.sent().spriteMosaicItem,e=a,y.ok(d,z)?[2,p.default.fromPictureFill(b,e,d,c)]:[2,this._fillError]}})})};a.prototype._createSLS=function(a,b,c){return l(this,void 0,void 0,function(){var d,
e;return k(this,function(g){switch(g.label){case 0:return[4,this._getMosaicItem(a)];case 1:return d=g.sent().spriteMosaicItem,e=a,y.ok(d,z)?[2,r.default.fromSimpleLine(b,c,e,d,this._joinOnUTurn)]:[2,this._lineError]}})})};a.prototype._createTS=function(a,b){return l(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().glyphMosaicItems,[2,x.default.fromText(b,a,c)]}})})};a.prototype._createCIMText=function(a,
b){return l(this,void 0,void 0,function(){var c,d,e,f,h,m;return k(this,function(k){switch(k.label){case 0:if("function"===typeof a.materialHash)return[2,g.resolve(q.default.fromCIMText(b,a))];c=[];if(d=a.text)for(e=d.length,f=0;f<e;f++)h=d.charCodeAt(f),c.push(h);a.cim.mosaicHash=a.materialHash;return[4,this.getCIMMosaicItem(a.cim,c)];case 1:return m=k.sent().glyphMosaicItems,y.ok(m,z)?[2,x.default.fromCIMText(b,a,m)]:[2,this._textError]}})})};a.prototype._createCIMFill=function(a,b){return l(this,
void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return a.cim.mosaicHash=a.materialHash,[4,this.getCIMMosaicItem(a.cim)];case 1:return c=d.sent().spriteMosaicItem,y.ok(c,z)?[2,p.default.fromCIMFill(b,a,c,!1)]:[2,this._fillError]}})})};a.prototype._createCIMLine=function(a,b){return l(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:if("function"===typeof a.materialHash)return[2,g.resolve(f.default.fromCIMLine(b,a))];a.cim.mosaicHash=
a.materialHash;return[4,this.getCIMMosaicItem(a.cim)];case 1:return c=d.sent().spriteMosaicItem,y.ok(c,z)?[2,r.default.fromCIMLine(b,a,c,!1,this._joinOnUTurn)]:[2,this._lineError]}})})};a.prototype._createCIMMarker=function(a,b){return l(this,void 0,void 0,function(){var d;return k(this,function(e){switch(e.label){case 0:if("function"===typeof a.materialHash)return[2,g.resolve(c.default.fromCIMMarker(b,a))];a.cim.mosaicHash=a.materialHash;return[4,this.getCIMMosaicItem(a.cim)];case 1:return d=e.sent().spriteMosaicItem,
y.ok(d,z)?[2,t.default.fromCIMMarker(b,a,d)]:[2,this._markerError]}})})};a.prototype._createCIM=function(a,b){return l(this,void 0,void 0,function(){var c,d,e=this;return k(this,function(g){c=a.templateHash;if(this._cimTemplateCache.has(c))return[2,this._cimTemplateCache.get(c)];switch(a.type){case "marker":d=this._createCIMMarker(a,b);break;case "line":d=this._createCIMLine(a,b);break;case "fill":d=this._createCIMFill(a,b);break;case "text":d=this._createCIMText(a,b)}d.then(function(a){return e._cimTemplateCache.set(c,
a)});return[2,d]})})};a.prototype._getCIMSymbolLayers=function(a,b,c){return l(this,void 0,void 0,function(){var d,f;return k(this,function(h){switch(h.label){case 0:return d=[],f=[],d.push(e.analyzeCIMSymbol(a.data,b,c,f)),[4,g.all(d)];case 1:return h.sent(),[2,f]}})})};a.prototype._createCIMMeshTemplates=function(a,b,c,d){return l(this,void 0,void 0,function(){var e,g,f,h,l,p,q;return k(this,function(k){switch(k.label){case 0:return g=(e=c)?e.fieldMap:null,f=b,[4,this._getCIMSymbolLayers(f,g,d)];
case 1:h=k.sent();l=0;for(p=h;l<p.length;l++)q=p[l],m(a,this._createCIM(q,c));return[2]}})})};a.prototype._createMeshTemplates=function(a,b,c,d,e){return l(this,void 0,void 0,function(){var g,f,h;return k(this,function(k){switch(k.label){case 0:if(-1!==b.type.indexOf("3d"))return z.error("3D symbols are not supported with MapView"),[2,a];g=b.type;switch(g){case "cim":return[3,1];case "simple-marker":return[3,3];case "picture-marker":return[3,4];case "simple-fill":return[3,5];case "picture-fill":return[3,
6];case "simple-line":return[3,7];case "text":return[3,8]}return[3,9];case 1:return[4,this._createCIMMeshTemplates(a,b,c,d)];case 2:return k.sent(),[2,a];case 3:return[2,m(a,this._createSMS(b,c))];case 4:return[2,m(a,this._createPMS(b,c))];case 5:return f=b,m(a,this._createSFS(f,c,e)),f.outline&&m(a,this._createSLS(f.outline,c,!0)),[2,a];case 6:return h=b,m(a,this._createPFS(h,c,e)),h.outline&&m(a,this._createSLS(h.outline,c,!0)),[2,a];case 7:return[2,m(a,this._createSLS(b,c,!1))];case 8:return[2,
m(a,this._createTS(b,c))];case 9:return z.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),[2,a]}})})};return a}();b.WGLTemplateStore=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(c,g){var f=b.call(this,g)||this;f._cimLineLayer=g;var l=0;d.isFunction(g.width)||(l=.5*k.pt2px(g.width));f._dynamicPropertyMap.set("_halfWidth",function(a,b,c){return d.isFunction(g.width)?.5*k.pt2px(g.width(a,b,c)):l});var p=h.CapType.ROUND;d.isFunction(g.cap)||(p=g.cap);f._dynamicPropertyMap.set("_capType",function(a,b,c){return d.isFunction(g.cap)?g.cap(a,b,c):p});var m;d.isFunction(g.join)||
(m=g.join);f._dynamicPropertyMap.set("_joinType",function(a,b,c){return d.isFunction(g.join)?g.join(a,b,c):m});var q;if(!d.isFunction(g.color)){var r=g.color;q=r&&a.premultiplyAlphaRGBA(r)||0}f._dynamicPropertyMap.set("_fillColor",function(b,c,e){return d.isFunction(g.color)?(b=g.color(b,c,e))&&a.premultiplyAlphaRGBA(b)||0:q});var n;d.isFunction(g.miterLimit)||(n=d.getLimitCosine(g.miterLimit));f._dynamicPropertyMap.set("_miterLimitCosine",function(a,b,c){return d.isFunction(g.miterLimit)?d.getLimitCosine(g.miterLimit(a,
b,c)):n});f._isDashed=g.isDashed;f.tessellationProperties._bitset=g.colorLocked?1:0;f._materialKey=e.createMaterialKey(f.geometryType,c,g.isOutline);f._initializeTessellator(!0);return f}l(c,b);c.fromCIMLine=function(a,b){return new c(a,b)};c.prototype.bindFeature=function(a,b,c){var d=this,f=this._dynamicPropertyMap;f&&f.forEach(function(e,g){d[g]=e(a,b,c)});var f=this._materialCache,h=this._cimLineLayer.materialHash,h=h(a,b,c),h=f.get(h),f=null;h&&q.ok(h.spriteMosaicItem)&&(f=h.spriteMosaicItem);
if(f){this._hasPattern=!0;var h=f.rect,k=h.x+1+f.width,l=h.y+1+f.height;this.tessellationProperties._tl=g.i1616to32(h.x+1,h.y+1);this.tessellationProperties._br=g.i1616to32(k,l)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;h=e.LineMaterialKey.load(this._materialKey);f&&(h.sdf=f.sdf,h.pattern=!0,h.textureBinding=f.textureBinding);this._materialKey=h.data};return c}(f.default(c.default));
b.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/cim/cimAnalyzer ./WGLMeshTemplate".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});var e=k.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");n=function(b){function d(a){var c=b.call(this)||this;c._ongoingMaterialRequestMap=
new Map;c._materialCache=new Map;c._dynamicPropertyMap=new Map;c._cimLayer=a;return c}l(d,b);d.prototype.analyze=function(b,d,g,f){var c=this,k=this._materialCache,l=this._cimLayer.materialHash;if(!l)return e.error("A Dynamic mesh template must have a material hash function!"),h.reject(null);var p=l(d,g,f);if(k.has(p))return b=k.get(p),h.resolve(b);if(this._ongoingMaterialRequestMap.has(p))return this._ongoingMaterialRequestMap.get(p);d=a.analyzeCIMResource(d,this._cimLayer.cim,this._cimLayer.materialOverrides);
d.mosaicHash=p;b=b.getCIMMosaicItem(d).then(function(a){c._ongoingMaterialRequestMap.delete(p);k.set(p,a);return a}).catch(function(a){c._ongoingMaterialRequestMap.delete(p);e.error(".analyze()",a.message);return null});this._ongoingMaterialRequestMap.set(p,b);return b};return d}(g.default);b.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u){Object.defineProperty(b,"__esModule",{value:!0});var y=3.14159265359/180,m=f.vec2f32.create(),v=e.mat2df32.create(),z=h.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");n=function(b){function e(d,e){var g=b.call(this,e)||this;g._cimMarkerLayer=e;var f=0;t.isFunction(e.color)||(f=q.premultiplyAlphaRGBA(e.color));g._dynamicPropertyMap.set("_fillColor",function(a,b,c){return t.isFunction(e.color)?q.premultiplyAlphaRGBA(e.color(a,b,c)):f});
var h=0;t.isFunction(e.outlineColor)||(h=q.premultiplyAlphaRGBA(e.outlineColor));g._dynamicPropertyMap.set("_outlineColor",function(a,b,c){return t.isFunction(e.outlineColor)?q.premultiplyAlphaRGBA(e.outlineColor(a,b,c)):h});var k;t.isFunction(e.size)||(k=a.pt2px(e.size));g._dynamicPropertyMap.set("_size",function(b,c,d){return t.isFunction(e.size)?a.pt2px(e.size(b,c,d)):k});var m;t.isFunction(e.scaleX)||(m=e.scaleX);g._dynamicPropertyMap.set("_scaleX",function(a,b,c){return t.isFunction(e.scaleX)?
e.scaleX(a,b,c):m});var l;t.isFunction(e.offsetX)||(l=a.pt2px(e.offsetX));g._dynamicPropertyMap.set("xOffset",function(b,c,d){return t.isFunction(e.offsetX)?a.pt2px(e.offsetX(b,c,d)):l});var p;t.isFunction(e.offsetY)||(p=a.pt2px(e.offsetY));g._dynamicPropertyMap.set("yOffset",function(b,c,d){return t.isFunction(e.offsetY)?a.pt2px(e.offsetY(b,c,d)):p});var n;t.isFunction(e.outlineWidth)||(n=a.pt2px(e.outlineWidth));g._dynamicPropertyMap.set("_outlineWidth",function(b,c,d){return t.isFunction(e.outlineWidth)?
a.pt2px(e.outlineWidth(b,c,d)):n});var v;t.isFunction(e.rotation)||(v=e.rotation);g._dynamicPropertyMap.set("_angle",function(a,b,c){return t.isFunction(e.rotation)?e.rotation(a,b,c):v});g._bitSet=(e.alignment===c.Alignment.MAP?1:0)|(e.colorLocked?1:0)<<1|(e.scaleSymbolsProportionally?1:0)<<3;g._materialKey=r.createMaterialKey(g.geometryType,d,!1);return g}l(e,b);e.fromCIMMarker=function(a,b){return new e(a,b)};e.prototype.bindFeature=function(b,c,e){var h=this,l=this._dynamicPropertyMap;l&&l.forEach(function(a,
d){h[d]=a(b,c,e)});l=this._cimMarkerLayer.materialHash;l=l(b,c,e);if((l=this._materialCache.get(l))&&u.ok(l.spriteMosaicItem)&&l.spriteMosaicItem){var l=l.spriteMosaicItem,q=this._cimMarkerLayer.sizeRatio,n=l.width/l.height*this._scaleX,t=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,w=this._size,x=w*n,B=this.xOffset,C=this.yOffset,D=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/a.pt2px(this._cimMarkerLayer.frameHeight):1,I=this._outlineWidth*
D,K=a.pt2px(this._cimMarkerLayer.referenceSize),V=0,D=0,Z=this._cimMarkerLayer.anchorPoint;Z&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(V=-Z.x/(this._size*n),D=Z.y/this._size):(V=Z.x,D=Z.y));this._sizeOutlineWidth=p.i8888to32(Math.round(Math.sqrt(256*x)),Math.round(Math.sqrt(256*w)),Math.round(Math.sqrt(256*I)),Math.round(Math.sqrt(256*K)));g.mat2d.identity(v);g.mat2d.translate(v,v,f.vec2f32.fromValues(B,-C));t&&g.mat2d.rotate(v,v,y*t);n=l.rect.x;t=l.rect.y;B=n+l.rect.width;C=t+l.rect.height;
V=.5-((.5+V)*l.width+1)/l.rect.width;D=.5-((.5+D)*l.height+1)/l.rect.height;I=Math.round(64*q);x*=l.rect.width/l.width*q;w*=l.rect.height/l.height*q;q=(V-.5)*x;D=(D-.5)*w;this._bitestAndDistRatio=p.i8888to32(0,0,this._bitSet,I);d.vec2.set(m,q,D);d.vec2.transformMat2d(m,m,v);this._offsetUpperLeft=p.i1616to32(16*m[0],16*m[1]);this._texUpperLeft=p.i1616to32(n,t);d.vec2.set(m,q+x,D);d.vec2.transformMat2d(m,m,v);this._offsetUpperRight=p.i1616to32(16*m[0],16*m[1]);this._texUpperRight=p.i1616to32(B,t);d.vec2.set(m,
q,D+w);d.vec2.transformMat2d(m,m,v);this._offsetBottomLeft=p.i1616to32(16*m[0],16*m[1]);this._texBottomLeft=p.i1616to32(n,C);d.vec2.set(m,q+x,D+w);d.vec2.transformMat2d(m,m,v);this._offsetBottomRight=p.i1616to32(16*m[0],16*m[1]);this._texBottomRight=p.i1616to32(B,C);w=r.MarkerMaterialKey.load(this._materialKey);w.sdf=l.sdf;w.pattern=!0;w.textureBinding=l.textureBinding;this._materialKey=w.data}else z.error(new k("mapview-cim","Encountered an error when binding feature"))};return e}(x.default(w.default));
b.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../fontUtils ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../util/BidiText".split(" "),function(n,b,l,k,h,a,g,e,d,f,c,q){Object.defineProperty(b,"__esModule",{value:!0});var p=new Set;n=function(b){function c(c,f){var h=b.call(this,
f)||this;h._horizontalAlignment="center";h._verticalAlignment="middle";h._glyphs=[];h._cimTextLayer=f;var l=0;d.isFunction(f.color)||(l=a.premultiplyAlphaRGBA(f.color));h._dynamicPropertyMap.set("_color",function(b,c,e){return d.isFunction(f.color)?a.premultiplyAlphaRGBA(f.color(b,c,e)):l});var m=0;d.isFunction(f.color)||(m=a.premultiplyAlphaRGBA(f.outlineColor));h._dynamicPropertyMap.set("_haloColor",function(b,c,e){return d.isFunction(f.outlineColor)?a.premultiplyAlphaRGBA(f.outlineColor(b,c,e)):
m});var p;d.isFunction(f.size)||(p=Math.min(Math.round(k.pt2px(f.size*f.sizeRatio)),127));h._dynamicPropertyMap.set("_size",function(a,b,c){return d.isFunction(f.size)?Math.min(Math.round(k.pt2px(f.size(a,b,c)*f.sizeRatio)),127):p});var q;d.isFunction(f.outlineSize)||(q=Math.min(Math.floor(5*k.pt2px(f.outlineSize*f.sizeRatio)),127));h._dynamicPropertyMap.set("_haloSize",function(a,b,c){return d.isFunction(f.outlineSize)?Math.min(Math.floor(5*k.pt2px(f.outlineSize(a,b,c)*f.sizeRatio)),127):q});var r;
d.isFunction(f.offsetX)||(r=Math.round(k.pt2px(f.offsetX*f.sizeRatio)));h._dynamicPropertyMap.set("_xOffset",function(a,b,c){return d.isFunction(f.offsetX)?Math.round(k.pt2px(f.offsetX(a,b,c)*f.sizeRatio)):r});var n;d.isFunction(f.offsetY)||(n=Math.round(k.pt2px(f.offsetY*f.sizeRatio)));h._dynamicPropertyMap.set("_yOffset",function(a,b,c){return d.isFunction(f.offsetY)?Math.round(k.pt2px(f.offsetY(a,b,c)*f.sizeRatio)):n});var t;d.isFunction(f.decoration)||(t=g.getFontDecorationTop(f.decoration));
h._dynamicPropertyMap.set("_decorationTop",function(a,b,c){return d.isFunction(f.decoration)?g.getFontDecorationTop(f.decoration(a,b,c)):t});var w;d.isFunction(f.angle)||(w=f.angle);h._dynamicPropertyMap.set("_angle",function(a,b,c){return d.isFunction(f.angle)?f.angle(a,b,c):w});var x;d.isFunction(f.horizontalAlignment)||(x=f.horizontalAlignment);h._dynamicPropertyMap.set("_horizontalAlignment",function(a,b,c){return d.isFunction(f.horizontalAlignment)?f.horizontalAlignment(a,b,c):x});var Q;d.isFunction(f.verticalAlignment)||
(Q=f.verticalAlignment);h._dynamicPropertyMap.set("_verticalAlignment",function(a,b,c){return d.isFunction(f.verticalAlignment)?f.verticalAlignment(a,b,c):Q});var J;d.isFunction(f.text)||(J=f.text);h._dynamicPropertyMap.set("_text",function(a,b,c){return d.isFunction(f.text)?f.text(a,b,c):J});var N=Math.min(Math.round(k.pt2px(f.referenceSize*f.sizeRatio)),127);h._referenceSize=Math.round(Math.sqrt(256*N));h._materialKey=e.createMaterialKey(h.geometryType,c,!1);c=e.TextMaterialKey.load(h._materialKey);
c.sdf=!0;h._bitset=f.colorLocked?1:0;h._materialKey=c.data;return h}l(c,b);c.fromCIMText=function(a,b){return new c(a,b)};c.prototype.analyze=function(a,b,c,d){var e=this._cimTextLayer;b="string"===typeof e.text?e.text:"function"===typeof e.text?e.text(b,c,d):"";var f=this._glyphs;p.clear();for(c=0;c<b.length;c++)p.add(b.charCodeAt(c));var g=[];p.forEach(function(a){if(f.length<a||void 0===f[a])g[a]=a});return a.getCIMMosaicItem(e.cim,g).then(function(a){if(a.glyphMosaicItems&&0<a.glyphMosaicItems.length)for(var b=
a.glyphMosaicItems,c=0;c<b.length;c++)void 0!==b[c]&&(f[c]=b[c]);return a})};c.prototype.bindFeature=function(a,b,c){var d=this,e=this._dynamicPropertyMap;e&&e.forEach(function(e,f){d[f]=e(a,b,c)});if(this._text&&0!==this._text.length){this._scale=this._size/24;this._justify=h.getJustification(this._horizontalAlignment||"center");this._xAlignD=h.getXAnchorDirection(this._horizontalAlignment||"center");this._yAlignD=-h.getYAnchorDirection(this._verticalAlignment||"baseline");this._baseline="baseline"===
(this._verticalAlignment||"baseline");for(var e=this._glyphs,f=q.bidiText(this._text),g=f[0],f=f[1],k=[],l=0;l<g.length;l++)k[g.charCodeAt(l)]=e[g.charCodeAt(l)];this.bindTextInfo(k,g,f);this._computeGlyphs(this._shapedGlyphs,this._shapedBox)}else this._shapedBox=this._shapedGlyphs=this._computedGlyphs=null};return c}(f.default(c.default));b.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../../../../../core/libs/earcut/earcut ../../color ../../definitions ../../enums ../../number ../../TileClipper ../../WGLDisplayRecord ../../materialKey/MaterialKey ../Tesselator ./WGLMeshTemplate".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){Object.defineProperty(b,"__esModule",{value:!0});var w=k.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLFillTemplate"),u=[],y=[];n=function(b){function k(a,c,e,g,h,k,m,l,p){var n=b.call(this)||this;n.fillColor=e;n.tl=g;n.br=h;n.aux1=k;n.aux2=m;n.aux3=l;n.isBFS=p;n.geometryType=f.WGLGeometryType.FILL;n.forceLibtess=!1;a=r.FillMaterialKey.load(r.createMaterialKey(n.geometryType,a,!1));c&&(a.sdf=c.sdf,a.pattern=!0,a.textureBinding=c.textureBinding);
n._materialKey=a.data;n._tesselator=new t.default;n._tileClipper=new q.TileClipper(0,0,0,1,8);n._tileClipper.setExtent(d.TILE_SIZE);return n}l(k,b);k.fromCIMFill=function(b,d,f,g){void 0===g&&(g=!1);var m=d.color,m=m&&e.premultiplyAlphaRGBA(m)||0,l=c.i8888to32(0,0,0,d.colorLocked?1:0);if(!f)return new k(b,null,m,0,0,0,0,l,g);var l=f.rect,p=f.width,q=f.height,r=l.x+1,n=l.y+1,v=r+p,u=n+q,l=h.nextHighestPowerOfTwo(a.pt2px(d.height||0));255<l?l=255:0>=l&&(l=h.nextHighestPowerOfTwo(u-n));p=h.nextHighestPowerOfTwo(a.pt2px(d.height/
q*p||0));255<p?p=255:0>=p&&(p=h.nextHighestPowerOfTwo(v-r));q=a.pt2px(d.offsetX||0)+128;255<q&&(q=255);var t=a.pt2px(-d.offsetY||0)+128;255<t&&(t=255);d=d.scaleX||1;r=c.i1616to32(r,n);v=c.i1616to32(v,u);l=c.i8888to32(p,l,q,t);d=c.i1616to32(128*d,128);return new k(b,f,m,r,v,l,d,0,g)};k.fromSimpleFill=function(a,b,d,f){void 0===f&&(f=!1);var g=b.color;b=g&&"none"!==b.style&&e.premultiplyAlphaRGBA(g)||0;g=c.i8888to32(0,0,0,f?255:0);if(!d)return new k(a,null,b,0,0,0,0,g,f);var m=d.rect,l=m.x+1,p=m.y+
1,q=m.x+1+d.width,r=m.y+1+d.height,m=c.i1616to32(l,p),n=c.i1616to32(q,r),l=c.i8888to32(h.nextHighestPowerOfTwo(q-l),h.nextHighestPowerOfTwo(r-p),0,0),p=c.i1616to32(128,128);return new k(a,d,b,m,n,l,p,g,f)};k.fromPictureFill=function(b,e,f,g){void 0===g&&(g=!1);var m=d.PICTURE_FILL_COLOR,l=f.rect,p=l.x+1,q=l.y+1,l=p+f.width,r=q+f.height,p=c.i1616to32(p,q),l=c.i1616to32(l,r),r=h.nextHighestPowerOfTwo(a.pt2px(e.width));255<r&&(r=255);q=h.nextHighestPowerOfTwo(a.pt2px(e.height));255<q&&(q=255);var n=
a.pt2px(e.xoffset)+128;255<n&&(n=255);var v=a.pt2px(-e.yoffset)+128;255<v&&(v=255);r=c.i8888to32(r,q,n,v);e=c.i1616to32(128*e.xscale,128*e.yscale);q=c.i8888to32(0,0,0,g?255:0);return new k(b,f,m,p,l,r,e,q,g)};k.prototype.writeMesh=function(a,b,c,d,e){u.length=0;if("esriGeometryPolygon"!==c)"esriGeometryPolyline"!==c&&w.error("Unable to handle geometryType: "+c);else{var f=e.geometry;c=r.FillMaterialKey.load(this._materialKey);var g=(e=this._isClippingRequired(f))?this._clip(f,!1):f.rings;if(c.dotDensity){for(var f=
f.rings,h=0,k=0;k<f.length;k++)for(var m=f[k],l=m[0],p=l[0],l=l[1],q=1;q<m.length;q++)var n=m[q],v=p+n[0],n=l+n[1],h=h-(v-p)*(n+l)/2,p=v,l=n;f=h}else f=0;this.forceLibtess?this._writeMeshLibtess(a,b,d,g,e,c,f):this._writeMeshEarcut(a,b,d,g,e,c,f)||this._writeMeshLibtess(a,b,d,g,e,c,f)}};k.prototype._isClippingRequired=function(a){var b=d.TILE_SIZE+8,c=0;for(a=a.rings;c<a.length;c++){var e=a[c],f=e.length;if(!(3>f)){var g=e[0][0],h=e[0][1];if(-8>g||g>b||-8>h||h>b)return!0;for(var k=1;k<f;++k)if(g+=
e[k][0],h+=e[k][1],-8>g||g>b||-8>h||h>b)return!0}}return!1};k.prototype._clip=function(a,b){var c;this._tileClipper.reset(3);for(var d=0,e=a.rings;d<e.length;d++){var f=e[d],g=f.length;if(!(3>g)){a=f[0][0];c=f[0][1];this._tileClipper.moveTo(a,c);for(var h=1;h<g;++h)a+=f[h][0],c+=f[h][1],this._tileClipper.lineTo(a,c);this._tileClipper.close()}}return this._tileClipper.result(b)};k.prototype._writeMeshLibtess=function(a,b,c,d,e,f,g){if(d&&d.length){var h=[],k=b.indexVector;b=b.getVector("geometry");
var m=new p(c,this.geometryType,this._materialKey),l=b.vertexCount;m.vertexFrom=l;m.indexFrom=k.length;this._tesselator.beginPolygon(u,h);for(var q=0;q<d.length;q++){var r=d[q];if(!(3>r.length)){this._tesselator.beginContour();var n=void 0,v=void 0;e?(n=r[0].x,v=r[0].y):(n=r[0][0],v=r[0][1]);var t=[n,v,0];this._tesselator.addVertex(t,t);for(t=1;t<r.length-1;t++){var y=void 0,w=void 0;e?(n=r[t].x,v=r[t].y):(y=r[t][0],w=r[t][1],n+=y,v+=w);y=[n,v,0];this._tesselator.addVertex(y,y)}this._tesselator.endContour()}}this._tesselator.endPolygon();
this._writeVerticesLibTess(m,b,c,u,f,g);this._writeIndicesLibTess(m,k,l,h);0<m.indexCount&&a.push(m)}};k.prototype._writeMeshEarcut=function(a,b,c,d,e,f,g){if(d&&d.length){var h=b.indexVector;b=b.getVector("geometry");var k=new p(c,this.geometryType,this._materialKey),m=h.length,l=b.data.length;k.vertexFrom=b.vertexCount;k.indexFrom=h.length;for(var q=0,r=0,n=0;n<d.length;n++){var v=d[n],t=r,w=void 0,x=void 0;e?(w=v[0].x,x=v[0].y):(w=v[0][0],x=v[0][1]);u[r++]=w;u[r++]=x;for(var z=0,B=1;B<v.length;++B){var C=
void 0,D=void 0;e?(C=w,D=x,w=v[B].x,x=v[B].y,C=w-C,D=x-D):(C=v[B][0],D=v[B][1],w+=C,x+=D);z-=C*(x+x-D);u[r++]=w;u[r++]=x}if(0<z){if(0<t-q){if(!this._write(k,h,b,c,u,y,q,t,f,g))return h.seek(m),b.data.seek(l),u.length=y.length=0,!1;q=t}y.length=0}else 0>z?0<t-q?y.push(.5*(t-q)):r=t:r=t}if(0<r-q&&!this._write(k,h,b,c,u,y,q,r,f,g))return h.seek(m),b.data.seek(l),u.length=y.length=0,!1;u.length=y.length=0;a.push(k);return!0}};k.prototype._write=function(a,b,c,d,e,f,h,k,m,l){e=e.slice(h,k);h=g(e,f,2);
if(g.deviation(e,f,2,h))return!1;if(h.length)return f=c.vertexCount,this._writeVertices(a,c,d,e,m,l),this._writeIndices(a,b,f,h),!0};k.prototype._writeVertices=function(a,b,d,e,f,g){for(var h=0;h<e.length;h+=2){var k=c.i1616to32(e[h],e[h+1]);b.data.push(k);b.data.push(d);f.dotDensity?b.data.writeF32(1/g):(b.data.push(this.fillColor),b.data.push(this.tl),b.data.push(this.br),b.data.push(this.aux1),b.data.push(this.aux2),b.data.push(this.aux3));a.vertexCount++}};k.prototype._writeIndices=function(a,
b,c,d){for(var e=0;e<d.length;e+=3)b.push(c+d[e]),b.push(c+d[e+1]),b.push(c+d[e+2]),a.indexCount+=3};k.prototype._writeVerticesLibTess=function(a,b,d,e,f,g){for(var h=0;h<e.length;h+=2){var k=c.i1616to32(e[h],e[h+1]);b.data.push(k);b.data.push(d);f.dotDensity?b.data.writeF32(1/g):(b.data.push(this.fillColor),b.data.push(this.tl),b.data.push(this.br),b.data.push(this.aux1),b.data.push(this.aux2),b.data.push(this.aux3));a.vertexCount++}};k.prototype._writeIndicesLibTess=function(a,b,c,d){for(var e=
0;e<d.length;e++)b.push(c+d[e]),a.indexCount++};return k}(x.default);b.default=n})},"esri/views/2d/engine/webgl/mesh/Tesselator":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/libs/libtess/libtess"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});var h=l.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");n=function(){function a(){this._indexCounter=this._currentVertexIndex=0;this._triangleIndices=[-1,-1,-1];this.glu=new k.GluTesselator;
this.glu.gluTessCallback(k.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_END,this._endcallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this));
this.glu.gluTessProperty(k.gluEnum.GLU_TESS_WINDING_RULE,k.windingRule.GLU_TESS_WINDING_ODD)}a.prototype.beginPolygon=function(a,b){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._indexCounter=this._currentVertexIndex=0;this.glu.gluTessBeginPolygon(a);this._indices=b};a.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()};a.prototype.beginContour=function(){this.glu.gluTessBeginContour()};a.prototype.endContour=function(){this.glu.gluTessEndContour()};
a.prototype.addVertex=function(a,b){this.glu.gluTessVertex(a,b)};a.prototype._vertexCallback=function(a,b){b[b.length]=a[0];b[b.length]=a[1];this._triangleIndices[this._currentVertexIndex]=-1;if(2<=this._currentVertexIndex){for(a=0;3>a;a++)-1===this._triangleIndices[a]&&(this._triangleIndices[a]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[a];this._currentVertexIndex=0}else this._currentVertexIndex++};a.prototype._begincallback=function(a){this._triangleIndices[0]=
-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._currentVertexIndex=0};a.prototype._endcallback=function(){this._currentVertexIndex=0};a.prototype._errorcallback=function(a){h.error("Encountered error during tesselation: "+a)};a.prototype._combinecallback=function(a,b,d){return[a[0],a[1],a[2]]};a.prototype._edgeCallback=function(a){};return a}();b.default=n})},"esri/core/libs/libtess/libtess":function(){define([],function(){var n={DEBUG:!1,assert:function(b,l){if(n.DEBUG&&!b)throw Error("Assertion failed"+
(l?": "+l:""));},GLU_TESS_MAX_COORD:1E150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,
GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,
GLU_INVALID_VALUE:100901},geom:{}};n.geom.vertEq=function(b,l){return b.s===l.s&&b.t===l.t};n.geom.vertLeq=function(b,l){return b.s<l.s||b.s===l.s&&b.t<=l.t};n.geom.edgeEval=function(b,l,k){n.assert(n.geom.vertLeq(b,l)&&n.geom.vertLeq(l,k));var h=l.s-b.s,a=k.s-l.s;return 0<h+a?h<a?l.t-b.t+h/(h+a)*(b.t-k.t):l.t-k.t+a/(h+a)*(k.t-b.t):0};n.geom.edgeSign=function(b,l,k){n.assert(n.geom.vertLeq(b,l)&&n.geom.vertLeq(l,k));var h=l.s-b.s,a=k.s-l.s;return 0<h+a?(l.t-k.t)*h+(l.t-b.t)*a:0};n.geom.transLeq=function(b,
l){return b.t<l.t||b.t===l.t&&b.s<=l.s};n.geom.transEval=function(b,l,k){n.assert(n.geom.transLeq(b,l)&&n.geom.transLeq(l,k));var h=l.t-b.t,a=k.t-l.t;return 0<h+a?h<a?l.s-b.s+h/(h+a)*(b.s-k.s):l.s-k.s+a/(h+a)*(k.s-b.s):0};n.geom.transSign=function(b,l,k){n.assert(n.geom.transLeq(b,l)&&n.geom.transLeq(l,k));var h=l.t-b.t,a=k.t-l.t;return 0<h+a?(l.s-k.s)*h+(l.s-b.s)*a:0};n.geom.edgeGoesLeft=function(b){return n.geom.vertLeq(b.dst(),b.org)};n.geom.edgeGoesRight=function(b){return n.geom.vertLeq(b.org,
b.dst())};n.geom.vertL1dist=function(b,l){return Math.abs(b.s-l.s)+Math.abs(b.t-l.t)};n.geom.vertCCW=function(b,l,k){return 0<=b.s*(l.t-k.t)+l.s*(k.t-b.t)+k.s*(b.t-l.t)};n.geom.interpolate_=function(b,l,k,h){b=0>b?0:b;k=0>k?0:k;return b<=k?0===k?(l+h)/2:l+b/(b+k)*(h-l):h+k/(b+k)*(l-h)};n.geom.edgeIntersect=function(b,l,k,h,a){var g,e;n.geom.vertLeq(b,l)||(g=b,b=l,l=g);n.geom.vertLeq(k,h)||(g=k,k=h,h=g);n.geom.vertLeq(b,k)||(g=b,b=k,k=g,g=l,l=h,h=g);n.geom.vertLeq(k,l)?n.geom.vertLeq(l,h)?(g=n.geom.edgeEval(b,
k,l),e=n.geom.edgeEval(k,l,h),0>g+e&&(g=-g,e=-e),a.s=n.geom.interpolate_(g,k.s,e,l.s)):(g=n.geom.edgeSign(b,k,l),e=-n.geom.edgeSign(b,h,l),0>g+e&&(g=-g,e=-e),a.s=n.geom.interpolate_(g,k.s,e,h.s)):a.s=(k.s+l.s)/2;n.geom.transLeq(b,l)||(g=b,b=l,l=g);n.geom.transLeq(k,h)||(g=k,k=h,h=g);n.geom.transLeq(b,k)||(g=b,b=k,k=g,g=l,l=h,h=g);n.geom.transLeq(k,l)?n.geom.transLeq(l,h)?(g=n.geom.transEval(b,k,l),e=n.geom.transEval(k,l,h),0>g+e&&(g=-g,e=-e),a.t=n.geom.interpolate_(g,k.t,e,l.t)):(g=n.geom.transSign(b,
k,l),e=-n.geom.transSign(b,h,l),0>g+e&&(g=-g,e=-e),a.t=n.geom.interpolate_(g,k.t,e,h.t)):a.t=(k.t+l.t)/2};n.mesh={};n.mesh.makeEdge=function(b){var l=n.mesh.makeEdgePair_(b.eHead);n.mesh.makeVertex_(l,b.vHead);n.mesh.makeVertex_(l.sym,b.vHead);n.mesh.makeFace_(l,b.fHead);return l};n.mesh.meshSplice=function(b,l){var k=!1,h=!1;b!==l&&(l.org!==b.org&&(h=!0,n.mesh.killVertex_(l.org,b.org)),l.lFace!==b.lFace&&(k=!0,n.mesh.killFace_(l.lFace,b.lFace)),n.mesh.splice_(l,b),h||(n.mesh.makeVertex_(l,b.org),
b.org.anEdge=b),k||(n.mesh.makeFace_(l,b.lFace),b.lFace.anEdge=b))};n.mesh.deleteEdge=function(b){var l=b.sym,k=!1;b.lFace!==b.rFace()&&(k=!0,n.mesh.killFace_(b.lFace,b.rFace()));b.oNext===b?n.mesh.killVertex_(b.org,null):(b.rFace().anEdge=b.oPrev(),b.org.anEdge=b.oNext,n.mesh.splice_(b,b.oPrev()),k||n.mesh.makeFace_(b,b.lFace));l.oNext===l?(n.mesh.killVertex_(l.org,null),n.mesh.killFace_(l.lFace,null)):(b.lFace.anEdge=l.oPrev(),l.org.anEdge=l.oNext,n.mesh.splice_(l,l.oPrev()));n.mesh.killEdge_(b)};
n.mesh.addEdgeVertex=function(b){var l=n.mesh.makeEdgePair_(b),k=l.sym;n.mesh.splice_(l,b.lNext);l.org=b.dst();n.mesh.makeVertex_(k,l.org);l.lFace=k.lFace=b.lFace;return l};n.mesh.splitEdge=function(b){var l=n.mesh.addEdgeVertex(b).sym;n.mesh.splice_(b.sym,b.sym.oPrev());n.mesh.splice_(b.sym,l);b.sym.org=l.org;l.dst().anEdge=l.sym;l.sym.lFace=b.rFace();l.winding=b.winding;l.sym.winding=b.sym.winding;return l};n.mesh.connect=function(b,l){var k=!1,h=n.mesh.makeEdgePair_(b),a=h.sym;l.lFace!==b.lFace&&
(k=!0,n.mesh.killFace_(l.lFace,b.lFace));n.mesh.splice_(h,b.lNext);n.mesh.splice_(a,l);h.org=b.dst();a.org=l.org;h.lFace=a.lFace=b.lFace;b.lFace.anEdge=a;k||n.mesh.makeFace_(h,b.lFace);return h};n.mesh.zapFace=function(b){var l=b.anEdge,k=l.lNext,h;do if(h=k,k=h.lNext,h.lFace=null,null===h.rFace()){h.oNext===h?n.mesh.killVertex_(h.org,null):(h.org.anEdge=h.oNext,n.mesh.splice_(h,h.oPrev()));var a=h.sym;a.oNext===a?n.mesh.killVertex_(a.org,null):(a.org.anEdge=a.oNext,n.mesh.splice_(a,a.oPrev()));n.mesh.killEdge_(h)}while(h!==
l);l=b.prev;b=b.next;b.prev=l;l.next=b};n.mesh.meshUnion=function(b,l){var k=b.fHead,h=b.vHead,a=b.eHead,g=l.fHead,e=l.vHead;l=l.eHead;g.next!==g&&(k.prev.next=g.next,g.next.prev=k.prev,g.prev.next=k,k.prev=g.prev);e.next!==e&&(h.prev.next=e.next,e.next.prev=h.prev,e.prev.next=h,h.prev=e.prev);l.next!==l&&(a.sym.next.sym.next=l.next,l.next.sym.next=a.sym.next,l.sym.next.sym.next=a,a.sym.next=l.sym.next);return b};n.mesh.deleteMesh=function(b){};n.mesh.makeEdgePair_=function(b){var l=new n.GluHalfEdge,
k=new n.GluHalfEdge,h=b.sym.next;k.next=h;h.sym.next=l;l.next=b;b.sym.next=k;l.sym=k;l.oNext=l;l.lNext=k;k.sym=l;k.oNext=k;return k.lNext=l};n.mesh.splice_=function(b,l){var k=b.oNext,h=l.oNext;k.sym.lNext=l;h.sym.lNext=b;b.oNext=h;l.oNext=k};n.mesh.makeVertex_=function(b,l){var k=l.prev,h=new n.GluVertex(l,k);k.next=h;l.prev=h;l=h.anEdge=b;do l.org=h,l=l.oNext;while(l!==b)};n.mesh.makeFace_=function(b,l){var k=l.prev,h=new n.GluFace(l,k);k.next=h;l.prev=h;h.anEdge=b;h.inside=l.inside;l=b;do l.lFace=
h,l=l.lNext;while(l!==b)};n.mesh.killEdge_=function(b){var l=b.next;b=b.sym.next;l.sym.next=b;b.sym.next=l};n.mesh.killVertex_=function(b,l){var k=b.anEdge,h=k;do h.org=l,h=h.oNext;while(h!==k);l=b.prev;b=b.next;b.prev=l;l.next=b};n.mesh.killFace_=function(b,l){var k=b.anEdge,h=k;do h.lFace=l,h=h.lNext;while(h!==k);l=b.prev;b=b.next;b.prev=l;l.next=b};n.normal={};n.normal.S_UNIT_X_=1;n.normal.S_UNIT_Y_=0;n.normal.projectPolygon=function(b,l,k,h){var a=!1,g=[l,k,h];0===l&&0===k&&0===h&&(n.normal.computeNormal_(b,
g),a=!0);k=n.normal.longAxis_(g);l=b.mesh.vHead;if(n.TRUE_PROJECT){n.normal.normalize_(g);h=[0,0,0];var e=[0,0,0];h[k]=0;h[(k+1)%3]=n.normal.S_UNIT_X_;h[(k+2)%3]=n.normal.S_UNIT_Y_;k=n.normal.dot_(h,g);h[0]-=k*g[0];h[1]-=k*g[1];h[2]-=k*g[2];n.normal.normalize_(h);e[0]=g[1]*h[2]-g[2]*h[1];e[1]=g[2]*h[0]-g[0]*h[2];e[2]=g[0]*h[1]-g[1]*h[0];n.normal.normalize_(e);for(g=l.next;g!==l;g=g.next)g.s=n.normal.dot_(g.coords,h),g.t=n.normal.dot_(g.coords,e)}else for(h=(k+1)%3,e=(k+2)%3,k=0<g[k]?1:-1,g=l.next;g!==
l;g=g.next)g.s=g.coords[h],g.t=k*g.coords[e];a&&n.normal.checkOrientation_(b)};n.normal.dot_=function(b,l){return b[0]*l[0]+b[1]*l[1]+b[2]*l[2]};n.normal.normalize_=function(b){var l=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];n.assert(0<l);l=Math.sqrt(l);b[0]/=l;b[1]/=l;b[2]/=l};n.normal.longAxis_=function(b){var l=0;Math.abs(b[1])>Math.abs(b[0])&&(l=1);Math.abs(b[2])>Math.abs(b[l])&&(l=2);return l};n.normal.computeNormal_=function(b,l){var k=[-2*n.GLU_TESS_MAX_COORD,-2*n.GLU_TESS_MAX_COORD,-2*n.GLU_TESS_MAX_COORD],
h=[2*n.GLU_TESS_MAX_COORD,2*n.GLU_TESS_MAX_COORD,2*n.GLU_TESS_MAX_COORD],a=[],g=[],e;b=b.mesh.vHead;for(e=b.next;e!==b;e=e.next)for(var d=0;3>d;++d){var f=e.coords[d];f<h[d]&&(h[d]=f,g[d]=e);f>k[d]&&(k[d]=f,a[d]=e)}e=0;k[1]-h[1]>k[0]-h[0]&&(e=1);k[2]-h[2]>k[e]-h[e]&&(e=2);if(h[e]>=k[e])l[0]=0,l[1]=0,l[2]=1;else{k=0;h=g[e];a=a[e];g=[0,0,0];h=[h.coords[0]-a.coords[0],h.coords[1]-a.coords[1],h.coords[2]-a.coords[2]];d=[0,0,0];for(e=b.next;e!==b;e=e.next)d[0]=e.coords[0]-a.coords[0],d[1]=e.coords[1]-
a.coords[1],d[2]=e.coords[2]-a.coords[2],g[0]=h[1]*d[2]-h[2]*d[1],g[1]=h[2]*d[0]-h[0]*d[2],g[2]=h[0]*d[1]-h[1]*d[0],f=g[0]*g[0]+g[1]*g[1]+g[2]*g[2],f>k&&(k=f,l[0]=g[0],l[1]=g[1],l[2]=g[2]);0>=k&&(l[0]=l[1]=l[2]=0,l[n.normal.longAxis_(h)]=1)}};n.normal.checkOrientation_=function(b){for(var l=0,k=b.mesh.fHead,h=k.next;h!==k;h=h.next){var a=h.anEdge;if(!(0>=a.winding)){do l+=(a.org.s-a.dst().s)*(a.org.t+a.dst().t),a=a.lNext;while(a!==h.anEdge)}}if(0>l)for(b=b.mesh.vHead,l=b.next;l!==b;l=l.next)l.t=-l.t};
n.render={};n.render.renderMesh=function(b,l,k){for(var h=!1,a=-1,g=l.fHead.prev;g!==l.fHead;g=g.prev)if(g.inside){h||(b.callBeginCallback(n.primitiveType.GL_TRIANGLES),h=!0);var e=g.anEdge;n.assert(e.lNext.lNext.lNext===e,"renderMesh called with non-triangulated mesh");do{if(k){var d=e.rFace().inside?0:1;a!==d&&(a=d,b.callEdgeFlagCallback(!!a))}b.callVertexCallback(e.org.data);e=e.lNext}while(e!==g.anEdge)}h&&b.callEndCallback()};n.render.renderBoundary=function(b,l){for(var k=l.fHead.next;k!==l.fHead;k=
k.next)if(k.inside){b.callBeginCallback(n.primitiveType.GL_LINE_LOOP);var h=k.anEdge;do b.callVertexCallback(h.org.data),h=h.lNext;while(h!==k.anEdge);b.callEndCallback()}};n.sweep={};n.sweep.SENTINEL_COORD_=4*n.GLU_TESS_MAX_COORD;n.sweep.TOLERANCE_NONZERO_=!1;n.sweep.computeInterior=function(b){b.fatalError=!1;n.sweep.removeDegenerateEdges_(b);n.sweep.initPriorityQ_(b);n.sweep.initEdgeDict_(b);for(var l;null!==(l=b.pq.extractMin());){for(;;){var k=b.pq.minimum();if(null===k||!n.geom.vertEq(k,l))break;
k=b.pq.extractMin();n.sweep.spliceMergeVertices_(b,l.anEdge,k.anEdge)}n.sweep.sweepEvent_(b,l)}l=b.dict.getMin().getKey();b.event=l.eUp.org;n.sweep.doneEdgeDict_(b);n.sweep.donePriorityQ_(b);n.sweep.removeDegenerateFaces_(b.mesh);b.mesh.checkMesh()};n.sweep.addWinding_=function(b,l){b.winding+=l.winding;b.sym.winding+=l.sym.winding};n.sweep.edgeLeq_=function(b,l,k){b=b.event;l=l.eUp;k=k.eUp;if(l.dst()===b)return k.dst()===b?n.geom.vertLeq(l.org,k.org)?0>=n.geom.edgeSign(k.dst(),l.org,k.org):0<=n.geom.edgeSign(l.dst(),
k.org,l.org):0>=n.geom.edgeSign(k.dst(),b,k.org);if(k.dst()===b)return 0<=n.geom.edgeSign(l.dst(),b,l.org);l=n.geom.edgeEval(l.dst(),b,l.org);b=n.geom.edgeEval(k.dst(),b,k.org);return l>=b};n.sweep.deleteRegion_=function(b,l){l.fixUpperEdge&&n.assert(0===l.eUp.winding);l.eUp.activeRegion=null;b.dict.deleteNode(l.nodeUp);l.nodeUp=null};n.sweep.fixUpperEdge_=function(b,l){n.assert(b.fixUpperEdge);n.mesh.deleteEdge(b.eUp);b.fixUpperEdge=!1;b.eUp=l;l.activeRegion=b};n.sweep.topLeftRegion_=function(b){var l=
b.eUp.org;do b=b.regionAbove();while(b.eUp.org===l);b.fixUpperEdge&&(l=n.mesh.connect(b.regionBelow().eUp.sym,b.eUp.lNext),n.sweep.fixUpperEdge_(b,l),b=b.regionAbove());return b};n.sweep.topRightRegion_=function(b){var l=b.eUp.dst();do b=b.regionAbove();while(b.eUp.dst()===l);return b};n.sweep.addRegionBelow_=function(b,l,k){var h=new n.ActiveRegion;h.eUp=k;h.nodeUp=b.dict.insertBefore(l.nodeUp,h);return k.activeRegion=h};n.sweep.isWindingInside_=function(b,l){switch(b.windingRule){case n.windingRule.GLU_TESS_WINDING_ODD:return 0!==
(l&1);case n.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==l;case n.windingRule.GLU_TESS_WINDING_POSITIVE:return 0<l;case n.windingRule.GLU_TESS_WINDING_NEGATIVE:return 0>l;case n.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return 2<=l||-2>=l}n.assert(!1);return!1};n.sweep.computeWinding_=function(b,l){l.windingNumber=l.regionAbove().windingNumber+l.eUp.winding;l.inside=n.sweep.isWindingInside_(b,l.windingNumber)};n.sweep.finishRegion_=function(b,l){var k=l.eUp,h=k.lFace;h.inside=l.inside;h.anEdge=
k;n.sweep.deleteRegion_(b,l)};n.sweep.finishLeftRegions_=function(b,l,k){var h=l;for(l=l.eUp;h!==k;){h.fixUpperEdge=!1;var a=h.regionBelow(),g=a.eUp;if(g.org!==l.org){if(!a.fixUpperEdge){n.sweep.finishRegion_(b,h);break}g=n.mesh.connect(l.lPrev(),g.sym);n.sweep.fixUpperEdge_(a,g)}l.oNext!==g&&(n.mesh.meshSplice(g.oPrev(),g),n.mesh.meshSplice(l,g));n.sweep.finishRegion_(b,h);l=a.eUp;h=a}return l};n.sweep.addRightEdges_=function(b,l,k,h,a,g){var e=!0;do n.assert(n.geom.vertLeq(k.org,k.dst())),n.sweep.addRegionBelow_(b,
l,k.sym),k=k.oNext;while(k!==h);for(null===a&&(a=l.regionBelow().eUp.rPrev());;){h=l.regionBelow();k=h.eUp.sym;if(k.org!==a.org)break;k.oNext!==a&&(n.mesh.meshSplice(k.oPrev(),k),n.mesh.meshSplice(a.oPrev(),k));h.windingNumber=l.windingNumber-k.winding;h.inside=n.sweep.isWindingInside_(b,h.windingNumber);l.dirty=!0;!e&&n.sweep.checkForRightSplice_(b,l)&&(n.sweep.addWinding_(k,a),n.sweep.deleteRegion_(b,l),n.mesh.deleteEdge(a));e=!1;l=h;a=k}l.dirty=!0;n.assert(l.windingNumber-k.winding===h.windingNumber);
g&&n.sweep.walkDirtyRegions_(b,l)};n.sweep.callCombine_=function(b,l,k,h,a){var g=[l.coords[0],l.coords[1],l.coords[2]];l.data=null;l.data=b.callCombineCallback(g,k,h);null===l.data&&(a?b.fatalError||(b.callErrorCallback(n.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),b.fatalError=!0):l.data=k[0])};n.sweep.spliceMergeVertices_=function(b,l,k){var h=[null,null,null,null];h[0]=l.org.data;h[1]=k.org.data;n.sweep.callCombine_(b,l.org,h,[.5,.5,0,0],!1);n.mesh.meshSplice(l,k)};n.sweep.vertexWeights_=function(b,
l,k,h,a){var g=n.geom.vertL1dist(l,b),e=n.geom.vertL1dist(k,b),d=a+1;h[a]=.5*e/(g+e);h[d]=.5*g/(g+e);b.coords[0]+=h[a]*l.coords[0]+h[d]*k.coords[0];b.coords[1]+=h[a]*l.coords[1]+h[d]*k.coords[1];b.coords[2]+=h[a]*l.coords[2]+h[d]*k.coords[2]};n.sweep.getIntersectData_=function(b,l,k,h,a,g){var e=[0,0,0,0],d=[k.data,h.data,a.data,g.data];l.coords[0]=l.coords[1]=l.coords[2]=0;n.sweep.vertexWeights_(l,k,h,e,0);n.sweep.vertexWeights_(l,a,g,e,2);n.sweep.callCombine_(b,l,d,e,!0)};n.sweep.checkForRightSplice_=
function(b,l){var k=l.regionBelow(),h=l.eUp,a=k.eUp;if(n.geom.vertLeq(h.org,a.org)){if(0<n.geom.edgeSign(a.dst(),h.org,a.org))return!1;n.geom.vertEq(h.org,a.org)?h.org!==a.org&&(b.pq.remove(h.org.pqHandle),n.sweep.spliceMergeVertices_(b,a.oPrev(),h)):(n.mesh.splitEdge(a.sym),n.mesh.meshSplice(h,a.oPrev()),l.dirty=k.dirty=!0)}else{if(0>n.geom.edgeSign(h.dst(),a.org,h.org))return!1;l.regionAbove().dirty=l.dirty=!0;n.mesh.splitEdge(h.sym);n.mesh.meshSplice(a.oPrev(),h)}return!0};n.sweep.checkForLeftSplice_=
function(b,l){var k=l.regionBelow();b=l.eUp;var h=k.eUp;n.assert(!n.geom.vertEq(b.dst(),h.dst()));if(n.geom.vertLeq(b.dst(),h.dst())){if(0>n.geom.edgeSign(b.dst(),h.dst(),b.org))return!1;l.regionAbove().dirty=l.dirty=!0;k=n.mesh.splitEdge(b);n.mesh.meshSplice(h.sym,k);k.lFace.inside=l.inside}else{if(0<n.geom.edgeSign(h.dst(),b.dst(),h.org))return!1;l.dirty=k.dirty=!0;k=n.mesh.splitEdge(h);n.mesh.meshSplice(b.lNext,h.sym);k.rFace().inside=l.inside}return!0};n.sweep.checkForIntersect_=function(b,l){var k=
l.regionBelow(),h=l.eUp,a=k.eUp,g=h.org,e=a.org,d=h.dst(),f=a.dst(),c=new n.GluVertex;n.assert(!n.geom.vertEq(f,d));n.assert(0>=n.geom.edgeSign(d,b.event,g));n.assert(0<=n.geom.edgeSign(f,b.event,e));n.assert(g!==b.event&&e!==b.event);n.assert(!l.fixUpperEdge&&!k.fixUpperEdge);if(g===e||Math.min(g.t,d.t)>Math.max(e.t,f.t))return!1;if(n.geom.vertLeq(g,e)){if(0<n.geom.edgeSign(f,g,e))return!1}else if(0>n.geom.edgeSign(d,e,g))return!1;n.geom.edgeIntersect(d,g,f,e,c);n.assert(Math.min(g.t,d.t)<=c.t);
n.assert(c.t<=Math.max(e.t,f.t));n.assert(Math.min(f.s,d.s)<=c.s);n.assert(c.s<=Math.max(e.s,g.s));n.geom.vertLeq(c,b.event)&&(c.s=b.event.s,c.t=b.event.t);var q=n.geom.vertLeq(g,e)?g:e;n.geom.vertLeq(q,c)&&(c.s=q.s,c.t=q.t);if(n.geom.vertEq(c,g)||n.geom.vertEq(c,e))return n.sweep.checkForRightSplice_(b,l),!1;if(!n.geom.vertEq(d,b.event)&&0<=n.geom.edgeSign(d,b.event,c)||!n.geom.vertEq(f,b.event)&&0>=n.geom.edgeSign(f,b.event,c)){if(f===b.event)return n.mesh.splitEdge(h.sym),n.mesh.meshSplice(a.sym,
h),l=n.sweep.topLeftRegion_(l),h=l.regionBelow().eUp,n.sweep.finishLeftRegions_(b,l.regionBelow(),k),n.sweep.addRightEdges_(b,l,h.oPrev(),h,h,!0),!0;if(d===b.event)return n.mesh.splitEdge(a.sym),n.mesh.meshSplice(h.lNext,a.oPrev()),k=l,l=n.sweep.topRightRegion_(l),g=l.regionBelow().eUp.rPrev(),k.eUp=a.oPrev(),a=n.sweep.finishLeftRegions_(b,k,null),n.sweep.addRightEdges_(b,l,a.oNext,h.rPrev(),g,!0),!0;0<=n.geom.edgeSign(d,b.event,c)&&(l.regionAbove().dirty=l.dirty=!0,n.mesh.splitEdge(h.sym),h.org.s=
b.event.s,h.org.t=b.event.t);0>=n.geom.edgeSign(f,b.event,c)&&(l.dirty=k.dirty=!0,n.mesh.splitEdge(a.sym),a.org.s=b.event.s,a.org.t=b.event.t);return!1}n.mesh.splitEdge(h.sym);n.mesh.splitEdge(a.sym);n.mesh.meshSplice(a.oPrev(),h);h.org.s=c.s;h.org.t=c.t;h.org.pqHandle=b.pq.insert(h.org);n.sweep.getIntersectData_(b,h.org,g,d,e,f);l.regionAbove().dirty=l.dirty=k.dirty=!0;return!1};n.sweep.walkDirtyRegions_=function(b,l){for(var k=l.regionBelow();;){for(;k.dirty;)l=k,k=k.regionBelow();if(!l.dirty&&
(k=l,l=l.regionAbove(),null===l||!l.dirty))break;l.dirty=!1;var h=l.eUp,a=k.eUp;h.dst()!==a.dst()&&n.sweep.checkForLeftSplice_(b,l)&&(k.fixUpperEdge?(n.sweep.deleteRegion_(b,k),n.mesh.deleteEdge(a),k=l.regionBelow(),a=k.eUp):l.fixUpperEdge&&(n.sweep.deleteRegion_(b,l),n.mesh.deleteEdge(h),l=k.regionAbove(),h=l.eUp));if(h.org!==a.org)if(h.dst()===a.dst()||l.fixUpperEdge||k.fixUpperEdge||h.dst()!==b.event&&a.dst()!==b.event)n.sweep.checkForRightSplice_(b,l);else if(n.sweep.checkForIntersect_(b,l))break;
h.org===a.org&&h.dst()===a.dst()&&(n.sweep.addWinding_(a,h),n.sweep.deleteRegion_(b,l),n.mesh.deleteEdge(h),l=k.regionAbove())}};n.sweep.connectRightVertex_=function(b,l,k){var h=k.oNext,a=l.regionBelow(),g=l.eUp,e=a.eUp,d=!1;g.dst()!==e.dst()&&n.sweep.checkForIntersect_(b,l);n.geom.vertEq(g.org,b.event)&&(n.mesh.meshSplice(h.oPrev(),g),l=n.sweep.topLeftRegion_(l),h=l.regionBelow().eUp,n.sweep.finishLeftRegions_(b,l.regionBelow(),a),d=!0);n.geom.vertEq(e.org,b.event)&&(n.mesh.meshSplice(k,e.oPrev()),
k=n.sweep.finishLeftRegions_(b,a,null),d=!0);d?n.sweep.addRightEdges_(b,l,k.oNext,h,h,!0):(h=n.geom.vertLeq(e.org,g.org)?e.oPrev():g,h=n.mesh.connect(k.lPrev(),h),n.sweep.addRightEdges_(b,l,h,h.oNext,h.oNext,!1),h.sym.activeRegion.fixUpperEdge=!0,n.sweep.walkDirtyRegions_(b,l))};n.sweep.connectLeftDegenerate_=function(b,l,k){var h=l.eUp;if(n.geom.vertEq(h.org,k))n.assert(n.sweep.TOLERANCE_NONZERO_),n.sweep.TOLERANCE_NONZERO_&&n.sweep.spliceMergeVertices_(b,h,k.anEdge);else if(n.geom.vertEq(h.dst(),
k)){if(n.assert(n.sweep.TOLERANCE_NONZERO_),n.sweep.TOLERANCE_NONZERO_){l=n.sweep.topRightRegion_(l);var h=l.regionBelow(),a=h.eUp.sym,g=a.oNext,e=g;h.fixUpperEdge&&(n.assert(g!==a),n.sweep.deleteRegion_(b,h),n.mesh.deleteEdge(a),a=g.oPrev());n.mesh.meshSplice(k.anEdge,a);n.geom.edgeGoesLeft(g)||(g=null);n.sweep.addRightEdges_(b,l,a.oNext,e,g,!0)}}else n.mesh.splitEdge(h.sym),l.fixUpperEdge&&(n.mesh.deleteEdge(h.oNext),l.fixUpperEdge=!1),n.mesh.meshSplice(k.anEdge,h),n.sweep.sweepEvent_(b,k)};n.sweep.connectLeftVertex_=
function(b,l){var k=new n.ActiveRegion;k.eUp=l.anEdge.sym;var k=b.dict.search(k).getKey(),h=k.regionBelow(),a=k.eUp,g=h.eUp;0===n.geom.edgeSign(a.dst(),l,a.org)?n.sweep.connectLeftDegenerate_(b,k,l):(h=n.geom.vertLeq(g.dst(),a.dst())?k:h,k.inside||h.fixUpperEdge?(a=h===k?n.mesh.connect(l.anEdge.sym,a.lNext):n.mesh.connect(g.dNext(),l.anEdge).sym,h.fixUpperEdge?n.sweep.fixUpperEdge_(h,a):n.sweep.computeWinding_(b,n.sweep.addRegionBelow_(b,k,a)),n.sweep.sweepEvent_(b,l)):n.sweep.addRightEdges_(b,k,
l.anEdge,l.anEdge,null,!0))};n.sweep.sweepEvent_=function(b,l){b.event=l;for(var k=l.anEdge;null===k.activeRegion;)if(k=k.oNext,k===l.anEdge){n.sweep.connectLeftVertex_(b,l);return}l=n.sweep.topLeftRegion_(k.activeRegion);var h=l.regionBelow(),k=h.eUp,h=n.sweep.finishLeftRegions_(b,h,null);h.oNext===k?n.sweep.connectRightVertex_(b,l,h):n.sweep.addRightEdges_(b,l,h.oNext,k,k,!0)};n.sweep.addSentinel_=function(b,l){var k=new n.ActiveRegion,h=n.mesh.makeEdge(b.mesh);h.org.s=n.sweep.SENTINEL_COORD_;h.org.t=
l;h.dst().s=-n.sweep.SENTINEL_COORD_;h.dst().t=l;b.event=h.dst();k.eUp=h;k.windingNumber=0;k.inside=!1;k.fixUpperEdge=!1;k.sentinel=!0;k.dirty=!1;k.nodeUp=b.dict.insert(k)};n.sweep.initEdgeDict_=function(b){b.dict=new n.Dict(b,n.sweep.edgeLeq_);n.sweep.addSentinel_(b,-n.sweep.SENTINEL_COORD_);n.sweep.addSentinel_(b,n.sweep.SENTINEL_COORD_)};n.sweep.doneEdgeDict_=function(b){for(var l=0,k;null!==(k=b.dict.getMin().getKey());)k.sentinel||(n.assert(k.fixUpperEdge),n.assert(1===++l)),n.assert(0===k.windingNumber),
n.sweep.deleteRegion_(b,k);b.dict=null};n.sweep.removeDegenerateEdges_=function(b){for(var l=b.mesh.eHead,k,h=l.next;h!==l;h=k){k=h.next;var a=h.lNext;n.geom.vertEq(h.org,h.dst())&&h.lNext.lNext!==h&&(n.sweep.spliceMergeVertices_(b,a,h),n.mesh.deleteEdge(h),h=a,a=h.lNext);if(a.lNext===h){if(a!==h){if(a===k||a===k.sym)k=k.next;n.mesh.deleteEdge(a)}if(h===k||h===k.sym)k=k.next;n.mesh.deleteEdge(h)}}};n.sweep.initPriorityQ_=function(b){var l=new n.PriorityQ;b.pq=l;b=b.mesh.vHead;var k;for(k=b.next;k!==
b;k=k.next)k.pqHandle=l.insert(k);l.init()};n.sweep.donePriorityQ_=function(b){b.pq.deleteQ();b.pq=null};n.sweep.removeDegenerateFaces_=function(b){for(var l,k=b.fHead.next;k!==b.fHead;k=l)l=k.next,k=k.anEdge,n.assert(k.lNext!==k),k.lNext.lNext===k&&(n.sweep.addWinding_(k.oNext,k),n.mesh.deleteEdge(k))};n.tessmono={};n.tessmono.tessellateMonoRegion_=function(b){b=b.anEdge;for(n.assert(b.lNext!==b&&b.lNext.lNext!==b);n.geom.vertLeq(b.dst(),b.org);b=b.lPrev());for(;n.geom.vertLeq(b.org,b.dst());b=b.lNext);
for(var l=b.lPrev(),k;b.lNext!==l;)if(n.geom.vertLeq(b.dst(),l.org)){for(;l.lNext!==b&&(n.geom.edgeGoesLeft(l.lNext)||0>=n.geom.edgeSign(l.org,l.dst(),l.lNext.dst()));)k=n.mesh.connect(l.lNext,l),l=k.sym;l=l.lPrev()}else{for(;l.lNext!==b&&(n.geom.edgeGoesRight(b.lPrev())||0<=n.geom.edgeSign(b.dst(),b.org,b.lPrev().org));)k=n.mesh.connect(b,b.lPrev()),b=k.sym;b=b.lNext}for(n.assert(l.lNext!==b);l.lNext.lNext!==b;)k=n.mesh.connect(l.lNext,l),l=k.sym};n.tessmono.tessellateInterior=function(b){for(var l,
k=b.fHead.next;k!==b.fHead;k=l)l=k.next,k.inside&&n.tessmono.tessellateMonoRegion_(k)};n.tessmono.discardExterior=function(b){for(var l,k=b.fHead.next;k!==b.fHead;k=l)l=k.next,k.inside||n.mesh.zapFace(k)};n.tessmono.setWindingNumber=function(b,l,k){for(var h,a=b.eHead.next;a!==b.eHead;a=h)h=a.next,a.rFace().inside!==a.lFace.inside?a.winding=a.lFace.inside?l:-l:k?n.mesh.deleteEdge(a):a.winding=0};n.Dict=function(b,l){this.head_=new n.DictNode;this.frame_=b;this.leq_=l};n.Dict.prototype.deleteDict_=
function(){};n.Dict.prototype.insertBefore=function(b,l){do b=b.prev;while(null!==b.key&&!this.leq_(this.frame_,b.key,l));l=new n.DictNode(l,b.next,b);b.next.prev=l;return b.next=l};n.Dict.prototype.insert=function(b){return this.insertBefore(this.head_,b)};n.Dict.prototype.deleteNode=function(b){b.next.prev=b.prev;b.prev.next=b.next};n.Dict.prototype.search=function(b){var l=this.head_;do l=l.next;while(null!==l.key&&!this.leq_(this.frame_,b,l.key));return l};n.Dict.prototype.getMin=function(){return this.head_.next};
n.Dict.prototype.getMax=function(){return this.head_.prev};n.DictNode=function(b,l,k){this.key=b||null;this.next=l||this;this.prev=k||this};n.DictNode.prototype.getKey=function(){return this.key};n.DictNode.prototype.getSuccessor=function(){return this.next};n.DictNode.prototype.getPredecessor=function(){return this.prev};n.GluTesselator=function(){this.state_=n.GluTesselator.tessState_.T_DORMANT;this.errorCallback_=this.mesh=this.lastEdge_=null;this.normal_=[0,0,0];this.windingRule=n.windingRule.GLU_TESS_WINDING_ODD;
this.fatalError=!1;this.combineCallback_=this.event=this.pq=this.dict=null;this.boundaryOnly_=!1;this.polygonData_=this.meshCallback_=this.endCallback_=this.vertexCallback_=this.edgeFlagCallback_=this.beginCallback_=null};n.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2};n.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(n.GluTesselator.tessState_.T_DORMANT)};n.GluTesselator.prototype.gluTessProperty=function(b,l){switch(b){case n.gluEnum.GLU_TESS_TOLERANCE:return;
case n.gluEnum.GLU_TESS_WINDING_RULE:switch(l){case n.windingRule.GLU_TESS_WINDING_ODD:case n.windingRule.GLU_TESS_WINDING_NONZERO:case n.windingRule.GLU_TESS_WINDING_POSITIVE:case n.windingRule.GLU_TESS_WINDING_NEGATIVE:case n.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:this.windingRule=l;return}break;case n.gluEnum.GLU_TESS_BOUNDARY_ONLY:this.boundaryOnly_=!!l;return;default:this.callErrorCallback(n.gluEnum.GLU_INVALID_ENUM);return}this.callErrorCallback(n.gluEnum.GLU_INVALID_VALUE)};n.GluTesselator.prototype.gluGetTessProperty=
function(b){switch(b){case n.gluEnum.GLU_TESS_TOLERANCE:return 0;case n.gluEnum.GLU_TESS_WINDING_RULE:return b=this.windingRule,n.assert(b===n.windingRule.GLU_TESS_WINDING_ODD||b===n.windingRule.GLU_TESS_WINDING_NONZERO||b===n.windingRule.GLU_TESS_WINDING_POSITIVE||b===n.windingRule.GLU_TESS_WINDING_NEGATIVE||b===n.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),b;case n.gluEnum.GLU_TESS_BOUNDARY_ONLY:return n.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(n.gluEnum.GLU_INVALID_ENUM)}return!1};
n.GluTesselator.prototype.gluTessNormal=function(b,l,k){this.normal_[0]=b;this.normal_[1]=l;this.normal_[2]=k};n.GluTesselator.prototype.gluTessCallback=function(b,l){l=l?l:null;switch(b){case n.gluEnum.GLU_TESS_BEGIN:case n.gluEnum.GLU_TESS_BEGIN_DATA:this.beginCallback_=l;break;case n.gluEnum.GLU_TESS_EDGE_FLAG:case n.gluEnum.GLU_TESS_EDGE_FLAG_DATA:this.edgeFlagCallback_=l;break;case n.gluEnum.GLU_TESS_VERTEX:case n.gluEnum.GLU_TESS_VERTEX_DATA:this.vertexCallback_=l;break;case n.gluEnum.GLU_TESS_END:case n.gluEnum.GLU_TESS_END_DATA:this.endCallback_=
l;break;case n.gluEnum.GLU_TESS_ERROR:case n.gluEnum.GLU_TESS_ERROR_DATA:this.errorCallback_=l;break;case n.gluEnum.GLU_TESS_COMBINE:case n.gluEnum.GLU_TESS_COMBINE_DATA:this.combineCallback_=l;break;case n.gluEnum.GLU_TESS_MESH:this.meshCallback_=l;break;default:this.callErrorCallback(n.gluEnum.GLU_INVALID_ENUM)}};n.GluTesselator.prototype.gluTessVertex=function(b,l){var k=!1,h=[0,0,0];this.requireState_(n.GluTesselator.tessState_.T_IN_CONTOUR);for(var a=0;3>a;++a){var g=b[a];g<-n.GLU_TESS_MAX_COORD&&
(g=-n.GLU_TESS_MAX_COORD,k=!0);g>n.GLU_TESS_MAX_COORD&&(g=n.GLU_TESS_MAX_COORD,k=!0);h[a]=g}k&&this.callErrorCallback(n.errorType.GLU_TESS_COORD_TOO_LARGE);this.addVertex_(h,l)};n.GluTesselator.prototype.gluTessBeginPolygon=function(b){this.requireState_(n.GluTesselator.tessState_.T_DORMANT);this.state_=n.GluTesselator.tessState_.T_IN_POLYGON;this.mesh=new n.GluMesh;this.polygonData_=b};n.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(n.GluTesselator.tessState_.T_IN_POLYGON);
this.state_=n.GluTesselator.tessState_.T_IN_CONTOUR;this.lastEdge_=null};n.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(n.GluTesselator.tessState_.T_IN_CONTOUR);this.state_=n.GluTesselator.tessState_.T_IN_POLYGON};n.GluTesselator.prototype.gluTessEndPolygon=function(){this.requireState_(n.GluTesselator.tessState_.T_IN_POLYGON);this.state_=n.GluTesselator.tessState_.T_DORMANT;n.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]);n.sweep.computeInterior(this);
if(!this.fatalError){var b=this.mesh;this.boundaryOnly_?n.tessmono.setWindingNumber(b,1,!0):n.tessmono.tessellateInterior(b);this.mesh.checkMesh();if(this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)this.boundaryOnly_?n.render.renderBoundary(this,this.mesh):n.render.renderMesh(this,this.mesh,!!this.edgeFlagCallback_);if(this.meshCallback_){n.tessmono.discardExterior(this.mesh);this.meshCallback_(this.mesh);this.polygonData_=this.mesh=null;return}}n.mesh.deleteMesh(this.mesh);
this.mesh=this.polygonData_=null};n.GluTesselator.prototype.requireState_=function(b){this.state_!==b&&this.gotoState_(b)};n.GluTesselator.prototype.gotoState_=function(b){for(;this.state_!==b;)if(this.state_<b)switch(this.state_){case n.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(n.errorType.GLU_TESS_MISSING_BEGIN_POLYGON);this.gluTessBeginPolygon(null);break;case n.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(n.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case n.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(n.errorType.GLU_TESS_MISSING_END_CONTOUR);
this.gluTessEndContour();break;case n.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(n.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}};n.GluTesselator.prototype.addVertex_=function(b,l){var k=this.lastEdge_;null===k?(k=n.mesh.makeEdge(this.mesh),n.mesh.meshSplice(k,k.sym)):(n.mesh.splitEdge(k),k=k.lNext);k.org.data=l;k.org.coords[0]=b[0];k.org.coords[1]=b[1];k.org.coords[2]=b[2];k.winding=1;k.sym.winding=-1;this.lastEdge_=k};n.GluTesselator.prototype.callBeginCallback=
function(b){this.beginCallback_&&this.beginCallback_(b,this.polygonData_)};n.GluTesselator.prototype.callVertexCallback=function(b){this.vertexCallback_&&this.vertexCallback_(b,this.polygonData_)};n.GluTesselator.prototype.callEdgeFlagCallback=function(b){this.edgeFlagCallback_&&this.edgeFlagCallback_(b,this.polygonData_)};n.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)};n.GluTesselator.prototype.callCombineCallback=function(b,l,k){return this.combineCallback_?
this.combineCallback_(b,l,k,this.polygonData_)||null:null};n.GluTesselator.prototype.callErrorCallback=function(b){this.errorCallback_&&this.errorCallback_(b,this.polygonData_)};n.GluFace=function(b,l){this.next=b||this;this.prev=l||this;this.anEdge=null;this.inside=!1};n.GluHalfEdge=function(b){this.next=b||this;this.activeRegion=this.lFace=this.org=this.lNext=this.oNext=this.sym=null;this.winding=0};n.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace};n.GluHalfEdge.prototype.dst=function(){return this.sym.org};
n.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext};n.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym};n.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym};n.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext};n.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym};n.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym};n.GluMesh=function(){this.vHead=new n.GluVertex;this.fHead=new n.GluFace;this.eHead=new n.GluHalfEdge;this.eHeadSym=
new n.GluHalfEdge;this.eHead.sym=this.eHeadSym;this.eHeadSym.sym=this.eHead};n.GluMesh.prototype.checkMesh=function(){if(n.DEBUG){var b=this.fHead,l=this.vHead,k=this.eHead,h,a;for(h=h=b;(a=h.next)!==b;h=a){n.assert(a.prev===h);h=a.anEdge;do n.assert(h.sym!==h),n.assert(h.sym.sym===h),n.assert(h.lNext.oNext.sym===h),n.assert(h.oNext.sym.lNext===h),n.assert(h.lFace===a),h=h.lNext;while(h!==a.anEdge)}n.assert(a.prev===h&&null===a.anEdge);for(h=h=l;(b=h.next)!==l;h=b){n.assert(b.prev===h);h=b.anEdge;
do n.assert(h.sym!==h),n.assert(h.sym.sym===h),n.assert(h.lNext.oNext.sym===h),n.assert(h.oNext.sym.lNext===h),n.assert(h.org===b),h=h.oNext;while(h!==b.anEdge)}n.assert(b.prev===h&&null===b.anEdge&&null===b.data);for(l=l=k;(h=l.next)!==k;l=h)n.assert(h.sym.next===l.sym),n.assert(h.sym!==h),n.assert(h.sym.sym===h),n.assert(null!==h.org),n.assert(null!==h.dst()),n.assert(h.lNext.oNext.sym===h),n.assert(h.oNext.sym.lNext===h);n.assert(h.sym.next===l.sym&&h.sym===this.eHeadSym&&h.sym.sym===h&&null===
h.org&&null===h.dst()&&null===h.lFace&&null===h.rFace())}};n.GluVertex=function(b,l){this.next=b||this;this.prev=l||this;this.data=this.anEdge=null;this.coords=[0,0,0];this.pqHandle=this.t=this.s=0};n.PriorityQ=function(){this.verts_=[];this.order_=null;this.size_=0;this.initialized_=!1;this.heap_=new n.PriorityQHeap};n.PriorityQ.prototype.deleteQ=function(){this.verts_=this.order_=this.heap_=null};n.PriorityQ.prototype.init=function(){this.order_=[];for(var b=0;b<this.size_;b++)this.order_[b]=b;
b=function(b){return function(h,a){return n.geom.vertLeq(b[h],b[a])?1:-1}}(this.verts_);this.order_.sort(b);this.initialized_=!0;this.heap_.init();if(n.DEBUG)for(var l=0+this.size_-1,b=0;b<l;++b)n.assert(n.geom.vertLeq(this.verts_[this.order_[b+1]],this.verts_[this.order_[b]]))};n.PriorityQ.prototype.insert=function(b){if(this.initialized_)return this.heap_.insert(b);var l=this.size_++;this.verts_[l]=b;return-(l+1)};n.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();
var b=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var l=this.heap_.minimum();if(n.geom.vertLeq(l,b))return this.heap_.extractMin()}do--this.size_;while(0<this.size_&&null===this.verts_[this.order_[this.size_-1]]);return b};n.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var b=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var l=this.heap_.minimum();if(n.geom.vertLeq(l,b))return l}return b};n.PriorityQ.prototype.remove=function(b){if(0<=
b)this.heap_.remove(b);else for(b=-(b+1),n.assert(b<this.verts_.length&&null!==this.verts_[b]),this.verts_[b]=null;0<this.size_&&null===this.verts_[this.order_[this.size_-1]];)--this.size_};n.PriorityQHeap=function(){this.heap_=n.PriorityQHeap.reallocNumeric_([0],n.PriorityQHeap.INIT_SIZE_+1);this.verts_=[null,null];this.handles_=[0,0];this.size_=0;this.max_=n.PriorityQHeap.INIT_SIZE_;this.freeList_=0;this.initialized_=!1;this.heap_[1]=1};n.PriorityQHeap.INIT_SIZE_=32;n.PriorityQHeap.reallocNumeric_=
function(b,l){for(var k=Array(l),h=0;h<b.length;h++)k[h]=b[h];for(;h<l;h++)k[h]=0;return k};n.PriorityQHeap.prototype.init=function(){for(var b=this.size_;1<=b;--b)this.floatDown_(b);this.initialized_=!0};n.PriorityQHeap.prototype.insert=function(b){var l=++this.size_;2*l>this.max_&&(this.max_*=2,this.handles_=n.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1));var k;0===this.freeList_?k=l:(k=this.freeList_,this.freeList_=this.handles_[this.freeList_]);this.verts_[k]=b;this.handles_[k]=l;
this.heap_[l]=k;this.initialized_&&this.floatUp_(l);return k};n.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_};n.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]};n.PriorityQHeap.prototype.extractMin=function(){var b=this.heap_,l=this.verts_,k=this.handles_,h=b[1],a=l[h];0<this.size_&&(b[1]=b[this.size_],k[b[1]]=1,l[h]=null,k[h]=this.freeList_,this.freeList_=h,0<--this.size_&&this.floatDown_(1));return a};n.PriorityQHeap.prototype.remove=function(b){var l=
this.heap_,k=this.verts_,h=this.handles_;n.assert(1<=b&&b<=this.max_&&null!==k[b]);var a=h[b];l[a]=l[this.size_];h[l[a]]=a;a<=--this.size_&&(1>=a?this.floatDown_(a):n.geom.vertLeq(k[l[a>>1]],k[l[a]])?this.floatDown_(a):this.floatUp_(a));k[b]=null;h[b]=this.freeList_;this.freeList_=b};n.PriorityQHeap.prototype.floatDown_=function(b){for(var l=this.heap_,k=this.verts_,h=this.handles_,a=l[b];;){var g=b<<1;g<this.size_&&n.geom.vertLeq(k[l[g+1]],k[l[g]])&&(g+=1);n.assert(g<=this.max_);var e=l[g];if(g>
this.size_||n.geom.vertLeq(k[a],k[e])){l[b]=a;h[a]=b;break}l[b]=e;h[e]=b;b=g}};n.PriorityQHeap.prototype.floatUp_=function(b){for(var l=this.heap_,k=this.verts_,h=this.handles_,a=l[b];;){var g=b>>1,e=l[g];if(0===g||n.geom.vertLeq(k[e],k[a])){l[b]=a;h[a]=b;break}l[b]=e;h[e]=b;b=g}};n.ActiveRegion=function(){this.nodeUp=this.eUp=null;this.windingNumber=0;this.fixUpperEdge=this.dirty=this.sentinel=this.inside=!1};n.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()};
n.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()};return n})},"esri/views/2d/engine/webgl/util/Lock":function(){define(["require","exports","../../../../../core/promiseUtils"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._resolver=null}b.prototype.isHeld=function(){return!!this._resolver};b.prototype.acquire=function(){var b=this;return this._resolver?this._resolver.promise.then(function(){return b.acquire()}):
(this._resolver=l.createResolver(),l.resolve())};b.prototype.release=function(){var b=this._resolver;this._resolver=null;b.resolve()};return b}();b.default=n;b.withLock=function(b,h,a){return b.acquire().then(function(){return h(a)}).then(function(){return b.release()}).catch(function(a){b.release();throw a;})}})},"esri/views/2d/engine/webgl/TileData":function(){define("require exports ./MemoryRequirements ./TileBufferData ./TileDisplayData ./Utils ./Utils ./WGLDisplayObject ./WGLDisplayRecord ./mesh/VertexBuffer ./util/Reader ./util/serializationUtils ./util/Writer".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});var r=new l.default,t=new l.default;n=function(){function b(){this.tileBufferData=this.tileDisplayData=null}b.prototype.reshuffle=function(){r.reset();for(var c=h.groupRecordsByGeometryType(this.tileDisplayData.displayObjects),d=0;d<c.length;d++)for(var e=c[d],f=0,l=e;f<l.length;f++){var p=l[f];p&&r.needMore(p.geometryType,p.meshData?p.meshData.vertexCount:p.vertexCount,p.meshData?p.meshData.indexData.length:p.indexCount)}f=
c.length;d=new k;for(l=0;l<f;++l){d.geometries[l].indexBuffer=new Uint32Array(Math.round(1.15*r.indicesFor(l)));var p=[],q;for(q in this.tileBufferData.geometries[l].vertexBuffer)p.push(this.tileBufferData.geometries[l].vertexBuffer[q].stride);var p=b._computeVertexAlignment(p),e=Math.round(1.15*r.verticesFor(l)),p=b._align(e,p),n;for(n in this.tileBufferData.geometries[l].vertexBuffer)e=this.tileBufferData.geometries[l].vertexBuffer[n].stride,d.geometries[l].vertexBuffer[n]={stride:e,data:g.allocateTypedArrayBuffer(p,
e)}}t.reset();this.tileDisplayData.displayList.clear();for(l=0;l<f;++l){e=c[l];q=0;for(n=e;q<n.length;q++){p=n[q];if(p.meshData)p.writeMeshDataToBuffers(t.verticesFor(l),d.geometries[l].vertexBuffer,t.indicesFor(l),d.geometries[l].indexBuffer),p.meshData=null;else{var x=this.tileBufferData.geometries[l].vertexBuffer,K=this.tileBufferData.geometries[l].indexBuffer,I=d.geometries[l].vertexBuffer,Q=d.geometries[l].indexBuffer,J=t.verticesFor(l),N=t.indicesFor(l);a.copyMeshData(J,N,I,Q,p,x,K);p.vertexFrom=
J;p.indexFrom=N}t.needMore(l,p.vertexCount,p.indexCount)}this.tileDisplayData.displayList.unified||this.tileDisplayData.displayList.addToList(e)}if(this.tileDisplayData.displayList.unified)for(c=0,f=this.tileDisplayData.displayObjects;c<f.length;c++)this.tileDisplayData.displayList.addToList(f[c].displayRecords);this.tileBufferData=d};b.prototype.getStrides=function(){for(var a=[],b=0;b<this.tileBufferData.geometries.length;++b){var c=this.tileBufferData.geometries[b];a[b]={};for(var d in c.vertexBuffer)a[b][d]=
c.vertexBuffer[d].stride}return a};b.prototype.clone=function(){var a=new b;a.tileBufferData=this.tileBufferData.clone();a.tileDisplayData=this.tileDisplayData.clone();return a};b.prototype._guessSize=function(){for(var a=this.tileDisplayData.displayObjects,b=Math.min(a.length,4),c=0,d=0;d<b;d++)c=Math.max(c,a[d].displayRecords.length);return 2*(12*a.length+a.length*c*40)};b.prototype.serialize=function(){var a=this.tileBufferData.serialize(),b=this.tileBufferData.getBuffers(),c=this.tileDisplayData.serialize(new p.default(Int32Array,
this._guessSize())).buffer();b.push(c);return{result:{displayData:c,bufferData:a},transferList:b}};b.decode=function(a){var d=q.deserializeList(new c.default(a.displayObjects),e),g={},h;for(h in a.vertexBuffersMap)g[h]=f.VertexBuffers.decode(a.vertexBuffersMap[h]);return b.fromMeshData({displayObjects:d,vertexBuffersMap:g})};b.fromMeshData=function(a){var c=new b,d=new h.default,e=new k;d.displayObjects=a.displayObjects;for(var f in a.vertexBuffersMap){var g=a.vertexBuffersMap[f];e.geometries[f].indexBuffer=
g.indexBuffer;e.geometries[f].vertexBuffer=g.namedBuffers}c.tileDisplayData=d;c.tileBufferData=e;return c};b.bind=function(a,c){var d=new b;d.tileDisplayData=a;d.tileBufferData=c;return d};b.create=function(a,c){var e=new b;e.tileDisplayData=new h.default;e.tileDisplayData.displayObjects=a;for(var f=[0,0,0,0,0],l=[0,0,0,0,0],p=[[],[],[],[],[]],q=0;q<a.length;q++)for(var r=0,n=a[q].displayRecords;r<n.length;r++){var u=n[r];p[u.geometryType].push(u);f[u.geometryType]+=u.meshData.vertexCount;l[u.geometryType]+=
u.meshData.indexData.length}a=new k;c=[c.fill||{},c.line||{},c.icon||{},c.text||{},c.label||{}];for(q=0;5>q;q++){var r=new Uint32Array(l[q]),n=c[q],u=f[q],t={},w=void 0;for(w in n){var x={data:g.allocateTypedArrayBuffer(u,n[w]),stride:n[w]};t[w]=x}n=t;d.writeAllMeshDataToBuffers(p[q],n,r);a.geometries[q]={indexBuffer:r,vertexBuffer:n}}e.tileBufferData=a;return e};b._align=function(a,b){var c=a%b;return 0===c?a:a+(b-c)};b._computeVertexAlignment=function(a){for(var b=!1,c=!1,d=0;d<a.length;d++){var e=
a[d];2===e%4?b=!0:0!==e%4&&(c=!0)}return c?4:b?2:1};return b}();b.TileData=n})},"esri/views/2d/engine/webgl/MemoryRequirements":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._byGeometryType=null}Object.defineProperty(b.prototype,"satisfied",{get:function(){return!this._byGeometryType},enumerable:!0,configurable:!0});b.prototype.reset=function(){this._byGeometryType=null};b.prototype.verticesFor=function(b){return this._byGeometryType?
this._byGeometryType[b].vertices:0};b.prototype.indicesFor=function(b){return this._byGeometryType?this._byGeometryType[b].indices:0};b.prototype.needMore=function(b,h,a){if(h||a)this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]),b=this._byGeometryType[b],b.vertices+=h,b.indices+=a};return b}();b.default=n})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["require","exports",
"./Utils"],function(n,b,l){return function(){function b(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}b.prototype.clone=function(){for(var h=new b,a=0;a<this.geometries.length;a++){var g=this.geometries[a],e=h.geometries[a];e.indexBuffer=g.indexBuffer.slice();e.vertexBuffer={};for(var d in g.vertexBuffer){var f=g.vertexBuffer[d],c=f.stride;
e.vertexBuffer[d]={data:f.data.slice(),stride:c}}}return h};b.deserialize=function(h){for(var a=new b,g=0;5>g;++g){a.geometries[g].indexBuffer=new Uint32Array(h.geometries[g].indexBuffer);a.geometries[g].vertexBuffer={};for(var e in h.geometries[g].vertexBuffer)a.geometries[g].vertexBuffer[e]={data:l.allocateTypedArrayBufferwithData(h.geometries[g].vertexBuffer[e].data,h.geometries[g].vertexBuffer[e].stride),stride:h.geometries[g].vertexBuffer[e].stride}}return a};b.prototype.serialize=function(){for(var b=
{geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},a=0;5>a;++a)for(var g in this.geometries[a].vertexBuffer)b.geometries[a].vertexBuffer[g]={data:this.geometries[a].vertexBuffer[g].data.buffer,stride:this.geometries[a].vertexBuffer[g].stride};
return b};b.prototype.getBuffers=function(){for(var b=[],a=0;5>a;++a){b.push(this.geometries[a].indexBuffer.buffer);for(var g in this.geometries[a].vertexBuffer)b.push(this.geometries[a].vertexBuffer[g].data.buffer)}return b};return b}()})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define(["require","exports","./WGLDisplayList","./WGLDisplayObject","./util/serializationUtils"],function(n,b,l,k,h){function a(a){for(var b=[[],[],[],[],[]],d=0;d<a.length;d++)for(var f=0,c=a[d].displayRecords;f<
c.length;f++){var g=c[f];b[g.geometryType].push(g)}return b}Object.defineProperty(b,"__esModule",{value:!0});b.groupRecordsByGeometryType=a;n=function(){function b(){}Object.defineProperty(b.prototype,"displayObjectRegistry",{get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(var a=0,b=this.displayObjects;a<b.length;a++){var f=b[a];this._displayObjectRegistry.set(f.id,f)}}return this._displayObjectRegistry},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"displayList",{get:function(){return this._displayList},enumerable:!0,configurable:!0});b.prototype.computeDisplayList=function(b){this._displayList=new l(b);if(b){b=0;for(var d=this.displayObjects;b<d.length;b++)for(var e=0,c=d[b].displayRecords;e<c.length;e++)this._displayList.addToList(c[e])}else for(b=a(this.displayObjects),d=b.length,e=0;e<d;++e)this._displayList.addToList(b[e])};b.prototype.clone=function(){var a=new b;this.displayObjects&&(a.displayObjects=this.displayObjects.map(function(a){return a.clone()}));
return a};b.prototype.serialize=function(a){h.serializeList(a,this.displayObjects);return a};b.prototype._deserializeObjects=function(a){for(var b=a.readInt32(),b=Array(b),e=new Map,c=0;c<b.length;++c){var g=k.deserialize(a);b[c]=g;e.set(g.id,g)}this.displayObjects=b;this._displayList=null;this._displayObjectRegistry=e};b.deserialize=function(a){var d=new b;d._deserializeObjects(a);return d};return b}();b.default=n})},"esri/views/2d/engine/webgl/WGLDisplayList":function(){define(["require","exports",
"../../../../core/tsSupport/generatorHelper","../../../../core/Logger","./enums"],function(n,b,l,k,h){function a(a,b,c){for(var d=[],e=3;e<arguments.length;e++)d[e-3]=arguments[e];b<a.length?a.splice.apply(a,[b,c].concat(d)):a.push.apply(a,d)}var g=k.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");n=new Map;n.set(h.WGLDrawPhase.MAP,[h.WGLGeometryType.FILL,h.WGLGeometryType.LINE,h.WGLGeometryType.MARKER,h.WGLGeometryType.TEXT]);n.set(h.WGLDrawPhase.LABEL,[h.WGLGeometryType.LABEL]);n.set(h.WGLDrawPhase.LABEL_ALPHA,
[h.WGLGeometryType.LABEL]);n=function(){function b(a){void 0===a&&(a=!1);this.symbolLevels=[];this.unified=a}b.prototype.replay=function(a,b,c){if(this.unified)for(var d=0,e=this.symbolLevels;d<e.length;d++)for(var f=0,g=e[d].zLevels;f<g.length;f++){var h=g[f].geometryDPInfo,k;for(k in h)if(h[k])for(var l=0,p=h[k];l<p.length;l++){var q=p[l],r=a.painter.getGeometryBrush(q.geometryType),n=b.getGeometry(a,q.geometryType);r.prepareState(a,b);r.drawGeometry(a,b,q,n,c)}}};Object.defineProperty(b.prototype,
"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});b.prototype.clear=function(){this.symbolLevels.length=0};b.prototype.addToList=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)this._addToList(a[c],b);else this._addToList(a,b)};b.prototype.removeFromList=function(a){Array.isArray(a)||(a=[a]);for(var b=null,c=0;c<a.length;c++)b=this._removeFromList(a[c]);return b};b.prototype.byType=function(a,b){for(var c=0,d=this.symbolLevels;c<
d.length;c++)for(var e=0,f=d[c].zLevels;e<f.length;e++){var g=f[e].geometryDPInfo,h=this.getDPInfoType(a);if(g[h])for(var k=0,g=g[h];k<g.length;k++)b(g[k])}};b.prototype.clone=function(){for(var a=new b(this.unified),c=0,d=this.symbolLevels;c<d.length;c++)a.symbolLevels.push(d[c].clone());return a};b.prototype.splitAfter=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),c=b.length,d=a.indexFrom+a.indexCount,f=0;f<c;++f){var g=b[f];if(g.geometryType===a.geometryType&&
d>g.indexFrom&&d<=g.indexFrom+g.indexCount)return d<g.indexFrom+g.indexCount&&(a=new e,a.geometryType=g.geometryType,a.materialKey=g.materialKey,a.indexFrom=d,a.indexCount=g.indexFrom+g.indexCount-d,b.splice(f+1,0,a),g.indexCount=d-g.indexFrom),f}};b.prototype._addToList=function(b,c){var d=this._getDisplayList(b.symbolLevel,b.zOrder,b.geometryType);c=null!=c?c:d.length-1;var f=0<=c&&c<d.length?d[c]:null;null===f||f.materialKey!==b.materialKey||f.indexFrom+f.indexCount!==b.indexFrom||this.unified&&
f.geometryType!==b.geometryType?(f=new e,f.indexFrom=b.indexFrom,f.indexCount=b.indexCount,f.materialKey=b.materialKey,f.geometryType=b.geometryType,a(d,c+1,0,f)):f.indexCount+=b.indexCount};b.prototype._removeFromList=function(b){for(var c=this._getDisplayList(b.symbolLevel,b.zOrder,b.geometryType),d=c.length,f=void 0,g=0;g<d;++g){var h=c[g];if(b.indexFrom+b.indexCount>h.indexFrom&&b.indexFrom<h.indexFrom+h.indexCount&&(!this.unified||h.geometryType===b.geometryType)){f=g;break}}if(void 0!==f){h=
c[f];if(b.indexFrom===h.indexFrom)return h.indexCount-=b.indexCount,h.indexFrom+=b.indexCount,0===h.indexCount&&a(c,f,1),f-1;if(b.indexFrom+b.indexCount===h.indexFrom+h.indexCount)return h.indexCount-=b.indexCount,0===h.indexCount?(a(c,f,1),f-1):f;var d=h.indexFrom,g=b.indexFrom-h.indexFrom,k=b.indexCount;b=h.indexFrom+h.indexCount-(b.indexFrom+b.indexCount);h.indexCount=g;var m=new e;m.geometryType=h.geometryType;m.materialKey=h.materialKey;m.indexFrom=d+g+k;m.indexCount=b;a(c,f+1,0,m);return f}return null};
b.prototype._getDisplayList=function(a,b,e){for(var g,k=this.symbolLevels.length,l=0;l<k;l++)if(this.symbolLevels[l].symbolLevel===a){g=this.symbolLevels[l];break}g||(g=new c,g.symbolLevel=a,this.symbolLevels.push(g));var p;a=g.zLevels.length;for(k=0;k<a;k++)if(g.zLevels[k].zLevel===b){p=g.zLevels[k];break}p||(p=new f,p.geometryDPInfo=new d,p.zLevel=b,g.zLevels.push(p));var m;if(this.unified)p.geometryDPInfo.unified||(p.geometryDPInfo.unified=[]),m=p.geometryDPInfo.unified;else switch(e){case h.WGLGeometryType.FILL:p.geometryDPInfo.fill||
(p.geometryDPInfo.fill=[]);m=p.geometryDPInfo.fill;break;case h.WGLGeometryType.LINE:p.geometryDPInfo.line||(p.geometryDPInfo.line=[]);m=p.geometryDPInfo.line;break;case h.WGLGeometryType.MARKER:p.geometryDPInfo.marker||(p.geometryDPInfo.marker=[]);m=p.geometryDPInfo.marker;break;case h.WGLGeometryType.TEXT:p.geometryDPInfo.text||(p.geometryDPInfo.text=[]);m=p.geometryDPInfo.text;break;case h.WGLGeometryType.LABEL:p.geometryDPInfo.label||(p.geometryDPInfo.label=[]);m=p.geometryDPInfo.label;break;
default:console.error("Trying to add a record with geometry type '"+e+"'.")}return m};b.prototype.getDPInfoType=function(a){if(this.unified)return"unified";switch(a){case h.WGLGeometryType.FILL:return"fill";case h.WGLGeometryType.LINE:return"line";case h.WGLGeometryType.MARKER:return"marker";case h.WGLGeometryType.TEXT:return"text";case h.WGLGeometryType.LABEL:return"label";default:g.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return b}();var e=function(){function a(){this.materialKey=
null;this.indexCount=this.indexFrom=0}a.prototype.clone=function(){var b=new a;b.geometryType=this.geometryType;b.materialKey=this.materialKey;b.indexFrom=this.indexFrom;b.indexCount=this.indexCount;return b};return a}(),d=function(){function a(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}a.prototype.clone=function(){var b=new a;b.fill=this.fill&&this.fill.map(function(a){return a.clone()});b.line=this.line&&this.line.map(function(a){return a.clone()});b.marker=this.marker&&
this.marker.map(function(a){return a.clone()});b.text=this.text&&this.text.map(function(a){return a.clone()});b.label=this.label&&this.label.map(function(a){return a.clone()});b.unified=this.unified&&this.unified.map(function(a){return a.clone()});return b};return a}(),f=function(){function a(){this.geometryDPInfo=new d}a.prototype.clone=function(){var b=new a;b.zLevel=this.zLevel;b.geometryDPInfo=this.geometryDPInfo.clone();return b};return a}(),c=function(){function a(){this.zLevels=[]}a.prototype.clone=
function(){var b=new a;b.symbolLevel=this.symbolLevel;for(var c=0,d=this.zLevels;c<d.length;c++)b.zLevels.push(d[c].clone());return b};return a}();return n})},"esri/views/2d/engine/webgl/util/Reader":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._pos=0;this._buffer=b;this._i32View=new Int32Array(this._buffer);this._f32View=new Float32Array(this._buffer)}b.prototype.readInt32=function(){return this._i32View[this._pos++]};
b.prototype.readF32=function(){return this._f32View[this._pos++]};return b}();b.default=n})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../renderers/support/utils ./definitions ./Utils".split(" "),function(n,b,l,k,h,a,g,e,d,f,c,q){function p(a,b){var c=b.length;
if(a<b[0].value||1===c)return b[0].size;for(var d=1;d<c;d++)if(a<b[d].value)return b[d-1].size+(a-b[d-1].value)/(b[d].value-b[d-1].value)*(b[d].size-b[d-1].size);return b[c-1].size}function r(a,b,c){void 0===c&&(c=0);var d=b.g,e=b.b,f=b.a;a[c+0]=b.r*f/255;a[c+1]=d*f/255;a[c+2]=e*f/255;a[c+3]=f}Object.defineProperty(b,"__esModule",{value:!0});var t=function(a,b,c){for(var d=c*=16,e=0;d<Math.min(c+16,a.length);d++,e++)a[d]=b[e]},x=d.mat4f32.create();n=function(){function b(){this.symbolLevels=[];this.vvColorValues=
new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.vvSizeFieldStopsValues=new Float32Array(6);this.vvSizeFieldStopsSizes=new Float32Array(6);this.ddColors=new Float32Array(32);this.ddBackgroundColor=new Float32Array(4);this.ddActiveDots=new Float32Array(8);this.insideEffect=new Float32Array(16*c.MAX_FILTERS);this.insideOpacity=1;this.outsideEffect=new Float32Array(16*c.MAX_FILTERS);
this.outsideOpacity=1;this.effectCount=0;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this._buf0=new Float32Array(2);this._buf1=new Float32Array(2);this.symbolLevels.push(0);for(var a=0;a<c.MAX_FILTERS;a++)t(this.insideEffect,x,a),t(this.outsideEffect,x,a)}Object.defineProperty(b.prototype,"insideOpacities",{get:function(){this._buf0[0]=1;this._buf0[1]=this.insideOpacity;return this._buf0},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"outsideOpacities",{get:function(){this._buf1[0]=0;this._buf1[1]=this.outsideOpacity;return this._buf1},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});b.prototype.update=function(b){a.isSome(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,b)};b.prototype.setInfo=function(b,c,d){var e=this;a.isSome(d)?(d.forEach(function(a,b){return e._updateEffects(b,
a)}),this.effectCount=d.length):this.effectCount=0;this._vvInfo=c;switch(b.type){case "dot-density":this._updateDotDensityInfo(b)}};b.prototype.getVariation=function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,effectCount:this.effectCount,oesTextureFloat:h("esri-webgl-texture-float")}};b.prototype.getVariationHash=function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1|this.effectCount<<2};b.prototype._updateEffects=function(b,c){b+=
1;if(a.isSome(c)&&c.filter&&c.filter.enabled){this.outsideLabelsVisible=c.excludedLabelsVisible;var d=c.parsedIncludedEffect;c=c.parsedExcludedEffect;a.isSome(d)?(t(this.insideEffect,d.getColorMatrix(),b),this.insideOpacity=d.getOpacity()):(t(this.insideEffect,x,b),this.insideOpacity=1);a.isSome(c)?(t(this.outsideEffect,c.getColorMatrix(),b),this.outsideOpacity=c.getOpacity()):(t(this.outsideEffect,x,b),this.outsideOpacity=1)}else t(this.insideEffect,x,b),t(this.outsideEffect,x,b),this.outsideOpacity=
this.insideOpacity=1};b.prototype._updateVisualVariables=function(a,b){var c=this._vvMaterialParameters;c.vvOpacityEnabled=!1;c.vvSizeEnabled=!1;c.vvColorEnabled=!1;c.vvRotationEnabled=!1;if(a){var d=a.size;if(d){c.vvSizeEnabled=!0;if(d.minMaxValue){var h=d.minMaxValue,k=void 0,l=void 0;q.isDefined(h.minSize)&&q.isDefined(h.maxSize)&&(q.isNumber(h.minSize)&&q.isNumber(h.maxSize)?(k=g.pt2px(h.minSize),l=g.pt2px(h.maxSize)):(l=b.scale,k=g.pt2px(p(l,h.minSize.stops)),l=g.pt2px(p(l,h.maxSize.stops))));
this.vvSizeMinMaxValue.set([h.minDataValue,h.maxDataValue,k,l])}d.scaleStops&&(this.vvSizeScaleStopsValue=g.pt2px(p(b.scale,d.scaleStops.stops)));d.unitValue&&(this.vvSizeUnitValueToPixelsRatio=e.getMetersPerUnitForSR(b.spatialReference)/f.meterIn[d.unitValue.unit]/b.resolution);d.fieldStops&&(this.vvSizeFieldStopsValues.set(d.fieldStops.values),this.vvSizeFieldStopsSizes.set(d.fieldStops.sizes))}if(b=a.color)c.vvColorEnabled=!0,this.vvColorValues.set(b.values),this.vvColors.set(b.colors);if(b=a.opacity)c.vvOpacityEnabled=
!0,this.vvOpacityValues.set(b.values),this.vvOpacities.set(b.opacities);if(a=a.rotation)c.vvRotationEnabled=!0,c.vvRotationType=a.type}};b.prototype._updateDotDensityInfo=function(a){var b=a.attributes;this.ddDotValue=a.dotValue;this.ddDotScale=a.referenceScale;this.ddDotSize=a.dotSize;this.ddDotBlending=a.dotBlendingEnabled;this.ddSeed=a.seed;for(var d=0;d<c.DOT_DENSITY_MAX_FIELDS;d++){var e=d>=b.length?new k([0,0,0,0]):b[d].color;r(this.ddColors,e,4*d)}for(d=0;8>d;d++)this.ddActiveDots[d]=d<a.attributes.length?
1:0;r(this.ddBackgroundColor,a.backgroundColor)};return b}();b.WGLRendererInfo=n})},"esri/views/2d/engine/webgl/WGLTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat2d ../../../../core/libs/gl-matrix-2/mat2df32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ./definitions ./DirtyMap ./DisplayRecordStore ./Fader ./TiledDisplayObject ./WGLBuffers".split(" "),function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,
"__esModule",{value:!0});var r=new Set;n=function(b){function q(a,f,g){void 0===g&&(g=!1);a=b.call(this,a,f,[e.TILE_SIZE,e.TILE_SIZE])||this;a._data=null;a._displayList=null;a._wglBuffers=null;a._dirtyMap=new d.default;a._labelIndex=null;a._dirty=!0;a.fader=new c.default;a._ensureCorrectZOrder=g;a.transforms.labelMat2d=h.mat2df32.create();return a}l(q,b);q.prototype.destroy=function(){this.clear()};Object.defineProperty(q.prototype,"displayObjects",{get:function(){return this._data.tileDisplayData.displayObjects},
enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"canDisplay",{get:function(){return!!this.attached},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"isDirty",{get:function(){return this._dirty},set:function(a){(this._dirty=a)||this.isReady||this.ready();this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"hasData",{get:function(){return!!this._data},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"labelIndex",
{get:function(){return this._labelIndex},enumerable:!0,configurable:!0});q.prototype.getGeometry=function(a,b){return this._wglBuffers&&this._wglBuffers.has(b)?this._wglBuffers.get(b):null};q.prototype.getDisplayList=function(a){return this._data&&this._displayList};Object.defineProperty(q.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});q.prototype.setTransform=function(c,d){b.prototype.setTransform.call(this,c,d);var e=this.transforms.labelMat2d;d=c.getScreenTransform(e,
d);var f=g.vec2f32.create();a.vec2.transformMat2d(f,this.coords,d);k.mat2d.identity(e);k.mat2d.translate(e,e,f);k.mat2d.multiply(e,c.viewMat2d,e)};q.prototype.setData=function(a,b,c){var e=a.addOrUpdate,g=a.remove;!a.clear&&this.hasData||a.addOrUpdate?!a.clear&&this.hasData||!a.addOrUpdate?this.hasData&&this._doPatchData({addOrUpdate:e,remove:g},b,c):(e.tileDisplayData.computeDisplayList(this._ensureCorrectZOrder),this._dirtyMap=new d.default,this._dispRecStore=f.default.fromTileData(e,this._dirtyMap),
this._data=e,this._readyTileIfNoLabels(b,c),this._dirtyMap.markAllDirty(),this._displayList||(this._displayList=e.tileDisplayData.displayList.clone())):(this.clear(),this.ready());this.emit("change")};q.prototype.commitChanges=function(a){this.fader.step()||this.requestRender();this._wglBuffers||(this._wglBuffers=new p.default(this.stage.context));this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap);this._displayList=this._data.tileDisplayData.displayList.clone();this._dirtyMap.markAllClean()};
q.prototype.clear=function(){this._dispRecStore=this._displayList=this._data=null;this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)};q.prototype.attach=function(){return!0};q.prototype._readyTileIfNoLabels=function(a,b){a&&this._rebuildLabelIndex();this.isDirty=a&&b?!0:!1};q.prototype._doPatchData=function(a,b,c){this._patchData(a)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=f.default.fromTileData(this._data,this._dirtyMap));this._readyTileIfNoLabels(b,
c);this.requestRender()};q.prototype._rebuildLabelIndex=function(){this._labelIndex=this._initLabelIndex();for(var a=0,b=this.displayObjects;a<b.length;a++)for(var c=0,d=b[a].metrics;c<d.length;c++)this._insertIntoLabelIndex(d[c])};q.prototype._insertIntoLabelIndex=function(a){-1!==a.xBucket&&this.labelIndex[a.yBucket][a.xBucket].push(a)};q.prototype._initLabelIndex=function(){for(var a=[],b=0;b<e.TILE_SIZE/e.COLLISION_BUCKET_SIZE;b++){a.push([]);for(var c=0;c<e.TILE_SIZE/e.COLLISION_BUCKET_SIZE;c++)a[b].push([])}return a};
q.prototype._patchData=function(a){for(var b=!0,c=a.addOrUpdate&&a.addOrUpdate.tileDisplayData&&a.addOrUpdate.tileDisplayData.displayObjects||[],d=(a.remove||[]).slice(),e=0;e<c.length;e++){var f=c[e];null!=f.insertAfter&&d.push(f.id)}for(f=0;f<d.length;f++){var g=d[f];if(e=this._data.tileDisplayData.displayObjectRegistry.get(g)){this._data.tileDisplayData.displayList.removeFromList(e.displayRecords);for(var h=0,k=e.displayRecords;h<k.length;h++)this._dispRecStore.delete(k[h]);this._data.tileDisplayData.displayObjectRegistry.delete(g);
e=this._data.tileDisplayData.displayObjects.indexOf(e);this._data.tileDisplayData.displayObjects.splice(e,1)}}for(d=0;d<c.length;d++){f=c[d];e=this._data.tileDisplayData.displayObjectRegistry.get(f.id);g=void 0;if(e){h=e.displayRecords;e.set(f);e.displayRecords=h;h=e.displayRecords.length;for(k=0;k<h;++k){var l=e.displayRecords[k],p=f.displayRecords[k];if(k>=f.displayRecords.length||l.geometryType!==p.geometryType||l.symbolLevel!==p.symbolLevel||l.zOrder!==p.zOrder||l.materialKey!==p.materialKey)this._dispRecStore.delete(e.displayRecords[k]),
k<f.displayRecords.length&&(e.displayRecords[k]=void 0)}e.displayRecords.length=f.displayRecords.length;e.metrics=f.metrics}else if(e=f.copy(),e.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(f.id,e),k=void 0,l=this._data.tileDisplayData.displayObjects,null!=e.insertAfter?(g={},0<=e.insertAfter?(h=this._data.tileDisplayData.displayObjectRegistry.get(e.insertAfter))?(k=l.indexOf(h)+1,k<l.length?l.splice(k,0,e):(l.push(e),k=l.length)):(l.push(e),k=l.length):(l.unshift(e),k=0)):
(l.push(e),k=l.length),g){p=void 0;if(this._data.tileDisplayData.displayList.unified)p=0<f.displayRecords.length?1:0;else{r.clear();for(var p=0,q=f.displayRecords;p<q.length;p++)h=this._data.tileDisplayData.displayList.getDPInfoType(q[p].geometryType),r.add(h);p=r.size}q=0;for(--k;0<=k&&q<p;--k)for(var n=l[k].displayRecords.length-1;0<=n&&q<p;--n){var t=l[k].displayRecords[n],h=this._data.tileDisplayData.displayList.getDPInfoType(t.geometryType);g[h]||(g[h]=t,++q)}}q=f.displayRecords.length;for(k=
0;k<q;++k){p=f.displayRecords[k];(l=e.displayRecords[k])?(l.meshData=p.meshData,l.materialKey=p.materialKey):(l=p.copy(),l.vertexFrom=void 0,l.indexFrom=void 0,e.displayRecords[k]=l);var n=p.geometryType,h=this._data.tileDisplayData.displayList.getDPInfoType(n),t=a.addOrUpdate.tileBufferData.geometries[n],n=t.vertexBuffer,t=t.indexBuffer,x=void 0;g&&(x=g[h]?this._data.tileDisplayData.displayList.splitAfter(g[h]):-1);b=this._dispRecStore.setMeshData(l,p,n,t,x)&&b;g&&null!=l.indexFrom&&null!=l.indexFrom&&
(g[h]=l)}}return b};return q}(q.TiledDisplayObject);b.WGLTile=n})},"esri/views/2d/engine/webgl/DirtyMap":function(){define(["require","exports","./Utils"],function(n,b,l){function k(b,a,g){if(!b.allDirty)if(null!=b.from&&null!=b.count){var e=Math.min(b.from,a);a=Math.max(b.from+b.count,a+g)-e;b.from=e;b.count=a}else b.from=a,b.count=g}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._dirties=l.createGeometryData(function(a){return{indices:{from:null,count:null,allDirty:!1}}},
function(a,b){return{vertices:{from:null,count:null,allDirty:!1}}})}b.prototype.hasDirty=function(){for(var a=0,b=this._dirties;a<b.length;a++){var e=b[a];if(null!==e.data.indices.count||e.data.indices.allDirty)return!0}return!1};b.prototype.markAllClean=function(){for(var a=0,b=this._dirties;a<b.length;a++){var e=b[a];e.data.indices.from=null;e.data.indices.count=null;e.data.indices.allDirty=!1;for(var d in e.buffers)e.buffers[d].data.vertices.from=null,e.buffers[d].data.vertices.count=null,e.buffers[d].data.vertices.allDirty=
!1}};b.prototype.markAllDirty=function(){for(var a=0,b=this._dirties;a<b.length;a++){var e=b[a];e.data.indices.allDirty=!0;for(var d in e.buffers)e.buffers[d].data.vertices.allDirty=!0}};b.prototype.forEach=function(a){for(var b=0;b<this._dirties.length;++b){var e=this._dirties[b],d={},f;for(f in e.buffers){var c=e.buffers[f].data.vertices;if(c.allDirty||null!=c.from&&null!=c.count&&0<c.count)d[f]=c}e=e.data.indices;c=void 0;c=e.allDirty||null!=e.from&&null!=e.count&&0<e.count?{indices:e,vertices:d}:
{indices:null,vertices:d};(c.indices||0<Object.keys(c).length)&&a(c,b)}};b.prototype.markDirtyIndices=function(a,b,e){k(this._dirties[a].data.indices,b,e)};b.prototype.markDirtyVertices=function(a,b,e,d){k(this._dirties[a].buffers[b].data.vertices,e,d)};return b}();b.default=n})},"esri/views/2d/engine/webgl/DisplayRecordStore":function(){define(["require","exports","../../../../core/has","./FreeList","./Utils"],function(n,b,l,k,h){function a(a){a=a.getStrides();for(var b={},e=0;e<a.length;e++)b[g[e]]=
a[e];return b}Object.defineProperty(b,"__esModule",{value:!0});var g=["FILL","LINE","MARKER","TEXT","LABEL"];n=function(){function b(a,b,c,e){this._strides=a;this._displayList=b;this._freeListsAndStorage={};this._dirtyMap=null;this._dirtyMap=c;for(var d in a){this._freeListsAndStorage[d]={vtxFreeList:e?new k.FreeList(e):null,idxFreeList:e?new k.FreeList(e):null,vertexBuffers:{},indexBuffer:e?new Uint32Array(e):null};for(var f in a[d])this._freeListsAndStorage[d].vertexBuffers[f]={data:e?h.allocateTypedArrayBuffer(e,
a[d][f]):null,stride:a[d][f]}}}b.fromTileData=function(d,e){var c=a(d),f=[0,0,0,0,0],l=[0,0,0,0,0],r=[];d.tileDisplayData.displayObjectRegistry.forEach(function(a){r.push(a)});for(var n=0;n<r.length;n++)for(var x=0,w=r[n].displayRecords;x<w.length;x++){var u=w[x];f[u.geometryType]=Math.max(f[u.geometryType],u.vertexFrom+u.vertexCount);l[u.geometryType]=Math.max(l[u.geometryType],u.indexFrom+u.indexCount)}e=new b(c,d.tileDisplayData.displayList,e,null);for(c=0;c<d.tileBufferData.geometries.length;++c){var n=
f[c],w=l[c],u=d.tileBufferData.geometries[c],x=e._storageFor(g[c]),y=d.tileBufferData.geometries[c].indexBuffer;x.indexBuffer=y;x.idxFreeList=new k.FreeList(y.length);x.idxFreeList.allocate(w);var w=void 0,m;for(m in u.vertexBuffer)u=d.tileBufferData.geometries[c].vertexBuffer[m],x.vertexBuffers[m].data=u.data,x.vertexBuffers[m].stride=u.stride,y=h.strideToPackingFactor(u.stride),u=u.data.length*y/u.stride,w||(w=u);x.vtxFreeList=new k.FreeList(w);x.vtxFreeList.allocate(n)}return e};b.prototype.delete=
function(a){var b=g[a.geometryType];this._freeVertices(b,a.vertexFrom,a.vertexCount);this._freeIndices(b,a.indexFrom,a.indexCount);this._displayList.removeFromList(a);a.vertexFrom=void 0;a.indexFrom=void 0};b.prototype.setMeshData=function(a,b,c,e,k){var d=g[a.geometryType];a.meshData=null;var f=void 0,l=void 0;void 0===a.vertexFrom?(l=b.vertexCount,f=this._allocateVertices(d,l)):b.vertexCount>a.vertexCount?(this._freeVertices(d,a.vertexFrom,a.vertexCount),l=b.vertexCount,f=this._allocateVertices(d,
l)):b.vertexCount===a.vertexCount?(f=a.vertexFrom,l=a.vertexCount):(this._freeVertices(d,a.vertexFrom+b.vertexCount,a.vertexCount-b.vertexCount),f=a.vertexFrom,l=b.vertexCount);var p=!0,q=void 0,n=void 0,m=void 0;void 0===a.indexFrom?(q=k,m=b.indexCount,n=this._allocateIndices(d,m)):b.indexCount>a.indexCount?(q=this._displayList.removeFromList(a),this._freeIndices(d,a.indexFrom,a.indexCount),m=b.indexCount,n=this._allocateIndices(d,m)):b.indexCount===a.indexCount?(p=!1,n=a.indexFrom,m=a.indexCount):
(q=this._displayList.removeFromList(a),this._freeIndices(d,a.indexFrom+b.indexCount,a.indexCount-b.indexCount),n=a.indexFrom,m=b.indexCount);if(-1!==f&&-1!==n){k=this._storageFor(d);h.copyMeshData(f,n,k.vertexBuffers,k.indexBuffer,b,c,e);a.vertexFrom=f;a.indexFrom=n;a.vertexCount=b.vertexCount;a.indexCount=b.indexCount;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(a.geometryType,a.indexFrom,a.indexCount);for(var v in c)this._dirtyMap.markDirtyVertices(a.geometryType,v,a.vertexFrom,a.vertexCount)}p&&
this._displayList.addToList(a,q);return!0}-1!==f&&this._freeVertices(d,f,l);-1!==n&&this._freeIndices(d,n,m);a.setMeshDataFromBuffers(b,c,e);a.vertexFrom=void 0;a.vertexCount=0;a.indexFrom=void 0;a.indexCount=0;return!1};b.prototype._allocateVertices=function(a,b){a=this._storageFor(a);b=a.vtxFreeList.allocate(b);return-1===b||.5<a.vtxFreeList.fragmentation?-1:b};b.prototype._freeVertices=function(a,b,c){this._storageFor(a).vtxFreeList.free(b,c)};b.prototype._freeIndices=function(a,b,c){this._storageFor(a).idxFreeList.free(b,
c)};b.prototype._allocateIndices=function(a,b){a=this._storageFor(a);b=a.idxFreeList.allocate(b);return-1===b||.5<a.idxFreeList.fragmentation?-1:b};b.prototype._storageFor=function(a){return this._freeListsAndStorage[a]};b.prototype._stridesFor=function(a,b){return this._strides[a][b]};return b}();b.default=n})},"esri/views/2d/engine/webgl/FreeList":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});var l=function(){function b(b){this._largestRange=
null;this._parent=b;this._updateLargestRange()}Object.defineProperty(b.prototype,"largestRange",{get:function(){return this._largestRange},enumerable:!0,configurable:!0});b.prototype.rangeCreated=function(b){if(!this._largestRange||b.count>this._largestRange.count)this._largestRange=b};b.prototype.rangeResized=function(b,a,g){if(b===this._largestRange)b.count<g&&this._updateLargestRange();else if(!this._largestRange||b.count>this._largestRange.count)this._largestRange=b};b.prototype.findBestRange=
function(b){for(var a=this._parent._freeHead,g=null;null!==a;)a.count>=b&&(!g||a.count-b<g.count-b)&&(g=a),a=a.next;return g};b.prototype.findAdjacentRanges=function(b,a){for(var g=!0,e=!1,d=null,f=this._parent._freeHead;g&&!e;){var c=null!==f?f.from:this._parent._size;b>=(null!==d?d.from+d.count:0)&&b+a<=c?(g=!1,e=!0):null!==f?(d=f,f=f.next):g=!1}return[d,f]};b.prototype._updateLargestRange=function(){for(var b=null,a=this._parent._freeHead;null!==a;){if(!b||a.count>b.count)b=a;a=a.next}this._largestRange=
b};return b}();n=function(){function b(b,a){this._allocated=0;this._size=b;this._freeHead=0<b?{from:0,count:b,prev:null,next:null}:null;this._bookKeeper=a||new l(this);this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}b.prototype.allocate=function(h){var a=this._bookKeeper.findBestRange(h);if(null===a)return-1;var g=a.from,e=a.count;a.from+=h;a.count-=h;this._bookKeeper.rangeResized(a,g,e);this._allocated+=h;0===a.count&&(h=null!==a.prev?this._freeHead:a.next,b._removeRange(a),this._freeHead=
h);return g};b.prototype.free=function(h,a){var g=this._bookKeeper.findAdjacentRanges(h,a),e=g[0],g=g[1];h={from:h,count:a,prev:e,next:g};null!==e&&(e.next=h);null!==g&&(g.prev=h);this._bookKeeper.rangeCreated(h);this._allocated-=a;if(null!==g&&h.from+h.count===g.from){a=h.from;var d=h.count;b._fuse(h,g);b._removeRange(g);this._bookKeeper.rangeResized(h,a,d);this._bookKeeper.rangeResized(g,void 0,0)}null!==e&&e.from+e.count===h.from&&(a=e.from,d=e.count,b._fuse(e,h),b._removeRange(h),this._bookKeeper.rangeResized(e,
a,d),this._bookKeeper.rangeResized(h,void 0,0));this._freeHead=null!==h.prev?this._freeHead:h};Object.defineProperty(b.prototype,"fragmentation",{get:function(){var b=this._size-this._allocated;return 0===b?0:1-this._bookKeeper.largestRange.count/b},enumerable:!0,configurable:!0});b._removeRange=function(b){null!==b.prev?null!==b.next?(b.prev.next=b.next,b.next.prev=b.prev):b.prev.next=null:null!==b.next&&(b.next.prev=null)};b._fuse=function(b,a){b.count+=a.count;b.next=a.next;a.from+=a.count;a.count=
0;null!==a.next&&(a.next.prev=b)};return b}();b.FreeList=n})},"esri/views/2d/engine/webgl/Fader":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){void 0===b&&(b=400);this.duration=b;this._value=this._elapsed=this._lastTime=0;this._finished=!1}Object.defineProperty(b.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});b.prototype.reset=function(){this._value=this._elapsed=this._lastTime=
0};b.prototype.step=function(){var b=performance.now();if(0===this._lastTime)return this._lastTime=b,this._value=0,!0;if(this._elapsed>=this.duration)return!0;this._elapsed+=b-this._lastTime;this._lastTime=b;this._value=Math.min(this._elapsed/this.duration,1);return!1};return b}();b.default=n})},"esri/views/2d/engine/webgl/WGLBuffers":function(){define(["require","exports","../../../webgl","./Utils"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.geometryMap=
k.createGeometryData(function(b){return{indexBuffer:l.BufferObject.createIndex(a,35044),vao:null}},function(b,e){return{vertexBuffer:l.BufferObject.createVertex(a,k.C_VBO_INFO[e])}})}b.prototype.dispose=function(){for(var a=0;5>a;a++){var b=this.geometryMap[a];if(b){b.data.vao&&b.data.vao.dispose(!1);b.data.indexBuffer&&b.data.indexBuffer.dispose();for(var e in b.buffers)b.buffers[e]&&b.buffers[e].data.vertexBuffer.dispose()}}};b.prototype.get=function(a){var b=this.geometryMap[a];a={};for(var e in b.buffers)a[e]=
b.buffers[e].data.vertexBuffer;return{indexBuffer:b.data.indexBuffer,get vao(){return b.data.vao},set vao(a){b.data.vao=a},vertexBufferMap:a}};b.prototype.has=function(a){return null!=this.geometryMap[a]};b.prototype.upload=function(a,b){var e=this;b.forEach(function(b,f){e._upload(b,f,a)})};b.prototype._upload=function(a,b,e){a.indices&&(a.indices.allDirty?this._uploadIndices(e,b):null!=a.indices.from&&null!=a.indices.count&&this._uploadIndices(e,b,a.indices.from,a.indices.count));if(a.vertices){a=
a.vertices;for(var d in a){var f=a[d];f.allDirty?this._uploadVertices(e,b,d):null!=f.from&&null!=f.count&&this._uploadVertices(e,b,d,f.from,f.count)}}};b.prototype._uploadVertices=function(a,b,e,d,f){var c=this.geometryMap[b];c&&(b=a.geometries[b].vertexBuffer[e])&&(a=b.stride,b=b.data.buffer,c.buffers[e]&&0<b.byteLength&&(null!=d&&null!=f?c.buffers[e].data.vertexBuffer.setSubData(b,d*a,d*a,(d+f)*a):c.buffers[e].data.vertexBuffer.setData(b)))};b.prototype._uploadIndices=function(a,b,e,d){var f=this.geometryMap[b];
f&&(a=a.geometries[b].indexBuffer.buffer,f.data.indexBuffer&&0<a.byteLength&&(null!=e&&null!=d?f.data.indexBuffer.setSubData(a,4*e,4*e,4*(e+d)):f.data.indexBuffer.setData(a)))};return b}();b.default=n})},"esri/views/2d/engine/webgl/shaders/MagnifierPrograms":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.magnifier={name:"magnifier",shaders:{vertexShader:k.resolveIncludes("magnifier/magnifier.vert"),
fragmentShader:k.resolveIncludes("magnifier/magnifier.frag")},attributes:{a_pos:0}};b.createMagnifierProgram=function(h){return l.createProgram(h,b.magnifier)}})},"esri/views/2d/engine/BitmapTileContainer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry/support/aaBoundingRect ../engine ./BitmapTile ./webgl/enums ./webgl/TileContainer".split(" "),function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});
n=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);c.prototype.createTile=function(a){var b=this._tileInfoView.getTileBounds(h.create(),a);return new g.BitmapTile(a,b,this._tileInfoView.tileInfo.size)};c.prototype.destroyTile=function(a){};c.prototype.prepareRenderPasses=function(c){var d=this,f=c.registerRenderPass({name:"bitmap (tile)",brushes:[a.brushes.Bitmap],target:function(){return d.children.map(function(a){return a.bitmap})},drawPhase:e.WGLDrawPhase.MAP});return b.prototype.prepareRenderPasses.call(this,
c).concat([f])};c.prototype.doRender=function(a){this.visible&&a.drawPhase===e.WGLDrawPhase.MAP&&b.prototype.doRender.call(this,a)};return c}(d.default);b.BitmapTileContainer=n})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(b){this.type=b}}();b.RenderBucket=n;var k=function(b){function a(){var a=b.call(this,2)||this;a.triangleElementStart=
0;a.triangleElementCount=0;return a}l(a,b);a.prototype.hasData=function(){return 0<this.triangleElementCount};a.prototype.triangleCount=function(){return this.triangleElementCount/3};return a}(n);b.LineRenderBucket=k;k=function(b){function a(){var a=b.call(this,1)||this;a.triangleElementStart=0;a.triangleElementCount=0;a.outlineElementStart=0;a.outlineElementCount=0;return a}l(a,b);a.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};a.prototype.triangleCount=
function(){return(this.triangleElementCount+this.outlineElementCount)/3};return a}(n);b.FillRenderBucket=k;k=function(b){function a(){var a=b.call(this,3)||this;a.markerPerPageElementsMap=new Map;a.glyphPerPageElementsMap=new Map;a.isSDF=!1;return a}l(a,b);a.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};a.prototype.triangleCount=function(){var a=0;this.markerPerPageElementsMap.forEach(function(b){a+=b[1]});this.glyphPerPageElementsMap.forEach(function(b){a+=
b[1]});return a/3};return a}(n);b.SymbolRenderBucket=k;k=function(b){function a(){var a=b.call(this,4)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}l(a,b);a.prototype.hasData=function(){return 0<this.triangleElementCount};a.prototype.triangleCount=function(){return this.triangleElementCount/3};return a}(n);b.CircleRenderBucket=k;n=function(b){function a(){return b.call(this,0)||this}l(a,b);a.prototype.hasData=function(){return!0};a.prototype.triangleCount=function(){return 2};
return a}(n);b.BackgroundRenderBucket=n})},"esri/views/3d/terrain/ElevationBounds":function(){define(["require","exports","../../../core/tsSupport/extendsHelper"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a){void 0===b&&(b=0);void 0===a&&(a=0);this.min=b;this.max=a;this.level=0;this.hasNoDataValues=!1}b.prototype.copyFrom=function(b){this.min=b.min;this.max=b.max;this.level=b.level;this.hasNoDataValues=b.hasNoDataValues};return b}();b.ElevationBounds=
n})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../core/mathUtils","../support/mathUtils","./TerrainConst"],function(n,b,l,k,h){return function(){function a(a,b,d,f){this.samplerData=null;this.level=a;this.i=b;this.j=d;this.extent=f}a.prototype.release=function(){this.bounds=this.samplerData=null};a.prototype.computeMinMaxValue=function(a,b,d,f){f.min=Infinity;f.max=-Infinity;f.hasNoDataValues=!1;a-=this.level;if(0>=a)return f;var c=Math.pow(2,a);if(Math.floor(b/
c)!==this.i||Math.floor(d/c)!==this.j)return f;var e=Infinity,g=-Infinity,l=this.samplerData.width,n=this.samplerData.pixelData,x=.5*h.ELEVATION_NODATA_VALUE;a=(l-1)/c;d=(d-this.j*c)*a;var w=(b-this.i*c)*a;if(1>a){var u=Math.floor(d),y=Math.floor(w),m=u+y*l;b=n[m];var c=n[m+1],v=n[m+l],m=n[m+l+1];if(b+c+v+m<x)return e=d-u,x=w-y,g=k.bilerp(b,c,v,m,e,x),l=k.bilerp(b,c,v,m,e+a,x),n=k.bilerp(b,c,v,m,e,x+a),a=k.bilerp(b,c,v,m,e+a,x+a),f.min=Math.min(g,l,n,a),f.max=Math.max(g,l,n,a),f;d=u;w=y;a=1}else d=
Math.floor(d),w=Math.floor(w),a=Math.ceil(a);for(b=d;b<=d+a;b++)for(c=w;c<=w+a;c++)m=b+c*l,v=n[m],v<x?(e=Math.min(e,v),g=Math.max(g,v)):f.hasNoDataValues=!0;f.min=e;f.max=g;return f};a.create=function(b,e,d){b=new a(b[0],b[1],b[2],e);e=d.noDataValue;for(var f=d.values,c=Infinity,g=-Infinity,h=!0,k=!1,l=0;l<f.length;l++){var n=f[l];n!==e?(c=n<c?n:c,g=n>g?n:g,h=!1):k=!0}h&&(g=c=0);g=-3E38<g?g:0;b.samplerData={pixelData:d.values,width:d.width,height:d.height,minValue:c,maxValue:g,noDataValue:e,safeWidth:.99999999*
(d.width-1),dx:(d.width-1)/(b.extent[2]-b.extent[0]),dy:(d.width-1)/(b.extent[3]-b.extent[1]),x0:b.extent[0],y1:b.extent[3]};b.bounds=[c,g];b.hasNoDataValues=k;return b};a.sample=function(a,b,d){for(var e=0;e<d.length;e++){var c=d[e];if(c){var g=c.safeWidth,k=c.width,r=c.pixelData,n=l.clamp(c.dy*(c.y1-b),0,g),c=l.clamp(c.dx*(a-c.x0),0,g),g=Math.floor(n),x=Math.floor(c),w=g*k+x,u=w+k,y=r[w],k=r[u],w=r[w+1],r=r[u+1];if(y+k+w+r<.5*h.ELEVATION_NODATA_VALUE)return n-=g,c-=x,a=y+(w-y)*c,a+(k+(r-k)*c-a)*
n}}return null};return a}()})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgent".split(" "),function(n,b,l,k,h,a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._scaleRangeEnabled=!1;return b}l(b,a);b.prototype._desiredMinLevelDelta=function(){return h.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])};b.Pool=new k(b);return b}(a.TileAgent)})},
"esri/views/3d/terrain/TileAgent":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./TerrainConst","./tileUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=Error("Abstract method called on TileAgent");n=function(){function a(){}Object.defineProperty(a.prototype,"updating",{get:function(){return!!this._tileRequested},enumerable:!0,configurable:!0});a.prototype.init=function(a,b,f,c){this.tile=a;this._layerIdx=b;this._layerClass=f;this._suspended=
c;this._tileLayerInfo=a.getLayerInfo(b,f);this._tileRequested=null;a=this._findAncestorWithData();this._setUpsampleTile(a)};a.prototype.startLoading=function(){return this._requestNext()};a.prototype.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null};a.prototype.setSuspension=function(a){a!==this._suspended&&((this._suspended=a)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,
this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};a.prototype.update=function(){var a=this._findAncestorWithData();this._setUpsampleTile(a);return this._requestNext()};a.prototype.dataArrived=function(a){this._setUpsampleTile(a);this._tileRequested=null;a===this.tile?this.tile.updateRenderData(this._layerClass):this._requestNext()};a.prototype.dataMissing=function(a){this._tileRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};a.prototype._agentDone=
function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};a.prototype._requestNext=function(){if(this._suspended)return!0;var a=this._findNextDownload();if(this._tileRequested){if(a===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}a?a.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=a):this._agentDone();return!!this._tileRequested};a.prototype._findNextDownload=function(){for(var a=
this._layerIdx,b=this._layerClass,f=this.tile.surface.layerViewByIndex(a,b),c=f.layer,g=f.dataLevelRange,f=g.minLevel,g=g.maxLevel,l=this._desiredMinLevelDelta(),r=k.START_LOADING_LEVEL_DELTA+l,n=this._scaleRangeEnabled?h.fallsWithinLayer:function(){return!0},x,w=this.tile,u=0,y=this._tileLayerInfo.upsampleFromTile,y=y?y.tile.level:-1,m=this.tile.surface,v=m.getTilemapTile(w);w&&n(w,c,!1)&&w.level>=f;){var z=w.level,B=w.layerInfo[b][a];if(B.data&&u>=l){z>y&&this._setUpsampleTile(w);B.dataInvalidated&&
(x=w);break}if((!v||v.hasDataAvailable(w,a,b))&&z<=g&&!B.data&&!B.dataMissing){if(!x||0===z%k.LOADING_LEVEL_MODULO||this.tile.level-x.level<l)x=w;if(u>=r)break}(w=w.parent)&&v&&(v=v.parent||m.getTilemapTile(w));u++}x&&this.tile.level-x.level<l&&this._tileLayerInfo.upsampleFromTile&&(x=null);return x};a.prototype._findAncestorWithData=function(){for(var a=this.tile.vlevel,b=this._desiredMinLevelDelta(),f,c=this.tile;c;c=c.parent)if(c.hasLayerData(this._layerIdx,this._layerClass)){if(a-c.level>=b)return c;
f=c}return f};a.prototype._setUpsampleTile=function(a){this._tileLayerInfo.setUpsampleInfo(this.tile,a);this.tile.updateRenderData(this._layerClass)};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{findNextDownload:function(){return a._findNextDownload()},tileLayerInfo:this._tileLayerInfo}},enumerable:!0,configurable:!0});return a}();b.TileAgent=n;n=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}l(e,b);e.prototype._desiredMinLevelDelta=function(){throw a;
};return e}(n);b.TILE_AGENT_DONE=new n})},"esri/views/3d/terrain/tileUtils":function(){define(["require","exports","../../../core/maybe","../../../core/PooledArray"],function(n,b,l,k){function h(a){return a[0]+"/"+a[1]+"/"+a[2]}function a(b,e){e(b);if(!b.isLeaf){var c=0;for(b=b.children;c<b.length;c++)a(b[c],e)}}function g(a,b,c){a=a.screenDepth;b=b.screenDepth;return a<b?-c:a>b?c:0}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(){this.q=new k;this._last=null}Object.defineProperty(a.prototype,
"done",{get:function(){return 0===this.q.length&&(!this._last||this._last.isLeaf)},enumerable:!0,configurable:!0});a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null};a.prototype.reset=function(a,b){this.q.clear();this._eye=b;if(a&&(this.q.pushArray(a),l.isSome(this._eye))){var c=this._eye;this.q.sort(function(a,b){return b.distanceToSquared(c)-a.distanceToSquared(c)})}this._last=null};a.prototype.skipSubtree=function(){this._last=null};a.prototype.next=function(){if(this._last&&
!this._last.isLeaf){var a=this._last.children;if(l.isSome(this._eye)){var b=this._eye;e.pushArray(a);e.sort(function(a,c){return c.distanceToSquared(b)-a.distanceToSquared(b)});this.q.pushArray(e.data,e.length);e.clear()}else this.q.pushArray(a)}return this._last=this.q.pop()};return a}();b.IteratorPreorder=n;var e=new k;n=function(){function a(){this.q=new k}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length},enumerable:!0,configurable:!0});a.prototype.reset=function(a){this.q.clear();
if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a){var b=this.q.data[a];b.isLeaf||this.q.pushArray(b.children)}};a.prototype.next=function(){return this.q.pop()};return a}();b.IteratorPostorder=n;b.lij2str=h;b.tile2str=function(a){return h(a.lij)};b.traverseTilesPreorder=function(b,e){if(Array.isArray(b))for(var c=0;c<b.length;c++)a(b[c],e);else a(b,e)};b.findParentByLIJ=function(a,b){for(;a;a=a.parent)if(a.hasLij(b))return a;return null};b.fallsWithinLayer=function(a,b,c){if(!b)return!1;var d=
b.fullExtent,e=a.extent;if(c){if(e[0]<d.xmin||e[1]<d.ymin||e[2]>d.xmax||e[3]>d.ymax)return!1}else if(d.xmin>e[2]||d.ymin>e[3]||d.xmax<e[0]||d.ymax<e[1])return!1;a=a.surface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};b.getTileNLevelsUp=function(a,b){for(;b--;)a=a.parent;return a};b.getRootTile=function(a){for(;a.parent;)a=a.parent;return a};b.nextTileInAncestry=function(a,b){var c=a.lij[0]-b.lij[0]-1,d=a.lij[2]>>c,e=
0;a.lij[1]>>c&1&&(e+=2);d&1&&(e+=1);return b.children[e]};b.sortTiles=function(a,b){b.sort(function(b,d){return g(b,d,a)})};b.compareTiles=g;b.computeUpsampleInfo=function(a,b,c){for(var d=1,e=0,f=0;a!==b;)if(d*=.5,e*=.5,f*=.5,a.lij[2]&1&&(e+=.5),0===(a.lij[1]&1)&&(f+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of upsampleTile");c.init(b,e,f,d)};b.hasVisibleSiblings=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.parent;if(d)for(var e=0;4>e;e++){var g=d.children[e];if(g&&
g!==c&&g.visible)return!0}}return!1}})},"esri/views/3d/terrain/MapTileAgent":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/ObjectPool","./TileAgent"],function(n,b,l,k,h){return function(a){function b(){var b=a.call(this)||this;b._scaleRangeEnabled=!0;return b}l(b,a);b.prototype._desiredMinLevelDelta=function(){return 0};b.Pool=new k(b);return b}(h.TileAgent)})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/mathUtils ../../../core/maybe ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../symbols/SimpleMarkerSymbol ../state/utils/viewUtils ../support/animationUtils ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/mathUtils ../support/projectionUtils ../support/stack ../webgl-engine/lib/Intersector ../webgl-engine/lib/localOrigin ../../support/Scheduler".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R){function S(a,b){for(var c=D.TESTS_DISABLE_UPDATE_THRESHOLDS?0:1E-5*Math.max(a[2]-a[0],a[3]-a[1],b[2]-b[0],b[3]-b[1]),d=0;4>d;d++)if(Math.abs(b[d]-a[d])>c)return!0;return!1}Object.defineProperty(b,"__esModule",{value:!0});var T=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],U;n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||
this;b._handles=new g;b._overlaySR=null;b._renderSR=null;b._overlaySREqualsRenderSR=!0;b._connectedLayers=new Map;b._overlays=null;b._renderedAltitude=0;b._placementDirty=!1;b._drawTexturesDirty=!1;b._drawTexturesAnimateDirty=!1;b._isSpherical=!1;b._latestOriginId=0;b._maxResolution=e("esri-mobile")?2048:4096;b._animationTimeLast=0;b.opacity=0;return b}l(b,a);Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});b.prototype.initialize=
function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.renderView.getDrapedRenderer();this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._renderer.onContentChanged=function(){return a.setDrawTexturesDirty()};this._renderer.onUpdatingChanged=function(){return a._setOverlayUpdating()};this._renderer.forceUpdate=function(b){a.updateOverlays(b);a._drawOverlayTextures()};this.groundIntersector=new L(this.view.viewingMode);this.groundIntersector.enable.backfacesTerrain=
!0;this.groundIntersector.enable.invisibleTerrain=!0;this.groundIntersector.enable.hud=!1;this._handles.add([this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],function(){return a.setOverlayPlacementDirty()}),this.terrainSurface.on("elevation-change",function(){return a.setOverlayPlacementDirty()}),this.view.on("resize",function(){return a.setOverlayPlacementDirty()}),this.watch("suspended",function(){return a._setOverlayUpdating()},
!0),q.addFrameTask({preRender:function(b){a.hasOverlays()&&(a._dispatchRendererUpdate(b),a._drawOverlayTextures())}}),this.view.resourceController.scheduler.registerTask(R.Task.OVERLAY_MANAGER,function(){return a.updateOverlays()},function(){return a.needsUpdate()})])};b.prototype.destroy=function(){var a=this;this._connectedLayers.forEach(function(b){return a._unregisterLayerView(b.layerView)});this._disposeOverlays();this._handles&&(this._handles.destroy(),this._handles=null)};b.prototype.onHasHighlightsChanged=
function(){this.setOverlayPlacementDirty();this.notifyChange("hasHighlights")};b.prototype.hasOverlays=function(){return!!this._overlays};b.prototype.setSpatialReference=function(a,b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=b)?a.isWebMercator?new Q.Cyclical(-2.0037508342788905E7,2.0037508342788905E7):new Q.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=
null)};b.prototype.updateLayerViews=function(a){for(var b=this,c=0,d=this.view.allLayerViews.items;c<d.length;c++){var e=d[c];"supportsDraping"in e&&e.supportsDraping&&!this._connectedLayers.has(e.uid)&&this._registerLayerView(e)}this._connectedLayers.forEach(function(c,d){c=c.layerView;a.has(d)||b._unregisterLayerView(c)})};b.prototype._registerLayerView=function(a){var b=this,c=a.uid,d=a.on("draped-data-change",function(){return b.setOverlayPlacementDirty()});this._connectedLayers.set(c,{eventHandles:[d],
layerView:a});a.setDrapingExtent&&this._overlays&&this._overlays.forEach(function(c,d){a.setDrapingExtent(d,c.extent,b._overlaySR,c.resolution,c.renderLocalOrigin,c.pixelRatio)});this.setOverlayPlacementDirty();this._setLayerViewOverlayUpdating(a,this.layerViewOverlayUpdating)};b.prototype._unregisterLayerView=function(a){var b=this;this._connectedLayers.forEach(function(c,d){if(c.layerView===a){if(c.eventHandles)for(var e=0;e<c.eventHandles.length;e++)c.eventHandles[e].remove();b._connectedLayers.delete(d);
b.setOverlayPlacementDirty();a.destroyed||b._setLayerViewOverlayUpdating(a,!1)}})};b.prototype.setOverlayPlacementDirty=function(){this._placementDirty||(this._placementDirty=!0,this._setOverlayUpdating())};b.prototype.updateOverlays=function(a){void 0===a&&(a=this.view.state.camera);if(this._overlaySR){var b;b=d.nextHighestPowerOfTwo(Math.max(a.fullWidth,a.fullHeight)+256);var c=Math.min(b,this._maxResolution);this._computeOverlayExtents(a,b,ca);this._initOverlays();this._updateOverlay(0,ca.inner,
c,1);this._updateOverlay(1,ca.outer,c,v.width(ca.inner)/v.width(ca.outer));this.opacity=1;this.terrainSurface.updateTileOverlayParams();this._placementDirty=!1;this.setDrawTexturesDirty();this.terrainSurface.updateOverlayOpacity()}};b.prototype._updateOverlay=function(a,b,c,d){var e=this,f=this._overlays[a];if(S(b,f.extent)||c!==f.resolution||f.pixelRatio!==d)v.set(f.extent,b),f.resolution=c,f.pixelRatio=d,d=v.center(f.extent),f.renderLocalOrigin=M.fromValues(d[0],d[1],0,"OV_"+this._latestOriginId++),
this._connectedLayers.forEach(function(d){d=d.layerView;d.setDrapingExtent&&d.setDrapingExtent(a,b,e._overlaySR,c,f.renderLocalOrigin,f.pixelRatio)})};b.prototype.needsUpdate=function(){return this._placementDirty&&!!this._overlaySR&&!this._get("suspended")&&this.terrainSurface.ready};b.prototype.updateOpacity=function(a){return this._overlays?this._getAltitudeBasedOpacity(a,this._renderedAltitude):1};b.prototype._getAltitudeBasedOpacity=function(a,b){return 3.5*a<b?Math.sqrt(d.clamp((a-b/10)/(b/
3.5-b/10),0,1)):1};b.prototype.setOverlayParamsOfTile=function(a,b,c){var d=this._overlays[0],e=this._overlays[1];a=v.intersection(a.extent,a.surface.extent,da);this._rectInsideRect(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1])):this._rectanglesOverlap(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._setTileOverlayData(a,e,b.overlays[1])):(this._rectanglesOverlap(a,e.extent)?this._setTileOverlayData(a,e,b.overlays[0]):this._invalidateTileOverlayData(b.overlays[0]),
this._invalidateTileOverlayData(b.overlays[1]));b.overlayOpacity=void 0!==c?c:1};b.prototype.overlayPixelSizeInMapUnits=function(a){if(!this._overlays)return 0;var b=this._overlays[0],c=this._overlays[1];a=this._pointIsInExtent(a,b.extent)?b:c;return(a.extent[2]-a.extent[0])/a.resolution};b.prototype._setTileOverlayData=function(a,b,c){var d=b.extent;c.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);c.texScale[1]=(a[3]-a[1])/(d[3]-d[1]);var e=a[0];if(this._longitudeCyclical){var e=this._longitudeCyclical.minimalMonotonic(d[0],
e),f=this._longitudeCyclical.minimalMonotonic(d[0],a[2]);e>f&&(e=f-(a[2]-a[0]))}c.texOffset[0]=(e-d[0])/(d[2]-d[0]);c.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);c.renderTargetId=b.valid?b.renderTargetId:null;c.highlightRenderTargetId=b.highlightValid?b.highlightRenderTargetId:null;c.waterMaskRenderTargetId=b.waterMaskValid?b.waterMaskRenderTargetId:null};b.prototype._invalidateTileOverlayData=function(a){a.renderTargetId=null;a.highlightRenderTargetId=null;a.waterMaskRenderTargetId=null};b.prototype._createEmptyOverlay=
function(a){var b=this._renderer.createRenderTarget("overlay"+a,!0,8,9987),c=this._renderer.createRenderTarget("overlayHighlight"+a,!1,8,9987);a=this._renderer.createRenderTarget("overlayWaterMask"+a,!0,8,9987);return{extent:v.create(),resolution:0,renderTargetId:b,valid:!1,highlightRenderTargetId:c,highlightValid:!1,waterMaskRenderTargetId:a,waterMaskValid:!1,renderLocalOrigin:M.fromValues(0,0,0,"O"),pixelRatio:1}};b.prototype._initOverlays=function(){this._overlays||(this._overlays=[this._createEmptyOverlay(0),
this._createEmptyOverlay(1)])};b.prototype._disposeOverlays=function(){var a=this;this._overlays&&(this._overlays.forEach(function(b){a._renderer.disposeRenderTarget(b.renderTargetId);a._renderer.disposeRenderTarget(b.highlightRenderTargetId);a._renderer.disposeRenderTarget(b.waterMaskRenderTargetId)}),this._overlays=null)};b.prototype._dispatchRendererUpdate=function(a){var b=a.time-this._animationTimeLast;b<C.DESIRED_DRAPED_ANIMATION_MS||(this._animationTimeLast=a.time,this._renderer.updateLogic({dt:b,
camera:this._stage.getCamera()})&&(this._drawTexturesAnimateDirty=!0))};b.prototype.setDrawTexturesDirty=function(){this._overlays?this._drawTexturesDirty||(this._drawTexturesDirty=!0,this._setOverlayUpdating()):this.setOverlayPlacementDirty()};b.prototype._intersectGroundFromView=function(a,b,c,d){var e=p.createRenderScreenPointArray3(b*a.fullWidth,c*a.fullHeight,1),e=a.unprojectPoint(e,N.sv3d.get());b=p.createRenderScreenPointArray3(b*a.fullWidth,c*a.fullHeight,0);b=a.unprojectPoint(b,N.sv3d.get());
this.groundIntersector.intersect([],b,e,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundIntersector,null,b,e);return this.groundIntersector.results.min.getIntersectionPoint(d)};b.prototype._setLayerViewOverlayUpdating=function(a,b){"overlayUpdating"in a&&(a.overlayUpdating=b)};Object.defineProperty(b.prototype,"layerViewOverlayUpdating",{get:function(){return this.needsUpdate()||this._drawTexturesDirty||this._renderer.updating},enumerable:!0,configurable:!0});b.prototype._setOverlayUpdating=
function(){var a=this,b=this.layerViewOverlayUpdating;this._connectedLayers.forEach(function(c){return a._setLayerViewOverlayUpdating(c.layerView,b)});var d=this.view.graphicsView;c.isSome(d)&&(d.overlayUpdating=b)};b.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var e=.5;if("global"===this.view.viewingMode){e=w.vec3f64.clone(a.eye);x.vec3.normalize(e,e);x.vec3.negate(e,e);b=x.vec3.length(b);b=Math.asin(b/x.vec3.length(a.eye));var f=Math.acos(x.vec3.dot(a.viewForward,e)),e=d.clamp((b-
(f-.5*a.fovY))/a.fovY,0,1);b=d.clamp((-b-(f-.5*a.fovY))/a.fovY,0,1);e=1===e&&0===b?.5:b+.55*(e-b)}else e=y.vec4f64.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0),e=u.vec4.transformMat4(e,e,a.projectionMatrix)[1],e=d.clamp(.5+.5*e,0,1),e=1===e||0===e?.5:0<a.eye[2]?.55*e:1-.55*(1-e);return this._intersectGroundFromView(a,.5,e,c)?!0:!1};b.prototype._computeOverlayExtents=function(a,b,c){var d=this.terrainSurface.extent,e=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,
g=w.vec3f64.create();this._findHorizonBasedPointOfInterest(a,e,g)||x.vec3.copy(g,e);this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(a.eye);var k=x.vec3.distance(a.eye,g),e=B.viewAngle(this.view.renderCoordsHelper,e,a.eye),e=Math.PI/2-Math.abs(e-Math.PI/2);if(K.OVERLAY_SHOW_CENTER){var l=new z({color:[255,0,0],outline:{color:[255,255,255],width:2}}),p=new m;J.vectorToPoint(g,this._renderSR,p,this._overlaySR);l=new h({geometry:p,symbol:l});void 0!==U&&this.view.graphics.remove(U);this.view.graphics.add(l);
U=l}this._overlaySREqualsRenderSR||J.vectorToVector(g,this._renderSR,g,this._overlaySR);b=b*a.perRenderPixelRatio*k/2;p=!1;k=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(b/=Math.cos(J.webMercator.y2lat(g[1])),k=this.terrainSurface.extent[3],k*=.999):(p=!0,b/=I.metersPerDegree,k=90),b>=k&&(b=k,g[1]=0,this._overlaySR.isWebMercator&&(g[0]=0)));l=1;p&&(l=1/Math.max(.2,Math.cos(Math.abs(f.deg2rad(g[1])))),180<b*l&&(l=180/b));var q=b*l,p=c.inner;p[0]=g[0]-q;p[1]=g[1]-b;p[2]=g[0]+q;p[3]=g[1]+
b;this._isSpherical&&this._shiftExtentToFitBounds(p,Infinity,k);c=c.outer;v.set(c,p);6*q>d[2]-d[0]?v.set(c,d):e<=.25*Math.PI?(c[0]-=q,c[1]-=b,c[2]+=q,c[3]+=b):(J.vectorToVector(a.eye,this._renderSR,Z,this._overlaySR),t.vec2.subtract(V,g,Z),a=-Math.atan2(V[1],V[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),u.vec4.scale(V,T[Math.floor(a/(.25*Math.PI))],2*b),V[0]*=l,V[2]*=l,u.vec4.add(c,c,V));this._isSpherical&&(c[0]=this._longitudeCyclical.clamp(c[0]),c[2]=this._longitudeCyclical.clamp(c[2]),c[1]=Math.max(c[1],
-k),c[3]=Math.min(c[3],k));!this._isSpherical&&d&&(a=v.intersection(p,d,da),d=v.intersection(c,d,F),v.contains(a,d)&&(c[2]=c[0],c[3]=c[1]))};b.prototype._drawOverlayTextures=function(){if(this._drawTexturesDirty||this._drawTexturesAnimateDirty){var a=this._drawOverlay(0),b=this._drawOverlay(1);0!==a&&0!==b||this.terrainSurface.updateTileOverlayParams();this._drawTexturesDirty?(this._drawTexturesAnimateDirty=this._drawTexturesDirty=!1,this._setOverlayUpdating(),this.terrainSurface.requestRender(),
this.terrainSurface.setPendingUpdates()):(this._drawTexturesAnimateDirty=!1,this._setOverlayUpdating(),this.terrainSurface.requestRender(0))}};b.prototype._drawOverlay=function(a){var b=this._overlays[a],c=b.valid,d=b.highlightValid,e=b.waterMaskValid,f=b.extent,g=b.resolution,h=b.pixelRatio,k=this._longitudeCyclical?f[2]>this._longitudeCyclical.max:!1,m=this._longitudeCyclical?f[0]<this._longitudeCyclical.min:!1;if(k||m){Y.views=P;var m=Math.round((k?this._longitudeCyclical.max-f[0]:this._longitudeCyclical.min-
f[0])/(f[2]-f[0])*g),l=Y.views[0];u.vec4.set(l.viewport,0,0,m,g);u.vec4.set(l.extent,f[0],f[1],this._longitudeCyclical.max,f[3]);k||(l.extent[0]+=this._longitudeCyclical.range);l=Y.views[1];u.vec4.set(l.viewport,m,0,g-m,g);u.vec4.set(l.extent,this._longitudeCyclical.min,f[1],f[2],f[3]);k&&(l.extent[2]-=this._longitudeCyclical.range)}else Y.views=X,v.set(Y.views[0].extent,f),u.vec4.set(Y.views[0].viewport,0,0,g,g);Y.width=g;Y.height=g;Y.pixelRatio=h*this.view.state.camera.pixelRatio;Y.index=a;g=this._renderer;
a=g.draw(b.renderTargetId,Y);f=g.drawHighlights(b.highlightRenderTargetId,Y);g=g.drawNormals(b.waterMaskRenderTargetId,Y);b.valid=a;b.highlightValid=f;b.waterMaskValid=g;return a!==c||f!==d||g!==e?0:1};b.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):v.intersects(a,b)};b.prototype._rectInsideRect=
function(a,b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:v.contains(b,a)};b.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};b.prototype._shiftExtentToFitBounds=function(a,b,c){var d=0,e=0;a[0]<-b?d=a[0]+b:a[2]>b&&(d=b-a[2]);a[1]<-c?e=a[1]+c:
a[3]>c&&(e=c-a[3]);v.offset(a,d,e)};Object.defineProperty(b.prototype,"test",{get:function(){return{overlays:this._overlays,renderer:this._renderer}},enumerable:!0,configurable:!0});k([r.property()],b.prototype,"view",void 0);k([r.property()],b.prototype,"terrainSurface",void 0);k([r.property({readOnly:!0,aliasOf:"terrainSurface.suspended"})],b.prototype,"suspended",void 0);k([r.property({type:Boolean})],b.prototype,"hasHighlights",null);return b=k([r.subclass("esri.views.3d.terrain.OverlayManager")],
b)}(r.declared(a));b.OverlayManager=n;var Y={width:0,height:0,pixelRatio:0,views:null,index:0},X=[{viewport:v.create(),extent:v.create()}],P=[X[0],{viewport:v.create(),extent:v.create()}],V=y.vec4f64.create(),Z=w.vec3f64.create(),ca={inner:v.create(),outer:v.create()},da=v.create(),F=v.create()})},"esri/views/3d/support/animationUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.DESIRED_ANIMATION_FPS=25;b.DESIRED_ANIMATION_MS=1E3/b.DESIRED_ANIMATION_FPS;
b.DESIRED_DRAPED_ANIMATION_FPS=20;b.DESIRED_DRAPED_ANIMATION_MS=1E3/b.DESIRED_DRAPED_ANIMATION_FPS})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.fromVector=function(b,h){return{vec3:l.vec3f64.clone(b),id:h}};b.fromValues=function(b,h,a,g){return{vec3:l.vec3f64.fromValues(b,h,a),id:g}}})},"esri/views/3d/terrain/PlanarPatch":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../support/geometryUtils ./PatchGeometryFactory ./Tile".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,e,f){var c=b.call(this,d.NumSubdivisionsAtLevel)||this;void 0!==a&&c.init(a,e,f);return c}l(d,b);d.prototype.init=function(a,d,e){b.prototype.init.call(this,a,d,e);this._edgeLen=this.extent[2]-this.extent[0];this._edgeLen2=this._edgeLen*this._edgeLen;this.centerAtSeaLevel[0]=k.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=k.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=
0;this.updateRadiusAndCenter()};d.prototype.updateRadiusAndCenter=function(){this._updateCenter();var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,b=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._radius=Math.sqrt(a*a+b*b)};d.prototype._isVisible=function(){return this.intersectsClippingArea&&a.frustum.intersectsAABB(this.surface.frustum.planes,h.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))};d.prototype.createGeometry=
function(a,b){g.createPlanarGlobePatch(a,this.extent,b,this.renderData);this.setMemoryDirty()};d.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];return d}(e.Tile);b.PlanarPatch=n})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../geometry/support/aaBoundingBox ../support/earthUtils ../support/buffer/BufferPool ../support/buffer/InterleavedLayout ./ElevationData ./TerrainConst ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(a,b,c,d){var e=0<(c&2),f=b+(d?1024:0)+(e?2048:0),g=v.get(f);if(!g){var g=b-1,h=b-1,k=b*b,m=2*g+2*h,l=g*h*6,p=6*m,q=6*(2*g+h-1);d&&(l*=2,p*=2,q*=2);for(var m=65536<k+m?new Uint32Array(l+p):new Uint16Array(l+p),r=0,n=0,t=l,y,x,w,z,B=0,C=0;C<=h;C++){e&&(B=0===C?q:C===h?-q:0);for(var t=t+B,L=0;L<=g;L++)w=u(L,C,g,h),-1<w&&(z=0===C&&L!==g?1:L===g&&C!==h?g+1:C===h&&0!==L?-1:0===L&&0!==C?-(g+1):0,0!==z&&(y=r,x=k+w,w=k+(0===L&&1===C?0:w+1),z=r+z,d?(m[t+0]=y,
m[t+1]=x,m[t+2]=x,m[t+3]=w,m[t+4]=w,m[t+5]=y,m[t+6]=w,m[t+7]=z,m[t+8]=z,m[t+9]=y,m[t+10]=y,m[t+11]=w,t+=12):(m[t+0]=y,m[t+1]=x,m[t+2]=w,m[t+3]=w,m[t+4]=z,m[t+5]=y,t+=6))),++r,L<g&&C<h&&(y=C*(g+1)+L,x=y+1,w=x+(g+1),z=w-1,d?(m[n+0]=y,m[n+1]=x,m[n+2]=x,m[n+3]=w,m[n+4]=w,m[n+5]=y,m[n+6]=w,m[n+7]=z,m[n+8]=z,m[n+9]=y,m[n+10]=y,m[n+11]=w,n+=12):(m[n+0]=y,m[n+1]=x,m[n+2]=w,m[n+3]=w,m[n+4]=z,m[n+5]=y,n+=6));t-=B}g={values:m,numSurfaceIndices:l,numSkirtIndices:p};v.set(f,g)}a.indices=g.values;a.numSurfaceIndices=
g.numSurfaceIndices;a.numSkirtIndices=g.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function x(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function w(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function u(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(b,"__esModule",{value:!0});var y=f.newLayout().vec3f(p.VertexAttrConstants.POSITION).vec2f(p.VertexAttrConstants.UV0),
m=new d.BufferPool(function(a){return y.createBuffer(a)},function(a){return a.count});b.clearCaches=function(){m.clear();v.clear()};b.releaseGeometry=function(a){m.release(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};b.createSphericalGlobePatch=function(b,d,f,h,k,p,r){var n=k[0],v=k[1],y=k[2];k=k[3];var z=.1*e.earthRadius*(k-v),L=b.numVertsPerRow-1,N=b.numVertsPerRow-1,R=b.numVertsPerRow*b.numVertsPerRow,S=m.acquire(R+(2*L+2*N)),J=S.position.typedBuffer,M=S.uv0.typedBuffer,I=h.geometryInfo.boundingBox;
g.empty(I);var T=d[2]-d[0],Q=d[3]-d[1],va=y-n,y=f[0],fa=f[1];f=f[2];for(var xa=0;xa<=L;xa++){var ia=xa/L,na=n+ia*va;B[xa]=Math.sin(na);C[xa]=Math.cos(na);D[xa]=ia;K[xa]=d[0]+ia*T}n=p&&!!(r&1);T=p&&!!(r&2);for(na=va=0;na<=N;na++){var wa=na/N,xa=l.lerp(v,k,wa),Ca=Math.cos(xa),ua=Math.sin(xa),ya=void 0;p?(ya=e.halfEarthRadius*Math.log((1+ua)/(1-ua)),wa=(ya-d[1])/Q):ya=180*xa/Math.PI;for(xa=0;xa<=L;xa++){var ia=D[xa],G=B[xa],Ea=C[xa],za=e.earthRadius;b.samplerData&&(za+=c.sample(K[xa],ya,b.samplerData)||
0);Ea=Ea*Ca*za-y;G=G*Ca*za-fa;za=ua*za-f;x(Ea,G,za,I);var H=q.GEOMETRY_VERTEX_STRIDE*va;J[H+0]=Ea;J[H+1]=G;J[H+2]=za;M[H+0]=ia;M[H+1]=wa;H=u(xa,na,L,N);if(-1<H){var H=q.GEOMETRY_VERTEX_STRIDE*(R+H),qa=n&&0===na?-1:T&&na===N?1:0,Ea=0===qa?Ea:-y,G=0===qa?G:-fa,za=0===qa?za:e.earthRadius*qa-f;J[H+0]=Ea;J[H+1]=G;J[H+2]=za;M[H+0]=0===qa?w(ia,wa):ia;M[H+1]=0===qa?z:wa;0!==qa&&x(Ea,G,za,I)}++va}}h.geometryInfo.numVertsPerRow=b.numVertsPerRow;h.geometryInfo.vertexAttributes=S;h.geometryInfo.skirtLength=z;
a.vec4.set(h.geometryInfo.uvOffsetAndScale,0,0,1,1);t(h.geometryInfo,b.numVertsPerRow,p?r:0,b.wireframe)};b.createPlanarGlobePatch=function(b,d,e,f){var h=d[0],k=d[1],l=d[2]-h,p=d[3]-k,r=b.clippingArea,n=r?Math.max(0,(r[0]-d[0])/l):0,v=r?Math.max(0,(r[1]-d[1])/p):0,y=r?Math.min(1,(r[2]-d[0])/l):1;d=r?Math.min(1,(r[3]-d[1])/p):1;var z=y>n?1/(y-n):1,B=d>v?1/(d-v):1,C=-n*z,L=-v*B,D=.1*l,N=b.numVertsPerRow-1,J=b.numVertsPerRow-1,I=b.numVertsPerRow*b.numVertsPerRow,M=m.acquire(I+(2*N+2*J)),K=M.position.typedBuffer,
Q=M.uv0.typedBuffer,ia=f.geometryInfo.boundingBox;g.empty(ia);for(var na=0,wa=0;wa<=J;wa++){var Ca=wa/J,ua=L+Ca*B,Ca=k+Ca*p;r&&(Ca<r[1]?(Ca=r[1],ua=0):Ca>r[3]&&(Ca=r[3],ua=1));for(var ya=0;ya<=N;ya++){var G=ya/N,Ea=C+G*z,G=h+G*l;r&&(G<r[0]?(G=r[0],Ea=0):G>r[2]&&(G=r[2],Ea=1));var za=b.samplerData?c.sample(G,Ca,b.samplerData)||0:0,G=G-e[0],H=Ca-e[1],za=za-e[2];x(G,H,za,ia);var qa=q.GEOMETRY_VERTEX_STRIDE*na;K[qa+0]=G;K[qa+1]=H;K[qa+2]=za;Q[qa+0]=Ea;Q[qa+1]=ua;qa=u(ya,wa,N,N);-1<qa&&(qa=q.GEOMETRY_VERTEX_STRIDE*
(I+qa),K[qa+0]=G,K[qa+1]=H,K[qa+2]=za,Q[qa+0]=w(Ea,ua),Q[qa+1]=D);++na}}f.geometryInfo.numVertsPerRow=b.numVertsPerRow;f.geometryInfo.vertexAttributes=M;f.geometryInfo.skirtLength=D;a.vec4.set(f.geometryInfo.uvOffsetAndScale,n,v,y-n,d-v);t(f.geometryInfo,b.numVertsPerRow,0,b.wireframe)};var v=new Map,z=Math.pow(2,-52);b.intersectSkirts=function(a,b,c,d,e,f,g,h){var m=f.position;f=f.uv0;var l=a[0],p=a[1];a=a[2];var q=b[0]-l,n=b[1]-p;for(b=b[2]-a;c<d;c++){var v=3*c,t=3*c+1,u=3*c+2,y=m.get(e[v],0),w=
m.get(e[v],1),x=m.get(e[v],2),B=m.get(e[t],0),C=m.get(e[t],1),L=m.get(e[t],2),D=m.get(e[u],0),N=m.get(e[u],1),R=m.get(e[u],2),v=f.get(e[v],0),t=f.get(e[t],0),u=f.get(e[u],0);2<=v&&(k.vec3.set(I,y,w,x),g(I),y+=I[0],w+=I[1],x+=I[2]);2<=t&&(k.vec3.set(I,B,C,L),g(I),B+=I[0],C+=I[1],L+=I[2]);2<=u&&(k.vec3.set(I,D,N,R),g(I),D+=I[0],N+=I[1],R+=I[2]);var B=B-y,C=C-w,L=L-x,D=D-y,N=N-w,R=R-x,v=n*R-N*b,t=b*D-R*q,S=q*N-D*n,u=B*v+C*t+L*S,y=l-y,J=p-w,M=a-x,x=J*L-C*M,w=M*B-L*y,K=y*C-B*J;if(u>z){y=y*v+J*t+M*S;if(0>
y||y>u)continue;v=q*x+n*w+b*K;if(0>v||y+v>u)continue}else if(u<-z){y=y*v+J*t+M*S;if(0<y||y<u)continue;v=q*x+n*w+b*K;if(0<v||y+v<u)continue}else continue;x=(D*x+N*w+R*K)/u;0<=x&&(B=r.computeNormal(B,C,L,D,N,R,Q),h(x,B,c))}};var B=Array(q.MAX_PATCH_TESSELATION+1),C=Array(q.MAX_PATCH_TESSELATION+1),D=Array(q.MAX_PATCH_TESSELATION+1),K=Array(q.MAX_PATCH_TESSELATION+1),I=h.vec3f64.create(),Q=h.vec3f64.create()})},"esri/views/3d/support/buffer/BufferPool":function(){define(["require","exports","../../../../core/PooledArray"],
function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a){this._factoryCallback=b;this._lengthCallback=a;this._pool=new Map}b.prototype.acquire=function(h){if(!b.test.disabled){var a=this._pool.get(h);if(a&&0!==a.length)return a.pop()}try{return this._factoryCallback(h)}catch(e){var a=window.performance&&window.performance.memory,g="";a&&(g="\n  totalJSHeapSize: "+a.totalJSHeapSize+", usedJSHeapSize: "+a.usedJSHeapSize+", jsHeapSizeLimit: "+a.jsHeapSizeLimit);console.log("Array allocation of size "+
h+" failed: "+e+g);throw e;}};b.prototype.release=function(h){if(!b.test.disabled){var a=this._lengthCallback(h),g=this._pool.get(a);g||(g=new l({shrink:!0}),this._pool.set(a,g));g.push(h)}};b.prototype.clear=function(){this._pool.clear()};Object.defineProperty(b.prototype,"test",{get:function(){return{size:this._pool.size}},enumerable:!0,configurable:!0});b.test={disabled:!1};return b}();b.BufferPool=n})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../2d/engine/vectorTiles/VectorTileDisplayObject ./ElevationBounds ./ElevationTileAgent ./MapTileAgent ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./tileUtils ../../webgl/Texture ../../webgl/Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B){function C(a){a.dispose();a instanceof t?t.Pool.release(a):a instanceof x&&x.Pool.release(a)}Object.defineProperty(b,"__esModule",{value:!0});var D=u.weakAssert,K=d.vec3f64.create(),I=d.vec3f64.create(),Q=c.vec4f64.create();n=function(){return function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0}}();b.SplitLimits=n;n=function(){function b(a){this._numSubdivisionAtLevel=
a;this.lij=[0,0,0];this._children=[null,null,null,null];this._dirty=!0;this.extent=q.create();this._elevationBounds=g.vec2f64.create();this.layerInfo=Array(2);this.extentInRadians=q.create();this.centerAtSeaLevel=d.vec3f64.create();this._center=d.vec3f64.create();this.up=d.vec3f64.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._maxTesselation=0;this._usedMemory=N;this._curvatureHeight=this._radius=this._edgeLen2=this._edgeLen=this.renderOrder=this.screenDepth=
0}Object.defineProperty(b.prototype,"usedMemory",{get:function(){for(var a=0,b=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b].data;d instanceof p&&(a+=d.getMemoryUsage())}this._usedMemory===N&&this._updateMemoryUsed();return this._usedMemory+a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxTesselation",{get:function(){return this._maxTesselation},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"numSubdivisionsAtLevel",{get:function(){return this._numSubdivisionAtLevel},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isWithinClippingArea",{get:function(){return this._isWithinClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"intersectsClippingArea",{get:function(){return this._intersectsClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"clippingArea",{get:function(){return this._clippingArea},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"parent",{get:function(){return this._parent},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"surface",{get:function(){return this._surface},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"level",{get:function(){return this.lij[0]},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"edgeLen",{get:function(){return this._edgeLen},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){if(this._dirty){var a=this._isVisible();a!==this._visible&&(this._visible=a,this.updateAgentSuspension(),this._visible=a);this._dirty=!1}return this._visible},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"rendered",{get:function(){return!!this.renderData},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"shouldRender",{get:function(){if(!this.visible)return!1;if(this.surface.reduceTileLevelDifferences){var a=this.level-this._surface.snapLevel;if(0===a)return!0;if(1===a)return!1}return this.isLeaf},enumerable:!0,configurable:!0});b.prototype.init=function(b,c,d){this.lij[0]=b[0];this.lij[1]=b[1];this.lij[2]=b[2];d.tilingScheme.getExtent(b[0],b[1],b[2],this.extent,this.extentInRadians);
this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._radius=this._edgeLen2=this._edgeLen=0;this.vlevel=b?b[0]:0;c&&c._elevationBounds?a.vec2.copy(this._elevationBounds,c.elevationBounds):a.vec2.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;this._visible=!1;this._parent=c;this.unsetChildren();this._surface=d;this.updateVisibility();for(b=0;2>b;b++){c=d.numLayers(b);var e=this.layerInfo[b];this.layerInfo[b]?e.length=
c:(e=Array(c),this.layerInfo[b]=e);for(var f=0;f<c;f++)e[f]=m.TilePerLayerInfo.makeEmptyLayerInfo(b,this._surface.upsampleInfoPool,e[f]),0===b&&this.findElevationBoundsForLayer(f,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(d.tilingScheme.pixelSize,w.MAX_PATCH_TESSELATION)};b.prototype.dispose=function(){D(!this.renderData,"tile.renderData was not unloaded");for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++)c[b].dispose();this._surface=this._parent=null;this._usedMemory=
N};b.prototype.setMemoryDirty=function(){this._usedMemory=N};b.prototype._updateMemoryUsed=function(){for(var a=this._surface.tilingScheme.pixelSize,a=a*a*4,b=this._usedMemory=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b],d=d.data;d instanceof z?this._usedMemory+=B.getGpuMemoryUsage(d):d instanceof HTMLImageElement&&(this._usedMemory+=a)}b=0;for(c=this.layerInfo[0];b<c.length;b++)d=c[b],this._usedMemory+=d.data?a:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,
a=this.renderData.textureDescriptor)&&(this._usedMemory+=B.getGpuMemoryUsage(a))};b.prototype.updateScreenDepth=function(a){e.vec3.copy(Q,this._center);Q[3]=1;f.vec4.transformMat4(Q,Q,a);this.screenDepth=Q[2]/Q[3]};b.prototype.shouldSplit=function(a,b,c){var d=this.level;e.vec3.subtract(K,this._center,b);var f=e.vec3.squaredLength(K);if(this._edgeLen2>f&&d<a.maxLod||this.surface.reduceTileLevelDifferences&&0===c&&1===this._surface.snapLevel-d)return 1;c=Math.sqrt(f);var g=e.vec3.dot(this.up,K),f=
this._elevationBounds[1]-this._elevationBounds[0],h=f/this.edgeLen;if(this.surface.reduceTileLevelDifferences&&a.aboveGround&&0<g&&.001>h&&0<g/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-h)return 0;h=this._edgeLen/(a.fovX*c*2);return h<a.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,2):0:d>=a.maxLod?(a=d+Math.ceil(-k.log2(a.relativeWidthLimit/h)),a!==this.vlevel?(this.vlevel=a,2):0):6<d&&(e.vec3.scale(I,this.up,g),e.vec3.subtract(I,I,K),d=e.vec3.squaredLength(I),
d>this._radius*this._radius&&(e.vec3.scale(I,I,this._radius/Math.sqrt(d)),e.vec3.add(I,I,this._center),e.vec3.subtract(I,b,I),Math.min(1,(Math.abs(e.vec3.dot(I,this.up))+.5*f+this._curvatureHeight)/e.vec3.length(I))*(this._edgeLen/(a.fovY*c*2))<.1/a.angledSplitBias*a.relativeHeightLimit))?0:1};b.prototype.setChildren=function(a,b,c,d){D(!!(a&&b&&c&&d),"Null child passed");this._children[0]=a;this._children[1]=b;this._children[2]=c;this._children[3]=d};b.prototype.unsetChildren=function(){this._children[0]=
null;this._children[1]=null;this._children[2]=null;this._children[3]=null};b.prototype.load=function(a){for(var b=null==this.renderData&&a.loadCachedElevationData(this),c=0;2>c;c++){var d=this.layerInfo[c];if(d)if(0===c&&b)for(var e=0;e<d.length;e++)d[e].loadingAgent=y.TILE_AGENT_DONE;else this._createOrUpdateAgents(0,c)}a.loadTile(this)};b.prototype.unload=function(a){a.unloadTile(this,this.elevationDone);for(a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var d=c[b];d.loadingAgent&&
d.loadingAgent!==y.TILE_AGENT_DONE&&(C(d.loadingAgent),d.loadingAgent=null);d.pendingUpdates=0}this.resetPendingUpdate(16);this.resetPendingUpdate(32)};b.prototype.updateClippingStatus=function(a){if(q.equals(a,this._clippingArea))return!1;var b=this._intersectsClippingArea,c=this._isWithinClippingArea;a?(this._intersectsClippingArea=this.intersectsExtent(a),this._isWithinClippingArea=this.isWithinExtent(a)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=a;this.updateVisibility();
a=c&&this._isWithinClippingArea;b=!c&&!b&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||a||b||this.setPendingUpdate(16);return!0};b.prototype.updateVisibility=function(){this._dirty=!0;this._surface.setPendingUpdates()};b.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};b.prototype.hasLayerData=function(a,b){a=this.layerInfo[b][a];return!(!a||!a.data||a.dataInvalidated)};b.prototype.hasDataAvailable=function(a,b,c){return(b=this.layerInfo[c][b].tilemap)?
"unavailable"!==b.getAvailability(a.lij[1],a.lij[2]):!0};Object.defineProperty(b.prototype,"updating",{get:function(){if(this.hasPendingUpdates)return!0;for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var d=c[b];if(d.loadingAgent&&d.loadingAgent!==y.TILE_AGENT_DONE&&d.loadingAgent.updating)return!0}return!1},enumerable:!0,configurable:!0});b.prototype.isSuspended=function(a){return this.hasPendingUpdate(1)?!0:0===a?!1:!this.visible};Object.defineProperty(b.prototype,"elevationDone",
{get:function(){if(this.hasPendingUpdate(16))return!1;for(var a=0,b=this.layerInfo[0];a<b.length;a++){var c=b[a];if(c.loadingAgent!==y.TILE_AGENT_DONE||!c.upsampleFromTile)return!1}return!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasPendingUpdates",{get:function(){return 0!==this._pendingUpdates},enumerable:!0,configurable:!0});b.prototype.hasPendingUpdate=function(a){return(this._pendingUpdates&a)===a};b.prototype.setPendingUpdate=function(a){this._pendingUpdates|=a;this._surface.setPendingUpdates()};
b.prototype.resetPendingUpdate=function(a){return this.hasPendingUpdate(a)?(this._pendingUpdates&=~a,!0):!1};b.prototype.requestLayerData=function(a,b,c){w.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),!0;d.waitingAgents.push(c);
if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),c.dataArrived(this),!0;if(d.requestPromise)return!0;d.requestAbort=h.createAbortController();var e=this._surface.requestTileData(this,a,b,d.requestAbort);if(!e)return d.requestAbort=null,!1;a=function(){d.requestPromise===e&&(d.requestPromise=null,d.requestAbort=null)};d.requestPromise=e;e.then(a,a);return!!d.requestPromise};Object.defineProperty(b.prototype,
"isLeaf",{get:function(){return null==this._children[0]},enumerable:!0,configurable:!0});b.prototype.hasLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};b.prototype.findByLij=function(a){return this.hasLij(a)?this:this.isLeaf?null:(a=this._children[0].findByLij(a)||this._children[1].findByLij(a)||this._children[2].findByLij(a)||this._children[3].findByLij(a))?a:null};b.prototype.distanceToSquared=function(a){return e.vec3.squaredLength(e.vec3.subtract(I,this._center,
a))};b.prototype.containsPoint=function(a){var b=this.extent;return a[0]>=b[0]&&a[1]>=b[1]&&a[0]<=b[2]&&a[1]<=b[3]};b.prototype.unrequestLayerData=function(a,b,c){w.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a],e=d.waitingAgents;c=null!=l.removeUnordered(e,c);D(c,"agent has not requested this piece of map data");1>e.length&&(d.abortRequest(),w.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",
this.lij.toString(),b,a),this._updateMemoryUsed())};b.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0;this._updateMemoryUsed()};b.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),b,a);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing(this);
a.waitingAgents.length=0;this._updateMemoryUsed()};b.prototype.updateRenderData=function(a){switch(a){case 1:return this.updateTexture();case 0:return this.updateGeometry()}};b.prototype.updateTexture=function(){this.renderData&&this.setPendingUpdate(32)};b.prototype.updateGeometry=function(){this.setPendingUpdate(16);for(var a=0,b=this.layerInfo[0];a<b.length;a++)b[a].pendingUpdates|=16;this._surface.setPendingUpdates()};b.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();
this.restartAgents(b)};b.prototype.computeElevationBounds=function(){a.vec2.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);for(var b=!0,c=0,d=this.layerInfo[0];c<d.length;c++){var e=d[c];e.elevationBounds&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],e.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],e.elevationBounds.max),e.elevationBounds.hasNoDataValues||(b=!1))}b&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=
Math.max(this._elevationBounds[1],0));this.updateRadiusAndCenter()};b.prototype._updateCenter=function(){e.vec3.scale(I,this.up,.5*(this._elevationBounds[0]+this._elevationBounds[1]));e.vec3.add(this._center,this.centerAtSeaLevel,I)};b.prototype.findElevationBoundsForLayer=function(a,b){var c=this.layerInfo[0][a];if(!c.elevationBounds||c.elevationBounds.level<b)if(b=this._surface.layerViewByIndex(a,0),v.fallsWithinLayer(this,b.layer,!1)){b=J;var d=!1;if(c.data){var e=c.data;b.min=e.bounds[0];b.max=
e.bounds[1];b.hasNoDataValues=e.hasNoDataValues;b.level=this.lij[0];d=!0}else{for(var f=0,g=void 0,e=void 0,h=this._parent;h&&(!e||f<w.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(f=this.vlevel-h.level,g=e||g,e=h.layerInfo[0][a].data,!e&&g&&f>=w.ELEVATION_DESIRED_RESOLUTION_LEVEL);h=h._parent);if(e=e||g)e.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],b),Infinity!==b.min&&(b.level=e.level,d=!0)}d&&(c.elevationBounds||(c.elevationBounds=new r.ElevationBounds),c.elevationBounds.copyFrom(b))}};b.prototype.modifyLayers=
function(a,b,c){for(var d=this.layerInfo[c],e=0;e<d.length;e++){var f=d[e];f.loadingAgent&&f.loadingAgent!==y.TILE_AGENT_DONE&&(C(f.loadingAgent),f.loadingAgent=null);f.waitingAgents.length=0}if(1===c)for(e=0;e<d.length;++e)void 0===a[e]&&d[e].dispose();a=b.length;f=Array(a);for(e=0;e<a;e++){var g=b[e];f[e]=-1<g?d[g]:m.TilePerLayerInfo.makeEmptyLayerInfo(c,this._surface.upsampleInfoPool)}this.layerInfo[c]=f;this._updateMemoryUsed()};b.prototype.restartAgents=function(a){this.renderData&&(this._createOrUpdateAgents(0,
a),this.updateRenderData(a))};b.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent===y.TILE_AGENT_DONE&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};b.prototype.updateAgentSuspension=function(){for(var a=0;2>a;a++)for(var b=this.isSuspended(a),c=0,d=this.layerInfo[a];c<d.length;c++){var e=d[c];e.loadingAgent&&e.loadingAgent!==y.TILE_AGENT_DONE&&(e.loadingAgent.setSuspension(b),e.loadingAgent===y.TILE_AGENT_DONE&&
this.updateRenderData(a))}};b.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==y.TILE_AGENT_DONE&&a.loadingAgent.dispose();a.loadingAgent=null};b.prototype.agentDone=function(a,b){var c=this.layerInfo[b][a];c.loadingAgent=y.TILE_AGENT_DONE;c.data||c.upsampleFromTile||this._createOrUpdateAgents(a+1,b)};b.prototype._createOrUpdateAgents=function(a,b){for(var c=this.isSuspended(b),d=this.layerInfo[b];a<d.length;++a){var e=d[a],f=!1,g=this._surface.layerViewByIndex(a,
b);if(e.loadingAgent)v.fallsWithinLayer(this,g.layer,!1)?(e.loadingAgent!==y.TILE_AGENT_DONE&&e.loadingAgent.setSuspension(c),e.loadingAgent!==y.TILE_AGENT_DONE&&(f=e.loadingAgent.update())):e.dispose();else if(v.fallsWithinLayer(this,g.layer,!1)){var f=e,h=a,k=b,m=c,l=0===k?t.Pool.acquire():x.Pool.acquire();l.init(this,h,k,m);f.loadingAgent=l;(f=e.loadingAgent.startLoading())?e.loadingAgent===y.TILE_AGENT_DONE&&this.setPendingUpdate(16):(C(e.loadingAgent),e.loadingAgent=y.TILE_AGENT_DONE)}e.loadingAgent===
y.TILE_AGENT_DONE&&this.updateRenderData(b);if(f&&g.isOpaque)break}};b.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};b.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};return b}();b.Tile=n;var J=new r.ElevationBounds,N=-1})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../../support/basemapDefinitions ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),
function(n,b,l,k,h,a,g,e){function d(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function f(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function c(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function q(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function p(){x={};for(var b in a.esriBasemapDefinitions)a.esriBasemapDefinitions[b].baseMapLayers.forEach(function(a){return x[a.url]=19});x["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=
20}function r(a,b,c,d){return t["local"===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,c)}Object.defineProperty(b,"__esModule",{value:!0});var t={planar:g,spherical:e};b.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};b.autoUpdateSkirtsVisibility=function(a,b,c){var d=t[a.manifold],e,f=d.isInsideExtent(a,b);f?e=a.getElevation(b):(e=a.elevationBounds,e=.5*(e.min+e.max));e=b[2]-e;c=.9*Math.abs(e)<c?0:0>e?-1:1;f||(d.isInsideExtent(a,b,a.hideSkirtsDistanceFromExtentMargin)?
(b=d.tiltToExtentEdge(a,b),b>a.hideSkirtsMinimumCameraTilt&&b<a.hideSkirtsMaximumCameraTilt&&(c=0)):c=0);a.skirtScale=c};b.isTiledLayer=function(a){return a&&"base-tile"===a.type||"tile"===a.type||"elevation"===a.type||"base-elevation"===a.type||"open-street-map"===a.type||"web-tile"===a.type||"wmts"===a.type||"vector-tile"===a.type};b.isVectorTileLayer=function(a){return a&&a.isInstanceOf(h)};b.isTileLayerView=d;b.isVectorTileLayerView=f;b.isWMTSLayerView=c;b.isElevationLayerView=q;b.isTiledLayerView=
function(a){return a&&(d(a)||q(a)||f(a)||c(a))};b.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===k.prototype.fetchTile||a.fetchTile===l.prototype.fetchTile)};var x=null;b.getKnownTiledServiceLevelCap=function(a){x||p();a=a&&a.replace(/https?:/,"");return a in x?x[a]:Infinity};b.prepareKnownTiledServiceLevelCaps=p;b.checkIfTileInfoSupportedForView=r;b.getTiledLayerInfo=function(a,c,d){var e,f;if("wmts"===a.type){if(a=a.activeLayer){var g=a.tileMatrixSet;if(g)e=g.tileInfo,f=g.fullExtent;
else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==r(a.tileInfo,a.fullExtent,c,d)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else e="vector-tile"!==a.type||b.test.force512VTL?a.tileInfo:a.compatibleTileInfo256,f=a.fullExtent;return e&&f&&null==r(e,f,c,d)?{tileInfo:e,fullExtent:f}:{tileInfo:null,fullExtent:null}};b.test={force512VTL:!1}})},"esri/layers/ElevationLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../request ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/HeightModelInfo ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./support/commonProperties ./support/LercWorker".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B){var C=f.getLogger("esri.layers.ElevationLayer");return function(b){function f(a){a=b.call(this)||this;a.copyright=null;a.heightModelInfo=null;a.path=null;a.opacity=1;a.operationalLayerType="ArcGISTiledElevationServiceLayer";a.sourceJSON=null;a.type="elevation";a.url=null;a.version=null;a._lercWorker=B.acquireInstance();return a}k(f,b);f.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?l({url:a},b):a};f.prototype.destroy=function(){B.releaseInstance(this._lercWorker);
this._lercWorker=null};Object.defineProperty(f.prototype,"minScale",{get:function(){},set:function(a){this.constructed&&C.warn(this.declaredClass+".minScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maxScale",{get:function(){},set:function(a){this.constructed&&C.warn(this.declaredClass+".maxScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0});f.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=9.3);
return a};f.prototype.load=function(a){var b=this,e=c.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(a){for(var b=0;b<a.typeKeywords.length;b++)if("elevation 3d layer"===a.typeKeywords[b].toLowerCase())return!0;throw new d("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});}},a).then(function(){return b._fetchImageService(e)},
function(){return b._fetchImageService(e)}));return this.when()};f.prototype.fetchTile=function(a,b,c,d){var f=this;void 0===d&&(d={});null!=d&&"number"===typeof d&&(C.warn("Passing noDataValue directly as a parameter is deprecated, use { noDataValue } options object instead (since 4.12)"),d={noDataValue:d});var g={responseType:"array-buffer",signal:d.signal},h={noDataValue:d.noDataValue,returnFileInfo:!0};return this.load().then(function(){return f._fetchTileAvailability(a,b,c,d)}).then(function(){return e(f.getTileUrl(a,
b,c),g)}).then(function(a){return f._lercWorker.decode(a.data,h,d.signal)}).then(function(a){return{values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}})};f.prototype.getTileUrl=function(a,b,c){var d=r.objectToQuery(l({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null}));return this.parsedUrl.path+"/tile/"+a+"/"+b+"/"+c+(d?"?"+d:"")};f.prototype.queryElevation=function(a,
b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).query(c,a,b)})};f.prototype.createElevationSampler=function(a,b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).createSampler(c,a,b)})};f.prototype.importLayerViewModule=function(b){return g(this,void 0,void 0,function(){return a(this,function(a){switch(b.type){case "2d":return[2,p.reject(new d("elevation-layer:view-not-supported","ElevationLayer is only supported in 3D"))];
case "3d":return[2,p.create(function(a){return n(["../views/3d/layers/ElevationLayerView3D"],a)})]}return[2]})})};f.prototype._fetchTileAvailability=function(a,b,c,d){return this.tilemapCache?this.tilemapCache.fetchAvailability(a,b,c,d):p.resolve("unknown")};f.prototype._fetchImageService=function(b){return g(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:if(this.sourceJSON)return[2,this.sourceJSON];c={query:l({f:"json"},this.parsedUrl.query),responseType:"json",
signal:b};return[4,e(this.parsedUrl.path,c)];case 1:return d=a.sent(),d.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=d.data,this.read(d.data,{origin:"service",url:this.parsedUrl}),[2]}})})};f.prototype._importElevationQuery=function(){return p.create(function(a){n(["./support/ElevationQuery"],a)})};h([t.property({json:{read:{source:"copyrightText"}}})],f.prototype,"copyright",void 0);h([t.property({readOnly:!0,type:x})],f.prototype,"heightModelInfo",void 0);h([t.property({type:String,
json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],f.prototype,"path",void 0);h([t.property({type:["show","hide"]})],f.prototype,"listMode",void 0);h([t.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],f.prototype,"minScale",null);h([t.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],f.prototype,"maxScale",null);
h([t.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],f.prototype,"opacity",void 0);h([t.property({type:["ArcGISTiledElevationServiceLayer"]})],f.prototype,"operationalLayerType",void 0);h([t.property()],f.prototype,"sourceJSON",void 0);h([t.property({json:{read:!1},value:"elevation",readOnly:!0})],f.prototype,"type",void 0);h([t.property(z.url)],f.prototype,"url",void 0);h([t.property()],f.prototype,"version",void 0);h([t.reader("version",["currentVersion"])],f.prototype,
"readVersion",null);return f=h([t.subclass("esri.layers.ElevationLayer")],f)}(t.declared(u.ArcGISCachedService(y.ArcGISService(m.OperationalLayer(v.PortalLayer(q.MultiOriginJSONMixin(w)))))))})},"esri/layers/mixins/ArcGISCachedService":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/accessorSupport/decorators ../support/serviceTileInfoProperty ../support/TilemapCache".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});b.ArcGISCachedService=function(b){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.copyright=null;a.minScale=0;a.maxScale=0;a.spatialReference=null;a.tileInfo=null;a.tilemapCache=null;return a}k(c,b);c.prototype.readMinScale=function(a,b){return null!=b.minLOD&&null!=b.maxLOD?a:0};c.prototype.readMaxScale=function(a,b){return null!=b.minLOD&&null!=b.maxLOD?a:0};Object.defineProperty(c.prototype,
"supportsBlankTile",{get:function(){return 10.2<=this.version},enumerable:!0,configurable:!0});c.prototype.readTilemapCache=function(a,b){return b.capabilities&&-1<b.capabilities.indexOf("Tilemap")?new d.TilemapCache({layer:this}):null};h([g.property({json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",void 0);h([g.property()],c.prototype,"minScale",void 0);h([g.reader("service","minScale")],c.prototype,"readMinScale",null);h([g.property()],c.prototype,"maxScale",void 0);h([g.reader("service",
"maxScale")],c.prototype,"readMaxScale",null);h([g.property({type:a.SpatialReference})],c.prototype,"spatialReference",void 0);h([g.property({readOnly:!0,dependsOn:["version"]})],c.prototype,"supportsBlankTile",null);h([g.property(e.serviceTileInfoProperty)],c.prototype,"tileInfo",void 0);h([g.property()],c.prototype,"tilemapCache",void 0);h([g.reader("service","tilemapCache",["capabilities"])],c.prototype,"readTilemapCache",null);h([g.property()],c.prototype,"version",void 0);return c=h([g.subclass("esri.layers.mixins.ArcGISCachedService")],
c)}(g.declared(b))}})},"esri/layers/support/serviceTileInfoProperty":function(){define(["require","exports","../../core/tsSupport/assignHelper","./TileInfo"],function(n,b,l,k){function h(a,b,e,d){if(!a)return null;e=b.minScale;var f=b.maxScale,c=b.minLOD,g=b.maxLOD;if(null!=c&&null!=g)return d&&d.ignoreMinMaxLOD?k.fromJSON(a):k.fromJSON(l({},a,{lods:a.lods.filter(function(a){a=a.level;return null!=a&&a>=c&&a<=g})}));if(0!==e&&0!==f){var h=e?Math.round(1E4*e)/1E4:Infinity,r=f?Math.round(1E4*f)/1E4:
-Infinity;return k.fromJSON(l({},a,{lods:a.lods.filter(function(a){a=Math.round(1E4*a.scale)/1E4;return a<=h&&a>=r})}))}return k.fromJSON(a)}Object.defineProperty(b,"__esModule",{value:!0});b.serviceTileInfoProperty={type:k,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:h}}}}};b.readServiceTileInfo=h})},"esri/layers/TileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../geometry ../request ../core/Error ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/arcgisLayerUrl ./support/commonProperties".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I){var Q="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");return function(b){function m(a,c){a=b.call(this)||
this;a.listMode="show";a.isReference=null;a.resampling=!0;a.sourceJSON=null;a.spatialReference=null;a.path=null;a.sublayers=null;a.type="tile";a.url=null;return a}k(m,b);m.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?l({url:a},b):a};m.prototype.load=function(a){var b=this,d=c.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service","Map Service"]},a).then(function(){return b._fetchService(d)},function(){return b._fetchService(d)}));
return this.when()};Object.defineProperty(m.prototype,"attributionDataUrl",{get:function(){return this._getDefaultAttribution(this._getMapName(this.parsedUrl.path.toLowerCase()))},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"operationalLayerType",{get:function(){if(this.capabilities&&this.capabilities.operations)return this.capabilities.operations.supportsExportMap?"ArcGISTiledMapServiceLayer":"ArcGISTiledImageServiceLayer";var a=this.url||this.portalItem&&this.portalItem.url;
return a&&/\/ImageServer(\/|\/?$)/i.test(a)?"ArcGISTiledImageServiceLayer":"ArcGISTiledMapServiceLayer"},enumerable:!0,configurable:!0});m.prototype.readSpatialReference=function(a,b){return(a=a||b.tileInfo&&b.tileInfo.spatialReference)&&e.SpatialReference.fromJSON(a)};Object.defineProperty(m.prototype,"tileServers",{get:function(){return this._getDefaultTileServers(this.parsedUrl.path)},enumerable:!0,configurable:!0});m.prototype.castTileServers=function(a){return Array.isArray(a)?a.map(function(a){return r.urlToObject(a).path}):
null};m.prototype.fetchTile=function(a,b,c,e){void 0===e&&(e={});var f=e.signal,g=e.timestamp;a=this.getTileUrl(a,b,c);f={responseType:"image",signal:f};null!=g&&(f.query={_ts:e.timestamp});return d(a,f).then(function(a){return a.data})};m.prototype.getTileUrl=function(a,b,c){var d=r.objectToQuery(l({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null})),e=this.tileServers;return(e&&e.length?e[b%e.length]:this.parsedUrl.path)+"/tile/"+a+"/"+b+"/"+c+(d?"?"+d:"")};m.prototype.importLayerViewModule=
function(b){return g(this,void 0,void 0,function(){return a(this,function(a){switch(b.type){case "2d":return[2,p.create(function(a){return n(["../views/2d/layers/TileLayerView2D"],a)})];case "3d":return[2,p.create(function(a){return n(["../views/3d/layers/TileLayerView3D"],a)})]}return[2]})})};m.prototype._fetchService=function(a){var b=this;return p.create(function(c,e){if(b.sourceJSON)c({data:b.sourceJSON});else{if(!b.parsedUrl)return e(new f("tile-layer:undefined-url","layer's url is not defined"));
d(b.parsedUrl.path,{query:l({f:"json"},b.parsedUrl.query),responseType:"json",signal:a}).then(c,e)}}).then(function(c){c.ssl&&(b.url=b.url.replace(/^http:/i,"https:"));b.sourceJSON=c.data;b.read(c.data,{origin:"service",url:b.parsedUrl});if(10.1===b.version&&!K.isHostedAgolService(b.url))return b._fetchServerVersion(b.url,a).then(function(a){b.read({currentVersion:a})}).catch(function(){})})};m.prototype._fetchServerVersion=function(a,b){if(!D.test(a))return p.reject();a=a.replace(/(.*\/rest)\/.*/i,
"$1")+"/info";return d(a,{query:{f:"json"},responseType:"json",signal:b}).then(function(a){return a.data&&a.data.currentVersion?a.data.currentVersion:p.reject()})};m.prototype._getMapName=function(a){return(a=a.match(/^(?:https?:)?\/\/(server|services)\.arcgisonline\.com\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&a[2]};m.prototype._getDefaultAttribution=function(a){if(a){var b;a=a.toLowerCase();for(var c=0,d=Q.length;c<d;c++)if(b=Q[c],-1<b.toLowerCase().indexOf(a))return r.makeAbsolute("//static.arcgis.com/attribution/"+
b)}};m.prototype._getDefaultTileServers=function(a){var b=-1!==a.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),c=-1!==a.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return b||c?[a,a.replace(b?/server\.arcgisonline/i:/services\.arcgisonline/i,b?"services.arcgisonline":"server.arcgisonline")]:[]};h([t.property({readOnly:!0,dependsOn:["parsedUrl"]})],m.prototype,"attributionDataUrl",null);h([t.property({type:["show","hide","hide-children"]})],m.prototype,"listMode",void 0);h([t.property({type:Boolean,
json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],m.prototype,"isReference",void 0);h([t.property({readOnly:!0})],m.prototype,"operationalLayerType",null);h([t.property()],m.prototype,"popupTemplates",void 0);h([t.property({type:Boolean})],m.prototype,"resampling",void 0);h([t.property()],m.prototype,"sourceJSON",void 0);h([t.property({type:e.SpatialReference})],m.prototype,"spatialReference",void 0);h([t.reader("spatialReference",["spatialReference","tileInfo"])],
m.prototype,"readSpatialReference",null);h([t.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],m.prototype,"path",void 0);h([t.property({readOnly:!0})],m.prototype,"sublayers",void 0);h([t.property({dependsOn:["parsedUrl"]})],m.prototype,"tileServers",null);h([t.cast("tileServers")],m.prototype,"castTileServers",null);h([t.property({readOnly:!0,json:{read:!1}})],m.prototype,"type",void 0);h([t.property(I.url)],m.prototype,"url",void 0);return m=h([t.subclass("esri.layers.TileLayer")],
m)}(t.declared(C.SublayersOwner(B.ScaleRangeLayer(z.RefreshableLayer(m.OperationalLayer(v.PortalLayer(w.ArcGISCachedService(u.ArcGISMapService(y.ArcGISService(q.MultiOriginJSONMixin(x)))))))))))})},"esri/layers/mixins/ArcGISMapService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),function(n,b,l,k,h,a,
g,e){Object.defineProperty(b,"__esModule",{value:!0});b.ArcGISMapService=function(b){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.capabilities=void 0;a.copyright=null;a.fullExtent=null;a.legendEnabled=!0;a.spatialReference=null;a.version=null;return a}l(c,b);c.prototype.readCapabilities=function(a,b){var c=b.capabilities&&b.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});if(!c)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,
supportsTileMap:!1},exportMap:null,exportTiles:null};a=this.type;var d=-1!==c.indexOf("query"),e=-1!==c.indexOf("map"),f=!!b.exportTilesAllowed,c=-1!==c.indexOf("tilemap"),g="tile"!==a&&!!b.supportsDynamicLayers,h="tile"!==a&&(!b.tileInfo||g),k="tile"!==a&&(!b.tileInfo||g);return{operations:{supportsQuery:d,supportsExportMap:e,supportsExportTiles:f,supportsTileMap:c},exportMap:e?{supportsSublayersChanges:"tile"!==a,supportsDynamicLayers:g,supportsSublayerVisibility:h,supportsSublayerDefinitionExpression:k}:
null,exportTiles:f?{maxExportTilesCount:+b.maxExportTilesCount}:null}};c.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=b.hasOwnProperty("capabilities")||b.hasOwnProperty("tables")?10:b.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return a};k([h.property({readOnly:!0})],c.prototype,"capabilities",void 0);k([h.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],c.prototype,"readCapabilities",null);k([h.property({json:{read:{source:"copyrightText"}}})],
c.prototype,"copyright",void 0);k([h.property({type:a})],c.prototype,"fullExtent",void 0);k([h.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],c.prototype,"id",void 0);k([h.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],c.prototype,"legendEnabled",void 0);k([h.property(e.popupEnabled)],c.prototype,"popupEnabled",void 0);k([h.property({type:g})],c.prototype,"spatialReference",void 0);k([h.property()],
c.prototype,"version",void 0);k([h.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],c.prototype,"readVersion",null);return c=k([h.subclass("esri.layers.mixins.ArcGISMapService")],c)}(h.declared(b))}})},"esri/layers/mixins/SublayersOwner":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){function x(a,b,c){var d=[],e={};if(!a)return d;a.forEach(function(a){var f=new r;f.read(a,b);c&&(-1===c.indexOf(f.id)?f.visible=!1:f.visible=!0);e[f.id]=f;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=e[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(f)):d.unshift(f)});return d}function w(a,b){var c=b.get(a.id);c?(d.mixin(a.__accessor__.store._values,c.__accessor__.store._values),c.__accessor__.overridden&&(a.__accessor__.overridden=d.mixin(a.__accessor__.overridden||
{},c.__accessor__.overridden)),c.sublayers&&(a.sublayers=c.sublayers.map(function(a){return w(a,b)}))):a.sublayers&&a.sublayers.forEach(function(a){return w(a,b)});return a}Object.defineProperty(b,"__esModule",{value:!0});var u=f.getLogger("esri.layers.TileLayer");b.SublayersOwner=function(b){return function(b){function d(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];var d=b.apply(this,a)||this;d.allSublayers=new g({root:d,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});
d.watch("sublayers",function(a,b){return d._handleSublayersChange(a,b)},!0);return d}k(d,b);d.prototype.readServiceSublayers=function(a,b,c){return x(b.layers,c)};d.prototype.readSublayersFromItemOrWebMap=function(a,b,c){return!b.layers&&b.visibleLayers?b.visibleLayers.map(function(a){return{id:a}}):x(b.layers,c,b.visibleLayers)};d.prototype.readSublayers=function(a,b,c){a=x(b.layers,c);this._updateSublayersForOrigin(p.OriginId.PORTAL_ITEM,a);this._updateSublayersForOrigin(p.OriginId.WEB_MAP,a);this._updateSublayersForOrigin(p.OriginId.WEB_SCENE,
a);return a};d.prototype.writeSublayers=function(a,b,c,d){if(a&&this.serviceSublayers){a=a.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray();var e=this.serviceSublayers.flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray().reduce(function(a,b){a.set(b.id,b);return a},new Map),f=!1,g=!0;this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers?(f=t.isExportDynamic(a,this.serviceSublayers,
this),g=!f&&t.sameStructureAsService(a,this.serviceSublayers)):g=t.sameStructureAsService(a,this.serviceSublayers);b.layers=[];a.forEach(function(a){var c=e.get(a.id),c=l({writeAsDynamic:f,writeOverridesOnly:g,serviceSublayer:c},d);a=a.write({},c);(!g||g&&1<Object.keys(a).length)&&b.layers.push(a)});a=a.filter(function(a){return a.visible}).map(function(a){return a.id});"tile"!==this.type&&(b.visibleLayers=a)}};d.prototype.findSublayerById=function(a){return this.allSublayers.find(function(b){return b.id===
a})};d.prototype.createServiceSublayers=function(){return this.serviceSublayers.map(function(a){return a.clone()})};d.prototype._updateSublayersForOrigin=function(b,c){var d=this.__accessor__.store;if(d.has("sublayers",b)){var e=d.get("sublayers",b).flatten(function(a){return a.sublayers});if(e.every(function(a){return!a.__accessor__.store._values.hasOwnProperty("minScale")})){var f=e.reduce(function(a,b){a.set(b.id,b);return a},new Map);c=c.map(function(a){return w(a.clone(),f)});d.set("sublayers",
new (a.ofType(r))(c),b)}}};d.prototype._handleSublayersChange=function(a,b){var c=this;b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this._sublayersHandles.forEach(function(a){return a.remove()}),this._sublayersHandles=null);a&&(a.forEach(function(a){a.parent=c;a.layer=c}),this._sublayersHandles=[a.on("after-add",function(a){a=a.item;a.parent=c;a.layer=c}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})],"tile"===this.type&&this._sublayersHandles.push(a.on("before-changes",
function(a){u.error(new e("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:c}));a.preventDefault()})))};h([c.property({readOnly:!0})],d.prototype,"allSublayers",void 0);h([c.property({readOnly:!0,type:a.ofType(r)})],d.prototype,"serviceSublayers",void 0);h([c.reader("service","serviceSublayers",["layers"])],d.prototype,"readServiceSublayers",null);h([c.property({value:null,type:a.ofType(r),json:{type:[Number],write:{target:"subLayerIds",
allowNull:!0}}})],d.prototype,"sublayers",void 0);h([c.reader(["web-map","web-scene","portal-item"],"sublayers",["layers","visibleLayers"])],d.prototype,"readSublayersFromItemOrWebMap",null);h([c.reader("service","sublayers",["layers"])],d.prototype,"readSublayers",null);h([c.writer("sublayers",{layers:{type:[r]},visibleLayers:{type:[q.Integer]}})],d.prototype,"writeSublayers",null);return d=h([c.subclass("esri.layers.mixins.SublayersOwner")],d)}(c.declared(b))}})},"esri/layers/support/Sublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../PopupTemplate ../../renderers ../../symbols ../../core/Collection ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/accessorSupport/write ./commonProperties ./LabelClass ./layerSourceUtils ../../renderers/support/jsonUtils ../../tasks/support/Query".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D){var K=t.getLogger("esri.layers.support.Sublayer"),I=0;return function(b){function h(a){a=b.call(this,a)||this;a._sublayersHandles=null;return a}l(h,b);p=h;Object.defineProperty(h.prototype,"definitionExpression",{get:function(){return this._get("definitionExpression")},set:function(a){this._setAndNotifyLayer("definitionExpression",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"id",{get:function(){var a=this._get("id");
return null==a?I++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id"):this._set("id",a))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"labelingInfo",{get:function(){return this._get("labelingInfo")},set:function(a){this._setAndNotifyLayer("labelingInfo",a)},enumerable:!0,configurable:!0});h.prototype.writeLabelingInfo=function(a,b,c,d){(!d||d.writeAsDynamic)&&a&&a.length&&(b.layerDefinition=
{drawingInfo:{labelingInfo:a.map(function(a){return a.write({},d)})}})};Object.defineProperty(h.prototype,"labelsVisible",{get:function(){return this._get("labelsVisible")},set:function(a){this._setAndNotifyLayer("labelsVisible",a)},enumerable:!0,configurable:!0});h.prototype.writeLabelsVisible=function(a,b,c,d){if(!d||d.writeAsDynamic)b.showLabels=a};Object.defineProperty(h.prototype,"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(b){return b.layer=a})},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"legendEnabled",{get:function(){return this._get("legendEnabled")},set:function(a){this._set("legendEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"listMode",{get:function(){return this._get("listMode")},set:function(a){this._set("listMode",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"minScale",{get:function(){return this._get("minScale")},set:function(a){this._setAndNotifyLayer("minScale",
a)},enumerable:!0,configurable:!0});h.prototype.readMinScale=function(a,b){return b.minScale||b.layerDefinition&&b.layerDefinition.minScale||0};h.prototype.writeMinScale=function(a,b,c,d){if(d&&d.writeOverridesOnly&&(c=d&&d.serviceSublayer)&&c.minScale===a&&c.maxScale===this.maxScale)return;b.minScale=a};Object.defineProperty(h.prototype,"maxScale",{get:function(){return this._get("maxScale")},set:function(a){this._setAndNotifyLayer("maxScale",a)},enumerable:!0,configurable:!0});h.prototype.readMaxScale=
function(a,b){return b.maxScale||b.layerDefinition&&b.layerDefinition.maxScale||0};h.prototype.writeMaxScale=function(a,b,c,d){if(d&&d.writeOverridesOnly&&(c=d&&d.serviceSublayer)&&c.maxScale===a&&c.minScale===this.minScale)return;b.maxScale=a};Object.defineProperty(h.prototype,"opacity",{get:function(){return this._get("opacity")},set:function(a){this._setAndNotifyLayer("opacity",a)},enumerable:!0,configurable:!0});h.prototype.readOpacity=function(a,b){a=b.layerDefinition;return 1-.01*(null!=a.transparency?
a.transparency:a.drawingInfo.transparency)};h.prototype.writeOpacity=function(a,b,c,d){if(!d||d.writeAsDynamic)b.layerDefinition={drawingInfo:{transparency:100-100*a}}};h.prototype.writeParent=function(a,b,c,d){d&&d.writeOverridesOnly||(b.parentLayerId=this.parent&&this.parent!==this.layer?this.parent.id:-1)};Object.defineProperty(h.prototype,"popupEnabled",{get:function(){return this._get("popupEnabled")},set:function(a){this._set("popupEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"popupTemplate",{get:function(){return this._get("popupTemplate")},set:function(a){this._set("popupTemplate",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"renderer",{get:function(){return this._get("renderer")},set:function(a){if(a)for(var b=0,c=a.getSymbols();b<c.length;b++)if(f.isSymbol3D(c[b])){K.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)},enumerable:!0,configurable:!0});h.prototype.readRenderer=function(a,b,c){if(a=b.layerDefinition.drawingInfo.renderer||
void 0)(a=C.read(a,b,c)||void 0)||K.error("Failed to create renderer",{rendererDefinition:b.drawingInfo.renderer,layer:this,context:c});return a};h.prototype.writeRenderer=function(a,b,c,d){if(!d||d.writeAsDynamic)b.layerDefinition={drawingInfo:{renderer:a.toJSON()}}};h.prototype.writeWebSceneRenderer=function(a,b,c,d){if(!d||d.writeAsDynamic)b.layerDefinition={drawingInfo:{renderer:a.toJSON()}}};Object.defineProperty(h.prototype,"source",{get:function(){return this._get("source")||{mapLayerId:this.id,
type:B.MAPLAYER}},set:function(a){this._setAndNotifyLayer("source",a)},enumerable:!0,configurable:!0});h.prototype.writeSource=function(a,b,c,d){d&&!d.writeAsDynamic&&d.writeOverridesOnly||(b.layerDefinition={source:B.sourceToJSON(a)})};Object.defineProperty(h.prototype,"sublayers",{set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)},enumerable:!0,configurable:!0});h.prototype.castSublayers=function(a){return y.default(c.ofType(p),a)};h.prototype.writeSublayers=
function(a,b,c,d){d&&d.writeOverridesOnly||this.get("sublayers.length")&&(b[c]=this.sublayers.map(function(a){return a.id}).toArray().reverse())};Object.defineProperty(h.prototype,"title",{get:function(){return this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});h.prototype.writeTitle=function(a,b,c,d){if(d&&d.writeOverridesOnly&&(d=d&&d.serviceSublayer)&&d.title===a)return;b[c]=a};Object.defineProperty(h.prototype,"url",{get:function(){var a=this.layer,b=this.source;
if(!a)return null;if(B.isMapLayerSource(b))return a.parsedUrl.path+"/"+b.mapLayerId;b={layer:JSON.stringify({source:B.sourceToJSON(this.source)})};return a.parsedUrl.path+"/dynamicLayer?"+w.objectToQuery(b)},set:function(a){a?this._override("url",a):this._clearOverride("url")},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"visible",{get:function(){return this._get("visible")},set:function(a){this._setAndNotifyLayer("visible",a)},enumerable:!0,configurable:!0});h.prototype.writeVisible=
function(a,b,c,d){if(d&&d.writeOverridesOnly&&(d=d&&d.serviceSublayer)&&d.visible===a)return;b[c]=a};h.prototype.clone=function(){var a=new p;this.hasOwnProperty("definitionExpression")&&(a.definitionExpression=this.definitionExpression);this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("labelingInfo")&&(a.labelingInfo=r.clone(this.labelingInfo));this.hasOwnProperty("labelsVisible")&&(a.labelsVisible=this.labelsVisible);this.hasOwnProperty("legendEnabled")&&(a.legendEnabled=this.legendEnabled);
this.hasOwnProperty("visible")&&(a.visible=this.visible);this.hasOwnProperty("layer")&&(a.layer=this.layer);this.hasOwnProperty("minScale")&&(a.minScale=this.minScale);this.hasOwnProperty("maxScale")&&(a.maxScale=this.maxScale);this.hasOwnProperty("opacity")&&(a.opacity=this.opacity);this.hasOwnProperty("parent")&&(a.parent=this.parent);this.hasOwnProperty("popupEnabled")&&(a.popupEnabled=this.popupEnabled);this.hasOwnProperty("popupTemplate")&&(a.popupTemplate=this.popupTemplate?this.popupTemplate.clone():
this.popupTemplate);this.hasOwnProperty("renderer")&&(a.renderer=this.renderer?this.renderer.clone():this.renderer);this.hasOwnProperty("source")&&(a.source=r.clone(this.source));this.hasOwnProperty("sublayers")&&(a.sublayers=this.sublayers?this.sublayers.clone():this.sublayers);this.hasOwnProperty("title")&&(a.title=this.title);return a};h.prototype.createQuery=function(){return new D({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};h.prototype.createFeatureLayer=function(){return g(this,
void 0,void 0,function(){var b,c,d,e,f;return a(this,function(a){switch(a.label){case 0:if(this.hasOwnProperty("sublayers"))return[2,null];b=this.layer&&this.layer.parsedUrl;c=this.source;d=null;b&&(d=B.isMapLayerSource(c)?b.path+"/"+c.mapLayerId:b.path+"/dynamicLayer");return[4,x.create(function(a){return n(["../FeatureLayer"],a)})];case 1:return e=a.sent(),f=new e({url:d}),this.hasOwnProperty("definitionExpression")&&(f.definitionExpression=this.definitionExpression),this.hasOwnProperty("labelingInfo")&&
(f.labelingInfo=r.clone(this.labelingInfo)),this.hasOwnProperty("labelsVisible")&&(f.labelsVisible=this.labelsVisible),this.hasOwnProperty("legendEnabled")&&(f.legendEnabled=this.legendEnabled),this.hasOwnProperty("visible")&&(f.visible=this.visible),this.hasOwnProperty("minScale")&&(f.minScale=this.minScale),this.hasOwnProperty("maxScale")&&(f.maxScale=this.maxScale),this.hasOwnProperty("opacity")&&(f.opacity=this.opacity),this.hasOwnProperty("popupTemplate")&&(f.popupTemplate=this.popupTemplate?
this.popupTemplate.clone():this.popupTemplate),this.hasOwnProperty("renderer")&&(f.renderer=this.renderer?this.renderer.clone():this.renderer),this.hasOwnProperty("source")&&B.isDataLayerSource(this.source)&&(f.dynamicDataSource=r.clone(this.source)),this.hasOwnProperty("title")&&(f.title=this.title),[2,f]}})})};h.prototype.queryFeatures=function(a,b){var c=this;void 0===a&&(a=this.createQuery());return x.all([x.create(function(a){return n(["../../tasks/operations/query"],a)}),x.create(function(a){return n(["../../tasks/support/FeatureSet"],
a)})]).then(function(d){var e=d[0].executeQuery,f=d[1];return e(c.url,D.from(a),b).then(function(a){return f.fromJSON(a.data)})}).then(function(a){a&&a.features&&a.features.forEach(function(a){a.sourceLayer=c});return a})};h.prototype.toExportImageJSON=function(){var a={id:this.id,source:B.sourceToJSON(this.source)};this.definitionExpression&&(a.definitionExpression=this.definitionExpression);if(this.renderer||this.labelingInfo||null!=this.opacity||null!=this.labelsVisible){var b=a.drawingInfo={};
this.renderer&&(b.renderer=this.renderer.toJSON());null!=this.labelsVisible&&(b.showLabels=this.labelsVisible);!1!==this.labelsVisible&&this.labelingInfo&&(b.labelingInfo=this.labelingInfo.map(function(a){return a.write({},{origin:"service"})}),b.showLabels=!0);null!=this.opacity&&(b.transparency=100-100*this.opacity)}return a};h.prototype._setAndNotifyLayer=function(a,b){var c=this.layer,d=this._get(a),e;switch(a){case "definitionExpression":e="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":e=
"supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":e="supportsDynamicLayers"}e&&!1===this.get("layer.capabilities.exportMap."+e)?this._logLockedError(a):(this._set(a,b),d!==b&&c&&c.emit&&c.emit("sublayer-update",{propertyName:a}))};h.prototype._handleSublayersChange=function(a,b){var c=this;b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this._sublayersHandles.forEach(function(a){return a.remove()}),this._sublayersHandles=
null);a&&(a.forEach(function(a){a.parent=c;a.layer=c.layer}),this._sublayersHandles=[a.on("after-add",function(a){a=a.item;a.parent=c;a.layer=c.layer}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null}),a.on("before-changes",function(a){var b=c.get("layer.capabilities.exportMap.supportsSublayersChanges");null==b||b||(K.error(new q("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:c})),a.preventDefault())})])};h.prototype._logLockedError=
function(a){K.error(new q("sublayer:locked","Property '"+a+"' can't be changed on Sublayer from the layer '"+this.layer.id+"'",{sublayer:this,layer:this.layer}))};var p;k([u.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],h.prototype,"definitionExpression",null);k([u.property({type:Number,json:{write:{ignoreOrigin:!0}}})],h.prototype,"id",null);k([u.property({value:null,type:[z],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},
write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],h.prototype,"labelingInfo",null);k([u.writer("labelingInfo")],h.prototype,"writeLabelingInfo",null);k([u.property({type:Boolean,json:{read:{source:"showLabels"},write:{target:"showLabels"}}})],h.prototype,"labelsVisible",null);k([u.writer("labelsVisible")],h.prototype,"writeLabelsVisible",null);k([u.property({value:null})],h.prototype,"layer",null);k([u.property(v.legendEnabled)],h.prototype,"legendEnabled",null);k([u.property({type:["show",
"hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],h.prototype,"listMode",null);k([u.property({type:Number,value:0,json:{write:{overridePolicy:function(a,b,c){if(m.willPropertyWrite(this,"maxScale",{},c))return{ignoreOrigin:!0}}}}})],h.prototype,"minScale",null);k([u.reader("portal-item","minScale",["minScale","layerDefinition.minScale"])],h.prototype,"readMinScale",null);k([u.writer("minScale")],h.prototype,"writeMinScale",null);k([u.property({type:Number,
value:0,json:{write:{overridePolicy:function(a,b,c){if(m.willPropertyWrite(this,"minScale",{},c))return{ignoreOrigin:!0}}}}})],h.prototype,"maxScale",null);k([u.reader("portal-item","maxScale",["maxScale","layerDefinition.maxScale"])],h.prototype,"readMaxScale",null);k([u.writer("maxScale")],h.prototype,"writeMaxScale",null);k([u.property({type:Number,json:{write:{target:"layerDefinition.drawingInfo.transparency"}}})],h.prototype,"opacity",null);k([u.reader("opacity",["layerDefinition.drawingInfo.transparency",
"layerDefinition.transparency"])],h.prototype,"readOpacity",null);k([u.writer("opacity")],h.prototype,"writeOpacity",null);k([u.property({json:{type:Number,write:{target:"parentLayerId",allowNull:!0}}})],h.prototype,"parent",void 0);k([u.writer("parent")],h.prototype,"writeParent",null);k([u.property(v.popupEnabled)],h.prototype,"popupEnabled",null);k([u.property({value:null,type:e,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],h.prototype,"popupTemplate",null);k([u.property({types:d.rendererTypes,
value:null,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],h.prototype,"renderer",null);k([u.reader("renderer",["layerDefinition.drawingInfo.renderer"])],h.prototype,"readRenderer",null);k([u.writer("renderer")],h.prototype,"writeRenderer",null);k([u.writer("web-scene","renderer",{"layerDefinition.drawingInfo.renderer":{types:d.webSceneRendererTypes}})],h.prototype,"writeWebSceneRenderer",null);k([u.property({cast:B.castSource,json:{read:{source:"layerDefinition.source",reader:B.sourceFromJSON},
write:{target:"layerDefinition.source"}}})],h.prototype,"source",null);k([u.writer("source")],h.prototype,"writeSource",null);k([u.property({value:null,json:{type:[y.Integer],write:{target:"subLayerIds",allowNull:!0}}})],h.prototype,"sublayers",null);k([u.cast("sublayers")],h.prototype,"castSublayers",null);k([u.writer("sublayers")],h.prototype,"writeSublayers",null);k([u.property({type:String,value:null,json:{read:{source:"name"},write:{target:"name",allowNull:!0,ignoreOrigin:!0}}})],h.prototype,
"title",null);k([u.writer("title")],h.prototype,"writeTitle",null);k([u.property({type:String,dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:function(){return{enabled:this._isOverridden("url")}}}}})],h.prototype,"url",null);k([u.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility"}}})],h.prototype,"visible",null);k([u.writer("visible")],h.prototype,"writeVisible",null);return h=p=k([u.subclass("esri.layers.support.Sublayer")],
h)}(u.declared(p.JSONSupport))})},"esri/layers/support/sublayerUtils":function(){define(["require","exports","./layerSourceUtils"],function(n,b,l){function k(b,a){function g(a){var b=a.sublayers;e.unshift(a.id);b&&b.toArray().forEach(g)}if(!b||!b.length)return!0;var e=[];a.forEach(g);if(b.length>e.length)return!1;a=0;for(var d=e.length,f=0;f<b.length;f++){for(var c=b[f].id;a<d&&e[a]!==c;)a++;if(a>=d)return!1}return!0}Object.defineProperty(b,"__esModule",{value:!0});b.isExportDynamic=function(b,a,
g){return b.some(function(a){var b=a.source;return!(!b||b.type===l.MAPLAYER&&b.mapLayerId===a.id&&(!b.gdbVersion||b.gdbVersion===g.gdbVersion))||null!=a.renderer||null!=a.labelingInfo||a.hasOwnProperty("opacity")&&null!=a.opacity||a.hasOwnProperty("labelsVisible")&&null!=a.labelsVisible})?!0:!k(b,a)};b.sameStructureAsService=function(b,a){return a.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).every(function(a,e){return(e=b[e])&&a.id===e.id&&(null==a.sublayers&&
null==e.sublayers||null!=a.sublayers&&null!=e.sublayers&&a.sublayers.map(function(a){return a.id}).join(",")===e.sublayers.map(function(a){return a.id}).join(","))})}})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../request ../core/Error ../core/global ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/SpriteSource ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/2d/engine/vectorTiles/SchemaHelper ../views/2d/engine/vectorTiles/tileInfoUtils ../views/2d/engine/vectorTiles/style/StyleRepository".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L){return function(b){function c(a,c){a=b.call(this)||this;a._spriteSourceMap=new Map;a.currentStyleInfo=null;a.style=null;a.isReference=null;a.operationalLayerType="VectorTileLayer";a.type="vector-tile";a.url=null;return a}k(c,b);c.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?l({url:a},b):a};c.prototype.load=function(b){var c=this,d=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},
b).then(function(){return g(c,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:if(!this.portalItem||!this.portalItem.id)return[2];c=this.portalItem.itemUrl+"/resources/styles/root.json";return[4,e(c,l({},b,{query:{f:"json"}}))];case 1:return d=a.sent(),d.data&&this.read({url:c},Q.createForItem(this.portalItem)),[2]}})})}).then(function(){return c._loadStyle(b)},function(){return c._loadStyle(b)});this.addResolvingPromise(d);return this.when()};Object.defineProperty(c.prototype,
"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&r.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"capabilities",{get:function(){var a=this._getPrimarySource();return a?a.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"fullExtent",{get:function(){var a=this._getPrimarySource();
return a?a.fullExtent:null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"parsedUrl",{get:function(){return this.serviceUrl?p.urlToObject(this.serviceUrl):null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||
null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});c.prototype.writeStyleUrl=function(a,b){a&&r.isProtocolRelative(a)&&(a="https:"+a);b.styleUrl=a};Object.defineProperty(c.prototype,"tileIndexType",{get:function(){var a=this._getPrimarySource();return a?a.type:""},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tileIndexUrl",{get:function(){var a=
this._getPrimarySource();return a?a.tileMapURL:""},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tileInfo",{get:function(){var a=[],b;for(b in this.sourceNameToSource)a.push(this.sourceNameToSource[b]);b=this._getPrimarySource().tileInfo;if(1<a.length)for(var c=0;c<a.length;c++)N.areSchemasOverlapping(b,a[c].tileInfo)&&(b=N.unionTileInfos(b,a[c].tileInfo));return b},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tilemapCache",{get:function(){var a=this._getPrimarySource();
return a?a.capabilities.operations.supportsTileMap?a.tilemapCache:null:null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tileServers",{get:function(){var a=this._getPrimarySource();return a?a.tileServers:[]},enumerable:!0,configurable:!0});c.prototype.readVersion=function(a,b){return b.version?parseFloat(b.version):parseFloat(b.currentVersion)};Object.defineProperty(c.prototype,"compatibleTileInfo256",{get:function(){return J.create256x256CompatibleTileInfo(this.tileInfo)},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"compatibleTileInfo512",{get:function(){return J.create512x512CompatibleTileInfo(this.tileInfo)},enumerable:!0,configurable:!0});c.prototype.loadSpriteSource=function(b,c){void 0===b&&(b=1);return g(this,void 0,void 0,function(){var d,e;return a(this,function(a){this._spriteSourceMap.has(b)||(d=new C.default(this.styleRepository.sprite,b),this._spriteSourceMap.set(b,d.load()));e=this._spriteSourceMap.get(b);return[2,q.create(function(a,
b){e.then(a,b);q.onAbortOrThrow(c,b)})]})})};c.prototype.loadStyle=function(b,c){return g(this,void 0,void 0,function(){var d,e,g,h=this;return a(this,function(a){d=b||this.style||this.url;if(this._loadingPromise&&"string"===typeof d&&this.url===d&&!q.isAborted(this._abortController))return[2,this._loadingPromise];(e=this._abortController)&&e.abort();g=q.createAbortController();this._loadingPromise=q.create(function(a,b){var e={signal:g.signal};h._spriteSourceMap.clear();h._getSourceAndStyle(d,e).then(function(){return h.loadSpriteSource(f.devicePixelRatio||
1,e).then(function(){return a()})}).catch(b);q.onAbort(c,function(){g.abort()})});this._abortController=g;return[2,this._loadingPromise]})})};c.prototype.getStyleLayerId=function(a){return this.styleRepository.getStyleLayerId(a)};c.prototype.getPaintProperties=function(a){return this.styleRepository.getPaintProperties(a)};c.prototype.setPaintProperties=function(a,b){var c=this.styleRepository.isPainterDataDriven(a),d=this.styleRepository.setPaintProperties(a,b),e=this.styleRepository.isPainterDataDriven(a);
this.emit("paint-change",{layer:d,paint:b});(c||e)&&this.emit("layout-change",{layer:d,layout:this.styleRepository.getLayoutProperties(a)})};c.prototype.getLayoutProperties=function(a){return this.styleRepository.getLayoutProperties(a)};c.prototype.setLayoutProperties=function(a,b){a=this.styleRepository.setLayoutProperties(a,b);this.emit("layout-change",{layer:a,layout:b})};c.prototype.getTileUrl=function(a,b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,
b.toString()).replace(/\{x\}/gi,c.toString())};c.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?(b.messages&&b.messages.push(new d("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};c.prototype.importLayerViewModule=function(b){return g(this,void 0,void 0,function(){return a(this,function(a){switch(b.type){case "2d":return[2,q.create(function(a){return n(["../views/2d/layers/VectorTileLayerView2D"],
a)})];case "3d":return[2,q.create(function(a){return n(["../views/3d/layers/VectorTileLayerView3D"],a)})]}return[2,null]})})};c.prototype._getSourceAndStyle=function(b,c){return g(this,void 0,void 0,function(){var d;return a(this,function(a){switch(a.label){case 0:return b?[4,I.loadMetadata(b,c)]:[2,q.reject(Error("invalid style!"))];case 1:return d=a.sent(),this._set("currentStyleInfo",{serviceUrl:d.serviceUrl,styleUrl:d.styleUrl,spriteUrl:d.spriteUrl,glyphsUrl:d.glyphsUrl,style:d.style,layerDefinition:d.layerDefinition}),
"string"===typeof b?(this.url=b,this.style=null):(this.url=null,this.style=b),this._set("sourceNameToSource",d.sourceNameToSource),this._set("primarySourceName",d.primarySourceName),this._set("styleRepository",new L(d.style,d)),this.read(d.layerDefinition,{origin:"service"}),[2]}})})};c.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);if(b&&(a=b[3]&&
b[3].toLowerCase()))for(var b=b[2]||"",c=0,d="OpenStreetMap_v2 OpenStreetMap_Export_v2 OpenStreetMap_FTS_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84".split(" ");c<d.length;c++){var e=d[c];if(-1<e.toLowerCase().indexOf(a))return r.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+e)}};c.prototype._getPrimarySource=function(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?this.sourceNameToSource[this.primarySourceName]:
null};c.prototype._loadStyle=function(b){return g(this,void 0,void 0,function(){return a(this,function(a){return this._loadingPromise?[2,this._loadingPromise]:[2,this.loadStyle(null,b)]})})};h([t.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],c.prototype,"attributionDataUrl",null);h([t.property({type:["show","hide"]})],c.prototype,"listMode",void 0);h([t.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"capabilities",null);h([t.property({readOnly:!0})],
c.prototype,"currentStyleInfo",void 0);h([t.property({json:{read:!1},readOnly:!0,type:x,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"fullExtent",null);h([t.property()],c.prototype,"style",void 0);h([t.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],c.prototype,"isReference",void 0);h([t.property({type:["VectorTileLayer"]})],c.prototype,"operationalLayerType",void 0);h([t.property({readOnly:!0,dependsOn:["serviceUrl"]})],
c.prototype,"parsedUrl",null);h([t.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],c.prototype,"serviceUrl",null);h([t.property({type:w,dependsOn:["tileInfo"],readOnly:!0})],c.prototype,"spatialReference",null);h([t.property({readOnly:!0})],c.prototype,"styleRepository",void 0);h([t.property({readOnly:!0})],c.prototype,"sourceNameToSource",void 0);h([t.property({readOnly:!0})],c.prototype,"primarySourceName",void 0);h([t.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},
origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],c.prototype,"styleUrl",null);h([t.writer(["portal-item","web-document"],"styleUrl")],c.prototype,"writeStyleUrl",null);h([t.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"tileIndexType",null);h([t.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"tileIndexUrl",null);h([t.property({json:{read:!1,origins:{service:{read:!1}}},
readOnly:!0,type:D,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"tileInfo",null);h([t.property({json:{read:!1},readOnly:!0,type:K.TilemapCache,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"tilemapCache",null);h([t.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"tileServers",null);h([t.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],c.prototype,"type",void 0);h([t.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},
"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],c.prototype,"url",void 0);h([t.property({readOnly:!0})],c.prototype,"version",void 0);h([t.reader("version",["version","currentVersion"])],c.prototype,"readVersion",null);h([t.property({readOnly:!0,dependsOn:["tileInfo"]})],c.prototype,"compatibleTileInfo256",null);h([t.property({readOnly:!0,dependsOn:["tileInfo"]})],c.prototype,"compatibleTileInfo512",null);return c=h([t.subclass("esri.layers.VectorTileLayer")],c)}(t.declared(B.ScaleRangeLayer(y.ArcGISCachedService(m.ArcGISService(v.OperationalLayer(z.PortalLayer(c.MultiOriginJSONMixin(u))))))))})},
"esri/layers/support/SpriteSource":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/promiseUtils".split(" "),function(n,b,l,k,h,a,g,e,d,f,c,q){Object.defineProperty(b,"__esModule",{value:!0});var p=c.getLogger("esri.layers.support.SpriteSource");n=function(){function b(a,
b){this.baseURL=a;this.devicePixelRatio=b;this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;this.loadStatus="not-loaded"}Object.defineProperty(b.prototype,"spriteNames",{get:function(){var a=[],b;for(b in this._spritesData)a.push(b);a.sort();return a},enumerable:!0,configurable:!0});b.prototype.getSpriteInfo=function(a){return this._spritesData[a]};b.prototype.load=function(b){return g(this,void 0,void 0,function(){return a(this,function(a){switch(a.label){case 0:q.throwIfAborted(b);
this.loadStatus="loading";if(!this.baseURL)return[2,q.resolve(this)];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._loadSprites(b)];case 2:return a.sent(),this.loadStatus="loaded",[3,4];case 3:return a.sent(),this.loadStatus="failed",[3,4];case 4:return[2,this]}})})};b.prototype._loadSprites=function(a){var b=this;this._isRetina=1.15<this.devicePixelRatio?!0:!1;var c=this.baseURL,g=this._isRetina?"@2x":"",k=""+c+g+".png";return q.all([e(c+g+".json",a),e(k,h({responseType:"image"},a))]).then(function(a){var e=
a[0];a=a[1];var g=Object.keys(e.data);if(!g||0===g.length||1===g.length&&"_ssl"===g[0]||!a||!a.data)return b._spritesData=b.image=null,b.width=b.height=0,q.resolve(null);b._spritesData=e.data;e=a.data;a=Math.max(f("esri-webgl-max-texture-size"),4096);if(e.width>a||e.height>a)throw e="Sprite resource for style "+c+" is bigger than the maximum allowed of "+a+" pixels}",p.error(e),new d("SpriteSource",e);b.width=e.width;b.height=e.height;a=document.createElement("canvas");g=a.getContext("2d");a.width=
e.width;a.height=e.height;g.drawImage(e,0,0,e.width,e.height);e=g.getImageData(0,0,e.width,e.height);e=new Uint8Array(e.data);for(g=0;g<e.length;g+=4)a=e[g+3]/255,e[g]*=a,e[g+1]*=a,e[g+2]*=a;b.image=e})};return b}();b.default=n})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../config ../../request ../../core/promiseUtils ../../core/urlUtils ../../views/2d/engine/vectorTiles/style/VectorTileSource".split(" "),
function(n,b,l,k,h,a,g,e,d,f){function c(a){a&&(a=d.getOrigin(a),x&&-1===x.indexOf(a)&&x.push(a))}function q(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var b=void 0,c=0;c<a.length;++c)d.isProtocolRelative(a[c])?b&&(b=b.split("://")[0]+":"+a[c].trim()):b=d.isAbsolute(a[c])?a[c]:d.join(b,a[c]);return b}function p(a,b,f,m,p){return h(this,void 0,void 0,function(){var h,q,n,v,u,y;return k(this,function(k){switch(k.label){case 0:e.throwIfAborted(p);if("string"!==typeof f)return[3,
2];v=d.normalize(f);c(v);u=d.urlToObject(v);return[4,g(u.path,l({query:{f:"json"},responseType:"json"},p))];case 1:return n=k.sent(),q=h=v,[3,3];case 2:n={data:f},h=f.jsonUrl||null,q=m,k.label=3;case 3:return y=n.data,n.ssl&&(h&&(h=h.replace(/^http:/i,"https:")),q&&(q=q.replace(/^http:/i,"https:"))),y.sources?(a.styleUrl=h||null,[2,r(a,y,q,p)]):y.sources?[2,e.reject("You must specify the URL or the JSON for a service or for a style.")]:a.sourceUrl?[2,t(a,y,q,!1,b,p)]:(a.sourceUrl=h||null,[2,t(a,y,
q,!0,b,p)])}})})}function r(a,b,f,g){return h(this,void 0,void 0,function(){var h,m,l,r,n,t;return k(this,function(k){switch(k.label){case 0:h=f?d.removeFile(f):d.appBaseUrl;a.styleBase=h;a.style=b;a.styleUrl&&c(a.styleUrl);m=[];if(!b.sources||!b.sources.esri)return[3,3];l=b.sources.esri;return l.url?[4,p(a,"esri",q(h,l.url),void 0,g)]:[3,2];case 1:return k.sent(),[3,3];case 2:m.push(p(a,"esri",l,h,g)),k.label=3;case 3:r=0;for(n=Object.keys(b.sources);r<n.length;r++)t=n[r],"esri"!==t&&"vector"===
b.sources[t].type&&(b.sources[t].url?m.push(p(a,t,q(h,b.sources[t].url),void 0,g)):m.push(p(a,t,b.sources[t],h,g)));return[4,e.all(m)];case 4:return k.sent(),[2]}})})}function t(a,b,g,m,l,r){return h(this,void 0,void 0,function(){var h,n,v,t;return k(this,function(k){h=g?d.removeTrailingSlash(g)+"/":d.appBaseUrl;k=h;if(b.hasOwnProperty("tileInfo"))n=b;else{for(var u={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},
y=78271.51696400007,x=2.958287637957775E8,w=[],z=b.hasOwnProperty("minzoom")?parseFloat(b.minzoom):0,B=b.hasOwnProperty("maxzoom")?parseFloat(b.maxzoom):16,C=0;C<=B;C++)C>=z&&w.push({level:C,scale:x,resolution:y}),y/=2,x/=2;y=0;for(x=b.tiles;y<x.length;y++)c(q(k,x[y]));n={capabilities:"TilesOnly",initialExtent:u,fullExtent:u,minScale:w[0].scale,maxScale:w[w.length-1].scale,tiles:b.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:w,spatialReference:{wkid:102100}}}}v=
new f(l,h,n);if(!m&&a.primarySourceName in a.sourceNameToSource){t=a.sourceNameToSource[a.primarySourceName];if(!t.isCompatibleWith(v))return[2,e.resolve()];null!=v.fullExtent&&(null!=t.fullExtent?t.fullExtent.union(v.fullExtent):t.fullExtent=v.fullExtent.clone());t.tileInfo.lods.length<v.tileInfo.lods.length&&(t.tileInfo=v.tileInfo)}m?(a.sourceBase=h,a.source=b,a.validatedSource=n,a.primarySourceName=l,a.sourceUrl&&c(a.sourceUrl)):c(h);a.sourceNameToSource[l]=v;return a.style?[2]:null==b.defaultStyles?
[2,e.reject()]:"string"===typeof b.defaultStyles?[2,p(a,"",q(h,b.defaultStyles,"root.json"),void 0,r)]:[2,p(a,"",b.defaultStyles,q(h,"root.json"),r)]})})}Object.defineProperty(b,"__esModule",{value:!0});var x=a.defaults&&a.defaults.io.corsEnabledServers;b.loadMetadata=function(a,b){return h(this,void 0,void 0,function(){var e,f,g,h,l,r;return k(this,function(k){switch(k.label){case 0:return e={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,
sourceNameToSource:{},primarySourceName:""},f="string"===typeof a?[a,null]:[null,a.jsonUrl],g=f[0],h=f[1],l=g?d.urlToObject(g):null,[4,p(e,"esri",a,h,b)];case 1:return k.sent(),r={layerDefinition:e.validatedSource,url:g,parsedUrl:l,serviceUrl:e.sourceUrl,style:e.style,styleUrl:e.styleUrl,spriteUrl:e.style.sprite&&q(e.styleBase,e.style.sprite),glyphsUrl:e.style.glyphs&&q(e.styleBase,e.style.glyphs),sourceNameToSource:e.sourceNameToSource,primarySourceName:e.primarySourceName},c(r.spriteUrl),c(r.glyphsUrl),
[2,r]}})})}})},"esri/views/2d/engine/vectorTiles/style/VectorTileSource":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/lang ../../../../../core/urlUtils ../../../../../geometry/Extent ../../../../../layers/support/serviceTileInfoProperty ../../../../../layers/support/TilemapCache ../TileIndex".split(" "),function(n,b,l,k,h,a,g,e,d,f){return function(){function b(b,c,k){this.tileMapURL="";this.fullExtent=
this.tileIndex=this.capabilities=this.tileInfo=this.parsedUrl=this.tilemapCache=null;this.name=b;if(this.sourceUrl=c)this.parsedUrl=a.urlToObject(this.sourceUrl);b=h.clone(k);var l=b.tiles;c&&l.forEach(function(b,d){a.isAbsolute(b)||(l[d]=a.join(c,b))});this.tileServers=l;k.tileMap&&(this.tileMapURL=a.join(c,k.tileMap));var p=k.capabilities&&k.capabilities.split(",").map(function(a){return a.toLowerCase().trim()}),q=!!k.exportTilesAllowed,p=!!p&&-1!==p.indexOf("tilemap"),r=q&&k.hasOwnProperty("maxExportTilesCount")?
k.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:q,supportsTileMap:p},exportTiles:q?{maxExportTilesCount:+r}:null};this.tileInfo=e.readServiceTileInfo(b.tileInfo,b,null,{ignoreMinMaxLOD:!0});p&&(this.type="vector-tile",this.tilemapCache=new d.TilemapCache({layer:this}),this.tileIndex=new f(this.tilemapCache));this.fullExtent=g.fromJSON(k.fullExtent)}b.prototype.getRefKey=function(a,b){return k(this,void 0,void 0,function(){return l(this,function(c){return this.tileIndex?
[2,this.tileIndex.dataKey(a,b)]:[2,a]})})};b.prototype.getSourceTileUrl=function(a,b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};b.prototype.isCompatibleWith=function(a){var b=this.tileInfo;a=a.tileInfo;if(!b.spatialReference.equals(a.spatialReference)||!b.origin.equals(a.origin)||Math.round(b.dpi)!==Math.round(a.dpi))return!1;b=b.lods;a=a.lods;for(var c=Math.min(b.length,a.length),
d=0;d<c;d++){var e=b[d],f=a[d];if(e.level!==f.level||Math.round(e.scale)!==Math.round(f.scale))return!1}return!0};return b}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["require","exports","../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(n,b,l,k,h){return function(){function a(a){if(a instanceof k.TilemapCache)this._tilemapCache=a;else if(a&&"index"in a)this._tilemap=a.index;else throw Error("Invalid tilemap!");}a.prototype.dataKey=
function(a,b){if(this._tilemapCache){var d=a.level,e=a.row,c=a.col,g=new h(a);return this._tilemapCache.fetchAvailabilityUpsample(d,e,c,g,b).then(function(){return g}).catch(function(a){if(l.isAbortError(a))throw a;g.level=d;g.row=e;g.col=c;return g})}return this._getIndexedDataKey(a)};a.prototype.forEach=function(a,b,d,f,c){this._callback=c;this._maxLevel=b+a;this._forEach(this._tilemap,b,d,f)};a.prototype._forEach=function(a,b,d,f){0!==a&&(this._callback(b,d,f),b!==this._maxLevel&&"object"===typeof a&&
(this._forEach(a[0],b+1,2*d,2*f),this._forEach(a[1],b+1,2*d,2*f+1),this._forEach(a[2],b+1,2*d+1,2*f),this._forEach(a[3],b+1,2*d+1,2*f+1)))};a.prototype._getIndexedDataKey=function(a){var b=[a];if(0>a.level||0>a.row||0>a.col||0<a.row>>a.level||0<a.col>>a.level)return l.resolve(null);for(;0!==a.level;)a=new h(a.level-1,a.row>>1,a.col>>1,a.world),b.push(a);a=this._tilemap;var d=b.pop(),f,c;if(1===a)return l.resolve(d);for(;b.length;)if(f=b.pop(),c=(f.col&1)+((f.row&1)<<1),a){if(0===a[c]){d=null;break}if(1===
a[c]){d=f;break}d=f;a=a[c]}return l.resolve(d)};return a}()})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(n,b,l){return function(){function b(b,a,g,e){this.set(b,a,g,e)}b.getId=function(b,a,g,e){return"object"===typeof b?b.level+"/"+b.row+"/"+b.col+"/"+b.world:b+"/"+a+"/"+g+"/"+e};Object.defineProperty(b.prototype,"key",{get:function(){return this},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this.toString()},
enumerable:!0,configurable:!0});b.prototype.equals=function(b){return this.level===b.level&&this.row===b.row&&this.col===b.col&&this.world===b.world};b.prototype.release=function(){this.world=this.col=this.row=this.level=0};b.prototype.set=function(b,a,g,e){null==b?this.world=this.col=this.row=this.level=0:"object"===typeof b?(this.level=b.level||0,this.row=b.row||0,this.col=b.col||0,this.world=b.world||0):"string"===typeof b?(b=b.split("/"),a=b[1],g=b[2],e=b[3],this.level=parseFloat(b[0]),this.row=
parseFloat(a),this.col=parseFloat(g),this.world=parseFloat(e)):(this.level=+b,this.row=+a,this.col=+g,this.world=+e||0);return this};b.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+"/"+this.world};b.prototype.getChildKeys=function(){var h=this.level+1,a=this.row<<1,g=this.col<<1,e=this.world;return[new b(h,a,g,e),new b(h,a,g+1,e),new b(h,a+1,g,e),new b(h,a+1,g+1,e)]};b.prototype.compareRowMajor=function(b){return this.row<b.row?-1:this.row>b.row?1:this.col<b.col?-1:this.col>
b.col?1:0};b.pool=new l(b,!0,null,25,50);return b}()})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.createForItem=function(b){return{origin:"portal-item",url:l.urlToObject(b.itemUrl),portal:b.portal||k.getDefault()}}})},"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["require","exports","../../../../layers/support/LOD","../../../../layers/support/TileInfo"],
function(n,b,l,k){return function(){function b(a,b){this.lockedSchemaPixelSize=a;this.isGCS=b}b.prototype.getLevelRowColumn=function(a){return this.isGCS?[a[0],a[1]>>1,a[2]>>1]:256===this.lockedSchemaPixelSize&&0<a[0]?[a[0]-1,a[1]>>1,a[2]>>1]:a};b.prototype.adjustLevel=function(a){return this.isGCS?a:256===this.lockedSchemaPixelSize?0<a?a-1:0:a};b.prototype.getShift=function(a,b){var e=0,d=0;if(256===this.lockedSchemaPixelSize||this.isGCS)a[2]%2&&(e=b),a[1]%2&&(d=b);return[e,d]};b.prototype.getScale=
function(a){if(this.isGCS){if(512===this.lockedSchemaPixelSize)return 4}else if(256===this.lockedSchemaPixelSize&&0===a)return 1;return 2};b.create256x256CompatibleTileInfo=function(a){if(!a)return null;if(256===a.size[0]&&256===a.size[1])return a;for(var b=a.spatialReference.isGeographic,e=[],d=a.lods.length,f=0;f<d;f++){var c=a.lods[f];e.push(new l({level:c.level,scale:c.scale,resolution:b?c.resolution:2*c.resolution}))}return new k({size:[256,256],dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,
origin:a.origin,spatialReference:a.spatialReference,lods:e})};b.create512x512CompatibleTileInfo=function(a){if(!a||256===a.size[0]||256===a.size[1])return null;for(var b=[],e=a.lods.length,d=0;d<e;d++){var f=a.lods[d];b.push(new l({level:f.level,scale:f.scale,resolution:.5*f.resolution}))}return new k({size:[512,512],dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,origin:a.origin,spatialReference:a.spatialReference,lods:b})};return b}()})},"esri/views/2d/engine/vectorTiles/tileInfoUtils":function(){define(["require",
"exports","../../../../layers/support/TileInfo"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.areSchemasOverlapping=function(b,h){if(b===h)return!0;if(!b&&null!=h||null!=b&&!h||!b.spatialReference.equals(h.spatialReference)||b.dpi!==h.dpi)return!1;var a=b.origin,g=h.origin;if(1E-6<=Math.abs(a.x-g.x)||1E-6<=Math.abs(a.y-g.y))return!1;b.lods[0].scale>h.lods[0].scale?(a=b,b=h):a=h;for(h=a.lods[0].scale;h>=b.lods[b.lods.length-1].scale-1E-6;h/=2)if(1E-6>Math.abs(h-b.lods[0].scale))return!0;
return!1};b.unionTileInfos=function(b,h){if(b===h)return b;if(!b&&null!=h)return h;if(null!=b&&!h)return b;var a=b.size[0],g=b.format,e=b.dpi,d={x:b.origin.x,y:b.origin.y},f=b.spatialReference.toJSON(),c=b.lods[0].scale>h.lods[0].scale?b.lods[0]:h.lods[0];b=(b.lods[b.lods.length-1].scale<=h.lods[h.lods.length-1].scale?b.lods[b.lods.length-1]:h.lods[h.lods.length-1]).scale;h=[];for(var k=c.scale,c=c.resolution,p=0;k>b;)h.push({level:p,resolution:c,scale:k}),p++,k/=2,c/=2;return new l({size:[a,a],dpi:e,
format:g||"pbf",origin:d,lods:h,spatialReference:f})}})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["require","exports","../../../../../core/has","./StyleLayer"],function(n,b,l,k){return function(){function b(a,g){this.backgroundBucketIds=[];this._layerByName={};this.styleJSON=a;this.version=parseFloat(a.version);this.sprite=g?g.spriteUrl:a.sprite;this.glyphs=g?g.glyphsUrl:a.glyphs;if(this.layers=(a.layers||[]).map(b._create))for(a=void 0,g=0;g<this.layers.length;g++)a=
this.layers[g],this._layerByName[a.id.toLowerCase()]=a,0===a.type&&this.backgroundBucketIds.push(g);this._identifyRefLayers()}b.prototype.isPainterDataDriven=function(a){return(a=this._layerByName[a.toLowerCase()])?a.isPainterDataDriven():!1};b.prototype.getStyleLayerId=function(a){return a>=this.layers.length?null:this.layers[a].id};b.prototype.getLayoutProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?a.layout:null};b.prototype.getPaintProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?
a.paint:null};b.prototype.setPaintProperties=function(a,g){a=this._layerByName[a.toLowerCase()];if(!a)return"";var e=this.layers.indexOf(a);this.styleJSON.layers[e].paint=g;g=b._recreateLayer({id:a.id,type:a.typeName,source:a.source,sourceLayer:a["source-layer"],minzoom:a.minzoom,maxzoom:a.maxzoom,filter:a.filter,layout:a.layout,paint:g},a);this.layers[e]=g;this._layerByName[a.id.toLowerCase()]=g;return a.id};b.prototype.setLayoutProperties=function(a,g){a=this._layerByName[a.toLowerCase()];if(!a)return"";
var e=this.layers.indexOf(a);this.styleJSON.layers[e].layout=g;g=b._recreateLayer({id:a.id,type:a.typeName,source:a.source,sourceLayer:a["source-layer"],minzoom:a.minzoom,maxzoom:a.maxzoom,filter:a.filter,layout:g,paint:a.paint},a);this.layers[e]=g;this._layerByName[a.id.toLowerCase()]=g;return a.id};b.prototype._identifyRefLayers=function(){for(var a=[],b=[],e=0,d=0,f=this.layers;d<f.length;d++){var c=f[d];if(1===c.type){var h=c,k=c.source+"|"+c.sourceLayer,k=k+("|"+JSON.stringify(c.layout&&c.layout.visibility)),
k=k+("|"+JSON.stringify(c.minzoom)),k=k+("|"+JSON.stringify(c.maxzoom)),k=k+("|"+JSON.stringify(c.filter));if(h.hasDataDrivenFill||h.hasDataDrivenOutline)k+="|"+JSON.stringify(e);a.push({key:k,layer:c})}2===c.type&&(h=c,k=c.source+"|"+c.sourceLayer,k+="|"+JSON.stringify(c.layout&&c.layout.visibility),k+="|"+JSON.stringify(c.minzoom),k+="|"+JSON.stringify(c.maxzoom),k+="|"+JSON.stringify(c.filter),k+="|"+JSON.stringify(c.layout&&c.layout["line-cap"]),k+="|"+JSON.stringify(c.layout&&c.layout["line-join"]),
h.hasDataDrivenLine&&(k+="|"+JSON.stringify(e)),b.push({key:k,layer:c}));++e}this._assignRefLayers(a);this._assignRefLayers(b)};b.prototype._assignRefLayers=function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var b,e,d=a.length,f=0;f<d;f++){var c=a[f];if(c.key===b)c.layer.refLayerId=e;else if(b=c.key,e=c.layer.id,1===c.layer.type&&!c.layer.getPaintProperty("fill-outline-color"))for(var h=f+1;h<d;h++){var k=a[h];if(k.key===b){if(k.layer.getPaintProperty("fill-outline-color")){a[f]=
k;a[h]=c;e=k.layer.id;break}}else break}}};b._create=function(a,b,e){b=1-1/(e.length+1)*(1+b);switch(a.type){case "background":return new k.BackgroundStyleLayer(0,a,b);case "fill":return new k.FillStyleLayer(1,a,b);case "line":return new k.LineStyleLayer(2,a,b);case "symbol":return new k.SymbolStyleLayer(3,a,b);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new k.CircleStyleLayer(4,a,b)}throw Error("Unknown vector tile layer");};b._recreateLayer=function(a,
b){switch(a.type){case "background":return new k.BackgroundStyleLayer(0,a,b.z);case "fill":return new k.FillStyleLayer(1,a,b.z);case "line":return new k.LineStyleLayer(2,a,b.z);case "symbol":return new k.SymbolStyleLayer(3,a,b.z);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new k.CircleStyleLayer(4,a,b.z)}};return b}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,d){this.type=a;this.typeName=b.type;this.id=b.id;this.source=b.source;this.sourceLayer=b["source-layer"];this.minzoom=b.minzoom;this.maxzoom=b.maxzoom;this.filter=b.filter;this.layout=b.layout;this.paint=b.paint;this.z=d;switch(a){case 0:this._layoutDefinition=h.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=h.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=
h.StyleDefinition.fillLayoutDefinition;this._paintDefinition=h.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=h.StyleDefinition.lineLayoutDefinition;this._paintDefinition=h.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=h.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=h.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=h.StyleDefinition.circleLayoutDefinition,this._paintDefinition=h.StyleDefinition.circlePaintDefinition}this._layoutProperties=
this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}b.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=k.createFilter(this.filter)};b.prototype.getLayoutProperty=function(a){var b=this._layoutProperties;if(b)return b[a]};b.prototype.getPaintProperty=function(a){var b=this._paintProperties;if(b)return b[a]};b.prototype.getLayoutValue=function(a,b,d){var c,e=this._layoutProperties;e&&(e=e[a])&&(c=e.getValue(b,
d));a=this._layoutDefinition[a];void 0===c&&(c=a["default"]);"enum"===a.type&&(c=a.values.indexOf(c));return c};b.prototype.getPaintValue=function(a,b,d){var c,e=this._paintProperties;e&&(e=e[a])&&(c=e.getValue(b,d));a=this._paintDefinition[a];void 0===c&&(c=a["default"]);"enum"===a.type&&(c=a.values.indexOf(c));return c};b.prototype.isPainterDataDriven=function(){var a=this._paintProperties;if(a)for(var b in a)if(a[b].isDataDriven)return!0;return!1};b.prototype._parseLayout=function(b){var c={},
d;for(d in b){var e=this._layoutDefinition[d];e&&(c[d]=new a(d,e,b[d]))}return c};b.prototype._parsePaint=function(b){var c={},d;for(d in b){var e=this._paintDefinition[d];e&&(c[d]=new a(d,e,b[d]))}return c};return b}();b.StyleLayer=n;var e=function(a){function b(b,d,e){return a.call(this,b,d,e)||this}l(b,a);return b}(n);b.BackgroundStyleLayer=e;e=function(a){function b(b,d,e){b=a.call(this,b,d,e)||this;d=b.getPaintProperty("fill-color");b.hasDataDrivenColor=d?d.isDataDriven:!1;d=b.getPaintProperty("fill-opacity");
b.hasDataDrivenOpacity=d?d.isDataDriven:!1;b.hasDataDrivenFill=b.hasDataDrivenColor||b.hasDataDrivenOpacity;d=b.getPaintProperty("fill-outline-color");b.outlineUsesFillColor=!d;b.hasDataDrivenOutlineColor=d?d.isDataDriven:!1;b.hasDataDrivenOutline=(d?b.hasDataDrivenOutlineColor:b.hasDataDrivenColor)||b.hasDataDrivenOpacity;return b}l(b,a);return b}(n);b.FillStyleLayer=e;e=function(a){function b(b,d,e){b=a.call(this,b,d,e)||this;e=b.getPaintProperty("line-color");b.hasDataDrivenColor=e?e.isDataDriven:
!1;e=b.getPaintProperty("line-opacity");b.hasDataDrivenOpacity=e?e.isDataDriven:!1;e=b.getPaintProperty("line-width");b.hasDataDrivenWidth=e?e.isDataDriven:!1;b.hasDataDrivenLine=b.hasDataDrivenColor||b.hasDataDrivenOpacity||b.hasDataDrivenWidth;d=d.paint["line-width"];d||(d=h.StyleDefinition.linePaintDefinition["line-width"].default);b.isThinLine=!b.hasDataDrivenWidth&&"number"===typeof d&&d<g.THIN_LINE_THRESHOLD;return b}l(b,a);return b}(n);b.LineStyleLayer=e;e=function(a){function b(b,d,e){b=a.call(this,
b,d,e)||this;d=b.getPaintProperty("icon-color");b.hasDataDrivenIconColor=d?d.isDataDriven:!1;d=b.getPaintProperty("icon-opacity");b.hasDataDrivenIconOpacity=d?d.isDataDriven:!1;d=b.getLayoutProperty("icon-size");b.hasDataDrivenIconSize=d?d.isDataDriven:!1;b.hasDataDrivenIcon=b.hasDataDrivenIconColor||b.hasDataDrivenIconOpacity||b.hasDataDrivenIconSize;d=b.getPaintProperty("text-color");b.hasDataDrivenTextColor=d?d.isDataDriven:!1;d=b.getPaintProperty("text-opacity");b.hasDataDrivenTextOpacity=d?d.isDataDriven:
!1;d=b.getLayoutProperty("text-size");b.hasDataDrivenTextSize=d?d.isDataDriven:!1;b.hasDataDrivenText=b.hasDataDrivenTextColor||b.hasDataDrivenTextOpacity||b.hasDataDrivenTextSize;return b}l(b,a);return b}(n);b.SymbolStyleLayer=e;n=function(a){function b(b,d,e){b=a.call(this,b,d,e)||this;d=b.getPaintProperty("circle-radius");b.hasDataDrivenRadius=d?d.isDataDriven:!1;d=b.getPaintProperty("circle-color");b.hasDataDrivenColor=d?d.isDataDriven:!1;d=b.getPaintProperty("circle-opacity");b.hasDataDrivenOpacity=
d?d.isDataDriven:!1;d=b.getPaintProperty("circle-stroke-width");b.hasDataDrivenStrokeWidth=d?d.isDataDriven:!1;d=b.getPaintProperty("circle-stroke-color");b.hasDataDrivenStrokeColor=d?d.isDataDriven:!1;d=b.getPaintProperty("circle-stroke-opacity");b.hasDataDrivenStrokeOpacity=d?d.isDataDriven:!1;d=b.getPaintProperty("circle-blur");b.hasDataDrivenBlur=d?d.isDataDriven:!1;return b}l(b,a);return b}(n);b.CircleStyleLayer=n;n=function(){return function(a,b,c){this.cap=a.getLayoutValue("line-cap",b,c);
this.join=a.getLayoutValue("line-join",b,c);this.miterLimit=a.getLayoutValue("line-miter-limit",b,c);this.roundLimit=a.getLayoutValue("line-round-limit",b,c)}}();b.LineLayout=n;n=function(){return function(a,b,c,e){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",b,e);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",b,e);this.optional=a.getLayoutValue("icon-optional",b,e);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",b,e);this.size=a.getLayoutValue("icon-size",
b,e);this.rotate=a.getLayoutValue("icon-rotate",b,e);this.padding=a.getLayoutValue("icon-padding",b,e);this.keepUpright=a.getLayoutValue("icon-keep-upright",b,e);this.offset=a.getLayoutValue("icon-offset",b,e);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();b.IconLayout=n;n=function(){return function(a,b,c,e){this.allowOverlap=a.getLayoutValue("text-allow-overlap",b,e);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",b,e);this.optional=a.getLayoutValue("text-optional",
b,e);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",b,e);this.fontArray=a.getLayoutValue("text-font",b,e);this.maxWidth=a.getLayoutValue("text-max-width",b,e);this.lineHeight=a.getLayoutValue("text-line-height",b,e);this.letterSpacing=a.getLayoutValue("text-letter-spacing",b,e);this.justify=a.getLayoutValue("text-justify",b,e);this.anchor=a.getLayoutValue("text-anchor",b,e);this.maxAngle=a.getLayoutValue("text-max-angle",b,e);this.size=a.getLayoutValue("text-size",b,e);this.rotate=
a.getLayoutValue("text-rotate",b,e);this.padding=a.getLayoutValue("text-padding",b,e);this.keepUpright=a.getLayoutValue("text-keep-upright",b,e);this.transform=a.getLayoutValue("text-transform",b,e);this.offset=a.getLayoutValue("text-offset",b,e);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();b.TextLayout=n})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["require","exports"],function(n,b){return function(){function b(k,h,a){this._op=k;"$type"===h?(this._val=a instanceof
Array?a.map(function(a){return b._types.indexOf(a)}):b._types.indexOf(a),this._op+=11):(this._key=h,this._val=a)}b.prototype.filter=function(b){switch(this._op){case 0:return this._val;case 1:return b.values[this._key]===this._val;case 2:return b.values[this._key]!==this._val;case 3:return b.values[this._key]<this._val;case 4:return b.values[this._key]>this._val;case 5:return b.values[this._key]<=this._val;case 6:return b.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(b.values[this._key]);
case 8:return-1===this._val.indexOf(b.values[this._key]);case 9:for(var h=0,a=this._val;h<a.length;h++){var g=a[h];if(g.filter(b))return!0}return!1;case 10:h=0;for(a=this._val;h<a.length;h++)if(g=a[h],!g.filter(b))return!1;return!0;case 11:h=0;for(a=this._val;h<a.length;h++)if(g=a[h],g.filter(b))return!1;return!0;case 12:return b.type===this._val;case 13:return b.type!==this._val;case 14:return b.type<this._val;case 15:return b.type>this._val;case 16:return b.type>=this._val;case 17:return b.type<=
this._val;case 18:return-1!==this._val.indexOf(b.type);case 19:return-1===this._val.indexOf(b.type);case 20:return void 0!==b.values[this._key];case 21:return void 0===b.values[this._key]}};b.createFilter=function(k){if(!k)return new b(0,void 0,!0);var h=k[0];if(1>=k.length)return new b(0,void 0,"any"!==h);switch(h){case "\x3d\x3d":return new b(1,k[1],k[2]);case "!\x3d":return new b(2,k[1],k[2]);case "\x3e":return new b(4,k[1],k[2]);case "\x3c":return new b(3,k[1],k[2]);case "\x3e\x3d":return new b(6,
k[1],k[2]);case "\x3c\x3d":return new b(5,k[1],k[2]);case "in":return new b(7,k[1],k.slice(2));case "!in":return new b(8,k[1],k.slice(2));case "any":return new b(9,void 0,k.slice(1).map(b.createFilter.bind(this)));case "all":return new b(10,void 0,k.slice(1).map(b.createFilter.bind(this)));case "none":return new b(11,void 0,k.slice(1).map(b.createFilter.bind(this)));case "has":return new b(20,k[1],void 0);case "!has":return new b(21,k[1],void 0);default:throw Error("invalid operator: "+h);}};b._types=
["Unknown","Point","LineString","Polygon"];return b}()})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){}b.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};b.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};b.lineLayoutDefinition={visibility:{type:"enum",values:["visible",
"none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};b.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"symbol-avoid-edges":{type:"boolean",
default:!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",default:!1},"icon-optional":{type:"boolean",default:!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"icon-rotate":{type:"number",default:0},"icon-padding":{type:"number",minimum:0,default:2},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",
length:2,default:[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,default:16},"text-max-width":{type:"number",minimum:0,default:10},"text-line-height":{type:"number",default:1.2},"text-letter-spacing":{type:"number",default:0},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},
"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"text-max-angle":{type:"number",minimum:0,default:45},"text-rotate":{type:"number",default:0},"text-padding":{type:"number",minimum:0,default:2},"text-keep-upright":{type:"boolean",default:!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-allow-overlap":{type:"boolean",
default:!1},"text-ignore-placement":{type:"boolean",default:!1},"text-optional":{type:"boolean",default:!1}};b.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};b.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-color":{type:"color",default:[0,0,0,1]},"background-pattern":{type:"string"}};b.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-antialias":{type:"boolean",
default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"fill-pattern":{type:"string"}};b.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-color":{type:"color",default:[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",
values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-blur":{type:"number",minimum:0,default:0},"line-dasharray":{type:"array",value:"number",default:[]},"line-pattern":{type:"string"}};b.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-color":{type:"color",default:[0,0,0,0]},
"icon-halo-width":{type:"number",minimum:0,default:0},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-halo-blur":{type:"number",minimum:0,
default:0},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};b.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},
"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};b.circlePaintDefinition={"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-color":{type:"color",default:[0,0,0,1]},"circle-blur":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],
default:"map"},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1}};return b}();b.StyleDefinition=n})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../../../Color","../GeometryUtils"],function(n,b,l,k){return function(){function b(a,g,e){this.isDataDriven=!1;switch(g.type){case "number":a=!0;break;case "color":a=
!0;e=b._parseColor(e);break;case "array":a="number"===g.value;break;default:a=!1}null==e&&(e=g.default);a&&"interval"===e.type&&(a=!1);var d=e&&e.stops&&0<e.stops.length;if(d)for(var f=0,c=e.stops;f<c.length;f++){var h=c[f];h[1]=this._validate(h[1],g)}if(this.isDataDriven=e?!!e.property:!1)if(void 0!==e.default&&(e.default=this._validate(e.default,g)),d)switch(e.type){case "identity":this.getValue=this._buildIdentity(e,g);break;case "categorical":this.getValue=this._buildCategorical(e,g);break;default:this.getValue=
a?this._buildInterpolate(e,g):this._buildInterval(e,g)}else this.getValue=this._buildIdentity(e,g);else d?this.getValue=a?this._buildZoomInterpolate(e):this._buildZoomInterval(e):(e=this._validate(e,g),this.getValue=this._buildSimple(e))}b.prototype._validate=function(a,b){if("number"===b.type){if(a<b.minimum)return b.minimum;if(a>b.maximum)return b.maximum}return a};b.prototype._buildSimple=function(a){return function(){return a}};b.prototype._buildIdentity=function(a,g){var e=this;return function(d,
f){var c;f&&(c=f.values[a.property],"color"===g.type&&(c=b._parseColor(c)));void 0===c&&(c=a.default);return void 0!==c?e._validate(c,g):g.default}};b.prototype._buildCategorical=function(a,b){var e=this;return function(d,f){var c;f&&(c=f.values[a.property]);c=e._categorical(c,a.stops);return void 0!==c?c:void 0!==a.default?a.default:b.default}};b.prototype._buildInterval=function(a,b){var e=this;return function(d,f){var c;f&&(c=f.values[a.property]);return"number"===typeof c?e._interval(c,a.stops):
void 0!==a.default?a.default:b.default}};b.prototype._buildInterpolate=function(a,b){var e=this;return function(d,f){var c;f&&(c=f.values[a.property]);return"number"===typeof c?e._interpolate(c,a.stops,a.base||1):void 0!==a.default?a.default:b.default}};b.prototype._buildZoomInterpolate=function(a){var b=this;return function(e){return b._interpolate(e,a.stops,a.base||1)}};b.prototype._buildZoomInterval=function(a){var b=this;return function(e){return b._interval(e,a.stops)}};b.prototype._categorical=
function(a,b){for(var e=b.length,d=0;d<e;d++)if(b[d][0]===a)return b[d][1]};b.prototype._interval=function(a,b){for(var e=b.length,d=0,f=0;f<e;f++)if(b[f][0]<=a)d=f;else break;return b[d][1]};b.prototype._interpolate=function(a,b,e){for(var d,f,c=b.length,g=0;g<c;g++){var h=b[g];if(h[0]<=a)d=h;else{f=h;break}}if(d&&f){g=f[0]-d[0];a-=d[0];e=1===e?a/g:(Math.pow(e,a)-1)/(Math.pow(e,g)-1);if(Array.isArray(d[1])){d=d[1];f=f[1];a=[];for(g=0;g<d.length;g++)a.push(k.interpolate(d[g],f[g],e));return a}return k.interpolate(d[1],
f[1],e)}if(d)return d[1];if(f)return f[1]};b._isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};b._parseColor=function(a){if(Array.isArray(a))return a;if("string"===typeof a){if(a=new l(a),!this._isEmpty(a))return l.toUnitRGBA(a)}else return a&&a.default&&(a.default=b._parseColor(a.default)),a&&a.stops&&(a.stops=a.stops.map(function(a){return[a[0],b._parseColor(a[1])]})),a};return b}()})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),
function(n,b,l,k,h,a,g,e){function d(a,b,d,e){k.vec3.copy(f,d);f[e]=b[e];e=k.vec3.subtract(f,f,b);var g=k.vec3.subtract(c,a,b),g=k.vec3.dot(g,e),h=k.vec3.dot(e,e);b=0>=g?b:h<=g?d:k.vec3.add(f,b,k.vec3.scale(e,e,g/h));a=k.vec3.subtract(f,a,b);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*a[0]+a[1]*a[1]))}Object.defineProperty(b,"__esModule",{value:!0});var f=h.vec3f64.create(),c=h.vec3f64.create(),q=h.vec3f64.create(),p=h.vec3f64.create();b.isInsideExtent=function(b,c,d){void 0===d&&(d=0);b=b.extent;
return 0===d?a.containsPoint(b,c):a.containsPointWithMargin(b,c,d*Math.min(b[2]-b[0],b[3]-b[1]))};b.tiltOnEdge=d;b.tiltToExtentEdge=function(a,b){var c=a.elevationBounds;a=a.extent;c=.5*(c.min+c.max);q[0]=a[0];q[1]=a[1];q[2]=c;p[0]=a[2];p[1]=a[3];p[2]=c;a=c=Infinity;b[0]<q[0]?c=d(b,q,p,0):b[0]>p[0]&&(c=d(b,p,q,0));b[1]<q[1]?a=d(b,q,p,1):b[1]>p[1]&&(a=d(b,p,q,1));return Math.min(c,a)};b.checkIfTileInfoSupportedForViewSR=function(b,c,d){if(b.spatialReference.isGeographic)return new l("tilingscheme:local-gcs-not-supported",
"Geographic coordinate systems are not supported in local scenes");var f=e.checkUnsupported(b);if(f)return f;var h=b.lods,f=h[0].resolution*Math.pow(2,h[0].level),k=[f*b.size[0],f*b.size[1]],m=[b.origin.x,b.origin.y];c=a.fromExtent(c);var p=a.create();e.computeRowColExtent(c,k,m,p);k=(p[2]-p[0])*(p[3]-p[1]);k>g.MAX_ROOT_TILES?(h=h[0].scale*Math.pow(2,h[0].level),f=Math.max((c[3]-c[1])/b.size[1],(c[2]-c[0])/b.size[0])*h/f,c=Math.floor(Math.log(f)/Math.log(10)),f=Math.ceil(f/Math.pow(10,c))*Math.pow(10,
c),f=new l("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(h).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+f.toLocaleString()+".",{level0Scale:h,suggestedLevel0Scale:f,requiredNumRootTiles:k,allowedNumRootTiles:g.MAX_ROOT_TILES})):f=null;return f?f:d&&!b.spatialReference.equals(d)?new l("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require",
"exports","../../../core/Error","../support/projectionUtils","./TilingScheme"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});b.isInsideExtent=function(a,b,e){void 0===e&&(e=0);return!0};b.tiltToExtentEdge=function(a,b){return 0};b.checkIfTileInfoSupportedForViewSR=function(a,b,e){b=a.lods.length-1;if(a.spatialReference.isWebMercator){if(!h.makeWebMercatorAuxiliarySphere(b).compatibleWith(a))return new l("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(k.canProjectToWGS84ComparableLonLat(a.spatialReference)){if(!h.makeGCSWithTileSize(a.spatialReference,
a.size[0],b).compatibleWith(a))return a.spatialReference.isWGS84?new l("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new l("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new l("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(e&&!a.spatialReference.equals(e))return new l("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define(["require","exports","./TileAgent","./tileUtils"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){this._pool=b;this.waitingAgents=[];this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleFromTile=this.tilemapRequestAbort=this.tilemapRequestPromise=this.tilemap=this.data=null;this.pendingUpdates=
0;this.elevationBounds=void 0;this.init(a)}b.prototype.init=function(a){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.tilemapRequestAbort=this.tilemapRequestPromise=this.tilemap=null;this._unsetUpsampleInfo();this.requestAbort=this.requestPromise=this.loadingAgent=null;this.pendingUpdates=0;0===a&&(this.elevationBounds=null)};b.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};
b.prototype.abortRequest=function(){this.requestPromise&&(this.requestAbort.abort(),this.requestAbort=this.requestPromise=null)};b.prototype.abortTilemapRequest=function(){this.tilemapRequestPromise&&(this.tilemapRequestAbort.abort(),this.tilemapRequestAbort=this.tilemapRequestPromise=null)};b.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==l.TILE_AGENT_DONE&&this.loadingAgent.dispose();this.loadingAgent=null;this.abortRequest();this.abortTilemapRequest();this.tilemap=null;this._unsetUpsampleInfo();
this.pendingUpdates=0;this.disposeData()};b.prototype.disposeData=function(){!this.data||this.data instanceof HTMLImageElement||this.data instanceof HTMLCanvasElement||this.data.release();this.data=null};Object.defineProperty(b.prototype,"upsampleFromTile",{get:function(){return this._upsampleFromTile},enumerable:!0,configurable:!0});b.prototype._unsetUpsampleInfo=function(){this._upsampleFromTile&&(this._pool.release(this._upsampleFromTile),this._upsampleFromTile=null)};b.prototype.setUpsampleInfo=
function(a,b){if(a===b||null==b)this._unsetUpsampleInfo();else{if(null==this._upsampleFromTile)this._upsampleFromTile=this._pool.acquire();else if(this._upsampleFromTile.tile===b)return;k.computeUpsampleInfo(a,b,this._upsampleFromTile)}};b.makeEmptyLayerInfo=function(a,g,e){return e?(e.init(a),e):new b(a,g)};return b}();b.TilePerLayerInfo=n})},"esri/views/3d/terrain/SphericalPatch":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils ../support/geometryUtils ../support/projectionUtils ./PatchGeometryFactory ./Tile".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(d,e,f){var g=b.call(this,c.NumSubdivisionsAtLevel)||this;g.obb=Array(8);g.isWebMercator=!1;for(var h=0;8>h;h++)g.obb[h]=a.vec3f64.create();void 0!==d&&g.init(d,e,f);return g}l(c,b);c.prototype.init=function(c,e,f){b.prototype.init.call(this,c,e,f);this.isWebMercator=f.tilingScheme.spatialReference.isWebMercator;e=this.extentInRadians[0];f=this.extentInRadians[1];var l=this.extentInRadians[2],
p=this.extentInRadians[3];c=c[0];var q=k.lerp(f,p,.5),m=k.lerp(e,l,.5);this._edgeLen=(l-e)*Math.cos(0===c?0:Math.min(Math.abs(f),Math.abs(p)))*g.earthRadius;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=g.earthRadius-Math.sqrt(g.earthRadius*g.earthRadius-this._edgeLen2/4);d.wgs84ComparableLonLatToECEF(this.centerAtSeaLevel,m,q,0);e=a.vec3f64.fromArray(this.centerAtSeaLevel);h.vec3.normalize(e,e);this.up=e;this._updateOBB();this.updateRadiusAndCenter()};c.prototype.updateRadiusAndCenter=
function(){if(0===this.lij[0])h.vec3.set(this._center,0,0,0),this._radius=g.earthRadius+this.elevationBounds[1];else{this._updateCenter();var a=Math.max(h.vec3.squaredDistance(this._center,this.obb[0]),h.vec3.squaredDistance(this._center,this.obb[1]));this._radius=Math.sqrt(a)}};c.prototype._isVisible=function(){if(!this.intersectsClippingArea)return!1;var a=this.surface.frustum.planes;if(10>this.lij[0])return e.frustum.intersectsSphere(a,e.sphere.wrap(this._radius,this._center));for(var b=this.obb,
c=0;6>c;c++){for(var d=void 0,d=0;8>d&&!e.plane.isPointOutside(a[c],b[d]);d++);if(8===d)return!1}return!0};c.prototype.computeElevationBounds=function(){b.prototype.computeElevationBounds.call(this);this._updateOBB()};c.prototype.createGeometry=function(a,b){var c=this._isPole(this.lij[1],this.lij[0]);f.createSphericalGlobePatch(a,this.extent,b,this.renderData,this.extentInRadians,this.isWebMercator,c);this.setMemoryDirty()};c.prototype._updateOBB=function(){for(var a=this.extentInRadians,b=this.obb,
c=0;2>c;c++){var e=this.elevationBounds[c],f=4*c;d.wgs84ComparableLonLatToECEF(b[f++],a[0],a[1],e);d.wgs84ComparableLonLatToECEF(b[f++],a[0],a[3],e);d.wgs84ComparableLonLatToECEF(b[f++],a[2],a[3],e);d.wgs84ComparableLonLatToECEF(b[f++],a[2],a[1],e)}this.isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(h.vec3.set(b[1],0,0,g.earthRadius),h.vec3.set(b[2],0,0,g.earthRadius),h.vec3.set(b[5],0,0,g.earthRadius),h.vec3.set(b[6],0,0,g.earthRadius)):1===a&&(h.vec3.set(b[0],0,0,-g.earthRadius),
h.vec3.set(b[3],0,0,-g.earthRadius),h.vec3.set(b[4],0,0,-g.earthRadius),h.vec3.set(b[7],0,0,-g.earthRadius)))};c.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};c.NumSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];return c}(c.Tile);b.SphericalPatch=n})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ./TerrainConst ./terrainUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){function q(a,b){a&&!a.spatialReference.equals(b)&&(a=d.canProject(a.spatialReference,b)?d.project(a,b):null);return a}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(c){c=b.call(this,c)||this;c._changeListeners=new a;return c}l(c,b);c.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};c.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(c.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});c.prototype._computeStencilEnabledExtents=function(a,b){var c=[],d=0;for(a=a.items;d<a.length;d++){var f=a[d].layer;"IntegratedMeshLayer"===f.operationalLayerType&&null!=b&&(f=q(f.fullExtent,b),null!=f&&c.push(e.fromExtent(f)))}return c};
k([g.property({readOnly:!0})],c.prototype,"layerViewsExtent",null);k([g.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],c.prototype,"tiledLayersExtent",null);k([g.property({readOnly:!0,dependsOn:["spatialReference"]})],c.prototype,"stencilEnabledExtents",null);k([g.property()],c.prototype,"spatialReference",null);k([g.property()],c.prototype,"tilingScheme",null);k([g.property()],c.prototype,"defaultTiledLayersExtent",void 0);k([g.property({constructOnly:!0})],c.prototype,"layers",
void 0);k([g.property({constructOnly:!0})],c.prototype,"layerViews",void 0);return c=k([g.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],c)}(g.declared(h));h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};b.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};b.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?f.WEBMERCATOR_WORLD_EXTENT:
f.GEOGRAPHIC_WORLD_EXTENT};k([g.property({dependsOn:["spatialReference"]})],b.prototype,"layerViewsExtent",void 0);return b=k([g.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],b)}(g.declared(n));b.SurfaceExtentHelperGlobal=h;n=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};
b.prototype._computeLayerViewsExtent=function(){var a=e.empty(),b=this.spatialReference;this.layerViews.forEach(function(c){c.isResolved()&&(c=c.fullExtentInLocalViewSpatialReference||c.layer.fullExtent,(c=q(c,b))&&e.expand(a,c))});var c=e.allFinite(a)?a:null,d=this._get("layerViewsExtent");return e.equals(c,d)?d:c};b.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,d=e.empty();this.layers.forEach(function(f){if(f.loaded&&c.isTiledLayer(f)){var g=
c.getTiledLayerInfo(f,b,"local");f=g.tileInfo;g=g.fullExtent;f&&a.compatibleWith(f)&&g&&g.spatialReference.equals(b)&&e.expand(d,g)}});this.defaultTiledLayersExtent&&e.expand(d,this.defaultTiledLayersExtent);var f=e.allFinite(d)?d:null,g=this._get("tiledLayersExtent");return e.equals(f,g)?g:f};return b=k([g.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],b)}(g.declared(n));b.SurfaceExtentHelperLocal=n})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../support/projectionUtils ./terrainUtils ./TilingScheme".split(" "),
function(n,b,l,k,h,a,g,e,d,f){return function(b){function c(c){c=b.call(this,c)||this;c._changeHandles=new a;return c}l(c,b);c.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};c.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};c.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b;this.layers.some(function(c){return!d.isTiledLayer(c)||c.isRejected()?!1:!c.isFulfilled()||d.getTiledLayerInfo(c,a.viewSpatialReference,a.manifold).tileInfo?(b=c,"vector-tile"!==c.type):!1});if(b)if(b.isResolved()){var c=b,e=d.getTiledLayerInfo(c,this.viewSpatialReference,this.manifold).tileInfo,e=new f(e),c=d.getKnownTiledServiceLevelCap(c.url);Infinity>c&&e.capMaxLod(c);
this._set("tilingSchemeDone",!0);this._lockTilingScheme(e)}else this._updateWhen(b);else this._set("tilingSchemeDone",!0)}};c.prototype._updateWhen=function(a){var b=this,c=a.when().catch(function(a){return a}).then(function(){c===b._waitTask&&b._update()});this._waitTask=c};c.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var c=a.levels.length-1;a.spatialReference.isWebMercator?a=f.makeWebMercatorAuxiliarySphere(c):e.canProjectToWGS84ComparableLonLat(a.spatialReference)&&
(a=f.makeGCSWithTileSize(a.spatialReference,a.pixelSize,c))}this.tilingSchemeLocked=!0;this.tilingScheme=a;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};c.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};c.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold){var a=
this.extentHelper.spatialReference;a.isWebMercator?this.tilingScheme=f.WebMercatorAuxiliarySphere:e.canProjectToWGS84ComparableLonLat(a)&&(this.tilingScheme=f.makeGCSWithTileSize(a,256));this.extent=this.extentHelper.layerViewsExtent}else if(a=this.extentHelper.layerViewsExtent)this.tilingScheme=f.fromExtent(a,this.extentHelper.spatialReference),this.extent=a};k([g.property()],c.prototype,"tilingScheme",void 0);k([g.property()],c.prototype,"extent",void 0);k([g.property({value:!1})],c.prototype,"tilingSchemeLocked",
void 0);k([g.property({readOnly:!0,value:!1})],c.prototype,"tilingSchemeDone",void 0);k([g.property({constructOnly:!0})],c.prototype,"viewSpatialReference",void 0);k([g.property({constructOnly:!0})],c.prototype,"layers",void 0);k([g.property({constructOnly:!0})],c.prototype,"extentHelper",void 0);k([g.property({constructOnly:!0})],c.prototype,"manifold",void 0);return c=k([g.subclass("esri.views.3d.terrain.SurfaceTilingSchemeLogic")],c)}(g.declared(h))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/imageUtils ../support/buffer/BufferView ./PatchGeometryFactory ./PatchRenderData ./TileRenderer ./tileUtils ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/tracer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainRendererPrograms ../../webgl/renderState ../../webgl/Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S){var T=N.assert,U=p.mat4f64.create(),Y=r.vec2f64.create(),X=y.create(),P=u.vec4f64.create(),V=u.vec4f64.create(),Z=u.vec4f64.create(),ca=function(){return function(){this.extent=u.vec4f64.create();this.maxLevel=this.minLevel=0;this.callback=null}}();n=function(b){function g(a){a=b.call(this,a)||this;a.tileSize=256;a.rctx=null;a.renderDataPool=new d(B.PatchRenderData);a.patchGroups=new f({allocator:function(a){return a||{root:null,
origin:null,patches:new f}},deallocator:function(a){a.root=null;a.origin=null;a.patches.clear();return a}});a.patchGroupsDirty=!0;a.patchGroupsMap=new Map;a.tileIterator=new D.IteratorPreorder;a.highestVisibleLODTile=null;a.visible=!0;a.debugScreenSizePerspective=!1;a._opaque=!0;a._skirtScale=1;a._renderPatchBorders=!1;a._renderingDisabled=!1;a.backfaceCullingEnabled=!1;a._renderOrder=1;a._velvetOvergroundEnabled=!0;a.hasOverlays=!1;a._slicePlaneEnabled=!1;a._wireframeEnabled=!1;a.castShadows=!0;
a.receiveShadows=!1;a.emptyTex=null;a.tileRenderer=null;a.tileBackgroundInitialized=!1;a.stencilEnabledLayerExtents=[];a.numTrianglesRendered=0;a.numTilesRendered=0;a.numTilesCulled=0;a.numOriginsRendered=0;a.clippingExtent=null;a.needsHighlight=!1;a.visibleScaleRangeQueries=new f({initialSize:10});a.visibleScaleRangeQueriesInvPtr=0;a.visibleScaleRangeQueryQueue=new f({initialSize:30});a.visibleScaleRangeQueryPool=new d(ca,!1);return a}l(g,b);g.prototype.destroy=function(){z.clearCaches()};g.prototype.install=
function(a){a.addRenderPlugin([4,9],this);this.drapedRenderer=a.renderView.getDrapedRenderer()};g.prototype.uninstall=function(a){a.removeRenderPlugin(this)};Object.defineProperty(g.prototype,"updating",{get:function(){return!this.tileBackgroundInitialized},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"canRender",{get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this._renderingDisabled},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"renderingDisabled",{set:function(a){this._renderingDisabled=!!a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"opaque",{get:function(){return this._opaque&&!this._slicePlaneEnabled},set:function(a){this._opaque!==a&&(this._opaque=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"skirtScale",{set:function(a){this._skirtScale=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"renderPatchBorders",{set:function(a){this._renderPatchBorders!==a&&(this._renderPatchBorders=a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"cullBackFaces",{set:function(a){this.backfaceCullingEnabled=a;this._updatePrograms();this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderOrder",{get:function(){return this._renderOrder},set:function(a){this._renderOrder=a;this.setNeedsRender()},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"velvetOvergroundEnabled",{set:function(a){this._velvetOvergroundEnabled!==a&&(this._velvetOvergroundEnabled=a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"intersectionHandlerId",{get:function(){return I.TERRAIN_ID},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=
a,this._updatePrograms())},enumerable:!0,configurable:!0});g.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};g.prototype.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};g.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};g.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};g.prototype.loadCachedElevationData=function(a){T(null===
a.renderData);var b=D.tile2str(a);if(b=this.memCache.pop(b)){a.renderData=b.renderData;a.renderData.tile=a;a.renderData.localOrigin=this._getLocalOriginOfTile(a);for(var c=0;c<b.upsampleLIJs.length;c++){var d=D.findParentByLIJ(a,b.upsampleLIJs[c]);a.layerInfo[0][c].setUpsampleInfo(a,d)}}return null!=b};g.prototype.loadTile=function(a){a.renderData||(a.renderData=this.renderDataPool.acquire(),a.renderData.init(a),a.renderData.localOrigin=this._getLocalOriginOfTile(a),this.updateTileGeometry(a));this.updateTileTexture(a)};
g.prototype.queryVisibleLevelRange=function(a,b,c,d){var e=this.visibleScaleRangeQueryPool.acquire();w.vec4.copy(e.extent,a);e.minLevel=b?b:-Number.MAX_VALUE;e.maxLevel=null!=c?c:Number.MAX_VALUE;e.callback=d;this.visibleScaleRangeQueryQueue.push(e);this.setNeedsRender()};g.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(a),a.resetPendingUpdate(32))};g.prototype.updateTileGeometry=function(a){for(var b=0,c=a.layerInfo[0];b<
c.length;b++)c[b].pendingUpdates&=-17;a.renderData.updateGeometry(this.rctx,this._wireframeEnabled)&&this.setNeedsRender()};g.prototype.unloadTile=function(a,b){if(a.renderData){a.renderData.releaseTexture();if(b){b={renderData:a.renderData,upsampleLIJs:[]};for(var c=0,d=a.layerInfo[0];c<d.length;c++){var e=d[c].upsampleFromTile.tile.lij;b.upsampleLIJs.push([e[0],e[1],e[2]])}this.memCache.put(D.tile2str(a),b,a.renderData.estimatedGeometryMemoryUsage)}else this.releaseTileGeometry(a.renderData);a.renderData=
null;a.setMemoryDirty();this.setNeedsRender()}};g.prototype._getLocalOriginOfTile=function(a){var b=Math.max(0,7*Math.floor((a.lij[0]-3)/7));if("spherical"===this.manifold&&0===b)return x.vec3f64.ZEROS;for(;a.parent&&a.lij[0]>b;)a=a.parent;return a.centerAtSeaLevel};g.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};g.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,
numOriginsRendered:this.numOriginsRendered}};g.prototype.setDebugScreenSizePerspective=function(a){a!==this.debugScreenSizePerspective&&(this.debugScreenSizePerspective=a,this._updatePrograms())};g.prototype.setWireframe=function(a){var b=this;this._wireframeEnabled!==a&&(this._wireframeEnabled=a,this.rootTiles&&(D.traverseTilesPreorder(this.rootTiles,function(c){c.renderData&&c.renderData.updateGeometry(b.rctx,a)}),this.setNeedsRender()))};g.prototype.setNeedsRender=function(a){void 0===a&&(a=1);
this.patchGroupsDirty=!0;this._initContext.requestRender(a)};g.prototype.setTileBackground=function(a){this.tileBackground=a;this._updateTileBackground()};g.prototype.initializeRenderContext=function(a){var b=this;this._initContext=a;this.rctx=a.rctx;a=this.programRep=a.programRep;this._updatePrograms();this.tileRenderer=new C(this.rctx,this.tileSize,a,function(){return b.setNeedsRender()});this.tileBackground&&this._updateTileBackground();this.emptyTex=K.createEmptyTexture(this.rctx)};g.prototype.uninitializeRenderContext=
function(a){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};g.prototype.intersect=function(a,b,c,d,f){if(this.rootTiles&&(!a.enable.selectOpaqueTerrainOnly||!a.enable.selectionMode||this._opaque)){var g=la,h=ka;t.vec3.subtract(g,d,c);t.vec3.set(h,1/g[0],1/g[1],1/g[2]);var k=a.results.min,m=a.results.max,l=a.results.terrain,p=null,q=this.clippingExtent,n=this.tileIterator;n.reset(this.rootTiles);f=function(){var f=
n.next();if(null===f.renderData)return"continue";if(a.enable.invisibleTerrain){if(!f.visible&&q&&!f.intersectsExtent(q))return"continue"}else if(!f.visible)return"continue";var u=f.renderData.geometryInfo,x=-r._skirtScale*u.skirtLength;if(0!==x){var w=f.up;y.offset(u.boundingBox,x*w[0],x*w[1],x*w[2],X);y.expandWithBuffer(X,u.boundingBox,0,2)}var w=0===x?u.boundingBox:X,B=f.renderData.localOrigin;t.vec3.subtract(oa,c,B);if(!L.intersectAabbInvDir(w,oa,h,a.tolerance))return"continue";var C=function(a,
b,c,d){a.set(void 0,D.tile2str(b),c,d,U,void 0);a.intersector=fa;a.target=xa},w=function(h,q,n){0<=h&&(a.enable.backfacesTerrain||0>t.vec3.dot(q,g))&&(a.enable.invisibleTerrain||!a.enable.selectionMode||null==b||b(c,d,h))&&((null==l.dist||h<l.dist)&&C(l,f,h,q),a.enable.storeTerrainResults&&(a.enable.storeAll&&(e.isNone(p)?(p=new I.IntersectorResult(a.ray),C(p,f,h,q),a.results.all.push(p)):h<p.dist&&C(p,f,h,q)),(null==k.dist||h<k.dist)&&C(k,f,h,q),(null==m.dist||h>m.dist)&&C(m,f,h,q)))},N=va;t.vec3.subtract(N,
d,B);var B=u.indices,K=u.vertexAttributes,J={data:K.getField("position",v.BufferViewVec3f).typedBuffer,size:3,offsetIdx:0,strideIdx:K.stride/4},u=u.numWithoutSkirtIndices/3;L.intersectTriangles(oa,N,0,u,B,J,null,w);0!==x&&z.intersectSkirts(oa,N,u,B.length/3,B,K,"spherical"===r.manifold?function(a){return t.vec3.scale(a,a,x/t.vec3.length(a))}:function(a){return t.vec3.set(a,0,0,x)},w)};for(var r=this;!n.done;)f()}};g.prototype.render=function(a){if(a.slot!==(this.opaque?4:9))return!1;J.trace("# BEGIN RENDER TERRAIN");
var b=a.pass,c=1===a.scenelightingData.globalFactor,d=this._updatePatchGroups();da.overlayEnabled=!1;da.used=!0;switch(b){case 0:da.overlayEnabled=!0;da.used=!1;b=a.shadowMap&&a.shadowMap.enabled;this.receiveShadows!==b&&(this.receiveShadows=b,this._updatePrograms());b=!this.drapedRenderer.isEmpty();b!==this.hasOverlays&&(this.hasOverlays=b,this._updatePrograms());this._renderMaterialPass(a,this.programs.color,d,da);break;case 3:this.castShadows&&c&&this._renderAuxiliaryPass(a,this.programs.depthShadowMap,
d,da);break;case 1:this._renderAuxiliaryPass(a,this.programs.depth,d,da);break;case 2:this._renderAuxiliaryPass(a,this.programs.normal,d,da);break;case 4:this.needsHighlight&&(da.overlayEnabled=!0,this._renderAuxiliaryPass(a,this.programs.highlight,d,da),a.rctx.clearSafe(256))}J.trace("# END RENDER TERRAIN");0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender();return!0};g.prototype._renderMaterialPass=function(a,b,c,d){var e=this,f=a.camera;a.rctx.bindProgram(b);a.shadowMap&&a.shadowMap.bind(b);
a.ssaoHelper&&a.ssaoHelper.setUniforms(b);b.setUniform1i("tex",0);this._bindOverlayUniforms(b);b.setUniformMatrix4fv("viewNormal",f.viewInverseTransposeMatrix);b.setUniformMatrix4fv("proj",f.projectionMatrix);a.scenelightingData.setUniforms(b,!0);f=f.viewMatrix;t.vec3.set(ea,f[12],f[13],f[14]);t.vec3.normalize(ea,ea);b.setUniform3fv("viewDirection",ea);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();this.opaque?this._renderPatchGroups(a,
b,c,d):a.offscreenRenderingHelper.renderToTargets(function(){return e._renderPatchGroups(a,b,c,d)},a.offscreenRenderingHelper.tmpColor,a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries()};g.prototype._renderAuxiliaryPass=function(a,b,c,d){a.rctx.bindProgram(b);if(4===a.pass){var e=a.offscreenRenderingHelper;a.rctx.bindTexture(e.depthTexture,5);b.setUniform1i("depthTex",5);b.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height)}else if(b.setUniformMatrix4fv("viewNormal",
a.camera.viewInverseTransposeMatrix),1===a.pass||3===a.pass)Y[0]=a.camera.near,Y[1]=a.camera.far,b.setUniform2fv("nearFar",Y);this._renderPatchGroupsAuxiliary(a,b,c,d)};g.prototype._updateTileBackground=function(){var b=this;if(this.tileRenderer){var c=function(){b.tileBackgroundInitialized=!0;b.rootTiles&&D.traverseTilesPreorder(b.rootTiles,function(a){return b.tileRenderer.updateTileTexture(a)});b.setNeedsRender()};if("string"===typeof this.tileBackground){var d=this.tileBackground;m.requestImage(d).then(function(a){d===
b.tileBackground&&b.tileRenderer&&(b.tileRenderer.setBackground(a),c())})}else{var e=this.tileBackground?a.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(e);c()}}};g.prototype._updatePatchGroups=function(){var a=this,b=this.patchGroups;if(!this.patchGroupsDirty)return b;this.highestVisibleLODTile=null;this._renderCollectOrigins(b);if(0!==this.renderOrder){for(var c=0;c<b.length;c++)D.sortTiles(this.renderOrder,b.data[c].patches);b.sort(function(b,c){var d=a.renderOrder;
b=0===b.patches.length?-d:0===c.patches.length?d:D.compareTiles(b.patches.data[0],c.patches.data[0],d);return b})}this.patchGroupsDirty=!1;return b};g.prototype._renderCollectOrigins=function(a){var b=this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],f=a.pushNew();f.root=e;f.origin=c?x.vec3f64.ZEROS:e.centerAtSeaLevel;f.patches.clear();this._renderCollectOriginsForRoot(a,f)}};g.prototype._renderCollectOriginsForRoot=function(a,b){var c=this.tileIterator;
c.resetOne(b.root);var d=this.patchGroupsMap;d.clear();for(d.set(b.origin,b);!c.done;){b=c.next();var e=b.renderData;if(e&&!b.visible)this.numTilesCulled++,c.skipSubtree();else{if(0===b.lij[0]%7){var f=a.pushNew();f.root=b;f.origin=b.centerAtSeaLevel;d.set(b.centerAtSeaLevel,f);f.patches.clear()}if(!b.rendered)this.numTilesCulled++;else if(e){(f=d.get(e.localOrigin))&&f.patches.push(b);if(!this.highestVisibleLODTile||b.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=b;c.skipSubtree()}}}};
g.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};g.prototype._tileIntersectsStencilEnabledLayer=function(a){for(var b=this.stencilEnabledLayerExtents,c=0;c<b.length;c++)if(a.intersectsExtent(b[c]))return!0;
return!1};g.prototype._renderPatchGroupsAuxiliary=function(a,b,c,d){a.rctx.setPipelineState(this.defaultPipelineState);var e=0<this.stencilEnabledLayerExtents.length;b.setUniformMatrix4fv("proj",a.camera.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);d.overlayEnabled&&this._bindOverlayUniforms(b);for(var f=0;f<c.length;f++){var g=c.data[f];this._bindViewForPatchGroup(b,g,a.camera.eye,a.camera.viewMatrix);for(var h=0;h<g.patches.length;h++)this._renderPatch(a.rctx,b,g.patches.data[h],
4,e,d)}a.rctx.bindVAO(null)};g.prototype._renderPatchGroups=function(a,b,c,d){var e=a.rctx,f=a.camera,g=f.viewMatrix;e.setPipelineState(this.defaultPipelineState);if(this.debugScreenSizePerspective&&this.pointsOfInterest){var h=Q.getSettings("spherical"===this.manifold?"global":"local");h.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:f.fovY});L.bindScreenSizePerspective(h,b,"screenSizePerspective")}h=0<this.stencilEnabledLayerExtents.length;b.setUniform1f("skirtScale",
this._skirtScale);for(var k=this._wireframeEnabled?1:4,m=0;m<c.length;m++){var l=c.data[m],p=l.patches;if(0!==p.length){this._bindViewForPatchGroup(b,l,f.eye,g);var q=a.sliceHelper&&a.sliceHelper.plane;q&&L.bindSlicePlane(l.origin,q,b);a.shadowMap&&a.shadowMap.bindView(b,l.origin);this.numOriginsRendered++;for(l=0;l<p.length;l++){q=p.data[l];J.trace("# RENDER TILE "+D.tile2str(q)+", screenDepth:"+q.screenDepth);var n=q.renderData.geometryInfo.uvOffsetAndScale,r=q.renderData.texOffsetAndScale;w.vec4.set(Z,
n[0]*r[2]+r[0],n[1]*r[3]+r[1],n[2]*r[2],n[3]*r[3]);b.setUniform4fv("texOffsetAndScale",Z);e.bindTexture(q.renderData.textureReference,0);b.setUniform1f("opacity",q.renderData.opacity);n=this._renderPatch(e,b,q,k,h,d);q.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=n/3;this._scaleQueriesForTile(q)}}}e.bindVAO(null)};g.prototype._renderPatch=function(a,b,c,d,e,f){f.overlayEnabled&&(this._bindOverlayTextures(b,c.renderData.overlays,f.used),b.setUniform1f("overlayOpacity",
c.renderData.overlayOpacity));e&&a.setPipelineState(this._tileIntersectsStencilEnabledLayer(c)?this.stencilPipelineState:this.defaultPipelineState);e=0===this._skirtScale?c.renderData.geometryInfo.numWithoutSkirtIndices:c.renderData.vao.indexBuffer.size;a.bindVAO(c.renderData.vao);S.assertCompatibleVertexAttributeLocations(c.renderData.vao,b);a.drawElements(d,e,c.renderData.vao.indexBuffer.indexType,0);return e};g.prototype._bindViewForPatchGroup=function(a,b,c,d){a.setUniform3fv("origin",b.origin);
q.mat4.translate(F,d,b.origin);a.setUniformMatrix4fv("view",F);a.setUniform3f("camPos",c[0]-b.origin[0],c[1]-b.origin[1],c[2]-b.origin[2])};g.prototype._bindOverlayUniforms=function(a){a.setUniform1i("ovInnerColorTex",1);a.setUniform1i("ovOuterColorTex",2);a.setUniform1i("ovInnerWaterTex",3);a.setUniform1i("ovOuterWaterTex",4)};g.prototype._bindOverlayTextures=function(a,b,c){for(var d=0;2>d;d++){var e=2*d,f=b[d],g=c?f.highlightRenderTargetId:f.renderTargetId;g?(P[e]=f.texOffset[0],P[e+1]=f.texOffset[1],
V[e]=f.texScale[0],V[e+1]=f.texScale[1],e=this.drapedRenderer.getRenderTargetTexture(g),this.rctx.bindTexture(e,1+d),(f=f.waterMaskRenderTargetId)?(f=this.drapedRenderer.getRenderTargetTexture(f),this.rctx.bindTexture(f,3+d)):this.rctx.bindTexture(this.emptyTex,3+d)):(P[e]=0,P[e+1]=0,V[e]=0,V[e+1]=0,this.rctx.bindTexture(this.emptyTex,1+d),this.rctx.bindTexture(this.emptyTex,3+d))}a.setUniform4fv("overlayTexOffset",P);a.setUniform4fv("overlayTexScale",V)};g.prototype._updatePrograms=function(){var a=
this.programRep;this.programs={color:a.getProgram(M.colorPass,{overlay:this.hasOverlays,atmosphere:"spherical"===this.manifold&&this._velvetOvergroundEnabled,tileBorders:this._renderPatchBorders,receiveShadows:this.receiveShadows,screenSizePerspective:this.debugScreenSizePerspective,slice:this._slicePlaneEnabled}),normal:a.getProgram(M.normalPass,{alphaZero:!0}),depth:a.getProgram(M.depthPass,{shadowMap:!1}),depthShadowMap:a.getProgram(M.depthPass,{shadowMap:!0}),highlight:a.getProgram(M.highlightPass,
{})};this.defaultPipelineState=R.makePipelineState({culling:this.backfaceCullingEnabled&&R.backFaceCullingParams,depthTest:{func:513},depthWrite:R.defaultDepthWriteParams,colorWrite:R.defaultColorWriteParams});this.stencilPipelineState=R.makePipelineState(k({},this.defaultPipelineState,{stencilTest:{function:{func:517,ref:1,mask:255},operation:{fail:7680,zFail:7680,zPass:7680}}}));this.setNeedsRender()};g.prototype.releaseTileGeometry=function(a){a.releaseGeometry()&&this.setNeedsRender();this.renderDataPool.release(a)};
g.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&0<b.length;){var c=b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};g.prototype._processScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};Object.defineProperty(g.prototype,
"test",{get:function(){return{tileRenderer:this.tileRenderer}},enumerable:!0,configurable:!0});h([c.property()],g.prototype,"tileBackgroundInitialized",void 0);h([c.property({constructOnly:!0})],g.prototype,"manifold",void 0);h([c.property({constructOnly:!0})],g.prototype,"memCache",void 0);h([c.property({readOnly:!0,dependsOn:["tileBackgroundInitialized"]})],g.prototype,"updating",null);return g=h([c.subclass("esri.views.3d.terrain.TerrainRenderer")],g)}(c.declared(g));var da={overlayEnabled:!1,
used:!0},F=p.mat4f64.create(),ea=x.vec3f64.create(),la=x.vec3f64.create(),ka=x.vec3f64.create(),oa=x.vec3f64.create(),va=x.vec3f64.create(),fa="TerrainRenderer",xa={type:"external"};return n})},"esri/views/3d/terrain/PatchRenderData":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./PatchGeometryFactory ./TerrainConst ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.overlayTexOffset=a.vec2f64.create();this.texOffsetAndScale=e.vec4f64.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:d.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:e.vec4f64.create()}}b.prototype.init=function(a){this.tile=a;a=this.geometryInfo;a.indices=null;a.vertexAttributes=
null;d.empty(a.boundingBox);a.numSurfaceIndices=0;a.numSkirtIndices=0;a.numWithoutSkirtIndices=0;a.numVertsPerRow=0;this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1};this.textureReference=this._texture=this._vao=null;g.vec4.set(this.texOffsetAndScale,0,0,1,1);this.opacity=1;if(this.overlays){a=0;for(var b=this.overlays;a<b.length;a++){var c=b[a];c.renderTargetId=null;c.highlightRenderTargetId=null;c.waterMaskRenderTargetId=null;h.vec2.set(c.texScale,1,1);h.vec2.set(c.texOffset,
0,0)}}else for(this.overlays=[null,null],a=0;2>a;a++)this.overlays[a]={renderTargetId:null,highlightRenderTargetId:null,waterMaskRenderTargetId:null,texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};b.prototype.updateGeometry=function(a,b){if(!this._updateGeometryState(b))return!1;this._releaseGeometry();this._createGeometry(a);return!0};b.prototype.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,
wireframe:!1},!0):!1};b.prototype.ensureTexture=function(a,b){this._texture&&this._texture.descriptor.width!==a&&this.releaseTexture();this._texture||(this._texture=b(),this.tile.setMemoryDirty());return this._texture};b.prototype.releaseTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null);this.textureReference=null};b.prototype._updateGeometryState=function(a){var b=this._getElevationInfo(),c=this.tile.lij[0],d=8>c?this.tile.numSubdivisionsAtLevel[c]+1:2;b.samplerData&&
(d=this.tile.maxTesselation,d=k.clamp((d>>Math.max(c-b.maxTileLevel,q.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-c)))+1,2,d+1));c=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)c=null;var e=this.geometryState,f=!1;e.numVertsPerRow!==d&&(e.numVertsPerRow=d,f=!0);b.changed&&(e.samplerData=b.samplerData,f=!0);l.equals(e.clippingArea,c)||(e.clippingArea=c,f=!0);e.wireframe!==a&&(e.wireframe=a,f=!0);return f};b.prototype._createGeometry=function(a){this.tile.createGeometry(this.geometryState,
this.localOrigin);var b=this.geometryInfo.vertexAttributes,c=this.geometryInfo.indices,d=a.gl;this._vao=new x(a,r.Default3D,{geometry:f.glLayout(b.layout)},{geometry:t.createVertex(a,d.STATIC_DRAW,b.buffer)},t.createIndex(a,d.STATIC_DRAW,c))};b.prototype._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;c.releaseGeometry(this.geometryInfo);return!0};Object.defineProperty(b.prototype,"vao",{get:function(){return this._vao},enumerable:!0,configurable:!0});b.prototype._getElevationInfo=
function(){for(var a=this.geometryState.samplerData,b=this.tile.layerInfo[0],c=b.length,d=Array(c),e=0,f=0,g=!1,h=0;h<c;h++){var k=b[h];if(k.upsampleFromTile){var k=k.upsampleFromTile.tile,l=k.layerInfo[0][h].data,l=l&&l.samplerData;a&&a[e]===l||(g=!0);d[e++]=l;f=Math.max(f,k.lij[0])}else k.data&&(l=this.tile.surface.layerViewByIndex(h,0),p.fallsWithinLayer(this.tile,l.layer,!1)&&(l=k.data,a&&a[e]===l.samplerData||(g=!0),d[e++]=l.samplerData,f=this.tile.lij[0]))}a&&a.length!==e&&(g=!0);0<e?d.length=
e:d=null;return{changed:g,samplerData:d,maxTileLevel:f}};Object.defineProperty(b.prototype,"estimatedGeometryMemoryUsage",{get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureDescriptor",{get:function(){return this._texture?this._texture.descriptor:null},enumerable:!0,configurable:!0});return b}();b.PatchRenderData=n})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec4 ../../2d/engine/vectorTiles/tileRendererHelper3D ../../2d/engine/vectorTiles/VectorTileDisplayObject ./terrainUtils ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/shaders/MiscPrograms ../../webgl/FramebufferObject ../../webgl/renderState ../../webgl/Texture ../../webgl/Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){function w(a,b,c){var d=a.layerInfo[1][b];c.layerIndex=b;if(d.data)return k.vec2.set(c.offset,0,0),c.tile=a,c.scale=1,c.sourceLod=a.lij,c.sourceLayerInfo=d,c;if(!d.upsampleFromTile)return null;a=d.upsampleFromTile;b=a.tile.layerInfo[1][b];c.tile=a.tile;k.vec2.copy(c.offset,a.offset);c.scale=a.scale;c.sourceLod=a.tile.lij;c.sourceLayerInfo=b;return c}var u=[],y={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0};return function(){function b(a,
b,d,e){this._context=a;this.tileSize=b;this._setNeedsRender=e;this._blackTex=this._backgroundTexture=null;this._context.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,this._context.parameters.maxMaxAnisotropy));this._vaoQuad=c.createQuadVAO(this._context,f.Pos3Tex);this._blendLayersProgram=d.getProgram(q.blendLayers);this._blendLayersPipelineState=r.makePipelineState({blending:r.simpleBlendingParams(1,771),colorWrite:r.defaultColorWriteParams});this._applyOpacityPipelineState=
r.makePipelineState({blending:r.simpleBlendingParams(0,770),colorWrite:r.defaultColorWriteParams});this._blackTex=c.createColorTexture(this._context,[0,0,0,1])}b.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);this._backgroundTexture&&(this._backgroundTexture.dispose(),this._backgroundTexture=null);this._blackTex&&(this._blackTex.dispose(),this._blackTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),
this._blendLayersProgram=null)};b.prototype.updateTileTexture=function(a){for(var b=a.layerInfo[1],c=0;c<b.length;c++)b[c].pendingUpdates&=-33;if(a.renderData){var e=a.surface,f=e.baseOpacity,c=0,g=this.tileSize,h=!1,k,m=b.length;for(k=0;k<b.length&&!h;k++){var p=e.layerViewByIndex(k,1),q=p.fullOpacity;u[k]=q;this._isBaseLayer(p.layer)&&m>=b.length&&(m=k);0!==q&&w(a,k,y)&&(d.isVectorTileLayerView(p)?g=Math.max(g,this.tileSize*p.view.pixelRatio):p.isOpaque&&1===f&&1===q&&(h=!0),c++)}f=g;g=l.nextHighestPowerOfTwo(f);
b=g*g;e=f*f;b===e?g=f:(f=g/2,g=b-e<e-f*f?g:f);b=g/this.tileSize;--k;0===c&&this._backgroundTexture?this._useBackgroundTexture(a):1===c&&h?this._useLayerTexture(a,k):this._composeMapLayers(a,k,m,h,u,g,b);this._setNeedsRender()}};b.prototype.setBackground=function(a){this._backgroundTexture=a instanceof HTMLImageElement?this._buildTexture(a):c.createColorTexture(this._context,a)};b.prototype._buildTexture=function(a){var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,
maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},d=this._context,e;if("number"===typeof a)b.width=b.height=a,e=new t(d,b);else try{e=new t(d,b,a)}catch(D){e=c.createEmptyTexture(d),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}d.bindTexture(e);e.generateMipmap();return e};b.prototype._bindFBO=function(a,b,c,d){a&&a.width===b&&a.height===c||(a&&a.dispose(),a=p.create(this._context,{colorTarget:0,depthStencilTarget:d?1:0,width:b,height:c}));
this._context.bindFramebuffer(a);return a};b.prototype._drawRasterData=function(a,b,c,d){void 0===d&&(d=1);var e=this._context,f=this._blendLayersProgram,g=this._vaoQuad;e.bindProgram(f);e.bindVAO(g);x.assertCompatibleVertexAttributeLocations(g,f);e.bindTexture(a,0);f.setUniform1i("tex",0);f.setUniform1f("scale",b);f.setUniform2f("offset",c[0],c[1]);f.setUniform1f("opacity",d);e.drawArrays(5,0,x.vertexCount(g,"geometry"))};b.prototype._drawVectorData=function(a,b,c){var d=this._context,e=a.tile.surface.layerViewByIndex(a.layerIndex,
1);g.renderVectorTile(d,a.sourceLod,a.sourceLayerInfo.data,e.renderer,e.layer.styleRepository,e.schemaHelper,Math.round(1/a.scale),a.offset,this.tileSize,b,c)};b.prototype._useBackgroundTexture=function(b){b.renderData.opacity=b.surface.baseOpacity;b.renderData.textureReference=this._backgroundTexture;a.vec4.set(b.renderData.texOffsetAndScale,0,0,1,1)};b.prototype._useLayerTexture=function(b,c){c=w(b,c,y);if(this._dataToTexture(c)){b.renderData.textureReference=c.sourceLayerInfo.data;var d=c.offset;
a.vec4.set(b.renderData.texOffsetAndScale,d[0],d[1],c.scale,c.scale)}b.renderData.opacity=b.surface.baseOpacity};b.prototype._composeMapLayers=function(b,c,d,f,g,k,m){var l=this,p=b.renderData.ensureTexture(k,function(){return l._buildTexture(k)}),q=this._context;this._fbo=this._bindFBO(this._fbo,p.descriptor.width,p.descriptor.height,!0);q.setViewport(0,0,k,k);q.setClearColor(0,0,0,0);q.setClearDepth(1);q.clearSafe(16640);var n=!1;!f&&this._backgroundTexture&&(q.setPipelineState(this._blendLayersPipelineState),
this._drawRasterData(this._backgroundTexture,1,h.vec2f64.ZEROS));f=b.surface.baseOpacity;for(var r=!1;0<=c;c--){var v=w(b,c,y);v&&(c<d&&1>f&&!r&&(q.setPipelineState(this._applyOpacityPipelineState),this._drawRasterData(this._blackTex,1,h.vec2f64.ZEROS,f),r=!0),0!==g[c]&&(v&&v.sourceLayerInfo&&v.sourceLayerInfo.data instanceof e?(n&&q.clearSafe(256),q.setPipelineState(this._blendLayersPipelineState),this._drawVectorData(v,m,g[c]),n=!0):this._dataToTexture(v)&&(q.setPipelineState(this._blendLayersPipelineState),
this._drawRasterData(v.sourceLayerInfo.data,v.scale,v.offset,g[c]))))}q.bindTexture(p);d=p.descriptor;q.gl.copyTexImage2D(q.gl.TEXTURE_2D,0,d.pixelFormat,0,0,d.width,d.height,0);p.generateMipmap();q.bindFramebuffer(null);b.renderData.opacity=r?1:f;b.renderData.textureReference=p;a.vec4.set(b.renderData.texOffsetAndScale,0,0,1,1)};b.prototype._dataToTexture=function(a){if(a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof e)return!1;var b=a&&a.sourceLayerInfo&&a.sourceLayerInfo.data;if(b instanceof
HTMLImageElement||b instanceof HTMLCanvasElement)this._rasterDataToTexture(a),a.tile.setMemoryDirty();return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof t};b.prototype._rasterDataToTexture=function(a){a=a.sourceLayerInfo;a.data=this._buildTexture(a.data)};b.prototype._isBaseLayer=function(a){return a.parent&&"esri.Basemap"===a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};Object.defineProperty(b.prototype,"test",{get:function(){return{fbo:this._fbo}},enumerable:!0,configurable:!0});
return b}()})},"esri/views/2d/engine/vectorTiles/tileRendererHelper3D":function(){define("require exports ../../../../geometry ../../../../Viewpoint ../../../../core/has ../../../../core/libs/gl-matrix-2/mat4 ../../ViewState ../../../webgl/renderState".split(" "),function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.renderVectorTile=function(b,e,g,k,l,n,y,m,v,z,B){var p=n.adjustLevel(e[0]);z={context:b,drawPhase:0,state:d,stationary:!0,pixelRatio:z,displayLevel:p,requiredLevel:p,
drawphase:1,renderer:k,layerOpacity:B,globalOpacity:1};k.initializeProgramCache(b);var r=n.getScale(e[0]);n=n.getShift(e,y*r);var t=n[1];g.tileTransform.displayCoord[0]=-1-n[0]-m[0]*y*2;g.tileTransform.displayCoord[1]=1+t+(1-m[1])*y*2-2;m=g.tileTransform.transform;a.mat4.identity(m);y=.125*y*r/v;m[0]=y;m[5]=-y;z.state.size[0]=v;z.state.size[1]=v;k.setStateParams(z.state,z.pixelRatio,e[0]);g.attached||g.attachWithContext(b);g.triangleCount=0;if((e=l.backgroundBucketIds)&&0<e.length)for(b.setPipelineState(f),
v=0;v<e.length;v++)y=e[v],k.renderBackGroundLayer(b,l.layers[y],y,g,p,0,B);b.setPipelineState(c);z.drawphase=1;g.processRender(z);b.setPipelineState(q);z.drawphase=2;g.processRender(z);z.drawphase=3;g.processRender(z);h("esri-vector-tiles-debug")&&k.renderTileInfo(b,g)};var d=new g({viewpoint:new k({targetGeometry:new l.Point(0,0),scale:1,rotation:0}),size:[256,256]}),f=e.makePipelineState({blending:e.simpleBlendingParams(1,771),depthTest:{func:515},colorWrite:e.defaultColorWriteParams}),c=e.makePipelineState({depthTest:{func:515},
depthWrite:e.defaultDepthWriteParams,colorWrite:e.defaultColorWriteParams}),q=e.makePipelineState({blending:e.simpleBlendingParams(1,771),depthTest:{func:515},colorWrite:e.defaultColorWriteParams})})},"esri/views/2d/ViewState":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df32 ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f32 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y){var m=[0,0];return function(b){function g(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];a=b.apply(this,a)||this;a._viewpoint2D={center:w.vec2f64.create(),rotation:0,scale:0,spatialReference:null};a.center=[0,0];a.extent=new h.Extent;a.id=0;a.inverseTransform=q.mat2df64.create();a.resolution=0;a.rotation=0;a.scale=0;a.transform=q.mat2df64.create();a.transformNoRotation=q.mat2df64.create();a.displayMat3=r.mat3f32.create();a.displayViewMat3=
r.mat3f32.create();a.viewMat3=r.mat3f32.create();a.viewMat2d=c.mat2df32.create();a.worldScreenWidth=0;a.size=[0,0];return a}l(g,b);n=g;Object.defineProperty(g.prototype,"pixelRatio",{set:function(a){this._set("pixelRatio",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"size",{set:function(a){this._set("size",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"viewpoint",{set:function(a){if(a){var b=this._viewpoint2D,c=a.targetGeometry;
b.center[0]=c.x;b.center[1]=c.y;b.rotation=a.rotation;b.scale=a.scale;b.spatialReference=c.spatialReference}this._update()},enumerable:!0,configurable:!0});g.prototype.copy=function(a){var b=this.size,c=this.viewpoint;c&&b?(this.viewpoint=y.copy(c,a.viewpoint),this._set("size",t.vec2.copy(b,a.size))):(this.viewpoint=a.viewpoint.clone(),this._set("size",[a.size[0],a.size[1]]));this._set("pixelRatio",a.pixelRatio);return this};g.prototype.clone=function(){return new n({size:this.size,viewpoint:this.viewpoint.clone(),
pixelRatio:this.pixelRatio})};g.prototype.toMap=function(a,b,c){if(u.isVec2(b))return t.vec2.transformMat2d(a,b,this.inverseTransform);m[0]=b;m[1]=c;return t.vec2.transformMat2d(a,m,this.inverseTransform)};g.prototype.toScreen=function(a,b,c){if(u.isVec2(b))return t.vec2.transformMat2d(a,b,this.transform);m[0]=b;m[1]=c;return t.vec2.transformMat2d(a,m,this.transform)};g.prototype.toScreenNoRotation=function(a,b,c){if(u.isVec2(b))return t.vec2.transformMat2d(a,b,this.transformNoRotation);m[0]=b;m[1]=
c;return t.vec2.transformMat2d(a,m,this.transformNoRotation)};g.prototype.pixelSizeAt=function(a){return y.pixelSizeAt(a,this.viewpoint,this.size)};g.prototype.getScreenTransform=function(a,b){var c=this._viewpoint2D.center,d=this._get("pixelRatio")||1,e=this._get("size");y.getMatrix(a,c,e,b,0,d);return a};g.prototype._update=function(){var b=this._viewpoint2D,c=b.center,e=b.spatialReference,g=b.scale,k=b.rotation,b=this._get("pixelRatio")||1,m=this._get("size");this._set("id",this.id+1);var l=new a({targetGeometry:new h.Point(c[0],
c[1],e),scale:g,rotation:k});this._set("viewpoint",l);if(m&&e&&g)return this.resolution=y.getResolution(l),this.rotation=k,this.scale=g,this.spatialReference=e,t.vec2.copy(this.center,c),p.mat3.set(this.displayMat3,0!==m[0]?2/m[0]:0,0,0,0,0!==m[1]?-2/m[1]:0,0,-1,1,1),g=p.mat3.identity(this.viewMat3),c=x.vec2f32.fromValues(m[0]/2,m[1]/2),e=x.vec2f32.fromValues(-m[0]/2,-m[1]/2),k=d.common.toRadian(k),p.mat3.translate(g,g,c),p.mat3.rotate(g,g,k),p.mat3.translate(g,g,e),p.mat3.multiply(this.displayViewMat3,
this.displayMat3,g),g=f.mat2d.identity(this.viewMat2d),f.mat2d.translate(g,g,c),f.mat2d.rotate(g,g,k),f.mat2d.translate(g,g,e),y.getExtent(this.extent,l,m),y.getTransform(this.transform,l,m,b),f.mat2d.invert(this.inverseTransform,this.transform),y.getTransformNoRotation(this.transformNoRotation,l,m,b),this.worldScreenWidth=y.getWorldScreenWidth(this.spatialReference,this.resolution),this};var n;k([e.property({readOnly:!0})],g.prototype,"id",void 0);k([e.property({value:1,json:{write:!0}})],g.prototype,
"pixelRatio",null);k([e.property({json:{write:!0}})],g.prototype,"size",null);k([e.property({type:a,json:{write:!0}})],g.prototype,"viewpoint",null);return g=n=k([e.subclass("esri.views.2d.ViewState")],g)}(e.declared(g.JSONSupport))})},"esri/core/libs/gl-matrix-2/common":function(){define(["require","exports","./math/common"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.common=l})},"esri/core/libs/gl-matrix-2/mat2d":function(){define(["require","exports","./math/mat2d"],function(n,
b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat2d=l})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["require","exports","./common"],function(n,b,l){function k(a,b,e){var d=b[0],f=b[1],c=b[2],g=b[3],h=b[4];b=b[5];var k=e[0],l=e[1],n=e[2],w=e[3],u=e[4];e=e[5];a[0]=d*k+c*l;a[1]=f*k+g*l;a[2]=d*n+c*w;a[3]=f*n+g*w;a[4]=d*u+c*e+h;a[5]=f*u+g*e+b;return a}function h(a,b,e){a[0]=b[0]-e[0];a[1]=b[1]-e[1];a[2]=b[2]-e[2];a[3]=b[3]-e[3];a[4]=b[4]-e[4];a[5]=b[5]-e[5];return a}Object.defineProperty(b,
"__esModule",{value:!0});b.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a};b.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};b.set=function(a,b,e,d,f,c,h){a[0]=b;a[1]=e;a[2]=d;a[3]=f;a[4]=c;a[5]=h;return a};b.invert=function(a,b){var e=b[0],d=b[1],f=b[2],c=b[3],g=b[4];b=b[5];var h=e*c-d*f;if(!h)return null;h=1/h;a[0]=c*h;a[1]=-d*h;a[2]=-f*h;a[3]=e*h;a[4]=(f*b-c*g)*h;a[5]=(d*g-e*b)*h;return a};b.determinant=function(a){return a[0]*a[3]-
a[1]*a[2]};b.multiply=k;b.rotate=function(a,b,e){var d=b[0],f=b[1],c=b[2],g=b[3],h=b[4];b=b[5];var k=Math.sin(e);e=Math.cos(e);a[0]=d*e+c*k;a[1]=f*e+g*k;a[2]=d*-k+c*e;a[3]=f*-k+g*e;a[4]=h;a[5]=b;return a};b.scale=function(a,b,e){var d=b[1],f=b[2],c=b[3],g=b[4],h=b[5],k=e[0];e=e[1];a[0]=b[0]*k;a[1]=d*k;a[2]=f*e;a[3]=c*e;a[4]=g;a[5]=h;return a};b.translate=function(a,b,e){var d=b[0],f=b[1],c=b[2],g=b[3],h=b[4];b=b[5];var k=e[0];e=e[1];a[0]=d;a[1]=f;a[2]=c;a[3]=g;a[4]=d*k+c*e+h;a[5]=f*k+g*e+b;return a};
b.fromRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=-e;a[3]=b;a[4]=0;a[5]=0;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];a[4]=0;a[5]=0;return a};b.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=b[0];a[5]=b[1];return a};b.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],
2)+Math.pow(a[5],2)+1)};b.add=function(a,b,e){a[0]=b[0]+e[0];a[1]=b[1]+e[1];a[2]=b[2]+e[2];a[3]=b[3]+e[3];a[4]=b[4]+e[4];a[5]=b[5]+e[5];return a};b.subtract=h;b.multiplyScalar=function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*e;a[5]=b[5]*e;return a};b.multiplyScalarAndAdd=function(a,b,e,d){a[0]=b[0]+e[0]*d;a[1]=b[1]+e[1]*d;a[2]=b[2]+e[2]*d;a[3]=b[3]+e[3]*d;a[4]=b[4]+e[4]*d;a[5]=b[5]+e[5]*d;return a};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&
a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]};b.equals=function(a,b){var e=a[0],d=a[1],f=a[2],c=a[3],g=a[4];a=a[5];var h=b[0],k=b[1],n=b[2],x=b[3],w=b[4];b=b[5];return Math.abs(e-h)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(d-k)<=l.EPSILON*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(f-n)<=l.EPSILON*Math.max(1,Math.abs(f),Math.abs(n))&&Math.abs(c-x)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(g-w)<=l.EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(a-b)<=l.EPSILON*Math.max(1,
Math.abs(a),Math.abs(b))};b.mul=k;b.sub=h})},"esri/core/libs/gl-matrix-2/mat2df32":function(){define(["require","exports","./factories/mat2df32"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat2df32=l})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(6);b[0]=1;b[3]=1;return b};b.clone=function(b){var k=new Float32Array(6);k[0]=b[0];
k[1]=b[1];k[2]=b[2];k[3]=b[3];k[4]=b[4];k[5]=b[5];return k};b.fromValues=function(b,k,h,a,g,e){var d=new Float32Array(6);d[0]=b;d[1]=k;d[2]=h;d[3]=a;d[4]=g;d[5]=e;return d};b.createView=function(b,k){return new Float32Array(b,k,6)}})},"esri/core/libs/gl-matrix-2/mat2df64":function(){define(["require","exports","./factories/mat2df64"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat2df64=l})},"esri/core/libs/gl-matrix-2/factories/mat2df64":function(){define(["require","exports"],
function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,1,0,0]};b.clone=function(b){return[b[0],b[1],b[2],b[3],b[4],b[5]]};b.fromValues=function(b,k,h,a,g,e){return[b,k,h,a,g,e]};b.createView=function(b,k){return new Float64Array(b,k,6)}})},"esri/core/libs/gl-matrix-2/mat3f32":function(){define(["require","exports","./factories/mat3f32"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat3f32=l})},"esri/core/libs/gl-matrix-2/factories/mat3f32":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(9);b[0]=1;b[4]=1;b[8]=1;return b};b.clone=function(b){var k=new Float32Array(9);k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=b[3];k[4]=b[4];k[5]=b[5];k[6]=b[6];k[7]=b[7];k[8]=b[8];return k};b.fromValues=function(b,k,h,a,g,e,d,f,c){var l=new Float32Array(9);l[0]=b;l[1]=k;l[2]=h;l[3]=a;l[4]=g;l[5]=e;l[6]=d;l[7]=f;l[8]=c;return l};b.createView=function(b,k){return new Float32Array(b,k,9)}})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["require",
"exports"],function(n,b){function l(b){return b instanceof Float32Array&&2<=b.length}function k(b){return Array.isArray(b)&&2<=b.length}Object.defineProperty(b,"__esModule",{value:!0});b.isVec2f32=l;b.isVec2f64=k;b.isVec2=function(b){return l(b)||k(b)}})},"esri/views/2d/viewpointUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Viewpoint ../../core/asyncUtils ../../core/Collection ../../core/maybe ../../core/promiseUtils ../../core/unitUtils ../../core/wgs84Constants ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/webMercatorUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B){function C(a,b,c,d){return d&&c&&!d.equals(c)&&z.canProject(d,c)&&d.isWebMercator?(d.isWebMercator?(c=b[1],89.99999<c?c=89.99999:-89.99999>c&&(c=-89.99999),c=Math.sin(q.common.toRadian(c)),a=t.vec2.set(a,q.common.toRadian(b[0])*P,.5*P*Math.log((1+c)/(1-c)))):(c=q.common.toDegree(b[0]/P),a=t.vec2.set(a,c-360*Math.floor((c+180)/360),q.common.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*b[1]/P))))),a):t.vec2.copy(a,b)}function D(a){return a.wkid?
a:a.spatialReference||m.WGS84}function K(a,b){return b.type?t.vec2.set(a,b.x,b.y):t.vec2.copy(a,b)}function I(a,b){return Math.max(a.width/b[0],a.height/b[1])*Y(a.spatialReference)}function Q(a,b,c,f){return k(this,void 0,void 0,function(){var h,k,m,p,q,n,r,v,t,x,B,C,N,D,L,I,H,J,K,R,F,S,M,T,A,P,Z,V;return l(this,function(l){switch(l.label){case 0:if(!a||Array.isArray(a)&&!a.length)return[2,null];g.isCollection(a)&&(a=a.toArray());if(!Array.isArray(a)||!a.length||"object"!==typeof a[0])return[3,7];
k=a.every(function(a){return"attributes"in a});m=a.some(function(a){return!a.geometry});p=a;if(!(k&&m&&b&&b.allLayerViews))return[3,2];q=new Map;n=0;for(r=a;n<r.length;n++)v=r[n],t=v.layer,x=q.get(t)||[],B=v.attributes[t.objectIdField],null!=B&&x.push(B),q.set(t,x);C=[];q.forEach(function(a,c){var d=b.allLayerViews.find(function(a){return a.layer.id===c.id});if("queryFeatures"in d){var e=c.createQuery();e.objectIds=a;e.returnGeometry=!0;C.push(d.queryFeatures(e))}});return[4,d.all(C)];case 1:N=l.sent();
D=[];L=0;for(I=N;L<I.length;L++)if((H=I[L])&&H.features&&H.features.length)for(J=0,K=H.features;J<K.length;J++)v=K[J],e.isSome(v.geometry)&&D.push(v.geometry);p=D;l.label=2;case 2:R=0,F=p,l.label=3;case 3:if(!(R<F.length))return[3,6];S=F[R];return[4,Q(S,b,c,f)];case 4:f=l.sent(),l.label=5;case 5:return R++,[3,3];case 6:return[2,f];case 7:if(!Array.isArray(a)||2!==a.length||"number"!==typeof a[0]||"number"!==typeof a[1])return[3,8];h=new y(a);return[3,12];case 8:if(!(a instanceof u))return[3,9];h=
a;return[3,12];case 9:if(!("geometry"in a))return[3,12];if(!a.geometry)return[3,10];h=a.geometry;return[3,12];case 10:if(!a.layer)return[3,12];M=a.layer;T=b.allLayerViews.find(function(a){return a.layer.id===M.id});if(!("queryFeatures"in T))return[3,12];A=M.createQuery();A.objectIds=[a.attributes[M.objectIdField]];A.returnGeometry=!0;return[4,T.queryFeatures(A)];case 11:P=l.sent(),h=e.get(P,"features",0,"geometry"),l.label=12;case 12:if(e.isNone(h))return[2,null];Z="point"===h.type?new w({xmin:h.x,
ymin:h.y,xmax:h.x,ymax:h.y,spatialReference:h.spatialReference}):h.extent;if(!Z)return[2,null];V=z.canProject(Z,c);if(!Z.spatialReference.equals(c)&&V)Z=z.project(Z,c);else if(!V)return[2,null];f=f?f.union(Z):Z.clone();return[2,f]}})})}function J(a){if(a&&(!Array.isArray(a)||"number"!==typeof a[0])&&("object"===typeof a||Array.isArray(a)&&"object"===typeof a[0])){if("layer"in a&&a.layer&&a.layer.minScale&&a.layer.maxScale){var b=a.layer;return{min:b.minScale,max:b.maxScale}}if(Array.isArray(a)&&a.length&&
a.every(function(a){return"layer"in a})){for(var c=0,d=0,e=0;e<a.length;e++)(b=a[e].layer)&&b.minScale&&b.maxScale&&(c=b.minScale<c?b.minScale:c,d=b.maxScale>d?b.maxScale:d);return c&&d?{min:c,max:d}:null}}}function N(a,b){return k(this,void 0,void 0,function(){var c,d,e,f,g,k,m,p,q,n,r,v,t,u,N,L;return l(this,function(l){switch(l.label){case 0:if(!a||!b)return[2,new h({targetGeometry:new y,scale:0,rotation:0})];c=b.spatialReference;d=b.size;e=b.viewpoint;f=b.constraints;g=null;"esri.Viewpoint"===
a.declaredClass?g=a:a.viewpoint?g=a.viewpoint:a.target&&"esri.Viewpoint"===a.target.declaredClass&&(g=a.target);k=null;if(!g||!g.targetGeometry)return[3,1];k=g.targetGeometry;return[3,10];case 1:if(!(a instanceof w))return[3,2];k=a;return[3,10];case 2:return a||a&&(a.hasOwnProperty("center")||a.hasOwnProperty("extent")||a.hasOwnProperty("target"))?[4,Q(a.center,b,c)]:[3,10];case 3:return(q=l.sent())?[3,5]:[4,Q(a.extent,b,c)];case 4:q=l.sent(),l.label=5;case 5:return(p=q)?[3,7]:[4,Q(a.target,b,c)];
case 6:p=l.sent(),l.label=7;case 7:return(m=p)?[3,9]:[4,Q(a,b,c)];case 8:m=l.sent(),l.label=9;case 9:k=m,l.label=10;case 10:!k&&e&&e.targetGeometry?k=e.targetGeometry:!k&&b.extent&&(k=b.extent);n=D(k);c||(c=D(b.spatialReference||b.extent||k));if(!B.canProject(k,c)&&n&&!n.equals(c))return[2,null];r=K(x.vec2f64.create(),k.center?k.center:k);v=new y(C(r,r,n,c),c);t=null;t=g&&g.targetGeometry&&"point"===g.targetGeometry.type?g.scale:a.hasOwnProperty("scale")&&a.scale?a.scale:a.hasOwnProperty("zoom")&&
-1!==a.zoom&&f&&f.effectiveLODs?f.zoomToScale(a.zoom):Array.isArray(k)||"point"===k.type||"extent"===k.type&&0===k.width&&0===k.height?b.extent&&z.canProject(b.extent,c)?I(z.project(b.extent,c),d):b.extent?I(b.extent,d):e.scale:z.canProject(k.extent,c)?I(z.project(k.extent,c),d):I(k.extent,d);if(u=J(a))u.min&&u.min>t?t=u.min:u.max&&u.max<t&&(t=u.max);N=0;g?N=g.rotation:a.hasOwnProperty("rotation")?N=a.rotation:e&&(N=e.rotation);L=new h({targetGeometry:v,scale:t,rotation:N});f&&(L=f.fit(L),f.rotationEnabled||
(L.rotation=N));return[2,L]}})})}function L(a,b){var c=a.targetGeometry,d=b.targetGeometry;c.x=d.x;c.y=d.y;c.spatialReference=d.spatialReference;a.scale=b.scale;a.rotation=b.rotation;return a}function M(a,b,c){return c?t.vec2.set(a,.5*(b[0]-c.right+c.left),.5*(b[1]-c.bottom+c.top)):t.vec2.scale(a,b,.5)}function R(a,c,d,e){b.getTransform(a,c,d,e);return p.mat2d.invert(a,a)}function S(a,b,c){var d=U(b);b=Math.abs(Math.cos(d));d=Math.abs(Math.sin(d));return t.vec2.set(a,Math.round(c[1]*d+c[0]*b),Math.round(c[1]*
b+c[0]*d))}function T(a){var b=a.scale;a=a.targetGeometry.spatialReference;a=v.isValid(a)?1/(39.37*f.getMetersPerUnitForSR(a)*96):1;return b*a}function U(a){return q.common.toRadian(a.rotation)||0}function Y(a){return v.isValid(a)?39.37*f.getMetersPerUnitForSR(a)*96:1}function X(a){return a.isWrappable?(a=v.getInfo(a),a.valid[1]-a.valid[0]):0}Object.defineProperty(b,"__esModule",{value:!0});var P=c.wgs84Radius,V=180/Math.PI;b.extentToScale=I;b.create=N;b.copy=L;b.getAnchor=M;b.getExtent=function(){var a=
x.vec2f64.create();return function(b,c,d){var e=c.targetGeometry;K(a,e);c=.5*T(c);b.xmin=a[0]-c*d[0];b.ymin=a[1]-c*d[1];b.xmax=a[0]+c*d[0];b.ymax=a[1]+c*d[1];b.spatialReference=e.spatialReference;return b}}();b.setExtent=function(a,c,d,e,f){b.centerAt(a,c,d.center);a.scale=I(d,e);f&&f.constraints&&f.constraints.constrain(a);return a};b.getOuterExtent=function(){var a=x.vec2f64.create(),b=x.vec2f64.create();return function(c,d,e){K(a,d.targetGeometry);S(b,d,e);e=.5*T(d);c.set({xmin:a[0]-e*b[0],ymin:a[1]-
e*b[1],xmax:a[0]+e*b[0],ymax:a[1]+e*b[1],spatialReference:d.targetGeometry.spatialReference});return c}}();b.getOuterSize=S;b.getPaddingScreenTranslation=function(){var a=x.vec2f64.create();return function(b,c,d){return t.vec2.sub(b,t.vec2.scale(b,c,.5),M(a,c,d))}}();b.getPaddingMapTranslation=function(){var a=r.mat2df64.create(),c=x.vec2f64.create();return function(d,e,f,g){var h=T(e);e=U(e);t.vec2.set(c,h,h);p.mat2d.fromScaling(a,c);p.mat2d.rotate(a,a,e);p.mat2d.translate(a,a,b.getPaddingScreenTranslation(c,
f,g));p.mat2d.translate(a,a,[0,g.top-g.bottom]);return t.vec2.set(d,a[4],a[5])}}();b.getResolution=T;b.getResolutionToScaleFactor=Y;b.getMatrix=function(){var a=x.vec2f64.create(),b=x.vec2f64.create(),c=x.vec2f64.create();return function(d,e,f,g,h,k){t.vec2.negate(a,e);t.vec2.scale(b,f,.5*k);t.vec2.set(c,1/g*k,-1/g*k);p.mat2d.identity(d);p.mat2d.translate(d,d,b);h&&p.mat2d.rotate(d,d,h);p.mat2d.scale(d,d,c);p.mat2d.translate(d,d,a);return d}}();b.getTransform=function(){var a=x.vec2f64.create();return function(c,
d,e,f){var g=T(d),h=U(d);K(a,d.targetGeometry);return b.getMatrix(c,a,e,g,h,f)}}();b.getTransformNoRotation=function(){var a=x.vec2f64.create();return function(c,d,e,f){var g=T(d);K(a,d.targetGeometry);return b.getMatrix(c,a,e,g,0,f)}}();b.getWorldWidth=X;b.getWorldScreenWidth=function(a,b){return Math.round(X(a)/b)};b.createAsync=function(b,c){return a.safeCast(N(b,c))};b.angleBetween=function(){var a=x.vec2f64.create(),b=x.vec2f64.create(),c=[0,0,0];return function(d,e,f){t.vec2.subtract(a,d,e);
t.vec2.normalize(a,a);t.vec2.subtract(b,d,f);t.vec2.normalize(b,b);t.vec2.cross(c,a,b);d=Math.acos(t.vec2.dot(a,b)/(t.vec2.length(a)*t.vec2.length(b)))*V;0>c[2]&&(d=-d);isNaN(d)&&(d=0);return d}}();b.addPadding=function(){var a=x.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;L(c,d);b.getPaddingMapTranslation(a,d,e,f);g.x+=a[0];g.y+=a[1];return c}}();b.removePadding=function(){var a=x.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;L(c,d);b.getPaddingMapTranslation(a,
d,e,f);g.x-=a[0];g.y-=a[1];return c}}();b.centerAt=function(){var a=x.vec2f64.create();return function(b,c,d){L(b,c);c=b.targetGeometry;var e=D(d),f=D(c);K(a,d);C(a,a,e,f);c.x=a[0];c.y=a[1];return b}}();b.pixelSizeAt=function(a,b,c){return T(b)};b.resize=function(){var a=x.vec2f64.create();return function(c,d,e,f,g){g||(g="center");t.vec2.sub(a,e,f);t.vec2.scale(a,a,.5);e=a[0];f=a[1];switch(g){case "center":t.vec2.set(a,0,0);break;case "left":t.vec2.set(a,-e,0);break;case "top":t.vec2.set(a,0,f);
break;case "right":t.vec2.set(a,e,0);break;case "bottom":t.vec2.set(a,0,-f);break;case "top-left":t.vec2.set(a,-e,f);break;case "bottom-left":t.vec2.set(a,-e,-f);break;case "top-right":t.vec2.set(a,e,f);break;case "bottom-right":t.vec2.set(a,e,-f)}b.translateBy(c,d,a);return c}}();b.rotateBy=function(a,b,c){L(a,b);a.rotation+=c;return a};b.rotateTo=function(a,b,c){L(a,b);a.rotation=c;return a};b.scaleBy=function(){var a=x.vec2f64.create();return function(c,d,e,f,g){L(c,d);isNaN(e)||0===e||(b.toMap(a,
f,d,g),c.scale=d.scale*e,b.toScreen(a,a,c,g),b.translateBy(c,c,t.vec2.set(a,a[0]-f[0],f[1]-a[1])));return c}}();b.scaleTo=function(a,b,c){L(a,b);a.scale=c;return a};b.scaleAndRotateBy=function(){var a=x.vec2f64.create();return function(c,d,e,f,g,h){L(c,d);isNaN(e)||0===e||(b.toMap(a,g,d,h),c.scale=d.scale*e,c.rotation+=f,b.toScreen(a,a,c,h),b.translateBy(c,c,t.vec2.set(a,a[0]-g[0],g[1]-a[1])));return c}}();b.padAndScaleAndRotateBy=function(){var a=x.vec2f64.create(),c=x.vec2f64.create();return function(d,
e,f,g,h,k,m){b.getPaddingScreenTranslation(c,k,m);t.vec2.add(a,h,c);return g?b.scaleAndRotateBy(d,e,f,g,a,k):b.scaleBy(d,e,f,a,k)}}();b.toMap=function(){var a=r.mat2df64.create();return function(b,c,d,e){return t.vec2.transformMat2d(b,c,R(a,d,e,1))}}();b.toScreen=function(){var a=r.mat2df64.create();return function(c,d,e,f){return t.vec2.transformMat2d(c,d,b.getTransform(a,e,f,1))}}();b.translateBy=function(){var a=x.vec2f64.create(),b=r.mat2df64.create();return function(c,d,e){L(c,d);var f=T(d),
g=c.targetGeometry;p.mat2d.fromRotation(b,U(d));p.mat2d.scale(b,b,x.vec2f64.fromValues(f,f));t.vec2.transformMat2d(a,e,b);g.x+=a[0];g.y+=a[1];return c}}()})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});var h=null,a=[];b.enabled=!1;b.begin=function(){b.enabled&&(h=[])};b.trace=function(a){b.enabled&&null!=h&&h.push(a)};b.end=function(){if(b.enabled){var g=
h;h=null;g&&(a.forEach(function(a){return a(g)}),a.length=0);return g}return null};b.instrumentContext=function(a){return b.enabled?k.default(a)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),a):l.makeDebugContext(a,void 0,function(a,d){b.enabled&&h&&h.push("gl."+a+"("+l.glFunctionArgsToString(a,d)+")")}):a};b.request=function(b){a.push(b)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function n(a){if(null==d){d={};f={};for(var b in a)"number"==
typeof a[b]&&(d[a[b]]=b,f[b]=a[b])}}function b(){if(null==d)throw"WebGLDebugUtils.init(ctx) not called";}function l(a){b();var c=d[a];return void 0!==c?"gl."+c:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function k(a,b,d,g){a=e[a];if(void 0!==a&&(a=a[b],void 0!==a&&a[d])){if("object"===typeof a[d]&&void 0!==a[d].enumBitwiseOr){b=a[d].enumBitwiseOr;d=0;a=[];for(var c=0;c<b.length;++c){var h=f[b[c]];0!==(g&h)&&(d|=h,a.push(l(h)))}return d===g?a.join(" | "):l(g)}return l(g)}return null===g?"null":
void 0===g?"undefined":g.toString()}function h(a,b,d){a.__defineGetter__(d,function(){return b[d]});a.__defineSetter__(d,function(a){b[d]=a})}function a(b,d,e,f){function c(a,b){return function(){e&&e(b,arguments);var c=a[b].apply(a,arguments),h=f.getError();0!=h&&(g[h]=!0,d(h,b,arguments));return c}}f=f||b;n(b);d=d||function(a,b,c){for(var d="",e=c.length,f=0;f<e;++f)d+=(0==f?"":", ")+k(b,e,f,c[f]);a="WebGL error "+l(a)+" in "+b+"("+d+")";window.console&&window.console.error?window.console.error(a):
window.console&&window.console.log&&window.console.log(a)};var g={},p={},q;for(q in b)if("function"==typeof b[q])if("getExtension"!=q)p[q]=c(b,q);else{var r=c(b,q);p[q]=function(){var c=r.apply(b,arguments);return a(c,d,e,f)}}else h(p,b,q);p.getError=function(){for(var a in g)if(g.hasOwnProperty(a)&&g[a])return g[a]=!1,a;return b.NO_ERROR};return p}function g(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);for(var d=0;d<b;++d)a.disableVertexAttribArray(d),
a.vertexAttribPointer(d,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(d,0);a.deleteBuffer(c);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(d=0;d<b;++d)a.activeTexture(a.TEXTURE0+d),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);
a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var e={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},
drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,
2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,
1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},
frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},d=null,f=null;return{init:n,mightBeEnum:function(a){b();return void 0!==d[a]},glEnumToString:l,glFunctionArgToString:k,glFunctionArgsToString:function(a,b){for(var c="",d=b.length,e=0;e<d;++e)c+=(0==e?"":", ")+k(a,d,e,b[e]);return c},makeDebugContext:a,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function c(){for(var a=
Object.keys(J),b=0;b<a.length;++b)delete J[a]}function d(){++K;B||D==K&&a.loseContext()}function e(a,b){var c=a[b];return function(){d();if(!B)return c.apply(a,arguments)}}function f(a){return{statusMessage:a,preventDefault:function(){I=!0}}}function k(a){for(var b in a)"function"==typeof a[b]?n[b]=e(a,b):h(n,a,b);n.getError=function(){d();if(!B)for(var a;a=l.getError();)J[a]=!0;for(a in J)if(J[a])return delete J[a],a;return n.NO_ERROR};var c="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");
for(b=0;b<c.length;++b){var f=c[b];n[f]=function(b){return function(){d();if(B)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=z;C.push(c);return c}}(a[f])}c="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(b=0;b<c.length;++b)f=c[b],n[f]=function(b){return function(){d();return B?null:b.apply(a,arguments)}}(n[f]);c="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(b=0;b<c.length;++b)f=c[b],n[f]=function(b){return function(){d();return B?!1:b.apply(a,arguments)}}(n[f]);n.checkFramebufferStatus=function(b){return function(){d();return B?n.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(n.checkFramebufferStatus);n.getAttribLocation=function(b){return function(){d();
return B?-1:b.apply(a,arguments)}}(n.getAttribLocation);n.getVertexAttribOffset=function(b){return function(){d();return B?0:b.apply(a,arguments)}}(n.getVertexAttribOffset);n.isContextLost=function(){return B};return n}var l,n,m=[],v=[];n={};var z=1,B=!1,C=[],D=0,K=0,I=!1,Q=0,J={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=l){if(l)throw"got different context";l=c;n=k(l)}return n}return c}}(a.getContext);(function(a){var c=a.addEventListener;
a.addEventListener=function(d,e,f){switch(d){case "webglcontextlost":m.push(b(e));break;case "webglcontextrestored":v.push(b(e));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!B){B=!0;D=0;for(++z;l.getError(););c();J[l.CONTEXT_LOST_WEBGL]=!0;var b=f("context lost"),d=m.slice();setTimeout(function(){for(var c=0;c<d.length;++c)d[c](b);0<=Q&&setTimeout(function(){a.restoreContext()},Q)},0)}};a.restoreContext=function(){B&&v.length&&setTimeout(function(){if(!I)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<C.length;++a){var b=C[a];b instanceof WebGLBuffer?l.deleteBuffer(b):b instanceof WebGLFramebuffer?l.deleteFramebuffer(b):b instanceof WebGLProgram?l.deleteProgram(b):b instanceof WebGLRenderbuffer?l.deleteRenderbuffer(b):b instanceof WebGLShader?l.deleteShader(b):b instanceof WebGLTexture&&l.deleteTexture(b)}g(l);B=!1;K=0;I=!1;for(var a=v.slice(),b=f("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(B)throw"You can not ask a lost contet to be lost";
D=K+a};a.getNumCalls=function(){return K};a.setRestoreTimeout=function(a){Q=a};return a},resetToInitialState:g}})},"esri/views/3d/webgl-engine/shaders/TerrainRendererPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(a){return h.glslifyDefineMap({OVERLAY:a.overlay,ATMOSPHERE:a.atmosphere,TILE_BORDERS:a.tileBorders,RECEIVE_SHADOWS:a.receiveShadows,
SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,ALPHA_ZERO:a.alphaZero,BIAS_SHADOWMAP:a.shadowMap,SLICE:a.slice})};b.colorPass={name:"terrain-color",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("terrainRenderer/colorPass.vert"),fragmentShader:a(b)+k.resolveIncludes("terrainRenderer/colorPass.frag")}},attributes:l.Default3D};b.normalPass={name:"terrain-normal",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("terrainRenderer/normalPass.vert"),fragmentShader:a(b)+k.resolveIncludes("terrainRenderer/normalPass.frag")}},
attributes:l.Default3D};b.depthPass={name:"terrain-depth",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("terrainRenderer/depthPass.vert"),fragmentShader:a(b)+k.resolveIncludes("terrainRenderer/depthPass.frag")}},attributes:l.Default3D};b.highlightPass={name:"terrain-highlight",shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("terrainRenderer/highlightPass.vert"),fragmentShader:a(b)+k.resolveIncludes("terrainRenderer/highlightPass.frag")}},attributes:l.Default3D}})},
"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TilePerLayerInfo"],function(n,b,l){return function(){function b(b,a,g){this.lij=b;this._pool=a;this.layerInfo=Array(2);this.parent=null;for(b=0;2>b;b++)if(a=g[b],0<a){this.layerInfo[b]=[];for(var e=0;e<a;++e)this.layerInfo[b][e]=l.TilePerLayerInfo.makeEmptyLayerInfo(b,this._pool)}}b.prototype.hasDataAvailable=function(b,a,g){return(a=this.layerInfo[g][a].tilemap)?"unavailable"!==a.getAvailability(b.lij[1],b.lij[2]):
!0};b.prototype.modifyLayers=function(b,a,g){b=this.layerInfo[g];for(var e=a.length,d=Array(e),f=0;f<e;f++){var c=a[f];d[f]=-1<c?b[c]:l.TilePerLayerInfo.makeEmptyLayerInfo(g,this._pool)}this.layerInfo[g]=d};return b}()})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64"],function(n,b,l){return function(){function b(){this.offset=l.vec2f64.create();this.scale=0;this.tile=null}b.prototype.init=function(b,a,g,e){this.tile=b;this.offset[0]=
a;this.offset[1]=g;this.scale=e};b.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return b}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./lib/AutoDisposable ./lib/GeometryRecord ./lighting/Lightsources ./parts/Model ./parts/RenderView".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(a){return"function"===typeof a.addParentStage&&"function"===typeof a.removeParentStage}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a._viewContent=[];a._mainLightDirection=d.vec3f64.fromValues(0,1,0);return a}k(h,b);n=h;h.prototype.initialize=function(){this.model=new p;this._set("renderView",new r(this.container,this,this.model.getDirtySet(),this.options));this.setLighting({lights:[new q.MainLight(d.vec3f64.fromValues(.7,
.7,.7)),new q.AmbientLight(d.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})};h.prototype.destroy=function(){c.pool.prune(0);this.dispose()};Object.defineProperty(h.prototype,"dirty",{get:function(){var a=this.model.getDirtySet();return!(!a.hasDirtyGeometryRecords()&&!a.getDirtyMaterials())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"mainLightDirection",{get:function(){return this._mainLightDirection},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"lighting",{get:function(){return this._lighting},enumerable:!0,configurable:!0});h.prototype.setLighting=function(a){e.vec3.set(this._mainLightDirection,0,0,0);for(var b=0,c=a.lights;b<c.length;b++){var d=c[b];if(d instanceof q.MainLight){e.vec3.negate(this._mainLightDirection,d.direction);break}}this._lighting=a;this.renderView.setNeedsRender()};h.prototype.forceAllAnimations=function(b){this.getAll(3).forEach(function(c){a.applySome(c.animation,function(a){return a.forceTime(b)})});this.renderView.setNeedsRender()};
h.prototype.add=function(a,b){this.model.add(a,b);t(b)&&b.addParentStage(this);this.renderView.setNeedsRender()};h.prototype.remove=function(a,b){this.renderView.setNeedsRender();a=this.model.remove(a,b);t(a)&&a.removeParentStage(this);return a};h.prototype.notifyDirty=function(a,b,c,d){this.model.notifyDirty(a,b,c,d);this.renderView.setNeedsRender()};h.prototype.processDirty=function(){var a=this.model.getDirtySet(),b=a.getDirtyMaterials();if(a.hasDirtyGeometryRecords()||b){n.DebugSettings.logDirtySet&&
console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var c=a.commitLayers(this._viewContent);(0<c[0].length+c[1].length+c[2].length||b)&&this.renderView.modify(c[0],c[1],c[2],b);n.DebugSettings.logDirtySet&&(console.log("RGs add: "+c[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+c[1].map(function(a){return a.uniqueName})));a.commit();a.clearDirtyMaterials();this.renderView.setNeedsRender()}};h.prototype.processDirtyLayer=function(a){var b=this.model.getDirtySet(),
c=b.getDirtyMaterials();a=b.commitLayers([a]);(0<a[0].length+a[1].length+a[2].length||c)&&this.renderView.modify(a[0],a[1],a[2],c);b.clearDirtyMaterials();this.renderView.setNeedsRender()};h.prototype.getContent=function(a,b){return this.model.get(a,b)};h.prototype.getAll=function(a){return this.model.getAll(a)};h.prototype.getCount=function(a){return this.model.getAll(a).size};h.prototype.getCamera=function(){return this.renderView.getCamera()};h.prototype.setCamera=function(a){this.renderView.setCamera(a)};
h.prototype.getLayers=function(){return this.model.getAll(0)};h.prototype.getViewContent=function(){return this._viewContent.slice(0)};h.prototype.addToViewContent=function(a){for(var b=[],c=0;c<a.length;c++)-1===this._viewContent.indexOf(a[c])&&b.push(a[c]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.renderView.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};h.prototype.removeFromViewContent=function(a){this.processDirty();
for(var b=this.model.getDirtySet(),c=this._viewContent,d=[],e=0;e<a.length;e++){var f=c.indexOf(a[e]);-1<f&&(c[f]=c[c.length-1],c.pop(),d.push(a[e]))}a=b.getResidentRenderGeometriesFilteredByLayers(d);this.renderView.modify([],a,[])};h.prototype.addRenderPlugin=function(a,b){"intersect"in b&&this.sceneIntersectionHelper.addIntersectionHandler(b);return this.renderView.renderPlugins.add(a,b)};h.prototype.removeRenderPlugin=function(a){"intersect"in a&&this.sceneIntersectionHelper.removeIntersectionHandler(a);
return this.renderView.renderPlugins.remove(a)};h.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};var n;h.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};l([g.property({constructOnly:!0})],h.prototype,"options",void 0);l([g.property({constructOnly:!0})],h.prototype,"sceneIntersectionHelper",void 0);l([g.property({constructOnly:!0})],h.prototype,"viewingMode",void 0);l([g.property({constructOnly:!0})],h.prototype,"container",void 0);l([f.autoDispose()],
h.prototype,"model",void 0);l([f.autoDispose(),g.property()],h.prototype,"renderView",void 0);return h=n=l([g.subclass("esri.views.3d.webgl-engine.Stage")],h)}(g.declared(f.AutoDisposableMixin(h)));b.Stage=n})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../../support/mathUtils ../lib/localOrigin ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(n,b,l,k,h,a,g,e,d){var f=d.assert,c=d.logWithBase;return function(){function b(){var b=
this;this.dirtySet=new g(this);this._uniqueIdx=0;this._id2origin={};this._content=new Map;a.allModelContentTypes.forEach(function(a){b._content.set(a,new Map)})}b.prototype.getAll=function(a){a=this._content.get(a);f(void 0!==a);return a};b.prototype.get=function(a,b){return this.getAll(a).get(b)};b.prototype.add=function(a,b){var c=this._content.get(a);f(void 0!==c);var d=b.id;f(!c.has(d),"Model/Stage already contains object to be added");c.set(d,b);0===a&&this.notifyDirty(a,b,"layerAdded")};b.prototype.remove=
function(a,b){var c=this._content.get(a);f(void 0!==c);var d=c.get(b);f(void 0!==d,"Model/Stage doesn't contain object to be removed");c.delete(b);4===a&&d.unload();0===a&&this.notifyDirty(a,d,"layerRemoved");return d};b.prototype.getDirtySet=function(){return this.dirtySet};b.prototype.notifyDirty=function(a,b,c,d){this.dirtySet.handleUpdate(b,c,d)};b.prototype.getOrigin=function(a,b,d){void 0===d&&(d=10);var e=0;b=b*d/1E4;1<b&&(e=Math.ceil(c(b,2)));b=1E4*Math.pow(2,e);d=Math.round(a[0]/b);var f=
Math.round(a[1]/b);a=Math.round(a[2]/b);var e=e+"_"+d+"_"+f+"_"+a,g=this._id2origin[e];null==g&&(g=h.fromValues(d*b,f*b,a*b,e),this._id2origin[e]=g);return g};b.prototype.getGeometryRenderGeometries=function(a,b,c){var d=a.id,f=b.geometry,g=a.getCombinedStaticTransformation(b),h=k.maxScale(g),m=b.origin,l=b.id,p=this._uniqueIdx++;a=new e(f.data,f.boundingInfo,b.material,g,b.shaderTransformation,h,a.castShadow,!!f.singleUse,d,l,p);a.origin=m||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=
b.instanceParameters;c.push(a)};b.prototype.updateRenderGeometryTransformation=function(a,b,c){a.getCombinedStaticTransformation(b,c.transformation);c.updateTransformation(c.transformation);a=this.getOrigin(c.center,c.bsRadius);return c.origin!==a};b.prototype.formatDebugInfo=function(b){var c=[];if(b){c[0]="\x3ctable\x3e";for(var d=0,e=a.allModelContentTypes;d<e.length;d++)b=e[d],c[0]+="\x3ctr\x3e\x3ctd\x3e"+b+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+this.getAll(b).size+"\x3c/td\x3e\x3c/tr\x3e";
c[0]+="\x3c/table\x3e";c[1]=this.dirtySet.formatDebugInfo(!0)}else{c[0]="";d=0;for(e=a.allModelContentTypes;d<e.length;d++)b=e[d],c[0]+=l.pad(String(this.getAll(b).size),6," ")+" "+b+", ";c[1]=this.dirtySet.formatDebugInfo(!1)}return c};b.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var c=a[b];f(null!=this.get(2,c.geometry.id));f(null!=this.get(3,c.material.id))}};b.prototype.validateLayer=function(a){a=a.getObjects();for(var b=0;b<a.length;++b){var c=this.get(1,
a[b].id);f(null!=c)}};return b}()})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.allModelContentTypes=[0,1,2,3,4];b.modelContentTypes={LAYER:0,OBJECT:1,GEOMETRY:2,MATERIAL:3,TEXTURE:4}})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/iteratorUtils","./Util"],function(n,b,l,k,h){return function(){function a(a){this._residentGeomRecords=
new Map;this._dirtyGeomRecords=new Map;this._dirtyMaterials=new Set;this._model=a}Object.defineProperty(a.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"residentObjectCount",{get:function(){var a=0;this._residentGeomRecords.forEach(function(b){a+=b.size});return a},enumerable:!0,configurable:!0});a.prototype.getDirtyMaterials=function(){return 0<this._dirtyMaterials.size?this._dirtyMaterials:
null};a.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()};a.prototype.hasDirtyGeometryRecords=function(){var a=!1;k.everyMap(this._dirtyGeomRecords,function(b){if(a)return!1;k.everyMap(b,function(b){if(!a&&b&&0<b.size)return a=!0,!1})});return a};a.prototype.handleUpdate=function(a,b,d){h.assert(this[b],"ModelDirtySet doesn't know how to process "+b);return this[b](a,d)};a.prototype.shaderTransformationChanged=function(a){var b=this;(a=this._residentGeomRecords.get(a.id))&&a.forEach(function(a,
e){(e=b._model.get(1,e))&&e.hasVolativeTransformation()&&a.forEach(function(a){var b=0;for(a=a[1];b<a.length;b++)a[b].shaderTransformationChanged()})})};a.prototype.commit=function(){return this.commitLayers(l.keysOfMap(this._dirtyGeomRecords))};a.prototype.commitLayers=function(a){for(var b=this,d=[],f=[],c=[],g=function(e){var g=a[e];e=k._dirtyGeomRecords.get(g);if(!e)return"continue";e.forEach(function(a,e){var k=b._ensureGeomRecord(g,e);a.forEach(function(a,g){var m=a[0],l=a[1];a=a[2];var p=!1;
if(l&2){var q=k.get(g);if(q){q=q[1];if(a&4)for(var n=b._model.get(1,e),r=0;r<q.length;r++){var v=q[r];if(b._model.updateRenderGeometryTransformation(n,m,v)){p=!0;break}}if(!p)for(n=0;n<q.length;n++)v=q[n],c.push({renderGeometry:v,updateType:a})}else h.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l&4||p)(q=k.get(g))?f.push.apply(f,q[1]):4===l&&h.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),q&&k.delete(g);if(l&1||p)l=[m,[]],n=b._model.get(1,
e),b._model.getGeometryRenderGeometries(n,m,l[1]),d.push.apply(d,l[1]),k.set(g,l)});0===k.size&&b._residentGeomRecords.get(g).delete(e)});0===k._residentGeomRecords.get(g).size&&k._residentGeomRecords.delete(g);k._dirtyGeomRecords.delete(g)},k=this,l=0;l<a.length;l++)g(l);return[d,f,c]};a.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(l.keysOfMap(this._residentGeomRecords))};a.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var b=
[],d=0;d<a.length;d++){var f=this._residentGeomRecords.get(a[d]);f&&f.forEach(function(a){a.forEach(function(a){b.push.apply(b,a[1])})})}return b};a.prototype.visibilityChanged=function(a,b,d){if(null!=b)this._componentPropertyChanged(a,b,d,1);else{b=0;for(var e=a.geometryRecords;b<e.length;b++)this._componentPropertyChanged(a,e[b],d,1)}};a.prototype.componentHighlightChanged=function(a,b,d){if(null!=b)this._componentPropertyChanged(a,b,d,16);else{b=0;for(var e=a.geometryRecords;b<e.length;b++)this._componentPropertyChanged(a,
e[b],d,16)}};a.prototype.vertexAttrsUpdated=function(a,b,d){this._updateOrCreateDirtyRecord(a,b,d,2,0,0,2,5,2)};a.prototype.matChanged=function(a){this._dirtyMaterials.add(a.id);if(this.onMaterialChanged)this.onMaterialChanged(a)};a.prototype.layerAdded=function(a){for(var b=a.getObjects(),d=0;d<b.length;d++)this.layerObjectAdded(a,b[d])};a.prototype.layerRemoved=function(a){for(var b=a.getObjects(),d=0;d<b.length;d++)this.layerObjectRemoved(a,b[d])};a.prototype.layerObjectAdded=function(a,b){a=a.id;
for(var d=b.geometryRecords,e=0;e<d.length;e++)this.objGeometryAdded(b,d[e],a)};a.prototype.layerObjectRemoved=function(a,b){a=a.id;for(var d=b.geometryRecords,e=0;e<d.length;e++)this.objGeometryRemoved(b,d[e],a)};a.prototype.layObjectReplaced=function(a,b){this.layerObjectRemoved(a,b[0]);this.layerObjectAdded(a,b[1])};a.prototype.objTransformation=function(a,b){var d=this;b=b||this._getParentLayerId(a);this._ensureGeomRecord(b,a.id).forEach(function(e){d._updateOrCreateDirtyRecord(a,e[0],b,2,0,0,
2,5,4)})};a.prototype.objGeometryAdded=function(a,b,d){this._updateOrCreateDirtyRecord(a,b,d,1,4,0,0,0)};a.prototype.objGeometryRemoved=function(a,b,d){this._updateOrCreateDirtyRecord(a,b,d,4,1,2,0,0)};a.prototype.objGeometryReplaced=function(a,b){this.objGeometryRemoved(a,b[0]);this.objGeometryAdded(a,b[1])};a.prototype.objGeometryTransformation=function(a,b){this.objGeometryReplaced(a,b)};a.prototype._componentPropertyChanged=function(a,b,d,f){this._updateOrCreateDirtyRecord(a,b,d,2,0,0,2,5,f)};
a.prototype._updateOrCreateDirtyRecord=function(a,b,d,f,c,k,l,n,t){d=d||this._getParentLayerId(a);var e=b.id;a=this._ensureDirtyRecord(d,a.id);(d=a.get(e))?(b=d[1],b&c?a.delete(e):b&k?(d[1]=f,d[2]=t):b&l?d[2]|=t:b&n||h.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):a.set(e,[b,f,t])};a.prototype._ensureGeomRecord=function(a,b){var d=this._residentGeomRecords.get(a);d||(d=new Map,this._residentGeomRecords.set(a,d));a=d.get(b);a||(a=new Map,d.set(b,a));return a};a.prototype._ensureDirtyRecord=
function(a,b){var d=this._dirtyGeomRecords.get(a);d||(d=new Map,this._dirtyGeomRecords.set(a,d));a=d.get(b);a||(a=new Map,d.set(b,a));return a};a.prototype._getParentLayerId=function(a){return a.parentLayer.id};a.prototype.formatDebugInfo=function(a){if(a)return"";var b=["ADD","UPD",void 0,"REM"],d="";this._dirtyGeomRecords.forEach(function(a,c){a.forEach(function(a,e){0<d.length&&(d+="\n");d+=c+"."+e;var f=[];a.forEach(function(a){var b=a[1];f[b]||(f[b]=[]);f[b].push(a[0].geometry.id)});for(a=0;a<
f.length;a++)if(f[a])for(d+=" "+b[a-1]+": ",e=0;e<f[a].length;e++)d+=f[a][e]+", "})});return d};return a}()})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/has ../../../../core/Logger ../../../../core/now ../../../../core/scheduling ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/animationUtils ../lib/AutoDisposable ../lib/Camera ../lib/DrapedRenderer ../lib/GLMaterialRep ../lib/ProgramRepository ../lib/Renderer ../lib/TextureRepository ../lib/tracer ./ScreenshotManager ../shaders/globalOptions ../../../webgl/context-util ../../../webgl/RenderingContext".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D){var K=e.getLogger("esri.views.3d.webgl-engine.parts.View");return function(a){function b(b,c,d,e){var f=a.call(this)||this;f._stage=c;f._camera=new t.default(q.vec3f64.fromValues(0,100,-100));f._needsUpdate=!0;f._needsRender=!0;f._idleSuspend=!0;f._logicUpdateLast=0;f._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,renderTimeTotal:0,renderTimeLast:0,frameCount:0};f._container=b;f._initializeContext(e);b=B.glslifyGlobalOptions({viewingMode:e.viewingMode});
f._programRepository=new u(f._rctx,b);f._textureRepository=new m(f._stage.getAll(4),f._programRepository,function(){return f._camera.viewport},f._rctx,function(){f._textureRepositoryHasNewLoadedTextures=!0});f._materialRepository=new w(f._textureRepository,f._programRepository);f._initializeViewportCamera();f._drapedRenderer=new x(f._rctx,f._canvas,f._programRepository,f._materialRepository,f._textureRepository,d);f._renderer=new y(f._programRepository,f._materialRepository,f._textureRepository,f._rctx,
"scene",function(a){void 0===a&&(a=1);return f.setNeedsRender(a)},f._stage);f._screenshotManager=new z.ScreenshotManager(f._rctx,f._render.bind(f),function(){return f.setNeedsRender()},e.screenshot.renderOverlay);f._registerFrameTask();return f}k(b,a);b.prototype.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this.inherited(arguments)};b.prototype.getCombinedStats=function(){var a=
this._rctx.gl,b={},c=this._renderer.getCombinedStats(),d;for(d in c)b[d]=c[d];b.renderGeometriesTotal=this._stats.renderGeometriesTotal;b.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==a.getUsedTextureMemory&&(b.textureMemory=a.getUsedTextureMemory());void 0!==a.getUsedRenderbufferMemory&&(b.renderbufferMemory=a.getUsedRenderbufferMemory());void 0!==a.getUsedVBOMemory&&(b.VBOMemory=a.getUsedVBOMemory());if(void 0!==a.getUsedTextureMemoryStats){var a=a.getUsedTextureMemoryStats(),
e;for(e in a)b["texMem type: "+e]=a[e]}return b};b.prototype.setNeedsRender=function(a){void 0===a&&(a=1);1===a?(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0};Object.defineProperty(b.prototype,"canRender",{get:function(){var a=this._camera;return 0<a.fullWidth&&0<a.fullHeight&&this._renderer.canRender},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsUpdate",{get:function(){return this._needsUpdate||!this._idleSuspend||this._textureRepositoryHasNewLoadedTextures},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return this.needsUpdate||this._renderer.updating||0<this._textureRepository.getLoadingCount()||this._drapedRenderer.updating||this._stage.dirty},enumerable:!0,configurable:!0});b.prototype.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};Object.defineProperty(b.prototype,"edgeView",{get:function(){return this._renderer.edgeView},enumerable:!0,configurable:!0});b.prototype.setRenderParameters=
function(a){this.setNeedsRender();void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._renderer.setRenderParams(a)};b.prototype.getRenderParameters=function(){var a=this._renderer.getRenderParams();a.anisotropicFiltering=this._textureRepository.getMaxAnisotropy();a.idleSuspend=this._idleSuspend;return a};Object.defineProperty(b.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});b.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:
"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:!1};b.prototype.modify=function(a,b,c,d){this._renderer.modify(a,a.length,b,b.length,c,c.length,d)};b.prototype.setCamera=function(a){this._camera.copyFrom(a);this.setNeedsRender()};b.prototype.getCamera=function(){return this._camera};b.prototype.getCanvas=function(){return this._canvas};b.prototype.getDrapedRenderer=function(){return this._drapedRenderer};b.prototype.takeScreenshot=function(a){return this._screenshotManager.takeScreenshot(a)};
Object.defineProperty(b.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0});b.prototype.getGpuMemoryUsage=function(){return l({},this._renderer.getGpuMemoryUsage(),{draped:this._drapedRenderer?this._drapedRenderer.getGpuMemoryUsage():0})};b.prototype._registerFrameTask=function(){var a=this,b={viewCamera:this._camera,frameHasSlicePlane:!1,
drapedRenderer:this._drapedRenderer};this._frameTask=f.addFrameTask({preRender:function(b){v.begin();var c=!1;a._stage.processDirty();a._drapedRenderer.commitChanges();var d=b.time-a._logicUpdateLast;d>p.DESIRED_ANIMATION_MS&&(c=a._renderer.updateLogic({dt:d,camera:a._stage.getCamera()})||c,a._logicUpdateLast=b.time);c&&a.setNeedsRender(0)},render:function(){(a.needsUpdate||a._needsRender)&&a.canRender&&(a._needsRender=!1,a._needsUpdate=!1,a._textureRepositoryHasNewLoadedTextures=!1,a._render(null,
a._camera,!1))},postRender:function(){a.notifyChange("updating");v.end()},update:function(){b.viewCamera=a._camera;b.frameHasSlicePlane=a._renderer.hasSlicePlane;b.drapedRenderer=a._drapedRenderer;a._screenshotManager.update(b)}})};b.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this.getCamera();b.viewport[2]=a.width;b.viewport[3]=a.height;this.setCamera(b)};b.prototype._initializeContext=function(a){this._canvas=a.canvas;this._canvas||(this._canvas=
document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var b=v.instrumentContext(C.createContextOrErrorHTML(this._canvas,{alpha:a.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==a.stencil?!0:a.stencil},a.renderContext));this._rctx=new D(b,{disabledExtensions:a.deactivatedWebGLExtensions||{},debugWebGLExtensions:a.debugWebGLExtensions||{}});this._load3DExtensions(this._rctx);!a.alpha&&this._rctx.contextAttributes.alpha&&K.error("WebGL context has alpha channel even though no alpha channel was requested");
!this._rctx.contextAttributes.alpha&&11<=g("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas)};b.prototype._render=function(a,b,c){this._renderer.setLighting(this._stage.lighting);this._rctx.bindFramebuffer(a);b.setGLViewport(this._rctx);this._renderer.render({fbo:a,camera:b,disableSlice:c,lightDirection:this._stage.mainLightDirection})};b.prototype._load3DExtensions=function(a){a=a.capabilities;a.standardDerivatives&&a.shaderTextureLOD&&a.instancing&&
a.textureFilterAnisotropic||K.error("required WebGL extensions are not supported!")};h([c.property({type:Boolean,readOnly:!0})],b.prototype,"updating",null);h([r.autoDispose()],b.prototype,"_rctx",void 0);h([r.autoDispose()],b.prototype,"_container",void 0);h([r.autoDispose()],b.prototype,"_canvas",void 0);h([r.autoDispose()],b.prototype,"_programRepository",void 0);h([r.autoDispose()],b.prototype,"_renderer",void 0);h([r.autoDispose()],b.prototype,"_drapedRenderer",void 0);h([r.autoDispose()],b.prototype,
"_screenshotManager",void 0);return b=h([c.subclass("esri.views.3d.webgl-engine.parts.RenderView")],b)}(c.declared(r.AutoDisposableMixin(a)))})},"esri/views/3d/webgl-engine/lib/DrapedRenderer":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ../../webgl-engine/lib/intersectorUtils ./Camera ./DefaultVertexBufferLayouts ./DrapedUpdates ./glUtil3D ./GridLocalOriginFactory ./Renderer ../lighting/Lightsources ../materials/ColorMaterial ../materials/HUDMaterial ../materials/RibbonLineMaterial ../shaders/MiscPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z){n=function(){function b(a,b,c,d,e,g){var m=this;this._renderTargets={};this._clearColor=h.vec4f64.fromValues(0,0,0,0);this._uniqueIdx=0;this._localOrigins=new q;this._rctx=a;this._canvas=b;this._programRep=c;this._modelDirtySet=g;this._modelDirtySet.onMaterialChanged=function(){return m._emitContentChanged()};this._renderer=new p(c,d,e,this._rctx,"draped",function(){return m._emitContentChanged()});this._updates=new f.DrapedUpdates(this._renderer,
{emitContentChanged:function(){return m._emitContentChanged()},emitUpdatingChanged:function(){return m._emitUpdatingChanged()}});this._renderer.onHasHighlightsChanged=function(a){if(m.onHasHighlightsChanged)m.onHasHighlightsChanged(a)};this._renderer.setLighting({lights:[new r.AmbientLight(k.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})}b.prototype.dispose=function(){for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._renderer.dispose();
this._renderer=null;this._updates.dispose();this._updates=null};b.prototype.disposeRenderTarget=function(a){var b=this._renderTargets[a];b&&b.dispose();delete this._renderTargets[a]};Object.defineProperty(b.prototype,"updating",{get:function(){return this._updates.updating},enumerable:!0,configurable:!0});b.prototype.commitChanges=function(){this._updates.commitChanges()};b.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};b.prototype.addRenderGeometries=
function(a){for(var b=0;b<a.length;b++){var c=a[b];null==c.origin&&(c.origin=this._localOrigins.getOrigin(c.center));c.idx=this._uniqueIdx++}this._updates.add(a)};b.prototype.removeRenderGeometries=function(a){this._updates.remove(a)};b.prototype.updateRenderGeometries=function(a,b){this._updates.modify(a,b)};b.prototype.updateRenderOrder=function(a){0<a.size&&(this._renderer.modifyRenderOrder(a),this._emitContentChanged())};b.prototype.setBackgroundColor=function(a){this._clearColor=a;this._emitContentChanged()};
b.prototype.updateHighlights=function(a){this._updates.modify(a,16)};b.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!a.OVERLAY_DRAW_TEST_TEXTURE};b.prototype.processDirtyMaterials=function(){var a=this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify(null,0,null,0,null,0,a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"hasWater",{get:function(){return this._renderer.hasWater},enumerable:!0,configurable:!0});b.prototype.draw=function(a,b){return this.drawPass(0,a,b)};b.prototype.drawNormals=function(a,b){return this.drawPass(2,a,b)};b.prototype.drawHighlights=function(a,b){return this.drawPass(4,a,b)};b.prototype.drawPass=function(b,c,d){this._pixelRatio=d.pixelRatio*Math.abs(d.views[0].extent[2]-d.views[0].extent[0])/Math.abs(d.views[0].viewport[2]-d.views[0].viewport[0]);if(this.isEmpty()||4===b&&!this.hasHighlights||
2===b&&!this.hasWater)return!1;this.processDirtyMaterials();if(!d.views.some(function(a){return a.extent[0]!==a.extent[2]&&a.extent[1]!==a.extent[3]}))return!1;c=this._renderTargets[c];if(!c)return!1;var e=this._rctx,f=d.width,g=d.height;c.width===f&&c.height===g||c.resize(f,g);var h=C.camera;C.fbo=c;h.near=1;h.far=1E4;h.pixelRatio=d.pixelRatio||1;e.bindFramebuffer(c);e.setClearColor.apply(e,this._clearColor);e.clearSafe(16384);for(var k=0;k<d.views.length;k++){var m=d.views[k];h.viewport=m.viewport;
l.mat4.ortho(h.projectionMatrix,0,m.extent[2]-m.extent[0],0,m.extent[3]-m.extent[1],h.near,h.far);l.mat4.identity(h.viewMatrix);l.mat4.translate(h.viewMatrix,h.viewMatrix,[-m.extent[0],-m.extent[1],0]);h.setGLViewport(this._rctx);a.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(f,g,B[d.index%B.length]);this._renderer.renderPass(b,C)}e.bindFramebuffer(null);e.setViewport(0,0,this._canvas.width,this._canvas.height);c.colorTexture.descriptor.hasMipmap&&c.colorTexture.generateMipmap();return!0};b.prototype._drawTestTexture=
function(a,b,e){var f=this._rctx;if(!this._testPatternTexture){for(var g=new Uint8Array(a*b*4),h=0,k=0;k<b;k++)for(var l=0;l<a;l++){var p=Math.floor(l/10),q=Math.floor(k/10);2>p||2>q||10*p>a-20||10*q>b-20?(g[h++]=255,g[h++]=255,g[h++]=255,g[h++]=255):(g[h++]=255,g[h++]=255,g[h++]=255,p&1&&q&1?g[h++]=l&1^k&1?0:255:g[h++]=p&1^q&1?0:128)}this._testPatternTexture=new v(f,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:b},g);this._testPatternProgram=this._programRep.getProgram(u.texOnly);
this._testPatternPipelineState=m.makePipelineState({blending:m.separateBlendingParams(770,1,771,771),colorWrite:m.defaultColorWriteParams});this._quadVAO=c.createQuadVAO(f,d.Pos3Tex)}a=this._testPatternProgram;f.bindProgram(a);f.setPipelineState(this._testPatternPipelineState);a.setUniform4f("color",e[0],e[1],e[2],1);a.setUniform1i("tex",0);f.bindTexture(this._testPatternTexture,0);f.bindVAO(this._quadVAO);f.drawArrays(5,0,z.vertexCount(this._quadVAO,"geometry"))};b.prototype.updateLogic=function(a){return this._renderer.updateLogic(a)};
b.prototype._emitContentChanged=function(){if(this.onContentChanged)this.onContentChanged()};b.prototype._emitUpdatingChanged=function(){if(this.onUpdatingChanged)this.onUpdatingChanged()};b.prototype.createRenderTarget=function(a,b,c,d){for(var e=a,f=0;this._renderTargets[e];)e=a+"_"+ ++f;this._renderTargets[e]=y.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:d,hasMipmap:b,maxAnisotropy:c,width:0,height:0},{colorTarget:0,depthStencilTarget:0});
return e};b.prototype.getGpuMemoryUsage=function(){var a=0,b;for(b in this._renderTargets)a+=z.getGpuMemoryUsage(this._renderTargets[b]);return a};b.prototype.intersect=function(a,b,c){var d=this,e=0;this._renderer.forEachRenderGeometry(function(f){if(!c||c(f)){if(f.material instanceof t||f.material instanceof w||f.material instanceof x){var g=f.transformation[12],h=f.transformation[13];D[0]=b[0]-g;D[1]=b[1]-h;D[2]=1;K[0]=b[0]-g;K[1]=b[1]-h;K[2]=0;f.pixelRatio=d._pixelRatio;f.material.intersect(f,
null,f.getShaderTransformation(),a,D,K,function(b,c,g,h,k,m){d.addIntersectionResult(g,f.material.renderPriority,e,a,f.data.layerUid,f.data.graphicUid)},f.calculateShaderTransformation,!0)}e++}})};b.prototype.addIntersectionResult=function(a,b,c,d,e,f){var h={type:"external",metadata:{layerUid:e,graphicUid:f}};e=function(e){e.set(h,null,d.results.terrain.dist,d.results.terrain.normal,d.results.terrain.transformation,b,null,null,a,c);e.intersector="DrapedRenderer"};(null==d.results.min.drapedLayerOrder||
b>=d.results.min.drapedLayerOrder)&&(null==d.results.min.dist||d.results.terrain.dist<=d.results.min.dist)&&e(d.results.min);(null==d.results.max.drapedLayerOrder||b<d.results.max.drapedLayerOrder)&&(null==d.results.max.dist||d.results.terrain.dist>d.results.max.dist)&&e(d.results.max);d.enable.storeAll&&(f=new g.IntersectorResult(d.ray),e(f),d.results.all.push(f))};Object.defineProperty(b.prototype,"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0});return b}();
var B=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],C={fbo:null,camera:new e.default,lightDirection:k.vec3f64.fromValues(0,0,1)},D=k.vec3f64.create(),K=k.vec3f64.create();return n})},"esri/views/3d/webgl-engine/lib/DrapedUpdates":function(){define(["require","exports","../../../../core/PooledArray"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});var k=function(){return function(){}}();n=function(){function b(a,b){this.renderer=a;this.handlers=b;this._pendingAddsRemoves=new Map;this._adds=new l;
this._removes=new l;this._updates=new l({allocator:function(a){return a?a:new k},deallocator:function(a){a.renderGeometry=null;return a}})}b.prototype.dispose=function(){this._adds.prune();this._removes.prune();this._updates.prune()};Object.defineProperty(b.prototype,"updating",{get:function(){return 0<this._pendingAddsRemoves.size||0<this._updates.length},enumerable:!0,configurable:!0});b.prototype.commitChanges=function(){var a=this;if(0!==this._pendingAddsRemoves.size||0!==this._updates.length){this._pendingAddsRemoves.forEach(function(b,
d){switch(b){case 0:a._adds.push(d);break;case 1:a._removes.push(d)}});for(var b=0;b<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[b].renderGeometry)?this._updates.removeUnorderedIndex(b):b++;this.renderer.modify(this._adds.data,this._adds.length,this._removes.data,this._removes.length,this._updates.data,this._updates.length);this._adds.clear();this._removes.clear();this._pendingAddsRemoves.clear();this._updates.clear();this.handlers.emitContentChanged();this.handlers.emitUpdatingChanged()}};
b.prototype.add=function(a){for(var b=0===this._pendingAddsRemoves.size,e=0;e<a.length;e++)this._pendingAddsRemoves.set(a[e],0);b&&0<this._pendingAddsRemoves.size&&this.handlers.emitUpdatingChanged()};b.prototype.remove=function(a){for(var b=0===this._pendingAddsRemoves.size,e=0;e<a.length;e++){var d=a[e],f=this._pendingAddsRemoves.get(d);0===f?this._pendingAddsRemoves.set(d,2):2!==f&&this._pendingAddsRemoves.set(d,1)}b&&0<this._pendingAddsRemoves.size&&this.handlers.emitUpdatingChanged()};b.prototype.modify=
function(a,b){for(var e=0===this._updates.length,d=0;d<a.length;d++){var f=a[d],c=this._updates.pushNew();c.renderGeometry=f;c.updateType=b}e&&0<this._updates.length&&this.handlers.emitUpdatingChanged()};return b}();b.DrapedUpdates=n})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/SpatialReference ../../support/projectionUtils ./Geometry ./GeometryData ./Layer ./localOrigin ./Object3D ./Util ../materials/RibbonLineMaterial".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){var x=0;n=function(){function a(){this.ROOT_ORIGIN_ID="rg_root_"+x++;this._origins=new Map;this._gridSize=42E5}a.prototype.getOrigin=function(b){var c=this._origins.get(this.ROOT_ORIGIN_ID);if(null==c){if(l.isSome(a.testOrigin)){var d=a.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,q.fromValues(d[0],d[1],d[2],this.ROOT_ORIGIN_ID));return this.getOrigin(b)}d=q.fromValues(b[0]+Math.random()-.5,b[1]+Math.random()-.5,b[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);
this._origins.set(this.ROOT_ORIGIN_ID,d);return d}h.vec3.subtract(u,b,c.vec3);u[0]=Math.abs(u[0]);u[1]=Math.abs(u[1]);u[2]=Math.abs(u[2]);d=this._gridSize;if(u[0]<d&&u[1]<d&&u[2]<d)return c;var c=Math.round(b[0]/d),e=Math.round(b[1]/d);b=Math.round(b[2]/d);var f="rg_"+c+"/"+e+"/"+b,g=this._origins.get(f);g||(g=q.fromValues(c*d,e*d,b*d,f),this._origins.set(f,g));return g};a.prototype._drawOriginBox=function(a){var b=window.view,h=b._stage;if(null==this._object){this._material=new t({width:2,color:[0,
1,0,1]},"GridLocalOriginMaterial");h.add(3,this._material);var k=new c("GridLocalOrigin",{isPickable:!1});h.add(0,k);this._object=new p({idHint:"GridLocalOrigin",castShadow:!1});h.add(1,this._object);k.addObject(this._object);h.addToViewContent([k.id])}for(var m=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=m.length,q=new Float32Array(3*l),k=new Uint32Array(2*(l-1)),n=.5*this._gridSize,u=0;u<l;u++)q[3*u+0]=a[0]+(m[u]&1?n:-n),q[3*u+1]=a[1]+(m[u]&2?n:-n),q[3*u+2]=a[2]+(m[u]&4?n:-n),0<u&&(k[2*u+0]=u-1,k[2*
u+1]=u);e.bufferToBuffer(q,g.WebMercator,0,q,b.spatialReference,0,l);b={};b[r.VertexAttrConstants.POSITION]={size:3,data:q};q={};q[r.VertexAttrConstants.POSITION]=k;k=new f.GeometryData(b,q,void 0,"line");k=new d(k,"GridLocalOriginBox");h.add(2,k);this._object.addGeometry(k,this._material,w);console.log(this._origins.size,a)};return a}();var w=k.mat4f64.create(),u=a.vec3f64.create();(n||(n={})).testOrigin=null;return n})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/Handles ../../../../core/maybe ../../../../core/TimeProfiler ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../support/debugFlags ./BoundingInfo ./depthRange ./depthRangeUtils ./FxaaRenderPass ./HighlightHelper ./OffscreenRenderingHelper ./RenderContext ./RenderPluginManager ./renderStats ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./Util ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../materials/internal/waterMaterialUtils ../../../webgl/Profiling ../../../webgl/Texture".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q){function J(a,b){for(var c=new Map,d=null,e=null,f=function(a){if(a===d)return e;var b=c.get(a);b||(b={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1},c.set(a,b));d=a;return e=b},g=0;g<a.numToAdd;g++){var h=a.toAdd[g];if(1<=N(h.data)){var k=f(h.material);k.toAdd.push(h)}}for(g=0;g<a.numToRemove;g++)h=a.toRemove[g],1<=N(h.data)&&(k=f(h.material),k.toRemove.push(h));for(g=h=0;g<a.numToUpdate;g++){var m=a.toUpdate[g];
1<=N(m.renderGeometry.data)&&(k=f(m.renderGeometry.material),k.toUpdate.push(m),h|=m.updateType)}b&&(b.updateTypes=h);return c}function N(a){return!1===a.preinterleaved?z.getFirstObjectValue(a.indices).length:a.indexCount}function L(a,b){return a.isVisible()&&a.isVisibleInPass(b.pass)&&0!==(a.renderOccluded&b.renderOccludedMask)}n=function(){function b(b,c,d,f,g,h,k){var n=this;this.requestRender=h;this._materialRenderers=new Map;this._orderedMaterialRenderers=[];this._hasHighlights=!1;this._lighting=
new C.SceneLighting;this._content=new Map;this._isRendering=!1;this._fallbackDepthStencilTexture=null;this._stats={scene:new w.RenderStatsAggregator,draped:new w.RenderStatsAggregator};this._edgeView=null;this._handles=new l;this.renderOptions={antialiasing:"smaa"};this.renderHiddenTransparentEdges=function(){};this._programRep=b;this._materialRep=c;this._rctx=f;this._mode=g;this._stage=k;this._fxaaPass=new q(f);this._smaaPass=new m(f);this._bindParameters={view:null,proj:null,viewInvTransp:null,
fovY:0,nearFar:null,viewport:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null};this._offscreenRendering=new r(b,this._rctx);this._sliceHelper=new y;"scene"===this._mode&&(this._shadowMap=new u(this._rctx),this._ssaoHelper=new v(b,this._rctx,function(){return n.requestRender()}),this._highlightHelper=new p(b,this._rctx));this._renderPlugins=new x.RenderPluginManager({rctx:f,programRep:b,textureRep:d,materialRep:c,requestRender:this.requestRender});this._renderContext=
new t(f,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper);this._handles.add(a.init(e,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",function(a){n.renderHiddenTransparentEdges=a?function(){return n.renderEdges(1)}:function(){};n.requestRender()}))}b.prototype.dispose=function(){this._handles.destroy();this._materialRenderers.forEach(function(a){a.dispose()});this._orderedMaterialRenderers=this._materialRenderers=null;this._edgeView&&(this._edgeView.destroy(),this._edgeView=
null);this._offscreenRendering.enabled=!1;this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null);this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose());this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose());this._highlightHelper&&(this._highlightHelper.enabled=!1);d.tmpIndices.prune();this._content.clear();this._content=null};Object.defineProperty(b.prototype,"updating",{get:function(){return"smaa"===
this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources||K.waterTextureRepo.loading()},enumerable:!0,configurable:!0});b.prototype.ensureEdgeView=function(){var a=this;null==this._edgeView&&(this._edgeView=new B.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){return a.requestRender()}}),this._edgeView.initialize());return this._edgeView};Object.defineProperty(b.prototype,"edgeView",{get:function(){return this._edgeView},enumerable:!0,configurable:!0});b.prototype.setLighting=
function(a){this._lighting.set(a)};b.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._shadowMap.enabled&&(this._shadowMap.textureResolution=a.shadowMapResolution);void 0!==a.shadowMap&&(this._shadowMap.enabled=a.shadowMap);void 0!==a.shadowMapMaxCascades&&(this._shadowMap.maxCascades=a.shadowMapMaxCascades);this._highlightHelper.enabled=!0;void 0!==a.ssao&&(this._ssaoHelper.enabled=a.ssao);void 0!==a.ssaoAttenuation&&(this._ssaoHelper.attenuation=a.ssaoAttenuation);
void 0!==a.ssaoRadius&&(this._ssaoHelper.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&(this._ssaoHelper.samples=a.ssaoSamples);a.background&&(this._offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this.renderOptions.antialiasing=a.antialiasingEnabled?"smaa":"none");void 0!==a.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(a.defaultHighlightOptions);
void 0!==a.slicePlane&&(this._sliceHelper.plane=a.slicePlane);this.requestRender()};Object.defineProperty(b.prototype,"hasSlicePlane",{get:function(){return!!this._sliceHelper.plane},enumerable:!0,configurable:!0});b.prototype.getRenderParams=function(){var a={};this._shadowMap&&(a.shadowMap=this._shadowMap.enabled,a.shadowMapResolution=this._shadowMap.textureResolution,a.shadowMapMaxCascades=this._shadowMap.maxCascades);this._ssaoHelper&&this._ssaoHelper.isSupported&&(a.ssao=this._ssaoHelper.enabled,
a.ssaoAttenuation=this._ssaoHelper.attenuation,a.ssaoRadius=this._ssaoHelper.radius,a.ssaoFilterRadius=this._ssaoHelper.filterRadius,a.ssaoSamples=this._ssaoHelper.samples);return a};Object.defineProperty(b.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"canRender",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.getCombinedStats=function(){return{draped:this._stats.draped.getAggregatedStats(),
scene:this._stats.scene.getAggregatedStats()}};b.prototype.getFramebufferTexture=function(a){switch(a){case "color":return this._offscreenRendering.colorTexture;case "hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();case "linearDepth":return this._offscreenRendering.linearDepthTexture;case "normals":return this._offscreenRendering.normalTexture;case "highlight":return this._offscreenRendering.highlightTexture}return null};
Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasWater",{get:function(){return this._orderedMaterialRenderers.some(function(a){return a.hasWater()})},enumerable:!0,configurable:!0});b.prototype.isEmpty=function(){return 0===this._materialRenderers.size};b.prototype.modify=function(a,b,c,d,e,f,g){var h=this;void 0===b&&(b=a?a.length:0);void 0===d&&(d=c?c.length:0);void 0===f&&(f=e?e.length:
0);this._isRendering&&console.warn("Renderer.modify called while rendering");for(var k=0;k<d;++k)this._content.delete(c[k].uniqueName);for(k=0;k<b;++k)this._content.set(a[k].uniqueName,a[k]);if(b||d||f){var m=!1;J({toAdd:a,numToAdd:b,toRemove:c,numToRemove:d,toUpdate:e,numToUpdate:f}).forEach(function(a,b){var c=h._materialRenderers.get(b);!c&&0<a.toAdd.length&&(c=b.createRenderer(h._rctx,h._materialRep),h._materialRenderers.set(b,c),h._orderedMaterialRenderers.push(c),h.sortOrderedMaterialRenderers());
c&&(c.modify(a),c.isEmpty&&(m=!0))});m&&this._materialRenderers.forEach(function(a,b){a.isEmpty&&(h._materialRenderers.delete(b),h._orderedMaterialRenderers.splice(h._orderedMaterialRenderers.indexOf(a),1),a.dispose())});var l=!1;this._materialRenderers.forEach(function(a){l=l||a.hasHighlights});if(l!==this._hasHighlights){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(l);this._hasHighlights=l}this.requestRender()}g&&(g.forEach(function(a){h._materialRep.updateMaterialParameters(a)}),
this.requestRender())};b.prototype.modifyRenderOrder=function(a){"draped"===this._mode&&(this.sortOrderedMaterialRenderers(),this.requestRender())};b.prototype.updateLogic=function(a){var b=!1;this._orderedMaterialRenderers.forEach(function(c){c.updateLogic&&(b=c.updateLogic(a)||b)});return b};b.prototype.render=function(a){switch(this._mode){case "scene":this.renderScene(a);break;case "draped":this.renderDraped(a)}if(this.onPostRender)this.onPostRender()};b.prototype.renderPass=function(a,b){this.renderGeometryPass(a,
b)};b.prototype.renderScene=function(a){var b=this;this._isRendering=!0;var c=this._rctx,d=this._offscreenRendering,e=a.camera,f=a.fbo,g=this._sliceHelper.plane;a.disableSlice&&(this._sliceHelper.plane=null);this._renderPlugins.prepareRender(e);this.renderShadowMap(a);d.enabled=!0;d.initializeFrame(e,f);this.renderLinearDepth(a);this.renderNormal(a);this._ssaoHelper.enabled&&this._ssaoHelper.computeSSAO(e,d.linearDepthTexture,d.normalTexture);this._ssaoHelper.bindAll(this._programRep);this._stats.scene.reset();
this.updateGlobalUniforms(e.projectionMatrix);this._renderContext.pass=0;this._renderContext.camera=e;this._renderContext.options=this.renderOptions;d.bindTarget(d.mainColor,d.mainDepth);this._renderPlugins.render(0,this._renderContext);this.renderOpaqueGeometry(this._renderContext);this.renderEdges(2);this.renderHiddenTransparentEdges();this.renderTransparentGeometry(this._renderContext);this.renderEdges(1);var h=e=!1,e=this.renderHUDVisibility(this._renderContext);this.renderInternalSlot(18,this._renderContext);
(h=this.renderTransparentTerrain(this._renderContext))&&e&&(d.compositeTransparentTerrainOntoHUDVisibility(),d.renderToTargets(function(){return b.renderHUD("occluded")},d.mainColor,d.tmpDepth,void 0,!0));h&&d.compositeTransparentTerrainOntoMain();d.renderToTargets(function(){b.renderInternalSlot(10,b._renderContext);b._renderPlugins.render(14,b._renderContext);b._renderPlugins.render(15,b._renderContext)},d.mainColor,d.mainDepth);this.renderOccluded();this.renderAntiAliasing(f);c.bindFramebuffer(f);
c.clearSafe(256);this.renderHUD("notOccluded");this.renderHighlights(a,f);this._sliceHelper.plane=g;this._isRendering=!1};b.prototype.renderEdges=function(a){var b=this,c=this._edgeView;c&&c.shouldRender()&&this._offscreenRendering.renderAndComposite(function(){return c.render(b._bindParameters,a)},"alpha")};b.prototype.renderDraped=function(a){this._stats.draped.reset();this.renderGeometryPass(0,a)};b.prototype.renderShadowMap=function(a){var b=this._shadowMap,c=a.camera,d=a.fbo,f=a.lightDirection;
if(b.enabled){e.ENABLE_PROFILE_DEPTH_RANGE&&h.begin("depthRange");var g=this.computeDepthRange(c);e.ENABLE_PROFILE_DEPTH_RANGE&&h.end("depthRange");b.prepare(c,f,g);f=b.getCascades();for(g=0;g<f.length;++g){var k=f[g];k.camera.setGLViewport(this._rctx);a.camera=k.camera;this.renderGeometryPass(3,a)}a.camera=c;b.finish(d);c.setGLViewport(this._rctx)}b.bindAll(this._programRep)};b.prototype.renderLinearDepth=function(a){var b=this;this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth()?this._offscreenRendering.renderToTargets(function(){b.renderGeometryPass(1,
a)},this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth)};b.prototype.renderNormal=function(a){var b=this;this._ssaoHelper.enabled?this._offscreenRendering.renderToTargets(function(){b.renderGeometryPass(2,a)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};b.prototype.computeDepthRange=
function(a){var b=c.depthRangeFromScene(a,this._content,this._stage.getLayers());f.union(b,this.renderPlugins.queryDepthRange(a));b.near=Math.max(a.near,b.near);b.far=Math.min(a.far,b.far);return b};b.prototype.renderGeometryPass=function(a,b){this._isRendering=!0;b=b.camera;this.updateGlobalUniforms(b.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=b;"draped"===this._mode?this.renderGeometryPassDraped(this._renderContext):this.renderGeometryPassScene(this._renderContext);
this._isRendering=!1};b.prototype.renderGeometryPassDraped=function(a){var b=this,c=a.camera;this._bindParameters.view=c.viewMatrix;this._bindParameters.proj=c.projectionMatrix;this._bindParameters.viewInvTransp=c.viewInverseTransposeMatrix;M[0]=c.near;M[1]=c.far;this._bindParameters.nearFar=M;this._bindParameters.viewport=c.fullViewport;this._bindParameters.pixelRatio=c.pixelRatio;this._bindParameters.slicePlane=a.sliceHelper&&a.sliceHelper.plane;this._bindParameters.highlightDepthTexture=this.getFallbackDepthTexture();
this._orderedMaterialRenderers.forEach(function(c){var d=b._stats.draped.getMaterialRenderStatsObject(c.type);c.render(null,a,b._bindParameters,d)})};b.prototype.renderGeometryPassScene=function(a){this.renderGeometry(a);this.renderTransparentTerrain(a)};b.prototype.renderGeometry=function(a){this.renderOpaqueGeometry(a);this.renderTransparentGeometry(a)};b.prototype.renderOpaqueGeometry=function(a){this._renderPlugins.render(1,a);this.renderInternalSlot(2,a);this.renderInternalSlot(3,a);this._renderPlugins.render(4,
a);this.renderInternalSlot(5,a);this._renderPlugins.render(6,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._renderPlugins.render(13,this._renderContext)};b.prototype.renderTransparentGeometry=function(a){this.renderInternalSlot(7,a);this._renderPlugins.render(8,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep)};b.prototype.renderTransparentTerrain=function(a){return this._renderPlugins.render(9,a)};b.prototype.renderHUDVisibility=function(a){var b=this,c=D.shouldRenderVisibilityDuringRenderPass(a.pass),
d=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.enabled,e=!1;c&&d&&a.offscreenRenderingHelper.renderHUDVisibility(function(){e=b.renderInternalSlot(11,a)});return e};b.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this.renderInternalSlot(19,this._renderContext);this.renderInternalSlot(16,this._renderContext);this.renderInternalSlot(17,this._renderContext)};b.prototype.renderHighlights=function(a,b){var c=this,d=this._highlightHelper;if(d&&d.enabled&&
(this.hasHighlights||this._renderPlugins.needsHighlight())){var e=null;d.profilingCallback&&(e=I.startMeasurement(this._renderContext.rctx));var f=this._offscreenRendering;this._renderContext.highlightDepthTexture=this._bindParameters.highlightDepthTexture;f=f.renderToTargets(function(){c.renderGeometryPass(4,a);c._rctx.clearSafe(256);c.renderHUD("both")},f.highlight,f.tmpDepth,[0,0,0,0],!0);d.render(a.camera,f,b);null!==e&&d.profilingCallback&&e.stop(function(a){d.profilingCallback&&d.profilingCallback(a)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};
b.prototype.renderOccluded=function(){var a=this;this._materialRenderers.forEach(function(a,b){b&&b.isVisible()&&1!==b.renderOccluded&&R.push(b)});if(0!==R.length){var b=this._offscreenRendering,c=this._renderContext,d=function(d,e){c.renderOccludedMask=e;b.renderToTargets(function(){a.renderInternalSlot(5,c,R);a.renderInternalSlot(7,c,R);a.renderInternalSlot(10,c,R)},b.tmpColor,b.tmpDepth,[0,0,0,0],!0);c.resetRenderOccludedMask();b.compositeOccludedOntoMain(d)};c.pass=0;d(.4,4);d(.5,2);d(1,8);R.length=
0}};b.prototype.renderAntiAliasing=function(a){var b=this;switch(this.renderOptions.antialiasing){case "smaa":this._smaaPass.loadResources(function(){return b.requestRender()});this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:this._offscreenRendering.colorTexture},a)):this._offscreenRendering.composite();break;case "fxaa":this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:this._offscreenRendering.colorTexture},a)):this._offscreenRendering.composite();
break;default:this._offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()}};b.prototype.renderInternalSlot=function(a,b,c){this._bindParameters.view=b.camera.viewMatrix;this._bindParameters.proj=b.camera.projectionMatrix;this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;M[0]=b.camera.near;M[1]=b.camera.far;var d=this._renderContext.offscreenRenderingHelper;
this._bindParameters.nearFar=M;this._bindParameters.viewport=b.camera.fullViewport;this._bindParameters.shadowMap=b.shadowMap;this._bindParameters.shadowMappingEnabled=!!b.shadowMap&&b.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!b.ssaoHelper&&b.ssaoHelper.enabled;this._bindParameters.pixelRatio=b.camera.pixelRatio;this._bindParameters.slicePlane=b.sliceHelper&&b.sliceHelper.plane;this._bindParameters.hudVisibilityTexture=d?d.hudVisibilityTexture:null;this._bindParameters.highlightDepthTexture=
d&&d.depthTexture||this.getFallbackDepthTexture();return this.renderInternalSlotMaterials(a,b,c)};b.prototype.renderInternalSlotMaterials=function(a,b,c){var d=this,e=0===b.pass?this._stats.scene:null,f=!1;k.isSome(c)?c.forEach(function(c){L(c,b)&&(f=d._materialRenderers.get(c).render(a,b,d._bindParameters)||f)}):this._materialRenderers.forEach(function(c,g){L(g,b)&&(g=e?e.getMaterialRenderStatsObject(c.type):null,f=c.render(a,b,d._bindParameters,g)||f)});return f};b.prototype.updateGlobalUniforms=
function(a){for(var b=this._programRep.getProgramsUsingUniform("proj"),c=0;c<b.length;c++)b[c].setUniformMatrix4fv("proj",a);if(this._lighting){b=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c]);b=this._programRep.getProgramsUsingUniform("lightDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c])}};b.prototype.sortOrderedMaterialRenderers=function(){"draped"===this._mode&&this._orderedMaterialRenderers.sort(function(a,
b){return b.renderPriority()-a.renderPriority()})};b.prototype.getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new Q(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};b.prototype.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:this._highlightHelper?
this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}};b.prototype.forEachRenderGeometry=function(a){this._content.forEach(function(b,c){a(b)})};Object.defineProperty(b.prototype,"test",{get:function(){return{orderedMaterialRenderers:this._orderedMaterialRenderers}},enumerable:!0,configurable:!0});return b}();var M=g.vec2f64.create(),R=[];return n})},"esri/core/TimeProfiler":function(){define(["require",
"exports"],function(n,b){n=function(){function b(b,h){void 0===h&&(h=.9);this._alpha=.9;this._name=b;this._alpha=h;this.reset()}b.prototype.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(b.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"average",{get:function(){return 0<
this._count?this._sum/this._count:0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});b.prototype.begin=function(){this._startTime=performance.now()};b.prototype.end=function(){var b=performance.now()-
this._startTime;this._count+=1;this._sum+=b;this._smooth=this._alpha*b+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,b);this._max=Math.max(this._max,b)};b.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return b}();(function(b){function k(e){e in a||(a[e]=new b(e));return a[e]}function h(a){console.log(k(a).toJSON())}var a={},g={};b.get=k;b.begin=function(a){k(a).begin()};b.end=function(a,b){void 0===
b&&(b=!0);k(a).end();var d=performance.now();!b||a in g&&!(d>=g[a]+1E3)||(h(a),g[a]=d)};b.log=h;b.logAll=function(){for(var b in a)h(b)}})(n||(n={}));return n})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(n,b){function l(b,a){return{near:b,far:a}}function k(b,a,g){b.near=a;b.far=g;return b}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.empty=function(b){return b?k(b,Infinity,-Infinity):l(Infinity,-Infinity)};b.set=k;b.union=function(b,
a,g){void 0===g&&(g=b);g.near=Math.min(b.near,a.near);g.far=Math.max(b.far,a.far);return g}})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ./ComponentUtils ./depthRange ./Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(a,b){if(b.isVisible){var c=p.empty(),d=b.getObjects();b.getSpatialQueryAccelerator()?x(c,a,b.getSpatialQueryAccelerator()):w(c,a,d);return c}}function x(a,b,c){var d=b.eye,e=b.viewForward,f=b.frustum,g=function(a){return!a.areAllComponentsHidden()},h=c.objectCount;500>h?(p.set(D,b.near,Math.min(a.near,b.far)),c.forEachInDepthRange(d,e,"front-to-back",D,function(c,d){u(a,b,c);D.far=a.near;d.setRange(D)},f,g),p.set(D,Math.max(a.far,b.near),b.far),c.forEachInDepthRange(d,
e,"back-to-front",D,function(c,d){u(a,b,c);D.near=a.far;d.setRange(D)},f,g)):(h=Math.max(Math.min(h,500),Math.ceil(.1*h)),d=c.findClosest(e,"front-to-back",f,g,h),c=c.findClosest(e,"back-to-front",f,g,h),d&&c&&(m(a,b,d.getCenter(),d.getBSRadius()),m(a,b,c.getCenter(),c.getBSRadius())))}function w(a,b,c){K.clear();c.forEach(function(a){a.areAllComponentsHidden()||K.add(a)});K.empty||(K.sort(b),p.set(D,b.near,Math.min(a.near,b.far)),K.forEachInDepthRange(D,"front-to-back",function(c,d,e){d<a.near&&
u(a,b,c)}),p.set(D,Math.max(a.far,b.near),b.far),K.forEachInDepthRange(D,"back-to-front",function(b,c,d){a.far=Math.max(a.far,d)}))}function u(a,b,d){if(!d.areAllComponentsHidden()&&f.frustum.intersectsSphere(b.frustum.planes,f.sphere.wrap(d.getBSRadius(),d.getCenter()))){var e=d.objectTransformation,g=C;d.geometryRecords.forEach(function(d){k.mat4.multiply(g,e,d.getShaderTransformation());var f=c.maxScale(g);y(a,b,d.geometry.boundingInfo,g,f)})}}function y(b,c,d,e,g){var h=c.eye,k=c.viewForward;
a.vec3.transformMat4(B,d.center,e);h=k[0]*(B[0]-h[0])+k[1]*(B[1]-h[1])+k[2]*(B[2]-h[2]);k=d.bsRadius*g;if(!(h-k>b.near&&h+k<b.far)&&f.frustum.intersectsSphere(c.frustum.planes,f.sphere.wrap(k,B)))if(100<d.bsRadius&&d.getChildren())for(d=d.getChildren(),h=0;8>h;++h)d[h]&&y(b,c,d[h],e,g);else Q.unionDepthRangeWithAABB(b,c.viewProjectionMatrix,e,d.bbMin,d.bbMax)}function m(a,b,c,d){var e=b.eye;b=b.viewForward;c=(c[0]-e[0])*b[0]+(c[1]-e[1])*b[1]+(c[2]-e[2])*b[2];a.near=Math.min(a.near,c-d);a.far=Math.max(a.far,
c+d)}Object.defineProperty(b,"__esModule",{value:!0});b.depthRangeFromScene=function(a,b,c){if(1E4>b.size)return I.compute(a,b);var d=p.empty();c.forEach(function(b){b.isVisible&&p.union(d,t(a,b))});return d};b.depthRangeFromLayer=t;n=function(){function a(){this._items=new l({allocator:function(a){return a||{obj:null,distance:0,near:0,far:0}},deallocator:function(a){a.obj=null;a.distance=0;a.near=0;a.far=0;return a}})}Object.defineProperty(a.prototype,"length",{get:function(){return this._items.length},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._items.clear()};a.prototype.add=function(a){this._items.pushNew().obj=a};a.prototype.sort=function(a){var b=a.eye,c=a.viewForward;this._items.forEach(function(a){var d=a.obj,e=d.getCenter(),d=d.getBSRadius(),e=(e[0]-b[0])*c[0]+(e[1]-b[1])*c[1]+(e[2]-b[2])*c[2];a.distance=e;a.near=e-d;a.far=e+d});this._items.sort(function(a,
b){return a.distance-b.distance})};a.prototype.forEachInDepthRange=function(a,b,c){if("front-to-back"===b)for(b=0;b<this._items.length;++b){var d=this._items.data[b];d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)}else for(b=this._items.length-1;0<=b;--b)d=this._items.data[b],d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)};return a}();var v=function(){function b(){this.view=h.mat4f64.create();this.viewProj=h.mat4f64.create();this.frustum=f.frustum.create();this.geometries=[];this.near=[];this.far=
[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}b.prototype.compute=function(a,b){var c=this;this.reset();k.mat4.copy(this.view,a.viewMatrix);k.mat4.multiply(this.viewProj,a.projectionMatrix,this.view);f.frustum.copy(a.frustum,this.frustum);a=this.view;var d=a[2],e=a[6],g=a[10],h=a[14];a=this.range;var m=0;b.forEach(function(a){if(!q.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)&&a.castShadow){var b,f;a.hasShaderTransformation?
(b=a.getBoundingSphere(a.getShaderTransformation(),1,B),f=B):(b=a.bsRadius,f=a.center);f=d*f[0]+e*f[1]+g*f[2]+h;c.geometries[m]=a;c.near[m]=-(f+b);c.far[m]=-(f-b);++m}});if(0===this.geometries.length)return a;for(b=0;b<this.geometries.length;++b)this.near[b]>a.far&&(a.far=this.near[b]),2<this.near[b]&&this.far[b]<a.near&&(a.near=this.far[b]);var l=this.looseRange;l.near=Math.max(.5*a.near,2);l.far=2*a.far;var p=0,n=0;for(b=0;b<this.geometries.length;++b)this.near[b]<a.near&&(this.near[b]>=l.near?
a.near=this.near[b]:this.nearCandidates[p++]=b),this.far[b]>a.far&&(this.far[b]<=l.far?a.far=this.far[b]:this.farCandidates[n++]=b);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return a;this.nearCandidates.sort(function(a,b){return c.near[a]<c.near[b]?-1:c.near[a]>c.near[b]?1:0});this.farCandidates.sort(function(a,b){return c.far[a]<c.far[b]?1:c.far[a]>c.far[b]?-1:0});for(b=0;b<this.nearCandidates.length;++b)l=this.nearCandidates[b],this.near[l]<a.near&&(l=this.geometries[l],p=
l.boundingInfo,this.includeNearBoundingInfoRec(p,l.getShaderTransformation()));for(b=0;b<this.farCandidates.length;++b)l=this.farCandidates[b],this.far[l]>a.far&&(l=this.geometries[l],p=l.boundingInfo,this.includeFarBoundingInfoRec(p,l.getShaderTransformation()));return a};b.prototype.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};b.prototype.includeNearBoundingInfoRec=
function(b,d){var e=b.getBSRadius(),f=b.getCenter();a.vec3.transformMat4(B,f,d);var g=c.maxScale(d),f=B[0],h=B[1],k=B[2],e=e*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*h+g[0][2]*k+g[0][3]>e||g[1][0]*f+g[1][1]*h+g[1][2]*k+g[1][3]>e||g[2][0]*f+g[2][1]*h+g[2][2]*k+g[2][3]>e||g[3][0]*f+g[3][1]*h+g[3][2]*k+g[3][3]>e||(f=this.view[2]*f+this.view[6]*h+this.view[10]*k+this.view[14],h=f+e,2>-(f-e)||-h>=this.range.near)))if(-h>this.looseRange.near)this.range.near=-h;else{if(100<e&&(e=b.getChildren(),void 0!==
e)){for(b=0;8>b;++b)void 0!==e[b]&&this.includeNearBoundingInfoRec(e[b],d);return}Q.unionDepthRangeWithAABB(this.range,this.viewProj,d,b.getBBMin(),b.getBBMax())}};b.prototype.includeFarBoundingInfoRec=function(b,d){var e=b.getBSRadius(),f=b.getCenter();a.vec3.transformMat4(B,f,d);var g=c.maxScale(d),f=B[0],h=B[1],k=B[2],e=e*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*h+g[0][2]*k+g[0][3]>e||g[1][0]*f+g[1][1]*h+g[1][2]*k+g[1][3]>e||g[2][0]*f+g[2][1]*h+g[2][2]*k+g[2][3]>e||g[3][0]*f+g[3][1]*h+g[3][2]*
k+g[3][3]>e||(f=this.view[2]*f+this.view[6]*h+this.view[10]*k+this.view[14]-e,-f<=this.range.far)))if(-f<this.looseRange.far)this.range.far=-f;else{if(100<e&&(e=b.getChildren(),void 0!==e)){for(b=0;8>b;++b)void 0!==e[b]&&this.includeFarBoundingInfoRec(e[b],d);return}Q.unionDepthRangeWithAABB(this.range,this.viewProj,d,b.getBBMin(),b.getBBMax())}};return b}();b.DepthRangeFromRenderGeometries=v;b=function(){function a(){this.modelViewProj=h.mat4f64.create();this.clipPosition=[d.vec4f64.create(),d.vec4f64.create(),
d.vec4f64.create(),d.vec4f64.create(),d.vec4f64.create(),d.vec4f64.create(),d.vec4f64.create(),d.vec4f64.create()]}a.prototype.unionDepthRangeWithAABB=function(a,b,c,d,e){var f=this.modelViewProj;k.mat4.multiply(f,b,c);b=!1;for(c=0;8>c;++c){var g=this.clipPosition[c],h=0===c||3===c||4===c||7===c?d[0]:e[0],m=0===c||1===c||4===c||5===c?d[1]:e[1],l=4>c?d[2]:e[2];g[0]=f[0]*h+f[4]*m+f[8]*l+f[12];g[1]=f[1]*h+f[5]*m+f[9]*l+f[13];g[2]=f[2]*h+f[6]*m+f[10]*l+f[14];g[3]=f[3]*h+f[7]*m+f[11]*l+f[15]}for(c=0;12>
c;++c){d=this.clipTriangle(this.clipPosition[z[c][0]],this.clipPosition[z[c][1]],this.clipPosition[z[c][2]]);e=!0;for(f=0;f<d.length;++f)if(g=d[f][3],2<=g){e=!1;break}if(!e)for(b=!0,f=0;f<d.length;++f)g=d[f][3],g<a.near&&(a.near=g),g>a.far&&(a.far=g)}return b};a.prototype.inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];r.assert(!1)};a.prototype.intersect=function(a,b,c){var f=0;0===c?f=(-a[3]-a[0])/(b[0]-a[0]+b[3]-
a[3]):1===c?f=(-a[3]-a[1])/(b[1]-a[1]+b[3]-a[3]):2===c?f=(a[3]-a[0])/(b[0]-a[0]-b[3]+a[3]):3===c&&(f=(a[3]-a[1])/(b[1]-a[1]-b[3]+a[3]));return e.vec4.lerp(d.vec4f64.create(),a,b,f)};a.prototype.clipTriangle=function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var d=0;d<c.length;++d){var e=c[d],f=c[(d+1)%c.length];this.inside(f,b)?(this.inside(e,b)||a.push(this.intersect(e,f,b)),a.push(f)):this.inside(e,b)&&a.push(this.intersect(e,f,b))}}return a};return a}();var z=[[0,1,3],[2,3,1],[1,5,2],[6,2,
5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],B=g.vec3f64.create(),C=h.mat4f64.create(),D=p.empty(),K=new n,I=new v,Q=new b})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define("require exports ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/VertexArrayObject".split(" "),function(n,b,l,k,h,a){return function(){function b(a){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",
count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.enable=function(){if(this.isEnabled)return!0;var b=this.rctx;this.program=new k(b,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);this.pipelineState=h.makePipelineState({colorWrite:h.defaultColorWriteParams});var d=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new a(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new l(b,34962,35044,d)});return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var d=this.rctx;d.bindVAO(this.vao);
d.bindFramebuffer(b);var c=0,e=0;null!=b?(c=b.descriptor.width,e=b.descriptor.height):(c=d.gl.canvas.width,e=d.gl.canvas.height);d.bindProgram(this.program);d.setPipelineState(this.pipelineState);d.bindTexture(a.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/c,1/e);d.drawArrays(4,0,3)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/HighlightPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){return function(){function b(a,b){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=b;this.viewportToRestore=h.vec4f64.create();this.defaultOptions={color:k.vec4f32.fromValues(1,0,1,1),haloColor:k.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};this.blurProgram=
a.getProgram(c.blurPass,{gaussianSamples:5});this.blurGridProgram=a.getProgram(c.blurPass,{gaussianSamples:5,gridOptimization:!0});this.applyProgram=a.getProgram(c.applyPass);this.applyGridProgram=a.getProgram(c.applyPass,{gridOptimization:!0});this.applyGridDebugProgram=a.getProgram(c.applyPass,{gridOptimization:!0,gridDebug:!0});this.downsampleProgram=a.getProgram(c.downsamplePass);this.preprocessPipelineState=r.makePipelineState({colorWrite:r.defaultColorWriteParams});this.applyPipelineState=r.makePipelineState({blending:r.separateBlendingParams(770,
1,771,771),colorWrite:r.defaultColorWriteParams})}Object.defineProperty(b.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"profilingCallback",{get:function(){return a.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});b.prototype.setDefaultOptions=function(a){this.defaultOptions=a};b.prototype.render=function(b,c,d){var e=
b.pixelRatio,g=!a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,h=a.HIGHLIGHTS_VISUALIZE_BLOCKS,k=this._rctx;f.assert(this.enabled);l.vec4.copy(this.viewportToRestore,b.fullViewport);var m=Math.ceil(b.fullWidth/e);b=Math.ceil(b.fullHeight/e);this.blur0Fbo.resize(m,b);this.blur1Fbo.resize(m,b);k.bindVAO(this.quadVAO);k.setPipelineState(this.preprocessPipelineState);var p=null,q=e=p=null;if(g){var n=this._grid;this._gridUpdateResources(c,32);this._gridComputeMipmap();e=n.vao;q=4;p=this.blurGridProgram;k.bindProgram(p);
k.bindTexture(n.coverageMipmap[n.mipmapLevels].colorTexture,1);p.setUniform1i("coverageTex",1)}else e=this.quadVAO,q=5,p=this.blurProgram,k.bindProgram(p);k.bindVAO(e);k.bindFramebuffer(this.blur0Fbo);k.setViewport(0,0,m,b);k.setClearColor(0,0,0,0);k.clear(16384);p.setUniform1i("tex",0);k.bindTexture(c.colorTexture,0);p.setUniform2f("blurSize",1/m,0);k.drawArrays(q,0,t.vertexCount(e,"geometry"));k.bindFramebuffer(this.blur1Fbo);k.clear(16384);k.bindTexture(this.blur0Fbo.colorTexture,0);p.setUniform2f("blurSize",
0,1/b);k.drawArrays(q,0,t.vertexCount(e,"geometry"));k.bindFramebuffer(d);k.setPipelineState(this.applyPipelineState);k.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);g?(p=h?this.applyGridDebugProgram:this.applyGridProgram,k.bindProgram(p),p.setUniform1i("coverageTex",2),k.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(p=this.applyProgram,k.bindProgram(p));p.setUniform1i("tex",0);k.bindTexture(this.blur1Fbo.colorTexture,
0);p.setUniform1i("origin",1);k.bindTexture(c.colorTexture,1);p.setUniform4fv("color",this.defaultOptions.color);p.setUniform4fv("haloColor",this.defaultOptions.haloColor);p.setUniform1f("outlineSize",8.6);p.setUniform1f("blurSize",.4);p.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);k.drawArrays(q,0,t.vertexCount(e,"geometry"));k.bindVAO(null)};b.prototype.enable=function(){if(!this.enabled){this.quadVAO=
d.createQuadVAO(this._rctx);var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=p.createWithAttachments(this._rctx,b,a);this.blur1Fbo=p.createWithAttachments(this._rctx,b,a)}};b.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};b.prototype._gridUpdateResources=function(a,
b){var c=this._rctx,d=this._grid,f=!1;null===d.coverageMipmap&&(d.coverageMipmap=[a],f=!0);if(d.viewportWidth!==a.width||d.viewportHeight!==a.height)f=!0,d.viewportWidth=a.width,d.viewportHeight=a.height;d.coverageMipmap[0]=a;d.cellPixelSize!==b&&(d.cellPixelSize=b,f=!0);if(f){for(b=1;b<d.coverageMipmap.length;b++)d.coverageMipmap[b].dispose();d.mipmapLevels=Math.ceil(Math.log(d.cellPixelSize)*Math.LOG2E);d.coverageMipmap.length=d.mipmapLevels+1;for(b=0;b<d.mipmapLevels;b++)f=d.coverageMipmap[b],
f=p.createWithAttachments(c,{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(f.width/2),height:Math.ceil(f.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(f.width/2),height:Math.ceil(f.height/2)}),d.coverageMipmap[b+1]=f}var f=Math.ceil(a.height/d.cellPixelSize),h=Math.ceil(a.width/d.cellPixelSize);if(!d.vao||d.verticalCellCount!==f||d.horizontalCellCount!==h){d.verticalCellCount=f;d.horizontalCellCount=h;a=f+1;b=h+1;for(var f=1/f,h=1/h,
k=new Float32Array(24*a*b),l=0,n=0;n<a;n++)for(var r=0;r<b;r++)k[l+0]=(r-.5)*h*2-1,k[l+1]=(n-.5)*f*2-1,k[l+2]=r*h,k[l+3]=n*f,k[l+4]=(r+.5)*h*2-1,k[l+5]=(n-.5)*f*2-1,k[l+6]=r*h,k[l+7]=n*f,k[l+8]=(r-.5)*h*2-1,k[l+9]=(n+.5)*f*2-1,k[l+10]=r*h,k[l+11]=n*f,k[l+12]=(r-.5)*h*2-1,k[l+13]=(n+.5)*f*2-1,k[l+14]=r*h,k[l+15]=n*f,k[l+16]=(r+.5)*h*2-1,k[l+17]=(n-.5)*f*2-1,k[l+18]=r*h,k[l+19]=n*f,k[l+20]=(r+.5)*h*2-1,k[l+21]=(n+.5)*f*2-1,k[l+22]=r*h,k[l+23]=n*f,l+=24;d.vao&&d.vao.dispose(!0);d.vao=new x(c,g.Default3D,
{geometry:e.Pos2Tex},{geometry:q.createVertex(c,35044,k)})}};b.prototype._gridComputeMipmap=function(){var a=this._rctx,b=this._grid,c=this.downsampleProgram;a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var e=b.coverageMipmap[d+1].width,f=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/e,1/f);a.setViewport(0,0,e,f);a.drawArrays(5,0,t.vertexCount(this.quadVAO,
"geometry"))}};b.prototype.getGpuMemoryUsage=function(){var a=t.getGpuMemoryUsage(this.blur0Fbo)+t.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(var b=0,c=this._grid.coverageMipmap;b<c.length;b++)a+=t.getGpuMemoryUsage(c[b]);return a};return b}()})},"esri/views/3d/webgl-engine/shaders/HighlightPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k,h){Object.defineProperty(b,
"__esModule",{value:!0});var a=function(a){return h.glslifyDefineMap({GRID_OPTIMIZATION:a.gridOptimization,GAUSSIAN_SAMPLES:a.gaussianSamples})},g=function(a){return h.glslifyDefineMap({GRID_OPTIMIZATION:a.gridOptimization,GRID_DEBUG:a.gridDebug})};b.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:k.resolveIncludes("renderer/highlight/downsample.vert"),fragmentShader:k.resolveIncludes("renderer/highlight/downsample.frag")},attributes:l.Default3D};b.blurPass={name:"highlight-blur",
shaders:function(b){return{vertexShader:a(b)+k.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:a(b)+k.resolveIncludes("renderer/highlight/blur.frag")}},attributes:l.Default3D};b.applyPass={name:"highlight-apply",shaders:function(a){return{vertexShader:g(a)+k.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:g(a)+k.resolveIncludes("renderer/highlight/apply.frag")}},attributes:l.Default3D}})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports ./glUtil3D ./RenderTargetHelper ./Util ../shaders/OffscreenPrograms ../../../webgl/renderState ../../../webgl/Util".split(" "),
function(n,b,l,k,h,a,g,e){var d=[0,0,0,0],f=[0,1,0,1];return function(){function b(b,c){this.dimensions={width:4,height:4};this._enabled=!1;this._background={type:"color",color:[0,0,0,1]};this._compositePipelineState=new Map;this._rctx=c;c=this.renderTargetHelper=new k.RenderTargetHelper(c);this.mainColor=c.registerColorTarget({name:"mainColor"});this.mainDepth=c.registerDepthTarget({name:"mainDepth"});this.linearDepth=c.registerColorTarget({name:"linearDepth"});this.normal=c.registerColorTarget({name:"normal"});
this.highlight=c.registerColorTarget({name:"highlight",dataType:32819});this.hudVisibility=c.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=c.registerColorTarget({name:"tmpColor"});this.tmpDepth=c.registerDepthTarget({name:"tmpDepth"});this._compositeProgram=b.getProgram(a.composite);this._compositePipelineState.set("none",g.makePipelineState({colorWrite:g.defaultColorWriteParams}));this._compositePipelineState.set("alpha",g.makePipelineState({blending:g.separateBlendingParams(770,
1,771,771),colorWrite:g.defaultColorWriteParams}));this._compositePipelineState.set("premultiplied-alpha",g.makePipelineState({blending:g.simpleBlendingParams(1,771),colorWrite:g.defaultColorWriteParams}));this._compositeTransparentToHUDVisibilityProgram=b.getProgram(a.compositeTransparentToHUDVisibility);this._compositeTransparentToHUDVisibilityPipelineState=g.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});this._compositeOccludedProgram=b.getProgram(a.compositeOccluded);this._compositeOccludedPipelineState=
g.makePipelineState({blending:g.simpleBlendingParams(1,771),colorWrite:g.defaultColorWriteParams})}Object.defineProperty(b.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"depthTexture",{get:function(){return this.framebuffer.depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"highlightTexture",
{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tmpColorTexture",{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!0,configurable:!0});b.prototype.initializeFrame=function(a,b){h.assert(this.enabled);var c=this._rctx;
this.dimensions.width=a.fullWidth;this.dimensions.height=a.fullHeight;this.outputFramebuffer=b;this.bindTarget(this.mainColor,this.mainDepth);c.setClearStencil(0);a=this._background.color;c.setClearColor(a[0]*a[3],a[1]*a[3],a[2]*a[3],a[3]);c.clearSafe(17664)};b.prototype.renderAndComposite=function(a,b){this.renderToTargets(a,this.tmpColor,this.mainDepth,d);this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,b)};b.prototype.renderHUDVisibility=function(a){this.renderToTargets(a,this.hudVisibility,
this.mainDepth,f)};b.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var a=this,b=this._rctx;this.renderToTargets(function(){var c=a._compositeTransparentToHUDVisibilityProgram;b.bindProgram(c);b.setPipelineState(a._compositeTransparentToHUDVisibilityPipelineState);c.setUniform1i("tex",1);b.bindTexture(a.getColorTexture(a.tmpColor),1);b.bindVAO(a.quadVAO);b.drawArrays(5,0,e.vertexCount(a.quadVAO,"geometry"))},this.hudVisibility,this.mainDepth)};b.prototype.compositeTransparentTerrainOntoMain=
function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")};b.prototype.compositeOccludedOntoMain=function(a){var b=this._rctx,c=this._compositeOccludedProgram;this.bindFramebuffer();b.bindProgram(c);b.setPipelineState(this._compositeOccludedPipelineState);b.bindVAO(this.quadVAO);b.bindTexture(this.getColorTexture(this.tmpColor),0);c.setUniform1i("occludedColorMap",0);c.setUniform1f("opacity",a);b.drawArrays(5,0,e.vertexCount(this.quadVAO,"geometry"));b.bindVAO(null)};
b.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};b.prototype.renderDepthDetached=function(a){var b=this.bindTarget(this.mainColor);a(b);this.bindTarget(this.mainColor,this.mainDepth)};b.prototype.composite=function(a,b,c){void 0===a&&(a=this.framebuffer.colorTexture);void 0===b&&(b=this.outputFramebuffer);void 0===c&&(c="none");var d=this._rctx,f=this._compositeProgram;d.bindFramebuffer(b);d.bindProgram(f);d.setPipelineState(this._compositePipelineState.get(c));
f.setUniform1i("tex",1);d.bindTexture(a,1);d.bindVAO(this.quadVAO);d.drawArrays(5,0,e.vertexCount(this.quadVAO,"geometry"))};b.prototype.disposeTarget=function(a){this.renderTargetHelper.disposeTargetResource(a)};b.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=l.createQuadVAO(this._rctx))};b.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)};b.prototype.renderToTargets=function(a,
b,c,d,e){var f=this._rctx;b=this.bindTarget(b,c);c=0;d&&(f.setClearColor(d[0],d[1],d[2],Math.max(1E-13,d[3])),c|=16384);e&&(c|=256);f.clearSafe(c);a(b);f.gl.flush();this.bindTarget(this.mainColor,this.mainDepth);return b};b.prototype.bindTarget=function(a,b){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,b);this._rctx.bindFramebuffer(a);return a};b.prototype.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,this.dimensions)};b.prototype.getGpuMemoryUsage=function(){var a=
0;this.renderTargetHelper&&(a+=this.renderTargetHelper.getGpuMemoryUsage());return a};return b}()})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});var e={dataType:5121},d={};n=function(){function b(a){this.rctx=a;this.activeTargets=
new Set;this.depthTextures=new Map;this.depthBuffers=new Map;this.colorTextures=new Map;this.framebuffers=new Map;this.nextId=1;this.depthTextureSupported=a.capabilities.depthTexture}b.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(a){return a.dispose()});this.depthBuffers.clear();this.depthTextures.forEach(function(a){return a.dispose()});this.depthTextures.clear();this.colorTextures.forEach(function(a){return a.dispose()});this.colorTextures.clear()};b.prototype.disposeTargetResource=
function(a){a=a.id;this.activeTargets.has(a)&&(this.activeTargets.delete(a),this.depthTextures.has(a)&&(this.depthTextures.get(a).dispose(),this.depthTextures.delete(a)),this.depthBuffers.has(a)&&(this.depthBuffers.get(a).dispose(),this.depthBuffers.delete(a)),this.colorTextures.has(a)&&(this.colorTextures.get(a).dispose(),this.colorTextures.delete(a)))};b.prototype.getDepthTexture=function(b,d){if(this.depthTextureSupported){var c=this.depthTextures.get(b.id);!c||c.descriptor.width===d.width&&c.descriptor.height===
d.height||(c.dispose(),c=void 0);c||(c=new a(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:d.width,height:d.height}),this.depthTextures.set(b.id,c),this.activeTargets.add(b.id));return c}};b.prototype.getDepthBuffer=function(a,b){if(!this.depthTextureSupported){var c=this.depthBuffers.get(a.id);c?c.descriptor.width===b.width&&c.descriptor.height===b.height||c.resize(b.width,b.height):(c=new h(this.rctx,l({internalFormat:34041},b)),this.depthBuffers.set(a.id,
c),this.activeTargets.add(a.id));return c}};b.prototype.getColorTexture=function(b,d){var c=this.colorTextures.get(b.id);!c||c.descriptor.width===d.width&&c.descriptor.height===d.height||(c.dispose(),c=void 0);c||(c=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:b.dataType,samplingMode:9729,wrapMode:33071,width:d.width,height:d.height}),this.colorTextures.set(b.id,c),this.activeTargets.add(b.id));return c};b.prototype.getAllocatedColorTexture=function(a){return this.colorTextures.get(a.id)};
b.prototype.registerDepthTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return l({id:b},d,a)};b.prototype.registerColorTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return l({id:b},e,a)};b.prototype.getFramebuffer=function(a,b,d){var c=this.getKey(b,d),e=this.framebuffers.get(c);b=this.getColorTexture(b,a);if(this.depthTextureSupported){var f=d?this.getDepthTexture(d,a):void 0;if(!e)return e=d?k.createWithAttachments(this.rctx,b,{colorTarget:0,depthStencilTarget:4},f):k.createWithAttachments(this.rctx,
b,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(c,e),e;if(d=e.width!==a.width||e.height!==a.height||e.colorTexture!==b||e.depthStencilTexture!==f)e.detachColorTexture(),e.detachDepthStencilTexture(),e.resize(a.width,a.height),e.attachColorTexture(b),e.attachDepthStencilTexture(f);return e}f=d?this.getDepthBuffer(d,a):void 0;if(!e)return e=k.createWithAttachments(this.rctx,b,{colorTarget:0,depthStencilTarget:d?3:0},f),this.framebuffers.set(c,e),e;if(d=e.width!==a.width||e.height!==a.height||
e.colorTexture!==b)e.detachColorTexture(),e.detachDepthStencilBuffer(),e.resize(a.width,a.height),e.attachColorTexture(b),e.attachDepthStencilBuffer(f);return e};b.prototype.getKey=function(a,b){return a.id+"_"+(b?b.id:"X")+"_"+a.name+(b?"_"+b.name:"")};b.prototype.getGpuMemoryUsage=function(){var a=0,b=new Set,d=function(c){b.has(c)||(b.add(c),a+=g.getGpuMemoryUsage(c))};this.depthTextures.forEach(d);this.colorTextures.forEach(d);this.depthBuffers.forEach(d);this.framebuffers.forEach(d);return a};
return b}();b.RenderTargetHelper=n})},"esri/views/3d/webgl-engine/shaders/OffscreenPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.composite={name:"offscreen-composite",shaders:{vertexShader:k.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:k.resolveIncludes("renderer/offscreen/composite.frag")},attributes:l.Default3D};b.compositeTransparentToHUDVisibility=
{name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:k.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:k.resolveIncludes("renderer/offscreen/compositeTransparentToHUDVisibility.frag")},attributes:l.Default3D};b.compositeOccluded={name:"offscreen-composite-occluded",shaders:{vertexShader:k.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:k.resolveIncludes("renderer/offscreen/compositeOccluded.frag")},attributes:l.Default3D}})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require",
"exports"],function(n,b){return function(){function b(b,h,a,g,e,d){this.camera=null;this.slot=this.pass=0;this.options=this.highlightDepthTexture=null;this.renderOccludedMask=5;this.rctx=b;this.offscreenRenderingHelper=h;this.scenelightingData=a;this.shadowMap=g;this.ssaoHelper=e;this.sliceHelper=d}b.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=5};Object.defineProperty(b.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0});return b}()})},
"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["require","exports","./depthRange"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.pluginContext=a;this.renderPlugins=[];this.slots=[];for(a=0;21>a;++a)this.slots[a]=[]}b.prototype.add=function(a,b){this.renderPlugins.push(b);for(var e=0;e<a.length;++e)this.slots[a[e]].push(b);b.initializeRenderContext(this.pluginContext);this.pluginContext.requestRender()};b.prototype.remove=
function(a){this.renderPlugins=this.renderPlugins.filter(function(b){return b!==a});for(var b=0;b<this.slots.length;++b)this.slots[b]=this.slots[b].filter(function(b){return b!==a});a.uninitializeRenderContext(this.pluginContext);this.pluginContext.requestRender()};b.prototype.prepareRender=function(a){for(var b=0,e=this.renderPlugins;b<e.length;b++){var d=e[b];d.prepareRender&&d.prepareRender(a)}};b.prototype.render=function(a,b){b.slot=a;var e=!1,d=0;for(a=this.slots[a];d<a.length;d++){var f=a[d];
f.canRender&&f.render(b)&&(e=!0)}return e};b.prototype.queryDepthRange=function(a){var b=k;b.near=Infinity;b.far=-Infinity;for(var e=0,d=this.renderPlugins;e<d.length;e++){var f=d[e];f.queryDepthRange&&(f=f.queryDepthRange(a))&&l.union(b,f,b)}return b};b.prototype.needsHighlight=function(){return this.renderPlugins.some(function(a){return a.needsHighlight})};b.prototype.needsLinearDepth=function(){for(var a=0,b=this.renderPlugins;a<b.length;a++)if(b[a].needsLinearDepth)return!0;return!1};return b}();
b.RenderPluginManager=n;var k={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/renderStats":function(){define(["require","exports"],function(n,b){function l(){return{triangles:0,drawCalls:0}}Object.defineProperty(b,"__esModule",{value:!0});b.makeNewRenderStats=l;n=function(){function b(){this.materialRenderStats=new Map;this.reset()}b.prototype.getMaterialRenderStatsObject=function(b){var a=this.materialRenderStats.get(b);a||(a=l(),this.materialRenderStats.set(b,a));return a};b.prototype.getAggregatedStats=
function(){var b={materialRenderers:{},total:l()};this.materialRenderStats.forEach(function(a,g){b.materialRenderers[g]=a;b.total.drawCalls+=a.drawCalls;b.total.triangles+=a.triangles});return b};b.prototype.reset=function(){this.materialRenderStats.forEach(function(b){b.drawCalls=0;b.triangles=0})};return b}();b.RenderStatsAggregator=n})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ./Camera ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u){function y(a,b){g.vec2.set(oa,a[b],a[b+3]);return oa}var m=function(){return function(){this.camera=new p.default;this.lightMat=a.mat4f64.create()}}();n=function(){function a(a){this.doShadowMapMipmapsWork=!1;this.textureRes=4096;this.numCascades=1;this.maxNumCascades=2;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.rctx=a;this.emptyTexture=r.createEmptyTexture(a);for(a=0;4>a;++a)this.cascades.push(new m)}a.prototype.dispose=function(){this.emptyTexture.dispose();
this.emptyTexture=null};Object.defineProperty(a.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(a){this.textureRes=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(a){this.maxNumCascades=l.clamp(Math.floor(a),1,4)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(a){a?this.enable():this.disable()},
enumerable:!0,configurable:!0});a.prototype.getDepthTexture=function(){return this.depthTexture};a.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)T[a]=this.cascades[a];T.length=this.numCascades;return T};a.prototype.prepare=function(a,b,e){t.assert(this.enabled);h.mat4.multiply(z,a.projectionMatrix,a.viewMatrix);var f=e.near,k=e.far;2>f&&(f=2);2>k&&(k=2);f>=k&&(f=2,k=4);this.numCascades=Math.min(1+Math.floor(t.logWithBase(k/f,4)),this.maxNumCascades);var m=Math.pow(k/f,1/this.numCascades);
for(e=0;e<this.numCascades+1;++e)this.cascadeDistances[e]=f*Math.pow(m,e);h.mat4.invert(B,z);h.mat4.lookAt(R,[0,0,0],[-b[0],-b[1],-b[2]],[0,1,0]);m=a.viewMatrix;a=a.projectionMatrix;for(e=0;e<this.numCascades;++e){var p=this.cascades[e],k=-this.cascadeDistances[e],f=-this.cascadeDistances[e+1],k=(a[10]*k+a[14])/Math.abs(a[11]*k+a[15]),f=(a[10]*f+a[14])/Math.abs(a[11]*f+a[15]);t.assert(k<f);for(var q=0;8>q;++q){c.vec4.set(C,0===q%4||3===q%4?-1:1,0===q%4||1===q%4?-1:1,4>q?k:f,1);c.vec4.transformMat4(D[q],
C,B);for(var n=0;3>n;++n)D[q][n]/=D[q][3]}d.vec3.negate(S,D[0]);h.mat4.translate(v,R,S);p.camera.viewMatrix=v;for(q=0;8>q;++q)d.vec3.transformMat4(D[q],D[q],p.camera.viewMatrix);d.vec3.copy(K,D[0]);d.vec3.copy(I,D[0]);for(q=1;8>q;++q)for(n=0;3>n;++n)K[n]=Math.min(K[n],D[q][n]),I[n]=Math.max(I[n],D[q][n]);K[2]-=200;I[2]+=200;p.camera.near=-I[2];p.camera.far=-K[2];f=1/D[0][3];k=1/D[4][3];t.assert(f<k);var n=f+Math.sqrt(f*k),q=Math.sin(l.acosClamped(m[2]*b[0]+m[6]*b[1]+m[10]*b[2])),n=n/q,f=D,r=n,u=q,
q=Q,x=J,w=N,ia=L,n=M;g.vec2.set(X,0,0);for(var T=0;4>T;++T)g.vec2.add(X,X,f[T]);g.vec2.scale(X,X,.25);g.vec2.set(P,0,0);for(T=4;8>T;++T)g.vec2.add(P,P,f[T]);g.vec2.scale(P,P,.25);g.vec2.lerp(V[0],f[4],f[5],.5);g.vec2.lerp(V[1],f[5],f[6],.5);g.vec2.lerp(V[2],f[6],f[7],.5);g.vec2.lerp(V[3],f[7],f[4],.5);for(var U=0,na=g.vec2.squaredDistance(V[0],X),T=1;4>T;++T){var A=g.vec2.squaredDistance(V[T],X);A<na&&(na=A,U=T)}g.vec2.subtract(Z,V[U],f[U+4]);T=Z[0];Z[0]=-Z[1];Z[1]=T;g.vec2.subtract(ca,P,X);g.vec2.lerp(Z,
Z,ca,u);g.vec2.normalize(Z,Z);U=u=void 0;u=U=g.vec2.dot(g.vec2.subtract(da,f[0],X),Z);for(T=1;8>T;++T)na=g.vec2.dot(g.vec2.subtract(da,f[T],X),Z),na<u?u=na:na>U&&(U=na);g.vec2.copy(q,X);g.vec2.scale(da,Z,u-r);g.vec2.add(q,q,da);for(var A=-1,Y=1,T=r=na=0;8>T;++T){g.vec2.subtract(F,f[T],q);g.vec2.normalize(F,F);var wa=Z[0]*F[1]-Z[1]*F[0];0<wa?wa>A&&(A=wa,na=T):wa<Y&&(Y=wa,r=T)}t.verify(0<A,"leftArea");t.verify(0>Y,"rightArea");g.vec2.scale(ea,Z,u);g.vec2.add(ea,ea,X);g.vec2.scale(la,Z,U);g.vec2.add(la,
la,X);ka[0]=-Z[1];ka[1]=Z[0];x=t.rayRay2D(q,f[r],la,g.vec2.add(da,la,ka),1,x);w=t.rayRay2D(q,f[na],la,da,1,w);ia=t.rayRay2D(q,f[na],ea,g.vec2.add(da,ea,ka),1,ia);f=t.rayRay2D(q,f[r],ea,da,1,n);t.verify(x,"rayRay");t.verify(w,"rayRay");t.verify(ia,"rayRay");t.verify(f,"rayRay");w=Q;f=J;q=L;ia=M;n=p.camera.projectionMatrix;g.vec2.subtract(va,q,ia);g.vec2.scale(va,va,.5);fa[0]=va[0];fa[1]=va[1];fa[2]=0;fa[3]=va[1];fa[4]=-va[0];fa[5]=0;fa[6]=va[0]*va[0]+va[1]*va[1];fa[7]=va[0]*va[1]-va[1]*va[0];fa[8]=
1;fa[6]=-g.vec2.dot(y(fa,0),w);fa[7]=-g.vec2.dot(y(fa,1),w);w=g.vec2.dot(y(fa,0),q)+fa[6];x=g.vec2.dot(y(fa,1),q)+fa[7];T=g.vec2.dot(y(fa,0),ia)+fa[6];ia=g.vec2.dot(y(fa,1),ia)+fa[7];w=-(w+T)/(x+ia);fa[0]+=fa[1]*w;fa[3]+=fa[4]*w;fa[6]+=fa[7]*w;w=1/(g.vec2.dot(y(fa,0),q)+fa[6]);x=1/(g.vec2.dot(y(fa,1),q)+fa[7]);fa[0]*=w;fa[3]*=w;fa[6]*=w;fa[1]*=x;fa[4]*=x;fa[7]*=x;fa[2]=fa[1];fa[5]=fa[4];fa[8]=fa[7];fa[7]+=1;w=g.vec2.dot(y(fa,1),f)+fa[7];x=g.vec2.dot(y(fa,2),f)+fa[8];T=g.vec2.dot(y(fa,1),q)+fa[7];
ia=g.vec2.dot(y(fa,2),q)+fa[8];w=-.5*(w/x+T/ia);fa[1]+=fa[2]*w;fa[4]+=fa[5]*w;fa[7]+=fa[8]*w;w=g.vec2.dot(y(fa,1),f)+fa[7];x=g.vec2.dot(y(fa,2),f)+fa[8];T=-x/w;fa[1]*=T;fa[4]*=T;fa[7]*=T;n[0]=fa[0];n[1]=fa[1];n[2]=0;n[3]=fa[2];n[4]=fa[3];n[5]=fa[4];n[6]=0;n[7]=fa[5];n[8]=0;n[9]=0;n[10]=1;n[11]=0;n[12]=fa[6];n[13]=fa[7];n[14]=0;n[15]=fa[8];p.camera.projectionMatrix[10]=2/(K[2]-I[2]);p.camera.projectionMatrix[14]=-(K[2]+I[2])/(K[2]-I[2]);h.mat4.multiply(p.lightMat,p.camera.projectionMatrix,p.camera.viewMatrix);
f=this.textureRes/2;p.camera.viewport[0]=0===e%2?0:f;p.camera.viewport[1]=0===Math.floor(e/2)?0:f;p.camera.viewport[2]=f;p.camera.viewport[3]=f}this.lastOrigin=null;this.cascadeDistances[this.numCascades]=100*k;b=this.rctx;b.bindFramebuffer(this.fbo);b.bindTexture(null,7);b.setClearColor(1,1,1,1);b.clearSafe(16640)};a.prototype.finish=function(a){t.assert(this.enabled);this.rctx.bindFramebuffer(a);this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()};a.prototype.bind=function(a){var b=
this.rctx,c=this.enabled;b.bindTexture(c?this.depthTexture:this.emptyTexture,7);b.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",c?.5/this.textureRes:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])};a.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b])};a.prototype.bindView=
function(a,b){if(this.enabled){var c=this.lastOrigin;if(!c||c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2])for(this.lastOrigin=this.lastOrigin||f.vec3f64.create(),d.vec3.copy(this.lastOrigin,b),c=0;c<this.numCascades;++c){h.mat4.translate(U,this.cascades[c].lightMat,b);for(var e=0;16>e;++e)Y[16*c+e]=U[e]}a.setUniformMatrix4fv("shadowMapMatrix",Y)}};a.prototype.enable=function(){this.enabled||(this.depthTexture=new w(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,
width:this.textureRes,height:this.textureRes}),this.fbo=x.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes}))};a.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.depthTexture=this.fbo=null)};a.prototype.getGpuMemoryUsage=function(){return u.getGpuMemoryUsage(this.fbo)};return a}();var v=a.mat4f64.create(),z=a.mat4f64.create(),B=a.mat4f64.create(),C=q.vec4f64.create(),D=[];for(b=0;8>b;++b)D.push(q.vec4f64.create());
var K=f.vec3f64.create(),I=f.vec3f64.create(),Q=e.vec2f64.create(),J=e.vec2f64.create(),N=e.vec2f64.create(),L=e.vec2f64.create(),M=e.vec2f64.create(),R=a.mat4f64.create(),S=f.vec3f64.create(),T=[],U=a.mat4f64.create(),Y=new Float32Array(64),X=e.vec2f64.create(),P=e.vec2f64.create(),V=[e.vec2f64.create(),e.vec2f64.create(),e.vec2f64.create(),e.vec2f64.create()],Z=e.vec2f64.create(),ca=e.vec2f64.create(),da=e.vec2f64.create(),F=e.vec2f64.create(),ea=e.vec2f64.create(),la=e.vec2f64.create(),ka=e.vec2f64.create(),
oa=e.vec2f64.create(),va=e.vec2f64.create(),fa=k.mat3f64.create();return n})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["require","exports","../../support/geometryUtils"],function(n,b,l){var k=l.boundedPlane.create();return function(){function b(){this._worldPlane=k}Object.defineProperty(b.prototype,"isEnabled",{get:function(){return this.plane!==k},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"plane",{get:function(){return this._worldPlane},set:function(a){this._worldPlane=
a?a:k},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../core/promiseUtils ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(n,b,l,k,h,a,g,e,d,f){return function(){function b(a){this.resourceLoadingPromise=null;this.isEnabled=!1;this.vertexAttributeLocations=
{vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.loadResources=function(a){var b=this;if(!this.data||!this.textureArea||!this.textureSearch){var c=this.resourceLoadingPromise||this.loadDataModule().then(function(){return b.loadTextures()});a&&c.then(a);this.resourceLoadingPromise||(this.resourceLoadingPromise=c,c.then(function(){return b.resourceLoadingPromise=null}));return!1}return!0};b.prototype.loadDataModule=
function(){var a=this;return this.data?l.resolve():l.create(function(b){return n(["./SmaaRenderPassData"],function(c){a.data=c;b()})})};b.prototype.loadTextures=function(){var a=this;return l.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,9728,6409)]).then(function(b){var c=b[1];a.textureArea=b[0];a.textureSearch=c})};Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return null!=this.resourceLoadingPromise},
enumerable:!0,configurable:!0});b.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var b=this.rctx;this.programEdgeDetect=new g(b,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new g(b,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new g(b,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);
this.pipelineState=e.makePipelineState({colorWrite:e.defaultColorWriteParams});var c=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new f(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new h(b,34962,35044,c)});this.tmpFramebufferEdges=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=a.createWithAttachments(this.rctx,{target:3553,
pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,
this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var c=this.rctx,d=0,e=0;null!=b?(d=b.descriptor.width,e=b.descriptor.height):(d=c.gl.canvas.width,e=c.gl.canvas.height);c.bindVAO(this.vao);c.setPipelineState(this.pipelineState);c.setViewport(0,0,d,e);this.tmpFramebufferEdges.resize(d,e);c.bindFramebuffer(this.tmpFramebufferEdges);c.setClearColor(0,0,0,
1);c.clear(16384);c.bindProgram(this.programEdgeDetect);c.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/d,1/e,d,e);c.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(d,e);c.bindFramebuffer(this.tmpFramebufferBlend);c.setClearColor(0,0,1,1);c.clear(16384);c.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",
1);c.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);c.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);c.drawArrays(4,0,3);c.bindFramebuffer(b);c.setClearColor(0,1,0,1);c.clear(16384);c.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);c.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",
1);c.drawArrays(4,0,3)};b.prototype.loadTextureFromBase64=function(a,b,c){var e=new d(this.rctx,{pixelFormat:c,dataType:5121,wrapMode:33071,samplingMode:b},null);return k.requestImage(a).then(function(a){e.resize(a.width,a.height);e.setData(a);return e})};return b}()})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../core/Logger ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/imageUtils ./glUtil3D ./Util ../shaders/SSAOPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){var x=l.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");b=function(){function b(a,b,c){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=g.vec4f64.create();this._rctx=b;this._programRep=a;this._requestRender=c;this._emptyTexture=d.createEmptyTexture(b)}b.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=null};Object.defineProperty(b.prototype,"isSupported",{get:function(){var a=
this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),a=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return!(b||a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a;this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0});b.prototype.computeSSAO=function(b,c,e){if(this._noiseTexture){f.assert(this.enabled);var g=this._rctx,
k=b.fullViewport,m=k[2],l=k[3],k=m/this._BLUR_F,p=l/this._BLUR_F;this._ssaoFBO.resize(m,l);this._blur0FBO.resize(k,p);this._blur1FBO.resize(k,p);k=1*m;p=1*l;g.bindFramebuffer(this._ssaoFBO);a.vec4.copy(this._viewportToRestore,b.fullViewport);g.setViewport(0,0,m,l);var q=this._ssaoProgram,n=this._blurProgram;q.setUniform2f("rnmScale",m/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height);q.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:
32>=this._samples?this._data.random32:this._data.random64);g.bindProgram(q);g.setPipelineState(this._pipelineState);m=this._data.minDiscrepancy;q.setUniform1f("numSpiralTurns",this._samples<m.length?m[this._samples]:5779);m=u;l=w;f.inverseProjectionInfo(b.projectionMatrix,b.fullWidth,b.fullHeight,m,l);q.setUniform4fv("projInfo",m);q.setUniform2fv("zScale",l);q.setUniform2f("nearFar",b.near,b.far);m=1/b.computeRenderPixelSizeAtDist(1);q.setUniform1f("projScale",1*m);q.setUniform2f("screenDimensions",
k,p);var r=2*this._radius,l=h.vec3.distance(b.eye,b.center),r=20*b.computeRenderPixelSizeAtDist(l),r=Math.max(.1,r);q.setUniform1f("radius",r);q.setUniform1f("intensity",4*this._attenuation/Math.pow(r,6));q.setUniform1i("rnm",0);q.setUniform1i("normalMap",1);q.setUniform1i("depthMap",2);g.bindTexture(this._noiseTexture,0);g.bindTexture(e,1);g.bindTexture(c,2);c=d.createQuadVAO(this._rctx);g.bindVAO(c);g.drawArrays(5,0,t.vertexCount(c,"geometry"));g.bindTexture(this._ssaoFBO.colorTexture,0);g.setViewport(0,
0,k/this._BLUR_F,p/this._BLUR_F);g.bindFramebuffer(this._blur0FBO);n.setUniform2f("screenDimensions",k,p);n.setUniform1i("tex",0);n.setUniform1i("normalMap",1);n.setUniform1i("depthMap",2);n.setUniform2f("blurSize",0,1*this._BLUR_F/p);n.setUniform1i("radius",4);n.setUniform1f("g_BlurFalloff",.08);n.setUniform2f("nearFar",b.near,b.far);5E4<l&&(m=Math.max(0,m-(l-5E4)));n.setUniform1f("projScale",m);n.setUniform2f("zScale",1,0);g.drawArrays(5,0,t.vertexCount(c,"geometry"));n.setUniform2f("blurSize",
1*this._BLUR_F/k,0);g.bindFramebuffer(this._blur1FBO);g.bindTexture(this._blur0FBO.colorTexture,0);g.drawArrays(5,0,t.vertexCount(c,"geometry"));g.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};b.prototype.setUniforms=function(a){var b=this.enabled&&this._noiseTexture,c=this._rctx;c.bindTexture(b?this._blur1FBO.colorTexture:this._emptyTexture,6);c.setActiveTexture(0);a.setUniform1i("ssaoTex",6);b?a.setUniform4f("viewportPixelSz",
this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};b.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b])};b.prototype.selectPrograms=function(){this._ssaoProgram=this._programRep.getProgram(c.ssaoPass,{samples:8>=this._samples?8:16>=this._samples?16:32>=this._samples?32:64});this._blurProgram=this._programRep.getProgram(c.blurPass,
{radius:4});this._pipelineState=p.makePipelineState({colorWrite:p.defaultColorWriteParams})};b.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&a.initialize()})):x.warn("SSAO is not supported for this browser or hardware"))};b.prototype.loadResources=function(a){var b=this;this._data?a():n(["./SSAOHelperData"],function(c){b._data=c;a()})};b.prototype.initialize=function(){var a=this,b={target:3553,pixelFormat:6408,dataType:5121,
samplingMode:9729,wrapMode:33071,width:0,height:0},c={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=q.createWithAttachments(this._rctx,b,c);this._blur0FBO=q.createWithAttachments(this._rctx,b,c);this._blur1FBO=q.createWithAttachments(this._rctx,b,c);e.requestImage(this._data.noiseTexture).then(function(b){a._enabled&&(a._noiseTexture=new r(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:b.width,height:b.height},b),a._requestRender())});this.selectPrograms()};b.prototype.disable=
function(){this.enabled&&(this._enabled=!1,this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};b.prototype.getGpuMemoryUsage=function(){return t.getGpuMemoryUsage(this._blur0FBO)+t.getGpuMemoryUsage(this._blur1FBO)+t.getGpuMemoryUsage(this._ssaoFBO)};return b}();var w=k.vec2f64.create(),u=
g.vec4f64.create();return b})},"esri/views/3d/webgl-engine/shaders/SSAOPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.ssaoPass={name:"ssao",shaders:function(b){return{vertexShader:k.resolveIncludes("util/quad.vert"),fragmentShader:"#define SAMPLES "+b.samples+"\n"+k.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:l.Default3D};b.blurPass={name:"ssao-blur",shaders:function(b){return{vertexShader:k.resolveIncludes("util/quad.vert"),
fragmentShader:"#define RADIUS "+b.radius+"\n"+k.resolveIncludes("renderer/ssao/blur.frag")}},attributes:l.Default3D}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/promiseUtils ../../../../../core/requireUtils ../../../../../core/typedArrayUtil ../../../../../core/workers ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/BufferView ../../../support/buffer/utils ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../PreinterleavedGeometryData ../TextureBackedBuffer/BufferManager ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../../../../webgl/BufferObject ../../../../webgl/renderState ../../../../webgl/VertexArrayObject module".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L){Object.defineProperty(b,"__esModule",{value:!0});l=function(){function b(a,b,c){this.rctx=a;this.programRepository=b;this.callbacks=c;this.profilingCallback=null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new y.LocalOriginManager(new w);this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new C;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=r.vec3f64.create();this.tmpCameraPosition=
r.vec3f64.create();this.componentColorManager=new v.BufferManager(this.rctx,2)}b.prototype.initialize=function(){var a=this;c.open(d.getAbsMid("./EdgeProcessingWorker",n,L)).then(function(b){a.destroyed?b.close():a.workerThread=b});for(var b=z.VertexLayout.createBuffer(4),e=0;4>e;e++)b.sideness.set(e,0,0===e||3===e?0:1),b.sideness.set(e,1,0===e||1===e?0:1);this.verticesBufferObject=Q.createVertex(this.rctx,35044,b.buffer);this.pipelineState=(b=this.rctx.capabilities.blendMinMax)?J.makePipelineState({blending:J.separateBlendingParams(1,
1,0,1,32774,b.MAX),depthTest:{func:515},colorWrite:J.defaultColorWriteParams}):J.makePipelineState({depthTest:{func:515},depthWrite:J.defaultDepthWriteParams,colorWrite:J.defaultColorWriteParams})};b.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)};b.prototype.getUsedMemory=function(){return this.gpuMemoryUsage};Object.defineProperty(b.prototype,
"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});b.prototype.shouldRender=function(){return 0<this.renderers.size};b.prototype.addObject=function(a,b,c,d,f){return k(this,void 0,void 0,function(){var g,k,l,p,q,n,r;return h(this,function(h){switch(h.label){case 0:if(this.hasObject(a))return[2];g=[];l={loaded:e.create(function(a){return k=a}),renderables:[]};this.perObjectData.set(a,l);if(f&&f.mergeGeometries&&1<a.geometries.length&&this.canMergeGeometries(a))g.push(this.addObjectMergedGeometries(a,
l,b,c));else for(p=0;p<a.geometries.length;p++)q=a.geometries[p],n=a.geometryRecords[p],r=n.material,r.supportsEdges&&(q.data instanceof m?g.push(this.addGeometryPreinterleaved(a,l,q.data,n,b,c,d)):g.push(this.addGeometryNonPreinterleaved(a,l,q.data,n,b[0],c,d)));return[4,e.all(g)];case 1:return h.sent(),this.callbacks.setNeedsRender(),k(),[2]}})})};b.prototype.hasObject=function(a){return this.perObjectData.has(a)};b.prototype.updateAllComponentOpacities=function(a,b){return k(this,void 0,void 0,
function(){var c,d,e=this;return h(this,function(f){switch(f.label){case 0:return c=b instanceof Array?function(a){return b[a]}:function(){return b},[4,this.getObjectEntry(a)];case 1:return d=f.sent(),d.renderables.forEach(function(a){for(var b=a.components.meta.length,d=0;d<b;d++){var f=c(d),g=a.components.meta[d],h=g.index;g.material.opacity=f;a.components.buffer.textureBuffer.setDataElement(h,1,3,255*f)}e.updateTransparency(a)}),this.callbacks.setNeedsRender(),[2]}})})};b.prototype.updateAllComponentMaterials=
function(a,b,c,d){return k(this,void 0,void 0,function(){var e,f,g,k,m=this;return h(this,function(h){switch(h.label){case 0:return e=!!c.slicePlaneEnabled,f=I.determineRendererType(b),g=D.EdgeRenderer.getKey(f,e),[4,this.getObjectEntry(a)];case 1:return k=h.sent(),k.renderables.forEach(function(a){if(g!==a.rendererKey){var c=m.renderers.get(a.rendererKey),h=m.acquireRenderer(f,e);c.removeRenderable(a);c.refCount.decrement();a.rendererKey=g;h.addRenderable(a)}for(c=0;c<b.length;c++)a.components.meta[c].material=
b[c];d&&m.updateComponentBuffer(a.components);m.updateTransparency(a)}),this.callbacks.setNeedsRender(),[2]}})})};b.prototype.updateObjectVisibility=function(a,b){return k(this,void 0,void 0,function(){var c;return h(this,function(d){switch(d.label){case 0:return[4,this.getObjectEntry(a)];case 1:return c=d.sent(),c.renderables.forEach(function(a){a.visible=b}),this.callbacks.setNeedsRender(),[2]}})})};b.prototype.removeObject=function(a){var b=this,c=this.perObjectData.get(a);c&&(this.perObjectData.delete(a),
c.loaded.then(function(){c.renderables.forEach(function(a){b.removeRenderable(a)});b.callbacks.setNeedsRender()}))};b.prototype.getObjectEntry=function(a){return k(this,void 0,void 0,function(){var b;return h(this,function(c){switch(c.label){case 0:b=this.perObjectData.get(a);if(!b)throw"no object";return[4,b.loaded];case 1:return c.sent(),[2,b]}})})};b.prototype.removeAll=function(){var a=this;this.perObjectData.forEach(function(b,c){a.removeObject(c)})};b.prototype.render=function(a,b){var c=this;
this.localOrigins.updateViewMatrices(a.view);this.renderers.forEach(function(a){0===a.refCount.value&&(c.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var d=0,e=0;this.renderers.forEach(function(a){return a.forEachRenderable(function(a){d+=a.statistics.averageEdgeLength;e++},b)});if(0!==e){var f=a.view,g=40*d/e,h=I.estimateLengthAtDistance(a.viewport[3],a.fovY,1,3.5*a.pixelRatio),k={distanceFalloffFactor:g,minimumEdgeLength:h,
transparency:b};this.rctx.setPipelineState(this.pipelineState);this.updateObjectCameraDistances(a);this.numberOfRenderedEdges=0;this.renderers.forEach(function(b){c.renderRegularEdges(b,a,k);c.renderSilhouetteEdges(b,a,k)});a.view=f}};b.prototype.updateTransparency=function(a){var b=I.determineEdgeTransparency(a.components.meta),c=I.determineObjectTransparency(a.components.meta);if(b!==a.edgeTransparency||c!==a.objectTransparency)a.edgeTransparency=b,a.objectTransparency=c,this.renderers.get(a.rendererKey).setRenderablesDirty()};
b.prototype.computeModelTransformWithLocalOrigin=function(a,b,c){a.getCombinedStaticTransformation(b,c);b.origin?this.localOrigins.register(b.origin):(a=p.vec3.set(this.tmpModelPosition,c[12],c[13],c[14]),b.origin=this.localOrigins.acquire(a));u.applyToModelMatrix(b.origin.vec3,c);return c};b.prototype.updateComponentBuffer=function(a){var b=a.meta;a=a.buffer;for(var c=0;c<b.length;c++){var d=b[c].material,e=b[c].index,f=g.clamp(Math.round(d.size*D.LINE_WIDTH_FRACTION_FACTOR),0,255),h=g.clamp(d.extensionLength,
-D.EXTENSION_LENGTH_OFFSET,255-D.EXTENSION_LENGTH_OFFSET)+D.EXTENSION_LENGTH_OFFSET,k="solid"===d.type?0:1,m=255*d.opacity,d=d.color;a.textureBuffer.setData(e,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(e,1,f,h,k,m)}};b.prototype.createComponentBuffers=function(a){for(var b=[],c=this.componentColorManager.getBuffer(a.length),d=0;d<a.length;d++){var e=a[d],f=c.acquireIndex();b.push({index:f,material:e})}a={meta:b,buffer:c};this.updateComponentBuffer(a);return a};b.prototype.extractEdges=
function(a,b,c,d,e){return this.worker.process({data:b,originalIndices:e,writerSettings:a,skipDeduplicate:c},d?null:this.workerThread)};b.prototype.createEdgeResources=function(a){var b={};if(0<a.regular.lodInfo.lengths.length){var c=new N(this.rctx,z.EdgeShaderAttributeLocations,{vertices:z.glVertexLayout,instances:B.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:Q.createVertex(this.rctx,35044,a.regular.instancesData.buffer)});b.regular={vao:c,lod:a.regular.lodInfo}}0<
a.silhouette.lodInfo.lengths.length&&(c=new N(this.rctx,z.EdgeShaderAttributeLocations,{vertices:z.glVertexLayout,instances:B.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:Q.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),b.silhouette={vao:c,lod:a.silhouette.lodInfo});return b};b.prototype.disposeEdgeResources=function(a){a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),
a.silhouette.vao.dispose(!1),a.silhouette.vao=null)};b.prototype.addGeometryNonPreinterleaved=function(a,b,c,d,e,f,g){return k(this,void 0,void 0,function(){var k,m,l,p;return h(this,function(h){k=c.getAttribute("position");m=this.computeModelTransformWithLocalOrigin(a,d,q.mat4f64.create());l=d.origin;p={position:k,indices:c.getIndices("position"),modelTransform:m,origin:l};return[2,this.addNonPreinterleaved(b,p,e,f,g)]})})};b.prototype.addNonPreinterleaved=function(a,b,c,d,e){void 0===e&&(e=!1);
return k(this,void 0,void 0,function(){var f,g,k,m,l,p,q,n,r,v,t,u,y,x,w;return h(this,function(h){switch(h.label){case 0:f=this.acquireRenderer(c.type,d.slicePlaneEnabled||!1);g=b.modelTransform;k=b.origin;m=b.indices;l=b.position;p=l.data.length/l.strideIdx;q=z.EdgeInputBufferLayout.createBuffer(p);for(n=0;n<p;n++)q.position.set(n,0,l.data[l.offsetIdx+n*l.strideIdx+0]),q.position.set(n,1,l.data[l.offsetIdx+n*l.strideIdx+1]),q.position.set(n,2,l.data[l.offsetIdx+n*l.strideIdx+2]);r=this.createComponentBuffers([c]);
I.fillComponenBufferIndices(r.meta,[0,q.componentIndex.count],q.componentIndex);return[4,this.extractEdges(f.writerSettings,q,!1,e,m)];case 1:return v=h.sent(),t=this.createEdgeResources(v),u=t.regular,y=t.silhouette,x=(u?u.vao.size:0)+(y?y.vao.size:0),w={regular:u,silhouette:y,transform:{modelMatrix:g,origin:k},statistics:{gpuMemoryUsage:x,averageEdgeLength:v.averageEdgeLength},components:r,visible:!0,edgeTransparency:I.determineEdgeTransparency(r.meta),objectTransparency:I.determineObjectTransparency(r.meta),
distanceToCamera:0,rendererKey:f.key},a.renderables.push(w),f.addRenderable(w),this.gpuMemoryUsage+=x,[2]}})})};b.prototype.addGeometryPreinterleaved=function(a,b,c,d,e,g,m){return k(this,void 0,void 0,function(){var k,l,p,n,r,v,u,y,w,B,C,D,N,K,L,J;return h(this,function(h){switch(h.label){case 0:k=c.getAttribute("position");if(!k||!f.isFloat32Array(k.data))return console.warn("Geometry has no float32 `position` attribute, skipping it."),[2];l=I.determineRendererType(e);p=this.acquireRenderer(l,g.slicePlaneEnabled||
!1);n=this.computeModelTransformWithLocalOrigin(a,d,q.mat4f64.create());r=d.origin;v=c.getIndices("position");u=new t.BufferViewVec3f(k.data.buffer,4*k.offsetIdx,4*k.strideIdx);y=z.EdgeInputBufferLayout.createBuffer(u.count);x.vec3.copy(y.position,u);w=this.createComponentBuffers(e);I.fillComponenBufferIndices(w.meta,c.componentOffsets,y.componentIndex,v);B=c.hasPositionData;return[4,this.extractEdges(p.writerSettings,y,B,m,v)];case 1:return C=h.sent(),D=this.createEdgeResources(C),N=D.regular,K=
D.silhouette,L=(N?N.vao.size:0)+(K?K.vao.size:0),J={regular:N,silhouette:K,transform:{modelMatrix:n,origin:r},statistics:{gpuMemoryUsage:L,averageEdgeLength:C.averageEdgeLength},components:w,visible:!a.isHidden(d),edgeTransparency:I.determineEdgeTransparency(w.meta),objectTransparency:I.determineObjectTransparency(w.meta),distanceToCamera:0,rendererKey:p.key},b.renderables.push(J),p.addRenderable(J),this.gpuMemoryUsage+=L,[2]}})})};b.prototype.canMergeGeometries=function(b){for(var c=null,d=null,
e=0;e<b.geometries.length;e++){var f=b.geometryRecords[e];if(f.material.supportsEdges){if(b.geometries[e].data instanceof m)return!1;if(!c)c=f.transformation;else if(!a.equals(c,f.transformation))return!1;if(!d&&f.origin)d=f;else if(d&&f.origin&&d.origin.id!==f.origin.id)return!1}}return!0};b.prototype.addObjectMergedGeometries=function(a,b,c,d){return k(this,void 0,void 0,function(){var e,g,k,m,l,p,n,r,v,u,t,y,x,w,z,B,C,D,N,I,K;return h(this,function(h){switch(h.label){case 0:e=new Map;g=0;m=k=null;
for(l=0;l<a.geometries.length;l++)if(p=a.geometries[l],n=a.geometryRecords[l],r=n.material,r.supportsEdges&&(!m&&n.origin&&(m=n),v=p.data.getIndices("position"),g+=v?v.length:0,v&&null==k||k===Uint16Array))k=f.isUint16Array(v)?Uint16Array:Uint32Array;u=g?new k(g):null;t=[];for(l=y=0;l<a.geometries.length;l++)if(p=a.geometries[l],x=a.geometryRecords[l],r=x.material,r.supportsEdges){w=p.data.getAttribute("position");v=p.data.getIndices("position");z=e.get(w.data);if(null==z){z=t.length/3;for(B=w.offsetIdx;B<
w.data.length;B+=w.strideIdx)t.push(w.data[B+0]),t.push(w.data[B+1]),t.push(w.data[B+2]);e.set(w.data,z)}if(v)for(C=0;C<v.length;C++)u[y++]=z+v[C]}D=m||a.geometryRecords[0];N=this.computeModelTransformWithLocalOrigin(a,D,q.mat4f64.create());I=D.origin;for(l=0;l<a.geometryRecords.length;l++)a.geometryRecords[l].origin=I;K={position:{data:t,offsetIdx:0,strideIdx:3},indices:u,modelTransform:N,origin:I};return[4,this.addNonPreinterleaved(b,K,c[0],d)];case 1:return h.sent(),[2]}})})};b.prototype.acquireRenderer=
function(a,b){var c=D.EdgeRenderer.getKey(a,b),d=this.renderers.get(c);this.strokesTexture||(this.strokesTexture=K.generateStrokesTexture(this.rctx));d||(d=new D.EdgeRenderer(this.rctx,this.programRepository,{type:a,slicePlaneEnabled:b,strokesTexture:this.strokesTexture}),this.renderers.set(c,d));d.refCount.increment();return d};b.prototype.removeRenderable=function(a){var b=this.renderers.get(a.rendererKey);b.removeRenderable(a);b.refCount.decrement();this.disposeEdgeResources(a);this.localOrigins.release(a.transform.origin);
this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;for(var b=0,c=a.components.meta;b<c.length;b++)a.components.buffer.releaseIndex(c[b].index)};b.prototype.updateObjectCameraDistances=function(a){var b=this;a=a.viewInvTransp;p.vec3.set(this.tmpCameraPosition,a[3],a[7],a[11]);this.perObjectData.forEach(function(a,c){var d=p.vec3.distance(c.getCenter(),b.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=d})})};b.prototype.renderRegularEdges=function(a,b,c){var d=this;a.bindRegularEdges(b,
c);a.forEachRenderable(function(e){if(e.visible&&e.regular){var f=I.computeEdgeCount(e.regular.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);a.renderRegularEdges(e,b,f);d.numberOfRenderedEdges+=f}},c.transparency)};b.prototype.renderSilhouetteEdges=function(a,b,c){var d=this;a.bindSilhouetteEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.silhouette){var f=I.computeEdgeCount(e.silhouette.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);
a.renderSilhouetteEdges(e,b,f);d.numberOfRenderedEdges+=f}},c.transparency)};return b}();b.EdgeView=l})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.applyToModelMatrix=function(b,k){var h=-b[0],a=-b[1];b=-b[2];var g=k[3],e=k[7],d=k[11],f=k[15];k[0]+=g*h;k[1]+=g*a;k[2]+=g*b;k[4]+=e*h;k[5]+=e*a;k[6]+=e*b;k[8]+=d*h;k[9]+=d*a;k[10]+=d*b;k[12]+=f*h;k[13]+=f*a;k[14]+=f*b};b.applyToViewMatrix=
function(b,k){var h=b[0],a=b[1];b=b[2];k[12]+=h*k[0]+a*k[4]+b*k[8];k[13]+=h*k[1]+a*k[5]+b*k[9];k[14]+=h*k[2]+a*k[6]+b*k[10];k[14]+=h*k[3]+a*k[7]+b*k[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/mat4f64","./localOriginHelper"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this.factory=a;this.originData=new Map}a.prototype.acquire=
function(a){return this.register(this.factory.getOrigin(a))};a.prototype.register=function(a){var b=this.originData.get(a.id);if(b)return b.refCount++,b.origin;this.originData.set(a.id,{refCount:1,viewMatrix:k.mat4f64.create(),origin:a});return a};a.prototype.release=function(a){var b=this.originData.get(a.id);b&&(b.refCount--,0===b.refCount&&this.originData.delete(a.id))};a.prototype.updateViewMatrices=function(a){this.originData.forEach(function(b){l.mat4.copy(b.viewMatrix,a);h.applyToViewMatrix(b.origin.vec3,
b.viewMatrix)})};a.prototype.getViewMatrix=function(a){return this.originData.get(a.id).viewMatrix};return a}();b.LocalOriginManager=n})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define("require exports ../../../../core/compilerUtils ./ComponentUtils ./geometryDataUtils ../../../webgl/Util".split(" "),function(n,b,l,k,h,a){function g(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;
case 5125:return Uint32Array;case 5123:return Uint16Array;default:l.neverReached(a)}}return function(){function b(d,e,c,l,p){void 0===c&&(c=null);void 0===l&&(l=b.DefaultOffsets);void 0===p&&(p=b.DefaultIndices);this.preinterleaved=!0;this.primitiveType="triangle";this._positionData=null;var f=a.getStride(e)/4,f=d.length/f;this._hasDefaultIndices=p===b.DefaultIndices;this.indexCount=p.length;this._hasDefaultIndices&&(p=h.generateDefaultIndexArray(f),this.indexCount=f);for(var f={},q=0;q<e.length;q++){var n=
e[q],w=new (g(n.type))(d.buffer),u=a.getBytesPerElement(n.type);f[n.name]={data:w,size:n.count,offsetIdx:n.offset/u,strideIdx:n.stride/u}}c&&(this._positionData=c,f.position={data:c.data,size:3,offsetIdx:0,strideIdx:3});this._id=h.getNewId();this._vertexData=d;this._vertexAttributes=f;this._layout=e;this._indexData=p;this._componentOffsets=k.createOffsets(l);this._gpuMemoryUsage=d.byteLength+(this._hasDefaultIndices?0:p.byteLength)}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});b.prototype.toRenderData=function(){var a={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,indexCount:this.indexCount,vertexData:this._vertexData,layout:this._layout};this._indexData=
this._vertexData=null;this._vertexAttributes={position:this._vertexAttributes.position};return a};b.prototype.getIndices=function(a){return"position"===a&&this._positionData?this._positionData.indices:this._indexData};b.prototype.getAttribute=function(a){return this._vertexAttributes[a]};b.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage};Object.defineProperty(b.prototype,"hasPositionData",{get:function(){return!!this._positionData},enumerable:!0,configurable:!0});b.DefaultOffsets=
new Uint32Array(0);b.DefaultIndices=new Uint32Array(0);return b}()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a){void 0===a&&(a=1);this.rctx=b;this.fieldCount=a;this.buffers=[]}b.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(b){return 0===b.activeCount?(b.dispose(),!1):!0})};b.prototype.getBuffer=
function(b){for(var a=0,g=this.buffers;a<g.length;a++){var e=g[a];if(e.availableCount>=b)return e}if(b>l.MAX_INDEX_COUNT)return null;b=new l.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(b);return b};b.prototype.updateTextures=function(){for(var b=0,a=this.buffers;b<a.length;b++)a[b].textureBuffer.updateTexture()};return b}();b.BufferManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require","exports","./SimpleIndexManager",
"./TextureBackedBuffer"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.MAX_INDEX_COUNT=65536;n=function(){function h(a,g){void 0===g&&(g=1);this.textureBuffer=new k.TextureBackedBuffer(a,g);this.indexManager=new l.SimpleIndexManager(b.MAX_INDEX_COUNT)}h.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(h.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});h.prototype.acquireIndex=function(){var a=this.indexManager.acquire();this.textureBuffer.resizeToFit(a);return a};h.prototype.releaseIndex=function(a){this.indexManager.release(a)};return h}();b.ManagedTextureBackedBuffer=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,
"__esModule",{value:!0});n=function(){function b(b){this.maxCount=b;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(b.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});b.prototype.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();
if(this.availableCount)return this._nextIndex++};b.prototype.release=function(b){this.recycledIndices.push(b)};return b}();b.SimpleIndexManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){void 0===b&&(b=1);this.rctx=a;this.fieldCount=b;this.textureWidth=4096;this.dirty=
!0;this.texture=new k(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new l.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}b.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};b.prototype.setData=function(a,b,e,d,f,c){a=a*this.fieldCount+b;this.dirty=!0;this.data.set(a,0,e);this.data.set(a,1,d);this.data.set(a,2,f);this.data.set(a,3,c)};b.prototype.setDataElement=
function(a,b,e,d){a=a*this.fieldCount+b;this.dirty=!0;this.data.set(a,e,d)};b.prototype.resizeToFit=function(a){a*=this.fieldCount;a>=this.data.count&&(a=new l.BufferViewVec4u8(new ArrayBuffer(Math.ceil((a+1)/this.textureWidth)*this.textureWidth*4)),a.typedBuffer.set(this.data.typedBuffer),this.data=a)};b.prototype.updateTexture=function(){if(this.dirty){var a=this.texture.descriptor.width;this.data.count>a*this.texture.descriptor.height&&this.texture.resize(a,this.data.count/a);this.texture.setData(this.data.typedBuffer);
this.dirty=!1}};b.prototype.bind=function(a,b){this.rctx.bindTexture(this.texture,b.unit);a.setUniform1i(b.texName,b.unit);a.setUniform2f(b.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return b}();b.TextureBackedBuffer=n})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require","exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});
b.EdgeInputBufferLayout=k.newLayout().vec3f("position").u16("componentIndex").u16("_padding");b.VertexLayout=k.newLayout().vec2u8("sideness");b.glVertexLayout=l.glLayout(b.VertexLayout,{prefixA:!0});b.CommonInstancesLayout=k.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0});b.RegularEdgeInstancesLayout=b.CommonInstancesLayout.clone().vec3f("normal");
b.SilhouetteEdgeInstancesLayout=b.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");b.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/RandomLCG ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(){}a.prototype.updateSettings=function(a){this.settings=a};a.prototype.write=function(a,b,d){var e=c;e[0]=d.position0[0];e[1]=d.position0[1];e[2]=d.position0[2];e[3]=d.position1[0];e[4]=d.position1[1];e[5]=d.position1[2];p[0]=5381;for(e=0;e<q.length;e++)p[0]=31*p[0]+q[e];r.seed=p[0];var e=r.getIntRange(0,255),f=r.getIntRange(0,this.settings.variants-1),g=r.getFloat(),g=-(1-Math.min(g/.7,1))+Math.max(0,
g-.7)/(1-.7),g=255*(Math.pow(Math.abs(g),1.2)*(0>g?-1:1)*.5+.5);a.position0.setVec(b,d.position0);a.position1.setVec(b,d.position1);a.componentIndex.set(b,d.componentIndex);a.variantOffset.set(b,e);a.variantStroke.set(b,f);a.variantExtension.set(b,g)};a.prototype.trim=function(a,b){return a.slice(0,b)};return a}();b.CommonBufferWriter=f;var c=new Float32Array(6),q=new Uint32Array(c.buffer),p=new Uint32Array(1),r=new h;n=function(){function b(){this.commonWriter=new f}b.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};
b.prototype.allocate=function(a){return d.RegularEdgeInstancesLayout.createBuffer(a)};b.prototype.write=function(b,c,d){this.commonWriter.write(b,c,d);a.vec3.add(t,d.faceNormal0,d.faceNormal1);a.vec3.normalize(t,t);b.normal.setVec(c,t)};b.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};b.Layout=d.RegularEdgeInstancesLayout;b.glLayout=e.glLayout(d.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1});return b}();b.RegularEdgeBufferWriter=n;n=function(){function a(){this.commonWriter=
new f}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return d.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);a.normalA.setVec(b,c.faceNormal0);a.normalB.setVec(b,c.faceNormal1)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=d.SilhouetteEdgeInstancesLayout;a.glLayout=e.glLayout(d.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();
b.SilhouetteEdgeBufferWriter=n;var t=g.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/typedArrayUtil ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(n,b,l,k,h,a,g,
e,d,f,c){return function(){function b(){this.regularWriter=new f.RegularEdgeBufferWriter;this.silhouetteWriter=new f.SilhouetteEdgeBufferWriter}b.prototype.process=function(a,b){return l(this,void 0,void 0,function(){var c,d,e;return k(this,function(f){switch(f.label){case 0:if(!b)return[3,2];c=[];d=this.packInput(a,c);this.wrappedWork;return[4,b.invoke("wrappedWork",d,{transferList:c})];case 1:return e=f.sent(),[2,this.unpackOutput(e)];case 2:return[2,this.work(a)]}})})};b.prototype.wrappedWork=
function(a){return l(this,void 0,void 0,function(){var b,c,d,e;return k(this,function(f){b=this.unpackInput(a);c=this.work(b);d=[];this.packInputTransferables(b,d);e=this.packOutput(c,d);return[2,{result:e,transferList:d}]})})};b.prototype.work=function(a){var b=this.extractEdgeInformation(a.data,a.skipDeduplicate,a.originalIndices);this.regularWriter.updateSettings(a.writerSettings);this.silhouetteWriter.updateSettings(a.writerSettings);return c.extractEdges(b,this.regularWriter,this.silhouetteWriter)};
b.prototype.packInputTransferables=function(a,b){b.push(a.data.buffer)};b.prototype.packInput=function(a,b){this.packInputTransferables(a,b);b={dataBuffer:a.data.buffer,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(b.originalIndicesBuffer=a.originalIndices.buffer,b.originalIndicesType=h.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return b};b.prototype.unpackInput=function(a){return{data:d.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===
a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};b.prototype.packOutput=function(a,b){b.push(a.regular.lodInfo.lengths.buffer);b.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:e.packInterleavedBuffer(a.regular.instancesData,b),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:e.packInterleavedBuffer(a.silhouette.instancesData,
b),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:a.averageEdgeLength}};b.prototype.unpackOutput=function(a){return{regular:{instancesData:e.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:e.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};b.prototype.extractEdgeInformation=function(b,
c,e){if(c&&e)return c=g.computeNeighbors(e,b.count),{faces:e,neighbors:c,vertices:b};b=a.default(b.buffer,b.stride/4,e);c=g.computeNeighbors(b.indices,b.uniqueCount);return{faces:b.indices,neighbors:c,vertices:d.EdgeInputBufferLayout.createView(b.buffer)}};return b}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.computeNeighbors=function(b,k){for(var h=b.length/3,a=new Uint32Array(k+1),g=new Uint32Array(k+
1),e=function(b,c){b<c?a[b+1]++:g[c+1]++},d=0;d<h;d++){var f=b[3*d],c=b[3*d+1],l=b[3*d+2];e(f,c);e(c,l);e(l,f)}for(d=c=f=0;d<k;d++)l=a[d+1],e=g[d+1],a[d+1]=f,g[d+1]=c,f+=l,c+=e;for(var p=new Uint32Array(6*h),n=a[k],e=function(b,c,d){if(b<c){var e=a[b+1]++;p[2*e]=c;p[2*e+1]=d}else e=g[c+1]++,p[2*n+2*e]=b,p[2*n+2*e+1]=d},d=0;d<h;d++)f=b[3*d],c=b[3*d+1],l=b[3*d+2],e(f,c,d),e(c,l,d),e(l,f,d);f=function(a,b){var c=2*a;a=b-a;for(b=1;b<a;b++){var d=p[c+2*b],e=p[c+2*b+1],f=b-1;for(f;0<=f&&p[c+2*f]>d;f--)p[c+
2*f+2]=p[c+2*f],p[c+2*f+3]=p[c+2*f+1];p[c+2*f+2]=d;p[c+2*f+3]=e}};for(d=0;d<k;d++)f(a[d],a[d+1]),f(n+g[d],n+g[d+1]);for(var t=new Int32Array(3*h),x=function(a,c){return a===b[3*c]?0:a===b[3*c+1]?1:a===b[3*c+2]?2:-1},h=function(a,b){a=x(a,b);t[3*b+a]=-1},f=function(a,b,c,d){a=x(a,b);t[3*b+a]=d;c=x(c,d);t[3*d+c]=b},d=0;d<k;d++){for(var c=a[d],l=a[d+1],e=g[d],w=g[d+1];c<l&&e<w;){var u=p[2*c],y=p[2*n+2*e];u===y?(f(d,p[2*c+1],y,p[2*n+2*e+1]),c++,e++):u<y?(h(d,p[2*c+1]),c++):(h(y,p[2*n+2*e+1]),e++)}for(;c<
l;)h(d,p[2*c+1]),c++;for(;e<w;)y=p[2*n+2*e],h(y,p[2*n+2*e+1]),e++}return t}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","./BufferView","./InterleavedLayout"],function(n,b,l,k,h){function a(a){var b=[];a.fields.forEach(function(a,d){var c=a.constructor;a=l({},a,{constructor:c.ElementType+"_"+c.ElementCount});b.push([d,a])});return{stride:a.stride,fields:b,fieldNames:a.fieldNames}}function g(a){var b=h.newLayout();b.stride=
a.stride;b.fieldNames=a.fieldNames;a.fields.forEach(function(a){return b.fields.set(a[0],l({},a[1],{constructor:e.get(a[1].constructor)}))});return b}Object.defineProperty(b,"__esModule",{value:!0});b.packInterleavedBuffer=function(b,e){e.push(b.buffer);return{buffer:b.buffer,layout:a(b.layout)}};b.unpackInterleavedBuffer=function(a){return g(a.layout).createView(a.buffer)};b.packLayout=a;b.unpackLayout=g;n=[k.BufferViewFloat,k.BufferViewVec2f,k.BufferViewVec3f,k.BufferViewVec4f,k.BufferViewMat3f,
k.BufferViewMat4f,k.BufferViewFloat64,k.BufferViewVec2f64,k.BufferViewVec3f64,k.BufferViewVec4f64,k.BufferViewMat3f64,k.BufferViewMat4f64,k.BufferViewUint8,k.BufferViewVec2u8,k.BufferViewVec3u8,k.BufferViewVec4u8,k.BufferViewUint16,k.BufferViewVec2u16,k.BufferViewVec3u16,k.BufferViewVec4u16,k.BufferViewUint32,k.BufferViewVec2u32,k.BufferViewVec3u32,k.BufferViewVec4u32,k.BufferViewInt8,k.BufferViewVec2i8,k.BufferViewVec3i8,k.BufferViewVec4i8,k.BufferViewInt16,k.BufferViewVec2i16,k.BufferViewVec3i16,
k.BufferViewVec4i16,k.BufferViewInt32,k.BufferViewVec2i32,k.BufferViewVec3i32,k.BufferViewVec4i32];var e=new Map;n.forEach(function(a){return e.set(a.ElementType+"_"+a.ElementCount,a)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils".split(" "),
function(n,b,l,k,h,a,g,e){function d(b,c){var d=k.acosClamped(b.cosAngle),f=q.fwd,g=q.ortho;e.directionFromTo(f,b.position1,b.position0);b=0<a.vec3.dot(a.vec3.cross(g,b.faceNormal0,b.faceNormal1),f)?-1:1;return d*b>c}function f(a){var b=a.faces.length/3,c=a.faces;a=a.neighbors;for(var d=0,e=0;e<b;e++)var f=a[3*e+0],g=a[3*e+1],h=a[3*e+2],k=c[3*e+0],l=c[3*e+1],p=c[3*e+2],d=d+(-1===f||k<l?1:0),d=d+(-1===g||l<p?1:0),d=d+(-1===h||p<k?1:0);for(var d=new Int32Array(4*d),n=0,e=0;e<b;e++){f=a[3*e+0];g=a[3*
e+1];h=a[3*e+2];k=c[3*e+0];l=c[3*e+1];p=c[3*e+2];if(-1===f||k<l)d[n++]=k,d[n++]=l,d[n++]=e,d[n++]=f;if(-1===g||l<p)d[n++]=l,d[n++]=p,d[n++]=e,d[n++]=g;if(-1===h||p<k)d[n++]=p,d[n++]=k,d[n++]=e,d[n++]=h}return d}function c(b){var c=b.faces.length/3,d=b.vertices.position;b=b.faces;for(var e=p.v0,f=p.v1,g=p.v2,h=new Float32Array(3*c),k=0;k<c;k++){var l=b[3*k+1],n=b[3*k+2];d.getVec(b[3*k+0],e);d.getVec(l,f);d.getVec(n,g);a.vec3.subtract(f,f,e);a.vec3.subtract(g,g,e);a.vec3.cross(e,f,g);a.vec3.normalize(e,
e);h[3*k+0]=e[0];h[3*k+1]=e[1];h[3*k+2]=e[2]}return h}Object.defineProperty(b,"__esModule",{value:!0});b.extractEdges=function(b,e,g,p){void 0===p&&(p=r);var n=b.vertices.position,m=b.vertices.componentIndex,v=k.deg2rad(p.anglePlanar);p=k.deg2rad(p.angleSignificantEdge);var t=Math.cos(p),u=Math.cos(v),x=q.edge,w=x.position0,K=x.position1,I=x.faceNormal0,Q=x.faceNormal1,J=c(b),N=f(b),L=N.length/4;b=e.allocate(L);p=0;var M=g.allocate(L),R=0,S=0,T=0,U=l.range(0,L),Y=new Float32Array(L);h.forEach(Y,function(b,
c,d){n.getVec(N[4*c+0],w);n.getVec(N[4*c+1],K);d[c]=a.vec3.distance(w,K)});U.sort(function(a,b){return Y[b]-Y[a]});for(var X=[],P=[],V=0;V<L;V++){var Z=U[V],ca=Y[Z],da=N[4*Z+0],F=N[4*Z+1],ea=N[4*Z+2],Z=N[4*Z+3],la=-1===Z;n.getVec(da,w);n.getVec(F,K);if(la)a.vec3.set(I,J[3*ea+0],J[3*ea+1],J[3*ea+2]),a.vec3.copy(Q,I),x.componentIndex=m.get(da),x.cosAngle=a.vec3.dot(I,Q);else{a.vec3.set(I,J[3*ea+0],J[3*ea+1],J[3*ea+2]);a.vec3.set(Q,J[3*Z+0],J[3*Z+1],J[3*Z+2]);x.componentIndex=m.get(da);x.cosAngle=a.vec3.dot(I,
Q);if(x.cosAngle>u)continue;-.9999>x.cosAngle&&a.vec3.copy(Q,I)}S+=ca;T++;la||x.cosAngle<t?(e.write(b,p++,x),X.push(ca)):d(x,v)&&(g.write(M,R++,x),P.push(ca))}m=new Float32Array(X.reverse());v=new Float32Array(P.reverse());return{regular:{instancesData:e.trim(b,p),lodInfo:{lengths:m}},silhouette:{instancesData:g.trim(M,R),lodInfo:{lengths:v}},averageEdgeLength:S/T}};var q={edge:{position0:g.vec3f64.create(),position1:g.vec3f64.create(),faceNormal0:g.vec3f64.create(),faceNormal1:g.vec3f64.create(),
componentIndex:0,cosAngle:0},ortho:g.vec3f64.create(),fwd:g.vec3f64.create()},p={v0:g.vec3f64.create(),v1:g.vec3f64.create(),v2:g.vec3f64.create()},r={anglePlanar:4,angleSignificantEdge:35}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../materials/internal/MaterialUtil ../../shaders/EdgeRendererPrograms".split(" "),
function(n,b,l,k,h,a,g,e,d,f){Object.defineProperty(b,"__esModule",{value:!0});b.LINE_WIDTH_FRACTION_FACTOR=8;b.EXTENSION_LENGTH_OFFSET=128;var c={type:"uber",slicePlaneEnabled:!1,strokesTexture:null},q=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}();n=function(){function k(b,d,f){var g,h,p;this.rctx=
b;this.programRepository=d;this.refCount=new q;this.renderables=new Set;this.sortedRenderables=(g={},g[1]=(h={},h[1]=new a,h[2]=new a,h),g[2]=(p={},p[1]=new a,p[2]=new a,p),g);this.renderablesDirty=!1;this.depthBiasZ=-4E-4;this.depthBiasXY=.5;this.tmpViewToWorldNormalMatrix=e.mat3f64.create();this.settings=l({},c,f);this.key=k.getKey(this.settings.type,this.settings.slicePlaneEnabled);this.writerSettings={variants:this.settings.strokesTexture.variants};this.createPrograms()}k.prototype.dispose=function(){for(var a in this.programs){var b=
this.programs[a];b&&(this.programRepository.decreaseRefCount(b),this.programs[a]=null)}};k.prototype.addRenderable=function(a){this.renderables.add(a);this.renderablesDirty=!0};k.prototype.removeRenderable=function(a){this.renderables.delete(a);this.renderablesDirty=!0};k.prototype.setRenderablesDirty=function(){this.renderablesDirty=!0};k.prototype.forEachRenderable=function(a,b){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[b][1].forEach(a);this.sortedRenderables[b][2].forEach(a)};
k.prototype.bindRegularEdges=function(a,b){this.bind(this.programs.regular,a,b)};k.prototype.bindSilhouetteEdges=function(a,b){this.bind(this.programs.silhouette,a,b)};k.prototype.bind=function(a,b,c){this.rctx.bindProgram(a);a.setUniformMatrix4fv("uProj",b.proj);a.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ);a.setUniform2f("uPixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform2f("uNDCToPixel",b.viewport[2]/2,b.viewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",c.distanceFalloffFactor);
a.setUniform2f("uViewportDimInv",1/b.viewport[2],1/b.viewport[3]);a.setUniform1f("uPixelRatio",b.pixelRatio||1)};k.prototype.renderRegularEdges=function(a,b,c){this.render(this.programs.regular,a,a.regular.vao,b,c)};k.prototype.renderSilhouetteEdges=function(a,b,c){this.render(this.programs.silhouette,a,a.silhouette.vao,b,c)};k.prototype.render=function(a,b,c,d,e){this.setUniforms(a,b,d);this.rctx.bindVAO(c);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,e)};k.prototype.setUniforms=function(a,
c,e){c.components.buffer.textureBuffer.bind(a,b.componentDataBindParameters);a.setUniformMatrix4fv("uView",e.view);a.setUniformMatrix4fv("uModel",c.transform.modelMatrix);var f=e.viewInvTransp,h=g.mat3.fromMat4(this.tmpViewToWorldNormalMatrix,f);a.setUniform3f("uCameraPosition",f[3],f[7],f[11]);a.setUniformMatrix3fv("uViewToWorldNormalMatrix",h);"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(e.fovY/2)/(e.viewport[3]/
2));a.setUniform3fv("uLocalOrigin",c.transform.origin.vec3);this.settings.slicePlaneEnabled&&d.bindSlicePlane(c.transform.origin.vec3,e.slicePlane,a)};k.prototype.setSketchUniforms=function(a){var b=this.settings.strokesTexture,c=b.texture;this.rctx.bindTexture(c,0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",1/c.descriptor.width,1/c.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",h.log2(b.resolution));a.setUniform1f("uStrokesNormalizationScale",b.normalizationScale);
a.setUniform1f("uStrokesAmplitude",b.amplitude);a.setUniform1f("uStrokeVariants",b.variants)};k.prototype.getOptions=function(a){return l({},a,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.type,slice:this.settings.slicePlaneEnabled})};k.prototype.createPrograms=function(){var a=this.programRepository.getProgram(f.program,this.getOptions({silhouette:!1})),b=this.programRepository.getProgram(f.program,this.getOptions({silhouette:!0}));this.programRepository.increaseRefCount(a);
this.programRepository.increaseRefCount(b);this.programs={regular:a,silhouette:b}};k.prototype.sortRenderables=function(){var a=this;this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();this.sortedRenderables[2][2].clear();this.renderables.forEach(function(b){switch(b.objectTransparency){case 1:case 2:switch(b.edgeTransparency){case 1:case 2:a.sortedRenderables[b.objectTransparency][b.edgeTransparency].push(b)}}});
var b=function(a,b){return a.transform.origin.id<b.transform.origin.id?-1:a.transform.origin.id>b.transform.origin.id?1:0};this.sortedRenderables[1][1].sort(b);this.sortedRenderables[1][2].sort(b);this.sortedRenderables[2][1].sort(b);this.sortedRenderables[2][2].sort(b)};k.getKey=function(a,b){return"edges-t:"+a+":"+b};return k}();b.EdgeRenderer=n;b.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}})},"esri/views/3d/webgl-engine/shaders/EdgeRendererPrograms":function(){define(["require",
"exports","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});var h=function(a){return k.glslifyDefineMap({MODE:{value:a.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:a.silhouette,ANTIALIASING:a.antialiasing,SLICE:a.slice})};b.program={name:"edges",shaders:function(a){return{vertexShader:h(a)+l.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:h(a)+l.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},
attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(n,b,l,k,h,a){function g(a,b){if(!a)return null;var c=a.length/2,f=e*c,c=Array(c),g=0;b=1===b;for(var h=0;h<
a.length;h+=2){var k=(a[h]+a[h+1])/2;b?c[g++]=Math.min(f,1-(1-k)*d):c[g++]=Math.min(f,k*d)}return c}Object.defineProperty(b,"__esModule",{value:!0});b.generateStrokesTexture=function(d){for(var c=b.strokesDefinition.resolution,e=c/2,f=new Uint8Array(4*c*c),l=4*c*e,e=b.strokesDefinition.amplitude,n=2*e,x=4*c,w=k.log2(c)+1,u=b.strokesDefinition.strokes.length,y=(w-1)*u*x,m=0,v=b.strokesDefinition.strokes;m<v.length;m++){for(var z=v[m],B=z.distance,z=z.pressure,C=y,D=0;D<w;D++){0!==D&&(B=g(B,0),z=g(z,
1));for(var K=0;K<b.strokesDefinition.resolution;K++){var I=z?z[K%z.length]:1;h.packFloatRGBA((B?B[K%B.length]/n:0)+.5,f,C);h.packFloatRGBA(I,f,C+l);C+=4}C-=x*(u+1)}y+=x}d=new a(d,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:c,height:c,wrapMode:10497},f);return{resolution:c,texture:d,normalizationScale:n,amplitude:e,variants:u}};var e=.1,d=.5;b.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,
-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,
.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,
.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,
-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,
.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,
.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,
.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,
-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,
-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,
1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,
.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,
-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,
.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,
.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,
.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,
.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,
4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,
3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,
.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,
.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,
.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,
.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,
.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,
1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,
-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,
.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,
2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,
.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,
.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,
.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,
-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,
1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,
.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,
-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,
.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,
.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,
.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,
.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,
4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,
.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,
-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],
pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,
.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,
.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,
.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../../../core/maybe","../../../../../core/typedArrayUtil"],function(n,b,l,k,h){function a(a){return 0<
a.size*a.color[3]*a.opacity}function g(a,b){var d=l.binaryIndexOf(a,b,!0);return-1===d?b<a[0]?0:a.length:d}Object.defineProperty(b,"__esModule",{value:!0});b.determineRendererType=function(b){for(var d=null,e=0;e<b.length;e++){var c=b[e],g=c.type;if(a(c))if(k.isNone(d))d=g;else if(d!==g)return"uber"}return k.isSome(d)?d:"solid"};b.determineEdgeTransparency=function(b){for(var d=0,e=0;e<b.length;e++){var c=b[e].material;if(a(c)){if(1>c.color[3]*c.opacity)return 1;d=2}}return d};b.determineObjectTransparency=
function(b){for(var d=0,e=0;e<b.length;e++){var c=b[e].material;if(a(c)){switch(c.objectTransparency){case 1:case 0:return 1}d=2}}return d};b.cloneIndices=function(a){if(Uint16Array.from)return h.isUint16Array(a)?Uint16Array.from(a):Uint32Array.from(a);for(var b=h.isUint16Array(a)?new Uint16Array(a.length):new Uint32Array(a.length),e=0;e<a.length;e++)b[e]=a[e];return b};b.estimateLengthAtDistance=function(a,b,f,c){return c/a*f*2*Math.tan(.5*b)};b.findLowerBoundIndex=g;b.computeEdgeCount=function(a,
b,f){return a.length-g(a,b*f.minimumEdgeLength)};b.fillComponenBufferIndices=function(a,b,f,c){for(var d=0;d<a.length;d++){var e=a[d].index,g=b[d],h=b[d+1];if(c)for(;g<h;g++)f.set(c[g],e);else for(;g<h;g++)f.set(g,e)}}})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","./SphericalHarmonics"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a=k.vec3f64.create();
n=function(){function b(){this._renderLighting={main:{intensity:k.vec3f64.create(),direction:k.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldSunlight={direction:k.vec3f64.create(),ambient:{color:k.vec3f64.create(),intensity:0},diffuse:{color:k.vec3f64.create(),intensity:0}}}b.prototype.setLightDirectionUniform=function(a){a.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)};b.prototype.setUniforms=function(a,
b){void 0===b&&(b=!1);b||a.getDefine("GROUND_NORMAL_SHADING")?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);this.setLightDirectionUniform(a);a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);b=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?a.setUniform3f("lightingAmbientSH0",
b.r[0],b.g[0],b.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",b.r[0],b.r[1],b.r[2],b.r[3]),a.setUniform4f("lightingAmbientSH_G",b.g[0],b.g[1],b.g[2],b.g[3]),a.setUniform4f("lightingAmbientSH_B",b.b[0],b.b[1],b.b[2],b.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]),a.setUniform4f("lightingAmbientSH_R1",b.r[1],b.r[2],b.r[3],b.r[4]),a.setUniform4f("lightingAmbientSH_G1",b.g[1],b.g[2],b.g[3],b.g[4]),a.setUniform4f("lightingAmbientSH_B1",b.b[1],b.b[2],
b.b[3],b.b[4]),a.setUniform4f("lightingAmbientSH_R2",b.r[5],b.r[6],b.r[7],b.r[8]),a.setUniform4f("lightingAmbientSH_G2",b.g[5],b.g[6],b.g[7],b.g[8]),a.setUniform4f("lightingAmbientSH_B2",b.b[5],b.b[6],b.b[7],b.b[8]))};b.prototype.set=function(b){this._info=b;h.combineLights(b.lights,this._shOrder,this._renderLighting);l.vec3.negate(this._oldSunlight.direction,this._renderLighting.main.direction);b=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*
b;this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*b;this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*b;this._oldSunlight.ambient.intensity=1;this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*b;this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*b;this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*b;this._oldSunlight.diffuse.intensity=1;b=l.vec3.copy(a,
this._oldSunlight.diffuse.color);l.vec3.scale(b,b,.4*this._info.globalFactor);l.vec3.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,b)};Object.defineProperty(b.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"old",{get:function(){return this._oldSunlight},enumerable:!0,configurable:!0});return b}();b.SceneLighting=n})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),
function(n,b,l,k,h,a,g){function e(a){return(a+1)*(a+1)}function d(a){return l.clamp(Math.floor(Math.sqrt(a)-1),0,2)}function f(a,b,c){var d=a[0],f=a[1];a=a[2];c=c||[];c.length=e(b);0<=b&&(c[0]=.28209479177);1<=b&&(c[1]=.4886025119*d,c[2]=.4886025119*a,c[3]=.4886025119*f);2<=b&&(c[4]=1.09254843059*d*f,c[5]=1.09254843059*f*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*d*a,c[8]=.54627421529*(d*d-f*f));return c}function c(a,b){a=e(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=
0;c<a;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function q(b,c){for(var e=d(c.r.length),g=0;g<b.length;g++){var h=b[g];k.vec3.negate(y,h.direction);f(y,e,w);a.elementwiseProduct(w,m);a.scalarProduct(w,h.intensity[0],u);a.add(c.r,u);a.scalarProduct(w,h.intensity[1],u);a.add(c.g,u);a.scalarProduct(w,h.intensity[2],u);a.add(c.b,u)}return c}function p(a,b){f(y,0,w);for(var c=0;c<a.length;c++){var d=a[c];b.r[0]+=w[0]*m[0]*d.intensity[0]*4*Math.PI;b.g[0]+=w[0]*m[0]*d.intensity[1]*4*Math.PI;b.b[0]+=w[0]*m[0]*
d.intensity[2]*4*Math.PI}return b}Object.defineProperty(b,"__esModule",{value:!0});b.numberOfCoefficients=e;b.numberOfCoefficientsInBand=function(a){return 2*a+1};b.orderFromNumberOfCoefficients=d;b.computeCoefficients=f;b.initSHCoefficients=c;b.projectFillLights=q;b.projectAmbientLights=p;b.combineLights=function(b,d,e){c(d,e.sphericalHarmonics.sh);k.vec3.set(e.main.intensity,0,0,0);var f=!1,h=r,l=t;d=x;h.length=0;l.length=0;for(var m=d.length=0;m<b.length;m++){var n=b[m];n instanceof g.MainLight&&
!f?(k.vec3.copy(e.main.direction,n.direction),e.main.intensity[0]=n.intensity[0],e.main.intensity[1]=n.intensity[1],e.main.intensity[2]=n.intensity[2],e.main.castShadows=n.castShadows,f=!0):n instanceof g.MainLight||n instanceof g.FillLight?h.push(n):n instanceof g.AmbientLight?l.push(n):n instanceof g.SphericalHarmonicsLight&&d.push(n)}q(h,e.sphericalHarmonics.sh);p(l,e.sphericalHarmonics.sh);for(b=0;b<d.length;b++)n=d[b],a.add(e.sphericalHarmonics.sh.r,n.sh.r),a.add(e.sphericalHarmonics.sh.g,n.sh.g),
a.add(e.sphericalHarmonics.sh.b,n.sh.b)};var r=[],t=[],x=[],w=[0],u=[0],y=h.vec3f64.create(),m=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.dotProduct=function(b,k){for(var h=0,a=0;a<b.length;a++)h+=b[a]*k[a];return h};b.elementwiseProduct=function(b,k,h){h=h||b;h.length=b.length;for(var a=0;a<b.length;a++)h[a]=
b[a]*k[a];return h};b.scalarProduct=function(b,k,h){h=h||b;h.length=b.length;for(var a=0;a<b.length;a++)h[a]=b[a]*k;return h};b.add=function(b,k,h){h=h||b;h.length=b.length;for(var a=0;a<b.length;a++)h[a]=b[a]+k[a];return h}})},"esri/views/webgl/Profiling":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.startMeasurement=function(b){return(b=b.capabilities.disjointTimerQuery)?new l(b):null};b.getTimestamp=function(b,h,a){void 0===a&&(a=50);var g=
b.capabilities.disjointTimerQuery;if(!g||0>=g.timestampBits())return!1;var e=g.createQuery();g.createTimestamp(e);var d=function(){var b=g.resultAvailable(e),c=g.disjoint();b&&!c?(b=g.getResult(e),h(b/1E6)):c?h():setTimeout(d,a)};d();return!0};b.supportsTimestamps=function(b){b=b.capabilities.disjointTimerQuery;if(!b)return!1;b=b.timestampBits();console.log({bits:b});return 0<b};var l=function(){function b(b){this.timer=b;this.query=b.createQuery();this.timer.beginTimeElapsed(this.query)}b.prototype.stop=
function(b,a){void 0===a&&(a=50);this.cb=b;this.checkInterval=a;this.timer.endTimeElapsed();this.checkQueryResult()};b.prototype.checkQueryResult=function(){var b=this.timer.resultAvailable(this.query),a=this.timer.disjoint();b&&!a?(b=this.timer.getResult(this.query),this.cb(b/1E6)):a?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval)};return b}()})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","../../../../core/compilerUtils","./Util"],
function(n,b,l,k){var h=function(){function a(a){this.refCnt=0;this.glMaterial=a}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=function(){--this.refCnt;k.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();n=function(){function b(a,b){this._textureRep=a;this._programRep=b;this._id2glMaterialRef=new Map}b.prototype.acquire=function(a,b){var d=a.id+"_"+b,c=this._id2glMaterialRef.get(d);
null==c?(a=(c=a.getGLMaterials()[b])?new c({material:a,programRep:this._programRep,textureRep:this._textureRep}):void 0,c=new h(a),this._id2glMaterialRef.set(d,c)):a=c.getGLMaterial();c.incRefCnt();a&&this.increaseProgramReferences(a);return a};b.prototype.release=function(a,b){a=a+"_"+b;b=this._id2glMaterialRef.get(a);b.decRefCnt();if(0===b.getRefCnt()){if(b=b.getGLMaterial())this.decreaseProgramReferences(b),b.dispose();this._id2glMaterialRef.delete(a)}};b.prototype.updateMaterialParameters=function(b){for(var d=
0,e=a;d<e.length;d++){var c=this._id2glMaterialRef.get(b+"_"+e[d]);c&&c.getGLMaterial()&&this.updateParamsForMat(c.getGLMaterial())}};b.prototype.updateParamsForMat=function(a){a.updateParameters&&(this.decreaseProgramReferences(a),a.updateParameters(),this.increaseProgramReferences(a))};b.prototype.increaseProgramReferences=function(a){a=a.getPrograms();for(var b=this._programRep,e=0;e<a.length;e++)b.increaseRefCount(a[e])};b.prototype.decreaseProgramReferences=function(a){a=a.getPrograms();for(var b=
this._programRep,e=0;e<a.length;e++)b.decreaseRefCount(a[e])};return b}();var a=l.tuple("color","depth","depthShadowMap","normal","highlight");return n})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util","../../../webgl/programUtils"],function(n,b,l,k){return function(){function b(a,b){void 0===b&&(b="");this._rctx=a;this._shaderPrefix=b;this._programCacheByTemplate=new Map;this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],
proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}b.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._rctx=this._commonUniforms=this._programRefCount=this._programCacheByTemplate=null};b.prototype.getProgram=function(a,b){var e=this;this._programCacheByTemplate.has(a)||this.addProgramTemplate(a,function(b){return k.createProgram(e._rctx,a,b,e._shaderPrefix)});return this.getProgramTemplateInstance(a,
b)};b.prototype.addProgramTemplate=function(a,b){this._programCacheByTemplate.set(a,{constructor:b,programs:new Map})};b.prototype.getProgramTemplateInstance=function(a,b){if(a=this._programCacheByTemplate.get(a)){var e=b?JSON.stringify(b):"default";a.programs.has(e)||(b=a.constructor(b),a.programs.set(e,b));return a.programs.get(e)}return null};b.prototype.getProgramsUsingUniform=function(a){return this._commonUniforms[a]||[]};b.prototype.increaseRefCount=function(a){var b=a.id;this._programRefCount[b]?
this._programRefCount[b]++:(this._programRefCount[b]=1,this._findCommonUniforms(a))};b.prototype.decreaseRefCount=function(a){var b=a.id;1<this._programRefCount[b]?this._programRefCount[b]--:(this._forgetCommonUniforms(a),this._programRefCount[b]=0)};b.prototype._findCommonUniforms=function(a){for(var b in this._commonUniforms)a.hasUniform(b)&&(l.assert(-1===this._commonUniforms[b].indexOf(a),"common uniforms of program have already been determined"),this._commonUniforms[b].push(a))};b.prototype._forgetCommonUniforms=
function(a){for(var b in this._commonUniforms){var e=this._commonUniforms[b],d=e.indexOf(a);-1<d&&(e[d]=e[e.length-1],e.pop())}};return b}()})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define(["require","exports","../../../../core/Logger","./Util","../../../webgl/Texture"],function(n,b,l,k,h){var a=l.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");n=function(){function b(a,b,f,c,g){this.NUM_PARALLEL=8;this._fallbackTextureTransparent=this._fallbackTexture=null;this.textures=
a;this._programRepository=b;this.getViewportToRestore=f;this.onNewlyTexturesLoaded=g;this._rctx=c;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=c.capabilities.textureFilterAnisotropic)?c.parameters.maxMaxAnisotropy:1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(a=0;a<this._fallbackTextureData.length;++a)this._fallbackTextureData[a]=
255,this._fallbackTextureTransparentData[a]=0!==(a+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8};this.onNewlyTexturesLoaded()}b.prototype.acquire=function(e,d,f){var c=this,g=this.id2textureRef[e];if(null==g){var h=this.textures.get(e);k.assert(void 0!==h);h.setUnloadFunc(this._unload.bind(this));d=!0===d;var l=this._createGLTextureDescription(h),g=new b.TextureRef(null);k.assert(null==this.id2textureRef[e]);this.id2textureRef[e]=
g;if(h.initializeThroughRender)e=h.initializeThroughRender(this._rctx,l),g.setGLTexture(e),f&&f(g);else if(h.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(e,l,f):this._queue.push([e,l,f]);else try{h.initializeThroughUpload(this._rctx,l,this._programRepository,this.getViewportToRestore(),function(a){g.setGLTexture(a);c.onNewlyTexturesLoaded();f&&f(g)})}catch(t){a.error("#acquire","Error loading texture: "+t.toString())}null==g.getGLTexture()&&g.setGLTexture(d?this.fallbackTextureTransparent:
this.fallbackTexture);this.onNewlyTexturesLoaded()}g.incRefCnt();return g};b.prototype.release=function(a){a=this.id2textureRef[a];void 0!==a&&(a.decRefCnt(),k.assert(0<=a.getRefCnt()))};b.prototype.getLoadingCount=function(){return Object.keys(this.loading).length};b.prototype.getTexture=function(a){return this.textures.get(a)};b.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};b.prototype._unload=function(a){var b=this.id2textureRef[a];void 0!==b&&((b=b.getGLTexture())&&b!==this.fallbackTextureTransparent&&
b!==this.fallbackTexture&&b.dispose(),delete this.id2textureRef[a]);this.next(a)};b.prototype._createGLTextureDescription=function(a){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&a.params&&a.params.mipmap&&!a.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:a.params&&a.params.wrap}};b.prototype.next=function(a){if(a in this.loading){delete this.loading[a];var b=Object.keys(this.id2textureRef),e=Object.keys(this.loading);this.listeners.forEach(function(c){c(a,
b,e)});this.processQueue()}};b.prototype._loadImage=function(a,b,f){var c=this;k.assert(null==this.loading[a]);this.loading[a]=!0;var d=this.textures.get(a);k.assert(void 0!==d);setTimeout(function(){var e=c.id2textureRef[a];e&&e.getRefCnt()&&d.initializeThroughUpload(c._rctx,b,c._programRepository,c.getViewportToRestore(),function(b){c.next(a);c.onNewlyTexturesLoaded();e&&e.getRefCnt()&&(e.setGLTexture(b),f&&f(e))})},0)};b.prototype.processQueue=function(){for(var a=[],b=0;b<this._queue.length;++b){var f=
this._queue[b][0],c=this.id2textureRef[f];void 0!==c&&(0===c.getRefCnt()?(c.getGLTexture().dispose(),delete this.id2textureRef[f]):a.push(this._queue[b]))}this._queue=a;a=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(b=0;b<a;++b)this._loadImage(this._queue[b][0],this._queue[b][1],this._queue[b][2]);this._queue.splice(0,a)};Object.defineProperty(b.prototype,"fallbackTexture",{get:function(){this._fallbackTexture||(this._fallbackTexture=new h(this._rctx,this._fallbackTextureDesc,
this._fallbackTextureData));return this._fallbackTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fallbackTextureTransparent",{get:function(){this._fallbackTextureTransparent||(this._fallbackTextureTransparent=new h(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData));return this._fallbackTextureTransparent},enumerable:!0,configurable:!0});return b}();(function(a){var b=function(){function a(a){this._glTexture=null;this._refCount=0;this._glTexture=
a}a.prototype.incRefCnt=function(){++this._refCount};a.prototype.decRefCnt=function(){--this._refCount;k.assert(0<=this._refCount)};a.prototype.getRefCnt=function(){return this._refCount};a.prototype.setGLTexture=function(a){this._glTexture=a};a.prototype.getGLTexture=function(){return this._glTexture};return a}();a.TextureRef=b})(n||(n={}));return n})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../lib/AutoDisposable ../../../support/screenshotUtils ../../../webgl/FramebufferObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c,d,e,f){void 0===e&&(e=null);void 0===f&&(f=!0);var g=b.call(this)||this;g._rctx=a;g._renderScene=c;g._requestRenderScene=d;g._renderOverlay=e;g.supersample=f;g._screenshotQueue=[];return g}k(d,b);d.prototype.dispose=function(){this._rctx=null};d.prototype.takeScreenshot=function(a){var b=this;this._requestRenderScene();var c=g.createResolver(function(){b._screenshotQueue=b._screenshotQueue.filter(function(a){return a.resolver!==
c})});this._screenshotQueue.push({settings:a,resolver:c});return c.promise};d.prototype.update=function(a){if(0!==this._screenshotQueue.length){for(var b=0,c=this._screenshotQueue;b<c.length;b++){var d=c[b];if(this.isDisposed)d.resolver.reject();else{var e=l({},d.settings,{pixelRatio:d.settings.pixelRatio*a.viewCamera.pixelRatio}),g=this._ensureScreenshotEncodeCanvas(),h=this._renderScreenshot(a,e),e=f.encodeResult(h,e,g,{flipY:!0,premultipliedAlpha:!0});d.resolver(e)}}this._screenshotQueue=[]}};
d.prototype._renderScreenshotOverlay=function(b,c,d){if(!a.isNone(this._renderOverlay)){b.width=c.width;b.height=c.height;var e=b.getContext("2d"),f=d.pixelRatio;e.save();e.translate(0,c.height);e.scale(1,-1);d.region&&e.translate(-d.region.x,-d.region.y);e.scale(f,f);this._renderOverlay(b,c);e.restore()}};d.prototype._readbackScreenshot=function(a){return a.resample?this._readbackScreenshotResampled(a):this._readbackScreenshotImmediate(a)};d.prototype._readbackScreenshotResampled=function(a){var b=
a.framebufferWidth,c=a.framebufferHeight,d=a.region,e=a.resample,g=this._ensureScreenshotEncodeCanvas(),h=f.createEmptyImageData(b,c,g);this._rctx.gl.readPixels(0,0,b,c,6408,5121,new Uint8Array(h.data.buffer));this._renderScreenshotOverlay(g,h,l({},a,{region:null}));a=f.createEmptyImageData(d.width,d.height,g);return f.resampleHermite(h,a,!0,e.region.x,c-(e.region.y+e.region.height),e.region.width,e.region.height)};d.prototype._readbackScreenshotImmediate=function(a){var b=a.framebufferHeight,c=a.region,
d=this._ensureScreenshotEncodeCanvas(),e=f.createEmptyImageData(c.width,c.height,d);this._rctx.gl.readPixels(c.x,b-(c.y+c.height),c.width,c.height,6408,5121,new Uint8Array(e.data.buffer));this._renderScreenshotOverlay(d,e,a);return e};d.prototype._renderScreenshot=function(a,b){var d=null,e=a.viewCamera,f=b.framebufferWidth,g=b.framebufferHeight,h=!1,k=a.frameHasSlicePlane&&b.disableSlice;if(k=f!==e.fullWidth||g!==e.fullHeight||k){var l=e.clone();l.fullWidth=f;l.fullHeight=g;l.pixelRatio=b.pixelRatio;
d=e.fovX-l.fovX;h=e.fovY-l.fovY;0>d&&d<h?l.fovX=e.fovX:0>h&&h<d&&(l.fovY=e.fovY);a.drapedRenderer.forceUpdate&&a.drapedRenderer.forceUpdate(l);h=!0;d=new c(this._rctx,{width:l.fullWidth,height:l.fullHeight,colorTarget:0,depthStencilTarget:3});this._renderScene(d,l,b.disableSlice)}b=this._readbackScreenshot(b);if(k&&!this._rctx.contextAttributes.alpha)for(k=3;k<b.data.length;k+=4)b.data[k]=255;d&&d.dispose();this._rctx.bindFramebuffer(null);h&&a.drapedRenderer.forceUpdate&&a.drapedRenderer.forceUpdate(e);
return b};d.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return d=h([e.subclass("esri.views.3d.webgl-engine.parts.ScreenshotManager")],d)}(e.declared(d.AutoDisposable));b.ScreenshotManager=n})},"esri/views/3d/webgl-engine/shaders/globalOptions":function(){define(["require","exports","../../../webgl/programUtils"],function(n,b,l){Object.defineProperty(b,"__esModule",
{value:!0});b.glslifyGlobalOptions=function(b){return l.glslifyDefineMap({VIEWING_MODE:{value:b.viewingMode,options:{global:"VIEWING_MODE_GLOBAL",local:"VIEWING_MODE_LOCAL"}}})}})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error","../../core/has"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a={supportsMajorWebPerformanceCaveat:!1};b.check=function(b){b=l({},a,b);return h("esri-webgl")?
!b.supportsMajorWebPerformanceCaveat&&h("esri-webgl-major-performance-caveat")?new k("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):h("esri-webgl-high-precision-fragment")?h("esri-webgl-vertex-shader-samplers")?h("esri-webgl-element-index-uint")?h("esri-webgl-standard-derivatives")?h("esri-webgl-instanced-arrays")?null:new k("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):
new k("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new k("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new k("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new k("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new k("webgl:required",
"WebGL is required but not supported.")}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),function(n,b,l,k,h,a){return function(a){function b(b){b=a.call(this)||this;b.components=["attribution","zoom","navigation-toggle","compass"];return b}l(b,a);k([h.property()],b.prototype,"components",void 0);return b=k([h.subclass("esri.views.ui.3d.DefaultUI3D")],
b)}(h.declared(a))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),function(n,b,l,k,h,a,g,e,d,f,c,q){return function(b){function e(a){a=b.call(this)||this;a._defaultPositionLookup={attribution:"manual",compass:"top-leading",
"navigation-toggle":"top-leading",zoom:"top-leading"};a.components=[];return a}l(e,b);e.prototype.initialize=function(){this._handles.add([h.init(this,"components",this._componentsWatcher.bind(this)),h.init(this,"view",this._updateViewAwareWidgets.bind(this))])};e.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),a.destroy()})};e.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b.find(c))&&c.widget)&&
void 0!==c.view&&c.set("view",a)})};e.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};e.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};e.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),b._defaultPositionLookup[a])})};e.prototype._createComponent=function(a){var b=this._createWidget(a);
if(b)return new g({id:a,node:b})};e.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};e.prototype._createAttribution=function(){return new d({view:this.view})};e.prototype._createCompass=function(){return new f({view:this.view})};e.prototype._createNavigationToggle=function(){return new c({view:this.view})};
e.prototype._createZoom=function(){return new q({view:this.view})};k([a.property()],e.prototype,"components",void 0);return e=k([a.subclass("esri.views.ui.DefaultUI")],e)}(a.declared(e))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a,g){return function(b){function d(){var a=null!==b&&b.apply(this,
arguments)||this;a.widget=null;return a}l(d,b);d.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(d.prototype,"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"node",{set:function(a){var b=this._get("node");a!==b&&(a&&a.classList.add("esri-component"),b&&b.classList.remove("esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});
d.prototype.castNode=function(b){if(!b)return this._set("widget",null),null;if("string"===typeof b||b&&"nodeType"in b)return this._set("widget",null),a.byId(b);b&&"function"===typeof b.render&&!b.domNode&&(b.domNode=document.createElement("div"));this._set("widget",b);return b.domNode};k([g.property()],d.prototype,"id",null);k([g.property()],d.prototype,"node",null);k([g.cast("node")],d.prototype,"castNode",null);k([g.property({readOnly:!0})],d.prototype,"widget",void 0);return d=k([g.subclass("esri.views.ui.Component")],
d)}(g.declared(h))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ../../widgets/support/widgetUtils".split(" "),function(n,b,l,k,h,a,g,e,d,f,c,q){function p(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(c)||"declaredClass"in a||!("component"in
a||"index"in a||"position"in a)?null:a}function r(a,b){var c=b.bottom,d=b.left,e=b.right;a.style.top=b.top;a.style.bottom=c;a.style.left=d;a.style.right=e}var t={left:0,top:0,bottom:0,right:0},x={bottom:30,top:15,right:15,left:15};return function(b){function g(a){a=b.call(this)||this;a._cornerNameToContainerLookup={};a._positionNameToContainerLookup={};a._components=[];a._handles=new e;a._componentToKey=new Map;a.view=null;a._initContainers();return a}k(g,b);g.prototype.initialize=function(){this._handles.add([d.init(this,
"view.padding, container",this._applyViewPadding.bind(this)),d.init(this,"padding",this._applyUIPadding.bind(this))])};g.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy();this._componentToKey.clear();this._componentToKey=null};Object.defineProperty(g.prototype,"container",{set:function(b){var c=this._get("container");b!==c&&(b&&(b.classList.add("esri-ui"),this._attachContainers(b)),c&&(c.classList.remove("esri-ui"),
r(c,{top:"",bottom:"",left:"",right:""}),a.empty(c)),this._set("container",b))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",a):this._clearOverride("padding")},enumerable:!0,
configurable:!0});g.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:l({},x,a)};Object.defineProperty(g.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});g.prototype.add=function(a,b){var d=this,e,f;if(Array.isArray(a))a.forEach(function(a){return d.add(a,b)});else{var g=p(a);g&&(e=g.index,b=g.position,a=g.component,f=g.key);
b&&"object"===typeof b&&(e=b.index,f=b.key,b=b.position);!a||b&&!this._isValidPosition(b)||(a&&a.isInstanceOf&&a.isInstanceOf(c)||(a=new c({node:a})),this._place({component:a,position:b,index:e}),this._components.push(a),f&&this._componentToKey.set(a,f))}};g.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this.find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),d.node.parentNode&&
d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};g.prototype.empty=function(a){var b=this;if(Array.isArray(a))return a.map(function(a){return b.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!a.classList.contains("esri-ui-corner")}).map(function(a){return b.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this)};g.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,e=p(a)||p(b);e&&(d=e.index,b=e.position,a=e.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};g.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(c)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};g.prototype._getViewPadding=function(){return this.get("view.padding")||
t};g.prototype._attachContainers=function(a){a.appendChild(this._innerContainer);a.appendChild(this._manualContainer)};g.prototype._initContainers=function(){var a=document.createElement("div");a.classList.add("esri-ui-inner-container");a.classList.add("esri-ui-corner-container");var b=document.createElement("div");b.classList.add("esri-ui-inner-container");b.classList.add("esri-ui-manual-container");var c=document.createElement("div");c.classList.add("esri-ui-top-left");c.classList.add("esri-ui-corner");
a.appendChild(c);var d=document.createElement("div");d.classList.add("esri-ui-top-right");d.classList.add("esri-ui-corner");a.appendChild(d);var e=document.createElement("div");e.classList.add("esri-ui-bottom-left");e.classList.add("esri-ui-corner");a.appendChild(e);var f=document.createElement("div");f.classList.add("esri-ui-bottom-right");f.classList.add("esri-ui-corner");a.appendChild(f);this._innerContainer=a;this._manualContainer=b;a=q.isRTL();this._cornerNameToContainerLookup={"top-left":c,
"top-right":d,"bottom-left":e,"bottom-right":f,"top-leading":a?d:c,"top-trailing":a?c:d,"bottom-leading":a?f:e,"bottom-trailing":a?e:f};this._positionNameToContainerLookup=l({manual:b},this._cornerNameToContainerLookup)};g.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};g.prototype._place=function(b){var c=b.component,d=b.index;b=this._positionNameToContainerLookup[b.position||"manual"];var e=-1<d,f=c.widget;f&&!f._started&&"function"===typeof f.postMixInProperties&&
"function"===typeof f.buildRendering&&"function"===typeof f.postCreate&&"function"===typeof f.startup&&c.widget.startup();e?(e=Array.prototype.slice.call(b.children),0===d?b.firstChild?a.insertBefore(c.node,b.firstChild):b.appendChild(c.node):d>=e.length?b.appendChild(c.node):a.insertBefore(c.node,e[d])):b.appendChild(c.node)};g.prototype._applyViewPadding=function(){var a=this.container;a&&r(a,this._toPxPosition(this._getViewPadding()))};g.prototype._applyUIPadding=function(){var a=this._innerContainer;
a&&r(a,this._toPxPosition(this.padding))};g.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};g.prototype._toPxUnit=function(a){return 0===a?"0":a+"px"};g.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=d===a)&&(b=d);return c});return b};g.prototype._findById=function(a){var b=null,c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});
return b};g.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};h([f.property()],g.prototype,"container",null);h([f.property({dependsOn:["view.height"]})],g.prototype,"height",null);h([f.property({value:x})],g.prototype,"padding",null);h([f.cast("padding")],g.prototype,"castPadding",null);h([f.property()],g.prototype,"view",void 0);h([f.property({dependsOn:["view.width"]})],g.prototype,"width",null);return g=h([f.subclass("esri.views.ui.UI")],
g)}(f.declared(g.EventedAccessor))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),function(n,b,l,k,h,a,g,e,d,f){return function(b){function c(a){a=b.call(this)||this;a._isOpen=!1;a._attributionTextOverflowed=!1;a._prevSourceNodeHeight=0;a.iconClass=
"esri-icon-description";a.itemDelimiter=" | ";a.label=h.widgetLabel;a.view=null;a.viewModel=new d;return a}l(c,b);c.prototype.postInitialize=function(){var b=this;this.own(a.on(this,"viewModel.items","change",function(){return b.scheduleRender()}))};Object.defineProperty(c.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0});c.prototype.render=function(){var a,
b=(a={},a["esri-attribution--open"]=this._isOpen,a);return f.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",b),onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),f.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",f.tsx("a",{class:this.classes("esri-attribution__link","esri-widget__anchor"),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri")))};c.prototype._renderSourcesNode=function(){var a,b=this._isOpen,c=this._isInteractive(),
d=c?0:-1,e=this.attributionText,g=c?"button":void 0,b=(a={},a["esri-attribution__sources--open"]=b,a["esri-interactive"]=c,a);return f.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",b),innerHTML:e,role:g,tabIndex:d})};c.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=a.clientWidth};c.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=
a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};c.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};c.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};k([g.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),f.renderable()],
c.prototype,"attributionText",null);k([g.property()],c.prototype,"iconClass",void 0);k([g.property(),f.renderable()],c.prototype,"itemDelimiter",void 0);k([g.property()],c.prototype,"label",void 0);k([g.aliasOf("viewModel.view")],c.prototype,"view",void 0);k([g.property({type:d}),f.renderable(["state","view.size"])],c.prototype,"viewModel",void 0);k([f.accessibleHandler()],c.prototype,"_toggleState",null);return c=k([g.subclass("esri.widgets.Attribution")],c)}(g.declared(e))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/generatorHelper ../../geometry ../../core/arrayUtils ../../core/Collection ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})}function x(a,b,c){c&&b&&(e.find(a,function(a){return a.layerView===b&&a.text===c})||a.push({text:c,layerView:b}))}var w=[];return function(b){function e(a){var e=b.call(this,a)||this;e.clear=function(){e._fetchedAttributionData.clear();e._pendingAttributions.clear();e.handles.remove("suspension");e.notifyChange("state")};e._pendingAttributions=new Set;e._fetchedAttributionData=
new Map;e.items=new d;e.view=null;e._allLayerViewsChange=function(a){e.handles.remove("suspension");var b=e.get("view.allLayerViews");b&&e.handles.add(b.map(function(a){return a.watch(["suspended","attributionVisible"],e._updateAttributionItems)}),"suspension");a&&a.removed&&a.removed.forEach(function(a){e._pendingAttributions.delete(a);e._fetchedAttributionData.delete(a)});e._updateAttributionItems()};e._updateAttributionItems=function(){var a=e.get("view.allLayerViews");w.length=0;a?(a.forEach(function(a){if(!a.suspended&&
a.get("layer.attributionVisible")){var b=a.layer;if(b&&"function"===typeof b.originOf&&"user"===b.originOf("copyright"))x(w,a,b.copyright);else if(b.hasAttributionData)if(e._fetchedAttributionData.has(a)){var c=e._fetchedAttributionData.get(a);c&&x(w,a,e._getDynamicAttribution(c,e.view,b))}else e._fetchAttributionData(a);else(c=b.get("portalItem.accessInformation"))?x(w,a,c):x(w,a,b.copyright)}}),t(e.items,w)&&(e.items.removeAll(),e.items.addMany(w)),e.notifyChange("state")):e.clear()};e.handles.add([c.on(e,
"view.allLayerViews","change",e._allLayerViewsChange,e._allLayerViewsChange,e.clear),c.whenTrue(e,"view.stationary",function(){return e._updateAttributionItems()})]);return e}l(e,b);e.prototype.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear()};Object.defineProperty(e.prototype,"state",{get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"},enumerable:!0,configurable:!0});e.prototype._fetchAttributionData=
function(b){return h(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:if(this._pendingAttributions.has(b))return[2];this._pendingAttributions.add(b);c=null;a.label=1;case 1:return a.trys.push([1,3,,4]),[4,b.layer.fetchAttributionData()];case 2:return d=a.sent(),c=this._createContributionIndex(d,"bing-maps"===b.layer.type),[3,4];case 3:return a.sent(),[3,4];case 4:return this._pendingAttributions.has(b)&&(this._pendingAttributions.delete(b),this._fetchedAttributionData.set(b,
c)),this._updateAttributionItems(),[2]}})})};e.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;for(var d=0;d<a.length;d++){var e=a[d],f=e.coverageAreas;if(!f)return;for(var h=0;h<f.length;h++)for(var k=f[h],l=k.bbox,m=k.zoomMin-(b&&k.zoomMin?1:0),n=k.zoomMax-(b&&k.zoomMax?1:0),k={extent:r.geographicToWebMercator({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:g.SpatialReference.WGS84}),attribution:e.attribution||"",score:null!=k.score?k.score:100,
id:d};m<=n;m++)c[m]=c[m]||[],c[m].push(k)}c.maxKey=Math.max.apply(null,Object.keys(c));return c};e.prototype._getDynamicAttribution=function(a,b,c){var d=b.extent;c=c.tileInfo.scaleToZoom(b.scale);c=Math.min(a.maxKey,Math.round(c));if(!d||null==c||-1>=c)return"";a=a[c];var e=r.project(d.center.clone().normalize(),b.spatialReference),f={};return a?a.filter(function(a){var b=!f[a.id]&&e&&p.extentContainsPoint(a.extent,e);b&&(f[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-
b.objectId}).map(function(a){return a.attribution}).join(", "):""};k([q.property({readOnly:!0,type:d})],e.prototype,"items",void 0);k([q.property({dependsOn:["view.ready"],readOnly:!0})],e.prototype,"state",null);k([q.property()],e.prototype,"view",void 0);return e=k([q.subclass("esri.widgets.Attribution.AttributionViewModel")],e)}(q.declared(f.HandleOwner))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),
function(n,b,l,k,h,a,g,e,d){return function(b){function c(a){a=b.call(this)||this;a.goToOverride=null;a.iconClass="esri-icon-locate-circled";a.label=h.widgetLabel;a.view=null;a.viewModel=new e;return a}l(c,b);c.prototype.reset=function(){};c.prototype.render=function(){var a,b,c=this.viewModel,e=c.orientation,c=c.state,f="disabled"===c,g="compass"===("rotation"===c?"rotation":"compass"),c=f?-1:0,f=(a={},a["esri-disabled"]=f,a["esri-interactive"]=!f,a);a=(b={},b["esri-icon-compass"]=g,b["esri-icon-dial"]=
!g,b);return d.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",f),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:c,"aria-label":h.reset,title:h.reset},d.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(e)}),d.tsx("span",{class:"esri-icon-font-fallback-text"},h.reset))};c.prototype._reset=function(){this.viewModel.reset()};c.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+
a.z+"deg)"}};k([a.aliasOf("viewModel.goToOverride")],c.prototype,"goToOverride",void 0);k([a.property()],c.prototype,"iconClass",void 0);k([a.property()],c.prototype,"label",void 0);k([a.aliasOf("viewModel.view")],c.prototype,"view",void 0);k([a.property({type:e}),d.renderable(["viewModel.orientation","viewModel.state"])],c.prototype,"viewModel",void 0);k([a.aliasOf("viewModel.reset")],c.prototype,"reset",null);k([d.accessibleHandler()],c.prototype,"_reset",null);return c=k([a.subclass("esri.widgets.Compass")],
c)}(a.declared(g))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),function(n,b,l,k,h,a,g,e,d){return function(b){function c(c){c=b.call(this,c)||this;c._handles=new a;c.orientation={x:0,y:0,z:0};c.view=null;c._updateForCamera=c._updateForCamera.bind(c);c._updateForRotation=
c._updateForRotation.bind(c);c._updateRotationWatcher=c._updateRotationWatcher.bind(c);c.view;return c}l(c,b);c.prototype.initialize=function(){this._handles.add(g.init(this,"view",this._updateRotationWatcher))};c.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(c.prototype,"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return!(!a||!a.isWebMercator&&!a.isGeographic)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});c.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};c.prototype._updateForRotation=function(a){void 0!==a&&null!==a&&(this.orientation={z:a})};c.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};c.prototype._updateRotationWatcher=function(a){this._handles.removeAll();
a&&("2d"===a.type?this._handles.add(g.init(this,"view.rotation",this._updateForRotation)):this._handles.add(g.init(this,"view.camera",this._updateForCamera)))};k([e.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],c.prototype,"canShowNorth",null);k([e.property()],c.prototype,"orientation",void 0);k([e.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],c.prototype,"state",null);k([e.property()],c.prototype,"view",void 0);k([e.property()],
c.prototype,"reset",null);return c=k([e.subclass("esri.widgets.CompassViewModel")],c)}(e.declared(d.GoToMixin(h)))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),function(n,b,l,k,h,a,g,e,d){return function(b){function c(a){a=b.call(this)||
this;a.iconClass="esri-icon-pan2";a.label=h.widgetLabel;a.view=null;a.viewModel=new e;return a}l(c,b);Object.defineProperty(c.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});c.prototype.toggle=function(){};c.prototype.render=function(){var a,b,c,e="disabled"===this.get("viewModel.state"),f="pan"===this.get("viewModel.navigationMode"),g=(a={},a["esri-disabled"]=e,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,
a);a=(b={},b["esri-navigation-toggle__button--active"]=f,b);b=(c={},c["esri-navigation-toggle__button--active"]=!f,c);c=e?-1:0;return d.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",g),onclick:this._toggle,onkeydown:this._toggle,tabIndex:c,"aria-label":h.toggle,title:h.toggle},d.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",a)},d.tsx("span",{class:"esri-icon-pan"})),d.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",b)},d.tsx("span",{class:"esri-icon-rotate"})))};c.prototype._toggle=function(){this.toggle()};k([a.property()],c.prototype,"iconClass",void 0);k([a.property()],c.prototype,"label",void 0);k([a.property({value:"vertical"}),d.renderable()],c.prototype,"layout",null);k([a.aliasOf("viewModel.view"),d.renderable()],c.prototype,"view",void 0);k([a.property({type:e}),d.renderable(["viewModel.state","viewModel.navigationMode"])],c.prototype,"viewModel",void 0);k([a.aliasOf("viewModel.toggle")],
c.prototype,"toggle",null);k([d.accessibleHandler()],c.prototype,"_toggle",null);return c=k([a.subclass("esri.widgets.NavigationToggle")],c)}(a.declared(g))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a,g,e){return function(b){function d(c){c=
b.call(this,c)||this;c._handles=new a;c.navigationMode="pan";c.view=null;c.toggle=c.toggle.bind(c);return c}l(d,b);d.prototype.initialize=function(){this._handles.add(g.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};d.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"},enumerable:!0,configurable:!0});d.prototype.toggle=
function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};d.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};k([e.property({dependsOn:["view.ready"],readOnly:!0})],d.prototype,"state",null);k([e.property()],d.prototype,"navigationMode",void 0);k([e.property()],d.prototype,"view",void 0);k([e.property()],d.prototype,"toggle",null);return d=k([e.subclass("esri.widgets.NavigationToggleViewModel")],
d)}(e.declared(h))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(n,b,l,k,h,a,g,e,d,f){return function(b){function c(a){a=b.call(this)||this;a.iconClass="esri-icon-zoom-in-magnifying-glass";a.label=h.widgetLabel;a.view=null;a.viewModel=new d;return a}l(c,b);c.prototype.postInitialize=
function(){this._zoomInButton=new e({action:this.zoomIn,iconClass:"esri-icon-plus",title:h.zoomIn});this._zoomOutButton=new e({action:this.zoomOut,iconClass:"esri-icon-minus",title:h.zoomOut})};Object.defineProperty(c.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});c.prototype.render=function(){var a,b=this.viewModel,c=(a={},a["esri-zoom--horizontal"]="horizontal"===this.layout,a);this._zoomInButton.enabled="ready"===b.state&&
b.canZoomIn;this._zoomOutButton.enabled="ready"===b.state&&b.canZoomOut;return f.tsx("div",{class:this.classes("esri-zoom esri-widget",c)},this._zoomInButton.render(),this._zoomOutButton.render())};c.prototype.zoomIn=function(){};c.prototype.zoomOut=function(){};k([a.property()],c.prototype,"iconClass",void 0);k([a.property()],c.prototype,"label",void 0);k([a.property({value:"vertical"}),f.renderable()],c.prototype,"layout",null);k([a.aliasOf("viewModel.view"),f.renderable()],c.prototype,"view",void 0);
k([a.property({type:d}),f.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],c.prototype,"viewModel",void 0);k([a.aliasOf("viewModel.zoomIn")],c.prototype,"zoomIn",null);k([a.aliasOf("viewModel.zoomOut")],c.prototype,"zoomOut",null);return c=k([a.subclass("esri.widgets.Zoom")],c)}(a.declared(g))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(n,b,l,k,h,a,g){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.enabled=!0;b.iconClass="";b.title="";return b}l(b,a);b.prototype.render=function(){var a,b,d=this.enabled?0:-1,e=(a={},a["esri-disabled"]=!this.enabled,a["esri-interactive"]=this.enabled,a);a=(b={},b[this.iconClass]=!!this.iconClass,b);return g.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",e),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:d,
title:this.title},g.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",a)}),g.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};b.prototype._triggerAction=function(){this.action.call(this)};k([h.property()],b.prototype,"action",void 0);k([h.property(),g.renderable()],b.prototype,"enabled",void 0);k([h.property(),g.renderable()],b.prototype,"iconClass",void 0);k([h.property(),g.renderable()],b.prototype,"title",void 0);k([g.accessibleHandler()],b.prototype,
"_triggerAction",null);return b=k([h.subclass("esri.widgets.IconButton")],b)}(h.declared(a))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(n,b,l,k,h,a,g,e){return function(b){function d(a){a=b.call(this,a)||this;a.canZoomIn=!1;a.canZoomOut=!1;a.zoomIn=a.zoomIn.bind(a);a.zoomOut=a.zoomOut.bind(a);
return a}l(d,b);d.prototype.destroy=function(){this.view=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new g({view:a}):"3d"===a.type&&(this._zoomConditions=new e({view:a})):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});d.prototype.zoomIn=function(){if(this.canZoomIn){var a=
this.view;"2d"===a.type?a.mapViewNavigation.zoomIn():a.goTo({zoomFactor:2})}};d.prototype.zoomOut=function(){if(this.canZoomOut){var a=this.view;"2d"===a.type?a.mapViewNavigation.zoomOut():a.goTo({zoomFactor:.5})}};k([a.property()],d.prototype,"_zoomConditions",void 0);k([a.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],d.prototype,"canZoomIn",void 0);k([a.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],d.prototype,"canZoomOut",void 0);k([a.property({dependsOn:["view.ready"],
readOnly:!0})],d.prototype,"state",null);k([a.property()],d.prototype,"view",null);k([a.property()],d.prototype,"zoomIn",null);k([a.property()],d.prototype,"zoomOut",null);return d=k([a.subclass("esri.widgets.Zoom.ZoomViewModel")],d)}(a.declared(h))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a){return function(b){function e(){return null!==
b&&b.apply(this,arguments)||this}l(e,b);Object.defineProperty(e.prototype,"canZoomIn",{get:function(){if(!this.get("view.ready"))return!1;var a=this.get("view.animation.target.scale")||this.get("view.scale"),b=this.get("view.constraints.effectiveMaxScale");return 0===b||a>b},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"canZoomOut",{get:function(){if(!this.get("view.ready"))return!1;var a=this.get("view.animation.target.scale")||this.get("view.scale"),b=this.get("view.constraints.effectiveMinScale");
return 0===b||a<b},enumerable:!0,configurable:!0});k([a.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMaxScale"],readOnly:!0})],e.prototype,"canZoomIn",null);k([a.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMinScale"],readOnly:!0})],e.prototype,"canZoomOut",null);k([a.property()],e.prototype,"view",void 0);return e=k([a.subclass("esri.widgets.Zoom.ZoomConditions2D")],e)}(a.declared(h))})},
"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a){return function(b){function e(){return null!==b&&b.apply(this,arguments)||this}l(e,b);Object.defineProperty(e.prototype,"canZoomIn",{get:function(){return!!this.get("view.ready")},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"canZoomOut",
{get:function(){return!!this.get("view.ready")},enumerable:!0,configurable:!0});k([a.property({dependsOn:["view.ready"],readOnly:!0})],e.prototype,"canZoomIn",null);k([a.property({dependsOn:["view.ready"],readOnly:!0})],e.prototype,"canZoomOut",null);k([a.property()],e.prototype,"view",void 0);return e=k([a.subclass("esri.widgets.Zoom.ZoomConditions3D")],e)}(a.declared(h))})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../PopupTemplate ../renderers ../request ../core/asyncUtils ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../support/popupUtils ../tasks/support/Query".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T,U,Y,X,P,V,Z,ca,da,F){function ea(a,b,c){a&&((a=Z.read(a,b,c)||void 0)||ka.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var la=["3DObject","Point"],ka=p.getLogger("esri.layers.SceneLayer"),oa=R.defineFieldProperties(),va={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",
polygons:"polygons","features-polygons":"polygons"},fa={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(b){function p(a,c){a=b.call(this)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=null;a.outFields=null;a.nodePages=null;a.materialDefinitions=null;a.textureSetDefinitions=null;a.geometryDefinitions=null;a.serviceUpdateTimeStamp=null;a.definitionExpression=null;a.path=null;a.labelsVisible=
!0;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=!0;return a}k(p,b);p.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?l({url:a},b):a};p.prototype.getField=function(a){return this.fieldsIndex.get(a)};p.prototype.getFieldDomain=function(a){return(a=this.getField(a))&&a.domain?a.domain:null};Object.defineProperty(p.prototype,
"fieldsIndex",{get:function(){return new S(this.fields)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"geometryType",{get:function(){return fa[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"renderer",{set:function(a){T.fixRendererFields(a,this.fields);this._set("renderer",
a)},enumerable:!0,configurable:!0});p.prototype.readCachedDrawingInfo=function(a,b){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};Object.defineProperty(p.prototype,"defaultPopupTemplate",{get:function(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null},enumerable:!0,configurable:!0});p.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};
p.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&va[a])return va[a];ka.error("Unknown or missing profile",{profile:a,layer:this});return"mesh-pyramids"};p.prototype.load=function(a){var b=this,d=r.isSome(a)?a.signal:null;a=c.safeCast(this.loadFromPortal({supportedTypes:["Scene Service"]},a)).then(function(){return c.safeCast(b._fetchService(d))},function(){return c.safeCast(b._fetchService(d))}).then(function(){return x.all([b._verifyRootNodeAndUpdateExtent(b.nodePages,d),b._setAssociatedFeatureLayer(d)])}).then(function(){return b._validateElevationInfo()}).then(function(){return b._applyAssociatedLayerOverrides()}).then(function(){return b._populateFieldUsageInfo()}).then(function(){return ca.loadStyleRenderer(b,
{origin:"service"},d)}).then(function(){return T.fixRendererFields(b.renderer,b.fields)});this.addResolvingPromise(a);return this.when()};p.prototype.importLayerViewModule=function(b){return g(this,void 0,void 0,function(){return a(this,function(a){return"2d"===b.type?[2,x.reject(new q("scene-layer:view-not-supported","SceneLayer is only supported in 3D"))]:null==this.profile||"mesh-pyramids"===this.profile?[2,x.create(function(a){return n(["../views/3d/layers/SceneLayerView3D"],a)})]:[2,x.create(function(a){return n(["../views/3d/layers/SceneLayerGraphicsView3D"],
a)})]})})};p.prototype.createQuery=function(){var a=new F;"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};p.prototype.queryExtent=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryExtent(a||c.createQuery(),b)})};p.prototype.queryFeatureCount=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatureCount(a||c.createQuery(),
b)})};p.prototype.queryFeatures=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatures(a||c.createQuery(),b)}).then(function(a){if(a&&a.features)for(var b=0,d=a.features;b<d.length;b++){var e=d[b];e.layer=c;e.sourceLayer=c}return a})};p.prototype.queryObjectIds=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryObjectIds(a||c.createQuery(),b)})};p.prototype.getFieldUsageInfo=function(a){var b={supportsLabelingInfo:!1,
supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||b:(ka.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),b)};p.prototype.createPopupTemplate=function(a){return da.createPopupTemplate(this,a)};p.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var b=this.associatedLayer;return null!=b?x.resolve(b):x.reject(new q("scenelayer:query-not-available",
"SceneLayer queries are not available without associated feature layer"))};p.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};p.prototype.queryCachedStatistics=function(b,c){return g(this,void 0,void 0,function(){var d,e,g,h,k;return a(this,function(a){switch(a.label){case 0:return[4,this.load(c)];case 1:a.sent();if(!this.statisticsInfo)throw new q("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");
d=this.fieldsIndex.get(b);if(!d)throw new q("scenelayer:field-unexisting","Field '"+b+"' does not exist on the layer");e=0;for(g=this.statisticsInfo;e<g.length;e++)if(h=g[e],h.name===d.name)return k=w.join(this.parsedUrl.path,h.href),[2,f(k,{query:{f:"json"},responseType:"json",signal:c?c.signal:null}).then(function(a){return a.data})];throw new q("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");}})})};p.prototype._validateLayer=function(a){if(a.layerType&&
-1===la.indexOf(a.layerType))throw new q("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new q("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new q("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,
supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,c=!1,d=!1;if(null==a)d=c=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":c=!0;d=b;break;case "vertex-reference-frame":c=!0;d=!b;break;default:c=!1}if(!c)throw new q("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!d)throw new q("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");
};p.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||d,supportsLayerQuery:d}},b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};p.prototype._applyAssociatedLayerOverrides=
function(){if(this.associatedLayer){if(this.associatedLayer.fields){for(var a=null,b=0,c=this.associatedLayer.fields;b<c.length;b++){var d=c[b];this.getField(d.name)||(a||(a=this.fields?this.fields.slice():[]),a.push(d.clone()))}a&&this._set("fields",a)}a=["popupTemplate","popupEnabled"];b=v.getProperties(this);for(c=0;c<a.length;c++)d=a[c],this._buddyIsMoreImportant(d)&&(b.setDefaultOrigin(this.associatedLayer.originOf(d)),b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}};p.prototype._setAssociatedFeatureLayer=
function(b){return g(this,void 0,void 0,function(){var c;return a(this,function(a){switch(a.label){case 0:return[4,this._fetchAssociatedFeatureLayer(b)];case 1:return this.associatedLayer=c=a.sent(),[2]}})})};p.prototype._fetchAssociatedFeatureLayer=function(b){return g(this,void 0,void 0,function(){var c;return a(this,function(a){switch(a.label){case 0:if(-1===["mesh-pyramids","points"].indexOf(this.profile))return[2,null];a.label=1;case 1:return a.trys.push([1,4,,5]),[4,this.portalItem&&this.portalItem.isResolved()?
this._fetchAssociatedFeatureLayerFromRelatedItems(this.portalItem,b):this._fetchAssociatedFeatureLayerFromUrl(b)];case 2:return c=a.sent(),[4,c.load({signal:b})];case 3:return[2,a.sent()];case 4:return a.sent(),this._logWarningOnPopupEnabled(),[2,null];case 5:return[2]}})})};p.prototype._logWarningOnPopupEnabled=function(){var a=this;u.whenValidOnce(this,["popupTemplate","popupEnabled"],function(){return a.popupEnabled&&null!=a.popupTemplate}).then(function(){return function(){var b="this SceneLayer: "+
a.title;null==a.attributeStorageInfo?ka.warn("Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on "+b):ka.info("Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on "+b)}})};p.prototype._fetchAssociatedFeatureLayerFromRelatedItems=function(b,c){return g(this,void 0,void 0,function(){var d,e;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),[4,b.fetchRelatedItems({relationshipType:"Service2Service",
direction:"reverse"},{signal:c})];case 1:return d=a.sent(),(e=d.filter(function(a){return"Feature Service"===a.type})[0])?[4,this._fetchAssociatedFeatureLayerFromPortalItem(new V({id:e.id,portal:e.portal}),c)]:[3,3];case 2:return[2,a.sent()];case 3:throw Error();case 4:return a.sent(),[2,this._fetchAssociatedFeatureLayerFromUrl(c)];case 5:return[2]}})})};p.prototype._fetchAssociatedFeatureLayerFromPortalItem=function(b,c){return g(this,void 0,void 0,function(){var d;return a(this,function(a){switch(a.label){case 0:return[4,
b.load({signal:c})];case 1:return a.sent(),[4,this._findMatchingAssociatedSublayerUrl(b.url,c)];case 2:return d=a.sent(),[2,new z({url:d,portalItem:b})]}})})};p.prototype._fetchAssociatedFeatureLayerFromUrl=function(b){return g(this,void 0,void 0,function(){var c;return a(this,function(a){switch(a.label){case 0:return[4,this._findMatchingAssociatedSublayerUrl(null,b)];case 1:return c=a.sent(),[2,new z({url:c})]}})})};p.prototype._findMatchingAssociatedSublayerUrl=function(b,c){void 0===b&&(b=null);
return g(this,void 0,void 0,function(){var d,e,g,h,k,l,m,p,n,q,r,v,u,t;return a(this,function(a){switch(a.label){case 0:d=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!d)return[2,x.reject()];null==b&&(b=d[1]+"/FeatureServer");e=b.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");g={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:c};h=d[1]+"/SceneServer";k=parseInt(d[2],10);l=f(h,g).catch(function(a){return{data:{layers:null}}});m=f(e,g);return[4,x.all([m,
l])];case 1:p=a.sent();n=p[0];q=p[1];r=q.data&&q.data.layers;v=n.data&&n.data.layers;if(!Array.isArray(v))throw Error("expected layers array");if(Array.isArray(r))for(u=0;u<Math.min(r.length,v.length);u++){if(t=r[u],t.id===k)return[2,e+"/"+v[u].id]}else if(k<v.length)return[2,e+"/"+v[k].id];throw Error("could not find matching associated sublayer");}})})};p.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=m.nameToId(this.originOf(a));a=m.nameToId(this.associatedLayer.originOf(a));
return null!=a&&a<=m.OriginId.SERVICE?null==b||b<m.OriginId.SERVICE:null!=a&&a<=m.OriginId.PORTAL_ITEM?null==b||b<m.OriginId.PORTAL_ITEM:!1};p.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&ka.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&ka.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};
h([y.property({types:{key:"type",base:L.default,typeMap:{selection:M.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],p.prototype,"featureReduction",void 0);h([y.property({type:[P.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],p.prototype,"rangeInfos",void 0);h([y.property({json:{read:!1}})],p.prototype,"associatedLayer",
void 0);h([y.property({type:["show","hide"]})],p.prototype,"listMode",void 0);h([y.property({type:["ArcGISSceneServiceLayer"]})],p.prototype,"operationalLayerType",void 0);h([y.property({json:{read:!1},readOnly:!0})],p.prototype,"type",void 0);h([y.property(l({},oa.fields,{readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}}))],p.prototype,"fields",void 0);h([y.property({readOnly:!0,dependsOn:["fields"]})],p.prototype,"fieldsIndex",null);h([y.property(oa.outFields)],p.prototype,"outFields",void 0);
h([y.property({type:U.I3SNodePageDefinition,readOnly:!0})],p.prototype,"nodePages",void 0);h([y.property({type:[U.I3SMaterialDefinition],readOnly:!0})],p.prototype,"materialDefinitions",void 0);h([y.property({type:[U.I3STextureSetDefinition],readOnly:!0})],p.prototype,"textureSetDefinitions",void 0);h([y.property({type:[U.I3SGeometryDefinition],readOnly:!0})],p.prototype,"geometryDefinitions",void 0);h([y.property({readOnly:!0})],p.prototype,"serviceUpdateTimeStamp",void 0);h([y.property({readOnly:!0})],
p.prototype,"attributeStorageInfo",void 0);h([y.property({readOnly:!0})],p.prototype,"statisticsInfo",void 0);h([y.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],p.prototype,"definitionExpression",void 0);h([y.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],p.prototype,"path",void 0);h([y.property(J.elevationInfo)],p.prototype,"elevationInfo",
null);h([y.property({type:String,dependsOn:["profile"]})],p.prototype,"geometryType",null);h([y.property(J.labelsVisible)],p.prototype,"labelsVisible",void 0);h([y.property({type:[Y],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:X.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:X.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],p.prototype,"labelingInfo",void 0);h([y.property(J.legendEnabled)],
p.prototype,"legendEnabled",void 0);h([y.property(J.opacityDrawingInfo)],p.prototype,"opacity",void 0);h([y.property({types:d.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:ea}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:ea},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],p.prototype,"renderer",null);h([y.property({json:{read:!1}})],p.prototype,"cachedDrawingInfo",void 0);h([y.reader("service","cachedDrawingInfo")],p.prototype,
"readCachedDrawingInfo",null);h([y.property(J.popupEnabled)],p.prototype,"popupEnabled",void 0);h([y.property({type:e,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],p.prototype,"popupTemplate",void 0);h([y.property({readOnly:!0,json:{read:!1},dependsOn:["fields","title","attributeStorageInfo","associatedLayer"]})],p.prototype,"defaultPopupTemplate",null);h([y.property({type:String,json:{read:!1}})],p.prototype,"objectIdField",void 0);h([y.reader("service","objectIdField",["objectIdField",
"fields"])],p.prototype,"readObjectIdField",null);h([y.property({json:{read:!1}})],p.prototype,"objectIdFilter",void 0);h([y.property({type:String,json:{read:!1}})],p.prototype,"profile",void 0);h([y.reader("service","profile",["store.profile"])],p.prototype,"readProfile",null);h([y.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],p.prototype,"normalReferenceFrame",void 0);h([y.property(N.screenSizePerspectiveEnabled)],p.prototype,
"screenSizePerspectiveEnabled",void 0);return p=h([y.subclass("esri.layers.SceneLayer")],p)}(y.declared(I.ScaleRangeLayer(Q.SceneService(C.ArcGISService(D.OperationalLayer(K.PortalLayer(t.MultiOriginJSONMixin(B))))))))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w){Object.defineProperty(b,"__esModule",{value:!0});var u=d.getLogger("esri.layers.mixins.SceneService");b.SceneService=function(b){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.minScale=0;a.maxScale=0;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}
l(d,b);d.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};d.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return t.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new t(a):null};d.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent||!Array.isArray(a.extent)||a.extent.some(function(a){return a<
y})?null:new p({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})};d.prototype.readVersion=function(a,b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};d.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a};d.prototype.readTitleService=function(a,b){a=this.portalItem&&
this.portalItem.title;if("item-title"===this.sublayerTitleMode)return x.titleFromUrlAndName(this.url,b.name);b=b.name||x.parse(this.url).title;"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return x.cleanTitle(b)};d.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(d.prototype,"url",{set:function(a){a=x.sanitizeUrlWithLayerId(this,a,u);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});d.prototype.writeUrl=
function(a,b,c,d){x.writeUrlWithLayerId(this,a,"layers",b,d)};Object.defineProperty(d.prototype,"parsedUrl",{get:function(){var a=this._get("url");if(!a)return null;a=c.urlToObject(a);null!=this.layerId&&x.match.test(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});d.prototype._verifyRootNodeAndUpdateExtent=function(b,c){return a(this,void 0,void 0,function(){var a,d,e;return h(this,function(f){switch(f.label){case 0:if(!b)return[3,4];f.label=1;case 1:return f.trys.push([1,
3,,4]),a=this._updateExtentFromRootPage,d=[b],[4,this._fetchRootPage(b,c)];case 2:return[2,a.apply(this,d.concat([f.sent()]))];case 3:return f.sent(),[3,4];case 4:return e=this._updateExtentFromRootNode,[4,this._fetchRootNode(c)];case 5:return[2,e.apply(this,[f.sent()])]}})})};d.prototype._fetchRootPage=function(b,c){return a(this,void 0,void 0,function(){var a,d,e;return h(this,function(h){switch(h.label){case 0:if(!b)return[2,f.reject()];a=Math.floor(b.rootIndex/b.nodesPerPage);d=this.parsedUrl.path+
"/nodepages/"+a;return[4,g(d,{responseType:"json",signal:c})];case 1:return e=h.sent(),[2,e.data]}})})};d.prototype._updateExtentFromRootPage=function(a,b){if(null==b||null==b.nodes)throw new e("sceneservice:invalid-node-page","Inavlid node page.");b=b.nodes[a.rootIndex%a.nodesPerPage];if(null==b||null==b.obb||null==b.obb.center||null==b.obb.halfSize)throw new e("sceneservice:invalid-node-page","Inavlid node page.");a=b.obb.halfSize;b=b.obb.center[2];a=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);this.fullExtent.zmin=
b-a;this.fullExtent.zmax=b+a};d.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};d.prototype._fetchRootNode=function(b){return a(this,void 0,void 0,function(){var a,d,f;return h(this,function(h){switch(h.label){case 0:if(!this.rootNode)return[2];a=c.join(this.parsedUrl.path,this.rootNode);h.label=1;case 1:return h.trys.push([1,
3,,4]),[4,g(a,{query:{f:"json"},responseType:"json",signal:b})];case 2:return d=h.sent(),[2,d.data];case 3:throw f=h.sent(),new e("sceneservice:root-node-missing","Root node missing.",{error:f,url:a});case 4:return[2]}})})};d.prototype._fetchService=function(b){return a(this,void 0,void 0,function(){var a;return h(this,function(c){switch(c.label){case 0:return null==this.layerId&&/SceneServer\/*$/i.test(this.url)?[4,this._fetchFirstLayerId(b)]:[3,2];case 1:a=c.sent(),null!=a&&(this.layerId=a),c.label=
2;case 2:return[2,this._fetchServiceLayer(b)]}})})};d.prototype._fetchFirstLayerId=function(b){return a(this,void 0,void 0,function(){var a;return h(this,function(c){switch(c.label){case 0:return[4,g(this.url,{query:{f:"json"},responseType:"json",signal:b})];case 1:return a=c.sent(),a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length?[2,a.data.layers[0].id]:[2,void 0]}})})};d.prototype._fetchServiceLayer=function(b){return a(this,void 0,void 0,function(){var a,c;return h(this,function(d){switch(d.label){case 0:return[4,
g(this.parsedUrl.path,{query:{f:"json"},responseType:"json",signal:b})];case 1:return a=d.sent(),a.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),c=a.data,this.read(c,{origin:"service",url:this.parsedUrl}),this._validateLayer(c),[2]}})})};d.prototype._validateLayer=function(a){};k([q.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],d.prototype,"properties",void 0);k([q.property({type:t})],d.prototype,"spatialReference",void 0);k([q.reader("spatialReference",["spatialReference",
"store.indexCRS","store.geographicCRS"])],d.prototype,"readSpatialReference",null);k([q.property({type:p})],d.prototype,"fullExtent",void 0);k([q.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],d.prototype,"readFullExtent",null);k([q.property({readOnly:!0,type:r})],d.prototype,"heightModelInfo",void 0);k([q.property({type:Number,json:{read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"},origins:{service:{read:{source:"minScale"},
write:!1}}}})],d.prototype,"minScale",void 0);k([q.property({type:Number,json:{read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"},origins:{service:{read:{source:"maxScale"},write:!1}}}})],d.prototype,"maxScale",void 0);k([q.property({readOnly:!0})],d.prototype,"version",void 0);k([q.reader("version",["store.version"])],d.prototype,"readVersion",null);k([q.property({type:String,json:{read:{source:"copyrightText"}}})],d.prototype,"copyright",void 0);k([q.property({type:String,
json:{read:!1}})],d.prototype,"sublayerTitleMode",void 0);k([q.property({type:String})],d.prototype,"title",void 0);k([q.reader("portal-item","title")],d.prototype,"readTitlePortalItem",null);k([q.reader("service","title",["name"])],d.prototype,"readTitleService",null);k([q.property({type:Number})],d.prototype,"layerId",void 0);k([q.reader("service","layerId",["id"])],d.prototype,"readLayerId",null);k([q.property(w.url)],d.prototype,"url",null);k([q.writer("url")],d.prototype,"writeUrl",null);k([q.property({dependsOn:["layerId"]})],
d.prototype,"parsedUrl",null);k([q.property({readOnly:!0})],d.prototype,"store",void 0);k([q.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],d.prototype,"rootNode",void 0);return d=k([q.subclass("esri.layers.mixins.SceneService")],d)}(q.declared(b))};var y=-1E38})},"esri/layers/support/I3SLayerDefinitions":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.nodesPerPage=null;a.rootIndex=0;a.lodSelectionMetricType=null;return a}l(c,b);k([a.property({type:Number})],c.prototype,"nodesPerPage",void 0);k([a.property({type:Number})],c.prototype,"rootIndex",void 0);k([a.property({type:String})],c.prototype,"lodSelectionMetricType",void 0);return c=k([a.subclass("esri.layer.support.I3SNodePageDefinition")],c)}(a.declared(h.JSONSupport));
b.I3SNodePageDefinition=n;var g=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.factor=1;return a}l(c,b);k([a.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],c.prototype,"id",void 0);k([a.property({type:Number})],c.prototype,"factor",void 0);return c=k([a.subclass("esri.layer.support.I3SMaterialTexture")],c)}(a.declared(h.JSONSupport));b.I3SMaterialTexture=g;var e=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.baseColorFactor=
[1,1,1,1];a.baseColorTexture=null;a.metallicRoughnessTexture=null;a.metallicFactor=1;a.roughnessFactor=1;return a}l(c,b);k([a.property({type:[Number]})],c.prototype,"baseColorFactor",void 0);k([a.property({type:g})],c.prototype,"baseColorTexture",void 0);k([a.property({type:g})],c.prototype,"metallicRoughnessTexture",void 0);k([a.property({type:Number})],c.prototype,"metallicFactor",void 0);k([a.property({type:Number})],c.prototype,"roughnessFactor",void 0);return c=k([a.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],
c)}(a.declared(h.JSONSupport));b.I3SMaterialPBRMetallicRoughness=e;n=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.alphaMode="opaque";a.alphaCutoff=.25;a.doubleSided=!1;a.cullFace="none";a.normalTexture=null;a.occlusionTexture=null;a.emissiveTexture=null;a.emissiveFactor=null;a.pbrMetallicRoughness=null;return a}l(c,b);k([a.enumeration.serializable()({opaque:"opaque",mask:"mask",blend:"blend"})],c.prototype,"alphaMode",void 0);k([a.property({type:Number})],c.prototype,"alphaCutoff",
void 0);k([a.property({type:Boolean})],c.prototype,"doubleSided",void 0);k([a.enumeration.serializable()({none:"none",back:"back",front:"front"})],c.prototype,"cullFace",void 0);k([a.property({type:g})],c.prototype,"normalTexture",void 0);k([a.property({type:g})],c.prototype,"occlusionTexture",void 0);k([a.property({type:g})],c.prototype,"emissiveTexture",void 0);k([a.property({type:[Number]})],c.prototype,"emissiveFactor",void 0);k([a.property({type:e})],c.prototype,"pbrMetallicRoughness",void 0);
return c=k([a.subclass("esri.layer.support.I3SMaterialDefinition")],c)}(a.declared(h.JSONSupport));b.I3SMaterialDefinition=n;var d=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);k([a.property({type:String,json:{read:{source:["name","index"],reader:function(a,b){return null!=a?a:""+b.index}}}})],c.prototype,"name",void 0);k([a.enumeration.serializable()({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2"})],c.prototype,"format",void 0);return c=k([a.subclass("esri.layer.support.I3STextureFormat")],
c)}(a.declared(h.JSONSupport));b.I3STextureFormat=d;n=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.atlas=!1;return a}l(c,b);k([a.property({type:[d]})],c.prototype,"formats",void 0);k([a.property({type:Boolean})],c.prototype,"atlas",void 0);return c=k([a.subclass("esri.layer.support.I3STextureSetDefinition")],c)}(a.declared(h.JSONSupport));b.I3STextureSetDefinition=n;var f=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);k([a.enumeration.serializable()({Float32:"Float32",
UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],c.prototype,"type",void 0);k([a.property({type:Number})],c.prototype,"component",void 0);return c=k([a.subclass("esri.layer.support.I3SGeometryAttribute")],c)}(a.declared(h.JSONSupport));b.I3SGeometryAttribute=f;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);k([a.enumeration.serializable()({draco:"draco"})],c.prototype,"encoding",void 0);k([a.property({type:[String]})],c.prototype,"attributes",void 0);
return c=k([a.subclass("esri.layer.support.I3SGeometryAttribute")],c)}(a.declared(h.JSONSupport));b.I3SGeometryCompressedAttributes=c;n=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.offset=0;return a}l(d,b);k([a.property({type:Number})],d.prototype,"offset",void 0);k([a.property({type:f})],d.prototype,"position",void 0);k([a.property({type:f})],d.prototype,"normal",void 0);k([a.property({type:f})],d.prototype,"uv0",void 0);k([a.property({type:f})],d.prototype,"color",void 0);
k([a.property({type:f})],d.prototype,"uvRegion",void 0);k([a.property({type:f})],d.prototype,"featureId",void 0);k([a.property({type:f})],d.prototype,"faceRange",void 0);k([a.property({type:c})],d.prototype,"compressedAttributes",void 0);return d=k([a.subclass("esri.layer.support.I3SGeometryBuffer")],d)}(a.declared(h.JSONSupport));b.I3SGeometryBuffer=n;h=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);k([a.enumeration.serializable()({triangle:"triangle"})],c.prototype,
"topology",void 0);k([a.property()],c.prototype,"geometryBuffers",void 0);return c=k([a.subclass("esri.layer.support.I3SMeshDefinition")],c)}(a.declared(h.JSONSupport));b.I3SGeometryDefinition=h})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=
null!==b&&b.apply(this,arguments)||this;a.name=null;a.field=null;a.currentRangeExtent=null;a.fullRangeExtent=null;a.type="rangeInfo";return a}l(e,b);k([a.property({type:String,json:{read:!0,write:!0}})],e.prototype,"name",void 0);k([a.property({type:String,json:{read:!0,write:!0}})],e.prototype,"field",void 0);k([a.property({type:[Number],json:{read:!0,write:!0}})],e.prototype,"currentRangeExtent",void 0);k([a.property({type:[Number],json:{read:!0,write:!0}})],e.prototype,"fullRangeExtent",void 0);
k([a.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],e.prototype,"type",void 0);return e=k([a.subclass("esri.layers.support.RangeInfo")],e)}(a.declared(h.JSONSupport));b.RangeInfo=n;b.default=n})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./LayerView3D ./TiledLayerView3D ./support/tiledLayerUtils ../../layers/LayerView".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){return function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);c.prototype.initialize=function(){var b=this.get("view.map.allLayers"),b=b&&b.includes(this.layer),c=this.get("view.map.ground.layers"),c=c&&c.includes(this.layer);b&&!c&&(b=new h("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(a.reject(b)));this._addTilingSchemeMatchPromise();this.addResolvingPromise(f.checkArcGISServiceVersionCompatibility(this.layer))};
k([g.property({readOnly:!0,aliasOf:"layer.fullExtent"})],c.prototype,"fullExtent",void 0);k([g.property()],c.prototype,"layer",void 0);k([g.property({readOnly:!0,aliasOf:"layer.tileInfo"})],c.prototype,"tileInfo",void 0);return c=k([g.subclass("esri.views.3d.layers.ElevationLayerView3D")],c)}(g.declared(d.TiledLayerView3D(e.LayerView3D(c))))})},"esri/views/3d/layers/LayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/heightModelInfoUtils".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.LayerView3D=function(b){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.slicePlaneEnabled=!1;a.supportsHeightUnitConversion=!1;return a}l(c,b);c.prototype.destroy=function(){this.view=null};c.prototype.postscript=function(a){this.inherited(arguments);e.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};c.prototype._validateHeightModelInfo=function(){var b=
this;return h.create(function(c,d){a.whenFalseOnce(b.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var a=e.rejectLayerError(b.layer,b.view.heightModelInfo,b.supportsHeightUnitConversion);a?d(a):c()})})};k([g.property()],c.prototype,"view",void 0);k([g.property()],c.prototype,"slicePlaneEnabled",void 0);return c=k([g.subclass("esri.views.3d.layers.LayerView3D")],c)}(g.declared(b))}})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./support/layerViewUpdatingProperties ./support/tiledLayerUtils ../terrain/terrainUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){Object.defineProperty(b,"__esModule",{value:!0});b.TiledLayerView3D=function(b){return function(b){function h(){return null!==b&&b.apply(this,arguments)||this}l(h,b);Object.defineProperty(h.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isOpaque",{get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"dataLevelRange",
{get:function(){var a=this.tileInfo.lods;return this.levelRangeFromScaleRange(a[0].scale,a[a.length-1].scale)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"displayLevelRange",{get:function(){var a=this.tileInfo.lods,a=this.levelRangeFromScaleRange(this.layer.minScale||a[0].scale,this.layer.maxScale||a[a.length-1].scale);this.layer.maxScale&&a.maxLevel++;return a},enumerable:!0,configurable:!0});h.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};h.prototype._addTilingSchemeMatchPromise=
function(){var a=this,b=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);b?this.addResolvingPromise(g.reject(b)):(b=e.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){c.throwIfError(a._getTileInfoCompatibilityError(a.tileInfo,a.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(b))};h.prototype._getTileInfoSupportError=function(b,c){if(b=q.checkIfTileInfoSupportedForView(b,c,this.view.spatialReference,this.view.basemapTerrain.manifold)){c={layer:this.layer,
error:b};var d=void 0;switch(b.name){case "tilingscheme:local-gcs-not-supported":d=new a("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",c);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":d=new a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",c);break;default:d=new a("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",
c)}return d}return null};h.prototype._getTileInfoCompatibilityError=function(b,c){return c.compatibleWith(b)?null:new a("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};h.prototype.levelRangeFromScaleRange=function(a,b){var c={minLevel:0,maxLevel:Infinity},d=this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!d)return c;var e=d.levels[0],d=function(a){a=Math.log(e.scale/a)/Math.LN2;return 1E-9>.5-Math.abs(.5-
a%1)?Math.round(a):Math.ceil(a)};null!=a&&0<a&&(c.minLevel=Math.max(0,d(a)));null!=b&&0<b&&(c.maxLevel=Math.max(0,d(b)));return c};h.prototype.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};k([d.property({readOnly:!0})],h.prototype,"imageFormatIsOpaque",null);k([d.property({readOnly:!0,dependsOn:["view.basemapTerrain.updating"]})],h.prototype,"updating",void 0);k([d.property(f.updatingPercentage)],h.prototype,"updatingPercentage",void 0);k([d.property(f.updatingPercentageValue)],
h.prototype,"updatingPercentageValue",void 0);k([d.property({readOnly:!0})],h.prototype,"fullExtent",void 0);k([d.property({readOnly:!0,dependsOn:["fullOpacity","imageFormatIsOpaque"]})],h.prototype,"isOpaque",null);k([d.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme"]})],h.prototype,"dataLevelRange",null);k([d.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme","layer.minScale","layer.maxScale"]})],h.prototype,"displayLevelRange",null);k([d.property()],
h.prototype,"layer",void 0);k([d.property({readOnly:!0})],h.prototype,"tileInfo",void 0);return h=k([d.subclass("esri.views.3d.layers.TiledLayerView3D")],h)}(d.declared(b))}})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.updatingPercentageValue={value:100,readOnly:!0};b.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?
this.updatingPercentageValue:0}}})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports dojo/request/xhr ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(n,b,l,k,h,a){function g(a){var b=null,e=a.search(/\/rest\/services\//i);0<e&&(b=a.substring(0,e+6));return b}Object.defineProperty(b,"__esModule",{value:!0});b.checkArcGISServiceVersionCompatibility=function(b){if(!a.isHostedAgolService(b.url)){if(10.22>
b.version)return b=new k("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+b.version,{minVersion:10.22,detectedVersion:b.version}),h.reject(b);if(10.22===b.version&&!a.isHostedSecuredProxyService(b.url,b.get("portalItem.id"))){b=g(b.url);var d=new k("tiledlayerview3d:service-missing-cors-patch","Tiled Map Layers from 10.2.2 servers are only supported if all server updates have been applied.");return l(b+"self?f\x3djson",{headers:{"X-Requested-With":null},
timeout:1E4,handleAs:"json"}).then(function(a){if(!a||a.error)throw d;}).catch(function(){throw d;})}return h.resolve()}};b.throwIfError=function(a){if(a)throw a;}})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/asyncUtils ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ./support/layerViewUpdatingProperties ../support/EventedSet ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B){return function(b){function n(a){a=b.call(this)||this;a._controllerTotal=0;a._graphicsCoreTotal=0;a.suspendResumeExtentMode="data";return a}l(n,b);n.prototype.destroy=function(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)};Object.defineProperty(n.prototype,"updatingPercentageValue",{get:function(){var a=0,b=0;this.controller&&this.controller.updating&&(a+=this.controller.updatingRemaining,b=this.controller.updatingTotal);
var c=0;this.graphics3d&&this.graphics3d.graphicsCore&&(a+=this.graphics3d.graphicsCore.updatingRemaining,c=this.graphics3d.graphicsCore.updatingTotal);0===b&&0===c?this._graphicsCoreTotal=this._controllerTotal=0:(this._controllerTotal=Math.max(b,this._controllerTotal),this._graphicsCoreTotal=Math.max(c,this._graphicsCoreTotal));return(b=this._controllerTotal+this._graphicsCoreTotal)?(b-a)/b*100:100},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"maximumNumberOfFeaturesExceeded",
{get:function(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"asyncGraphicsUpdates",{get:function(){if(this.controller)switch(this.controller.mode){case "snapshot":return 5E3<this.controller.serviceDataCount;case "tiles":break;default:d.neverReached(this.controller.mode)}return!0},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"hasZ",{get:function(){var a=this.layer,
b=a.capabilities&&a.capabilities.data;return b&&b.supportsZ?"returnZ"in a&&null!=a.returnZ?a.returnZ:b.supportsZ:!1},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"hasM",{get:function(){var a=this.layer,b=a.capabilities&&a.capabilities.data;return b&&b.supportsM?"returnM"in a&&null!=a.returnM?a.returnM:!1:!1},enumerable:!0,configurable:!0});n.prototype.fetchPopupFeatures=function(b,d){return g(this,void 0,void 0,function(){var b;return a(this,function(a){return(b=this.validateFetchPopupFeatures(d))?
[2,c.reject(b)]:[2,this.fetchClientPopupFeatures(d)]})})};n.prototype.setVisibility=function(a,b){this.graphics3d.graphicsCore.setObjectIdVisibility(a,b)};n.prototype.createQuery=function(){return this.inherited(arguments)};n.prototype.queryFeatures=function(a,b){var c=this,d=arguments,f=function(){return c.inherited(d)};return"mesh"===this.layer.geometryType?e.safeCast(this._queryFeaturesMesh(this._ensureQuery(a),f)):e.safeCast(f())};n.prototype.createController=function(){return g(this,void 0,void 0,
function(){var b,c=this;return a(this,function(a){this.fetcherContext=new u.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});b=new t({layerView:this,context:this.fetcherContext,graphics:new m.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(b,"serviceDataExtent",function(a){c.graphics3d&&(c.graphics3d.dataExtent=a)},2);this.handles.add(q.init(this,"suspended",function(a){a?b.suspend():b.resume()},!0));this.updatingHandles.add(this.graphics3d.graphicsCore,
"displayFeatureLimit",function(){return c.updateDisplayFeatureLimit(b)},2);this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",function(){return c.updateDisplayFeatureLimit()}));return[2,b]})})};n.prototype.doRefresh=function(b){return g(this,void 0,void 0,function(){return a(this,function(a){!this.suspended&&this.controller&&this.controller.refresh();return[2]})})};n.prototype.getStats=function(){var a=this.inherited(arguments);if(this.controller&&a.features){var b=
this.controller.debug;a.features+="/"+b.storedFeatures+"/"+b.totalFeatures;a.totalVertices=b.totalVertices}b=(b=this.controller&&this.controller.displayFeatureLimit)&&b.maximumSymbolComplexity;a.numTiles=this.controller?this.controller.tileDescriptors.length:0;a.partial=this.maximumNumberOfFeaturesExceeded;a.mode=this.controller?this.controller.mode:"n/a";a.symbolComplexity=b?"f:"+b.primitivesPerFeature+",v:"+b.primitivesPerCoordinate:"n/a";var c=this.graphics3d&&this.graphics3d.graphicsCore,b=c?
c.unprocessedMemoryEstimate:0,c=this.controller?this.controller.expectedFeatureDiff*c.usedMemoryPerGraphic:0;a.memory="u:"+(this.getUsedMemory()/1024/1024).toFixed(1)+", pc:"+(""+(b/1024/1024).toFixed(1))+", pf:"+(""+(c/1024/1024).toFixed(1))+" MB";return a};n.prototype.getUsedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return(a?a.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)};n.prototype.getUnloadedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;
return(a?a.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*a.usedMemoryPerGraphic:0)};n.prototype.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride};n.prototype.updateDisplayFeatureLimit=function(a){void 0===a&&(a=this.controller);if(a&&this.graphics3d&&this.graphics3d.graphicsCore){var b=this.graphics3d.graphicsCore.displayFeatureLimit,c=this.view.resourceController.memoryController.memoryFactor;a.displayFeatureLimit=
1===c?b:h({},b,{maximumNumberOfFeatures:Math.ceil(b.maximumNumberOfFeatures*c),maximumTotalNumberOfFeatures:Math.ceil(b.maximumTotalNumberOfFeatures*c),minimumTotalNumberOfFeatures:Math.ceil(b.minimumTotalNumberOfFeatures*c)})}};n.prototype._queryFeaturesMesh=function(b,c){return g(this,void 0,void 0,function(){var d,e,f,g,h,k,l,m;return a(this,function(a){switch(a.label){case 0:return[4,this._validateQueryFeaturesMesh(b)];case 1:return a.sent(),[4,c()];case 2:d=a.sent();if(b&&b.outStatistics)return[2,
d];e=this.layer.objectIdField;f=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID;g=[];h=0;for(k=d.features;h<k.length;h++)if(l=k[h],l.geometry){if(m=f.get(l.attributes[e]))l.geometry=r.hydrateGeometry(m.graphic.geometry),g.push(l)}else g.push(l);d.features=g;return[2,d]}})})};n.prototype._validateQueryFeaturesMesh=function(b){return g(this,void 0,void 0,function(){var c,d,e,g,h;return a(this,function(a){if(!b)return[2];c=function(a){throw new f("feature-layer-view:unsupported-query","Queries on Mesh feature collection layers do not support '"+
a+"'");};d=["quantizationParameters","geometryPrecision","maxAllowableOffset"];e=0;for(g=d;e<g.length;e++)h=g[e],null!=b[h]&&c(h);"returnM"in b&&b.returnM&&c("returnM");"returnCentroid"in b&&b.returnCentroid&&c("returnCentroid");b.outSpatialReference&&!b.outSpatialReference.equals(this.view.spatialReference)&&c("outSpatialReference");return[2]})})};k([p.property()],n.prototype,"layer",void 0);k([p.property()],n.prototype,"controller",void 0);k([p.property({readOnly:!0,dependsOn:["controller.updatingRemaining",
"controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],n.prototype,"updatingPercentageValue",null);k([p.property({aliasOf:"controller.maximumNumberOfFeatures",set:null,get:null})],n.prototype,"maximumNumberOfFeatures",void 0);k([p.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],n.prototype,"maximumNumberOfFeaturesExceeded",null);k([p.property(y.updatingPercentage)],n.prototype,"updatingPercentage",void 0);
k([p.property({readOnly:!0,dependsOn:["controller.mode"]})],n.prototype,"asyncGraphicsUpdates",null);k([p.property({readOnly:!0})],n.prototype,"hasZ",null);k([p.property({readOnly:!0})],n.prototype,"hasM",null);k([p.property()],n.prototype,"suspendResumeExtentMode",void 0);return n=k([p.subclass("esri.views.3d.layers.FeatureLayerView3D")],n)}(p.declared(B.RefreshableLayerView(v.FeatureLayerView(x.FeatureLikeLayerView3D(w.LayerView3D(z))))))})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/compilerUtils ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../support/arcgisLayerUrl ../../../portal/support/geometryServiceUtils ../../../tasks/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags ../../../views/support/WatchUpdatingTracking".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I){var Q=t.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");n=function(b){function e(a){a=b.call(this)||this;a.type="feature-tile-3d";a.watchUpdatingTracking=new I.WatchUpdatingTracking;a.serviceDataExtent=null;a.serviceDataCount=h.constants.NO_SERVICE_DATA_COUNT;a.vertexLimitExceeded=!1;a.displayFeatureLimit=null;a.suspended=!1;a.tileFetcher=null;a.handles=new p;a.fetchDataInfoPromise=null;a.fetchDataInfoAbortController=
null;a.lifeCycleAbortController=u.createAbortController();return a}l(e,b);h=e;Object.defineProperty(e.prototype,"extent",{set:function(a){if(a&&!a.spatialReference.equals(this.layerView.view.spatialReference))Q.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var b=this._get("extent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("extent",a))}},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"updating",{get:function(){return!!(this.tileFetcher&&
this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"updatingTotal",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"updatingRemaining",{get:function(){return this.updating&&
this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"maximumNumberOfFeaturesExceeded",
{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"maximumNumberOfFeatures",{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(a){a!==this.maximumNumberOfFeatures&&(null==a?this._clearOverride("maximumNumberOfFeatures"):
this._override("maximumNumberOfFeatures",a))},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"mode",{get:function(){if(this.serviceDataCount===h.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var a=this.layerView,b=a.layer,a=(a=(a=a.view)&&a.featureTiles)&&a.tilingScheme;return b&&b.minScale&&
this.serviceDataExtent&&a&&(b=this.approximateExtentSizeAtScale(b.minScale,a),(this.serviceDataExtent.width/b+this.serviceDataExtent.height/b)/2>h.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"maxTotalSnapshotVertices",{get:function(){var a=this._get("maxTotalSnapshotVertices")||0;return Math.max(a,"snapshot"===this.mode&&this.tileFetcher&&
this.tileFetcher.totalVertices||0)},enumerable:!0,configurable:!0});e.prototype.approximateExtentSizeAtScale=function(a,b){var c=this.layerView.view,d=b.levels[0];return(d.tileSize[0]/(d.scale/a)+d.tileSize[1]/(d.scale/a))/2*Math.ceil((c.width/b.pixelSize+c.height/b.pixelSize)/2)};Object.defineProperty(e.prototype,"tileDescriptors",{get:function(){return"snapshot"===this.mode?new f([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:
new f},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}},enumerable:!0,configurable:!0});e.prototype.initialize=function(){var a=this;this.watchUpdatingTracking.add(this,"vertexLimitInfo",function(){return a.watchUpdatingTracking.addPromise(a.updateVertexLimitExceeded(null,a.lifeCycleAbortController.signal))});this.watchUpdatingTracking.add(this,"mode",function(){return a.modeChanged()},
2);var b=u.resolve().then(function(){return a.verifyCapabilities()}).then(function(){return a.watchUpdatingTracking.addPromise(a.fetchServiceDataInfo())}).then(function(){return a.initializeTileFetcher()});this.addResolvingPromise(b)};e.prototype.verifyCapabilities=function(){var a=this.layerView.layer;if(!a.get("capabilities.operations.supportsQuery"))throw new q("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:a});};e.prototype.destroy=
function(){this.cancelFetchServiceDataInfo();this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null);this.handles&&(this.handles.destroy(),this.handles=null);this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null);this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null);this.watchUpdatingTracking.destroy();this._set("watchUpdatingTracking",null)};e.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&
this.tileFetcher.suspend())};e.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())};e.prototype.refresh=function(){var a=this,b=function(){a.tileFetcher&&a.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(b,b))};e.prototype.initializeTileFetcher=function(){var a=this,b=this.layerView.view,c=y.whenOnce(b.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(c);
c.then(function(){var c=a.layerView,d=c.layer;a.tileFetcher=new C.FeatureTileFetcher3D({context:a.context,filterExtent:a.filteredDataExtent,tileDescriptors:a.tileDescriptors,features:a.graphics});a.suspended?a.tileFetcher.suspend():a.tileFetcher.resume();var e=a.layerView.view.resourceController;e&&(a.handles.add(e.memoryController.events.on("quality-changed",function(b){a.tileFetcher.memoryFactor=b})),a.tileFetcher.memoryFactor=e.memoryController.memoryFactor);(e="polygon"===a.context.geometryType?
"polygonLodFactor":"polyline"===a.context.geometryType?"polylineLodFactor":null)&&a.handles.add(y.init(a.layerView.view,"qualitySettings.graphics3D."+e,function(b){a.tileFetcher.lodFactor=b||1}));a.watchUpdatingTracking.add(d,"definitionExpression",function(){return a.definitionExpressionChanged()});a.watchUpdatingTracking.add(c,"availableFields",function(b,c){return a.attributesChanged(c,b)});a.handles.add([d.on("apply-edits",function(b){return a.applyEdits(b)}),a.watch("filteredDataExtent",function(b){return a.tileFetcher.filterExtent=
b},!0),a.watch("tileDescriptors",function(b){return a.tileFetcher.tileDescriptors=b},!0),y.init(a,"maximumNumberOfFeatures",function(b){a.tileFetcher.maximumNumberOfFeatures=b;a.tileFetcher.useTileCount=a.serviceDataCount>b},!0),y.init(a,"serviceDataCount",function(b){return a.tileFetcher.useTileCount=b>a.maximumNumberOfFeatures},!0),y.init(K,"FEATURE_TILE_FETCH_SHOW_TILES",function(c){c&&a.tileFetcher&&!a.tileFetcher.debugger?(a.tileFetcher.debugger=new D.FeatureTileFetcher3DDebugger(a.tileFetcher,
b.featureTiles.tilingScheme.toTileInfo(),b),a.tileFetcher.debugger.update()):!c&&a.tileFetcher&&a.tileFetcher.debugger&&(a.tileFetcher.debugger.destroy(),a.tileFetcher.debugger=null)})]);a.supportsExceedsLimitQuery||a.watchUpdatingTracking.add(a,"maxTotalSnapshotVertices",function(){return a.watchUpdatingTracking.addPromise(a.updateVertexLimitExceeded(null,a.lifeCycleAbortController.signal))})}).catch(function(){})};e.prototype.modeChanged=function(){switch(this.mode){case "tiles":this.tilesHandle||
(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:Q.warn("Unhandled feature layer mode "+this.mode);case "snapshot":this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null)}};e.prototype.definitionExpressionChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refresh()};e.prototype.applyEdits=function(a){var b=this;this.tileFetcher.applyEdits(a).then(function(a){a&&(a.deletedFeatures.length||a.updatedFeatures.length||
a.addedFeatures.length)&&b.watchUpdatingTracking.addPromise(b.updateServiceDataExtent(b.lifeCycleAbortController.signal))})};e.prototype.attributesChanged=function(a,b){if(!a||-1===a.indexOf("*"))if(a&&b){for(var c=new Set,d=0;d<a.length;d++){var e=a[d];c.add(e)}for(a=0;a<b.length;a++)if(e=b[a],!c.has(e)){this.refresh();break}}else this.refresh()};e.prototype.createVertexLimitExceededQuery=function(a){var b=this.layerView.layer,c=b.createQuery();c.outStatistics=[new B({statisticType:"exceedslimit",
maxVertexCount:a,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];b.capabilities.query.supportsCacheHint&&(c.cacheHint=!0);return c};e.prototype.createDataInfoQuery=function(){var a=this.layerView.layer,b=a.createQuery();b.outSpatialReference=this.layerView.view.spatialReference;a.capabilities.query.supportsCacheHint&&(b.cacheHint=!0);return b};e.prototype.fullExtentIsAccurate=function(){var a=this.layerView.layer;if(a.definitionExpression)return!1;switch(a.type){case "feature":case "stream":return v.isHostedAgolService(a.url);
case "csv":case "geojson":return!0;default:c.neverReached(a)}};e.prototype.updateServiceDataExtent=function(b){return g(this,void 0,void 0,function(){var c;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.tryUpdateServiceDataExtent(b)];case 1:return a.sent(),[3,3];case 2:return c=a.sent(),u.isAbortError(c)||this._set("serviceDataExtent",r.clone(this.layerView.fullExtentInLocalViewSpatialReference)),[3,3];case 3:return[2]}})})};e.prototype.tryUpdateServiceDataExtent=
function(b){return g(this,void 0,void 0,function(){var c,d,e,f,g,k,l,m,n,p,q,v;return a(this,function(a){switch(a.label){case 0:c=this.layerView;d=c.layer;e=d.capabilities.query.supportsExtent;f=r.clone(c.fullExtentInLocalViewSpatialReference);g=d.fullExtent;k=this.fullExtentIsAccurate();l=this.serviceDataCount;m=e&&l<=h.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!f||!k);if(!m)return[3,2];n=this.createDataInfoQuery();return[4,d.queryExtent(n,{timeout:h.constants.QUERY_EXTENT_TIMEOUT,signal:b})];case 1:return p=
a.sent(),this._set("serviceDataExtent",p.extent),[3,6];case 2:if(!f)return[3,3];this._set("serviceDataExtent",f);return[3,6];case 3:if(!g)return[3,5];q="portalItem"in d?d.portalItem:null;return[4,z.projectGeometry(g,c.view.spatialReference,q,b)];case 4:return v=a.sent(),this._set("serviceDataExtent",v),[3,6];case 5:this._set("serviceDataExtent",null),a.label=6;case 6:return[2]}})})};e.prototype.updateServiceDataCount=function(b){return g(this,void 0,void 0,function(){var c,e,f;return a(this,function(a){switch(a.label){case 0:return c=
this.layerView.layer,[4,d.result(c.queryFeatureCount(this.createDataInfoQuery(),{timeout:h.constants.QUERY_STATISTICS_TIMEOUT,signal:b}))];case 1:e=a.sent();if(!0===e.ok)this._set("serviceDataCount",e.value);else{if(u.isAbortError(e.error))throw e.error;f=h.constants.NO_SERVICE_DATA_COUNT;this._set("serviceDataCount",f)}return[2]}})})};Object.defineProperty(e.prototype,"vertexLimitInfo",{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var a=
this.displayFeatureLimit,b=a.maximumSymbolComplexity,a=a.maximumTotalNumberOfPrimitives,c=b.primitivesPerCoordinate,b=b.primitivesPerFeature,d=this._get("vertexLimitInfo");return x.isNone(d)||d.maximumTotalNumberOfPrimitives!==a||d.primitivesPerCoordinate!==c||d.primitivesPerFeature!==b?{primitivesPerCoordinate:c,primitivesPerFeature:b,maximumTotalNumberOfPrimitives:a}:d},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"supportsExceedsLimitQuery",{get:function(){var a=this.layerView.layer;
return a.capabilities&&a.capabilities.operations&&a.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var a=this.layerView.layer.geometryType;switch(a){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;default:return c.neverReached(a),0}},enumerable:!0,configurable:!0});e.prototype.updateVertexLimitExceeded=
function(b,c){return g(this,void 0,void 0,function(){var e,f,g,k,l,m,n,p,q,r,v,t,y,w,z;return a(this,function(a){switch(a.label){case 0:e=x.isSome(this.vertexLimitInfo)&&0>=this.vertexLimitInfo.primitivesPerFeature;f=1<this.minimumNumberOfVerticesForGeometry;g=this.layerView.layer;k=this.supportsExceedsLimitQuery;if(x.isNone(this.vertexLimitInfo)||!e&&!f)return this._set("vertexLimitExceeded",!1),[2];l=this.vertexLimitInfo;m=l.primitivesPerFeature;n=l.primitivesPerCoordinate;p=l.maximumTotalNumberOfPrimitives;
return(q=0!==m)&&x.isSome(b)?[4,b]:[3,2];case 1:a.sent(),a.label=2;case 2:r=this.serviceDataCount;v=(t=r!==h.constants.NO_SERVICE_DATA_COUNT)?Math.ceil((p-r*m)/(n||1)):Math.ceil(p/(n||1));f&&(v=Math.min(v,J));if(t&&this.minimumNumberOfVerticesForGeometry*r>v)return this._set("vertexLimitExceeded",!0),[2];k||this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>v);return[4,d.result(g.queryFeatures(this.createVertexLimitExceededQuery(v),{timeout:h.constants.QUERY_STATISTICS_TIMEOUT,signal:c}))];
case 3:y=a.sent();if(!1===y.ok){if(u.isAbortError(y.error))throw y.error;this._set("vertexLimitExceeded",!1);return[2]}w=y.value;(z=w.features[0])&&z.attributes?this._set("vertexLimitExceeded",!!z.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);return[2]}})})};e.prototype.fetchServiceDataInfo=function(){return g(this,void 0,void 0,function(){var b,c,d,e,f,g=this;return a(this,function(a){this.cancelFetchServiceDataInfo();b=u.createAbortController();c=b.signal;d=this.updateServiceDataCount(c);
e=u.eachAlways([d,this.updateVertexLimitExceeded(d,c)]);f=e.then(function(){return g.updateServiceDataExtent(c)}).catch(function(a){u.isAbortError(a)||Q.error("#fetchServiceDataInfo()",a)}).then(function(){f===g.fetchDataInfoPromise&&(g.fetchDataInfoPromise=null,g.fetchDataInfoAbortController=null);b=null});b&&(this.fetchDataInfoPromise=f);this.fetchDataInfoAbortController=b;return[2,e.catch(function(){})]})})};e.prototype.cancelFetchServiceDataInfo=function(){var a=this.fetchDataInfoAbortController;
a&&(this.fetchDataInfoPromise=this.fetchDataInfoAbortController=null,a.abort())};Object.defineProperty(e.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0});var h;k([m.property({readOnly:!0})],e.prototype,"type",void 0);k([m.property({constructOnly:!0})],e.prototype,"graphics",void 0);
k([m.property({constructOnly:!0})],e.prototype,"layerView",void 0);k([m.property({constructOnly:!0})],e.prototype,"context",void 0);k([m.property()],e.prototype,"extent",null);k([m.property({dependsOn:["tileFetcher.updating","mode","layerView.view.featureTiles.updating","fetchDataInfoPromise","watchUpdatingTracking.updating"]})],e.prototype,"updating",null);k([m.property({readOnly:!0})],e.prototype,"watchUpdatingTracking",void 0);k([m.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],
e.prototype,"updatingTotal",null);k([m.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],e.prototype,"updatingRemaining",null);k([m.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],e.prototype,"expectedFeatureDiff",null);k([m.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],e.prototype,"memoryForUnusedFeatures",null);k([m.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],e.prototype,"maximumNumberOfFeaturesExceeded",null);k([m.property({readOnly:!0})],
e.prototype,"serviceDataExtent",void 0);k([m.property({readOnly:!0})],e.prototype,"serviceDataCount",void 0);k([m.property({readOnly:!0})],e.prototype,"vertexLimitExceeded",void 0);k([m.property({readOnly:!0,dependsOn:["extent"]})],e.prototype,"filteredDataExtent",null);k([m.property()],e.prototype,"displayFeatureLimit",void 0);k([m.property({type:Number,dependsOn:["displayFeatureLimit"]})],e.prototype,"maximumNumberOfFeatures",null);k([m.property({readOnly:!0,dependsOn:"serviceDataCount displayFeatureLimit maximumNumberOfFeatures vertexLimitExceeded serviceDataExtent layerView.layer.minScale layerView.view.featureTiles.tilingScheme".split(" ")})],
e.prototype,"mode",null);k([m.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],e.prototype,"maxTotalSnapshotVertices",null);k([m.property({readOnly:!0,dependsOn:["mode"]})],e.prototype,"tileDescriptors",null);k([m.property()],e.prototype,"tileFetcher",void 0);k([m.property()],e.prototype,"fetchDataInfoPromise",void 0);k([m.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],e.prototype,"vertexLimitInfo",null);return e=h=k([m.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],
e)}(m.declared(w.EsriPromiseMixin(e)));var J=5E6;(function(a){(function(a){a.NO_SERVICE_DATA_COUNT=Infinity;a.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;a.reset=function(){a.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;a.QUERY_STATISTICS_TIMEOUT=12E3;a.QUERY_EXTENT_TIMEOUT=1E4}})(a.constants||(a.constants={}))})(n||(n={}));n.constants.reset();return n})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/now ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/QuantizationParameters ../../../../tasks/support/Query ./featureReference ./FeatureTile ../../../support/index ../../../support/QueueProcessor".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D){function K(a){return"dummy-tile-full-extent"===a.id}function I(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];d.features&&0<d.features.length&&d.alive&&(b=Math.max(b,d.descriptor.lij[0]))}return b}Object.defineProperty(b,"__esModule",{value:!0});var Q=z.SingleFeatureReference,J=z.MultiFeatureReference,N=c.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");n=function(b){function c(a){a=b.call(this,a)||this;a.useTileCount=!1;a.updating=
!1;a.updatingTotal=0;a.updatingRemaining=0;a.expectedFeatureDiff=0;a.maximumNumberOfFeaturesExceeded=!1;a.maximumNumberOfFeaturesExceededThrottle=1E3;a.maximumNumberOfFeaturesExceededNext=0;a._fullRatio=1;a._farRatio=1;a.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};a.handles=new f;a._dirty=!1;a.idToFeatureTile=new Map;a.displayingFeatureReferences=new Map;a.numDisplayingFeatureReferences=0;a.suspended=!0;a.pendingEdits=null;return a}l(c,b);Object.defineProperty(c.prototype,"maximumNumberOfFeatures",
{set:function(a){a=a||Infinity;var b=this._get("maximumNumberOfFeatures");a===b||1>a||(this._set("maximumNumberOfFeatures",a),this.maximumFeaturesUpdated(b,a))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"memoryFactor",{set:function(a){this.memoryFactor!==a&&(this._set("memoryFactor",a),this.setDirty())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"lodFactor",{set:function(a){this.lodFactor!==a&&(this._set("lodFactor",a),this.supportsResolution&&this.restart())},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"memoryForUnusedFeatures",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=b.estimatedUnusedSize});return a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"totalVertices",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=b.numVertices});return a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"totalFeatures",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=
b.numFeatures});return a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"filterExtent",{set:function(a){if(a&&this.context.tilingScheme&&!a.spatialReference.equals(this.context.tilingScheme.spatialReference))N.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.reclip(a,b))}},enumerable:!0,configurable:!0});c.prototype.initialize=
function(){var a=this;this.fetchQueue=this.createFetchQueue();this.handles.add(x.on(this,"tileDescriptors","change",function(){return a.setDirty()},function(){return a.setDirty()}));this.objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?J:Q;var b=this.context.scheduler;q.isSome(b)&&this.handles.add(b.registerTask(C.Task.FEATURE_TILE_FETCHER,function(b){return a.update(b)},function(){return a._dirty||0<a.maximumNumberOfFeaturesExceededNext}));
this.setDirty()};c.prototype.destroy=function(){var a=this;this.handles&&(this.handles.destroy(),this.handles=null);this.forEachFeatureTile(function(b){a.cancelFetchTile(b);a.removeTile(b)});this.idToFeatureTile.clear();this.displayingFeatureReferences.clear();this.fetchQueue.destroy();this.fetchQueue=null;this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)};Object.defineProperty(c.prototype,"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!0,
configurable:!0});c.prototype.restart=function(){var a=this;this.fetchQueue.clear();q.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.forEachFeatureTile(function(b){a.cancelFetchTile(b);a.resetFetchTile(b)});this.setDirty()};c.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())};c.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())};c.prototype.pause=function(){this.paused&&(this.fetchQueue.pause(),this.fetchQueue.reset(),
this.updated())};c.prototype.unpause=function(){this.paused||(this.setDirty(),this.fetchQueue.resume(),this.updated())};c.prototype.getFeatureTileById=function(a){return this.idToFeatureTile.get(a)||null};c.prototype.forEachFeatureTile=function(a){this.idToFeatureTile.forEach(a)};c.prototype.applyEdits=function(a){var b=this;this.pendingEdits||(this.pendingEdits={edits:r.resolve(),count:0,controller:r.createAbortController()},this.pause());this.pendingEdits.count++;var c=this.pendingEdits.edits.then(function(){return a.result.catch(function(a){if(r.isAbortError(a))throw a;
return null}).then(function(a){return a?(b.applyEditsDeleteFeatures(a.deletedFeatures),d.safeCast(b.applyEditsAddUpdateFeatures(a.addedFeatures,a.updatedFeatures,b.pendingEdits.controller.signal).then(function(){return a}))):a}).then(function(a){0===--b.pendingEdits.count&&(b.pendingEdits=null,q.isSome(b.context.memoryCache)&&b.context.memoryCache.clear(),b.unpause(),b.updated());return a})});this.pendingEdits.edits=c;this.updated();return c};c.prototype.applyEditsDeleteFeatures=function(a){var b=
this;if(0!==a.length){var c=new Set;a.forEach(function(a){return c.add(a.objectId)});this.forEachFeatureTile(function(a){if(a.features){var d=a.features.filter(function(a){return!c.has(y.getObjectId(a,b.objectIdField))});d.length!==a.features.length&&(a.setFeatures(d,0),b.invalidateCounts())}})}};c.prototype.applyEditsAddUpdateFeatures=function(b,c,e){return a(this,void 0,void 0,function(){var a,f,h,k=this;return g(this,function(g){switch(g.label){case 0:a=[];f=new Set;b.forEach(function(b){return a.push(b.objectId)});
c.forEach(function(b){a.push(b.objectId);f.add(b.objectId)});if(0===a.length)return[2];h=[];this.forEachFeatureTile(function(b){(b=d.safeCast(k.applyEditsAddUpdateTile(b,a,f,e)))&&h.push(b)});return[4,r.eachAlways(h)];case 1:return g.sent(),[2]}})})};c.prototype.applyEditsAddUpdateTile=function(b,c,d,e){return a(this,void 0,void 0,function(){var a,f,h,k,l,m,n,p=this;return g(this,function(g){switch(g.label){case 0:if(!b.features)return[2];a=this.createQuery(b);a.resultType=void 0;a.cacheHint=!1;a.objectIds=
c;return[4,this.queryFeatures(a,e)];case 1:f=g.sent();h=null;0<d.size&&(k=b.features.filter(function(a){return!d.has(y.getObjectId(a,p.objectIdField))}),k.length!==b.features.length&&(h=k));if(0<f.features.length)for(h||(h=b.features.slice()),this.context.adjustVerticalScale(f.features),l=0,m=f.features;l<m.length;l++)n=m[l],h.push(n);h&&(b.setFeatures(h,0),this.invalidateCounts());return[2]}})})};c.prototype.queryFeatures=function(a,b){return this.context.query.queryFeaturesDehydrated(a,{signal:b,
timeout:S})};c.prototype.createFetchQueue=function(){var a=this;return new D.QueueProcessor({concurrency:6,task:C.Task.FEATURE_TILE_FETCHER,scheduler:this.context.scheduler,peeker:function(b){return a.highestPriorityTile(b)},process:function(b,c){return a.fetchTile(b,c)}})};c.prototype.highestPriorityTile=function(a){return a.reduce(function(a,b){return a&&a.descriptor.loadPriority<=b.descriptor.loadPriority?a:b},null)};c.prototype.setDirty=function(){this._dirty=!0;this.updated()};c.prototype.update=
function(a){var b=this;this.maximumNumberOfFeaturesExceededNext&&p()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded();if(this._dirty&&this.constructed){this._dirty=!1;var c=this.getListOfTiles();this.markTilesNotAlive(c);if(a.run(function(){return b.addTiles(c,a)})&&a.run(function(){return b.filterExtentTiles(c,a)})&&a.run(function(){return b.removeTiles(c,a)})&&!a.done){var d=this.sortTiles(c);a.run(function(){return b.displayTiles(d,a)})&&a.run(function(){return b.queueFetchTiles(d,
a)})&&a.run(function(){return b.updateMemoryEstimates(d,a)})||this.setDirty();this.updated()}else this.setDirty()}};c.prototype.markTilesNotAlive=function(a){for(var b=0;b<a.length;b++)a[b].alive=!1};c.prototype.addTiles=function(a,b){var c=this;if(this.suspended)return!1;this.tileDescriptors.forEach(function(d){var e=c.getFeatureTileById(d.id);e?e.alive=!0:b.done||(a.push(c.addTile(d)),b.madeProgress())});return b.hasProgressed};c.prototype.filterExtentTiles=function(a,b){for(var c=0;c<a.length;c++){var d=
a[c];if(b.done)break;d.alive&&(d.filtered=!d.intersects(this.filterExtent),d.filtered&&(this.clearTile(d),b.madeProgress()))}return b.hasProgressed};c.prototype.removeTiles=function(a,b){for(var c=a.length-1;0<=c&&!b.done;c--){var d=a[c];d.alive||(this.removeTile(d),c!==a.length-1&&(a[c]=a[a.length-1]),a.pop(),b.madeProgress())}return b.hasProgressed};c.prototype.sortTiles=function(a){a.sort(function(a,b){return a.descriptor.loadPriority-b.descriptor.loadPriority});return a};c.prototype.displayTiles=
function(a,b){for(var c=this,d=this.updateRatio(a),e=function(a){if(!b.run(function(){var b=1>c._fullRatio?d(a)*c._farRatio:1;a.reduceFeatures(b,c.memoryFactor,c.objectIdField)&&c.setDirty();return c.showTile(a)}))return f.setDirty(),"break"},f=this,g=0;g<a.length&&"break"!==e(a[g]);g++);return b.hasProgressed};c.prototype.queueFetchTiles=function(a,b){for(var c=this,d=function(a){if(!b.run(function(){return c.queueFetchTile(a)}))return e.setDirty(),{value:!0}},e=this,f=0;f<a.length;f++){var g=d(a[f]);
if("object"===typeof g)return g.value}return b.hasProgressed};c.prototype.updateMemoryEstimates=function(a,b){var c=this;a.some(function(a){return b.run(function(){return a.updateMemoryEstimates()})?!1:(c.setDirty(),!0)});return b.hasProgressed};c.prototype.reclip=function(a,b){var c=this;this.constructed&&(this.forEachFeatureTile(function(d){d.displayingFeatures&&0!==d.displayingFeatures.length&&(d.intersection(b,M),d.intersection(a,R),u.equals(M,R)||c.hideTileFeatures(d))}),this.forEachFeatureTile(function(a){return c.showTile(a)}),
this.updated())};c.prototype.updated=function(){var a=this,b=this._dirty||0<this.fetchQueue.length&&!this.paused||!!this.pendingEdits;this._set("updating",b);if(b){var c=b=0,d=0,e=0,f=0,g=0,h=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.forEachFeatureTile(function(b){++d;if(b.isFetching&&b.hasPreciseFeatureCount){var k=a.maximumFeaturesForTile(b)*(1-b.emptyFeatureRatio);g+=k-(b.displayingFeatures?b.displayingFeatures.length*h:0)}b.needsFetching?++f:0<b.numFeatures&&
(++e,c+=b.numFeatures)});var k=f+=this.fetchQueue?this.fetchQueue.length:0;c?(k=f*c/e,b=c+k):b=d;g=Math.min(this.maximumNumberOfFeatures-this.features.length,g);this._set("updatingTotal",b);this._set("updatingRemaining",k);this._set("expectedFeatureDiff",g)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update();this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||p()+
this.maximumNumberOfFeaturesExceededThrottle)};c.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var a=!1;this.forEachFeatureTile(function(b){a=a||b.perTileMaximumNumberOfFeaturesExceeded});this.maximumNumberOfFeaturesExceededNext=0;this._set("maximumNumberOfFeaturesExceeded",a)}};c.prototype.updateRatio=function(a){for(var b=I(a),c=function(a){return 1/(1<<Math.max(0,b-a.descriptor.lij[0]))},d=0,e=0,f=0;f<a.length;f++)var g=a[f],h=g.numFeatures,d=d+h,e=e+h*c(g);this._fullRatio=
Math.min(1,this.maximumNumberOfFeatures/d);this._farRatio=this.maximumNumberOfFeatures/e;this.scheduleUpdated();return c};c.prototype.maximumFeaturesUpdated=function(a,b){var c=this;a!==b&&(b>a&&this.forEachFeatureTile(function(a){if(a.featuresMissing){var b=c.maximumFeaturesForTile(a);a.features&&(a.features.length>=b||5===a.fetchStatus)||(c.cancelFetchTile(a),c.resetFetchTile(a))}}),this.setDirty())};c.prototype.addTile=function(a){a=new B(a);this.idToFeatureTile.set(a.id,a);this.resetFetchTile(a);
this.referenceDisplayingFeaturesFromRelatedTiles(a);return a};c.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(a){var b=this,c=a.descriptor.resolution;this.forEachFeatureTile(function(d){if(d.displayingFeatures&&b.tilesAreRelated(a,d)){a.displayingFeatures=a.displayingFeatures||[];var e=0;for(d=d.displayingFeatures;e<d.length;e++){var f=d[e];a.displayingFeatures.push(f);f=b.displayingFeatureReferences.get(y.getObjectId(f,b.objectIdField));f.ref(c,f.feature);b.numDisplayingFeatureReferences++}}});
a.featureLimit=a.displayingFeatures?a.displayingFeatures.length:0};c.prototype.tilesAreRelated=function(a,b){if(a===b)return!1;a=a.descriptor.lij;var c=b.descriptor.lij;if(!a||!c)return!0;var d=a[0]<c[0];b=d?a:c;a=d?c:a;c=a[0]-b[0];if(0===c)return!1;c=1<<c;return Math.floor(a[1]/c)===b[1]&&Math.floor(a[2]/c)===b[2]};c.prototype.removeTile=function(a){this.clearTile(a);this.idToFeatureTile.delete(a.id)};c.prototype.resetFetchTile=function(a){a.filtered=!a.intersects(this.filterExtent);a.filtered?a.needsFetching&&
(a.fetchStatus=4):a.fetchStatus=0};c.prototype.cancelFetchTile=function(a){a.fetchRequest&&(a.fetchRequest=null,a.fetchStatus=0,this.fetchQueue.abort(a))};c.prototype.fetchTile=function(b,c){return a(this,void 0,void 0,function(){var a,d,e,f,h,k,l,m,n,p,q,u;return g(this,function(g){switch(g.label){case 0:if(!this.needsNumFeatures(b))return[3,4];g.label=1;case 1:return g.trys.push([1,3,,4]),a=b,[4,this.fetchCount(b,c)];case 2:return a.numFeatures=g.sent(),this.updateRatio(this.getListOfTiles()),[3,
4];case 3:return d=g.sent(),r.isAbortError(d)?[2,void 0]:[3,4];case 4:e=this.maximumFeaturesForTile(b);f=this.getMaxRecordCount(b);h=Math.ceil(e/f);if(K(b)||!this.context.capabilities.supportsMaxRecordCountFactor||b.numFeatures<=e&&h>v.MAX_MAX_RECORD_COUNT_FACTOR)return[2,this.fetchPagedTile(b,c)];k=this.createQuery(b);k.maxRecordCountFactor=Math.ceil(e/f);b.isRefetching&&b.features&&0<b.features.length&&(l=Math.ceil(b.features.length/(1-b.emptyFeatureRatio)/f),k.maxRecordCountFactor=Math.max(l+1,
k.maxRecordCountFactor));return[4,this.queryFeatures(k,c)];case 5:return m=g.sent(),n=m.features,q=(p=m.exceededTransferLimit)?k.maxRecordCountFactor>=v.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,b.featuresMissing=n.length<b.numFeatures||p,u=this._removeEmptyFeatures(n),this.context.adjustVerticalScale(n),b.setFeatures(n,u),this.invalidateCounts(),[2,q]}})})};c.prototype.fetchCount=function(b,c){return a(this,void 0,void 0,function(){return g(this,function(a){return[2,this.context.query.queryFeatureCount(this.createFeatureCountQuery(b),
{signal:c})]})})};c.prototype.fetchPagedTile=function(b,c){return a(this,void 0,void 0,function(){var a,d,e,f,h,k,l,m,n,p,q;return g(this,function(g){switch(g.label){case 0:f=d=a=0,h=this.maximumFeaturesForTile(b)-f,k=this.getMaxRecordCount(b),g.label=1;case 1:return l=this.createQuery(b),m=this.setPagingParameters(l,a,h,k),[4,this.queryFeatures(l,c)];case 2:return n=g.sent(),p=n.features,q=n.exceededTransferLimit,m&&(a+=l.num),f+=p.length,d+=this._removeEmptyFeatures(p),this.context.adjustVerticalScale(p),
b.featuresMissing=a<b.numFeatures||q,e=e?e.concat(p):p,b.setFeatures(e,d),this.invalidateCounts(),this.setDirty(),h=this.maximumFeaturesForTile(b)-f,!m||!q||0>=h?[2,q?4:5]:[3,1];case 3:return[2]}})})};c.prototype.createFeatureCountQuery=function(a){a=this.createQuery(a);this.context.capabilities.supportsCacheHint&&(a.resultType=void 0,a.cacheHint=!0);return a};c.prototype.createQuery=function(a){var b=this.context.createQuery(),c=a.descriptor.extent;c&&(b.geometry=u.toExtent(c,this.context.tilingScheme.spatialReference));
this.setResolutionParams(b,a);this.useTileQuery(a)?b.resultType="tile":this.context.capabilities.supportsCacheHint&&(b.cacheHint=!0);return b};c.prototype.setPagingParameters=function(a,b,c,d){if(!this.context.capabilities.supportsPagination)return!1;a.start=b;0<c&&this.context.capabilities.supportsMaxRecordCountFactor?(a.maxRecordCountFactor=Math.ceil(c/d),a.num=Math.min(a.maxRecordCountFactor*d,c)):a.num=Math.min(d);return!0};c.prototype.getEffectiveTileResolution=function(a){if(null==a.descriptor.resolution)return null;
var b="global"===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(a.descriptor.resolution,b)/this.lodFactor};Object.defineProperty(c.prototype,"supportsResolution",{get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType},enumerable:!0,configurable:!0});c.prototype.setResolutionParams=function(a,b){this.supportsResolution&&(b=this.getEffectiveTileResolution(b),null!=b&&(this.context.capabilities.supportsQuantization?
a.quantizationParameters=new m.default({mode:"view",originPosition:"upper-left",tolerance:b,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(a.maxAllowableOffset=b)))};c.prototype._removeEmptyFeatures=function(a){for(var b=a.length,c=0;c<a.length;)y.hasVertices(a[c].geometry)?++c:(a[c]=a[a.length-1],--a.length);return b-a.length};c.prototype.needsNumFeatures=function(a){return this.useTileCount&&!a.hasPreciseFeatureCount&&!K(a)};c.prototype.getMaxRecordCount=function(a){var b=
this.context,c=b.tileMaxRecordCount,b=b.maxRecordCount;return this.useTileQuery(a)&&q.isSome(c)&&0<c&&this.context.capabilities.supportsResultType?c:q.isSome(b)&&0<b?b:L};c.prototype.useTileQuery=function(a){return K(a)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};c.prototype.queueFetchTile=function(a){var b=this;if(!a.needsFetching)return!1;var c=q.isSome(this.context.memoryCache)&&this.context.memoryCache.pop(a.id);if(c)return a.loadCache(c),this.setDirty(),
this.scheduleUpdated(),!0;a.fetchStatus=a.needsRefetching?3:2;var d=!1,e=!1,f=this.fetchQueue.push(a).then(function(b){a.fetchRequest=null;a.fetchStatus=b}).catch(function(c){a.fetchRequest===f&&(a.fetchRequest=null,a.fetchStatus=4);r.isAbortError(c)?d=!0:(a.setFeatures([],0),b.invalidateCounts(),a.featuresMissing=!1,b.context.logFetchError(N,c))}).then(function(){e=!0;d||b.setDirty();b.scheduleUpdated()});e||(a.fetchRequest=f);return!0};c.prototype.scheduleUpdated=function(){var a=this;this.handles&&
!this.handles.has("scheduleUpdated")&&this.handles.add(t.schedule(function(){a.handles.remove("scheduleUpdated");a.updated()}),"scheduleUpdated")};c.prototype.showTile=function(a){if(a.displayingFeatures&&!a.needsDisplayUpdate)return!1;var b=a.features;if(0===a.featureLimit||!b)return b=a.displayingFeatures&&0<a.displayingFeatures.length,this.hideTileFeatures(a),a.displayingFeatures=[],b;var c=a.descriptor.resolution,d=this.changes.updates,e=this.changes.adds,f=Math.min(a.featureLimit,b.length);a.featureLimit=
f;for(var g=0;g<f;++g){var h=b[g],k=y.getObjectId(h,this.objectIdField),l=this.displayingFeatureReferences.get(k);l?(h=l.ref(c,h),h.oldVersion!==h.newVersion&&(d.removes.push(h.oldVersion),d.adds.push(h.newVersion))):(this.displayingFeatureReferences.set(k,new this.FeatureReferenceClass(c,h)),e.push(h));this.numDisplayingFeatureReferences++}this.hideTileFeatures(a);this.applyChanges();a.displayingFeatures=b.slice(0,f);return!0};c.prototype.hideTile=function(a){this.cancelFetchTile(a);this.hideTileFeatures(a)};
c.prototype.hideTileFeatures=function(a){if(a.displayingFeatures){for(var b=this.changes.updates,c=this.changes.removes,d=0,e=a.displayingFeatures;d<e.length;d++){var f=y.getObjectId(e[d],this.objectIdField),g=this.displayingFeatureReferences.get(f);g&&((g=g.unref(a.descriptor.resolution),this.numDisplayingFeatureReferences--,g)?g.oldVersion!==g.newVersion&&(null==g.newVersion?(this.displayingFeatureReferences.delete(f),c.push(g.oldVersion)):(b.adds.push(g.newVersion),b.removes.push(g.oldVersion))):
console.error("Hiding unreferenced feature"))}this.applyChanges();a.displayingFeatures=null}};c.prototype.applyChanges=function(){var a=this.changes.updates;0<a.removes.length&&(this.features.removeMany(a.removes),a.removes.length=0);0<a.adds.length&&(this.features.addMany(a.adds),a.adds.length=0);for(var a=this.changes.adds,b=this.changes.removes,c=Math.min(a.length,b.length),d=0;d<c;){var e=Math.min(d+T,c);this.features.addMany(a.slice(d,e));this.features.removeMany(b.slice(d,e));d=e}a.length>c&&
this.features.addMany(0===d?a:a.slice(d));b.length>c&&this.features.removeMany(0===d?b:b.slice(d));a.length=0;b.length=0};c.prototype.clearTile=function(a){this.hideTile(a);a.features&&q.isSome(this.context.memoryCache)&&this.context.memoryCache.put(a.id,a.cacheItem,16+a.estimatedSize);a.setFeatures(null,0);this.invalidateCounts()};c.prototype.invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};c.prototype.getListOfTiles=
function(){var a=Array(this.idToFeatureTile.size),b=0;this.forEachFeatureTile(function(c){return a[b++]=c});return a};Object.defineProperty(c.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce(function(a,b){return a+(b.features?b.features.length:0)},0)},enumerable:!0,configurable:!0});c.prototype.maximumFeaturesForTile=function(a){return Math.min(Math.ceil((a.hasPreciseFeatureCount?a.numFeatures:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-a.emptyFeatureRatio)),
a.hasPreciseFeatureCount?a.numFeatures:Infinity)};Object.defineProperty(c.prototype,"test",{get:function(){var a=this;return{update:function(b){a.fetchQueue.test.update(b);a.update(b)}}},enumerable:!0,configurable:!0});k([w.property({constructOnly:!0})],c.prototype,"features",void 0);k([w.property()],c.prototype,"tileDescriptors",void 0);k([w.property({value:Infinity})],c.prototype,"maximumNumberOfFeatures",null);k([w.property({value:1})],c.prototype,"memoryFactor",null);k([w.property({value:1})],
c.prototype,"lodFactor",null);k([w.property()],c.prototype,"useTileCount",void 0);k([w.property({readOnly:!0})],c.prototype,"updating",void 0);k([w.property({readOnly:!0})],c.prototype,"updatingTotal",void 0);k([w.property({readOnly:!0})],c.prototype,"updatingRemaining",void 0);k([w.property({readOnly:!0})],c.prototype,"expectedFeatureDiff",void 0);k([w.property({readOnly:!0})],c.prototype,"memoryForUnusedFeatures",null);k([w.property({readOnly:!0})],c.prototype,"maximumNumberOfFeaturesExceeded",
void 0);k([w.property({constructOnly:!0})],c.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);k([w.property({readOnly:!0})],c.prototype,"totalVertices",null);k([w.property({readOnly:!0})],c.prototype,"totalFeatures",null);k([w.property()],c.prototype,"filterExtent",null);k([w.property({constructOnly:!0})],c.prototype,"context",void 0);return c=k([w.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],c)}(w.declared(e));b.FeatureTileFetcher3D=n;b.contextCapabilitiesFromLayer=function(a){var b=
a.capabilities.query;a:switch(a.geometryType){case "polyline":a=!0;break a;case "polygon":a=a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsQuantization;break a;default:a=!1}return{supportsMultipleResolutions:a,supportsPagination:!(!b||!b.supportsPagination),supportsResultType:!(!b||!b.supportsResultType),supportsCacheHint:!(!b||!b.supportsCacheHint),supportsQuantization:!(!b||!b.supportsQuantization),supportsQuantizationEditMode:!(!b||!b.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!b||
!b.supportsMaxRecordCountFactor),supportsFormatPBF:!(!b||!b.supportsFormatPBF)}};var L=2E3,M=u.create(),R=u.create(),S=6E5,T=200;b.default=n})},"esri/views/3d/layers/support/featureReference":function(){define(["require","exports","../../../../layers/graphics/dehydratedFeatures"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){this.highestResolutionVersion=null;this.versions=[];this.markedTile=null;this.ref(a,b)}Object.defineProperty(b.prototype,"isReferenced",
{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0});b.prototype.ref=function(a,b){var e=this.feature;k.oldVersion=e;this.feature&&(b.uid=this.feature.uid);for(var d=0,f=this.versions;d<f.length;d++){var c=f[d];if(c.resolution===a){c.refCount++;if((a=this.highestResolutionVersion===c&&!l.equals(b,c.feature))||this.highestResolutionVersion!==
c)c.feature=b;k.newVersion=a?b:e;return k}}c={feature:b,resolution:a,refCount:1};this.versions.push(c);!this.highestResolutionVersion||a<this.highestResolutionVersion.resolution?(k.newVersion=b,this.highestResolutionVersion=c):k.newVersion=e;return k};b.prototype.unref=function(a){for(var b=0;b<this.versions.length;b++){var e=this.versions[b];if(e.resolution===a)return e.refCount--,k.oldVersion=this.feature,0===e.refCount&&(this.versions[b]=this.versions[this.versions.length-1],this.versions.length--,
this.highestResolutionVersion===e&&(this.recalculateHighestResolutionVersion(),k.oldVersion=e.feature)),k.newVersion=this.feature,k}return null};Object.defineProperty(b.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0});b.prototype.recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{for(var a=this.versions[0],b=1;b<this.versions.length;b++){var e=
this.versions[b];e.resolution<a.resolution&&(a=e)}this.highestResolutionVersion=a}};return b}();b.MultiFeatureReference=n;n=function(){function b(a,b){this._feature=b;this.refCount=1;this.markedTile=null}Object.defineProperty(b.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0});b.prototype.ref=function(a,b){++this.refCount;k.oldVersion=
this._feature;this.feature&&(b.uid=this.feature.uid);l.equals(this._feature,b)||(this._feature=b);k.newVersion=this._feature;return k};b.prototype.unref=function(a){k.oldVersion=this._feature;if(0<this.refCount&&(this.refCount--,!this.isReferenced))return k.newVersion=null,k;k.newVersion=this._feature;return k};Object.defineProperty(b.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0});return b}();b.SingleFeatureReference=n;var k={oldVersion:null,newVersion:null}})},
"esri/views/3d/layers/support/FeatureTile":function(){define(["require","exports","../../../../core/arrayUtils","../../../../geometry/support/aaBoundingRect","../../../../layers/graphics/dehydratedFeatures"],function(n,b,l,k,h){n=function(){function b(a){this.descriptor=a;this.fetchRequest=null;this.fetchStatus=0;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=b.UNKNOWN_COUNT;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=
0;this._estimatedUnusedSizeDirty=!1;this.displayingFeatures=null;this.alive=!0;this.filtered=!1}Object.defineProperty(b.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"featureLimit",{get:function(){return this._featureLimit},
set:function(a){this._featureLimit!==a&&(this._featureLimit=a,this._estimatedUnusedSizeDirty=!0)},enumerable:!0,configurable:!0});b.prototype.setFeatures=function(a,b){this._features=a;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;a&&0<a.length?(this._emptyFeatureRatio=b/(a.length+b),this._numVertices=a.reduce(function(a,b){return a+h.numVertices(b.geometry)},0)):this._numVertices=this._emptyFeatureRatio=0};Object.defineProperty(b.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"numFeatures",{get:function(){return this._numFeatures!==b.UNKNOWN_COUNT?this._numFeatures:this._features?this._features.length:0},set:function(a){this._numFeatures=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures!==b.UNKNOWN_COUNT},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"estimatedSize",{get:function(){this.updateMemoryEstimates();return this._estimatedSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"estimatedUnusedSize",{get:function(){return this._estimatedUnusedSize},enumerable:!0,configurable:!0});b.prototype.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=
this._estimatedSize=0;if(this._features)for(var a=0;a<this._features.length;++a){var b=h.estimateSize(this._features[a]);this._estimatedSize+=b;a>=this.featureLimit&&(this._estimatedUnusedSize+=b)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(a=this.featureLimit;a<this._features.length;++a)this._estimatedUnusedSize+=h.estimateSize(this._features[a]);return!0}return!1};Object.defineProperty(b.prototype,"isFetching",{get:function(){return 2===
this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsFetching",{get:function(){return 0===this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsDisplayUpdate",{get:function(){var a;if(a=!!this._features){a:{a=this._features;var b=this.displayingFeatures,f=this.featureLimit;if(!b||!a||f!==b.length||f>a.length)a=!1;else{for(var c=0;c<f;++c)if(a[c]!==b[c]){a=!1;break a}a=!0}}a=!a}return a},enumerable:!0,configurable:!0});b.prototype.intersects=function(b){if(!b||!this.descriptor.extent)return!0;
k.fromExtent(b,a);return k.intersects(this.descriptor.extent,a)};b.prototype.intersection=function(a,b){if(!a&&!this.descriptor.extent)return k.set(b,k.POSITIVE_INFINITY),b;a?(k.fromExtent(a,b),this.descriptor.extent&&k.intersection(b,this.descriptor.extent,b)):k.set(b,this.descriptor.extent);return b};b.prototype._shuffle=function(a){this._features.sort(function(b,e){return h.getObjectId(b,a)-h.getObjectId(e,a)});l.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0};b.prototype.reduceFeatures=
function(a,b,f){if(0>=a)return!1;var c=!1;this._features?(this.featureLimit=Math.ceil(this.numFeatures*a),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&0<this._features.length&&(this.fetchStatus=1,c=!0)),!this._shuffled&&1>a&&this._shuffle(f),a=Math.max(this.featureLimit,Math.ceil(b*this.numFeatures)),this._features.length>a&&(this._features.length=a,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4))):this.featureLimit=0;return c};
Object.defineProperty(b.prototype,"cacheItem",{get:function(){return{features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},enumerable:!0,configurable:!0});b.prototype.loadCache=function(a){this.fetchRequest=null;this._features=a.features;this._numFeatures=a.numFeatures;this._emptyFeatureRatio=a.emptyFeatureRatio;this.fetchStatus=a.fetchStatus;this.featuresMissing=a.featuresMissing;this._estimatedSize=
-1;this._estimatedUnusedSizeDirty=!0};return b}();(n||(n={})).UNKNOWN_COUNT=-1;var a=k.create();return n})},"esri/views/support/QueueProcessor":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/scheduling".split(" "),function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});var d=function(){return function(a,b){this.item=a;this.controller=b;this.promise=null}}();
n=function(){function b(a){var b=this;this._deferreds=new Map;this._controllers=new Map;this._processingItems=new Map;this._isPaused=!1;this._task=this._schedule=null;this.concurrency=1;a.concurrency&&(this.concurrency=a.concurrency);this._queue=new g({peeker:a.peeker});this.process=a.process;var c=a.scheduler;a.task&&h.isSome(c)&&(this._task=c.registerTask(a.task,function(a){return b.update(a)},function(){return b.needsUpdate()}))}b.prototype.destroy=function(){this.clear();this._schedule&&(this._schedule.remove(),
this._schedule=null);this._task&&(this._task.remove(),this._task=null)};Object.defineProperty(b.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length},enumerable:!0,configurable:!0});b.prototype.abort=function(a){(a=this._controllers.get(a))&&a.abort()};b.prototype.clear=function(){this._queue.clear();var a=[];this._controllers.forEach(function(b){return a.push(b)});this._controllers.clear();a.forEach(function(a){return a.abort()});this._processingItems.clear();this._cancelNext()};
b.prototype.get=function(a){return(a=this._deferreds.get(a))?a.promise:void 0};b.prototype.isOngoing=function(a){return this._processingItems.has(a)};b.prototype.has=function(a){return this._deferreds.has(a)};b.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())};b.prototype.push=function(b){return k(this,void 0,void 0,function(){var c,d,e,f,g,h,k=this;return l(this,function(l){if(c=this.get(b))return[2,c];e=a.createAbortController();f=function(){var c=k._processingItems.get(b);
c&&c.controller.abort();g();d.reject(a.createAbortError())};g=function(){h.remove();k._deferreds.delete(b);k._controllers.delete(b);k._queue.remove(b);k._processingItems.delete(b);k._scheduleNext()};h=a.onAbortOrThrow(e.signal,f);d=a.createDeferred();this._deferreds.set(b,d);this._controllers.set(b,e);d.promise.then(g,g);this._queue.push(b);this._scheduleNext();return[2,d.promise]})})};b.prototype.reset=function(){var a=[];this._processingItems.forEach(function(b){return a.push(b)});this._processingItems.clear();
for(var b=0;b<a.length;b++){var d=a[b];this._queue.push(d.item);d.controller.abort()}this._scheduleNext()};b.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())};b.prototype.needsUpdate=function(){return!this._isPaused&&0<this._queue.length&&this._processingItems.size<this.concurrency};b.prototype.update=function(a){for(;!a.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),a.madeProgress()};b.prototype._scheduleNext=
function(){var a=this;this._task||this._isPaused||this._schedule||(this._schedule=e.schedule(function(){a._schedule=null;a._next()}))};b.prototype._next=function(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())};b.prototype._cancelNext=function(){this._schedule&&(this._schedule.remove(),this._schedule=null)};b.prototype._processResult=function(a,b){this._canProcessFulfillment(a)&&(this._scheduleNext(),this._deferreds.get(a.item).resolve(b))};
b.prototype._processError=function(a,b){this._canProcessFulfillment(a)&&(this._scheduleNext(),this._deferreds.get(a.item).reject(b))};b.prototype._canProcessFulfillment=function(a){return this._deferreds.get(a.item)&&this._processingItems.get(a.item)===a?!0:!1};b.prototype._process=function(b){var c=this;if(!h.isNone(b)){var e,f=a.createAbortController(),g=new d(b,f);this._processingItems.set(b,g);try{e=this.process(b,f.signal)}catch(x){this._processError(g,x)}e&&"function"===typeof e.then?(g.promise=
e,e.then(function(a){return c._processResult(g,a)},function(a){return c._processError(g,a)})):this._processResult(g,e)}};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{update:function(b){return a.update(b)}}},enumerable:!0,configurable:!0});return b}();b.QueueProcessor=n})},"esri/core/Queue":function(){define(["require","exports"],function(n,b){return function(){function b(b){this._items=[];this._itemSet=new Set;this._peeker=function(b){return b[0]};this._length=0;b&&b.peeker&&
(this._peeker=b.peeker)}Object.defineProperty(b.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0});b.prototype.clear=function(){this._itemSet.clear();this._length=this._items.length=0};b.prototype.peek=function(){if(0!==this._length)return this._peeker(this._items)};b.prototype.push=function(b){this.contains(b)||this._add(b)};b.prototype.contains=function(b){return 0<this._length&&this._itemSet.has(b)};b.prototype.pop=function(){if(0!==this._length){var b=this.peek();
this._remove(b);return b}};b.prototype.remove=function(b){this.contains(b)&&this._remove(b)};b.prototype._add=function(b){this._items.push(b);this._itemSet.add(b);this._length++};b.prototype._remove=function(b){this._itemSet.delete(b);this._items.splice(this._items.indexOf(b),1);this._length--};return b}()})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("require exports ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});var f=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];n=function(){function b(a,b,c){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=a;this.view=c;this.tilingScheme=
new d(b);this.loadedSymbols=f.map(function(a){return new g(new h({material:{color:[a[0],a[1],a[2],.6]},outline:{color:"black",size:1}}))});this.loadingSymbols=[new g(new h({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new g(new h({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new g(new h({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}b.prototype.destroy=function(){this.enabled=!1};Object.defineProperty(b.prototype,
"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});b.prototype.update=function(){var a=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(a){return a.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(a){return!a.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(a){return!a.isFetching},symbols:this.pendingSymbols}),
this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))};b.prototype.showDataExtent=function(a){this.dataExtentGraphic&&
(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);a&&(a=k.fromExtent(a),this.dataExtentGraphic=new l({geometry:a,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};b.prototype.synchronizeMaps=function(b,c){var d=this,f=[];b.forEach(function(a,b){var e=d.tileFetcher.getFeatureTileById(b);e&&c.filter(e)||(d.view.graphics.removeMany(a),f.push(b))});f.forEach(function(a){return b.delete(a)});this.tileFetcher.forEachFeatureTile(function(f){if(c.filter(f)&&
!b.has(f.id)){var g=f.descriptor.lij,h=g[0],k=g[1],m=g[2];d.tilingScheme.ensureMaxLod(h);var n=d.tilingScheme.getExtentGeometry(h,k,m),g=new l({geometry:n,symbol:c.symbols[h%c.symbols.length]}),h=new l({geometry:n.center,symbol:new a({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new e({text:h+"/"+k+"/"+m,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})}),h=[g,h];b.set(f.id,h);d.view.graphics.addMany(h)}})};return b}();
b.FeatureTileFetcher3DDebugger=n;b.default=n})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../renderers/support/renderingInfoUtils ../../../tasks/support/Query ./graphics/Graphics3DFeatureLikeLayerView ./graphics/QueryEngine ./support/projectExtentUtils ../../support/index".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m){Object.defineProperty(b,"__esModule",{value:!0});b.FeatureLikeLayerView3D=function(b){return function(b){function n(){var a=null!==b&&b.apply(this,arguments)||this;a.controller=null;a.asyncGraphicsUpdates=!1;a.suspendResumeExtentMode="computed";a.slicePlaneEnabled=!1;a.supportsDraping=!0;a.overlayUpdating=!1;a.fullExtentInLocalViewSpatialReference=null;a.suspendResumeExtent=null;a._controllerCreated=!1;a.clippingExtent=null;a.supportsHeightUnitConversion=
!0;a.pendingController=null;a.queryEngine=null;return a}l(n,b);n.prototype.initialize=function(){var a=this;this.layer.isTable?this.addResolvingPromise(c.reject(new d("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer}))):(this._set("graphics3d",new w({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,
preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(b){return a.updateClippingExtent(b)}})),this.updatingHandles.add(this,"asyncGraphicsUpdates",function(b){a.graphics3d.graphicsCore.preferredUpdatePolicy=b?1:0}),this.updatingHandles.add(this,"suspendResumeExtentMode",function(b){a.graphics3d.suspendResumeExtentMode=b}),this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this.addResolvingPromise(e.safeCast(this.graphics3d.setup()).then(function(){return a.validateGeometryType()}).then(function(){return a.queryEngine=
new u.default({layerView:a,task:m.Task.FEATURE_QUERY_ENGINE})}).then(function(){return y.toViewIfLocal(a)}).then(function(b){return a.fullExtentInLocalViewSpatialReference=b}).then(function(){return a.initializeController()})),this.notifyChange("updating"))};n.prototype.destroy=function(){this.destroyPendingController();this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this.queryEngine&&(this.queryEngine.destroy(),
this.queryEngine=null);this.loadedGraphics=null};n.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};Object.defineProperty(n.prototype,"drawingOrder",{set:function(a){this.graphics3d.graphicsCore.setDrawingOrder(a);this._set("drawingOrder",a)},enumerable:!0,configurable:!0});n.prototype.getRenderingInfo=function(a,b){(a=t.getRenderingInfo(a,{renderer:b}))&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};
n.prototype.getRenderingInfoAsync=function(b,c,d){return a(this,void 0,void 0,function(){return h(this,function(a){return[2,t.getRenderingInfoAsync(b,g({renderer:c},d))]})})};n.prototype.getGraphicFromGraphicUid=function(a){var b=this,c=null;this.loadedGraphics&&this.loadedGraphics.forEach(function(d){d.uid===a&&(c=r.hydrateGraphic(d,b.layer))});return c};Object.defineProperty(n.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},
enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0});n.prototype.whenGraphicBounds=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(a,
b):null};n.prototype.whenSymbolLayerSize=function(a,b){return this.graphics3d?e.safeCast(this.graphics3d.graphicsCore.whenSymbolLayerSize(a,b)):null};n.prototype.queryFeatures=function(a,b){return e.safeCast(this.queryEngine.executeQuery(this._ensureQuery(a),f.get(b,"signal")))};n.prototype.queryObjectIds=function(a,b){return e.safeCast(this.queryEngine.executeQueryForIds(this._ensureQuery(a),f.get(b,"signal")))};n.prototype.queryFeatureCount=function(a,b){return e.safeCast(this.queryEngine.executeQueryForCount(this._ensureQuery(a),
f.get(b,"signal")))};n.prototype.queryExtent=function(a,b){return e.safeCast(this.queryEngine.executeQueryForExtent(this._ensureQuery(a),f.get(b,"signal")))};n.prototype._ensureQuery=function(a){return f.isNone(a)?this.createQuery():x.from(a)};n.prototype.highlight=function(a,b){void 0===b&&(b={});return this.graphics3d.highlight(a,b,this.layer.objectIdField)};n.prototype.getStats=function(){var a=this.graphics3d.graphicsCore.getStats();a.features=this.loadedGraphics.length;a.updating=this.updating;
a.elevationUpdating=this.graphics3d.elevationAlignment.updating;a.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended;a.visibilityScale=!this.graphics3d.scaleVisibility.suspended;return a};n.prototype.canResume=function(){return!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended?!1:!0};n.prototype.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!(!(!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating)&&this.view.basemapTerrain&&
this.view.basemapTerrain.ready&&!this.graphics3d.updating)};n.prototype.initializeController=function(){return a(this,void 0,void 0,function(){var a;return h(this,function(b){switch(b.label){case 0:return[4,this.createController()];case 1:return this.pendingController=a=b.sent(),[4,a.when()];case 2:return b.sent(),this.setControllerWhenInitialized(a),[2]}})})};n.prototype.setControllerWhenInitialized=function(b){return a(this,void 0,void 0,function(){return h(this,function(a){switch(a.label){case 0:return a.trys.push([0,
2,,3]),[4,this.when()];case 1:return a.sent(),[3,3];case 2:return a.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,q.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return a.sent(),this.pendingController=null,this.controller=b,this.loadedGraphics=b.graphics,this.notifyChange("updating"),[2]}})})};n.prototype.updateClippingExtent=function(a){this.clippingExtent=a;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;
case "feature-tile-3d":return this.controller.extent=a,!0}};n.prototype.validateGeometryType=function(){var a=this.layer;switch(a.geometryType){case "multipatch":case "multipoint":return c.reject(new d("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:a.geometryType}))}};k([p.property()],n.prototype,"loadedGraphics",void 0);k([p.property({dependsOn:["graphics3d.suspended"]})],n.prototype,"suspended",void 0);k([p.property({dependsOn:["graphics3d.updating",
"controller.updating","overlayUpdating"]})],n.prototype,"updating",void 0);k([p.property()],n.prototype,"controller",void 0);k([p.property()],n.prototype,"graphics3d",void 0);k([p.property({readOnly:!0})],n.prototype,"asyncGraphicsUpdates",void 0);k([p.property({readOnly:!0})],n.prototype,"suspendResumeExtentMode",void 0);k([p.property({type:Boolean})],n.prototype,"slicePlaneEnabled",void 0);k([p.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],n.prototype,"hasDraped",void 0);k([p.property({readOnly:!0,
type:Boolean})],n.prototype,"supportsDraping",void 0);k([p.property({type:Boolean})],n.prototype,"overlayUpdating",void 0);k([p.property()],n.prototype,"drawingOrder",null);return n=k([p.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],n)}(p.declared(b))}})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Graphic ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/diffUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DHighlights ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../../../support/WatchUpdatingTracking".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K){var I={remove:function(){},pause:function(){},resume:function(){}};return function(b){function e(a){a=b.call(this)||this;a._handles=new c;a.highlights=new z;a.watchUpdatingTracking=new K.WatchUpdatingTracking;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}l(e,b);Object.defineProperty(e.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&
this.frustumVisibility.suspended},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0});e.prototype.normalizeCtorArgs=function(a){var b=a.frustumVisibilityEnabled?new v:null,c=a.scaleVisibilityEnabled?new B:null,d=(a.filterVisibilityEnabled||a.timeExtentVisibilityEnabled)&&
"multipatch"!==a.layer.geometryType?new m.Graphics3DFilterVisibility:null,e=a.elevationAlignmentEnabled?new y:null;return{graphicsCore:new u({owner:a.owner,layer:a.layer,preferredUpdatePolicy:a.preferredUpdatePolicy,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:a.owner.hasZ,hasM:a.owner.hasM}),frustumVisibility:b,scaleVisibility:c,filterVisibility:d,elevationAlignment:e,updateClippingExtent:a.updateClippingExtent,suspendResumeExtentMode:a.suspendResumeExtentMode,
dataExtent:a.dataExtent}};e.prototype.initialize=function(){var a=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()});this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",function(){return a.filterVisibility.filterChanged()}),this.watchUpdatingTracking.add(this.owner,"timeExtent",function(){return a.filterVisibility.filterChanged()}));this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,
"elevationInfo",function(b,c){t.diff(b,c)&&a.graphicsCore.elevationInfoChange()});this.watchUpdatingTracking.add(this.layer,"labelsVisible",function(){return a.graphicsCore.updateVisibilityInfo()});this.watchUpdatingTracking.add(this.layer,"labelingInfo",function(b,c){t.diff(b,c)&&a.graphicsCore.updateLabelingInfo()})};e.prototype.setup=function(){return a(this,void 0,void 0,function(){var a,b,c,e,f=this;return h(this,function(g){switch(g.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),
a=this.owner,b=this.owner.view.basemapTerrain,c=function(a,b,c){return f.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(a,b,c)},this.scaleVisibility&&this.scaleVisibility.setup(a,this.layer,c,this.graphicsCore,b),this.filterVisibility&&("filter"in a||"timeExtent"in a)&&this.filterVisibility.setup(a,this.graphicsCore),this.elevationAlignment&&(e=a.view.elevationProvider,this.elevationAlignment.setup(a,c,this.graphicsCore,e)),this.highlights&&this.highlights.setup(this.graphicsCore),this._set("labeling",
this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",a.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,d.result(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,highlights:this.highlights}))];case 1:return g.sent(),this._handles.add([this.layer.watch("renderer",function(a){return f.graphicsCore.rendererChange(a)}),
a.watch("fullOpacity",function(){return f.graphicsCore.opacityChange()})]),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this._handles.add(a.view.watch("clippingArea",function(){return f._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,d.result(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:g.sent(),g.label=3;case 3:return[2]}})})};e.prototype.destroy=function(){this._handles&&(this._handles.destroy(),
this._handles=null);for(var a=0,b="watchUpdatingTracking frustumVisibility scaleVisibility filterVisibility elevationAlignment highlights graphicsCore".split(" ");a<b.length;a++){var c=b[a],d=this[c];d&&(d.destroy(),this._set(c,null))}this._set("layer",null);this._set("owner",null)};e.prototype.highlight=function(a,b,c){var d=this;if(a instanceof x){b=this.highlights.acquireSet(b,c);var e=b.set,f=b.handle;this.owner.queryObjectIds(a).then(function(a){return d.highlights.setObjectIds(e,a)});return f}if("number"===
typeof a||a instanceof g)return this.highlight([a],b,c);"toArray"in a&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof g)if(f=a,c&&f[0].attributes&&null!==D.attributeLookup(f[0].attributes,c))a=f.map(function(a){return D.attributeLookup(a.attributes,c)});else return a=f.map(function(a){return a.uid}),f=this.highlights.acquireSet(b,null),b=f.set,f=f.handle,this.highlights.setUids(b,a),f;if("number"===typeof a[0])return f=this.highlights.acquireSet(b,c),b=f.set,f=f.handle,this.highlights.setObjectIds(b,
a),f}return I};e.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};e.prototype.setupSuspendResumeExtent=function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(q.init(this,"suspendResumeExtentMode",function(){a._handles.remove("suspendResumeExtentMode");switch(a.suspendResumeExtentMode){case "computed":a._handles.add(q.init(a.graphicsCore,
"computedExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;case "data":a._handles.add(q.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;default:f.neverReached(a.suspendResumeExtentMode)}}))};e.prototype.updateSuspendResumeExtent=function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};e.prototype.extentToSuspendResumeRect=
function(a,b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!r.canProject(a,c))return;a=r.project(a,c)}return C.enlargeExtent(a,b,w.SUSPEND_RESUME_EXTENT_OPTIMISM)};e.prototype.suspendResumeExtentChanged=function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);this.scaleVisibility&&this.scaleVisibility.setExtent(a)};k([p.property({aliasOf:"graphicsCore.layer"})],e.prototype,"layer",void 0);k([p.property({aliasOf:"graphicsCore.owner"})],e.prototype,"owner",
void 0);k([p.property({constructOnly:!0})],e.prototype,"updateClippingExtent",void 0);k([p.property({constructOnly:!0})],e.prototype,"graphicsCore",void 0);k([p.property({constructOnly:!0})],e.prototype,"scaleVisibility",void 0);k([p.property({constructOnly:!0})],e.prototype,"filterVisibility",void 0);k([p.property({constructOnly:!0})],e.prototype,"elevationAlignment",void 0);k([p.property({constructOnly:!0})],e.prototype,"frustumVisibility",void 0);k([p.property({readOnly:!0})],e.prototype,"deconfliction",
void 0);k([p.property({readOnly:!0})],e.prototype,"labeling",void 0);k([p.property({readOnly:!0})],e.prototype,"highlights",void 0);k([p.property({readOnly:!0})],e.prototype,"watchUpdatingTracking",void 0);k([p.property()],e.prototype,"suspendResumeExtentMode",void 0);k([p.property()],e.prototype,"dataExtent",void 0);k([p.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],e.prototype,"suspended",null);k([p.property({readOnly:!0,dependsOn:["graphicsCore.updating",
"frustumVisibility.updating","watchUpdatingTracking.updating"]})],e.prototype,"updating",null);return e=k([p.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],e)}(p.declared(e))})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry ../../../../renderers ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/diffUtils ../../../../renderers/support/rendererConversion ../../../../support/arcadeUtils ../../../../symbols/support/symbolConversion ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphic ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./graphicUtils ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/projectionUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/Layer ../../../support/index".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T,U,Y,X,P,V,Z,ca,da,F,ea,la,ka,oa,va){var fa=new g.Point,xa=D.vec3f64.create(),ia=K.create(),na=x.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");n=function(b){function f(a){a=b.call(this)||this;a.propertiesPool=new la.PropertiesPool({computedExtent:g.Extent},a);a.computedExtent=null;a.currentRenderer=null;a.rendererHasGeometryOperations=!1;a.symbolCreationContext=new X.Graphics3DSymbolCreationContext;a.graphics3DGraphics=
new Map;a.stageLayer=null;a.stage=null;a.graphicsDrapedUids=new Set;a.graphicsBySymbol=new Map;a.symbolConversionCache=new Map;a.symbols=new Map;a.graphicsWithoutSymbol=new Map;a.graphicsWaitingForSymbol=new Set;a.handles=new r;a.suspendSymbolCleanup=!1;a._spatialReference=null;a.elevationAlignment=null;a.scaleVisibility=null;a.filterVisibility=null;a._spatialIndex=null;a._updatingPendingLoadedGraphicsChange=null;a.featureStore=null;a.deconflictor=null;a.labeler=null;a.highlights=null;a.viewElevationProvider=
null;a.stageLayerElevationProvider=null;a.sharedSymbolResourcesOwnerHandle=null;a.whenGraphics3DGraphicRequests={};a.pendingUpdates=new Map;a.numberOfGraphics=0;a.numberOfGraphicsProvidingElevation=0;a.pendingAdds=0;a.pendingRemoves=0;a.pendingUpdatesPool=new m({allocator:function(a){return a||{add:null,renderingInfo:null,abortController:null,state:0,remove:null}},deallocator:function(a){a.add=null;a.renderingInfo=null;a.remove=null;a.state=0;a.abortController=null;return a}});a.symbolWarningLogged=
!1;a.geometryWarningLogged=!1;a.objectIdInvisibleSet=new Set;a._whenSymbolRemoved=new m;a.preferredUpdatePolicy=0;a._asyncUpdates=!1;a.elevationFeatureExpressionEnabled=!0;a.owner=null;a.layer=null;a.hasDraped=!1;a.graphicSymbolSupported=!0;a.hasZ=null;a.hasM=null;a._usedMemory=0;a._visible=void 0;a._startCreateGraphics=!1;a.maxPendingUpdates=0;return a}l(f,b);n=f;Object.defineProperty(f.prototype,"spatialIndex",{get:function(){if(!this._spatialIndex){this._spatialIndex=new ca.default({objectIdField:this.owner.layer&&
this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM});var a=0,b=Array(this.graphics3DGraphics.size);this.graphics3DGraphics.forEach(function(c){return b[a++]=c});this._spatialIndex.addMany(b)}return this._spatialIndex},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"asyncUpdates",{get:function(){return this._asyncUpdates},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updating",{get:function(){return!!(0<this.graphicsWaitingForSymbol.size||
this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating||this._updatingPendingLoadedGraphicsChange)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updatingTotal",{get:function(){return this.updating?
this.maxPendingUpdates:0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"displayFeatureLimit",{get:function(){var a=this.owner&&this.owner.view&&this.owner.view.qualitySettings,b=a?a.graphics3D.minTotalNumberOfFeatures:0,c=a?a.graphics3D.maxTotalNumberOfFeatures:0,a=a?a.graphics3D.maxTotalNumberOfPrimitives:0,d=this.maxSymbolComplexity,e=Math.max(b,Math.min(c,Math.ceil(a/Math.max(1,d?d.primitivesPerFeature:1)))),f=this._get("displayFeatureLimit");return f&&f.minimumTotalNumberOfFeatures===
b&&f.maximumTotalNumberOfFeatures===c&&f.maximumTotalNumberOfPrimitives===a&&f.maximumSymbolComplexity===d&&f.maximumNumberOfFeatures===e?f:{minimumTotalNumberOfFeatures:b,maximumTotalNumberOfFeatures:c,maximumTotalNumberOfPrimitives:a,maximumSymbolComplexity:d,maximumNumberOfFeatures:e}},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maxSymbolComplexity",{get:function(){for(var a=null,b=this.symbolComplexities,c=this._get("maxSymbolComplexity"),d=!1,e=0;e<b.length;e++){var f=
b[e];if(!a||0===a.primitivesPerCoordinate&&f.primitivesPerFeature>a.primitivesPerFeature||0!==a.primitivesPerCoordinate&&f.primitivesPerCoordinate>a.primitivesPerCoordinate)a=f;d=d||f.estimated}return!a||d&&c&&(c.primitivesPerFeature>=a.primitivesPerFeature||c.primitivesPerCoordinate>=a.primitivesPerCoordinate)||c&&c.primitivesPerFeature===a.primitivesPerFeature&&c.primitivesPerCoordinate===a.primitivesPerCoordinate?c:a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"spatialReference",
{get:function(){return this._spatialReference},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"usedMemory",{get:function(){return this._usedMemory+(this.maxSymbolComplexity&&this.labelsEnabled?this.maxSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?
this.maxSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.maxSymbolComplexity.memory.bytesPerFeatureLabel:0):0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"symbolComplexities",{get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):
this.getSymbolComplexitiesUsed()},enumerable:!0,configurable:!0});f.prototype.getConvertedSymbol=function(a){if("web-style"===a.type)return a.clone();var b=this.symbolConversionCache.get(a.id);if(void 0!==b)return b;var b=R.to3D(a,!0,!1,this.hasLabelingContext(a)),c=b.symbol||null;c||b.error&&na.error(b.error.message);this.symbolConversionCache.set(a.id,c);return c};f.prototype.getSymbolComplexitiesUsedOrRenderer=function(a){var b=a.getSymbols(),c="backgroundFillSymbol"in a&&a.backgroundFillSymbol;
if(!(c||b&&b.length))return[];a=[];c=this.getSymbolComplexityUsedOrRenderer(c);u.isSome(c)&&a.push(c);for(c=0;c<b.length;c++){var d=this.getSymbolComplexityUsedOrRenderer(b[c]);u.isSome(d)&&a.push(d)}return a};f.prototype.getSymbolComplexityUsedOrRenderer=function(a){if(u.isNone(a))return null;var b=this.symbols.get(a.id);return b?b.complexity:(a=this.getConvertedSymbol(a))?da.defaultSymbolComplexity(a):null};f.prototype.getSymbolComplexitiesUsed=function(){var a=[];this.symbols.forEach(function(b){b&&
a.push(b.complexity)});return a};f.prototype.initialize=function(){var a=this;this._spatialReference=this.owner.view.spatialReference;this._set("featureStore",new U.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:function(){return a.spatialIndex},forAllGraphics:function(b){return a.graphics3DGraphics.forEach(b)}}))};f.prototype.setup=function(b){return a(this,void 0,void 0,function(){var a,
c,d,e,f=this;return h(this,function(g){this._set("elevationAlignment",b.elevationAlignment);this._set("scaleVisibility",b.scaleVisibility);this._set("filterVisibility",b.filterVisibility);this._set("deconflictor",b.deconflictor);this._set("labeler",b.labeler);this._set("highlights",b.highlights);a=this.owner.view;this.viewElevationProvider=new S.ViewElevationProvider(this._spatialReference,a);this.initializeStage(a,this.layer.uid);this.symbolCreationContext.sharedResources=a.sharedSymbolResources;
this.sharedSymbolResourcesOwnerHandle=a.sharedSymbolResources.addGraphicsOwner(this.owner);this.symbolCreationContext.renderer=this.currentRenderer;this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=a.sharedSymbolResources.streamDataRequester;this.symbolCreationContext.renderSpatialReference=a.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=a.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=
this.owner;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=new ka;this.symbolCreationContext.elevationProvider=a.elevationProvider;c=T.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=T.createContext(c,this._spatialReference,na);this.symbolCreationContext.screenSizePerspectiveEnabled=a.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=
!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled;this.handles.add(this.owner.watch("suspended",function(){return f.updateLayerVisibility()}));d="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled";this.handles.add([this.owner.watch(d,function(){var b=a.screenSizePerspectiveEnabled&&f.layer.screenSizePerspectiveEnabled;
b!==f.symbolCreationContext.screenSizePerspectiveEnabled&&(f.symbolCreationContext.screenSizePerspectiveEnabled=b,f.recreateAllGraphics())}),B.init(this,"preferredUpdatePolicy",function(){return f.updateUpdatePolicy()},!0),this.owner.watch("slicePlaneEnabled",function(a){return f.slicePlaneEnabledChange(!!a)}),this.owner.view.watch("pixelRatio",function(a){return f.pixelRatioChange(a)}),this.owner.view.watch("qualitySettings.physicallyBasedRenderingEnabled",function(a){return f.physicalBasedRenderingChange(a)}),
B.when(a.basemapTerrain,"tilingScheme",function(b){b.spatialReference.equals(f.symbolCreationContext.overlaySR)||(f.symbolCreationContext.overlaySR=a.basemapTerrain.spatialReference);f.handles.has("loaded-graphics")?f.recreateAllGraphics():f.handles.add([B.on(f.owner,"loadedGraphics","change",function(a){return f.graphicsCollectionChanged(a)},function(){return f.recreateAllGraphics()}),B.on(f.owner,"loadedGraphics","after-changes",function(){return f._signalUpdatingDuringAsyncLoadedGraphicsChange()},
function(){return f._signalUpdatingDuringAsyncLoadedGraphicsChange()})],"loaded-graphics")}),a.resourceController.scheduler.registerTask(va.Task.GRAPHICS_CORE,function(a){return f.update(a)},function(){return f.needsUpdate()})]);this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",function(){return f.deconflictor.featureReductionChange()}));e=this.rendererChange(this.layer.renderer);this.notifyChange("maxSymbolComplexity");return[2,e]})})};
f.prototype.destroy=function(){this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this._updatingPendingLoadedGraphicsChange&&(this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=null);this.clear();this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(0,this.stageLayer.id),this.stage=this.stageLayer=null);this.handles.destroy();this._spatialReference=this.handles=null;this._set("owner",
null);for(var a in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[a].reject(new p("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null);this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear();
this._spatialIndex&&(this._spatialIndex.destroy(),this._spatialIndex=null);this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",null))};f.prototype.clear=function(){this.graphics3DGraphics.forEach(function(a){return a.destroy()});this._spatialIndex&&this._spatialIndex.clear();this.graphics3DGraphics.clear();this._usedMemory=this.numberOfGraphics=0;this.updateLayerVisibility();this.symbols.forEach(function(a){a&&a.destroy()});this.symbols.clear();this.graphicsBySymbol.clear();this.graphicsWithoutSymbol.clear();
this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=this.pendingAdds=this.maxPendingUpdates=0;this._set("hasDraped",!1);this.notifyChange("updating");this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.featureStore.events.emit("changed")};f.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new oa(b,{isPickable:!this.owner.suspended},b);this.stage.add(0,this.stageLayer);this.stage.addToViewContent([this.stageLayer.id])};
f.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var b=new Set;this.symbols.forEach(function(c){c&&c.setDrawOrder(a,b)});0<b.size&&this.stage.renderView.getDrapedRenderer().updateRenderOrder(b)};f.prototype.updateLayerVisibility=function(){var a=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*ya,a=!this.owner.suspended&&!a;a!==this._visible&&((this._visible=a)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=
!1,this.hideAllGraphics()),this.updateStageLayerVisibility())};f.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};f.prototype.getGraphics3DGraphicById=function(a){return this.graphics3DGraphics.get(a)};f.prototype._getGraphicObjectID=function(a,b){void 0===b&&(b=this.owner.layer&&this.owner.layer.objectIdField);return J.getObjectId(a,b)};Object.defineProperty(f.prototype,"graphics3DGraphicsByObjectID",{get:function(){var a=
this,b=this.owner.layer&&this.owner.layer.objectIdField;if(!b)return null;var c=new Map;this.graphics3DGraphics.forEach(function(d){if(d){var e=a._getGraphicObjectID(d.graphic,b);u.isSome(e)&&c.set(e,d)}});return c},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"labelsEnabled",{get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())},enumerable:!0,configurable:!0});f.prototype.updateLabelingInfo=function(b){return a(this,void 0,void 0,function(){var a,c;return h(this,
function(d){switch(d.label){case 0:return a=this.deconflictor&&this.deconflictor.labelingInfoChange(b),c=this.labeler&&this.labeler.labelingInfoChange(b),[4,v.eachAlways([a,c])];case 1:return d.sent(),[2]}})})};f.prototype.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange();this.labeler&&this.labeler.visibilityInfoChange()};Object.defineProperty(f.prototype,"symbolUpdateType",{get:function(){var a=this;if(0<this.pendingUpdates.size)return"unknown";var b=0,c=0;
return t.everyMap(this.symbols,function(d,e){if(d){d=d.getFastUpdateStatus();if(0<d.loading)return!1;a.graphicsBySymbol.has(e)&&(c+=d.fast,b+=d.slow)}return!0})?0<=c&&0===b?"fast":0<=b&&0===c?"slow":"mixed":"unknown"},enumerable:!0,configurable:!0});f.prototype.needsUpdate=function(){return 0<this.pendingUpdates.size};f.prototype.update=function(a){this._applyPendingUpdates(a);this.needsUpdate()||this.notifyChange("updating")};f.prototype.setObjectIdVisibility=function(a,b){b?this.objectIdInvisibleSet.delete(a):
this.objectIdInvisibleSet.add(a);a=this._findGraphics3DGraphicByObjectId(a);u.isSome(a)&&this._updateUserVisibility(a)};f.prototype._findGraphics3DGraphicByObjectId=function(a){var b=this,c;t.everyMap(this.graphics3DGraphics,function(d){return b._getGraphicObjectID(d.graphic)===a?(c=d,!1):!0});return c};f.prototype._updateUserVisibility=function(a){if(u.isNone(a))return!1;var b=a.graphic,c=this._getGraphicObjectID(b),b=b.visible&&!this.owner.suspended&&(u.isNone(c)||!this.objectIdInvisibleSet.has(c));
return a.setVisibilityFlag(0,b,0)};f.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics3DGraphics.get(a.uid);if(b)return v.resolve(b);if(b=this.whenGraphics3DGraphicRequests[a.uid])return b.promise;b=v.createDeferred();this.whenGraphics3DGraphicRequests[a.uid]=b;return b.promise};f.prototype.boundsForGraphics3DGraphic=function(b,c){return a(this,void 0,void 0,function(){var a,d,e,f,g,k,l,m,n,p;return h(this,function(h){switch(h.label){case 0:return a=this._spatialReference,d=this.owner.view.renderSpatialReference,
e=this.owner.view.basemapTerrain.spatialReference,f=function(b,c,e){return ea.bufferToBuffer(b,d,c,b,a,c,e)},g=function(b,c,d){return ea.bufferToBuffer(b,e,c,b,a,c,d)},k=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:u.isSome(c)&&c.useViewElevation,minDemResolution:u.isSome(c)&&c.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,b.getProjectedBoundingBox(f,g,k,u.get(c,"signal"))];case 1:l=h.sent();if(!l)return[2,null];m=l.boundingBox;l.requiresDrapedElevation&&
(n=this.symbolCreationContext.elevationProvider)&&(K.center(m,xa),fa.x=xa[0],fa.y=xa[1],fa.z=void 0,fa.spatialReference=a,p=n.getElevation(fa)||0,m[2]=Math.min(m[2],p),m[5]=Math.max(m[5],p));return[2,{boundingBox:m,screenSpaceObjects:l.screenSpaceObjects}]}})})};f.prototype.whenGraphicBounds=function(a,b){var c=this;return B.whenOnce(this.owner,"loadedGraphics").then(function(){var b=c.owner.layer&&c.owner.layer.objectIdField,d=c.owner.loadedGraphics.find(function(c){return c===a?!0:b&&c.attributes&&
a.attributes&&c.attributes[b]===a.attributes[b]});if(d)return c.whenGraphics3DGraphic(d);throw new p("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return c.boundsForGraphics3DGraphic(a,b)})};f.prototype.whenSymbolLayerSize=function(b,c){return a(this,void 0,void 0,function(){var a,d,e;return h(this,function(f){switch(f.label){case 0:a=this.symbols.get(b.id);if(null==a)throw new p("internal:symbol-not-part-of-view","Symbol is not part of this view");d=
b.symbolLayers.indexOf(c);if(-1===d)throw new p("internal:missing-symbol-layer","Symbol layer is not in symbol");return[4,a.whenSymbolLayerSize(d)];case 1:e=f.sent();if(null==e)throw new p("internal:missing-size","Symbol layer has no valid size");return[2,e]}})})};f.prototype.graphicsCollectionChanged=function(a){this._startCreateGraphics&&(this.add(a.added),this.remove(a.removed))};f.prototype.graphicUpdateHandler=function(a){var b=a.graphic.uid,c=this.graphics3DGraphics.get(b),b=this.graphicsWithoutSymbol.get(b);
if(c||b)switch(a.property){case "visible":this.graphicUpdateVisibleHandler(c,a);break;case "geometry":this.graphicUpdateGeometryHandler(c,a);break;case "symbol":this.graphicUpdateSymbolHandler(c,a);break;case "attributes":break;default:q.neverReached(a)}};f.prototype.graphicUpdateGeometryHandler=function(a,b){var c=b.graphic.geometry;if(u.isNone(c))this.recreateGraphic(b.graphic);else if(u.isNone(a)){if((a=b.graphic.symbol&&b.graphic.symbol.id)&&(a=this.symbols.get(a))&&0===a.loadStatus)return;this.recreateGraphic(b.graphic)}else a.graphics3DSymbol.updateGeometry(a,
b.newValue)||this.recreateGraphic(a.graphic),this.expandComputedExtent(c)};f.prototype.graphicUpdateSymbolHandler=function(a,b){var c=b.graphic,d=u.isSome(a)?a.graphics3DSymbol:b.oldValue&&this.symbols.get(b.oldValue.id);if(d){var e=d.symbol;b=this.getConvertedSymbol(b.newValue);if(b.type!==e.type||"web-style"===b.type||"web-style"===e.type)this.recreateGraphic(c);else{var f=this.graphicsBySymbol.get(e.id);if(f&&1!==f.size)this.recreateGraphic(c);else if(f=N.diff(e,b),u.isNone(f))this.updateSymbolMapping(e.id,
b);else if(f={diff:f,graphics3DGraphicPatches:[],symbolStatePatches:[]},d.prepareSymbolPatch(f),N.isEmpty(f.diff)){for(var g=0,h=f.symbolStatePatches;g<h.length;g++)d=h[g],d();c=this._getRenderingInfo(c);if(u.isSome(a))for(g=0,f=f.graphics3DGraphicPatches;g<f.length;g++)d=f[g],d(a,c);this.updateSymbolMapping(e.id,b)}else this.recreateGraphic(c)}}else this.recreateGraphic(c)};f.prototype.graphicUpdateVisibleHandler=function(a,b){(a=this._updateUserVisibility(a))&&this.labeler&&this.owner.view.labeler.setDirty();
a&&this.owner.view.deconflictor.setDirty()};f.prototype.recreateGraphic=function(a){a=[a];this.suspendSymbolCleanup=!0;this.remove(a);this.add(a);this.suspendSymbolCleanup=!1;this.asyncUpdates||this._cleanupSymbols()};f.prototype._beginGraphicUpdate=function(a){this.graphicsWaitingForSymbol.add(a.uid);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)};f.prototype._endGraphicUpdate=function(a){a&&(this.graphicsWaitingForSymbol.delete(a.uid),
0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))};f.prototype.expandComputedExtent=function(a){var b=a.spatialReference;J.computeAABB(a,ia);a=this._spatialReference;var c=n.tmpVec;!b.equals(a)&&ea.xyzToVector(ia[0],ia[1],0,b,c,a)&&(ia[0]=c[0],ia[1]=c[1],ea.xyzToVector(ia[3],ia[4],0,b,c,a),ia[3]=c[0],ia[4]=c[1]);if(w.isFinite(ia[0])&&w.isFinite(ia[3])&&
w.isFinite(ia[1])&&w.isFinite(ia[4])){var b=this.computedExtent,c=null,d=w.isFinite(ia[2])&&w.isFinite(ia[5]),e=d&&(!b||null==b.zmin||ia[2]<b.zmin),d=d&&(!b||null==b.zmax||ia[5]>b.zmax);if(b){if(ia[0]<b.xmin||ia[1]<b.ymin||ia[3]>b.xmax||ia[4]>b.ymax||e||d)c=this.propertiesPool.get("computedExtent"),c.xmin=Math.min(ia[0],b.xmin),c.ymin=Math.min(ia[1],b.ymin),c.xmax=Math.max(ia[3],b.xmax),c.ymax=Math.max(ia[4],b.ymax),c.spatialReference=a}else c=this.propertiesPool.get("computedExtent"),c.xmin=ia[0],
c.ymin=ia[1],c.xmax=ia[3],c.ymax=ia[4],c.spatialReference=a;c&&(e&&(c.zmin=ia[2]),d&&(c.zmax=ia[5]),this._set("computedExtent",c))}};f.prototype.updateHasDraped=function(){this._set("hasDraped",0<this.graphicsDrapedUids.size)};f.prototype.elevationInfoChange=function(){var a=this,b=T.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=T.createContext(b,this._spatialReference,na);this.labeler&&this.labeler.elevationInfoChange();
this.forEachGraphics3DSymbol(function(b,c,d){b.globalPropertyChanged("elevationInfo",c)?c.forEach(function(a){var b=a.graphic;a=a._labelGraphics;for(var c=0;c<a.length;c++){var d=a[c];d.graphics3DSymbolLayer.updateGraphicElevationContext(b,d)}}):a._recreateSymbol(d)});this.updateStageLayerElevationProvider();this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()};f.prototype.updateStageLayerElevationProvider=function(){if(this.stageLayerElevationProvider){if(this.layer.elevationInfo&&
"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this.numberOfGraphicsProvidingElevation&&(this.stageLayerElevationProvider=new F.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,
view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))};f.prototype.clearSymbolsAndGraphics=function(){this.clear();this.filterVisibility&&this.filterVisibility.clear();this.labeler&&this.labeler.reset();this.deconflictor&&this.deconflictor.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),
this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)};f.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};f.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=
!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};f.prototype._recreateSymbol=function(a){var b=this,c=[];this.graphicsBySymbol.get(a).forEach(function(a,d){var e=a.usedMemory;b._conditionalRemove(a,d);b._spatialIndex&&b._spatialIndex.remove(a);c.push(a.graphic);a.destroy();b.removeGraphics3DGraphic(d,e);b.updateLayerVisibility();b.featureStore.events.emit("changed")});
this.graphicsBySymbol.set(a,new Map);var d=this.symbols.get(a);d&&d.destroy();this.symbols.delete(a);this.updateHasDraped();this.add(c)};f.prototype._conditionalRemove=function(a,b){a.isDraped()&&this.graphicsDrapedUids.delete(b);this.highlights&&this.highlights.removeGraphic(a);this.labeler&&this.labeler.removeGraphic(a);this.deconflictor&&this.deconflictor.removeGraphic(a)};f.prototype.add=function(a){a&&0!==a.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?
(this.asyncUpdates?this._addDelayed(a):this._addImmediate(a),this.notifyChange("updating")):na.error("#add()","Cannot add graphics before terrain surface has been initialized"))};f.prototype._addImmediate=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;wa.clear();for(var c=0;c<a.length;c++){var d=a[c];this._startAddGraphic(d,this._getRenderingInfo(d,na),wa)}wa.forEach(function(a){return b._finishAddGraphics(a)});wa.clear();this.updateHasDraped();this._cleanupSymbols();
this.owner.view.labeler.setDirty();this._cleanupSymbols()};f.prototype._addDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add?1===e.state&&e.abortController.abort():this.pendingAdds++:(e=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(d,e));e.add=c}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};f.prototype.remove=
function(a){this.asyncUpdates?this._removeDelayed(a):this._removeImmediate(a);this.notifyChange("updating")};f.prototype._removeImmediate=function(a){for(var b=0;b<a.length;b++)this._removeGraphic(a[b]);this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty()};f.prototype._removeDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add&&(e.remove?e.add=null:this.pendingUpdates.delete(d),1===e.state&&e.abortController.abort(),this.pendingAdds--):
(e=this.pendingUpdatesPool.pushNew(),e.remove=c,this.pendingUpdates.set(d,e),this.pendingRemoves++)}0===this.pendingUpdates.size&&this._finishPendingUpdates();this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};f.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();this.maxPendingUpdates=0;this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&na.warn("pendingAdds/Removes in inconsistent state!");
this.pendingRemoves=this.pendingAdds=0};f.prototype._applyPendingUpdates=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;var c=a.idleFrame?1E3:100,d=0;wa.clear();t.everyMap(this.pendingUpdates,function(e,f){e.add&&0===e.state&&b._startAddRenderingInfo(e);!e.remove||e.add&&2!==e.state||(b.pendingRemoves--,b._removeGraphic(e.remove),e.remove=null);if(e.add)switch(e.state){case 2:b._startAddGraphic(e.add,e.renderingInfo,wa)&&d++;e.add=null;b.pendingAdds--;break;case 3:e.add=
null,b.pendingAdds--}d>c&&(wa.forEach(function(a){return b._finishAddGraphics(a)}),wa.clear(),d=0);null==e.remove&&null==e.add&&(b.pendingUpdates.delete(f),a.madeProgress());return!a.done});wa.forEach(function(a){return b._finishAddGraphics(a)});wa.clear();0===this.pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.updateHasDraped()};f.prototype._startAddRenderingInfo=function(a){var b=this;u.isSome(this.layer.renderer)&&
"dictionary"===this.layer.renderer.type?(a.state=1,a.abortController=v.createAbortController(),this._getRenderingInfoAsync(a.add,{signal:a.abortController.signal}).then(function(c){u.isNone(c)||u.isNone(c.symbol)?(na&&!b.symbolWarningLogged&&(b.symbolWarningLogged=!0,na.warn("Graphic in layer "+b.layer.id+" has no symbol and will not render")),a.renderingInfo=null):a.renderingInfo=c;a.state=2},function(b){a.abortController=null;v.isAbortError(b)?a.state=0:a.state=3})):(a.renderingInfo=this._getRenderingInfo(a.add,
na),a.state=2)};f.prototype._startAddGraphic=function(a,b,c){this.graphicsWithoutSymbol.set(a.uid,a);if(!b||u.isNone(b.symbol)||!J.hasGeometry(a))return!1;var d=this.getOrCreateGraphics3DSymbol(b.symbol,b.renderer);if(!d)return!1;this.expandComputedExtent(a.geometry);this._beginGraphicUpdate(a);a={graphic:a,renderingInfo:b,layer:this.layer};b=d.symbol.id;var e=c.get(b);e?e.graphics.push(a):(e=ua.acquire(),e.clear(),e.push(a),c.set(b,{asyncSymbol:d,graphics:e}));return!0};f.prototype._finishAddGraphics=
function(a){var b=this,c=!1,d=function(b){b===a.asyncSymbol.symbol.id&&(c=!0)};this._whenSymbolRemoved.push(d);a.asyncSymbol.load().then(function(){b._whenSymbolRemoved.removeUnordered(d);Ca.clear();for(var e=0;e<a.graphics.length;e++){var f=a.graphics.data[e],g=f.graphic;c||a.asyncSymbol.destroyed||b.graphicSymbolSupported&&g.symbol&&g.symbol.id!==a.asyncSymbol.symbol.id||(b.graphicsWaitingForSymbol.has(g.uid)&&(f=b.createGraphics3DGraphic(a.asyncSymbol,f),b._spatialIndex&&f&&Ca.push(f)),b._endGraphicUpdate(g));
--a.asyncSymbol.referenced}0<Ca.length&&(b._spatialIndex.addMany(Ca.data,Ca.length),Ca.clear());b.featureStore.events.emit("changed");a.graphics.clear();ua.release(a.graphics);b.labeler&&b.owner.view.labeler.setDirty()},function(){b._whenSymbolRemoved.removeUnordered(d);if(!c&&!a.asyncSymbol.destroyed)for(var e=0;e<a.graphics.length;e++)b._endGraphicUpdate(a.graphics.data[e].graphic);a.graphics.clear();ua.release(a.graphics)})};f.prototype._removeGraphic=function(a){a=a.uid;var b=this.graphics3DGraphics.get(a);
if(b){b.graphics3DSymbol.onRemoveGraphic(b);var c=b.usedMemory,d=b.isElevationSource;this._conditionalRemove(b,a);this._spatialIndex&&this._spatialIndex.remove(b);this.graphicsBySymbol.get(b.graphics3DSymbol.symbol.id).delete(a);this.graphicsWithoutSymbol.delete(a);this.removeGraphics3DGraphic(a,c,d);b.destroy();this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(a),this.graphicsWaitingForSymbol.delete(a)};f.prototype.hasLabelingContext=function(a){if(a instanceof d.LabelSymbol3D||
a instanceof d.TextSymbol){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};f.prototype.hasValidSymbolCreationContext=function(a){return a instanceof d.LabelSymbol3D&&!this.hasLabelingContext(a)?(na.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};f.prototype._getRenderingInfo=function(a,b){if(u.isNone(a.geometry))return b&&!this.geometryWarningLogged&&
(this.geometryWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&u.isSome(a.symbol))return b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;a=this.rendererHasGeometryOperations?J.hydrateGraphic(a,this.layer):a;a=this.owner.getRenderingInfo(a,this.currentRenderer);return!a||u.isNone(a.symbol)?(b&&!this.symbolWarningLogged&&
(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null):a};f.prototype._getRenderingInfoAsync=function(a,b){if(u.isNone(a.geometry))return na&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,na.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&u.isSome(a.symbol))return na&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,na.warn("Graphic in layer "+this.layer.id+
" is not allowed to have a symbol, use a renderer instead")),null;a=this.rendererHasGeometryOperations?J.hydrateGraphic(a,this.layer):a;return this.owner.getRenderingInfoAsync(a,this.currentRenderer,b)};f.prototype.createGraphics3DSymbol=function(a,b){var c=this;if(!this.hasValidSymbolCreationContext(a))return null;a=this.getConvertedSymbol(a);if(!a)return null;var d;b&&"backgroundFillSymbol"in b&&b.backgroundFillSymbol&&(b=R.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&"web-style"!==b.symbol.type&&
(d=b.symbol.symbolLayers));d=P.make(a,this.symbolCreationContext,d);d.load().then(function(){return c.notifyChange("maxSymbolComplexity")});return d};f.prototype.getOrCreateGraphics3DSymbol=function(a,b){var c=this,e=this.symbols.get(a.id);void 0===e&&(e=a instanceof d.WebStyleSymbol?new V(a,function(a){return c.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols.set(a.id,e));e&&++e.referenced;return e};f.prototype.addGraphics3DGraphic=function(a){this._usedMemory+=a.usedMemory;
this.graphics3DGraphics.set(a.graphic.uid,a);this.numberOfGraphics++;a.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};f.prototype.removeGraphics3DGraphic=function(a,b,c){void 0===c&&(c=!1);this._usedMemory-=b;this.graphics3DGraphics.delete(a);this.numberOfGraphics--;c&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};f.prototype.createGraphics3DGraphic=
function(a,b){var c=b.graphic;this.graphicsWithoutSymbol.delete(c.uid);if(!this.symbols.has(a.symbol.id))this.add([c]);else if(!this.graphics3DGraphics.has(c.uid)){b=a.createGraphics3DGraphic(b);a=a.symbol.id;this.addGraphics3DGraphic(b);this.graphicsBySymbol.has(a)||this.graphicsBySymbol.set(a,new Map);this.graphicsBySymbol.get(a).set(c.uid,b);b.isDraped()&&(this.graphicsDrapedUids.add(c.uid),this._set("hasDraped",!0));b.centroid=null;u.isSome(c.geometry)&&"point"!==c.geometry.type&&b instanceof
Y&&(b.centroid=Z.computeCentroid(c.geometry,this._spatialReference));this._updateUserVisibility(b);this.scaleVisibility&&this.scaleVisibility.updateVisibility(b);this.filterVisibility&&this.filterVisibility.updateVisibility(b);this.deconflictor&&this.deconflictor.addGraphic(b);this.labeler&&this.labeler.addGraphic(b);this.highlights&&this.highlights.addGraphic(b);this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,b);b.initialize(this.stageLayer,this.stage);if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],
a.resolve(b);return b}};f.prototype.rendererChange=function(b){return a(this,void 0,void 0,function(){return h(this,function(a){switch(a.label){case 0:if(b===this.currentRenderer)return[2];this.validateRenderer(b);return M.hasGeometryOperations(b)?[4,M.enableGeometryOperations()]:[3,2];case 1:return a.sent(),this.layer.renderer===b&&this.currentRendererChange(b,!0),[3,3];case 2:this.currentRendererChange(b,!1),a.label=3;case 3:return[2]}})})};f.prototype.currentRendererChange=function(a,b){this.currentRenderer=
a;this.rendererHasGeometryOperations=b;b=this.symbolCreationContext.renderer;if(a!==b){this.updateUpdatePolicy();this.symbolConversionCache.clear();var c=N.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;u.isNone(c)||("complete"===c.type?this.recreateAllGraphics():"partial"===c.type&&(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}};f.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;
case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};f.prototype.applySymbolSetDiff=function(a,b,c,d){var e=this;a=a||[];b=b||[];var f=[];d=function(b){var d=g.graphicsBySymbol.get(b.id);d&&d.forEach(function(g,h){var k=g.graphic,l=e.layer instanceof Q?e.layer:null;if(b!==c.defaultSymbol||c.getSymbol(J.hydrateGraphic(k,l),{arcadeUtils:M})!==c.defaultSymbol)l=g.usedMemory,a.length||c.defaultSymbol?f.push(k):e.graphicsWithoutSymbol.set(h,k),k=e.graphics3DGraphics.get(h),
e._conditionalRemove(k,h),g.destroy(),d.delete(h),e.removeGraphics3DGraphic(h,l),e.updateLayerVisibility()});g._whenSymbolRemoved.forEach(function(a){return a(b.id)})};for(var g=this,h=0;h<b.length;h++)d(b[h]);if(a.length||f.length)this.graphicsWithoutSymbol.forEach(function(a){return f.push(a)}),this.graphicsWithoutSymbol.clear(),this.add(f);this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty()};f.prototype.applyUniqueValueRendererDiff=function(a,b,c){var d=a.diff.defaultSymbol,
e=a.diff.uniqueValueInfos;if(d||e){var f=e?e.added.map(function(a){return a.symbol}):[],g=e?e.removed.map(function(a){return a.symbol}):[];if(e)for(var h=0;h<e.changed.length;h++)f.push(e.changed[h].newValue.symbol),g.push(e.changed[h].oldValue.symbol);d?(c.defaultSymbol&&g.push(c.defaultSymbol),b.defaultSymbol&&f.push(b.defaultSymbol)):c.defaultSymbol&&f.length&&g.push(b.defaultSymbol);this.applySymbolSetDiff(f,g,b,c);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};
f.prototype.calculateUnchangedSymbolMapping=function(a,b,c){var d=function(a){return u.isSome(a)?a.id:null};if(b instanceof e.UniqueValueRenderer&&c instanceof e.UniqueValueRenderer&&(u.isNone(a)||"partial"===a.type)){var f=a&&a.diff;a=f&&f.defaultSymbol;var f=f&&f.uniqueValueInfos,g=void 0,g=f?f.unchanged.map(function(a){return{oldId:d(a.oldValue.symbol),newId:d(a.newValue.symbol)}}):c.uniqueValueInfos.map(function(a,c){return{oldId:d(a.symbol),newId:d(b.uniqueValueInfos[c].symbol)}});!a&&c.defaultSymbol&&
g.push({oldId:d(c.defaultSymbol),newId:d(b.defaultSymbol)});return g}return[]};f.prototype.updateSymbolMapping=function(a,b){var c=b?"string"===typeof b?b:b.id:null;b="string"===typeof b?null:b;if(a&&a!==c){var d=this.graphicsBySymbol.get(a);this.graphicsBySymbol.delete(a);void 0!==d&&this.graphicsBySymbol.set(c,d);d=this.symbols.get(a);this.symbols.delete(a);void 0!==d&&(this.symbols.set(c,d),b?d.symbol=b:d.symbol.id=c)}};f.prototype.updateUnchangedSymbolMappings=function(a,b,c){var d=0;for(a=this.calculateUnchangedSymbolMapping(a,
b,c);d<a.length;d++)b=a[d],this.updateSymbolMapping(b.oldId,b.newId)};f.prototype.applyRendererDiff=function(a,b,c){var d=this;return this.diffHasSymbolChange(a)?!1:b instanceof e.UniqueValueRenderer&&c instanceof e.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(a,b,c)&&0===Object.keys(a.diff).length?!0:t.everyMap(this.graphicsBySymbol,function(c,e){c=d.symbols.get(e);return!(c&&!c.applyRendererDiff(a,b))})};f.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(a,b){return a.globalPropertyChanged("opacity",
b)});this.updateStageLayerVisibility()};f.prototype.updateUpdatePolicy=function(){var a=u.isSome(this.currentRenderer)&&"dictionary"===this.currentRenderer.type;this._asyncUpdates=1===this.preferredUpdatePolicy||a;(this.symbolCreationContext.isAsync=this._asyncUpdates)||this.update(va.noBudget)};f.prototype.slicePlaneEnabledChange=function(a){a!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=a,this.stageLayer.isSliceable=a,this.forEachGraphics3DSymbol(function(a,
b){return a.globalPropertyChanged("slicePlaneEnabled",b)}),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())};f.prototype.physicalBasedRenderingChange=function(a){a!==this.symbolCreationContext.physicalBasedRenderingEnabled&&(this.symbolCreationContext.physicalBasedRenderingEnabled=a,this.forEachGraphics3DSymbol(function(a,b){return a.globalPropertyChanged("physicalBasedRenderingEnabled",b)}))};f.prototype.pixelRatioChange=function(a){var b=
this;this.forEachGraphics3DSymbol(function(a,c,d){a.globalPropertyChanged("pixelRatio",c)||b._recreateSymbol(d)})};f.prototype._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){var a=this;this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=z.schedule(function(){a._updatingPendingLoadedGraphicsChange=null})};f.prototype.setClippingExtent=function(a,b){var d=this.symbolCreationContext.clippingExtent,e=I.create();
ea.extentToBoundingRect(a,e,b)?this.symbolCreationContext.clippingExtent=[e[0],e[1],-Infinity,e[2],e[3],Infinity]:this.symbolCreationContext.clippingExtent=null;return!c.equals(this.symbolCreationContext.clippingExtent,d)};f.prototype.notifyVisibilityChanged=function(){this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};f.prototype.modifyGraphics3DGraphicVisibilities=function(a){var b=!1;this.graphics3DGraphics.forEach(function(c){a(c)&&(b=!0)});b&&this.notifyVisibilityChanged()};
f.prototype.forEachGraphics3DSymbol=function(a){var b=this;this.graphicsBySymbol.forEach(function(c,d){var e=b.symbols.get(d);e&&a(e,c,d)})};f.prototype.updateAllGraphicsVisibility=function(){var a=this;this.filterVisibility&&(this.filterVisibility.dirty=!0);this.modifyGraphics3DGraphicVisibilities(function(b){var c=a._updateUserVisibility(b);b=a.scaleVisibility&&a.scaleVisibility.updateVisibility(b);return c||b})};f.prototype.hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(function(a){return a.setVisibilityFlag(0,
!1,0)})};f.prototype.validateRenderer=function(a){(a=L.validateTo3D(a))&&na.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};f.prototype.volatileGraphicsUpdated=function(){this.labeler&&this.labeler.reset();this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};f.prototype._cleanupSymbols=function(){var a=this;if(!(0<this.graphicsWaitingForSymbol.size||
this.suspendSymbolCleanup)){var b=!1;this.symbols.forEach(function(c,d){if(c&&!(0<c.referenced)){var e=a.graphicsBySymbol.get(d);e&&0!==e.size||(a.graphicsBySymbol.delete(d),a.symbols.delete(d),c&&c.destroy(),b=!0)}});b&&this.notifyChange("maxSymbolComplexity")}};f.prototype.snapshotInternals=function(){var a=this;return{graphics:c.keysOfMap(this.graphics3DGraphics).sort(),symbols:c.keysOfMap(this.symbols).sort(),graphicsBySymbol:c.keysOfMap(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,
graphics:c.keysOfMap(a.graphicsBySymbol.get(b)).sort()}}),graphicsWithoutSymbol:c.keysOfMap(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:c.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}};Object.defineProperty(f.prototype,"test",{get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size}},enumerable:!0,configurable:!0});f.prototype.getStats=function(){return{"core.visible":this.graphics3DGraphics.size,
"core.missing":this.graphicsWithoutSymbol.size,"core.pending":this.pendingUpdates.size}};var n;f.tmpVec=D.vec3f64.create();k([C.property({readOnly:!0})],f.prototype,"computedExtent",void 0);k([C.property()],f.prototype,"currentRenderer",void 0);k([C.property()],f.prototype,"rendererHasGeometryOperations",void 0);k([C.property({readOnly:!0})],f.prototype,"elevationAlignment",void 0);k([C.property({readOnly:!0})],f.prototype,"scaleVisibility",void 0);k([C.property({readOnly:!0})],f.prototype,"filterVisibility",
void 0);k([C.property()],f.prototype,"_updatingPendingLoadedGraphicsChange",void 0);k([C.property({readOnly:!0})],f.prototype,"featureStore",void 0);k([C.property({readOnly:!0})],f.prototype,"deconflictor",void 0);k([C.property({readOnly:!0})],f.prototype,"labeler",void 0);k([C.property({readOnly:!0})],f.prototype,"highlights",void 0);k([C.property()],f.prototype,"preferredUpdatePolicy",void 0);k([C.property({constructOnly:!0})],f.prototype,"elevationFeatureExpressionEnabled",void 0);k([C.property({constructOnly:!0})],
f.prototype,"owner",void 0);k([C.property({constructOnly:!0})],f.prototype,"layer",void 0);k([C.property({readOnly:!0})],f.prototype,"hasDraped",void 0);k([C.property({readOnly:!0})],f.prototype,"symbolsUpdating",void 0);k([C.property({constructOnly:!0})],f.prototype,"graphicSymbolSupported",void 0);k([C.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating","filterVisibility.updating","_updatingPendingLoadedGraphicsChange"]})],f.prototype,"updating",null);k([C.property({readOnly:!0})],
f.prototype,"updatingRemaining",null);k([C.property({readOnly:!0})],f.prototype,"updatingTotal",null);k([C.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],f.prototype,"displayFeatureLimit",null);k([C.property({readOnly:!0})],f.prototype,"maxSymbolComplexity",null);k([C.property({constructOnly:!0})],f.prototype,"hasZ",void 0);k([C.property({constructOnly:!0})],
f.prototype,"hasM",void 0);return f=n=k([C.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],f)}(C.declared(f));var wa=new Map,Ca=new m,ua=new y(m);(function(){return function(){this.renderingInfo=this.add=null;this.state=0;this.remove=null}})();var ya=10;return n})},"esri/renderers/support/rendererConversion":function(){define(["require","exports","../../core/Error","../../symbols/support/symbolConversion"],function(n,b,l,k){function h(a,b){if(!b)return null;b=Array.isArray(b)?b:[b];if(0<
b.length){var d=b.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});d.sort();var c=[];d.forEach(function(a,b){0!==b&&a===d[b-1]||c.push(a)});return new l("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+c.join(", ")+") which are not supported in 3D",{renderer:a,symbolErrors:b})}return null}function a(a){var b=a.uniqueValueInfos.map(function(a){return k.to3D(a.symbol).error}).filter(function(a){return!!a}),e=k.to3D(a.defaultSymbol);
e.error&&b.unshift(e.error);return h(a,b)}function g(a){var b=a.classBreakInfos.map(function(a){return k.to3D(a.symbol).error}).filter(function(a){return!!a}),e=k.to3D(a.defaultSymbol);e.error&&b.unshift(e.error);return h(a,b)}Object.defineProperty(b,"__esModule",{value:!0});b.validateTo3D=function(b){return b?"simple"===b.type?h(b,k.to3D(b.symbol).error):"dictionary"===b.type?null:"unique-value"===b.type?a(b):"class-breaks"===b.type?g(b):new l("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+
(b.type||b.declaredClass)+"'",{renderer:b}):null}})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter ../../support/projectionUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function h(e){var h=b.call(this)||this;h.events=new a;h.hasZ=null;h.hasM=null;h.objectIdField=null;h.spatialReference=null;h.featureAdapter={getAttribute:function(a,b){return"graphic"in a?a.graphic.attributes[b]:q.default.getAttribute(a,b)},getAttributes:function(a){return"graphic"in a?a.graphic.attributes:q.default.getAttributes(a)},getObjectId:function(a){return"graphic"in a?d.getObjectId(a.graphic,
h.objectIdField):q.default.getObjectId(a)},getGeometry:function(a){return"graphic"in a?a.getAsOptimizedGeometry(h.hasZ,h.hasM):q.default.getGeometry(a)},getCentroid:function(a,b){if("graphic"in a){var d=null;g.isSome(a.centroid)?d=a.centroid:"point"===a.graphic.geometry.type&&p.pointToPoint(a.graphic.geometry,r,h.spatialReference)&&(d=r);a=Array(2+(b.hasZ?1:0)+(b.hasM?1:0));g.isNone(d)?(a[0]=0,a[1]=0,a[2]=0,a[3]=0):(a[0]=d.x,a[1]=d.y,b.hasZ&&(a[2]=d.hasZ?d.z:0),b.hasM&&(a[b.hasZ?3:2]=d.hasM?d.m:0));
return new c.default([],a)}return q.default.getCentroid(a,b)},cloneWithGeometry:function(a,b){return"graphic"in a?new f.default(b,h.featureAdapter.getAttributes(a),null,h.featureAdapter.getObjectId(a)):q.default.cloneWithGeometry(a,b)}};return h}l(h,b);h.prototype.forEach=function(a){this.forAllGraphics(function(b){a(b)})};h.prototype.forEachInBounds=function(a,b){this.getSpatialIndex().forEachInBounds(a,b)};h.prototype.forEachBounds=function(a,b,c){for(var d=this.getSpatialIndex(),e=0;e<a.length;e++){var f=
this.featureAdapter.getObjectId(a[e]);g.isSome(d.getBounds(f,c))&&b(c)}};k([e.property({constructOnly:!0})],h.prototype,"getSpatialIndex",void 0);k([e.property({constructOnly:!0})],h.prototype,"forAllGraphics",void 0);k([e.property({constructOnly:!0})],h.prototype,"hasZ",void 0);k([e.property({constructOnly:!0})],h.prototype,"hasM",void 0);k([e.property({constructOnly:!0})],h.prototype,"objectIdField",void 0);k([e.property({constructOnly:!0})],h.prototype,"spatialReference",void 0);return h=k([e.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],
h)}(e.declared(h));b.Graphics3DFeatureStore=n;var r={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};b.default=n})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["require","exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});b.optimizedFeatureQueryEngineAdapter={getObjectId:function(a){return a.objectId},getAttributes:function(a){return a.attributes},getAttribute:function(a,
b){return a.attributes[b]},cloneWithGeometry:function(a,b){return new k.default(b,a.attributes,null,a.objectId)},getGeometry:function(a){return a.geometry},getCentroid:function(a,b){a.centroid||(a.centroid=l.getCentroidOptimizedGeometry(new h.default,a.geometry,b.hasZ,b.hasM));return a.centroid}};b.default=b.optimizedFeatureQueryEngineAdapter})},"esri/layers/graphics/centroid":function(){define(["require","exports"],function(n,b){function l(b,a,g,e,d,f){f=d?f?4:3:f?3:2;var c=g,h=g+f,k=0,l=0,n=g=0,
x=0,w=0;for(--e;w<e;w++,c+=f,h+=f){var u=a[c],y=a[c+1],m=a[c+2],v=a[h],z=a[h+1],B=a[h+2],C=u*z-v*y,n=n+C,k=k+(u+v)*C,l=l+(y+z)*C;d&&(C=u*B-v*m,g+=(m+B)*C,x+=C);u<b[0]&&(b[0]=u);u>b[1]&&(b[1]=u);y<b[2]&&(b[2]=y);y>b[3]&&(b[3]=y);d&&(m<b[4]&&(b[4]=m),m>b[5]&&(b[5]=m))}0<n&&(n*=-1);0<x&&(x*=-1);if(!n)return null;b=[k,l,.5*n];d&&(b[3]=g,b[4]=.5*x);return b}function k(b,a,g,e,d){d=e?d?4:3:d?3:2;for(var f=a,c=a+d,h=0,k=0,l=0,n=0,x=0,w=g-1;x<w;x++,f+=d,c+=d){var u=b[f],y=b[f+1],m=b[f+2],v=b[c],z=b[c+1],
B=b[c+2],C;if(e){C=v-u;var D=z-y,K=B-m;C=Math.sqrt(C*C+D*D+K*K)}else C=v-u,D=z-y,C=Math.sqrt(C*C+D*D);C&&(h+=C,e?(u=[u+.5*(v-u),y+.5*(z-y),m+.5*(B-m)],k+=C*u[0],l+=C*u[1],n+=C*u[2]):(u=[u+.5*(v-u),y+.5*(z-y)],k+=C*u[0],l+=C*u[1]))}return 0<h?e?[k/h,l/h,n/h]:[k/h,l/h]:0<g?e?[b[a],b[a+1],b[a+2]]:[b[a],b[a+1]]:null}Object.defineProperty(b,"__esModule",{value:!0});b.getCentroidOptimizedGeometry=function(b,a,g,e){if(!a||!a.lengths.length)return null;b.lengths.length&&(b.lengths.length=0);b.coords.length&&
(b.coords.length=0);for(var d=b.coords,f=[],c=g?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],h=a.lengths,n=a.coords,r=g?e?4:3:e?3:2,t=0,x=0;x<h.length;x++){var w=h[x],u=l(c,n,t,w,g,e);u&&f.push(u);t+=w*r}f.sort(function(a,b){var c=a[2]-b[2];0===c&&g&&(c=a[4]-b[4]);return c});f.length&&(r=6*f[0][2],
d[0]=f[0][0]/r,d[1]=f[0][1]/r,g&&(r=6*f[0][4],d[2]=0!==r?f[0][3]/r:0),d[0]<c[0]||d[0]>c[1]||d[1]<c[2]||d[1]>c[3]||g&&(d[2]<c[4]||d[2]>c[5]))&&(d.length=0);if(!d.length)if(a=a.lengths[0]?k(n,0,h[0],g,e):null)d[0]=a[0],d[1]=a[1],g&&2<a.length&&(d[2]=a[2]);else return null;return b};b.lineCentroid=k})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(){this.featureExpressionInfoContext=
this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.renderSpatialReference=this.clippingExtent=this.layerOrderDelta=this.layerOrder=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1}}();b.Graphics3DSymbolCreationContext=n})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require",
"exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});b.make=function(b,a,g){var e;switch(b.type){case "point-3d":e=l;break;default:e=k}return new e(b,a,g)}})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DSymbol".split(" "),
function(n,b,l,k,h,a,g,e){return function(b){function d(a,d,e){a=b.call(this,a,d,e)||this;a.calloutSymbolLayer=null;a.symbol.hasVisibleCallout()&&(a.calloutSymbolLayer=g.make(a.symbol,d));return a}l(d,b);d.prototype.doLoad=function(c){return h(this,void 0,void 0,function(){return k(this,function(d){switch(d.label){case 0:return[4,b.prototype.doLoad.call(this,c)];case 1:return d.sent(),this.calloutSymbolLayer?[4,this.calloutSymbolLayer.load()]:[3,3];case 2:d.sent(),d.label=3;case 3:if(a.isAborted(c))throw a.createAbortError();
return[2]}})})};d.prototype.destroy=function(){b.prototype.destroy.call(this);this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()};d.prototype.createGraphics3DGraphic=function(a,d,e){d=b.prototype.createGraphics3DGraphic.call(this,a,e);this.calloutSymbolLayer&&(a=this.createCalloutGraphic(a))&&d.addAuxiliaryGraphic(a);return d};d.prototype.globalPropertyChanged=function(a,d){var c=this;return b.prototype.globalPropertyChanged.call(this,a,d)?this.calloutSymbolLayer?this.calloutSymbolLayer.globalPropertyChanged(a,
d,function(a){var b=0;for(a=a._auxiliaryGraphics;b<a.length;b++){var d=a[b];if(d.graphics3DSymbolLayer===c.calloutSymbolLayer)return d}}):!0:!1};d.prototype.createCalloutGraphic=function(a){var b=a.renderingInfo;a.renderingInfo={renderer:b.renderer,symbol:b.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(a)};return d}(e)})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/has ../../../../core/accessorSupport/decorators ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(n,b,l,k,h,a,g,e,d,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function h(c){c=b.call(this)||this;c.index=new e.default(9,a("csp-restrictions")?function(a){return{minX:a.extent[0],minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);c.boundsByFeature=new Map;c.spatialReference=null;c.hasZ=null;c.hasM=null;c.objectIdField=null;return c}l(h,b);h.prototype.destroy=function(){this.index.destroy();this.index=null;this.boundsByFeature.clear();
this.boundsByFeature=null};h.prototype.queryGraphicUIDsInExtent=function(a,b,d){b.equals(this.spatialReference)&&(c.minX=a[0],c.minY=a[1],c.maxX=a[2],c.maxY=a[3],this.index.search(c,function(a){return d(a.graphic.uid)}))};h.prototype.add=function(a){a.computeExtent(this.spatialReference);this.index.insert(a);var b=f.getObjectId(a.graphic,this._get("objectIdField"));null!=b&&this.boundsByFeature.set(b,a.extent)};h.prototype.addMany=function(a,b){void 0===b&&(b=a.length);for(var c=this._get("objectIdField"),
d=0;d<b;d++){var e=a[d];e.computeExtent(this.spatialReference);var g=f.getObjectId(e.graphic,c);null!=g&&this.boundsByFeature.set(g,e.extent)}this.index.load(a,b)};h.prototype.remove=function(a){this.index.remove(a);a=f.getObjectId(a.graphic,this._get("objectIdField"));null!=a&&this.boundsByFeature.delete(a)};h.prototype.clear=function(){this.index.clear();this.boundsByFeature.clear()};h.prototype.forEachInBounds=function(a,b){c.minX=a[0];c.minY=a[1];c.maxX=a[2];c.maxY=a[3];this.index.search(c,function(a){b(a)})};
h.prototype.getBounds=function(a,b){return(a=this.boundsByFeature.get(a))?d.fromRect(b,a):null};k([g.property({constructOnly:!0})],h.prototype,"spatialReference",void 0);k([g.property({constructOnly:!0})],h.prototype,"hasZ",void 0);k([g.property({constructOnly:!0})],h.prototype,"hasM",void 0);k([g.property({constructOnly:!0})],h.prototype,"objectIdField",void 0);return h=k([g.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],h)}(g.declared(h));b.SpatialIndex2D=n;var c={minX:0,minY:0,maxX:0,
maxY:0};b.default=n})},"esri/core/libs/rbush/PooledRBush":function(){define(["require","exports","../../PooledArray","../quickselect/quickselect"],function(n,b,l,k){function h(b,c){a(b,0,b.children.length,c,b)}function a(a,b,c,d,e){e||(e=r(null,!0));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;e.maxY=-Infinity;for(var f=void 0;b<c;b++)f=a.children[b],g(e,a.leaf?d(f):f);return e}function g(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=
Math.max(a.maxY,b.maxY);return a}function e(a,b){return a.minX-b.minX}function d(a,b){return a.minY-b.minY}function f(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function c(a){return a.maxX-a.minX+(a.maxY-a.minY)}function q(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function p(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function r(a,b){return{children:a,height:1,leaf:b,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function t(a,
b,c,d,e){for(var f=[b,c];f.length;)if(c=f.pop(),b=f.pop(),!(c-b<=d)){var g=b+Math.ceil((c-b)/d/2)*d;k(a,g,b,c,e);f.push(b,g,g,c)}}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){void 0===a&&(a=9);this.compareMinX=e;this.compareMinY=d;this.toBBox=function(a){return a};this._maxEntries=Math.max(4,a||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));b&&("function"===typeof b?this.toBBox=b:this._initFormat(b));this.clear()}b.prototype.destroy=function(){this.clear();
x.prune();w.prune();u.prune();y.prune()};b.prototype.all=function(a){this._all(this.data,a)};b.prototype.search=function(a,b){var c=this.data,d=this.toBBox;if(p(a,c))for(x.clear();c;){for(var e=0,f=c.children.length;e<f;e++){var g=c.children[e],h=c.leaf?d(g):g;p(a,h)&&(c.leaf?b(g):q(a,h)?this._all(g,b):x.push(g))}c=x.pop()}};b.prototype.collides=function(a){var b=this.data,c=this.toBBox;if(!p(a,b))return!1;for(x.clear();b;){for(var d=0,e=b.children.length;d<e;d++){var f=b.children[d],g=b.leaf?c(f):
f;if(p(a,g)){if(b.leaf||q(a,g))return!0;x.push(f)}}b=x.pop()}return!1};b.prototype.load=function(a,b){void 0===b&&(b=a.length);if(!b)return this;if(b<this._minEntries){for(var c=0;c<b;c++)this.insert(a[c]);return this}a=this._build(a.slice(0,b),0,b-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this};b.prototype.insert=function(a){a&&
this._insert(a,this.data.height-1);return this};b.prototype.clear=function(){this.data=r([],!0);return this};b.prototype.remove=function(a,b){if(!a)return this;var c=this.data,d,e,f,g,h=this.toBBox(a);u.clear();for(y.clear();c||u.length;){c||(c=u.pop(),d=u.data[u.length-1],e=y.pop(),f=!0);if(c.leaf){a:{g=a;var k=c.children,l=b;if(l){for(var m=0;m<k.length;m++)if(l(g,k[m])){g=m;break a}g=-1}else g=k.indexOf(g)}if(-1!==g){c.children.splice(g,1);u.push(c);this._condense(u);break}}f||c.leaf||!q(c,h)?
d?(e++,c=d.children[e],f=!1):c=null:(u.push(c),y.push(e),e=0,d=c,c=c.children[0])}return this};b.prototype.toJSON=function(){return this.data};b.prototype.fromJSON=function(a){this.data=a;return this};b.prototype._all=function(a,b){for(w.clear();a;){if(!0===a.leaf){var c=0;for(a=a.children;c<a.length;c++)b(a[c])}else w.pushArray(a.children);a=w.pop()}};b.prototype._build=function(a,b,c,d){var e=c-b+1,f=this._maxEntries,g;if(e<=f)return g=r(a.slice(b,c+1),!0),h(g,this.toBBox),g;d||(d=Math.ceil(Math.log(e)/
Math.log(f)),f=Math.ceil(e/Math.pow(f,d-1)));g=r([],!1);g.height=d;e=Math.ceil(e/f);f=e*Math.ceil(Math.sqrt(f));for(t(a,b,c,f,this.compareMinX);b<=c;b+=f){var k=Math.min(b+f-1,c);t(a,b,k,e,this.compareMinY);for(var l=b;l<=k;l+=e)g.children.push(this._build(a,l,Math.min(l+e-1,k),d-1))}h(g,this.toBBox);return g};b.prototype._chooseSubtree=function(a,b,c,d){for(;;){d.push(b);if(!0===b.leaf||d.length-1===c)break;for(var e=Infinity,g=Infinity,h=void 0,k=0,l=b.children.length;k<l;k++){var m=b.children[k],
n=f(m),p=(Math.max(m.maxX,a.maxX)-Math.min(m.minX,a.minX))*(Math.max(m.maxY,a.maxY)-Math.min(m.minY,a.minY))-n;p<g?(g=p,e=n<e?n:e,h=m):p===g&&n<e&&(e=n,h=m)}b=h||b.children[0]}return b};b.prototype._insert=function(a,b,c){var d=this.toBBox;c=c?a:d(a);u.clear();d=this._chooseSubtree(c,this.data,b,u);d.children.push(a);for(g(d,c);0<=b;)if(u.data[b].children.length>this._maxEntries)this._split(u,b),b--;else break;this._adjustParentBBoxes(c,u,b)};b.prototype._split=function(a,b){var c=a.data[b],d=c.children.length,
e=this._minEntries;this._chooseSplitAxis(c,e,d);d=this._chooseSplitIndex(c,e,d);d=r(c.children.splice(d,c.children.length-d),c.leaf);d.height=c.height;h(c,this.toBBox);h(d,this.toBBox);b?a.data[b-1].children.push(d):this._splitRoot(c,d)};b.prototype._splitRoot=function(a,b){this.data=r([a,b],!1);this.data.height=a.height+1;h(this.data,this.toBBox)};b.prototype._chooseSplitIndex=function(b,c,d){var e,g,h;e=g=Infinity;for(var k=c;k<=d-c;k++){var l=a(b,0,k,this.toBBox),m=a(b,k,d,this.toBBox),n;n=Math.max(0,
Math.min(l.maxX,m.maxX)-Math.max(l.minX,m.minX))*Math.max(0,Math.min(l.maxY,m.maxY)-Math.max(l.minY,m.minY));l=f(l)+f(m);n<e?(e=n,h=k,g=l<g?l:g):n===e&&l<g&&(g=l,h=k)}return h};b.prototype._chooseSplitAxis=function(a,b,c){var f=a.leaf?this.compareMinX:e,g=a.leaf?this.compareMinY:d,h=this._allDistMargin(a,b,c,f);b=this._allDistMargin(a,b,c,g);h<b&&a.children.sort(f)};b.prototype._allDistMargin=function(b,d,e,f){b.children.sort(f);f=this.toBBox;for(var h=a(b,0,d,f),k=a(b,e-d,e,f),l=c(h)+c(k),m=d;m<
e-d;m++){var n=b.children[m];g(h,b.leaf?f(n):n);l+=c(h)}for(m=e-d-1;m>=d;m--)n=b.children[m],g(k,b.leaf?f(n):n),l+=c(k);return l};b.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)g(b.data[c],a)};b.prototype._condense=function(a){for(var b=a.length-1,c=void 0;0<=b;b--)0===a.data[b].children.length?0<b?(c=a.data[b-1].children,c.splice(c.indexOf(a.data[b]),1)):this.clear():h(a.data[b],this.toBBox)};b.prototype._initFormat=function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a",
"b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")};return b}();b.PooledRBush=n;var x=new l,w=new l,u=new l,y=new l({deallocator:null});b.default=n})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function n(k,h,a,g,e){for(;g>a;){if(600<g-a){var d=g-a+1,f=h-a+1,c=Math.log(d),l=.5*Math.exp(2*c/3),c=.5*Math.sqrt(c*l*(d-l)/d)*(0>f-d/2?-1:1);n(k,h,
Math.max(a,Math.floor(h-f*l/d+c)),Math.min(g,Math.floor(h+(d-f)*l/d+c)),e)}d=k[h];f=a;l=g;b(k,a,h);for(0<e(k[g],d)&&b(k,a,g);f<l;){b(k,f,l);f++;for(l--;0>e(k[f],d);)f++;for(;0<e(k[l],d);)l--}0===e(k[a],d)?b(k,a,l):(l++,b(k,l,g));l<=h&&(a=l+1);h<=l&&(g=l-1)}}function b(b,h,a){var g=b[h];b[h]=b[a];b[a]=g}function l(b,h){return b<h?-1:b>h?1:0}return function(b,h,a,g,e){n(b,h,a||0,g||b.length-1,e||l)}})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/unitUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){Object.defineProperty(b,"__esModule",{value:!0});var w=g.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider");n=function(a){function b(b){b=a.call(this,b)||this;b.elevationOffset=0;b.layerDirtyNotificationHandle=null;return b}l(b,a);b.prototype.initialize=function(){var a=this;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=new x(this.view.viewingMode);var b=this.computeLayerExtent(this.stageLayer);
this.zmin=b[2];this.zmax=b[5];this.layerDirtyNotificationHandle=this.stageLayer.on("dirty",function(b){a.stageLayerChanged(b.contentType,b.origin,b.dirtyType,b.subObject)})};b.prototype.dispose=function(){this.layerDirtyNotificationHandle.remove()};b.prototype.elevationInfoChanged=function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"on-the-ground"!==a.mode){var b=e.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=t.getMetersPerUnit(a.unit);this.elevationOffset=
(a.offset||0)*c/b}else this.elevationOffset=0};b.prototype.getElevation=function(a){if(r.isPoint(a)){if(!this.renderCoordsHelper.toRenderCoords(a,v))return w.error("could not project point for elevation alignment"),null}else if(!this.renderCoordsHelper.toRenderCoords(a,this.spatialReference,v))return w.error("could not project point for elevation alignment"),null;var b=this.elevationOffset;a=this.zmin+b;b=this.zmax+b;f.vec3.copy(z,v);f.vec3.copy(B,v);this.renderCoordsHelper.setAltitude(b,z);this.renderCoordsHelper.setAltitude(a,
B);this.intersector.intersect(this.intersectLayers,z,B,null,null,1,!1,null,!0,function(a){return a.metadata&&a.metadata.isElevationSource});return this.intersector.results.min.getIntersectionPoint(v)?this.renderCoordsHelper.getAltitude(v):null};b.prototype.stageLayerChanged=function(a,b,c,d){switch(c){case "layerObjectAdded":case "layerObjectRemoved":case "objGeometryAdded":a=d;a.metadata&&a.metadata.isElevationSource&&this.objectChanged(a);break;case "objGeometryRemoved":case "objGeometryReplaced":case "objGeometryTransformation":case "vertexAttrsUpdated":case "objTransformation":a=
b,a.metadata&&a.metadata.isElevationSource&&this.objectChanged(a)}};b.prototype.objectChanged=function(a){if(this.spatialReference){q.empty(u);a.metadata.lastValidElevationBB.isEmpty()||this.expandExtent(a.metadata.lastValidElevationBB.bbMin,a.metadata.lastValidElevationBB.bbMax,u);var b=a.getBBMin(!1),c=a.getBBMax(!1);this.expandExtent(b,c,u);q.toRect(u,y);this.zmin=Math.min(this.zmin,u[2]);this.zmax=Math.max(this.zmax,u[5]);m.extent=y;m.spatialReference=this.spatialReference;this.emit("elevation-change",
m);f.vec3.copy(a.metadata.lastValidElevationBB.bbMin,b);f.vec3.copy(a.metadata.lastValidElevationBB.bbMax,c)}};b.prototype.computeLayerExtent=function(a){q.empty(u);var b=0;for(a=a.getObjects();b<a.length;b++){var c=a[b];this.expandExtent(c.getBBMin(!1),c.getBBMax(!1),u)}return u};b.prototype.expandExtent=function(a,b,c){for(var d=0;8>d;++d)v[0]=d&1?a[0]:b[0],v[1]=d&2?a[1]:b[1],v[2]=d&4?a[2]:b[2],this.renderCoordsHelper.fromRenderCoords(v,v,this.spatialReference),q.expand(c,v);return c};k([d.property({constructOnly:!0})],
b.prototype,"layer",void 0);k([d.property({constructOnly:!0})],b.prototype,"stageLayer",void 0);k([d.property({constructOnly:!0})],b.prototype,"view",void 0);k([d.property({readOnly:!0,aliasOf:"view.spatialReference"})],b.prototype,"spatialReference",void 0);return b=k([d.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],b)}(d.declared(a.EventedMixin(h)));b.StageLayerElevationProvider=n;var u=q.empty(),y=p.empty(),m={spatialReference:null,extent:y,context:"scene"},v=c.vec3f64.create(),
z=c.vec3f64.create(),B=c.vec3f64.create()})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../../support/index".split(" "),function(n,
b,l,k,h,a,g,e,d,f,c,q){var p=function(){function a(){this.extents=new d({allocator:function(a){return a||c.create()}});this.tempExtent=c.create();this.dirty=!1}Object.defineProperty(a.prototype,"length",{get:function(){return this.extents.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.extents.clear()};a.prototype.add=function(a){this.contains(a)||(this.removeContained(a),c.set(this.extents.pushNew(),a),this.dirty=!0)};a.prototype.pop=function(){this.dirty&&(this.mergeTight(),
this.dirty=!1);return this.extents.pop()};a.prototype.mergeTight=function(){for(var a=this.extents,b=this.tempExtent,d=!1;!d;)for(var d=!0,e=0;e<a.length;++e){for(var f=e,g=a.data[f],h=c.area(g),k=!1,l=a.length-1;l>f;--l){var n=a.data[l],p=c.area(n);c.expand(g,n,b);n=h+p;.05>(c.area(b)-n)/n&&(c.set(g,b),h=c.area(g),a.swapElements(l,a.length-1),a.pop(),k=!0)}if(k){d=!1;break}}};a.prototype.containsPoint=function(a){return this.extents.some(function(b){return c.containsPoint(b,a)})};a.prototype.contains=
function(a){return this.extents.some(function(b){return c.contains(b,a)})};a.prototype.removeContained=function(a){for(var b=this.extents.length-1;0<=b;--b)c.contains(a,this.extents.data[b])&&this.extents.removeUnorderedIndex(b)};return a}();return function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c.dirtyExtents=new p;c.globalDirty=!1;c.dirtyGraphicsSet=new Set;c.handles=new g;c.updateElevation=!1;c.layerView=null;c.graphicsCore=null;c.events=new a;return c}l(c,b);Object.defineProperty(c.prototype,
"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0});c.prototype.setup=function(a,b,c,d){var e=this;this.layerView=a;this.queryGraphicUIDsInExtent=b;this.graphicsCore=c;this.elevationProvider=d;a=this.layerView.view.resourceController.scheduler;this.handles.add([d.on("elevation-change",function(a){("scene"!==a.context||c.layer.elevationInfo&&"relative-to-scene"===c.layer.elevationInfo.mode)&&e.elevationUpdateHandler(a)}),this.layerView.watch("suspended",function(){return e.suspendedChange()}),
a.registerTask(q.Task.ELEVATION_ALIGNMENT,function(a){return e.update(a)},function(){return e.needsUpdate()})])};c.prototype.destroy=function(){this.dirtyGraphicsSet=null;this.handles.destroy();this.queryGraphicUIDsInExtent=this.graphicsCore=this.layerView=this.handles=null};c.prototype.clear=function(){this.dirtyGraphicsSet.clear();this.notifyChange("updating")};c.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&
(this.globalDirty=!0,this.notifyChange("updating"))};c.prototype.elevationInfoChange=function(){this.globalDirty=!0;this.notifyChange("updating")};c.prototype.needsUpdate=function(){return this.dirtyGraphicsSet&&0<this.dirtyGraphicsSet.size||this.dirtyExtents&&0<this.dirtyExtents.length||this.globalDirty};c.prototype.update=function(a){this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,a.madeProgress());for(;this.needsUpdate()&&!a.done;)this._updateDirtyGraphics(a),this._updateDirtyExtents(a);
this.layerView.view.deconflictor.setDirty();this.notifyChange("updating")};c.prototype._updateDirtyGraphics=function(a){for(var b=this,c=this.layerView.view,d=this.graphicsCore.stageLayer.id,f=this.layerView.labeling,g=function(){var g=Math.min(h.dirtyGraphicsSet.size,100);e.everySet(h.dirtyGraphicsSet,function(d){var e=b.graphicsCore.getGraphics3DGraphicById(d);b.dirtyGraphicsSet.delete(d);e&&e.alignWithElevation(b.elevationProvider,c.renderCoordsHelper,b.graphicsCore.asyncUpdates);a.madeProgress();
return 0<--g&&!a.done});c._stage.processDirtyLayer(d);f&&f.processStageDirty()},h=this;0<this.dirtyGraphicsSet.size&&!a.done;)g()};c.prototype._updateDirtyExtents=function(a){for(var b=this;0<this.dirtyExtents.length&&100>this.dirtyGraphicsSet.size&&!a.done;){var c=this.dirtyExtents.pop();this.events.hasEventListener("invalidate-elevation")&&this.events.emit("invalidate-elevation",{extent:c,spatialReference:this.spatialReference});this.queryGraphicUIDsInExtent(c,this.spatialReference,function(a){var c=
b.graphicsCore.getGraphics3DGraphicById(a);c&&c.needsElevationUpdates()&&b.dirtyGraphicsSet.add(a)});a.madeProgress()}};c.prototype.markAllGraphicsElevationDirty=function(){var a=this;this.dirtyExtents.clear();this.dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach(function(b,c){a.dirtyGraphicsSet.add(c)})};c.prototype.elevationUpdateHandler=function(a){var b=a.extent;this.layerView.suspended?this.updateElevation||(a=this.graphicsCore.computedExtent)&&b[2]>a.xmin&&b[0]<a.xmax&&
b[3]>a.ymin&&b[1]<a.ymax&&(this.updateElevation=!0):(-Infinity===b[0]?this.globalDirty=!0:this.dirtyExtents.add(b),this.spatialReference=a.spatialReference,this.notifyChange("updating"))};k([f.property({readOnly:!0})],c.prototype,"updating",null);return c=k([f.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],c)}(f.declared(h))})},"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ./QueryEngine ../../../layers/support/FeatureFilter ../../../support/index".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});var r=g.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");n=function(b){function g(){var c=b.call(this)||this;c.filter=null;c._dirty=!1;c._querying=!1;c._handles=new a;return c}l(g,b);Object.defineProperty(g.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0});g.prototype.setup=function(a,b){var e=this;this._layerView=
a;this._core=b;this._objectIdField=a.layer.objectIdField;this._queryEngine=new c.default({layerView:this._layerView,task:p.Task.FILTER_VISIBILITY});this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(p.Task.FILTER_VISIBILITY,function(a){return e._update(a)},function(){return e._needsUpdate()}));this._handles.add(d.on(b.owner,"loadedGraphics","after-changes",function(a){return e._graphicsChanged(a)},function(){return e.dirty=!0}))};g.prototype.destroy=function(){this._handles.destroy();
this._handles=null;this.clear();this._core=this._layerView=null};g.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(function(a){return a.clearVisibilityFlag(2)}),this._queryResult=null,this._querying=!1);this.dirty=!1;this.notifyChange("updating")};g.prototype._graphicsChanged=function(a){this._queryEngine&&0===(a.type&1)||(this.dirty=!0)};g.prototype.updateVisibility=function(a){this.active&&(a.hasVisibilityFlag(2,0)||a.setVisibilityFlag(2,!1,
0),this.dirty=!0)};g.prototype.filterChanged=function(){this.filter=this.recomputeFilter();this.dirty=!0};Object.defineProperty(g.prototype,"active",{get:function(){return this.filter&&0<this._core.graphics3DGraphics.size},enumerable:!0,configurable:!0});g.prototype.recomputeFilter=function(){var a="filter"in this._layerView?this._layerView.filter:null,b="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!b)return a;a=e.isSome(a)?a.clone():new q;a.timeExtent=a.timeExtent?a.timeExtent.intersection(b):
b;return a};g.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult};g.prototype._update=function(a){var b=this;this.active?(!this._dirty||this._querying||a.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(function(a){b._queryResult=a;b._querying=!1}).catch(function(a){r.warn("FeatureFilter query failed: "+a);b._queryResult=new Set;b._core.graphics3DGraphics.forEach(function(a){return b._queryResult.add(b._getFeatureId(a.graphic))});
b._querying=!1}),a.madeProgress()),this._queryResult&&!a.done&&(this._core.modifyGraphics3DGraphicVisibilities(function(c){if(a.done)return!1;var d=b._queryResult.has(b._getFeatureId(c.graphic));return c.setVisibilityFlag(2,d,0)?(a.madeProgress(),!0):!1}),a.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()};g.prototype._getFeatureId=function(a){return null==a.objectId?a.attributes[this._objectIdField]:a.objectId};Object.defineProperty(g.prototype,"dirty",{set:function(a){this._dirty!==
a&&(this._dirty=a,this.notifyChange("updating"))},enumerable:!0,configurable:!0});k([f.property({readOnly:!0})],g.prototype,"updating",null);return g=k([f.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],g)}(f.declared(h));b.Graphics3DFilterVisibility=n})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){Object.defineProperty(b,"__esModule",{value:!0});var t=q.default;n=function(b){function e(a){a=b.call(this)||this;a._dataQueryEngineInstance=null;return a}k(e,b);Object.defineProperty(e.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"defaultQueryJSON",
{get:function(){return(new r({outSpatialReference:this.spatialReference})).toJSON()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0});e.prototype.destroy=function(){this.clear()};e.prototype.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};e.prototype.executeQueryForIdSet=function(b,c){return a(this,
void 0,void 0,function(){return h(this,function(a){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(b),c)]})})};e.prototype.executeQueryForCount=function(b,c){return a(this,void 0,void 0,function(){return h(this,function(a){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(b),c)]})})};e.prototype.executeQueryForExtent=function(b,d){return a(this,void 0,void 0,function(){var a,e,f,g;return h(this,function(h){switch(h.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(b),
d)];case 1:return a=h.sent(),e=a.count,f=a.extent,g=c.fromJSON(f),[2,{count:e,extent:g}]}})})};e.prototype.executeQueryForIds=function(b,c){return a(this,void 0,void 0,function(){return h(this,function(a){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(b),c)]})})};e.prototype.executeQuery=function(b,c){return a(this,void 0,void 0,function(){var a,d,e=this;return h(this,function(f){switch(f.label){case 0:return[4,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(b),c)];
case 1:return a=f.sent(),d=p.fromJSON(a),d.features.forEach(function(a){a.layer=e.layer;a.sourceLayer=e.layer}),[2,d]}})})};e.prototype._ensureQueryJSON=function(a){if(d.isNone(a))return this.defaultQueryJSON;"outSpatialReference"in a&&!a.outSpatialReference&&(a.outSpatialReference=this.spatialReference);return a.toJSON()};e.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var a="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||
null,b=this.layer.objectIdField,c=g.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),d=this.layer.fields.map(function(a){return a.toJSON()}),e=this.layerView.view.resourceController.scheduler,f=this.task,h=this.spatialReference.toJSON(),k=this.layerView;return this._dataQueryEngineInstance=new t({hasZ:k.hasZ,hasM:k.hasM,geometryType:c,fields:d,timeInfo:a,spatialReference:h,objectIdField:b,featureStore:this.layerView.graphics3d.graphicsCore.featureStore,scheduler:e,task:f})};l([f.property({constructOnly:!0})],
e.prototype,"layerView",void 0);l([f.property({constructOnly:!0})],e.prototype,"task",void 0);l([f.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],e.prototype,"spatialReference",void 0);l([f.property({readOnly:!0,aliasOf:"layerView.layer"})],e.prototype,"layer",void 0);l([f.property({readOnly:!0,dependsOn:["layer.geometryType"]})],e.prototype,"queryGeometryType",null);l([f.property({readOnly:!0,dependsOn:["spatialReference"]})],e.prototype,"defaultQueryJSON",null);return e=l([f.subclass("esri.views.3d.layers.graphics.QueryEngine")],
e)}(f.declared(e));b.QueryEngine=n;b.default=n})},"esri/layers/graphics/data/QueryEngine":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/iteratorUtils ../../../core/lang ../../../core/Logger ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../support/PromiseQueue".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K){Object.defineProperty(b,"__esModule",{value:!0});var I=d.getLogger("esri.layers.graphics.data.QueryEngine");n=function(){return function(a,b,c,d,e){void 0===b&&(b=null);this.attributes=a;this.geometry=c;this.centroid=d;this.filterFlags=e;this.groupId=-1;this.localId=b}}();b.Feature=n;var Q=new Set,J=new f.MemCacheStorage(2E6),N=0;n=function(){function b(a){var b=this;this.capabilities={query:m.queryCapabilities};this.geometryType=a.geometryType;
this.hasM=a.hasM;this.hasZ=a.hasZ;this.objectIdField=a.objectIdField;this.spatialReference=a.spatialReference;this.definitionExpression=a.definitionExpression;this.cacheSpatialQueries=a.cacheSpatialQueries||!1;this.gdbVersion=a.gdbVersion;this.historicMoment=a.historicMoment;this.featureStore=a.featureStore;this._changeHandle=this.featureStore.events.on("changed",function(){return b.clearCache()});this.timeInfo=a.timeInfo;this.cacheSpatialQueries&&(this._geometryQueryCache=new f.MemCache(N++ +"$$",
J));this.fieldsIndex=new D(a.fields);a.scheduler&&a.task&&(this._frameQueue=new K.PromiseQueue,this._frameTask=a.scheduler.registerTask(a.task,function(a){return b._update(a)},function(){return 0<b._frameQueue.length}))}b.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=
null);this.fieldsIndex.destroy()};Object.defineProperty(b.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullExtent",{get:function(){var a=this.featureStore.fullBounds;return a?{xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:C.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"timeExtent",{get:function(){return this.timeInfo?
this._timeExtent?this._timeExtent:this._timeExtent=B.getTimeExtent(this.timeInfo,this.featureStore):null},enumerable:!0,configurable:!0});b.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};b.prototype.executeQuery=function(a,b){void 0===a&&(a={});return h(this,void 0,void 0,function(){var b,c,d;return k(this,function(f){switch(f.label){case 0:b=e.clone(a),f.label=1;case 1:return f.trys.push([1,14,,15]),[4,this._schedule()];
case 2:return f.sent(),[4,C.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=f.sent(),[4,this._reschedule()];case 4:return f.sent(),[4,this._checkQuerySupport(b)];case 5:return b=f.sent(),[4,this._reschedule()];case 6:return f.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=f.sent(),[4,this._reschedule()];case 8:return f.sent(),[4,c.executeObjectIdsQuery(b)];case 9:return c=f.sent(),[4,this._reschedule()];case 10:return f.sent(),[4,c.executeTimeQuery(b)];
case 11:return c=f.sent(),[4,this._reschedule()];case 12:return f.sent(),[4,c.executeAttributesQuery(b)];case 13:return c=f.sent(),[3,15];case 14:d=f.sent();if(d!==C.QUERY_ENGINE_EMPTY_RESULT)throw d;c=new v.default([],null,this);return[3,15];case 15:return[2,c.createQueryResponse(b)]}})})};b.prototype.executeQueryForCount=function(a,b){void 0===a&&(a={});return h(this,void 0,void 0,function(){var b,c,d;return k(this,function(f){switch(f.label){case 0:b=e.clone(a),b.returnGeometry=!1,b.returnCentroid=
!1,b.outSR=null,f.label=1;case 1:return f.trys.push([1,14,,15]),[4,this._schedule()];case 2:return f.sent(),[4,C.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=f.sent(),[4,this._reschedule()];case 4:return f.sent(),[4,this._checkQuerySupport(b)];case 5:return b=f.sent(),[4,this._reschedule()];case 6:return f.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=f.sent(),[4,this._reschedule()];case 8:return f.sent(),[4,c.executeObjectIdsQuery(b)];case 9:return c=
f.sent(),[4,this._reschedule()];case 10:return f.sent(),[4,c.executeTimeQuery(b)];case 11:return c=f.sent(),[4,this._reschedule()];case 12:return f.sent(),[4,c.executeAttributesQuery(b)];case 13:return c=f.sent(),[2,c.size];case 14:d=f.sent();if(d!==C.QUERY_ENGINE_EMPTY_RESULT)throw d;return[2,0];case 15:return[2]}})})};b.prototype.executeQueryForExtent=function(a,b){void 0===a&&(a={});return h(this,void 0,void 0,function(){var b,c,d,f,g,h,l,m;return k(this,function(k){switch(k.label){case 0:b=e.clone(a),
d=b.outSR,k.label=1;case 1:return k.trys.push([1,14,,15]),[4,this._schedule()];case 2:return k.sent(),[4,C.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=k.sent(),[4,this._reschedule()];case 4:return k.sent(),[4,this._checkQuerySupport(b)];case 5:return b=k.sent(),b.returnGeometry=!0,b.returnCentroid=!1,b.outSR=null,[4,this._reschedule()];case 6:return k.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=k.sent(),[4,this._reschedule()];case 8:return k.sent(),
[4,c.executeObjectIdsQuery(b)];case 9:return c=k.sent(),[4,this._reschedule()];case 10:return k.sent(),[4,c.executeTimeQuery(b)];case 11:return c=k.sent(),[4,this._reschedule()];case 12:return k.sent(),[4,c.executeAttributesQuery(b)];case 13:c=k.sent();f=c.size;if(!f)return[2,{count:f,extent:null}];p.set(M,p.NEGATIVE_INFINITY);this.featureStore.forEachBounds(c.items,function(a){return p.expand(M,a)},L);g={xmin:M[0],ymin:M[1],xmax:M[3],ymax:M[4],spatialReference:C.cleanFromGeometryEngine(this.spatialReference)};
this.hasZ&&isFinite(M[2])&&isFinite(M[5])&&(g.zmin=M[2],g.zmax=M[5]);h=y.project(g,c.spatialReference,d);h.spatialReference=C.cleanFromGeometryEngine(d||this.spatialReference);0===h.xmax-h.xmin&&(l=q.getMetersPerUnitForSR(h.spatialReference),h.xmin-=l,h.xmax+=l);0===h.ymax-h.ymin&&(l=q.getMetersPerUnitForSR(h.spatialReference),h.ymin-=l,h.ymax+=l);this.hasZ&&null!=h.zmin&&null!=h.zmax&&0===h.zmax-h.zmin&&(l=q.getMetersPerUnitForSR(h.spatialReference),h.zmin-=l,h.zmax+=l);return[2,{count:f,extent:h}];
case 14:m=k.sent();if(m===C.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw m;case 15:return[2]}})})};b.prototype.executeQueryForIds=function(a,b){void 0===a&&(a={});return h(this,void 0,void 0,function(){return k(this,function(c){return[2,this.executeQueryForIdSet(a,b).then(function(a){return g.valuesOfSet(a)})]})})};b.prototype.executeQueryForIdSet=function(a,b){void 0===a&&(a={});return h(this,void 0,void 0,function(){var b,c,d,f,g,h,l,m;return k(this,function(k){switch(k.label){case 0:b=
e.clone(a),b.returnGeometry=!1,b.returnCentroid=!1,b.outSR=null,k.label=1;case 1:return k.trys.push([1,13,,14]),[4,this._schedule()];case 2:return k.sent(),[4,C.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=k.sent(),[4,this._reschedule()];case 4:return k.sent(),[4,this._executeGeometryQuery(b)];case 5:return c=k.sent(),[4,this._reschedule()];case 6:return k.sent(),[4,c.executeObjectIdsQuery(b)];case 7:return c=k.sent(),[4,this._reschedule()];case 8:return k.sent(),
[4,c.executeTimeQuery(b)];case 9:return c=k.sent(),[4,this._reschedule()];case 10:return k.sent(),[4,c.executeAttributesQuery(b)];case 11:return c=k.sent(),[4,this._reschedule()];case 12:k.sent();d=c.items;f=new Set;g=0;for(h=d;g<h.length;g++)l=h[g],f.add(c.featureAdapter.getObjectId(l));return[2,f];case 13:m=k.sent();if(m===C.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw m;case 14:return[2]}})})};b.prototype.executeQueryForLatestObservations=function(b,c){var d=this;if(this.timeInfo)return this.executeQuery(b,
c).then(function(a){return d._filterLatest(a,d.timeInfo)});I.error(new a("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))};b.prototype._schedule=function(a){return h(this,void 0,void 0,function(){return k(this,function(b){return this._frameQueue?[2,this._frameQueue.push(a).then(function(a){return a})]:[2,a]})})};b.prototype._reschedule=function(a){return h(this,void 0,void 0,function(){return k(this,function(b){return this._frameQueue?[2,this._frameQueue.unshift(a).then(function(a){return a})]:
[2,a]})})};b.prototype._update=function(a){for(this._budget=a;!a.done&&this._frameQueue&&this._frameQueue.process();)a.madeProgress();this._budget=null};b.prototype._filterLatest=function(a,b){var c=b.trackIdField,d=b.startTimeField;b=b.endTimeField||d;for(var d=new Map,e=[],f=0,g=a.features;f<g.length;f++){var h=g[f],k=h.attributes[c],m=h.attributes[b];(!d.has(k)||d.get(k).attributes[b]<m)&&d.set(k,h)}d.forEach(function(a){return e.push(a)});return l({},a,{features:e})};b.prototype._getAll=function(){if(!this._allItems){var a=
[];this.featureStore.forEach(function(b){return a.push(b)});this._allItems=new v.default(a,null,this)}return this._allItems};b.prototype._executeGeometryQuery=function(a){return h(this,void 0,void 0,function(){var b,c,d,e,f,g,l,m,n,p,q,r,u,t,x,y,B,C,D,N,I,L,J,K,M=this;return k(this,function(F){switch(F.label){case 0:b=a.geometry;c=a.outSR;d=a.spatialRel;e=w.isValid(c)&&!w.equals(this.spatialReference,c);if(f=this.cacheSpatialQueries?e?JSON.stringify({geometry:b,spatialRelationship:d,outSpatialReference:c}):
JSON.stringify({geometry:b,spatialRelationship:d}):null)if(g=this._geometryQueryCache.get(f),void 0!==g)return[2,g];l=function(b){return h(M,void 0,void 0,function(){var d;return k(this,function(g){switch(g.label){case 0:return e&&(a.returnGeometry||a.returnCentroid)?[4,b.project(c)]:[3,2];case 1:return d=g.sent(),f&&this._geometryQueryCache.put(f,d,d.size||1),[2,d];case 2:return f&&this._geometryQueryCache.put(f,b,b.size||1),[2,b]}})})};if(!b)return[2,l(this._getAll())];m=this.featureAdapter;if("esriSpatialRelDisjoint"!==
d)return[3,5];n=this._searchFeatures(this._getQueryBBoxes(b));if(!n.length)return[2,l(this._getAll())];r=new Set;u=0;for(t=n;u<t.length;u++)x=t[u],r.add(m.getObjectId(x));return[4,this._reschedule(r)];case 1:return r=F.sent(),y=0,p=Array(r.size),this.featureStore.forEach(function(a){return p[y++]=a}),q=r,[4,this._reschedule()];case 2:return F.sent(),[4,z.getSpatialQueryOperator(d,b,this)];case 3:return B=F.sent(),C=function(a){return!q.has(m.getObjectId(a))||B(m.getGeometry(a))},N=v.default.bind,
[4,this._runSpatialFilter(p,C)];case 4:return D=new (N.apply(v.default,[void 0,F.sent(),b,this])),[2,l(D)];case 5:return I=this._searchFeatures(this._getQueryBBoxes(b)),I.length?(L=this._canExecuteSoloPass(b,a))?[2,l(new v.default(I,b,this))]:[4,z.getSpatialQueryOperator(d,b,this)]:(D=new v.default([],b,this),f&&this._geometryQueryCache.put(f,D,D.size||1),[2,D]);case 6:return J=F.sent(),[4,this._runSpatialFilter(I,function(a){return J(m.getGeometry(a))})];case 7:return K=F.sent(),[2,l(new v.default(K,
b,this))]}})})};b.prototype._runSpatialFilter=function(a,b){return h(this,void 0,void 0,function(){var c,d,e,f=this;return k(this,function(g){if(!b)return[2,a];if(!this._budget)return[2,a.filter(function(a){return b(a)})];c=0;d=[];e=function(){return h(f,void 0,void 0,function(){var f;return k(this,function(g){switch(g.label){case 0:if(!(c<a.length))return[3,3];f=a[c];b(f)&&d.push(f);return this._budget.done?[4,this._reschedule()]:[3,2];case 1:return g.sent(),[2,e()];case 2:return++c,[3,0];case 3:return[2]}})})};
return[2,this._reschedule().then(function(){return e()}).then(function(){return d})]})})};b.prototype._canExecuteSoloPass=function(a,b){var c=this.geometryType;b=b.spatialRel;return z.canQueryWithRBush(a)&&("esriSpatialRelEnvelopeIntersects"===b||"esriGeometryPoint"===c&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b||"esriSpatialRelWithin"===b))};b.prototype._getQueryBBoxes=function(a){if(z.canQueryWithRBush(a)){if(x.isExtent(a))return[r.fromValues(a.xmin,a.ymin,a.xmax,a.ymax)];if(x.isPolygon(a))return a.rings.map(function(a){return r.fromValues(Math.min(a[0][0],
a[2][0]),Math.min(a[0][1],a[2][1]),Math.max(a[0][0],a[2][0]),Math.max(a[0][1],a[2][1]))})}return[t.getBoundsXY(r.create(),a)]};b.prototype._searchFeatures=function(a){for(var b=0;b<a.length;b++)this.featureStore.forEachInBounds(a[b],function(a){Q.add(a)});var c=Array(Q.size),d=0;Q.forEach(function(a){return c[d++]=a});Q.clear();return c};b.prototype._checkQuerySupport=function(b){return h(this,void 0,void 0,function(){return k(this,function(d){if(0>b.distance||null!=b.geometryPrecision||b.multipatchOption||
b.pixelSize||b.relationParam||b.text)throw new a("feature-store:unsupported-query","Unsupported query options",{query:b});return[2,c.all([this._checkAttributesQuerySupport(b),this._checkStatisticsQuerySupport(b),z.checkSpatialQuerySupport(b,this.geometryType,this.spatialReference),y.checkProjectionSupport(this.spatialReference,b.outSR)]).then(function(){return b})]})})};b.prototype._checkAttributesQuerySupport=function(b){var c=b.outFields,d=b.orderByFields,e=b.returnDistinctValues;d&&0<d.length&&
(d=d.map(function(a){return-1<a.indexOf(" ASC")?a.split(" ASC")[0]:-1<a.indexOf(" DESC")?a.split(" DESC")[0]:a}),u.validateFields(this.fieldsIndex,d,"orderByFields contains missing fields"));if(c&&0<c.length)u.validateFields(this.fieldsIndex,c,"outFields contains missing fields");else if(e)throw new a("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:b});u.validateWhere(this.fieldsIndex,b.where)};b.prototype._checkStatisticsQuerySupport=function(b){return h(this,
void 0,void 0,function(){var c,d,e,f,g,h,l,m,n,p,q,r;return k(this,function(k){c=b.outStatistics;d=b.groupByFieldsForStatistics;e=b.having;f=d&&d.length;g=c&&c.length;if(e){if(!f||!g)throw new a("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:b});u.validateHaving(this.fieldsIndex,e,c)}if(g){if(h=c.some(function(a){return"exceedslimit"===a.statisticType}))return[2];l=c.map(function(a){return a.onStatisticField});u.validateFields(this.fieldsIndex,
l,"onStatisticFields contains missing fields");f&&u.validateFields(this.fieldsIndex,d,"groupByFieldsForStatistics contains missing fields");m=0;for(n=c;m<n.length;m++){p=n[m];q=p.onStatisticField;r=p.statisticType;if("exceedslimit"===r)throw new a("feature-store:unsupported-query","statistic type exceedslimit is not supported",{definition:p,query:b});if((!f||"count"!==r)&&q&&u.hasInvalidFieldType(q,this.fieldsIndex))throw new a("feature-store:unsupported-query","outStatistics contains non-numeric fields",
{definition:p,query:b});}}return[2]})})};return b}();b.default=n;var L=p.create(),M=p.create()})},"esri/layers/graphics/data/attributeSupport":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/iteratorUtils ../../../core/sql/WhereClauseCache".split(" "),function(n,b,l,k,h,a){function g(a,b){return a?f.get(a,b):null}function e(a,b,c,f){void 0===f&&(f=!0);for(var h=[],l=0;l<b.length;l++){var n=b[l];if("*"!==n&&!a.has(n))if(f){var p=d(n);try{var m=
g(p,a);if(!m)throw new k("feature-store:unsupported-query","invalid SQL expression",{where:p});if(!m.isStandardized)throw new k("feature-store:unsupported-query","expression is not standard",{clause:m});e(a,m.fieldNames,"expression contains missing fields")}catch(v){if((p=v&&v.details)&&(p.clause||p.where))throw v;p&&p.missingFields?h.push.apply(h,p.missingFields):h.push(n)}}else h.push(n)}if(h.length)throw new k("feature-store:unsupported-query",c,{missingFields:h});}function d(a){return a.split(" as ")[0]}
Object.defineProperty(b,"__esModule",{value:!0});var f=new a.WhereClauseCache(50,500),c=h.SetFromValues("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));b.validateWhere=function(a,b){if(!b)return!0;var c=f.get(b,a);if(!c)throw new k("feature-store:unsupported-query","invalid SQL expression",{where:b});if(!c.isStandardized)throw new k("feature-store:unsupported-query","where clause is not standard",
{where:b});e(a,c.fieldNames,"where clause contains missing fields");return!0};b.validateHaving=function(a,b,c){if(!b)return!0;var d=f.get(b,a);if(!d)throw new k("feature-store:unsupported-query","invalid SQL expression",{having:b});if(!d.isAggregate)throw new k("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:b});e(a,d.fieldNames,"having contains missing fields");if(!d.getExpressions().every(function(b){var d=b.aggregateType;b=b.field;var e=a.has(b)&&
a.get(b).name;return c.some(function(b){var c=b.onStatisticField;b=b.statisticType;return(a.has(c)&&a.get(c).name)===e&&b.toLowerCase().trim()===d})}))throw new k("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:b});return!0};b.getWhereClause=g;b.validateFields=e;b.getExpressionFromFieldName=d;b.getAliasFromFieldName=function(a){return a.split(" as ")[1]};b.hasInvalidFieldType=function(a,b){return(a=b.get(a))?!c.has(a.type):!1}})},"esri/core/sql/WhereClauseCache":function(){define(["require",
"exports","../ItemCache","./WhereClause"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b){this._cache=new l(a);this._invalidCache=new l(b)}b.prototype.get=function(a,b){var e=b.uid+":"+a,d=this._cache.get(e);if(d)return d;if(void 0!==this._invalidCache.get(e))return null;try{var f=k.WhereClause.create(a,b);this._cache.put(e,f);return f}catch(c){return this._invalidCache.put(e,null),null}};return b}();b.WhereClauseCache=n})},"esri/core/sql/WhereClause":function(){define("require exports ../has ../iteratorUtils ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),
function(n,b,l,k,h,a,g){function e(a,b){a+="";return a.length>=b?a:Array(b-a.length+1).join("0")+a}function d(a,b,c,d,f,g,h,k,l){void 0===c&&(c="0");void 0===d&&(d="0");void 0===f&&(f="0");void 0===g&&(g="0");void 0===h&&(h="");void 0===k&&(k="0");void 0===l&&(l="0");return"+"===h||"-"===h?(a=e(parseInt(a,10),4)+"-"+e(parseInt(b,10),2)+"-"+e(parseInt(c,10),2),b="",10>parseFloat(g)&&(b="0"),d=e(parseInt(d,10),2)+":"+e(parseInt(f,10),2)+":"+(b+parseFloat(g).toString()),h=""+h+e(parseInt(k,10),2)+":"+
e(parseInt(l,10),2),new Date(a+"T"+d+h)):new Date(parseInt(a,10),parseInt(b,10),parseInt(c,10),parseInt(d,10),parseInt(f,10),parseFloat(g))}function f(a){var b=C.exec(a);if(null!==b){a=b[1];var c=b[2],e=b[3],f=b[4],g=b[5],h=b[6];return d(a,c,e,f,g,h)}b=D.exec(a);if(null!==b){a=b[1];var c=b[2],e=b[3],f=b[4],g=b[5],h=b[6],k=b[7],l=b[8],b=b[9];return d(a,c,e,f,g,h,k,l,b)}b=K.exec(a);if(null!==b)return a=b[1],c=b[2],e=b[3],f=b[4],g=b[5],k=b[6],l=b[7],b=b[8],d(a,c,e,f,g,"0",k,l,b);b=I.exec(a);if(null!==
b)return a=b[1],c=b[2],e=b[3],f=b[4],g=b[5],d(a,c,e,f,g);b=B.exec(a);if(null!==b)return a=b[1],c=b[2],e=b[3],d(a,c,e);throw Error("SQL Invalid Timestamp");}function c(a){a=B.exec(a);if(null===a)throw Error("SQL Invalid Date");var b=a[2],c=a[3];return new Date(parseInt(a[1],10),parseInt(b,10)-1,parseInt(c,10))}function q(a){return Array.isArray(a)?a:[a]}function p(a){return null!==a?!0!==a:null}function r(a,b){return null!=a&&null!=b?!0===a&&!0===b:!1===a||!1===b?!1:null}function t(a,b){return null!=
a&&null!=b?!0===a||!0===b:!0===a||!0===b?!0:null}function x(a,b){if(null==a)return null;for(var c=!1,d=0;d<b.length;d++){var e=b[d];if(null==e)c=null;else if(a===e){c=!0;break}}return c}function w(a,b,c){if(null==a)return null;for(var d="",e=0,f=0;f<b.length;f++){var g=b.charAt(f);switch(e){case 0:g===c?e=1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):"%"===g?d+".*":"_"===g?d+".":d+g;break;case 1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):d+g,e=0}}return(new RegExp("^"+d+"$")).test(a)}function u(a){return a instanceof
Date?a.valueOf():a}function y(a,b,c){if(null==b||null==c)return null;b=u(b);c=u(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function m(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d],f=e.toLowerCase();void 0===c[f]&&(b.push(e),c[f]=1)}return b}function v(b,c,d){if(c instanceof a.SqlInterval)if(d instanceof Date)switch(b){case "+":return new Date(c.valueInMilliseconds()+
d.getTime());case "-":return c.valueInMilliseconds()-d.getTime();case "*":return c.valueInMilliseconds()*d.getTime();case "/":return c.valueInMilliseconds()/d.getTime()}else if(d instanceof a.SqlInterval)switch(b){case "+":return a.SqlInterval.createFromMilliseconds(c.valueInMilliseconds()+d.valueInMilliseconds());case "-":return a.SqlInterval.createFromMilliseconds(c.valueInMilliseconds()-d.valueInMilliseconds());case "*":return c.valueInMilliseconds()*d.valueInMilliseconds();case "/":return c.valueInMilliseconds()/
d.valueInMilliseconds()}else c=c.valueInMilliseconds();else if(d instanceof a.SqlInterval)if(c instanceof Date)switch(b){case "+":return new Date(d.valueInMilliseconds()+c.getTime());case "-":return new Date(c.getTime()-d.valueInMilliseconds());case "*":return c.getTime()*d.valueInMilliseconds();case "/":return c.getTime()/d.valueInMilliseconds()}else d=d.valueInMilliseconds();else if(c instanceof Date&&"number"===typeof d)switch(d*=864E5,c=c.getTime(),b){case "+":return new Date(c+d);case "-":return new Date(c-
d);case "*":return new Date(c*d);case "/":return new Date(c/d)}else if(d instanceof Date&&"number"===typeof c)switch(c*=864E5,d=d.getTime(),b){case "+":return new Date(c+d);case "-":return new Date(c-d);case "*":return new Date(c*d);case "/":return new Date(c/d)}switch(b){case "+":return c+d;case "-":return c-d;case "*":return c*d;case "/":return c/d}}function z(a,b,c,d){a=d.getAttribute(a,b);return null!=a&&1===c[b]?new Date(a):a}Object.defineProperty(b,"__esModule",{value:!0});var B=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,
C=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,D=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,K=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,I=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,Q=function(){function b(){}b.makeBool=function(a){return!0===a};b.featureValue=function(a,b,c,d){return z(a,b,c,d)};b.equalsNull=function(a){return null===a};b.applyLike=function(a,b,c){return w(a,
b,c)};b.ensureArray=function(a){return q(a)};b.applyIn=function(a,b){return x(a,b)};b.currentDate=function(){var a=new Date;a.setHours(0,0,0,0);return a};b.makeSqlInterval=function(b,c,d){return a.SqlInterval.createFromValueAndQualifer(b,c,d)};b.convertInterval=function(b){return b instanceof a.SqlInterval?b.valueInMilliseconds():b};b.currentTimestamp=function(){return new Date};b.compare=function(a,b,c){return y(a,b,c)};b.calculate=function(a,b,c){return v(a,b,c)};b.makeComparable=function(a){return u(a)};
b.evaluateFunction=function(b,c){return a.evaluateFunction(b,c)};b.lookup=function(a,b){a=b[a];return void 0===a?null:a};b.between=function(a,b){return null==a||null==b[0]||null==b[1]?null:a>=b[0]&&a<=b[1]};b.notbetween=function(a,b){return null==a||null==b[0]||null==b[1]?null:a<b[0]||a>b[1]};b.ternaryNot=function(a){return p(a)};b.ternaryAnd=function(a,b){return r(a,b)};b.ternaryOr=function(a,b){return t(a,b)};return b}();n=function(){function d(a,b){this.fieldsIndex=b;this.datefields={};this.parameters=
{};this.parseTree=g.WhereGrammar.parse(a);a=this.extractExpressionInfo(b);b=a.isStandardized;var c=a.isAggregate;this.referencedFieldNames=a.referencedFieldNames;this.isStandardized=b;this.isAggregate=c}d.create=function(a,b){return new d(a,b)};Object.defineProperty(d.prototype,"fieldNames",{get:function(){return this.referencedFieldNames},enumerable:!0,configurable:!0});d.prototype.testSet=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);for(var d={},e=function(b){d[b]=a.map(function(a){return c.getAttribute(a,
b)})},f=0,g=this.fieldNames;f<g.length;f++)e(g[f]);return!!this.evaluateNode(this.parseTree,{attributes:d},b.defaultAttributeAdapter)};d.prototype.calculateValue=function(c,d){void 0===d&&(d=b.defaultAttributeAdapter);c=this.evaluateNode(this.parseTree,c,d);return c instanceof a.SqlInterval?c.valueInMilliseconds()/864E5:c};d.prototype.calculateValueCompiled=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(a,this.parameters,
c,this.datefields);if(l("csp-restrictions"))return this.calculateValue(a,c);this.compileMe();return this.parseTree._compiledVersion(a,this.parameters,c,this.datefields)};d.prototype.testFeature=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);return!!this.evaluateNode(this.parseTree,a,c)};d.prototype.testFeatureCompiled=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);if(void 0===this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(a,this.parameters,c,this.datefields);
if(l("csp-restrictions"))return this.testFeature(a,c);this.compileMe();return!!this.parseTree._compiledVersion(a,this.parameters,c,this.datefields)};d.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&a.push(b.name.toLowerCase())});return m(a)};d.prototype.getExpressions=function(){var a=new Map;this.visitAll(this.parseTree,function(b){if("function"===b.type){var c=b.name.toLowerCase();b=b.args.value[0];if("column_ref"===b.type){b=b.column;var d=
c+"-"+b;a.has(d)||a.set(d,{aggregateType:c,field:b})}}});return k.valuesOfMap(a)};d.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return m(a)};d.prototype.compileMe=function(){var a="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",a)).bind(Q)};d.prototype.extractExpressionInfo=function(b){var c=
this,d=[],e=!0,f=!0;this.visitAll(this.parseTree,function(g){switch(g.type){case "column_ref":var k=g.column.toUpperCase();if("CURRENT_DATE"!==k&&"CURRENT_TIMESTAMP"!==k){var l=(k=b.get(g.column))&&k.name;!k||"date"!==k.type&&"esriFieldTypeDate"!==k.type||(c.datefields[k.name]=1);void 0!==l?(d.push(l),g.column=l):d.push(g.column)}break;case "function":k=g.name,g=g.args.value.length,e&&(e=a.isStandardized(k,g)),f&&(f=h.isAggregate(k,g))}});return{referencedFieldNames:m(d),isStandardized:e,isAggregate:f}};
d.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,d=a.clauses;c<d.length;c++){var e=d[c];this.visitAll(e,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)e=a[c],this.visitAll(e,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);
this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};d.prototype.evaluateNodeToJavaScript=function(a){switch(a.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(a.value)+", "+JSON.stringify(a.qualifier)+","+JSON.stringify(a.op)+")";case "case_expression":var b="";if("simple"===a.format)for(var d="this.makeComparable("+this.evaluateNodeToJavaScript(a.operand)+")",b="( ",e=0;e<a.clauses.length;e++)b+=" ("+d+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(a.clauses[e].operand)+
")) ? ("+this.evaluateNodeToJavaScript(a.clauses[e].value)+") : ";else for(b="( ",e=0;e<a.clauses.length;e++)b+=" this.makeBool("+this.evaluateNodeToJavaScript(a.clauses[e].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(a.clauses[e].value)+") : ";b=null!==a.else?b+this.evaluateNodeToJavaScript(a.else):b+"null";return b+" )";case "param":return"this.lookup("+JSON.stringify(a.value.toLowerCase())+",lookups)";case "expr_list":b="[";d=0;for(a=a.value;d<a.length;d++)e=a[d],"["!==b&&(b+=
","),b+=this.evaluateNodeToJavaScript(e);return b+"]";case "unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(a.expr)+")";case "binary_expr":switch(a.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+
this.evaluateNodeToJavaScript(a.left)+")";case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+")))";case "BETWEEN":return"this.between("+
this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+
JSON.stringify(a.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")"}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(a.value);
case "date":return"(new Date("+c(a.value).getTime().toString()+"))";case "timestamp":return"(new Date("+f(a.value).getTime().toString()+"))";case "column_ref":return"CURRENT_DATE"===a.column.toUpperCase()?"this.currentDate()":"CURRENT_TIMESTAMP"===a.column.toUpperCase()?"this.currentTimestamp()":"this.featureValue(feature,"+JSON.stringify(a.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(a.name)+","+this.evaluateNodeToJavaScript(a.args)+")"}throw Error("Unsupported sql syntax "+
a.type);};d.prototype.evaluateNode=function(b,d,e){switch(b.type){case "interval":return d=this.evaluateNode(b.value,d,e),a.SqlInterval.createFromValueAndQualifer(d,b.qualifier,b.op);case "case_expression":if("simple"===b.format)for(var g=u(this.evaluateNode(b.operand,d,e)),k=0;k<b.clauses.length;k++){if(g===u(this.evaluateNode(b.clauses[k].operand,d,e)))return this.evaluateNode(b.clauses[k].value,d,e)}else for(k=0;k<b.clauses.length;k++)if(!0===this.evaluateNode(b.clauses[k].operand,d,e))return this.evaluateNode(b.clauses[k].value,
d,e);return null!==b.else?this.evaluateNode(b.else,d,e):null;case "param":return this.parameters[b.value.toLowerCase()];case "expr_list":g=[];k=0;for(b=b.value;k<b.length;k++){var l=b[k];g.push(this.evaluateNode(l,d,e))}return g;case "unary_expr":return p(this.evaluateNode(b.expr,d,e));case "binary_expr":switch(b.operator){case "AND":return r(this.evaluateNode(b.left,d,e),this.evaluateNode(b.right,d,e));case "OR":return t(this.evaluateNode(b.left,d,e),this.evaluateNode(b.right,d,e));case "IS":if("null"!==
b.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(b.left,d,e);case "ISNOT":if("null"!==b.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(b.left,d,e);case "IN":return g=q(this.evaluateNode(b.right,d,e)),x(this.evaluateNode(b.left,d,e),g);case "NOT IN":return g=q(this.evaluateNode(b.right,d,e)),p(x(this.evaluateNode(b.left,d,e),g));case "BETWEEN":return g=this.evaluateNode(b.left,d,e),b=this.evaluateNode(b.right,d,e),null==g||null==b[0]||
null==b[1]?null:g>=u(b[0])&&g<=u(b[1]);case "NOTBETWEEN":return g=this.evaluateNode(b.left,d,e),b=this.evaluateNode(b.right,d,e),null==g||null==b[0]||null==b[1]?null:g<u(b[0])||g>u(b[1]);case "LIKE":return w(this.evaluateNode(b.left,d,e),this.evaluateNode(b.right,d,e),b.escape);case "NOT LIKE":return p(w(this.evaluateNode(b.left,d,e),this.evaluateNode(b.right,d,e),b.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return y(b.operator,this.evaluateNode(b.left,
d,e),this.evaluateNode(b.right,d,e));case "-":case "+":case "*":case "/":return v(b.operator,this.evaluateNode(b.left,d,e),this.evaluateNode(b.right,d,e))}throw Error("Not Supported Operator "+b.operator);case "null":case "bool":case "string":case "number":return b.value;case "date":return c(b.value);case "timestamp":return f(b.value);case "column_ref":return"CURRENT_DATE"===b.column.toUpperCase()?(l=new Date,l.setHours(0,0,0,0),l):"CURRENT_TIMESTAMP"===b.column.toUpperCase()?new Date:z(d,b.column,
this.datefields,e);case "function":return d=this.evaluateNode(b.args,d,e),this.isAggregate?h.aggregateFunction(b.name,d):a.evaluateFunction(b.name,d)}throw Error("Unsupported sql syntax "+b.type);};return d}();b.WhereClause=n;b.defaultAttributeAdapter={getAttribute:function(a,b){return(a&&"object"===typeof a.attributes?a.attributes:a)[b]}}})},"esri/core/sql/AggregateFunctions":function(){define(["require","exports"],function(n,b){function l(a){for(var b=0,e=0;e<a.length;e++)b+=a[e];return b/a.length}
function k(a){for(var b=l(a),e=a.length,d=0,f=0;f<a.length;f++)d+=Math.pow(a[f]-b,2);return 1<e?d/(e-1):0}Object.defineProperty(b,"__esModule",{value:!0});b.aggregateFunction=function(a,b){var e=h[a.toLowerCase()];if(null==e)throw Error("Function Not Recognised");if(b.length<e.minParams||b.length>e.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return e.evaluate(b)};b.isAggregate=function(a,b){a=h[a.toLowerCase()];return null!=a&&b>=a.minParams&&b<=a.maxParams};var h=
{min:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.min.apply(Math,a[0])}},max:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.max.apply(Math,a[0])}},avg:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:l(a[0])}},sum:{minParams:1,maxParams:1,evaluate:function(a){if(null==a[0])a=null;else{a=a[0];for(var b=0,e=0;e<a.length;e++)b+=a[e];a=b}return a}},stddev:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sqrt(k(a[0]))}},
count:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].length}},var:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:k(a[0])}}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","dojo/regexp"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}b.fixDefaults=function(a){if(null!==a.precision||null!==a.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");
};b.createFromMilliseconds=function(a){var g=new b;g.second=a/1E3;return g};b.createFromValueAndQualifer=function(a,g,e){var d=null,f=new b;f.op="-"===e?"-":"+";if("interval-period"===g.type){b.fixDefaults(g);if("year"===g.period||"month"===g.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(a))f[g.period]=parseFloat(a);else throw Error("Illegal Interval");}else{b.fixDefaults(g.start);b.fixDefaults(g.end);if("year"===g.start.period||"month"===g.start.period)throw Error("Year-Month Intervals not supported");
if("year"===g.end.period||"month"===g.end.period)throw Error("Year-Month Intervals not supported");switch(g.start.period){case "day":switch(g.end.period){case "hour":d=/^[0-9]{1,} [0-9]{1,}$/;if(d.test(a))f[g.start.period]=parseFloat(a.split(" ")[0]),f[g.end.period]=parseFloat(a.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":d=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(d.test(a))f[g.start.period]=parseFloat(a.split(" ")[0]),a=a.split(" ")[1].split(":"),f.hour=parseFloat(a[0]),
f.minute=parseFloat(a[1]);else throw Error("Illegal Interval");break;case "second":d=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(d.test(a))f[g.start.period]=parseFloat(a.split(" ")[0]),a=a.split(" ")[1].split(":"),f.hour=parseFloat(a[0]),f.minute=parseFloat(a[1]),f.second=parseFloat(a[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(g.end.period){case "minute":d=/^[0-9]{1,}:[0-9]{1,}$/;if(d.test(a))f.hour=parseFloat(a.split(":")[0]),
f.minute=parseFloat(a.split(":")[1]);else throw Error("Illegal Interval");break;case "second":d=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(d.test(a))a=a.split(":"),f.hour=parseFloat(a[0]),f.minute=parseFloat(a[1]),f.second=parseFloat(a[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(g.end.period){case "second":d=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(d.test(a))a=a.split(":"),f.minute=parseFloat(a[0]),f.second=parseFloat(a[1]);
else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return f};b.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return b}();b.SqlInterval=n;b.evaluateFunction=function(b,a){var g=k[b.toLowerCase()];if(null==g)throw Error("Function Not Recognised");if(a.length<g.minParams||a.length>g.maxParams)throw Error("Invalid Parameter count for call to "+
b.toUpperCase());return g.evaluate(a)};b.isStandardized=function(b,a){b=k[b.toLowerCase()];return null!=b&&a>=b.minParams&&a<=b.maxParams};var k={extract:{minParams:2,maxParams:2,evaluate:function(b){var a=b[0];b=b[1];if(null==b)return null;if(b instanceof Date)switch(a.toUpperCase()){case "SECOND":return b.getSeconds();case "MINUTE":return b.getMinutes();case "HOUR":return b.getHours();case "DAY":return b.getDate();case "MONTH":return b.getMonth()+1;case "YEAR":return b.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");
}},substring:{minParams:2,maxParams:3,evaluate:function(b){if(2===b.length){var a=b[0],g=b[1];return null==a||null==g?null:a.toString().substring(g-1)}if(3===b.length)return a=b[0],g=b[1],b=b[2],null==a||null==g||null==b?null:0>=b?"":a.toString().substring(g-1,g+b-1)}},position:{minParams:2,maxParams:2,evaluate:function(b){var a=b[0];b=b[1];return null==a||null==b?null:b.indexOf(a)+1}},trim:{minParams:2,maxParams:3,evaluate:function(b){var a=3===b.length,g=a?b[1]:" ",a=a?b[2]:b[1];if(null==g||null==
a)return null;g="("+l.escapeString(g)+")";switch(b[0]){case "BOTH":return a.replace(new RegExp("^"+g+"*|"+g+"*$","g"),"");case "LEADING":return a.replace(new RegExp("^"+g+"*","g"),"");case "TRAILING":return a.replace(new RegExp(g+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.abs(b[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.ceil(b[0])}},floor:{minParams:1,
maxParams:1,evaluate:function(b){return null==b[0]?null:Math.floor(b[0])}},log:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.log(b[0])}},log10:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.log(b[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.sin(b[0])}},cos:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.cos(b[0])}},tan:{minParams:1,maxParams:1,evaluate:function(b){return null==
b[0]?null:Math.tan(b[0])}},asin:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.asin(b[0])}},acos:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.acos(b[0])}},atan:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.atan(b[0])}},sign:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:0<b[0]?1:0>b[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(b){return null==b[0]||null==b[1]?null:Math.pow(b[0],
b[1])}},mod:{minParams:2,maxParams:2,evaluate:function(b){return null==b[0]||null==b[1]?null:b[0]%b[1]}},round:{minParams:1,maxParams:2,evaluate:function(b){var a=b[0];b=2===b.length?Math.pow(10,b[1]):1;return null==a?null:Math.round(a*b)/b}},truncate:{minParams:1,maxParams:2,evaluate:function(b){return null==b[0]?null:1===b.length?parseInt(b[0].toFixed(0),10):parseFloat(b[0].toFixed(b[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(b){return"string"===typeof b[0]||b[0]instanceof String?
b[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(b){for(var a="",g=0;g<b.length;g++){if(null==b[g])return null;a+=b[g].toString()}return a}},lower:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:b[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:b[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(n,b,l){Object.defineProperty(b,
"__esModule",{value:!0});n=function(){function b(){}b.parse=function(b){return l.parse(b)};return b}();b.WhereGrammar=n})},"esri/core/sql/sql92grammar":function(){define([],function(){function n(b,l,k,h){this.message=b;this.expected=l;this.found=k;this.location=h;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}(function(b,l){function k(){this.constructor=b}k.prototype=l.prototype;b.prototype=new k})(n,Error);n.buildMessage=function(b,l){function k(a){return a.charCodeAt(0).toString(16).toUpperCase()}
function h(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+k(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+k(a)})}function a(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+
k(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+k(a)})}var g={literal:function(a){return'"'+h(a.text)+'"'},"class":function(b){var d="",e;for(e=0;e<b.parts.length;e++)d+=b.parts[e]instanceof Array?a(b.parts[e][0])+"-"+a(b.parts[e][1]):a(b.parts[e]);return"["+(b.inverted?"^":"")+d+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),e;for(e=0;e<a.length;e++){var c=
e,h;h=a[e];h=g[h.type](h);b[c]=h}b.sort();if(0<b.length){for(a=e=1;e<b.length;e++)b[e-1]!==b[e]&&(b[a]=b[e],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(b)+" but "+(l?'"'+h(l)+'"':"end of input")+" found."};return{SyntaxError:n,parse:function(b,l){function k(a,b){return{type:"literal",text:a,ignoreCase:b}}function h(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function a(a){var c=fb[a],
d;if(!c){for(d=a-1;!fb[d];)d--;c=fb[d];for(c={line:c.line,column:c.column};d<a;)10===b.charCodeAt(d)?(c.line++,c.column=1):c.column++,d++;fb[a]=c}return c}function g(b,c){var d=a(b),e=a(c);return{start:{offset:b,line:d.line,column:d.column},end:{offset:c,line:e.line,column:e.column}}}function e(a){E<kb||(E>kb&&(kb=E,Pb=[]),Pb.push(a))}function d(){var a,b,d;a=E;b=ga();b!==A?(b=c(),b!==A?(d=ga(),d!==A?a=b:(E=a,a=A)):(E=a,a=A)):(E=a,a=A);return a}function f(){var a,b,d,e,f,g,h,k;a=E;b=c();if(b!==A){d=
[];e=E;f=ga();f!==A?(g=qa(),g!==A?(h=ga(),h!==A?(k=c(),k!==A?e=f=[f,g,h,k]:(E=e,e=A)):(E=e,e=A)):(E=e,e=A)):(E=e,e=A);for(;e!==A;)d.push(e),e=E,f=ga(),f!==A?(g=qa(),g!==A?(h=ga(),h!==A?(k=c(),k!==A?e=f=[f,g,h,k]:(E=e,e=A)):(E=e,e=A)):(E=e,e=A)):(E=e,e=A);if(d!==A){a={type:"expr_list"};b=[b];for(e=0;e<d.length;e++)b.push(d[e][3]);a.value=b}else E=a,a=A}else E=a,a=A;return a}function c(){var a,b,c,d,e,f,g,h;a=E;b=q();if(b!==A){c=[];d=E;e=ga();e!==A?(f=ka(),f!==A?(g=ga(),g!==A?(h=q(),h!==A?d=e=[e,f,
g,h]:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A);for(;d!==A;)c.push(d),d=E,e=ga(),e!==A?(f=ka(),f!==A?(g=ga(),g!==A?(h=q(),h!==A?d=e=[e,f,g,h]:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A);c!==A?a=b=Ta(b,c):(E=a,a=A)}else E=a,a=A;return a}function q(){var a,b,c,d,e,f,g,h;a=E;b=p();if(b!==A){c=[];d=E;e=ga();e!==A?(f=la(),f!==A?(g=ga(),g!==A?(h=p(),h!==A?d=e=[e,f,g,h]:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A);for(;d!==A;)c.push(d),d=E,e=ga(),e!==A?(f=la(),f!==A?(g=ga(),g!==A?(h=p(),h!==A?d=e=[e,f,g,h]:
(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A);c!==A?a=b=Ta(b,c):(E=a,a=A)}else E=a,a=A;return a}function p(){var a,c,d,g,h;a=E;c=ea();c===A&&(c=E,33===b.charCodeAt(E)?(d=hb,E++):(d=A,0===ha&&e(Ba)),d!==A?(g=E,ha++,61===b.charCodeAt(E)?(h=db,E++):(h=A,0===ha&&e(Ua)),ha--,h===A?g=void 0:(E=g,g=A),g!==A?c=d=[d,g]:(E=c,c=A)):(E=c,c=A));c!==A?(d=ga(),d!==A?(g=p(),g!==A?a=c={type:"unary_expr",operator:"NOT",expr:g}:(E=a,a=A)):(E=a,a=A)):(E=a,a=A);if(a===A)if(a=E,c=w(),c!==A)if(d=ga(),d!==A){var k,l,m;d=[];
g=E;h=ga();h!==A?(k=r(),k!==A?(l=ga(),l!==A?(m=w(),m!==A?g=h=[h,k,l,m]:(E=g,g=A)):(E=g,g=A)):(E=g,g=A)):(E=g,g=A);if(g!==A)for(;g!==A;)d.push(g),g=E,h=ga(),h!==A?(k=r(),k!==A?(l=ga(),l!==A?(m=w(),m!==A?g=h=[h,k,l,m]:(E=g,g=A)):(E=g,g=A)):(E=g,g=A)):(E=g,g=A);else d=A;d!==A&&(d={type:"arithmetic",tail:d});d===A&&(d=E,g=x(),g!==A?(h=ga(),h!==A?(h=sa(),h!==A?(h=ga(),h!==A?(h=f(),h!==A?(k=ga(),k!==A?(k=W(),k!==A?d=g={op:g,right:h}:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,
d=A),d===A&&(d=E,g=x(),g!==A?(h=ga(),h!==A?(h=sa(),h!==A?(h=ga(),h!==A?(h=W(),h!==A?d=g={op:g,right:{type:"expr_list",value:[]}}:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A),d===A&&(d=E,g=x(),g!==A?(h=ga(),h!==A?(h=K(),h!==A?d=g={op:g,right:h}:(E=d,d=A)):(E=d,d=A)):(E=d,d=A))),d===A&&(d=E,h=ea(),h!==A?(g=ga(),g!==A?(g=oa(),g!==A?(k=ga(),k!==A?(k=w(),k!==A?(l=ga(),l!==A?(l=la(),l!==A?(h=ga(),h!==A?(h=w(),h!==A?d=h={op:"NOT"+g,right:{type:"expr_list",value:[k,h]}}:(E=d,d=A)):(E=d,d=A)):(E=
d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A),d===A&&(d=E,h=oa(),h!==A?(g=ga(),g!==A?(g=w(),g!==A?(k=ga(),k!==A?(k=la(),k!==A?(l=ga(),l!==A?(l=w(),l!==A?d=h={op:h,right:{type:"expr_list",value:[g,l]}}:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)),d===A&&(d=E,g=da(),g!==A?(h=ga(),h!==A?(h=ea(),h!==A?(h=ga(),h!==A?(h=w(),h!==A?d=g={op:g+"NOT",right:h}:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A),d===A&&(d=E,g=da(),g!==A?(h=ga(),h!==
A?(h=w(),h!==A?d=g={op:g,right:h}:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)),d===A&&(d=E,g=t(),g!==A?(h=ga(),h!==A?(h=M(),h!==A?(k=ga(),k!==A?(k=E,b.substr(E,6).toLowerCase()===Xb?(l=b.substr(E,6),E+=6):(l=A,0===ha&&e(vc)),l!==A?(l=E,ha++,m=C(),ha--,m===A?l=void 0:(E=l,l=A),l!==A?k="ESCAPE":(E=k,k=A)):(E=k,k=A),k!==A?(k=ga(),k!==A?(k=R(),k!==A?d=g={op:g,right:h,escape:k.value}:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A),d===A&&(d=E,g=t(),g!==A?(h=ga(),h!==A?(h=M(),h!==A?d=g=
{op:g,right:h,escape:""}:(E=d,d=A)):(E=d,d=A)):(E=d,d=A))))));d===A&&(d=null);d!==A?(a=c,c=d,""==c||void 0==c||null==c?c=a:(d=null,c=d="arithmetic"==c.type?Ta(a,c.tail):Ra(c.op,a,c.right,c.escape)),a=c):(E=a,a=A)}else E=a,a=A;else E=a,a=A;return a}function r(){var a;b.substr(E,2)===Da?(a=Da,E+=2):(a=A,0===ha&&e(Ya));a===A&&(62===b.charCodeAt(E)?(a=ta,E++):(a=A,0===ha&&e(Qa)),a===A&&(b.substr(E,2)===aa?(a=aa,E+=2):(a=A,0===ha&&e(Fa)),a===A&&(b.substr(E,2)===Ha?(a=Ha,E+=2):(a=A,0===ha&&e(Ka)),a===A&&
(60===b.charCodeAt(E)?(a=ra,E++):(a=A,0===ha&&e(Aa)),a===A&&(61===b.charCodeAt(E)?(a=db,E++):(a=A,0===ha&&e(Ua)),a===A&&(b.substr(E,2)===ja?(a=ja,E+=2):(a=A,0===ha&&e(rb))))))));return a}function t(){var a,b,c,d;a=a=E;b=ea();b!==A?(c=ga(),c!==A?(d=F(),d!==A?a=b=[b,c,d]:(E=a,a=A)):(E=a,a=A)):(E=a,a=A);a!==A&&(a=a[0]+" "+a[2]);a===A&&(a=F());return a}function x(){var a,b,c,d;a=a=E;b=ea();b!==A?(c=ga(),c!==A?(d=ca(),d!==A?a=b=[b,c,d]:(E=a,a=A)):(E=a,a=A)):(E=a,a=A);a!==A&&(a=a[0]+" "+a[2]);a===A&&(a=
ca());return a}function w(){var a,b,c,d,e,f,g,h;a=E;b=y();if(b!==A){c=[];d=E;e=ga();e!==A?(f=u(),f!==A?(g=ga(),g!==A?(h=y(),h!==A?d=e=[e,f,g,h]:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A);for(;d!==A;)c.push(d),d=E,e=ga(),e!==A?(f=u(),f!==A?(g=ga(),g!==A?(h=y(),h!==A?d=e=[e,f,g,h]:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A);c!==A?a=b=Ta(b,c):(E=a,a=A)}else E=a,a=A;return a}function u(){var a;43===b.charCodeAt(E)?(a=Nb,E++):(a=A,0===ha&&e(gb));a===A&&(45===b.charCodeAt(E)?(a=ab,E++):(a=A,0===ha&&e(vb)));
return a}function y(){var a,b,c,d,e,f,g,h;a=E;b=v();if(b!==A){c=[];d=E;e=ga();e!==A?(f=m(),f!==A?(g=ga(),g!==A?(h=v(),h!==A?d=e=[e,f,g,h]:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A);for(;d!==A;)c.push(d),d=E,e=ga(),e!==A?(f=m(),f!==A?(g=ga(),g!==A?(h=v(),h!==A?d=e=[e,f,g,h]:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A);c!==A?a=b=Ta(b,c):(E=a,a=A)}else E=a,a=A;return a}function m(){var a;42===b.charCodeAt(E)?(a=Za,E++):(a=A,0===ha&&e($a));a===A&&(47===b.charCodeAt(E)?(a=xb,E++):(a=A,0===ha&&e(Ob)));return a}
function v(){var a,d,g,h,k,l,m;m=R();if(m===A){var n,p,q,r;n=E;var v,u,t,x;v=E;u=Y();u!==A?(t=X(),t!==A?(x=P(),x!==A?v=u=parseFloat(u+t+x):(E=v,v=A)):(E=v,v=A)):(E=v,v=A);v===A&&(v=E,u=Y(),u!==A?(t=X(),t!==A?v=u=parseFloat(u+t):(E=v,v=A)):(E=v,v=A),v===A&&(v=E,u=Y(),u!==A?(t=P(),t!==A?v=u=parseFloat(u+t):(E=v,v=A)):(E=v,v=A),v===A&&(v=E,u=Y(),u!==A&&(u=parseFloat(u)),v=u)));p=v;p!==A?(q=E,ha++,r=B(),ha--,r===A?q=void 0:(E=q,q=A),q!==A?n=p={type:"number",value:p}:(E=n,n=A)):(E=n,n=A);m=n;if(m===A){var y,
w;y=E;var F,J,L,H;F=E;b.substr(E,4).toLowerCase()===Cc?(J=b.substr(E,4),E+=4):(J=A,0===ha&&e(wd));J!==A?(L=E,ha++,H=C(),ha--,H===A?L=void 0:(E=L,L=A),L!==A?F=J=[J,L]:(E=F,F=A)):(E=F,F=A);w=F;w!==A&&(w={type:"bool",value:!0});y=w;if(y===A){y=E;var N,V,Da,aa;N=E;b.substr(E,5).toLowerCase()===kc?(V=b.substr(E,5),E+=5):(V=A,0===ha&&e(Oc));V!==A?(Da=E,ha++,aa=C(),ha--,aa===A?Da=void 0:(E=Da,Da=A),Da!==A?N=V=[V,Da]:(E=N,N=A)):(E=N,N=A);w=N;w!==A&&(w={type:"bool",value:!1});y=w}m=y;if(m===A){var Fa,Z,ea,
la,Ha;Z=E;b.substr(E,4).toLowerCase()===ed?(ea=b.substr(E,4),E+=4):(ea=A,0===ha&&e(Wc));ea!==A?(la=E,ha++,Ha=C(),ha--,Ha===A?la=void 0:(E=la,la=A),la!==A?Z=ea=[ea,la]:(E=Z,Z=A)):(E=Z,Z=A);Fa=Z;Fa!==A&&(Fa={type:"null",value:null});m=Fa;if(m===A){var O,da,oa,ka;O=E;var ta,Ya,Ka,Qa;ta=E;b.substr(E,4).toLowerCase()===fd?(Ya=b.substr(E,4),E+=4):(Ya=A,0===ha&&e(xd));Ya!==A?(Ka=E,ha++,Qa=C(),ha--,Qa===A?Ka=void 0:(E=Ka,Ka=A),Ka!==A?ta=Ya="DATE":(E=ta,ta=A)):(E=ta,ta=A);da=ta;da!==A?(oa=ga(),oa!==A?(ka=
M(),ka!==A?O=da={type:"date",value:ka.value}:(E=O,O=A)):(E=O,O=A)):(E=O,O=A);m=O;if(m===A){var ra,ba,ja,Ua;ra=E;var qa,za,Aa,ma;qa=E;b.substr(E,9).toLowerCase()===gd?(za=b.substr(E,9),E+=9):(za=A,0===ha&&e(Ic));za!==A?(Aa=E,ha++,ma=C(),ha--,ma===A?Aa=void 0:(E=Aa,Aa=A),Aa!==A?qa=za="TIMESTAMP":(E=qa,qa=A)):(E=qa,qa=A);ba=qa;ba!==A?(ja=ga(),ja!==A?(Ua=M(),Ua!==A?ra=ba={type:"timestamp",value:Ua.value}:(E=ra,ra=A)):(E=ra,ra=A)):(E=ra,ra=A);m=ra;if(m===A){var pa,Ba,Pa,Ra,rb,Ta,db,Ia;pa=E;Ba=xa();Ba!==
A?(Pa=ga(),Pa!==A?(45===b.charCodeAt(E)?(Ra=ab,E++):(Ra=A,0===ha&&e(vb)),Ra===A&&(43===b.charCodeAt(E)?(Ra=Nb,E++):(Ra=A,0===ha&&e(gb))),Ra!==A?(rb=ga(),rb!==A?(Ta=M(),Ta!==A?(db=ga(),db!==A?(Ia=Q(),Ia!==A?pa=Ba={type:"interval",value:Ta,qualifier:Ia,op:Ra}:(E=pa,pa=A)):(E=pa,pa=A)):(E=pa,pa=A)):(E=pa,pa=A)):(E=pa,pa=A)):(E=pa,pa=A)):(E=pa,pa=A);pa===A&&(pa=E,Ba=xa(),Ba!==A?(Pa=ga(),Pa!==A?(Ra=M(),Ra!==A?(rb=ga(),rb!==A?(Ta=Q(),Ta!==A?pa=Ba={type:"interval",value:Ra,qualifier:Ta,op:""}:(E=pa,pa=A)):
(E=pa,pa=A)):(E=pa,pa=A)):(E=pa,pa=A)):(E=pa,pa=A));m=pa}}}}}}a=m;if(a===A){var Ga,La,hb,Ma,Na,Va,bb,dc,lb,Sb,Zb,mc;Ga=E;var bc,fb,jb,mb;bc=E;b.substr(E,7).toLowerCase()===Yb?(fb=b.substr(E,7),E+=7):(fb=A,0===ha&&e(lc));fb!==A?(jb=E,ha++,mb=C(),ha--,mb===A?jb=void 0:(E=jb,jb=A),jb!==A?bc=fb="EXTRACT":(E=bc,bc=A)):(E=bc,bc=A);La=bc;if(La!==A)if(hb=ga(),hb!==A)if(Ma=sa(),Ma!==A)if(Na=ga(),Na!==A){var Xa;Xa=ia();Xa===A&&(Xa=na(),Xa===A&&(Xa=wa(),Xa===A&&(Xa=Ca(),Xa===A&&(Xa=ua(),Xa===A&&(Xa=ya())))));
Va=Xa;Va!==A?(bb=ga(),bb!==A?(dc=va(),dc!==A?(lb=ga(),lb!==A?(Sb=c(),Sb!==A?(Zb=ga(),Zb!==A?(mc=W(),mc!==A?Ga=La={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:Va},Sb]}}:(E=Ga,Ga=A)):(E=Ga,Ga=A)):(E=Ga,Ga=A)):(E=Ga,Ga=A)):(E=Ga,Ga=A)):(E=Ga,Ga=A)):(E=Ga,Ga=A)}else E=Ga,Ga=A;else E=Ga,Ga=A;else E=Ga,Ga=A;else E=Ga,Ga=A;a=Ga;if(a===A){var ib,Fb,kd,pb,qb,kb,Za,Ab,Bb,Cb,ld,cb,Wa,Ib,$c,ad;ib=E;var nb,Rb,Kb,Wb;nb=E;b.substr(E,9).toLowerCase()===hd?(Rb=b.substr(E,9),E+=
9):(Rb=A,0===ha&&e(Eb));Rb!==A?(Kb=E,ha++,Wb=C(),ha--,Wb===A?Kb=void 0:(E=Kb,Kb=A),Kb!==A?nb=Rb="SUBSTRING":(E=nb,nb=A)):(E=nb,nb=A);Fb=nb;if(Fb!==A)if(kd=ga(),kd!==A)if(pb=sa(),pb!==A)if(qb=ga(),qb!==A)if(kb=c(),kb!==A)if(Za=ga(),Za!==A)if(Ab=va(),Ab!==A)if(Bb=ga(),Bb!==A)if(Cb=c(),Cb!==A)if(ld=ga(),ld!==A){cb=E;var ub,Db,xb,Pb;ub=E;b.substr(E,3).toLowerCase()===id?(Db=b.substr(E,3),E+=3):(Db=A,0===ha&&e(yd));Db!==A?(xb=E,ha++,Pb=C(),ha--,Pb===A?xb=void 0:(E=xb,xb=A),xb!==A?ub=Db="FOR":(E=ub,ub=
A)):(E=ub,ub=A);Wa=ub;Wa!==A?(Ib=ga(),Ib!==A?($c=c(),$c!==A?(ad=ga(),ad!==A?cb=Wa=[Wa,Ib,$c,ad]:(E=cb,cb=A)):(E=cb,cb=A)):(E=cb,cb=A)):(E=cb,cb=A);cb===A&&(cb=null);cb!==A?(Wa=W(),Wa!==A?ib=Fb={type:"function",name:"substring",args:{type:"expr_list",value:cb?[kb,Cb,cb[2]]:[kb,Cb]}}:(E=ib,ib=A)):(E=ib,ib=A)}else E=ib,ib=A;else E=ib,ib=A;else E=ib,ib=A;else E=ib,ib=A;else E=ib,ib=A;else E=ib,ib=A;else E=ib,ib=A;else E=ib,ib=A;else E=ib,ib=A;else E=ib,ib=A;a=ib;if(a===A){var Ja,Jb,cc,ec,Vb,$a,Ob,Hb,
Qb,Mb,Ac,vc,$b,xc;Ja=E;Jb=fa();Jb!==A?(cc=ga(),cc!==A?(ec=sa(),ec!==A?(Vb=ga(),Vb!==A?($a=I(),$a===A&&($a=null),$a!==A?(Ob=ga(),Ob!==A?(Hb=c(),Hb!==A?(Qb=ga(),Qb!==A?(Mb=va(),Mb!==A?(Ac=ga(),Ac!==A?(vc=c(),vc!==A?($b=ga(),$b!==A?(xc=W(),xc!==A?Ja=Jb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==$a?"BOTH":$a},Hb,vc]}}:(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):
(E=Ja,Ja=A)):(E=Ja,Ja=A);Ja===A&&(Ja=E,Jb=fa(),Jb!==A?(cc=ga(),cc!==A?(ec=sa(),ec!==A?(Vb=ga(),Vb!==A?($a=I(),$a===A&&($a=null),$a!==A?(Ob=ga(),Ob!==A?(Hb=c(),Hb!==A?(Qb=ga(),Qb!==A?(Mb=W(),Mb!==A?Ja=Jb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==$a?"BOTH":$a},Hb]}}:(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A)):(E=Ja,Ja=A));a=Ja;if(a===A){var ob,Ec,Fc,fc,gc,wb,Lb,Ub,Kc,yc,Lc,nd;ob=E;var Xb,ac,Tb,Jc;
Xb=E;b.substr(E,8).toLowerCase()===jd?(ac=b.substr(E,8),E+=8):(ac=A,0===ha&&e(zd));ac!==A?(Tb=E,ha++,Jc=C(),ha--,Jc===A?Tb=void 0:(E=Tb,Tb=A),Tb!==A?Xb=ac="POSITION":(E=Xb,Xb=A)):(E=Xb,Xb=A);Ec=Xb;Ec!==A?(Fc=ga(),Fc!==A?(fc=sa(),fc!==A?(gc=ga(),gc!==A?(wb=c(),wb!==A?(Lb=ga(),Lb!==A?(Ub=ca(),Ub!==A?(Kc=ga(),Kc!==A?(yc=c(),yc!==A?(Lc=ga(),Lc!==A?(nd=W(),nd!==A?ob=Ec={type:"function",name:"position",args:{type:"expr_list",value:[wb,yc]}}:(E=ob,ob=A)):(E=ob,ob=A)):(E=ob,ob=A)):(E=ob,ob=A)):(E=ob,ob=A)):
(E=ob,ob=A)):(E=ob,ob=A)):(E=ob,ob=A)):(E=ob,ob=A)):(E=ob,ob=A)):(E=ob,ob=A);a=ob;if(a===A){var Gb,zc,Uc,md,rd,rc,wc,Tc;Gb=E;var oc,hc,jc,Dc;oc=E;oc=hc=z();if(oc===A)if(oc=E,96===b.charCodeAt(E)?(hc=Xc,E++):(hc=A,0===ha&&e(Pc)),hc!==A){jc=[];Yc.test(b.charAt(E))?(Dc=b.charAt(E),E++):(Dc=A,0===ha&&e(Qc));if(Dc!==A)for(;Dc!==A;)jc.push(Dc),Yc.test(b.charAt(E))?(Dc=b.charAt(E),E++):(Dc=A,0===ha&&e(Qc));else jc=A;jc!==A?(96===b.charCodeAt(E)?(Dc=Xc,E++):(Dc=A,0===ha&&e(Pc)),Dc!==A?oc=hc=jc.join(""):(E=
oc,oc=A)):(E=oc,oc=A)}else E=oc,oc=A;zc=oc;zc!==A?(Uc=ga(),Uc!==A?(md=sa(),md!==A?(rd=ga(),rd!==A?(rc=f(),rc===A&&(rc=null),rc!==A?(wc=ga(),wc!==A?(Tc=W(),Tc!==A?Gb=zc={type:"function",name:zc,args:rc?rc:{type:"expr_list",value:[]}}:(E=Gb,Gb=A)):(E=Gb,Gb=A)):(E=Gb,Gb=A)):(E=Gb,Gb=A)):(E=Gb,Gb=A)):(E=Gb,Gb=A)):(E=Gb,Gb=A);a=Gb;if(a===A){var sc,Sa,Gc,Vc,ic,uc,Rc,pc,nc,od,qd;Sa=E;Gc=G();if(Gc!==A)if(Vc=ga(),Vc!==A)if(ic=c(),ic!==A)if(uc=ga(),uc!==A){Rc=[];for(pc=T();pc!==A;)Rc.push(pc),pc=T();Rc!==A?
(pc=ga(),pc!==A?(nc=Ea(),nc!==A?Sa=Gc={type:"case_expression",format:"simple",operand:ic,clauses:Rc,else:null}:(E=Sa,Sa=A)):(E=Sa,Sa=A)):(E=Sa,Sa=A)}else E=Sa,Sa=A;else E=Sa,Sa=A;else E=Sa,Sa=A;else E=Sa,Sa=A;if(Sa===A)if(Sa=E,Gc=G(),Gc!==A)if(Vc=ga(),Vc!==A)if(ic=c(),ic!==A)if(uc=ga(),uc!==A){Rc=[];for(pc=T();pc!==A;)Rc.push(pc),pc=T();Rc!==A?(pc=ga(),pc!==A?(nc=U(),nc!==A?(od=ga(),od!==A?(qd=Ea(),qd!==A?Sa=Gc={type:"case_expression",format:"simple",operand:ic,clauses:Rc,else:nc.value}:(E=Sa,Sa=
A)):(E=Sa,Sa=A)):(E=Sa,Sa=A)):(E=Sa,Sa=A)):(E=Sa,Sa=A)}else E=Sa,Sa=A;else E=Sa,Sa=A;else E=Sa,Sa=A;else E=Sa,Sa=A;sc=Sa;if(sc===A){var eb,Hc,Bc,Sc,qc,tc,Nc,pd;eb=E;Hc=G();if(Hc!==A)if(Bc=ga(),Bc!==A){Sc=[];for(qc=S();qc!==A;)Sc.push(qc),qc=S();Sc!==A?(qc=ga(),qc!==A?(tc=Ea(),tc!==A?eb=Hc={type:"case_expression",format:"searched",clauses:Sc,else:null}:(E=eb,eb=A)):(E=eb,eb=A)):(E=eb,eb=A)}else E=eb,eb=A;else E=eb,eb=A;if(eb===A)if(eb=E,Hc=G(),Hc!==A)if(Bc=ga(),Bc!==A){Sc=[];for(qc=S();qc!==A;)Sc.push(qc),
qc=S();Sc!==A?(qc=ga(),qc!==A?(tc=U(),tc!==A?(Nc=ga(),Nc!==A?(pd=Ea(),pd!==A?eb=Hc={type:"case_expression",format:"searched",clauses:Sc,else:tc.value}:(E=eb,eb=A)):(E=eb,eb=A)):(E=eb,eb=A)):(E=eb,eb=A)):(E=eb,eb=A)}else E=eb,eb=A;else E=eb,eb=A;sc=eb}a=sc;if(a===A){var Mc,Zc,bd,Gd,Hd;Zc=E;bd=B();if(bd!==A){Gd=[];for(Hd=D();Hd!==A;)Gd.push(Hd),Hd=D();Gd!==A?Zc=bd+=Gd.join(""):(E=Zc,Zc=A)}else E=Zc,Zc=A;Mc=Zc;Mc!==A&&(Mc={type:"column_ref",table:"",column:Mc});a=Mc;a===A&&(a=K(),a===A&&(a=E,d=sa(),
d!==A?(g=ga(),g!==A?(h=c(),h!==A?(k=ga(),k!==A?(l=W(),l!==A?(h.paren=!0,a=d=h):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)))}}}}}}}return a}function z(){var a,b,c,d;a=E;b=B();if(b!==A){c=[];for(d=C();d!==A;)c.push(d),d=C();c!==A?a=b+=c.join(""):(E=a,a=A)}else E=a,a=A;return a}function B(){var a;nb.test(b.charAt(E))?(a=b.charAt(E),E++):(a=A,0===ha&&e(Fb));return a}function C(){var a;mc.test(b.charAt(E))?(a=b.charAt(E),E++):(a=A,0===ha&&e(Ab));return a}function D(){var a;Rb.test(b.charAt(E))?
(a=b.charAt(E),E++):(a=A,0===ha&&e(lb));return a}function K(){var a,c,d;a=E;64===b.charCodeAt(E)?(c=jb,E++):(c=A,0===ha&&e(Sb));c!==A?(d=z(),d!==A?a=c=[c,d]:(E=a,a=A)):(E=a,a=A);a!==A&&(a={type:"param",value:a[1]});return a}function I(){var a,c,d;a=E;b.substr(E,7).toLowerCase()===rc?(c=b.substr(E,7),E+=7):(c=A,0===ha&&e(ba));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="LEADING":(E=a,a=A)):(E=a,a=A);a===A&&(a=E,b.substr(E,8).toLowerCase()===Na?(c=b.substr(E,8),E+=8):(c=A,0===ha&&e(bb)),
c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="TRAILING":(E=a,a=A)):(E=a,a=A),a===A&&(a=E,b.substr(E,4).toLowerCase()===Ma?(c=b.substr(E,4),E+=4):(c=A,0===ha&&e(La)),c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="BOTH":(E=a,a=A)):(E=a,a=A)));return a}function Q(){var a,c,d;a=E;var f,g;c=E;d=J();d!==A?(f=ga(),f!==A?(f=sa(),f!==A?(f=ga(),f!==A?(f=L(),f!==A?(g=ga(),g!==A?(g=W(),g!==A?c=d={type:"interval-period",period:d.value,precision:f,secondary:null}:(E=c,c=A)):(E=c,c=
A)):(E=c,c=A)):(E=c,c=A)):(E=c,c=A)):(E=c,c=A)):(E=c,c=A);c===A&&(c=E,d=J(),d!==A&&(d=Hb(d)),c=d);if(c!==A)if(d=ga(),d!==A)if(d=E,b.substr(E,2).toLowerCase()===Va?(f=b.substr(E,2),E+=2):(f=A,0===ha&&e(Zb)),f!==A?(f=E,ha++,g=C(),ha--,g===A?f=void 0:(E=f,f=A),f!==A?d="TO":(E=d,d=A)):(E=d,d=A),d!==A)if(d=ga(),d!==A){var h;d=E;f=J();f!==A&&(f={type:"interval-period",period:f.value,precision:null,secondary:null});d=f;d===A&&(d=E,f=ya(),f!==A?(f=ga(),f!==A?(f=sa(),f!==A?(f=ga(),f!==A?(f=L(),f!==A?(g=ga(),
g!==A?(g=qa(),g!==A?(g=ga(),g!==A?(g=N(),g!==A?(h=ga(),h!==A?(h=W(),h!==A?d=f=Bb(f,g):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A),d===A&&(d=E,f=ya(),f!==A?(f=ga(),f!==A?(f=sa(),f!==A?(f=ga(),f!==A?(f=L(),f!==A?(g=ga(),g!==A?(g=W(),g!==A?d=f={type:"interval-period",period:"second",precision:f,secondary:null}:(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A)):(E=d,d=A),d===A&&(d=E,f=ya(),f!==A&&(f={type:"interval-period",
period:"second",precision:null,secondary:null}),d=f)));d!==A?a=c={type:"interval-qualifier",start:c,end:d}:(E=a,a=A)}else E=a,a=A;else E=a,a=A;else E=a,a=A;else E=a,a=A;a===A&&(a=E,d=J(),d!==A?(c=ga(),c!==A?(c=sa(),c!==A?(c=ga(),c!==A?(c=N(),c!==A?(f=ga(),f!==A?(f=W(),f!==A?a=d={type:"interval-period",period:d.value,precision:c,secondary:null}:(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A),a===A&&(a=E,d=J(),d!==A&&(d=Hb(d)),a=d,a===A&&(a=E,d=ya(),d!==A?(c=ga(),c!==A?(c=
sa(),c!==A?(c=ga(),c!==A?(c=L(),c!==A?(f=ga(),f!==A?(f=qa(),f!==A?(d=ga(),d!==A?(d=N(),d!==A?(f=ga(),f!==A?(f=W(),f!==A?a=d=Bb(c,d):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A),a===A&&(a=E,d=ya(),d!==A?(c=ga(),c!==A?(c=sa(),c!==A?(c=ga(),c!==A?(c=N(),c!==A?(f=ga(),f!==A?(f=W(),f!==A?a=d={type:"interval-period",period:"second",precision:c,secondary:null}:(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,
a=A),a===A&&(a=E,d=ya(),d!==A&&(d={type:"interval-period",period:"second",precision:null,secondary:null}),a=d)))));return a}function J(){var a;a=E;a=wa();a!==A&&(a={type:"string",value:"day"});a===A&&(a=E,a=Ca(),a!==A&&(a={type:"string",value:"hour"}),a===A&&(a=E,a=ua(),a!==A&&(a={type:"string",value:"minute"}),a===A&&(a=E,a=na(),a!==A&&(a={type:"string",value:"month"}),a===A&&(a=E,a=ia(),a!==A&&(a={type:"string",value:"year"})))));return a}function N(){var a;a=V();a!==A&&(a=parseFloat(a));return a}
function L(){var a;a=V();a!==A&&(a=parseFloat(a));return a}function M(){var a;a=R();a===A&&(a=K());return a}function R(){var a,c,d;a=E;39===b.charCodeAt(E)?(c=$b,E++):(c=A,0===ha&&e(Ib));c===A&&(b.substr(E,2)===ub?(c=ub,E+=2):(c=A,0===ha&&e(Qb)));if(c!==A){c=[];d=E;b.substr(E,2)===Jb?(d=Jb,E+=2):(d=A,0===ha&&e(Kb));d!==A&&(d="'");d===A&&(ac.test(b.charAt(E))?(d=b.charAt(E),E++):(d=A,0===ha&&e(O)));for(;d!==A;)c.push(d),d=E,b.substr(E,2)===Jb?(d=Jb,E+=2):(d=A,0===ha&&e(Kb)),d!==A&&(d="'"),d===A&&(ac.test(b.charAt(E))?
(d=b.charAt(E),E++):(d=A,0===ha&&e(O)));c!==A?(39===b.charCodeAt(E)?(d=$b,E++):(d=A,0===ha&&e(Ib)),d!==A?a=c={type:"string",value:c.join("")}:(E=a,a=A)):(E=a,a=A)}else E=a,a=A;return a}function S(){var a,b,d;a=E;b=za();b!==A?(b=ga(),b!==A?(b=c(),b!==A?(d=ga(),d!==A?(d=H(),d!==A?(d=ga(),d!==A?(d=c(),d!==A?a=b={type:"when_clause",operand:b,value:d}:(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A);return a}function T(){var a,b,d;a=E;b=za();b!==A?(b=ga(),b!==A?(b=c(),b!==A?
(d=ga(),d!==A?(d=H(),d!==A?(d=ga(),d!==A?(d=c(),d!==A?a=b={type:"when_clause",operand:b,value:d}:(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A)):(E=a,a=A);return a}function U(){var a,d;a=E;var f,g;d=E;b.substr(E,4).toLowerCase()===wc?(f=b.substr(E,4),E+=4):(f=A,0===ha&&e(sc));f!==A?(f=E,ha++,g=C(),ha--,g===A?f=void 0:(E=f,f=A),f!==A?d="ELSE":(E=d,d=A)):(E=d,d=A);d!==A?(d=ga(),d!==A?(d=c(),d!==A?a={type:"else_clause",value:d}:(E=a,a=A)):(E=a,a=A)):(E=a,a=A);return a}function Y(){var a,
c,d;a=V();a===A&&(a=E,45===b.charCodeAt(E)?(c=ab,E++):(c=A,0===ha&&e(vb)),c===A&&(43===b.charCodeAt(E)?(c=Nb,E++):(c=A,0===ha&&e(gb))),c!==A?(d=V(),d!==A?a=c=c[0]+d:(E=a,a=A)):(E=a,a=A));return a}function X(){var a,c;a=E;46===b.charCodeAt(E)?(c=Ia,E++):(c=A,0===ha&&e(wb));c!==A?(c=V(),c===A&&(c=null),c!==A?a="."+(null!=c?c:""):(E=a,a=A)):(E=a,a=A);return a}function P(){var a,c,d;c=a=E;ma.test(b.charAt(E))?(d=b.charAt(E),E++):(d=A,0===ha&&e(Lb));d!==A?(Mb.test(b.charAt(E))?(d=b.charAt(E),E++):(d=A,
0===ha&&e(Tb)),d===A&&(d=null),d!==A?c="e"+(null===d?"":d):(E=c,c=A)):(E=c,c=A);c!==A?(d=V(),d!==A?a=c+d:(E=a,a=A)):(E=a,a=A);return a}function V(){var a,b;a=[];b=Z();if(b!==A)for(;b!==A;)a.push(b),b=Z();else a=A;a!==A&&(a=a.join(""));return a}function Z(){var a;Wa.test(b.charAt(E))?(a=b.charAt(E),E++):(a=A,0===ha&&e(Ub));return a}function ca(){var a,c,d;a=E;b.substr(E,2).toLowerCase()===Jc?(c=b.substr(E,2),E+=2):(c=A,0===ha&&e(Kc));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="IN":
(E=a,a=A)):(E=a,a=A);return a}function da(){var a,c,d;a=E;b.substr(E,2).toLowerCase()===xc?(c=b.substr(E,2),E+=2):(c=A,0===ha&&e(bc));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="IS":(E=a,a=A)):(E=a,a=A);return a}function F(){var a,c,d;a=E;b.substr(E,4).toLowerCase()===Cb?(c=b.substr(E,4),E+=4):(c=A,0===ha&&e(cc));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="LIKE":(E=a,a=A)):(E=a,a=A);return a}function ea(){var a,c,d;a=E;b.substr(E,3).toLowerCase()===yc?(c=b.substr(E,
3),E+=3):(c=A,0===ha&&e(Lc));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="NOT":(E=a,a=A)):(E=a,a=A);return a}function la(){var a,c,d;a=E;b.substr(E,3).toLowerCase()===zc?(c=b.substr(E,3),E+=3):(c=A,0===ha&&e(dc));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="AND":(E=a,a=A)):(E=a,a=A);return a}function ka(){var a,c,d;a=E;b.substr(E,2).toLowerCase()===Ec?(c=b.substr(E,2),E+=2):(c=A,0===ha&&e(ec));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="OR":(E=a,a=
A)):(E=a,a=A);return a}function oa(){var a,c,d;a=E;b.substr(E,7).toLowerCase()===Vb?(c=b.substr(E,7),E+=7):(c=A,0===ha&&e(Fc));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="BETWEEN":(E=a,a=A)):(E=a,a=A);return a}function va(){var a,c,d;a=E;b.substr(E,4).toLowerCase()===Tc?(c=b.substr(E,4),E+=4):(c=A,0===ha&&e(Uc));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="FROM":(E=a,a=A)):(E=a,a=A);return a}function fa(){var a,c,d;a=E;b.substr(E,4).toLowerCase()===Wb?(c=b.substr(E,
4),E+=4):(c=A,0===ha&&e(Ac));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="TRIM":(E=a,a=A)):(E=a,a=A);return a}function xa(){var a,c,d;a=E;b.substr(E,8).toLowerCase()===kd?(c=b.substr(E,8),E+=8):(c=A,0===ha&&e($c));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="INTERVAL":(E=a,a=A)):(E=a,a=A);return a}function ia(){var a,c,d;a=E;b.substr(E,4).toLowerCase()===pb?(c=b.substr(E,4),E+=4):(c=A,0===ha&&e(ad));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="YEAR":
(E=a,a=A)):(E=a,a=A);return a}function na(){var a,c,d;a=E;b.substr(E,5).toLowerCase()===qb?(c=b.substr(E,5),E+=5):(c=A,0===ha&&e(ld));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="MONTH":(E=a,a=A)):(E=a,a=A);return a}function wa(){var a,c,d;a=E;b.substr(E,3).toLowerCase()===cb?(c=b.substr(E,3),E+=3):(c=A,0===ha&&e(md));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="DAY":(E=a,a=A)):(E=a,a=A);return a}function Ca(){var a,c,d;a=E;b.substr(E,4).toLowerCase()===nd?(c=b.substr(E,
4),E+=4):(c=A,0===ha&&e(od));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="HOUR":(E=a,a=A)):(E=a,a=A);return a}function ua(){var a,c,d;a=E;b.substr(E,6).toLowerCase()===Gc?(c=b.substr(E,6),E+=6):(c=A,0===ha&&e(pd));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="MINUTE":(E=a,a=A)):(E=a,a=A);return a}function ya(){var a,c,d;a=E;b.substr(E,6).toLowerCase()===Mc?(c=b.substr(E,6),E+=6):(c=A,0===ha&&e(qd));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="SECOND":
(E=a,a=A)):(E=a,a=A);return a}function G(){var a,c,d;a=E;b.substr(E,4).toLowerCase()===Hc?(c=b.substr(E,4),E+=4):(c=A,0===ha&&e(rd));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="CASE":(E=a,a=A)):(E=a,a=A);return a}function Ea(){var a,c,d;a=E;b.substr(E,3).toLowerCase()===fc?(c=b.substr(E,3),E+=3):(c=A,0===ha&&e(gc));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="END":(E=a,a=A)):(E=a,a=A);return a}function za(){var a,c,d;a=E;b.substr(E,4).toLowerCase()===Vc?(c=b.substr(E,
4),E+=4):(c=A,0===ha&&e(bd));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="WHEN":(E=a,a=A)):(E=a,a=A);return a}function H(){var a,c,d;a=E;b.substr(E,4).toLowerCase()===hc?(c=b.substr(E,4),E+=4):(c=A,0===ha&&e(mb));c!==A?(c=E,ha++,d=C(),ha--,d===A?c=void 0:(E=c,c=A),c!==A?a="THEN":(E=a,a=A)):(E=a,a=A);return a}function qa(){var a;44===b.charCodeAt(E)?(a=Bc,E++):(a=A,0===ha&&e(ic));return a}function sa(){var a;40===b.charCodeAt(E)?(a=tc,E++):(a=A,0===ha&&e(uc));return a}function W(){var a;
41===b.charCodeAt(E)?(a=Nc,E++):(a=A,0===ha&&e(Xa));return a}function ga(){var a,b;a=[];for(b=Pa();b!==A;)a.push(b),b=Pa();return a}function Pa(){var a;jc.test(b.charAt(E))?(a=b.charAt(E),E++):(a=A,0===ha&&e(nc));return a}function Ra(a,b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function Ta(a,b){for(var c=0;c<b.length;c++)a=Ra(b[c][1],a,b[c][3]);return a}l=void 0!==l?l:{};var A={},pa={start:d},Ga=d,hb="!",Ba=k("!",!1),db="\x3d",Ua=k("\x3d",!1),Da="\x3e\x3d",
Ya=k("\x3e\x3d",!1),ta="\x3e",Qa=k("\x3e",!1),aa="\x3c\x3d",Fa=k("\x3c\x3d",!1),Ha="\x3c\x3e",Ka=k("\x3c\x3e",!1),ra="\x3c",Aa=k("\x3c",!1),ja="!\x3d",rb=k("!\x3d",!1),Nb="+",gb=k("+",!1),ab="-",vb=k("-",!1),Za="*",$a=k("*",!1),xb="/",Ob=k("/",!1),nb=/^[A-Za-z_\x80-\uFFFF]/,Fb=h([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),mc=/^[A-Za-z0-9_]/,Ab=h([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Rb=/^[A-Za-z0-9_.\x80-\uFFFF]/,lb=h([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),
jb="@",Sb=k("@",!1),Hb=function(a){return{type:"interval-period",period:a.value,precision:null,secondary:null}},Bb=function(a,b){return{type:"interval-period",period:"second",precision:a,secondary:b}},$b="'",Ib=k("'",!1),ub="N'",Qb=k("N'",!1),Jb="''",Kb=k("''",!1),ac=/^[^']/,O=h(["'"],!0,!1),Ia=".",wb=k(".",!1),Wa=/^[0-9]/,Ub=h([["0","9"]],!1,!1),ma=/^[eE]/,Lb=h(["e","E"],!1,!1),Mb=/^[+\-]/,Tb=h(["+","-"],!1,!1),ed="null",Wc=k("NULL",!0),Cc="true",wd=k("TRUE",!0),kc="false",Oc=k("FALSE",!0),Jc="in",
Kc=k("IN",!0),xc="is",bc=k("IS",!0),Cb="like",cc=k("LIKE",!0),Xb="escape",vc=k("ESCAPE",!0),yc="not",Lc=k("NOT",!0),zc="and",dc=k("AND",!0),Ec="or",ec=k("OR",!0),Vb="between",Fc=k("BETWEEN",!0),Tc="from",Uc=k("FROM",!0),id="for",yd=k("FOR",!0),hd="substring",Eb=k("SUBSTRING",!0),Yb="extract",lc=k("EXTRACT",!0),Wb="trim",Ac=k("TRIM",!0),jd="position",zd=k("POSITION",!0),gd="timestamp",Ic=k("TIMESTAMP",!0),fd="date",xd=k("DATE",!0),rc="leading",ba=k("LEADING",!0),Na="trailing",bb=k("TRAILING",!0),Ma=
"both",La=k("BOTH",!0),Va="to",Zb=k("TO",!0),kd="interval",$c=k("INTERVAL",!0),pb="year",ad=k("YEAR",!0),qb="month",ld=k("MONTH",!0),cb="day",md=k("DAY",!0),nd="hour",od=k("HOUR",!0),Gc="minute",pd=k("MINUTE",!0),Mc="second",qd=k("SECOND",!0),Hc="case",rd=k("CASE",!0),fc="end",gc=k("END",!0),Vc="when",bd=k("WHEN",!0),hc="then",mb=k("THEN",!0),wc="else",sc=k("ELSE",!0),Bc=",",ic=k(",",!1),tc="(",uc=k("(",!1),Nc=")",Xa=k(")",!1),jc=/^[ \t\n\r]/,nc=h([" ","\t","\n","\r"],!1,!1),Xc="`",Pc=k("`",!1),Yc=
/^[^`]/,Qc=h(["`"],!0,!1),E=0,fb=[{line:1,column:1}],kb=0,Pb=[],ha=0,Db;if("startRule"in l){if(!(l.startRule in pa))throw Error("Can't start parsing from rule \""+l.startRule+'".');Ga=pa[l.startRule]}Db=Ga();if(Db!==A&&E===b.length)return Db;Db!==A&&E<b.length&&e({type:"end"});throw function(a,b,c){return new n(n.buildMessage(a,b),a,b,c)}(Pb,kb<b.length?b.charAt(kb):null,kb<b.length?g(kb,kb+1):g(kb,kb));}}})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(n,b,l,k,h,a,g,e,d){function f(a,b){var d;if(!b)return null;if("x"in b){var e={x:0,y:0};a=a(b.x,b.y,r);e.x=a[0];e.y=a[1];null!=b.z&&(e.z=b.z);null!=b.m&&(e.m=b.m);return e}if("xmin"in b)return e={xmin:0,ymin:0,xmax:0,ymax:0},d=a(b.xmin,b.ymin,r),e.xmin=d[0],e.ymin=d[1],a=a(b.xmax,b.ymax,r),e.xmax=a[0],e.ymax=a[1],b.hasZ&&(e.zmin=b.zmin,e.zmax=b.zmax,e.hasZ=!0),b.hasM&&(e.mmin=b.mmin,e.mmax=b.mmax,e.hasM=!0),e;if("rings"in b)return{rings:c(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:c(b.paths,
a),hasM:b.hasM,hasZ:b.hasZ};if("points"in b)return{points:q(b.points,a),hasM:b.hasM,hasZ:b.hasZ}}function c(a,b){for(var c=[],d=0;d<a.length;d++)c.push(q(a[d],b));return c}function q(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=b(e[0],e[1],[0,0]);c.push(f);2<e.length&&f.push(e[2]);3<e.length&&f.push(e[3])}return c}function p(a,b){return!e.isValid(a)||!e.isValid(b)||e.equals(a,b)||d.canProject(a,b)?!1:!0}Object.defineProperty(b,"__esModule",{value:!0});var r=[0,0];b.checkProjectionSupport=function(a,
b){return k(this,void 0,void 0,function(){var c,d,e;return l(this,function(f){if(!b)return[2];if(Array.isArray(a)){c=0;for(d=a;c<d.length;c++)if(e=d[c],p(e.geometry&&e.geometry.spatialReference,b)){if(g.isSupported())return[2,g.load()];throw new h("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:b});}return[2]}if(!p(a,b))return[2];if(g.isSupported())return[2,g.load()];throw new h("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,
outSpatialReference:b});})})};var t=f.bind(null,d.lngLatToXY),x=f.bind(null,d.xyToLngLat);b.project=function(a,b,c){c||(c=b,b=a.spatialReference);return e.isValid(b)&&e.isValid(c)&&!e.equals(b,c)?d.canProject(b,c)?e.isWebMercator(c)?t(a):x(a):g.projectMany([a],b,c,null,!0)[0]:a};var w=new (function(){function b(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}b.prototype.push=function(b,c,d){return k(this,void 0,void 0,function(){var f,g=this;return l(this,function(h){b&&b.length&&
c&&d&&!e.equals(c,d)||a.resolve(b);f={geometries:b,inSpatialReference:c,outSpatialReference:d,resolve:null};this._jobs.push(f);return[2,a.create(function(a){f.resolve=a;null===g._timer&&(g._timer=setTimeout(g._process,10))},function(){var a=g._jobs.indexOf(f);-1<a&&g._jobs.splice(a,1)})]})})};b.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var b=a.geometries,c=a.inSpatialReference,f=a.outSpatialReference,a=a.resolve;d.canProject(c,f)?e.isWebMercator(f)?a(b.map(t)):
a(b.map(x)):a(g.projectMany(b,c,f,null,!0));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return b}());b.projectMany=function(a,b,c){return k(this,void 0,void 0,function(){return l(this,function(d){return[2,w.push(a,b,c)]})})}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),function(n,b,l,k,h,a){function g(b,f,g,k,l){void 0===k&&(k=null);void 0===l&&(l=!1);if(null===k){var n=
a.cacheKey(f,g);void 0!==c[n]?k=c[n]:(k=e(f,g,null),null===k&&(k=new a),c[n]=k)}return d._project(b,f,g instanceof h||!1===l?g:new h(g),k,l)}function e(b,c,e){void 0===e&&(e=null);b=d._getTransformation(b,c,e);return null!==b?a.fromGE(b):null}Object.defineProperty(b,"__esModule",{value:!0});var d=null;b.isLoaded=function(){return!!d&&k.isLoaded()};b.isSupported=function(){return k.isSupported()};var f=null;b.load=function(){return f?f:f=l.create(function(a,b){var c=k.load();n(["./geometryEngine"],
function(e){d=e;c.then(function(){d._enableProjection(k);a()},function(a){b(a)})})})};b.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:g(a,a[0].spatialReference,b,c):g([a],a.spatialReference,b,c)[0]};var c={};b.projectMany=g;b.getTransformation=e;b.getTransformations=function(b,c,e){void 0===e&&(e=null);b=d._getTransformationBySuitability(b,c,e);if(null!==b){c=[];for(e=0;e<b.length;e++)c.push(a.fromGE(b[e]));return c}return[]}})},"esri/geometry/pe":function(){define(["require",
"exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(n,b,l,k,h){function a(a){function c(a,b,c){a[b]=c(a[b])}b._pe=a;q.init();p.init();r.init();t.init();x.init();b.PeGCSExtent=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}l(c,a);c.prototype.destroy=function(){b._pe.destroy(this)};return c}(b._pe.PeGCSExtent);for(var d=0,e=[b._pe.PeDatum,b._pe.PeGeogcs,b._pe.PeGeogtran,b._pe.PeObject,b._pe.PeParameter,b._pe.PePrimem,b._pe.PeProjcs,b._pe.PeSpheroid,
b._pe.PeUnit];d<e.length;d++)a=e[d],c(a.prototype,"getName",function(a){return function(){return a.call(this,Array(q.PE_NAME_MAX))}});d=0;for(e=[b._pe.PeGeogtran,b._pe.PeProjcs];d<e.length;d++)a=e[d],c(a.prototype,"getParameters",function(a){return function(){for(var c=Array(q.PE_PARM_MAX),d=a.call(this),e=0;e<c.length;e++){var f=b._pe.getValue(d,"*");c[e]=f?b._pe.wrapPointer(f,b._pe.PeParameter):null;d+=Int32Array.BYTES_PER_ELEMENT}return c}});c(b._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=
this.getSize();if(!b)return null;var c=[],d=a.call(this);f(c,b,d);return c}});c(b._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(a){var c=b._pe._pe_getPeGTlistExtendedGTsSize();return function(){var d=null,e=a.call(this);if(!b._pe.compare(e,b._pe.NULL)){var d=[e],f=this.getSteps();if(1<f)for(var e=b._pe.getPointer(e),g=1;g<f;g++)d.push(b._pe.wrapPointer(e+c*g,b._pe.PeGTlistExtendedGTs))}return d}});var g=b._pe._pe_getPeHorizonSize();a=function(a){return function(){var c=this._cache;c||
(this._cache=c=new Map);if(c.has(a))return c.get(a);var d=null,e=a.call(this);if(!b._pe.compare(e,b._pe.NULL)){var d=[e],f=e.getNump();if(1<f)for(var e=b._pe.getPointer(e),h=1;h<f;h++)d.push(b._pe.wrapPointer(e+g*h,b._pe.PeHorizon))}c.set(a,d);return d}};c(b._pe.PeProjcs.prototype,"horizonGcsGenerate",a);c(b._pe.PeProjcs.prototype,"horizonPcsGenerate",a);b._pe.PeObject.prototype.toString=function(a){void 0===a&&(a=q.PE_STR_OPTS_NONE);b._pe.ensureCache.prepare();var c=b._pe.getPointer(this),d=b._pe.ensureInt8(Array(q.PE_BUFFER_MAX));
return b._pe.UTF8ToString(b._pe._pe_object_to_string_ext(c,a,d))}}function g(a){if(a){var c=b._pe.getClass(a);c&&(c=b._pe.getCache(c))&&(a=b._pe.getPointer(a))&&delete c[a]}}function e(a,c){var d=[];c=Array(c);for(var e=0;e<a;e++)d.push(b._pe.ensureInt8(c));return d}function d(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):b=a;return b}function f(a,c,d,e){void 0===e&&(e=!1);if(e)for(e=0;e<2*c;e++)a[e]=b._pe.getValue(d+e*Float64Array.BYTES_PER_ELEMENT,"double");else{var f=
0===a.length;for(e=0;e<c;e++)f&&(a[e]=Array(2)),a[e][0]=b._pe.getValue(d,"double"),a[e][1]=b._pe.getValue(d+Float64Array.BYTES_PER_ELEMENT,"double"),d+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(b,"__esModule",{value:!0});var c;b._pe=null;b.isLoaded=function(){return!!b._pe};b.isSupported=function(){return!!k("esri-wasm")};b.load=function(){return c?c:c=h.create(function(b,c){n(["./support/pe-wasm"],function(d){d({locateFile:function(a){return n.toUrl("./support/"+a)},onAbort:function(a){c(Error(a))}}).then(function(c){a(c);
b()})})})};(function(a){function c(a,c,e){b._pe.ensureCache.prepare();var g=d(e),h=e===g,g=b._pe.ensureFloat64(g);(a=b._pe._pe_geog_to_proj(b._pe.getPointer(a),c,g))&&f(e,c,g,h);return a}function e(a,b,c){return g(a,b,c,0)}function g(a,c,e,g){b._pe.ensureCache.prepare();var h=d(e),k=e===h,h=b._pe.ensureFloat64(h);(a=b._pe._pe_proj_to_geog_center(b._pe.getPointer(a),c,h,g))&&f(e,c,h,k);return a}a.geogToProj=c;a.projGeog=function(a,b,d,f){switch(f){case q.PE_TRANSFORM_P_TO_G:return e(a,b,d);case q.PE_TRANSFORM_G_TO_P:return c(a,
b,d)}return 0};a.projToGeog=e;a.projToGeogCenter=g})(b.PeCSTransformations||(b.PeCSTransformations={}));var q;(function(a){a.init=function(){a.PE_BUFFER_MAX=b._pe.PeDefs.prototype.PE_BUFFER_MAX;a.PE_NAME_MAX=b._pe.PeDefs.prototype.PE_NAME_MAX;a.PE_MGRS_MAX=b._pe.PeDefs.prototype.PE_MGRS_MAX;a.PE_USNG_MAX=b._pe.PeDefs.prototype.PE_USNG_MAX;a.PE_DD_MAX=b._pe.PeDefs.prototype.PE_DD_MAX;a.PE_DDM_MAX=b._pe.PeDefs.prototype.PE_DDM_MAX;a.PE_DMS_MAX=b._pe.PeDefs.prototype.PE_DMS_MAX;a.PE_UTM_MAX=b._pe.PeDefs.prototype.PE_UTM_MAX;
a.PE_PARM_MAX=b._pe.PeDefs.prototype.PE_PARM_MAX;a.PE_TYPE_NONE=b._pe.PeDefs.prototype.PE_TYPE_NONE;a.PE_TYPE_GEOGCS=b._pe.PeDefs.prototype.PE_TYPE_GEOGCS;a.PE_TYPE_PROJCS=b._pe.PeDefs.prototype.PE_TYPE_PROJCS;a.PE_TYPE_GEOGTRAN=b._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;a.PE_TYPE_COORDSYS=b._pe.PeDefs.prototype.PE_TYPE_COORDSYS;a.PE_TYPE_UNIT=b._pe.PeDefs.prototype.PE_TYPE_UNIT;a.PE_STR_OPTS_NONE=b._pe.PeDefs.prototype.PE_STR_OPTS_NONE;a.PE_STR_AUTH_NONE=b._pe.PeDefs.prototype.PE_STR_AUTH_NONE;a.PE_STR_AUTH_TOP=
b._pe.PeDefs.prototype.PE_STR_AUTH_TOP;a.PE_STR_NAME_CANON=b._pe.PeDefs.prototype.PE_STR_NAME_CANON;a.PE_PARM_X0=b._pe.PeDefs.prototype.PE_PARM_X0;a.PE_PARM_ND=b._pe.PeDefs.prototype.PE_PARM_ND;a.PE_TRANSFORM_1_TO_2=b._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;a.PE_TRANSFORM_2_TO_1=b._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;a.PE_TRANSFORM_P_TO_G=b._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;a.PE_TRANSFORM_G_TO_P=b._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;a.PE_HORIZON_RECT=b._pe.PeDefs.prototype.PE_HORIZON_RECT;
a.PE_HORIZON_POLY=b._pe.PeDefs.prototype.PE_HORIZON_POLY;a.PE_HORIZON_LINE=b._pe.PeDefs.prototype.PE_HORIZON_LINE;a.PE_HORIZON_DELTA=b._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(q=b.PeDefs||(b.PeDefs={}));(function(a){function c(a,c){var f=null,g=e[a];g||(g={},e[a]=g);g.hasOwnProperty(String(c))?f=g[c]:(a=b._pe.PeFactory.prototype.factoryByType(a,c),b._pe.compare(a,b._pe.NULL)||(f=a,g[c]=f));return f=d(f)}function d(a){if(a){var c=a.getType();switch(c){case q.PE_TYPE_GEOGCS:a=b._pe.castObject(a,b._pe.PeGeogcs);
break;case q.PE_TYPE_PROJCS:a=b._pe.castObject(a,b._pe.PeProjcs);break;case q.PE_TYPE_GEOGTRAN:a=b._pe.castObject(a,b._pe.PeGeogtran);break;default:c&q.PE_TYPE_UNIT&&(a=b._pe.castObject(a,b._pe.PeUnit))}}return a}var e={},f={};a.initialize=function(){b._pe.PeFactory.prototype.initialize(null)};a.coordsys=function(a){return c(q.PE_TYPE_COORDSYS,a)};a.factoryByType=c;a.fromString=function(a,c){var e=null,g=f[a];g||(g={},f[a]=g);g.hasOwnProperty(c)?e=g[c]:(a=b._pe.PeFactory.prototype.fromString(a,c),
b._pe.compare(a,b._pe.NULL)||(e=a,g[c]=e));return e=d(e)};a.geogcs=function(a){return c(q.PE_TYPE_GEOGCS,a)};a.geogtran=function(a){return c(q.PE_TYPE_GEOGTRAN,a)};a.getCode=function(a){return b._pe.PeFactory.prototype.getCode(a)};a.projcs=function(a){return c(q.PE_TYPE_PROJCS,a)};a.unit=function(a){return c(q.PE_TYPE_UNIT,a)}})(b.PeFactory||(b.PeFactory={}));b.PeGCSExtent=null;var p;(function(a){var c;a.init=function(){a.PE_GTLIST_OPTS_COMMON=b._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;
c=b._pe._pe_getPeGTlistExtendedEntrySize()};a.getGTlist=function(a,d,e,f,g,h){var k=null,l=new b._pe.PeInteger(h);try{var m=b._pe.PeGTlistExtended.prototype.getGTlist(a,d,e,f,g,l);if(h=l.val)if(k=[m],1<h){var n=b._pe.getPointer(m);for(a=1;a<h;a++)k.push(b._pe.wrapPointer(n+c*a,b._pe.PeGTlistExtendedEntry))}}finally{b._pe.destroy(l)}return k}})(p=b.PeGTlistExtended||(b.PeGTlistExtended={}));(function(a){a.destroy=function(a){if(a&&a.length){for(var c=0;c<a.length;c++){var d=a[c];g(d);d.getEntries().forEach(function(a){g(a);
a=a.getGeogtran();g(a);a.getParameters().forEach(g);[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){g(a);var b=a.getDatum();g(b);g(b.getSpheroid());g(a.getPrimem());g(a.getUnit())})})}b._pe.PeGTlistExtendedEntry.prototype.Delete(a[0])}}})(b.PeGTlistExtendedEntry||(b.PeGTlistExtendedEntry={}));(function(a){a.geogToGeog=function(a,c,e,g,h){b._pe.ensureCache.prepare();var k=d(e),l=e===k,k=b._pe.ensureFloat64(k),m=0;g&&(m=b._pe.ensureFloat64(g));(a=b._pe._pe_geog_to_geog(b._pe.getPointer(a),c,k,m,
h))&&f(e,c,k,l);return a}})(b.PeGTTransformations||(b.PeGTTransformations={}));(function(a){function c(a,c,f,g,h,k){b._pe.ensureCache.prepare();var l,m;switch(a){case "dd":l=b._pe._pe_geog_to_dd;m=q.PE_DD_MAX;break;case "ddm":l=b._pe._pe_geog_to_ddm;m=q.PE_DDM_MAX;break;case "dms":l=b._pe._pe_geog_to_dms,m=q.PE_DMS_MAX}a=0;c&&(a=b._pe.getPointer(c));c=d(g);c=b._pe.ensureFloat64(c);m=e(f,m);g=b._pe.ensureInt32(m);if(h=l(a,f,c,h,g))for(l=0;l<f;l++)k[l]=b._pe.UTF8ToString(m[l]);return h}function g(a,
c,d,e,g){b._pe.ensureCache.prepare();var h;switch(a){case "dd":h=b._pe._pe_dd_to_geog;break;case "ddm":h=b._pe._pe_ddm_to_geog;break;case "dms":h=b._pe._pe_dms_to_geog}a=0;c&&(a=b._pe.getPointer(c));c=e.map(function(a){return b._pe.ensureString(a)});e=b._pe.ensureInt32(c);c=b._pe.ensureFloat64(Array(2*d));(h=h(a,d,e,c))&&f(g,d,c);return h}a.geog_to_dms=function(a,b,d,e,f){return c("dms",a,b,d,e,f)};a.dms_to_geog=function(a,b,c,d){return g("dms",a,b,c,d)};a.geog_to_ddm=function(a,b,d,e,f){return c("ddm",
a,b,d,e,f)};a.ddm_to_geog=function(a,b,c,d){return g("ddm",a,b,c,d)};a.geog_to_dd=function(a,b,d,e,f){return c("dd",a,b,d,e,f)};a.dd_to_geog=function(a,b,c,d){return g("dd",a,b,c,d)}})(b.PeNotationDms||(b.PeNotationDms={}));var r;(function(a){a.init=function(){a.PE_MGRS_STYLE_NEW=b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;a.PE_MGRS_STYLE_OLD=b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;a.PE_MGRS_STYLE_AUTO=b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;a.PE_MGRS_180_ZONE_1_PLUS=b._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;
a.PE_MGRS_ADD_SPACES=b._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};a.geog_to_mgrs_extended=function(a,c,f,g,h,k,l){b._pe.ensureCache.prepare();var m=0;a&&(m=b._pe.getPointer(a));a=d(f);f=b._pe.ensureFloat64(a);a=e(c,q.PE_MGRS_MAX);var n=b._pe.ensureInt32(a);if(g=b._pe._pe_geog_to_mgrs_extended(m,c,f,g,h,k,n))for(h=0;h<c;h++)l[h]=b._pe.UTF8ToString(a[h]);return g};a.mgrs_to_geog_extended=function(a,c,d,e,g){b._pe.ensureCache.prepare();var h=0;a&&(h=b._pe.getPointer(a));a=d.map(function(a){return b._pe.ensureString(a)});
d=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*c));(e=b._pe._pe_mgrs_to_geog_extended(h,c,d,e,a))&&f(g,c,a);return e}})(r=b.PeNotationMgrs||(b.PeNotationMgrs={}));(function(a){a.geog_to_usng=function(a,c,f,g,h,k,l){b._pe.ensureCache.prepare();var m=0;a&&(m=b._pe.getPointer(a));a=d(f);f=b._pe.ensureFloat64(a);a=e(c,q.PE_MGRS_MAX);var n=b._pe.ensureInt32(a);if(g=b._pe._pe_geog_to_usng(m,c,f,g,h,k,n))for(h=0;h<c;h++)l[h]=b._pe.UTF8ToString(a[h]);return g};a.usng_to_geog=function(a,c,d,e){b._pe.ensureCache.prepare();
var g=0;a&&(g=b._pe.getPointer(a));a=d.map(function(a){return b._pe.ensureString(a)});d=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*c));(g=b._pe._pe_usng_to_geog(g,c,d,a))&&f(e,c,a);return g}})(b.PeNotationUsng||(b.PeNotationUsng={}));var t;(function(a){a.init=function(){a.PE_UTM_OPTS_NONE=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;a.PE_UTM_OPTS_ADD_SPACES=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;a.PE_UTM_OPTS_NS=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};a.geog_to_utm=function(a,
c,f,g,h){b._pe.ensureCache.prepare();var k=0;a&&(k=b._pe.getPointer(a));a=d(f);f=b._pe.ensureFloat64(a);a=e(c,q.PE_UTM_MAX);var l=b._pe.ensureInt32(a);if(g=b._pe._pe_geog_to_utm(k,c,f,g,l))for(k=0;k<c;k++)h[k]=b._pe.UTF8ToString(a[k]);return g};a.utm_to_geog=function(a,c,d,e,g){b._pe.ensureCache.prepare();var h=0;a&&(h=b._pe.getPointer(a));a=d.map(function(a){return b._pe.ensureString(a)});d=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*c));(e=b._pe._pe_utm_to_geog(h,c,d,e,a))&&f(g,c,a);return e}})(t=
b.PeNotationUtm||(b.PeNotationUtm={}));var x;(function(a){var c=new Map;a.init=function(){a.PE_PCSINFO_OPTION_NONE=b._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;a.PE_PCSINFO_OPTION_DOMAIN=b._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;a.PE_POLE_OUTSIDE_BOUNDARY=b._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;a.PE_POLE_POINT=b._pe.PePCSInfo.prototype.PE_POLE_POINT};a.generate=function(d,e){void 0===e&&(e=a.PE_PCSINFO_OPTION_DOMAIN);var f,g;c.has(d)&&(g=c.get(d),g[e]&&(f=g[e]));f||(f=b._pe.PePCSInfo.prototype.generate(d,
e),g||(g=[],c.set(d,g)),g[e]=f);return f}})(x=b.PePCSInfo||(b.PePCSInfo={}));(function(a){a.version_string=function(){return b._pe.PeVersion.prototype.version_string()}})(b.PeVersion||(b.PeVersion={}));b._init=a})},"esri/geometry/support/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(n,b,l){return function(){function b(b){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(b&&b.steps){var a=0;for(b=b.steps;a<
b.length;a++){var g=b[a];g instanceof l?this.steps.push(g):this.steps.push(new l({wkid:g.wkid,wkt:g.wkt,isInverse:g.isInverse}))}}}b.cacheKey=function(b,a){return[void 0!==b.wkid&&null!==b.wkid?b.wkid.toString():"-1",void 0!==b.wkt&&null!==b.wkt?b.wkt.toString():"",void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():""].join()};b.fromGE=function(h){var a=new b,g="",e=0;for(h=h.steps;e<h.length;e++){var d=l.fromGE(h[e]);a.steps.push(d);g+=d.uid.toString()+
","}a._cached_projection={};a._gtlistentry=null;a._chain=g;return a};b.prototype.getInverse=function(){var h=new b;h.steps=[];for(var a=this.steps.length-1;0<=a;a--)h.steps.push(this.steps[a].getInverse());return h};b.prototype.getGTListEntry=function(){for(var b="",a=0,g=this.steps;a<g.length;a++)b+=g[a].uid.toString()+",";b!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=b);return this._gtlistentry};b.prototype.assignCachedGe=function(h,a,g){this._cached_projection[b.cacheKey(h,
a)]=g};b.prototype.getCachedGeTransformation=function(h,a){for(var g="",e=0,d=this.steps;e<d.length;e++)g+=d[e].uid.toString()+",";g!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=g);h=this._cached_projection[b.cacheKey(h,a)];return void 0===h?null:h};return b}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(n,b){var l=0;return function(){function b(b){void 0===b&&(b=null);this.uid=l++;b?(this._wkt=void 0!==
b.wkt?b.wkt:null,this._wkid=void 0!==b.wkid?b.wkid:-1,this._isInverse=void 0!==b.isInverse?!0===b.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}b.fromGE=function(h){var a=new b;a._wkt=h.wkt;a._wkid=h.wkid;a._isInverse=h.isInverse;return a};Object.defineProperty(b.prototype,"wkt",{get:function(){return this._wkt},set:function(b){this._wkt=b;this.uid=l++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"wkid",{get:function(){return this._wkid},set:function(b){this._wkid=
b;this.uid=l++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isInverse",{get:function(){return this._isInverse},set:function(b){this._isInverse=b;this.uid=l++},enumerable:!0,configurable:!0});b.prototype.getInverse=function(){var h=new b;h._wkt=this.wkt;h._wkid=this._wkid;h._isInverse=!this.isInverse;return h};return b}()})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});
b.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,
supportsDisjointSpatialRelationship:!0}})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/iteratorUtils ../../../core/maybe ../../../core/promiseUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,c){this.items=a;this.queryGeometry=b;this.definitionExpression=c.definitionExpression;this.geometryType=c.geometryType;this.hasM=c.hasM;this.hasZ=c.hasZ;this.objectIdField=c.objectIdField;this.spatialReference=c.spatialReference;this.fieldsIndex=c.fieldsIndex;this.timeInfo=c.timeInfo;this.featureAdapter=c.featureAdapter}Object.defineProperty(b.prototype,"size",{get:function(){return this.items.length},
enumerable:!0,configurable:!0});b.prototype.createQueryResponse=function(a){var b;b=a.outStatistics?a.outStatistics.some(function(a){return"exceedslimit"===a.statisticType})?this._createExceedsLimitQueryResponse(a):this._createStatisticsQueryResponse(a):this._createFeatureQueryResponse(a);a.returnQueryGeometry&&(f.isValid(a.outSR)&&!f.equals(this.queryGeometry.spatialReference,a.outSR)?b.queryGeometry=x.cleanFromGeometryEngine(l({spatialReference:a.outSR},r.project(this.queryGeometry,this.queryGeometry.spatialReference,
a.outSR))):b.queryGeometry=x.cleanFromGeometryEngine(l({spatialReference:a.outSR},this.queryGeometry)));return b};b.prototype.executeAttributesQuery=function(a){var c=p.getWhereClause(a.where,this.fieldsIndex);if(!c)return e.resolve(this);if(c.isStandardized){for(var d=0,f=[],g=0,h=this.items;g<h.length;g++){var k=h[g];c.testFeature(k,this.featureAdapter)&&(f[d++]=k)}c=new b(f,this.queryGeometry,this);c.definitionExpression=a.where;return e.resolve(c)}return e.reject(new TypeError("Where clause is not standardized"))};
b.prototype.executeObjectIdsQuery=function(c){if(!c.objectIds||!c.objectIds.length)return e.resolve(this);var d=a.SetFromValues(c.objectIds),f=this.featureAdapter.getObjectId;return e.resolve(new b(this.items.filter(function(a){return d.has(f(a))}),this.queryGeometry,this))};b.prototype.executeTimeQuery=function(a){a=t.getTimeOperator(this.timeInfo,a.timeExtent,this.featureAdapter);if(!g.isSome(a))return e.resolve(this);a=this.items.filter(a);return e.resolve(new b(a,this.queryGeometry,this))};b.prototype.project=
function(a){return h(this,void 0,void 0,function(){var d,e,g,h=this;return k(this,function(k){switch(k.label){case 0:if(!a||f.equals(this.spatialReference,a))return[2,this];d=this.featureAdapter;return[4,r.projectMany(this.items.map(function(a){return x.getGeometry(h,d.getGeometry(a))}),this.spatialReference,a)];case 1:return e=k.sent(),g=e.map(function(a,b){return d.cloneWithGeometry(h.items[b],c.convertFromGeometry(a,h.hasZ,h.hasM))}),[2,new b(g,this.queryGeometry,{definitionExpression:this.definitionExpression,
geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:a,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}})})};b.prototype._createFeatureQueryResponse=function(a){var b=this,c=this.items,e=this.geometryType,f=this.hasM,g=this.hasZ,h=this.objectIdField,k=this.spatialReference,l=a.outFields,n=a.outSR,p=a.quantizationParameters,q=a.resultRecordCount,r=a.resultOffset,t=!1;null!=q&&null!=r&&(q=r+q,t=c.length>
q,c=c.slice(r,Math.min(c.length,q)));return{exceededTransferLimit:t,features:this._createFeatures(a,c),fields:l&&l.map(function(a){return b.fieldsIndex.get(a)}),geometryType:e,hasM:f,hasZ:g,objectIdFieldName:h,spatialReference:x.cleanFromGeometryEngine(n?n:k),transform:p&&d.toQuantizationTransform(p)||null}};b.prototype._createFeatures=function(a,b){var c=new q.default(a,this.featureAdapter,this.fieldsIndex),e=a.quantizationParameters,f=a.returnGeometry,g=a.returnCentroid,h=a.maxAllowableOffset,k=
a.orderByFields;a=[];var l=0;if(b.length&&k&&k.length){var k=k[0].split(" "),n=k[0],p=this.fieldsIndex.get(n),r="DESC"===k[1];b.sort(function(a,b){a=c.getFieldValue(a,n,p);b=c.getFieldValue(b,n,p);if("number"===typeof a&&"number"===typeof b)return r?b-a:a-b;if("string"===typeof a&&"string"===typeof b)return a=a.toUpperCase(),b=b.toUpperCase(),(r?a>b:a<b)?-1:(r?a<b:a>b)?1:0})}if(f||g)if(e=d.toQuantizationTransform(e),f&&!g)for(g=0;g<b.length;g++)f=b[g],a[l++]={attributes:c.getAttributes(f),geometry:x.getGeometry(this,
this.featureAdapter.getGeometry(f),h,e)};else if(!f&&g)for(h=0;h<b.length;h++)f=b[h],a[l++]={attributes:c.getAttributes(f),centroid:x.transformCentroid(this,this.featureAdapter.getCentroid(f,this),e)};else for(g=0;g<b.length;g++)f=b[g],a[l++]={attributes:c.getAttributes(f),centroid:x.transformCentroid(this,this.featureAdapter.getCentroid(f,this),e),geometry:x.getGeometry(this,this.featureAdapter.getGeometry(f),h,e)};else for(h=0;h<b.length;h++)f=b[h],(f=c.getAttributes(f))&&(a[l++]={attributes:f});
return a};b.prototype._createExceedsLimitQueryResponse=function(a){var b=!1,c=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,e=0;for(a=a.outStatistics;e<a.length;e++){var f=a[e];if("exceedslimit"===f.statisticType){c=null!=f.maxPointCount?f.maxPointCount:Number.POSITIVE_INFINITY;d=null!=f.maxRecordCount?f.maxRecordCount:Number.POSITIVE_INFINITY;b=null!=f.maxVertexCount?f.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)b=this.items.length>
c;else if(this.items.length>d)b=!0;else var c=this.hasZ?this.hasM?4:3:this.hasM?3:2,g=this.featureAdapter,b=this.items.reduce(function(a,b){b=g.getGeometry(b);return a+(b&&b.coords.length||0)},0)/c>b;return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(b)}}]}};b.prototype._createStatisticsQueryResponse=function(a){var b=new q.default(a,this.featureAdapter,this.fieldsIndex),
c=a.outStatistics,d=[],e=[],f=a.groupByFieldsForStatistics;a=a.having;for(var g=f&&f.length,f=g&&f[0],h=this.fieldsIndex.get(f),k=!h,l={},n={},p={},r={attributes:{}},t=0;t<c.length;t++){var u=c[t],x=u.outStatisticFieldName,w=u.statisticType,u="exceedslimit"!==w?u.onStatisticField:void 0,T=this.fieldsIndex.get(u),U=g&&(u===f||k)&&"count"===w;if(g){l[u]||(l[u]=this._calculateUniqueValues(b,f,h));var Y=l[u],X;for(X in Y){var P=Y[X],V=P.count,Z=P.data,ca=P.items;if(!a||b.validateItems(ca,a)){var P=n[Z]||
{attributes:{}},da=null;U?da=V:(V=this._calculateStatistics(ca,b,u,T),ca="var"===w?"variance":w,da=V[ca]);P.attributes[x]=da;P.attributes[k?"EXPR_1":f]=Z;n[Z]=P}}}else p[u]||(p[u]=this._calculateStatistics(this.items,b,u,T)),V=p[u],ca="var"===w?"variance":w,r.attributes[x]=V[ca];e.push({name:x,alias:x,type:"esriFieldTypeDouble"})}if(g)for(var F in n)d.push(n[F]);else d.push(r);return{fields:e,features:d}};b.prototype._calculateStatistics=function(a,b,c,d){for(var e=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,
g=null,h=null,k=null,l=null,m=[],n=0,p=0;p<a.length;p++){var q=b.getFieldValue(a[p],c,d);"string"===typeof q?n++:null==q||isNaN(q)||(g+=q,e=Math.min(e,q),f=Math.max(f,q),m.push(q),n++)}if(n){h=g/n;for(b=a=0;b<m.length;b++)q=m[b],a+=Math.pow(q-h,2);l=1<n?a/(n-1):0;k=Math.sqrt(l)}else f=e=null;return{avg:h,count:n,max:f,min:e,stddev:k,sum:g,variance:l}};b.prototype._calculateUniqueValues=function(a,b,c){for(var d={},e=0,f=this.items;e<f.length;e++){var g=f[e],h=a.getFieldValue(g,b,c);if(null==h||"string"===
typeof h&&""===h.trim())h=null;null==d[h]?d[h]={count:1,data:h,items:[g]}:(d[h].count++,d[h].items.push(g))}return d};return b}();b.default=n})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["require","exports","../../../core/maybe","./attributeSupport"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,e){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=a.returnDistinctValues;this.fieldsIndex=e;
this.featureAdapter=b;if((a=a.outFields)&&-1===a.indexOf("*")){this.outFields=a;for(var d=b=0;d<a.length;d++){var f=a[d],c=k.getExpressionFromFieldName(f),g=this.fieldsIndex.get(c),c=g?null:k.getWhereClause(c,e),g=g?g.name:k.getAliasFromFieldName(f)||"FIELD_EXP_"+b++;this._fieldDataCache.set(f,{alias:g,clause:c})}}}b.prototype.getAttributes=function(a){a=this._processAttributesForOutFields(a);return this._processAttributesForDistinctValues(a)};b.prototype.getFieldValue=function(a,b,e){var d=e?e.name:
b,f=null;this._fieldDataCache.has(d)?f=this._fieldDataCache.get(d).clause:e||(f=k.getWhereClause(b,this.fieldsIndex),this._fieldDataCache.set(d,{alias:d,clause:f}));return e?this.featureAdapter.getAttribute(a,d):f.calculateValue(a,this.featureAdapter)};b.prototype.validateItem=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:k.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testFeature(a,this.featureAdapter)};b.prototype.validateItems=
function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:k.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testSet(a,this.featureAdapter)};b.prototype._processAttributesForOutFields=function(a){var b=this.outFields;if(!b||!b.length)return this.featureAdapter.getAttributes(a);for(var e={},d=0;d<b.length;d++){var f=this._fieldDataCache.get(b[d]),c=f.alias,f=f.clause;e[c]=f?f.calculateValue(a,this.featureAdapter):this.featureAdapter.getAttribute(a,
c)}return e};b.prototype._processAttributesForDistinctValues=function(a){if(l.isNone(a)||!this.returnDistinctValues)return a;var b=this.outFields,e=[];if(b)for(var d=0;d<b.length;d++){var f=this._fieldDataCache.get(b[d]).alias;e.push(a[f])}else for(f in a)e.push(a[f]);b=(b||["*"]).join(",")+"\x3d"+e.join(",");e=this._returnDistinctMap.get(b)||0;this._returnDistinctMap.set(b,++e);return 1<e?null:a};return b}();b.default=n})},"esri/layers/graphics/data/timeSupport":function(){define(["require","exports"],
function(n,b){function l(b,a,g,e,d){if(null!=e&&null!=d&&e===d)return function(d){return e>=b.getAttribute(d,a)&&e<=b.getAttribute(d,g)};if(null!=e&&null!=d)return function(f){var c=b.getAttribute(f,a);f=b.getAttribute(f,g);return!(c>d||f<e)};if(null!=e)return function(a){return!(b.getAttribute(a,g)<e)};if(null!=d)return function(e){return!(b.getAttribute(e,a)>d)}}function k(b,a,g,e){if(null!=g&&null!=e&&g===e)return function(d){return b.getAttribute(d,a)===g};if(null!=g&&null!=e)return function(d){return b.getAttribute(d,
a)>=g&&b.getAttribute(d,a)<=e};if(null!=g)return function(d){return b.getAttribute(d,a)>=g};if(null!=e)return function(d){return b.getAttribute(d,a)<=e}}Object.defineProperty(b,"__esModule",{value:!0});b.getTimeExtent=function(b,a){if(!b)return null;var g=a.featureAdapter,e=b.startTimeField,d=b.endTimeField,f=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(e&&d)a.forEach(function(a){var b=g.getAttribute(a,e);a=g.getAttribute(a,d);null==b||isNaN(b)||(f=Math.min(f,b));null==a||isNaN(a)||(c=Math.max(c,
a))});else{var h=e||d;a.forEach(function(a){a=g.getAttribute(a,h);null==a||isNaN(a)||(f=Math.min(f,a),c=Math.max(c,a))})}return{start:f,end:c}};b.getTimeOperator=function(b,a,g){if(!a||!b)return null;var e=b.startTimeField;b=b.endTimeField;if(!e&&!b)return null;var d=a.start;a=a.end;return null==d&&null==a?null:e&&b?l(g,e,b,d,a):k(g,e||b,d,a)}})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/jsonMap ../../../core/maybe ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w){function u(a,b,c){c&&(b=r.quantizeOptimizedGeometry(B,b,a.hasZ,a.hasM,"esriGeometryPoint",c));return r.convertToPoint(b,a.hasZ,a.hasM)}function y(e,g,h){return k(this,void 0,void 0,function(){var k,n,p,q,r,v;return l(this,function(l){switch(l.label){case 0:if(!e)return[2,null];k=e.where;e.where=k=k&&k.trim();if(!k||/^1 *= *1$/.test(k)||g&&g===k)e.where=null;return e.geometry?[4,m(e)]:[2,e];case 1:return n=l.sent(),e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===
e.spatialRel&&(p=e.geometry.spatialReference,n=d.getGeometryExtent(n),n.spatialReference=p),e.geometry=n,[4,x.checkProjectionSupport(n.spatialReference,h)];case 2:return l.sent(),[4,c.normalizeCentralMeridian(f.fromJSON(n))];case 3:q=l.sent()[0];if(a.isNone(q))throw b.QUERY_ENGINE_EMPTY_RESULT;r=q.toJSON();return[4,x.project(r,r.spatialReference,h)];case 4:v=l.sent();if(!v)throw b.QUERY_ENGINE_EMPTY_RESULT;v.spatialReference=h;e.geometry=v;return[2,e]}})})}function m(a){return k(this,void 0,void 0,
function(){var b,c,d,f,h,k,m,n,p,r;return l(this,function(l){switch(l.label){case 0:b=a.geometry;c=a.distance;d=a.units;if(null==c)return[2,g.resolve(b)];f=b.spatialReference;h=d&&v.fromJSON(d)||e.getUnitString(f);k=f&&(q.isGeographic(f)||q.isWebMercator(f));if(!k)return[3,1];n=b;return[3,3];case 1:return[4,x.checkProjectionSupport(f,q.WGS84).then(function(){return x.project(b,q.WGS84)})];case 2:n=l.sent(),l.label=3;case 3:return m=n,[4,w.getGeodesicBufferOperator()];case 4:return p=l.sent(),r=p(m,
c,h),[2,r?r.toJSON():null]}})})}Object.defineProperty(b,"__esModule",{value:!0});var v=new h.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});b.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var z=new t.default,B=new t.default,C={esriGeometryPoint:r.convertToPoint,esriGeometryPolyline:r.convertToPolyline,esriGeometryPolygon:r.convertToPolygon,
esriGeometryMultipoint:r.convertToMultipoint};b.transformCentroid=u;b.getCentroid=function(a,b,c){if("esriGeometryPolygon"!==a.geometryType||!b||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=p.getCentroidOptimizedGeometry(new t.default,b.geometry,a.hasZ,a.hasM));return u(a,b.centroid,c)};b.getGeometry=function(a,b,c,d){b=b?"coords"in b?b:b.geometry:null;return b?c?(c=r.generalizeOptimizedGeometry(z,b,a.hasZ,a.hasM,a.geometryType,c),d&&(c=r.quantizeOptimizedGeometry(B,c,a.hasZ,a.hasM,
a.geometryType,d)),C[a.geometryType](c,a.hasZ,a.hasM)):d?(c=r.quantizeOptimizedGeometry(B,b,a.hasZ,a.hasM,a.geometryType,d),C[a.geometryType](c,a.hasZ,a.hasM)):C[a.geometryType](b,a.hasZ,a.hasM):null};b.normalizeQuery=function(a,b,c){return k(this,void 0,void 0,function(){var d,e,f,g,h;return l(this,function(k){d=a.outFields;e=a.orderByFields;f=a.groupByFieldsForStatistics;g=a.outStatistics;if(d)for(h=0;h<d.length;h++)d[h]=d[h].trim();if(e)for(h=0;h<e.length;h++)e[h]=e[h].trim();if(f)for(h=0;h<f.length;h++)f[h]=
f[h].trim();if(g)for(h=0;h<g.length;h++)g[h].onStatisticField&&(g[h].onStatisticField=g[h].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,y(a,b,c)]})})};b.normalizeFilter=function(a,b,c){return k(this,void 0,void 0,function(){return l(this,function(d){return[2,y(a,b,c)]})})};b.normalizeQueryLike=y;b.cleanFromGeometryEngine=function(a){return a&&D in a?JSON.parse(JSON.stringify(a,K)):a};var D="_geVersion",K=function(a,b){return a!==D?b:void 0}})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){function x(){return a.create(function(a){return n(["../../../geometry/geometryEngine"],a)})}Object.defineProperty(b,"__esModule",{value:!0});var w={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",
esriSpatialRelRelation:null},u={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},y={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},m={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,
esriGeometryPolygon:!0,esriGeometryEnvelope:!1};b.importGeometryEngine=x;b.getGeodesicBufferOperator=function(){return x().then(function(a){return a.geodesicBuffer})};b.getSpatialQueryOperator=function(b,f,h){if(d.isPolygon(f)&&"esriGeometryPoint"===h.geometryType&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b)){var k=q.convertFromPolygon(new p.default,f,!1,!1);return a.resolve(function(a){return c.polygonContainsPoint(k,!1,!1,a)})}if(d.isPolygon(f)&&"esriGeometryMultipoint"===h.geometryType){var l=
q.convertFromPolygon(new p.default,f,!1,!1);if("esriSpatialRelContains"===b)return a.resolve(function(a){return c.polygonContainsMultipoint(l,!1,!1,a,h.hasZ,h.hasM)})}if(d.isExtent(f)&&"esriGeometryPoint"===h.geometryType&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b))return a.resolve(function(a){return g.extentContainsPoint(f,t.getGeometry(h,a))});if(d.isExtent(f)&&"esriGeometryMultipoint"===h.geometryType&&"esriSpatialRelContains"===b)return a.resolve(function(a){return g.extentContainsMultipoint(f,
t.getGeometry(h,a))});if(d.isExtent(f)&&"esriSpatialRelIntersects"===b){var m=e.getExtentIntersector(h.geometryType);return a.resolve(function(a){return m(f,t.getGeometry(h,a))})}return x().then(function(a){var c=a[w[b]].bind(null,f);return function(a){return c(t.getGeometry(h,a))}})};b.checkSpatialQuerySupport=function(a,b,c){return k(this,void 0,void 0,function(){var e,g;return l(this,function(k){e=a.spatialRel;g=a.geometry;if(!g)return[2];if(!0!==u[e])throw new h("feature-store:unsupported-query",
"Unsupported query spatial relationship",{query:a});if(!f.isValid(g.spatialReference)||!f.isValid(c))return[2];if(!0!==y[d.getJsonType(g)])throw new h("feature-store:unsupported-query","Unsupported query geometry type",{query:a});if(!0!==m[b])throw new h("feature-store:unsupported-query","Unsupported layer geometry type",{query:a});return a.outSR?[2,r.checkProjectionSupport(a.geometry&&a.geometry.spatialReference,a.outSR)]:[2]})})};b.canQueryWithRBush=function(a){if(d.isExtent(a))return!0;if(d.isPolygon(a)){var b=
0;for(a=a.rings;b<a.length;b++){var c=a[b];if(5!==c.length||c[0][0]!==c[1][0]||c[0][0]!==c[4][0]||c[2][0]!==c[3][0]||c[0][1]!==c[3][1]||c[0][1]!==c[4][1]||c[1][1]!==c[2][1])return!1}return!0}return!1}})},"esri/layers/graphics/contains":function(){define(["require","exports"],function(n,b){function l(b,h,a,g,e){if(!b)return!1;h=h?a?4:3:a?3:2;a=b.coords;var d=!1,f=0,c=0;for(b=b.lengths;c<b.length;c++){for(var k=b[c],l=f,n=f,t=f+k*h;n<t;n+=h){l=n+h;l===t&&(l=f);var x=a[n],w=a[n+1],u=a[l],l=a[l+1];(w<
e&&l>=e||l<e&&w>=e)&&x+(e-w)/(l-w)*(u-x)<g&&(d=!d)}f+=k*h}return d}Object.defineProperty(b,"__esModule",{value:!0});b.polygonContainsPoint=function(b,h,a,g){return l(b,h,a,g.coords[0],g.coords[1])};b.polygonContainsMultipoint=function(b,h,a,g,e,d){e=e?d?4:3:d?3:2;d=g.coords;g=g.lengths;if(!g)return!1;for(var f=0,c=0;f<g.length;f++,c+=e)if(!l(b,h,a,d[c],d[c+1]))return!1;return!0};b.polygonContainsCoords=l})},"esri/layers/support/PromiseQueue":function(){define(["require","exports","../../core/promiseUtils"],
function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._deferreds=[];this._values=[]}b.prototype.push=function(b){var a=this;return l.create(function(g,e){a._deferreds.push({resolve:g,reject:e});a._values.push(b)})};b.prototype.unshift=function(b){var a=this;return l.create(function(g,e){a._deferreds.unshift({resolve:g,reject:e});a._values.unshift(b)})};Object.defineProperty(b.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,
configurable:!0});b.prototype.process=function(){if(0===this.length)return!1;this._deferreds.shift().resolve(this._values.shift());return!0};b.prototype.cancelAll=function(){for(var b=l.createAbortError(),a=0,g=this._deferreds;a<g.length;a++)g[a].reject(b);this._deferreds.length=0;this._values.length=0};return b}();b.PromiseQueue=n})},"esri/views/layers/support/FeatureFilter":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../TimeExtent ../../../core/iteratorUtils ../../../core/jsonMap ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../geometry/support/jsonUtils ../../../tasks/support/Query".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){var t=new d.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),x=new d.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(b){function d(a){a=b.call(this,a)||this;a.where=null;a.geometry=null;a.spatialRelationship="intersects";a.hiddenIds=new Set;a.distance=void 0;a.objectIds=null;a.units=null;a.timeExtent=null;a.enabled=!1;return a}k(d,b);f=d;d.prototype.writeWhere=function(a,b,c){b.where=a||"1\x3d1"};d.prototype.enable=function(){this._set("enabled",!0)};d.prototype.createQuery=
function(a){void 0===a&&(a={});var b=this.where,d=this.spatialRelationship,e=this.timeExtent,f=this.objectIds,g=this.units,k=this.distance;return new r(h({geometry:c.clone(this.geometry),objectIds:c.clone(f),spatialRelationship:d,timeExtent:c.clone(e),where:b,units:g,distance:k},a))};d.prototype.clone=function(){var a=this.where,b=this.geometry,d=this.spatialRelationship,e=this.hiddenIds,g=this.timeExtent,h=this.objectIds,k=this.units,l=this.distance,n=new Set;e.forEach(function(a){return n.add(a)});
return new f({geometry:c.clone(b),hiddenIds:n,objectIds:c.clone(h),spatialRelationship:d,timeExtent:c.clone(g),where:a,units:k,distance:l})};var f;l([q.property({type:String})],d.prototype,"where",void 0);l([q.writer("where")],d.prototype,"writeWhere",null);l([q.property({types:a.geometryTypes,json:{read:p.fromJSON,write:!0}})],d.prototype,"geometry",void 0);l([q.property({type:String,json:{read:{source:"spatialRel",reader:t.read},write:{target:"spatialRel",writer:t.write}}})],d.prototype,"spatialRelationship",
void 0);l([q.property({json:{write:function(a,b,c){return b[c]=e.valuesOfSet(a)},read:function(a,b){return e.SetFromValues(a)}}})],d.prototype,"hiddenIds",void 0);l([q.property({type:Number,json:{write:{overridePolicy:function(a){return{enabled:0<a}}}}})],d.prototype,"distance",void 0);l([q.property({type:[Number],json:{write:!0}})],d.prototype,"objectIds",void 0);l([q.property({type:String,json:{read:x.read,write:{writer:x.write,overridePolicy:function(a){return{enabled:a&&0<this.distance}}}}})],
d.prototype,"units",void 0);l([q.property({type:g,json:{write:!0}})],d.prototype,"timeExtent",void 0);l([q.property({readOnly:!0})],d.prototype,"enabled",void 0);return d=f=l([q.subclass("esri.views.layers.support.FeatureFilter")],d)}(q.declared(f.JSONSupport))})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../support/earthUtils ../../support/FrustumExtentIntersection ../../../support/index".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){var q=-.3*d.earthRadius;return function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c.suspended=!1;c.extent=null;c.extentIntersectionDirty=!0;c._isVisibleBelowSurface=!1;c.handles=new a;c.layerView=null;c.updating=!0;return c}l(d,b);d.prototype.setup=function(a){var b=this;this.layerView=a;this.extentIntersection=new f.FrustumExtentIntersection({renderCoordsHelper:a.view.renderCoordsHelper});a=a.view;var d=a.basemapTerrain,e=a.resourceController.scheduler;
this.handles.add([a.on("resize",function(){return b.viewChange()}),a.state.watch("camera",function(){return b.viewChange()},!0),e.registerTask(c.Task.FRUSTUM_VISIBILITY,function(){return b.update()},function(){return b.updating}),d.on("elevation-bounds-change",function(){return b.elevationBoundsChange()})]);"local"===a.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([g.init(d,["opacity","wireframe"],function(){return b.updateIsVisibleBelowSurface()}),g.init(a,"map.ground.navigationConstraint.type",
function(){return b.updateIsVisibleBelowSurface()})])};d.prototype.destroy=function(){this.extentIntersection=this.extent=this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};d.prototype._setDirty=function(){this.updating||this._set("updating",!0)};d.prototype.setExtent=function(a){this.extent=a;this.extentIntersectionDirty=!0;this._setDirty()};d.prototype.viewChange=function(){this._setDirty()};d.prototype.elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=
!0};Object.defineProperty(d.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this._setDirty();this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0});d.prototype.updateIsVisibleBelowSurface=function(){var a=this.layerView.view,b=a.basemapTerrain,c=a.map.ground&&a.map.ground.navigationConstraint&&"none"===a.map.ground.navigationConstraint.type;this.isVisibleBelowSurface="local"===a.viewingMode||!b.isOpaque()||c};d.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=
!1;var a=this.layerView.view,b;if(this._isVisibleBelowSurface)b=q;else{b=a.basemapTerrain.elevationBounds;var c=b.min;b=c-Math.max(1,(b.max-c)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,b)}};d.prototype.update=function(){this._set("updating",!1);this.extent?(this.updateExtentIntersection(),this._set("suspended",!this.extentIntersection.isVisibleInFrustum(this.layerView.view.frustum))):this._set("suspended",!1)};k([e.property({readOnly:!0})],d.prototype,"suspended",void 0);
k([e.property({readOnly:!0})],d.prototype,"updating",void 0);return d=k([e.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],d)}(e.declared(h))})},"esri/views/3d/layers/graphics/Graphics3DHighlights":function(){define(["require","exports","./Graphics3DHighlightSet"],function(n,b,l){return function(){function b(){this.graphicsCore=null;this.highlights=[]}b.prototype.destroy=function(){this.highlights.forEach(function(b){return b.highlightSet.removeAll()});this.highlights=null};
b.prototype.setup=function(b){this.graphicsCore=b};b.prototype.acquireSet=function(b,a){var g=this,e=new l(b,a);this.highlights.push(e);return{set:e,handle:{remove:function(){return g.releaseSet(e)},pause:function(){e.highlightSet.removeAll();e.paused=!0},resume:function(){e.paused=!1;g.initializeSet(e)}}}};b.prototype.releaseSet=function(b){b.highlightSet.removeAll();b=this.highlights?this.highlights.indexOf(b):-1;-1!==b&&this.highlights.splice(b,1)};b.prototype.setUids=function(b,a){for(var g=this.graphicsCore.graphics3DGraphics,
e=0;e<a.length;e++){var d=a[e];b.ids.add(d);(d=g.get(d))&&d.addHighlight(b.highlightSet,b.options)}};b.prototype.setObjectIds=function(b,a){a.forEach(function(a){return b.ids.add(a)});this.initializeSet(b)};b.prototype.addGraphic=function(b){this.highlights.forEach(function(a){!a.paused&&a.hasGraphic(b)&&b.addHighlight(a.highlightSet,a.options)})};b.prototype.removeGraphic=function(b){this.highlights.forEach(function(a){a.hasGraphic(b)&&b.removeHighlight(a.highlightSet)})};b.prototype.allGraphicsDeleted=
function(){this.highlights.forEach(function(b){return b.highlightSet.removeAll()})};b.prototype.initializeSet=function(b){var a=this.graphicsCore.graphics3DGraphics;b.objectIdField?a.forEach(function(a){a&&b.hasGraphic(a)&&a.addHighlight(b.highlightSet,b.options)}):b.ids.forEach(function(g){(g=a.get(g))&&g.addHighlight(b.highlightSet,b.options)})};return b}()})},"esri/views/3d/layers/graphics/Graphics3DHighlightSet":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(n,
b,l){return function(){function b(b,a){this.highlightSet=new l;this.ids=new Set;this.paused=!1;this.options=b;this.objectIdField=a}b.prototype.hasGraphic=function(b){return this.objectIdField?this.ids.has(b.graphic.attributes[this.objectIdField]):this.ids.has(b.graphic.uid)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightSet":function(){define(["require","exports"],function(n,b){return function(){function b(){this.items=[]}b.prototype.addObject=function(b,h){this.items.push({type:"object",
highlightId:h,object:b})};b.prototype.addRenderGeometry=function(b,h,a){this.items.push({type:"renderGeometry",highlightId:h,renderGeometry:b,owner:a})};b.prototype.addExternal=function(b,h){this.items.push({type:"external",highlightId:h,remove:b})};b.prototype.remove=function(b){for(var h=this.items.length-1;0<=h;--h){var a=this.items[h];a.highlightId===b&&(this.removeHighlight(a),this.items.splice(h,1))}};b.prototype.removeObject=function(b){for(var h=this.items.length-1;0<=h;--h){var a=this.items[h];
"object"===a.type&&a.object===b&&(this.removeHighlight(a),this.items.splice(h,1))}};b.prototype.removeRenderGeometry=function(b){for(var h=this.items.length-1;0<=h;--h){var a=this.items[h];"renderGeometry"===a.type&&a.renderGeometry===b&&(this.removeHighlight(a),this.items.splice(h,1))}};b.prototype.removeAll=function(){var b=this;this.items.forEach(function(h){b.removeHighlight(h)});this.items=[]};b.prototype.removeHighlight=function(b){switch(b.type){case "object":b.object.removeHighlights(b.highlightId);
break;case "renderGeometry":b.owner.removeRenderGeometryHighlight(b.renderGeometry,b.highlightId);break;case "external":b.remove(b.highlightId)}};return b}()})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../support/index ../../../support/layerViewUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f){return function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c._scaleRangeActive=!1;c.layerScaleRangeVisibilityQuery=!1;c.scaleChangeEventHandle=null;c.handles=new a;c.layerView=null;c.layer=null;c.queryGraphicUIDsInExtent=null;c.extent=null;c.graphicsCore=null;c.basemapTerrain=null;c.suspended=!1;c.updating=!0;return c}l(c,b);c.prototype.setup=function(a,b,c,e,f){var g=this;this.layerView=a;this.layer=b;this.queryGraphicUIDsInExtent=c;this.graphicsCore=
e;this.basemapTerrain=f;this.updateScaleRangeActive();this.handles.add(this.layerView.view.resourceController.scheduler.registerTask(d.Task.SCALE_VISIBILITY,function(){return g.update()},function(){return g.needsUpdate()}))};c.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);this.handles.destroy();this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=this.handles=null};c.prototype.needsUpdate=function(){return!(!this.layerView.view.basemapTerrain||
!this.updating)};c.prototype._setDirty=function(){this.updating||this._set("updating",!0)};c.prototype.setExtent=function(a){this.extent=a;this._setDirty()};c.prototype.scaleRangeActive=function(){return this._scaleRangeActive};c.prototype.updateScaleRangeActive=function(){var a=this,b=this.layer,c=0<b.minScale||0<b.maxScale;b.labelingInfo&&!c&&(c=b.labelingInfo.some(function(a){return a&&(0<a.minScale||0<a.maxScale)}));b=this._scaleRangeActive!==c;(this._scaleRangeActive=c)&&!this.scaleChangeEventHandle&&
this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",function(b){return a.scaleUpdateHandler(b)}):!c&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);return b};c.prototype.update=function(){var a=this,b=this.layerView.view.basemapTerrain;this.extent&&b&&b.ready&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,b.queryVisibleScaleRange(this.extent,this.layer.minScale,
this.layer.maxScale,function(b){return a.finishUpdate(b)})):this.finishUpdate(!0)};c.prototype.finishUpdate=function(a){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!a);this._set("updating",!1)};c.prototype.visibleAtLayerScale=function(a){return f.scaleBoundsPredicate(a,this.layer.minScale||0,this.layer.maxScale||0)};c.prototype.visibleAtLabelScale=function(a,b){return f.scaleBoundsPredicate(a,b.minScale||0,b.maxScale||0)};c.prototype.graphicScale=function(a){var b;g.isSome(a.centroid)?
b=a.centroid:g.isSome(a.graphic.geometry)&&"point"===a.graphic.geometry.type&&(b=a.graphic.geometry);return b?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(b):1:null};c.prototype.graphicVisible=function(a){a=this.graphicScale(a);return this.visibleAtLayerScale(a)};c.prototype.updateVisibility=function(a){if(this._scaleRangeActive){var b=this.graphicVisible(a);return a.setVisibilityFlag(1,b,0)}return!1};c.prototype.updateGraphicLabelScaleVisibility=function(a){if(!this._scaleRangeActive||
!a._labelGraphics||0===a._labelGraphics.length)return!1;var b=this.graphicScale(a);if(a=this.updateLabelScaleVisibility(a,b))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return a};c.prototype.updateLabelScaleVisibility=function(a,b){if(!a._labelGraphics||0===a._labelGraphics.length)return!1;var c=a._labelGraphics[0]._labelClass;return c&&null!=c.minScale&&null!=c.maxScale&&(b=this.visibleAtLabelScale(b,c),a.setVisibilityFlag(1,b,1))?!0:!1};c.prototype.scaleUpdateHandler=
function(a){var b=this;this._setDirty();if(!this.layerView.suspended){var c=a.extent,d=a.scale,e=this.visibleAtLayerScale(d),f=!1;this.queryGraphicUIDsInExtent(c,a.spatialReference,function(a){if(a=b.graphicsCore.getGraphics3DGraphicById(a)){var h=a.centroid;g.isSome(h)&&(c[0]>h.x||c[1]>h.y||c[2]<h.x||c[3]<h.y)||(a.setVisibilityFlag(1,e,0)&&(f=!0),b.updateLabelScaleVisibility(a,d)&&(f=!0))}});f&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}};c.prototype.layerMinMaxScaleChangeHandler=
function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(function(a){return a.clearVisibilityFlag(1)}):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};k([e.property({readOnly:!0})],c.prototype,"suspended",void 0);k([e.property({readOnly:!0})],c.prototype,"updating",void 0);return c=k([e.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],c)}(e.declared(h))})},"esri/views/3d/layers/support/attributeUtils":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.attributeLookup=function(b,k){k=k.toLowerCase();for(var h=0,a=Object.keys(b);h<a.length;h++){var g=a[h];if(g.toLowerCase()===k)return b[g]}return null}})},"esri/views/3d/layers/support/projectExtentUtils":function(){define("require exports ../../../../core/asyncUtils ../../../../core/promiseUtils ../../../../geometry/support/webMercatorUtils ../../../../portal/support/geometryServiceUtils".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,
"__esModule",{value:!0});b.toViewIfLocal=function(b){var e=b.view.spatialReference,d=b.layer.fullExtent,f=d&&d.spatialReference;return f?f.equals(e)?k.resolve(d.clone()):h.canProject(f,e)?k.resolve(h.project(d,e)):b.view.state.isLocal?l.safeCast(a.projectGeometry(d,e,b.layer.portalItem).then(function(a){return!b.destroyed&&a?a:void 0}).catch(function(){return null})):k.resolve(null):k.resolve(null)}})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define("require exports ../../../../core/maybe ../graphics/Graphics3DVerticalScale ./FeatureTileFetcher3D ./featureTileQuery3D".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._capabilities=this.memoryCache=null;var d=b.layerView.layer;this.layerView=b.layerView;this.objectIdField=d.objectIdField;this.returnZ=b.returnZ;this.returnM=b.returnM;this.verticalScale=new k({sourceSpatialReference:d.spatialReference,destSpatialReference:this.layerView.view.spatialReference});this.query=a.createFeatureTileQuery3D(d);b=this.layerView.view.resourceController;"hasService"in d&&d.hasService&&
b&&(this.memoryCache=b.memoryController.getMemCache(d.uid))}b.prototype.destroy=function(){l.isSome(this.memoryCache)&&this.memoryCache.destroy()};b.prototype.createQuery=function(){var a=this.layerView.layer.createQuery();a.outFields=this.layerView.availableFields;a.returnZ=this.returnZ;a.returnM=this.returnM;a.outSpatialReference=this.tilingScheme.spatialReference;return a};Object.defineProperty(b.prototype,"viewingMode",{get:function(){return this.layerView.view.viewingMode},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"tilingScheme",{get:function(){return this.layerView.view.featureTiles.tilingScheme},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"scheduler",{get:function(){var a=this.layerView.view.resourceController;return a?a.scheduler:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometryType",{get:function(){return this.layerView.layer.geometryType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullExtent",
{get:function(){return this.layerView.layer.fullExtent},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tileMaxRecordCount",{get:function(){var a=this.layerView.layer;return"tileMaxRecordCount"in a?a.tileMaxRecordCount:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxRecordCount",{get:function(){var a=this.layerView.layer;return"maxRecordCount"in a?a.maxRecordCount:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capabilities",
{get:function(){return l.isSome(this._capabilities)?this._capabilities:this._capabilities=h.contextCapabilitiesFromLayer(this.layerView.layer)},enumerable:!0,configurable:!0});b.prototype.logFetchError=function(a,b){a.error("#fetchTile()",this.layerView.layer,b&&b.message?b.message:b)};b.prototype.adjustVerticalScale=function(a){return this.verticalScale.adjust(a)};return b}();b.FeatureTileFetcher3DLayerViewContext=n})},"esri/views/3d/layers/graphics/Graphics3DVerticalScale":function(){define(["require",
"exports","../../../../core/maybe","../../../../core/unitUtils"],function(n,b,l,k){return function(){function b(a){this.sourceSpatialReference=a.sourceSpatialReference;this.destSpatialReference=a.destSpatialReference}b.prototype.adjust=function(a){var b=this._getVerticalUnitScale();1!==b&&this._scaleVerticalUnits(a,b)};b.prototype._getVerticalUnitScale=function(){if(this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)){var a=k.getMetersPerVerticalUnitForSR(this.sourceSpatialReference),
b=k.getMetersPerVerticalUnitForSR(this.destSpatialReference);return a/b}return 1};b.prototype._vertexListsScaleZ=function(a,b){for(var e=0;e<a.length;++e)for(var d=a[e],f=0;f<d.length;++f)d[f][2]*=b};b.prototype._scaleVerticalUnits=function(a,b){for(var e=0;e<a.length;++e){var d=a[e].geometry;!l.isNone(d)&&d.hasZ&&(this._geometryIsPoint(d)?null!==d.z&&(d.z*=b):this._geometryIsPolyline(d)?this._vertexListsScaleZ(d.paths,b):this._geometryIsPolygon(d)&&this._vertexListsScaleZ(d.rings,b))}};b.prototype._geometryIsPoint=
function(a){return"point"===a.type};b.prototype._geometryIsPolygon=function(a){return"polygon"===a.type};b.prototype._geometryIsPolyline=function(a){return"polyline"===a.type};return b}()})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/operations/query".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});var d=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);Object.defineProperty(c.prototype,"queryFeaturesDehydrated",{get:function(){var a=this,b=this.layer.capabilities;if((b=b&&b.query)&&b.supportsFormatPBF){var c={type:"dehydrated",applyTransform:!0,useWorker:!0,maxStringAttributeLength:1024};return function(b,d){return e.executeQueryPBF(a.layer.parsedUrl,b,c,d).then(function(a){return a.data})}}return function(b,
c){return e.executeQuery(a.layer.parsedUrl,b,c).then(function(a){return g.fromFeatureSetJSON(a.data)})}},enumerable:!0,configurable:!0});c.prototype.queryFeatureCount=function(a,b){return this.layer.queryFeatureCount(a,b)};k([a.property({constructOnly:!0})],c.prototype,"layer",void 0);k([a.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],c.prototype,"queryFeaturesDehydrated",null);return c=k([a.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],
c)}(a.declared(h)),f=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);c.prototype.queryFeaturesDehydrated=function(a,b){var c=this;return this.source.queryFeaturesJSON(a,b).then(g.fromFeatureSetJSON,function(d){if(d&&"query-features-json:unsupported"===d.name)return c.source.queryFeatures(a,b);throw d;})};c.prototype.queryFeatureCount=function(a,b){return this.layer.queryFeatureCount(a,b)};k([a.property({constructOnly:!0})],c.prototype,"layer",void 0);k([a.aliasOf("layer.source")],
c.prototype,"source",void 0);return c=k([a.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],c)}(a.declared(h));b.createFeatureTileQuery3D=function(a){switch(a.source.type){case "feature-layer":return new d({layer:a});case "memory":case "csv":case "geojson":return new f({layer:a});case "stream-layer":throw Error("Tile based queries unsupported for stream sources");}}})},"esri/views/3d/support/EventedSet":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"../../../core/Evented","../../../core/iteratorUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._set=new Set;return b}l(b,a);b.prototype.clear=function(){if(0<this._set.size){var a=this.toArray();this._set.clear();this.emit("after-changes",{type:2});this.emit("change",{added:[],removed:a})}};Object.defineProperty(b.prototype,"length",{get:function(){return this._set.size},enumerable:!0,configurable:!0});
b.prototype.addMany=function(a){if(0!==a.length){for(var b=0;b<a.length;b++)this._set.add(a[b]);this.emit("after-changes",{type:1});this.emit("change",{added:a,removed:[]})}};b.prototype.removeMany=function(a){for(var b=[],e=0;e<a.length;e++){var c=a[e];this._set.delete(c)&&b.push(c)}0<b.length&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:b}))};b.prototype.toArray=function(){return h.valuesOfSet(this._set)};b.prototype.find=function(a){var b;h.everySet(this._set,function(d){return a(d)?
(b=d,!1):!0});return b};b.prototype.forEach=function(a){this._set.forEach(function(b){return a(b)})};return b}(k);b.EventedSet=n})},"esri/views/layers/FeatureLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/iteratorUtils ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/support/fieldUtils ../../layers/support/timeUtils ../../support/arcadeOnDemand ../../tasks/support/Query ./support/FeatureEffect ./support/FeatureFilter ./support/popupUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v){Object.defineProperty(b,"__esModule",{value:!0});var z=f.getLogger("esri.views.layers.FeatureLayerView");b.FeatureLayerView=function(b){return function(b){function f(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a._updatingRequiredFieldsPromise=null;a.effect=null;a.filter=null;a.layer=null;a.requiredFields=null;a.view=null;return a}l(f,b);f.prototype.initialize=function(){var a=this;p.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo filter effect layer.timeInfo timeExtent".split(" "),
function(){return a._handleRequiredFieldsChange()},!0)};Object.defineProperty(f.prototype,"availableFields",{get:function(){var a=this.layer,b=this.layer.fields,c=this.requiredFields;return"outFields"in a&&a.outFields?t.fixFields(b,t.unpackFieldNames(b,a.outFields).concat(c)):t.fixFields(b,c)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(a){z.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!1},enumerable:!0,configurable:!0});f.prototype.highlight=function(a,b){void 0===b&&(b={});return this.inherited(arguments)};f.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},a=c.isSome(this.filter)?this.filter.createQuery(a):new u(a);this.timeExtent&&(a.timeExtent=a.timeExtent?a.timeExtent.intersection(this.timeExtent):
this.timeExtent.clone());return a};f.prototype.queryFeatures=function(a,b){return this.inherited(arguments)};f.prototype.queryObjectIds=function(a,b){return this.inherited(arguments)};f.prototype.queryFeatureCount=function(a,b){return this.inherited(arguments)};f.prototype.queryExtent=function(a,b){return this.inherited(arguments)};f.prototype._loadArcadeModules=function(a){if(a.get("expressionInfos.length"))return w.loadArcade()};f.prototype._handleRequiredFieldsChange=function(){var a=this,b=this._updateRequiredFields();
this._set("_updatingRequiredFieldsPromise",b);b.then(function(){a._updatingRequiredFieldsPromise===b&&a._set("_updatingRequiredFieldsPromise",null)})};f.prototype._updateRequiredFields=function(){return g(this,void 0,void 0,function(){var b,e,f,g,h,k,l,m,n,p,r,v,u;return a(this,function(a){switch(a.label){case 0:if(!this.layer||!this.view)return[2];b="3d"===this.view.type;e=this;g=f=e.layer;h=g.fields;k=g.objectIdField;l=g.renderer;m=new Set;return[4,q.eachAlways([l?l.collectRequiredFields(m,h):null,
t.collectLabelingFields(m,f),b?t.collectElevationFields(m,f):null,c.isSome(this.filter)?t.collectFilterFields(m,f,this.filter):null,this.effect?t.collectFilterFields(m,f,this.effect.filter):null])];case 1:n=a.sent();f.timeInfo&&this.timeExtent&&t.collectFields(m,f.fields,[f.timeInfo.startField,f.timeInfo.endField]);p=0;for(r=n;p<r.length;p++)v=r[p],v.error&&z.error(v.error);t.collectField(m,h,k);u=d.valuesOfSet(m).sort();this._set("requiredFields",u);return[2]}})})};f.prototype.validateFetchPopupFeatures=
function(a){var b=this.layer;if(!this.layer.popupEnabled)return new e("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:b});if(!v.getFetchPopupTemplate(this.layer,a))return new e("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:b})};f.prototype.fetchClientPopupFeatures=function(b){return g(this,void 0,void 0,function(){var d,e,f,g,h,k,l,m,n,p,r,u;return a(this,function(a){switch(a.label){case 0:d=c.isSome(b)?b.clientGraphics:null;if(!d||0===d.length)return[2,
q.resolve([])];e=[];f=[];g=this.layer;h=v.getFetchPopupTemplate(g,b);return c.isSome(h)?[4,this._loadArcadeModules(h)]:[2,q.resolve([])];case 1:return l=(k=a.sent())&&k.arcadeUtils.hasGeometryOperations(h),[4,this.createPopupQuery(b)];case 2:m=a.sent();n=t.unpackFieldNames(g.fields,m.outFields);p=0;for(r=d;p<r.length;p++)u=r[p],l||!t.featureHasFields(n,u)?f.push(u):e.push(u);if(0===f.length)return[2,q.resolve(e)];m.objectIds=f.map(function(a){return a.attributes[g.objectIdField]});return[2,g.queryFeatures(m).then(function(a){return e.concat(a.features)}).catch(function(){return f})]}})})};
f.prototype.createPopupQuery=function(b){return g(this,void 0,void 0,function(){var c,d,e;return a(this,function(a){switch(a.label){case 0:return c=this.layer,d=c.createQuery(),d.returnGeometry=!0,d.returnZ=!0,d.returnM=!0,e=d,[4,v.getRequiredFields(this.layer,v.getFetchPopupTemplate(this.layer,b))];case 1:return e.outFields=a.sent(),d.outSpatialReference=this.view.spatialReference,[2,d]}})})};k([r.property()],f.prototype,"_updatingRequiredFieldsPromise",void 0);k([r.property({readOnly:!0,dependsOn:["layer.outFields?",
"requiredFields"]})],f.prototype,"availableFields",null);k([r.property({type:y})],f.prototype,"effect",void 0);k([r.property({type:m})],f.prototype,"filter",void 0);k([r.property(x.combinedViewLayerTimeExtentProperty)],f.prototype,"timeExtent",void 0);k([r.property()],f.prototype,"layer",void 0);k([r.property({type:Number})],f.prototype,"maximumNumberOfFeatures",null);k([r.property({readOnly:!0,type:Boolean})],f.prototype,"maximumNumberOfFeaturesExceeded",null);k([r.property({readOnly:!0})],f.prototype,
"requiredFields",void 0);k([r.property()],f.prototype,"view",void 0);return f=k([r.subclass("esri.views.layers.FeatureLayerView")],f)}(r.declared(b))}})},"esri/views/layers/support/FeatureEffect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ./FeatureFilter ./ParsedFeatureEffect ./Transition".split(" "),function(n,b,l,
k,h,a,g,e,d,f,c){var q=a.getLogger("esri.views.layers.support.FeatureEffect");return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.filter=null;b.includedEffect=null;b.excludedEffect=null;b.excludedLabelsVisible=!1;return b}k(b,a);h=b;Object.defineProperty(b.prototype,"insideEffect",{get:function(){q.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");return this.includedEffect},set:function(a){q.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");
this.includedEffect=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"outsideEffect",{get:function(){q.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");return this.excludedEffect},set:function(a){q.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");this.excludedEffect=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"parsedIncludedEffect",{get:function(){return g.isSome(this.includedEffect)?
"string"===typeof this.includedEffect?f.fromString(this.includedEffect):new c({from:f.fromString(this.includedEffect.from),to:f.fromString(this.includedEffect.to),duration:this.includedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"parsedExcludedEffect",{get:function(){return g.isSome(this.excludedEffect)?"string"===typeof this.excludedEffect?f.fromString(this.excludedEffect):new c({from:f.fromString(this.excludedEffect.from),to:f.fromString(this.excludedEffect.to),
duration:this.excludedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderingHash",{get:function(){return this.excludedLabelsVisible+"-"+this.includedEffect+"-"+this.excludedEffect},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"done",{get:function(){return(!g.isSome(this.parsedIncludedEffect)||this.parsedIncludedEffect.done)&&(!g.isSome(this.parsedExcludedEffect)||this.parsedExcludedEffect.done)},enumerable:!0,configurable:!0});b.prototype.clone=
function(){return new h({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};var h;l([e.property({type:d,json:{write:!0}})],b.prototype,"filter",void 0);l([e.property({type:String,json:{write:!0}})],b.prototype,"includedEffect",void 0);l([e.property({type:String,json:{write:!0}})],b.prototype,"excludedEffect",void 0);l([e.property({type:Boolean,json:{write:!0}})],b.prototype,"excludedLabelsVisible",
void 0);l([e.property({dependsOn:["includedEffect"]})],b.prototype,"parsedIncludedEffect",null);l([e.property({dependsOn:["excludedEffect"]})],b.prototype,"parsedExcludedEffect",null);l([e.property({dependsOn:["includedEffect","excludedEffect"]})],b.prototype,"renderingHash",null);return b=h=l([e.subclass("esri.views.layers.support.FeatureEffect")],b)}(e.declared(h.JSONSupport))})},"esri/views/layers/support/ParsedFeatureEffect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f32 ./cssFilterParser".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){var r=e.getLogger("esri.views.layers.support.ParsedFeatureEffect"),t={grayscale:function(a){a=1-a.amount;a=q.mat4f32.fromValues(.2126+.7874*a,.7152-.7152*a,.0722-.0722*a,0,.2126-.2126*a,.7152+.2848*a,.0722-.0722*a,0,.2126-.2126*a,.7152-.7152*a,.0722+.9278*a,0,0,0,0,1);return c.mat4.transpose(a,a)},sepia:function(a){a=1-a.amount;a=q.mat4f32.fromValues(.393+.607*a,.769-.769*a,.189-.189*a,0,.349-.349*a,.686+.314*a,.168-.168*a,0,.272-.272*a,.534-.534*a,.131+.869*a,
0,0,0,0,1);return c.mat4.transpose(a,a)},saturate:function(a){a=a.amount;a=q.mat4f32.fromValues(.213+.787*a,.715-.715*a,.072-.072*a,0,.213-.213*a,.715+.285*a,.072-.072*a,0,.213-.213*a,.715-.715*a,.072+.928*a,0,0,0,0,1);return c.mat4.transpose(a,a)},"hue-rotate":function(a){var b=Math.sin(a.angle*Math.PI/180);a=Math.cos(a.angle*Math.PI/180);b=q.mat4f32.fromValues(.213+.787*a-.213*b,.715-.715*a-.715*b,.072-.072*a+.928*b,0,.213-.213*a+.143*b,.715+.285*a+.14*b,.072-.072*a-.283*b,0,.213-.213*a-.787*b,
.715-.715*a+.715*b,.072+.928*a+.072*b,0,0,0,0,1);return c.mat4.transpose(b,b)},invert:function(a){var b=1-2*a.amount;a=a.amount;b=q.mat4f32.fromValues(b,0,0,a,0,b,0,a,0,0,b,a,0,0,0,1);return c.mat4.transpose(b,b)},brightness:function(a){a=a.amount;a=q.mat4f32.fromValues(a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1);return c.mat4.transpose(a,a)},contrast:function(a){a=a.amount;a=q.mat4f32.fromValues(a,0,0,.5-.5*a,0,a,0,.5-.5*a,0,0,a,.5-.5*a,0,0,0,1);return c.mat4.transpose(a,a)}};return function(b){function e(){var a=
null!==b&&b.apply(this,arguments)||this;a.customTransforms=null;a.done=!0;return a}k(e,b);g=e;e.fromString=function(b){var c=[],d=null;try{for(var e=0,f=p.parse(b);e<f.length;e++){var h=f[e];"opacity"===h.type?d=h:c.push(h)}}catch(D){r.error(new a("invalid-type","Encountered an error when parsing css",D))}return new g({transforms:c,opacity:d})};e.prototype.getOpacity=function(){return d.isSome(this.opacity)?this.opacity.amount:1};e.prototype.getColorMatrix=function(){var a=this;return(this.transforms||
[]).map(function(a){return h({},a)}).reverse().reduce(function(b,d){return c.mat4.multiply(b,b,a._getFactory(d)(d))},q.mat4f32.create())};e.prototype.clone=function(){return new g({transforms:this.transforms&&this.transforms.map(function(a){return h({},a)}),customTransforms:this.customTransforms&&this.customTransforms.map(function(a){return h({},a)})})};e.prototype._getFactory=function(a){var b=t[a.type];if(!b){if(this.customTransforms)for(var b=function(b){if(b.type===a.type){b=q.mat4f32.fromValues.apply(q.mat4f32,
b.matrix);var d=c.mat4.transpose(b,b);return{value:function(a){return d}}}},d=0,e=this.customTransforms;d<e.length;d++){var f=b(e[d]);if("object"===typeof f)return f.value}r.error("invalid-type","No effect "+a.type+" exists");return function(a){return q.mat4f32.create()}}return b};var g;l([f.property()],e.prototype,"opacity",void 0);l([f.property()],e.prototype,"transforms",void 0);l([f.property()],e.prototype,"customTransforms",void 0);return e=g=l([f.subclass("esri.views.layers.support.ParsedFeatureEffect")],
e)}(f.declared(g.JSONSupport))})},"esri/views/layers/support/cssFilterParser":function(){define([],function(){function n(b,l,k,h){this.message=b;this.expected=l;this.found=k;this.location=h;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}(function(b,l){function k(){this.constructor=b}k.prototype=l.prototype;b.prototype=new k})(n,Error);n.buildMessage=function(b,l){function k(a){return a.charCodeAt(0).toString(16).toUpperCase()}function h(a){return a.replace(/\\/g,
"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+k(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+k(a)})}function a(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+k(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,
function(a){return"\\x"+k(a)})}var g={literal:function(a){return'"'+h(a.text)+'"'},"class":function(b){var d="",e;for(e=0;e<b.parts.length;e++)d+=b.parts[e]instanceof Array?a(b.parts[e][0])+"-"+a(b.parts[e][1]):a(b.parts[e]);return"["+(b.inverted?"^":"")+d+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),e;for(e=0;e<a.length;e++){var c=e,h;h=a[e];h=g[h.type](h);b[c]=h}b.sort();
if(0<b.length){for(a=e=1;e<b.length;e++)b[e-1]!==b[e]&&(b[a]=b[e],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(b)+" but "+(l?'"'+h(l)+'"':"end of input")+" found."};return{SyntaxError:n,parse:function(b,l){function k(a,b){return{type:"literal",text:a,ignoreCase:b}}function h(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function a(a){return{type:"other",description:a}}function g(a){var c=
wb[a],d;if(!c){for(d=a-1;!wb[d];)d--;c=wb[d];for(c={line:c.line,column:c.column};d<a;)10===b.charCodeAt(d)?(c.line++,c.column=1):c.column++,d++;wb[a]=c}return c}function e(a,b){var c=g(a),d=g(b);return{start:{offset:a,line:c.line,column:c.column},end:{offset:b,line:d.line,column:d.column}}}function d(a){O<Wa||(O>Wa&&(Wa=O,Ub=[]),Ub.push(a))}function f(){var a,e;ma++;a=O;e=y();e!==m?(b.substr(O,4)===C?(e=C,O+=4):(e=m,0===ma&&d(D)),e!==m?(e=y(),e!==m?(Ia=a,a=null):(O=a,a=m)):(O=a,a=m)):(O=a,a=m);ma--;
a===m&&(e=m,0===ma&&d(B));if(a===m)if(a=[],e=c(),e!==m)for(;e!==m;)a.push(e),e=c();else a=m;return a}function c(){var a,c,f,g,h,k,l,v,w;ma++;c=O;f=y();f!==m?(b.substr(O,5)===I?(g=I,O+=5):(g=m,0===ma&&d(Q)),g!==m?(h=y(),h!==m?(k=x(),k!==m?(l=y(),l!==m?(41===b.charCodeAt(O)?(v=J,O++):(v=m,0===ma&&d(N)),v!==m?(w=y(),w!==m?(Ia=c,c=f={type:"blur",radius:k}):(O=c,c=m)):(O=c,c=m)):(O=c,c=m)):(O=c,c=m)):(O=c,c=m)):(O=c,c=m)):(O=c,c=m);ma--;c===m&&(f=m,0===ma&&d(K));a=c;if(a===m){var z,B,C,A,D,G,H,Da;ma++;
z=O;B=y();B!==m?(b.substr(O,11)===M?(C=M,O+=11):(C=m,0===ma&&d(R)),C!==m?(A=y(),A!==m?(D=q(),D!==m?(G=y(),G!==m?(41===b.charCodeAt(O)?(H=J,O++):(H=m,0===ma&&d(N)),H!==m?(Da=y(),Da!==m?(Ia=z,z=B={type:"brightness",amount:D}):(O=z,z=m)):(O=z,z=m)):(O=z,z=m)):(O=z,z=m)):(O=z,z=m)):(O=z,z=m)):(O=z,z=m);ma--;z===m&&(B=m,0===ma&&d(L));a=z;if(a===m){var aa,Fa,Ha,ta,W,Ya,Ka,Qa;ma++;aa=O;Fa=y();Fa!==m?(b.substr(O,9)===T?(Ha=T,O+=9):(Ha=m,0===ma&&d(U)),Ha!==m?(ta=y(),ta!==m?(W=q(),W!==m?(Ya=y(),Ya!==m?(41===
b.charCodeAt(O)?(Ka=J,O++):(Ka=m,0===ma&&d(N)),Ka!==m?(Qa=y(),Qa!==m?(Ia=aa,aa=Fa={type:"contrast",amount:W}):(O=aa,aa=m)):(O=aa,aa=m)):(O=aa,aa=m)):(O=aa,aa=m)):(O=aa,aa=m)):(O=aa,aa=m)):(O=aa,aa=m);ma--;aa===m&&(Fa=m,0===ma&&d(S));a=aa;if(a===m){var ra,ja,Ua,qa,za,Aa,sa,Ea,Ba,Ta,rb,db,Nb,vb;ma++;ra=O;ja=y();if(ja!==m)if(b.substr(O,12)===X?(Ua=X,O+=12):(Ua=m,0===ma&&d(P)),Ua!==m)if(qa=y(),qa!==m)if(za=x(),za!==m)if(Aa=y(),Aa!==m)if(sa=x(),sa!==m)if(Ea=y(),Ea!==m)if(Ba=x(),Ba===m&&(Ba=null),Ba!==
m)if(Ta=y(),Ta!==m){var ba,Na,bb,Ma,La,Va,gb,ab,$a,pb,Wa,qb,Za,cb,nb,Bb,ub,Ib;ba=O;35===b.charCodeAt(O)?(Na=Fb,O++):(Na=m,0===ma&&d(mc));if(Na!==m)if(bb=O,Ma=u(),Ma!==m?(La=u(),La!==m?bb=Ma=[Ma,La]:(O=bb,bb=m)):(O=bb,bb=m),bb!==m)if(Ma=O,La=u(),La!==m?(Va=u(),Va!==m?Ma=La=[La,Va]:(O=Ma,Ma=m)):(O=Ma,Ma=m),Ma!==m)if(La=O,Va=u(),Va!==m?(gb=u(),gb!==m?La=Va=[Va,gb]:(O=La,La=m)):(O=La,La=m),La!==m){Ia=ba;var xb=Ma,Ob=La;ba=Na=[parseInt(bb.join(""),16),parseInt(xb.join(""),16),parseInt(Ob.join(""),16)]}else O=
ba,ba=m;else O=ba,ba=m;else O=ba,ba=m;else O=ba,ba=m;if(ba===m){ba=O;35===b.charCodeAt(O)?(Na=Fb,O++):(Na=m,0===ma&&d(mc));if(Na!==m)if(bb=u(),bb!==m)if(Ma=u(),Ma!==m)if(La=u(),La!==m){Ia=ba;var Qb=Ma,$b=La;ba=Na=[parseInt([bb,bb].join(""),16),parseInt([Qb,Qb].join(""),16),parseInt([$b,$b].join(""),16)]}else O=ba,ba=m;else O=ba,ba=m;else O=ba,ba=m;else O=ba,ba=m;if(ba===m&&(ba=O,b.substr(O,5)===Ab?(Na=Ab,O+=5):(Na=m,0===ma&&d(Rb)),Na!==m?(bb=y(),bb!==m?(Ma=r(),Ma!==m?(La=y(),La!==m?(44===b.charCodeAt(O)?
(Va=lb,O++):(Va=m,0===ma&&d(jb)),Va!==m?(gb=y(),gb!==m?(ab=r(),ab!==m?($a=y(),$a!==m?(44===b.charCodeAt(O)?(pb=lb,O++):(pb=m,0===ma&&d(jb)),pb!==m?(Wa=y(),Wa!==m?(qb=r(),qb!==m?(Za=y(),Za!==m?(44===b.charCodeAt(O)?(cb=lb,O++):(cb=m,0===ma&&d(jb)),cb!==m?(nb=y(),nb!==m?(Bb=q(),Bb!==m?(ub=y(),ub!==m?(41===b.charCodeAt(O)?(Ib=J,O++):(Ib=m,0===ma&&d(N)),Ib!==m?(Ia=ba,ba=Na=[255*Ma,255*ab,255*qb,Bb]):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):
(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m),ba===m&&(ba=O,b.substr(O,5)===Ab?(Na=Ab,O+=5):(Na=m,0===ma&&d(Rb)),Na!==m?(bb=y(),bb!==m?(Ma=p(),Ma!==m?(La=y(),La!==m?(44===b.charCodeAt(O)?(Va=lb,O++):(Va=m,0===ma&&d(jb)),Va!==m?(gb=y(),gb!==m?(ab=p(),ab!==m?($a=y(),$a!==m?(44===b.charCodeAt(O)?(pb=lb,O++):(pb=m,0===ma&&d(jb)),pb!==m?(Wa=y(),Wa!==m?(qb=p(),qb!==m?(44===b.charCodeAt(O)?(Za=lb,O++):(Za=m,0===ma&&d(jb)),Za!==m?(cb=y(),
cb!==m?(nb=q(),nb!==m?(41===b.charCodeAt(O)?(Bb=J,O++):(Bb=m,0===ma&&d(N)),Bb!==m?(Ia=ba,ba=Na=[Ma,ab,qb,nb]):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m),ba===m&&(ba=O,b.substr(O,5)===Ab?(Na=Ab,O+=5):(Na=m,0===ma&&d(Rb)),Na!==m?(bb=y(),bb!==m?(Ma=r(),Ma!==m?(La=y(),La!==m?(44===b.charCodeAt(O)?(Va=lb,O++):(Va=m,0===ma&&d(jb)),Va!==m?(gb=y(),gb!==m?(ab=
r(),ab!==m?($a=y(),$a!==m?(44===b.charCodeAt(O)?(pb=lb,O++):(pb=m,0===ma&&d(jb)),pb!==m?(Wa=y(),Wa!==m?(qb=r(),qb!==m?(Za=y(),Za!==m?(41===b.charCodeAt(O)?(cb=J,O++):(cb=m,0===ma&&d(N)),cb!==m?(Ia=ba,ba=Na=[255*Ma,255*ab,255*qb,1]):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m),ba===m&&(ba=O,b.substr(O,5)===Ab?(Na=Ab,O+=5):(Na=m,0===ma&&d(Rb)),Na!==m?(bb=y(),bb!==m?(Ma=p(),Ma!==
m?(La=y(),La!==m?(44===b.charCodeAt(O)?(Va=lb,O++):(Va=m,0===ma&&d(jb)),Va!==m?(gb=y(),gb!==m?(ab=p(),ab!==m?($a=y(),$a!==m?(44===b.charCodeAt(O)?(pb=lb,O++):(pb=m,0===ma&&d(jb)),pb!==m?(Wa=y(),Wa!==m?(qb=p(),qb!==m?(41===b.charCodeAt(O)?(Za=J,O++):(Za=m,0===ma&&d(N)),Za!==m?(Ia=ba,ba=Na=[Ma,ab,qb,1]):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m),ba===m&&(ba=O,b.substr(O,4)===Sb?(Na=Sb,O+=
4):(Na=m,0===ma&&d(Hb)),Na!==m?(bb=y(),bb!==m?(Ma=r(),Ma!==m?(La=y(),La!==m?(44===b.charCodeAt(O)?(Va=lb,O++):(Va=m,0===ma&&d(jb)),Va!==m?(gb=y(),gb!==m?(ab=r(),ab!==m?($a=y(),$a!==m?(44===b.charCodeAt(O)?(pb=lb,O++):(pb=m,0===ma&&d(jb)),pb!==m?(Wa=y(),Wa!==m?(qb=r(),qb!==m?(Za=y(),Za!==m?(41===b.charCodeAt(O)?(cb=J,O++):(cb=m,0===ma&&d(N)),cb!==m?(Ia=ba,ba=Na=[255*Ma,255*ab,255*qb,1]):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=
m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m),ba===m&&(ba=O,b.substr(O,4)===Sb?(Na=Sb,O+=4):(Na=m,0===ma&&d(Hb)),Na!==m?(bb=y(),bb!==m?(Ma=p(),Ma!==m?(La=y(),La!==m?(44===b.charCodeAt(O)?(Va=lb,O++):(Va=m,0===ma&&d(jb)),Va!==m?(gb=y(),gb!==m?(ab=p(),ab!==m?($a=y(),$a!==m?(44===b.charCodeAt(O)?(pb=lb,O++):(pb=m,0===ma&&d(jb)),pb!==m?(Wa=y(),Wa!==m?(qb=p(),qb!==m?(Za=y(),Za!==m?(41===b.charCodeAt(O)?(cb=J,O++):(cb=m,0===ma&&d(N)),cb!==m?(Ia=ba,ba=Na=[Ma,ab,qb,1]):(O=ba,ba=m)):(O=ba,ba=m)):
(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m)):(O=ba,ba=m),ba===m))))))){var wb,fc,gc;ma++;wb=O;fc=[];Kb.test(b.charAt(O))?(gc=b.charAt(O),O++):(gc=m,0===ma&&d(ac));if(gc!==m)for(;gc!==m;)fc.push(gc),Kb.test(b.charAt(O))?(gc=b.charAt(O),O++):(gc=m,0===ma&&d(ac));else fc=m;if(fc!==m){Ia=wb;var Lb=b.substring(Ia,O);if(!Tb.has(Lb)){var Ub='unknown color "'+Lb+'"',hc=void 0,hc=void 0!==hc?hc:e(Ia,O);throw new n(Ub,null,
null,hc);}fc=Mb[Lb].concat(1)}wb=fc;ma--;wb===m&&(fc=m,0===ma&&d(Jb));ba=wb}}rb=ba;rb===m&&(rb=null);rb!==m?(db=y(),db!==m?(41===b.charCodeAt(O)?(Nb=J,O++):(Nb=m,0===ma&&d(N)),Nb!==m?(vb=y(),vb!==m?(Ia=ra,ra=ja={type:"drop-shadow",offsetX:za,offsetY:sa,blurRadius:Ba,color:rb}):(O=ra,ra=m)):(O=ra,ra=m)):(O=ra,ra=m)):(O=ra,ra=m)}else O=ra,ra=m;else O=ra,ra=m;else O=ra,ra=m;else O=ra,ra=m;else O=ra,ra=m;else O=ra,ra=m;else O=ra,ra=m;else O=ra,ra=m;else O=ra,ra=m;ma--;ra===m&&(ja=m,0===ma&&d(Y));a=ra;
if(a===m){var mb,wc,sc,Bc,ic,tc,uc,Nc;ma++;mb=O;wc=y();wc!==m?(b.substr(O,10)===Z?(sc=Z,O+=10):(sc=m,0===ma&&d(ca)),sc!==m?(Bc=y(),Bc!==m?(ic=q(),ic!==m?(tc=y(),tc!==m?(41===b.charCodeAt(O)?(uc=J,O++):(uc=m,0===ma&&d(N)),uc!==m?(Nc=y(),Nc!==m?(Ia=mb,mb=wc={type:"grayscale",amount:ic}):(O=mb,mb=m)):(O=mb,mb=m)):(O=mb,mb=m)):(O=mb,mb=m)):(O=mb,mb=m)):(O=mb,mb=m)):(O=mb,mb=m);ma--;mb===m&&(wc=m,0===ma&&d(V));a=mb;if(a===m){var Xa,jc,nc,Xc,Pc,Yc,Qc,E;ma++;Xa=O;jc=y();if(jc!==m)if(b.substr(O,11)===F?(nc=
F,O+=11):(nc=m,0===ma&&d(ea)),nc!==m)if(Xc=y(),Xc!==m){var fb,kb,Pb;ma++;fb=O;var ha,Db,Ad;ma++;ha=O;Pa.test(b.charAt(O))?(Db=b.charAt(O),O++):(Db=m,0===ma&&d(Ra));Db===m&&(Db=null);Db!==m?(Ad=p(),Ad!==m?(Ia=ha,ha=Db=parseFloat(b.substring(Ia,O))):(O=ha,ha=m)):(O=ha,ha=m);ma--;ha===m&&(Db=m,0===ma&&d(ga));kb=ha;kb!==m?(Pb=t(),Pb!==m?(Ia=fb,fb=kb*=Pb):(O=fb,fb=m)):(O=fb,fb=m);fb===m&&(fb=O,48===b.charCodeAt(O)?(kb=Ga,O++):(kb=m,0===ma&&d(hb)),kb!==m?(Pb=t(),Pb===m&&(Pb=null),Pb!==m?(Ia=fb,fb=kb=0):
(O=fb,fb=m)):(O=fb,fb=m));ma--;fb===m&&(kb=m,0===ma&&d(pa));Pc=fb;Pc!==m?(Yc=y(),Yc!==m?(41===b.charCodeAt(O)?(Qc=J,O++):(Qc=m,0===ma&&d(N)),Qc!==m?(E=y(),E!==m?(Ia=Xa,Xa=jc={type:"hue-rotate",angle:Pc}):(O=Xa,Xa=m)):(O=Xa,Xa=m)):(O=Xa,Xa=m)):(O=Xa,Xa=m)}else O=Xa,Xa=m;else O=Xa,Xa=m;else O=Xa,Xa=m;ma--;Xa===m&&(jc=m,0===ma&&d(da));a=Xa;if(a===m){var sb,cd,sd,Bd,td,Cd,ud,Oa;ma++;sb=O;cd=y();cd!==m?(b.substr(O,7)===ka?(sd=ka,O+=7):(sd=m,0===ma&&d(oa)),sd!==m?(Bd=y(),Bd!==m?(td=q(),td!==m?(Cd=y(),Cd!==
m?(41===b.charCodeAt(O)?(ud=J,O++):(ud=m,0===ma&&d(N)),ud!==m?(Oa=y(),Oa!==m?(Ia=sb,sb=cd={type:"invert",amount:td}):(O=sb,sb=m)):(O=sb,sb=m)):(O=sb,sb=m)):(O=sb,sb=m)):(O=sb,sb=m)):(O=sb,sb=m)):(O=sb,sb=m);ma--;sb===m&&(cd=m,0===ma&&d(la));a=sb;if(a===m){var tb,dd,vd,Qd,Id,Dd,Jd,Rd;ma++;tb=O;dd=y();dd!==m?(b.substr(O,8)===fa?(vd=fa,O+=8):(vd=m,0===ma&&d(xa)),vd!==m?(Qd=y(),Qd!==m?(Id=q(),Id!==m?(Dd=y(),Dd!==m?(41===b.charCodeAt(O)?(Jd=J,O++):(Jd=m,0===ma&&d(N)),Jd!==m?(Rd=y(),Rd!==m?(Ia=tb,tb=dd=
{type:"opacity",amount:Id}):(O=tb,tb=m)):(O=tb,tb=m)):(O=tb,tb=m)):(O=tb,tb=m)):(O=tb,tb=m)):(O=tb,tb=m)):(O=tb,tb=m);ma--;tb===m&&(dd=m,0===ma&&d(va));a=tb;if(a===m){var yb,Ed,Kd,Sd,Ld,Td,Md,Ud;ma++;yb=O;Ed=y();Ed!==m?(b.substr(O,9)===na?(Kd=na,O+=9):(Kd=m,0===ma&&d(wa)),Kd!==m?(Sd=y(),Sd!==m?(Ld=q(),Ld!==m?(Td=y(),Td!==m?(41===b.charCodeAt(O)?(Md=J,O++):(Md=m,0===ma&&d(N)),Md!==m?(Ud=y(),Ud!==m?(Ia=yb,yb=Ed={type:"saturate",amount:Ld}):(O=yb,yb=m)):(O=yb,yb=m)):(O=yb,yb=m)):(O=yb,yb=m)):(O=yb,yb=
m)):(O=yb,yb=m)):(O=yb,yb=m);ma--;yb===m&&(Ed=m,0===ma&&d(ia));a=yb;if(a===m){var zb,Fd,Nd,Vd,Od,Wd,Pd,Xd;ma++;zb=O;Fd=y();Fd!==m?(b.substr(O,6)===ua?(Nd=ua,O+=6):(Nd=m,0===ma&&d(ya)),Nd!==m?(Vd=y(),Vd!==m?(Od=q(),Od!==m?(Wd=y(),Wd!==m?(41===b.charCodeAt(O)?(Pd=J,O++):(Pd=m,0===ma&&d(N)),Pd!==m?(Xd=y(),Xd!==m?(Ia=zb,zb=Fd={type:"sepia",amount:Od}):(O=zb,zb=m)):(O=zb,zb=m)):(O=zb,zb=m)):(O=zb,zb=m)):(O=zb,zb=m)):(O=zb,zb=m)):(O=zb,zb=m);ma--;zb===m&&(Fd=m,0===ma&&d(Ca));a=zb}}}}}}}}}return a}function q(){var a;
ma++;a=r();a===m&&(a=p());ma--;a===m&&0===ma&&d(G);return a}function p(){var a,c,e;ma++;a=O;c=[];za.test(b.charAt(O))?(e=b.charAt(O),O++):(e=m,0===ma&&d(H));if(e!==m)for(;e!==m;)c.push(e),za.test(b.charAt(O))?(e=b.charAt(O),O++):(e=m,0===ma&&d(H));else c=m;if(c!==m)if(46===b.charCodeAt(O)?(e=sa,O++):(e=m,0===ma&&d(W)),e!==m){c=[];za.test(b.charAt(O))?(e=b.charAt(O),O++):(e=m,0===ma&&d(H));if(e!==m)for(;e!==m;)c.push(e),za.test(b.charAt(O))?(e=b.charAt(O),O++):(e=m,0===ma&&d(H));else c=m;c!==m?(Ia=
a,a=c=parseFloat(b.substring(Ia,O))):(O=a,a=m)}else O=a,a=m;else O=a,a=m;if(a===m){ma++;a=O;c=[];za.test(b.charAt(O))?(e=b.charAt(O),O++):(e=m,0===ma&&d(H));if(e!==m)for(;e!==m;)c.push(e),za.test(b.charAt(O))?(e=b.charAt(O),O++):(e=m,0===ma&&d(H));else c=m;c!==m&&(Ia=a,c=parseInt(b.substring(Ia,O),10));a=c;ma--;a===m&&(c=m,0===ma&&d(Ea))}ma--;a===m&&(c=m,0===ma&&d(qa));return a}function r(){var a,c,e;a=O;c=p();c!==m?(37===b.charCodeAt(O)?(e=Ta,O++):(e=m,0===ma&&d(A)),e!==m?(Ia=a,a=c/100):(O=a,a=m)):
(O=a,a=m);return a}function t(){var a,c;ma++;a=O;b.substr(O,3)===db?(c=db,O+=3):(c=m,0===ma&&d(Ua));c!==m&&(Ia=a,c=1);a=c;a===m&&(a=O,b.substr(O,4)===Da?(c=Da,O+=4):(c=m,0===ma&&d(Ya)),c!==m&&(Ia=a,c=.9),a=c,a===m&&(a=O,b.substr(O,3)===ta?(c=ta,O+=3):(c=m,0===ma&&d(Qa)),c!==m&&(Ia=a,c=180/Math.PI),a=c,a===m&&(a=O,b.substr(O,4)===aa?(c=aa,O+=4):(c=m,0===ma&&d(Fa)),c!==m&&(Ia=a,c=1/360),a=c)));ma--;a===m&&(c=m,0===ma&&d(Ba));return a}function x(){var a,c,e;ma++;a=O;c=p();c!==m?(e=w(),e!==m?(Ia=a,a=
c*e):(O=a,a=m)):(O=a,a=m);a===m&&(a=O,48===b.charCodeAt(O)?(c=Ga,O++):(c=m,0===ma&&d(hb)),c!==m?(e=w(),e===m&&(e=null),e!==m?(Ia=a,a=0):(O=a,a=m)):(O=a,a=m));ma--;a===m&&(c=m,0===ma&&d(Ha));return a}function w(){var a,c;a=O;b.substr(O,2)===Ka?(c=Ka,O+=2):(c=m,0===ma&&d(ra));c!==m&&(Ia=a,c=1);a=c;a===m&&(a=O,b.substr(O,2)===Aa?(c=Aa,O+=2):(c=m,0===ma&&d(ja)),c!==m&&(Ia=a,c=96/2.54),a=c,a===m&&(a=O,b.substr(O,2)===rb?(c=rb,O+=2):(c=m,0===ma&&d(Nb)),c!==m&&(Ia=a,c=96/2.54/10),a=c,a===m&&(a=O,81===b.charCodeAt(O)?
(c=gb,O++):(c=m,0===ma&&d(ab)),c!==m&&(Ia=a,c=96/2.54/40),a=c,a===m&&(a=O,b.substr(O,2)===vb?(c=vb,O+=2):(c=m,0===ma&&d(Za)),c!==m&&(Ia=a,c=96),a=c,a===m&&(a=O,b.substr(O,2)===$a?(c=$a,O+=2):(c=m,0===ma&&d(xb)),c!==m&&(Ia=a,c=16),a=c,a===m&&(a=O,b.substr(O,2)===Ob?(c=Ob,O+=2):(c=m,0===ma&&d(nb)),c!==m&&(Ia=a,c=96/73),a=c))))));return a}function u(){var a;Bb.test(b.charAt(O))?(a=b.charAt(O),O++):(a=m,0===ma&&d($b));return a}function y(){var a,c;ma++;a=[];ub.test(b.charAt(O))?(c=b.charAt(O),O++):(c=
m,0===ma&&d(Qb));for(;c!==m;)a.push(c),ub.test(b.charAt(O))?(c=b.charAt(O),O++):(c=m,0===ma&&d(Qb));ma--;a===m&&(c=m,0===ma&&d(Ib));return a}l=void 0!==l?l:{};var m={},v={start:f},z=f,B=a("none"),C="none",D=k("none",!1),K=a("blur()"),I="blur(",Q=k("blur(",!1),J=")",N=k(")",!1),L=a("brightness()"),M="brightness(",R=k("brightness(",!1),S=a("contrast()"),T="contrast(",U=k("contrast(",!1),Y=a("drop-shadow()"),X="drop-shadow(",P=k("drop-shadow(",!1),V=a("grayscale()"),Z="grayscale(",ca=k("grayscale(",
!1),da=a("hue-rotate()"),F="hue-rotate(",ea=k("hue-rotate(",!1),la=a("invert()"),ka="invert(",oa=k("invert(",!1),va=a("opacity()"),fa="opacity(",xa=k("opacity(",!1),ia=a("saturate()"),na="saturate(",wa=k("saturate(",!1),Ca=a("sepia()"),ua="sepia(",ya=k("sepia(",!1),G=a("\x3cnumber-percentage\x3e"),Ea=a("\x3cinteger\x3e"),za=/^[0-9]/,H=h([["0","9"]],!1,!1),qa=a("\x3cnumber\x3e"),sa=".",W=k(".",!1),ga=a("\x3csignedNumber\x3e"),Pa=/^[+\-]/,Ra=h(["+","-"],!1,!1),Ta="%",A=k("%",!1),pa=a("\x3cangle\x3e"),
Ga="0",hb=k("0",!1),Ba=a("\x3cunit\x3e"),db="deg",Ua=k("deg",!1),Da="grad",Ya=k("grad",!1),ta="rad",Qa=k("rad",!1),aa="turn",Fa=k("turn",!1),Ha=a("\x3clength\x3e"),Ka="px",ra=k("px",!1),Aa="cm",ja=k("cm",!1),rb="mm",Nb=k("mm",!1),gb="Q",ab=k("Q",!1),vb="in",Za=k("in",!1),$a="pc",xb=k("pc",!1),Ob="pt",nb=k("pt",!1),Fb="#",mc=k("#",!1),Ab="rgba(",Rb=k("rgba(",!1),lb=",",jb=k(",",!1),Sb="rgb(",Hb=k("rgb(",!1),Bb=/^[0-9a-fA-F]/,$b=h([["0","9"],["a","f"],["A","F"]],!1,!1),Ib=a("whitespace"),ub=/^[ \t\n\r]/,
Qb=h([" ","\t","\n","\r"],!1,!1),Jb=a("\x3cnamed-color\x3e"),Kb=/^[a-z]/,ac=h([["a","z"]],!1,!1),O=0,Ia=0,wb=[{line:1,column:1}],Wa=0,Ub=[],ma=0,Lb;if("startRule"in l){if(!(l.startRule in v))throw Error("Can't start parsing from rule \""+l.startRule+'".');z=v[l.startRule]}var Mb={transparent:[0,0,0,0],black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,
255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,
139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,
105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,
128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,
112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,
239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rebeccapurple:[102,51,153],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,
191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]},Tb=new Set(Object.keys(Mb));Lb=z();if(Lb!==m&&O===b.length)return Lb;Lb!==m&&O<b.length&&d({type:"end"});throw function(a,b,c){return new n(n.buildMessage(a,b),a,b,c)}(Ub,Wa<b.length?b.charAt(Wa):null,Wa<b.length?e(Wa,Wa+1):e(Wa,Wa));}}})},"esri/views/layers/support/Transition":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4".split(" "),
function(n,b,l,k,h,a,g){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.from=null;a.to=null;a.duration=4E3;a.repeat=!0;a.done=!1;return a}k(d,b);e=d;d.prototype.getColorMatrix=function(){this.done=!1;if(null==this._lastTime)this._currentStep=0,this._lastTime=Date.now();else{var a=this._lastTime,b=Date.now();this._currentStep+=b-a;2147483647<=this._currentStep&&(this._currentStep=0);this._lastTime=b}var a=this._currentStep%this.duration/(this.duration/2),a=1>=a?a:2-
a,b=this.from.getColorMatrix(),d=this.to.getColorMatrix();g.mat4.multiplyScalar(b,b,1-a);g.mat4.multiplyScalar(d,d,a);!this.repeat&&this._currentStep>=this.duration&&(this.done=!0);return g.mat4.add(b,b,d)};d.prototype.getOpacity=function(){throw Error("No getOpacity definition for Transition");};d.prototype.clone=function(){var a=new e({from:this.from.clone(),to:this.to.clone(),duration:this.duration});a._lastTime=this._lastTime;a._currentStep=this._currentStep;return a};var e;l([a.property()],d.prototype,
"from",void 0);l([a.property()],d.prototype,"to",void 0);l([a.property({type:Number})],d.prototype,"duration",void 0);l([a.property({type:Boolean})],d.prototype,"repeat",void 0);return d=e=l([a.subclass("esri.views.layers.support.Transition")],d)}(a.declared(h))})},"esri/views/layers/support/popupUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});b.getRequiredFields=function(b,d){void 0===d&&(d=b.popupTemplate);return k(this,void 0,void 0,function(){var e,c,k,n,r,t,x,w,u,y,m;return l(this,function(f){switch(f.label){case 0:return a.isSome(d)?[4,d.getRequiredFields(b.fields)]:[2,[]];case 1:e=f.sent();c=d.lastEditInfoEnabled;k=b.objectIdField;n=b.typeIdField;if(h.includes(e,"*"))return[2,["*"]];t=g.fixFields;x=[b.fields];u=(w=e).concat;y=[[n]];return(m=c)?[4,g.getFeatureEditFields(b)]:
[3,3];case 2:m=f.sent(),f.label=3;case 3:return(r=t.apply(void 0,x.concat([u.apply(w,y.concat([m||null]))])))&&k&&g.hasField(b.fields,k)&&-1===r.indexOf(k)&&r.push(k),[2,r]}})})};b.getFetchPopupTemplate=function(b,d){return b.popupTemplate?b.popupTemplate:a.isSome(d)&&d.defaultPopupTemplateEnabled&&a.isSome(b.defaultPopupTemplate)?b.defaultPopupTemplate:null}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../request ../../../core/arrayUtils ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/iteratorUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../layers/support/domains ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorker ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/geometryUtils ../support/orientedBoundingBox ../support/projectionUtils ../../layers/LayerView ../../support/index ../../support/layerViewUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T,U,Y,X,P,V,Z,ca,da,F,ea){var la=p.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),ka=V.plane.create();n=function(b){function n(){var a=null!==b&&b.apply(this,arguments)||this;a.maximumPointCount=4E6;a.slicePlaneEnabled=!1;a._renderer=null;a._rendererAdded=!1;a._renderedNodes=new Set;a._nodeScales=new Map;a._updateViewNeeded=!0;a._lodFactor=1;a._worker=new L.PointCloudWorker;a._maxLoggedBoxWarnings=5;a._pageMultiplier=
1;a._nodeLoadEpoch=0;a._indexQueue=[];a._workQueue=[];a._idleQueue=new Q.PromiseQueue;a._indexPagesLoading=new Map;a._loadingNodes=new Map;a._layerIsVisible=!1;a._codedDomainPopulationPromise=null;a._codedDomainPopulationAbortController=null;a._totalWork=0;a._index=null;a._loadingInitNodePage=!1;a._nodeIdArray=[];return a}l(n,b);Object.defineProperty(n.prototype,"pointScale",{get:function(){var a=T.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.scaleFactor?a.scaleFactor:
1},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"useRealWorldSymbolSizes",{get:function(){var a=T.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.useRealWorldSymbolSizes?a.useRealWorldSymbolSizes:!1},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"pointSize",{get:function(){var a=T.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.size?a.size:0},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,
"inverseDensity",{get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"availableFields",{get:function(){var a=T.getRendererInfo(this.layer),b=new Set;a.primaryAttribute&&b.add(a.primaryAttribute.name);a.modulationAttribute&&b.add(a.primaryAttribute.name);if(a=T.getFilterInfo(this.layer))for(var c=0;c<a.length;c++)b.add(a[c].attributeInfo.name);if(this.layer.outFields)for(a=0,c=I.unpackFieldNames(this.layer.fields,
this.layer.outFields);a<c.length;a++)b.add(c[a]);return q.valuesOfSet(b)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"_clippingBox",{get:function(){if(!this.view||!this.view.clippingArea)return null;var a=z.create();return ca.extentToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?a:null},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"_elevationOffset",{get:function(){var a=this.layer&&this.layer.elevationInfo;if(a&&"absolute-height"===
a.mode){var b=u.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=J.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});n.prototype.initialize=function(){var a=this;this._tmpPoint=C.makeDehydratedPoint(0,0,0,this.layer.spatialReference);M.checkPointCloudLayerValid(this.layer);M.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._initRenderer();var b=this._initNodePages(),c=this.view.resourceController.memoryController;this._memCache=
c.getMemCache(this.layer.uid);this.updatingHandles.add(this,"_clippingBox",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this,"_elevationOffset",function(){return a._elevationOffsetChanged()},2);this.updatingHandles.add(this.layer,"renderer",function(){return a._rendererChanged()},2);this.updatingHandles.add(this.layer,"filters",function(){return a._reload()},2);this.updatingHandles.add(this.layer,"outFields",function(){return a._reload()},2);this.updatingHandles.add(this.layer,
"scaleRangeId",function(){return a._setUpdateViewNeeded()});this.updatingHandles.add(this,"clippingArea",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this.view.state,"camera",function(){return a._setUpdateViewNeeded()});this.handles.add([this.view.basemapTerrain.on("scale-change",function(b){return a._scaleUpdateHandler(b)}),c.events.on("quality-changed",function(){return a._setUpdateViewNeeded()})]);this.addResolvingPromise(b);var d=this.view.resourceController.scheduler;
this.when(function(){a.handles.add([d.registerTask(F.Task.POINT_CLOUD_LAYER,function(b){return a._process(b)},function(){return a._needsUpdate()}),d.registerIdleStateCallbacks(function(){return a._idleBegin()},function(){return a._idleEnd()}),a.updatingHandles.add(a,"suspended",function(b){b?a._clearNodeState():a._setUpdateViewNeeded()},2)])},function(){a.updatingHandles.removeAll();a.handles.removeAll()})};n.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};
n.prototype.destroy=function(){this.cancelLoading();this._worker.destroy();this._worker=null;this._destroyRenderer();this._memCache.destroy();this._memCache=null;this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null);this._codedDomainPopulationPromise=null};n.prototype._initRenderer=function(){var a=this;this._renderer=new Y.PointRenderer({createGraphic:function(b,c,d){return a._createGraphic(b,c,d)}});this._renderer.layerUid=
this.layer.uid;this.updatingHandles.add(this,"_clippingBox",function(b){return a._renderer.clippingBox=b},2);this.updatingHandles.add(this,"suspended",function(b){return a._setPointsVisible(!b)},2);this.updatingHandles.add(this,"pointScale",function(b){return a._renderer.scaleFactor=b},2);this._renderer.minSizePx=Math.sqrt(2);this.updatingHandles.add(this,"useRealWorldSymbolSizes",function(b){return a._renderer.useRealWorldSymbolSizes=b},2);this.updatingHandles.add(this,"pointSize",function(b){var c=
x.pt2px(b);a._renderer.size=b;a._renderer.sizePx=c},2);this.updatingHandles.add(this,"slicePlaneEnabled",function(b){return a._renderer.slicePlaneEnabled=b},2);this.updatingHandles.add(this,"inverseDensity",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this,"maximumPointCount",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(b){a._lodFactor=b;a._setUpdateViewNeeded()},2)};n.prototype._destroyRenderer=
function(){this._renderer.removeAll();this._setPointsVisible(!1)};n.prototype._createGraphic=function(a,b,c){var d=r.isSome(a.pointIdFilterMap)?a.pointIdFilterMap[b]:b;c=this.view.computeMapPointFromVec3d(c);var e=this._createGraphicAttributes(a,d);return new U.PointGraphic({pointCloudMetadata:{nodeId:a.id,pointIndexInNode:b,attributePointIndexInNode:d,epoch:this._nodeLoadEpoch},geometry:c,attributes:e,layer:this.layer,sourceLayer:this.layer})};n.prototype._createGraphicAttributes=function(a,b){var c=
{},d=0;for(a=a.attributes;d<a.length;d++){var e=a[d];this._encodeGraphicAttribute(e.attributeInfo,e.values,b,c)}return c};n.prototype._encodeGraphicAttribute=function(a,b,c,d){var e=a.storageInfo&&a.storageInfo.attributeValues,f=e?e.valuesPerElement:1;if(1===f)d[a.name]=b[c];else if("UInt8"===e.valueType&&4>=f){for(var e=0,g=c*=f;g<c+f;g++)e=(e<<8)+b[g];d[a.name]=e}else d[a.name]=void 0};n.prototype._setPointsVisible=function(a){a&&!this._rendererAdded?(this.view._stage.addRenderPlugin([6],this._renderer),
this._rendererAdded=!0):!a&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};n.prototype._rendererChanged=function(){this._renderer.useFixedSizes=T.rendererUsesFixedSizes(this.layer.renderer);this._reload()};n.prototype._reload=function(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()};n.prototype._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};n.prototype._scaleUpdateHandler=
function(a){var b=this;this.layer.minScale||this.layer.maxScale?ca.boundingRectToBoundingRect(a.extent,a.spatialReference,oa,this.layer.spatialReference)&&(this._nodeScales.forEach(function(c,d){b._renderedNodes.has(d)?(c=b._index.getNode(d),B.containsPoint(oa,c.obb.center)&&b._nodeScales.set(d,a.scale)):b._nodeScales.delete(d)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};n.prototype.displayNodes=function(a){this._workQueue=R.nodeDiff(e.keysOfSet(this._renderedNodes),a,this._index);R.sortFrontToBack(this._workQueue,
this.view.state.camera.viewForward,this._index);R.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<a.length||this._loadingInitNodePage;this.notifyChange("suspended")};n.prototype.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};n.prototype._cancelNodeLoading=function(){var a=[];this._loadingNodes.forEach(function(b){return a.push(b.abortController)});this._loadingNodes.clear();
for(var b=0;b<a.length;b++)a[b].abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};n.prototype._updateQueues=function(){var a=this,b=new Set;this._workQueue.forEach(function(a){a.load.forEach(function(a){b.add(a)})});var c=[],d=new Map;this._loadingNodes.forEach(function(a,e){b.has(e)?d.set(e,a):c.push(a)});this._loadingNodes=d;for(var e=0;e<c.length;e++)c[e].abortController.abort();this._workQueue=this._workQueue.filter(function(b){var c=
0;for(b=b.load;c<b.length;c++)if(a._loadingNodes.has(b[c]))return!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};n.prototype._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(function(a){return a.abortController.abort()});this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};n.prototype._clearNodeState=function(){var a=this;this._nodeLoadEpoch++;this._renderedNodes.forEach(function(b){return a._removeFromRenderer(b)});
this._cancelNodeLoading()};n.prototype._idleBegin=function(){this._setUpdateViewNeeded()};n.prototype._idleEnd=function(){this._setUpdateViewNeeded()};n.prototype._needsUpdate=function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||0<this._idleQueue.length};n.prototype._process=function(a){var b=this;if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,a=this._isRootNodeVisible(),a!==this._layerIsVisible&&
(this._layerIsVisible=a,this.notifyChange("suspended")),this._updateLoading());else{for(a.run(function(){return b._updateWorkQueues()});0<this._indexQueue.length&&a.run(function(){return b._processIndexQueue()}););for(this._processWorkQueue(a);0<this._idleQueue.length&&a.run(function(){return b._idleQueue.process()}););}};n.prototype._processIndexQueue=function(){var a=this,b=this._indexQueue.shift(),c=this._loadNodePage(b);this._indexPagesLoading.set(b,c);c.promise.then(function(c){a._index.addPage(b,
c,a._elevationOffset);a._setUpdateViewNeeded()}).then(function(){a._indexPagesLoading.delete(b)},function(){a._indexPagesLoading.delete(b)});return!0};n.prototype._processWorkQueue=function(a){for(;!a.done;){var b=this._scheduleWorkEntry();if(!b)break;this._processWorkEntry(b);a.madeProgress()}};n.prototype._scheduleWorkEntry=function(){var a=this;if(8<=this._loadingNodes.size)return null;for(var b=0;b<this._workQueue.length;++b){var c=this._workQueue[b];if(!d.find(c.remove,function(b){return!a._renderedNodes.has(b)})){for(;0<
b;--b)this._workQueue[b]=this._workQueue[b-1];this._workQueue.shift();return c}}return null};n.prototype._processWorkEntry=function(a){var b=this;if(0===a.load.length)for(var c=0;c<a.remove.length;c++)this._removeFromRenderer(a.remove[c]);else t.all(a.load.map(function(a){var c=t.createAbortController(),d=b._memCache.pop(a.toString());d?b._loadingNodes.set(a,{abortController:c,promise:t.resolve(d)}):b._loadingNodes.has(a)||b._loadingNodes.set(a,{abortController:c,promise:f.safeCast(b.loadNode(a,c.signal))});
return b._loadingNodes.get(a).promise})).then(function(c){for(var d=0;d<a.load.length;d++)if(c[d]){var e=b._setupRendererData(a.load[d],c[d]);b._addToRenderer(e)}for(d=0;d<a.remove.length;d++)b._removeFromRenderer(a.remove[d])}).catch(function(){}).then(function(){for(var c=0;c<a.load.length;c++)b._loadingNodes.delete(a.load[c]);b._updateLoading()}),this._updateLoading()};n.prototype.populateClassCodeCodedDomain=function(b,c){return a(this,void 0,void 0,function(){var a,d,e,g;return h(this,function(h){switch(h.label){case 0:return a=
this.layer.fieldsIndex.get("CLASS_CODE"),!a||a.domain||-1===b.indexOf(a.name)?[2]:[4,f.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:c}))];case 1:d=h.sent();if(!1===d.ok)return[2];g=(e=d.value)&&e.labels&&e.labels.labels;if(!g||!Array.isArray(g))return[2];a.domain=new K.CodedValueDomain({name:"CLASS_CODE",codedValues:g.map(function(a){return new D.default({code:a.value,name:a.label})})});return[2]}})})};n.prototype.prepareFetchPopupFeatures=function(b){return a(this,void 0,void 0,function(){var a=
this;return h(this,function(c){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=t.createAbortController(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(b,this._codedDomainPopulationAbortController.signal).then(function(){a._codedDomainPopulationAbortController=null}));return[2,this._codedDomainPopulationPromise]})})};n.prototype.whenGraphicAttributes=function(b,c){return a(this,void 0,void 0,function(){var d,e,g,k,l,m=this;return h(this,function(n){switch(n.label){case 0:return d=
this._splitGraphicsPerNode(b),e=this.layer.attributeStorageInfo,g=c.map(function(a){return T.getAttributeInfo(e,a)}),k=function(b,c){return a(m,void 0,void 0,function(){var d,e=this;return h(this,function(k){switch(k.label){case 0:return d=this._index.getNode(c),[4,f.forEach(g,function(c){return a(e,void 0,void 0,function(){var a,e,f,g,k,l;return h(this,function(h){switch(h.label){case 0:return c.useElevation?[4,this._loadElevationAttributeFromGeometry(d.resourceId)]:[3,2];case 1:return e=h.sent(),
[3,4];case 2:return[4,this._loadAndParseAttribute(d,c)];case 3:e=h.sent(),h.label=4;case 4:a=e;if(!a)return[2];f=0;for(g=b;f<g.length;f++)k=g[f],this._isValidPointGraphic(k)&&(l=k.pointCloudMetadata.attributePointIndexInNode,this._encodeGraphicAttribute(c,a,l,k.attributes));return[2]}})})})];case 1:return k.sent(),[2]}})})},l=[],d.forEach(function(a,b){l.push(k(a,b))}),[4,t.eachAlways(l)];case 1:return n.sent(),[2,b]}})})};n.prototype._isValidPointGraphic=function(a){return a instanceof U.PointGraphic&&
a.pointCloudMetadata&&a.pointCloudMetadata.epoch===this._nodeLoadEpoch};n.prototype._splitGraphicsPerNode=function(a){for(var b=new Map,c=0;c<a.length;c++){var d=a[c];if(this._isValidPointGraphic(d)){var e=d.pointCloudMetadata,f=b.get(e.nodeId);f?f.push(d):b.set(e.nodeId,[d])}}return b};n.prototype._loadAndParseAttribute=function(b,c){return a(this,void 0,void 0,function(){var a;return h(this,function(d){switch(d.label){case 0:return[4,this.loadAttribute(b.resourceId,c,null)];case 1:return a=d.sent(),
[2,r.isSome(a)?T.getAttributeValues({attributeInfo:c,buffer:a},null,b.vertexCount):null]}})})};n.prototype._loadElevationAttributeFromGeometry=function(b){return a(this,void 0,void 0,function(){var a,c,d,e;return h(this,function(f){switch(f.label){case 0:return a=this.layer.store.defaultGeometrySchema,d=T.readGeometry,e=[a],[4,this.loadGeometry(b,null)];case 1:return c=d.apply(void 0,e.concat([f.sent()])),[2,T.elevationFromPositions(c,c.length/3)]}})})};n.prototype.highlight=function(a,b){var d=this;
void 0===b&&(b={});if(!a)return{remove:function(){},pause:function(){},resume:function(){}};a=c.isCollection(a)?a.toArray():Array.isArray(a)?a:[a];return this._renderer.highlight(a.map(function(a){return d._graphicToPointDefinition(a)}),b)};n.prototype._graphicToPointDefinition=function(a){if(!this._isValidPointGraphic(a))return null;var b=a.pointCloudMetadata;a=b.nodeId;b=b.pointIndexInNode;return null!=a&&null!=b?{nodeId:a,pointId:b}:null};n.prototype._computeWork=function(){for(var a=0,b=0;b<this._workQueue.length;b++)a+=
this._workQueue[b].load.length;a+=this._loadingNodes.size;a+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;a+=this._loadingInitNodePage?100:0;return a+=this._updateViewNeeded?100:0};Object.defineProperty(n.prototype,"updatingPercentageValue",{get:function(){var a=this._computeWork();return 100*Math.min(this._totalWork,a)/this._totalWork},enumerable:!0,configurable:!0});n.prototype._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingPercentageValue")};
n.prototype.canResume=function(){return this.inherited(arguments)&&this._layerIsVisible};n.prototype.isUpdating=function(){return 0<this._computeWork()};n.prototype._initNodePages=function(){var a=this,b=this.layer.store.index;this._index=new S(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,b.nodesPerPage||b.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");
this._updateLoading();this._pageMultiplier=null!=b.nodesPerPage?1:b.nodePerIndexBlock;return this._loadNodePage(0).promise.then(function(b){a._index.addPage(0,b,a._elevationOffset);a._loadingInitNodePage=!1;a._setUpdateViewNeeded()})};n.prototype._loadNodePage=function(a){var b=this,c=t.createAbortController();return{promise:this._requestJSON(this.baseUrl+"/nodepages/"+a*this._pageMultiplier,c.signal).then(function(c){return c.data.nodes.map(function(c,d){return{resourceId:null!=c.resourceId?c.resourceId:
a*b._index.pageSize+d,obb:c.obb,firstChild:c.firstChild,childCount:c.childCount,vertexCount:null!=c.vertexCount?c.vertexCount:c.pointCount,lodThreshold:null!=c.lodThreshold?c.lodThreshold:c.effectiveArea}})}),abortController:c}};n.prototype._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;for(var a=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),b=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),
e=Math.sqrt(d/(.75*b));d>b;)a*=e,c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),e=Math.sqrt(2);this.displayNodes(c);this._updateViewNeeded=!1;this._updateLoading();return!0};n.prototype._computePointCount=function(a){for(var b=0,c=0;c<a.length;c++){var d=this._index.getNode(a[c]);d&&(b+=d.vertexCount)}return b};n.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};n.prototype._isRootNodeVisible=function(){var a=!1;this._traverseVisible({frustumPlanes:this.view.state.camera.frustum.planes,
clippingBox:this._clippingBox},{predicate:function(b,c,d){a=d;return!1},pageMiss:function(a,b){}});return a};n.prototype._computeNodesForMinimumDensity=function(a){var b=this,c=this.view.state.camera,d=c.frustum,e=this._clippingBox,f=c.viewForward,g=m.vec3.dot(f,c.eye),h=V.plane.fromNormalAndOffset(f,-g,ka),k=c.perScreenPixelRatio/2,l=a*a,n=this._nodeIdArray;n.length=0;a=ea.extractSafeScaleBounds(this.layer);var p=a.minScale,q=a.maxScale,r=0===p&&0===q?function(a){return n.push(a)}:function(a){var c=
b._getScale(a);ea.scaleBoundsPredicate(c,p,q)&&n.push(a)};this._traverseVisible({frustumPlanes:d.planes,clippingBox:e},{predicate:function(a,c,d){if(!d)return!1;if(0===c.childCount)return r(a),!1;d=b._index.getRenderObb(a);return b._computeAveragePixelArea(d,c.lodThreshold,c.vertexCount,h,k)<=l?(r(a),!1):!0},pageMiss:function(a,c){r(a);0>b._indexQueue.indexOf(c)&&b._indexQueue.push(c)}});return n};n.prototype._getScale=function(a){var b=this._nodeScales.get(a);null==b&&(b=this._index.getNode(a).obb.center,
this._tmpPoint.x=b[0],this._tmpPoint.y=b[1],this._tmpPoint.z=b[2],b=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(a,b));return b};n.prototype._computeAveragePixelArea=function(a,b,c,d,e){a=Math.max(1E-7,Z.minimumDistancePlane(a,d));return b/(a*a)/(4*e*e)/c};n.prototype.loadNode=function(b,c){return a(this,void 0,void 0,function(){return h(this,function(a){try{return[2,this.loadNodeAsync(b,c)]}catch(Ca){throw t.isAbortError(Ca)||la.error(Ca),Ca;}})})};n.prototype.loadAdditionalUserAttributes=
function(b,c,d){return a(this,void 0,void 0,function(){var a,e,f,g,k,l,m,n,p,v;return h(this,function(h){switch(h.label){case 0:a=this.layer.outFields;if(!a)return[2,[]];e=I.unpackFieldNames(this.layer.fields,a);f=q.SetFromValues(b.map(function(a){return r.isSome(a)?a.name:null}));g=this.layer.attributeStorageInfo;k=[];l=0;for(m=e;l<m.length;l++)n=m[l],f.has(n)||(p=T.getAttributeInfo(g,n))&&k.push(c(p));return[4,t.eachAlwaysValues(k)];case 1:return v=h.sent(),t.throwIfAborted(d),[2,r.mapSome(v,function(a){return a})]}})})};
n.prototype.loadNodeAsync=function(b,c){return a(this,void 0,void 0,function(){var d,e,f,g,k,l,m,n,p,q,v,u,x,y,w,z,B,C,D,I,F,K,J,L,V,N,Q=this;return h(this,function(A){switch(A.label){case 0:return d=this._index.getNode(b),e=T.getRendererInfo(this.layer),f=T.getFilterInfo(this.layer),g=d.resourceId,k=function(b){return a(Q,void 0,void 0,function(){var a;return h(this,function(d){switch(d.label){case 0:return r.isNone(b)?[2,null]:b.useElevation?[2,{attributeInfo:b,buffer:null}]:[4,this.loadAttribute(g,
b,c)];case 1:return a=d.sent(),[2,r.isSome(a)?{attributeInfo:b,buffer:a}:null]}})})},[4,this._idleQueue.push()];case 1:return A.sent(),l=this.loadGeometry(g,c),m=e.primaryAttribute,n=e.modulationAttribute,p=k(m),q=k(n),v=f.map(function(a){return a.attributeInfo}),u=v.map(function(a){return k(a)}),x=this.loadAdditionalUserAttributes([m,n].concat(v),k,c),[4,l];case 2:return y=A.sent(),[4,p];case 3:return w=A.sent(),[4,q];case 4:return z=A.sent(),[4,t.all(u)];case 5:return B=A.sent(),[4,x];case 6:C=
A.sent();t.throwIfAborted(c);D=[y];r.isSome(w)&&w.buffer&&D.push(w.buffer);r.isSome(z)&&z.buffer&&D.push(z.buffer);I=0;for(F=B;I<F.length;I++)K=F[I],r.isSome(K)&&K.buffer&&D.push(K.buffer);J=0;for(L=C;J<L.length;J++)K=L[J],K.buffer&&D.push(K.buffer);V={geometryBuffer:y,primaryAttributeData:w,modulationAttributeData:z,filterAttributesData:B,userAttributesData:C,schema:this.layer.store.defaultGeometrySchema,rendererInfo:e,filterInfo:f,obb:this._index.getRenderObb(b),elevationOffset:this._elevationOffset,
inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return[4,this._worker.transform(V,D,c)];case 7:return N=A.sent(),[2,N]}})})};n.prototype.loadGeometry=function(b,c){return a(this,void 0,void 0,function(){var a,d;return h(this,function(e){switch(e.label){case 0:return a=this.baseUrl+"/nodes/"+b+"/geometries/0",[4,this._requestBinary(a,c)];case 1:return d=e.sent(),[2,d.data]}})})};n.prototype.loadAttribute=function(b,c,d){return a(this,void 0,void 0,
function(){var a,e,f;return h(this,function(g){switch(g.label){case 0:if(r.isNone(c)||!c.storageInfo)return[2,null];a=c.storageInfo.key;e=this.baseUrl+"/nodes/"+b+"/attributes/"+a;return[4,this._requestBinary(e,d)];case 1:return f=g.sent(),[2,f.data]}})})};n.prototype._requestJSON=function(a,b){return g(a,{query:{f:"json"},responseType:"json",signal:b})};n.prototype._requestBinary=function(a,b){return g(a,{responseType:"array-buffer",signal:b})};n.prototype._removeFromRenderer=function(a){if(this._renderedNodes.has(a)){var b=
this._renderer.removeNode(a);this._renderedNodes.delete(a);this._nodeScales.delete(a);this._memCache.put(b.id.toString(),b,5*b.coordinates.length+128)}};n.prototype._addToRenderer=function(a){this._renderedNodes.has(a.id)||(this._renderedNodes.add(a.id),this._renderer.addNode(a))};n.prototype._setupRendererData=function(a,b){var c=this._index.getNode(a),d=Math.sqrt(c.lodThreshold/c.vertexCount),e=this._index.getRenderObb(a);if(Y.PointRenderer.isInstanceOfNode(b))return b.splatSize=d,b.obb=e,b.origin=
v.vec3f32.clone(b.obb.center),b;if(b.obb.halfSize[0]>e.halfSize[0]||b.obb.halfSize[1]>e.halfSize[1]||b.obb.halfSize[2]>e.halfSize[2]){if(0<this._maxLoggedBoxWarnings){var f=function(a){return"["+a.halfSize[0]+", "+a.halfSize[1]+", "+a.halfSize[2]+"]"};la.warn("Node "+a+" reported bounding box too small. got "+f(e)+" but points cover "+f(b.obb));0===--this._maxLoggedBoxWarnings&&la.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(a,b.obb)}return{id:a,
coordinates:b.points,origin:v.vec3f32.clone(e.center),rgb:b.rgb,attributes:b.attributes,pointIdFilterMap:b.pointIdFilterMap,highlights:null,splatSize:d,obb:e,isLeaf:0===c.childCount}};n.prototype.getUsedMemory=function(){var a=0;this._renderer.forEachNode(function(b){a+=va;a+=w.estimateSize(b.coordinates);var c=0;for(b=b.attributes;c<b.length;c++){var d=b[c].values;w.isArrayBuffer(d.buffer)&&(a+=w.estimateSize(d))}});return a};n.prototype.getUnloadedMemory=function(){var a=this,b=this._renderedNodes.size;
if(4>b)return 0;for(var c=e.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount}),d=this._loadingNodes.size,f=0;f<this._workQueue.length;f++)d+=this._workQueue[f].load.length,d-=this._workQueue[f].remove.length;if(0>d)return 0;f=d*c/b;b=(this.getUsedMemory()-b*va)/c;return f*b+d*va};n.prototype.ignoresMemoryFactor=function(){return!1};n.prototype.getStats=function(){var a=this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":e.keysOfSet(this._renderedNodes).reduce(function(b,
c){return b+a._index.getNode(c).vertexCount},0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}};k([y.property()],n.prototype,"layer",void 0);k([y.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],n.prototype,"baseUrl",void 0);k([y.property({readOnly:!0,dependsOn:["layer.renderer"]})],n.prototype,"pointScale",null);k([y.property({readOnly:!0,dependsOn:["layer.renderer"]})],n.prototype,"useRealWorldSymbolSizes",
null);k([y.property({readOnly:!0,dependsOn:["layer.renderer"]})],n.prototype,"pointSize",null);k([y.property({readOnly:!0,dependsOn:["layer.renderer"]})],n.prototype,"inverseDensity",null);k([y.property()],n.prototype,"maximumPointCount",void 0);k([y.property({readOnly:!0,dependsOn:["layer.renderer","layer.filters","layer.outFields"]})],n.prototype,"availableFields",null);k([y.property({readOnly:!0,dependsOn:["view.clippingArea"]})],n.prototype,"_clippingBox",null);k([y.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],
n.prototype,"_elevationOffset",null);k([y.property({type:Boolean})],n.prototype,"slicePlaneEnabled",void 0);k([y.property()],n.prototype,"updating",void 0);k([y.property(X.updatingPercentage)],n.prototype,"updatingPercentage",void 0);k([y.property({readOnly:!0})],n.prototype,"updatingPercentageValue",null);return n=k([y.subclass("esri.views.3d.layers.PointCloudLayerView3D")],n)}(y.declared(P.PopupSceneLayerView(N.LayerView3D(da))));var oa=B.create(),va=160;return n})},"esri/views/3d/layers/PointCloudWorker":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/requireUtils ../../../core/typedArrayUtil ../../../core/workers ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../geometry/SpatialReference ./i3s/PointCloudRendererUtil ../support/projectionUtils module".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x){Object.defineProperty(b,"__esModule",{value:!0});var w=function(){function a(){}a.prototype._process=function(a){a=this._transform(a);var b=[a.points.buffer,a.rgb.buffer];k.isSome(a.pointIdFilterMap)&&b.push(a.pointIdFilterMap.buffer);for(var c=0,d=a.attributes;c<d.length;c++){var e=d[c];"buffer"in e.values&&g.isArrayBuffer(e.values.buffer)&&e.values.buffer!==a.rgb.buffer&&b.push(e.values.buffer)}return h.resolve({result:a,transferList:b})};a.prototype._transform=
function(a){var b=r.readGeometry(a.schema,a.geometryBuffer),c=b.length/3,d=null,e=[],f=r.getAttributeValues(a.primaryAttributeData,b,c);k.isSome(a.primaryAttributeData)&&f&&e.push({attributeInfo:a.primaryAttributeData.attributeInfo,values:f});var g=r.getAttributeValues(a.modulationAttributeData,b,c);k.isSome(a.modulationAttributeData)&&g&&e.push({attributeInfo:a.modulationAttributeData.attributeInfo,values:g});f=r.evaluateRenderer(a.rendererInfo,f,g,c);a.filterInfo&&0<a.filterInfo.length&&k.isSome(a.filterAttributesData)&&
(g=a.filterAttributesData.map(function(a){var d=r.getAttributeValues(a,b,c);a={attributeInfo:a.attributeInfo,values:d};e.push(a);return a}),d=new Uint32Array(c),c=r.filterInPlace(b,f,d,a.filterInfo,g));for(var g=0,h=a.userAttributesData;g<h.length;g++){var l=h[g],m=r.getAttributeValues(l,b,c);e.push({attributeInfo:l.attributeInfo,values:m})}3*c<f.length&&(f=new Uint8Array(f.buffer.slice(0,3*c)));this._applyElevationOffsetInPlace(b,c,a.elevationOffset);g=this._transformCoordinates(b,c,a.obb,p.fromJSON(a.inSR),
p.fromJSON(a.outSR));return{obb:a.obb,points:g,rgb:f,attributes:e,pointIdFilterMap:d}};a.prototype._transformCoordinates=function(a,b,e,f,g){if(!t.bufferToBuffer(a,f,0,a,g,0,b))throw Error("Can't reproject");f=q.vec3f32.fromValues(e.center[0],e.center[1],e.center[2]);g=q.vec3f32.create();var h=q.vec3f32.create();d.quat.conjugate(u,e.quaternion);for(var k=new Float32Array(3*b),l=0;l<b;l++)g[0]=a[3*l]-f[0],g[1]=a[3*l+1]-f[1],g[2]=a[3*l+2]-f[2],c.vec3.transformQuat(h,g,u),e.halfSize[0]=Math.max(e.halfSize[0],
Math.abs(h[0])),e.halfSize[1]=Math.max(e.halfSize[1],Math.abs(h[1])),e.halfSize[2]=Math.max(e.halfSize[2],Math.abs(h[2])),k[3*l]=g[0],k[3*l+1]=g[1],k[3*l+2]=g[2];return k};a.prototype._applyElevationOffsetInPlace=function(a,b,c){if(0!==c)for(var d=0;d<b;d++)a[3*d+2]+=c};return a}(),u=f.quatf32.create();f=function(b){function c(){var c=b.call(this)||this;c._thread=void 0;e.open(a.getAbsMid("./PointCloudWorker",n,x)).then(function(a){void 0===c._thread?c._thread=a:a.close()});return c}l(c,b);c.prototype.destroy=
function(){this._thread&&this._thread.close();this._thread=null};c.prototype.transform=function(a,b,c){return this._thread?this._thread.invoke("_process",a,{transferList:b,signal:c}):h.resolve(this._transform(a))};return c}(w);b.PointCloudWorker=f;b.default=function(){return new w}})},"esri/core/libs/gl-matrix-2/quatf32":function(){define(["require","exports","./factories/quatf32"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.quatf32=l})},"esri/core/libs/gl-matrix-2/factories/quatf32":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(4);b[3]=1;return b};b.clone=function(b){var k=new Float32Array(4);k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=b[3];return k};b.fromValues=function(b,k,h,a){var g=new Float32Array(4);g[0]=b;g[1]=k;g[2]=h;g[3]=a;return g};b.createView=function(b,k){return new Float32Array(b,k,4)}})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define("require exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),
function(n,b,l,k,h,a,g,e){function d(a){var b=0,c=0;for(a=a?a:[];c<a.length;c++)b|=1<<a[c];return b}function f(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b&&null!=d.attributeValues&&"UInt8"===d.attributeValues.valueType&&3===d.attributeValues.valuesPerElement)return{name:b,storageInfo:d,useElevation:!1}}return null}function c(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b)return a="embedded-elevation"===d.encoding,{name:b,storageInfo:a?null:d,useElevation:a}}return"elevation"===
b.toLowerCase()?{name:b,storageInfo:null,useElevation:!0}:null}function q(a,b){for(var c=new Float64Array(b),d=0;d<b;d++)c[d]=a[3*d+2];return c}function p(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===a?function(a){return(a&240)>>4}:"absolute-value"===a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%10}:null}Object.defineProperty(b,"__esModule",{value:!0});b.getRendererInfo=function(a){var b=a.renderer,d=b&&b.type,e=b&&a.renderer.toJSON()||
null,g=null,h=!1;"point-cloud-unique-value"===d?g=c(a.attributeStorageInfo,b.field):"point-cloud-stretch"===d?g=c(a.attributeStorageInfo,b.field):"point-cloud-class-breaks"===d?g=c(a.attributeStorageInfo,b.field):(g="point-cloud-rgb"===d?f(a.attributeStorageInfo,b.field):f(a.attributeStorageInfo,"RGB"),h=null!=g);d=null;b&&b.colorModulation&&(d=c(a.attributeStorageInfo,b.colorModulation.field));return{rendererJSON:e,isRGBRenderer:h,primaryAttribute:g,modulationAttribute:d}};b.getFilterInfo=function(a){var b=
a.filters;return b?b.map(function(b){return{filterJSON:b.toJSON(),attributeInfo:c(a.attributeStorageInfo,b.field)}}):[]};b.evaluateRenderer=function(b,c,d,e){var f=b.rendererJSON,g=b.isRGBRenderer,l=b=null;if(c&&g)b=c;else if(c&&"pointCloudUniqueValueRenderer"===f.type){var l=a.fromJSON(f),n=l.colorUniqueValueInfos;b=new Uint8Array(3*e);g=p(l.fieldTransformType);for(f=0;f<e;f++)for(var q=g?g(c[f]):c[f],q=q+"",r=0;r<n.length;r++)if(0<=n[r].values.indexOf(q)){b[3*f]=n[r].color.r;b[3*f+1]=n[r].color.g;
b[3*f+2]=n[r].color.b;break}}else if(c&&"pointCloudStretchRenderer"===f.type)for(l=h.fromJSON(f),n=l.stops,b=new Uint8Array(3*e),g=p(l.fieldTransformType),f=0;f<e;f++)if(q=g?g(c[f]):c[f],r=n.length-1,q<n[0].value)b[3*f]=n[0].color.r,b[3*f+1]=n[0].color.g,b[3*f+2]=n[0].color.b;else if(q>=n[r].value)b[3*f]=n[r].color.r,b[3*f+1]=n[r].color.g,b[3*f+2]=n[r].color.b;else for(r=1;r<n.length;r++){if(q<n[r].value){q=(q-n[r-1].value)/(n[r].value-n[r-1].value);b[3*f]=n[r].color.r*q+n[r-1].color.r*(1-q);b[3*
f+1]=n[r].color.g*q+n[r-1].color.g*(1-q);b[3*f+2]=n[r].color.b*q+n[r-1].color.b*(1-q);break}}else if(c&&"pointCloudClassBreaksRenderer"===f.type)for(l=k.fromJSON(f),n=l.colorClassBreakInfos,b=new Uint8Array(3*e),g=p(l.fieldTransformType),f=0;f<e;f++)for(q=g?g(c[f]):c[f],r=0;r<n.length;r++){if(q>=n[r].minValue&&q<=n[r].maxValue){b[3*f]=n[r].color.r;b[3*f+1]=n[r].color.g;b[3*f+2]=n[r].color.b;break}}else for(b=new Uint8Array(3*e),f=0;f<b.length;f++)b[f]=255;if(d&&l&&l.colorModulation)for(c=l.colorModulation.minValue,
l=l.colorModulation.maxValue,f=0;f<e;f++)q=d[f],g=q>=l?1:q<=c?.3:.3+.7*(q-c)/(l-c),b[3*f]*=g,b[3*f+1]*=g,b[3*f+2]*=g;return b};b.filterInPlace=function(a,b,c,e,f){for(var g=a.length/3,h=0,k=0;k<g;k++){for(var l=!0,n=0;n<e.length&&l;n++){var p=e[n].filterJSON,q=f[n].values[k];switch(p.type){case "pointCloudValueFilter":var r="exclude"===p.mode;-1!==p.values.indexOf(q)===r&&(l=!1);break;case "pointCloudBitfieldFilter":r=d(p.requiredSetBits);p=d(p.requiredClearBits);if((q&r)!==r||0!==(q&p))l=!1;break;
case "pointCloudReturnFilter":for(var t=q&15,u=q>>>4&15,q=1<u,r=1===t,t=t===u,u=!1,x=0,p=p.includedReturns;x<p.length;x++){var w=p[x];if("last"===w&&t||"firstOfMany"===w&&r&&q||"lastOfMany"===w&&t&&q||"single"===w&&!q){u=!0;break}}u||(l=!1)}}l&&(c[h]=k,a[3*h]=a[3*k],a[3*h+1]=a[3*k+1],a[3*h+2]=a[3*k+2],b[3*h]=b[3*k],b[3*h+1]=b[3*k+1],b[3*h+2]=b[3*k+2],h++)}return h};b.getSplatSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"splat"===a.type?a:null};b.getFixedSizeAlgorithm=function(a){return(a=
a&&a.pointSizeAlgorithm)&&"fixed-size"===a.type?a:null};b.rendererUsesFixedSizes=function(a){return(a=a&&a.pointSizeAlgorithm)&&a.type?"fixed-size"===a.type:!1};b.getAttributeInfo=c;b.elevationFromPositions=q;b.getAttributeValues=function(a,b,c){return l.isSome(a)&&a.attributeInfo.useElevation?q(b,c):l.isSome(a)?g.readBinaryAttribute(a.attributeInfo.storageInfo,a.buffer,c):null};b.readGeometry=function(a,b){if(null==a.encoding||""===a.encoding){a=g.createGeometryIndexFromSchema(b,a);b=g.createTypedView(b,
a.vertexAttributes.position);var c=a.header.fields;a=[c.offsetX,c.offsetY,c.offsetZ];for(var c=[c.scaleX,c.scaleY,c.scaleZ],d=b.length/3,f=new Float64Array(3*d),h=0;h<d;h++)f[3*h]=b[3*h]*c[0]+a[0],f[3*h+1]=b[3*h+1]*c[1]+a[1],f[3*h+2]=b[3*h+2]*c[2]+a[2];return f}if("lepcc-xyz"===a.encoding)return e.decodeXYZ(b).result}})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(n,b,l,k,h,a,g,e,d,f){return function(b){function c(a){a=b.call(this)||this;a.type="point-cloud-class-breaks";a.field=null;a.legendOptions=null;a.fieldTransformType=null;a.colorClassBreakInfos=null;return a}k(c,b);n=c;c.prototype.clone=function(){return new n(l({},this.cloneProperties(),{field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:a.clone(this.colorClassBreakInfos),legendOptions:a.clone(this.legendOptions)}))};var n;h([g.enumeration.serializable()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
c.prototype,"type",void 0);h([g.property({json:{write:!0},type:String})],c.prototype,"field",void 0);h([g.property({type:d.default,json:{write:!0}})],c.prototype,"legendOptions",void 0);h([g.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],c.prototype,"fieldTransformType",void 0);h([g.property({type:[f.default],json:{write:!0}})],c.prototype,"colorClassBreakInfos",
void 0);return c=n=h([g.subclass("esri.renderers.PointCloudClassBreaksRenderer")],c)}(g.declared(e))})},"esri/renderers/PointCloudRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmJSONUtils ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(n,b,l,k,h,a,g,
e,d,f,c){var q=h.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});n=function(a){function b(b){b=a.call(this)||this;b.type=void 0;b.pointSizeAlgorithm=null;b.colorModulation=null;b.pointsPerInch=10;return b}l(b,a);b.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};b.prototype.cloneProperties=
function(){return{pointSizeAlgorithm:g.clone(this.pointSizeAlgorithm),colorModulation:g.clone(this.colorModulation),pointsPerInch:g.clone(this.pointsPerInch)}};k([e.property({type:q.apiValues,readOnly:!0,nonNullable:!0,json:{type:q.jsonValues,read:!1,write:q.write}})],b.prototype,"type",void 0);k([e.property({types:c.pointSizeAlgorithmTypes,json:{read:f.read,write:!0}})],b.prototype,"pointSizeAlgorithm",void 0);k([e.property({type:d.default,json:{write:!0}})],b.prototype,"colorModulation",void 0);
k([e.property({json:{write:!0},nonNullable:!0,type:Number})],b.prototype,"pointsPerInch",void 0);return b=k([e.subclass("esri.renderers.PointCloudRenderer")],b)}(e.declared(a.JSONSupport));(n||(n={})).fieldTransformTypeKebabDict=new h.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return n})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.field=null;a.minValue=0;a.maxValue=255;return a}l(e,b);d=e;e.prototype.clone=function(){return new d({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};var d;k([a.property({type:String,json:{write:!0}})],e.prototype,"field",void 0);k([a.property({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minValue",void 0);k([a.property({type:Number,
nonNullable:!0,json:{write:!0}})],e.prototype,"maxValue",void 0);return e=d=k([a.subclass("esri.renderers.support.pointCloud.ColorModulation")],e)}(a.declared(h.JSONSupport));b.ColorModulation=n;b.default=n})},"esri/renderers/support/pointCloud/pointSizeAlgorithmJSONUtils":function(){define(["require","exports","../../../core/Warning","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});var a={pointCloudFixedSizeAlgorithm:k.default,
pointCloudSplatAlgorithm:h.default};b.read=function(b,e,d){if(e=b?a[b.type]||null:null)return e=new e,e.read(b,d),e;d&&d.messages&&b&&d.messages.push(new l("pointsizealgorithm:unsupported","Point size algorithms of type '"+(b.type||"unknown")+"' are not supported",{definition:b,context:d}));return null};b.fromJSON=function(b){var e=b?a[b.type]||null:null;return e?e.fromJSON(b):null}})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.type="fixed-size";b.size=0;b.useRealWorldSymbolSizes=null;return b}l(b,a);d=b;b.prototype.clone=function(){return new d({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};var d;k([h.enumeration.serializable()({pointCloudFixedSizeAlgorithm:"fixed-size"})],b.prototype,"type",void 0);k([h.property({type:Number,nonNullable:!0,json:{write:!0}})],
b.prototype,"size",void 0);k([h.property({type:Boolean,json:{write:!0}})],b.prototype,"useRealWorldSymbolSizes",void 0);return b=d=k([h.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],b)}(h.declared(a.default));b.PointSizeFixedSizeAlgorithm=n;b.default=n})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});b.typeKebabDictionary=new h.default({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});n=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}l(d,a);k([g.property({type:b.typeKebabDictionary.apiValues,readOnly:!0,nonNullable:!0,json:{type:b.typeKebabDictionary.jsonValues,read:!1,write:b.typeKebabDictionary.write}})],d.prototype,"type",void 0);return d=k([g.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
d)}(g.declared(a.JSONSupport));b.PointSizeAlgorithm=n;b.default=n})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.type="splat";b.scaleFactor=1;return b}
l(b,a);d=b;b.prototype.clone=function(){return new d({scaleFactor:this.scaleFactor})};var d;k([h.enumeration.serializable()({pointCloudSplatAlgorithm:"splat"})],b.prototype,"type",void 0);k([h.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],b.prototype,"scaleFactor",void 0);return b=d=k([h.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],b)}(h.declared(a.default));b.PointSizeSplatAlgorithm=n;b.default=n})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["require",
"exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});b.pointSizeAlgorithmTypes={key:"type",base:l.default,typeMap:{"fixed-size":k.default,splat:h.default}}})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.description=null;b.label=null;b.minValue=0;b.maxValue=0;b.color=null;return b}l(b,a);f=b;b.prototype.clone=function(){return new f({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:g.clone(this.color)})};var f;k([e.property({type:String,json:{write:!0}})],b.prototype,"description",void 0);k([e.property({type:String,
json:{write:!0}})],b.prototype,"label",void 0);k([e.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],b.prototype,"minValue",void 0);k([e.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],b.prototype,"maxValue",void 0);k([e.property({type:h,json:{type:[d.Integer],write:!0}})],b.prototype,"color",void 0);return b=f=k([e.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],b)}(e.declared(a.JSONSupport));
b.ColorClassBreakInfo=n;b.default=n})},"esri/renderers/PointCloudStretchRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/StopInfo".split(" "),function(n,b,l,k,h,a,g,e,d,f){return function(b){function c(a){a=b.call(this)||this;a.type="point-cloud-stretch";a.field=null;a.legendOptions=null;
a.fieldTransformType=null;a.stops=null;return a}k(c,b);n=c;c.prototype.clone=function(){return new n(l({},this.cloneProperties(),{field:a.clone(this.field),fieldTransformType:a.clone(this.fieldTransformType),stops:a.clone(this.stops),legendOptions:a.clone(this.legendOptions)}))};var n;h([g.enumeration.serializable()({pointCloudStretchRenderer:"point-cloud-stretch"})],c.prototype,"type",void 0);h([g.property({json:{write:!0},type:String})],c.prototype,"field",void 0);h([g.property({type:d.default,
json:{write:!0}})],c.prototype,"legendOptions",void 0);h([g.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],c.prototype,"fieldTransformType",void 0);h([g.property({type:[f.default],json:{write:!0}})],c.prototype,"stops",void 0);return c=n=h([g.subclass("esri.renderers.PointCloudStretchRenderer")],c)}(g.declared(e))})},"esri/renderers/support/pointCloud/StopInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.label=null;b.value=0;b.color=null;return b}l(b,a);f=b;b.prototype.clone=function(){return new f({label:this.label,value:this.value,color:g.clone(this.color)})};var f;k([e.property({type:String,json:{write:!0}})],b.prototype,"label",void 0);k([e.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"value",void 0);k([e.property({type:h,
json:{type:[d.Integer],write:!0}})],b.prototype,"color",void 0);return b=f=k([e.subclass("esri.renderers.support.pointCloud.StopInfo")],b)}(e.declared(a.JSONSupport));b.StopInfo=n;b.default=n})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(n,b,l,k,h,a,g,e,d,f){return function(b){function c(a){a=b.call(this)||this;a.type="point-cloud-unique-value";a.field=null;a.fieldTransformType=null;a.colorUniqueValueInfos=null;a.legendOptions=null;return a}k(c,b);n=c;c.prototype.clone=function(){return new n(l({},this.cloneProperties(),{field:a.clone(this.field),fieldTransformType:a.clone(this.fieldTransformType),colorUniqueValueInfos:a.clone(this.colorUniqueValueInfos),legendOptions:a.clone(this.legendOptions)}))};var n;h([g.enumeration.serializable()({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],
c.prototype,"type",void 0);h([g.property({json:{write:!0},type:String})],c.prototype,"field",void 0);h([g.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],c.prototype,"fieldTransformType",void 0);h([g.property({type:[f.default],json:{write:!0}})],c.prototype,"colorUniqueValueInfos",void 0);h([g.property({type:d.default,json:{write:!0}})],c.prototype,"legendOptions",
void 0);return c=n=h([g.subclass("esri.renderers.PointCloudUniqueValueRenderer")],c)}(g.declared(e))})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(n,b,l,k,h,a,g,e,d){Object.defineProperty(b,"__esModule",{value:!0});
n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.description=null;b.label=null;b.values=null;b.color=null;return b}l(b,a);f=b;b.prototype.clone=function(){return new f({description:this.description,label:this.label,values:g.clone(this.values),color:g.clone(this.color)})};var f;k([e.property({type:String,json:{write:!0}})],b.prototype,"description",void 0);k([e.property({type:String,json:{write:!0}})],b.prototype,"label",void 0);k([e.property({type:[String],json:{write:!0}})],
b.prototype,"values",void 0);k([e.property({type:h,json:{type:[d.Integer],write:!0}})],b.prototype,"color",void 0);return b=f=k([e.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],b)}(e.declared(a.JSONSupport));b.ColorUniqueValueInfo=n;b.default=n})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("require exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC".split(" "),function(n,b,l,k,h,a){function g(a,b,c){for(var d="",e=0;e<c;){var f=
a[b+e];if(128>f)d+=String.fromCharCode(f),e++;else if(192<=f&&224>f){if(e+1>=c)throw new l("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var g=a[b+e+1],f=(f&31)<<6|g&63,d=d+String.fromCharCode(f),e=e+2}else if(224<=f&&240>f){if(e+2>=c)throw new l("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");var g=a[b+e+1],h=a[b+e+2],f=(f&15)<<12|(g&63)<<6|h&63,d=d+String.fromCharCode(f),e=e+3}else if(240<=f&&248>f){if(e+3>=c)throw new l("utf8-decode-error",
"UTF-8 Decode failed. Multi byte character was truncated.");g=a[b+e+1];h=a[b+e+2];f=(f&7)<<18|(g&63)<<12|(h&63)<<6|a[b+e+3]&63;d=65536<=f?d+String.fromCharCode((f-65536>>10)+55296,(f&1023)+56320):d+String.fromCharCode(f);e+=4}else throw new l("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return d}function e(a,c){for(var d={byteOffset:0,byteCount:0,fields:Object.create(null)},e=0,f=0;f<c.length;f++){var g=c[f],h=g.valueType||g.type;d.fields[g.property]=(0,b.valueType2ArrayBufferReader[h])(a,
e);e+=b.valueType2TypedArrayClassMap[h].BYTES_PER_ELEMENT}d.byteCount=e;return d}function d(a,b,c){var d=[],e,f=0,h;for(h=0;h<a;h+=1){e=b[h];if(0<e){if(d.push(g(c,f,e-1)),0!==c[f+e-1])throw new l("string-array-error","Invalid string array: missing null termination.");}else d.push(null);f+=e}return d}function f(a,c){return new b.valueType2TypedArrayClassMap[c.valueType](a,c.byteOffset,c.count*c.valuesPerElement)}function c(a,b){return new Uint8Array(a,b.byteOffset,b.byteCount)}function q(a,b,c){a=
null!=b.header?e(a,b.header):{byteOffset:0,byteCount:0,fields:{count:c}};c={header:a,byteOffset:a.byteCount,byteCount:0,entries:Object.create(null)};for(var d=a.byteCount,f=0;f<b.ordering.length;f++){var g=b.ordering[f],h=k.clone(b[g]);h.count=a.fields.count;if("String"===h.valueType){if(h.byteOffset=d,h.byteCount=a.fields[g+"ByteCount"],"UTF-8"!==h.encoding)throw new l("unsupported-encoding","Unsupported String encoding.",{encoding:h.encoding});}else if(r(h.valueType)){var m=t(h.valueType),d=d+(0!==
d%m?m-d%m:0);h.byteOffset=d;h.byteCount=m*h.valuesPerElement*h.count}else throw new l("unsupported-value-type","Unsupported binary valueType",{valueType:h.valueType});d+=h.byteCount;c.entries[g]=h}c.byteCount=d-c.byteOffset;return c}function p(a,b,c){b!==a&&x.error("Invalid "+c+" buffer size\n expected: "+a+", actual: "+b+")");if(b<a)throw new l("buffer-too-small","Binary buffer is too small",{expectedSize:a,actualSize:b});}function r(a){return b.valueType2TypedArrayClassMap.hasOwnProperty(a)}function t(a){return r(a)?
b.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT:0}Object.defineProperty(b,"__esModule",{value:!0});var x=h.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");b.readHeader=e;b.readStringArray=d;b.createTypedView=f;b.createRawView=c;b.createAttributeDataIndex=q;b.createGeometryIndexFromDefinition=function(a,b,c){for(var d={header:{byteOffset:0,byteCount:a.offset,fields:{}},byteOffset:a.offset,byteCount:0,vertexAttributes:{},featureAttributes:{}},e=a.offset,f=function(a,b,c,d){var f="UInt64"===
b.type?8:t(b.type);b={byteOffset:e,byteCount:f*b.component*c,count:c,valueType:b.type,valuesPerElement:b.component};e+=b.byteCount;d[a]=b},g=0,h=w;g<h.length;g++){var k=h[g];a[k[0]]&&f(k[1],a[k[0]],b,d.vertexAttributes)}b=0;for(g=u;b<g.length;b++)h=g[b],a[h[0]]&&f(h[1],a[h[0]],c,d.featureAttributes);return d};var w=[["position","position"],["normal","normal"],["uv0","uv0"],["uv1","uv1"],["color","color"],["uvRegion","region"]],u=[["featureId","id"],["faceRange","faceRange"]];b.createGeometryIndexFromSchema=
function(a,b){for(var c=e(a,b&&b.header),d=c.byteCount,f={header:c,byteOffset:c.byteCount,byteCount:0,vertexAttributes:k.clone(b.vertexAttributes)},g=f.vertexAttributes,h=c.fields,l=null!=h.vertexCount?h.vertexCount:h.count,c=0;c<b.ordering.length;c++){var m=b.ordering[c];null!=g[m]&&(g[m].byteOffset=d,g[m].count=l,d+=t(g[m].valueType)*g[m].valuesPerElement*l)}g=h.faceCount;if(b.faces&&g)for(f.faces=k.clone(b.faces),l=f.faces,c=0;c<b.ordering.length;c++)m=b.ordering[c],null!=l[m]&&(l[m].byteOffset=
d,l[m].count=g,d+=t(l[m].valueType)*l[m].valuesPerElement*g);h=h.featureCount;if(b.featureAttributes&&b.featureAttributeOrder&&h)for(f.featureAttributes=k.clone(b.featureAttributes),g=f.featureAttributes,c=0;c<b.featureAttributeOrder.length;c++)l=b.featureAttributeOrder[c],g[l].byteOffset=d,g[l].count=h,m=t(g[l].valueType),"UInt64"===g[l].valueType&&(m=8),d+=m*g[l].valuesPerElement*h;p(d,a.byteLength,"geometry");f.byteCount=d-f.byteOffset;return f};b.readBinaryAttribute=function(b,e,g){if("lepcc-rgb"===
b.encoding)return a.decodeRGB(e);if("lepcc-intensity"===b.encoding)return a.decodeIntensity(e);if(null!=b.encoding&&""!==b.encoding)throw new l("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");b["attributeByteCounts "]&&!b.attributeByteCounts&&(x.warn("Warning: Trailing space in 'attributeByteCounts '."),b.attributeByteCounts=b["attributeByteCounts "]);"ObjectIds"===b.ordering[0]&&b.hasOwnProperty("objectIds")&&(x.warn("Warning: Case error in objectIds"),b.ordering[0]=
"objectIds");g=q(e,b,g);p(g.byteOffset+g.byteCount,e.byteLength,"attribute");if(b=g.entries.attributeValues||g.entries.objectIds){if("String"===b.valueType){g=g.entries.attributeByteCounts;var h=f(e,g);e=c(e,b);return d(g.count,h,e)}return f(e,b)}throw new l("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};b.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array};
b.valueType2ArrayBufferReader={Float32:function(a,b){return(new DataView(a,0)).getFloat32(b,!0)},Float64:function(a,b){return(new DataView(a,0)).getFloat64(b,!0)},UInt8:function(a,b){return(new DataView(a,0)).getUint8(b)},Int8:function(a,b){return(new DataView(a,0)).getInt8(b)},UInt16:function(a,b){return(new DataView(a,0)).getUint16(b,!0)},Int16:function(a,b){return(new DataView(a,0)).getInt16(b,!0)},UInt32:function(a,b){return(new DataView(a,0)).getUint32(b,!0)},Int32:function(a,b){return(new DataView(a,
0)).getInt32(b,!0)}};b.isValueType=r;b.getBytesPerValue=t})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports","../../../../core/Error"],function(n,b,l){function k(a,b,f){return{identifier:String.fromCharCode.apply(null,new Uint8Array(a,f+g.identifierOffset,g.identifierLength)),version:b.getUint16(f+g.versionOffset,!0),checksum:b.getUint32(f+g.checksumOffset,!0)}}function h(b,d,f){var c=[];d=a(b,d,c);for(var e=[],g=0;g<c.length;g++){e.length=0;d=a(b,d,e);for(var h=0;h<e.length;h++)f.push(e[h]+
c[g])}return d}function a(a,b,f){var c=new DataView(a,b),d=c.getUint8(0),e=d&31,g=!!(d&32),h=(d&192)>>6,d=0;if(0===h)d=c.getUint32(1,!0),b+=5;else if(1===h)d=c.getUint16(1,!0),b+=3;else if(2===h)d=c.getUint8(1),b+=2;else throw new l("lepcc-decode-error","Bad count type");if(g)throw new l("lepcc-decode-error","LUT not implemented");a=new Uint8Array(a,b,Math.ceil(d*e/8));for(var h=g=c=0,k=-1>>>32-e,n=0;n<d;n++){for(;g<e;)c|=a[h]<<g,g+=8,h+=1;f[n]=c&k;c>>>=e;g-=e;32<g+e&&(c|=a[h-1]>>8-g)}return b+h}
Object.defineProperty(b,"__esModule",{value:!0});var g={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};b.decodeXYZ=function(a){var b,e,c,n,p,r,t,x,w,u,y,m,v=new DataView(a,0),z=0;n=k(a,v,z);c=n.identifier;n=n.version;z+=g.byteCount;if("LEPCC     "!==c)throw new l("lepcc-decode-error","Bad identifier");if(1<n)throw new l("lepcc-decode-error","Unknown version");var B=z;b=v.getUint32(B+0,!0);e=v.getUint32(B+4,!0);c=v.getFloat64(B+8,!0);n=v.getFloat64(B+16,!0);
p=v.getFloat64(B+24,!0);r=v.getFloat64(B+32,!0);t=v.getFloat64(B+40,!0);x=v.getFloat64(B+48,!0);w=v.getFloat64(B+56,!0);u=v.getFloat64(B+64,!0);y=v.getFloat64(B+72,!0);m=v.getUint32(B+80,!0);v.getUint32(B+84,!0);z+=88;if(e*Math.pow(2,32)+b!==a.byteLength)throw new l("lepcc-decode-error","Bad size");v=new Float64Array(3*m);b=[];e=[];m=[];B=[];z=h(a,z,b);z=h(a,z,e);z=h(a,z,m);z=h(a,z,B);if(z!==a.byteLength)throw new l("lepcc-decode-error","Bad length");for(var C=z=a=0;C<b.length;C++)for(var z=z+b[C],
D=0,K=0;K<e[C];K++){var D=D+m[a],I=B[a];v[3*a]=Math.min(r,c+2*w*D);v[3*a+1]=Math.min(t,n+2*u*z);v[3*a+2]=Math.min(x,p+2*y*I);a++}return{errorX:w,errorY:u,errorZ:y,result:v}};b.decodeRGB=function(a){var b,e,c,h,n,r,t=new DataView(a,0),x=0;h=k(a,t,x);c=h.identifier;h=h.version;x+=g.byteCount;if("ClusterRGB"!==c)throw new l("lepcc-decode-error","Bad identifier");if(1<h)throw new l("lepcc-decode-error","Unknown version");r=x;b=t.getUint32(r+0,!0);e=t.getUint32(r+4,!0);c=t.getUint32(r+8,!0);h=t.getUint16(r+
12,!0);n=t.getUint8(r+14);r=t.getUint8(r+15);x+=16;if(e*Math.pow(2,32)+b!==a.byteLength)throw new l("lepcc-decode-error","Bad size");if((2===n||1===n)&&0===r){if(3*h+c+x!==a.byteLength||256<h)throw new l("lepcc-decode-error","Bad count");t=new Uint8Array(a,x,3*h);h=new Uint8Array(a,x+3*h,c);x=new Uint8Array(3*c);for(a=0;a<c;a++)b=h[a],x[3*a]=t[3*b],x[3*a+1]=t[3*b+1],x[3*a+2]=t[3*b+2];return x}if(0===n&&0===r){if(3*c+x!==a.byteLength||0!==h)throw new l("lepcc-decode-error","Bad count");return(new Uint8Array(a,
x)).slice()}if(2>=n&&1===r){if(x+3!==a.byteLength||1!==h)throw new l("lepcc-decode-error","Bad count");h=t.getUint8(x);b=t.getUint8(x+1);t=t.getUint8(x+2);x=new Uint8Array(3*c);for(a=0;a<c;a++)x[3*a]=h,x[3*a+1]=b,x[3*a+2]=t;return x}throw new l("lepcc-decode-error","Bad method "+n+","+r);};b.decodeIntensity=function(b){var d,e,c,h,n,r=new DataView(b,0),t=0;h=k(b,r,t);c=h.identifier;h=h.version;t+=g.byteCount;if("Intensity "!==c)throw new l("lepcc-decode-error","Bad identifier");if(1<h)throw new l("lepcc-decode-error",
"Unknown version");var x=t;d=r.getUint32(x+0,!0);e=r.getUint32(x+4,!0);c=r.getUint32(x+8,!0);h=r.getUint16(x+12,!0);n=r.getUint8(x+14);r.getUint8(x+15);t+=16;if(e*Math.pow(2,32)+d!==b.byteLength)throw new l("lepcc-decode-error","Bad size");r=new Uint16Array(c);if(8===n){if(c+t!==b.byteLength)throw new l("lepcc-decode-error","Bad size");n=new Uint8Array(b,t,c)}else if(16===n){if(2*c+t!==b.byteLength)throw new l("lepcc-decode-error","Bad size");n=new Uint16Array(b,t,c)}else if(n=[],a(b,t,n)!==b.byteLength)throw new l("lepcc-decode-error",
"Bad size");for(b=0;b<c;b++)r[b]=n[b]*h;return r}})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("require exports ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/webMercatorUtils ../../../../tasks/QueryTask ../../../../tasks/support/Query ./I3SBinaryReader ../../support/projectionUtils ../../support/stack".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z){function B(a){return a&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10)}function C(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=a[0]-c,c=c-a[3],g=a[1]-d,d=d-a[4],h=a[2]-e;a=e-a[5];var e=Math.max(f,c,0),k=Math.max(g,d,0),l=Math.max(h,a,0),e=e*e+k*k+l*l;return e>b*b?0:0<e?1:-Math.max(f,c,g,d,h,a)>b?3:2}function D(a,b,c){var d=[],e=c&&c.missingFields;c=c&&c.originalFields;for(var f=0;f<a.length;f++){for(var g=a[f],h=g.toLowerCase(),k=!1,l=0,
m=b;l<m.length;l++){var n=m[l];if(h===n.name.toLowerCase()){d.push(n.name);k=!0;c&&c.push(g);break}}!k&&e&&e.push(g)}return d}function K(a,b){return a.filter(function(a){return a.toLowerCase()!==b.toLowerCase()}).concat([b])}function I(a,b,c,d){b.sort(function(a,b){return a.attributes[c]-b.attributes[c]});var e=b.map(function(a){return a.attributes[c]}),f=[],g=D(d,a.fields,{originalFields:f});return J(a,e,g).then(function(a){for(var c=0;c<b.length;c++){var d=b[c],e=a[c],h={},k;for(k in d.attributes)h[k]=
d.attributes[k];for(var l=0;l<f.length;l++)h[f[l]]=e[g[l]];d.attributes=h}return b})}function Q(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e in b.attributes||c.push(e)}return c}function J(a,b,c){if(null!=a.maxRecordCount&&b.length>a.maxRecordCount){var d=M(b,a.maxRecordCount);return g.all(d.map(function(b){return J(a,b,c)})).then(R)}d=new y({objectIds:b,outFields:c,orderByFields:[a.objectIdField]});return(new u(a.parsedUrl.path)).execute(d).then(function(a){return a&&a.features&&a.features.length===
b.length?a.features.map(function(a){return a.attributes}):g.reject(new h("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function N(a,b,c,d,e,f){for(var k=[],n=0;n<b.length;n++){var p=b[n];p&&-1!==e.indexOf(p.name)&&k.push({url:a+"/nodes/"+c.resources.attributes+"/attributes/"+p.key+"/0",storageInfo:p})}return g.eachAlways(k.map(function(a){return l(a.url,{responseType:"array-buffer"}).then(function(b){return m.readBinaryAttribute(a.storageInfo,b.data)})})).then(function(a){var b=
[];if(!f.ignoreUnavailableFields&&a.some(function(a){return null==a.value})){for(var b=[],c=0;c<a.length;c++)null==a[c].value&&b.push({name:k[c].storageInfo.name,error:a[c].error});return g.reject(new h("scenelayer:attribute-request-failed","Request for scene layer attributes failed",{failedAttributes:b}))}for(var e=0;e<d.length;e++){for(var l=d[e],m={},c=0;c<a.length;c++)null!=a[c].value&&(m[k[c].storageInfo.name]=L(a[c].value,l));b.push(m)}return b})}function L(a,b){if(!a)return null;b=a[b];return e.isInt16Array(a)?
b===V?null:b:e.isInt32Array(a)?b===Z?null:b:b!==b?null:b}function M(a,b){var c=a.length;b=Math.ceil(c/b);for(var d=[],e=0;e<b;e++)d.push(a.slice(Math.floor(c*e/b),Math.floor(c*(e+1)/b)));return d}function R(a){for(var b=[],c=0;c<a.length;c++)b=b.concat(a[c]);return b}function S(a){var b=new t(B(a.store.indexCRS||a.store.geographicCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function T(a){var b=new t(B(a.store.vertexCRS||a.store.projectedCRS));return b.equals(a.spatialReference)?
a.spatialReference:b}function U(a,b,c){if(!w.canProject(a,b))throw new h("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===c&&a.isGeographic)throw new h("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{});}function Y(a,b,c){var d=S(a);a=T(a);U(d,b,c);U(a,b,c)}Object.defineProperty(b,"__esModule",{value:!0});b.DDS_ENCODING_STRING="image/vnd-ms.dds";
b.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"];b.extractWkid=B;b.selectEncoding=function(a,c){if(c)for(c=0;c<a.length;c++)if(a[c].encoding===b.DDS_ENCODING_STRING)return a[c];for(c=0;c<a.length;c++)if(-1<b.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(a[c].encoding))return a[c];return null};b.findIntersectingNodes=function(a,b,c,d,e,f){e.traverse(c,function(c){var e=c.mbs;b!==d&&(e=P,v.mbsToMbs(c.mbs,d,e,b));e=C(a,e);if(0!==e)return f(c,e),!0})};b.filterInPlace=function(a,
b,c){for(var d=0,e=0,f=0;f<b.length&&d<a.length;f++)a[d]===b[f]&&(c(f)&&(a[e]=a[d],e++),d++);a.length=e};var X=x.create();b.getClipAABB=function(a,b){var c=d.mat4.copy(z.sm4d.get(),b.objectTransformation);b=b.geometryRecords[0].getShaderTransformation();d.mat4.multiply(c,c,b);if(0===c[1]&&0===c[2]&&0===c[3]&&0===c[4]&&0===c[6]&&0===c[7]&&0===c[8]&&0===c[9]&&0===c[11]&&1===c[15])return X[0]=(a[0]-c[12])/c[0],X[1]=(a[1]-c[13])/c[5],X[2]=(a[2]-c[14])/c[10],X[3]=(a[3]-c[12])/c[0],X[4]=(a[4]-c[13])/c[5],
X[5]=(a[5]-c[14])/c[10],X};var P=r.vec4f64.create();b.intersectBoundingBoxWithMbs=C;b.findFieldsCaseInsensitive=D;b.whenGraphicAttributes=function(a,b,c,d,e,f){var l=!0===(f&&f.populateObjectId),m=f.ignoreUnavailableFields?void 0:[],n=1===d.length&&"*"===d[0];!n&&l&&(d=K(d,c));d=n?d:D(d,a.fields,{missingFields:m});if(m&&0!==m.length)return g.reject(new h("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:m}));if(0===b.length)return g.resolve(b);var m=
a.associatedLayer,p=a.attributeStorageInfo,n=n?a.fields.map(function(a){return a.name}):d;if(m)return I(m,b,c,n);var q=Q(n,b[0]);if(0===q.length)return g.resolve(b);if(p){b=e(b);if(!b)return g.reject(new h("scenelayer:features-not-loaded","Tried to query attributes for unloaded features"));var r=a.parsedUrl.path;return g.all(b.map(function(a){return N(r,p,a.node,a.indices,q,f).then(function(b){for(var c=0;c<a.graphics.length;c++){var d=a.graphics[c],e=b[c],f;for(f in d.attributes)f in e||(e[f]=d.attributes[f]);
d.attributes=e}return a.graphics})})).then(k.flatten)}return g.reject(new h("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var V=-Math.pow(2,15),Z=-Math.pow(2,31);b.getCachedAttributeValue=L;b.convertFlatRangesToOffsets=function(a,b,c){b=null!=b?b:a.length/c;for(var d=new Uint32Array(b+1),e=0;e<b;e++){var f=a[e*c];d[e]=3*f;var g=(e-1)*c+1;if(0<=g&&f-1!==a[g])throw new h("Face ranges are not continuous");}d[d.length-1]=3*(a[(b-1)*c+1]+1);return d};
b.getIndexCrs=S;b.getVertexCrs=T;b.getCacheKeySuffix=function(a,b){return b===v.SphericalECEFSpatialReference?"@ECEF":a.equals(b)?"":null!=b.wkid?"@"+b.wkid:null};b.checkSpatialReference=U;b.checkSpatialReferences=Y;b.checkSceneLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,b=!!(null!=a.geometryType&&"triangles"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||null==a.vertexAttributes||null==a.vertexAttributes.position));
if(b)throw new h("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{});};b.checkSceneLayerCompatibleWithView=function(a,b){Y(a,b.spatialReference,b.viewingMode)};b.checkPointCloudLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,b=!!(null==a.geometryType||"points"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||null!=a.encoding&&""!==a.encoding&&"lepcc-xyz"!==
a.encoding||null==a.vertexAttributes||null==a.vertexAttributes.position));if(b)throw new h("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};b.checkPointCloudLayerCompatibleWithView=function(a,b){U(a.spatialReference,b.spatialReference,b.viewingMode)};b.rendererNeedsTextures=function(b){if(null==b||"simple"!==b.type&&"class-breaks"!==b.type&&"unique-value"!==b.type||("unique-value"===b.type||"class-breaks"===b.type)&&null==b.defaultSymbol)return!0;
b=b.getSymbols();if(0===b.length)return!0;for(var c=0;c<b.length;c++){var d=b[c];if("mesh-3d"!==d.type||0===d.symbolLayers.length)return!0;for(var e=0,d=d.symbolLayers.items;e<d.length;e++){var f=d[e];if("fill"!==f.type||a.isNone(f.material)||a.isNone(f.material.color)||"replace"!==f.material.colorMixMode)return!0}}return!1};var ca=function(){return function(){this.material=this.edges=null;this.castShadows=!0}}();b.SymbolInfo=ca;b.getSymbolInfo=function(b){var c=new ca,d=!1,e=!1,f=0;for(b=b.symbolLayers.items;f<
b.length;f++){var g=b[f];if("fill"===g.type&&g.enabled){var h=g.material,k=g.edges;a.isSome(h)&&!d&&(d=h.color,h=h.colorMixMode,a.isSome(d)?c.material={color:[d.r/255,d.g/255,d.b/255],alpha:d.a,colorMixMode:h}:c.material={color:[1,1,1],alpha:1,colorMixMode:"multiply"},c.castShadows=g.castShadows,d=!0);a.isSome(k)&&!e&&(c.edges=k,e=!0)}}c.material||(c.material={color:[1,1,1],alpha:1,colorMixMode:"multiply"});return c};b.addWraparound=function(a,b){return(a|0)+(b|0)|0};b.transformObb=function(a,b,d,
e,f){void 0===f&&(f=0);p.vec3.set(d.center,a.center[0],a.center[1],a.center[2]+f);b.isGeographic||e!==v.SphericalECEFSpatialReference?c.quat.copy(d.quaternion,a.quaternion):(v.computeLinearTransformation(b,d.center,da,e),f=2*Math.sqrt(1+da[0]+da[5]+da[10]),F[0]=(da[6]-da[9])/f,F[1]=(da[8]-da[2])/f,F[2]=(da[1]-da[4])/f,F[3]=.25*f,c.quat.multiply(d.quaternion,F,a.quaternion));p.vec3.copy(d.halfSize,a.halfSize);v.bufferToBuffer(d.center,b,0,d.center,e,0,1)};var da=f.mat4f64.create(),F=q.quatf32.create()})},
"esri/views/3d/layers/i3s/LoDUtil":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3"],function(n,b,l){function k(a,b,d){for(;0<a;){var c=b.indexOf(a);if(0<=c)return c;a=d.getParentId(a)}return b.indexOf(a)}function h(a,b){for(var c=[a.remove[0]],d=[];1===c.length;)for(var e=c.pop(),f=d.length=0;f<a.load.length;f++){for(var g=a.load[f],h=b.getParentId(g);h!==e;)g=h,h=b.getParentId(g);h=c.indexOf(g);0>h&&(h=c.length,c.push(g),d.push([]));d[h].push(a.load[f])}b=[];b.push({remove:a.remove,
load:c});for(f=0;f<c.length;f++)1<d[f].length?b.push({remove:[c[f]],load:d[f]}):c[f]=d[f][0];return b}Object.defineProperty(b,"__esModule",{value:!0});b.nodeDiff=function(b,c,h){for(var f=0;f<c.length;f++)e[f]=!1,d[f]=null;for(f=0;f<b.length;f++)a[f]=!1,g[f]=null;for(f=0;f<c.length;f++){var l=k(c[f],b,h);0<=l&&(e[f]=!0,null!=g[l]?g[l].push(c[f]):g[l]=[c[f]])}for(f=0;f<b.length;f++)l=k(b[f],c,h),0<=l&&(a[f]=!0,null!=d[l]?d[l].push(b[f]):d[l]=[b[f]]);h=[];for(f=0;f<b.length;f++)null!=g[f]||a[f]||h.push({load:[],
remove:[b[f]]});for(f=0;f<c.length;f++)null!=d[f]||e[f]||h.push({load:[c[f]],remove:[]});for(f=0;f<c.length;f++)null!=d[f]&&(1<d[f].length||d[f][0]!==c[f])&&h.push({load:[c[f]],remove:d[f]});for(f=0;f<b.length;f++)null!=g[f]&&(1<g[f].length||g[f][0]!==b[f])&&h.push({load:g[f],remove:[b[f]]});return h};var a=[!1],g=[null],e=[!1],d=[null];b.sortFrontToBack=function(a,b,d){return a.sort(function(a,c){if(0===a.load.length&&0===c.load.length)return 0;if(0===a.load.length)return-1;if(0===c.load.length)return 1;
if(0===a.remove.length&&0===c.remove.length)return a=d.getRenderCenter(a.load[0]),c=d.getRenderCenter(c.load[0]),l.vec3.dot(a,b)-l.vec3.dot(c,b);if(0===a.remove.length)return-1;if(0===c.remove.length)return 1;if(1===a.load.length&&1===c.load.length)return a=d.getRenderCenter(a.load[0]),c=d.getRenderCenter(c.load[0]),l.vec3.dot(a,b)-l.vec3.dot(c,b);if(1===a.load.length)return-1;if(1===c.load.length)return 1;a=d.getRenderCenter(a.remove[0]);c=d.getRenderCenter(c.remove[0]);return l.vec3.dot(a,b)-l.vec3.dot(c,
b)})};b.splitWorkEntries=function(a,b,d){for(var c=0;c<a.length;++c){var e=a[c];if(e.load.length>b&&1===e.remove.length){e=h(e,d);a[c]=e[0];for(var f=1;f<e.length;f++)a.push(e[f])}}};b.splitWorkEntry=h})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["require","exports","../../../../geometry/support/aaBoundingBox","./I3SUtil","../../support/orientedBoundingBox"],function(n,b,l,k,h){return function(){function a(a,b,d){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=
a;this._renderSR=b;this.pageSize=d}a.prototype.addPage=function(a,b,d){for(void 0===d&&(d=0);this._pages.length<a;)this._pages.push(null);for(var e=this._nodeSR,c=this._renderSR,g=new h.ObbArray(b.length),l=0;l<b.length;l++)k.transformObb(b[l].obb,e,g.obbs[l],c,d);this._pages[a]={nodes:b,renderObbs:g.obbs,parents:new Uint32Array(this.pageSize)};a=this._pages;b=this.pageSize;for(e=[0];e.length;)for(c=e.pop(),d=a[c/b|0].nodes[c%b],g=0;g<d.childCount;g++)l=d.firstChild+g,null!=a[l/b|0]&&(a[l/b|0].parents[l%
b]=c,e.push(l))};a.prototype.hasPage=function(a){return!!this._pages[a]};a.prototype.getNode=function(a){var b=this.pageSize;return this._pages[a/b|0].nodes[a%b]};a.prototype.getRenderObb=function(a){var b=this.pageSize;return this._pages[a/b|0].renderObbs[a%b]};a.prototype.getRenderCenter=function(a){return this.getRenderObb(a).center};a.prototype.setRenderObb=function(a,b){var d=this.pageSize;h.set(b,this._pages[a/d|0].renderObbs[a%d])};a.prototype.getParentId=function(a){var b=this.pageSize;return this._pages[a/
b|0].parents[a%b]};a.prototype.hasNodes=function(a,b){b=(a+b-1)/this.pageSize|0;for(a=a/this.pageSize|0;a<=b;a++)if(null==this._pages[a])return!1;return!0};a.prototype.createVisibilityTraverse=function(){var a=this,b=[],d=[],f=l.create();return function(c,e){if(a.hasNodes(0,1))for(b.length=0,b.push(0),d.length=0,d.push(0);0<b.length;){var g=b.pop(),k=d.pop(),n=a.getNode(g),q=a.getRenderObb(g),w=!0;if(null!=c.clippingBox){var u=1<<c.frustumPlanes.length;if(0===(k&u)){var y=h.toAaBoundingBox(q,f);l.contains(c.clippingBox,
y)?k|=u:l.intersects(c.clippingBox,y)||(w=!1)}}for(y=0;y<c.frustumPlanes.length&&w;y++)if(u=1<<y,0===(k&u)){var m=h.intersectPlane(q,c.frustumPlanes[y]);0<m?w=!1:0>m&&(k|=u)}if(e.predicate(g,n,w)){q=n.firstChild;n=n.childCount;y=!1;w=(q+n-1)/a.pageSize|0;for(u=q/a.pageSize|0;u<=w;u++)if(!a.hasPage(u)){e.pageMiss(g,u);y=!0;break}if(!y)for(y=0;y<n;y++)b.push(q+y),d.push(k)}}}};return a}()})},"esri/views/3d/support/orientedBoundingBox":function(){define("require exports ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/quatf64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ./dito ./geometryUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){function x(b,c,e){return{center:f.vec3f64.clone(b),halfSize:d.vec3f32.clone(c),quaternion:a.quatf32.clone(e)}}function w(a,b){var c=t.plane.signedDistance(b,a.center);a=u(a,b);return c>a?1:c<-a?-1:0}function u(a,b){h.quat.conjugate(y,a.quaternion);e.vec3.transformQuat(m,b,y);a=a.halfSize;return Math.abs(m[0]*a[0])+Math.abs(m[1]*a[1])+Math.abs(m[2]*a[2])}Object.defineProperty(b,"__esModule",{value:!0});var y=g.quatf64.create(),m=f.vec3f64.create(),v=f.vec3f64.create(),
z=q.vec4f64.create(),B=k.mat3f64.create();n=function(){return function(b){this.buffer=new ArrayBuffer(56*b);this.obbs=Array(b);for(var c=0;c<b;c++)this.obbs[c]={center:f.vec3f64.createView(this.buffer,56*c+0),halfSize:d.vec3f32.createView(this.buffer,56*c+24),quaternion:a.quatf32.createView(this.buffer,56*c+36)}}}();b.ObbArray=n;b.create=x;b.clone=function(a){return x(a.center,a.halfSize,a.quaternion)};b.set=function(a,b){e.vec3.copy(b.center,a.center);e.vec3.copy(b.halfSize,a.halfSize);h.quat.copy(b.quaternion,
a.quaternion)};b.compute=function(a,b){b||(b=x([0,0,0],[-1,-1,-1],[0,0,0,1]));r.computeOBB(a,b);return b};b.intersectPlane=w;b.toAaBoundingBox=function(a,b){b||(b=p.create());var c=l.mat3.fromQuat(B,a.quaternion),d=a.halfSize[0]*Math.abs(c[0])+a.halfSize[1]*Math.abs(c[3])+a.halfSize[2]*Math.abs(c[6]),e=a.halfSize[0]*Math.abs(c[1])+a.halfSize[1]*Math.abs(c[4])+a.halfSize[2]*Math.abs(c[7]),c=a.halfSize[0]*Math.abs(c[2])+a.halfSize[1]*Math.abs(c[5])+a.halfSize[2]*Math.abs(c[8]);b[0]=a.center[0]-d;b[1]=
a.center[1]-e;b[2]=a.center[2]-c;b[3]=a.center[0]+d;b[4]=a.center[1]+e;b[5]=a.center[2]+c;return b};b.minimumDistancePlane=function(a,b){var c=t.plane.signedDistance(b,a.center);a=u(a,b);return c-a};b.maximumDistancePlane=function(a,b){var c=t.plane.signedDistance(b,a.center);a=u(a,b);return c+a};b.isVisible=function(a,b){return 0>=w(a,b.planes[0])&&0>=w(a,b.planes[1])&&0>=w(a,b.planes[2])&&0>=w(a,b.planes[3])&&0>=w(a,b.planes[4])&&0>=w(a,b.planes[5])};b.intersectLine=function(a,b,c,d){void 0===d&&
(d=0);h.quat.conjugate(y,a.quaternion);e.vec3.subtract(m,b,a.center);b=e.vec3.transformQuat(m,m,y);c=e.vec3.transformQuat(v,c,y);for(var f=-Infinity,g=Infinity,k=0;3>k;k++)if(1E-6<Math.abs(c[k]))var l=(d+a.halfSize[k]-b[k])/c[k],n=(-d-a.halfSize[k]-b[k])/c[k],f=Math.max(f,Math.min(l,n)),g=Math.min(g,Math.max(l,n));else if(b[k]>a.halfSize[k]+d||b[k]<-a.halfSize[k]-d)return!1;return f<=g};b.projectedArea=function(a,b,d,f,g){h.quat.conjugate(y,a.quaternion);e.vec3.sub(m,b,a.center);e.vec3.transformQuat(m,
m,y);var k=m[0]<-a.halfSize[0]?-1:m[0]>a.halfSize[0]?1:0,n=m[1]<-a.halfSize[1]?-1:m[1]>a.halfSize[1]?1:0,p=m[2]<-a.halfSize[2]?-1:m[2]>a.halfSize[2]?1:0;b=Math.abs(k)+Math.abs(n)+Math.abs(p);if(0===b)return Infinity;b=1===b?4:6;n=6*(k+3*n+9*p+13);l.mat3.fromQuat(B,a.quaternion);l.mat3.scale(B,B,a.halfSize);for(k=0;k<b;k++)p=D[n+k],e.vec3.set(m,((p&1)<<1)-1,(p&2)-1,((p&4)>>1)-1),e.vec3.transformMat3(m,m,B),e.vec3.add(z,a.center,m),z[3]=1,c.vec4.transformMat4(z,z,d),p=1/Math.max(1E-6,z[3]),C[2*k]=z[0]*
p,C[2*k+1]=z[1]*p;a=2*b-2;d=C[0]*(C[3]-C[a+1])+C[a]*(C[1]-C[a-1]);for(k=2;k<a;k+=2)d+=C[k]*(C[k+3]-C[k-1]);return Math.abs(d)*f*g*.125};var C=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],D=function(){var a=new Int8Array(162),b=0,c=function(c){for(var d=0;d<c.length;d++)a[b+d]=c[d];b+=6};c([6,2,3,1,5,4]);c([0,2,3,1,5,4]);c([0,2,3,7,5,4]);c([0,1,3,2,6,4]);c([0,1,3,2,0,0]);c([0,1,5,7,3,2]);c([0,1,3,7,6,4]);c([0,1,3,7,6,2]);c([0,1,5,7,6,2]);c([0,1,5,4,6,2]);c([0,1,5,4,0,0]);c([0,1,3,7,5,4]);c([0,2,6,4,0,0]);
c([0,0,0,0,0,0]);c([1,3,7,5,0,0]);c([2,3,7,6,4,0]);c([2,3,7,6,0,0]);c([2,3,1,5,7,6]);c([0,1,5,7,6,2]);c([0,1,5,7,6,4]);c([0,1,3,7,6,4]);c([4,5,7,6,2,0]);c([4,5,7,6,0,0]);c([4,5,1,3,7,6]);c([0,2,3,7,5,4]);c([6,2,3,7,5,4]);c([6,2,3,1,5,4]);return a}()})},"esri/views/3d/support/dito":function(){define(["require","exports"],function(n,b){function l(a,b,c,d,f,g){if(!(1E-6>b[0]*b[0]+b[1]*b[1]+b[2]*b[2]))for(p(Q,c,b),p(J,d,b),p(N,f,b),k(a,b,I),M[1]=I[0],L[1]=I[1],R[1]=L[1]-M[1],c=[c,d,f],d=[Q,J,N],f=0;3>
f;++f){k(a,c[f],I);M[0]=I[0];L[0]=I[1];k(a,d[f],I);M[2]=I[0];L[2]=I[1];R[0]=L[0]-M[0];R[2]=L[2]-M[2];var h=e(R);h<g.quality&&(q(g.b0,c[f]),q(g.b1,b),q(g.b2,d[f]),g.quality=h)}}function k(a,b,c){var d=a.data,e=a.offsetIdx;a=a.strideIdx;c[0]=Number.POSITIVE_INFINITY;for(c[1]=Number.NEGATIVE_INFINITY;e<d.length;e+=a){var f=d[e]*b[0]+d[e+1]*b[1]+d[e+2]*b[2];c[0]=Math.min(c[0],f);c[1]=Math.max(c[1],f)}}function h(a,b,d){q(d.center,a);c(d.halfSize,b,.5);d.quaternion[0]=0;d.quaternion[1]=0;d.quaternion[2]=
0;d.quaternion[3]=1}function a(a,b,c,d,e,f){k(a,b,I);e[0]=I[0];f[0]=I[1];k(a,c,I);e[1]=I[0];f[1]=I[1];k(a,d,I);e[2]=I[0];f[2]=I[1]}function g(a,b,e,f,g,h,k){ca[0]=a[0];ca[1]=a[1];ca[2]=a[2];ca[3]=b[0];ca[4]=b[1];ca[5]=b[2];ca[6]=e[0];ca[7]=e[1];ca[8]=e[2];var l=k.quaternion,m=ca,n=m[0]+m[4]+m[8];if(0<n)n=Math.sqrt(n+1),l[3]=.5*n,n=.5/n,l[0]=(m[5]-m[7])*n,l[1]=(m[6]-m[2])*n,l[2]=(m[1]-m[3])*n;else{var p=0;m[4]>m[0]&&(p=1);m[8]>m[3*p+p]&&(p=2);var q=(p+1)%3,r=(p+2)%3,n=Math.sqrt(m[3*p+p]-m[3*q+q]-m[3*
r+r]+1);l[p]=.5*n;n=.5/n;l[3]=(m[3*q+r]-m[3*r+q])*n;l[q]=(m[3*q+p]+m[3*p+q])*n;l[r]=(m[3*r+p]+m[3*p+r])*n}d(da,f,g);c(da,da,.5);c(k.center,a,da[0]);c(Z,b,da[1]);d(k.center,k.center,Z);c(Z,e,da[2]);d(k.center,k.center,Z);c(k.halfSize,h,.5)}function e(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}function d(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2]}function f(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2]}function c(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}function q(a,b,c){void 0===c&&(c=
0);a[0]=b[c+0];a[1]=b[c+1];a[2]=b[c+2]}function p(a,b,c){var d=b[0],e=b[1];b=b[2];var f=c[0],g=c[1];c=c[2];a[0]=e*c-b*g;a[1]=b*f-d*c;a[2]=d*g-e*f}function r(a,b){var c=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c)}function t(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}Object.defineProperty(b,"__esModule",{value:!0});var x=[0,0,0],w=[0,0,0];b.computeOBB=function(b,k){var n=b.data.length/b.strideIdx;if(!(0>=n)){var J=new F(b);d(x,J.minProj,
J.maxProj);c(x,x,.5);f(w,J.maxProj,J.minProj);var L=e(w),N=new ea;N.quality=L;14>n&&(b={data:new Float64Array(J.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var M=[0,0,0],Q=[0,0,0],R=[0,0,0],n=[0,0,0],Z=[0,0,0],da=[0,0,0],ca=[0,0,0],G;G=b;for(var la=t(J.maxVert[0],J.minVert[0]),ka=0,H=1;7>H;++H){var qa=t(J.maxVert[H],J.minVert[H]);qa>la&&(la=qa,ka=H)}q(M,J.minVert[ka]);q(Q,J.maxVert[ka]);if(1E-6>t(M,Q))G=1;else{f(n,M,Q);r(n,n);J=G.data;la=G.strideIdx;ka=Number.NEGATIVE_INFINITY;H=0;for(qa=G.offsetIdx;qa<
J.length;qa+=la){K[0]=J[qa]-M[0];K[1]=J[qa+1]-M[1];K[2]=J[qa+2]-M[2];var sa=n[0]*K[0]+n[1]*K[1]+n[2]*K[2],sa=K[0]*K[0]+K[1]*K[1]+K[2]*K[2]-sa*sa/(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);sa>ka&&(ka=sa,H=qa)}q(R,J,H);1E-6>ka?G=2:(f(Z,Q,R),r(Z,Z),f(da,R,M),r(da,da),p(ca,Z,n),r(ca,ca),l(G,ca,n,Z,da,N),G=0)}switch(G){case 1:h(x,w,k);return;case 2:L=b;q(T,n);Math.abs(n[0])>Math.abs(n[1])&&Math.abs(n[0])>Math.abs(n[2])?T[0]=0:Math.abs(n[1])>Math.abs(n[2])?T[1]=0:T[2]=0;1E-6>T[0]*T[0]+T[1]*T[1]+T[2]*T[2]&&(T[0]=T[1]=
T[2]=1);p(U,n,T);r(U,U);p(Y,n,U);r(Y,Y);a(L,n,U,Y,X,P);f(V,P,X);g(n,U,Y,X,P,V,k);return}G=b;J=u;la=y;ka=I;H=G.data;sa=G.offsetIdx;qa=G.strideIdx;q(la,H,sa);q(J,la);ka[0]=S[0]*ca[0]+S[1]*ca[1]+S[2]*ca[2];ka[1]=ka[0];for(sa+=qa;sa<H.length;sa+=qa){var W=H[sa]*ca[0]+H[sa+1]*ca[1]+H[sa+2]*ca[2];W<ka[0]&&(ka[0]=W,q(la,H,sa));W>ka[1]&&(ka[1]=W,q(J,H,sa))}ca=M[0]*ca[0]+M[1]*ca[1]+M[2]*ca[2];I[1]-1E-6<=ca&&(J[0]=void 0);I[0]+1E-6>=ca&&(la[0]=void 0);void 0!==u[0]&&(f(m,u,M),r(m,m),f(v,u,Q),r(v,v),f(z,u,R),
r(z,z),p(B,v,n),r(B,B),p(C,z,Z),r(C,C),p(D,m,da),r(D,D),l(G,B,n,v,m,N),l(G,C,Z,z,v,N),l(G,D,da,m,z,N));void 0!==y[0]&&(f(m,y,M),r(m,m),f(v,y,Q),r(v,v),f(z,y,R),r(z,z),p(B,v,n),r(B,B),p(C,z,Z),r(C,C),p(D,m,da),r(D,D),l(G,B,n,v,m,N),l(G,C,Z,z,v,N),l(G,D,da,m,z,N));a(b,N.b0,N.b1,N.b2,X,P);b=[0,0,0];f(b,P,X);N.quality=e(b);N.quality<L?g(N.b0,N.b1,N.b2,X,P,b,k):h(x,w,k)}};var u=[0,0,0],y=[0,0,0],m=[0,0,0],v=[0,0,0],z=[0,0,0],B=[0,0,0],C=[0,0,0],D=[0,0,0],K=[0,0,0],I=[0,0],Q=[0,0,0],J=[0,0,0],N=[0,0,0],
L=[0,0,0],M=[0,0,0],R=[0,0,0],S=[0,0,0],T=[0,0,0],U=[0,0,0],Y=[0,0,0],X=[0,0,0],P=[0,0,0],V=[0,0,0],Z=[0,0,0],ca=[1,0,0,0,1,0,0,0,1],da=[0,0,0],F=function(){return function(a){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,b,7);for(var b=b+56,c=0;7>c;++c)this.minVert[c]=new Float64Array(this.buffer,b,3),b+=24;for(c=0;7>c;++c)this.maxVert[c]=new Float64Array(this.buffer,
b,3),b+=24;for(c=0;7>c;++c)this.minProj[c]=Number.POSITIVE_INFINITY,this.maxProj[c]=Number.NEGATIVE_INFINITY;for(var b=Array(7),d=Array(7),e=a.data,f=a.strideIdx,c=a.offsetIdx;c<e.length;c+=f)a=e[c],a<this.minProj[0]&&(this.minProj[0]=a,b[0]=c),a>this.maxProj[0]&&(this.maxProj[0]=a,d[0]=c),a=e[c+1],a<this.minProj[1]&&(this.minProj[1]=a,b[1]=c),a>this.maxProj[1]&&(this.maxProj[1]=a,d[1]=c),a=e[c+2],a<this.minProj[2]&&(this.minProj[2]=a,b[2]=c),a>this.maxProj[2]&&(this.maxProj[2]=a,d[2]=c),a=e[c]+e[c+
1]+e[c+2],a<this.minProj[3]&&(this.minProj[3]=a,b[3]=c),a>this.maxProj[3]&&(this.maxProj[3]=a,d[3]=c),a=e[c]+e[c+1]-e[c+2],a<this.minProj[4]&&(this.minProj[4]=a,b[4]=c),a>this.maxProj[4]&&(this.maxProj[4]=a,d[4]=c),a=e[c]-e[c+1]+e[c+2],a<this.minProj[5]&&(this.minProj[5]=a,b[5]=c),a>this.maxProj[5]&&(this.maxProj[5]=a,d[5]=c),a=e[c]-e[c+1]-e[c+2],a<this.minProj[6]&&(this.minProj[6]=a,b[6]=c),a>this.maxProj[6]&&(this.maxProj[6]=a,d[6]=c);for(c=0;7>c;++c)a=b[c],q(this.minVert[c],e,a),a=d[c],q(this.maxVert[c],
e,a)}}(),ea=function(){return function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0}}()})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/assignHelper ../../../../Graphic ../../../../core/accessorSupport/decorators".split(" "),function(n,b,l,k,h,a,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b){return a.call(this,
b)||this}k(b,a);e=b;b.prototype.clone=function(){return new e(this.cloneProperties())};b.prototype.cloneProperties=function(){var a=this.pointCloudMetadata;return h({},this.inherited(arguments),{pointCloudMetadata:a})};var e;l([g.property({constructOnly:!0})],b.prototype,"pointCloudMetadata",void 0);return b=e=l([g.subclass("esri.views.3d.layers.i3s.PointGraphic")],b)}(g.declared(a));b.PointGraphic=n})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../geometry/support/aaBoundingBox ./PointHighlights ../../support/geometryUtils ../../support/geometryUtils ../../support/orientedBoundingBox ../../webgl-engine/lib/ComponentUtils ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/lib/ProgramRepository ../../webgl-engine/materials/internal/MaterialUtil ../../webgl-engine/shaders/PointRendererPrograms ../../../webgl/BufferObject ../../../webgl/renderState ../../../webgl/VertexArrayObject".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B){function C(a,b,c,d,e){if(c.drawScreenSpace)return c.fixedSize*b*d;e=(e?256:64)*b*d;return c.drawFixedSize?Math.min(c.fixedSize/2,e):0<c.screenMinSize?Math.min(Math.max(c.screenMinSize*b*d,a/2),e):Math.min(a/2,e)}Object.defineProperty(b,"__esModule",{value:!0});var D=a.mat4f64.create(),K={positions:[{name:"aPosition",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"aColor",count:3,type:5121,offset:0,stride:3,normalized:!0}]};
n=function(){function a(a){var b=this;this._params=a;this._highlights=new q.PointHighlights({forEachNode:function(a){return b.forEachNode(a)},addHighlight:function(a,c,d,e){return b.addHighlight(a,c,d,e)},removeHighlight:function(a,c){return b.removeHighlight(a,c)}});this.canRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=c.create(c.POSITIVE_INFINITY);this._programRep=
null;this._recreatePrograms=!0;this._programScreenHighlight=this._programWorldHighlight=this._programScreenDepth=this._programWorldDepth=this._programScreen=this._programWorld=null;this.tempMatrix4=h.mat4f32.create();this.tempVec3=e.vec3f32.create();this.nodes=[]}Object.defineProperty(a.prototype,"needsHighlight",{get:function(){return this._highlights.hasHighlights},enumerable:!0,configurable:!0});a.prototype.initializeRenderContext=function(a){this._initContext=a;this._programRep=new u(a.rctx);
a.requestRender();this._recreatePrograms=!0};a.prototype.uninitializeRenderContext=function(a){this._programRep.dispose();this._programScreenHighlight=this._programWorldHighlight=this._programScreenDepth=this._programWorldDepth=this._programScreen=this._programWorld=this._programRep=null};a.prototype.intersect=function(a,b,e,h){var k=this,l=d.vec3f64.create(),m=d.vec3f64.create(),n=d.vec3f64.create(),q=d.vec3f64.create(),v=r.plane.create(),u=a.camera.perScreenPixelRatio/2,x=a.camera.near,y=this._getSizeParams();
g.vec3.subtract(m,h,e);var z=1/g.vec3.length(m);g.vec3.scale(m,m,z);g.vec3.negate(n,m);f.vec4.set(v,m[0],m[1],m[2],-g.vec3.dot(m,e));var B=function(){return function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""}}(),I=new B,F=new B,J=[],K=c.create(),L=c.create(this._clipBox);c.offset(L,-e[0],-e[1],-e[2],L);for(var N=function(f){var p=f.splatSize*Q._scaleFactor,r=t.minimumDistancePlane(f.obb,v),w=t.maximumDistancePlane(f.obb,v),r=r-(y.drawScreenSpace?0:C(p,r+x,y,u,
f.isLeaf)),w=w-(y.drawScreenSpace?0:C(p,w+x,y,u,f.isLeaf)),r=null!=I.dist&&null!=F.dist&&I.dist<r*z&&F.dist>w*z;if(0>w||r)return"continue";w=C(p,w+x,y,u,f.isLeaf);if(!t.intersectLine(f.obb,e,m,w))return"continue";var D=w*w;t.toAaBoundingBox(f.obb,K);c.offset(K,-e[0],-e[1],-e[2],K);var V=!c.contains(L,K);g.vec3.subtract(q,f.origin,e);for(var w=f.coordinates.length/3,r=function(r){l[0]=q[0]+f.coordinates[3*r];l[1]=q[1]+f.coordinates[3*r+1];l[2]=q[2]+f.coordinates[3*r+2];if(V&&!c.containsPoint(L,l))return"continue";
var v=g.vec3.dot(l,m),t=g.vec3.squaredLength(l)-v*v;if(t>D)return"continue";var w=v+x,G=y.drawScreenSpace?0:C(p,w,y,u,f.isLeaf);if(0>v-G)return"continue";w=C(p,w-G,y,u,f.isLeaf);if(t>w*w)return"continue";var H=(v-G)*z,v=function(a){var b=a.point;null==b&&(b=d.vec3f64.create());b[0]=f.origin[0]+f.coordinates[3*r];b[1]=f.origin[1]+f.coordinates[3*r+1];b[2]=f.origin[2]+f.coordinates[3*r+2];a.point=b;a.dist=H;a.normal=n;a.node=f;a.pointId=r;a.layerUid=k.layerUid};(null==I.dist||H<I.dist)&&(null==b||b(e,
h,H))&&v(I);(null==F.dist||H>F.dist)&&(null==b||b(e,h,H))&&v(F);(null==b||b(e,h,H))&&a.enable.storeAll&&(t=new B,v(t),J.push(t))},H=0;H<w;H++)r(H)},Q=this,fa=0,xa=this.nodes;fa<xa.length;fa++)N(xa[fa]);var ia=function(a){var b=a.node,c=a.pointId;return{type:"external",point:a.point,metadata:{layerUid:a.layerUid,createGraphic:function(){return k._params.createGraphic(b,c,a.point)}}}},N=function(a,b){var c=ia(b);a.set(c,b.layerUid+"/"+b.node.id+"/"+b.pointId,b.dist,b.normal,D,void 0);a.intersector=
"PointRenderer"};null!=I.dist&&(fa=a.results.min,(null==fa.dist||I.dist<fa.dist)&&N(fa,I));null!=F.dist&&(fa=a.results.max,(null==fa.dist||F.dist>fa.dist)&&N(fa,F));if(a.enable.storeAll)for(fa=p.ray.fromPoints(e,h),xa=0;xa<J.length;xa++){var na=J[xa],wa=new w.IntersectorResult(fa);N(wa,na);a.results.all.push(wa)}};a.prototype.render=function(a){if(0!==a.pass&&1!==a.pass&&4!==a.pass)return!1;for(var b=1===a.pass,d=a.rctx,e=0,f=this.nodes;e<f.length;e++){var h=f[e];null==h.vao&&this._initNode(a,h)}this._ensurePrograms();
e=this._getSizeParams();f=this._selectProgram(a.pass,e);if(null==f||0===this.nodes.length)return!0;var l=this._clipBox,m=!c.equals(l,c.POSITIVE_INFINITY,function(a,b){return a===b});m||(g.vec3.set(this.tempVec3,-Infinity,-Infinity,-Infinity),f.setUniform3fv("uClipMin",this.tempVec3),g.vec3.set(this.tempVec3,Infinity,Infinity,Infinity),f.setUniform3fv("uClipMax",this.tempVec3));d.bindProgram(f);d.setPipelineState(this._pipelineState);f.setUniformMatrix4fv("uProjectionMatrix",a.camera.projectionMatrix);
b&&f.setUniform2f("nearFar",a.camera.near,a.camera.far);a.isHighlightPass&&y.bindHighlightRendering(d,{viewport:a.camera.fullViewport,highlightDepthTexture:a.highlightDepthTexture},f);b=a.camera.pixelRatio;e.drawFixedSize&&f.setUniform2f("uPointScale",e.fixedSize*b,a.camera.fullHeight);for(var n=this._slicePlaneEnabled?a.sliceHelper&&a.sliceHelper.plane:null,p=0,q=this.nodes;p<q.length;p++)if(h=q[p],0!==h.coordinates.length&&(!a.isHighlightPass||h.highlights)){f.setUniform2f("uScreenMinMaxSize",e.screenMinSize*
b,(h.isLeaf?256:64)*b);e.drawFixedSize||f.setUniform2f("uPointScale",h.splatSize*this._scaleFactor*b,a.camera.fullHeight/b);var r=h.origin;m&&(g.vec3.set(this.tempVec3,l[0]-r[0],l[1]-r[1],l[2]-r[2]),f.setUniform3fv("uClipMin",this.tempVec3),g.vec3.set(this.tempVec3,l[3]-r[0],l[4]-r[1],l[5]-r[2]),f.setUniform3fv("uClipMax",this.tempVec3));k.mat4.identity(this.tempMatrix4);k.mat4.translate(this.tempMatrix4,this.tempMatrix4,r);k.mat4.multiply(this.tempMatrix4,a.camera.viewMatrix,this.tempMatrix4);f.setUniformMatrix4fv("uModelViewMatrix",
this.tempMatrix4);n&&y.bindSlicePlane(r,n,f);d.bindVAO(h.vao);a.isHighlightPass?this._renderHighlightFragments(d,h):d.drawArrays(0,0,h.coordinates.length/3)}return!0};a.prototype._renderHighlightFragments=function(a,b){var c=b.highlights;if(c){b=l.unwrap(c[0].component);for(var d=b+1,e=1;e<c.length;e++){var f=l.unwrap(c[e].component);f!==d&&(d-=b,0<d&&a.drawArrays(0,b,d),b=f);d=f+1}c=d-b;0<c&&a.drawArrays(0,b,c)}};Object.defineProperty(a.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},
set:function(a){this._useFixedSizes!==a&&(this._useFixedSizes=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(a){this._scaleFactor!==a&&(this._scaleFactor=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(a){this._minSizePx!==a&&(this._minSizePx=a,this._requestRender())},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(a){this._useRealWorldSymbolSizes!==a&&(this._useRealWorldSymbolSizes=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._size},set:function(a){this._size!==a&&(this._size=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sizePx",{get:function(){return this._sizePx},
set:function(a){this._sizePx!==a&&(this._sizePx=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"clippingBox",{set:function(a){c.set(this._clipBox,a||c.POSITIVE_INFINITY)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=a,this._requestRender(),this._recreatePrograms=!0)},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"intersectionHandlerId",{get:function(){return this.layerUid},enumerable:!0,configurable:!0});a.prototype.addNode=function(a){this.nodes.push(a);this._highlights.nodeAdded(a);this._requestRender()};a.prototype.removeNode=function(a){var b=this,c=null;this.nodes=this.nodes.filter(function(d){return d.id===a?(c=d,d.vao&&(d.vao.dispose(!0),d.vao=null),b._highlights.nodeRemoved(d),!1):!0});this._requestRender();return c};a.prototype.forEachNode=function(a){this.nodes.forEach(a)};
a.prototype.removeAll=function(){this.nodes.forEach(function(a){a.vao&&(a.vao.dispose(!0),a.vao=null)});this._highlights.removeAll();this.nodes=[];this._requestRender()};a.prototype.highlight=function(a,b){return this._highlights.add(a,b)};a.prototype.addHighlight=function(a,b,c,d){a.highlights=x.addHighlight(a.highlights,b,c,d);this._requestRender()};a.prototype.removeHighlight=function(a,b){a.highlights=x.removeHighlight(a.highlights,b);this._requestRender()};a.prototype._initNode=function(a,b){a=
a.rctx;b.vao=new B(a,m.program.attributes,K,{positions:v.createVertex(a,35044,b.coordinates),colors:v.createVertex(a,35044,b.rgb)})};a.prototype._requestRender=function(){this._initContext&&this._initContext.requestRender()};a.prototype._getSizeParams=function(){var a=this._useFixedSizes,b=a&&!this._useRealWorldSymbolSizes,c=b?this._sizePx:this._size,d=this._minSizePx;a&&(d=0);return{drawScreenSpace:b,drawFixedSize:a,fixedSize:c,screenMinSize:d}};a.prototype._selectProgram=function(a,b){b=b.drawScreenSpace;
switch(a){case 1:return b?this._programScreenDepth:this._programWorldDepth;case 4:return b?this._programScreenHighlight:this._programWorldHighlight;default:return b?this._programScreen:this._programWorld}};a.prototype._ensurePrograms=function(){this._recreatePrograms&&(this._recreatePrograms=!1,this._programWorld=this._programRep.getProgram(m.program,{slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreen=this._programRep.getProgram(m.program,{drawScreenSize:!0,slicePlaneEnabled:this._slicePlaneEnabled}),
this._programWorldDepth=this._programRep.getProgram(m.program,{depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreenDepth=this._programRep.getProgram(m.program,{drawScreenSize:!0,depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programWorldHighlight=this._programRep.getProgram(m.program,{highlightPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreenHighlight=this._programRep.getProgram(m.program,{drawScreenSize:!0,highlightPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),
this._pipelineState=z.makePipelineState({depthTest:{func:513},depthWrite:z.defaultDepthWriteParams,colorWrite:z.defaultColorWriteParams}))};return a}();b.PointRenderer=n;(function(a){a.isInstanceOfNode=function(a){return a.hasOwnProperty("splatSize")}})(n=b.PointRenderer||(b.PointRenderer={}));b.PointRenderer=n})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["require","exports","../../../../core/iteratorUtils","../../../../core/maybe","../../webgl-engine/lib/HighlightUtils"],function(n,
b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.context=a;this.highlights=new Set}Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return 0<this.highlights.size},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this.highlights=null};b.prototype.add=function(b,d){var e=this,c=new a(b,d);this.highlights.add(c);this.enableSet(c);return{remove:function(){return e.removeSet(c)},pause:function(){e.disableSet(c)},resume:function(){e.enableSet(c)}}};
b.prototype.removeSet=function(a){this.disableSet(a);this.highlights.delete(a)};b.prototype.enableSet=function(a){var b=this;a.enabled||(a.enabled=!0,this.context.forEachNode(function(d){return b.enableSetForNode(a,d)}))};b.prototype.enableSetForNode=function(a,b){var d=this;if(a.enabled){var c=a.ids.get(b.id);c&&c.forEach(function(c){return d.context.addHighlight(b,c,a.options,a.id)})}};b.prototype.disableSet=function(a){var b=this;a.enabled&&(a.enabled=!1,this.context.forEachNode(function(d){return b.disableSetForNode(a,
d)}))};b.prototype.disableSetForNode=function(a,b){a.enabled||this.context.removeHighlight(b,a.id)};b.prototype.nodeAdded=function(a){var b=this;this.highlights.forEach(function(d){return b.enableSetForNode(d,a)})};b.prototype.nodeRemoved=function(a){var b=this;this.highlights.forEach(function(d){return b.disableSetForNode(d,a)})};b.prototype.removeAll=function(){var a=this;this.highlights.forEach(function(b){return a.disableSet(b)})};return b}();b.PointHighlights=n;var a=function(){function a(a,
b){this.options=b;this.id=h.generateHighlightId();this.ids=new Map;this.enabled=!1;for(b=0;b<a.length;b++){var d=a[b];k.isSome(d)&&this.add(d.nodeId,d.pointId)}}a.prototype.add=function(a,b){var d=this.ids.get(a);d?d.add(b):this.ids.set(a,l.SetFromValues([b]))};return a}()})},"esri/views/3d/webgl-engine/shaders/PointRendererPrograms":function(){define(["require","exports","./sources/resolver","../../../webgl/programUtils"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});var h=function(a){return k.glslifyDefineMap({DEPTH_PASS:a.depthPass,
HIGHLIGHT_PASS:a.highlightPass,DRAW_SCREEN_SIZE:a.drawScreenSize,SLICE:a.slicePlaneEnabled})};b.program={name:"point-renderer",shaders:function(a){return{vertexShader:h(a)+l.resolveIncludes("pointRenderer/pointRenderer.vert"),fragmentShader:h(a)+l.resolveIncludes("pointRenderer/pointRenderer.frag")}},attributes:{aPosition:0,aColor:1}}})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/iteratorUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});b.PopupSceneLayerView=function(b){return function(b){function n(){return null!==b&&b.apply(this,arguments)||this}l(n,b);n.prototype._validateFetchPopupFeatures=function(a){var b=this.layer;if(!b.popupEnabled)return new g("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:b});if(!p.getFetchPopupTemplate(b,a))return new g("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",
{layer:b})};n.prototype.prepareFetchPopupFeatures=function(b){return a(this,void 0,void 0,function(){return h(this,function(a){return[2]})})};n.prototype.fetchPopupFeatures=function(b,c){return a(this,void 0,void 0,function(){var a,b,g,k,l,n,r,t,u,x,w;return h(this,function(h){switch(h.label){case 0:if(a=this._validateFetchPopupFeatures(c))return[2,f.reject(a)];b=d.isSome(c)?c.clientGraphics:null;if(!b||0===b.length)return[2,f.resolve([])];g=[];k=[];n=q.unpackFieldNames;r=[this.layer.fields];return[4,
p.getRequiredFields(this.layer,p.getFetchPopupTemplate(this.layer,c))];case 1:return l=n.apply(void 0,r.concat([h.sent()])),[4,this.prepareFetchPopupFeatures(l)];case 2:h.sent();t=new Set;u=0;for(x=b;u<x.length;u++)w=x[u],q.populateMissingFields(l,w,t)?k.push(w):g.push(w);return 0===k.length?[2,f.resolve(g)]:[2,this.whenGraphicAttributes(k,e.valuesOfSet(t)).catch(function(){return k}).then(function(a){return g.concat(a)})]}})})};return n=k([c.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],
n)}(c.declared(b))}})},"esri/views/3d/layers/SceneLayerView3D":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/iteratorUtils ../../../core/Logger ../../../core/maybe ../../../core/unitUtils ../../../core/accessorSupport/decorators ../../../core/sql/WhereClause ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/webMercatorUtils ../../../layers/support/fieldUtils ../../../tasks/support/Query ./I3SMeshView3D ./LayerView3D ./i3s/I3SGeometryUtil ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/projectionUtils ../../layers/LayerView ../../layers/support/FeatureFilter ../../support/index".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T,U,Y){var X=p.getLogger("esri.views.3d.layers.SceneLayerView3D"),P=L.defineFieldProperties(),V=[0,0,0,0];return function(b){function l(){var a=null!==b&&b.apply(this,arguments)||this;a._queryEngine=null;a.lodFactor=1;a.progressiveLoadFactor=1;a._elevationContext="scene";a._isIntegratedMesh=!1;a._asyncModuleLoading=0;a._projectionEngineLoaded=!1;return a}k(l,b);Object.defineProperty(l.prototype,"filter",{set:function(a){if(r.isNone(a))this._set("filter",
null);else{var b=["contains","intersects","disjoint"];a.timeExtent?(X.warn("Filters with a timeExtent are not supported for mesh scene layers"),this._set("filter",null)):a.spatialRelationship&&-1===b.indexOf(a.spatialRelationship)?(X.warn("Filters with spatialRelationship other than "+b.join(", ")+" are not supported for mesh scene layers"),this._set("filter",null)):this._set("filter",a)}},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"parsedFilterWhereClause",{get:function(){var a=
r.isSome(this.filter)?this.filter.where:null;if(!a)return null;try{return w.WhereClause.create(a,this.layer.fieldsIndex)}catch(F){X.error("Failed to parse filter where clause: "+F)}return null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"parsedFilterGeometry",{get:function(){var a=this;if(r.isNone(this.filter))return null;var b=this.filter,c=b.geometry,d=b.distance;if(!d)return c;if(!this._geometryEngine)return null;b=b.units||t.getUnitString(c.spatialReference);if(c.spatialReference.isWGS84)return this._geometryEngine.geodesicBuffer(c,
d,b);if(m.canProject(c,e.SpatialReference.WGS84))return m.project(this._geometryEngine.geodesicBuffer(m.project(c,e.SpatialReference.WGS84),d,b),c.spatialReference);if(!u.isSupported())return X.error("Filter by geodesic buffer (distance) unsupported due to lack of projection support."),null;if(!this._projectionEngineLoaded&&(this._loadAsyncModule(u.load()).then(function(){a._set("_projectionEngineLoaded",!0)}),!this._projectionEngineLoaded))return null;var f=null;try{f=u.project(c,e.SpatialReference.WGS84)}catch(oa){}if(f)try{f=
u.project(this._geometryEngine.geodesicBuffer(f,d,b),c.spatialReference)}catch(oa){f=null}f||X.error("Filter by geodesic buffer (distance) unsupported, failed to project input geometry ("+c.spatialReference.wkid+") to WGS84.");return f},enumerable:!0,configurable:!0});l.prototype.initialize=function(){for(var a=this,b=0,c=["layer.renderer","definitionExpressionFields","filter"];b<c.length;b++){var d=c[b];this.updatingHandles.add(this,d,function(){return a._updateRequiredFields()})}this._updateRequiredFields();
this.updatingHandles.add(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)},2);this.updatingHandles.add(this.layer,"renderer",function(b){return a._rendererChange(b)},2);b=0;for(c=["parsedDefinitionExpression","layer.objectIdFilter","filter","parsedFilterWhereClause","parsedFilterGeometry"];b<c.length;b++)d=c[b],this.updatingHandles.add(this,d,function(){return a._filterChange()})};l.prototype.destroy=function(){};l.prototype._updateRequiredFields=function(){return g(this,void 0,
void 0,function(){var b,c,d,e,f,g,h,k;return a(this,function(a){switch(a.label){case 0:return b=this,d=c=b.layer,e=d.fields,f=d.renderer,g=b.definitionExpressionFields,h=b.filter,k=new Set,f?[4,f.collectRequiredFields(k,e)]:[3,2];case 1:a.sent(),a.label=2;case 2:return r.isSome(h)?[4,v.collectFilterFields(k,c,h)]:[3,4];case 3:a.sent(),a.label=4;case 4:return v.collectFields(k,e,g),this._set("requiredFields",q.valuesOfSet(k).sort()),[2]}})})};l.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&
X.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};l.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return r.isSome(this.filter)?this.filter.createQuery(a):new z(a)};l.prototype.queryExtent=function(a){return c.safeCast(this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(a)))};l.prototype.queryFeatureCount=function(a){return c.safeCast(this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(a)))};
l.prototype.queryFeatures=function(a){return c.safeCast(this._ensureQueryEngine().executeQuery(this._ensureQuery(a)))};l.prototype.queryObjectIds=function(a){return c.safeCast(this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(a)))};l.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};l.prototype._createQueryEngine=function(){var a=this,b=this._createGetFeatureExtent();return new K.default({layerView:this,
task:Y.Task.FEATURE_QUERY_ENGINE,spatialIndex:new Q.default({featureAdapter:new I.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:b}),forAllFeatures:function(b,c){return a._forAllFeatures(function(a,c,d){return b({id:a,index:c,meta:d})},c,2)},getFeatureExtent:b,sourceSpatialReference:J.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};l.prototype._createGetFeatureExtent=function(){var a=
this,b=new Float64Array(24),c=this.view.renderSpatialReference,d=this.view.spatialReference;return function(e){if(!e.meta.featureExtents){var f=new Float64Array(6*e.meta.featureIds.length);e.meta.featureExtents=f;for(var g=0;g<f.length;g+=6)f[g]=Number.POSITIVE_INFINITY}f=new Float64Array(e.meta.featureExtents.buffer,6*e.index*Float64Array.BYTES_PER_ELEMENT,6);return f[0]===Number.POSITIVE_INFINITY?(a._boundingBoxCornerPoints(e.index,e.meta.engineObject,b),S.bufferToBuffer(b,c,0,b,d,0,8)?y.expandWithBuffer(y.NEGATIVE_INFINITY,
b,0,8,f):y.set(f,y.ZERO)):f}};l.prototype.highlight=function(a,b){void 0===b&&(b={});var c=this._highlights;if(a instanceof z){var d=c.acquireSet(b),e=d.set,d=d.handle;this.queryObjectIds(a).then(function(a){return c.setFeatureIds(e,a)});return d}return this.inherited(arguments)};l.prototype._createLayerGraphic=function(a){a=new d(null,null,a);a.layer=this.layer;a.sourceLayer=this.layer;return a};l.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};
l.prototype.isUpdating=function(){return this.updatingMeshView3D||0<this._asyncModuleLoading};l.prototype.getFilters=function(){var a=this,b=this.inherited(arguments);if(this.layer.objectIdFilter){var c=new Float64Array(this.layer.objectIdFilter.ids),d="include"===this.layer.objectIdFilter.method;c.sort();b.push(function(b){return a._objectIdFilter(c,d,b)})}this.addSqlFilter(b,this.parsedDefinitionExpression,this.definitionExpressionFields,this.logError);if(r.isSome(this.filter)){if(r.isSome(this.parsedFilterGeometry)){var e=
this.parsedFilterGeometry;b.push(function(b,c){return a._maskFilter(b,c,e)})}if(this.filter.objectIds){var f=new Float64Array(this.filter.objectIds);f.sort();b.push(function(b){return a._objectIdFilter(f,!0,b)})}}r.isSome(this.parsedFilterWhereClause)&&this.addSqlFilter(b,this.parsedFilterWhereClause,this.parsedFilterWhereClause.fieldNames,this.logError);return b};l.prototype._maskFilter=function(a,b,c){if(!r.isNone(this.filter)){S.mbsToMbs(b.node.mbs,this._controller.crsIndex,V,c.spatialReference||
this.view.spatialReference);var d=D.acquireMaskFilterContext(this.filter.spatialRelationship,this.view,c,b.engineObject);c=D.intersectMaskWithMbs(d,V);switch(D.getIntersectRelation(d,c)){case 1:a.length=0;return;case 0:return}b.engineObject.geometryRecords[0].geometry.componentCount===b.featureIds.length&&J.filterInPlace(a,b.featureIds,function(a){return D.filterMask(a,d)})}};l.prototype._filterChange=function(){var a=this;r.isSome(this.filter)&&this.filter.geometry&&!this._geometryEngine?this._loadAsyncModule(D.loadGeometryEngine()).then(function(b){a.destroyed||
(a._set("_geometryEngine",b),a._applyFilters(!0))}):this.inherited(arguments)};l.prototype._loadAsyncModule=function(a){var b=this;this._set("_asyncModuleLoading",this._asyncModuleLoading+1);var c=function(){return b._set("_asyncModuleLoading",b._asyncModuleLoading-1)};return a.then(function(a){c();return a},function(a){c();throw a;})};l.prototype._objectIdFilter=function(a,b,c){for(var d=0,e=0;d<c.length;)0<=f.binaryIndexOf(a,c[d])===b&&(c[e]=c[d],e++),d++;c.length=e};l.prototype._ensureQuery=function(a){return this._addDefinitionExpressionToQuery(r.isNone(a)?
this.createQuery():z.from(a))};h([x.property()],l.prototype,"layer",void 0);h([x.property({dependsOn:["updatingMeshView3D","_asyncModuleLoading"]})],l.prototype,"updating",void 0);h([x.property({dependsOn:["_controller.rootNodeVisible"]})],l.prototype,"suspended",void 0);h([x.property(M.updatingPercentage)],l.prototype,"updatingPercentage",void 0);h([x.property({type:U})],l.prototype,"filter",null);h([x.property({readOnly:!0,dependsOn:["filter.where"]})],l.prototype,"parsedFilterWhereClause",null);
h([x.property({readOnly:!0,dependsOn:["filter.geometry","filter.distance","filter.units","_geometryEngine","_projectionEngineLoaded"]})],l.prototype,"parsedFilterGeometry",null);h([x.property(P.requiredFields)],l.prototype,"requiredFields",void 0);h([x.property(P.availableFields)],l.prototype,"availableFields",void 0);h([x.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],l.prototype,"lodFactor",void 0);h([x.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],
l.prototype,"updatingPercentageValue",void 0);h([x.property({readOnly:!0})],l.prototype,"_asyncModuleLoading",void 0);h([x.property({readOnly:!0})],l.prototype,"_geometryEngine",void 0);h([x.property({readOnly:!0})],l.prototype,"_projectionEngineLoaded",void 0);return l=h([x.subclass("esri.views.3d.layers.SceneLayerView3D")],l)}(x.declared(B.I3SMeshView3D(N.DefinitionExpressionSceneLayerView(R.PopupSceneLayerView(C.LayerView3D(T))))))})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Color ../../../Graphic ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/iteratorUtils ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/requireUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../layers/graphics/controllers/I3SOnDemandController ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeUtils ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SElevationProvider ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/edgeUtils ./support/layerViewUpdatingProperties ./support/symbolColorUtils ../support/debugFlags ../support/orientedBoundingBox ../support/projectionUtils ../support/buffer/glUtil ../webgl-engine/lib/Geometry ../webgl-engine/lib/Layer ../webgl-engine/lib/Object3D ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/TextureBackedBuffer/BufferManager ../webgl-engine/materials/component/index module @dojo/framework/shim/Promise".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T,U,Y,X,P,V,Z,ca,da,F,ea,la,ka,oa,va,fa,xa,ia,na,wa,Ca,ua,ya){function G(a){var b=a.metallicRoughness;return b&&0<=b.baseColorTextureId||b&&0<=b.metallicRoughnessTextureId||0<=a.normalTextureId||0<=a.emissiveTextureId||0<=a.occlusionTextureId}function Ea(a){return x.isSome(a)&&m.isArrayBuffer(a.data)}function za(a,b){for(var c=1024,d=0;d<a.length;d++)var e=a[d],c=c+(e.interleavedVertexData.byteLength+(e.indices?e.indices.byteLength:
0)),c=c+(e.positionData.data.byteLength+e.positionData.indices.byteLength);if(x.isSome(b))for(a=0;a<b.length;a++)d=b[a],x.isSome(d)&&m.isArrayBuffer(d.data)&&(c+=d.data.byteLength);return c}function H(a,b){return 104857600<b.byteSize?(qa.warn("Node is too big to store in IndexedDB cache: "+a.id+" ("+b.byteSize+" bytes)"),!1):0<b.byteSize}Object.defineProperty(b,"__esModule",{value:!0});var qa=r.getLogger("esri.views.3d.layers.SceneLayerView3D"),sa=[1,1,1,1],W=function(){return function(){}}();b.I3SMeshView3D=
function(b){return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a._layerUid="";a._highlights=new U(a);a._elevationProvider=null;a._worker=new S;a._workerThread=null;a._nodeId2Meta=new Map;a._addTasks=new Map;a._rendererVersion=0;a._rendererFields=null;a._colorVariable=null;a._opacityVariable=null;a._symbolInfos=new Map;a._idbCache=new V.IDBCache("esri-scenelayer-cache","geometries");a._hasColors=!1;a._hasTextures=!1;a._hasData=!1;a.slicePlaneEnabled=!1;a._layerUrl="";a._cacheKeySuffix=
null;a._tmpAttributeOnlyGraphic=new d(null,null,{});return a}k(e,b);Object.defineProperty(e.prototype,"updatingMeshView3D",{get:function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"rendererTextureUsage",{get:function(){return P.rendererNeedsTextures(this._currentRenderer)?31:12},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"elevationOffset",{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=v.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=R.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"uncompressedTextureDownsamplingEnabled",
{get:function(){return this.view&&this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"useCompressedTextures",{get:function(){var a=this.layer.version,a=!q("trident")||1<a.major||1===a.major&&3<a.minor;return this.view._stage.renderView.has("s3tc")&&a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_atlasBiasCompensationEnabled",{get:function(){return this.view&&this.view._stage&&!this.view._stage.renderView.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},
enumerable:!0,configurable:!0});e.prototype.initialize=function(){var a=this;B.open(u.getAbsMid("./SceneLayerWorker",n,ya)).then(function(b){a.destroyed?b.close():a._workerThread=b});P.checkSceneLayerValid(this.layer);P.checkSceneLayerCompatibleWithView(this.layer,this.view);this._layerUid=this.layer.uid;this._layerUrl=this.layer.parsedUrl.path;this._controller=new J({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;if(this._isIntegratedMesh||
!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var b=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(b&&b.faceRange&&b.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid,
function(b){return a._deleteNodeStageData(b)});this._addThisLayerToStage();this._elevationProvider=new Y({layerView:this,stageLayer:this._stageLayer});this.updatingHandles.add(this,"view.clippingArea",function(){return a._clippingAreaChanged()},2);this.updatingHandles.add(this,"fullOpacity",function(b){return a._opacityChange(b)});this.updatingHandles.add(this,"slicePlaneEnabled",function(b){return a._slicePlaneEnabledChange(b)});this.updatingHandles.add(this,"elevationOffset",function(b,c){return a._reloadAll(c)});
this.updatingHandles.add(this,"filter",function(){return a._filterChange()},2);this.view.watch("qualitySettings.physicallyBasedRenderingEnabled",function(b){return a._enablePhysicalBasedRendering(b)});b=function(){a._reloadAll();a._memCache.clear()};this.updatingHandles.add(this,"rendererTextureUsage",b);this.updatingHandles.add(this,"uncompressedTextureDownsamplingEnabled",b);this.updatingHandles.add(this,"suspended",function(b){return a._suspendedChange(b)},2);this.handles.add(z.init(ea,"I3S_TREE_SHOW_TILES",
function(b){if(b&&!a._treeDebugger){var c=a._controller.crsIndex;(new Promise(function(a,b){n(["./support/I3STreeDebugger"],a,b)})).then(function(b){b=b.I3STreeDebugger;!a._treeDebugger&&ea.I3S_TREE_SHOW_TILES&&(a._treeDebugger=new b({lv:a,view:a.view,nodeSR:c}))})}else b||!a._treeDebugger||ea.I3S_TREE_SHOW_TILES||(a._treeDebugger.destroy(),a._treeDebugger=null)}));this._cacheKeySuffix=P.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(function(a){return qa.warn("Failed to initialize IndexedDB cache: "+
a)});this._componentColorManager=this._hasSymbolColors?new Ca.BufferManager(this._stage.renderView.renderingContext):null};e.prototype.destroy=function(){this._workerThread&&(this._workerThread.close(),this._workerThread=null);this._removeAllNodeDataFromStage();this._memCache.destroy();this._memCache=null;this._removeThisLayerFromStage();this._stage=null;this._idbCache&&(this._idbCache.destroy(),this._idbCache=null);this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);null!=
this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2Meta=null;this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};e.prototype.memEstimateTextureAdded=function(a){a=a.getEstimatedTexMemRequired();this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a;return a};e.prototype.memEstimateTextureRemoved=function(a){a=
a.getEstimatedTexMemRequired();this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a};e.prototype.memEstimateGeometryAdded=function(a){a=a.estimateGpuMemoryUsage();this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=a;return a};e.prototype.memEstimateGeometryRemoved=function(a){a=a.estimateGpuMemoryUsage();this.gpuMemoryEstimate-=a;this.geoMemoryEstimate-=a};e.prototype.isNodeLoaded=function(a){return this._nodeId2Meta.has(a)};e.prototype.getUsedMemory=function(){var a=0;this._nodeId2Meta.forEach(function(b){return a+=
b.node.memory});return a};e.prototype.getUnloadedMemory=function(){return this._controller?this._controller.unloadedMemoryEstimate:0};e.prototype.ignoresMemoryFactor=function(){return!1};e.prototype._suspendedChange=function(a){a?(this._removeAllNodeDataFromStage(),this.view.elevationProvider.unregister(this._elevationProvider)):this.view.elevationProvider.register(this._elevationContext,this._elevationProvider)};e.prototype.getStats=function(){var a={index:0,nodes:this._nodeId2Meta.size.toString(),
"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB"};this._controller&&(this._cachingEnabled()&&(a.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a};e.prototype._addThisLayerToStage=function(){var a=""+this.layer.uid;this._stageLayer=a=new fa(a,{},a);this._stage.add(0,a);
this._stage.addToViewContent([a.id])};e.prototype._removeThisLayerFromStage=function(){if(null!=this._stageLayer){var a=this._stage;this._removeAllNodeDataFromStage();wa.verify(0===this._nodeId2Meta.size);a.remove(0,this._stageLayer.id);this._stageLayer=void 0;this.gpuMemoryEstimate=0}};e.prototype.getLoadedAttributes=function(a){if((a=this._nodeId2Meta.get(a))&&a.attributeInfo)return a.attributeInfo.loadedAttributes};e.prototype.getAttributeData=function(a){if((a=this._nodeId2Meta.get(a))&&a.attributeInfo)return a.attributeInfo.attributeData};
e.prototype.setAttributeData=function(a,b){if(a=this._nodeId2Meta.get(a))a.attributeInfo=b,a.cachedRendererVersion=this._getInvalidRendererVersion(),a.filteredIds=null,this._updateEngineObject(a)};e.prototype.getLoadedNodeIds=function(){var a=[];this._nodeId2Meta.forEach(function(b){return a.push(b.node.id)});return a.sort()};e.prototype.getLoadedNodes=function(){var a=[];this._nodeId2Meta.forEach(function(b){return a.push(b.node)});return a};e.prototype.getLoadedNodeIndices=function(a){this._nodeId2Meta.forEach(function(b,
c){return a.push(c)})};e.prototype._calcEngineMaterialTransparencyParams=function(a,b,c){void 0===b&&(b=!1);void 0===c&&(c=!1);if(this._isIntegratedMesh)return{baseColorOpacity:1,layerOpacity:1,forceTransparency:!1};var d=this.fullOpacity,e=t.clamp(a.metallicRoughness.baseColorFactor[3],0,1);return{baseColorOpacity:e,layerOpacity:d,forceTransparency:1>e||1>d||!b&&"blend"===a.alphaMode||c}};e.prototype._getMaterialParameters=function(a,b,c){var d=a.metallicRoughness.baseColorFactor,e=this._isIntegratedMesh,
f=this._calcEngineMaterialTransparencyParams(a),g=this.rendererTextureUsage,h=function(a){if(0!==(a&g))a:{if(!x.isNone(b))for(var d=0;d<b.length;d++){var e=b[d];if(x.isSome(e)&&0!==(e.usage&a)){a=c[d].id;break a}}a=null}else a=null;return a};return l({usePBR:!e&&(a.isSchematic?this.view.qualitySettings.physicallyBasedRenderingEnabled:!0),baseColor:[d[0],d[1],d[2]],metallicFactor:a.metallicRoughness.metallicFactor,roughnessFactor:a.metallicRoughness.roughnessFactor,emissiveFactor:a.emissiveFactor,
reflectanceFactor:a.isSchematic?.2:.5,baseColorTexture:h(1),metallicRoughnessTexture:h(2),normalTexture:h(4),emissiveTexture:h(16),occlusionTexture:h(8),doubleSidedShading:a.doubleSided,cullFace:a.cullFace,writeStencil:e,receiveSSAO:!e,normals:e?"ground":"vertex"},f)};e.prototype._getGeometryParameters=function(a){return{textureCoordinates:a.hasTexture,textureCoordinateRegions:a.hasTexture&&a.hasRegions,colors:this._hasVertexColors,componentData:this._hasSymbolColors,normals:this._isIntegratedMesh?
"none":a.hasNormals?"compressed":"screen-space"}};e.prototype._createTexture=function(a,b,c,d){if(x.isNone(c)||null==c.data)return null;var e=c.data,f=b.wrapTextures;b=c.usage&1?"opaque"===b.alphaMode?3:4:3;var g=!0,h;c.encoding===P.DDS_ENCODING_STRING?h=na.DDS_ENCODING:g=t.isPowerOfTwo(e.width)&&t.isPowerOfTwo(e.height);g=(d?this._enableAtlasMipMaps:this._enableMipMaps)&&g;c=new na(e,a.id+"/"+c.id,{mipmap:g,wrap:d||!f?{s:33071,t:33071}:{s:10497,t:10497},disableAnisotropy:d&&g&&this._disableAtlasAnisotropy,
encoding:h,noUnpackFlip:!0,components:b});this._stage.add(4,c);a.memory+=this.memEstimateTextureAdded(c);return c};e.prototype._getVertexBufferLayout=function(a,b){a={hasTexture:G(a.params.material),hasNormals:null!=b.vertexAttributes.normal,hasRegions:null!=b.vertexAttributes.region};return oa.glLayout(ua.ComponentMaterial.vertexBufferLayout(this._getGeometryParameters(a)))};e.prototype._createEngineMaterial=function(a,b,c,d){var e=this,f=b.params.material,g=d.some(function(a){return"region"===a.name});
b=x.isSome(c)?c.map(function(b){return e._createTexture(a,f,b,g)}):[];d=d.some(function(a){return"normalCompressed"===a.name});var h=G(f);c=this._getMaterialParameters(f,c,b);d=this._getGeometryParameters({hasTexture:h,hasRegions:g,hasNormals:d});c=ua.ComponentMaterial.create(c,d,""+a.id);c.metadata={material:f,textures:b,isSchematic:f.isSchematic};return c};e.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};e.prototype._findGraphicNodeAndIndex=function(a){var b=
Z.attributeLookup(a.attributes,this._getObjectIdField()),c=null;p.everyMap(this._nodeId2Meta,function(a,d){d=a.featureIds.indexOf(b);if(-1===d)return!0;c={node:a.node,index:d};return!1});return c};e.prototype._getGraphicIndices=function(a,b){a=this._nodeId2Meta.get(a.index);if(!a)return[];for(var c=[],d=this._getObjectIdField(),e=0;e<b.length;e++){var f=Z.attributeLookup(b[e].attributes,d),f=a.featureIds.indexOf(f);-1!==f&&c.push(f)}return c};e.prototype.whenGraphicBounds=function(a){a=this._findGraphicNodeAndIndex(a);
if(!a)return w.reject();var b=this._nodeId2Meta.get(a.node.index).engineObject;a=this._boundingBoxCornerPoints(a.index,b,new Float64Array(24));if(ka.bufferToBuffer(a,this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))return b=Q.empty(),Q.expandWithBuffer(b,a,0,8),w.resolve({boundingBox:b,screenSpaceObjects:[]})};e.prototype.whenGraphicAttributes=function(a,b){var c=this;return P.whenGraphicAttributes(this.layer,a,this._getObjectIdField(),b,function(a){for(var b=new Map,d=[],e=0;e<
a.length;e++){var f=a[e],g=c._findGraphicNodeAndIndex(f),h=b.get(g.node);h||(h={node:g.node,indices:[],graphics:[]},d.push(h));h.indices.push(g.index);h.graphics.push(f)}return d},{ignoreUnavailableFields:!0,populateObjectId:!0})};e.prototype.getGraphicFromStageObject=function(a,b){if(this._isIntegratedMesh)return null;var c=this._getMetadata(a);a=a.getComponentFromTriangleNr(0,b);return null!=a&&null!=c.featureIds&&a<c.featureIds.length?this._createGraphic(a,c):null};e.prototype.hasStageObject=function(a){var b=
a.getMetadata();return(b=this._nodeId2Meta.get(b.nodeIndex))&&b.engineObject===a};e.prototype._getMetadata=function(a){a=a.getMetadata();return this._nodeId2Meta.get(a.nodeIndex)};e.prototype._getCacheKey=function(a){return this._layerUrl+"/v6/"+a.id+this._cacheKeySuffix};e.prototype._getMemCacheKey=function(a,b){void 0===b&&(b=this.elevationOffset);return a+"#"+b};e.prototype._cachingEnabled=function(){return!this._controller.disableIDBCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix};
e.prototype.loadCachedGPUData=function(a){return this._memCache.pop(this._getMemCacheKey(a.index))};e.prototype.loadMissingTextures=function(a,b,c,d){var e=this,f=a.filter(function(a,c){if(0===(a.usage&e.rendererTextureUsage))return!1;if(x.isNone(b))return!0;a=P.selectEncoding(a.encodings,e.useCompressedTextures);c=b[c];return x.isNone(c)||null==c.data||a&&c.encoding!==a.encoding?!0:!1});return 0===f.length?w.resolve(!1):c(f,d).then(function(c){for(var d=0,e=0;e<a.length;e++)d<c.length&&c[d].id===
a[e].id&&(b[e]=c[d],d++);return!0})};e.prototype.loadCachedNodeData=function(a,b,c){var d=this;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(a),b).then(function(e){if(null==e)return null;if(e.nodeVersion!==a.version)return d._idbCache.remove(d._getCacheKey(a)),null;a.obb||(a.obb=la.clone(e.nodeObb),d._controller.updateVisibility(a.index));return d.loadMissingTextures(e.requiredTextures,e.textureData,c,b).then(function(c){c&&d._idbCache.initialized&&x.isSome(e.textureData)&&(e.byteSize=
za(e.transformedGeometries,e.textureData),e.textureData.every(Ea)&&H(a,e)&&d._idbCache.put(d._getCacheKey(a),e).catch(function(b){return qa.warn("Failed to update node with textures in IndexedDB cache: "+a.id+": "+b)}));w.throwIfAborted(b);return e})}):w.resolve(null)};e.prototype.addNodeData=function(a,b){var c=this;if(0===b.allGeometryData.length||0===b.allGeometryData[0].geometries.length)return w.resolve();1!==b.allGeometryData.length&&console.warn("Node with",b.allGeometryData.length,"geometries is unsupported");
return this._addData(a,b.attributeDataInfo,function(){return c._transformNode(a,b).then(function(b){return c._controller.reschedule(a.index,b)}).then(function(d){a.obb||(a.obb=d.obb,c._controller.updateVisibility(a.index));b.allGeometryData[0].componentOffsets=d.componentOffsets;d.featureIds&&(b.allGeometryData[0].featureIds=Array.prototype.slice.call(d.featureIds));d={geometryData:b.allGeometryData[0],transformedGeometries:d.transformedGeometries,requiredTextures:b.requiredTextures,textureData:b.textureData,
nodeVersion:a.version,nodeObb:a.obb,byteSize:c._cachingEnabled()?za(d.transformedGeometries,b.textureData):0};if(H(a,d)&&c._idbCache.initialized){var e=x.isSome(d.textureData)?d.textureData.map(function(a){return Ea(a)?a:null}):null;c._idbCache.put(c._getCacheKey(a),l({},d,{textureData:e})).catch(function(b){return qa.warn("Failed to store node in IndexedDB cache: "+a.id+": "+b)})}return c._addCachedNodeData(a,d)})})};e.prototype._transformNode=function(a,b){for(var c=this,d=b.allGeometryData[0].geometries,
e=Array(d.length),f=0;f<d.length;++f)e[f]=this._getVertexBufferLayout(d[f],b.geometryIndex);var g={geometryBuffer:b.geometryBuffer,geometryData:b.allGeometryData[0],geometryIndex:b.geometryIndex,layouts:e,mbs:a.mbs,obb:a.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};
return this._workerThread?this._workerThread.invoke("process",g,{transferList:[b.geometryBuffer]}):S.ensureDracoDecoder(g).then(function(){return c._controller.reschedule(a.index,g).then(function(a){return c._worker.transform(a)})})};e.prototype.addCachedGPUData=function(a,b,c){if(this._controller.isGeometryVisible(a)){this._nodeId2Meta.set(a.index,b);this.updateNodeStatus(a.index,c);b.engineObject.setHidden(b.engineObject.geometryRecords[0],!1);a=0;for(c=b.engineObject.geometryRecords;a<c.length;a++){var d=
c[a].material;d.updateParameters({slicePlaneEnabled:this.slicePlaneEnabled,usePBR:!this._isIntegratedMesh&&(d.metadata.isSchematic?this.view.qualitySettings.physicallyBasedRenderingEnabled:!0)})}this._updateEngineObject(b);this._highlights.objectCreated(b.engineObject);this._treeDebugger&&this._treeDebugger.update()}else c=this._controller.indexDepth-a.level,this._memCache.put(this._getMemCacheKey(a.index),b,a.memory,c)};e.prototype.addCachedNodeData=function(a,b,c){var d=this;return this._addData(a,
c,function(){return d._addCachedNodeData(a,b)})};e.prototype._addCachedNodeData=function(a,b){var c=this;if(this.suspended||!this._controller.isGeometryVisible(a))return w.resolve();var d=b.geometryData,e=b.transformedGeometries,f=x.isSome(b.textureData)?b.textureData.filter(function(a){return x.isSome(a)&&0!==(a.usage&c.rendererTextureUsage)}):null,g=new Map;g.set(1,{});g.set(2,{});g.set(3,{});var h=0,k=!1;a.memory=0;var l=d.componentOffsets,m=d.geometries,d=d.featureIds,n=null,p=null;if(this._hasSymbolColors)for(var n=
this._componentColorManager.getBuffer(d.length),p=new Uint16Array(d.length),q=0;q<d.length;q++)p[q]=n.acquireIndex();for(var q=a.id+"|"+d[0],r=[],v=[],t=[],u=[],y=this.view,z,B=0;B<m.length;B++){var A=m[B],C=e[h++],F=this._createEngineMaterial(a,A,f,C.layout);z=C.corMatrices.globalTrafo;k=k||C.hasColors;C=new ia(new Float32Array(C.interleavedVertexData),C.layout,C.positionData,l||ia.DefaultOffsets,C.indices||ia.DefaultIndices);this._hasSymbolColors&&this._setComponentIndices(C,p);var A=null!=A.transformation?
D.mat4f64.clone(A.transformation):ga,G=r.length,C=new va(C,q+(0<G?"_"+G:"")),G=y.renderSpatialReference;r.push(C);t.push(A);u.push(F);A=X.createOrigin(a.mbs,this.elevationOffset,this._controller.crsIndex,G);v.push(A);a.memory+=this.memEstimateGeometryAdded(C.data);g.get(3)[F.id]=F;g.get(2)[C.id]=C}var I=new xa({idHint:a.id,geometries:r,materials:u,transformations:t,origins:v,castShadow:!0,metadata:{nodeIndex:a.index,layerUid:this._layerUid}});I.objectTransformation=z;g.get(1)[I.id]=I;var H=this._addTasks.get(a.index),
J=new W;J.node=a;J.engineObject=I;J.featureIds=d;J.componentColorBuffer=n;J.componentIndices=p;J.cachedRendererVersion=this._getInvalidRendererVersion();J.cachedSymbolInfos=[];J.attributeInfo=H.attributeInfo;!this._hasTextures&&b.requiredTextures.some(function(a){return 0!==(a.usage&19)})&&(this._hasTextures=!0);this._hasColors||(this._hasColors=k);this._hasData=!0;this.notifyChange("hasTexturesOrVertexColors");var K=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(J).then(function(){var b=
c._stageLayer,d=c._stage,e=g.get(1),f;for(f in e)e.hasOwnProperty(f)&&b.addObject(e[f]);g.forEach(function(a,b){for(var c in a)a.hasOwnProperty(c)&&null==d.getContent(b,c)&&d.add(b,a[c])});c._nodeId2Meta.has(a.index)&&(qa.warn("Removing duplicated node"),c._deleteNodeStageData(c._nodeId2Meta.get(a.index)));c._nodeId2Meta.set(a.index,J);if(c.suspended)c._removeNodeStageData(a.index,c.elevationOffset);else{J.attributeInfo=H.attributeInfo;J.cachedRendererVersion===c._rendererVersion&&K===c.slicePlaneEnabled||
c._addOrUpdateEdgeRendering(J);c._setObjectSymbology(J);c._applyFiltersToNode(J)&&c._updateEdgeRendering(J);c.visibleGeometryChanged(I);c._highlights.objectCreated(I);b=0;for(e=J.engineObject.geometryRecords;b<e.length;b++)e[b].material.updateParameters({slicePlaneEnabled:c.slicePlaneEnabled});c._markParentsAsHole(a.index);c._treeDebugger&&c._treeDebugger.update()}})};e.prototype._addData=function(a,b,c){var d=this,e=this._addTasks.get(a.index);e?e.attributeInfo=b:(e=l({},w.createResolver(),{attributeInfo:b}),
this._addTasks.set(a.index,e),c().then(e.resolve,e.reject).then(function(){return d._addTasks.delete(a.index)}).catch(function(b){d._addTasks.delete(a.index);throw b;}));return e.promise};e.prototype._markParentsAsHole=function(a){if(this._isIntegratedMesh){var b=this._controller;for(a=b.getParentIndex(a);a;a=b.getParentIndex(a))this.updateNodeStatus(a,"hole")}};e.prototype._clippingAreaChanged=function(){var a=Q.create();ka.extentToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?
this._clippingArea=a:this._clippingArea=null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};e.prototype._filterChange=function(){this._applyFilters(!1)};e.prototype._applyFilters=function(a){var b=this;this._filters=this.getFilters();a?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(function(a){b._applyFiltersToNode(a)&&(b._addOrUpdateEdgeRendering(a),b.visibleGeometryChanged(a.engineObject))})};e.prototype.getFilters=
function(){var a=this,b=[];this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,c,a._clippingArea)});return b};e.prototype.addSqlFilter=function(a,b,c,d){var e=this;b&&c&&a.push(function(a,f){return e._sqlFilter(a,f,b,c,d)})};e.prototype._sqlFilter=function(a,b,c,d,e){var f={},g=this._createLayerGraphic(f),h=this.layer.objectIdField,k=b.featureIds,l=b.attributeInfo.attributeData;d.every(function(a){return null!=l[a]||a===h})&&P.filterInPlace(a,k,function(a){f[h]=k[a];for(var b=0;b<
d.length;b++){var m=d[b];m!==h&&(f[m]=P.getCachedAttributeValue(l[m],a))}try{return c.testFeature(g)}catch(gb){return e(gb),!1}})};e.prototype._boundingboxNodeTest=function(a,b){ka.mbsToMbs(a.node.mbs,this._controller.crsIndex,Ga,this.view.renderSpatialReference);return P.intersectBoundingBoxWithMbs(b,Ga)};e.prototype._boundingboxFeatureTest=function(a,b,c){return Q.intersects(c,a.engineObject.geometryRecords[0].geometry.getComponentAABB(b,Ta))};e.prototype._boundingboxFilter=function(a,b,c){var d=
this,e=this._boundingboxNodeTest(b,c);if(3!==e)if(0===e)a.length=0;else if(b.engineObject.geometryRecords[0].geometry.componentCount===b.featureIds.length){var f=P.getClipAABB(c,b.engineObject);P.filterInPlace(a,b.featureIds,function(a){return d._boundingboxFeatureTest(b,a,f)})}};e.prototype._addOrUpdateEdgeRendering=function(a,b){void 0===b&&(b=!0);if(!this._edgeView)return w.resolve();var c=a.engineObject,d=this._edgeView.hasObject(c),e=this._extractObjectEdgeMaterials(a);a=e.perFeatureEdgeMaterials;
var g={slicePlaneEnabled:this.slicePlaneEnabled};if(e.hasEdges)if(e=!c.isHidden(c.geometryRecords[0]),d)this._edgeView.updateAllComponentMaterials(c,a,g,b),this._edgeView.updateObjectVisibility(c,e);else{if(e)return f.safeCast(this._edgeView.addObject(c,a,g,!1))}else d&&this._edgeView.removeObject(c);return w.resolve()};e.prototype._removeEdgeRendering=function(a){this._edgeView&&this._edgeView.hasObject(a.engineObject)&&this._edgeView.removeObject(a.engineObject)};e.prototype._applyFiltersToNode=
function(a){var b=a.engineObject,c=b.areAllComponentsVisible();b.unhideAllComponents();if(0===this._filters.length)return!c;var d=a.featureIds;if(null==a.filteredIds||a.appliedFilters!==this._filters)a.filteredIds=this._computeFilteredIds(a),a.appliedFilters=this._filters;a=a.filteredIds;if(a===d)return!c;for(var c=b.geometryRecords[0],e=0,f=0;f<d.length;f++){var g=d[f];e>=a.length||a[e]!==g?b.setComponentVisibility(c,f,!1):e++}return!0};e.prototype._computeFilteredIds=function(a){for(var b=a.featureIds.slice(),
c=0,d=this._filters;c<d.length;c++)(0,d[c])(b,a);return b.length===a.featureIds.length?a.featureIds:b};e.prototype._removeAllNodeDataFromStage=function(a){var b=this;void 0===a&&(a=this.elevationOffset);this._nodeId2Meta.forEach(function(c,d){return b._removeNodeStageData(d,a)})};e.prototype.removeNodeData=function(a,b){for(var c=this.elevationOffset;0<a.length&&!b.done;){var d=a.pop();this._removeNodeStageData(d,c);b.madeProgress()}};e.prototype._removeNodeStageData=function(a,b){var c=this._nodeId2Meta.get(a);
if(c){var d=c.engineObject;d.setHidden(d.geometryRecords[0],!0);this.visibleGeometryChanged(d);this._removeEdgeRendering(c);this._nodeId2Meta.delete(a);this._highlights.objectDeleted(d);d=this._controller.indexDepth-c.node.level+1;this._memCache.put(this._getMemCacheKey(a,b),c,c.node.memory,d);this._treeDebugger&&this._treeDebugger.update()}};e.prototype._deleteNodeStageData=function(a){var b=this._stage,c=this._stageLayer,d=a.engineObject;this._edgeView&&this._edgeView.removeObject(d);c.removeObject(d);
for(var c=0,e=d.geometryRecords;c<e.length;c++){var f=e[c];this.memEstimateGeometryRemoved(f.geometry.data);b.remove(2,f.geometry.id);this._removeMaterial(f.material,b)}if(a.componentIndices){for(c=0;c<a.componentIndices.length;c++)a.componentColorBuffer.releaseIndex(a.componentIndices[c]);this._componentColorManager.garbageCollect()}b.remove(1,d.id)};e.prototype._removeMaterial=function(a,b){b.remove(3,a.id);var c=0;for(a=a.metadata.textures;c<a.length;c++){var d=a[c];d&&(this.memEstimateTextureRemoved(d),
b.remove(4,d.id))}};e.prototype.updateNodeStatus=function(a,b){if(a=this._nodeId2Meta.get(a)){b="hole"===b;var c=0;for(a=a.engineObject.geometryRecords;c<a.length;c++)a[c].material.updateParameters({polygonOffsetEnabled:b})}};e.prototype._getInvalidRendererVersion=function(){return P.addWraparound(this._rendererVersion,-1)};e.prototype._rendererChange=function(b){return g(this,void 0,void 0,function(){var c,d,e,f,g,h,k,l;return a(this,function(a){switch(a.label){case 0:this._currentRenderer=b;this.notifyChange("rendererTextureUsage");
this._rendererVersion=P.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;if(!b)return[3,2];c=this;d=P.findFieldsCaseInsensitive;return[4,b.getRequiredFields(this.layer.fields)];case 1:c._rendererFields=d.apply(void 0,[a.sent(),this.layer.fields]),a.label=2;case 2:if(b&&"visualVariables"in b&&b.visualVariables)for(e=0,f=b.visualVariables;e<f.length;e++)g=f[e],"color"===g.type?this._colorVariable=g:"opacity"===g.type?this._opacityVariable=g:
qa.warn("Unsupported visual variable type for 3D Object Scene Services: "+g.type);if(b)for(h=0,k=b.getSymbols();h<k.length;h++)l=k[h],"mesh-3d"!==l.type&&qa.error("Symbols of type '"+l.type+"' are not supported for 3D Object Scene Services.");this._controller&&this._controller.requestUpdate();return[2]}})})};e.prototype._getSymbolInfos=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedSymbolInfos};e.prototype._getSymbolColors=
function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedSymbolColors};e.prototype._updateCachedRendererData=function(a){a.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var b=a.featureIds?a.featureIds.length:1,c={},d=this._tmpAttributeOnlyGraphic;d.attributes=c;var e=this._currentRenderer,f=a.attributeInfo.attributeData,g=null!=a.featureIds?this.layer.objectIdField:null,h=null!=f?this._rendererFields:
null;null==a.cachedSymbolColors&&(a.cachedSymbolColors=new Uint8Array(4*a.featureIds.length));for(var k=a.cachedSymbolColors,l=!0,m=0;m<b;m++){null!=g&&(c[g]=a.featureIds[m]);if(null!=h)for(var n=0,p=h;n<p.length;n++){var q=p[n];f[q]&&(c[q]=P.getCachedAttributeValue(f[q],m))}p=e&&e.getSymbol(d,{arcadeUtils:L});n=null;p instanceof M&&(this._symbolInfos.has(p.id)||this._symbolInfos.set(p.id,P.getSymbolInfo(p)),n=this._symbolInfos.get(p.id));a.cachedSymbolInfos[m]=n;var r=q=null,v=!0,p=!0;e&&"visualVariables"in
e&&(this._colorVariable&&(v=N.getColor(this._colorVariable,d,{color:pa}))&&(q=A,q[0]=v.r/255,q[1]=v.g/255,q[2]=v.b/255,this._opacityVariable||null===v.a||(r=v.a)),this._opacityVariable&&(r=N.getOpacity(this._opacityVariable,d)));n&&n.material?(v=n.material,q=null==q||null==r?T.overrideColor(q,r,v.color,v.alpha,sa,A):T.overrideColor(q,r,null,null,sa,A),F.encodeSymbolColor(q,v.colorMixMode,k,4*m),v=n.castShadows):(F.encodeSymbolColor(null,null,k,4*m),v=!0);if(0<m&&l){for(n=4*(m-1);n<4*m;n++)k[n]!==
k[n+4]&&(l=!1);v!==p&&(l=!1)}p=v}a.uniformSymbolColor=l}};e.prototype._extractObjectEdgeMaterials=function(a){var b=a.engineObject,c=a.featureIds?a.featureIds.length:1,d=Array(c),e=ca.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),f={opacity:this.fullOpacity,objectTransparency:2};if(0<a.engineObject.geometryRecords.length){var g=a.engineObject.geometryRecords[0].material;f.objectTransparency=g.isVisible()?g.hasTransparency?1:2:0}var g=!1,h=null,k=null;a=this._getSymbolInfos(a);for(var l=0;l<
c;l++){var m=a[l];b.getComponentVisibility(b.geometryRecords[0],l)&&m?(k!==m&&(k=m,(h=ca.createMaterialFromEdges(m.edges,f))&&(g=!0)),d[l]=x.isSome(h)?h:e):d[l]=e}return{hasEdges:g,perFeatureEdgeMaterials:d}};e.prototype._setObjectSymbology=function(a){if(this._hasSymbolColors){var b=a.featureIds?a.featureIds.length:1,c=this._getSymbolColors(a);if(a.uniformSymbolColor){var d=F.decodeSymbolColor(c,0),e=d.color,f=d.colorMixMode,d=!0;a.cachedSymbolInfos[0]&&(d=a.cachedSymbolInfos[0].castShadows);for(var g=
0,h=a.engineObject.geometryRecords;g<h.length;g++)b=h[g],b=b.material,b.updateParameters({componentData:{castShadows:d,externalColor:e,externalColorMixMode:f}});e=1>e[3];this._updateObjectOpacity(a.engineObject,!e&&"replace"===f,e)}else{for(var e=a.componentColorBuffer.textureBuffer,h=g=d=!0,k=0;k<b;k++){var f=4*k,l=a.componentIndices[k],m=1;a.cachedSymbolInfos[k]&&(m=!0===a.cachedSymbolInfos[k].castShadows?1:0);e.setData(l,0,c[f],c[f+1],c[f+2]&254|m,c[f+3]);l=F.isOpaqueSymbolColor(c,f);d=d&&l;g=
g&&!l;f=F.decodeSymbolColorMixMode(c,f);h=h&&2===f}f=0;for(c=a.engineObject.geometryRecords;f<c.length;f++)b=c[f],b=b.material,k="blend"!==b.metadata.material.alphaMode,b.updateParameters({componentData:{textureBuffer:e},useVertexTransparencyDiscards:!d&&!g&&k});this._updateObjectOpacity(a.engineObject,d&&h,!d);this._stage.renderView.setNeedsRender()}this._updateEdgeRendering(a)}};e.prototype._setComponentIndices=function(a,b){for(var c=a.getAttribute(wa.VertexAttrConstants.COMPONENTINDEX),d=c.data,
e=c.offsetIdx,c=c.strideIdx,f=a.getIndices(wa.VertexAttrConstants.COMPONENTINDEX),g=0;g<b.length;g++)for(var h=a.componentOffsets[g+1],k=a.componentOffsets[g];k<h;k++)d[e+f[k]*c]=b[g]};e.prototype._reloadAll=function(a){void 0===a&&(a=this.elevationOffset);this._removeAllNodeDataFromStage(a);null!=this._controller&&this._controller.restartNodeLoading()};e.prototype._opacityChange=function(a){var b=this;this._nodeId2Meta.forEach(function(a){b._updateObjectOpacity(a.engineObject);b._updateEdgeRendering(a)})};
e.prototype._updateObjectOpacity=function(a,b,c){var d=0;for(a=a.geometryRecords;d<a.length;d++){var e=a[d].material,f=e.metadata;void 0!==b&&(f.allSymbolsOpaqueReplace=b);void 0!==c&&(f.someSymbolsTransparent=c);f=this._calcEngineMaterialTransparencyParams(f.material,f.allSymbolsOpaqueReplace,f.someSymbolsTransparent);e.updateParameters(f)}};e.prototype._updateEngineObject=function(a){this._setObjectSymbology(a);this._applyFiltersToNode(a);this._addOrUpdateEdgeRendering(a);this.visibleGeometryChanged(a.engineObject)};
e.prototype._slicePlaneEnabledChange=function(a){var b=this,c={slicePlaneEnabled:a};this._stageLayer.isSliceable=a;this._nodeId2Meta.forEach(function(a){for(var d=0,e=a.engineObject.geometryRecords;d<e.length;d++)e[d].material.updateParameters(c);b._updateEdgeRendering(a,!1)})};e.prototype._enablePhysicalBasedRendering=function(a){var b=this,c={usePBR:!0};this._nodeId2Meta.forEach(function(a){var d=0;for(a=a.engineObject.geometryRecords;d<a.length;d++){var e=a[d].material;c.usePBR=!b._isIntegratedMesh&&
(e.metadata.isSchematic?b.view.qualitySettings.physicallyBasedRenderingEnabled:!0);e.updateParameters(c)}})};e.prototype._updateEdgeRendering=function(a,b){void 0===b&&(b=!0);this._edgeView&&this._edgeView.hasObject(a.engineObject)&&this._addOrUpdateEdgeRendering(a,b)};e.prototype._forAllFeatures=function(a,b,c){var d=this;void 0===c&&(c=0);p.everyMap(this._nodeId2Meta,function(e,f){if(x.isSome(b))switch(b(e)){case 0:return!1;case 2:return!0}return 0!==d._forAllFeaturesOfNode(e,a,c)})};e.prototype._forAllFeaturesOfNode=
function(a,b,c){void 0===c&&(c=0);var d=a.featureIds,e=a.engineObject.geometryRecords[0],f=2===c&&this._clippingArea?P.getClipAABB(this._clippingArea,a.engineObject):null,g=f?this._boundingboxNodeTest(a,this._clippingArea):3;if(0===g)return 1;for(var h=0;h<d.length;h++)if(a.engineObject.getComponentVisibility(e,h)||1===c||2===c&&(3===g||this._boundingboxFeatureTest(a,h,f))){var k=b(d[h],h,a,e);switch(k){case 0:return k}}return 1};e.prototype._createGraphic=function(a,b){var c={};null!=b.featureIds&&
(c[this._getObjectIdField()]=b.featureIds[a]);b=b.attributeInfo.attributeData;if(null!=b)for(var d=0,e=Object.keys(b);d<e.length;d++){var f=e[d];c[f]=P.getCachedAttributeValue(b[f],a)}return this._createLayerGraphic(c)};e.prototype._boundingBoxCornerPoints=function(a,b,c){a=b.geometries[0].getComponentAABB(a,Ra);for(var d=0;8>d;++d)Pa[0]=d&1?a[0]:a[3],Pa[1]=d&2?a[1]:a[4],Pa[2]=d&4?a[2]:a[5],K.vec3.transformMat4(Pa,Pa,b.objectTransformation),c[3*d]=Pa[0],c[3*d+1]=Pa[1],c[3*d+2]=Pa[2];return c};e.prototype.highlight=
function(a,b){var e=this;void 0===b&&(b={});var f=this._highlights;"number"===typeof a?a=[a]:a instanceof d?a=[a]:a instanceof c&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof d){a=a.map(function(a){return Z.attributeLookup(a.attributes,e._getObjectIdField())});var g=f.acquireSet(b);b=g.set;g=g.handle;f.setFeatureIds(b,a);return g}if("number"===typeof a[0])return g=f.acquireSet(b),b=g.set,g=g.handle,f.setFeatureIds(b,a),g}return hb};e.prototype.visibleGeometryChanged=function(a){var b=
this;a?this._elevationProvider.objectChanged(a):this._elevationProvider.layerChanged();null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=y.schedule(function(){b.emit("visible-geometry-changed");b._visibleGeometryChangedSchedulerHandle=null}))};e.prototype.test=function(){var a=this;return{controller:this._controller,get visibleObjectIds(){var b=[];a._forAllFeatures(function(a,c,d,e){d.engineObject.isHidden(e)||d.engineObject.areAllComponentsHidden()||
!d.engineObject.getComponentVisibility(e,c)||b.push(a);return 1});b.sort(function(a,b){return a-b});return b},get numNodes(){return a._nodeId2Meta.size}}};h([C.property()],e.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);h([C.property()],e.prototype,"view",void 0);h([C.property()],e.prototype,"layer",void 0);h([C.property()],e.prototype,"_controller",void 0);h([C.property({dependsOn:["updatingMeshView3D"]})],e.prototype,"updating",void 0);h([C.property({dependsOn:["_controller.updating",
"_visibleGeometryChangedSchedulerHandle"]})],e.prototype,"updatingMeshView3D",null);h([C.property({dependsOn:["_controller.rootNodeVisible"]})],e.prototype,"suspended",void 0);h([C.property(da.updatingPercentage)],e.prototype,"updatingPercentage",void 0);h([C.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],e.prototype,"updatingPercentageValue",void 0);h([C.property({readOnly:!0})],e.prototype,"hasTexturesOrVertexColors",null);h([C.property({readOnly:!0})],e.prototype,"rendererTextureUsage",
null);h([C.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],e.prototype,"elevationOffset",null);h([C.property({type:Boolean})],e.prototype,"slicePlaneEnabled",void 0);h([C.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","useCompressedTextures"]})],e.prototype,"uncompressedTextureDownsamplingEnabled",null);h([C.property({dependsOn:["layer.version"]})],e.prototype,"useCompressedTextures",null);return e=h([C.subclass("esri.views.3d.layers.I3SMeshView3D")],
e)}(C.declared(b))};var ga=D.mat4f64.create(),Pa=I.vec3f64.create(),Ra=Q.create(),Ta=Q.create(),A=[0,0,0,0],pa=new e([0,0,0,0]),Ga=[0,0,0,0],hb={remove:function(){},pause:function(){},resume:function(){}}})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/support/projectionUtils ../../../views/support/layerViewUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N){function L(a,b){return a.length===b.length&&a.every(function(a){return 0<=M(b,a.name)})}function M(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b)return c;return-1}function R(a){return null!=a&&null!=a.loadedAttributes&&null!=a.attributeData}var S=f.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");n=function(b){function f(a){a=b.call(this,a)||this;a.screenSizeFactor=0;a.featureTarget=
5E4;a.fixedFeatureTarget=!1;a.updating=!0;a.updatingPercentage=0;a.leafsReached=!1;a.scaleVisibilityEnabled=!0;a.uncompressedTextureDownsamplingEnabled=!1;a._featureLOD=1;a._stableFeatureLOD=!1;a._isIdle=!1;a._cameraDirty=!0;a._invisibleDirty=!1;a._newLoadingNodes=new c({deallocator:null});a._loadedNodeScales=new Map;a._abortController=p.createAbortController();a._downloadingNodes=new Set;a._loadingNodeRevisions=new Map;a._nextLoadingNodeRevision=0;a._updatingNodes=new Set;a._progressMaxNumNodes=
1;a._poi=w.vec3f64.create();a._requiredAttributes=[];a._requiredAttributesDirty=!0;a._updatesDisabled=!1;a.disableIDBCache=!1;a.disableMemCache=!1;a._restartNodeLoading=!1;a._fields=null;a._attributeStorageInfo=null;a._handles=new e;a._idleQueue=new v.PromiseQueue;a._errorCount=0;return a}l(f,b);Object.defineProperty(f.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"isGraphics3D",{get:function(){return"points"===this.layer.profile},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"streamDataController",{get:function(){var a=this.layerView.view.resourceController.createStreamDataRequester(1);return new K.default(a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"crsVertex",{get:function(){return I.getVertexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"crsIndex",{get:function(){return I.getIndexCrs(this.layer)},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"rootNodeVisible",{get:function(){var a=this._index&&this._index.rootNode;return a?(this._updateViewData(),this._index.isNodeVisible(a.index)):!0},enumerable:!0,configurable:!0});f.prototype.initialize=function(){var a=this;this._lodHandling=new C(this.layerView);var b=this.layerView.layer;this.layer=b;this._defaultGeometrySchema=b.store.defaultGeometrySchema;this.disableIDBCache=d("disable-feature:idb-cache");"fields"in b&&(this._fields=
b.fields,this._attributeStorageInfo=b.attributeStorageInfo);var c=p.all([this.layer.when(),this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){var c=a.layerView.view;a._setClippingArea(c.clippingArea);a._centerOnSurface=c.pointsOfInterest.centerOnSurfaceFrequent;var d=a.layerView.view.resourceController;a._handles.add([a._centerOnSurface.watch("renderLocation",function(){return a._pointOfInterestChanged()}),d.memoryController.events.on("quality-changed",function(){return a._setCameraDirty()}),
r.init(a.layerView,"suspended",function(b){var c=b?function(){return a._updateViewData()}:function(){return a._updateIdleState(!0)},e=b?function(){}:function(){return a._updateIdleState(!1)};a._idleStateCallbacks?(b&&a.cancelNodeLoading(),a.restartNodeLoading(),a._idleStateCallbacks.idleBegin=c,a._idleStateCallbacks.idleEnd=e):a._idleStateCallbacks=d.scheduler.registerIdleStateCallbacks(c,e)}),z.addTask(a.layerView.view.resourceController.scheduler,{update:function(b,c){return a._frame(b,c)},needsUpdate:function(){return a.updating}}),
a.watch("uncompressedTextureDownsamplingEnabled",function(){return a.restartNodeLoading()}),a.watch(["featureTarget","fixedFeatureTarget"],function(){a._setCameraDirty();a._stableFeatureLOD=!1}),c.state.watch("camera",function(){return a._setCameraDirty()}),a.layer.watch("elevationInfo",function(){return a._elevationInfoChanged()}),a.layer.watch(["minScale","maxScale"],function(){return a._scaleBoundsChanged()}),a.layerView.watch("lodFactor",function(){return a._setCameraDirty()}),a.layerView.watch("availableFields?",
function(){return a._requiredFieldsChange()})]);a._updateScaleHandles();a._viewportQueries=new Q(a.crsIndex,c.renderCoordsHelper,c.state.camera,a._clippingArea,c.elevationProvider,a.layer,{progressiveLoadFactor:a._getProgressiveLoadFactor(a.layer),screenspaceErrorBias:a.lod,angleDependentLoD:.5>a.lod});a._index=new B.I3SIndex(b,a.streamDataController,a._viewportQueries,S,function(b){return a.layerView.isNodeLoaded(b)},function(b){return a._shouldLoadNode(b)},function(b){return a._enableFromGPUCache(b,
"leaf")},function(b){return a._needsUpdate(b)},function(){return!a.streamDataController.busy})}});this._tmpPoint=m.makeDehydratedPoint(0,0,0,this.crsIndex);this.addResolvingPromise(c);this.when(function(){return a._startNodeLoading()})};f.prototype.destroy=function(){this._abortController.abort();this._abortController=null;this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;T.prune()};f.prototype._getRequiredAttributes=
function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];var a=this._attributeStorageInfo,b=this._fields,c=this.layer.objectIdField;return this.layerView.availableFields.map(function(c){var d=M(a,c);c=M(b,c);return 0<=d&&0<=c?{index:d,name:b[c].name,field:b[c],attributeStorageInfo:a[d]}:null}).filter(function(a){return null!=a&&a.name!==c})};f.prototype._requiredFieldsChange=function(){L(this._requiredAttributes,this._getRequiredAttributes())||this.requestUpdate()};
f.prototype.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};f.prototype._setClippingArea=function(a){var b=u.create();J.extentToBoundingBox(a,b,this.layerView.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null};f.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.setPointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=U.distancePenalty*
this._viewportQueries.distCameraToPOI(),this._index.requestUpdate())))};f.prototype._calculatePointOfInterest=function(a){var b=this._centerOnSurface.renderLocation,c=w.vec3f64.create();x.vec3.subtract(c,b,this.camPos);var d=this.layerView.view.renderCoordsHelper,e=w.vec3f64.create();d.worldUpAtPosition(b,e);c=x.vec3.angle(e,c)-.5*Math.PI;x.vec3.lerp(a,this.camPos,b,Math.max(0,Math.min(1,c/(.5*Math.PI))));return a};f.prototype.updateClippingArea=function(a){this._setClippingArea(a);this._viewportQueries&&
this._index&&(this._viewportQueries.updateExtent(this._clippingArea),this._index.invalidateVisibilityCache());this._setCameraDirty()};f.prototype._setCameraDirty=function(){this._cameraDirty=!0;this.notifyChange("rootNodeVisible");this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};f.prototype.updateElevationChanged=function(a,b){if(null!=this._index){null==this._elevationUpdateNodes&&(this._elevationUpdateNodes=new c({deallocator:null}));var d=this._elevationUpdateNodes;d.clear();var e=
this._index.rootNode;null!=e&&I.findIntersectingNodes(a,b,e,this.crsIndex,this._index,function(a){return d.push(a.index)});for(a=0;a<d.length;a++)b=d.data[a],this._index.invalidateBoundingVolumeCache(b),b===e.index&&this.notifyChange("rootNodeVisible");d.length&&this.restartNodeLoading()}};f.prototype.getParentIndex=function(a){return this._index.getParentIndex(a)};f.prototype._elevationInfoChanged=function(){this._index.updateElevationInfo(this.layer.elevationInfo);this._setCameraDirty()};f.prototype._updateScaleHandles=
function(){var a=this;this._handles.remove("scale-bounds");this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",function(b){return a._scaleUpdateHandler(b)}),"scale-bounds")};f.prototype._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};f.prototype._scaleUpdateHandler=function(a){this._updateScaleInBoundingRect(a.scale,a.extent,a.spatialReference);this._setCameraDirty()};
f.prototype._updateScaleInBoundingRect=function(a,b,c){var d=this;null!=this._index.rootNode&&J.boundingRectToBoundingRect(b,c,Y,this.crsIndex)&&this._loadedNodeScales.forEach(function(b,c){b=d._index.getNode(c);y.containsPoint(Y,b.mbs)&&d._loadedNodeScales.set(c,a)})};f.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};f.prototype.schedule=function(a,b){var c=this;return this._idleQueue.push(b).then(function(b){if(!c._loadingNodeRevisions.has(a)&&
!c._updatingNodes.has(a))throw p.createAbortError();return b})};f.prototype.reschedule=function(a,b){var c=this;return this._idleQueue.unshift(b).then(function(b){if(!c._loadingNodeRevisions.has(a)&&!c._updatingNodes.has(a))throw p.createAbortError();return b})};Object.defineProperty(f.prototype,"isIntegratedMesh",{get:function(){return"integrated-mesh"===this.layer.type},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"areScaleBoundsActive",{get:function(){var a=N.extractSafeScaleBounds(this.layer),
b=a.minScale,a=a.maxScale;return this.scaleVisibilityEnabled&&(0<b||0<a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"unloadedMemoryEstimate",{get:function(){return!this._index||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"indexDepth",{get:function(){return this._index?this._index.maxLevel:0},enumerable:!0,configurable:!0});f.prototype._frame=function(a,b){if(this.layerView.suspended)return this._updateViewData(),
this._evaluateUpdating(),-Infinity;if(!this.layerView.visible)return-Infinity;this._processLogError(a,b);return this._index.getPriority()};f.prototype._processLogError=function(a,b){try{this._process(a,b)}catch(ca){50>this._errorCount?S.error("Error during processing: "+ca):50===this._errorCount&&S.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};f.prototype._process=function(a,b){var c=this;this._restartNodeLoading&&this._startNodeLoading();if(null!=
this._nodeLoader&&null!=this._index){this._updateViewData();this._invisibleDirty&&this._removeInvisibleNodes(a)&&(this._invisibleDirty=!1);this.isIntegratedMesh&&(a.enabled=!1);a.run(function(){return c._processIndex(b,a)});this._updateFeatureLOD();a.run(function(){return c._processCache(a,b)});this.isIntegratedMesh&&(a.enabled=!0);for(a.run(function(){return c._processNodes(a,b)});!a.done&&this._idleQueue.process();)a.madeProgress();a.run(function(){return c._prefetchIndex(b)});b.numIndexLoading+=
this._index.getIndexLoading();b.numNodesLoading+=this._downloadingNodes.size;a.run(function(){return c._lodHandling.lodGlobalHandling(a)});this._evaluateUpdating()}};f.prototype._processIndex=function(b,c){this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update(a.keysOfMap(this._loadingNodeRevisions),c),!this.disableMemCache&&this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData&&(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),
this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),b=this._index.getFeatureEstimate().leafsReached,this._index.isLoading()||b===this._get("leafsReached")||this._set("leafsReached",b));return this._index.load()};f.prototype._prefetchIndex=function(a){return 0<this._loadingNodeRevisions.size||0<this._index.updates.add.length?!1:this._index.prefetch()};f.prototype._updateFeatureLOD=function(){if(this.isGraphics3D){var a=!this._index.isLoading(),b=this.featureTarget*
this.baseLOD,c=this._index.getFeatureEstimate();c.estimate=c.estimate||b/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(a&&c.estimate<b){if(c.leafsReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(b/c.estimate,1.001));a=this.lod;b=this._index.checkFeatureTarget(b,a);b!==a&&(this._featureLOD=b/this.baseLOD,this._stableFeatureLOD=!0)}else if(c.estimate>1.2*b||a&&c.estimate>
b){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(c.estimate/b-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.requestUpdate()}};f.prototype._processCache=function(a,b){for(;0<this._newLoadingNodes.length&&!a.done;)for(b=this._newLoadingNodes.pop(),b=this._index.getParent(b);b&&!this.layerView.isNodeLoaded(b.index)&&this._isNodeInScaleBounds(b);b=this._index.getParent(b.index))if(this._enableFromGPUCache(b,
"hole")){a.madeProgress();break}return a.hasProgressed};f.prototype._processNodes=function(a,b){var c=(this._isIdle?100:2)-this._loadingNodeRevisions.size,d=this._index.updates;d.cancel.forEach(this._cancelNode,this);for(d.cancel=[];0<d.update.length&&!a.done;){var e=this._index.getNode(d.update.pop());this._updateLoadedNode(e);a.madeProgress()}for(;0<d.add.length&&!a.done&&0<c;){--c;e=this._index.getNode(d.add.back());if(2!==e.cacheState&&!this._hasNodeLoadToken(b))break;d.add.pop();this._loadNode(e);
a.madeProgress()}return a.hasProgressed};f.prototype._cancelAllNodes=function(){this._loadingNodeRevisions.clear();this._downloadingNodes.clear();this._updatingNodes.clear();this._abortController.abort();this._abortController=new AbortController};f.prototype._cancelNode=function(a){this._loadingNodeRevisions.delete(a);this._downloadingNodes.delete(a)};f.prototype._hasNodeLoadToken=function(a){return!this._isIdle&&2<=a.numNodesLoading+this._loadingNodeRevisions.size?!1:!this.streamDataController.busy};
f.prototype._evaluateUpdating=function(){var a=!1,b=0;this.layerView.suspended?b=(a=this._cameraDirty)?100:0:(b=(this._index?this._index.getIndexMissing():0)+3*(this._index?this._index.updates.add.length:0)+2*this._loadingNodeRevisions.size,a=!!(0<b||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===b&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(b,this._progressMaxNumNodes),
b=100*b/this._progressMaxNumNodes);a!==this.updating&&this._set("updating",a);b!==this.updatingPercentage&&this._set("updatingPercentage",b)};f.prototype._updateViewData=function(){if(this._cameraDirty&&this._index){var a=this.layerView.view,b=a.state.camera;this.camPos=w.vec3f64.clone(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/(b.perScreenPixelRatio/2);this._poi=this._calculatePointOfInterest(this._poi);this._viewportQueries.updateCamera(b);this._viewportQueries.setPointOfInterest(this._poi);
this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=U.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};f.prototype._getProgressiveLoadFactor=function(a){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};Object.defineProperty(f.prototype,
"lod",{get:function(){return this._featureLOD*this.baseLOD},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"baseLOD",{get:function(){var a=this.layerView.lodFactor,b=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<a?a:1)*b},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"lodDropFactor",{get:function(){if(this.fixedFeatureTarget)return 1;var a=this.layerView.view.resourceController.memoryController;return(Math.min(a.memoryFactor,
.5)-a.minQuality)/(.5-a.minQuality)},enumerable:!0,configurable:!0});f.prototype.isGeometryVisible=function(a){return this._index.isGeometryVisible(a.index)};f.prototype.updateVisibility=function(a){return this._index.invalidateVisibilityCache(a)};f.prototype._shouldLoadNode=function(a){return this._lodHandling.shouldLoadNode(a)&&!this._shouldDropNode(a)&&this._isNodeInScaleBounds(a)?a.obb?this._index.isGeometryVisible(a.index):!0:!1};f.prototype._shouldDropNode=function(a){var b=this.lodDropFactor;
return 1<=b||!this._lodHandling.childrenEmpty(a)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(a))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*b};f.prototype._startNodeLoading=function(){var a=this;this._restartNodeLoading=!1;if(!this._updatesDisabled&&null!=this.streamDataController){this._updateViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=
!1);var b=D.TextureFormat.Normal;this.layerView.useCompressedTextures?b=D.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(b=D.TextureFormat.Downsampled);this._nodeLoader=new D(this.layer,this.streamDataController,S,this._defaultGeometrySchema,this._requiredAttributes,{textureFormat:b,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:!this.isMeshPyramid});b=this.layerView.view.renderSpatialReference;b=this.crsIndex.equals(b)||this.crsIndex.isWGS84&&b.equals(J.SphericalECEFSpatialReference);
this._index.ignoreServiceOBB=!b;this._index.requestUpdate();this._lodHandling.startNodeLoading(function(b){return a._index.isNodeVisible(b)},function(b){return a._index.isGeometryVisible(b)},function(b){return a._isNodeInScaleBounds(b)},function(b){return a._index.nodeTraversalState(b)},function(b,c){return a._removeNodes(b,c)},this._index,{maxLodLevel:this._viewportQueries.maxLodLevel});this._evaluateUpdating()}};f.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};
f.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this.streamDataController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};f.prototype._removeInvisibleNodes=function(a){var b=this;T.clear();this.layerView.getLoadedNodeIndices(T);var c=0===this._viewportQueries.maxDistance,d=c?function(){return!1}:function(a){return b._shouldDropNode(a)};T.filterInPlace(function(a){var c=b._index.getNode(a);return!b._index.isGeometryVisible(a)||
d(c)||!b._isNodeInScaleBounds(c)});0<T.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(T,a);if(c&&1>this.lodDropFactor)return!1;if(0===T.length)return!0;T.clear();return!1};f.prototype._removeNodes=function(a,b){0<a.length&&this._index.requestUpdate();var c=a.length;this.layerView.removeNodeData(a,b);if(0<this._loadedNodeScales.size)for(b=a.length;b<c;b++)this._loadedNodeScales.delete(a.data[b])};f.prototype._needsUpdate=function(a){if(!a.resources.hasFeatureData||this._updatingNodes.has(a.index))return!1;
a=this.layerView.getLoadedAttributes(a.index);return null!=a&&a!==this._requiredAttributes};f.prototype._updateLoadedNode=function(a){var b=this,c=this.layerView.getLoadedAttributes(a.index),c=L(c,this._requiredAttributes)?p.resolve(this.layerView.getAttributeData(a.index)):this._nodeLoader.loadAttributes(a,this._requiredAttributes,this._abortController.signal);this._updatingNodes.add(a.index);c.then(function(c){return b.schedule(a.index).then(function(){return b.layerView.setAttributeData(a.index,
{loadedAttributes:b._requiredAttributes,attributeData:c})})}).catch(function(c){p.isAbortError(c)||b.layerView.setAttributeData(a.index,{loadedAttributes:b._requiredAttributes,attributeData:{}})}).catch(function(){}).then(function(){b._updatingNodes.delete(a.index);b._evaluateUpdating()});this._evaluateUpdating()};f.prototype._loadNode=function(a){var b=this,c=this._nextLoadingNodeRevision++;this._loadingNodeRevisions.set(a.index,c);this._evaluateUpdating();this._loadAndAddNode(a).catch(function(a){return a}).then(function(){b._loadingNodeRevisions.get(a.index)===
c&&b._loadingNodeRevisions.delete(a.index);b._evaluateUpdating()})};f.prototype._loadAndAddNode=function(a){var b=this;return 1===a.cacheState?this._loadUncached(a):this._loadCached(a).then(function(c){c||(a.cacheState=1,b._index.updates.add.push(a.index))}).catch(function(b){p.isAbortError(b)||(a.cacheState=1)})};f.prototype._enableFromGPUCache=function(a,b){if(this.disableMemCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var c=this._loadCachedGPUData(a);if(!c)return!1;
this.layerView.addCachedGPUData(a,c,b);this._nodeAdded(a);return!0};f.prototype._loadCachedGPUData=function(a){return(a=this.layerView.loadCachedGPUData(a))&&R(a.attributeInfo)&&L(a.attributeInfo.loadedAttributes,this._requiredAttributes)?a:null};f.prototype._nodeAdded=function(a){this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};f.prototype._loadCached=function(a){var b=this;if(this._enableFromGPUCache(a,"leaf"))return p.resolve(!0);var c=this.layerView;
return!this.disableIDBCache&&c.loadCachedNodeData&&c.addCachedNodeData?this.schedule(a.index).then(function(){return c.loadCachedNodeData(a,b._abortController.signal,function(c,d){return b._nodeLoader.loadTextures(a,c,d)})}).then(function(d){if(null==d)return!1;var e=b._requiredAttributes;return R(d)&&L(d.loadedAttributes,e)?b.reschedule(a.index).then(function(){return c.addCachedNodeData(a,d,d)}).then(function(){b._nodeAdded(a);return!0}):b.reschedule(a.index).then(function(){return b._nodeLoader.loadAttributes(a,
e,b._abortController.signal)}).then(function(c){return b.reschedule(a.index,{loadedAttributes:e,attributeData:c})}).then(function(b){return c.addCachedNodeData(a,d,b)}).then(function(){b._nodeAdded(a);return!0})}):p.resolve(!1)};f.prototype._loadUncached=function(a){var b=this;this._downloadingNodes.add(a.index);return g.safeCast(this._nodeLoader.loadNodeData(a,this._abortController.signal)).then(function(c){b._downloadingNodes.delete(a.index);return b.schedule(a.index,c)}).then(function(c){return b.layerView.addNodeData(a,
c)}).then(function(){b._nodeAdded(a);a.cacheState=2}).catch(function(c){p.isAbortError(c)||(S.error("Failed to load node '"+a.id+"': "+c),a.failed=!0,b._index.requestUpdate())})};f.prototype._updateIdleState=function(a){a!==this._isIdle&&(this._isIdle=a,this._evaluateUpdating(),a&&this._index&&this._index.resetFailedNodes())};f.prototype._getScale=function(a){if(this._loadedNodeScales.has(a.index))return this._loadedNodeScales.get(a.index);var b=a.mbs;this._tmpPoint.x=b[0];this._tmpPoint.y=b[1];this._tmpPoint.z=
b[2];b=this.layerView.view.basemapTerrain.getScale(this._tmpPoint);this.layerView.isNodeLoaded(a.index)&&this._loadedNodeScales.set(a.index,b);return b};f.prototype._isNodeInScaleBounds=function(a){if(!this.areScaleBoundsActive)return!0;a=this._getScale(a);var b=N.extractSafeScaleBounds(this.layer);return N.scaleBoundsPredicate(a,b.minScale,b.maxScale)};f.prototype.updateStats=function(a){a.index=this._index?this._index.size:0;this.isGraphics3D&&(a.detail=this._featureLOD,a.target=this.featureTarget*
this.baseLOD);this._index&&this._index.updateStats(a)};Object.defineProperty(f.prototype,"test",{get:function(){var a=this;return{set disableIDBCache(b){a.disableIDBCache=b},set ignoreServiceOBB(b){a._index.ignoreServiceOBB=b}}},enumerable:!0,configurable:!0});k([t.property({readOnly:!0})],f.prototype,"isMeshPyramid",null);k([t.property({readOnly:!0})],f.prototype,"isGraphics3D",null);k([t.property({readOnly:!0})],f.prototype,"streamDataController",null);k([t.property({readOnly:!0})],f.prototype,
"crsVertex",null);k([t.property({readOnly:!0})],f.prototype,"crsIndex",null);k([t.property()],f.prototype,"camPos",void 0);k([t.property()],f.prototype,"screenSizeFactor",void 0);k([t.property()],f.prototype,"featureTarget",void 0);k([t.property()],f.prototype,"fixedFeatureTarget",void 0);k([t.property()],f.prototype,"layerView",void 0);k([t.property()],f.prototype,"layer",void 0);k([t.property({readOnly:!0})],f.prototype,"updating",void 0);k([t.property({readOnly:!0})],f.prototype,"updatingPercentage",
void 0);k([t.property({readOnly:!0})],f.prototype,"leafsReached",void 0);k([t.property({constructOnly:!0})],f.prototype,"scaleVisibilityEnabled",void 0);k([t.property({readOnly:!0})],f.prototype,"rootNodeVisible",null);k([t.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled?"})],f.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return f=k([t.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],f)}(t.declared(q.EsriPromiseMixin(h)));var T=new c({deallocator:null}),
U={factorIM:.2,factor3dObject:.05,distancePenalty:10},Y=y.create();return n})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["require","exports","../../../../core/arrayUtils","../../../support/index"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a){var b=this;this.referenceCount=0;this.callbacks=[];this.runIndex=0;this.handle=a.registerTask(k.Task.I3S_CONTROLLER,function(a){return b.update(a)},function(){return b.needsUpdate()})}a.prototype.destroy=
function(){this.handle&&(this.handle.remove(),this.handle=null)};a.prototype.needsUpdate=function(){for(var a=0,b=this.callbacks;a<b.length;a++)if(b[a].needsUpdate())return!0;return!1};a.prototype.update=function(a){this.sort();for(var b=this.callbacks,e={numIndexLoading:0,numNodesLoading:0},c=0;c<b.length&&!a.done;++c)b[c].priority=b[c].update(a,e),this.runIndex=c};a.prototype.sort=function(){for(var a=this.callbacks,b=a.length,f=this.runIndex;0<f;f--){for(var c=a[f-1],g=f;g<a.length&&c.priority<=
a[g].priority&&(g!==b||c.priority<a[g].priority);)a[g-1]=a[g],g++;a[g-1]=c;b=g-1}this.runIndex=0};a.prototype.add=function(a){this.sort();a.priority=Infinity;this.callbacks.unshift(a)};a.prototype.remove=function(a){l.removeUnordered(this.callbacks,a);this.runIndex=this.callbacks.length;this.sort()};return a}(),a=new Map;b.addTask=function(b,e){var d=a.get(b);null==d&&(d=new h(b),a.set(b,d));d.add(e);return{remove:function(){null!=d&&(d.remove(e),0<d.callbacks.length||(a.delete(b),d.destroy()),d=
null)}}}})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4f64 ./I3SUtil ../../support/orientedBoundingBox".split(" "),function(n,b,l,k,h,a,g,e,d,f){function c(a){a.node?(a.node.renderMbs[3]=-1,a.node.renderObb.halfSize[0]=-1):a.ref&&(a.ref.renderMbs[3]=-1,a.ref.renderObb.halfSize[0]=
-1)}function q(a,b){return 0===b?0:a/b|0}function p(a,b){return 0===b?a:a%b}function r(a){if(a)for(var b=0;b<a.length;b++)for(var c=0,d=u;c<d.length;c++){var e=d[c];if(e[0]===a[b].metricType)return{lodMetric:e[1],maxError:a[b].maxError}}return{lodMetric:0,maxError:0}}function t(a){return Math.sqrt(4/Math.PI*a)}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,c,e,f,g,k,l,m){this.streamDataController=b;this.viewportQueries=c;this.logger=e;this._isLoaded=f;this._isSelected=
g;this._enable=k;this._needsUpdate=l;this._canRequest=m;this._dirty=!0;this.nodePages=[];this.lodMetric=this.rootIndex=this.nodesPerPage=this.nodeCount=0;this.lodConversion=function(a){return a};this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState={};this._version=0;this._visibilityCacheGeneration=d.addWraparound(0,2);this._maxLevel=1;this._featureEstimate=
{estimate:0,leafsReached:!1};this._unloadedMemoryEstimate=0;this._missing=new h({deallocator:null});this._prefetch=new h({deallocator:null});this._updates=new w;this.ignoreServiceOBB=!1;this.progressiveLoadPenalty=0;this.layerUrl=a.parsedUrl.path;this.rootId=a.rootNode&&a.rootNode.split("/").pop();a.serviceUpdateTimeStamp&&a.serviceUpdateTimeStamp.lastUpdate&&(this.lastUpdate=""+a.serviceUpdateTimeStamp.lastUpdate);this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1;a.nodePages?
this.initNodePages(a.nodePages):this.initNodeDocuments(this.rootId)}b.prototype.initNodePages=function(a){this.nodesPerPage=a.nodesPerPage;this.rootIndex=a.rootIndex;switch(a.lodSelectionMetricType){case "maxScreenThreshold":this.lodMetric=1;break;case "maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=t}};b.prototype.initNodeDocuments=function(a){this.rootIndex=this.nodesPerPage=0;this.nodePages.push({nodes:[],children:[],parents:[]});this.makeRefNode({id:a,mbs:null},-1)};b.prototype.loadPage=
function(b){var c=this;this._loading.add(b);return this.streamDataController.request(this.layerUrl+"/nodepages/"+b,"json").then(function(a){c._loading.delete(b);c.addPage(b,a)}).catch(function(d){c._loading.delete(b);if(a.isAbortError(d))return a.reject(d);c._failedPages.add(b);0===c.nodePages.length&&c.initNodeDocuments(c.rootId);return a.reject(d)})};b.prototype.addPage=function(a,b){for(var c=this,h=this.nodePages.length;h<a;h++)this.nodePages[h]=null;var k=[],l=[];b=b.nodes.map(function(b,h){var m=
k.length,n=b.children?b.children.length:0;l.push(-1);for(var p=0;p<n;p++)k.push(b.children[p]);var p=""+b.index,q=f.clone(b.obb),r=e.vec4f64.fromArray([q.center[0],q.center[1],q.center[2],g.vec3.length(q.halfSize)]),v=b.mesh&&b.mesh.attribute,t=b.mesh&&b.mesh.geometry,u=b.mesh&&b.mesh.material;b={id:p,index:a*c.nodesPerPage+h,childCount:n,failed:!1,cacheState:0,obb:q,mbs:r,level:0,resources:{hasSharedResource:!1,hasFeatureData:!!t,attributes:v&&null!=v.resource?""+v.resource:null,geometry:t&&null!=
t.resource?""+t.resource:null,texture:u&&null!=u.resource&&0<u.texelCountHint?""+u.resource:null,geometryDefinition:t?t.definition:-1,materialDefinition:u?u.definition:-1},lodMetric:c.lodMetric,maxError:c.lodConversion(b.lodThreshold),renderMbs:e.vec4f64.fromArray([0,0,0,-1]),renderObb:f.create([0,0,0],[-1,-1,-1],[0,0,0,1]),numFeatures:t?t.featureCount:null,vertexCount:t?t.vertexCount:null,version:c.lastUpdate};return{childOffset:m,childCount:n,visibilityCache:d.addWraparound(c._visibilityCacheGeneration,
-2),ref:null,node:b}});this.nodePages[a]={nodes:b,children:k,parents:l};this.nodeCount+=b.length;this.updateParentsAndLevel()};b.prototype.updateParentsAndLevel=function(){var a=this,b=[],c=function(c,d,e){var f=a.getPage(c);if(k.isSome(f)){var g=p(c,a.nodesPerPage);f.parents[g]=d;if(d=f.nodes[g].node)d.level=e,b.push(c)}};for(c(this.rootIndex,-1,0);b.length;)for(var d=b.pop(),e=this.getNode(d),f=0;f<e.childCount;f++){var g=this.getChildIndex(e,f);c(g,d,e.level+1)}};b.prototype.getPage=function(a){return this.nodePages[q(a,
this.nodesPerPage)]};b.prototype.getNodeInternal=function(a){var b=this.getPage(a);return k.isNone(b)?null:b.nodes[p(a,this.nodesPerPage)]};b.prototype.addNode=function(a,b){null!=a.children&&this.populateChildren(b,a.children);var c=this.getParent(b),c=c?c.level+1:1;this._maxLevel=Math.max(this._maxLevel,c);var d=r(a.lodSelection),g=d.lodMetric,d=d.maxError,h=k.expect(this.getNodeInternal(b));h.node={id:a.id,index:b,mbs:e.vec4f64.fromArray(a.mbs),obb:a.obb&&f.clone(a.obb),childCount:h.childCount,
level:c,resources:a.resources,version:a.version,lodMetric:g,maxError:d,memory:null,numFeatures:a.numFeatures,failed:!1,cacheState:0};null==h.ref.mbs&&(h.ref.mbs=a.mbs);h.node.renderMbs=h.ref.renderMbs;h.node.renderObb=h.ref.renderObb;return h.node};b.prototype.makeRefNode=function(a,b){var c=this.nodePages[0],g=c.nodes.length;c.nodes.push({childOffset:0,childCount:0,node:null,ref:a,visibilityCache:d.addWraparound(this._visibilityCacheGeneration,-2)});this.nodeCount++;c.parents.push(b);a.renderMbs=
e.vec4f64.fromArray([0,0,0,-1]);a.renderObb=f.create([0,0,0],[-1,-1,-1],[0,0,0,1]);return g};b.prototype.populateChildren=function(a,b){var c=k.expect(this.getNodeInternal(a)),d=k.expect(this.getPage(a));c.childOffset=d.children.length;c.childCount=b.length;for(c=0;c<b.length;c++){var e=this.makeRefNode(b[c],a);d.children.push(e)}};b.prototype.getNode=function(a){a=this.getNodeInternal(a);return k.isSome(a)&&a.node};b.prototype.getIndexById=function(a){var b;this.forAllNodes(function(c,d){(c.node?
c.node.id:c.ref.id)===a&&(b=d)});return b};b.prototype.getNodeById=function(a){a=this.getIndexById(a);a=null!=a?this.getNodeInternal(a):null;return k.isSome(a)?a.node:null};b.prototype.getChildIndex=function(a,b){var c=this.getPage(a.index);if(k.isNone(c))return-1;a=c.nodes[p(a.index,this.nodesPerPage)];return c.children[a.childOffset+b]};b.prototype.getParentIndex=function(a){var b=this.getPage(a);return k.isSome(b)?b.parents[p(a,this.nodesPerPage)]:-1};b.prototype.getParent=function(a){a=this.getParentIndex(a);
return 0<=a?this.getNode(a):null};Object.defineProperty(b.prototype,"rootNode",{get:function(){var a=this.getNodeInternal(this.rootIndex);return k.isSome(a)?a.node:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this.nodeCount},enumerable:!0,configurable:!0});b.prototype.invalidateVisibilityCache=function(a){null!=a?(a=this.getNodeInternal(a),k.isSome(a)&&(a.visibilityCache=d.addWraparound(this._visibilityCacheGeneration,-2))):this._visibilityCacheGeneration=
d.addWraparound(this._visibilityCacheGeneration,2)};b.prototype.isNodeVisible=function(a){a=this.getNodeInternal(a);if(k.isNone(a)||a.ref&&!a.ref.mbs)return!0;if((a.visibilityCache&-2)!==this._visibilityCacheGeneration){var b=this.viewportQueries.isNodeVisible(a.ref||a.node);a.visibilityCache=this._visibilityCacheGeneration+(b?1:0);return b}return 1===(a.visibilityCache&1)};b.prototype.isGeometryVisible=function(a){if(!this.isNodeVisible(a))return!1;a=this.getNodeInternal(a);return k.isNone(a)?!0:
a.node&&a.ref&&!a.ref.obb?this.viewportQueries.isGeometryVisible(a.node):!0};Object.defineProperty(b.prototype,"maxLevel",{get:function(){return this._maxLevel},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this._updates.add.prune();this._updates.update.prune()};b.prototype.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;++this._version};b.prototype.update=function(a,
b){var c=this;if(this._dirty){this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(a,this._missing);x.clear();var d=!0,e=new y,f=new y;this.traverseVisible(function(g,h){if(h){var l=h.node;c._updateNodeFeatureEstimate(l,f);if(l){var m=k.expect(c.getPage(g));if(0===c._missing.length&&0===c.nodesPerPage)for(var n=0;n<h.childCount;n++){var p=m.children[h.childOffset+n],r=c.getNodeInternal(p);!k.isSome(r)||r.node||c._loading.has(p)||
c._failedNodes.has(p)||(x.set(p,c.entryPriority(p)),c._prefetch.push(p))}!l.failed&&l.resources.hasFeatureData&&(c._isLoaded(g)?(e.known+=l.memory,++e.knownNodes,c._isSelected(l)?0<h.childCount&&(d=!1):(e.unremoved+=l.memory,d=!1),c._needsUpdate(l)&&(h=c.entryPriority(g),x.set(g,h),c._maxProcessingPrio=Math.max(c._maxProcessingPrio,h),c._updates.update.push(g))):(l.memory&&(e.known+=l.memory,++e.knownNodes),c._isSelected(l)&&(0<h.childCount&&(d=!1),l.memory?(e.missing+=l.memory,e.known+=l.memory,
++e.knownNodes):++e.missingNodes,0<=a.indexOf(l.index)?(c._maxProcessingPrio=Math.max(c._maxProcessingPrio,c.entryPriority(g)),c._updates.cancel=c._updates.cancel.filter(function(a){return a!==l.index})):!b.done&&c._enable(l)?b.madeProgress():(h=c.entryPriority(g),x.set(g,h),c._maxProcessingPrio=Math.max(c._maxProcessingPrio,h),c._updates.add.push(g)))))}else h=c.entryPriority(g),c._loading.has(g)||c._failedNodes.has(g)||(c._missing.push(g),x.set(g,h)),c._maxProcessingPrio=Math.max(c._maxProcessingPrio,
h)}else h=c.entryPriority(g),g=q(g,c.nodesPerPage),x.set(g,Math.max(h,x.get(g)||0)),c._loading.has(g)||c._failedPages.has(g)||c._missing.push(g),c._maxProcessingPrio=Math.max(c._maxProcessingPrio,h)});this._unloadedMemoryEstimate=e.missing-e.unremoved;3<e.knownNodes&&0<e.missingNodes&&(this._unloadedMemoryEstimate+=e.known/e.knownNodes*e.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(f);this._featureEstimate.leafsReached=
d;this._missing.sort(function(a,b){return a-b});this._missing.filterInPlace(function(a,b){return 1>b||c._missing.data[b-1]!==a});this._missing.sort(function(a,b){return x.get(a)-x.get(b)});0<this._missing.length?(this._maxUnloadedPrio=x.get(this._missing.back()),this._prefetch.clear()):this._prefetch.sort(function(a,b){return x.get(a)-x.get(b)});this._updates.add.filterInPlace(function(a){return x.get(a)>=c._maxUnloadedPrio}).sort(function(a,b){return x.get(a)-x.get(b)});this._updates.update.sort(function(a,
b){return x.get(a)-x.get(b)});this._indexMissing=this._loading.size+this._missing.length;this._dirty=0<this._indexMissing;x.clear()}};b.prototype.checkFeatureTarget=function(a,b){for(var c=this.viewportQueries.updateScreenSpaceErrorBias(b),d=b,e=b,f=c,g=10;g--;){var h=new y;this._updateFeatureEstimate(d,h);if(this._computeFeatureEstimate(h)<=a){if(d>=b||0<h.missingNodes||0===g)break;f=d;d=.5*(d+e)}else e=d,d=.5*(d+f)}++this._version;this.viewportQueries.updateScreenSpaceErrorBias(c);return Math.min(b,
d)};b.prototype._updateFeatureEstimate=function(a,b){var c=this;++this._version;this.viewportQueries.updateScreenSpaceErrorBias(a);this.traverseVisible(function(a,d){return c._updateNodeFeatureEstimate(d&&d.node,b)})};b.prototype._updateNodeFeatureEstimate=function(a,b){a&&!a.failed&&null!=a.numFeatures&&(this._isLoaded(a.index)?(b.known+=a.numFeatures,++b.knownNodes,this._isSelected(a)||(b.unremoved+=a.numFeatures)):this._isSelected(a)&&(a.numFeatures?(b.missing+=a.numFeatures,b.known+=a.numFeatures,
++b.knownNodes):++b.missingNodes))};b.prototype._computeFeatureEstimate=function(a){var b=a.known-a.unremoved;3<a.knownNodes&&0<a.missingNodes&&(b+=a.known/a.knownNodes*a.missingNodes);return Math.max(0,b)};b.prototype.load=function(){return this._load(this._missing)};b.prototype.prefetch=function(){return this._load(this._prefetch)};b.prototype._load=function(a){if(0===a.length||!this._canRequest())return!1;for(;0<a.length&&this._canRequest();)0===this.nodesPerPage?this._loadNode(a.pop()):this.loadPage(a.pop());
return!0};b.prototype.isLoading=function(){return 0<this._indexMissing};b.prototype.getIndexLoading=function(){return this._loading.size};b.prototype.getIndexMissing=function(){return this._indexMissing};b.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};Object.defineProperty(b.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0});b.prototype.getFeatureEstimate=function(){return this._featureEstimate};b.prototype.nodeTraversalState=
function(a){if(!a)return null;var b=this._nodeTraversalState[a.index];if(b&&b.version===this._version)return b;var c=this.viewportQueries.getLodLevel(a),d=this.viewportQueries.hasLOD(a),e=!0;d?(e=this.getParentIndex(a.index),e=0<=e?(e=this._nodeTraversalState[e])&&c>e.lodLevel:0<c):e=0===a.childCount;if(b)return b.lodLevel=c,b.isChosen=e,b.version=this._version,b;this._nodeTraversalState[a.index]={nodeHasLOD:d,lodLevel:c,isChosen:e,version:this._version};return this._nodeTraversalState[a.index]};
b.prototype._loadNode=function(b){var c=this;this._loading.add(b);var d=k.expect(this.getNodeInternal(b)).ref.id,e=this.layerUrl+"/nodes/"+d,f=function(){c._loading.delete(b);0===c._missing.length&&0===c._loading.size&&c.requestUpdate()};this.streamDataController.request(e,"json").then(function(a){a=c._validateNode(d,a);null!=a&&(a.obb&&c.invalidateVisibilityCache(b),a=c.addNode(a,b),c.nodeTraversalState(a));f()},function(d){a.isAbortError(d)||(c.logger.error("Error loading node: "+e),c._failedNodes.add(b));
f()})};b.prototype._validateNode=function(a,b){var c=this;if(null==b||"object"!==typeof b||b.id!==a)return this.logger.error('Invalid node. Wrong type or wrong id "'+a+'"'),null;b.sharedResource&&"./shared"!==b.sharedResource.href&&"./shared/"!==b.sharedResource.href&&this.logger.warn('Invalid shared resource href on node "'+a+'"');null==b.geometryData||Array.isArray(b.geometryData)&&1===b.geometryData.length&&"./geometries/0"===b.geometryData[0].href||this.logger.warn('Invalid geometry data on node "'+
a+'"');null==b.attributeData||Array.isArray(b.attributeData)&&!b.attributeData.some(function(a,b){return a.href!=="./attributes/f_"+b+"/0"})||this.logger.warn('Invalid attribute data on node "'+a+'"');b.featureData&&1<b.featureData.length&&this.logger.warn("Node "+a+" has "+b.featureData.length+" bundles. Only the first bundle will be loaded.");var d=b.hasOwnProperty("obb")&&!this.ignoreServiceOBB?b.obb:null,e=b.featureData&&1===b.featureData.length&&b.featureData[0].featureRange?b.featureData[0].featureRange[1]-
b.featureData[0].featureRange[0]+1:null,f=function(b){if(null==b)return null;var d=function(b){return c.logger.error("Invalid node reference on node "+a+": "+b)};if("number"===typeof b.id)d("id "+b.id+" is a number instead of a string.");else if("string"!==typeof b.id||!Array.isArray(b.mbs))return d("Missing or invalid id."),null;if(!Array.isArray(b.mbs))return d("Invalid bounding volume on reference "+b.id+"."),null;b.href&&b.href!=="../"+b.id&&c.logger.error('Invalid node href on node "'+a+'"');
d=b.hasOwnProperty("obb")&&!c.ignoreServiceOBB?b.obb:null;return{id:""+b.id,mbs:b.mbs,obb:d}},f=Array.isArray(b.children)?b.children.map(f).filter(function(a){return null!=a}):null;return{id:a,mbs:b.mbs,obb:d,children:f,resources:{hasFeatureData:b.featureData&&0<b.featureData.length,hasSharedResource:null!=b.sharedResource,attributes:b.attributeData?a:null,texture:b.textureData&&0<b.textureData.length?a:null,geometry:null!=b.geometryData?a:null},version:"string"===typeof b.version?b.version:null,
lodSelection:Array.isArray(b.lodSelection)?b.lodSelection:null,numFeatures:e}};b.prototype.resetFailedNodes=function(){this._failedNodes.clear();this._failedPages.clear();this.forAllNodes(function(a){a.node&&(a.node.failed=!1)})};b.prototype.entryPriority=function(a){var b=this.getNodeInternal(a),c=this.getParentIndex(a);if(k.isNone(b)||0>c&&null==b.node)return 0>c?Infinity:this.entryPriority(c);var d=0;b.node&&0<=c&&(c=this._nodeTraversalState[c],null!=c&&(d=c.lodLevel));for(c=this.progressiveLoadPenalty;0<=
a;a=this.getParentIndex(a))if(this._isLoaded(a)){c=0;break}b=this.viewportQueries.distToPOI(b.ref||b.node);return-b-d*(b+this.progressiveLoadPenalty)+c};b.prototype.traverseVisible=function(a){var b=this.getNodeInternal(this.rootIndex);k.isSome(b)?this._traverse(this.rootIndex,b,a):a(this.rootIndex,null)};b.prototype._traverse=function(a,b,c){if(b.node&&0===b.childCount)this.isGeometryVisible(a)&&c(a,b);else if(this.isNodeVisible(a)&&(c(a,b),null!=b.node)){var d=this.nodeTraversalState(b.node);if(!d.nodeHasLOD||
d.lodLevel!==this._maxLodLevel)for(a=k.expect(this.getPage(a)),d=0;d<b.childCount;d++){var e=a.children[b.childOffset+d],f=this.getNodeInternal(e);k.isSome(f)?this._traverse(e,f,c):c(e,null)}}};b.prototype.traverse=function(a,b){b(a)&&this.traverseChildren(a,b)};b.prototype.traverseChildren=function(a,b){a=a.index;var c=this.getNodeInternal(a);k.isSome(c)&&this._traverseChildren(a,c,b)};b.prototype._traverseChildren=function(a,b,c){a=this.getPage(a);if(!k.isNone(a))for(var d=0;d<b.childCount;++d){var e=
a.children[b.childOffset+d],f=this.getNodeInternal(e);k.isSome(f)&&f.node&&c(f.node)&&this._traverseChildren(e,f,c)}};b.prototype.updateStats=function(a){0<this._updates.add.length&&(a.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)a.index+=" + "+this._indexMissing||this._prefetch.length;a.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){var b=this._featureEstimate.estimate-a.features;0<b?a.features+=" + "+b:0>b&&(a.features+=" - "+-b)}};b.prototype.getPriority=
function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};b.prototype.updateElevationInfo=function(a){this.forAllNodes(c);this.viewportQueries.updateElevationInfo(a)};b.prototype.invalidateBoundingVolumeCache=function(a){a=this.getNodeInternal(a);k.isSome(a)&&c(a)};b.prototype.forAllNodes=function(a){for(var b=0;b<this.nodePages.length;b++){var c=this.nodePages[b];if(c)for(var d=b*this.nodesPerPage,e=0;e<c.nodes.length;e++)a(c.nodes[e],d+e)}};Object.defineProperty(b.prototype,"test",
{get:function(){var a=this;return{addNode:function(b,c){return a.addNode(b,c)}}},enumerable:!0,configurable:!0});return b}();b.I3SIndex=n;var x=new Map,w=function(){function a(){this.update=new h({deallocator:null});this.add=new h({deallocator:null});this.cancel=[]}a.prototype.reset=function(a,b){this.add.clear();this.update.clear();this.cancel=a;this.missing=b};return a}(),u=[["maxScreenThreshold",1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",4]];b.selectErrorMetric=
r;var y=function(){return function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}()})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require","exports","../../../../core/PooledArray"],function(n,b,l){n=function(){function b(a){this.layerView=a;this._lodGlobalDirty=!1}b.prototype.startNodeLoading=function(a,b,e,d,f,c,h){this._maxLodLevel=h.maxLodLevel;this._index=c;this._nodeTraversalState=d;this._isNodeVisible=a;this._isGeometryVisible=b;this._isNodeInScaleBounds=
e;this._removeNodes=f};b.prototype.shouldLoadNode=function(a){var b=this._nodeTraversalState(a);return this.isChosenMaxLOD(b)?!0:b.isChosen?this._childrenRequireLoading(a):!1};b.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0};Object.defineProperty(b.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._index&&!0===this._lodGlobalDirty},enumerable:!0,configurable:!0});b.prototype.lodGlobalHandling=function(a){if(!this.requiresLODGlobalHandling)return!1;var b=Math.max(0,
Math.floor(10*(this.layerView.view.resourceController.memoryController.usedMemory-1)));k.clear();this._lodGlobalHandlingRecursion(this._index.rootNode,b);b=k.length;this._removeNodes(k,a);a=k.length<b;0===k.length&&(this._lodGlobalDirty=!1);k.clear();return a};b.prototype._lodGlobalHandlingRecursion=function(a,b){if(null==a)return!1;var e=this._nodeTraversalState(a),d=this.isChosenMaxLOD(e);(e=this.layerView.isNodeLoaded(a.index))&&null!=this.layerView.updateNodeStatus&&this.layerView.updateNodeStatus(a.index,
d?"leaf":"hole");if(d&&e)return this._removeChildrenRecursive(a),!0;var f=!1;if(0<a.childCount)for(var f=!0,c=0;c<a.childCount;c++){var g=this._index.getChildIndex(a,c),h=this._index.getNode(g);h?this._isGeometryVisible(g)&&!this._lodGlobalHandlingRecursion(h,b)&&this._isNodeInScaleBounds(h)&&(f=!1):this._isNodeVisible(g)&&(f=!1)}e&&!d&&(f||k.length<b)&&(k.push(a.index),e=!1);a=!a.resources.hasFeatureData;return f||e||a};b.prototype._removeChildrenRecursive=function(a){this._index.traverseChildren(a,
function(a){k.push(a.index);return!0})};b.prototype.childrenEmpty=function(a){var b=this,e=!0;this._index.traverseChildren(a,function(a){return e&&b._isNodeVisible(a.index)?b.layerView.isNodeLoaded(a.index)?e=!1:!0:!1});return e};b.prototype._childrenRequireLoading=function(a){var b=this,e=!1,d=!0;this._index.traverseChildren(a,function(a){if(!d||!b._isNodeVisible(a.index))return!1;var c=b._nodeTraversalState(a);b.isChosenMaxLOD(c)&&b._isGeometryVisible(a.index)&&(e=!0);return b.layerView.isNodeLoaded(a.index)?
d=!1:!0});return d&&e};b.prototype.isChosenMaxLOD=function(a){return a.isChosen&&(!a.nodeHasLOD||a.lodLevel===this._maxLodLevel)};return b}();var k=new l({deallocator:null});return n})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/has ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../libs/draco/DracoDecoder ./I3SBinaryReader ./I3SMaterialUtil ./I3SUtil".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q){n=function(){function b(a,b,d,e,f,g){this.streamDataController=b;this.logger=d;this.defaultGeometrySchema=e;this.requiredAttributes=f;this.options=g;this.layerUrl=a.parsedUrl.path;this.geometryDefinitions=a.geometryDefinitions;if(a.materialDefinitions){var h=a.textureSetDefinitions;this.materialAndTextures=a.materialDefinitions.map(function(a){return c.getMaterialAndTextures(h,a)})}}b.prototype.load=function(a,b,c){return this.streamDataController.request(a,b,{signal:c})};
b.prototype.loadAttribute=function(a,b,c){return this.load(this.layerUrl+"/nodes/"+a.resources.attributes+"/attributes/"+b.key+"/0","binary",c).then(function(a){return f.readBinaryAttribute(b,a)})};b.prototype.loadAttributes=function(a,b,c){var d=this;return g.eachAlways(b.map(function(b){return d.loadAttribute(a,b.attributeStorageInfo,c)})).then(function(c){for(var e={},f=0;f<b.length;++f)c[f].value?e[b[f].name]=c[f].value:g.isAbortError(c[f].error)||d.logger.error("Failed to load attributeData for '"+
b[f].name+"' on node '"+a.id+"'");return e})};b.prototype.loadNodeData=function(b,e){return k(this,void 0,void 0,function(){var k,n,q,m,r,t,x,C,D,K,I,Q,J,N,L,M,R,S,T,U,Y;return l(this,function(l){switch(l.label){case 0:k=null!=this.requiredAttributes&&b.resources.attributes?this.loadAttributes(b,this.requiredAttributes,e):g.resolve({});var u=this.geometryDefinitions;l={bufferDefinition:null,bufferIndex:0};if(!(null==u||0>b.resources.geometryDefinition)&&(u=0<=b.resources.geometryDefinition?u[b.resources.geometryDefinition].geometryBuffers:
null,null!=u))for(var v=0;v<u.length;v++)if(null!=u[v].compressedAttributes){if("draco"===u[v].compressedAttributes.encoding&&d.isSupported()&&!h("disable-feature:i3s-draco")){l.bufferIndex=v;l.bufferDefinition=u[v];break}}else l.bufferIndex=v,l.bufferDefinition=u[v];n=l;q=n.bufferDefinition;m=n.bufferIndex;r=b.resources.geometry?this.loadGeometry(b,m,e):null;return b.resources.hasSharedResource?[4,this.loadShared(b,e)]:[3,2];case 1:return x=l.sent(),[3,3];case 2:x=null,l.label=3;case 3:return t=
x,D=(C=this.materialAndTextures&&0<=b.resources.materialDefinition?this.materialAndTextures[b.resources.materialDefinition]:null!=t?c.getMaterialAndTexturesFromShared(t):null)&&C.material,K=C&&C.textures,this.options.loadFeatureData?[4,this.loadFeatureData(b,e)]:[3,5];case 4:return Q=l.sent(),[3,6];case 5:Q=null,l.label=6;case 6:return I=Q,J=this.options.loadFeatureData?this.collectGeometries(I):this.meshPyramidGeometryData(b,D),N=null!=K&&0<K.length?this.loadTextures(b,K,e):null,M=L=null,r?[4,r]:
[3,8];case 7:L=l.sent();u=this.defaultGeometrySchema;v=t;if(u&&v&&v.materialDefinitions){var w=Object.keys(v.materialDefinitions)[0];!v.materialDefinitions[w].params.vertexRegions&&u.vertexAttributes.region&&(u=a.clone(u),delete u.vertexAttributes.region)}R=u;if(S=!(!q||!q.compressedAttributes||"draco"!==q.compressedAttributes.encoding)){u={};v=0;for(w=q.compressedAttributes.attributes;v<w.length;v++){var y=w[v];p[y]&&(u[p[y]]={valueType:null})}u={header:null,byteOffset:0,byteCount:0,vertexAttributes:u}}else u=
q?f.createGeometryIndexFromDefinition(q,b.vertexCount,b.numFeatures):f.createGeometryIndexFromSchema(L,R);M=u;l.label=8;case 8:return[4,N];case 9:return T=l.sent(),[4,k];case 10:return Y=(U=l.sent())?{attributeData:U,loadedAttributes:this.requiredAttributes}:null,[2,{allGeometryData:J,attributeDataInfo:Y,geometryBuffer:L,geometryIndex:M,requiredTextures:K,textureData:T}]}})})};b.addAbsoluteHrefTexture=function(a,b){a=a.textureDefinitions;if(null!=a)for(var c=0,d=Object.keys(a);c<d.length;c++)for(var f=
0,g=a[d[c]].images;f<g.length;f++){var h=g[f];Array.isArray(h.href)?h.hrefConcat=h.href.map(function(a){return e.makeAbsolute(a,b)}):h.hrefConcat=e.makeAbsolute(h.href,b)}};b.fixTextureEncodings=function(a){a=a.textureDefinitions;if(null!=a)for(var b in a){var c=a[b];if(Array.isArray(c.encoding))for(var d=0;d<c.encoding.length;d++){var e=c.encoding[d];"data:"===e.substring(0,5)&&(c.encoding[d]=e.substring(5))}else e=c.encoding,"data:"===e.substring(0,5)&&(c.encoding=e.substring(5))}};b.prototype.loadShared=
function(a,c){var d=this.layerUrl+"/nodes/"+a.resources.geometry+"/shared";return this.load(d,"json",c).then(function(a){b.fixTextureEncodings(a);b.addAbsoluteHrefTexture(a,d);return a})};b.prototype.loadTexture=function(a,b,c,d,e,f){return e===q.DDS_ENCODING_STRING?this.load(a,"binary",f).then(function(a){return{id:b,usage:c,data:a,encoding:e}}):this.load(a,"image",f).then(function(a){var f=a;if(d&&4096<=a.width*a.height){var f=Math.ceil(a.width/2),g=Math.ceil(a.height/2),h=document.createElement("canvas");
h.width=f;h.height=g;h.getContext("2d").drawImage(a,0,0,f,g);f=h}return{id:b,usage:c,data:f,encoding:e}})};b.prototype.loadTextures=function(a,c,d){var e=this,f=this.options.textureFormat===b.TextureFormat.Compressed,h=this.options.textureFormat===b.TextureFormat.Downsampled,k=this.options.textureUsageMask;return g.all(c.map(function(b){if(0===(b.usage&k))return null;var c=q.selectEncoding(b.encodings,f);return null==c?(e.logger.error("No known encoding for texture found on node "+a.id),g.reject()):
e.loadTexture(e.layerUrl+"/nodes/"+(a.resources.texture||a.id)+"/textures/"+c.name,b.id,b.usage,h,c.encoding,d)}))};b.prototype.meshPyramidGeometryData=function(a,b){return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:b}}],featureDataPosition:[0,0,0]}]};b.prototype.collectGeometries=function(a){var b=[],c=0;for(a=a.featureData;c<a.length;c++){var d=a[c],e=d.geometries;if(null!=e)for(var f=0;f<e.length;f++)b.push({featureIds:[d.id],featureDataPosition:d.position,geometries:[e[f]]});
else null!=d.position&&b.push({featureIds:[d.id],featureDataPosition:d.position,geometries:null})}return b};b.prototype.loadFeatureData=function(a,b){return this.load(this.layerUrl+"/nodes/"+a.id+"/features/0","json",b)};b.prototype.loadGeometry=function(a,b,c){return this.load(this.layerUrl+"/nodes/"+a.resources.geometry+"/geometries/"+b,"binary",c)};return b}();var p={position:"position",normal:"normal",uv0:"uv0",uv1:"uv1",color:"color","uv-region":"region"};(function(a){a=a.TextureFormat||(a.TextureFormat=
{});a[a.Compressed=0]="Compressed";a[a.Normal=1]="Normal";a[a.Downsampled=2]="Downsampled"})(n||(n={}));return n})},"esri/libs/draco/DracoDecoder":function(){define(["require","exports","../../core/has","../../core/promiseUtils","./draco_decoder"],function(n,b,l,k,h){function a(){return!!l("esri-wasm")}function g(){return n.toUrl("./draco_decoder.wasm")}Object.defineProperty(b,"__esModule",{value:!0});(function(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])})(h);b.isSupported=a;b.getDecoderModule=
function(){if(!a())return k.reject(Error("Draco decompression not available, missing WebAssembly support"));e||(e=k.create(function(a,b){return n(["./draco_decoder"],function(b){d=b({locateFile:g});a(d)})}).catch(function(a){return k.reject(a)}));return e};var e,d})},"esri/libs/draco/draco_decoder":function(){var n=function(){var b="undefined"!==typeof document&&document.currentScript?document.currentScript.src:void 0;return function(l){function k(a){return F.locateFile?F.locateFile(a,na):na+a}function h(a,
b){a||y("Assertion failed: "+b)}function a(a,b){var c;if(a){c=W;var d=a+b;for(b=a;c[b]&&!(b>=d);)++b;if(16<b-a&&c.subarray&&H)c=H.decode(c.subarray(a,b));else{for(d="";a<b;){var e=c[a++];if(e&128){var f=c[a++]&63;if(192==(e&224))d+=String.fromCharCode((e&31)<<6|f);else{var g=c[a++]&63,e=224==(e&240)?(e&15)<<12|f<<6|g:(e&7)<<18|f<<12|g<<6|c[a++]&63;65536>e?d+=String.fromCharCode(e):(e-=65536,d+=String.fromCharCode(55296|e>>10,56320|e&1023))}}else d+=String.fromCharCode(e)}c=d}}else c="";return c}function g(a,
b){0<a%b&&(a+=b-a%b);return a}function e(){F.HEAP8=sa=new Int8Array(qa);F.HEAP16=new Int16Array(qa);F.HEAP32=ga=new Int32Array(qa);F.HEAPU8=W=new Uint8Array(qa);F.HEAPU16=new Uint16Array(qa);F.HEAPU32=new Uint32Array(qa);F.HEAPF32=new Float32Array(qa);F.HEAPF64=new Float64Array(qa)}function d(a){for(;0<a.length;){var b=a.shift();if("function"==typeof b)b();else{var c=b.func;"number"===typeof c?void 0===b.arg?F.dynCall_v(c):F.dynCall_vi(c,b.arg):c(void 0===b.arg?null:b.arg)}}}function f(a){return String.prototype.startsWith?
a.startsWith("data:application/octet-stream;base64,"):0===a.indexOf("data:application/octet-stream;base64,")}function c(){try{if(F.wasmBinary)return new Uint8Array(F.wasmBinary);if(F.readBinary)return F.readBinary(Ua);throw"both async and sync fetching of the wasm failed";}catch(tb){y(tb)}}function n(){return F.wasmBinary||!va&&!fa||"function"!==typeof fetch?new Promise(function(a,b){a(c())}):fetch(Ua,{credentials:"same-origin"}).then(function(a){if(!a.ok)throw"failed to load wasm binary file at '"+
Ua+"'";return a.arrayBuffer()}).catch(function(){return c()})}function p(a){function b(a,b){F.asm=a.exports;hb--;F.monitorRunDependencies&&F.monitorRunDependencies(hb);0==hb&&(null!==Ba&&(clearInterval(Ba),Ba=null),db&&(a=db,db=null,a()))}function c(a){b(a.instance)}function d(a){n().then(function(a){return WebAssembly.instantiate(a,e)}).then(a,function(a){ya("failed to asynchronously prepare wasm: "+a);y(a)})}var e={env:a,global:{NaN:NaN,Infinity:Infinity},"global.Math":Math,asm2wasm:G};hb++;F.monitorRunDependencies&&
F.monitorRunDependencies(hb);if(F.instantiateWasm)try{return F.instantiateWasm(e,b)}catch(Dd){return ya("Module.instantiateWasm callback failed with error: "+Dd),!1}F.wasmBinary||"function"!==typeof WebAssembly.instantiateStreaming||f(Ua)||"function"!==typeof fetch?d(c):WebAssembly.instantiateStreaming(fetch(Ua,{credentials:"same-origin"}),e).then(c,function(a){ya("wasm streaming compile failed: "+a);ya("falling back to ArrayBuffer instantiation");d(c)});return{}}function r(){return!!r.uncaught_exception}
function t(){return sa.length}function x(a){a=g(a,65536);var b=qa.byteLength;try{return-1!==Ea.grow((a-b)/65536)?(qa=Ea.buffer,!0):!1}catch(vd){return!1}}function w(a){this.name="ExitStatus";this.message="Program terminated with exit("+a+")";this.status=a}function u(a){function b(){if(!F.calledRun&&(F.calledRun=!0,!za)){Ga||(Ga=!0,d(Ta));d(A);if(F.onRuntimeInitialized)F.onRuntimeInitialized();if(F.postRun)for("function"==typeof F.postRun&&(F.postRun=[F.postRun]);F.postRun.length;)pa.unshift(F.postRun.shift());
d(pa)}}if(!(0<hb)){if(F.preRun)for("function"==typeof F.preRun&&(F.preRun=[F.preRun]);F.preRun.length;)Ra.unshift(F.preRun.shift());d(Ra);0<hb||F.calledRun||(F.setStatus?(F.setStatus("Running..."),setTimeout(function(){setTimeout(function(){F.setStatus("")},1);b()},1)):b())}}function y(a){if(F.onAbort)F.onAbort(a);void 0!==a?(ua(a),ya(a),a=JSON.stringify(a)):a="";za=!0;throw"abort("+a+"). Build with -s ASSERTIONS\x3d1 for more info.";}function m(){}function v(a){return(a||m).__cache__}function z(a,
b){var c=v(b),d=c[a];if(d)return d;d=Object.create((b||m).prototype);d.ptr=a;return c[a]=d}function B(a){if("string"===typeof a){for(var b=0,c=0;c<a.length;++c){var d=a.charCodeAt(c);55296<=d&&57343>=d&&(d=65536+((d&1023)<<10)|a.charCodeAt(++c)&1023);127>=d?++b:b=2047>=d?b+2:65535>=d?b+3:b+4}b=Array(b+1);c=0;d=b.length;if(0<d){for(var d=c+d-1,e=0;e<a.length;++e){var f=a.charCodeAt(e);if(55296<=f&&57343>=f)var g=a.charCodeAt(++e),f=65536+((f&1023)<<10)|g&1023;if(127>=f){if(c>=d)break;b[c++]=f}else{if(2047>=
f){if(c+1>=d)break;b[c++]=192|f>>6}else{if(65535>=f){if(c+2>=d)break;b[c++]=224|f>>12}else{if(c+3>=d)break;b[c++]=240|f>>18;b[c++]=128|f>>12&63}b[c++]=128|f>>6&63}b[c++]=128|f&63}}b[c]=0}a=Oa.alloc(b,sa);Oa.copy(b,sa,a)}return a}function C(){throw"cannot construct a Status, no constructor in IDL";}function D(){this.ptr=Tc();v(D)[this.ptr]=this}function K(){this.ptr=hc();v(K)[this.ptr]=this}function I(){this.ptr=jd();v(I)[this.ptr]=this}function Q(){this.ptr=Eb();v(Q)[this.ptr]=this}function J(){this.ptr=
ta();v(J)[this.ptr]=this}function N(){this.ptr=Gc();v(N)[this.ptr]=this}function L(){this.ptr=Nb();v(L)[this.ptr]=this}function M(){this.ptr=Ha();v(M)[this.ptr]=this}function R(){this.ptr=dc();v(R)[this.ptr]=this}function S(){this.ptr=qb();v(S)[this.ptr]=this}function T(){this.ptr=Kc();v(T)[this.ptr]=this}function U(){this.ptr=Cc();v(U)[this.ptr]=this}function Y(){this.ptr=xd();v(Y)[this.ptr]=this}function X(){this.ptr=vb();v(X)[this.ptr]=this}function P(){this.ptr=nb();v(P)[this.ptr]=this}function V(){this.ptr=
ba();v(V)[this.ptr]=this}function Z(){throw"cannot construct a VoidPtr, no constructor in IDL";}function ca(){this.ptr=Xb();v(ca)[this.ptr]=this}function da(){this.ptr=md();v(da)[this.ptr]=this}l=l||{};var F="undefined"!==typeof l?l:{},ea=!1,la=!1;F.onRuntimeInitialized=function(){ea=!0;if(la&&"function"===typeof F.onModuleLoaded)F.onModuleLoaded(F)};F.onModuleParsed=function(){la=!0;if(ea&&"function"===typeof F.onModuleLoaded)F.onModuleLoaded(F)};F.isVersionSupported=function(a){if("string"!==typeof a)return!1;
a=a.split(".");return 2>a.length||3<a.length?!1:1==a[0]&&0<=a[1]&&3>=a[1]?!0:0!=a[0]||10<a[1]?!1:!0};var ka={},oa;for(oa in F)F.hasOwnProperty(oa)&&(ka[oa]=F[oa]);F.arguments=[];F.thisProgram="./this.program";F.quit=function(a,b){throw b;};F.preRun=[];F.postRun=[];var va=!1,fa=!1,xa=!1,ia=!1,va="object"===typeof window,fa="function"===typeof importScripts,xa="object"===typeof process&&"function"===typeof require&&!va&&!fa,ia=!va&&!xa&&!fa,na="";if(xa){var na=__dirname+"/",wa,Ca;F.read=function(a,
b){wa||(wa=require("fs"));Ca||(Ca=require("path"));a=Ca.normalize(a);a=wa.readFileSync(a);return b?a:a.toString()};F.readBinary=function(a){a=F.read(a,!0);a.buffer||(a=new Uint8Array(a));h(a.buffer);return a};1<process.argv.length&&(F.thisProgram=process.argv[1].replace(/\\/g,"/"));F.arguments=process.argv.slice(2);process.on("uncaughtException",function(a){if(!(a instanceof w))throw a;});process.on("unhandledRejection",y);F.quit=function(a){process.exit(a)};F.inspect=function(){return"[Emscripten Module object]"}}else if(ia)"undefined"!=
typeof read&&(F.read=function(a){return read(a)}),F.readBinary=function(a){if("function"===typeof readbuffer)return new Uint8Array(readbuffer(a));a=read(a,"binary");h("object"===typeof a);return a},"undefined"!=typeof scriptArgs?F.arguments=scriptArgs:"undefined"!=typeof arguments&&(F.arguments=arguments),"function"===typeof quit&&(F.quit=function(a){quit(a)});else if(va||fa)fa?na=self.location.href:document.currentScript&&(na=document.currentScript.src),b&&(na=b),na=0!==na.indexOf("blob:")?na.substr(0,
na.lastIndexOf("/")+1):"",F.read=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send(null);return b.responseText},fa&&(F.readBinary=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.responseType="arraybuffer";b.send(null);return new Uint8Array(b.response)}),F.readAsync=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(){200==d.status||0==d.status&&d.response?b(d.response):c()};d.onerror=c;d.send(null)},F.setWindowTitle=function(a){document.title=
a};var ua=F.print||("undefined"!==typeof console?console.log.bind(console):"undefined"!==typeof print?print:null),ya=F.printErr||("undefined"!==typeof printErr?printErr:"undefined"!==typeof console&&console.warn.bind(console)||ua);for(oa in ka)ka.hasOwnProperty(oa)&&(F[oa]=ka[oa]);var ka=void 0,G={"f64-rem":function(a,b){return a%b},"debugger":function(){debugger}};"object"!==typeof WebAssembly&&ya("no native wasm support detected");var Ea,za=!1,H="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):
void 0;"undefined"!==typeof TextDecoder&&new TextDecoder("utf-16le");var qa,sa,W,ga,Pa=F.TOTAL_MEMORY||16777216;5242880>Pa&&ya("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+Pa+"! (TOTAL_STACK\x3d5242880)");F.buffer?qa=F.buffer:"object"===typeof WebAssembly&&"function"===typeof WebAssembly.Memory?(Ea=new WebAssembly.Memory({initial:Pa/65536}),qa=Ea.buffer):qa=new ArrayBuffer(Pa);e();ga[4088]=5259264;var Ra=[],Ta=[],A=[],pa=[],Ga=!1,hb=0,Ba=null,db=null;F.preloadedImages={};F.preloadedAudios=
{};var Ua="draco_decoder.wasm";f(Ua)||(Ua=k(Ua));F.asm=function(a,b,c){b.memory=Ea;b.table=new WebAssembly.Table({initial:490,maximum:490,element:"anyfunc"});b.__memory_base=1024;b.__table_base=0;return p(b)};var Da={last:0,caught:[],infos:{},deAdjust:function(a){if(!a||Da.infos[a])return a;for(var b in Da.infos)for(var c=+b,d=Da.infos[c].adjusted,e=d.length,f=0;f<e;f++)if(d[f]===a)return c;return a},addRef:function(a){a&&Da.infos[a].refcount++},decRef:function(a){if(a){var b=Da.infos[a];h(0<b.refcount);
b.refcount--;if(0===b.refcount&&!b.rethrown){b.destructor&&F.dynCall_vi(b.destructor,a);delete Da.infos[a];try{Cd(a)}catch(vd){}}}},clearRef:function(a){a&&(Da.infos[a].refcount=0)}},Ya=F.asm({},{e:y,d:function(a){return ud(a)},k:function(){za=!0;throw"Pure virtual function called!";},c:function(a,b,c){Da.infos[a]={ptr:a,adjusted:[a],type:b,destructor:c,refcount:0,caught:!1,rethrown:!1};Da.last=a;"uncaught_exception"in r?r.uncaught_exception++:r.uncaught_exception=1;throw a;},f:function(a){F.___errno_location&&
(ga[F.___errno_location()>>2]=a);return a},b:function(){F.abort()},j:t,i:function(a,b,c){W.set(W.subarray(b,b+c),a)},h:function(a){var b=t();if(2147418112<a)return!1;for(b=Math.max(b,16777216);b<a;)b=536870912>=b?g(2*b,65536):Math.min(g((3*b+2147483648)/4,65536),2147418112);if(!x(b))return!1;e();return!0},g:function(){y("trap!")},l:function(a){y("OOM")},a:16352},qa);F.asm=Ya;var ta=F._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=function(){return F.asm.m.apply(null,
arguments)},Qa=F._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=function(){return F.asm.n.apply(null,arguments)},aa=F._emscripten_bind_AttributeOctahedronTransform___destroy___0=function(){return F.asm.o.apply(null,arguments)},Fa=F._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=function(){return F.asm.p.apply(null,arguments)},Ha=F._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=function(){return F.asm.q.apply(null,arguments)},
Ka=F._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=function(){return F.asm.r.apply(null,arguments)},ra=F._emscripten_bind_AttributeQuantizationTransform___destroy___0=function(){return F.asm.s.apply(null,arguments)},Aa=F._emscripten_bind_AttributeQuantizationTransform_min_value_1=function(){return F.asm.t.apply(null,arguments)},ja=F._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=function(){return F.asm.u.apply(null,arguments)},rb=F._emscripten_bind_AttributeQuantizationTransform_range_0=
function(){return F.asm.v.apply(null,arguments)},Nb=F._emscripten_bind_AttributeTransformData_AttributeTransformData_0=function(){return F.asm.w.apply(null,arguments)},gb=F._emscripten_bind_AttributeTransformData___destroy___0=function(){return F.asm.x.apply(null,arguments)},ab=F._emscripten_bind_AttributeTransformData_transform_type_0=function(){return F.asm.y.apply(null,arguments)},vb=F._emscripten_bind_DecoderBuffer_DecoderBuffer_0=function(){return F.asm.z.apply(null,arguments)},Za=F._emscripten_bind_DecoderBuffer_Init_2=
function(){return F.asm.A.apply(null,arguments)},$a=F._emscripten_bind_DecoderBuffer___destroy___0=function(){return F.asm.B.apply(null,arguments)},xb=F._emscripten_bind_Decoder_DecodeBufferToMesh_2=function(){return F.asm.C.apply(null,arguments)},Ob=F._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=function(){return F.asm.D.apply(null,arguments)},nb=F._emscripten_bind_Decoder_Decoder_0=function(){return F.asm.E.apply(null,arguments)},Fb=F._emscripten_bind_Decoder_GetAttributeByUniqueId_2=function(){return F.asm.F.apply(null,
arguments)},mc=F._emscripten_bind_Decoder_GetAttributeFloatArrayForAllPoints_4=function(){return F.asm.G.apply(null,arguments)},Ab=F._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=function(){return F.asm.H.apply(null,arguments)},Rb=F._emscripten_bind_Decoder_GetAttributeFloat_3=function(){return F.asm.I.apply(null,arguments)},lb=F._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=function(){return F.asm.J.apply(null,arguments)},jb=F._emscripten_bind_Decoder_GetAttributeIdByName_2=
function(){return F.asm.K.apply(null,arguments)},Sb=F._emscripten_bind_Decoder_GetAttributeId_2=function(){return F.asm.L.apply(null,arguments)},Hb=F._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=function(){return F.asm.M.apply(null,arguments)},Bb=F._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=function(){return F.asm.N.apply(null,arguments)},$b=F._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=function(){return F.asm.O.apply(null,arguments)},Ib=F._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=
function(){return F.asm.P.apply(null,arguments)},ub=F._emscripten_bind_Decoder_GetAttributeMetadata_2=function(){return F.asm.Q.apply(null,arguments)},Qb=F._emscripten_bind_Decoder_GetAttributeUInt16ArrayForAllPoints_4=function(){return F.asm.R.apply(null,arguments)},Jb=F._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=function(){return F.asm.S.apply(null,arguments)},Kb=F._emscripten_bind_Decoder_GetAttributeUInt32ArrayForAllPoints_4=function(){return F.asm.T.apply(null,arguments)},ac=F._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=
function(){return F.asm.U.apply(null,arguments)},O=F._emscripten_bind_Decoder_GetAttributeUInt8ArrayForAllPoints_4=function(){return F.asm.V.apply(null,arguments)},Ia=F._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=function(){return F.asm.W.apply(null,arguments)},wb=F._emscripten_bind_Decoder_GetAttribute_2=function(){return F.asm.X.apply(null,arguments)},Wa=F._emscripten_bind_Decoder_GetEncodedGeometryType_1=function(){return F.asm.Y.apply(null,arguments)},Ub=F._emscripten_bind_Decoder_GetFaceFromMesh_3=
function(){return F.asm.Z.apply(null,arguments)},ma=F._emscripten_bind_Decoder_GetMetadata_1=function(){return F.asm._.apply(null,arguments)},Lb=F._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=function(){return F.asm.$.apply(null,arguments)},Mb=F._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=function(){return F.asm.aa.apply(null,arguments)},Tb=F._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=function(){return F.asm.ba.apply(null,arguments)},ed=F._emscripten_bind_Decoder_SkipAttributeTransform_1=
function(){return F.asm.ca.apply(null,arguments)},Wc=F._emscripten_bind_Decoder___destroy___0=function(){return F.asm.da.apply(null,arguments)},Cc=F._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=function(){return F.asm.ea.apply(null,arguments)},wd=F._emscripten_bind_DracoFloat32Array_GetArray_2=function(){return F.asm.fa.apply(null,arguments)},kc=F._emscripten_bind_DracoFloat32Array_GetValue_1=function(){return F.asm.ga.apply(null,arguments)},Oc=F._emscripten_bind_DracoFloat32Array___destroy___0=
function(){return F.asm.ha.apply(null,arguments)},Jc=F._emscripten_bind_DracoFloat32Array_size_0=function(){return F.asm.ia.apply(null,arguments)},Kc=F._emscripten_bind_DracoInt16Array_DracoInt16Array_0=function(){return F.asm.ja.apply(null,arguments)},xc=F._emscripten_bind_DracoInt16Array_GetArray_2=function(){return F.asm.ka.apply(null,arguments)},bc=F._emscripten_bind_DracoInt16Array_GetValue_1=function(){return F.asm.la.apply(null,arguments)},Cb=F._emscripten_bind_DracoInt16Array___destroy___0=
function(){return F.asm.ma.apply(null,arguments)},cc=F._emscripten_bind_DracoInt16Array_size_0=function(){return F.asm.na.apply(null,arguments)},Xb=F._emscripten_bind_DracoInt32Array_DracoInt32Array_0=function(){return F.asm.oa.apply(null,arguments)},vc=F._emscripten_bind_DracoInt32Array_GetArray_2=function(){return F.asm.pa.apply(null,arguments)},yc=F._emscripten_bind_DracoInt32Array_GetValue_1=function(){return F.asm.qa.apply(null,arguments)},Lc=F._emscripten_bind_DracoInt32Array___destroy___0=
function(){return F.asm.ra.apply(null,arguments)},zc=F._emscripten_bind_DracoInt32Array_size_0=function(){return F.asm.sa.apply(null,arguments)},dc=F._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return F.asm.ta.apply(null,arguments)},Ec=F._emscripten_bind_DracoInt8Array_GetArray_2=function(){return F.asm.ua.apply(null,arguments)},ec=F._emscripten_bind_DracoInt8Array_GetValue_1=function(){return F.asm.va.apply(null,arguments)},Vb=F._emscripten_bind_DracoInt8Array___destroy___0=function(){return F.asm.wa.apply(null,
arguments)},Fc=F._emscripten_bind_DracoInt8Array_size_0=function(){return F.asm.xa.apply(null,arguments)},Tc=F._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=function(){return F.asm.ya.apply(null,arguments)},Uc=F._emscripten_bind_DracoUInt16Array_GetArray_2=function(){return F.asm.za.apply(null,arguments)},id=F._emscripten_bind_DracoUInt16Array_GetValue_1=function(){return F.asm.Aa.apply(null,arguments)},yd=F._emscripten_bind_DracoUInt16Array___destroy___0=function(){return F.asm.Ba.apply(null,
arguments)},hd=F._emscripten_bind_DracoUInt16Array_size_0=function(){return F.asm.Ca.apply(null,arguments)},Eb=F._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=function(){return F.asm.Da.apply(null,arguments)},Yb=F._emscripten_bind_DracoUInt32Array_GetArray_2=function(){return F.asm.Ea.apply(null,arguments)},lc=F._emscripten_bind_DracoUInt32Array_GetValue_1=function(){return F.asm.Fa.apply(null,arguments)},Wb=F._emscripten_bind_DracoUInt32Array___destroy___0=function(){return F.asm.Ga.apply(null,
arguments)},Ac=F._emscripten_bind_DracoUInt32Array_size_0=function(){return F.asm.Ha.apply(null,arguments)},jd=F._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=function(){return F.asm.Ia.apply(null,arguments)},zd=F._emscripten_bind_DracoUInt8Array_GetArray_2=function(){return F.asm.Ja.apply(null,arguments)},gd=F._emscripten_bind_DracoUInt8Array_GetValue_1=function(){return F.asm.Ka.apply(null,arguments)},Ic=F._emscripten_bind_DracoUInt8Array___destroy___0=function(){return F.asm.La.apply(null,
arguments)},fd=F._emscripten_bind_DracoUInt8Array_size_0=function(){return F.asm.Ma.apply(null,arguments)},xd=F._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return F.asm.Na.apply(null,arguments)},rc=F._emscripten_bind_GeometryAttribute___destroy___0=function(){return F.asm.Oa.apply(null,arguments)},ba=F._emscripten_bind_Mesh_Mesh_0=function(){return F.asm.Pa.apply(null,arguments)},Na=F._emscripten_bind_Mesh___destroy___0=function(){return F.asm.Qa.apply(null,arguments)},bb=F._emscripten_bind_Mesh_num_attributes_0=
function(){return F.asm.Ra.apply(null,arguments)},Ma=F._emscripten_bind_Mesh_num_faces_0=function(){return F.asm.Sa.apply(null,arguments)},La=F._emscripten_bind_Mesh_num_points_0=function(){return F.asm.Ta.apply(null,arguments)},Va=F._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=function(){return F.asm.Ua.apply(null,arguments)},Zb=F._emscripten_bind_MetadataQuerier_GetEntryName_2=function(){return F.asm.Va.apply(null,arguments)},kd=F._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=function(){return F.asm.Wa.apply(null,
arguments)},$c=F._emscripten_bind_MetadataQuerier_GetIntEntry_2=function(){return F.asm.Xa.apply(null,arguments)},pb=F._emscripten_bind_MetadataQuerier_GetStringEntry_2=function(){return F.asm.Ya.apply(null,arguments)},ad=F._emscripten_bind_MetadataQuerier_HasEntry_2=function(){return F.asm.Za.apply(null,arguments)},qb=F._emscripten_bind_MetadataQuerier_MetadataQuerier_0=function(){return F.asm._a.apply(null,arguments)},ld=F._emscripten_bind_MetadataQuerier_NumEntries_1=function(){return F.asm.$a.apply(null,
arguments)},cb=F._emscripten_bind_MetadataQuerier___destroy___0=function(){return F.asm.ab.apply(null,arguments)},md=F._emscripten_bind_Metadata_Metadata_0=function(){return F.asm.bb.apply(null,arguments)},nd=F._emscripten_bind_Metadata___destroy___0=function(){return F.asm.cb.apply(null,arguments)},od=F._emscripten_bind_PointAttribute_GetAttributeTransformData_0=function(){return F.asm.db.apply(null,arguments)},Gc=F._emscripten_bind_PointAttribute_PointAttribute_0=function(){return F.asm.eb.apply(null,
arguments)},pd=F._emscripten_bind_PointAttribute___destroy___0=function(){return F.asm.fb.apply(null,arguments)},Mc=F._emscripten_bind_PointAttribute_attribute_type_0=function(){return F.asm.gb.apply(null,arguments)},qd=F._emscripten_bind_PointAttribute_byte_offset_0=function(){return F.asm.hb.apply(null,arguments)},Hc=F._emscripten_bind_PointAttribute_byte_stride_0=function(){return F.asm.ib.apply(null,arguments)},rd=F._emscripten_bind_PointAttribute_data_type_0=function(){return F.asm.jb.apply(null,
arguments)},fc=F._emscripten_bind_PointAttribute_normalized_0=function(){return F.asm.kb.apply(null,arguments)},gc=F._emscripten_bind_PointAttribute_num_components_0=function(){return F.asm.lb.apply(null,arguments)},Vc=F._emscripten_bind_PointAttribute_size_0=function(){return F.asm.mb.apply(null,arguments)},bd=F._emscripten_bind_PointAttribute_unique_id_0=function(){return F.asm.nb.apply(null,arguments)},hc=F._emscripten_bind_PointCloud_PointCloud_0=function(){return F.asm.ob.apply(null,arguments)},
mb=F._emscripten_bind_PointCloud___destroy___0=function(){return F.asm.pb.apply(null,arguments)},wc=F._emscripten_bind_PointCloud_num_attributes_0=function(){return F.asm.qb.apply(null,arguments)},sc=F._emscripten_bind_PointCloud_num_points_0=function(){return F.asm.rb.apply(null,arguments)},Bc=F._emscripten_bind_Status___destroy___0=function(){return F.asm.sb.apply(null,arguments)},ic=F._emscripten_bind_Status_code_0=function(){return F.asm.tb.apply(null,arguments)},tc=F._emscripten_bind_Status_error_msg_0=
function(){return F.asm.ub.apply(null,arguments)},uc=F._emscripten_bind_Status_ok_0=function(){return F.asm.vb.apply(null,arguments)},Nc=F._emscripten_bind_VoidPtr___destroy___0=function(){return F.asm.wb.apply(null,arguments)},Xa=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=function(){return F.asm.xb.apply(null,arguments)},jc=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=function(){return F.asm.yb.apply(null,arguments)},nc=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=
function(){return F.asm.zb.apply(null,arguments)},Xc=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=function(){return F.asm.Ab.apply(null,arguments)},Pc=F._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return F.asm.Bb.apply(null,arguments)},Yc=F._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return F.asm.Cb.apply(null,arguments)},Qc=F._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return F.asm.Db.apply(null,
arguments)},E=F._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return F.asm.Eb.apply(null,arguments)},fb=F._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return F.asm.Fb.apply(null,arguments)},kb=F._emscripten_enum_draco_GeometryAttribute_Type_INVALID=function(){return F.asm.Gb.apply(null,arguments)},Pb=F._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return F.asm.Hb.apply(null,arguments)},ha=F._emscripten_enum_draco_GeometryAttribute_Type_POSITION=
function(){return F.asm.Ib.apply(null,arguments)},Db=F._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return F.asm.Jb.apply(null,arguments)},Ad=F._emscripten_enum_draco_StatusCode_ERROR=function(){return F.asm.Kb.apply(null,arguments)},sb=F._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=function(){return F.asm.Lb.apply(null,arguments)},cd=F._emscripten_enum_draco_StatusCode_IO_ERROR=function(){return F.asm.Mb.apply(null,arguments)},sd=F._emscripten_enum_draco_StatusCode_OK=
function(){return F.asm.Nb.apply(null,arguments)},Bd=F._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=function(){return F.asm.Ob.apply(null,arguments)},td=F._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=function(){return F.asm.Pb.apply(null,arguments)},Cd=F._free=function(){return F.asm.Qb.apply(null,arguments)},ud=F._malloc=function(){return F.asm.Rb.apply(null,arguments)};F.dynCall_v=function(){return F.asm.Sb.apply(null,arguments)};F.dynCall_vi=function(){return F.asm.Tb.apply(null,
arguments)};F.asm=Ya;F.then=function(a){if(F.calledRun)a(F);else{var b=F.onRuntimeInitialized;F.onRuntimeInitialized=function(){b&&b();a(F)}}return F};w.prototype=Error();w.prototype.constructor=w;db=function dd(){F.calledRun||u();F.calledRun||(db=dd)};F.run=u;F.abort=y;if(F.preInit)for("function"==typeof F.preInit&&(F.preInit=[F.preInit]);0<F.preInit.length;)F.preInit.pop()();F.noExitRuntime=!0;u();m.prototype=Object.create(m.prototype);m.prototype.constructor=m;m.prototype.__class__=m;m.__cache__=
{};F.WrapperObject=m;F.getCache=v;F.wrapPointer=z;F.castObject=function(a,b){return z(a.ptr,b)};F.NULL=z(0);F.destroy=function(a){if(!a.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";a.__destroy__();delete v(a.__class__)[a.ptr]};F.compare=function(a,b){return a.ptr===b.ptr};F.getPointer=function(a){return a.ptr};F.getClass=function(a){return a.__class__};var Oa={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(Oa.needed){for(var a=0;a<Oa.temps.length;a++)F._free(Oa.temps[a]);
Oa.temps.length=0;F._free(Oa.buffer);Oa.buffer=0;Oa.size+=Oa.needed;Oa.needed=0}Oa.buffer||(Oa.size+=128,Oa.buffer=F._malloc(Oa.size),h(Oa.buffer));Oa.pos=0},alloc:function(a,b){h(Oa.buffer);a=a.length*b.BYTES_PER_ELEMENT;a=a+7&-8;Oa.pos+a>=Oa.size?(h(0<a),Oa.needed+=a,b=F._malloc(a),Oa.temps.push(b)):(b=Oa.buffer+Oa.pos,Oa.pos+=a);return b},copy:function(a,b,c){switch(b.BYTES_PER_ELEMENT){case 2:c>>=1;break;case 4:c>>=2;break;case 8:c>>=3}for(var d=0;d<a.length;d++)b[c+d]=a[d]}};C.prototype=Object.create(m.prototype);
C.prototype.constructor=C;C.prototype.__class__=C;C.__cache__={};F.Status=C;C.prototype.code=C.prototype.code=function(){return ic(this.ptr)};C.prototype.ok=C.prototype.ok=function(){return!!uc(this.ptr)};C.prototype.error_msg=C.prototype.error_msg=function(){return a(tc(this.ptr))};C.prototype.__destroy__=C.prototype.__destroy__=function(){Bc(this.ptr)};D.prototype=Object.create(m.prototype);D.prototype.constructor=D;D.prototype.__class__=D;D.__cache__={};F.DracoUInt16Array=D;D.prototype.GetValue=
D.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return id(b,a)};D.prototype.size=D.prototype.size=function(){return hd(this.ptr)};D.prototype.GetArray=D.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!Uc(c,a,b)};D.prototype.__destroy__=D.prototype.__destroy__=function(){yd(this.ptr)};K.prototype=Object.create(m.prototype);K.prototype.constructor=K;K.prototype.__class__=K;K.__cache__={};F.PointCloud=
K;K.prototype.num_attributes=K.prototype.num_attributes=function(){return wc(this.ptr)};K.prototype.num_points=K.prototype.num_points=function(){return sc(this.ptr)};K.prototype.__destroy__=K.prototype.__destroy__=function(){mb(this.ptr)};I.prototype=Object.create(m.prototype);I.prototype.constructor=I;I.prototype.__class__=I;I.__cache__={};F.DracoUInt8Array=I;I.prototype.GetValue=I.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return gd(b,a)};I.prototype.size=I.prototype.size=
function(){return fd(this.ptr)};I.prototype.GetArray=I.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!zd(c,a,b)};I.prototype.__destroy__=I.prototype.__destroy__=function(){Ic(this.ptr)};Q.prototype=Object.create(m.prototype);Q.prototype.constructor=Q;Q.prototype.__class__=Q;Q.__cache__={};F.DracoUInt32Array=Q;Q.prototype.GetValue=Q.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return lc(b,
a)};Q.prototype.size=Q.prototype.size=function(){return Ac(this.ptr)};Q.prototype.GetArray=Q.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!Yb(c,a,b)};Q.prototype.__destroy__=Q.prototype.__destroy__=function(){Wb(this.ptr)};J.prototype=Object.create(m.prototype);J.prototype.constructor=J;J.prototype.__class__=J;J.__cache__={};F.AttributeOctahedronTransform=J;J.prototype.InitFromAttribute=J.prototype.InitFromAttribute=function(a){var b=
this.ptr;a&&"object"===typeof a&&(a=a.ptr);return!!Qa(b,a)};J.prototype.quantization_bits=J.prototype.quantization_bits=function(){return Fa(this.ptr)};J.prototype.__destroy__=J.prototype.__destroy__=function(){aa(this.ptr)};N.prototype=Object.create(m.prototype);N.prototype.constructor=N;N.prototype.__class__=N;N.__cache__={};F.PointAttribute=N;N.prototype.size=N.prototype.size=function(){return Vc(this.ptr)};N.prototype.GetAttributeTransformData=N.prototype.GetAttributeTransformData=function(){return z(od(this.ptr),
L)};N.prototype.attribute_type=N.prototype.attribute_type=function(){return Mc(this.ptr)};N.prototype.data_type=N.prototype.data_type=function(){return rd(this.ptr)};N.prototype.num_components=N.prototype.num_components=function(){return gc(this.ptr)};N.prototype.normalized=N.prototype.normalized=function(){return!!fc(this.ptr)};N.prototype.byte_stride=N.prototype.byte_stride=function(){return Hc(this.ptr)};N.prototype.byte_offset=N.prototype.byte_offset=function(){return qd(this.ptr)};N.prototype.unique_id=
N.prototype.unique_id=function(){return bd(this.ptr)};N.prototype.__destroy__=N.prototype.__destroy__=function(){pd(this.ptr)};L.prototype=Object.create(m.prototype);L.prototype.constructor=L;L.prototype.__class__=L;L.__cache__={};F.AttributeTransformData=L;L.prototype.transform_type=L.prototype.transform_type=function(){return ab(this.ptr)};L.prototype.__destroy__=L.prototype.__destroy__=function(){gb(this.ptr)};M.prototype=Object.create(m.prototype);M.prototype.constructor=M;M.prototype.__class__=
M;M.__cache__={};F.AttributeQuantizationTransform=M;M.prototype.InitFromAttribute=M.prototype.InitFromAttribute=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return!!Ka(b,a)};M.prototype.quantization_bits=M.prototype.quantization_bits=function(){return ja(this.ptr)};M.prototype.min_value=M.prototype.min_value=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return Aa(b,a)};M.prototype.range=M.prototype.range=function(){return rb(this.ptr)};M.prototype.__destroy__=M.prototype.__destroy__=
function(){ra(this.ptr)};R.prototype=Object.create(m.prototype);R.prototype.constructor=R;R.prototype.__class__=R;R.__cache__={};F.DracoInt8Array=R;R.prototype.GetValue=R.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return ec(b,a)};R.prototype.size=R.prototype.size=function(){return Fc(this.ptr)};R.prototype.GetArray=R.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!Ec(c,a,b)};R.prototype.__destroy__=
R.prototype.__destroy__=function(){Vb(this.ptr)};S.prototype=Object.create(m.prototype);S.prototype.constructor=S;S.prototype.__class__=S;S.__cache__={};F.MetadataQuerier=S;S.prototype.HasEntry=S.prototype.HasEntry=function(a,b){var c=this.ptr;Oa.prepare();a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:B(b);return!!ad(c,a,b)};S.prototype.GetIntEntry=S.prototype.GetIntEntry=function(a,b){var c=this.ptr;Oa.prepare();a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:
B(b);return $c(c,a,b)};S.prototype.GetIntEntryArray=S.prototype.GetIntEntryArray=function(a,b,c){var d=this.ptr;Oa.prepare();a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:B(b);c&&"object"===typeof c&&(c=c.ptr);kd(d,a,b,c)};S.prototype.GetDoubleEntry=S.prototype.GetDoubleEntry=function(a,b){var c=this.ptr;Oa.prepare();a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:B(b);return Va(c,a,b)};S.prototype.GetStringEntry=S.prototype.GetStringEntry=function(b,c){var d=this.ptr;
Oa.prepare();b&&"object"===typeof b&&(b=b.ptr);c=c&&"object"===typeof c?c.ptr:B(c);return a(pb(d,b,c))};S.prototype.NumEntries=S.prototype.NumEntries=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return ld(b,a)};S.prototype.GetEntryName=S.prototype.GetEntryName=function(b,c){var d=this.ptr;b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return a(Zb(d,b,c))};S.prototype.__destroy__=S.prototype.__destroy__=function(){cb(this.ptr)};T.prototype=Object.create(m.prototype);
T.prototype.constructor=T;T.prototype.__class__=T;T.__cache__={};F.DracoInt16Array=T;T.prototype.GetValue=T.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return bc(b,a)};T.prototype.size=T.prototype.size=function(){return cc(this.ptr)};T.prototype.GetArray=T.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!xc(c,a,b)};T.prototype.__destroy__=T.prototype.__destroy__=function(){Cb(this.ptr)};
U.prototype=Object.create(m.prototype);U.prototype.constructor=U;U.prototype.__class__=U;U.__cache__={};F.DracoFloat32Array=U;U.prototype.GetValue=U.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return kc(b,a)};U.prototype.size=U.prototype.size=function(){return Jc(this.ptr)};U.prototype.GetArray=U.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!wd(c,a,b)};U.prototype.__destroy__=U.prototype.__destroy__=
function(){Oc(this.ptr)};Y.prototype=Object.create(m.prototype);Y.prototype.constructor=Y;Y.prototype.__class__=Y;Y.__cache__={};F.GeometryAttribute=Y;Y.prototype.__destroy__=Y.prototype.__destroy__=function(){rc(this.ptr)};X.prototype=Object.create(m.prototype);X.prototype.constructor=X;X.prototype.__class__=X;X.__cache__={};F.DecoderBuffer=X;X.prototype.Init=X.prototype.Init=function(a,b){var c=this.ptr;Oa.prepare();if("object"==typeof a&&"object"===typeof a){var d=Oa.alloc(a,sa);Oa.copy(a,sa,d);
a=d}b&&"object"===typeof b&&(b=b.ptr);Za(c,a,b)};X.prototype.__destroy__=X.prototype.__destroy__=function(){$a(this.ptr)};P.prototype=Object.create(m.prototype);P.prototype.constructor=P;P.prototype.__class__=P;P.__cache__={};F.Decoder=P;P.prototype.GetEncodedGeometryType=P.prototype.GetEncodedGeometryType=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return Wa(b,a)};P.prototype.DecodeBufferToPointCloud=P.prototype.DecodeBufferToPointCloud=function(a,b){var c=this.ptr;a&&"object"===
typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return z(Ob(c,a,b),C)};P.prototype.DecodeBufferToMesh=P.prototype.DecodeBufferToMesh=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return z(xb(c,a,b),C)};P.prototype.GetAttributeId=P.prototype.GetAttributeId=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return Sb(c,a,b)};P.prototype.GetAttributeIdByName=P.prototype.GetAttributeIdByName=function(a,
b){var c=this.ptr;Oa.prepare();a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:B(b);return jb(c,a,b)};P.prototype.GetAttributeIdByMetadataEntry=P.prototype.GetAttributeIdByMetadataEntry=function(a,b,c){var d=this.ptr;Oa.prepare();a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:B(b);c=c&&"object"===typeof c?c.ptr:B(c);return lb(d,a,b,c)};P.prototype.GetAttribute=P.prototype.GetAttribute=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&
(b=b.ptr);return z(wb(c,a,b),N)};P.prototype.GetAttributeByUniqueId=P.prototype.GetAttributeByUniqueId=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return z(Fb(c,a,b),N)};P.prototype.GetMetadata=P.prototype.GetMetadata=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return z(ma(b,a),da)};P.prototype.GetAttributeMetadata=P.prototype.GetAttributeMetadata=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&
(b=b.ptr);return z(ub(c,a,b),da)};P.prototype.GetFaceFromMesh=P.prototype.GetFaceFromMesh=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Ub(d,a,b,c)};P.prototype.GetTriangleStripsFromMesh=P.prototype.GetTriangleStripsFromMesh=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return Lb(c,a,b)};P.prototype.GetTrianglesUInt16Array=P.prototype.GetTrianglesUInt16Array=
function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Mb(d,a,b,c)};P.prototype.GetTrianglesUInt32Array=P.prototype.GetTrianglesUInt32Array=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Tb(d,a,b,c)};P.prototype.GetAttributeFloat=P.prototype.GetAttributeFloat=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);
b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Rb(d,a,b,c)};P.prototype.GetAttributeFloatForAllPoints=P.prototype.GetAttributeFloatForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Ab(d,a,b,c)};P.prototype.GetAttributeFloatArrayForAllPoints=P.prototype.GetAttributeFloatArrayForAllPoints=function(a,b,c,d){var e=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===
typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);d&&"object"===typeof d&&(d=d.ptr);return!!mc(e,a,b,c,d)};P.prototype.GetAttributeIntForAllPoints=P.prototype.GetAttributeIntForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Ib(d,a,b,c)};P.prototype.GetAttributeInt8ForAllPoints=P.prototype.GetAttributeInt8ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===
typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!$b(d,a,b,c)};P.prototype.GetAttributeUInt8ForAllPoints=P.prototype.GetAttributeUInt8ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Ia(d,a,b,c)};P.prototype.GetAttributeUInt8ArrayForAllPoints=P.prototype.GetAttributeUInt8ArrayForAllPoints=function(a,b,c,d){var e=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=
b.ptr);c&&"object"===typeof c&&(c=c.ptr);d&&"object"===typeof d&&(d=d.ptr);return!!O(e,a,b,c,d)};P.prototype.GetAttributeInt16ForAllPoints=P.prototype.GetAttributeInt16ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Hb(d,a,b,c)};P.prototype.GetAttributeUInt16ForAllPoints=P.prototype.GetAttributeUInt16ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&
(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Jb(d,a,b,c)};P.prototype.GetAttributeUInt16ArrayForAllPoints=P.prototype.GetAttributeUInt16ArrayForAllPoints=function(a,b,c,d){var e=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);d&&"object"===typeof d&&(d=d.ptr);return!!Qb(e,a,b,c,d)};P.prototype.GetAttributeInt32ForAllPoints=P.prototype.GetAttributeInt32ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);
b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Bb(d,a,b,c)};P.prototype.GetAttributeUInt32ForAllPoints=P.prototype.GetAttributeUInt32ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!ac(d,a,b,c)};P.prototype.GetAttributeUInt32ArrayForAllPoints=P.prototype.GetAttributeUInt32ArrayForAllPoints=function(a,b,c,d){var e=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===
typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);d&&"object"===typeof d&&(d=d.ptr);return!!Kb(e,a,b,c,d)};P.prototype.SkipAttributeTransform=P.prototype.SkipAttributeTransform=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);ed(b,a)};P.prototype.__destroy__=P.prototype.__destroy__=function(){Wc(this.ptr)};V.prototype=Object.create(m.prototype);V.prototype.constructor=V;V.prototype.__class__=V;V.__cache__={};F.Mesh=V;V.prototype.num_faces=V.prototype.num_faces=function(){return Ma(this.ptr)};
V.prototype.num_attributes=V.prototype.num_attributes=function(){return bb(this.ptr)};V.prototype.num_points=V.prototype.num_points=function(){return La(this.ptr)};V.prototype.__destroy__=V.prototype.__destroy__=function(){Na(this.ptr)};Z.prototype=Object.create(m.prototype);Z.prototype.constructor=Z;Z.prototype.__class__=Z;Z.__cache__={};F.VoidPtr=Z;Z.prototype.__destroy__=Z.prototype.__destroy__=function(){Nc(this.ptr)};ca.prototype=Object.create(m.prototype);ca.prototype.constructor=ca;ca.prototype.__class__=
ca;ca.__cache__={};F.DracoInt32Array=ca;ca.prototype.GetValue=ca.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return yc(b,a)};ca.prototype.size=ca.prototype.size=function(){return zc(this.ptr)};ca.prototype.GetArray=ca.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!vc(c,a,b)};ca.prototype.__destroy__=ca.prototype.__destroy__=function(){Lc(this.ptr)};da.prototype=Object.create(m.prototype);
da.prototype.constructor=da;da.prototype.__class__=da;da.__cache__={};F.Metadata=da;da.prototype.__destroy__=da.prototype.__destroy__=function(){nd(this.ptr)};(function(){function a(){F.OK=sd();F.ERROR=Ad();F.IO_ERROR=cd();F.INVALID_PARAMETER=sb();F.UNSUPPORTED_VERSION=td();F.UNKNOWN_VERSION=Bd();F.INVALID_GEOMETRY_TYPE=Pc();F.POINT_CLOUD=Yc();F.TRIANGULAR_MESH=Qc();F.ATTRIBUTE_INVALID_TRANSFORM=Xa();F.ATTRIBUTE_NO_TRANSFORM=jc();F.ATTRIBUTE_QUANTIZATION_TRANSFORM=Xc();F.ATTRIBUTE_OCTAHEDRON_TRANSFORM=
nc();F.INVALID=kb();F.POSITION=ha();F.NORMAL=Pb();F.COLOR=E();F.TEX_COORD=Db();F.GENERIC=fb()}Ga?a():A.unshift(a)})();if("function"===typeof F.onModuleParsed)F.onModuleParsed();return l}}();"object"===typeof exports&&"object"===typeof module?module.exports=n:"function"===typeof define&&define.amd?define([],function(){return n}):"object"===typeof exports&&(exports.DracoDecoderModule=n)},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/maybe",
"../../webgl-engine/materials/internal/MaterialUtil"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});b.getMaterialAndTextures=function(b,e){var d=new Map,f=function(a,b){if(k.isNone(a))return-1;if(d.has(a.id))return a=d.get(a.id),a.usage|=b,a.id;var c=d.size;d.set(a.id,{id:c,usage:b});return c},c=e.pbrMetallicRoughness,g=c&&c.baseColorFactor,l=e.emissiveFactor,n=null==e.normalTexture&&null==e.emissiveTexture&&null==e.occlusionTexture&&(c?null==c.metallicRoughnessTexture&&1===
c.roughnessFactor&&(1===c.metallicFactor||0===c.metallicFactor):!0),t=n?h.defaultPBRMaterialParameters.metallicFactor:c?c.metallicFactor:1,x=n?h.defaultPBRMaterialParameters.roughnessFactor:c?c.roughnessFactor:1,c={baseColorFactor:g?[g[0],g[1],g[2],g[3]]:[1,1,1,1],baseColorTextureId:f(c&&c.baseColorTexture,1),metallicRoughnessTextureId:f(c&&c.metallicRoughnessTexture,2),metallicFactor:t,roughnessFactor:x};e={alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,cullFace:e.cullFace,
normalTextureId:f(e.normalTexture,4),emissiveTextureId:f(e.emissiveTexture,16),occlusionTextureId:f(e.occlusionTexture,8),emissiveFactor:l?[l[0],l[1],l[2]]:[0,0,0],metallicRoughness:c,wrapTextures:!1,isSchematic:n};var w=[];d.forEach(function(c,d){c=c.usage;var e=k.isSome(b)&&b[d]&&b[d].formats,e=e?e.map(function(b){return{name:b.name,encoding:a[b.format]}}):[];w.push({id:d,usage:c,encodings:e})});return{material:e,textures:w}};var a={jpg:"image/jpeg",png:"image/png",dds:"image/vnd-ms.dds","ktx-etc2":"image/ktx"};
b.getMaterialAndTexturesFromShared=function(a){var b=a&&a.materialDefinitions?Object.keys(a.materialDefinitions)[0]:null,d=a&&a.textureDefinitions?Object.keys(a.textureDefinitions)[0]:null,b=b&&a.materialDefinitions[b],d=d&&a.textureDefinitions[d];a={alphaMode:"opaque",alphaCutoff:.1,doubleSided:!0,cullFace:"none",normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,
metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,isSchematic:!0};if(null!=b){b=b.params;b.diffuse&&(a.metallicRoughness.baseColorFactor=[b.diffuse[0],b.diffuse[1],b.diffuse[2],1]);null!=b.doubleSided&&(a.doubleSided=b.doubleSided,a.cullFace=b.doubleSided?"none":"back");if("none"===b.cullFace||"front"===b.cullFace||"back"===b.cullFace)a.cullFace=b.cullFace;b.transparency&&(a.metallicRoughness.baseColorFactor[3]=l.clamp(1-b.transparency,0,1));if(b.useVertexColorAlpha||1>a.metallicRoughness.baseColorFactor[3])a.alphaMode=
"blend"}b=[];if(null!=d){!d.wrap||"repeat"!==d.wrap[0]&&"repeat"!==d.wrap[1]||(a.wrapTextures=!0);"rgba"===d.channels&&(a.alphaMode="blend");var f=d.images[d.images.length-1],c=function(a){return a&&a.split("/").pop()},d=Array.isArray(d.encoding)?d.encoding.map(function(a,b){return{name:c(f.href[b]),encoding:a}}):[{name:c(f.href),encoding:d.encoding}];b.push({id:0,usage:1,encodings:d});a.metallicRoughness.baseColorTextureId=0}return{material:a,textures:b}}})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["require",
"exports","../../../../core/tsSupport/assignHelper","../../../../core/promiseUtils"],function(n,b,l,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.requester=a;this.activeRequests=new Set}Object.defineProperty(b.prototype,"busy",{get:function(){return this.requester.busy},enumerable:!0,configurable:!0});b.prototype.request=function(a,b,e){var d=this,f=k.createAbortController();k.onAbortOrThrow(e,function(){return f.abort()});e=l({},e,{signal:f.signal});a=this.requester.request(a,
b,e);var c={response:a,abortController:f};this.activeRequests.add(c);k.always(a,function(){return d.activeRequests.delete(c)});return a};b.prototype.cancelAll=function(){this.activeRequests.forEach(function(a){return a.abortController.abort()});this.activeRequests.clear()};return b}();b.I3SStreamDataController=n;b.default=n})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../layers/graphics/dehydratedFeatures ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ../graphics/Graphics3DSymbolCommonCode ./I3SUtil ../../support/geometryUtils ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){return function(){function b(a,b,c,d,e,f,h){void 0===h&&(h={});this.indexSR=a;this._renderCoordsHelper=b;this.extent=d;this.elevationProvider=e;this.options=h;this.fp=q.frustum.create();this._poi=k.vec3f64.create();this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=k.vec3f64.create();this._tmp2=k.vec3f64.create();this._tmp3=k.vec3f64.create();this._tmp0=k.vec3f64.create();this.screenspaceErrorBias=h.screenspaceErrorBias||1;this.progressiveLoadFactor=
h.progressiveLoadFactor||1;this.updateCamera(c);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(f.elevationInfo);this.tmpPoint=g.makeDehydratedPoint(0,0,0,a)}b.prototype.updateElevationInfo=function(a){null==a?this._elevationContext=null:(this._elevationContext=new e,this._elevationContext.featureExpressionInfoContext=d.createContext(d.extractExpressionInfo(a,!1)),this._elevationContext.mixinApi(a))};b.prototype.updateCamera=function(a){q.frustum.fromMatrix(a.viewMatrix,
a.projectionMatrix,this.fp);this._screenSizeFactor=1/(a.perScreenPixelRatio/2);this._camPos=a.eye;this.minDistance=Infinity;this.maxDistance=0};b.prototype.setPointOfInterest=function(a){l.vec3.copy(this._poi,a)};b.prototype.updateScreenSpaceErrorBias=function(a){var b=this.screenspaceErrorBias;this.screenspaceErrorBias=a;return b};b.prototype.updateExtent=function(a){this.extent=a};b.prototype.getRenderMbs=function(b){var c=b.renderMbs;c||(c=a.vec4f64.fromValues(b.mbs[0],b.mbs[1],b.mbs[2],-1),b.renderMbs=
c);0>c[3]&&(h.vec4.copy(c,b.mbs),this._elevationContext&&1E5>c[3]&&(this.tmpPoint.x=c[0],this.tmpPoint.y=c[1],this.tmpPoint.z=c[2],c[2]=f.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),r.mbsToMbs(c,this.indexSR,c,this.engineSR));return c};b.prototype.getRenderObb=function(a){if(a.obb&&!(0>a.obb.halfSize[0])&&a.renderObb){var b=a.renderObb;if(0>b.halfSize[0]){var d=0;this._elevationContext&&1E5>a.mbs[3]&&(this.tmpPoint.x=a.obb.center[0],
this.tmpPoint.y=a.obb.center[1],this.tmpPoint.z=a.obb.center[2],d=f.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)-a.obb.center[2]);c.transformObb(a.obb,this.indexSR,b,this.engineSR,d)}return b}};b.prototype.isNodeVisible=function(a){var b=this.getRenderMbs(a);return this.isMBSinExtent(b)?a.obb?(a=this.getRenderObb(a),p.isVisible(a,this.fp)):this.isMBSVisible(b):!1};b.prototype.isGeometryVisible=function(a){return(a=this.getRenderObb(a))?
p.isVisible(a,this.fp):!0};b.prototype.isMBSinExtent=function(a){return this.extent?0!==c.intersectBoundingBoxWithMbs(this.extent,a):!0};b.prototype.isMBSVisible=function(a){return q.frustum.intersectsSphere(this.fp.planes,q.sphere.wrap(a[3],a))};b.prototype.screenSpaceDiameterMbs=function(a,b){var c=this.getRenderMbs(a);a=Math.sqrt(l.vec3.squaredDistance(c,this._camPos));c=a-c[3];this._updateMinMaxDistance(a);return 0>c?.5*Number.MAX_VALUE:b/c*this._screenSizeFactor};b.prototype.calcCameraDistance=
function(a){return this.calcCameraDistanceToCenter(a)-this.getRenderMbs(a)[3]};b.prototype.calcCameraDistanceToCenter=function(a){a=this.getRenderMbs(a);a=l.vec3.distance(a,this._camPos);this._updateMinMaxDistance(a);return a};b.prototype.calcAngleDependentLoD=function(a){a=this.getRenderMbs(a);var b=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*(a[1]-this._camPos[1])+a[2]*(a[2]-this._camPos[2]))/l.vec3.length(a)+b)/l.vec3.distance(a,this._camPos);return Math.min(1,a)};b.prototype.hasLOD=function(a){return 0!==
a.lodMetric};b.prototype.getDistancePlanarMode=function(a,b){var c=a[0]-b[0],d=a[1]-b[1];a=a[2]-b[2];c=c*c+d*d;b=b[3];if(c<=b*b)return Math.abs(a);b=Math.sqrt(c)-b;return Math.sqrt(a*a+b*b)};b.prototype.getDistanceGlobeMode=function(a,b){var c=l.vec3.length(b),d=l.vec3.length(a)-c;l.vec3.scale(this._tmp0,a,l.vec3.dot(a,b)/l.vec3.squaredLength(a));var e=l.vec3.squaredDistance(b,this._tmp0),f=b[3];if(e<=f*f)return Math.abs(d);b=l.vec3.scale(this._tmp0,b,1/c);c=l.vec3.scale(this._tmp1,b,c-f*f/2/c);e=
l.vec3.subtract(this._tmp2,a,c);e=l.vec3.subtract(this._tmp2,e,l.vec3.scale(this._tmp3,b,l.vec3.dot(b,e)));c=l.vec3.add(this._tmp2,c,l.vec3.scale(this._tmp2,e,f/l.vec3.length(e)));f=l.vec3.distance(a,c);2E5<=d&&(a=l.vec3.subtract(this._tmp1,a,c),a=l.vec3.dot(a,b)/l.vec3.length(a),.08>a&&(a=1E-4),f/=a);return f};b.prototype.getDistance=function(a,b){return this.engineSR===r.SphericalECEFSpatialReference?this.getDistanceGlobeMode(a,b):this.getDistancePlanarMode(a,b)};b.prototype._updateMinMaxDistance=
function(a){0<a?(this.minDistance=Math.min(this.minDistance,a),this.maxDistance=Math.max(this.maxDistance,a)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-a))};b.prototype.getLodLevel=function(a){if(0===a.lodMetric||!a.resources.hasFeatureData)return 0;if(0===a.childCount)return this.maxLodLevel;if(1>this.progressiveLoadFactor){var b=this.screenspaceErrorBias;return this.evaluateLODmetric(a,this.progressiveLoadFactor*this.screenspaceErrorBias)?this.evaluateLODmetric(a,b)?2:1:0}return this.evaluateLODmetric(a,
this.screenspaceErrorBias)?this.maxLodLevel:0};b.prototype.evaluateLODmetric=function(a,b){switch(a.lodMetric){case 2:var c=this.getRenderMbs(a),d=this.getDistance(this._camPos,c),e=2*d/this._screenSizeFactor;this._updateMinMaxDistance(d+c[3]);return a.maxError*b<=e;case 1:return b=this.screenSpaceDiameterMbs(a,a.mbs[3]*b),this.options.angleDependentLoD&&(b*=this.calcAngleDependentLoD(a)),b<a.maxError;case 3:return 10>this.screenSpaceDiameterMbs(a,a.maxError)*b;case 4:return this.calcCameraDistance(a)>
a.maxError*b}return!1};b.prototype.distToPOI=function(a){a=this.getRenderMbs(a);return l.vec3.distance(a,this._poi)-a[3]};b.prototype.distCameraToPOI=function(){return l.vec3.distance(this._camPos,this._poi)};return b}()})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/Error ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/SpatialReference ../../../geometry/support/meshUtils/deduplicate ../../../libs/draco/DracoDecoder ./i3s/I3SBinaryReader ./i3s/I3SGeometryUtil ./i3s/I3SProjectionUtil ./i3s/I3SUtil ../support/orientedBoundingBox ../support/projectionUtils ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C){function D(b,c,d,e){var f=M._malloc(4*b),g=c.GetAttribute(d,e);if(!c.GetAttributeFloatArrayForAllPoints(d,g,f,b))throw new a("draco:decode_error","Error while getting attribute values",{attributeId:e});b=(new Float32Array(M.HEAPU8.buffer,f,b)).slice();M._free(f);return b}function K(a,b){var c=a.data,d=a.strideIdx,e=c.length/d,f=0;a=a.offsetIdx;for(var g=0;g<e;g++)g>=b[f+1]&&f++,c[a]=f,a+=d}n=function(){function b(){}b.prototype.process=function(a){return k(this,
void 0,void 0,function(){var c,d;return l(this,function(e){switch(e.label){case 0:return[4,b.ensureDracoDecoder(a)];case 1:return e.sent(),c=[a.geometryBuffer],d=this.transform(a,c),[2,{result:d,transferList:c}]}})})};b.prototype.transform=function(b,c){var d,g,k;if(null==b.geometryIndex.header){var l=[],n=b.layouts[0],p=b.geometryBuffer,x=new M.DecoderBuffer;x.Init(new Int8Array(p),p.byteLength);var L=new M.Decoder,F=new M.Mesh,R=L.DecodeBufferToMesh(x,F);if(!R.ok())throw M.destroy(F),M.destroy(L),
M.destroy(x),new a("draco:decode_error","Error while decoding draco geometry",{message:R.error_msg()});var S=new M.DracoInt32Array,T=new M.MetadataQuerier,oa=L.GetAttributeIdByMetadataEntry(F,"i3s-attribute-type","feature-index"),va=L.GetAttributeMetadata(F,oa);T.GetIntEntryArray(va,"i3s-feature-ids",S);var fa=S.size(),xa=M._malloc(4*fa);if(!S.GetArray(xa,fa))throw"GetArray failed";var ia=(new Uint32Array(M.HEAPU8.buffer,xa,fa)).slice();M._free(xa);var na=F.num_points(),wa=3*F.num_faces(),Ca=65536>
na,xa=M._malloc(wa*(Ca?2:4));if(Ca?!L.GetTrianglesUInt16Array(F,xa,wa):!L.GetTrianglesUInt32Array(F,xa,wa))throw"GetTrianglesArray failed";var ua=Ca?(new Uint16Array(M.HEAPU8.buffer,xa,wa)).slice():(new Uint32Array(M.HEAPU8.buffer,xa,wa)).slice();M._free(xa);var ya=M._malloc(4*na),G=L.GetAttribute(F,oa);if(!L.GetAttributeUInt32ArrayForAllPoints(F,G,ya,na))throw new a("draco:decode_error","Error while getting attribute values",{attributeId:oa});var Ea=(new Uint32Array(M.HEAPU8.buffer,ya,na)).slice();
M._free(ya);for(var za=[],H=0;H<ua.length;++H){for(var qa=ua[H],sa=Ea[qa];za.length<=sa;)za.push([]);za[sa].push(qa)}for(var W=0,ga=new Uint32Array(za.length+1),H=0;H<za.length;++H){var Pa=za[H];ga[H]=W;for(var Ra=0,Ta=Pa;Ra<Ta.length;Ra++)qa=Ta[Ra],ua[W++]=qa}ga[za.length]=W;var A=new Float32Array(n[0].stride/Float32Array.BYTES_PER_ELEMENT*na),pa=new B(A,n,null,ga,ua),Ga=L.GetAttributeId(F,M.POSITION),hb=D(3*na,L,F,Ga),Ba=pa.getAttribute(C.VertexAttrConstants.POSITION),db=L.GetAttributeMetadata(F,
Ga),Ua=T.GetDoubleEntry(db,"i3s-scale_x"),Da=T.GetDoubleEntry(db,"i3s-scale_y"),Ua=0>=Ua?1:Ua,Da=0>=Da?1:Da,Ya=pa.getAttribute(C.VertexAttrConstants.COLOR),ta=L.GetAttributeId(F,M.COLOR),Qa=-1!==ta,aa;if(Qa){var Fa=4*na,Ha=M._malloc(Fa),Ka=L.GetAttribute(F,ta);if(!L.GetAttributeUInt8ArrayForAllPoints(F,Ka,Ha,Fa))throw new a("draco:decode_error","Error while getting attribute values",{attributeId:ta});var ra=(new Uint8Array(M.HEAPU8.buffer,Ha,Fa)).slice();M._free(Ha);aa=ra}else aa=h.fill(Array(4*na),
255);for(var Aa=aa,ja=0;ja<na;ja++){var rb=ja*Ba.strideIdx+Ba.offsetIdx;Ba.data[rb]=hb[3*ja]*Ua;Ba.data[rb+1]=hb[3*ja+1]*Da;Ba.data[rb+2]=hb[3*ja+2];var Nb=ja*Ya.strideIdx+Ya.offsetIdx;Ya.data[Nb]=Aa[4*ja];Ya.data[Nb+1]=Aa[4*ja+1];Ya.data[Nb+2]=Aa[4*ja+2];Ya.data[Nb+3]=Aa[4*ja+3]}var gb=L.GetAttributeId(F,M.NORMAL),ab=pa.getAttribute(C.VertexAttrConstants.NORMAL);if(-1!==gb&&ab)for(var vb=D(3*na,L,F,gb),ja=0;ja<na;ja++){var Za=ja*ab.strideIdx+ab.offsetIdx;ab.data[Za]=vb[3*ja];ab.data[Za+1]=vb[3*ja+
1];ab.data[Za+2]=vb[3*ja+2]}else b.needNormals&&ab&&u.computeCompressedNormals({normals:pa.getAttribute(C.VertexAttrConstants.NORMALCOMPRESSED),positions:pa.getAttribute(C.VertexAttrConstants.POSITION),normalInd:pa.getIndices(C.VertexAttrConstants.NORMALCOMPRESSED),positionInd:pa.getIndices(C.VertexAttrConstants.POSITION)});var $a=L.GetAttributeId(F,M.TEX_COORD),xb=pa.getAttribute(C.VertexAttrConstants.UV0);if(-1!==$a&&xb)for(var Ob=D(2*na,L,F,$a),ja=0;ja<na;ja++)Za=ja*xb.strideIdx+xb.offsetIdx,xb.data[Za]=
Ob[2*ja],xb.data[Za+1]=Ob[2*ja+1];var nb=L.GetAttributeIdByMetadataEntry(F,"i3s-attribute-type","uv-region"),Fb=pa.getAttribute(C.VertexAttrConstants.REGION);if(-1!==nb&&Fb){var mc=4*na,Ab=M._malloc(2*mc),Rb=L.GetAttribute(F,nb);if(!L.GetAttributeUInt16ArrayForAllPoints(F,Rb,Ab,mc))throw new a("draco:decode_error","Error while getting attribute values",{attributeId:nb});var lb=(new Uint16Array(M.HEAPU8.buffer,Ab,mc)).slice();M._free(Ab);for(ja=0;ja<na;ja++)Za=ja*Fb.strideIdx+Fb.offsetIdx,Fb.data[Za]=
lb[4*ja],Fb.data[Za+1]=lb[4*ja+1],Fb.data[Za+2]=lb[4*ja+2],Fb.data[Za+3]=lb[4*ja+3]}var jb=pa.getAttribute(C.VertexAttrConstants.COMPONENTINDEX);jb&&K(jb,ga);M.destroy(T);M.destroy(S);M.destroy(F);M.destroy(L);M.destroy(x);var Sb=b.mbs,Hb=b.elevationOffset,Bb=r.fromJSON(b.indexSR),$b=r.fromJSON(b.vertexSR),Ib=r.fromJSON(b.renderSR),ub=y.computeGlobalTransformation(Sb,Hb,Bb,Ib);e.mat4.invert(I,ub);var Qb=pa.getAttribute(C.VertexAttrConstants.POSITION),Jb={globalTrafo:ub},Kb=A.buffer;y.reprojectPoints(Qb,
Sb,I,Hb,Bb,$b,Ib);var ac=u.extractPositionData(Kb,n,ua);l.push({layout:n,interleavedVertexData:Kb,indices:ua,corMatrices:Jb,hasColors:Qa,positionData:ac});c&&(c.push(Kb),c.push(ua.buffer));k={geometryBuffer:p,componentOffsets:ga,featureIds:ia,transformedGeometries:l,obb:null}}else{var O=b.geometryData,Ia=b.geometryIndex,wb=b.layouts,Wa=b.mbs,Ub=b.elevationOffset,ma=r.fromJSON(b.indexSR),Lb=r.fromJSON(b.renderSR),Mb=y.computeGlobalTransformation(Wa,Ub,ma,Lb);e.mat4.invert(I,Mb);var Tb=b.geometryBuffer;
O.geometries[0].params.vertexAttributes=Ia.vertexAttributes;var ed,Wc,Cc=Ia.featureAttributes;if(Cc){if(Cc.faceRange){var wd=w.createTypedView(Tb,Cc.faceRange);ed=m.convertFlatRangesToOffsets(wd,Cc.faceRange.count,Cc.faceRange.valuesPerElement)}var kc=Cc.id;if(kc){Wc=new Uint32Array(kc.count);var Oc=1,Jc=w.valueType2TypedArrayClassMap[kc.valueType];"UInt64"===kc.valueType&&(Jc=Uint32Array,Oc=2);for(var Kc=new Jc(Tb,kc.byteOffset,kc.count*kc.valuesPerElement*Oc),xc=0;xc<kc.count;xc++){var bc=xc*kc.valuesPerElement*
Oc;Wc[xc]=Kc[bc];if(2===Oc&&0!==Kc[bc+1])throw Error("ID exceeded maximum range supported (2^32))");}}}d=ed;g=Wc;c&&(g&&c.push(g.buffer),d&&c.push(d.buffer));var Cb=b.obb?null:v.create([0,0,0],[-1,-1,-1],[0,0,0,1]);q.vec3.copy(Q,Wa);Q[2]+=Ub;q.vec3.copy(J,Q);for(var cc=!1,Xb=0,vc=[],yc=0,Lc=O.geometries;yc<Lc.length;yc++){var zc=Lc[yc],dc=wb[Xb];++Xb;var Ec=b.geometryBuffer,ec=u.interleaveGeometryBuffer(zc,Ec,dc,[{name:C.VertexAttrConstants.COLOR,byteValue:255}],[C.VertexAttrConstants.NORMAL,C.VertexAttrConstants.NORMALCOMPRESSED,
C.VertexAttrConstants.SYMBOLCOLOR,C.VertexAttrConstants.COMPONENTINDEX]),Vb=new B(new Float32Array(ec),dc),Fc=Vb.getAttribute(C.VertexAttrConstants.POSITION),Tc=b.mbs,Uc=b.elevationOffset,id=r.fromJSON(b.indexSR),yd=r.fromJSON(b.vertexSR),hd=r.fromJSON(b.renderSR);y.reprojectPoints(Fc,Tc,I,Uc,id,yd,hd);if(Cb){var Eb=Cb,Yb=Fc,lc=Mb;if(0<Eb.halfSize[0]){q.vec3.subtract(Q,Eb.center,Eb.halfSize);q.vec3.add(J,Eb.center,Eb.halfSize);for(var Wb=Yb.offsetIdx;Wb<Yb.data.length;Wb+=Yb.strideIdx)Q[0]=Math.min(Q[0],
Yb.data[Wb]),Q[1]=Math.min(Q[1],Yb.data[Wb+1]),Q[2]=Math.min(Q[2],Yb.data[Wb+2]),J[0]=Math.max(J[0],Yb.data[Wb]),J[1]=Math.max(J[1],Yb.data[Wb+1]),J[2]=Math.max(J[2],Yb.data[Wb+2]);q.vec3.subtract(Eb.halfSize,J,Q);q.vec3.scale(Eb.halfSize,Eb.halfSize,.5);q.vec3.add(Eb.center,Q,J);q.vec3.scale(Eb.center,Eb.center,.5)}else{v.compute(Yb,Eb);var Ac=2*Math.sqrt(1+lc[0]+lc[5]+lc[10]);N[0]=(lc[9]-lc[6])/Ac;N[1]=(lc[2]-lc[8])/Ac;N[2]=(lc[4]-lc[1])/Ac;N[3]=.25*Ac;f.quat.conjugate(N,N);f.quat.multiply(Eb.quaternion,
N,Eb.quaternion)}}var jd=Vb.getAttribute(C.VertexAttrConstants.NORMALCOMPRESSED);if(b.needNormals&&jd){var zd={normals:jd,positions:Fc,normalInd:Vb.getIndices(C.VertexAttrConstants.NORMALCOMPRESSED),positionInd:Vb.getIndices(C.VertexAttrConstants.POSITION)};u.processAndInterleaveNormals(b.normalReferenceFrame,zc,Ec,Mb,zd)}var gd=Vb.getAttribute(C.VertexAttrConstants.COMPONENTINDEX);gd&&K(gd,d);var Ic=Vb.getAttribute(C.VertexAttrConstants.COLOR);if(Ic&&!cc)a:{for(var fd=Ic.data,xd=Ic.size,rc=Ic.strideIdx,
ba=Ic.offsetIdx;ba<fd.length;ba+=rc)for(var Na=0;Na<xd;Na++)if(255!==fd[ba+Na]){cc=!0;break a}cc=!1}var bb={globalTrafo:Mb},Ma=dc[0].stride,La=t.default(ec,Ma/4,null,1-.8*Ma/(Ma+4));if(null!=La){var Va=65536>La.uniqueCount?new Uint16Array(La.indices):La.indices,Zb=u.extractPositionData(La.buffer,dc,Va);vc.push({layout:dc,interleavedVertexData:La.buffer,indices:Va,corMatrices:bb,hasColors:cc,positionData:Zb});c&&(c.push(La.buffer),c.push(Va.buffer),c.push(Zb.data.buffer),c.push(Zb.indices.buffer))}else Zb=
u.extractPositionData(ec,dc),vc.push({layout:dc,interleavedVertexData:ec,corMatrices:bb,hasColors:cc,positionData:Zb}),c&&(c.push(ec),c.push(Zb.data.buffer),c.push(Zb.indices.buffer));Cb&&(q.vec3.transformMat4(Cb.center,Cb.center,Mb),z.vectorToVector(Cb.center,hd,Cb.center,id),Cb.center[2]-=b.elevationOffset)}k={geometryBuffer:Tb,componentOffsets:d,featureIds:g,transformedGeometries:vc,obb:Cb}}return k};return b}();(function(a){a.ensureDracoDecoder=function(a){if(M&&M.DecoderBuffer||a&&null!=a.geometryIndex.header)return g.resolve();
L||(L=x.getDecoderModule().then(function(a){M=a;L=null;return M}));return L.then(function(){})}})(n||(n={}));var I=d.mat4f64.create(),Q=p.vec3f64.create(),J=p.vec3f64.create(),N=c.quatf32.create(),L,M;return n})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/meshUtils/deduplicate ./I3SBinaryReader ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){function r(a,b,c,d,e,f,g){switch(c){case 1:for(c=0;c<g;c++)d[e]=a[b],b+=1,e+=f;break;case 2:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],b+=2,e+=f;break;case 3:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],b+=3,e+=f;break;case 4:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],d[e+3]=a[b+3],b+=4,e+=f;break;default:throw y("Unhandled stride size "+c);}}function t(a,b,c,d,e,f){switch(b){case 1:for(b=0;b<f;b++)c[d]=a,d+=e;break;case 2:for(b=0;b<f;b++)c[d]=
a,c[d+1]=a,d+=e;break;case 3:for(b=0;b<f;b++)c[d]=a,c[d+1]=a,c[d+2]=a,d+=e;break;case 4:for(b=0;b<f;b++)c[d]=a,c[d+1]=a,c[d+2]=a,c[d+3]=a,d+=e;break;default:throw y("Unhandled stride size "+b);}}function x(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}function w(a){switch(a){case 5120:return"Int8";
case 5126:return"Float32";case 5124:return"Int32";case 5122:return"Int16";case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw Error("Unhandled data type: "+a);}function u(a){return 0<a&&0===a%Uint32Array.BYTES_PER_ELEMENT}function y(a){return Error("I3SGeometryUtil processing failed: "+a)}function m(b){var c=b.normals,d=b.positions,f=b.normalInd,h=b.positionInd;p.assert(b.normalInd.length===b.positionInd.length);b=e.vec3f32.create();for(var k=e.vec3f32.create(),l=a.vec2f32.create(),
m=d.data,n=d.offsetIdx,d=d.strideIdx,q=c.data,r=c.offsetIdx,c=c.strideIdx,t=0;t<h.length;t+=3){var u=h[t],u=n+d*u,v=m[u],w=m[u+1],x=m[u+2],u=h[t+1],u=n+d*u;b[0]=m[u]-v;b[1]=m[u+1]-w;b[2]=m[u+2]-x;u=h[t+2];u=n+d*u;k[0]=m[u]-v;k[1]=m[u+1]-w;k[2]=m[u+2]-x;g.vec3.cross(b,b,k);p.encodeNormal(b,l);for(v=0;3>v;v++)w=r+c*f[t+v],q[w]=p.encodeInt16(l[0]),q[w+1]=p.encodeInt16(l[1])}}function v(a,b){switch(b){case 0:switch(a.type){case "intersects":case "contains":case "crosses":case "envelope-intersects":case "overlaps":case "touches":case "within":return 1;
case "disjoint":return 0}break;case 2:switch(a.type){case "intersects":case "contains":case "envelope-intersects":case "within":return 0;case "disjoint":case "crosses":case "overlaps":case "touches":return 1}break;case 1:switch(a.type){case "envelope-intersects":return 0}}return 2}function z(a,b){return C.contains(a.mask,b)?2:C.intersects(a.mask,b)?1:0}Object.defineProperty(b,"__esModule",{value:!0});var B=new Uint8Array(64);b.interleaveGeometryBuffer=function(a,b,c,d,e){void 0===d&&(d=[]);void 0===
e&&(e=[]);var f=a.params.vertexAttributes,g=f.position.count;if(!u(c[0].stride))throw y("Layout stride must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var h=new Uint32Array(c[0].stride/Uint32Array.BYTES_PER_ELEMENT*g);c=c.slice(0).sort(function(a,b){return a.offset-b.offset});a=function(a){if(-1!==e.indexOf(a.name))return"continue";var c=f[a.name],k=x(a.type),l=void 0,m=!1;if(null==c)if(m=d.filter(function(b){return b.name===a.name})[0]){c={valueType:w(a.type),byteOffset:0,count:g,valuesPerElement:a.count};
for(l=0;l<B.length;l++)B[l]=m.byteValue;l=B.buffer;m=!0}else throw y("Geometry definition is missing attribute");else l=b;if(w(a.type)!==c.valueType)throw y("Geometry definition type must match attribute type");if(0!==c.byteOffset%Uint32Array.BYTES_PER_ELEMENT||0!==a.offset%Uint32Array.BYTES_PER_ELEMENT)throw y(a.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!u(c.valuesPerElement*k.BYTES_PER_ELEMENT)||!u(a.count*k.BYTES_PER_ELEMENT))throw y(a.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+
"-byte words");var l=new Uint32Array(l),n=c.byteOffset/Uint32Array.BYTES_PER_ELEMENT,c=c.valuesPerElement*k.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,k=a.offset/Uint32Array.BYTES_PER_ELEMENT,p=a.stride/Uint32Array.BYTES_PER_ELEMENT;m?t(l[0],c,h,k,p,g):r(l,n,c,h,k,p,g)};for(var k=0;k<c.length;k++)a(c[k]);return h.buffer};b.processAndInterleaveNormals=function(a,b,d,e,f){if("none"===a)m(f);else{b=c.createTypedView(d,b.params.vertexAttributes.normal);d=f.normals;var g="earth-centered"===a?e:null;
a=b.length/3;e=d.data;f=d.offsetIdx;d=d.strideIdx;if(null!=g)for(var h=g[0],k=g[1],l=g[2],n=g[4],q=g[5],r=g[6],t=g[8],u=g[9],g=g[10],v=0;v<a;v++){var w=b[3*v],x=b[3*v+1],y=b[3*v+2];I[0]=h*w+k*x+l*y;I[1]=n*w+q*x+r*y;I[2]=t*w+u*x+g*y;p.encodeNormal(I,Q);e[f+v*d]=p.encodeInt16(Q[0]);e[f+v*d+1]=p.encodeInt16(Q[1])}else for(v=0;v<a;v++)I[0]=b[3*v],I[1]=b[3*v+1],I[2]=b[3*v+2],p.encodeNormal(I,Q),e[f+v*d]=p.encodeInt16(Q[0]),e[f+v*d+1]=p.encodeInt16(Q[1])}};b.computeCompressedNormals=m;b.extractPositionData=
function(a,b,c){var d=b[0];if(null==d||"position"!==d.name||5126!==d.type)return null;a=new Float32Array(a);b=d.stride/4;for(var d=d.offset/4,e=3*a.length/b,g=new Float32Array(e),h=0;h<e/3;h++)g[3*h]=a[h*b+d],g[3*h+1]=a[h*b+d+1],g[3*h+2]=a[h*b+d+2];c=f.default(g.buffer,3,c);return 65536>c.uniqueCount?{data:new Float32Array(c.buffer),indices:new Uint16Array(c.indices)}:{data:new Float32Array(c.buffer),indices:c.indices}};var C;b.isGeometryEngineLoaded=function(){return!!C};b.loadGeometryEngine=function(){return k(this,
void 0,void 0,function(){return l(this,function(a){switch(a.label){case 0:return C?[2,C]:[4,h.create(function(a,b){return n(["../../../../geometry/geometryEngine"],a)})];case 1:return C=a.sent(),[2,C]}})})};b.acquireMaskFilterContext=function(a,b,c,d){var e=c.spatialReference||b.spatialReference;b=b.renderSpatialReference;var f={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:e};f.rings[0][4]=f.rings[0][0];var g=d.objectTransformation;d=d.geometryRecords[0].geometry;
var h={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:e};h.rings[0][3]=h.rings[0][0];var k=C[a];k||(console.error("Spatial relationship",a,"not supported"),k=function(){return!0});return{type:a,mask:c,maskSR:e,renderSR:b,aabb:f,transform:g,geometry:d,triangle:h,testFunction:k}};b.getIntersectRelation=v;b.intersectMaskWithMbs=function(a,b){b=C.buffer({x:b[0],y:b[1],hasZ:!1,hasM:!1,type:"point",spatialReference:a.maskSR},b[3],1,!0);return z(a,b)};var D=Math.pow(2,
-32);b.filterMask=function(a,b){var c=b.type,d=b.mask,e=b.transform,f=b.renderSR,h=b.maskSR,k=b.geometry,l=b.triangle,m=b.testFunction,n=b.aabb;k.getComponentAABB(a,K);var r=[n.rings[0][0],n.rings[0][1],n.rings[0][2],n.rings[0][3]];g.vec3.set(r[0],K[0],K[1],0);g.vec3.set(r[1],K[0],K[4],0);g.vec3.set(r[2],K[3],K[4],0);g.vec3.set(r[3],K[3],K[1],0);for(var t=0;4>t;++t)g.vec3.transformMat4(r[t],r[t],e),q.vectorToVector(r[t],f,r[t],h);delete n._geVersion;t=z(b,n);switch(v(b,t)){case 1:return!1;case 0:return!0}b=
l.rings[0][0];var n=l.rings[0][1],r=l.rings[0][2],u=k.data.getIndices(p.VertexAttrConstants.POSITION),t=k.data.componentOffsets,w=k.data.getAttribute(p.VertexAttrConstants.POSITION),k=w.data,x=w.offsetIdx,w=w.strideIdx,y=t.length?t[a]:0;a=t.length?t[a+1]:u.length;var B;switch(c){case "intersects":case "crosses":case "envelope-intersects":case "index-intersects":case "overlaps":case "touches":B=function(){return m(d,l)?0:2};break;default:B=function(){return m(d,l)?2:1}}for(t=y;t<a;t+=3){var y=x+w*
u[t+0],C=x+w*u[t+1],I=x+w*u[t+2];g.vec3.set(b,k[y+0],k[y+1],k[y+2]);g.vec3.set(n,k[C+0],k[C+1],k[C+2]);g.vec3.set(r,k[I+0],k[I+1],k[I+2]);g.vec3.transformMat4(b,b,e);g.vec3.transformMat4(n,n,e);g.vec3.transformMat4(r,r,e);q.vectorToVector(b,f,b,h);q.vectorToVector(n,f,n,h);q.vectorToVector(r,f,r,h);if(!(Math.abs((n[0]-b[0])*(r[1]-b[1])-(n[1]-b[1])*(r[0]-b[0]))<D))switch(delete l._geVersion,B()){case 1:return!1;case 0:return!0}}switch(c){case "intersects":case "crosses":case "envelope-intersects":case "index-intersects":case "overlaps":case "touches":return!1;
default:return!0}};var K=d.create(),I=e.vec3f32.create(),Q=a.vec2f32.create()})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/projectionUtils ../../webgl-engine/lib/localOrigin".split(" "),function(n,b,l,k,h,a,g,e){function d(b,c,d){var e=h.vec3f64.create(),f=Math.ceil(Math.log(b[3])*Math.LOG2E/p),g=Math.pow(2,
f*p+q),k;if(d.isGeographic){k=g/a.earthRadius*180/Math.PI;d=Math.round(b[1]/k);var l=Math.max(-90,Math.min(90,d*k)),n=k/Math.cos((Math.abs(l)-k/2)/180*Math.PI);k=Math.round(b[0]/n);e[0]=k*n;e[1]=l}else k=Math.round(b[0]/g),d=Math.round(b[1]/g),e[0]=k*g,e[1]=d*g;b=Math.round((b[2]+c)/g);e[2]=b*g;return{center:e,id:f+"_"+k+"_"+d+"_"+b}}Object.defineProperty(b,"__esModule",{value:!0});var f=new Float64Array(3E3),c=h.vec3f64.create();b.computeGlobalTransformation=function(a,b,c,e){a=d(a,b,c).center;b=
l.mat4f64.create();g.computeLinearTransformation(c,a,b,e);return b};b.reprojectPoints=function(a,b,d,e,h,l,m){var n=a.data,p=a.offsetIdx;a=a.strideIdx;k.vec3.copy(c,b);c[2]+=e;b=[0,0,0];e=n.length/a;g.vectorToVector(c,h,b,l);for(h=0;h<e;h+=1E3){for(var q=Math.min(1E3,e-h),r=0;r<q;r++){var t=p+a*(h+r);f[3*r+0]=n[t+0]+b[0];f[3*r+1]=n[t+1]+b[1];f[3*r+2]=n[t+2]+b[2]}g.bufferToBuffer(f,l,0,f,m,0,q);for(r=0;r<q;r++){var t=f[3*r+0],u=f[3*r+1],w=f[3*r+2],x=p+a*(h+r);n[x+0]=d[0]*t+d[4]*u+d[8]*w+d[12];n[x+
1]=d[1]*t+d[5]*u+d[9]*w+d[13];n[x+2]=d[2]*t+d[6]*u+d[10]*w+d[14]}}};b.createOrigin=function(a,b,c,f){b=d(a,b,c);a=b.center;b=b.id;g.vectorToVector(a,c,a,f);return e.fromVector(a,b)};var q=1,p=5-q})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(n,b,l){var k=function(){return function(b){this.highlightSet=new l;this.ids=new Set;this.paused=!1;this.options=b}}();return function(){function b(a){this.highlights=[];this.layerView=
a}b.prototype.destroy=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()});this.highlights=null};b.prototype.acquireSet=function(a){var b=this,e=new k(a);this.highlights.push(e);return{set:e,handle:{remove:function(){return b.releaseSet(e)},pause:function(){e.highlightSet.removeAll();e.paused=!0},resume:function(){e.paused=!1;b.initializeSet(e)}}}};b.prototype.releaseSet=function(a){a.highlightSet.removeAll();a=this.highlights?this.highlights.indexOf(a):-1;-1!==a&&this.highlights.splice(a,
1)};b.prototype.setFeatureIds=function(a,b){b.forEach(function(b){return a.ids.add(b)});this.initializeSet(a)};b.prototype.initializeSet=function(a){this.layerView._forAllFeatures(function(b,e,d,f){a.ids.has(b)&&(b=d.engineObject.setComponentHighlight(f,e,a.options),a.highlightSet.addObject(d.engineObject,b));return 1},null,1)};b.prototype.objectCreated=function(a){var b=this;this.highlights.forEach(function(e){e.paused||b.layerView._forAllFeaturesOfNode(b.layerView._getMetadata(a),function(b,f,c,
g){e.ids.has(b)&&(b=a.setComponentHighlight(g,f,e.options),e.highlightSet.addObject(a,b));return 1},1)})};b.prototype.objectDeleted=function(a){this.highlights.forEach(function(b){b.highlightSet.removeObject(a)})};b.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()})};return b}()})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../webgl-engine/lib/Intersector".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p){var r=c.empty(),t={spatialReference:null,extent:r,context:"scene"},x=f.vec3f64.create(),w=f.vec3f64.create(),u=f.vec3f64.create(),y=g.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(a){function b(b){return a.call(this)||this}l(b,a);b.prototype.initialize=function(){var a=this.layerView.view;this.view=a;this.renderCoordsHelper=a.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=new p(a.viewingMode);a=this.layerView.layer.fullExtent;
this.zmin=a.zmin;this.zmax=a.zmax};b.prototype.getElevation=function(a){if(q.isPoint(a)){if(!this.renderCoordsHelper.toRenderCoords(a,x))return y.error("could not project point for elevation alignment"),null}else if(!this.renderCoordsHelper.toRenderCoords(a,this.spatialReference,x))return y.error("could not project point for elevation alignment"),null;var b=this.layerView.elevationOffset;a=this.zmin+b;b=this.zmax+b;d.vec3.copy(w,x);d.vec3.copy(u,x);this.renderCoordsHelper.setAltitude(b,w);this.renderCoordsHelper.setAltitude(a,
u);this.intersector.intersect(this.intersectLayers,w,u,null,null,1,!1);return this.intersector.results.min.getIntersectionPoint(x)?this.renderCoordsHelper.getAltitude(x):null};b.prototype.layerChanged=function(){this.spatialReference&&(t.extent=this.computeLayerExtent(this.intersectLayers[0]),t.spatialReference=this.spatialReference,this.emit("elevation-change",t))};b.prototype.objectChanged=function(a){this.spatialReference&&(t.extent=this.computeObjectExtent(a),t.spatialReference=this.spatialReference,
this.emit("elevation-change",t))};b.prototype.computeObjectExtent=function(a){c.empty(r);this.expandExtent(a,r);return r};b.prototype.computeLayerExtent=function(a){c.empty(r);var b=0;for(a=a.getObjects();b<a.length;b++)this.expandExtent(a[b],r);return r};b.prototype.expandExtent=function(a,b){for(var e=a.getBBMin(!0),f=a.getBBMax(!0),g=0;8>g;++g)x[0]=g&1?e[0]:f[0],x[1]=g&2?e[1]:f[1],x[2]=g&4?e[2]:f[2],d.vec3.transformMat4(x,x,a.objectTransformation),this.renderCoordsHelper.fromRenderCoords(x,x,this.spatialReference),
c.expand(b,x);return b};k([e.property({constructOnly:!0})],b.prototype,"layerView",void 0);k([e.property({constructOnly:!0})],b.prototype,"stageLayer",void 0);k([e.property()],b.prototype,"view",void 0);k([e.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],b.prototype,"spatialReference",void 0);return b=k([e.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],b)}(e.declared(a.EventedMixin(h)))})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["require","exports",
"../../../../core/Error","../../../../core/promiseUtils"],function(n,b,l,k){function h(a){return k.create(function(b,d){a.oncomplete=function(){return b()};a.onerror=function(){return d(a.error)};a.onabort=function(){return d(a.error)}})}function a(a){return k.create(function(b,d){"done"===a.readyState?null!=a.error?d(a.error):b(a.result):(a.onsuccess=function(){return b(a.result)},a.onerror=function(){return d(a.error)})})}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,
b,f){void 0===f&&(f=14);this._version=f;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=a;this._storeName=b}b.prototype.init=function(){var b=this;return k.resolve().then(function(){var d=indexedDB.open(b._dbName,b._version);d.onupgradeneeded=function(a){var c=d.result,e=d.transaction,f=c.objectStoreNames.contains(b._storeName)?e.objectStore(b._storeName):c.createObjectStore(b._storeName),
c=c.objectStoreNames.contains("last_access")?e.objectStore("last_access"):c.createObjectStore("last_access");c.indexNames.contains("date")||c.createIndex("date","date",{unique:!1});c.indexNames.contains("byteSize")||c.createIndex("byteSize","byteSize",{unique:!1});a.oldVersion<b._version&&(f.clear(),c.clear())};return a(d)}).then(function(a){b._destroyed?a.close():b._db=a})};b.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};Object.defineProperty(b.prototype,
"initialized",{get:function(){return null!=this._db},enumerable:!0,configurable:!0});b.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)};b.prototype.put=function(a,b){var d=this;return null==this._db?k.reject(new l("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:k.resolve()).then(function(){return d._put(a,b)}).catch(function(c){if(c&&"QuotaExceededError"===c.name)return null==d._quotaReductionPromise&&
(d._quotaReductionPromise=d._getCacheSize().then(function(a){return d._removeLeastRecentlyAccessed(b.byteSize+Math.ceil(a*d.quotaReductionFactor))}),d._quotaReductionPromise.then(function(){return d._quotaReductionPromise=null},function(){return d._quotaReductionPromise=null})),d._quotaReductionPromise.then(function(){return d._put(a,b)});throw c;}).then(function(){d._gcCounter--;0>d._gcCounter&&null!=d._db&&(d._gcCounter=d.gcFrequency,d._getCacheSize().then(function(a){return d._removeLeastRecentlyAccessed(a-
d.maxByteSize)}))})};b.prototype.get=function(b,d){var e=this;if(null==this._db)return k.resolve(null);var c=null;return k.resolve().then(function(){var f=e._db.transaction(e._storeName,"readonly");c=k.onAbort(d,function(){f.abort()});var g=f.objectStore(e._storeName).get(b);return a(g)}).then(function(a){null==a?++e._miss:e._db&&(++e._hit,e._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:a.byteSize},b));c&&c.remove();return a}).catch(function(a){++e._miss;
k.throwIfAborted(d);c&&c.remove();return null})};b.prototype.remove=function(b){var d=this;return null==this._db?k.resolve():k.resolve().then(function(){var e=d._db.transaction([d._storeName,"last_access"],"readwrite"),c=e.objectStore(d._storeName),g=e.objectStore("last_access"),c=c.delete(b),g=g.delete(b);return k.all([a(c),a(g),h(e)])})};b.prototype._put=function(b,d){var e=this._db.transaction([this._storeName,"last_access"],"readwrite"),c=e.objectStore(this._storeName),g=e.objectStore("last_access"),
c=c.put(d,b);b=g.put({date:Date.now(),byteSize:d.byteSize},b);return k.all([a(c),a(b),h(e)])};b.prototype._removeLeastRecentlyAccessed=function(a){if(!(0>=a)){var b=this._db.transaction([this._storeName,"last_access"],"readwrite"),e=b.objectStore(this._storeName),c=b.objectStore("last_access"),g=0,k=c.index("date").openCursor(null,"next");k.onsuccess=function(b){b=k.result;null!=b&&(null!=b.value.byteSize&&(g+=b.value.byteSize),e.delete(b.primaryKey),c.delete(b.primaryKey),g<a&&b.continue())};return h(b)}};
b.prototype._getCacheSize=function(){var a=this._db.transaction("last_access"),b=0,f=a.objectStore("last_access").index("byteSize").openKeyCursor();f.onsuccess=function(a){if(a=f.result){var c=a.key;null!=c&&(b+=c);a.continue()}};return h(a).then(function(){return b})};return b}();b.IDBCache=n;b.whenTransaction=h;b.whenRequest=a})},"esri/views/3d/webgl-engine/materials/component/index":function(){define(["require","exports","./ComponentMaterial","./VertexBufferLayout"],function(n,b,l,k){Object.defineProperty(b,
"__esModule",{value:!0});(function(b){b.create=function(a,b,e){return new l.ComponentMaterial(a,b,e)};b.vertexBufferLayout=k.createVertexBufferLayout})(b.ComponentMaterial||(b.ComponentMaterial={}))})},"esri/views/3d/webgl-engine/materials/component/ComponentMaterial":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/maybe ../../lib/Material ./ComponentGLMaterial ./Parameters ./VertexBufferLayout ../internal/MaterialUtil ../renderers/PreinterleavedRenderer".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b,c,d){d=a.call(this,d)||this;d.supportsEdges=!0;d._parameters=e.fillDefaults(b);d._geometryParameters=c;return d}l(b,a);Object.defineProperty(b.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometryParameters",{get:function(){return this._geometryParameters},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"hasTransparency",{get:function(){var a=this._parameters.forceTransparency;if(h.isSome(a))return a;if(1>this._parameters.baseColorOpacity||1>this._parameters.layerOpacity)return!0;a=this._parameters.componentData;return e.isUniformComponentData(a)&&"replace"===a.externalColorMixMode?1>a.externalColor[3]:!0},enumerable:!0,configurable:!0});b.prototype.isVisibleInPass=function(a){if(3!==a)return!0;a=this._parameters.componentData;return e.isUniformComponentData(a)?a.castShadows:!0};b.prototype.isVisible=
function(){var b=this.parameters;if(!a.prototype.isVisible.call(this)||0===b.layerOpacity)return!1;var c=b.componentData;return e.isUniformComponentData(c)?"replace"===c.externalColorMixMode?0<c.externalColor[3]:0<b.baseColorOpacity:!0};b.prototype.updateParameters=function(a){var b=!1,c;for(c in a){var d=a[c];this._parameters[c]!==d&&(b=!0,this._parameters[c]=d)}b&&this.notifyDirty("matChanged")};b.prototype.intersect=function(a,b,c,d,e,g,h){f.intersectTriangleGeometry(a,b,d,e,g,h)};b.prototype.getGLMaterials=
function(){return{color:g.GLMaterialColor,depthShadowMap:g.GLMaterialDepthShadowMap,normal:g.GLMaterialNormal,depth:g.GLMaterialDepth,highlight:g.GLMaterialHighlight}};b.prototype.createRenderer=function(a,b){return new c(a,b,this)};b.prototype.createBufferWriter=function(){throw Error("Not supported");};b.prototype.createBufferLayout=function(){return d.createVertexBufferLayout(this.geometryParameters)};return b}(a.Material);b.ComponentMaterial=n})},"esri/views/3d/webgl-engine/materials/component/ComponentGLMaterial":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/decorateHelper ../../lib/AutoDisposable ../../lib/DefaultTextureUnits ../../lib/GLMaterial ./Parameters ../internal/MaterialUtil ../internal/MaterialUtil ../internal/TextureBinding ../../shaders/DefaultPrograms ../../../../webgl/renderState".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r){function t(a){if(a.hasTransparency)return r.separateBlendingParams(770,1,771,771)}function x(a){if("none"!==a.parameters.cullFace)return{face:"front"===a.parameters.cullFace?1028:1029,mode:2305}}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(a){var c=b.call(this,a)||this;c.discardTransparentVertices=!1;c.material=a.material;c.passName=a.passName;var d=c.material.parameters;c._baseColorTexture=new q.TextureBinding(a.textureRep,d.baseColorTexture,
{textureUniform:"tex",textureUnit:g.DefaultTextureUnits.DIFFUSE});c._metallicRoughnessTexture=new q.TextureBinding(a.textureRep,d.metallicRoughnessTexture,{textureUniform:"texMetallicRoughness",textureUnit:g.DefaultTextureUnits.METALLIC_ROUGHNESS});c._normalTexture=new q.TextureBinding(a.textureRep,d.normalTexture,{textureUniform:"texNormal",textureUnit:g.DefaultTextureUnits.NORMAL});c._emissiveTexture=new q.TextureBinding(a.textureRep,d.emissiveTexture,{textureUniform:"texEmission",textureUnit:g.DefaultTextureUnits.EMISSION});
c._occlusionTexture=new q.TextureBinding(a.textureRep,d.occlusionTexture,{textureUniform:"texOcclusion",textureUnit:g.DefaultTextureUnits.OCCLUSION});c.createPrograms();c.selectPipeline();return c}k(e,b);Object.defineProperty(e.prototype,"requiresVertexTransparencyDiscards",{get:function(){return d.isUniformComponentData(this.material.parameters.componentData)?!1:"color"===this.passName&&this.material.hasTransparency&&this.material.parameters.useVertexTransparencyDiscards},enumerable:!0,configurable:!0});
e.prototype.createPrograms=function(){var a=this;this.programs=f.BindParametersMap.create(this.material.parameters,function(b){return a._createProgram(b)})};e.prototype._createProgram=function(a){var b=this.material.parameters,c=this.material.geometryParameters,e="screen-space"===b.normals||"screen-space"===c.normals||"none"===c.normals?"screenDerivative":"compressed"===c.normals?"compressed":"default";if("color"===this.passName)return this.programRep.getProgram(p.colorPass,{textureAtlas:!!c.textureCoordinateRegions,
colorTexture:!!b.baseColorTexture,vertexColors:c.colors,doubleSided:b.doubleSidedShading,groundNormalShading:"ground"===b.normals,normals:e,componentColor:c.componentData&&!d.isUniformComponentData(b.componentData),textureAlphaMode:"maskBlend",slice:b.slicePlaneEnabled,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO,usePBR:b.usePBR,roughnessMetallnessTexture:!!b.metallicRoughnessTexture,emissionTexture:!!b.emissiveTexture,normalTexture:!!b.normalTexture,occlusionTexture:!!b.occlusionTexture,
vertexTransparencyDiscardEnabled:this.requiresVertexTransparencyDiscards});if("depth"===this.passName||"depthShadowMap"===this.passName)return this.programRep.getProgram(p.depthPass,{textureAtlas:!!c.textureCoordinateRegions,colorTexture:!!b.baseColorTexture,vertexColors:c.colors,groundNormalShading:"ground"===b.normals,normals:e,componentColor:c.componentData&&!d.isUniformComponentData(b.componentData),textureAlphaMode:"maskBlend",shadowMap:"depthShadowMap"===this.passName,slice:b.slicePlaneEnabled});
if("normal"===this.passName)return this.programRep.getProgram(p.normalPass,{textureAtlas:!!c.textureCoordinateRegions,colorTexture:!!b.baseColorTexture,vertexColors:c.colors,groundNormalShading:"ground"===b.normals,normals:e,componentColor:c.componentData&&!d.isUniformComponentData(b.componentData),textureAlphaMode:"maskBlend",slice:b.slicePlaneEnabled});if("highlight"===this.passName)return this.programRep.getProgram(p.highlightPass,{textureAtlas:!!c.textureCoordinateRegions,colorTexture:!!b.baseColorTexture,
vertexColors:c.colors,groundNormalShading:"ground"===b.normals,normals:e,componentColor:c.componentData&&!d.isUniformComponentData(b.componentData),textureAlphaMode:"maskBlend",slice:b.slicePlaneEnabled})};e.prototype.selectPipeline=function(){var a=this.material.parameters;this.pipelineState="color"===this.passName?r.makePipelineState({blending:t(this.material),culling:x(this.material),polygonOffset:a.polygonOffsetEnabled&&y,stencilTest:a.writeStencil&&{function:{func:a.readStencil?517:519,ref:1,
mask:255},operation:{fail:7680,zFail:7680,zPass:7681}},stencilWrite:a.writeStencil&&{mask:255},depthTest:{func:513},depthWrite:r.defaultDepthWriteParams,colorWrite:r.defaultColorWriteParams}):r.makePipelineState({culling:x(this.material),polygonOffset:a.polygonOffsetEnabled&&y,depthTest:{func:513},depthWrite:r.defaultDepthWriteParams,colorWrite:r.defaultColorWriteParams})};e.prototype.beginSlot=function(a){return this.requiresVertexTransparencyDiscards?(this.discardTransparentVertices=5===a,7===a||
5===a):this.material.hasTransparency?7===a:a===(this.material.parameters.readStencil?3:this.material.parameters.writeStencil?2:5)};e.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};e.prototype.getPrograms=function(){return f.BindParametersMap.programs(this.programs)};e.prototype.updateParameters=function(){this._baseColorTexture.update(this.material.parameters.baseColorTexture);this.createPrograms();this.selectPipeline()};e.prototype.bind=function(a,b){var e=this.material.parameters,
h=this.material.geometryParameters,k=this.program=f.BindParametersMap.lookup(this.programs,b);a.bindProgram(k);a.setPipelineState(this.pipelineState);k.setUniform3fv("ambient",e.baseColor);k.setUniform3fv("diffuse",e.baseColor);k.setUniform3fv("specular",u);e.usePBR&&(k.setUniform1f("metalnessFactor",e.metallicFactor),k.setUniform1f("roughnessFactor",e.roughnessFactor),k.setUniform3fv("emissionFactor",e.emissiveFactor),k.setUniform1f("reflectanceFactor",e.reflectanceFactor));k.setUniform1f("opacity",
e.baseColorOpacity);k.setUniform1f("layerOpacity",e.layerOpacity);this.requiresVertexTransparencyDiscards&&k.setUniform1f("discardTransparentVertices",this.discardTransparentVertices?1:0);d.isUniformComponentData(e.componentData)?(k.setUniform4fv("externalColor",e.componentData.externalColor),k.setUniform1i("colorMixMode",c.colorMixModes[e.componentData.externalColorMixMode])):(k.setUniform4fv("externalColor",w),k.setUniform1i("colorMixMode",c.colorMixModes.multiply),h.componentData&&(e.componentData.textureBuffer.updateTexture(),
e.componentData.textureBuffer.bind(k,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:g.DefaultTextureUnits.COMPONENT_COLOR})));this._baseColorTexture.bind(a,k);k.setUniform1f("textureAlphaCutoff",.1);this._metallicRoughnessTexture.bind(a,k);this._normalTexture.bind(a,k);this._emissiveTexture.bind(a,k);this._occlusionTexture.bind(a,k);h.textureCoordinateRegions&&(this._baseColorTexture.isValid()?this._baseColorTexture.bindSize("atlasSize",k):this._metallicRoughnessTexture.isValid()?
this._metallicRoughnessTexture.bindSize("atlasSize",k):this._normalTexture.isValid()?this._normalTexture.bindSize("atlasSize",k):this._emissiveTexture.isValid()?this._emissiveTexture.bindSize("atlasSize",k):this._occlusionTexture.isValid()&&this._occlusionTexture.bindSize("atlasSize",k));"depth"!==this.passName&&"depthShadowMap"!==this.passName||k.setUniform2fv("nearFar",b.nearFar);"highlight"===this.passName&&c.bindHighlightRendering(a,b,k)};e.prototype.bindView=function(a,b){a=this.material.parameters;
var d=this.program=f.BindParametersMap.lookup(this.programs,b),e=b.origin;c.bindView(e,b.view,d);c.bindCamPos(e,b.viewInvTransp,d);a.slicePlaneEnabled&&c.bindSlicePlane(e,b.slicePlane,d);"color"===this.passName&&b.shadowMappingEnabled&&b.shadowMap.bindView(d,e);"normal"===this.passName&&d.setUniformMatrix4fv("viewNormal",b.viewInvTransp)};e.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};
h([a.autoDispose()],e.prototype,"_baseColorTexture",void 0);h([a.autoDispose()],e.prototype,"_metallicRoughnessTexture",void 0);h([a.autoDispose()],e.prototype,"_normalTexture",void 0);h([a.autoDispose()],e.prototype,"_emissiveTexture",void 0);h([a.autoDispose()],e.prototype,"_occlusionTexture",void 0);return e}(e);e=function(a){function b(b){return a.call(this,l({passName:"color"},b))||this}k(b,a);return b}(n);b.GLMaterialColor=e;e=function(a){function b(b){return a.call(this,l({passName:"depth"},
b))||this}k(b,a);return b}(n);b.GLMaterialDepth=e;e=function(a){function b(b){return a.call(this,l({passName:"depthShadowMap"},b))||this}k(b,a);return b}(n);b.GLMaterialDepthShadowMap=e;e=function(a){function b(b){return a.call(this,l({passName:"normal"},b))||this}k(b,a);return b}(n);b.GLMaterialNormal=e;n=function(a){function b(b){return a.call(this,l({passName:"highlight"},b))||this}k(b,a);return b}(n);b.GLMaterialHighlight=n;var w=[1,1,1,1],u=[0,0,0],y={factor:2,units:2}})},"esri/views/3d/webgl-engine/materials/component/Parameters":function(){define(["require",
"exports","../../../../../core/tsSupport/assignHelper"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.isUniformComponentData=function(a){return!("textureBuffer"in a)};b.fillDefaults=function(a){return l({baseColor:k,baseColorOpacity:1,baseColorTexture:null,doubleSidedShading:!1,normals:"screen-space",cullFace:"back",componentData:h,useVertexTransparencyDiscards:!1,receiveSSAO:!0,forceTransparency:null,slicePlaneEnabled:!1,polygonOffsetEnabled:!1,writeStencil:!1,readStencil:!1,
layerOpacity:1,usePBR:!1,normalTexture:null,emissiveTexture:null,occlusionTexture:null,metallicRoughnessTexture:null,emissiveFactor:[0,0,0],metallicFactor:0,roughnessFactor:1,reflectanceFactor:.5},a)};var k=[1,1,1],h={externalColor:[1,1,1,1],externalColorMixMode:"multiply",castShadows:!0}})},"esri/views/3d/webgl-engine/materials/internal/TextureBinding":function(){define(["require","exports","../../../../../core/maybe"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,
a,g){var e=this;this._textureRep=b;this._textureId=a;this._options=g;this._textureRef=l.applySome(this._textureId,function(a){return e._textureRep.acquire(a,!!e._options.initTransparent)})}b.prototype.dispose=function(){var b=this;this._textureRef=l.applySome(this._textureId,function(a){b._textureRep.release(a)})};b.prototype.bind=function(b,a){l.isSome(this._textureRef)&&(a.setUniform1i(this._options.textureUniform,this._options.textureUnit),b.bindTexture(this._textureRef.getGLTexture(),this._options.textureUnit))};
b.prototype.bindSize=function(b,a){if(l.isSome(this._textureRef)){var g=this._textureRef.getGLTexture();a.setUniform2f(b,g.descriptor.width,g.descriptor.height)}};b.prototype.update=function(b){var a=this;b!==this._textureId&&(l.applySome(this._textureId,function(b){a._textureRep.release(b)}),this._textureRef=l.applySome(b,function(b){return a._textureRep.acquire(b,!!a._options.initTransparent)}))};b.prototype.isValid=function(){return l.isSome(this._textureRef)};return b}();b.TextureBinding=n})},
"esri/views/3d/webgl-engine/materials/component/VertexBufferLayout":function(){define(["require","exports","../../../support/buffer/InterleavedLayout"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.createVertexBufferLayout=function(b){var h=l.newLayout().vec3f("position");"compressed"===b.normals?h.vec2i16("normalCompressed",{glNormalized:!0}):"default"===b.normals&&h.vec3f("normal");b.textureCoordinates&&h.vec2f("uv0");b.textureCoordinateRegions&&h.vec4u16("region",{glNormalized:!0});
b.colors&&h.vec4u8("color");b.componentData&&h.u16("componentIndex");return h.alignTo(4)}})},"esri/views/3d/webgl-engine/materials/renderers/PreinterleavedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ../../lib/Util ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),function(n,
b,l,k,h,a,g,e,d,f,c,q){n=function(){function b(a,b,c){this._material=c;this.type="PreinterleavedRenderer";this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=a;this._materialRep=b;this._glMaterials=d.acquireMaterials(this._material,this._materialRep)}b.prototype.dispose=function(){d.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});b.prototype.hasWater=function(){return!1};b.prototype.renderPriority=function(){return this._material.renderPriority};b.prototype.modify=function(a){this.updateGeometries(a.toUpdate);this.addAndRemoveGeometries(a.toAdd,a.toRemove);this.updateHighlightCount()};b.prototype.addAndRemoveGeometries=function(b,c){var n=this,r=this._rctx,t=this._dataByOrigin;b.forEach(function(b){var c=b.data;if(c.preinterleaved)if(null==
c.vertexData)g.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available.");else{var m=b.origin.id,u=b.origin.vec3,w=b.uniqueName,x=t.get(m);x||(x={origin:u,highlightCount:0,dataByGeometry:new Map},t.set(m,x));g.setMatrixTranslation3(p,-u[0],-u[1],-u[2]);m=k.mat4f64.create();l.mat4.multiply(m,p,b.transformation);var u=d.generateRenderGeometryVisibleIndexRanges(b),y=d.generateRenderGeometryHighlightRanges(b);y&&(x.highlightCount=null);b=new e(b.name,0,c.indexCount,u,y,m,
b.instanceParameters,b.idx,c.id);m=c.indexData?f.createIndex(r,35044,c.indexData):null;u=n._material.createBufferLayout();m=new q(r,a.Default3D,{geometry:h.glLayout(u)},{geometry:f.createVertex(r,35044)},m);m.vertexBuffers.geometry.setData(c.vertexData);c.indexData=null;c.vertexData=null;x.dataByGeometry.set(w,{instance:b,vao:m})}else g.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")});c.forEach(function(a){var b=a.origin.id;a=a.uniqueName;var c=t.get(b);c.dataByGeometry.get(a).vao.dispose();
c.dataByGeometry.delete(a);0===c.dataByGeometry.size&&t.delete(b)})};b.prototype.updateGeometries=function(a){var b=this;a.forEach(function(a){var c=a.updateType;a=a.renderGeometry;var e=a.uniqueName,f=b._dataByOrigin.get(a.origin.id);if(e=f&&f.dataByGeometry.get(e).instance)c&1&&(e.displayedIndexRange=d.generateRenderGeometryVisibleIndexRanges(a)),c&17&&(e.highlightedIndexRanges=d.generateRenderGeometryHighlightRanges(a),f.highlightCount=null),c&2&&console.error("Updating Preinterleaved geometry not supported"),
c&4&&d.calculateTransformRelToOrigin(a,e.transformation,e.transformationNormal)})};b.prototype.updateHighlightCount=function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(b){if(null==b.highlightCount){var c=0;b.dataByGeometry.forEach(function(a){a.instance.highlightedIndexRanges&&++c});b.highlightCount=c}a._highlightCount+=b.highlightCount})};b.prototype.render=function(a,b,c,d){var e=this,f=this._rctx,g=this._glMaterials.get(b.pass),h=4===b.pass;if(!g||null!=a&&!g.beginSlot(a)||
h&&0===this._highlightCount)return!1;g.bind(f,c);var k=!1;this._dataByOrigin.forEach(function(a){h&&0===a.highlightCount||(c.origin=a.origin,g.bindView(f,c),h?a.dataByGeometry.forEach(function(a){k=e.renderInstanceHighlight(g,a,d)||k}):a.dataByGeometry.forEach(function(a){k=e.renderInstance(g,a,d)||k}))});g.release(f,c);f.bindVAO(null);return k};b.prototype.renderInstance=function(a,b,e){var f=b.instance,g=b.vao,h=f.displayedIndexRange;if(h&&0===h.length)return!1;b=this._rctx;var k=a.getProgram(),
l=a.getDrawMode();c.assertCompatibleVertexAttributeLocations(g,k);b.bindVAO(g);a.bindInstance(b,f);a=g.indexBuffer&&g.indexBuffer.indexType;h?a?d.drawElementsFaceRange(b,h,f.from,l,a,e):d.drawArraysFaceRange(b,h,f.from,l,e):(h=f.to-f.from,a?d.drawElements(b,l,a,f.from,h,e):d.drawArrays(b,l,f.from,h,e));return!0};b.prototype.renderInstanceHighlight=function(a,b,e){var f=b.instance,g=b.vao;b=f.highlightedIndexRanges;if(!b)return!1;var h=this._rctx,k=a.getProgram(),l=a.getDrawMode();c.assertCompatibleVertexAttributeLocations(g,
k);h.bindVAO(g);a.bindInstance(h,f);a=g.indexBuffer&&g.indexBuffer.indexType;k=!1;for(g=0;g<b.length;g++){var n=b[g],k=n.range?n.range[0]+f.from:f.from,n=n.range?n.range[1]-n.range[0]+1:f.to-f.from;a?d.drawElements(h,l,a,k,n,e):d.drawArrays(h,l,k,n,e);k=!0}return k};return b}();var p=k.mat4f64.create();return n})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t){Object.defineProperty(b,"__esModule",{value:!0});var x=p.default;n=function(b){function g(a){a=b.call(this)||this;a._dataQueryEngineInstance=null;a._handles=new d;return a}k(g,b);Object.defineProperty(g.prototype,"defaultQueryJSON",{get:function(){return(new t({outSpatialReference:this.spatialReference})).toJSON()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,
configurable:!0});g.prototype.initialize=function(){var a=this;this._handles.add(this.layerView.on("visible-geometry-changed",function(){return a.spatialIndex.events.emit("changed")}))};g.prototype.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&(this._handles.destroy(),this._handles=null);this._set("layerView",null)};g.prototype.executeQueryForCount=function(b,c){return a(this,void 0,void 0,function(){return h(this,
function(a){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(b),c)]})})};g.prototype.executeQueryForExtent=function(b,c){return a(this,void 0,void 0,function(){var a,d,e,f;return h(this,function(g){switch(g.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(b),c)];case 1:return a=g.sent(),d=a.count,e=a.extent,f=q.fromJSON(e),[2,{count:d,extent:f}]}})})};g.prototype.executeQueryForIds=function(b,c){return a(this,void 0,void 0,function(){return h(this,
function(a){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(b),c)]})})};g.prototype.executeQuery=function(b,c){return a(this,void 0,void 0,function(){var a,d,f,g=this;return h(this,function(h){switch(h.label){case 0:a=this._ensureQueryJSON(b);if(a.returnGeometry)throw new e("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(a.returnCentroid)throw new e("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");
return[4,this.dataQueryEngine.executeQuery(a,c)];case 1:return d=h.sent(),f=r.fromJSON(d),f.features.forEach(function(a){a.geometry=null;a.layer=g.layer;a.sourceLayer=g.layer}),[2,f]}})})};g.prototype._ensureQueryJSON=function(a){if(f.isNone(a))return this.defaultQueryJSON;var b=a.toJSON();b.outSpatialReference||(a.outSpatialReference=this.spatialReference);return b};g.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var a=this.layer.objectIdField||
"OBJECTID",b=this.layer.fields.map(function(a){return a.toJSON()}),c=this.layerView.view.resourceController.scheduler,d=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new x({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:b,timeInfo:null,spatialReference:d,objectIdField:a,featureStore:this.spatialIndex,scheduler:c,task:this.task})};l([c.property({constructOnly:!0})],g.prototype,"layerView",void 0);l([c.property({constructOnly:!0})],g.prototype,"task",void 0);l([c.property({constructOnly:!0})],
g.prototype,"spatialIndex",void 0);l([c.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],g.prototype,"spatialReference",void 0);l([c.property({readOnly:!0,aliasOf:"layerView.layer"})],g.prototype,"layer",void 0);l([c.property({readOnly:!0,dependsOn:["spatialReference"]})],g.prototype,"defaultQueryJSON",null);return g=l([c.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],g)}(c.declared(g));b.I3SQueryEngine=n;b.default=n})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("require exports ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),
function(n,b,l,k,h,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.objectIdField=a.objectIdField;this.getFeatureExtent=a.getFeatureExtent}b.prototype.getObjectId=function(a){return a.id};b.prototype.getAttributes=function(b){var d=b.meta,c=b.index,e={};this.objectIdField&&(e[this.objectIdField]=b.id);b=d.attributeInfo.attributeData;if(null!=b)for(var d=0,g=Object.keys(b);d<g.length;d++){var h=g[d];e[h]=a.getCachedAttributeValue(b[h],c)}return e};b.prototype.getAttribute=
function(b,e){if(e===this.objectIdField)return b.id;var c=b.meta.attributeInfo.attributeData;return null==c?null:a.getCachedAttributeValue(c[e],b.index)};b.prototype.getGeometry=function(a){if(a.geometry)return a.geometry;var b=this.getFeatureExtent(a,g);a=b[0];var c=b[1],d=b[2],e=b[3],b=b[4];return new h.default([5],[a,c,d,e,c,d,e,b,d,a,b,d,a,c,d])};b.prototype.getCentroid=function(a,b){if(a.geometry)return k.getCentroidOptimizedGeometry(new h.default,a.geometry,b.hasZ,b.hasM);a=this.getFeatureExtent(a,
g);return new h.default([0],[(a[0]+a[3])/2,(a[1]+a[4])/2,(a[2]+a[5])/2])};b.prototype.cloneWithGeometry=function(a,b){return{id:a.id,index:a.index,meta:a.meta,geometry:b}};return b}();b.I3SQueryFeatureAdapter=n;var g=l.create()})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../support/projectionUtils".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(c){c=b.call(this)||this;c.events=new a;return c}l(e,b);e.prototype.destroy=function(){};e.prototype.forEach=function(a){this.forAllFeatures(function(b){a(b);return 1})};e.prototype.forEachBounds=function(a,b,c){for(var d=this.getFeatureExtent,e=0;e<a.length;e++)b(d(a[e],c))};e.prototype.forEachInBounds=function(a,b){var e=this;this.forAllFeatures(function(c){var g=e.getFeatureExtent(c,p);f.intersects(a,
d.toRect(g,r))&&b(c);return 1},function(b){c.mbsToMbs(b.node.mbs,e.sourceSpatialReference,q,e.viewSpatialReference);if(q[0]>=a[0]&&q[2]<=a[2]&&q[1]>=a[1]&&q[3]<=a[3])return 1;b=q[0]-Math.max(a[0],Math.min(q[0],a[2]));var d=q[1]-Math.max(a[1],Math.min(q[1],a[3]));return b*b+d*d<=q[3]*q[3]?1:2})};k([g.property({constructOnly:!0})],e.prototype,"featureAdapter",void 0);k([g.property({constructOnly:!0})],e.prototype,"forAllFeatures",void 0);k([g.property({constructOnly:!0})],e.prototype,"getFeatureExtent",
void 0);k([g.property({constructOnly:!0})],e.prototype,"sourceSpatialReference",void 0);k([g.property({constructOnly:!0})],e.prototype,"viewSpatialReference",void 0);return e=k([g.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],e)}(g.declared(h));b.I3SQueryFeatureStore=n;var q=e.vec4f64.create(),p=d.create(),r=f.create();b.default=n})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(n,b,l,k,h,a,g,e){Object.defineProperty(b,"__esModule",{value:!0});var d=h.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");b.DefinitionExpressionSceneLayerView=function(b){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._definitionExpressionErrors=0;a._maxDefinitionExpressionErrors=20;a.logError=function(b){a._definitionExpressionErrors<a._maxDefinitionExpressionErrors&&d.error("Error while evaluating definitionExpression: "+b);
a._definitionExpressionErrors++;a._definitionExpressionErrors===a._maxDefinitionExpressionErrors&&d.error("Further errors are ignored")};return a}l(c,b);Object.defineProperty(c.prototype,"parsedDefinitionExpression",{get:function(){if(!this.layer||!this.layer.definitionExpression)return null;try{var a=g.WhereClause.create(this.layer.definitionExpression,this.layer.fieldsIndex);if(!a.isStandardized)return d.error("definitionExpression is using non standard function"),null;var b=[];e.findFieldsCaseInsensitive(a.fieldNames,
this.layer.fields,{missingFields:b});if(0<b.length)return d.error("definitionExpression references unknown fields: "+b.join(", ")),null;this._definitionExpressionErrors=0;return a}catch(t){return d.error("Failed to parse definitionExpression: "+t),null}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"definitionExpressionFields",{get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null},enumerable:!0,configurable:!0});c.prototype._evaluateClause=
function(a,b){try{return a.testFeature(b)}catch(t){return this.logError(t),!1}};c.prototype._addDefinitionExpressionToQuery=function(a){if(!this.parsedDefinitionExpression)return a;var b=this.layer.definitionExpression;a=a.clone();a.where=a.where?"("+b+") AND ("+a.where+")":b;return a};k([a.property()],c.prototype,"layer",void 0);k([a.property({readOnly:!0,dependsOn:["layer.definitionExpression","layer.fieldsIndex"]})],c.prototype,"parsedDefinitionExpression",null);k([a.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],
c.prototype,"definitionExpressionFields",null);return c=k([a.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],c)}(a.declared(b))}})},"esri/views/3d/layers/support/fieldProperties":function(){define(["require","exports","../../../../layers/support/fieldUtils"],function(n,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,dependsOn:["layer.fields",
"layer.outFields","requiredFields"],get:function(){var b=this.layer,h=this.layer.fields,a=this.requiredFields;return b.outFields?l.fixFields(h,l.unpackFieldNames(h,b.outFields).concat(a)):l.fixFields(h,a)}}}}})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../Graphic ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/iteratorUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../renderers/support/renderingInfoUtils ../../../tasks/support/Query ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/Graphics3DVerticalScale ./graphics/QueryEngine ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../../3d/support/debugFlags ../support/GraphicsMap ../support/orientedBoundingBox ../support/projectionUtils ../../layers/LayerView ../../layers/support/FeatureFilter ../../support/Scheduler @dojo/framework/shim/Promise".split(" "),
function(n,b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T,U,Y,X,P,V,Z){function ca(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].graphics;d<e.length;d++){var f=e[d];f.attributes||(f.attributes={});if(b&&b.loadedAttributes)for(var g=0,h=b.loadedAttributes;g<h.length;g++){var k=h[g].name;b.attributeData[k]&&(f.attributes[k]=N.getCachedAttributeValue(b.attributeData[k],c))}}}var da=q.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D"),F=M.defineFieldProperties();b=function(b){function q(a){a=
b.call(this)||this;a._nodesAddedToStage=new Map;a.overlayUpdating=!1;a.supportsDraping=!0;a._queryEngine=null;a._memCache=null;a.loadedGraphics=new U.GraphicsMap;a.progressiveLoadFactor=1;a.supportsHeightUnitConversion=!0;a._coordinatesOutsideExtentErrors=0;a._maxCoordinatesOutsideExtentErrors=20;return a}l(q,b);q.prototype.initialize=function(){var a=this;N.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);for(var b=0,c=["layer.renderer","layer.labelingInfo","layer.labelsVisible",
"definitionExpressionFields","filter"];b<c.length;b++)this.updatingHandles.add(this,c[b],function(){return a._updateRequiredFields()});this.updatingHandles.add(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)},2);this.updatingHandles.add(this.layer,"renderer",function(b,c){return a._rendererChange(b,c)});this.updatingHandles.add(this,"layer.objectIdFilter",function(){return a._filterChange()});this.updatingHandles.add(this,"parsedDefinitionExpression",function(){return a._filterChange()});
this.handles.add(t.init(T,"I3S_TREE_SHOW_TILES",function(b){if(b&&!a._treeDebugger){var c=a._controller.crsIndex;(new Promise(function(a,b){n(["./support/I3STreeDebugger"],a,b)})).then(function(b){b=b.I3STreeDebugger;!a._treeDebugger&&T.I3S_TREE_SHOW_TILES&&(a._treeDebugger=new b({lv:a,view:a.view,nodeSR:c}))})}else b||!a._treeDebugger||T.I3S_TREE_SHOW_TILES||(a._treeDebugger.destroy(),a._treeDebugger=null)}));this._updateRequiredFields();this._set("graphics3d",new I({owner:this,layer:this.layer,
preferredUpdatePolicy:1,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:this.layer.fullExtent,updateClippingExtent:function(b){return a._updateClippingExtent(b)}}));if(this.graphics3d.elevationAlignment)this.graphics3d.elevationAlignment.events.on("invalidate-elevation",function(b){return a._invalidateElevation(b.extent,b.spatialReference)});
this.supportsHeightUnitConversion&&(this._verticalScale=new Q({sourceSpatialReference:this.layer.spatialReference,destSpatialReference:this.view.spatialReference}));this.addResolvingPromise(this.graphics3d.setup());this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid);this._controller=new z({layerView:this,scaleVisibilityEnabled:!1});this.when(function(){a._queryEngine=new J.default({layerView:a,task:Z.Task.FEATURE_QUERY_ENGINE});
a.updatingHandles.add(a,"maximumNumberOfFeatures",function(b){return a._controller.featureTarget=b},2);a.updatingHandles.add(a,"suspended",function(b){b&&a._removeAllNodeData()})})};q.prototype.destroy=function(){this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this._controller&&(this._controller.destroy(),this._controller=null);this._queryEngine&&(this._queryEngine.destroy(),this._queryEngine=null);
this._memCache.destroy();this._nodesAddedToStage=this._memCache=null};Object.defineProperty(q.prototype,"maximumNumberOfFeatures",{get:function(){var a=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return a?a.maximumNumberOfFeatures:0},set:function(a){null!=a?(this._override("maximumNumberOfFeatures",a),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)},enumerable:!0,configurable:!0});
Object.defineProperty(q.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return this.suspended?!1:!!this._controller&&!this._controller.leafsReached},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"hasM",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"hasZ",{get:function(){return!0},enumerable:!0,configurable:!0});q.prototype.whenGraphicAttributes=function(b,c){return a(this,void 0,void 0,function(){var a,d=this;return h(this,
function(e){a=function(a){for(var b=new Map,c=[],e=0;e<a.length;e++){var f=a[e],g=d._findGraphicNodeAndIndex(f),h=b.get(g.node);h||(h={node:g.node,indices:[],graphics:[]},c.push(h));h.indices.push(g.index);h.graphics.push(f)}return c};return[2,N.whenGraphicAttributes(this.layer,b,this._getObjectIdField(),c,a,{ignoreUnavailableFields:!0,populateObjectId:!0})]})})};q.prototype.getGraphicFromGraphicUid=function(a){if(!this.loadedGraphics)return null;var b=v.hydrateGraphic(this.loadedGraphics.find(function(b){return b.uid===
a}),this.layer),c=this._getObjectIdField();if(!b||!b.attributes||!b.attributes[c])return null;b.layer=this.layer;b.sourceLayer=this.layer;return b};q.prototype.whenGraphicBounds=function(a,b){return this.graphics3d.graphicsCore.whenGraphicBounds(a,b)};q.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};q.prototype.isUpdating=function(){return this.overlayUpdating||this._controller&&this._controller.updating||this.graphics3d&&this.graphics3d.updating};
q.prototype.getRenderingInfo=function(a,b){(a=C.getRenderingInfo(a,{renderer:b}))&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};q.prototype.getRenderingInfoAsync=function(b,c,d){return a(this,void 0,void 0,function(){return h(this,function(a){return[2,C.getRenderingInfoAsync(b,g({renderer:c},d))]})})};Object.defineProperty(q.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0});q.prototype._findGraphicNodeAndIndex=
function(a){a=a.attributes[this.layer.objectIdField];for(var b=0,c=d.keysOfMap(this._nodesAddedToStage);b<c.length;b++){var e=this._nodesAddedToStage.get(c[b]),f=this._findGraphicIndex(e.bundle,a);if(0<=f)return{node:e.node,index:f}}return null};q.prototype._findGraphicIndex=function(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].featureIds;d<e.length;d++)if(e[d]===b)return c;return-1};q.prototype.highlight=function(a,b){void 0===b&&(b={});return this.graphics3d.highlight(a,b,this.layer.objectIdField)};
q.prototype.addNodeData=function(a,b){if(this._nodesAddedToStage.has(a.index))da.error("I3S node "+a.id+" already added");else{var c=b.allGeometryData,d=b.attributeDataInfo,f=this._controller.crsIndex;b=this.view.spatialReference;var g=[0,0,0],h=this._getObjectIdField(),k=[],l;if(l=this.layer.fullExtent)l=this.layer.fullExtent.clone(),l.xmin-=.5,l.ymin-=.5,l.xmax+=.5,l.ymax+=.5,l.hasZ&&(l.zmin-=.5,l.zmax+=.5),l.hasM&&(l.mmin-=.5,l.mmax+=.5);var n=l;l=[];for(var q=[],t=0;t<c.length;t++){var u=c[t],
w=u.featureDataPosition,x=w.length,y=u.geometries||[ea[x]],z=u.featureIds;n&&!m.extentContainsCoords3D(n,w)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&da.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&da.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);for(var A=0;A<y.length;A++){var B=y[A];if("points"===B.params.type){var C=
[],D=z[A<z.length?A:0],F={};null!=D&&(F[h]=D);var D=null==D?e.generateUID():D,I=void 0;"Embedded"===B.type&&(I=B.params.vertexAttributes.position);for(B=0;B<I.length;B+=x){for(var J=0;J<x;J++)g[J]=w[J]+I[B+J];X.bufferToBuffer(g,f,0,la,b,0,1);J=v.makeDehydratedPoint(la[0],la[1],la[2],b);3>x&&(J.z=void 0);var K=D,L=this.loadedGraphics.get(K);p.isSome(L)?C.push(L):C.push({uid:K,geometry:J,attributes:F,visible:!0});a.obb||q.push(J.x,J.y,J.z?J.z:0)}l.push.apply(l,C);k.push({featureIds:u.featureIds,graphics:C})}}}a.numFeatures=
l.length;this._updateNodeMemory(a);c={bundle:k,attributeInfo:d,node:a};ca(c.bundle,c.attributeInfo);0<q.length&&(d=this.view.renderSpatialReference,f=this._controller.crsVertex,X.bufferToBuffer(q,b,0,q,d,0,q.length/3),a.obb=Y.compute({data:q,size:3,offsetIdx:0,strideIdx:3}),X.vectorToVector(a.obb.center,d,a.obb.center,f),this._controller.updateVisibility(a.index));if(!this._controller.isGeometryVisible(a))return this._cacheNodeData(c),r.resolve();this._verticalScale&&this._verticalScale.adjust(l);
this._nodesAddedToStage.set(a.index,c);this.loadedGraphics.addManyAndDeduplicate(l);this._filterNode(c);this._treeDebugger&&this._treeDebugger.update();return r.resolve()}};q.prototype.isNodeLoaded=function(a){return this._nodesAddedToStage.has(a)};q.prototype._updateNodeMemory=function(a){a.memory=4096+a.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic};q.prototype._cacheNodeData=function(a){var b=a.bundle.reduce(function(a,b){return b.graphics.reduce(function(a,b){return v.estimateSize(b)+
a},512+8*b.featureIds.length+a)},1024);this._memCache.put(this._getMemCacheKey(a.node),a,b)};q.prototype._getMemCacheKey=function(a){return""+a.index};q.prototype._removeAllNodeData=function(){var a=this;this._nodesAddedToStage.forEach(function(b){b&&(a._updateNodeMemory(b.node),a._cacheNodeData(b))});this._nodesAddedToStage.clear();this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};q.prototype.removeNodeData=function(a,b){for(;0<a.length&&!b.done;){var c=a.pop();if(c=this._removeNodeStageData(c))this._updateNodeMemory(c.node),
this._cacheNodeData(c);b.madeProgress()}};q.prototype._removeNodeStageData=function(a){var b=this._nodesAddedToStage.get(a);if(!b)return null;for(var c=0,d=b.bundle;c<d.length;c++)this.loadedGraphics.removeMany(d[c].graphics);this._nodesAddedToStage.delete(a);this._treeDebugger&&this._treeDebugger.update();return b};q.prototype.loadCachedNodeData=function(a){return r.resolve(this._memCache.pop(this._getMemCacheKey(a)))};q.prototype.addCachedNodeData=function(a,b,c){if(this._nodesAddedToStage.has(a.index))da.error("I3S node "+
a.id+" already added");else{for(var d=0,e=b.bundle;d<e.length;d++)this.loadedGraphics.addManyAndDeduplicate(e[d].graphics);this._nodesAddedToStage.set(a.index,b);this._updateNodeMemory(a);this.setAttributeData(a.index,c);this._filterNode(b);this._treeDebugger&&this._treeDebugger.update();return r.resolve()}};q.prototype.getLoadedNodeIds=function(){var a=[];this._nodesAddedToStage.forEach(function(b){return a.push(b.node.id)});return a.sort()};q.prototype.getLoadedNodes=function(){var a=[];this._nodesAddedToStage.forEach(function(b){return a.push(b.node)});
return a};q.prototype.getLoadedNodeIndices=function(a){this._nodesAddedToStage.forEach(function(b,c){return a.push(c)})};q.prototype.getLoadedAttributes=function(a){if((a=this._nodesAddedToStage.get(a))&&a.attributeInfo)return a.attributeInfo.loadedAttributes};q.prototype.getAttributeData=function(a){if((a=this._nodesAddedToStage.get(a))&&a.attributeInfo)return a.attributeInfo.attributeData};q.prototype.setAttributeData=function(a,b){if(a=this._nodesAddedToStage.get(a))a.attributeInfo=b,ca(a.bundle,
b),this._filterNode(a),this.graphics3d.graphicsCore.labelsEnabled&&(b=a.bundle.map(function(a){return a.graphics.length&&a.graphics[0].uid}),this.graphics3d.graphicsCore.updateLabelingInfo(b))};q.prototype._updateClippingExtent=function(a){this._controller&&this._controller.updateClippingArea(a);return!1};q.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};q.prototype._rendererChange=function(b,d){return a(this,void 0,void 0,function(){var a,e,f,g;return h(this,function(h){switch(h.label){case 0:return a=
this.layer.fields,e=new Set,b?[4,b.collectRequiredFields(e,a)]:[3,2];case 1:return h.sent(),f=c.valuesOfSet(e).sort(),[3,3];case 2:f=[],h.label=3;case 3:return e.clear(),d?[4,d.collectRequiredFields(e,a)]:[3,5];case 4:return h.sent(),g=c.valuesOfSet(e).sort(),[3,6];case 5:g=[],h.label=6;case 6:if(f.length===g.length&&f.every(function(a,b){return f[b]===g[b]}))return[2];this._reloadAllNodes();return[2]}})})};q.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&da.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
q.prototype._filterChange=function(){var a=this;this._nodesAddedToStage.forEach(function(b){return a._filterNode(b)})};q.prototype._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};q.prototype._filterNode=function(a){var b=this._getObjectIdField(),c=null;if(this.layer.objectIdFilter)var d=this.layer.objectIdFilter.ids,e="include"===this.layer.objectIdFilter.method,c=function(a){return 0<=d.indexOf(a)===e};var f=this.parsedDefinitionExpression,
g=0;for(a=a.bundle;g<a.length;g++)for(var h=0,k=a[g].graphics;h<k.length;h++){var l=k[h],m=l.visible;c&&!c(l.attributes[b])?l.visible=!1:l.visible=f?this._evaluateClause(f,l):!0;m!==l.visible&&(ka.graphic=l,ka.property="visible",ka.oldValue=m,ka.newValue=l.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(ka))}};q.prototype._updateRequiredFields=function(){return a(this,void 0,void 0,function(){var a,b,d,e,f,g,k,l,m;return h(this,function(h){switch(h.label){case 0:return a=this,d=b=a.layer,
e=d.fields,f=d.renderer,g=d.labelsVisible,k=a.filter,l=a.definitionExpressionFields,m=new Set,f?[4,f.collectRequiredFields(m,e)]:[3,2];case 1:h.sent(),h.label=2;case 2:return g?[4,B.collectLabelingFields(m,b)]:[3,4];case 3:h.sent(),h.label=4;case 4:return p.isSome(k)?[4,B.collectFilterFields(m,b,k)]:[3,6];case 5:h.sent(),h.label=6;case 6:return B.collectFields(m,e,l),this._set("requiredFields",c.valuesOfSet(m).sort()),[2]}})})};q.prototype._invalidateElevation=function(a,b){var c=this._controller.crsIndex;
X.boundingRectToBoundingRect(a,b,va,c);a=oa;u.fromRect(a,va);a[2]=-Infinity;a[5]=Infinity;this._controller.updateElevationChanged(a,c)};q.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return p.isSome(this.filter)?this.filter.createQuery(a):new D(a)};q.prototype.queryFeatures=function(a,b){return f.safeCast(this._queryEngine.executeQuery(this._ensureQuery(a),b&&b.signal))};q.prototype.queryObjectIds=function(a,b){return f.safeCast(this._queryEngine.executeQueryForIds(this._ensureQuery(a),
b&&b.signal))};q.prototype.queryFeatureCount=function(a,b){return f.safeCast(this._queryEngine.executeQueryForCount(this._ensureQuery(a),b&&b.signal))};q.prototype.queryExtent=function(a,b){return f.safeCast(this._queryEngine.executeQueryForExtent(this._ensureQuery(a),b&&b.signal))};q.prototype._ensureQuery=function(a){return this._addDefinitionExpressionToQuery(p.isNone(a)?this.createQuery():D.from(a))};q.prototype.getUsedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return a?
a.usedMemory:0};q.prototype.getUnloadedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(a?a.unprocessedMemoryEstimate:0))};q.prototype.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};q.prototype.getNumberOfNodes=function(){return this._nodesAddedToStage.size};q.prototype.getNumberOfFeatures=function(){return this.loadedGraphics.length};q.prototype.getStats=function(){var a=
this.graphics3d.graphicsCore.getStats();a.nodes=this.getNumberOfNodes();a.features=this.loadedGraphics.length;this._controller&&this._controller.updateStats(a);return a};k([x.property()],q.prototype,"graphics3d",void 0);k([x.property()],q.prototype,"drawingOrder",void 0);k([x.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],q.prototype,"hasDraped",void 0);k([x.property({type:Boolean})],q.prototype,"overlayUpdating",void 0);k([x.property({type:Boolean})],q.prototype,"supportsDraping",void 0);
k([x.property({type:V})],q.prototype,"filter",void 0);k([x.property()],q.prototype,"loadedGraphics",void 0);k([x.property()],q.prototype,"layer",void 0);k([x.property()],q.prototype,"_controller",void 0);k([x.property({dependsOn:["_controller.updating","graphics3d.updating","overlayUpdating"]})],q.prototype,"updating",void 0);k([x.property({dependsOn:["_controller.rootNodeVisible"]})],q.prototype,"suspended",void 0);k([x.property(R.updatingPercentage)],q.prototype,"updatingPercentage",void 0);k([x.property({aliasOf:"_controller.updatingPercentage"})],
q.prototype,"updatingPercentageValue",void 0);k([x.property(F.requiredFields)],q.prototype,"requiredFields",void 0);k([x.property(F.availableFields)],q.prototype,"availableFields",void 0);k([x.property({type:Number,dependsOn:["graphics3d.graphicsCore.displayFeatureLimit"]})],q.prototype,"maximumNumberOfFeatures",null);k([x.property({readOnly:!0,dependsOn:["suspended","_controller.leafsReached"]})],q.prototype,"maximumNumberOfFeaturesExceeded",null);k([x.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],
q.prototype,"lodFactor",void 0);k([x.property({readOnly:!0})],q.prototype,"hasM",null);k([x.property({readOnly:!0})],q.prototype,"hasZ",null);return q=k([x.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],q)}(x.declared(L.DefinitionExpressionSceneLayerView(S.PopupSceneLayerView(K.LayerView3D(P)))));var ea={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},la=w.vec3f64.create(),ka={graphic:null,
property:null,oldValue:null,newValue:null},oa=u.create(),va=y.create();return b})},"esri/views/3d/support/GraphicsMap":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/Evented","../../../core/iteratorUtils"],function(n,b,l,k,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._map=new Map;return b}l(b,a);b.prototype.clear=function(){if(0<this._map.size){var a=this.toArray();this._map.clear();
this.emit("change",{added:[],removed:a})}};Object.defineProperty(b.prototype,"length",{get:function(){return this._map.size},enumerable:!0,configurable:!0});b.prototype.get=function(a){return this._map.get(a)};b.prototype.addManyAndDeduplicate=function(a){if(0!==a.length){for(var b=new Set,e=0;e<a.length;e++){var c=a[e],g=c.uid,h=this._map.get(g);h?(b.add(g),c!==h&&(a[e]=h),++h.refCount):(c.refCount=1,this._map.set(g,c))}a=0<b.size?a.filter(function(a){return!b.has(a.uid)}):a;this.emit("change",{added:a,
removed:[]})}};b.prototype.removeMany=function(a){for(var b=[],e=0;e<a.length;e++){var c=a[e],g=c.uid,h=this._map.get(g);null!=h&&0>=--h.refCount&&this._map.delete(g)&&b.push(c)}0<b.length&&this.emit("change",{added:[],removed:b})};b.prototype.toArray=function(){return h.valuesOfMap(this._map)};b.prototype.find=function(a){var b;h.everyMap(this._map,function(d){return a(d)?(b=d,!1):!0});return b};b.prototype.forEach=function(a){this._map.forEach(function(b){return a(b)})};return b}(k);b.GraphicsMap=
n})},"*now":function(n){n(['dojo/i18n!*preload*esri/views/nls/SceneView*["ar","bs","ca","cs","da","de","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/assignHelper ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/asyncUtils ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/scheduling ../core/watchUtils ./../core/screenUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3f64 ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ../support/arcadeOnDemand ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/Deconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/layers/support/MemoryManagedLayerView ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/geometryUtils ./3d/support/HighlightOptions ./3d/support/index ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/SharedSymbolResources ./3d/support/geometryUtils/boundedPlane ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/intersectorUtils ./support/screenshotUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment @dojo/framework/shim/Promise".split(" "),function(n,
b,l,k,h,a,g,e,d,f,c,q,p,r,t,x,w,u,y,m,v,z,B,C,D,K,I,Q,J,N,L,M,R,S,T,U,Y,X,P,V,Z,ca,da,F,ea,la,ka,oa,va,fa,xa,ia,na,wa,Ca,ua,ya,G,Ea,za,H,qa,sa,W,ga,Pa,Ra,Ta,A,pa,Ga,hb,Ba){function db(a,b){a.layerUids||(a.layerUids=new Set);a.layerUids.add(b)}function Ua(a,b){a.graphicUids||(a.graphicUids=new Set);a.graphicUids.add(b)}function Da(a){return 1099511627776<=a?Math.round(a/1099511627776)+"TB":1073741824<=a?Math.round(a/1073741824)+"GB":1048576<=a?Math.round(a/1048576)+"MB":1024<=a?Math.round(a/1024)+
"KB":a.toFixed(0)+"B"}var Ya=y.getLogger("esri.views.SceneView");b=function(b){function g(a){var c=b.call(this)||this;c._clippingArea=null;c._userClippingArea=null;c._initialDefaultSpatialReference=null;c._defaults={};c._externallySet={environment:!1};c._createGraphicsViewController=null;c._updateDrawingOrderHandle=null;c.onViewExtentUpdateHandle=null;c._resolveWhenReady=[];c.propertiesPool=new G.default({slicePlane:qa.BoundedPlaneClass},c);c._resourceController=Ca.newResourceController(c);c._defaultToMapOptions=
{include:new Set};c._defaultHitTestOptions={exclude:new Set};c.deconflictor=new da.Deconflictor({view:c});c.labeler=new F.Labeler({view:c});c.renderSpatialReference=null;c.sharedSymbolResources=null;c.basemapTerrain=null;c.elevationProvider=null;c.camera=null;c.canvas=null;c.center=null;c.constraints=new P.default;c.extent=null;c.windowDevicePixelRatio=1;c.fullOpacity=1;c.graphicsView=null;c.groundView=null;c.map=null;c.screenSizePerspectiveEnabled=!0;c.state=null;c.scale=null;c.spatialReference=
null;c.isHeightModelInfoRequired=!0;c.alphaCompositingEnabled=!1;c.supersampleScreenhotsEnabled=!0;c.type="3d";c.ui=new hb;c.updatingPercentage=0;c.viewpoint=null;c.zoom=null;c.highlightOptions=new wa;a&&a.environment||(c._defaults.environment=new V,c.environment=c._defaults.environment);a=function(){c.notifyChange("dataExtent");c.updatingChanged();c.map&&c.map.allLayers.forEach(function(a){a.when(function(){return c.updatingChanged()},function(){return c.updatingChanged()})})};c.handles.add([B.when(c,
"ready",function(a,b){return c._viewReadyHandler(b)}),B.on(c,"map.allLayers","after-changes",a,a,a,!0),c.allLayerViews.on("after-changes",function(){return c._updateUpdatingMonitors()}),c.watch("map",function(a){a&&a.load&&a.load()})]);c.inputManager=new ca({view:c});c.stateManager=new oa.ViewStateManager({view:c,updateDevicePixelRatio:function(){var a=window.devicePixelRatio;a!==c.windowDevicePixelRatio&&(c.windowDevicePixelRatio=a,c.notifyChange("pixelRatio"))}});return c}l(g,b);g.prototype.initialize=
function(){var a=this;this.groundView=new T({view:this});this.environmentManager=new Z.default({view:this});this._updateUpdatingMonitors();var b=function(){return a._updateDefaultToMapOptions()};this.handles.add([B.whenNot(this,"ready",function(b,c){return a._viewUnreadyHandler(c)}),B.on(this,"map.allLayers","after-changes",b,b,b)]);this.updatingHandles.add(this.qualitySettings,"memoryLimit",function(b){a.resourceController&&(a.resourceController.memoryController.maxMemory=b)},2);this.updatingHandles.add(this.qualitySettings,
"additionalCacheMemory",function(b){a.resourceController&&(a.resourceController.memoryController.additionalCacheMemory=b)},2);this.updatingHandles.add(this.qualitySettings,"frameRate",function(a){return z.setFrameDuration(0<a?1E3/Math.ceil(a):0)},2);this.updatingHandles.add(xa,"SCENEVIEW_LOCKING_LOG",function(b){return a.defaultsFromMap.logDebugInformation=b},2);this.updatingHandles.add(this,"map.ground",b,3);this.updatingHandles.add(this,"map.ground.opacity",function(){return a._updateDefaultHitTestOptions()},
3)};g.prototype.destroy=function(){this.activeTool=null;this.layerViewManager.clear();this.stateManager.deinit();this.groundView.destroy();this.groundView=null;this.destroyViewData();this._disposeSurface();this._disposeGraphicsView();this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null);this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null);this.state&&this.state.destroy();this._stage&&(this._stage.destroy(),
this._stage=null,this.handles.remove("stage"));this._set("canvas",null);this.labeler.destroy();this.labeler=null;this.deconflictor.destroy();this.deconflictor=null;this._resourceController.destroy();this._resourceController=null;this.environmentManager.destroy();this._set("environmentManager",null);this.stateManager.destroy();this._set("stateManager",null);this.inputManager.destroy();this._set("inputManager",null);this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(g.prototype,
"clippingArea",{get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;var a=this.get("map.clippingEnabled"),b=this.get("map.clippingArea");if(!a||!b)return this._clippingArea=null;if(!(b instanceof d.Extent))return Ya.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(!L.canProject(b.spatialReference,this.spatialReference))return Ya.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),
this._clippingArea;b=L.project(b,this.spatialReference);return this._clippingArea&&b&&this._clippingArea.equals(b)?this._clippingArea:this._clippingArea=b},set:function(a){this.ready&&"global"===this.viewingMode&&a?Ya.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"dataExtent",{get:function(){var a=[],b=this.spatialReference||d.SpatialReference.WGS84,
c=this.clippingArea;c&&(c=L.project(c,b));var e=function(d){d&&(d=L.project(d,b))&&(c&&(d=d.intersection(c)),d&&a.push(d))},f=this._get("basemapTerrain");f&&f.spatialReference&&e(new d.Extent({xmin:f.extent[0],ymin:f.extent[1],zmin:0,xmax:f.extent[2],ymax:f.extent[3],zmax:0,spatialReference:f.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){return e(a.fullExtent)});return 0<a.length?(f=a.reduce(function(a,b){return a.union(b)}),f.hasZ?(f.zmin=Math.min(0,f.zmin),f.zmax=Math.max(0,
f.zmax)):(f.zmin=0,f.zmax=0),f):new d.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b})},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",a)},enumerable:!0,configurable:!0});g.prototype.castEnvironment=function(a){return a?a instanceof V?a:a instanceof Ba?V.fromWebsceneEnvironment(a):K.ensureType(V,a):new V};Object.defineProperty(g.prototype,
"pixelRatio",{get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},set:function(a){m.isSome(a)?this._override("pixelRatio",a):this._clearOverride("pixelRatio")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"maximumPixelRatio",{get:function(){var a=Infinity,b=this.qualitySettings,c=b.maximumPixelRatio,b=b.maximumRenderResolution;null!=c&&(a=Math.min(a,c));null!=b&&(a=Math.min(a,b/Math.max(this.width,this.height)));return a},set:function(a){m.isSome(a)?
this._override("maximumPixelRatio",a):this._clearOverride("maximumPixelRatio")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"groundExtent",{get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var b=a.extent;return new d.Extent({xmin:b[0],ymin:b[1],xmax:b[2],ymax:b[3],spatialReference:a.spatialReference})}return new d.Extent({spatialReference:this.spatialReference||d.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"initialExtentRequired",{get:function(){return this.stateManager&&!this.stateManager.hasInitialView},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"interacting",{get:function(){return!!this.state&&this.state.interacting},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||ia.getDefaultProfile()},set:function(a){ia.isValidProfile(a)&&(ia.apply(a,this.qualitySettings),this._set("qualityProfile",a))},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"slicePlane",{set:function(a){this._stage.renderView.setRenderParameters({slicePlane:a});if(a){var b=this.propertiesPool.get("slicePlane");na.boundedPlane.copy(a,b);this._set("slicePlane",b)}else this._set("slicePlane",null)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"resolution",{get:function(){return null!=this.spatialReference?N.getResolutionForScale(this.scale,this.spatialReference):0},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();return null!=a?Q.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){var a=0,b=0,c=!1;this.allLayerViews.forEach(function(d){d.isFulfilled()?d.updating&&(c=!0,d="updatingPercentage"in d?d.updatingPercentage:null,null!=d&&(++b,a+=d)):c=!0});c=!!(c||!this.ready||!this.stationary||this._createGraphicsViewController||
m.isSome(this.graphicsView)&&this.graphicsView.updating||this.basemapView&&this.basemapView.updating||this.basemapTerrain&&this.basemapTerrain.updating||this.layerViewManager&&this.layerViewManager.updating||this._resourceController&&this._resourceController.updating||this._stage&&this._stage.renderView&&this._stage.renderView.updating||this.featureTiles&&this.featureTiles.updating||this.pointsOfInterest&&this.pointsOfInterest.updating||this.labeler&&this.labeler.updating||this.deconflictor&&this.deconflictor.updating||
this.environmentManager&&this.environmentManager.updating||this.inputManager&&this.inputManager.hasPendingInputs||this.map&&this.map.allLayers&&this.map.allLayers.some(function(a){return!a.isFulfilled()})||this.overlay&&this.overlay.updating||this.updatingHandles&&this.updatingHandles.updating||this.featureTreeDebugger&&this.featureTreeDebugger.updating);a=0!==b?a/b:c?100:0;this._get("updatingPercentage")!==a&&this._set("updatingPercentage",a);return c},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"viewingMode",{get:function(){var a=this.get("map.initialViewProperties.viewingMode"),b=this.spatialReference;a||(a=!b||pa.isSpatialReferenceSupported(b,"global")?"global":"local");return a},set:function(a){this.internallyReady?Ya.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"resourceController",{get:function(){return this._resourceController},
enumerable:!0,configurable:!0});g.prototype.on=function(a,b,c){var d=this.inputManager.viewEvents.register(a,b,c);return d?d:this.inherited(arguments)};g.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.inputManager&&this.inputManager.viewEvents.hasHandler(a)};g.prototype.toMap=function(a,b){if(!this.ready)return Ya.error("#toMap()","Scene view cannot be used before it is ready"),null;b=b?this._externalToInternalIntersectOptions(b):this._defaultToMapOptions;var c=m.isSome(b.graphics)&&
(m.isSome(b.graphics.include)||m.isSome(b.graphics.exclude));b.allEnabled=c;a=C.isSupportedScreenPointEvent(a)?C.createScreenPointFromSupportedEvent(this,a):a;a=C.screenPointObjectToArray(a);var d=b.include&&!b.include.has(Ta.TERRAIN_ID)||b.exclude&&b.exclude.has(Ta.TERRAIN_ID);a=this.sceneIntersectionHelper.intersectIntersectorScreen(a,null,b,!0,d).results;if(c){c=0;for(a=a.all;c<a.length;c++){var d=a[c],e=d.toGraphic(this);if(m.isNone(e)||this._testGraphicUidFilter(b.graphics,e))return this._intersectResultToMapPoint(d)}return null}return this._intersectResultToMapPoint(a.min)};
g.prototype.toScreen=function(a){if(!this.ready)return Ya.error("#toScreen()","Scene view cannot be used before it is ready"),null;var b=null==a.z&&this.basemapTerrain.getElevation(a)||0;ya.pointToVector(a,ta,this.renderSpatialReference,b);return this.engineToScreen(ta)};g.prototype.pixelSizeAt=function(a,b){if(!this.ready)return Ya.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if("number"===typeof a){if(a=this.sceneIntersectionHelper.intersectIntersectorScreen(C.createScreenPointArray(a,
b)).results.min,!a.getIntersectionPoint(ta))return 0}else if(a instanceof d.Point)ya.pointToVector(a,ta,this.renderSpatialReference);else if(a=this.sceneIntersectionHelper.intersectIntersectorScreen(C.createScreenPointArray(a.x,a.y)).results.min,!a.getIntersectionPoint(ta))return 0;return this.state.camera.computeScreenPixelSizeAt(ta)};g.prototype.hitTest=function(a,b){if(!this.ready)return Ya.error("#hitTest()","Scene view cannot be used before it is ready"),null;a=C.isSupportedScreenPointEvent(a)?
C.createScreenPointFromSupportedEvent(this,a):a;var c=C.createScreenPointArray(a.x,a.y),d=b?this._externalToInternalIntersectOptions(b):this._defaultHitTestOptions;d.allEnabled=!0;d.terrainLocationFeedbackEnabled=!0;b=this.sceneIntersectionHelper.intersectIntersectorScreen(c,null,d,!0,!0);c=this._intersectResultsToHits(b.results.all,d.graphics);d=b.results.terrain;a={screenPoint:a,results:c,ground:{mapPoint:this._intersectResultToMapPoint(d),distance:d.hasIntersectionPoint?d.distanceInRenderSpace:
0}};xa.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(a.intersector=b);return v.resolve(a)};g.prototype.popupHitTest=function(a){return this.hitTest(a).then(function(b){for(var c=[],d=b.results.length?b.results[0].distance:0,e=0,f=b.results;e<f.length;e++){var g=f[e];if(g.distance!==d)break;c.push(g)}e=null;if(0===c.length||1E-5>Math.abs(d-b.ground.distance))e=b.ground.mapPoint;return{results:c,screenPoint:a,mapPoint:e}})};g.prototype.goTo=function(a,b){return p.safeCast(this.stateManager.goTo(a,b))};g.prototype.takeScreenshot=
function(a){var b=this;return this.whenReady().then(function(){var c=A.toRenderSettings(a,b);c.pixelRatio/=b.pixelRatio;return b._stage.renderView.takeScreenshot(A.screenshotSuperSampleSettings(c,b.supersampleScreenhotsEnabled))})};g.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()};g.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&
this._initialDefaultSpatialReference||null};g.prototype.validate=function(){var a=Ga.check();u("safari")&&9>u("safari")&&(a=new x("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:u("safari")}));return a?(Ya.warn("#validate()",a.message),v.reject(a)):p.safeCast(M.loadArcade()).then(function(){},function(){})};g.prototype.isSpatialReferenceSupported=function(a,b,c){var d=a.isGeographic,e=a.isWebMercator,f=
pa.isSpatialReferenceSupported(a,"global"),g="local"===this.viewingMode,h=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(h){if(g&&d)return c&&c("Layer "+b.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!g&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(d&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is geographic but unsupported"),
!1;if(b)if(ga.isTiledLayer(b)){if(d=void 0,h?h=ga.getTiledLayerInfo(b,a,this.viewingMode):(h=ga.getTiledLayerInfo(b,a,"global"),null==h.tileInfo&&(h=ga.getTiledLayerInfo(b,a,"local"))),d=null!=h.tileInfo,!d)return c&&c("Layer "+b.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((a.isWGS84||e)&&!g)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),h||this.internallyReady||
(this.viewingMode="global",c&&c("Viewing mode locked to global due to reprojectable layer "+b.id)),c&&c("Layer "+b.id+" is ignored because it supports server-side reprojection"),!1;return!0};g.prototype.whenReady=function(){var a=this;return v.create(function(b){a.internallyReady?b(a):a._resolveWhenReady.push(b)})};g.prototype.computeMapPointFromVec3d=function(a,b){var c=this.spatialReference||d.SpatialReference.WGS84;ya.vectorToVector(a,this.renderSpatialReference,a,c)||(c=d.SpatialReference.WGS84,
ya.vectorToVector(a,this.renderSpatialReference,a,c));b?(b.x=a[0],b.y=a[1],b.z=a[2],b.spatialReference=c):b=new d.Point(a,c);return b};g.prototype.engineToScreen=function(a,b){var c=C.createRenderScreenPointArray3();this.state.camera.projectPoint(a,c);a=C.screenPointArrayToObject(c);return C.renderToScreen(this,a,b)};g.prototype.flushDisplayModifications=function(){this._stage.processDirty()};g.prototype.getDrawingOrder=function(a){return this.allLayerViews.findIndex(function(b){return b.layer&&b.layer.uid===
a})};g.prototype.getViewForGraphic=function(a){return a.layer===this.graphics?this.graphicsView:a.layer?this.allLayerViews.find(function(b){return b.layer===a.layer}):null};g.prototype.graphicChanged=function(a){m.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(a)};g.prototype.whenViewForGraphic=function(a){var b=this;return a.layer===this?B.whenOnce(this,"graphicsView").then(function(){return b.graphicsView}):a.layer?this.whenLayerView(a.layer):v.reject()};g.prototype.getStats=function(){var a=
this.resourceController.memoryController,b=this.resourceController.scheduler,c={Memory:(a.usedMemory*a.maxMemory).toFixed(0)+"/"+a.maxMemory.toFixed(0)+"MB"};c.Quality=Math.round(100*a.memoryFactor)+"%";c.Load=b.load.toFixed(1);this.basemapTerrain&&(c.Terrain=Da(this.basemapTerrain.getUsedMemory()));this.allLayerViews.items.forEach(function(a){la.isMemoryManagedLayerView(a)&&(c[a.layer.title]=Da(a.getUsedMemory()))});if(a=this._stage&&this._stage.renderView&&this._stage.renderView.edgeView)a=a.getUsedMemory(),
1024<a&&(c.Edges=Da(a));return c};g.prototype._intersectResultToMapPoint=function(a,b){if(a.getIntersectionPoint(ta)){b=this.computeMapPointFromVec3d(ta,b);var c=this.basemapTerrain;"TerrainRenderer"===a.intersector&&c&&(b.z=c.getElevation(b)||0);return b}return null};g.prototype._intersectResultsToHits=function(a,b){for(var c=[],d=null,e=0;e<a.length;e++){var f=a[e],g=f.toOwner(this);if(m.isSome(g)&&(g===this.map.ground||"type"in g&&"integrated-mesh"===g.type))break;g=f.toGraphic(this);if(m.isSome(g)){m.isNone(d)&&
e!==a.length-1&&(d=new Set);if(m.isSome(d)){var h=this._getGraphicFilterUid(g);if(d.has(h))continue;d.add(h)}this._testGraphicUidFilter(b,g)&&(h=this._intersectResultToMapPoint(f),c.push({graphic:g,mapPoint:h,distance:f.distanceInRenderSpace}))}}return c};g.prototype._getGraphicFilterUid=function(a){if(a.layer&&"objectIdField"in a.layer){var b=a.attributes[a.layer.objectIdField];if(b)return"o-"+a.layer.id+"-"+b}return"u-"+a.uid};g.prototype._testGraphicUidFilter=function(a,b){b=this._getGraphicFilterUid(b);
return m.isNone(a)||(m.isNone(a.include)||a.include.has(b))&&(m.isNone(a.exclude)||!a.exclude.has(b))};g.prototype._externalToInternalRenderItems=function(a,b,d){var e=this;void 0===d&&(d={layerUids:null,graphicUids:null});if(!a)return d;a instanceof f?(Ua(d,this._getGraphicFilterUid(a)),0===b&&(m.isSome(this.graphicsView)&&a.layer===this.graphicsView?db(d,this.graphicsView.mockLayerId):a.layer&&db(d,a.layer.uid))):"forEach"in a?a.forEach(function(a){Array.isArray(a)?e._externalToInternalRenderItems(a,
b,d):r.isCollection(a)?a===e.graphics&&m.isSome(e.graphicsView)?db(d,e.graphicsView.mockLayerId):e._externalToInternalRenderItems(a,b,d):a instanceof c?a===e.map.ground&&db(d,Ta.TERRAIN_ID):e._externalToInternalRenderItems(a,b,d)}):db(d,a.uid);return d};g.prototype._externalToInternalIntersectOptions=function(a){var b=this._externalToInternalRenderItems(a.include,0);a=this._externalToInternalRenderItems(a.exclude,1);return{include:b.layerUids,exclude:a.layerUids,graphics:{include:b.graphicUids,exclude:a.graphicUids}}};
g.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";case "local":return"planar"}};g.prototype._initBasemapTerrain=function(a){var b=this;this._disposeBasemapTerrain();this._set("basemapTerrain",new W(this,this._viewingModeToManifold(a)));this._set("elevationProvider",new fa({view:this}));this.elevationProvider.register("ground",this.basemapTerrain);this.handles.add([this.updatingHandles.add(this,"map.ground.opacity",function(a){return b.basemapTerrain.baseOpacity=
null==a?1:a},3),this.updatingHandles.add(this,"map.ground.surfaceColor",function(a){b.basemapTerrain.backgroundColor=a},2)],"basemapTerrain")};g.prototype._initGlobe=function(a){var b=this;this._initCoordinateSystem();this._initState();this._initBasemapTerrain(a);this._set("pointsOfInterest",new sa.default({view:this}));this._set("featureTiles",new ea.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,
viewState:this.state,scheduler:this._resourceController.scheduler}));a=function(){var a=b.basemapTerrain&&b.basemapTerrain.extent;b.clippingArea||a?a&&b.basemapTerrain.spatialReference?(a=J.toExtent(b.basemapTerrain.extent,b.basemapTerrain.spatialReference),b.featureTiles.filterExtent=b.clippingArea?a.intersection(b.clippingArea):a):b.featureTiles.filterExtent=b.clippingArea:b.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(xa,"FEATURE_TILE_TREE_SHOW_TILES",function(a){a&&
b.featureTiles&&!b.featureTreeDebugger?(new Promise(function(a,b){n(["./3d/layers/support/FeatureTileTree3DDebugger"],a,b)})).then(function(a){a=a.FeatureTileTree3DDebugger;!b.featureTreeDebugger&&xa.FEATURE_TILE_TREE_SHOW_TILES&&(b.featureTreeDebugger=new a({view:b}))}):a||!b.featureTreeDebugger||xa.FEATURE_TILE_TREE_SHOW_TILES||(b.featureTreeDebugger.destroy(),b.featureTreeDebugger=null)},2),this.updatingHandles.add(this,"clippingArea",a,3),this.updatingHandles.add(this,"basemapTerrain.extent",
a,3)],"feature-tiles");this.stateManager.init()};g.prototype._initCoordinateSystem=function(){var a=this;if(this.spatialReference){var b=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(b)||this._set("mapCoordsHelper",new ua.default(this.map,b));var c="global"===this.viewingMode,b=c?ya.SphericalECEFSpatialReference:b;b!==this.renderSpatialReference&&(this.renderSpatialReference=b,this._set("renderCoordsHelper",za.RenderCoordsHelper.createMode(this.viewingMode,
b)),c||this.handles.add(this.watch("basemapTerrain.extent",function(b){if(0!==b[0]||0!==b[1]||0!==b[2]||0!==b[3])a.renderCoordsHelper.extent=b},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Ra.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null),this.renderSpatialReference=null};g.prototype.updatingChanged=function(){this.notifyChange("updating")};g.prototype._updateUpdatingMonitors=
function(){var a=this;this.handles.remove("updatingMonitors");this.allLayerViews.forEach(function(b){b.destroyed||(a.handles.add([b.watch(["updating","updatingPercentage"],function(){return a.updatingChanged()},!0)],"updatingMonitors"),b.when(function(){return a.updatingChanged()},function(){return a.updatingChanged()}))});this.updatingChanged()};g.prototype._disposeSurface=function(){var a=function(a){a&&a.remove();return null};this._updateDrawingOrderHandle=a(this._updateDrawingOrderHandle);this.onViewExtentUpdateHandle=
a(this.onViewExtentUpdateHandle);this.pointsOfInterest&&(this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null));this.featureTiles&&(this.featureTiles.destroy(),this._set("featureTiles",null));this.handles.remove("feature-tiles");this.handles.remove("render-coords-helper");this._disposeBasemapTerrain();this.environmentManager&&this.environmentManager.disposeRendering()};g.prototype._disposeBasemapTerrain=function(){var a=this._get("basemapTerrain");a&&(this.handles.remove("basemapTerrain"),
a.destroy(),this._set("basemapTerrain",null))};g.prototype._renderScreenshotOverlay=function(a,b){if(this.overlay&&this.overlay.hasVisibleItems){var c=a.getContext("2d");c.putImageData(b,0,0);this.overlay.renderCanvas(a);a=c.getImageData(0,0,b.width,b.height);for(c=0;c<a.data.length;c++)b.data[c]=a.data[c]}};g.prototype._initStage=function(){var a=this,b={renderContext:this.renderContext,deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,viewingMode:this.viewingMode,
alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:function(b,c){return a._renderScreenshotOverlay(b,c)}}},c=new va.SceneIntersectionHelper(this.viewingMode,{forEachLayer:function(b){a._stage.getLayers().forEach(b)}},this);this._set("sceneIntersectionHelper",c);var d=t.byId(this.surface);this._stage=new Pa.Stage({viewingMode:this.viewingMode,container:d,options:b,sceneIntersectionHelper:c});this._lostWebGLContextHandle=w.on(this._stage.renderView.getCanvas(),"webglcontextlost",
function(){return a.fatalError=new x("webgl-context-lost")});this.handles.add(this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",function(){a._stage.renderView.setRenderParameters({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})},2),"stage");b=function(){a._stage.renderView.setRenderParameters({defaultHighlightOptions:wa.toEngineOptions(a.highlightOptions)})};c=0;for(d=["highlightOptions","highlightOptions.color","highlightOptions.haloColor","highlightOptions.haloOpacity",
"highlightOptions.fillOpacity"];c<d.length;c++)this.handles.add(this.updatingHandles.add(this,d[c],b),"stage");b();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Ra.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.getCanvas())};g.prototype._initSurface=function(){this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new H.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this._resourceController,
pointsOfInterest:this.pointsOfInterest,viewState:this.state})};g.prototype._createGraphicsViewIfNeeded=function(){var a=this;if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=v.createAbortController();var b=function(){a._createGraphicsViewController=null;a.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(b,b);this.updatingChanged()}};g.prototype._createGraphicsViewAsync=
function(b){return a(this,void 0,void 0,function(){var a,c;return h(this,function(d){switch(d.label){case 0:return[4,v.create(function(a){return n(["./3d/layers/GraphicsView3D"],a)})];case 1:return a=d.sent(),v.throwIfAborted(b),[4,B.whenTrueOnce(this.basemapTerrain,"ready",b)];case 2:return d.sent(),c=new a({view:this}),this._set("graphicsView",c),[2]}})})};g.prototype._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=
null);this.handles.remove("graphics-view");m.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.mockLayerId),this.graphicsView.destroy(),this._set("graphicsView",null))};g.prototype._initState=function(){this._set("state",new ka.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}))};g.prototype._viewReadyHandler=function(a){var b=this;a||("global"===this.viewingMode&&(this._clippingArea=null),this.internallyReady=!0,this._initSurface(),this.handles.add(B.on(this,
"graphics","after-changes",function(){return b._createGraphicsViewIfNeeded()}),"graphics-view"),this._createGraphicsViewIfNeeded(),this.updatingChanged(),!this._externallySet.environment&&(a=this.get("map.initialViewProperties.environment"))&&(this.environment=a),this._updateDrawingOrderHandle=this.allLayerViews.on("change",function(){return b._updateDrawingOrder()}),this._updateDrawingOrder(),this.labeler.setup(),this.environmentManager.updateReadyChange(!0),this.inputManager.connect(),a=this._resolveWhenReady,
this._resolveWhenReady=[],a.forEach(function(a){return a(b)}))};g.prototype._viewUnreadyHandler=function(a){a&&(m.isSome(this.activeTool)&&(this.activeTool.deactivate&&this.activeTool.deactivate(),this._set("activeTool",null)),this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),this.internallyReady=!1,this.stateManager.deinit(),this._disposeSurface(),this.state.destroy(),this._set("state",null),this.sharedSymbolResources&&
(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler&&this.labeler.dispose(),this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._stage&&(this._stage.destroy(),this._stage=null),this.handles.remove("stage"),this._set("canvas",null))};g.prototype._updateDrawingOrder=function(){var a=this.allLayerViews.length-1;this.allLayerViews.forEach(function(b,c){"drawingOrder"in b&&(b.drawingOrder=a-c)})};g.prototype._updateDefaultToMapOptions=
function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ta.TERRAIN_ID);for(var a=0,b=this.map.allLayers.items;a<b.length;a++){var c=b[a];"integrated-mesh"===c.type&&this._defaultToMapOptions.include.add(c.uid)}}};g.prototype._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(Ta.TERRAIN_ID);for(var a=0,b=this.map.allLayers.items;a<
b.length;a++){var c=b[a];"integrated-mesh"===c.type&&1>c.opacity&&this._defaultToMapOptions.exclude.add(c.uid)}}};k([D.property()],g.prototype,"_resourceController",void 0);k([D.property()],g.prototype,"_stage",void 0);k([D.property()],g.prototype,"deconflictor",void 0);k([D.property()],g.prototype,"labeler",void 0);k([D.property({type:X,readOnly:!0,aliasOf:"state.animation"})],g.prototype,"animation",void 0);k([D.property({readOnly:!0})],g.prototype,"basemapTerrain",void 0);k([D.property({readOnly:!0})],
g.prototype,"elevationProvider",void 0);k([D.property({type:e,aliasOf:"stateManager.camera"})],g.prototype,"camera",void 0);k([D.property({readOnly:!0})],g.prototype,"canvas",void 0);k([D.property({type:d.Point,aliasOf:"stateManager.center"})],g.prototype,"center",void 0);k([D.property({type:d.Extent,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],g.prototype,"clippingArea",null);k([D.property({type:P.default})],g.prototype,"constraints",void 0);k([D.property({type:d.Extent,
dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],g.prototype,"dataExtent",null);k([D.property({value:null,type:V})],g.prototype,"environment",null);k([D.cast("environment")],g.prototype,"castEnvironment",null);k([D.property()],g.prototype,"environmentManager",void 0);k([D.property({type:d.Extent,aliasOf:"stateManager.extent"})],g.prototype,"extent",void 0);k([D.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],g.prototype,"screenCenter",void 0);k([D.property({type:Number,
dependsOn:["maximumPixelRatio"]})],g.prototype,"pixelRatio",null);k([D.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],g.prototype,"maximumPixelRatio",null);k([D.property({aliasOf:"stateManager.frustum"})],g.prototype,"frustum",void 0);k([D.property({type:Number,readOnly:!0})],g.prototype,"fullOpacity",void 0);k([D.property({readOnly:!0})],g.prototype,"graphicsView",void 0);k([D.property({type:d.Extent,dependsOn:["basemapTerrain.extent"],
readOnly:!0})],g.prototype,"groundExtent",null);k([D.property()],g.prototype,"groundView",void 0);k([D.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],g.prototype,"initialExtentRequired",null);k([D.property({type:Boolean,dependsOn:["state.interacting"],readOnly:!0})],g.prototype,"interacting",null);k([D.property()],g.prototype,"map",void 0);k([D.property({readOnly:!0})],g.prototype,"mapCoordsHelper",void 0);k([D.property({aliasOf:"stateManager.padding"})],g.prototype,"padding",
void 0);k([D.property({type:sa.default,readOnly:!0})],g.prototype,"pointsOfInterest",void 0);k([D.property({type:ea.default,readOnly:!0})],g.prototype,"featureTiles",void 0);k([D.property()],g.prototype,"featureTreeDebugger",void 0);k([D.property({type:Boolean})],g.prototype,"screenSizePerspectiveEnabled",void 0);k([D.property({constructOnly:!0})],g.prototype,"deactivatedWebGLExtensions",void 0);k([D.property({constructOnly:!0})],g.prototype,"debugWebGLExtensions",void 0);k([D.property({constructOnly:!0})],
g.prototype,"renderCanvas",void 0);k([D.property({readOnly:!0})],g.prototype,"state",void 0);k([D.property({readOnly:!0})],g.prototype,"inputManager",void 0);k([D.property({readOnly:!0})],g.prototype,"stateManager",void 0);k([D.property({type:["low","medium","high"]})],g.prototype,"qualityProfile",null);k([D.property({type:Ea,get:function(){var a=this._get("qualitySettings");a||(a=new Ea,ia.apply(this.qualityProfile,a));return a}})],g.prototype,"qualitySettings",void 0);k([D.property()],g.prototype,
"slicePlane",null);k([D.property({dependsOn:["viewingMode"]})],g.prototype,"ready",void 0);k([D.property({readOnly:!0})],g.prototype,"renderCoordsHelper",void 0);k([D.property({readOnly:!0})],g.prototype,"sceneIntersectionHelper",void 0);k([D.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],g.prototype,"resolution",null);k([D.property({type:Number,aliasOf:"stateManager.scale"})],g.prototype,"scale",void 0);k([D.property()],g.prototype,"heightModelInfo",null);k([D.property({dependsOn:["map.initialViewProperties?.spatialReference",
"defaultsFromMap.isSpatialReferenceDone"]})],g.prototype,"spatialReference",void 0);k([D.property({type:Boolean,constructOnly:!0})],g.prototype,"alphaCompositingEnabled",void 0);k([D.property({type:Boolean})],g.prototype,"supersampleScreenhotsEnabled",void 0);k([D.property({readOnly:!0})],g.prototype,"type",void 0);k([D.property({type:hb})],g.prototype,"ui",void 0);k([D.property({type:Boolean,readOnly:!0,dependsOn:"_resourceController.updating labeler.updating layerViewManager.updating deconflictor.updating environmentManager.updating inputManager.hasPendingInputs basemapView.updating basemapTerrain.updating featureTiles.updating pointsOfInterest.updating graphicsView.updating _stage.renderView.updating ready stationary overlay.updating updatingHandles.updating featureTreeDebugger.updating".split(" ")})],
g.prototype,"updating",null);k([D.property({type:Number,readOnly:!0})],g.prototype,"updatingPercentage",void 0);k([D.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],g.prototype,"viewingMode",null);k([D.property({type:q,aliasOf:"stateManager.viewpoint"})],g.prototype,"viewpoint",void 0);k([D.property({type:Number,aliasOf:"stateManager.zoom"})],g.prototype,"zoom",void 0);k([D.property({type:wa})],g.prototype,"highlightOptions",void 0);return g=
k([D.subclass("esri.views.SceneView")],g)}(D.declared(R.BreakpointsOwner(S.DOMContainer(U.PopupView(Y)))));var ta=I.vec3f64.create();return b});