// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/Error ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../statistics/support/utils ../utils ./FeatureLayerAdapter ./support/utils ../../../../tasks/support/generateRendererUtils".split(" "),function(E,F,x,y,z,A,n,p,q,r,B,C,D,g,t){function u(b){return"esri.tasks.support.ClassBreaksDefinition"===
b.declaredClass}function v(b){return"esri.tasks.support.UniqueValueDefinition"===b.declaredClass}return function(b){function a(d){return b.call(this,d)||this}x(a,b);a.prototype._createGenerateRendererResult=function(d,k,c,w,m){return A(this,void 0,void 0,function(){var e,b,h,f,a;return z(this,function(l){switch(l.label){case 0:b=(e=d&&d.features)&&e.length;if(!b)return[2,q.reject(new p("csv-layer-adapter:insufficient-data","No features are available to calculate statistics"))];h=null;return"percent-of-total"!==
w?[3,2]:[4,g.calculateStatsFromMemory({field:k},e)];case 1:f=l.sent();h=f.sum;if(null==h)return[2,q.reject(new p("csv-layer-adapter:invalid","invalid normalizationTotal"))];l.label=2;case 2:return u(m)?[4,g.getDataValues({field:k,normalizationType:w,normalizationField:c,normalizationTotal:h},e)]:[3,4];case 3:return a=l.sent().filter(function(c){return null!=c&&g.isValidNumber(c)}),[2,t.createGenerateRendererClassBreaks({definition:m,values:a,normalizationTotal:h})];case 4:return v(m)?[4,g.getDataValues({field:k},
e)]:[3,6];case 5:return a=l.sent().filter(function(c){return null!=c&&"string"===typeof c&&""!==c.trim()}),[2,t.createGenerateRendererUniqueValues(a)];case 6:return[2,void 0]}})})};a.prototype.generateRenderer=function(a){var k=this,c=a.classificationDefinition,b=null,d=null,e=null;u(c)?(b=c.classificationField,d=c.normalizationField,e=c.normalizationType):v(c)&&(b=c.attributeField);var g=this.layer;return n.safeCast(C.getFieldsList({field:b,normalizationField:d})).then(function(h){var f=g.createQuery();
f.returnGeometry=!1;f.outFields=h;f.where=B.mergeWhereClauses(f.where,a.where);return g.queryFeatures(f).then(function(a){return n.safeCast(k._createGenerateRendererResult(a,b,d,e,c))})})};a.prototype.load=function(a){var b=this;a=this.layer.load(a).then(function(a){b.geometryType=a.geometryType;b.objectIdField=a.objectIdField;b.supportsSQLExpression=!0;b._hasLocalSource=!1;b.hasQueryEngine=!0});this.addResolvingPromise(a);return this.when()};return a=y([r.subclass("esri.renderers.smartMapping.support.adapters.CSVLayerAdapter")],
a)}(r.declared(D))});