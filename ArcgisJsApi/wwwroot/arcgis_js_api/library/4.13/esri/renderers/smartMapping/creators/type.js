// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper dojo/i18n!../../nls/smartMapping ../.. ../../../pointCloudRenderers ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ./support/utils ../heuristics/outline ../statistics/uniqueValues ../support/utils ../symbology/type ../../support/LegendOptions ../../support/utils".split(" "),function(aa,v,D,q,m,P,Q,x,l,y,J,R,k,S,K,n,E,T,F){function U(d){return m(this,
void 0,void 0,function(){var a,c,b,e,g,f;return q(this,function(h){switch(h.label){case 0:if(!d||!d.layer||!d.field&&!d.valueExpression)throw new l("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(d.valueExpression&&!d.view)throw new l("type-renderer:missing-parameters","View is required when 'valueExpression' is specified");a=D({},d);a.symbolType=a.symbolType||"2d";a.numTypes=null==a.numTypes?10:a.numTypes;a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?
!0:a.defaultSymbolEnabled;a.sortBy=null==a.sortBy?"count":a.sortBy;a.sortEnabled=null==a.sortEnabled?!0:a.sortEnabled;a.statistics=y.clone(a.statistics);c=[0,2,1,3];b=n.createLayerAdapter(a.layer,c);a.layer=b;if(!b)throw new l("type-renderer:invalid-parameters","'layer' must be one of these types: "+n.getLayerTypeLabels(c).join(", "));return[4,b.load()];case 1:h.sent();e=b.geometryType;a.outlineOptimizationEnabled="polygon"===e?a.outlineOptimizationEnabled:!1;if("mesh"===e)a.symbolType="3d-volumetric",
a.colorMixMode=a.colorMixMode||"replace",a.edgesType=a.edgesType||"none";else{if("3d-volumetric-uniform"===a.symbolType&&"point"!==e)throw new l("type-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))throw new l("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");}return[4,
n.getFieldsList({field:a.field,valueExpression:a.valueExpression})];case 2:g=h.sent();if(f=k.verifyBasicFieldValidity(b,g,"type-renderer:invalid-parameters"))throw f;return[2,a]}})})}function V(d){return m(this,void 0,void 0,function(){var a,c,b,e,g;return q(this,function(f){switch(f.label){case 0:if(!(d&&d.layer&&d.field))throw new l("type-point-cloud-class-renderer:missing-parameters","'layer' and 'field' parameters are required");a=D({},d);a.statistics=y.clone(a.statistics);c=[4];b=n.createLayerAdapter(a.layer,
c);a.layer=b;a.density=a.density||25;a.size=a.size||"100%";if(!k.isValidPointSize(a.size))throw new l("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");if(!b)throw new l("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+n.getLayerTypeLabels(c).join(", "));return[4,b.load()];case 1:return f.sent(),[4,n.getFieldsList({field:a.field})];case 2:e=f.sent();if(g=k.verifyBasicFieldValidity(b,
e,"type-point-cloud-class-renderer:invalid-parameters"))throw g;return[2,a]}})})}function L(d){return m(this,void 0,void 0,function(){var a,c,b,e,g;return q(this,function(f){switch(f.label){case 0:return a=d.typeScheme,b=c=null,[4,k.getBasemapInfo(d.basemap,d.view)];case 1:e=f.sent();c=J.isSome(e.basemapId)?e.basemapId:null;b=J.isSome(e.basemapTheme)?e.basemapTheme:null;if(a)return[2,{scheme:E.cloneScheme(a),basemapId:c,basemapTheme:b}];if(g=E.getSchemes({basemap:c,basemapTheme:b,geometryType:d.geometryType,
theme:d.theme,worldScale:d.worldScale,view:d.view}))a=g.primaryScheme,c=g.basemapId,b=g.basemapTheme;return[2,{scheme:a,basemapId:c,basemapTheme:b}]}})})}function M(d,a){return d.label<a.label?-1:d.label>a.label?1:0}function N(d,a){return d.value<a.value?-1:d.value>a.value?1:0}function W(d,a){var c=a.count-d.count;0===c&&(c=M(d,a));return c}function X(d,a){var c=a.count-d.count;0===c&&(c=N(d,a));return c}function O(d,a,c){var b;"count"===a?(b=X,c&&c.codedValues&&(b=W)):"value"===a&&(b=N,c&&c.codedValues&&
(b=M));b&&d.sort(b)}function Y(d,a,c){return m(this,void 0,void 0,function(){var b,e,g,f,h,l,t,m,u,p,n,B,w,v,x,y,C,z,A,r,G,H,I;return q(this,function(q){switch(q.label){case 0:return b=d.uniqueValueInfos,e=a.layer,h=(f=(g=a.field)?e.getField(g):null)?e.getFieldDomain(f.name):null,l=-1===a.numTypes?b.length:a.numTypes,t=e.geometryType,[4,L({basemap:a.basemap,geometryType:t,typeScheme:a.typeScheme,worldScale:-1<a.symbolType.indexOf("3d-volumetric"),view:a.view})];case 1:m=q.sent();u=m.scheme;p=new Q.UniqueValueRenderer({field:g});
n=-1;w={value:null,domain:h,fieldInfo:f};b.forEach(function(a,b){w.value=a.value;a.label=F.createUniqueValueLabel(w);null===a.value&&(n=b)});-1<n&&(B=b.splice(n,1)[0]);!1!==a.sortEnabled&&O(b,a.sortBy,h);f&&"date"===f.type&&(v=b.filter(function(a,b){return b<l}),x=v.map(function(a){return a.value}),w.dateFormatInterval=F.calculateDateFormatInterval(x));y=c&&c.opacity;C=k.createColors(u.colors,b.length);z=k.getSymbolSizeFromScheme(u,t);A=k.getSymbolOutlineFromScheme(u,t,y);b.forEach(function(b,c){w.value=
b.value;b.label=F.createUniqueValueLabel(w);b.symbol=k.createSymbol(t,{type:a.symbolType,color:C[c],size:z,outline:A,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}})});a.valueExpression&&(p.valueExpression=a.valueExpression,p.valueExpressionTitle=a.valueExpressionTitle);a.legendOptions&&(p.legendOptions=new T.LegendOptions(a.legendOptions));C=k.createColors(u.colors,l);for(r=0;r<l;r++)(G=b[r])&&p.addUniqueValueInfo({value:G.value,label:G.label,symbol:k.createSymbol(t,{type:a.symbolType,
color:C[r],size:z,outline:A,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}})});a.defaultSymbolEnabled&&(p.defaultSymbol=k.createSymbol(t,{type:a.symbolType,color:u.noDataColor,size:z,outline:A,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}}),p.defaultLabel=P.other);B&&(B.symbol=k.createSymbol(t,{type:a.symbolType,color:u.noDataColor,size:z,outline:A,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}}),b.push(B));H=[];I=p.uniqueValueInfos.length===b.length?-1:
p.uniqueValueInfos.length;if(-1<I)for(r=I;r<b.length;r++)H.push(D({},b[r]));c&&c.visualVariables&&c.visualVariables.length&&(p.visualVariables=c.visualVariables.map(function(a){return a.clone()}));return[2,{renderer:p,uniqueValueInfos:b,excludedUniqueValueInfos:H,typeScheme:E.cloneScheme(u),basemapId:m.basemapId,basemapTheme:m.basemapTheme}]}})})}function Z(d,a){return m(this,void 0,void 0,function(){var c,b,e,g,f;return q(this,function(h){switch(h.label){case 0:return c=d.uniqueValueInfos,[4,L({basemap:"gray",
theme:"point-cloud-class",geometryType:"point",typeScheme:a})];case 1:return e=(b=h.sent())&&b.scheme,f=(g="point-cloud-class"===e.theme)?e.colors:k.createColors(e.colors,c.length),O(c,"value"),[2,c.map(function(a,b){var c=a.value,d=null;g?(d=f[c])||(d=f[f.length-1]):d=f[b];return{values:[c],color:d,label:a.label}})]}})})}Object.defineProperty(v,"__esModule",{value:!0});v.createRenderer=function(d){return m(this,void 0,void 0,function(){var a,c,b,e,g,f;return q(this,function(h){switch(h.label){case 0:return[4,
U(d)];case 1:return a=h.sent(),c={layer:a.layer,field:a.field,valueExpression:a.valueExpression,returnAllCodedValues:a.returnAllCodedValues,view:a.view},b={layer:a.layer,view:a.view},[4,R.all([null!=a.statistics?a.statistics:K(c),a.outlineOptimizationEnabled?S(b):null])];case 2:return e=h.sent(),g=e[0],f=e[1],[2,Y(g,a,f)]}})})};v.createPCClassRenderer=function(d){return m(this,void 0,void 0,function(){var a,c,b,e,g,f;return q(this,function(h){switch(h.label){case 0:return[4,V(d)];case 1:a=h.sent();
if(null==a.statistics)return[3,2];b=a.statistics;return[3,4];case 2:return[4,K({layer:a.layer,field:a.field})];case 3:b=h.sent(),h.label=4;case 4:return c=b,g=x.PointCloudUniqueValueRenderer.bind,f={field:a.field,pointsPerInch:a.density,pointSizeAlgorithm:k.getPointSizeAlgorithm(a.size)},[4,Z(c,a.typeScheme)];case 5:return e=new (g.apply(x.PointCloudUniqueValueRenderer,[void 0,(f.colorUniqueValueInfos=h.sent(),f)])),[2,{renderer:e}]}})})}});