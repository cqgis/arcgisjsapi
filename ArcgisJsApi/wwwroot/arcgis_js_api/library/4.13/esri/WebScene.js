// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(q,d,m){Object.defineProperty(d,"__esModule",{value:!0});d.updateOrigins=function(f){f&&f.writtenProperties&&f.writtenProperties.forEach(function(f){var d=f.target;f.newOrigin&&f.oldOrigin!==f.newOrigin&&m.isMultiOriginJSONMixin(d)&&d.updateOrigin(f.propName,f.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(q,
d,m){Object.defineProperty(d,"__esModule",{value:!0});d.createCopyError=function(){return new m("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};d.isCopyError=function(f){return f&&"webscene:failed-to-copy-embedded-resources"===f.name};d.createSchemaValidationError=function(f){return new m("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:f})};d.isSchemaValidationError=
function(f){return f&&"webscene:schema-validation"===f.name}})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(q,d,m,f,n,h,l,g,r,a,b,c,e,D){function k(a,b,c,e){2===a.length?(u[0]=a[0],u[1]=a[1],u[2]=0,a=u):a===c&&(l.vec3.copy(u,a),a=u);return p(a,b,0,c,e,0,1)}function p(a,b,c,e,p,k,C){void 0===C&&(C=1);b=M(b,p,K).projector;if(f.isNone(b))return!1;if(b===x){if(a===e&&c===k)return!0;for(b=c+3*C;c<b;c++,k++)e[k]=a[c];return!0}for(C=c+3*C;c<C;c+=3,k+=3)b(a,c,e,k);return!0}function T(a,b){if(b.spatialReference===a)return b.spatialReferenceId;b.spatialReference=a;"metersPerUnit"in b&&(b.metersPerUnit=n.getMetersPerUnitForSR(a,
1));return a.wkt===d.SphericalECEFSpatialReference.wkt?b.spatialReferenceId=1:a.isWGS84?b.spatialReferenceId=2:a.isWebMercator?b.spatialReferenceId=3:a.wkt===d.WGS84ECEFSpatialReference.wkt?b.spatialReferenceId=4:4490===a.wkid?b.spatialReferenceId=5:b.spatialReferenceId=0}function x(a,b,c,e){c[e++]=a[b++];c[e++]=a[b++];c[e]=a[b]}function U(a,b,c,p){c[p++]=V*(a[b++]/e.earthRadius);c[p++]=V*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/e.earthRadius)));c[p]=a[b]}function W(a,b,c,p){var w=.4999999*Math.PI,
w=m.clamp(P*a[b+1],-w,w),w=Math.sin(w);c[p++]=P*a[b]*e.earthRadius;c[p++]=e.halfEarthRadius*Math.log((1+w)/(1-w));c[p]=a[b+2]}function Y(a,b,c){b=T(b,L);b=H[b][6];if(f.isNone(b))return!1;b(a,0,u,0);c!==u&&(c[0]=u[0],c[1]=u[1],2<c.length&&(c[2]=u[2]));return!0}function Q(a,b){u[0]=a.x;u[1]=a.y;u[2]=a.hasZ?a.z:0;return Y(u,a.spatialReference,b)}function t(a,b,c,p){var w=e.earthRadius+a[b+2],k=P*a[b+1];a=P*a[b];b=Math.cos(k);c[p++]=Math.cos(a)*b*w;c[p++]=Math.sin(a)*b*w;c[p]=Math.sin(k)*w}function N(a,
b,c,p){var w=D.Vec3Compact.length(a,b),k=m.asinClamped(a[b+2]/(0===w?1:w)),C=Math.cos(k)*w;a=(0<a[b+1]?1:-1)*m.acosClamped(a[b]/(0===C?1:C));c[p++]=V*a;c[p++]=V*k;c[p]=w-e.earthRadius}function v(a,b,c,e){var w=Z,p=P*a[b],k=P*a[b+1];a=a[b+2];b=Math.sin(k);var k=Math.cos(k),C=w.a/Math.sqrt(1-w.e2*b*b);c[e++]=(C+a)*k*Math.cos(p);c[e++]=(C+a)*k*Math.sin(p);c[e++]=(C*(1-w.e2)+a)*b}function E(a,b,c,e){var w=Z,p=a[b],k=a[b+1];a=a[b+2];var C,D,f,R,d,ca;b=Math.abs(a);C=p*p+k*k;D=Math.sqrt(C);f=C+a*a;R=Math.sqrt(f);
p=Math.atan2(k,p);d=a*a/f;f=C/f;k=w.a2/R;C=w.a3-w.a4/R;.3<f?(d=b/R*(1+f*(w.a1+k+d*C)/R),R=Math.asin(d),k=d*d,f=Math.sqrt(1-k)):(f=D/R*(1-d*(w.a5-k-f*C)/R),R=Math.acos(f),k=1-f*f,d=Math.sqrt(k));ca=1-w.e2*k;k=w.a/Math.sqrt(ca);w=w.a6*k;k=D-k*f;C=b-w*d;b=f*k+d*C;D=f*C-d*k;w=D/(w/ca+b);R+=w;0>a&&(R=-R);c[e++]=V*p;c[e++]=V*R;c[e]=b+D*w/2}function M(a,b,c){if(c.source.spatialReference===a&&c.dest.spatialReference===b)return c;var e=T(a,c.source),w=T(b,c.dest);0===e&&0===w?a.equals(b)?c.projector=x:c.projector=
null:c.projector=H[e][w];return c}Object.defineProperty(d,"__esModule",{value:!0});var z,A,y,B,J,F,G,I;d.SphericalECEFSpatialReference=new a({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});d.WGS84ECEFSpatialReference=new a({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});
d.canProject=function(a,b){return!!M(a,b,K).projector};d.vectorToVector=k;d.pointToPoint=function(a,b,c,e){void 0===c&&(c=b.spatialReference);void 0===e&&(e=0);u[0]=a.x;u[1]=a.y;var w=a.z;u[2]=void 0!==w?w:e;if(!p(u,a.spatialReference,0,u,c,0,1))return!1;b.x=u[0];b.y=u[1];b.spatialReference=c;void 0!==w?(b.z=u[2],b.hasZ=!0):(b.z=void 0,b.hasZ=!1);return!0};d.pointToVector=function(a,b,c,e){void 0===e&&(e=0);u[0]=a.x;u[1]=a.y;var w=a.z;u[2]=void 0!==w?w:e;return p(u,a.spatialReference,0,b,c,0,1)};
d.vectorToPoint=function(a,b,e,k){e instanceof r?k=k||e.spatialReference:c.isPoint(e)?(e.hasZ=!0,k=k||e.spatialReference):(k=e,e=new r({spatialReference:k}));return p(a,b,0,u,k,0,1)?(e.x=u[0],e.y=u[1],e.z=u[2],e.spatialReference=k,e):null};d.xyzToVector=function(a,b,c,e,k,C){u[0]=a;u[1]=b;u[2]=c;return p(u,e,0,k,C,0,1)};d.bufferToBuffer=p;d.computeLinearTransformation=function(a,b,c,e){var w=T(a,L),k=T(e,O);if(w===k&&1!==k&&(0!==w||a.equals(e)))return h.mat4.identity(c),h.mat4.translate(c,c,b),!0;
if(1===k){a=H[w][6];k=H[6][k];if(f.isNone(a)||f.isNone(k))return!1;a(b,0,S,0);k(S,0,aa,0);a=P*S[0];k=P*S[1];b=Math.sin(a);a=Math.cos(a);e=Math.sin(k);k=Math.cos(k);c[0]=-b;c[4]=-e*a;c[8]=k*a;c[12]=aa[0];c[1]=a;c[5]=-e*b;c[9]=k*b;c[13]=aa[1];c[2]=0;c[6]=k;c[10]=e;c[14]=aa[2];c[3]=0;c[7]=0;c[11]=0;c[15]=1;return!0}if(3===k&&(2===w||1===w)){a=H[w][6];k=H[6][3];if(f.isNone(a)||f.isNone(k))return!1;a(b,0,S,0);b=P*S[1];k(S,0,aa,0);h.mat4.identity(c);h.mat4.translate(c,c,aa);b=1/Math.cos(b);h.mat4.scale(c,
c,[b,b,1]);return!0}return!1};d.transformDirection=function(a,b,c,e,p){l.vec3.copy(ba,a);l.vec3.add(C,a,b);k(ba,c,ba,p);k(C,c,C,p);l.vec3.subtract(e,C,ba);l.vec3.normalize(e,e)};d.mbsToMbs=function(a,b,c,k){b=M(b,k,X);if(b.projector===x)return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],!0;if(f.isNone(b.projector))return!1;k=b.source;var w=b.dest;if(3===w.spatialReferenceId){b=H[k.spatialReferenceId][2];if(f.isNone(b))return!1;b(a,0,S,0);b=Math.abs(P*S[1])+Math.asin(a[3]/(e.earthRadius+a[2]));W(S,0,c,
0);c[3]=b>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(b)*a[3];return!0}b.projector(a,0,c,0);c[3]=a[3]*k.metersPerUnit/w.metersPerUnit;return!0};d.extentToBoundingBox=function(a,b,c){if(null==a)return!1;var e;u[0]=null!=a.xmin?a.xmin:0;u[1]=null!=a.ymin?a.ymin:0;u[2]=null!=a.zmin?a.zmin:0;e=p(u,a.spatialReference,0,b,c,0,1);u[0]=null!=a.xmax?a.xmax:0;u[1]=null!=a.ymax?a.ymax:0;u[2]=null!=a.zmax?a.zmax:0;e=e&&p(u,a.spatialReference,0,b,c,3,1);null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);
null==a.zmin&&(b[2]=-Infinity);null==a.xmax&&(b[3]=Infinity);null==a.ymax&&(b[4]=Infinity);null==a.zmax&&(b[5]=Infinity);return e};d.extentToBoundingRect=function(a,b,c){if(null==a)return!1;var e;u[0]=null!=a.xmin?a.xmin:0;u[1]=null!=a.ymin?a.ymin:0;u[2]=null!=a.zmin?a.zmin:0;e=p(u,a.spatialReference,0,u,c,0,1);b[0]=u[0];b[1]=u[1];u[0]=null!=a.xmax?a.xmax:0;u[1]=null!=a.ymax?a.ymax:0;u[2]=null!=a.zmax?a.zmax:0;e=e&&p(u,a.spatialReference,0,u,c,0,1);b[2]=u[0];b[3]=u[1];null==a.xmin&&(b[0]=-Infinity);
null==a.ymin&&(b[1]=-Infinity);null==a.xmax&&(b[2]=Infinity);null==a.ymax&&(b[3]=Infinity);return e};d.boundingRectToBoundingRect=function(a,c,e,k){if(null==a)return!1;if(c.equals(k))return b.set(e,a),!0;var C;u[0]=a[0];u[1]=a[1];u[2]=0;C=p(u,c,0,u,k,0,1);e[0]=u[0];e[1]=u[1];u[0]=a[2];u[1]=a[3];u[2]=0;C=C&&p(u,c,0,u,k,0,1);e[2]=u[0];e[3]=u[1];return C};(function(a){a.x2lon=function(a){return a/e.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/e.earthRadius))};a.lon2x=function(a){return a*
e.earthRadius};a.lat2y=function(a){a=Math.sin(a);return e.earthRadius/2*Math.log((1+a)/(1-a))}})(d.webMercator||(d.webMercator={}));d.canProjectToWGS84ComparableLonLat=function(a){a=T(a,L);return!!H[a][6]};d.vectorToWGS84ComparableLonLat=Y;d.pointToWGS84ComparableLonLat=Q;d.pointToWGS84ComparableLonLatPoint=function(a,b){var c=T(b.spatialReference,O);return f.isNone(H[6][c])?!1:Q(a,u)?(b.x=u[0],b.y=u[1],b.z=u[2],!0):!1};d.wgs84ComparableLonLatToECEF=function(a,b,c,k){void 0===k&&(k=0);k=e.earthRadius+
k;var p=Math.cos(c);a[0]=Math.cos(b)*p*k;a[1]=Math.sin(b)*p*k;a[2]=Math.sin(c)*k};var H=(z={},z[2]=(A={},A[5]=null,A[6]=x,A[1]=t,A[0]=null,A[3]=W,A[2]=x,A[4]=v,A),z[5]=(y={},y[5]=x,y[6]=x,y[1]=t,y[0]=null,y[3]=null,y[2]=null,y[4]=v,y),z[3]=(B={},B[5]=null,B[6]=U,B[1]=function(a,b,c,e){U(a,b,c,e);t(c,e,c,e)},B[0]=null,B[3]=x,B[2]=U,B[4]=function(a,b,c,e){U(a,b,c,e);v(c,e,c,e)},B),z[4]=(J={},J[5]=E,J[6]=E,J[1]=function(a,b,c,e){E(a,b,c,e);t(c,e,c,e)},J[0]=null,J[3]=function(a,b,c,e){E(a,b,c,e);W(c,
e,c,e)},J[2]=E,J[4]=x,J),z[1]=(F={},F[5]=N,F[6]=N,F[1]=x,F[0]=null,F[3]=function(a,b,c,e){N(a,b,c,e);W(c,e,c,e)},F[2]=N,F[4]=function(a,b,c,e){N(a,b,c,e);v(c,e,c,e)},F),z[0]=(G={},G[5]=null,G[6]=null,G[1]=null,G[0]=x,G[3]=null,G[2]=null,G[4]=null,G),z[6]=(I={},I[5]=null,I[6]=x,I[1]=t,I[0]=null,I[3]=null,I[2]=x,I[4]=v,I),z),L={spatialReference:null,spatialReferenceId:0},O={spatialReference:null,spatialReferenceId:0},K={source:{spatialReference:null,spatialReferenceId:0},dest:{spatialReference:null,
spatialReferenceId:0},projector:x},X={source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:x},P=m.deg2rad(1),V=m.rad2deg(1),Z={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},u=g.vec3f64.create(),S=g.vec3f64.create(),aa=g.vec3f64.create(),ba=g.vec3f64.create(),C=g.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require",
"exports","./math/mat4"],function(q,d,m){Object.defineProperty(d,"__esModule",{value:!0});d.mat4=m})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(q,d,m,f){function n(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function h(a,b,c){var e=b[0],f=b[1],k=b[2],p=b[3],d=b[4],x=b[5],h=b[6],l=b[7],g=b[8],n=b[9],t=b[10],r=b[11],v=b[12],m=b[13],q=b[14];
b=b[15];var z=c[0],A=c[1],y=c[2],B=c[3];a[0]=z*e+A*d+y*g+B*v;a[1]=z*f+A*x+y*n+B*m;a[2]=z*k+A*h+y*t+B*q;a[3]=z*p+A*l+y*r+B*b;z=c[4];A=c[5];y=c[6];B=c[7];a[4]=z*e+A*d+y*g+B*v;a[5]=z*f+A*x+y*n+B*m;a[6]=z*k+A*h+y*t+B*q;a[7]=z*p+A*l+y*r+B*b;z=c[8];A=c[9];y=c[10];B=c[11];a[8]=z*e+A*d+y*g+B*v;a[9]=z*f+A*x+y*n+B*m;a[10]=z*k+A*h+y*t+B*q;a[11]=z*p+A*l+y*r+B*b;z=c[12];A=c[13];y=c[14];B=c[15];a[12]=z*e+A*d+y*g+B*v;a[13]=z*f+A*x+y*n+B*m;a[14]=z*k+A*h+y*t+B*q;a[15]=z*p+A*l+y*r+B*b;return a}function l(a,b,c){var e=
b[0],f=b[1],k=b[2],p=b[3],d=e+e,x=f+f,h=k+k;b=e*d;var l=e*x,e=e*h,g=f*x,f=f*h,k=k*h,d=p*d,x=p*x,p=p*h;a[0]=1-(g+k);a[1]=l+p;a[2]=e-x;a[3]=0;a[4]=l-p;a[5]=1-(b+k);a[6]=f+d;a[7]=0;a[8]=e+x;a[9]=f-d;a[10]=1-(b+g);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a}function g(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];a[9]=b[9]-c[9];a[10]=b[10]-c[10];a[11]=b[11]-c[11];a[12]=b[12]-c[12];a[13]=b[13]-
c[13];a[14]=b[14]-c[14];a[15]=b[15]-c[15];return a}Object.defineProperty(d,"__esModule",{value:!0});d.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};d.set=function(a,b,c,e,f,k,p,d,x,h,l,g,n,t,r,v,m){a[0]=b;a[1]=c;a[2]=e;a[3]=f;a[4]=k;a[5]=p;a[6]=d;a[7]=x;a[8]=h;a[9]=l;a[10]=g;a[11]=n;a[12]=t;a[13]=r;a[14]=v;a[15]=m;return a};d.identity=n;d.transpose=
function(a,b){if(a===b){var c=b[1],e=b[2],f=b[3],k=b[6],p=b[7],d=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=e;a[9]=k;a[11]=b[14];a[12]=f;a[13]=p;a[14]=d}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};d.invert=function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],p=b[4],d=b[5],x=b[6],h=b[7],l=b[8],g=b[9],n=b[10],t=b[11],r=b[12],v=b[13],m=b[14];
b=b[15];var q=c*d-e*p,z=c*x-f*p,A=c*h-k*p,y=e*x-f*d,B=e*h-k*d,J=f*h-k*x,F=l*v-g*r,G=l*m-n*r,I=l*b-t*r,H=g*m-n*v,L=g*b-t*v,O=n*b-t*m,K=q*O-z*L+A*H+y*I-B*G+J*F;if(!K)return null;K=1/K;a[0]=(d*O-x*L+h*H)*K;a[1]=(f*L-e*O-k*H)*K;a[2]=(v*J-m*B+b*y)*K;a[3]=(n*B-g*J-t*y)*K;a[4]=(x*I-p*O-h*G)*K;a[5]=(c*O-f*I+k*G)*K;a[6]=(m*A-r*J-b*z)*K;a[7]=(l*J-n*A+t*z)*K;a[8]=(p*L-d*I+h*F)*K;a[9]=(e*I-c*L-k*F)*K;a[10]=(r*B-v*A+b*q)*K;a[11]=(g*A-l*B-t*q)*K;a[12]=(d*G-p*H-x*F)*K;a[13]=(c*H-e*G+f*F)*K;a[14]=(v*z-r*y-m*q)*K;
a[15]=(l*y-g*z+n*q)*K;return a};d.adjoint=function(a,b){var c=b[0],e=b[1],f=b[2],k=b[3],p=b[4],d=b[5],x=b[6],h=b[7],l=b[8],g=b[9],n=b[10],t=b[11],r=b[12],m=b[13],q=b[14];b=b[15];a[0]=d*(n*b-t*q)-g*(x*b-h*q)+m*(x*t-h*n);a[1]=-(e*(n*b-t*q)-g*(f*b-k*q)+m*(f*t-k*n));a[2]=e*(x*b-h*q)-d*(f*b-k*q)+m*(f*h-k*x);a[3]=-(e*(x*t-h*n)-d*(f*t-k*n)+g*(f*h-k*x));a[4]=-(p*(n*b-t*q)-l*(x*b-h*q)+r*(x*t-h*n));a[5]=c*(n*b-t*q)-l*(f*b-k*q)+r*(f*t-k*n);a[6]=-(c*(x*b-h*q)-p*(f*b-k*q)+r*(f*h-k*x));a[7]=c*(x*t-h*n)-p*(f*t-
k*n)+l*(f*h-k*x);a[8]=p*(g*b-t*m)-l*(d*b-h*m)+r*(d*t-h*g);a[9]=-(c*(g*b-t*m)-l*(e*b-k*m)+r*(e*t-k*g));a[10]=c*(d*b-h*m)-p*(e*b-k*m)+r*(e*h-k*d);a[11]=-(c*(d*t-h*g)-p*(e*t-k*g)+l*(e*h-k*d));a[12]=-(p*(g*q-n*m)-l*(d*q-x*m)+r*(d*n-x*g));a[13]=c*(g*q-n*m)-l*(e*q-f*m)+r*(e*n-f*g);a[14]=-(c*(d*q-x*m)-p*(e*q-f*m)+r*(e*x-f*d));a[15]=c*(d*n-x*g)-p*(e*n-f*g)+l*(e*x-f*d);return a};d.determinant=function(a){var b=a[0],c=a[1],e=a[2],f=a[3],k=a[4],p=a[5],d=a[6],h=a[7],g=a[8],n=a[9],l=a[10],m=a[11],r=a[12],q=a[13],
v=a[14];a=a[15];return(b*p-c*k)*(l*a-m*v)-(b*d-e*k)*(n*a-m*q)+(b*h-f*k)*(n*v-l*q)+(c*d-e*p)*(g*a-m*r)-(c*h-f*p)*(g*v-l*r)+(e*h-f*d)*(g*q-n*r)};d.multiply=h;d.translate=function(a,b,c){var e=c[0],f=c[1];c=c[2];var k=void 0,p=void 0,d=void 0,h=void 0,g=void 0,n=void 0,l=void 0,m=void 0,r=void 0,q=void 0,v=void 0,E=void 0;b===a?(a[12]=b[0]*e+b[4]*f+b[8]*c+b[12],a[13]=b[1]*e+b[5]*f+b[9]*c+b[13],a[14]=b[2]*e+b[6]*f+b[10]*c+b[14],a[15]=b[3]*e+b[7]*f+b[11]*c+b[15]):(k=b[0],p=b[1],d=b[2],h=b[3],g=b[4],n=
b[5],l=b[6],m=b[7],r=b[8],q=b[9],v=b[10],E=b[11],a[0]=k,a[1]=p,a[2]=d,a[3]=h,a[4]=g,a[5]=n,a[6]=l,a[7]=m,a[8]=r,a[9]=q,a[10]=v,a[11]=E,a[12]=k*e+g*f+r*c+b[12],a[13]=p*e+n*f+q*c+b[13],a[14]=d*e+l*f+v*c+b[14],a[15]=h*e+m*f+E*c+b[15]);return a};d.scale=function(a,b,c){var e=c[0],f=c[1];c=c[2];a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*f;a[5]=b[5]*f;a[6]=b[6]*f;a[7]=b[7]*f;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};d.rotate=
function(a,b,c,e){var d=e[0],k=e[1];e=e[2];var p=Math.sqrt(d*d+k*k+e*e),h=void 0,g=void 0,n=void 0,l=void 0,m=void 0,r=void 0,t=void 0,q=void 0,v=void 0,E=void 0,M=void 0,z=void 0,A=void 0,y=void 0,B=void 0,J=void 0,F=void 0,G=void 0,I=void 0,H=void 0,L=void 0,O=void 0,g=h=void 0;if(p<f.EPSILON)return null;p=1/p;d*=p;k*=p;e*=p;h=Math.sin(c);g=Math.cos(c);n=1-g;l=b[0];m=b[1];r=b[2];t=b[3];q=b[4];v=b[5];E=b[6];M=b[7];z=b[8];A=b[9];y=b[10];B=b[11];J=d*d*n+g;F=k*d*n+e*h;G=e*d*n-k*h;I=d*k*n-e*h;H=k*k*
n+g;L=e*k*n+d*h;O=d*e*n+k*h;h=k*e*n-d*h;g=e*e*n+g;a[0]=l*J+q*F+z*G;a[1]=m*J+v*F+A*G;a[2]=r*J+E*F+y*G;a[3]=t*J+M*F+B*G;a[4]=l*I+q*H+z*L;a[5]=m*I+v*H+A*L;a[6]=r*I+E*H+y*L;a[7]=t*I+M*H+B*L;a[8]=l*O+q*h+z*g;a[9]=m*O+v*h+A*g;a[10]=r*O+E*h+y*g;a[11]=t*O+M*h+B*g;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};d.rotateX=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var f=b[4],k=b[5],p=b[6],d=b[7],h=b[8],g=b[9],n=b[10],l=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],
a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=f*c+h*e;a[5]=k*c+g*e;a[6]=p*c+n*e;a[7]=d*c+l*e;a[8]=h*c-f*e;a[9]=g*c-k*e;a[10]=n*c-p*e;a[11]=l*c-d*e;return a};d.rotateY=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var f=b[0],k=b[1],p=b[2],d=b[3],h=b[8],g=b[9],n=b[10],l=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=f*c-h*e;a[1]=k*c-g*e;a[2]=p*c-n*e;a[3]=d*c-l*e;a[8]=f*e+h*c;a[9]=k*e+g*c;a[10]=p*e+n*c;a[11]=d*e+l*c;return a};d.rotateZ=function(a,
b,c){var e=Math.sin(c);c=Math.cos(c);var f=b[0],k=b[1],p=b[2],d=b[3],h=b[4],g=b[5],n=b[6],l=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=f*c+h*e;a[1]=k*c+g*e;a[2]=p*c+n*e;a[3]=d*c+l*e;a[4]=h*c-f*e;a[5]=g*c-k*e;a[6]=n*c-p*e;a[7]=l*c-d*e;return a};d.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};d.fromScaling=function(a,
b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromRotation=function(a,b,c){var e=c[0],d=c[1];c=c[2];var k=Math.sqrt(e*e+d*d+c*c),p=void 0,h=void 0,g=void 0;if(k<f.EPSILON)return null;k=1/k;e*=k;d*=k;c*=k;p=Math.sin(b);h=Math.cos(b);g=1-h;a[0]=e*e*g+h;a[1]=d*e*g+c*p;a[2]=c*e*g-d*p;a[3]=0;a[4]=e*d*g-c*p;a[5]=d*d*g+h;a[6]=c*d*g+e*p;a[7]=0;a[8]=e*c*g+d*p;a[9]=d*c*g-e*p;a[10]=c*c*g+h;a[11]=0;a[12]=0;a[13]=0;
a[14]=0;a[15]=1;return a};d.fromXRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=c;a[7]=0;a[8]=0;a[9]=-c;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-c;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=c;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=0;a[4]=
-c;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromRotationTranslation=l;d.fromQuat2=function(a,b){var c=r,e=-b[0],f=-b[1],k=-b[2],p=b[3],d=b[4],h=b[5],g=b[6],n=b[7],m=e*e+f*f+k*k+p*p;0<m?(c[0]=2*(d*p+n*e+h*k-g*f)/m,c[1]=2*(h*p+n*f+g*e-d*k)/m,c[2]=2*(g*p+n*k+d*f-h*e)/m):(c[0]=2*(d*p+n*e+h*k-g*f),c[1]=2*(h*p+n*f+g*e-d*k),c[2]=2*(g*p+n*k+d*f-h*e));l(a,b,c);return a};var r=m.create();d.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};
d.getScaling=function(a,b){var c=b[0],e=b[1],f=b[2],k=b[4],d=b[5],h=b[6],g=b[8],n=b[9];b=b[10];a[0]=Math.sqrt(c*c+e*e+f*f);a[1]=Math.sqrt(k*k+d*d+h*h);a[2]=Math.sqrt(g*g+n*n+b*b);return a};d.getRotation=function(a,b){var c=b[0]+b[5]+b[10],e=0;0<c?(e=2*Math.sqrt(c+1),a[3]=.25*e,a[0]=(b[6]-b[9])/e,a[1]=(b[8]-b[2])/e,a[2]=(b[1]-b[4])/e):b[0]>b[5]&&b[0]>b[10]?(e=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/e,a[0]=.25*e,a[1]=(b[1]+b[4])/e,a[2]=(b[8]+b[2])/e):b[5]>b[10]?(e=2*Math.sqrt(1+b[5]-b[0]-b[10]),
a[3]=(b[8]-b[2])/e,a[0]=(b[1]+b[4])/e,a[1]=.25*e,a[2]=(b[6]+b[9])/e):(e=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/e,a[0]=(b[8]+b[2])/e,a[1]=(b[6]+b[9])/e,a[2]=.25*e);return a};d.fromRotationTranslationScale=function(a,b,c,e){var f=b[0],k=b[1],d=b[2],h=b[3],g=f+f,n=k+k,l=d+d;b=f*g;var m=f*n,f=f*l,r=k*n,k=k*l,d=d*l,g=h*g,n=h*n,h=h*l,l=e[0],t=e[1];e=e[2];a[0]=(1-(r+d))*l;a[1]=(m+h)*l;a[2]=(f-n)*l;a[3]=0;a[4]=(m-h)*t;a[5]=(1-(b+d))*t;a[6]=(k+g)*t;a[7]=0;a[8]=(f+n)*e;a[9]=(k-g)*e;a[10]=(1-(b+r))*
e;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};d.fromRotationTranslationScaleOrigin=function(a,b,c,e,f){var k=b[0],d=b[1],h=b[2],g=b[3],n=k+k,l=d+d,m=h+h;b=k*n;var r=k*l,t=k*m,k=d*l,d=d*m,D=h*m,h=g*n,l=g*l,q=g*m,E=e[0],M=e[1],m=e[2];e=f[0];g=f[1];f=f[2];var n=(1-(k+D))*E,z=(r+q)*E,E=(t-l)*E,r=(r-q)*M,D=(1-(b+D))*M,M=(d+h)*M,t=(t+l)*m,d=(d-h)*m;b=(1-(b+k))*m;a[0]=n;a[1]=z;a[2]=E;a[3]=0;a[4]=r;a[5]=D;a[6]=M;a[7]=0;a[8]=t;a[9]=d;a[10]=b;a[11]=0;a[12]=c[0]+e-(n*e+r*g+t*f);a[13]=c[1]+g-(z*
e+D*g+d*f);a[14]=c[2]+f-(E*e+M*g+b*f);a[15]=1;return a};d.fromQuat=function(a,b){var c=b[0],e=b[1],f=b[2];b=b[3];var k=c+c,d=e+e,h=f+f,c=c*k,g=e*k,e=e*d,n=f*k,l=f*d,f=f*h,k=b*k,d=b*d;b*=h;a[0]=1-e-f;a[1]=g+b;a[2]=n-d;a[3]=0;a[4]=g-b;a[5]=1-c-f;a[6]=l+k;a[7]=0;a[8]=n+d;a[9]=l-k;a[10]=1-c-e;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.frustum=function(a,b,c,e,f,k,d){var h=1/(c-b),p=1/(f-e),g=1/(k-d);a[0]=2*k*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*k*p;a[6]=0;a[7]=0;a[8]=(c+b)*h;a[9]=(f+e)*p;a[10]=
(d+k)*g;a[11]=-1;a[12]=0;a[13]=0;a[14]=d*k*2*g;a[15]=0;return a};d.perspective=function(a,b,c,e,f){b=1/Math.tan(b/2);var k=void 0;a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=f&&Infinity!==f?(k=1/(e-f),a[10]=(f+e)*k,a[14]=2*f*e*k):(a[10]=-1,a[14]=-2*e);return a};d.perspectiveFromFieldOfView=function(a,b,c,e){var f=Math.tan(b.upDegrees*Math.PI/180),k=Math.tan(b.downDegrees*Math.PI/180),d=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*
Math.PI/180);var h=2/(d+b),g=2/(f+k);a[0]=h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=g;a[6]=0;a[7]=0;a[8]=-((d-b)*h*.5);a[9]=(f-k)*g*.5;a[10]=e/(c-e);a[11]=-1;a[12]=0;a[13]=0;a[14]=e*c/(c-e);a[15]=0;return a};d.ortho=function(a,b,c,e,f,k,d){var h=1/(b-c),g=1/(e-f),p=1/(k-d);a[0]=-2*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*g;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*p;a[11]=0;a[12]=(b+c)*h;a[13]=(f+e)*g;a[14]=(d+k)*p;a[15]=1;return a};d.lookAt=function(a,b,c,e){var d=void 0,k=void 0,h=void 0,g=void 0,l=void 0,m=void 0,
r=void 0,q=void 0,Q=void 0,t=void 0,N=b[0],v=b[1];b=b[2];h=e[0];g=e[1];e=e[2];r=c[0];q=c[1];c=c[2];if(Math.abs(N-r)<f.EPSILON&&Math.abs(v-q)<f.EPSILON&&Math.abs(b-c)<f.EPSILON)return n(a);r=N-r;q=v-q;Q=b-c;t=1/Math.sqrt(r*r+q*q+Q*Q);r*=t;q*=t;Q*=t;d=g*Q-e*q;k=e*r-h*Q;h=h*q-g*r;(t=Math.sqrt(d*d+k*k+h*h))?(t=1/t,d*=t,k*=t,h*=t):h=k=d=0;g=q*h-Q*k;l=Q*d-r*h;m=r*k-q*d;(t=Math.sqrt(g*g+l*l+m*m))?(t=1/t,g*=t,l*=t,m*=t):m=l=g=0;a[0]=d;a[1]=g;a[2]=r;a[3]=0;a[4]=k;a[5]=l;a[6]=q;a[7]=0;a[8]=h;a[9]=m;a[10]=Q;
a[11]=0;a[12]=-(d*N+k*v+h*b);a[13]=-(g*N+l*v+m*b);a[14]=-(r*N+q*v+Q*b);a[15]=1;return a};d.targetTo=function(a,b,c,e){var f=b[0],d=b[1];b=b[2];var h=e[0],g=e[1],n=e[2];e=f-c[0];var l=d-c[1];c=b-c[2];var m=e*e+l*l+c*c;0<m&&(m=1/Math.sqrt(m),e*=m,l*=m,c*=m);var r=g*c-n*l,n=n*e-h*c,h=h*l-g*e,m=r*r+n*n+h*h;0<m&&(m=1/Math.sqrt(m),r*=m,n*=m,h*=m);a[0]=r;a[1]=n;a[2]=h;a[3]=0;a[4]=l*h-c*n;a[5]=c*r-e*h;a[6]=e*n-l*r;a[7]=0;a[8]=e;a[9]=l;a[10]=c;a[11]=0;a[12]=f;a[13]=d;a[14]=b;a[15]=1;return a};d.str=function(a){return"mat4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};d.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};d.add=function(a,b,
c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];a[9]=b[9]+c[9];a[10]=b[10]+c[10];a[11]=b[11]+c[11];a[12]=b[12]+c[12];a[13]=b[13]+c[13];a[14]=b[14]+c[14];a[15]=b[15]+c[15];return a};d.subtract=g;d.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12]*c;a[13]=b[13]*c;a[14]=b[14]*
c;a[15]=b[15]*c;return a};d.multiplyScalarAndAdd=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;a[2]=b[2]+c[2]*e;a[3]=b[3]+c[3]*e;a[4]=b[4]+c[4]*e;a[5]=b[5]+c[5]*e;a[6]=b[6]+c[6]*e;a[7]=b[7]+c[7]*e;a[8]=b[8]+c[8]*e;a[9]=b[9]+c[9]*e;a[10]=b[10]+c[10]*e;a[11]=b[11]+c[11]*e;a[12]=b[12]+c[12]*e;a[13]=b[13]+c[13]*e;a[14]=b[14]+c[14]*e;a[15]=b[15]+c[15]*e;return a};d.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&
a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};d.equals=function(a,b){var c=a[0],e=a[1],d=a[2],k=a[3],h=a[4],g=a[5],n=a[6],l=a[7],m=a[8],r=a[9],q=a[10],t=a[11],N=a[12],v=a[13],E=a[14];a=a[15];var M=b[0],z=b[1],A=b[2],y=b[3],B=b[4],J=b[5],F=b[6],G=b[7],I=b[8],H=b[9],L=b[10],O=b[11],K=b[12],X=b[13],P=b[14];b=b[15];return Math.abs(c-M)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(e-z)<=f.EPSILON*Math.max(1,Math.abs(e),Math.abs(z))&&
Math.abs(d-A)<=f.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(k-y)<=f.EPSILON*Math.max(1,Math.abs(k),Math.abs(y))&&Math.abs(h-B)<=f.EPSILON*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(g-J)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(J))&&Math.abs(n-F)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(F))&&Math.abs(l-G)<=f.EPSILON*Math.max(1,Math.abs(l),Math.abs(G))&&Math.abs(m-I)<=f.EPSILON*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(r-H)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(H))&&Math.abs(q-
L)<=f.EPSILON*Math.max(1,Math.abs(q),Math.abs(L))&&Math.abs(t-O)<=f.EPSILON*Math.max(1,Math.abs(t),Math.abs(O))&&Math.abs(N-K)<=f.EPSILON*Math.max(1,Math.abs(N),Math.abs(K))&&Math.abs(v-X)<=f.EPSILON*Math.max(1,Math.abs(v),Math.abs(X))&&Math.abs(E-P)<=f.EPSILON*Math.max(1,Math.abs(E),Math.abs(P))&&Math.abs(a-b)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};d.mul=h;d.sub=g})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/mathUtils ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./projectionUtils".split(" "),
function(q,d,m,f,n,h,l,g){function r(a,b,c,e){var f,k;a instanceof l&&b instanceof l&&(c=b.longitude,e=b.latitude,k=a.latitude,f=a.longitude);a=m.deg2rad(k);e=m.deg2rad(e);f=m.deg2rad(f);b=m.deg2rad(c);c=Math.sin((a-e)/2);f=Math.sin((f-b)/2);c=2*m.asinClamped(Math.sqrt(c*c+Math.cos(a)*Math.cos(e)*f*f))*d.earthRadius;return Math.round(1E4*c)/1E4}function a(a,b,c){a=c/d.earthRadius;b=m.deg2rad(b);a=Math.sin(a/2);b=Math.cos(b);b=2*m.asinClamped(Math.sqrt(a*a/(b*b)));return m.rad2deg(b)}function b(a,
b,c){return m.rad2deg(c/d.earthRadius)}function c(a,b){a/=15;b||(a=Math.round(a));return a}Object.defineProperty(d,"__esModule",{value:!0});d.earthRadius=f.wgs84Radius;d.halfEarthRadius=d.earthRadius/2;d.halfEarthCircumference=Math.PI*d.earthRadius;d.earthCircumference=2*d.halfEarthCircumference;d.metersPerDegree=d.halfEarthCircumference/180;d.getGreatCircleDistance=r;d.getGreatCircleSpanAt=function(a,b,c){var e=b.spatialReference,f=new l(b.x,a.y,e),d=new l(c.x,a.y,e);b=new l(a.x,b.y,e);a=new l(a.x,
c.y,e);return{lon:r(f,d),lat:r(b,a)}};d.getLonDeltaForDistance=a;d.getLatDeltaForDistance=b;d.getLatLonDeltaForDistance=function(c,e,f){return{lat:b(c,e,f),lon:a(c,e,f)}};d.getMaxCameraAltitude=function(a){a=m.deg2rad(a/2);return(1-Math.sin(a))*d.earthRadius/Math.sin(a)};d.getViewExtentDistance=function(a,b){b=m.deg2rad(b/2);return 2*m.acosClamped((Math.pow(a+d.earthRadius,2)+Math.pow(d.earthRadius,2)-Math.pow((a+d.earthRadius)*Math.cos(b)-Math.sqrt(Math.pow(Math.cos(b)*(a+d.earthRadius),2)-a*a-2*
a*d.earthRadius),2))/(2*(a+d.earthRadius)*d.earthRadius))*d.earthRadius};d.computeCartesianDistance=function(a,b){a=g.wgs84ComparableLonLatToECEF(e,a.longitude,a.latitude,a.z||0);b=g.wgs84ComparableLonLatToECEF(D,b.longitude,b.latitude,b.z||0);b=[b[0]-a[0],b[1]-a[1],b[2]-a[2]];return Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])};d.longitudeToTimezone=c;d.positionToTimezone=function(a,b){b||(b={hours:0,minutes:0,seconds:0});b.hours=c(a[0],!0);a=b.hours%1;b.hours-=a;b.minutes=60*a;a=b.minutes%1;b.minutes-=
a;b.seconds=Math.round(60*a);return b};d.distanceToIdealHorizon=function(a,b){b=b||d.earthRadius;a=n.vec3.dot(a,a);return Math.sqrt(Math.abs(a-b*b))};var e=h.vec3f64.create(),D=h.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(q,d){Object.defineProperty(d,"__esModule",{value:!0});(function(d){d.length=function(f,d){var h=f[d],n=f[d+1];f=f[d+2];return Math.sqrt(h*h+n*n+f*f)};d.normalize=function(f,d){var h=f[d],l=f[d+1],g=f[d+2],
h=1/Math.sqrt(h*h+l*l+g*g);f[d]*=h;f[d+1]*=h;f[d+2]*=h};d.scale=function(f,d,h){f[d]*=h;f[d+1]*=h;f[d+2]*=h};d.add=function(f,d,h,l,g,m){void 0===m&&(m=d);g=g||f;g[m]=f[d]+h[l];g[m+1]=f[d+1]+h[l+1];g[m+2]=f[d+2]+h[l+2]};d.subtract=function(f,d,h,l,g,m){void 0===m&&(m=d);g=g||f;g[m]=f[d]-h[l];g[m+1]=f[d+1]-h[l+1];g[m+2]=f[d+2]-h[l+2]}})(d.Vec3Compact||(d.Vec3Compact={}))})},"esri/views/support/spatialReferenceSupport":function(){define(["require","exports"],function(q,d){Object.defineProperty(d,"__esModule",
{value:!0});d.isSpatialReferenceSupported=function(d,f){return null==d?!1:"2d"===f?!0:"local"===f?!d.isGeographic:d.isWebMercator||d.isWGS84||4490===d.wkid}})},"esri/webdoc/support/thumbnailUtils":function(){define(["require","exports"],function(q,d){Object.defineProperty(d,"__esModule",{value:!0});var m={width:600,height:400};d.getOptimalThumbnailSize=function(f,d){d=d||m;var h=d.width;d=d.height;var l=h/d;1.5>l?d=h/1.5:1.5<l&&(h=1.5*d);h>f.width&&(d*=f.width/h,h=f.width);d>f.height&&(h*=f.height/
d,d=f.height);return{width:Math.round(h),height:Math.round(d)}}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),function(q,d,m,f,n,h,l){return function(d){function g(a){a=d.call(this,a)||this;a.viewing=null;return a}m(g,d);a=g;g.prototype.clone=function(){return new a({viewing:this.viewing?this.viewing.clone():
null})};var a;f([h.property({type:l,json:{write:!0}})],g.prototype,"viewing",void 0);return g=a=f([h.subclass("esri.webscene.ApplicationProperties")],g)}(h.declared(n.JSONSupport))})},"esri/webdoc/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),function(q,d,m,f,n,h,l,g){return function(d){function a(a){a=d.call(this,
a)||this;a.search=null;return a}m(a,d);b=a;a.prototype.clone=function(){return new b(h.clone({search:this.search}))};var b;f([l.property({type:g,json:{write:!0}})],a.prototype,"search",void 0);return a=b=f([l.subclass("esri.webdoc.applicationProperties.Viewing")],a)}(l.declared(n.JSONSupport))})},"esri/webdoc/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(q,d,m,f,n,h,l,g,r){var a=n.ofType(r);return function(b){function c(c){c=b.call(this,c)||this;c.addressSearchEnabled=!0;c.enabled=!0;c.hintText=null;c.layers=new a;return c}m(c,b);e=c;c.prototype.readAddressSearchEnabled=function(a,b){return!a};c.prototype.writeAddressSearchEnabled=function(a,b,c){b[c]=!a};c.prototype.clone=function(){return new e(l.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var e;f([g.property({type:Boolean,
json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"addressSearchEnabled",void 0);f([g.reader("addressSearchEnabled")],c.prototype,"readAddressSearchEnabled",null);f([g.writer("addressSearchEnabled")],c.prototype,"writeAddressSearchEnabled",null);f([g.property({type:Boolean,json:{write:!0,default:!0}})],c.prototype,"enabled",void 0);f([g.property({type:String,json:{write:!0}})],c.prototype,"hintText",void 0);
f([g.property({type:a,json:{write:{enabled:!0,isRequired:!0}}})],c.prototype,"layers",void 0);return c=e=f([g.subclass("esri.webdoc.applicationProperties.Search")],c)}(g.declared(h.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),
function(q,d,m,f,n,h,l,g,r){return function(a){function b(b){b=a.call(this,b)||this;b.field=null;b.id=null;b.subLayer=null;return b}m(b,a);c=b;b.prototype.clone=function(){return new c(h.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var c;f([l.property({type:r,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"field",void 0);f([l.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"id",void 0);f([l.property({type:g.Integer,json:{write:!0}})],b.prototype,
"subLayer",void 0);return b=c=f([l.subclass("esri.webdoc.applicationProperties.SearchLayer")],b)}(l.declared(n.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(q,d,m,f,n,h,l){return function(d){function g(a){a=d.call(this,a)||this;a.exactMatch=!1;a.name=
null;a.type=null;return a}m(g,d);a=g;g.prototype.clone=function(){return new a({exactMatch:this.exactMatch,type:this.type,name:this.name})};var a;f([h.property({type:Boolean,json:{write:!0}})],g.prototype,"exactMatch",void 0);f([h.property({type:String,json:{write:!0}})],g.prototype,"name",void 0);f([h.enumeration.serializable()(l.kebabDict)],g.prototype,"type",void 0);return g=a=f([h.subclass("esri.webdoc.applicationProperties.SearchLayerField")],g)}(h.declared(n.JSONSupport))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(q,d,m,f,n,h,l,g,r){var a=function(a,c,e){return{enabled:!e||!e.isPresentation}};return function(b){function c(a){a=b.call(this,a)||this;a.lighting=new g;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}m(c,b);e=c;c.prototype.clone=function(){return new e(this.cloneConstructProperties())};c.prototype.cloneConstructProperties=function(){return{lighting:g.prototype.clone.call(this.lighting),background:h.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var e;f([l.property({type:g,json:{write:!0}})],c.prototype,"lighting",void 0);f([l.property(r.backgroundProperty)],c.prototype,"background",void 0);f([l.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],c.prototype,"atmosphereEnabled",void 0);f([l.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],c.prototype,"starsEnabled",void 0);return c=e=f([l.subclass("esri.webscene.Environment")],c)}(l.declared(n.JSONSupport))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(q,d,m,f,n,h){return function(d){function g(a){a=d.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}m(g,d);l=g;g.prototype.readDate=function(a,b){return null!=b.datetime&&new Date(b.datetime)||null};g.prototype.writeDate=function(a,b,c){b[c]=a.getTime()};g.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};g.prototype.writedirectShadowsEnabled=function(a,b,c){a&&(b[c]=a)};g.prototype.writeDisplayUTCOffset=function(a,b){null!=
a&&(b.displayUTCOffset=a)};g.prototype.clone=function(){return new l(this.cloneConstructProperties())};g.prototype.cloneConstructProperties=function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var l;f([h.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],g.prototype,"date",void 0);f([h.reader("date",["datetime"])],g.prototype,"readDate",
null);f([h.writer("date")],g.prototype,"writeDate",null);f([h.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],g.prototype,"directShadowsEnabled",void 0);f([h.reader("directShadowsEnabled",["directShadows"])],g.prototype,"readDirectShadowsEnabled",null);f([h.writer("directShadowsEnabled")],g.prototype,"writedirectShadowsEnabled",null);f([h.property({type:Number,json:{write:!0}})],g.prototype,"displayUTCOffset",void 0);f([h.writer("displayUTCOffset")],g.prototype,"writeDisplayUTCOffset",
null);return g=l=f([h.subclass("esri.webscene.Lighting")],g)}(h.declared(n.JSONSupport))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(q,d,m,f){Object.defineProperty(d,"__esModule",{value:!0});q={base:m,key:"type",typeMap:{color:f}};d.backgroundProperty={types:q,json:{read:function(d){return function(f,l,g){if(!f)return f;for(var h in d.typeMap)if(f.type===h)return l=new d.typeMap[h],l.read(f,g),l}}(q),write:{overridePolicy:function(d,
f,l){return{enabled:!l||!l.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,d,m,f,n,h,l,g){var r=h.strict()({color:"color"});return function(a){function b(b){return a.call(this)||this}m(b,a);b.prototype.normalizeCtorArgs=function(a){a&&a.type&&
(a=n({},a),delete a.type);return a};b.prototype.clone=function(){};f([g.property({type:r.apiValues,readOnly:!0,json:{type:r.jsonValues,read:!1,write:r.write}})],b.prototype,"type",void 0);return b=f([g.subclass("esri.webscene.background.Background")],b)}(g.declared(l.JSONSupport))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(q,d,m,f,n,h,l,g,r){var a=n({},g.colorAndTransparencyProperty,{nonNullable:!0});return function(b){function c(a){a=b.call(this)||this;a.type="color";a.color=new h([0,0,0,1]);return a}m(c,b);e=c;c.prototype.clone=function(){return new e(this.cloneProperties())};c.prototype.cloneProperties=function(){return{color:this.color.clone()}};var e;f([l.enumeration.serializable()({color:"color"})],c.prototype,"type",void 0);f([l.property(a)],c.prototype,"color",void 0);return c=e=f([l.subclass("esri.webscene.background.ColorBackground")],
c)}(l.declared(r))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(q,d,m,f,n,h,l,g,r){return function(a){function b(b){b=a.call(this,b)||this;b.environment=new r;b.spatialReference=null;b.viewpoint=null;return b}m(b,a);c=b;Object.defineProperty(b.prototype,"viewingMode",{set:function(a){this._set("viewingMode",
a)},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new c({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var c;f([l.property({type:r,json:{write:{isRequired:!0}}})],b.prototype,"environment",void 0);f([l.property({type:g})],b.prototype,"spatialReference",void 0);f([l.property({type:["local","global"]})],b.prototype,"viewingMode",
null);f([l.property({type:n,json:{write:{isRequired:!0}}})],b.prototype,"viewpoint",void 0);return b=c=f([l.subclass("esri.webscene.InitialViewProperties")],b)}(l.declared(h))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(q,d,m,f,n,h,l,g,r){var a=n.ofType(r);return function(b){function c(c){c=
b.call(this,c)||this;c.slides=new a;return c}m(c,b);Object.defineProperty(c.prototype,"slides",{set:function(b){b&&(b=b.filter(function(a){return!!a.viewpoint}));this._set("slides",h.referenceSetter(b,this._get("slides"),a))},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};f([g.property({type:a,nonNullable:!0,json:{write:!0}}),g.cast(h.castForReferenceSetter)],c.prototype,"slides",null);return c=f([g.subclass("esri.webscene.Presentation")],
c)}(g.declared(l.JSONSupport))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(q,d,m,f,n,h,l,g,r,a,b,c,e,D,k,p,T,x,U,W,Y,Q,t,N,v,E,M,z,A){function y(a){if("building-scene"===a.type||"map-image"===a.type)return a.allSublayers}function B(a){if(a=y(a))return a.filter(function(a){return a.visible}).map(function(a){return a.id}).toArray()}function J(a,b){a=b-a;a>L&&(a-=H);a<-L&&(a+=H);return a}var F=0,G=b.ofType(z.default),I=D.getLogger("esri.webscene.Slide"),H=86400,L=43200;return function(d){function e(a){a=d.call(this,a)||this;a._applyToController=null;a.id=Date.now().toString(16)+
"-slide-"+F++;a.title=new A.default;a.description=new E.default;a.thumbnail=new t.default;a.viewpoint=null;a.basemap=null;a.ground=null;a.environment=new N;a.visibleLayers=new G;return a}f(e,d);e.prototype.castTitle=function(a){return"string"===typeof a?new A.default({text:a}):T.ensureType(A.default,a)};e.prototype.castDescription=function(a){return"string"===typeof a?new E.default({text:a}):T.ensureType(E.default,a)};e.prototype.castThumbnail=function(a){return"string"===typeof a?new t.default({url:a}):
T.ensureType(t.default,a)};e.prototype.castBasemap=function(a){return Y.ensureType(a)};Object.defineProperty(e.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",c.referenceSetter(a,this._get("visibleLayers"),G))},enumerable:!0,configurable:!0});e.prototype.castVisibleLayers=function(a){return a&&"function"===typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a instanceof W){var b=B(a);return{id:a.id,sublayerIds:b}}if(a.id)return{id:a.id,sublayerIds:a.sublayerIds};
I.warn('Invalid visible layer, expected { id }, Layer or "id"');return a}):null};e.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||
null})};e.prototype._updateVisibleLayersFrom=function(a){var b=this,c=[];return k.eachAlways(this._allLayers(a.map).map(function(b){return a.whenLayerView(b).then(function(a){if(a.visible){var e=B(b);c.push(new z.default({id:a.layer.id,sublayerIds:e}))}})}).toArray()).then(function(){b.visibleLayers.removeAll();b.visibleLayers.addMany(c)})};e.prototype.updateFrom=function(a,b){var c=this;b={screenshot:m({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},b&&b.screenshot)};return a.when(function(){c.viewpoint=
a.viewpoint.clone();c.environment.lighting=v.prototype.clone.apply(a.environment.lighting);c.basemap=a.map.basemap&&a.map.basemap.clone()||null;c.ground=a.map.ground?M.default.fromGround(a.map.ground):null;return c._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(b.screenshot)}).then(function(a){c.thumbnail=new t.default({url:a.dataUrl});return c})};e.prototype.applyTo=function(a,b){return l(this,void 0,void 0,function(){var c,e,d;return h(this,function(f){this._applyToController&&
this._applyToController.abort();this._applyToController=c=k.createAbortController();k.onAbortOrThrow(b,function(){return c.abort()});e=m({animate:!0},b,{signal:this._applyToController.signal});d=k.createDeferred(function(){c.abort()});this._applyTo(a,e,c).then(d.resolve,d.reject);return[2,d.promise]})})};e.prototype._applyTo=function(b,c,e){return l(this,void 0,void 0,function(){var d,f=this;return h(this,function(g){switch(g.label){case 0:return[4,a.result(function(){return l(f,void 0,void 0,function(){return h(this,
function(a){switch(a.label){case 0:return[4,this._applyBasemap(b,c)];case 1:return a.sent(),this._applyLayerVisibility(b),this._applyGround(b),[4,this._applyViewpoint(b,c)];case 2:return a.sent(),[2]}})})}())];case 1:d=g.sent();this._applyToController===e&&(this._applyToController=null);if(!1===d.ok)throw d.error;return[2,this]}})})};e.prototype._applyBasemap=function(a,b){return l(this,void 0,void 0,function(){var c;return h(this,function(e){switch(e.label){case 0:if(!this.basemap)return[3,5];e.label=
1;case 1:return e.trys.push([1,3,,4]),[4,this.basemap.load(b)];case 2:return e.sent(),[3,4];case 3:c=e.sent();if(k.isAbortError(c))throw c;return[3,4];case 4:a.map.basemap=Y.clonePreservingTiledLayers(this.basemap,a.map.basemap),e.label=5;case 5:return[2]}})})};e.prototype._applyGround=function(a){this.ground&&(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground))};e.prototype._allLayers=function(a){var c=new b;this._collectLayers(a,c);this._collectLayers(a.ground,c);return c};e.prototype._collectLayers=
function(a,b){var c=this;a.layers.forEach(function(a){b.add(a);a.layers&&c._collectLayers(a,b)})};e.prototype._applyLayerVisibility=function(a){var b=this;this.visibleLayers&&this._allLayers(a.map).forEach(function(a){var c=b.visibleLayers.find(function(b){return b.id===a.id});a.visible=null!=c;var e=c&&c.sublayerIds,c=y(a);e&&c&&c.forEach(function(a){return a.visible=0<=e.indexOf(a.id)})})};e.prototype._applyViewpoint=function(a,b){return l(this,void 0,void 0,function(){return h(this,function(c){switch(c.label){case 0:if(!this.viewpoint||
b.ignoreViewpoint)return[3,5];this.viewpoint.camera.fov=a.camera.fov;return b.animate?this.get("environment.lighting.date")?[4,this._animateToLighting(a,b)]:[3,2]:[3,4];case 1:return c.sent(),[2];case 2:return a.environment.lighting=this.environment.lighting.clone(),[4,a.goTo(this.viewpoint,b)];case 3:c.sent(),c.label=4;case 4:return a.viewpoint=this.viewpoint,a.environment.lighting=this.environment.lighting.clone(),[3,6];case 5:a.environment.lighting=this.environment.lighting.clone(),c.label=6;case 6:return[2]}})})};
e.prototype._animateToLighting=function(a,b){return l(this,void 0,void 0,function(){var c,e,d,f=this;return h(this,function(h){c=null;"global"===a.viewingMode&&(c=this._animateLightingWithCamera(a));a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);e=a.goTo(this.viewpoint,b);e.then(function(){a.environment.lighting=
f.environment.lighting.clone()});d=function(){c&&c.remove();a.environment.lighting.cameraTrackingEnabled=!0};e.catch(function(a){d();throw a;}).then(d);return[2,e]})})};e.prototype._getTime=function(a){var b=a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[b,a]};e.prototype._setTime=function(a,b,c){a.setTime(b);a.setUTCHours(c/3600);a.setUTCMinutes(c%3600/60);a.setUTCSeconds(c%3600%60);return a};e.prototype._animateLightingWithCamera=function(a){var b=this,c=this._getTime(new Date(a.environment.lighting.date.toString())),
e=c[0],d=c[1],c=this._getTime(this.environment.lighting.date),f=c[0],h=J(d,c[1]),g=a.renderCoordsHelper,C=U.vec3f64.create();g.toRenderCoords(a.camera.position,C);var k=U.vec3f64.create();g.toRenderCoords(this.viewpoint.camera.position,k);var l=U.vec3f64.create(),n=new Date;return a.watch("camera",function(c){g.toRenderCoords(c.position,l);var w=x.vec3.squaredDistance(C,l),m=x.vec3.squaredDistance(k,l);c=0;0!==w+m&&(c=w/(w+m));w=e+(f-e)*c;c=Q.moduloPositive(d+h*c,H);a.environment.lighting.date=b._setTime(n,
w,c)})};e.createFrom=function(a,b){return(new this).updateFrom(a,b)};n([p.property({type:String,json:{write:{isRequired:!0}}})],e.prototype,"id",void 0);n([p.property({type:A.default,json:{default:function(){return new A.default({text:""})},write:{isRequired:!0}}})],e.prototype,"title",void 0);n([p.cast("title")],e.prototype,"castTitle",null);n([p.property({type:E.default,json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],e.prototype,"description",void 0);n([p.cast("description")],
e.prototype,"castDescription",null);n([p.property({type:t.default,json:{default:function(){return new t.default({url:""})},write:{isRequired:!0}}})],e.prototype,"thumbnail",void 0);n([p.cast("thumbnail")],e.prototype,"castThumbnail",null);n([p.property({type:r,nonNullable:!0,json:{write:{isRequired:!0}}})],e.prototype,"viewpoint",void 0);n([p.property({type:g,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],e.prototype,"basemap",void 0);n([p.cast("basemap")],e.prototype,"castBasemap",null);
n([p.property({type:M.default,json:{write:!0}})],e.prototype,"ground",void 0);n([p.property({type:G,json:{write:{isRequired:!0}}})],e.prototype,"visibleLayers",null);n([p.cast("visibleLayers")],e.prototype,"castVisibleLayers",null);n([p.property({type:N,json:{write:!0}})],e.prototype,"environment",void 0);return e=n([p.subclass("esri.webscene.Slide")],e)}(p.declared(e.JSONSupport))})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(q,d,m,f,n,h){Object.defineProperty(d,"__esModule",{value:!0});q=function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a.url="";return a}m(g,d);l=g;g.prototype.clone=function(){return new l({url:this.url})};var l;f([h.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"url",void 0);return g=l=f([h.subclass("esri.webdoc.support.Thumbnail")],g)}(h.declared(n.JSONSupport));d.default=q})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(q,d,m,f,n,h){Object.defineProperty(d,"__esModule",{value:!0});q=function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a.text="";return a}m(g,d);l=g;g.prototype.clone=function(){return new l({text:this.text})};var l;f([h.property({type:String,json:{write:!0}})],g.prototype,"text",void 0);return g=l=f([h.subclass("esri.webscene.support.Description")],g)}(h.declared(n.JSONSupport));d.default=q})},"esri/webscene/support/SlideGround":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../webdoc/support/opacityUtils".split(" "),
function(q,d,m,f,n,h,l,g,r){Object.defineProperty(d,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.opacity=null;return b}m(b,a);c=b;b.prototype.clone=function(){return new c({opacity:this.opacity})};b.prototype.cloneAndApplyTo=function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new n;a.opacity=this.opacity;return a};b.fromGround=function(a){return new c({opacity:a.opacity})};var c;f([l.property({type:Number,json:{type:g.Integer,read:{reader:r.transparencyToOpacity,
source:"transparency"},write:{writer:function(a,b){b.transparency=r.opacityToTransparency(a)},target:"transparency"}}})],b.prototype,"opacity",void 0);return b=c=f([l.subclass("esri.webscene.support.SlideGround")],b)}(l.declared(h.JSONSupport));d.default=q})},"esri/webscene/support/SlideVisibleLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(q,d,m,f,n,h,l,g){Object.defineProperty(d,"__esModule",{value:!0});q=function(d){function a(a){a=d.call(this)||this;a.id="";a.sublayerIds=null;return a}m(a,d);b=a;a.prototype.clone=function(){return new b({id:this.id,sublayerIds:h.clone(this.sublayerIds)})};var b;f([l.property({type:String,json:{write:!0}})],a.prototype,"id",void 0);f([l.property({type:[g.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],a.prototype,"sublayerIds",void 0);return a=b=f([l.subclass("esri.webscene.support.SlideVisibleLayer")],
a)}(l.declared(n.JSONSupport));d.SlideVisibleLayer=q;d.default=q})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,d,m,f,n,h){Object.defineProperty(d,"__esModule",{value:!0});q=function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a.text="";return a}m(g,d);l=g;g.prototype.clone=function(){return new l({text:this.text})};
var l;f([h.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"text",void 0);return g=l=f([h.subclass("esri.webscene.support.Title")],g)}(h.declared(n.JSONSupport));d.default=q})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(q,d,m,f){Object.defineProperty(d,"__esModule",{value:!0});q=function(d){function f(f,g){return d.call(this,f,g,"webscene")||this}m(f,d);Object.defineProperty(f.prototype,"supportsGround",
{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return f}(f.Version);d.Version=q;d.default=q})},"esri/core/Version":function(){define(["require","exports","./Error"],function(q,d,m){Object.defineProperty(d,"__esModule",{value:!0});q=function(){function d(d,f,l){void 0===l&&(l="");this.major=d;this.minor=f;this._context=l}d.prototype.lessThan=
function(d,f){return this.major<d||d===this.major&&this.minor<f};d.prototype.since=function(d,f){return!this.lessThan(d,f)};d.prototype.validate=function(d){if(this.major!==d.major)throw new m((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:d});};d.prototype.clone=function(){return new d(this.major,this.minor,this._context)};d.parse=function(f,h){void 0===
h&&(h="");var l=f.split("."),g=l[0],l=l[1],n=/^\s*\d+\s*$/;if(!g||!g.match||!g.match(n))throw new m((h&&h+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:f});if(!l||!l.match||!l.match(n))throw new m((h&&h+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:f});f=parseInt(g,10);g=parseInt(l,10);return new d(f,g,h)};return d}();d.Version=q})},"*noref":1}});
define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./core/tsSupport/assignHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./kernel ./Map ./Viewpoint ./core/asyncUtils ./core/Collection ./core/Error ./core/Handles ./core/has ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./views/3d/support/projectionUtils ./views/support/spatialReferenceSupport ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/Version".split(" "),function(q,
d,m,f,n,h,l,g,r,a,b,c,e,D,k,p,T,x,U,W,Y,Q,t,N,v,E,M,z,A,y,B,J,F,G,I,H,L,O,K,X,P,V,Z){var u=Y.getLogger("esri.WebScene"),S=new Z.default(1,17);return function(a){function d(b){b=a.call(this)||this;b._handles=new k;b.applicationProperties=null;b.clippingArea=null;b.clippingEnabled=!1;b.heightModelInfo=null;b.sourceVersion=null;b.supportsHeightModelInfo=!0;b.presentation=new V;b.initialViewProperties=new P;b.portalItem=null;b.resourceInfo=null;b.authoringApp=null;b.authoringAppVersion=null;b._isAuthoringAppSetByUser=
!1;b._isAuthoringAppVersionSetByUser=!1;return b}m(d,a);d.prototype.initialize=function(){var a=this;this.when().catch(function(a){u.error("#load()","Failed to load web scene",a)});if(this.resourceInfo){var b=void 0;try{b=this._validateJSON(this.resourceInfo)}catch(R){this.addResolvingPromise(t.reject(R));return}this.read(b);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",function(){return a._scheduleLayersIdGC()}))};
d.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy()};d.prototype.writeClippingArea=function(a,b){b.clippingArea||(b.clippingArea={});b.clippingArea.geometry=a.toJSON()};d.prototype.readClippingEnabled=function(a,b){return b.clippingArea?!!b.clippingArea.clip:!1};d.prototype.writeClippingEnabled=function(a,b){this.clippingArea&&(b.clippingArea||(b.clippingArea={}),b.clippingArea.clip=a)};d.prototype.writeLayers=function(a,b,c,d){var e=this,f=h({},d,{layerContainerType:"operational-layers"});
a=a.map(function(a){return e.verifyWriteLayer(a,d)?a.write(null,f):null}).filter(function(a){return!!a});b[c]=a.toArray()};d.prototype.verifyWriteLayer=function(a,b){return"write"in a?!0:(b&&b.messages&&b.messages.push(new D("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)};d.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];return new Z.default(parseInt(a[0],10),parseInt(b,10))};d.prototype.writeSourceVersion=
function(a,b,c){b[c]=S.major+"."+S.minor};Object.defineProperty(d.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):this._clearOverride("thumbnailUrl")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},enumerable:!0,configurable:!0});d.prototype.writeAuthoringApp=function(a,b){b.authoringApp=
a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(d.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});d.prototype.writeAuthoringAppVersion=function(a,b){b.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:r.version};d.prototype.writeGround=function(a,b,c,d){b[c]=a?a.write(null,d):{transparency:0,layers:[]}};d.prototype.readInitialViewProperties=
function(a,c){a={};c.initialState&&c.initialState.environment&&(a.environment=X.fromJSON(c.initialState.environment));a.spatialReference=c.spatialReference?y.fromJSON(c.spatialReference):y.WebMercator;a.viewingMode=c.viewingMode||"global";c.initialState&&c.initialState.viewpoint&&(a.viewpoint=b.fromJSON(c.initialState.viewpoint));return new P(a)};d.prototype.writeInitialViewProperties=function(a,b,c,d){a&&(c={},a.environment&&(c.environment=a.environment.write({},d)),a.viewpoint&&(c.viewpoint=a.viewpoint.write({},
d)),0!==Object.keys(c).length&&(b.initialState=c),b.spatialReference=a.spatialReference?a.spatialReference.write({},d):y.WebMercator.toJSON(),b.viewingMode=null!=a.viewingMode?a.viewingMode:"global")};d.prototype.load=function(a){this.addResolvingPromise(this._loadFromSource());return this.when()};d.prototype.loadAll=function(){var a=this;return c.safeCast(W.default(this,function(b){var c=a.presentation&&a.presentation.slides;b(a.ground,a.basemap,a.layers,c&&c.map(function(a){return a.basemap}))}))};
d.prototype.read=function(a,b){var c=this;b=h({},b,{origin:"web-scene"});var d=this._isAuthoringAppVersionSetByUser,e=this._isAuthoringAppSetByUser,f=arguments;M.readLoadable(this,a,function(b){return c.inherited(f,[a,b])},b);e||(this._isAuthoringAppSetByUser=!1);d||(this._isAuthoringAppVersionSetByUser=!1);if(a.baseMap&&Array.isArray(a.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var d=a.baseMap.elevationLayers.map(function(a){return{id:a.id}}),g=this.presentation.slides,
k=function(a,b){return a.visibleLayers.some(function(a){return a.id===b})},l=d.filter(function(a){return!g.some(function(b){return k(b,a.id)})});g.forEach(function(a){a.visibleLayers.addMany(l)})}};d.prototype._writeBasemapElevationLayers=function(a){var b=a.ground&&a.ground.layers;!a.baseMap&&b&&b.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=x.clone(b))};d.prototype.write=function(a,b){if("loaded"!==this.loadStatus){var c=new D("webscene:not-loaded",
"Web scene must be loaded before it can be serialized");u.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw c;}this._runLayersIdGC();b=h({},b,{origin:"web-scene"});c=this.inherited(arguments,[a,b]);this._writeBasemapElevationLayers(c);return c};d.prototype.save=function(a){return g(this,void 0,void 0,function(){var b,c,d;return l(this,function(e){switch(e.label){case 0:if(this.portalItem)return[3,2];u.error("save(): requires the .portalItem property to be set");
return[4,t.reject(new D("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:e.sent(),e.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,t.reject(new D("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:e.sent(),e.label=4;case 4:return b=this._updateFromPromise,[4,this.load()];case 5:return e.sent(),[4,this._loadObjectsWithLayers()];case 6:return e.sent(),c=this._enableVerifyItemRelativeUrls({origin:"web-scene",
url:this.portalItem.itemUrl&&N.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||F.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),d=this.write(null,c),[4,this._verifySave(d,c,a)];case 7:return e.sent(),this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:d})];case 8:return e.sent(),E.updateOrigins(c),b?[4,b]:[3,10];case 9:e.sent(),e.label=10;case 10:return[4,this._saveThumbnail()];case 11:return e.sent(),[2,this.portalItem]}})})};d.prototype.saveAs=
function(a,b){return g(this,void 0,void 0,function(){var c,d,e,f,g;return l(this,function(h){switch(h.label){case 0:if(a)return[3,2];u.error("saveAs(portalItem): requires a portal item parameter");return[4,t.reject(new D("webscene:portal-item-required","saveAs requires a portal item to save to"))];case 1:h.sent(),h.label=2;case 2:return a.id&&(a=a.clone(),a.id=null),c=a.portal||F.getDefault(),[4,this.load()];case 3:return h.sent(),[4,this._loadObjectsWithLayers()];case 4:return h.sent(),d=this._enableVerifyItemRelativeUrls({origin:"web-scene",
url:null,messages:[],portal:c,writtenProperties:[],blockedRelativeUrls:[]}),e=this.write(null,d),[4,this._verifySaveAs(e,d,b)];case 5:return h.sent(),[4,c._signIn()];case 6:return h.sent(),f=this.thumbnailUrl,g=!this._isOverridden("thumbnailUrl"),a.type="Web Scene",a.portal=c,this._updateTypeKeywords(a),[4,c.user.addItem({item:a,folder:b&&b.folder,data:e})];case 7:return h.sent(),this.portalItem=a,T.JSONSupport.prototype.read.call(this,{version:e.version,authoringApp:e.authoringApp,authoringAppVersion:e.authoringAppVersion},
{name:"web-scene",ignoreDefaults:!0,url:a.itemUrl&&N.urlToObject(a.itemUrl)}),E.updateOrigins(d),f&&(this.thumbnailUrl=g?N.addQueryParameter(f,"w","8192"):f),[4,this._saveThumbnail()];case 8:return h.sent(),[2,a]}})})};d.prototype._saveThumbnail=function(){return g(this,void 0,void 0,function(){return l(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),
a.label=2;case 2:return[2]}})})};d.prototype._verifySave=function(a,b,c,d){void 0===d&&(d=!1);var e=b.messages.filter(function(a){return"error"===a.type}).map(function(a){return new D(a.name,a.message,a.details)});b.blockedRelativeUrls&&(e=e.concat(b.blockedRelativeUrls.map(function(a){return new D("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));c&&c.ignoreUnsupported&&(e=e.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==
a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name}));c&&c.strictSchemaValidationEnabled||(e=e.filter(function(a){return"web-document-write:property-required"!==a.name}));var f=c&&c.strictSchemaValidationEnabled;return(f?t.create(function(a){return q(["./webscene/validator"],a)}).then(function(b){b=b.validate(a);if(0<b.length){var c="webscene did not validate:\n"+b.join("\n");u.error((d?"saveAs":"save")+"(): "+c)}return b.map(function(a){return new D("webscene:schema-validation",
a)})}).then(function(a){return f&&0<a.length?(a=I.createSchemaValidationError(a.concat(e)),t.reject(a)):e}):t.resolve(e)).then(function(a){if(0<a.length)return t.reject(new D("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a}))})};d.prototype._verifySaveAs=function(a,b,c){return this.canSaveAs(b)?t.reject(I.createCopyError()):this._verifySave(a,b,c,!0)};d.prototype.verifySaveAs=function(a){var b=this._enableVerifyItemRelativeUrls({origin:"web-scene",
messages:[]}),c=this.write(null,b);return this._verifySaveAs(c,b,a)};d.prototype.canSaveAs=function(a){a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};d.prototype.updateFrom=function(a,b){void 0===b&&(b={});return g(this,void 0,void 0,function(){var c,d;return l(this,function(e){switch(e.label){case 0:return this._updateFromPromise=c=this._updateFromInternal(a,b),[4,c];case 1:e.sent();
if(d=this._updateFromPromise===c)this._updateFromPromise=null;return[2]}})})};d.prototype._updateFromInternal=function(a,b){void 0===b&&(b={});return g(this,void 0,void 0,function(){return l(this,function(c){switch(c.label){case 0:return[4,a.whenReady()];case 1:return c.sent(),!b.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=X.prototype.clone.apply(a.environment)),!b.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=
a.spatialReference.clone(),this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=a.visible}),!1===b.thumbnailExcluded||null==b.thumbnailExcluded&&!b.viewpointExcluded?[4,this._updateFromThumbnail(a,b.thumbnailSize||void 0)]:[3,
3];case 2:c.sent(),c.label=3;case 3:return[2]}})})};d.prototype._updateFromThumbnail=function(a,b){return g(this,void 0,void 0,function(){var c,d;return l(this,function(e){switch(e.label){case 0:return c=O.getOptimalThumbnailSize(a,b),[4,a.takeScreenshot({format:"jpg",width:c.width,height:c.height,disableSlice:!0})];case 1:return d=e.sent(),this.thumbnailUrl=d.dataUrl,[2]}})})};d.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):
this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};d.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a);this.read(a,b);return this._loadFromJSON(a,b)};d.prototype._extractOperationalLayers=function(a){var b=this,c=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var d=0,e=a.baseMap.elevationLayers;d<e.length;d++)c.push(e[d]);var f=[],g=function(a){a.layers&&(a.layers=a.layers.filter(g));
return"ArcGISTiledElevationServiceLayer"===a.layerType?(b.sourceVersion.supportsGround||f.push(a),!1):!0};return{operationalLayers:a.operationalLayers?a.operationalLayers.filter(g):[],operationalElevationLayers:f,basemapElevationLayers:c}};d.prototype._loadFromJSON=function(a,b){var d=this,f=new e;return this._validateSpatialReference().then(function(){return d._validateHeightModelInfo()}).then(function(){return t.create(function(a){return q(["./portal/support/layersCreator"],a)})}).then(function(e){var g=
d._extractOperationalLayers(a),k=g.operationalLayers,l=g.operationalElevationLayers,g=g.basemapElevationLayers,m=[],n={context:h({},b,{layerContainerType:"operational-layers"})};d.portalItem&&(n.context.portal=d.portalItem.portal||F.getDefault());if(0<g.length){var p=h({},n,{context:h({},n.context,{layerContainerType:"ground"})});p.defaultLayerType="ArcGISTiledElevationServiceLayer";m.push(c.safeCast(e.populateOperationalLayers(d.ground.layers,g,p)))}0<l.length&&(p=h({},n,{context:h({},n.context,
{layerContainerType:"ground"})}),p.defaultLayerType="ArcGISTiledElevationServiceLayer",m.push(c.safeCast(e.populateOperationalLayers(f,l,p))));k&&0<k.length&&m.push(c.safeCast(e.populateOperationalLayers(d.layers,k,n)));return t.eachAlways(m).then(function(){})}).then(function(){return d._loadObjectsWithLayers()}).then(function(){d.ground.layers.addMany(f)})};d.prototype._loadObjectsWithLayers=function(){var a=[];this.ground&&a.push(this.ground.load());this.basemap&&a.push(this.basemap.load());this.presentation.slides.forEach(function(b){b.basemap&&
a.push(b.basemap.load())});return t.eachAlways(a).then(function(){})};d.prototype._loadFromItem=function(a){var b=this;return a.load().catch(function(a){throw new D("webscene:load-portal-item","Failed to load portal item",{error:a});}).then(function(){if("Web Scene"!==a.type)throw new D("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(c){b.resourceInfo=c;return b._readAndLoadFromJSON(c,
{origin:"web-scene",url:N.urlToObject(a.itemUrl),portal:a.portal||F.getDefault()})})};d.prototype._validateSpatialReference=function(){var a=this.initialViewProperties,b=this._sceneSpatialReference,c;if("local"!==a.viewingMode){if(!L.isSpatialReferenceSupported(b,"global"))return t.reject(new D("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:b,viewingMode:a.viewingMode}));
c=function(a){return!a||H.canProject(a,b)}}else{if(!L.isSpatialReferenceSupported(b,"local"))return t.reject(new D("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||a.equals(b)}}var d=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},
e=d(a.viewpoint);return e&&!c(e)?t.reject(new D("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode})):(e=this.presentation.slides.find(function(a){return!c(d(a.viewpoint))}))?(e=d(e.viewpoint),t.reject(new D("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode}))):t.resolve()};d.prototype._validateHeightModelInfo=function(){var a=B.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return a?t.reject(a):t.resolve()};d.prototype._validateJSON=function(a){var b=Z.default.parse(a.version||"","webscene");S.validate(b);a.version=b.major+"."+b.minor;1===b.major&&2>=b.minor&&(a.spatialReference=y.WebMercator.toJSON());return a};d.prototype._updateTypeKeywords=function(a){"local"===
this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}))};Object.defineProperty(d.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||
y.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_verifyItemRelativeRootPath",{get:function(){return this.portalItem&&this.portalItem.itemUrl?N.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});d.prototype._enableVerifyItemRelativeUrls=function(a){var b=this._verifyItemRelativeRootPath;b&&(a.verifyItemRelativeUrls={rootPath:b,writtenUrls:[]});return a};d.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),
this._layersIdGCTimeoutId=0)};d.prototype._scheduleLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};d.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var b=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,c=function(b){return!!a.allLayers.find(function(a){return a.id===b})};b&&b.layers&&(b.layers=b.layers.filter(function(a){return c(a.id)}));
(b=this.presentation&&this.presentation.slides)&&b.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return c(a.id)}))})};d.fromJSON=function(a){if(!a)throw new D("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};d.VERSION=S;f([v.property({type:K,json:{write:!0}})],d.prototype,"applicationProperties",void 0);f([v.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],d.prototype,"basemap",void 0);
f([v.property({type:z,json:{read:{source:"clippingArea.geometry",reader:J.fromJSON},write:{target:"clippingArea.geometry"}}})],d.prototype,"clippingArea",void 0);f([v.writer("clippingArea")],d.prototype,"writeClippingArea",null);f([v.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],d.prototype,"clippingEnabled",void 0);f([v.reader("clippingEnabled",["clippingArea"])],d.prototype,"readClippingEnabled",null);f([v.writer("clippingEnabled")],d.prototype,"writeClippingEnabled",null);
f([v.property({type:A,json:{write:!0}})],d.prototype,"heightModelInfo",void 0);f([v.property({json:{write:{target:"operationalLayers"}}})],d.prototype,"layers",void 0);f([v.writer("layers")],d.prototype,"writeLayers",null);f([v.property({readOnly:!0,type:Z.default,json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],d.prototype,"sourceVersion",void 0);f([v.reader("sourceVersion",["version"])],d.prototype,"readSourceVersion",null);f([v.writer("sourceVersion")],d.prototype,"writeSourceVersion",
null);f([v.property({dependsOn:["portalItem.thumbnailUrl"]})],d.prototype,"thumbnailUrl",null);f([v.property({type:String,json:{write:{allowNull:!0}}})],d.prototype,"authoringApp",null);f([v.writer("authoringApp")],d.prototype,"writeAuthoringApp",null);f([v.property({type:String,json:{write:{allowNull:!0}}})],d.prototype,"authoringAppVersion",null);f([v.writer("authoringAppVersion")],d.prototype,"writeAuthoringAppVersion",null);f([v.property({json:{write:{isRequired:!0,allowNull:!0,enabled:!0}}})],
d.prototype,"ground",void 0);f([v.writer("ground")],d.prototype,"writeGround",null);f([v.property({type:V,nonNullable:!0,json:{write:function(a,b,c,d){a.slides&&0<a.slides.length&&(c=h({},d,{isPresentation:!0}),b.presentation=a.write(null,c))}}})],d.prototype,"presentation",void 0);f([v.property({type:P,nonNullable:!0,json:{default:function(){return new P({viewingMode:"global",spatialReference:y.WebMercator})}}})],d.prototype,"initialViewProperties",void 0);f([v.reader("initialViewProperties",["initialState.environment",
"spatialReference","viewingMode","initialState.viewpoint"])],d.prototype,"readInitialViewProperties",null);f([v.writer("initialViewProperties",{"initialState.environment":{type:X},spatialReference:{type:y},viewingMode:{type:String},"initialState.viewpoint":{type:b}})],d.prototype,"writeInitialViewProperties",null);f([v.property({type:G})],d.prototype,"portalItem",void 0);f([v.property()],d.prototype,"resourceInfo",void 0);f([n(0,v.cast(G))],d.prototype,"saveAs",null);f([v.property()],d.prototype,
"_sceneSpatialReference",null);f([v.property()],d.prototype,"_verifyItemRelativeRootPath",null);return d=f([v.subclass("esri.WebScene")],d)}(v.declared(U.LoadableMixin(Q.EsriPromiseMixin(T.JSONSupportMixin(a)))))});