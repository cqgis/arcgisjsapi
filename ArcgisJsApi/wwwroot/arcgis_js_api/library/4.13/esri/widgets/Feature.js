// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Graphic ../../intl ../../core/asyncUtils ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/throttle ../../core/watchUtils ../../core/accessorSupport/decorators ../../intl/date ../../intl/number ../../layers/support/fieldUtils ../../popup/content/TextContent ../../popup/content/support/ChartMediaInfoValueSeries ../../popup/support/FieldInfoFormat ../../tasks/support/AttachmentQuery ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(B,m,g,e,z,t,v,A,q,r,F,C,x,E,w,l,G,n,d,c,a,b,h,p,y,D,O,M){function P(){return v(this,void 0,void 0,function(){return t(this,function(a){return[2,w.create(function(a){B(["../../support/arcadeUtils"],function(f){a(f)})})]})})}function H(a){var b=/(\n)/gi;return"string"===typeof a?a.replace(b,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):a}function J(a,b){return a&&"function"===typeof a.getField?a.getField(b):null}function K(a){return a.replace(/[\u00A0-\u9999<>\&]/gim,function(a){return"\x26#"+
a.charCodeAt(0)+";"})}var Q=["$datastore","$map","$layer"],I=E.getLogger("esri.widgets.FeatureViewModel"),N=/^\s*expression\//i,L=d.convertDateFormatToIntlOptions("short-date-short-time");return function(d){function k(a){var f=d.call(this)||this;f._handles=new C;f._featureAbortController=null;f._graphicChangedThrottled=l.throttle(f._graphicChanged,1,f);f._effectivePopupTemplate=null;f._contentResponse=null;f._graphic=null;f.content=null;f.defaultPopupTemplateEnabled=!1;f.formattedAttributes=null;
f.graphic=null;f.lastEditInfo=null;f.title="";f.view=null;f._handles.add(G.init(f,"graphic graphic.sourceLayer.popupTemplate.title graphic.sourceLayer.popupTemplate.content graphic.sourceLayer.popupTemplate.fieldInfos graphic.sourceLayer.popupTemplate.lastEditInfoEnabled graphic.popupTemplate.title graphic.popupTemplate.content graphic.popupTemplate.fieldInfos graphic.popupTemplate.lastEditInfoEnabled".split(" "),function(){return f._graphicChangedThrottled()}));return f}g(k,d);k.prototype.destroy=
function(){this._clear();this._cancelFeatureQuery();this._handles.destroy();this._graphic=this.graphic=this._handles=null};Object.defineProperty(k.prototype,"spatialReference",{get:function(){return this.get("view.spatialReference")||null},set:function(a){void 0===a?this._clearOverride("spatialReference"):this._override("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"map",{get:function(){return this.get("view.map")||null},set:function(a){void 0===a?this._clearOverride("map"):
this._override("map",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"waitingForContent",{get:function(){return!!this._featureAbortController},enumerable:!0,configurable:!0});k.prototype._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};k.prototype._graphicChanged=function(){return v(this,void 0,void 0,function(){var a,u,b,h;return t(this,function(f){switch(f.label){case 0:this._cancelFeatureQuery();this._clear();this._graphic=
u=(a=this.graphic)?a.clone():null;if(!u)return[2];this._featureAbortController=b=w.createAbortController();f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this._queryFeature({signal:b.signal})];case 2:return f.sent(),[3,4];case 3:return h=f.sent(),I.error("error","error loading template",h),[3,4];case 4:return this._featureAbortController=null,[2]}})})};k.prototype._cancelFeatureQuery=function(){var a=this._featureAbortController;a&&a.abort();this._featureAbortController=null};k.prototype._compileContent=
function(a,u){var f=this;if(a&&(a.nodeName||a&&M.isWidgetBase(a)||M.isWidget(a)))return a;if(this._graphic){if("string"===typeof a)return this._compileText(new b({text:a})).text;if(Array.isArray(a))return a.map(function(a,b){b=(b=u&&u[b])&&b.value;if("attachments"===a.type)return f._compileAttachments(a,b);if("fields"===a.type)return f._compileFields(a);if("media"===a.type)return f._compileMedia(a);if("text"===a.type)return f._compileText(a)});a&&I.warn("invalid content type.")}};k.prototype._compileFields=
function(a){var f=this,b=this._effectivePopupTemplate;a=x.clone(a);var h=b&&b.expressionInfos,b=a.fieldInfos?void 0:b&&b.fieldInfos,b=a.fieldInfos||x.clone(b),c=[];b&&b.forEach(function(a){var b=a.fieldName.toLowerCase();if(!a.hasOwnProperty("visible")||a.visible)b=f._isExpressionField(b)?f._getExpressionInfo(h,b):null,a.label=b?b.title:a.label,c.push(a)});a.fieldInfos=c;return a};k.prototype._setImageValue=function(a){var f=a.value,b=a.formattedAttributes;a=a.layer;var h=f.linkURL,c=f.sourceURL;
c&&(c=this._fixTokens(c,a),f.sourceURL=this._substituteAttributes(b,c));h&&(a=this._fixTokens(h,a),f.linkURL=this._substituteAttributes(b,a))};k.prototype._compileMedia=function(a){var f=this,b=this._graphic;a=x.clone(a);var h=a.mediaInfos,c=b.attributes,d=D.getSourceLayer(b),p=this.formattedAttributes.global;a.mediaInfos=h&&h.map(function(a){if(a=x.clone(a)){var b=a.title?f._processFieldsInLinks(a.title,c):"",u=a.caption?f._processFieldsInLinks(a.caption,c):"";a.title=b?f._substituteAttributes(p,
b):"";a.caption=u?f._substituteAttributes(p,u):"";if("image"===a.type)return b=a.value,f._setImageValue({value:b,formattedAttributes:p,layer:d}),a.value.sourceURL?a:void 0;if("pie-chart"===a.type||"line-chart"===a.type||"column-chart"===a.type||"bar-chart"===a.type)return b=a.value,f._setChartValue({value:b,attributes:c,formattedAttributes:p,layer:d}),a}}).filter(Boolean);return a};k.prototype._substituteAttributes=function(a,b){return(""+this._removeEmptyHref(q.substitute(b,a))).trim()};k.prototype._compileText=
function(a){if((a=x.clone(a))&&a.text){var f=this.formattedAttributes.global,b=this._processFieldsInLinks(a.text,this._graphic.attributes);a.text=this._substituteAttributes(f,b)}return a};k.prototype._formatEditInfo=function(a,b){var f=a.creatorField,u=a.creationDateField,c=a.editorField;if(b){a=b[a.editDateField];if("number"===typeof a)return b=b[c],f=q.formatDate(a,L),{type:"edit",date:f,user:b};u=b[u];if("number"===typeof u)return b=b[f],f=q.formatDate(u,L),{type:"create",date:f,user:b}}};k.prototype._compileLastEditInfo=
function(){var a=this._effectivePopupTemplate,b=this._graphic;if(a){var a=a.lastEditInfoEnabled,c=b.get("sourceLayer.editFieldsInfo");if(a&&c)return this._formatEditInfo(c,b.attributes)}};k.prototype._compileTitle=function(){var a=this._effectivePopupTemplate,b=this._graphic,c=a&&a.title,h=b.attributes,a=this.formattedAttributes.global,b="function"===typeof c?c.call(null,{graphic:b}):c;return"string"===typeof b&&b?(b=this._processFieldsInLinks(b,h),this._substituteAttributes(a,b)):""};k.prototype._getExpressionInfo=
function(a,b){if(this._isExpressionField(b)){var f=b.replace(N,"").toLowerCase(),c;a.some(function(a){return a.name.toLowerCase()===f?(c=a,!0):!1});return c}};k.prototype._fixTokens=function(a,b){return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,f,c){return(a=J(b,c))?"{"+a.name+"}":f})};k.prototype._encodeAttributes=function(a){var b=a?x.clone(a):{};Object.keys(b).forEach(function(a){var f=b[a];"string"===typeof f&&(f=encodeURIComponent(f).replace(/\'/g,"\x26apos;"),b[a]=f)});return b};k.prototype._createfieldInfoMap=
function(a,b){var f=this,c=new Map;a&&a.forEach(function(a){var h=f._getFixedFieldName(a.fieldName,b);a.fieldName=h;c.set(h.toLowerCase(),a)});return c};k.prototype._formatAttributeValue=function(a){var b=a.value,f=a.fieldName,c=a.fieldInfos,h=a.fieldInfoMap;a=a.layer;if(null==b)return b;var d=this._getDomainName(f,b);return d||(d=this._getTypeName(f))?d:h.get(f.toLowerCase())?this._formatValueToFieldInfo(b,{fieldInfos:c,fieldName:f,layer:a}):(c=a&&a.fieldsIndex)&&c.isDateField(f)?q.formatDate(b,
L):H(b)};k.prototype._formatAttributes=function(a){var b=this,f=this._graphic,c=D.getSourceLayer(f),h=x.clone(f.attributes);this.addRelatedFeatureAttributes(h);var d=this._createfieldInfoMap(a,c);Object.keys(h).forEach(function(f){h[f]=b._formatAttributeValue({fieldName:f,fieldInfos:a,fieldInfoMap:d,layer:c,value:h[f]})});return h};k.prototype._formatValueToFieldInfo=function(a,b){var f=b.fieldName,h=this._getFieldInfo(b.fieldInfos,f),u=x.clone(h),h=b.preventPlacesFormatting;(b=J(b.layer,f))&&"date"===
b.type&&(b=u.format||new p,b.dateFormat=b.dateFormat||"short-date-short-time",u.format=b);u=u&&u.format;return"string"===typeof a||null==a||null==u?a:h?c.formatNumber(a,z({},c.convertNumberFormatToIntlOptions(u),{minimumFractionDigits:0,maximumFractionDigits:20})):u.format(a)};k.prototype._getDomainName=function(a,b){if(this.isRelatedField(a))return null;var f=this._graphic,c=D.getSourceLayer(f);return c&&"function"===typeof c.getFieldDomain?(a=c.getFieldDomain(a,{feature:f}))&&"coded-value"===a.type?
a.getName(b):null:null};k.prototype._getFieldInfo=function(a,b){if(a&&a.length&&b){var f=b.toLowerCase(),c=void 0;a.some(function(a){return a.fieldName&&a.fieldName.toLowerCase()===f?(c=a,!0):!1});return c}};k.prototype._getTypeName=function(a){if(this.isRelatedField(a))return null;var b=this._graphic,f=D.getSourceLayer(b);if(!f||"function"!==typeof f.getFeatureType)return null;var c=f.typeIdField;return c&&a===c?(a=f.getFeatureType(b))?a.name:null:null};k.prototype._removeEmptyHref=function(a){return a.replace(/href=(""|'')/gi,
"")};k.prototype._processFieldsInLinks=function(a,b){var f=this.get("_graphic.layer");a=this._fixTokens(a,f);var c=this._encodeAttributes(b),f=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;return a?a.replace(f,function(a,f,h){f=(""+(f||h)).trim();return q.substitute(a,f&&"{"===f[0]?b:c)}):a};k.prototype._compileAttachments=function(a,b){a=x.clone(a);if(!b||b&&0===b.length)return a;a.attachmentInfos=b;return a};k.prototype._queryAttachments=function(){var a=this._graphic,b=D.getSourceLayer(a);if(!b)return w.resolve([]);
if((b="scene"===b.type&&b.associatedLayer?b.associatedLayer:b)&&"function"===typeof b.queryAttachments){var c=b.objectIdField,h=(a=a.attributes)&&a[c],a=new y({objectIds:[h],returnMetadata:!0});return b.queryAttachments(a).then(function(a){return a[h]||[]})}return w.resolve([])};k.prototype._queryContentElements=function(a){var b=this;if(!Array.isArray(a))return w.resolve();var f={};a.forEach(function(a,c){"attachments"===a.type&&(a=b._queryAttachments())&&(f[c]=a)});return Object.keys(f).length?
w.eachAlways(f):w.resolve()};k.prototype._getContent=function(){var a=this._effectivePopupTemplate,b=this._graphic,a=a&&a.content,b="function"===typeof a?a.call(null,{graphic:b}):a;return w.isThenable(b)?b:w.resolve(b)};k.prototype._querySourceLayer=function(a,b){var c=a.layer,f=a.outFields;a=a.objectIds;if("function"!==typeof c.queryFeatures||!a)return b=new F("query-required-fields","Could not query required fields for the specified layer. Some fields will not be available.",{outFields:f,objectIds:a}),
I.warn("query-required-fields","Could not query required fields for the specified layer. Some fields will not be available."),w.reject(b);var h=c.createQuery();h.objectIds=a;h.outFields=f;h.returnGeometry=!0;return c.queryFeatures(h,b).then(function(a){return a.features[0]})};k.prototype._queryRequiredFieldsFeature=function(b){var c=this,f=this._graphic,h=this._effectivePopupTemplate,d=f.sourceLayer;return d&&h?("function"===typeof d.load?d.load(b):w.resolve()).then(function(){var p=f.attributes[d.objectIdField],
u="number"===typeof p?[p]:void 0;return r.safeCast(h.getRequiredFields(d.fields)).then(function(h){return a.featureHasFields(h,f)?null:c._querySourceLayer({layer:d,outFields:h,objectIds:u},b)})}):w.resolve(null)};k.prototype._queryFeature=function(a){var b=this,c=this._featureAbortController,f=this._graphic;this._effectivePopupTemplate=f&&f.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled);return this._getContent().then(function(h){if(c===b._featureAbortController&&f){var d=b._checkForRelatedFeatures(h,
a),p=b._createFormattedExpressions().then(function(a){f.attributes=z({},f.attributes,a)}),e=b._queryContentElements(h).then(function(a){return b._contentResponse=a}),u=b._queryRequiredFieldsFeature(a).then(function(a){a&&(f.geometry=a.geometry,f.attributes=z({},f.attributes,a.attributes))});return w.eachAlways([d,p,e,u]).then(function(){if(c===b._featureAbortController&&f){b._set("formattedAttributes",b._createFormattedAttributes(h));b._set("title",b._compileTitle());var a=b._compileLastEditInfo();
b._set("lastEditInfo",a||null);a=b._compileContent(h,b._contentResponse);b._set("content",a||null);return a}})}})};k.prototype._isExpressionField=function(a){return N.test(a)};k.prototype._formatArcadeArray=function(a){return'\x3cul class\x3d"esri-widget__list"\x3e'+a.map(function(a){return"\x3cli\x3e"+("string"===typeof a?H(K(a)):a)+"\x3c/li\x3e"}).join("")+"\x3c/ul\x3e"};k.prototype._formatArcadeDictionary=function(a){return'\x3ctable class\x3d"esri-widget__table"\x3e'+a.keys().map(function(b){var c=
a.field(b),c="string"===typeof c?H(K(c)):c;return"\x3ctr\x3e\x3cth\x3e"+b+"\x3c/th\x3e\x3ctd\x3e"+c+"\x3c/td\x3e\x3c/tr\x3e"}).join("")+"\x3c/table\x3e"};k.prototype._createFormattedExpressions=function(){return v(this,void 0,void 0,function(){var a,b,c,h,d,p,e,k,l,y,D,g=this;return t(this,function(f){switch(f.label){case 0:return a=this,b=a._effectivePopupTemplate,c=a._graphic,h=b&&b.expressionInfos,d=[],p={},h&&h.length?[4,P()]:[2,p];case 1:e=f.sent();k=function(a){var b="expression/"+a.name,h=
e.createSyntaxTree(a.expression),f=Q.filter(function(a){return e.hasVariable(h,a)});a=e.loadScriptDependencies(h,!0,f).then(function(){return v(g,void 0,void 0,function(){var a,d,k,l,y=this;return t(this,function(u){a=this.spatialReference;d=e.getViewInfo({spatialReference:a});k=e.createExecContext(c,d);k.useAsync=!0;this._addVarsToContext(e,f,k,d);l=e.createFunction(h,k);return[2,e.executeAsyncFunction(l,k).then(function(a){p[b]="string"===typeof a?H(K(a)):Array.isArray(a)?y._formatArcadeArray(a):
a&&"esri.arcade.Dictionary"===a.declaredClass?y._formatArcadeDictionary(a):a},function(a){return I.error("arcade-execution-error",a)})]})})});d.push(a)};l=0;for(y=h;l<y.length;l++)D=y[l],k(D);return[2,w.eachAlways(d).then(function(){return p})]}})})};k.prototype._addVarsToContext=function(a,b,c,h){var f=this.graphic,d=this.map;b.forEach(function(b){b=b.toLowerCase();var p={map:d,spatialReference:h.sr};"$map"===b&&(c.vars[b]=a.convertMapToFeatureSetCollection(p));"$layer"===b&&(c.vars[b]=a.convertFeatureLayerToFeatureSet(f.sourceLayer,
h.sr));"$datastore"===b&&(c.vars[b]=a.convertServiceUrlToWorkspace(f.sourceLayer.url,h.sr))})};k.prototype._createFormattedAttributes=function(a){var b=this,c=this._effectivePopupTemplate,h={global:this._formatAttributes(c&&c.fieldInfos),content:[]};Array.isArray(a)&&a.forEach(function(a,c){"fields"===a.type&&a.fieldInfos&&(h.content[c]=b._formatAttributes(a.fieldInfos))});return h};k.prototype._getAllFieldInfos=function(a){var b=this._effectivePopupTemplate,c=[];(b=b&&b.fieldInfos)&&c.push.apply(c,
b);if(!a||!Array.isArray(a))return c;a.forEach(function(a){"fields"===a.type&&c.push.apply(c,a&&a.fieldInfos)});return c};k.prototype._checkForRelatedFeatures=function(a,b){var c=this._graphic;a=this._getAllFieldInfos(a);return this.queryRelatedInfos(c,a,b)};k.prototype._getChartOption=function(a){var b=a.value,c=a.attributes,f=a.formattedAttributes,d=a.fieldName,p=a.relatedFieldName,e=a.fieldInfos,k=a.index;a=D.getSourceLayer(this._graphic);var l=b.normalizeField,b=b.tooltipField,l=l?this.isRelatedField(l)?
c[this.getRelatedFieldInfo(l).fieldName]:c[l]:null,y=p&&void 0!==c[p]?c[p]:void 0!==c[d]?c[d]:f[d],y=void 0===y?null:y&&l?y/l:y,k=new h({x:k,y:y});if(this.isRelatedField(d))return f=this.getRelatedFieldInfo(d),d=(d=this.getRelatedFieldInfo(b))?d.fieldName:null,e=this._formatValueToFieldInfo(y,{fieldInfos:e,fieldName:p,layer:a,preventPlacesFormatting:!!l}),p=f?f.label||f.fieldName:p,k.tooltip=(d&&void 0!==c[d]?c[d]:p)+": "+e,k;c=this._getFieldInfo(e,d);p=this._getFixedFieldName(d,a);c=c?c.label||c.fieldName:
d;k.tooltip=(b&&void 0!==f[b]?f[b]:c)+": "+f[p];return k};k.prototype._getFixedFieldName=function(a,b){return(b=J(b,a))?b.name:a};k.prototype._getFixedFieldNames=function(a,b){var c=this;return a&&a.map(function(a){return c._getFixedFieldName(a,b)})};k.prototype._setChartValue=function(a){var b=this,c=a.value,h=a.attributes,f=a.formattedAttributes;a=a.layer;var d=this._effectivePopupTemplate,p=this.relatedInfoCount,e=c.fields,k=c.normalizeField;c.fields=this._getFixedFieldNames(e,a);k&&(c.normalizeField=
this._getFixedFieldName(k,a));if(e.some(function(a){return!!(null!=f[a]||b.isRelatedField(a)&&p)})){var l=d&&d.fieldInfos;e.forEach(function(a,d){b.isRelatedField(a)?c.series=c.series.concat(b._getRelatedChartInfos({fieldInfos:l,fieldName:a,formattedAttributes:f,value:c})):(a=b._getChartOption({value:c,index:d,attributes:h,formattedAttributes:f,fieldName:a,fieldInfos:l}),c.series.push(a))})}};k.prototype._getRelatedChartInfos=function(a){var b=this,c=a.fieldInfos,h=a.fieldName,f=a.formattedAttributes,
d=a.value,p=[];a=this.getRelatedFieldInfo(h);var e=a.fieldName,k=this.getRelatedInfo(a.layerId);if(!k)return p;a=k.relatedFeatures;k=k.relation;if(!k||!a)return p;k=k.cardinality;a.forEach(function(a,k){var l=a.attributes;l&&Object.keys(l).forEach(function(a){a===e&&p.push(b._getChartOption({value:d,index:k,attributes:l,formattedAttributes:f,fieldName:h,relatedFieldName:a,fieldInfos:c}))})});return"one-to-many"===k||"many-to-many"===k?p:[p[0]]};e([n.property()],k.prototype,"_featureAbortController",
void 0);e([n.property({readOnly:!0})],k.prototype,"content",void 0);e([n.property({type:Boolean})],k.prototype,"defaultPopupTemplateEnabled",void 0);e([n.property({readOnly:!0})],k.prototype,"formattedAttributes",void 0);e([n.property({type:A})],k.prototype,"graphic",void 0);e([n.property({readOnly:!0})],k.prototype,"lastEditInfo",void 0);e([n.property({dependsOn:["view"]})],k.prototype,"spatialReference",null);e([n.property({readOnly:!0})],k.prototype,"title",void 0);e([n.property({dependsOn:["view"]})],
k.prototype,"map",null);e([n.property({readOnly:!0,dependsOn:["_featureAbortController"]})],k.prototype,"waitingForContent",null);e([n.property()],k.prototype,"view",void 0);return k=e([n.subclass("esri.widgets.FeatureViewModel")],k)}(n.declared(O))})},"esri/core/throttle":function(){define(["require","exports"],function(B,m){function g(e,g,m,v){var A=null,q=1E3;"number"===typeof g?(q=g,v=m):(A=g,q=m);var r=0,t,C=function(){r=0;e.apply(v,t)};g=function(){for(var e=[],g=0;g<arguments.length;g++)e[g]=
arguments[g];A&&A.apply(v,e);t=e;q?r||(r=setTimeout(C,q)):C()};g.remove=function(){r&&(clearTimeout(r),r=0)};g.forceUpdate=function(){r&&(clearTimeout(r),C())};g.hasPendingUpdates=function(){return!!r};return g}Object.defineProperty(m,"__esModule",{value:!0});m.throttle=g;m.default=g})},"esri/widgets/Feature/support/featureUtils":function(){define(["require","exports"],function(B,m){Object.defineProperty(m,"__esModule",{value:!0});m.getSourceLayer=function(g){if(g)return g.get("sourceLayer")||g.get("layer")}})},
"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),function(B,m,g,e,z,t,v,A,q,r,F,C,x,E){var w=new Map,l=A.getLogger("esri.widgets.Popup.support.RelatedFeatures");
return function(m){function n(d){d=m.call(this)||this;d.relatedInfoCount=null;d.relatedInfos=new Map;return d}g(n,m);n.prototype.destroy=function(){this.relatedInfos.clear()};n.prototype.addRelatedFeatureAttributes=function(d){var c=this;this.relatedInfos.forEach(function(a){return c._addRelatedFeatureAttribute(d,a)})};n.prototype.getRelatedFieldInfo=function(d){if(-1===d.indexOf("relationships/"))return null;d=d.split("/").slice(1);return{layerId:d[0],fieldName:d[1]}};n.prototype.getRelatedInfo=
function(d){return this.relatedInfos.get(d.toString())};n.prototype.isRelatedField=function(d){void 0===d&&(d="");return d?-1!==d.indexOf("relationships/"):!1};n.prototype.queryRelatedInfos=function(d,c,a){var b=this;this.relatedInfos.clear();var h=E.getSourceLayer(d);if(!h)return q.resolve();var p=c.filter(function(a){return a&&b.isRelatedField(a.fieldName)});if(!p||!p.length)return q.resolve();this._createRelatedInfos(c,h);return this._queryLayerInfos(h,a).then(function(c){b._updateRelatedInfoLayerInfos(c);
return b._queryRelatedFeatureMap(d,a).then(function(a){Object.keys(a).forEach(function(c){b._setRelatedFeatures(a[c],c.toString())});return a})})};n.prototype._addRelatedFeatureAttribute=function(d,c){var a=this;d&&c&&(c.relatedFeatures&&c.relatedFeatures&&c.relatedFeatures.forEach(function(b){return a._addAttributesFromFeature(d,b,c)}),c.relatedStatsFeatures&&c.relatedStatsFeatures&&c.relatedStatsFeatures.forEach(function(b){return a._addAttributesFromFeature(d,b,c)}))};n.prototype._updateRelatedInfoLayerInfo=
function(d,c){if(d=d.value)this.getRelatedInfo(c).layerInfo=d.data};n.prototype._updateRelatedInfoLayerInfos=function(d){var c=this;Object.keys(d).forEach(function(a){return c._updateRelatedInfoLayerInfo(d[a],a.toString())})};n.prototype._addAttributesFromFeature=function(d,c,a){var b=this;d&&c&&a&&Object.keys(c.attributes).forEach(function(h){var p=b._relatedFieldInfoToString({layerId:a.relation.id.toString(),fieldName:h});d[p]=c.attributes[h]})};n.prototype._relatedFieldInfoToString=function(d){return d?
"relationships/"+d.layerId+"/"+d.fieldName:""};n.prototype._createRelatedInfoForFieldInfo=function(d,c){var a=this.getRelatedFieldInfo(d.fieldName);if(a){var b=a.layerId,a=a.fieldName;b&&(c=this.getRelatedInfo(b)||this._createRelatedInfo(b,c))&&(c.relatedFields.push(a),d.statisticType&&(d=new x({statisticType:d.statisticType,onStatisticField:a,outStatisticFieldName:a}),c.outStatistics.push(d)))}};n.prototype._createRelatedInfos=function(d,c){var a=this;d.forEach(function(b){return a._createRelatedInfoForFieldInfo(b,
c)})};n.prototype._queryRelatedFeatureMap=function(d,c){var a=this,b={};this.relatedInfos.forEach(function(h,p){h.layerInfo&&(b[p]=a._queryRelatedLayerFeatures(d,h,c))});return q.eachAlways(b)};n.prototype._queryLayerInfos=function(d,c){var a=this,b={};this.relatedInfos.forEach(function(h,p){h=h.relation;if(!h)return p=new v("relation-required","A relation is required on a layer to retrieve related records."),l.error(p),q.reject(p);h=h.relatedTableId;if(!h)return p=new v("A related table ID is required on a layer to retrieve related records."),
l.error(p),q.reject(p);h=d.url+"/"+h;var e=w.get(h),g=e?e:a._queryLayerInfo(h,c);e||w.set(h,g);b[p]=g});return q.eachAlways(b)};n.prototype._queryLayerInfo=function(d,c){return z(d,{query:{f:"json"},signal:c&&c.signal})};n.prototype._queryRelatedLayerFeatures=function(d,c,a){var b=E.getSourceLayer(d).layerId.toString(),h=c.layerInfo,p=c.queryTask,e=c.relation;if(b=this._getDestinationRelation(h,b)){var e=e.keyField,l=b.keyField,b="string"===this._getDestinationFieldType(h,b)?l+"\x3d'"+d.attributes[e]+
"'":l+"\x3d"+d.attributes[e];d=p.execute(new C({where:b,outFields:c.relatedFields}),a);c=c.outStatistics&&0<c.outStatistics.length&&h.supportsStatistics?p.execute(new C({where:b,outFields:c.relatedFields,outStatistics:c.outStatistics}),a):null;return q.eachAlways({features:d,statsFeatures:c?c:q.resolve()})}return q.resolve()};n.prototype._setRelatedFeatures=function(d,c){if(c=this.getRelatedInfo(c)){var a=d.value;a&&(d=a.features,a=a.statsFeatures,d=d&&d.value,c.relatedFeatures=d?d.features:[],d=
a&&a.value,c.relatedStatsFeatures=d?d.features:[])}};n.prototype._getRelation=function(d,c){if(!c.relationships)return null;var a=null;c.relationships.some(function(b){return b.id===parseInt(d,10)?(a=b,!0):!1});return a};n.prototype._createRelatedInfo=function(d,c){var a=this._getRelation(d,c);if(a){c=c.url+"/"+a.relatedTableId;var b=new F({url:c}),a={url:c,queryTask:b,relation:a,relatedFields:[],outStatistics:[]};this.relatedInfos.set(d,a);return a}};n.prototype._getDestinationRelation=function(d,
c){var a;d&&d.relationships&&d.relationships.some(function(b){return""+b.relatedTableId===c?(a=b,!0):!1});return a};n.prototype._getDestinationFieldType=function(d,c){var a=void 0;d.fields.some(function(b){return b.name===c.keyField?(a=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(b.type)?"number":"string",!0):!1});return a};e([r.aliasOf("relatedInfos.size")],n.prototype,"relatedInfoCount",void 0);e([r.property()],n.prototype,"relatedInfos",
void 0);return n=e([r.subclass("esri.widgets.Popup.support.RelatedFeatures")],n)}(r.declared(t))})},"esri/widgets/Feature/support/attachmentUtils":function(){define(["require","exports"],function(B,m){Object.defineProperty(m,"__esModule",{value:!0});var g=B.toUrl("../../../themes/base/images/files/");m.isSupportedImage=function(e){e=e.toLowerCase();return"image/bmp"===e||"image/emf"===e||"image/exif"===e||"image/gif"===e||"image/x-icon"===e||"image/jpeg"===e||"image/png"===e||"image/tiff"===e||"image/x-wmf"===
e};m.getIconPath=function(e){return e?"text/plain"===e?g+"text-32.svg":"application/pdf"===e?g+"pdf-32.svg":"text/csv"===e?g+"csv-32.svg":"application/gpx+xml"===e?g+"gpx-32.svg":"application/x-dwf"===e?g+"cad-32.svg":"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?g+"code-32.svg":"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===
e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?g+"zip-32.svg":-1!==e.indexOf("image/")?g+"image-32.svg":-1!==e.indexOf("audio/")?g+"sound-32.svg":-1!==e.indexOf("video/")?g+"video-32.svg":-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?g+"excel-32.svg":-1!==e.indexOf("msword")||-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?g+"word-32.svg":-1!==e.indexOf("powerpoint")||
-1!==e.indexOf("presentationml")?g+"report-32.svg":g+"generic-32.svg":g+"generic-32.svg"}})},"esri/widgets/support/chartUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper dojo/_base/kernel @dojo/framework/shim/Promise".split(" "),function(B,m,g,e,z){function t(){var e=z.locale;if(!e)return"en_US";var g;if(!(g=m.locales[e])){e=e.split("-")[0].toLowerCase();g=null;for(var v=0,A=Object.keys(m.locales);v<A.length;v++){var t=A[v];if(-1<t.indexOf(e)){g=
m.locales[t];break}}}return g||"en_US"}Object.defineProperty(m,"__esModule",{value:!0});m.locales={ar:"ar","bs-ba":"bs_BA","ca-es":"ca_ES","cs-cz":"cs_CZ","da-dk":"da_DK","de-ch":"de_CH","de-de":"de_DE","el-gr":"el_GR","en-ca":"en_CA","en-us":"en_US","es-es":"es_ES","et-ee":"et_EE","fi-fi":"fi_FI","fr-fr":"fr_FR","he-il":"he_IL","hi-in":"hi_IN","hr-hr":"hr_HR","hu-hu":"hu_HU","id-id":"id_ID","it-it":"it_IT","ja-jp":"ja_JP","ko-kr":"ko_KR","lt-lt":"lt_LT","lv-lv":"lv_LV","nb-no":"nb_NO","nl-nl":"nl_NL",
"pl-pl":"pl_PL","pt-br":"pt_BR","pt-pt":"pt_PT","ro-ro":"ro_RO","ru-ru":"ru_RU","sl-sl":"sl_SL","sr-rs":"sr_RS","sv-se":"sv_SE","th-th":"th_TH","tr-tr":"tr_TR","uk-ua":"uk_UA","vi-vn":"vi_VN","zh-cn":"zh_Hans","zh-hk":"zh_Hant","zh-tw":"zh_Hant"};m.getChartLocale=t;var v,A=null;m.loadChartsModule=function(q){void 0===q&&(q=t());return e(this,void 0,void 0,function(){var e,m,t,x,z;return g(this,function(g){switch(g.label){case 0:if(q===v)return[2,A];v=q;return[4,Promise.all([new Promise(function(e,
g){B(["../../libs/amcharts4/index"],e,g)}),new Promise(function(e,g){B(["../../libs/amcharts4/lang/"+q],e,g)})])];case 1:return e=g.sent(),m=e[0],t=e[1],x=m.am4core,q===v&&(x.options.defaultLocale=t.default),"function"===typeof Object.assign?[3,3]:[4,new Promise(function(e,g){B(["@dojo/framework/shim/object"],e,g)})];case 2:z=g.sent(),Object.defineProperty(Object,"assign",{value:z.assign,writable:!0,configurable:!0}),g.label=3;case 3:return A=m,[2,m]}})})}})},"esri/widgets/support/uriUtils":function(){define(["require",
"exports","dojo/i18n!./nls/uriUtils","../../core/string"],function(B,m,g,e){function z(e){var g=null;t.some(function(q){q.pattern.test(e)&&(g=q);return!!g});return g}Object.defineProperty(m,"__esModule",{value:!0});var t=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:g.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,
label:g.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:g.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:g.openInApp,appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:g.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:g.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",
pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:g.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:g.openInApp,appName:g.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:g.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:g.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:g.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,
label:g.openInApp,appName:"Microsoft Power Bi"}];m.autoLink=function(g){if("string"!==typeof g||!g)return g;var m=z(g);if(!m)return g;var q=g.match(m.pattern),q=e.replace(m.label,{appName:m.appName,hierPart:q&&q[2]});return g.replace(m.pattern,"\x3ca "+(m.target?'target\x3d"'+m.target+'"':"")+' href\x3d"$1" '+("_blank"===m.target?'rel\x3d"noreferrer"':"")+"\x3e"+q+"\x3c/a\x3e")}})},"*now":function(B){B(['dojo/i18n!*preload*esri/widgets/nls/Feature*["ar","bs","ca","cs","da","de","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/i18n!./Feature/nls/Feature ../intl ../core/events ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Feature/FeatureViewModel ./Feature/support/attachmentUtils ./support/chartUtils ./support/uriUtils ./support/widget ./support/widgetUtils".split(" "),function(B,m,g,e,z,t,v,A,q,r,F,C,x,E,w,l,G){var n={title:!0,content:!0,lastEditedInfo:!0};return function(d){function c(a){a=
d.call(this)||this;a._chartMap=new Map;a._activeMediaMap=new Map;a._refreshTimers=new Map;a._mediaInfo=new Map;a.graphic=null;a.defaultPopupTemplateEnabled=!1;a.spatialReference=null;a.title=null;a.visibleElements=z({},n);a.map=null;a.view=null;a.viewModel=new C;return a}g(c,d);c.prototype.postInitialize=function(){var a=this;this.own(q.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))};c.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();
this._activeMediaMap=null;this._destroyCharts()};c.prototype.castVisibleElements=function(a){return z({},n,a)};c.prototype.render=function(){var a=l.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},l.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})),b=this.visibleElements,c=this.viewModel,d=c.waitingForContent,c=c.title,c=b.title?l.tsx("h4",{class:"esri-feature__title",innerHTML:c}):null,b=b.content?l.tsx("div",
{class:"esri-feature__main-container"},[this._renderContent(),this._renderLastEditInfo()]):null;return l.tsx("div",{class:this.classes("esri-feature","esri-widget")},l.tsx("div",{class:"esri-feature__size-container"},c,d?a:b))};c.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};c.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};c.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};c.prototype._buildKey=function(a){for(var b=
[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];c=this.get("viewModel.graphic.uid")||"0";b=b.join("-");return a+"__"+c+"-"+b};c.prototype._destroyCharts=function(){this._chartMap.forEach(function(a){return a.dispose()});this._chartMap.clear()};c.prototype._renderContent=function(){var a=this.viewModel.content;return a?"string"===typeof a?l.tsx("div",{key:"content-string",innerHTML:a}):l.isWidget(a)?l.tsx("div",{key:"content-widget"},a.render()):a instanceof HTMLElement?l.tsx("div",{key:"content-html-element",
bind:a,afterCreate:this._attachToNode}):l.isWidgetBase(a)?l.tsx("div",{key:"content-dijit",bind:a.domNode,afterCreate:this._attachToNode}):Array.isArray(a)?a.length?l.tsx("div",{key:"content-content-elements"},a.map(this._renderContentElement,this)):null:null:null};c.prototype._renderContentElement=function(a,b){var c=this.visibleElements;if("boolean"!==typeof c.content&&!c.content[a.type])return null;switch(a.type){case "attachments":return this._renderAttachments(a,b);case "fields":return this._renderFields(a,
b);case "media":return this._renderMedia(a,b);case "text":return this._renderText(a,b);default:return null}};c.prototype._renderAttachmentInfo=function(a){var b,c,d=a.attachmentInfo,e=a.supportsResizeAttachments,g=d.contentType,m=d.orientationInfo,n=d.name,q=d.url;a="preview"===a.contentElement.displayType?128:48;var m=(m=m?[m.rotation?"rotate("+m.rotation+"deg)":"",m.mirrored?"scaleX(-1)":""].join(" "):"")?{transform:m}:{},r=e&&x.isSupportedImage(g),v=-1===q.indexOf("?")?"?":"\x26",g=r?""+q+v+"w\x3d"+
a:x.getIconPath(g);a=(b={},b["esri-feature__attachment-item-mask--icon"]=!r,b);b=(c={},c["esri-feature__attachments-image--resizable"]=e,c);return l.tsx("li",{class:"esri-feature__attachments-item",key:d},l.tsx("a",{class:"esri-feature__attachments-item-link",href:q,rel:"noreferrer",target:"_blank"},l.tsx("div",{class:this.classes(a,"esri-feature__attachment-item-mask")},l.tsx("img",{styles:m,alt:"",class:this.classes(b,"esri-feature__attachments-image"),src:g}),l.tsx("span",{class:"esri-feature__attachments-image-overlay"},
l.tsx("span",{"aria-hidden":"true",class:"esri-feature__attachments-link-icon esri-icon-link-external"}))),l.tsx("span",{class:"esri-feature__attachments-filename"},n||t.noTitle)))};c.prototype._renderAttachments=function(a,b){var c=this,d,e=a.displayType,g=(b=a.attachmentInfos)&&b.length,m=this.get("graphic.layer.capabilities.operations.supportsResizeAttachments"),e=(d={},d["esri-feature__attachments--list"]="preview"!==e,d["esri-feature__attachments--preview"]="preview"===e,d);return g?l.tsx("div",
{key:"attachments-element",class:this.classes("esri-feature__attachments","esri-feature__content-element",e)},l.tsx("div",{class:"esri-feature__attachments-title"},t.attach),l.tsx("ul",{class:"esri-feature__attachments-items"},b.map(function(b,h){return c._renderAttachmentInfo({attachmentInfo:b,attachmentInfoIndex:h,supportsResizeAttachments:m,contentElement:a})}))):null};c.prototype._forceLTR=function(a){return"\x26lrm;"+a};c.prototype._renderFieldInfo=function(a,b){var c,d=this.viewModel.formattedAttributes,
e=d?d.content[b]||d.global:null,g=a.fieldName,d=a.label||g,e=e?null==e[g]?"":e[g]:"";a=!(!a.format||!a.format.dateFormat);e="number"!==typeof e||a?w.autoLink(e):this._forceLTR(e);a=(c={},c["esri-feature__field-data--date"]=a,c);return l.tsx("tr",{key:this._buildKey("fields-element-info-row",b)},l.tsx("th",{key:this._buildKey("fields-element-info-row-header",b),class:"esri-feature__field-header",innerHTML:d}),l.tsx("td",{key:this._buildKey("fields-element-info-row-data",b),class:this.classes("esri-feature__field-data",
a),innerHTML:e}))};c.prototype._renderFields=function(a,b){var c=this;return(a=a.fieldInfos)?l.tsx("div",{key:this._buildKey("fields-element",b),class:this.classes("esri-feature__fields","esri-feature__content-element")},l.tsx("table",{class:"esri-widget__table",summary:t.fieldsSummary,key:this._buildKey("fields-element-table",b)},l.tsx("tbody",{key:this._buildKey("fields-element-table-body",b)},a.map(function(a){return c._renderFieldInfo(a,b)})))):null};c.prototype._shouldOpenInNewTab=function(a){void 0===
a&&(a="");if(a)return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};c.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};c.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};c.prototype._getImageSource=function(a,b){var c=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var d=a[1],d=void 0===d?"":d;return""+a[0]+c+"timestamp\x3d"+
b+(d?"#":"")+d};c.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var c=this._activeMediaMap.get(a);isNaN(c)&&(c=0);(b=b.mediaInfos[c])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}};c.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,c){return a._setupMediaRefreshTimer(c)})};c.prototype._updateMediaInfoTimestamp=
function(a,b){var c=Date.now();this._mediaInfo.set(b,{timestamp:c,sourceURL:this._getImageSource(a,c)});this.scheduleRender()};c.prototype._setRefreshTimeout=function(a,b){var c=this,d=b.refreshInterval,e=b.value;d&&(b=6E4*d,this._updateMediaInfoTimestamp(e.sourceURL,a),b=setInterval(function(){c._updateMediaInfoTimestamp(e.sourceURL,a)},b),this._refreshTimers.set(a,b))};c.prototype._renderMediaInfoType=function(a){var b=a.mediaInfo,c=a.contentElementIndex;a=a.activeMediaIndex;var d=b.title,d=void 0===
d?"":d;if("image"===b.type){var e=b.value,g=b.refreshInterval,m=e.sourceURL,b=e.linkURL,e=this._shouldOpenInNewTab(b)?"_blank":"_self",n="_blank"===e?"noreferrer":"",m=(g=g?this._mediaInfo.get(c):null)?g.sourceURL:m,c=l.tsx("img",{alt:d,key:this._buildKey("media-image",c,a,g?g.timestamp:0),src:m});return(a=b?l.tsx("a",{title:d,href:b,rel:n,target:e},c):null)?a:c}if(-1!==b.type.indexOf("chart"))return l.tsx("div",{key:this._buildKey("media-chart",c,a),bind:this,"data-media-info":b,"data-content-element-index":c,
class:"esri-feature__media-chart",afterCreate:this._getChartDependencies})};c.prototype._getChartDependencies=function(a){var b=this,c=a["data-media-info"],d=a["data-content-element-index"],e=c.value,g=c.type;E.loadChartsModule().then(function(c){b._renderChart({chartDiv:a,contentElementIndex:d,type:g,value:e,chartsModule:c})})};c.prototype._createPieChart=function(a){var b=a.chartsModule,c=b.am4charts;a=b.am4core.create(a.chartDiv,c.PieChart);a.rtl=G.isRTL();c=a.series.push(new c.PieSeries);c.labels.template.disabled=
!0;c.ticks.template.disabled=!0;c.dataFields.value="y";c.dataFields.category="x";c.tooltip.label.wrap=!0;c.tooltip.label.maxWidth=150;c.tooltip.label.rtl=a.rtl;return a};c.prototype._createXYChart=function(a){var b=a.type,c=a.value,d=a.chartsModule,e=d.am4core,d=d.am4charts;a=e.create(a.chartDiv,d.XYChart);a.rtl=G.isRTL();c=15<c.series.length;if("column-chart"===b){var g=a.xAxes.push(new d.CategoryAxis);g.dataFields.category="x";g.renderer.labels.template.disabled=!0;g.tooltip.label.wrap=!0;g.tooltip.label.maxWidth=
125;g.tooltip.label.rtl=a.rtl;g.tooltip.events.on("sizechanged",function(){g.tooltip.dy=-g.tooltip.contentHeight});a.yAxes.push(new d.ValueAxis);var l=a.series.push(new d.ColumnSeries);l.dataFields.valueY="y";l.dataFields.categoryX="x";a.cursor=new d.XYCursor;c&&(a.scrollbarX=new e.Scrollbar)}if("bar-chart"===b){var m=a.yAxes.push(new d.CategoryAxis);m.dataFields.category="x";m.renderer.inversed=!0;m.renderer.labels.template.disabled=!0;m.tooltip.label.wrap=!0;m.tooltip.label.maxWidth=125;m.tooltip.label.rtl=
a.rtl;m.tooltip.events.on("sizechanged",function(){m.tooltip.dx=m.tooltip.contentWidth});a.xAxes.push(new d.ValueAxis);l=a.series.push(new d.ColumnSeries);l.dataFields.valueX="y";l.dataFields.categoryY="x";a.cursor=new d.XYCursor;c&&(a.scrollbarY=new e.Scrollbar)}if("line-chart"===b){var n=a.xAxes.push(new d.CategoryAxis);n.dataFields.category="x";n.renderer.labels.template.disabled=!0;n.tooltip.label.wrap=!0;n.tooltip.label.maxWidth=125;n.tooltip.label.rtl=a.rtl;n.tooltip.events.on("sizechanged",
function(){n.tooltip.dy=-n.tooltip.contentHeight});a.yAxes.push(new d.ValueAxis);l=a.series.push(new d.LineSeries);l.dataFields.categoryX="x";l.dataFields.valueY="y";a.cursor=new d.XYCursor;c&&(a.scrollbarX=new e.Scrollbar)}return a};c.prototype._renderChart=function(a){var b=a.contentElementIndex,c=a.type,d=a.value,e=a.chartsModule;e.am4core.useTheme(e.am4themes_animated);a="pie-chart"===c?this._createPieChart(a):this._createXYChart(a);a.data=d.series.map(function(a){return{x:a.tooltip,y:a.y}});
this._chartMap.set(b,a)};c.prototype._renderMediaInfo=function(a){var b=a.mediaInfo,c=a.contentElementIndex;a=this._renderMediaInfoType({mediaInfo:b,contentElementIndex:c,activeMediaIndex:a.activeMediaIndex});var d=b.title?l.tsx("div",{key:this._buildKey("media-title",c),class:"esri-feature__media-item-title",innerHTML:b.title}):null,b=b.caption?l.tsx("div",{key:this._buildKey("media-caption",c),class:"esri-feature__media-item-caption",innerHTML:b.caption}):null;return l.tsx("div",{key:this._buildKey("media-container",
c),class:"esri-feature__media-item-container"},l.tsx("div",{key:this._buildKey("media-item-container",c),class:"esri-feature__media-item"},a),d,b)};c.prototype._renderMediaPageButton=function(a,b){var c=(a="previous"===a)?t.previous:t.next,d=a?this.classes("esri-feature__button","esri-feature__media-previous"):this.classes("esri-feature__button","esri-feature__media-next"),e=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon",
"esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),g=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),m=a?this._previousClick:this._nextClick;return l.tsx("div",{key:this._buildKey(a?"media-previous":"media-next",b),title:c,tabIndex:0,role:"button",class:d,"data-content-element-index":b,bind:this,onkeydown:m,onclick:m},
l.tsx("span",{"aria-hidden":"true",class:e}),l.tsx("span",{"aria-hidden":"true",class:g}),l.tsx("span",{class:"esri-icon-font-fallback-text"},c))};c.prototype._handleMediaKeyup=function(a){var b=a.currentTarget["data-content-element-index"],c=A.eventKey(a);"ArrowLeft"===c&&(a.stopPropagation(),this.previousMedia(b));"ArrowRight"===c&&(a.stopPropagation(),this.nextMedia(b))};c.prototype._renderMedia=function(a,b){var c,d=(a=a.mediaInfos)&&a.length||0,e=(c={},c["esri-feature--media-pagination-visible"]=
1<d,c);c=this._renderMediaPageButton("previous",b);var g=this._renderMediaPageButton("next",b),m=this._activeMediaMap.get(b);isNaN(m)&&(this._activeMediaMap.set(b,0),m=0);return d?l.tsx("div",{key:this._buildKey("media-element",b),"data-content-element-index":b,bind:this,onkeyup:this._handleMediaKeyup,class:this.classes("esri-feature__media","esri-feature__content-element",e)},l.tsx("div",{key:this._buildKey("media-element-container",b),class:"esri-feature__media-container"},c,this._renderMediaInfo({mediaInfo:a[m],
contentElementIndex:b,activeMediaIndex:m}),g)):null};c.prototype._renderLastEditInfo=function(){var a=this.visibleElements,b=this.viewModel.lastEditInfo;if(!b||!a.lastEditedInfo)return null;a=b.user;b=v.substitute("edit"===b.type?a?t.lastEditedByUser:t.lastEdited:a?t.lastCreatedByUser:t.lastCreated,{date:b.date,user:a});return l.tsx("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},b)};c.prototype._renderText=function(a,b){return a.text?
l.tsx("div",{key:this._buildKey("text-element",b),innerHTML:a.text,class:this.classes("esri-feature__text","esri-feature__content-element")}):null};c.prototype._attachToNode=function(a){a.appendChild(this)};c.prototype._setContentElementMedia=function(a,b){this._clearMediaRefreshTimer(a);var c=this.viewModel.content;(c=(c=c&&c[a])&&c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};c.prototype._pageContentElementMedia=
function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};c.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};c.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};e([r.aliasOf("viewModel.graphic")],c.prototype,"graphic",void 0);e([r.aliasOf("viewModel.defaultPopupTemplateEnabled")],c.prototype,"defaultPopupTemplateEnabled",void 0);e([r.aliasOf("viewModel.spatialReference")],
c.prototype,"spatialReference",void 0);e([r.aliasOf("viewModel.title")],c.prototype,"title",void 0);e([r.property(),l.renderable()],c.prototype,"visibleElements",void 0);e([r.cast("visibleElements")],c.prototype,"castVisibleElements",null);e([r.aliasOf("viewModel.map")],c.prototype,"map",void 0);e([r.aliasOf("viewModel.view")],c.prototype,"view",void 0);e([r.property({type:C}),l.renderable(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo"])],c.prototype,"viewModel",void 0);
e([l.accessibleHandler()],c.prototype,"_previousClick",null);e([l.accessibleHandler()],c.prototype,"_nextClick",null);return c=e([r.subclass("esri.widgets.Feature")],c)}(r.declared(F))});