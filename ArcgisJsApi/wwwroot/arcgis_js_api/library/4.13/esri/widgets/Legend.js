// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Legend/LegendViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./support/ActiveLayerInfo".split(" "),function(t,n,m,h,b,a,f,k,u,g){var r=a.ofType(g),w="esri.layers.CSVLayer esri.layers.FeatureLayer esri.layers.HeatmapLayer esri.layers.MapImageLayer esri.layers.PointCloudLayer esri.layers.TileLayer esri.layers.StreamLayer esri.layers.SceneLayer esri.layers.GeoRSSLayer esri.layers.GeoJSONLayer esri.layers.GroupLayer esri.layers.ImageryLayer esri.layers.WMSLayer esri.layers.WMTSLayer".split(" "),
c=["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];return function(a){function d(c){c=a.call(this,c)||this;c._handles=new f;c._layerViewByLayerId={};c._layerInfosByLayerViewId={};c._activeLayerInfosByLayerViewId={};c.activeLayerInfos=new r;c.basemapLegendVisible=!1;c.groundLegendVisible=!1;c.respectLayerVisibility=!0;c.layerInfos=[];c.view=null;return c}m(d,a);d.prototype.initialize=function(){this._handles.add(k.init(this,"view",
this._viewHandles),"view")};d.prototype.destroy=function(){this._destroyViewActiveLayerInfos();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});d.prototype._viewHandles=function(){this._handles.remove("state");this.view&&this._handles.add(k.init(this,"state",this._stateHandles),"state")};d.prototype._stateHandles=function(){this._resetAll();"ready"===this.state&&
this._watchPropertiesAndAllLayerViews()};d.prototype._resetAll=function(){this._handles.remove(["all-layer-views","legend-properties"]);this._destroyViewActiveLayerInfos();this.activeLayerInfos.removeAll()};d.prototype._destroyViewActiveLayerInfos=function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)};d.prototype._destroyViewActiveLayerInfo=function(a){this._handles.remove(a);delete this._activeLayerInfosByLayerViewId[a]};d.prototype._watchPropertiesAndAllLayerViews=
function(){var a=this.view.allLayerViews;a.length&&this._refresh();this._handles.add(a.on("change",this._allLayerViewsChangeHandle.bind(this)),"all-layer-views");this._handles.add(k.watch(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),"legend-properties")};d.prototype._allLayerViewsChangeHandle=function(a){var c=this;a.removed.forEach(function(a){return c._destroyViewActiveLayerInfo(a.uid)});this._refresh()};d.prototype._propertiesChangeHandle=
function(){this._destroyViewActiveLayerInfos();this._refresh()};d.prototype._refresh=function(){this._layerInfosByLayerViewId={};this.activeLayerInfos.removeAll();this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this);this._sortActiveLayerInfos(this.activeLayerInfos)};d.prototype._sortActiveLayerInfos=function(a){var c={};this.view.allLayerViews.forEach(function(a,p){return c[a.layer.uid]=p});a.sort(function(a,
p){return(c[p.layer.uid]||0)-(c[a.layer.uid]||0)})};d.prototype._generateLayerViews=function(){var a=[];c.filter(this._filterLayerViews,this).map(this.get,this).filter(function(a){return null!=a}).forEach(this._collectLayerViews("layerViews",a));return a};d.prototype._filterLayerViews=function(a){var c=!this.groundLegendVisible&&"view.groundView.layerViews"===a;return!(!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===a||"view.basemapView.referenceLayerViews"===a))&&!c};d.prototype._collectLayerViews=
function(a,c){var p=function(d){d&&d.forEach(function(d){c.push(d);p(d[a])});return c};return p};d.prototype._filterLayerViewsByLayerInfos=function(a){var c=this,d=this.layerInfos;return d&&d.length?d.some(function(d){return c._hasLayerInfo(d,a)}):!0};d.prototype._hasLayerInfo=function(a,c){var d=this._isLayerUIDMatching(a.layer,c.layer.uid);d&&(this._layerInfosByLayerViewId[c.uid]=a);return d};d.prototype._isLayerUIDMatching=function(a,c){return a&&(a.uid===c||this._hasLayerUID(a.layers,c))};d.prototype._hasLayerUID=
function(a,c){var d=this;return a&&a.some(function(a){return d._isLayerUIDMatching(a,c)})};d.prototype._isLayerViewSupported=function(a){return-1<w.indexOf(a.layer.declaredClass)?(this._layerViewByLayerId[a.layer.uid]=a,!0):!1};d.prototype._generateActiveLayerInfo=function(a){var c=this;this._isLayerActive(a)?this._buildActiveLayerInfo(a):(this._handles.remove(a.uid),this._handles.add(k.watch(a,"suspended, layer.legendEnabled",function(){return c._layerActiveHandle(a)}),a.uid))};d.prototype._layerActiveHandle=
function(a){this._isLayerActive(a)&&(this._handles.remove(a.uid),this._buildActiveLayerInfo(a))};d.prototype._isLayerActive=function(a){return this.respectLayerVisibility?!a.suspended&&a.get("layer.legendEnabled"):!0};d.prototype._buildActiveLayerInfo=function(a){var c=this,d=a.layer,l=a.uid,b=this._layerInfosByLayerViewId[l],f=this._activeLayerInfosByLayerViewId[l];f||(f=new g({layer:d,title:b&&void 0!==b.title?b.title:d.title,view:this.view}),this._activeLayerInfosByLayerViewId[l]=f);f.parent||
(b=(b=d.parent)&&this._layerViewByLayerId[b.uid],f.parent=b&&this._activeLayerInfosByLayerViewId[b.uid]);if(!this._handles.has(l)){var b=k.watch(d,"title",function(e){return c._titleHandle(e,f,a)}),q=k.watch(d,"renderer?, opacity",function(){return c._constructLegendElements(f,a)}),e=k.whenTrue(this.view,"stationary",function(){return c._scaleHandle(f,a)}),b=[b,q,e];this.respectLayerVisibility&&(q=k.watch(a,"suspended",function(e){return c._suspendedHandle(e,f,a)}),d=k.watch(d,"legendEnabled",function(e){return c._legendEnabledHandle(e,
f,a)}),b.push(q,d));this._handles.add(b,l);this._constructLegendElements(f,a)}this._addActiveLayerInfo(f,a)};d.prototype._titleHandle=function(a,c,d){c.title=a;this._constructLegendElements(c,d)};d.prototype._legendEnabledHandle=function(a,c,d){a?this._addActiveLayerInfo(c,d):this._removeActiveLayerInfo(c)};d.prototype._suspendedHandle=function(a,c,d){a?this._removeActiveLayerInfo(c):this._addActiveLayerInfo(c,d)};d.prototype._scaleHandle=function(a,c){a.scale!==this.view.scale&&a.isScaleDriven&&
this._constructLegendElements(a,c)};d.prototype._addActiveLayerInfo=function(a,c){this._isLayerActive(c)&&-1===this.activeLayerInfos.indexOf(a)&&((c=a.parent,c)?-1===c.children.indexOf(a)&&(c.children.push(a),this._sortActiveLayerInfos(c.children)):(this.activeLayerInfos.add(a),this._sortActiveLayerInfos(this.activeLayerInfos)))};d.prototype._removeActiveLayerInfo=function(a){var c=a.parent;c?c.children.remove(a):this.activeLayerInfos.remove(a)};d.prototype._constructLegendElements=function(a,c){c=
c.layer;a.scale=this.view.scale;c.featureCollections?a.buildLegendElementsForFeatureCollections(c.featureCollections):c.renderer?a.buildLegendElementsForRenderer():c.url&&a.buildLegendElementsForTools()};h([u.property({type:r})],d.prototype,"activeLayerInfos",void 0);h([u.property()],d.prototype,"basemapLegendVisible",void 0);h([u.property()],d.prototype,"groundLegendVisible",void 0);h([u.property()],d.prototype,"respectLayerVisibility",void 0);h([u.property()],d.prototype,"layerInfos",void 0);h([u.property({dependsOn:["view.ready"],
readOnly:!0})],d.prototype,"state",null);h([u.property()],d.prototype,"view",void 0);return d=h([u.subclass("esri.widgets.Legend.LegendViewModel")],d)}(u.declared(b))})},"esri/widgets/Legend/support/ActiveLayerInfo":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../Color ../../../request ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ../../../layers/support/fieldUtils ../../../renderers/support/jsonUtils ../../../symbols/support/symbolUtils ../../../symbols/support/utils ./colorRampUtils ./heatmapRampUtils ./relationshipRampUtils ./sizeRampUtils ./utils @dojo/framework/shim/Promise".split(" "),
function(t,n,m,h,b,a,f,k,u,g,r,w,c,l,d,q,p,x,B,D,y,z,e,v,C,E,G,H,A,I){function M(a){return"esri.renderers.SimpleRenderer"===a.declaredClass}function J(a){return"esri.renderers.ClassBreaksRenderer"===a.declaredClass}function S(a){return"esri.renderers.UniqueValueRenderer"===a.declaredClass}function ba(a){return"esri.renderers.HeatmapRenderer"===a.declaredClass}function P(a){return"esri.renderers.PointCloudClassBreaksRenderer"===a.declaredClass}function T(a){return"esri.renderers.PointCloudStretchRenderer"===
a.declaredClass}function K(a){return"esri.renderers.PointCloudUniqueValueRenderer"===a.declaredClass}var F=d.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),L=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,N=new g.SimpleMarkerSymbol({size:6,outline:{color:[128,128,128,.5],width:.5}}),X=new g.SimpleFillSymbol({style:"solid"}),Y=new g.SimpleMarkerSymbol({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});return function(d){function g(a){a=d.call(this,
a)||this;a._handles=new l;a._hasColorRamp=!1;a._hasOpacityRamp=!1;a._hasSizeRamp=!1;a._legendResponse={};a._webStyleSymbolCache=new Map;a._dotDensityUrlCache=new Map;a.children=new c;a.layer=null;a.legendElements=[];a.parent=null;a.scale=null;a.title=null;a.view=null;return a}h(g,d);g.prototype.initialize=function(){var a=this,e=function(){return a.notifyChange("ready")};this._handles.add([B.on(this,"children","change",function(c){var d=c.removed,l=a._handles;c.added.map(function(a){var c="activeLayerInfo-ready-watcher-"+
a.layer.uid;l.add(B.init(a,"ready",e),c)});d.forEach(function(a){return l.remove(a.layer.uid)});e()})])};g.prototype.destroy=function(){this._handles.destroy();this._dotDensityUrlCache=this._webStyleSymbolCache=this._legendResponse=this._handles=null};Object.defineProperty(g.prototype,"ready",{get:function(){return null===this.layer?!0:0<this.children.length?this._isGroupActive():0<this.legendElements.length},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isScaleDriven",{get:function(){var a=
this,e=this.layer;if(null===e)return!1;if("renderer"in e&&e.renderer){if("dot-density"===e.renderer.type)return!0;var c=e.get("renderer.valueExpression");return L.test(c)?!0:(e=e.get("renderer.visualVariables"))&&e.some(function(e){return a._isScaleDrivenSizeVariable(e)})}return!0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"version",{get:function(){return this._get("version")+1},enumerable:!0,configurable:!0});g.prototype.buildLegendElementsForFeatureCollections=function(c){return a(this,
void 0,void 0,function(){var a,d=this;return f(this,function(l){this.legendElements=[];a=c.map(function(a){if("esri.layers.FeatureLayer"===a.declaredClass)return d._buildRendererLegendElements(a.renderer,a.title,"append");if(a.featureSet&&a.featureSet.features.length){var c=a.layerDefinition,c=(c=c&&c.drawingInfo)&&e.fromJSON(c.renderer);return c?d._buildRendererLegendElements(c,a.name,"append"):(F.warn("drawingInfo not available!"),null)}return null});return[2,p.eachAlways(a).then(function(){})]})})};
g.prototype.buildLegendElementsForRenderer=function(){return a(this,void 0,void 0,function(){return f(this,function(a){return[2,this._buildRendererLegendElements("renderer"in this.layer&&this.layer.renderer,null,"replace")]})})};g.prototype.buildLegendElementsForTools=function(){return a(this,void 0,void 0,function(){var a,c=this;return f(this,function(e){switch(e.label){case 0:a=this.layer;if("esri.layers.WMTSLayer"!==a.declaredClass)return[3,1];this._constructLegendElementsForWMTSlayer();return[3,
6];case 1:if("esri.layers.WMSLayer"!==a.declaredClass)return[3,2];this._constructLegendElementsForWMSSublayers();return[3,6];case 2:return"esri.layers.MapImageLayer"!==a.declaredClass?[3,4]:[4,this._constructLegendElementsForSublayers()];case 3:return e.sent(),[3,6];case 4:return this._handles.remove("imageryLayers-watcher"),[4,this._getLegendLayers().then(function(e){c.legendElements=[];e.forEach(function(e){if("esri.layers.ImageryLayer"===a.declaredClass){var d=a.watch("renderingRule, bandIds",
function(){c._legendResponse["default"]=null;c.buildLegendElementsForTools()});c._handles.add(d,"imageryLayers-watcher")}(e=c._generateSymbolTableElementForLegendLayer(e))&&e.infos.length&&("esri.layers.ImageryLayer"===a.declaredClass&&(e.title=a.title),c.legendElements.push(e));c.notifyChange("ready")});c.notifyChange("ready")}).catch(function(a){F.warn("Request to server for legend has failed!",a)})];case 5:e.sent(),e.label=6;case 6:return[2]}})})};g.prototype._isGroupActive=function(){var a=this.children;
return a.length?a.some(function(a){return a.ready}):!1};g.prototype._isScaleDrivenSizeVariable=function(a){if(a&&"size"!==a.type)return!1;var e=a.minSize,c=a.maxSize;return"object"===typeof e&&e?this._isScaleDrivenSizeVariable(e):"object"===typeof c&&c?this._isScaleDrivenSizeVariable(c):!!a.expression||L.test(a.valueExpression)};g.prototype._buildRendererLegendElements=function(e,c,d){return a(this,void 0,void 0,function(){var a,l;return f(this,function(b){switch(b.label){case 0:return b.trys.push([0,
2,,3]),[4,this._getRendererLegendElements(e,c)];case 1:return a=b.sent(),"append"===d?Array.prototype.push.apply(this.legendElements,a):this.legendElements=a,this.notifyChange("ready"),[3,3];case 2:return l=b.sent(),F.warn("error while building legend for layer!",l),[3,3];case 3:return[2]}})})};g.prototype._constructLegendElementsForWMTSlayer=function(){this.legendElements=[];this._handles.remove("wmts-activeLayer-watcher");var a=this.layer,e=a.activeLayer;this._handles.add(B.watch(this.layer,"activeLayer",
this._constructLegendElementsForWMTSlayer.bind(this)),"wmts-activeLayer-watcher");if(e.styleId&&e.styles){var c=null;e.styles.some(function(a){return e.styleId===a.id?(c=a.legendUrl,!0):!1});c&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:c,opacity:a.opacity}]}])}this.notifyChange("ready")};g.prototype._constructLegendElementsForWMSSublayers=function(){this.legendElements=[];this._handles.remove("wms-sublayers-watcher");var a=this.layer,e=null;if(a.customParameters||a.customLayerParameters)e=
m({},a.customParameters,a.customLayerParameters);this._handles.add(B.watch(this.layer,"sublayers",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");this.legendElements=this._generateLegendElementsForWMSSublayers(a.sublayers,e);this.notifyChange("ready")};g.prototype._generateLegendElementsForWMSSublayers=function(a,e){var c=this,d=[];this._handles.add(a.on("change",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");a.forEach(function(a){var l=
a.watch("title, visible, legendEnabled",function(){return c._constructLegendElementsForWMSSublayers()});c._handles.add(l,"wms-sublayers-watcher");a.visible&&a.legendEnabled&&(a=c._generateSymbolTableElementForWMSSublayer(a,e))&&a.infos.length&&d.unshift(a)});return d};g.prototype._generateSymbolTableElementForWMSSublayer=function(a,e){return!a.legendUrl&&a.sublayers?(e=this._generateLegendElementsForWMSSublayers(a.sublayers,e).filter(function(a){return a}),{type:"symbol-table",title:a.title,infos:e}):
this._generateSymbolTableElementForLegendUrl(a,e)};g.prototype._generateSymbolTableElementForLegendUrl=function(a,e){var c=a.legendUrl;if(c){var d={type:"symbol-table",title:a.title||a.name||a.id&&a.id+"",infos:[]};e&&(c+="?"+x.objectToQuery(e));d.infos.push({src:c,opacity:a.layer&&a.layer.opacity});return d}};g.prototype._getLegendLayers=function(a){var e=this,c=(a=a&&a.hasDynamicLayers?a.dynamicLayers:null)||"default",d=this._legendResponse&&this._legendResponse[c];return d?p.resolve(d):this._legendRequest(a).then(function(a){a=
a.layers;return e._legendResponse[c]=a})};g.prototype._legendRequest=function(a){var e=this.layer;a={f:"json",dynamicLayers:a};"esri.layers.ImageryLayer"===e.declaredClass&&(e.renderingRule&&(a.renderingRule=JSON.stringify(e.renderingRule.toJSON())),e.bandIds&&(a.bandIds=e.bandIds.join()),e.raster||e.viewId)&&(a=m({raster:e.raster,viewId:e.viewId},a));var c=e.url.replace(/(\/)+$/,"");"version"in e&&10.01<=e.version?(e=c.indexOf("?"),c=-1<e?c.substring(0,e)+"/legend"+c.substring(e):c+"/legend"):(e=
c.toLowerCase().indexOf("/rest/"),c=c.substring(0,e)+c.substring(e+5,c.length),c="https://utility.arcgis.com/sharing/tools/legend?soapUrl\x3d"+encodeURI(c)+"\x26returnbytes\x3dtrue");return u(c,{query:a}).then(function(a){return a.data})};g.prototype._constructLegendElementsForSublayers=function(){var a=this;this.legendElements=[];this._handles.remove("sublayers-watcher");var e=this.layer,c=new y.ExportImageParameters({layer:e});return this._getLegendLayers(c).then(function(c){var d={};c.forEach(function(a){d[a.layerId]=
a});a._handles.add(B.watch(e,"sublayers",a._constructLegendElementsForSublayers.bind(a)),"sublayers-watcher");a.legendElements=a._generateLegendElementsForSublayers(e.sublayers,d,e.opacity);a.notifyChange("ready")}).catch(function(a){F.warn("Request to server for legend has failed!",a)}).then(function(){return c.destroy()})};g.prototype._generateLegendElementsForSublayers=function(a,e,c){var d=this,l=[];this._handles.add(a.on("change",this._constructLegendElementsForSublayers.bind(this)),"sublayers-watcher");
a.forEach(function(a){var b=a.watch("renderer, opacity, title, visible",function(){return d._constructLegendElementsForSublayers()});d._handles.add(b,"sublayers-watcher");a.visible&&a.legendEnabled&&(b=a&&null!=a.opacity?a.opacity:null,(a=d._generateSymbolTableElementForSublayer(a,e,null!=b?b*c:c))&&a.infos.length&&l.unshift(a))});return l};g.prototype._generateSymbolTableElementForSublayer=function(a,e,c){var d=e[a.id];return!d&&a.sublayers?(e=this._generateLegendElementsForSublayers(a.sublayers,
e,c).filter(function(a){return a}),{type:"symbol-table",title:a.title,infos:e}):this._generateSymbolTableElementForLegendLayer(d,a,c)};g.prototype._generateSymbolTableElementForLegendLayer=function(a,e,c){var d=this;if(a){var l=e&&e.renderer,b=e&&e.title||a.layerName;l&&(l=e&&e.title||this._getRendererTitle(l,e))&&(b&&(l.title=b),b=l);b={type:"symbol-table",title:b,infos:[]};a.legendType&&(b.legendType=a.legendType);a.legend&&this._isLegendLayerInScale(a,e)&&(e=e?this._sanitizeLegendForSublayer(a.legend.slice(),
e):a.legend,b.infos=e.map(function(e){var l=e.url;if(e.imageData&&0<e.imageData.length)l="data:image/png;base64,"+e.imageData;else if(0!==l.indexOf("http"))l=x.addTokenParameter(d.layer.url+"/"+a.layerId+"/images/"+l);else return null;return{label:e.label,src:l,opacity:c,width:e.width,height:e.height}}).filter(function(a){return!!a}));return b.infos.length?b:null}};g.prototype._isLegendLayerInScale=function(a,e){e=e||this.layer;var c=null,d=null,l=!0;!e.minScale&&0!==e.minScale||!e.maxScale&&0!==
e.maxScale?(0===a.minScale&&e.tileInfo&&(c=e.tileInfo.lods[0].scale),0===a.maxScale&&e.tileInfo&&(d=e.tileInfo.lods[e.tileInfo.lods.length-1].scale)):(c=Math.min(e.minScale,a.minScale)||e.minScale||a.minScale,d=Math.max(e.maxScale,a.maxScale));if(0<c&&c<this.scale||d>this.scale)l=!1;return l};g.prototype._sanitizeLegendForSublayer=function(a,e){if("version"in this.layer&&10.1>this.layer.version||0===a.length)return a;e=e.renderer;var c=null,d=null;a.some(function(a){return a.values})&&a.some(function(a,
e){a.values||(c=e,d=a,d.label||(d.label="others"));return null!=d});e?"unique-value"===e.type?d&&(a.splice(c,1),a.push(d)):"class-breaks"===e.type&&(d&&a.splice(c,1),a.reverse(),d&&a.push(d)):d&&(a.splice(c,1),a.push(d));return a};g.prototype._getRendererLegendElements=function(e,c){return a(this,void 0,void 0,function(){return f(this,function(a){return M(e)||J(e)||S(e)||"raster-stretch"===e.type||"raster-colormap"===e.type||ba(e)||P(e)||T(e)||K(e)||"esri.renderers.DotDensityRenderer"===e.declaredClass?
P(e)||T(e)||K(e)||"esri.renderers.PointCloudRGBRenderer"===e.declaredClass?[2,this._constructPointCloudRendererLegendElements(e,c)]:"dot-density"===e.type?[2,this._constructDotDensityRendererLegendElements(e)]:[2,this._constructRendererLegendElements(e,c)]:(F.warn("Renderer not supported!"),[2,[]])})})};g.prototype._getPointCloudRendererTitle=function(a){return a.legendOptions&&a.legendOptions.title||a.field};g.prototype._constructPointCloudRendererLegendElements=function(a,e){var c=this,d=[],l=null,
b=null;if(P(a))l={type:"symbol-table",title:e||this._getPointCloudRendererTitle(a),infos:[]},a.colorClassBreakInfos.forEach(function(a){l.infos.unshift({label:a.label||a.minValue+" - "+a.maxValue,value:[a.minValue,a.maxValue],symbol:c._getAppliedCloneSymbol(N,a.color)})});else if(T(a)){var b=a.stops,f=null;if(b.length&&(1===b.length&&(f=b[0].color),!f)){var g=b[0].value,q=b[b.length-1].value;null!=g&&null!=q&&(f=E.getColorFromPointCloudStops(g+(q-g)/2,b))}l={type:"symbol-table",title:null,infos:[{label:null,
value:null,symbol:this._getAppliedCloneSymbol(N,f||N.color)}]};b=E.getRampStopsForPointCloud(a.stops);b={type:"color-ramp",title:e||this._getPointCloudRendererTitle(a),infos:b,preview:v.renderColorRampPreviewHTML(b.map(function(a){return a.color}))}}else K(a)&&(l={type:"symbol-table",title:e||this._getPointCloudRendererTitle(a),infos:[]},a.colorUniqueValueInfos.forEach(function(a){l.infos.push({label:a.label||a.values.join(", "),value:a.values.join(", "),symbol:c._getAppliedCloneSymbol(N,a.color)})}));
l&&l.infos.length&&d.push(l);b&&b.infos.length&&d.push(b);a=d.reduce(function(a,e){return a.concat(e.infos)},[]).filter(function(a){return!!a.symbol}).map(function(a){return c._getSymbolPreview(a)});return p.eachAlways(a).then(function(){return d})};g.prototype._getElementInfoForDotDensity=function(a,e){var c=a.outline,c=a.dotSize+"-"+e+"-"+a.backgroundColor+"-"+(c&&JSON.stringify(c.toJSON())),d=this._dotDensityUrlCache;a=d.has(c)?d.get(c):v.renderDotDensityPreviewHTML(a,e);d.set(c,a);return{opacity:1,
src:a.src,preview:a,width:a.width,height:a.height}};g.prototype._constructDotDensityRendererLegendElements=function(a){var e=this,c=a.calculateDotValue(this.view.scale),d={type:"symbol-table",title:{value:c&&Math.round(c),unit:a.legendOptions&&a.legendOptions.unit||""},infos:[]};a.attributes.forEach(function(c){var l=e._getElementInfoForDotDensity(a,c.color);l.label=c.label||c.valueExpressionTitle||c.field;d.infos.push(l)});return p.resolve([d])};g.prototype._constructRendererLegendElements=function(e,
c){return a(this,void 0,void 0,function(){var a,d,l,b,g,x,k,r,y,m,B,h,z,u,C,D,P,n,E,U,w,Q,A,t,T,K,F,O,I,N,R,L,Z,da,ea,aa=this;return f(this,function(f){switch(f.label){case 0:return[4,this._loadRenderer(e)];case 1:return a=f.sent(),this._hasSizeRamp=this._hasOpacityRamp=this._hasColorRamp=!1,[4,this._getVisualVariableLegendElements(a)];case 2:d=f.sent()||[];l={type:"symbol-table",title:c||this._getRendererTitle(a),infos:[]};b=null;g=!1;if(!ba(a))return[3,3];x=G.getHeatmapRampStops(a);d.push({type:"heatmap-ramp",
title:c,infos:x,preview:v.renderColorRampPreviewHTML(x.map(function(a){return a.color}))});return[3,10];case 3:if(!S(a))return[3,4];if(r=(k=a&&a.authoringInfo)&&"relationship"===k.type){if(y=k.focus,m=k.numClasses,B=k.field1,h=k.field2,m&&B&&h){z=this.layer;u=[B,h];C=H.getRotationAngleForFocus(y)||0;D=0;for(P=u;D<P.length;D++)n=P[D],E=n.field,U=n.normalizationField,w={field:this._getFieldAlias(E,z),normField:U&&this._getFieldAlias(U,z)},Q=Y.clone(),Q.angle=C,l.infos.push({label:w,symbol:Q}),C+=90;
A=H.getRelationshipRampElement({focus:y,numClasses:m,infos:a.uniqueValueInfos});d.unshift(A)}}else t=a.field,a.uniqueValueInfos.forEach(function(a){a.symbol&&l.infos.push({label:a.label||aa._getDomainName(t,a.value)||a.value,value:a.value,symbol:a.symbol})});a.defaultSymbol&&(l.infos.push({label:a.defaultLabel||"others",symbol:a.defaultSymbol}),g=!0);return[3,10];case 4:if(!J(a))return[3,5];b=this._isUnclassedRenderer(a);if(T=!b||!this._hasSizeRamp)a.classBreakInfos.forEach(function(a){a.symbol&&
l.infos.unshift({label:a.label||(b?null:a.minValue+" - "+a.maxValue),value:[a.minValue,a.maxValue],symbol:a.symbol})}),b&&(l.title=null),this._updateInfosforClassedSizeRenderer(a,l.infos);a.defaultSymbol&&!b&&(l.infos.push({label:a.defaultLabel||"others",symbol:a.defaultSymbol}),g=!0);return[3,10];case 5:if("raster-stretch"!==a.type)return[3,9];z=this.layer;F=K=void 0;a.statistics&&(K=a.statistics[0].min||a.statistics[0][0],F=a.statistics[0].max||a.statistics[0][1]);O=[];N=q.unwrap;return z.renderingRule?
[4,z.generateRasterInfo(z.renderingRule)]:[3,7];case 6:return R=f.sent(),[3,8];case 7:R=z.serviceRasterInfo,f.label=8;case 8:return I=N.apply(void 0,[R]),L=I.keyProperties.BandProperties,1===I.bandCount?(K=K||I.statistics&&I.statistics[0].min,F=F||I.statistics&&I.statistics[0].max,K&&F?d.push(this._getStretchLegendElements(a,{min:K,max:F})):this.buildLegendElementsForTools()):z.bandIds&&1===z.bandIds.length?(K=K||I.statistics&&I.statistics[z.bandIds[0]].min,F=F||I.statistics&&I.statistics[z.bandIds[0]].max,
K&&F?d.push(this._getStretchLegendElements(a,{min:K,max:F})):this.buildLegendElementsForTools()):3<=I.bandCount?L&&L.length>=I.bandCount?z.bandIds&&3===z.bandIds.length?(O=z.bandIds.map(function(a){return L[a].BandName}),l.infos=this._createSymbolTableElementMultiBand(O)):"lerc"===z.format?(O=[0,1,2].map(function(a){return L[a].BandName}),l.infos=this._createSymbolTableElementMultiBand(O)):this.buildLegendElementsForTools():"lerc"===z.format?(O=["band0","band1","band2"],l.infos=this._createSymbolTableElementMultiBand(O)):
this.buildLegendElementsForTools():this.buildLegendElementsForTools(),[3,10];case 9:"raster-colormap"===a.type?a.colormapInfos.forEach(function(a){l.infos.push({label:a.label,value:a.value,symbol:aa._getAppliedCloneSymbol(X,a.color)})}):M(a)&&a.symbol&&!this._hasSizeRamp&&l.infos.push({label:a.label,symbol:a.symbol}),f.label=10;case 10:return Z=a.defaultSymbol,!Z||g||M(a)||b&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||d.push({type:"symbol-table",infos:[{label:a.defaultLabel||
"others",symbol:Z}]}),l.infos.length&&d.unshift(l),da=this._getSymbolConfig("visualVariables"in a&&a.visualVariables),ea=d.reduce(function(a,e){return a.concat(e.infos)},[]).filter(function(a){return!(!a||!a.symbol)}).map(function(a){return aa._getSymbolPreview(a,da)}),a=null,[4,p.eachAlways(ea)];case 11:return f.sent(),[2,d]}})})};g.prototype._getStretchLegendElements=function(a,e){a=E.getStrectchRampStops(a.colorRamp,e);return{type:"stretch-ramp",title:"",infos:a,preview:v.renderColorRampPreviewHTML(a.map(function(a){return a.color}))}};
g.prototype._createSymbolTableElementMultiBand=function(a){var e=[],c=["red","green","blue"];a.forEach(function(a,d){e.push({label:{colorName:c[d],bandName:a},src:I.RGB_IMG_SOURCE[d],opacity:1})});return e};g.prototype._updateInfosforClassedSizeRenderer=function(a,e){var c=a.authoringInfo&&"class-breaks-size"===a.authoringInfo.type,d=a.classBreakInfos.some(function(a){return C.isVolumetricSymbol(a.symbol)});if(c&&d){var l=A.REAL_WORLD_MAX_SIZE;a=a.classBreakInfos.length;var b=(l-A.REAL_WORLD_MIN_SIZE)/
(1<a?a-1:a);e.forEach(function(a,e){a.size=l-b*e})}};g.prototype._getSymbolConfig=function(a){var e=!1,c=!1;if(a)for(var d=0;d<a.length&&(!e||!c);d++){var l=a[d];"size"===l.type&&("height"===l.axis&&(e=!0),"width-and-depth"===l.axis&&(c=!0))}return e&&c?"tall":null};g.prototype._getSymbolPreview=function(a,e){return v.renderPreviewHTML(a.symbol,{size:a.size,opacity:this.layer.opacity,symbolConfig:e,rotation:a.symbol.angle}).then(function(e){a.preview=e;return a}).catch(function(){a.preview=null;return a})};
g.prototype._loadRenderer=function(e){return a(this,void 0,void 0,function(){var a,c,d,l,b=this;return f(this,function(f){switch(f.label){case 0:return a=[],e=e.clone(),[4,this._getMedianColor(e)];case 1:c=f.sent();if(J(e)||S(e))d=e.classBreakInfos||e.uniqueValueInfos,l=d.map(function(a){return b._fetchSymbol(a.symbol,c).then(function(e){a.symbol=e}).catch(function(){a.symbol=null})}),Array.prototype.push.apply(a,l);a.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:c).then(function(a){b._applySymbolToRenderer(e,
a,M(e))}).catch(function(){b._applySymbolToRenderer(e,null,M(e))}));return[2,p.eachAlways(a).then(function(){return e})]}})})};g.prototype._applySymbolToRenderer=function(a,e,c){c?a.symbol=e:a.defaultSymbol=e};g.prototype._getMedianColor=function(e){return a(this,void 0,void 0,function(){var a,c,d,l,b;return f(this,function(f){switch(f.label){case 0:if(!("visualVariables"in e&&e.visualVariables))return[2,null];a=w.find(e.visualVariables,function(a){return"color"===a.type});if(!a)return[2,null];d=
c=null;if(a.stops){if(1===a.stops.length)return[2,a.stops[0].color];c=a.stops[0].value;d=a.stops[a.stops.length-1].value}l=c+(d-c)/2;return[4,new Promise(function(a,e){t(["../../../renderers/visualVariables/support/visualVariableUtils"],a,e)})];case 1:return b=f.sent().getColor,[2,b(a,l)]}})})};g.prototype._fetchSymbol=function(a,e){var c=this;if(!a)return p.reject();if("web-style"===a.type){var d=a.portal,d=a.name+"-"+a.styleName+"-"+a.styleUrl+"-"+(d&&d.url)+"-"+(d&&d.user&&d.user.username),l=this._webStyleSymbolCache;
l.has(d)||l.set(d,a.fetchSymbol());return l.get(d).then(function(a){return c._getAppliedCloneSymbol(a,e)}).catch(function(){F.warn("Fetching web-style failed!");return p.reject()})}return p.resolve(this._getAppliedCloneSymbol(a,e))};g.prototype._getAppliedCloneSymbol=function(a,e){if(!a)return a;a=a.clone();var c=-1<a.type.indexOf("3d");e=e&&e.toRgba();c?this._applyColorTo3dSymbol(a,e):a.color&&(a.color=new k(e||a.color));return a};g.prototype._applyColorTo3dSymbol=function(a,e){e&&a.symbolLayers.forEach(function(a){a&&
(a.material||(a.material={}),a.material.color=new k(e))})};g.prototype._getVisualVariableLegendElements=function(e){return a(this,void 0,void 0,function(){var c,d,l,b,g,x,k,r,y,m,B=this;return f(this,function(h){switch(h.label){case 0:if(!("visualVariables"in e&&e.visualVariables))return[2,null];c=e.visualVariables;d=[];l=[];b=[];g=this.layer;c.forEach(function(a){"color"===a.type?d.push(a):"size"===a.type?l.push(a):"opacity"===a.type&&b.push(a)});x=d.concat(l,b);0===d.length&&J(e)&&e.classBreakInfos&&
1===e.classBreakInfos.length&&(k=(y=e.classBreakInfos[0])&&y.symbol);0===d.length&&M(e)&&(k=e.symbol);k&&(-1<k.type.indexOf("3d")?(m=k.symbolLayers.getItemAt(0),"water"===m.type?q.isSome(m.color)&&(r=m.color):q.isSome(m.material)&&q.isSome(m.material.color)&&(r=m.material.color)):k.url||(r=k.color));return[4,p.all(x.map(function(c){return a(B,void 0,void 0,function(){var a,d,l,b,p,q,x,k;return f(this,function(f){switch(f.label){case 0:if(c.legendOptions&&!1===c.legendOptions.showLegend)return[3,8];
a=this._getRampTitle(c,g);d=null;b=(l="getField"in g&&g.getField&&g.getField(c.field))&&z.isDateField(l);return"color"!==c.type?[3,2]:[4,E.getRampStops(c,null,b)];case 1:return p=f.sent(),d={type:"color-ramp",title:a,infos:p,preview:v.renderColorRampPreviewHTML(p.map(function(a){return a.color}))},this._hasColorRamp||(this._hasColorRamp=!(null==d.infos||!d.infos.length)),[3,7];case 2:if("size"!==c.type)return[3,5];q={type:"size-ramp",title:a};x=A.getRampStops;k=[e,c];return[4,this._getMedianColor(e)];
case 3:return[4,x.apply(void 0,k.concat([f.sent(),this.scale,this.view,b]))];case 4:return d=(q.infos=f.sent(),q),this._hasSizeRamp||(this._hasSizeRamp=!(null==d.infos||!d.infos.length)),[3,7];case 5:return"opacity"!==c.type?[3,7]:[4,E.getRampStops(c,r,b)];case 6:p=f.sent(),d={type:"opacity-ramp",title:a,infos:p,preview:v.renderColorRampPreviewHTML(p.map(function(a){return a.color}))},this._hasOpacityRamp||(this._hasOpacityRamp=!(null==d.infos||!d.infos.length)),f.label=7;case 7:return[2,d.infos&&
d];case 8:return[2,void 0]}})})}))];case 1:return[2,h.sent().filter(function(a){return!!a})]}})})};g.prototype._getDomainName=function(a,e){if(a&&"function"!==typeof a){var c=this.layer;return(c=(a=c.getField&&c.getField(a))&&c.getFieldDomain?c.getFieldDomain(a.name):null)&&c.codedValues?c.getName(e):null}return null};g.prototype._getRampTitle=function(a,e){var c=a.field,d=a.normalizationField,l=!1,b=!1,f=!1,p=null,c="function"===typeof c?null:c,d="function"===typeof d?null:d;if(null!=(a.legendOptions&&
a.legendOptions.title))p=a.legendOptions.title;else if(a.valueExpressionTitle)p=a.valueExpressionTitle;else{if("renderer"in e&&e.renderer&&"authoringInfo"in e.renderer&&e.renderer.authoringInfo&&e.renderer.authoringInfo.visualVariables)for(a=e.renderer.authoringInfo.visualVariables,p=0;p<a.length;p++){var g=a[p];if("color"===g.type){if("ratio"===g.style){l=!0;break}if("percent"===g.style){b=!0;break}if("percent-of-total"===g.style){f=!0;break}}}p={field:c&&this._getFieldAlias(c,e),normField:d&&this._getFieldAlias(d,
e),ratio:l,ratioPercent:b,ratioPercentTotal:f}}return p};g.prototype._getRendererTitle=function(a,e){if(a.legendOptions&&a.legendOptions.title)return a.legendOptions.title;if(a.valueExpressionTitle)return a.valueExpressionTitle;var c=this.layer,d=a.field,l=null,b=null;J(a)&&(l=a.normalizationField,b="percent-of-total"===a.normalizationType);d="function"===typeof d?null:d;l="function"===typeof l?null:l;a=null;if(d||l)a={field:e?d:d&&this._getFieldAlias(d,c),normField:e?l:l&&this._getFieldAlias(l,c),
normByPct:b};return a};g.prototype._getFieldAlias=function(a,e){var c="popupTemplate"in e&&e.popupTemplate,c=c&&c.fieldInfos;e="function"===typeof a?null:"getField"in e&&e.getField&&e.getField(a);var d=null;c&&c.some(function(e){return a===e.fieldName?(d=e,!0):!1});var c=d||e,l=null;c&&(l=d&&d.label||e&&e.alias||"name"in c&&c.name||"fieldName"in c&&c.fieldName);return l};g.prototype._isUnclassedRenderer=function(a){var e=a.visualVariables,c=!1;J(a)&&a.classBreakInfos&&1===a.classBreakInfos.length&&
e&&(c=a.field?e.some(function(e){return!(!e||a.field!==e.field||(a.normalizationField||e.normalizationField)&&a.normalizationField!==e.normalizationField)}):!!e.length);return c};b([D.property()],g.prototype,"children",void 0);b([D.property()],g.prototype,"layer",void 0);b([D.property()],g.prototype,"legendElements",void 0);b([D.property()],g.prototype,"parent",void 0);b([D.property({readOnly:!0})],g.prototype,"ready",null);b([D.property()],g.prototype,"scale",void 0);b([D.property({dependsOn:["layer.renderer?.valueExpression?",
"layer.renderer?.visualVariables?"],readOnly:!0})],g.prototype,"isScaleDriven",null);b([D.property()],g.prototype,"title",void 0);b([D.property({dependsOn:["ready"],readOnly:!0,value:0})],g.prototype,"version",null);b([D.property()],g.prototype,"view",void 0);return g=b([D.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],g)}(D.declared(r))})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./sublayerUtils ./timeUtils ../../views/View".split(" "),
function(t,n,m,h,b,a,f,k,u,g){Object.defineProperty(n,"__esModule",{value:!0});var r={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};t=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c._scale=null;c.view=null;return c}h(c,a);Object.defineProperty(c.prototype,"dynamicLayers",
{get:function(){if(!this.hasDynamicLayers)return null;var a=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});return a.length?JSON.stringify(a):null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasDynamicLayers",{get:function(){return this.layer&&k.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"layer",{set:function(a){var c=this;this._get("layer")!==a&&(this._set("layer",
a),this._layerHandles&&(this._layerHandles.forEach(function(a){return a.remove()}),this._layerHandles.length=0),a&&(this._layerHandles=[a.allSublayers.on("change",function(){return c.notifyChange("visibleSublayers")}),a.on("sublayer-update",function(a){return c.notifyChange(r[a.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"layers",{get:function(){var a=this.visibleSublayers;return a?a.length?"show:"+a.map(function(a){return a.id}).join(","):"show:-1":null},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"layerDefs",{get:function(){var a=this.visibleSublayers.filter(function(a){return null!=a.definitionExpression});return a.length?JSON.stringify(a.reduce(function(a,c){a[c.id]=c.definitionExpression;return a},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"scale",{get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(a){this.view||(this._scale=a,this.notifyChange("scale"))},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"version",{get:function(){this.layers;this.layerDefs;this.dynamicLayers;this.timeExtent;var a=this.layer;a&&(a.dpi,a.imageFormat,a.imageTransparency,a.gdbVersion);return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"visibleSublayers",{get:function(){var a=this,c=[];if(!this.layer)return c;var b=this.layer.sublayers,f=function(d){var b=a.scale,l=
0===d.minScale||b<=d.minScale,p=0===d.maxScale||b>=d.maxScale;d.visible&&(0===b||l&&p)&&(d.sublayers?d.sublayers.forEach(f):c.unshift(d))};b&&b.forEach(f);b=this._get("visibleSublayers");return!b||b.length!==c.length||b.some(function(a,d){return c[d]!==a})?c:b},enumerable:!0,configurable:!0});c.prototype.toJSON=function(){var a=this.layer,a={dpi:a.dpi,format:a.imageFormat,transparent:a.imageTransparency,gdbVersion:a.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?a.dynamicLayers=this.dynamicLayers:
a=m({},a,{layers:this.layers,layerDefs:this.layerDefs});return a};b([f.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],c.prototype,"dynamicLayers",null);b([f.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],c.prototype,"hasDynamicLayers",null);b([f.property()],c.prototype,"layer",null);b([f.property({readOnly:!0,dependsOn:["visibleSublayers"]})],c.prototype,"layers",null);b([f.property({readOnly:!0,dependsOn:["visibleSublayers"]})],
c.prototype,"layerDefs",null);b([f.property({type:Number,dependsOn:["view.scale"]})],c.prototype,"scale",null);b([f.property(u.combinedViewLayerTimeExtentProperty)],c.prototype,"timeExtent",void 0);b([f.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion timeExtent".split(" ")})],c.prototype,"version",null);b([f.property({type:g})],c.prototype,"view",void 0);b([f.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],c.prototype,
"visibleSublayers",null);return c=b([f.subclass("esri.layers.mixins.ExportImageParameters")],c)}(f.declared(a));n.ExportImageParameters=t})},"esri/layers/support/sublayerUtils":function(){define(["require","exports","./layerSourceUtils"],function(t,n,m){function h(b,a){function f(a){var c=a.sublayers;k.unshift(a.id);c&&c.toArray().forEach(f)}if(!b||!b.length)return!0;var k=[];a.forEach(f);if(b.length>k.length)return!1;a=0;for(var m=k.length,g=0;g<b.length;g++){for(var r=b[g].id;a<m&&k[a]!==r;)a++;
if(a>=m)return!1}return!0}Object.defineProperty(n,"__esModule",{value:!0});n.isExportDynamic=function(b,a,f){return b.some(function(a){var b=a.source;return!(!b||b.type===m.MAPLAYER&&b.mapLayerId===a.id&&(!b.gdbVersion||b.gdbVersion===f.gdbVersion))||null!=a.renderer||null!=a.labelingInfo||a.hasOwnProperty("opacity")&&null!=a.opacity||a.hasOwnProperty("labelsVisible")&&null!=a.labelsVisible})?!0:!h(b,a)};n.sameStructureAsService=function(b,a){return a.slice().reverse().flatten(function(a){return(a=
a.sublayers)&&a.toArray().reverse()}).every(function(a,k){return(k=b[k])&&a.id===k.id&&(null==a.sublayers&&null==k.sublayers||null!=a.sublayers&&null!=k.sublayers&&a.sublayers.map(function(a){return a.id}).join(",")===k.sublayers.map(function(a){return a.id}).join(","))})}})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/compilerUtils ../../core/maybe ../../core/promiseUtils ./previewSymbol2D ./previewSymbol3D ./previewWebStyleSymbol ./utils".split(" "),
function(t,n,m,h,b,a,f,k,u,g,r){function w(a,c){switch(a.type){case "web-style":return g.previewWebStyleSymbol(a,w,c);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return u.previewSymbol3D(a,c);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":case "cim":return k.previewSymbol2D(a,c);default:b.neverReached(a)}}function c(a){return a&&"opacity"in a?a.opacity*c(a.parent):1}Object.defineProperty(n,"__esModule",
{value:!0});var l=null;n.renderDotDensityPreviewHTML=function(a,c,b){var d=a.backgroundColor,f=a.outline;a=a.dotSize;var p=b&&b.swatchSize||22,g=Math.round(p*p/Math.pow(a,2)*.8),k=window.devicePixelRatio;b=document.createElement("canvas");var e=p*k;b.width=e;b.height=e;b.style.width=b.width/k+"px";b.style.height=b.height/k+"px";var v=b.getContext("2d");d&&(v.fillStyle=d.toCss(!0),v.fillRect(0,0,e,e),v.fill());v.fillStyle=c.toCss(!0);if(l&&l.length/2===g)for(c=0;c<2*g;c+=2){var d=l[c],q=l[c+1];v.fillRect(d,
q,a*k,a*k);v.fill()}else for(l=[],c=0;c<2*g;c+=2)d=Math.floor(Math.random()*(e-0+1)+0),q=Math.floor(Math.random()*(e-0+1)+0),l.push(d,q),v.fillRect(d,q,a*k,a*k),v.fill();f&&(f.color&&(v.strokeStyle=f.color.toCss(!0)),v.lineWidth=f.width,v.strokeRect(0,0,e,e));f=new Image(p,p);f.src=b.toDataURL();return f};n.renderColorRampPreviewHTML=function(a,c){var d=c&&"horizontal"===c.align,b=c&&c.width||(d?75:24);c=c&&c.height||(d?24:75);var l=window.devicePixelRatio,f=b*l,g=c*l,l=document.createElement("canvas");
l.width=f;l.height=g;l.style.width=b+"px";l.style.height=c+"px";var k=l.getContext("2d"),e=k.createLinearGradient(0,0,d?f:0,d?0:g),v=1/(a.length-1);a.forEach(function(a,c){return e.addColorStop(c*v,a.toString())});k.fillStyle=e;k.fillRect(0,0,f,g);a=document.createElement("div");a.style.width=b+"px";a.style.height=c+"px";a.appendChild(l);return a};n.renderPreviewHTML=w;n.getDisplayedSymbol=function(d,b){return h(this,void 0,void 0,function(){var l,g,k,q,y,h,e,v,C,u,n,w,A,I,M,J;return m(this,function(p){switch(p.label){case 0:if(!d)return[2,
void 0];l=c(d.layer||d.sourceLayer);if(a.isSome(d.symbol))return g=d.symbol.clone(),r.applyColorToSymbol(g,null,l),[2,g];k=d.get("layer.renderer")||d.get("sourceLayer.renderer");return[4,k.getSymbolAsync(d)];case 1:q=p.sent();if(!q)return[2,void 0];q=q.clone();return!("visualVariables"in k)||"visualVariables"in k&&!k.visualVariables||"visualVariables"in k&&k.visualVariables&&!k.visualVariables.length?[2,q]:[4,f.create(function(a){return t(["../../renderers/visualVariables/support/visualVariableUtils"],
a)})];case 2:y=p.sent();h=[];e=[];v=[];C=[];u=0;for(n=k.visualVariables;u<n.length;u++)switch(w=n[u],w.type){case "color":h.push(w);break;case "opacity":e.push(w);break;case "rotation":C.push(w);break;case "size":v.push(w)}I=(A=!!h.length&&h[h.length-1])?y.getColor(A,d,b):null;J=(M=!!e.length&&e[e.length-1])?y.getOpacity(M,d,b):null;null!=l&&(J=null!=J?J*l:l);r.applyColorToSymbol(q,I,J);v.forEach(function(a){return r.applySizeToSymbol(q,y.getSize(a,d,b),a.axis)});C.forEach(function(a){return r.applyRotationToSymbol(q,
y.getRotationAngle(a,d,b),a.axis)});return[2,q]}})})}})},"esri/symbols/support/previewSymbol2D":function(){define("require exports ../../core/Error ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils".split(" "),function(t,n,m,h,b,a,f,k){function u(a,c){var d=r.getContext("2d"),b=[];c&&(c.weight&&b.push(c.weight),c.size&&b.push(c.size+"px"),c.family&&b.push(c.family));d.font=b.join(" ");return d.measureText(a).width}function g(a){if(0===a.length)return 0;if(2<a.length){var d=
b.px2pt(1),l=parseFloat(a);switch(a.slice(-2)){case "px":return l;case "pt":return l*d;case "in":return 72*l*d;case "pc":return 12*l*d;case "mm":return l*w*d;case "cm":return l*c*d}}return parseFloat(a)}Object.defineProperty(n,"__esModule",{value:!0});var r=document.createElement("canvas"),w=7.2/2.54,c=72/2.54;n.previewSymbol2D=function(c,d){var l=d&&d.size?b.pt2px(d.size):null,p=d&&d.maxSize?b.pt2px(d.maxSize):null,x=d&&null!=d.opacity?d.opacity:null,r=d&&null!=d.rotation?d.rotation:null,n=a.getStroke(c),
y={shape:null,fill:null,stroke:n};n&&n.width&&(n.width=Math.min(n.width,80));var z=0,e=0;switch(c.type){case "simple-marker":var n=c.style,v=b.pt2px(c.size),z=Math.min(l||v||22,p||120),e=Math.min(l||v||22,p||120);switch(n){case "circle":y.shape={type:"circle",cx:.5*v,cy:.5*v,r:.5*v};break;case "cross":y.shape={type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[z,.5*e]},{command:"M",values:[.5*z,0]},{command:"L",values:[.5*z,e]}]};break;case "diamond":y.shape={type:"path",path:[{command:"M",
values:[0,.5*e]},{command:"L",values:[.5*z,0]},{command:"L",values:[z,.5*e]},{command:"L",values:[.5*z,e]},{command:"Z",values:[]}]};break;case "square":y.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[z,0]},{command:"L",values:[z,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]};break;case "triangle":y.shape={type:"path",path:[{command:"M",values:[.5*z,0]},{command:"L",values:[z,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]};break;case "x":y.shape={type:"path",
path:[{command:"M",values:[0,0]},{command:"L",values:[z,e]},{command:"M",values:[z,0]},{command:"L",values:[0,e]}]};break;case "path":y.shape={type:"path",path:c.path||""}}break;case "simple-line":l=Math.min(l||n&&n.width||22,p||80);n.width=l;z=22<l?2*l:40;e=l;y.shape={type:"path",path:[{command:"M",values:[0,e]},{command:"L",values:[z,e]}]};break;case "picture-fill":case "simple-fill":z=Math.min(l||22,p||120);e=Math.min(l||22,p||120);y.shape=f.shapes.fill[0];break;case "picture-marker":var n=b.pt2px(c.width),
C=b.pt2px(c.height),v=Math.max(n,C),C=n/C,n=1>=C?Math.ceil(v*C):v,C=1>=C?v:Math.ceil(v/C),z=Math.min(l||n||22,p||120),e=Math.min(l||C||22,p||120);y.shape={type:"image",x:-Math.round(z/2),y:-Math.round(e/2),width:z,height:e,src:c.url||""};break;case "text":n=c.text||"Aa",v=c.font,l=Math.min(l||b.pt2px(v.size),p||120),C=u(n,{weight:v.weight,size:l,family:v.family}),z=(p=/[\uE600-\uE6FF]/.test(n))?l:C,e=l,C=.25*g((v?l:0).toString()),p&&(C+=5),y.shape={type:"text",text:n,x:0,y:C,align:"middle",decoration:v&&
v.decoration,rotated:c.rotated,kerning:c.kerning},y.font=v&&{size:l,style:v.style,decoration:v.decoration,weight:v.weight,family:v.family}}if(!y.shape)return h.reject(new m("symbolPreview: renderPreviewHTML2D","symbol not supported."));var E=a.getFill(c),l=c.color,p=null;E&&"pattern"===E.type&&l&&"picture-fill"!==c.type?p=a.getPatternUrlWithColor(E.src,l.toCss(!0)).then(function(a){E.src=a;y.fill=E;return y}):(y.fill=E,p=h.resolve(y));return p.then(function(a){return k.renderSymbol([[a]],[z,e],{node:d&&
d.node,scale:!0,opacity:x,rotation:r})})}})},"esri/symbols/support/gfxUtils":function(){define("require exports ../../core/tsSupport/assignHelper ../../Color ../../request ../../core/ItemCache ../../core/promiseUtils ../../core/screenUtils".split(" "),function(t,n,m,h,b,a,f,k){function u(a){if(!a)return null;var c;switch(a.type){case "simple-fill":case "picture-fill":case "simple-marker":c=u(a.outline);break;case "simple-line":var d=k.pt2px(a.width);"none"!==a.style&&0!==d&&(c={color:a.color,style:l(a.style),
width:d,cap:a.cap,join:"miter"===a.join?k.pt2px(a.miterLimit):a.join});break;default:c=null}return c}Object.defineProperty(n,"__esModule",{value:!0});var g=t.toUrl("../../symbols/patterns/"),r={left:"start",center:"middle",right:"end",justify:"start"},w={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},c=new a(1E3);n.getSVGAlign=function(a){return a=(a=a.horizontalAlignment)&&r[a.toLowerCase()]||"middle"};n.getSVGBaseline=function(a){return(a=a.verticalAlignment)&&
w[a.toLowerCase()]||"alphabetic"};n.getSVGBaselineShift=function(a){return"bottom"===a.verticalAlignment?"super":null};n.getFill=function(a){var c=a.style,d=null;if(a)switch(a.type){case "simple-marker":"cross"!==c&&"x"!==c&&(d=a.color);break;case "simple-fill":"solid"===c?d=a.color:"none"!==c&&(d={type:"pattern",x:0,y:0,src:g+c+".png",width:8,height:8});break;case "picture-fill":d={type:"pattern",src:a.url,width:k.pt2px(a.width)*a.xscale,height:k.pt2px(a.height)*a.yscale,x:k.pt2px(a.xoffset),y:k.pt2px(a.yoffset)};
break;case "text":d=a.color}return d};n.getPatternUrlWithColor=function(a,l){var d=a+"-"+l;return void 0!==c.get(d)?f.resolve(c.get(d)):b(a,{responseType:"image"}).then(function(a){a=a.data;var b=a.naturalWidth,f=a.naturalHeight,g=document.createElement("canvas");g.width=b;g.height=f;var p=g.getContext("2d");p.fillStyle=l;p.fillRect(0,0,b,f);p.globalCompositeOperation="destination-in";p.drawImage(a,0,0);a=g.toDataURL();c.put(d,a);return a})};n.getStroke=u;var l=function(){var a={};return function(c){if(a[c])return a[c];
var d=c.replace(/-/g,"");return a[c]=d}}();n.defaultThematicColor=new h([128,128,128])})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(t,n,m){return function(){function h(b,a){this._storage=new m.MemCacheStorage;this._storage.maxSize=b;a&&this._storage.registerRemoveFunc("",a)}h.prototype.put=function(b,a){this._storage.put(b,a,1,1)};h.prototype.pop=function(b){return this._storage.pop(b)};h.prototype.get=function(b){return this._storage.get(b)};h.prototype.clear=
function(){this._storage.clearAll()};h.prototype.destroy=function(){this._storage.clearAll()};return h}()})},"esri/symbols/support/previewUtils":function(){define(["require","exports"],function(t,n){Object.defineProperty(n,"__esModule",{value:!0});n.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},
{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},
{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},
{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};n.getPathSymbolShapes=function(m){var h=22,b=22;1>m?h*=.75:1<m&&(b*=1.25);
return[{type:"path",path:[{command:"M",values:[22,0]},{command:"L",values:[19.25,0]},{command:"L",values:[0,b-11]},{command:"L",values:[h-11,b-11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[22,0]},{command:"L",values:[22,2.75]},{command:"L",values:[h-11,22]},{command:"L",values:[h-11,b-11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[h-11,b-11]},{command:"L",values:[0,b-11]},{command:"L",values:[0,22]},{command:"L",values:[h-11,22]},{command:"Z",values:[]}]}]};
n.getExtrudeSymbolShapes=function(m){m*=.5;return[{type:"path",path:[{command:"M",values:[0,.7*11]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+m]},{command:"L",values:[0,22*.7+m-.7*11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+m]},{command:"L",values:[22,m]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,
22*.7]},{command:"L",values:[0,.7*11]},{command:"Z",values:[]}]}]};n.getWaterSymbolShapes=function(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},
{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]};
n.getCubeShapes=function(m,h){var b=h?20:m,a=h?4:6,a=b=22>=b?b-.5*a:b-a;h=h?.35*b:.5*b;return[{type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[a,.5*h]},{command:"L",values:[.5*a,h]},{command:"L",values:[0,.5*h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[.5*a,h]},{command:"L",values:[.5*a,m]},{command:"L",values:[0,m-.5*h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*a,h]},{command:"L",values:[.5*a,
m]},{command:"L",values:[a,m-.5*h]},{command:"L",values:[a,.5*h]},{command:"Z",values:[]}]}]};n.getCylinderShapes=function(m,h){var b=h?20:m;h=h?4:6;b=22>=b?b-.5*h:b-h;h=.5*b;var a=.15*b;m-=a;return[{type:"ellipse",cx:.5*b,cy:m,rx:h,ry:a},{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,m]},{command:"L",values:[b,m]},{command:"L",values:[b,a]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*b,cy:a,rx:h,ry:a}]};n.getConeShapes=function(m,h){var b=h?20:m;h=h?4:6;b=22>=b?b-.5*h:b-
h;h=.15*b;var a=b;m-=h;return[{type:"ellipse",cx:.5*b,cy:m,rx:.5*b,ry:h},{type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[a,m]},{command:"L",values:[0,m]},{command:"Z",values:[]}]}]};n.getInvertedConeShapes=function(m){var h=m,h=22>h?h-3:h-6,b=.15*h,a=h;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,0]},{command:"L",values:[.5*a,m-b]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*h,cy:0,rx:.5*h,ry:b}]};n.getDiamondShapes=function(m){var h=m,h=22>
h?h-2:h-4,b=Math.floor(m/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*h,0]},{command:"L",values:[h,.5*m-b]},{command:"L",values:[.45*h-b,.5*m+b]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*h,0]},{command:"L",values:[.45*h-b,.5*m+b]},{command:"L",values:[0,.5*m-b]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*m-b]},{command:"L",values:[.45*h-b,.5*m+b]},{command:"L",values:[.45*h,m]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",
values:[.45*h,m]},{command:"L",values:[h,.5*m-b]},{command:"L",values:[.45*h-b,.5*m+b]},{command:"Z",values:[]}]}]};n.getTetrahedronShapes=function(m){var h=m,h=22>h?h-1:h-2;return[{type:"path",path:[{command:"M",values:[.45*m,0]},{command:"L",values:[m,h]},{command:"L",values:[.45*m,.6*h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*m,0]},{command:"L",values:[.45*m,.6*h]},{command:"L",values:[0,h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,h]},
{command:"L",values:[.45*m,.6*h]},{command:"L",values:[m,h]},{command:"Z",values:[]}]}]}})},"esri/symbols/support/renderUtils":function(){define("require exports ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/has ../../core/promiseUtils ./svgUtils maquette".split(" "),function(t,n,m,h,b,a,f,k,u,g){function r(c,b,d){return c?h(c,{responseType:"image"}).then(function(a){a=a.data;var c=a.width,l=a.height,f=c/l,g=b;d&&(g=Math.min(g,Math.max(c,l)));return{image:a,width:1>=
f?Math.ceil(g*f):g,height:1>=f?g:Math.ceil(g/f)}}):k.reject(new a("renderUtils: imageDataSize","href not provided."))}Object.defineProperty(n,"__esModule",{value:!0});var w=g.createProjector();n.renderSymbol=function(a,b,d){var c=Math.ceil(b[0]);b=Math.ceil(b[1]);if(!a.some(function(a){return!!a.length}))return null;var l=d&&d.node||document.createElement("div");null!=d.opacity&&(l.style.opacity=d.opacity.toString());w.append(l,u.renderSVG.bind(null,a,c,b,d));return l};n.tintImageWithColor=function(a,
l,d,g,p){return r(a,l,p).then(function(c){var p=c.width?c.width:l,k=c.height?c.height:l,r;if(r=c.image)r=d&&"ignore"!==g?"multiply"===g&&255===d.r&&255===d.g&&255===d.b&&1===d.a?!1:!0:!1;if(r){var x=c.image.width,e=c.image.height;(f("edge")||f("ie"))&&/\.svg$/i.test(a)&&(--x,--e);var v,h;v=Math.ceil(p);h=Math.ceil(k);r=document.createElement("canvas");r.width=v;r.height=h;r.style.width=v+"px";r.style.height=h+"px";r=r.getContext("2d");r.clearRect(0,0,v,h);r.drawImage(c.image,0,0,x,e,0,0,p,k);c=r.getImageData(0,
0,p,k);x=[d.r/255,d.g/255,d.b/255,d.a];e=b.toHSV(d);for(v=0;v<c.data.length;v+=4){h=c.data;var q=v,u=x,n=e;switch(g){case "multiply":h[q+0]*=u[0];h[q+1]*=u[1];h[q+2]*=u[2];h[q+3]*=u[3];break;default:var w=b.toHSV({r:h[q+0],g:h[q+1],b:h[q+2]});w.h=n.h;w.s=n.s;w.v=w.v/100*n.v;n=b.toRGB(w);h[q+0]=n.r;h[q+1]=n.g;h[q+2]=n.b;h[q+3]*=u[3]}}r.putImageData(c,0,0);a=r.canvas.toDataURL("image/png")}else(r=m.id&&m.id.findCredential(a))&&r.token&&(c=-1===a.indexOf("?")?"?":"\x26",a=""+a+c+"token\x3d"+r.token);
return{url:a,width:p,height:k}}).catch(function(){return{url:a,width:l,height:l}})}})},"esri/core/colorUtils":function(){define(["require","exports"],function(t,n){function m(a,b){var c=[],l,d;if(a[0].length!==b.length)throw"dimensions do not match";var f=a.length,g=a[0].length,k=0;for(l=0;l<f;l++){for(d=k=0;d<g;d++)k+=a[l][d]*b[d];c.push(k)}return c}function h(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=m(u,a);return{x:100*a[0],y:100*a[1],
z:100*a[2]}}function b(a){a=m(g,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function a(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}}function f(a){var b=a.l;a=[(b+16)/116+a.a/500,(b+16)/116,(b+16)/116-a.b/
200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function k(a){if("r"in a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var g=a.c,c=a.h;return b(f({l:a.l,a:g*Math.cos(c),b:g*Math.sin(c)}))}if("l"in a&&"a"in a&&"b"in a)return b(f(a));if("x"in a&&"y"in a&&"z"in a)return b(a);if("h"in a&&"s"in a&&"v"in a){c=(a.h+360)%360/60;g=a.v/100*255;a=a.s/100*g;var l=a*(1-Math.abs(c%2-1));switch(Math.floor(c)){case 0:c={r:a,
g:l,b:0};break;case 1:c={r:l,g:a,b:0};break;case 2:c={r:0,g:a,b:l};break;case 3:c={r:0,g:l,b:a};break;case 4:c={r:l,g:0,b:a};break;case 5:case 6:c={r:a,g:0,b:l};break;default:c={r:0,g:0,b:0}}c.r=Math.round(c.r+g-a);c.g=Math.round(c.g+g-a);c.b=Math.round(c.b+g-a);return c}}Object.defineProperty(n,"__esModule",{value:!0});var u=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],g=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];n.toRGB=k;n.toHSV=function(a){if("h"in a&&
"s"in a&&"v"in a)return a;var b=k(a);a=b.r;var c=b.g,b=b.b,l=Math.max(a,c,b),d=l-Math.min(a,c,b),f;0===d?f=0:l===a?f=(c-b)/d%6:l===c?f=(b-a)/d+2:l===b&&(f=(a-c)/d+4);0>f&&(f+=6);return{h:60*f,s:100*(0===d?0:d/l),v:100/255*l}};n.toLAB=function(b){return"l"in b&&"a"in b&&"b"in b?b:a(h(k(b)))};n.toLCH=function(b){if(!("l"in b&&"c"in b&&"h"in b)){var f=a(h(k(b)));b=f.l;var c=f.a,l=f.b,f=Math.sqrt(c*c+l*l),c=Math.atan2(l,c),c=0<c?c:c+2*Math.PI;b={l:b,c:f,h:c}}return b};n.toXYZ=function(a){return"x"in a&&
"y"in a&&"z"in a?a:h(k(a))}})},"esri/symbols/support/svgUtils":function(){define("require exports ../../Color ../../core/has ../../core/libs/gl-matrix-2/mat2df32 ../../core/libs/gl-matrix-2/math/mat2d ../../widgets/support/widget".split(" "),function(t,n,m,h,b,a,f){function k(a){return a.map(function(a){return a.command+" "+a.values.join(" ")}).join(" ").trim()}function u(a,e,c,b){if(a){if("circle"===a.type)return f.tsx("circle",{fill:e,"fill-rule":"evenodd",stroke:c.color,"stroke-width":c.width,
"stroke-linecap":c.cap,"stroke-linejoin":c.join,"stroke-dasharray":c.dashArray,"stroke-miterlimit":"4",cx:a.cx,cy:a.cy,r:a.r});if("ellipse"===a.type)return f.tsx("ellipse",{fill:e,"fill-rule":"evenodd",stroke:c.color,"stroke-width":c.width,"stroke-linecap":c.cap,"stroke-linejoin":c.join,"stroke-dasharray":c.dashArray,"stroke-miterlimit":"4",cx:a.cx,cy:a.cy,rx:a.rx,ry:a.ry});if("rect"===a.type)return f.tsx("rect",{fill:e,"fill-rule":"evenodd",stroke:c.color,"stroke-width":c.width,"stroke-linecap":c.cap,
"stroke-linejoin":c.join,"stroke-dasharray":c.dashArray,"stroke-miterlimit":"4",x:a.x,y:a.y,width:a.width,height:a.height});if("image"===a.type)return f.tsx("image",{href:a.src,x:a.x,y:a.y,width:a.width,height:a.height,preserveAspectRatio:"none"});if("path"===a.type)return a="string"!==typeof a.path?k(a.path):a.path,f.tsx("path",{fill:e,"fill-rule":"evenodd",stroke:c.color,"stroke-width":c.width,"stroke-linecap":c.cap,"stroke-linejoin":c.join,"stroke-dasharray":c.dashArray,"stroke-miterlimit":"4",
d:a});if("text"===a.type)return f.tsx("text",{fill:e,"fill-rule":"evenodd",stroke:c.color,"stroke-width":c.width,"stroke-linecap":c.cap,"stroke-linejoin":c.join,"stroke-dasharray":c.dashArray,"stroke-miterlimit":"4","text-anchor":b.align,"text-decoration":b.decoration,kerning:b.kerning,rotate:b.rotate,"text-rendering":C,"font-style":b.font.style,"font-variant":b.font.variant,"font-weight":b.font.weight,"font-size":b.font.size,"font-family":b.font.family,x:a.x,y:a.y},a.text)}return null}function g(a){var c=
{fill:"none",pattern:null,linearGradient:null};if(a)if("type"in a&&"pattern"===a.type){var b="patternId-"+ ++e;c.fill="url(#"+b+")";c.pattern={id:b,x:a.x,y:a.y,width:a.width,height:a.height,image:{x:0,y:0,width:a.width,height:a.height,href:a.src}}}else"type"in a&&"linear"===a.type?(b="linearGradientId-"+ ++v,c.fill="url(#"+b+")",c.linearGradient={id:b,x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,stops:a.colors.map(function(a){return{offset:a.offset,color:a.color&&(new m(a.color)).toString()}})}):a&&(a=new m(a),
c.fill=a.toString());return c}function r(a){var c={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(a&&(null!=a.width&&(c.width=a.width),a.cap&&(c.cap=a.cap),a.join&&(c.join=a.join.toString()),a.color&&(c.color=(new m(a.color)).toString()),a.style)){var e=null;a.style in I&&(e=I[a.style]);if(Array.isArray(e)){for(var e=e.slice(0),b=0;b<e.length;++b)e[b]*=a.width;if("butt"!==a.cap){for(b=0;b<e.length;b+=2)e[b]-=a.width,1>e[b]&&(e[b]=1);for(b=1;b<e.length;b+=2)e[b]+=a.width}e=e.join(",")}c.dashArray=
e}return c}function w(a,c){var e={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};a&&(e.align=a.align,e.decoration=a.decoration,e.kerning=a.kerning?"auto":"0",e.rotate=a.rotated?"90":"0",e.font.style=c.style||"normal",e.font.variant=c.variant||"normal",e.font.weight=c.weight||"normal",e.font.size=c.size&&c.size.toString()||"10pt",e.font.family=c.family||"serif");return e}function c(a){var c=a.pattern;a=a.linearGradient;return c?
f.tsx("pattern",{id:c.id,patternUnits:"userSpaceOnUse",x:c.x,y:c.y,width:c.width,height:c.height},f.tsx("image",{x:c.image.x,y:c.image.y,width:c.image.width,height:c.image.height,href:c.image.href})):a?(c=a.stops.map(function(a,c){return f.tsx("stop",{key:c+"-stop",offset:a.offset,"stop-color":a.color})}),f.tsx("linearGradient",{id:a.id,gradientUnits:"userSpaceOnUse",x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},c)):null}function l(c,e,b){return a.translate(c,a.identity(c),[e,b])}function d(c,e,b,d,l){a.scale(c,
a.identity(c),[e,b]);c[4]=c[4]*e-d*e+d;c[5]=c[5]*b-l*b+l;return c}function q(c,e,b,d){var l=e%360*Math.PI/180;a.rotate(c,a.identity(c),l);e=Math.cos(l);var l=Math.sin(l),f=c[4],g=c[5];c[4]=f*e-g*l+d*l-b*e+b;c[5]=g*e+f*l-b*l-d*e+d;return c}function p(a,c){H&&"left"in H?(H.left>a&&(H.left=a),H.right<a&&(H.right=a),H.top>c&&(H.top=c),H.bottom<c&&(H.bottom=c)):H={left:a,bottom:c,right:a,top:c}}function x(a){var c=a.args,e=c.length;switch(a.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(a=
0;a<e;a+=2)p(c[a],c[a+1]);A.x=c[e-2];A.y=c[e-1];break;case "H":for(a=0;a<e;++a)p(c[a],A.y);A.x=c[e-1];break;case "V":for(a=0;a<e;++a)p(A.x,c[a]);A.y=c[e-1];break;case "m":a=0;"x"in A||(p(A.x=c[0],A.y=c[1]),a=2);for(;a<e;a+=2)p(A.x+=c[a],A.y+=c[a+1]);break;case "l":case "t":for(a=0;a<e;a+=2)p(A.x+=c[a],A.y+=c[a+1]);break;case "h":for(a=0;a<e;++a)p(A.x+=c[a],A.y);break;case "v":for(a=0;a<e;++a)p(A.x,A.y+=c[a]);break;case "c":for(a=0;a<e;a+=6)p(A.x+c[a],A.y+c[a+1]),p(A.x+c[a+2],A.y+c[a+3]),p(A.x+=c[a+
4],A.y+=c[a+5]);break;case "s":case "q":for(a=0;a<e;a+=4)p(A.x+c[a],A.y+c[a+1]),p(A.x+=c[a+2],A.y+=c[a+3]);break;case "A":for(a=0;a<e;a+=7)p(c[a+5],c[a+6]);A.x=c[e-2];A.y=c[e-1];break;case "a":for(a=0;a<e;a+=7)p(A.x+=c[a+5],A.y+=c[a+6])}}function B(a,c,e){var b=E[a.toLowerCase()];"number"===typeof b&&(b?c.length>=b&&(a={action:a,args:c.slice(0,c.length-c.length%b)},e.push(a),x(a)):(a={action:a,args:[]},e.push(a),x(a)))}function D(a){var c={x:0,y:0,width:0,height:0};if("circle"===a.type)c.x=a.cx-a.r,
c.y=a.cy-a.r,c.width=2*a.r,c.height=2*a.r;else if("ellipse"===a.type)c.x=a.cx-a.rx,c.y=a.cy-a.ry,c.width=2*a.rx,c.height=2*a.ry;else if("image"===a.type||"rect"===a.type)c.x=a.x,c.y=a.y,c.width=a.width,c.height=a.height;else if("path"===a.type){a=("string"!==typeof a.path?k(a.path):a.path).match(G);var e=[];H={};A={};if(a){for(var b="",d=[],l=a.length,f=0;f<l;++f){var g=a[f],p=parseFloat(g);isNaN(p)?(b&&B(b,d,e),d=[],b=g):d.push(p)}B(b,d,e);a={x:0,y:0,width:0,height:0};H&&"left"in H&&(a.x=H.left,
a.y=H.top,a.width=H.right-H.left,a.height=H.bottom-H.top)}else a=null;c.x=a.x;c.y=a.y;c.width=a.width;c.height=a.height}return c}function y(a){for(var c={x:0,y:0,width:0,height:0},e=null,b=Number.NEGATIVE_INFINITY,d=Number.NEGATIVE_INFINITY,l=0;l<a.length;l++){var f=a[l];e?(e.x=Math.min(e.x,f.x),e.y=Math.min(e.y,f.y),b=Math.max(b,f.x+f.width),d=Math.max(d,f.y+f.height)):(e=c,e.x=f.x,e.y=f.y,b=f.x+f.width,d=f.y+f.height)}e&&(e.width=b-e.x,e.height=d-e.y);return e}function z(c,e,f,g,p,k){var v=e/2,
m=f/2,h=c.width+g,x=c.height+g,y=b.mat2df32.create(),u=b.mat2df32.create(),n=!1;if(p&&0!==h&&0!==x){p=h/x;var n=e>f?e:f,z=1,B=1;isNaN(n)||(1<p?(z=n/h,B=n/p/x):(B=n/x,z=n*p/h));a.multiply(u,u,d(y,z,B,v,m));n=!0}p=c.x+(h-g)/2;c=c.y+(x-g)/2;a.multiply(u,u,l(y,v-p,m-c));!n&&(h>e||x>f)&&(v=h/e>x/f,e=(v?e:f)/(v?h:x),a.multiply(u,u,d(y,e,e,p,c)));k&&a.multiply(u,u,q(y,k,p,c));return"matrix("+u[0]+","+u[1]+","+u[2]+","+u[3]+","+u[4]+","+u[5]+")"}Object.defineProperty(n,"__esModule",{value:!0});var e=0,v=
0,C=h("chrome")?"auto":"optimizeLegibility",E={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},G=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,H={},A={},I={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};n.renderShape=u;n.generateFillAttributes=g;n.generateStrokeAttributes=r;n.generateTextAttributes=w;n.renderDef=c;n.getBoundingBox=D;n.computeBBox=
y;n.getTransformMatrix=z;n.renderSVG=function(a,e,b,d){for(var l=[],p=[],k=0;k<a.length;k++){for(var v=[],m=[],h=0,x=0,q=a[k];x<q.length;x++){var n=q[x],B=n.shape,C=n.fill,E=n.stroke,n=n.font,h=h+(E&&E.width||0),C=g(C),E=r(E),n="text"===B.type?w(B,n):null;l.push(c(C));v.push(u(B,C.fill,E,n));m.push(D(B))}m=z(y(m),e,b,h,d&&d.scale,d&&d.rotation);p.push(f.tsx("g",{transform:m},v))}return f.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:b},f.tsx("defs",null,l),p)}})},"esri/core/libs/gl-matrix-2/mat2df32":function(){define(["require",
"exports","./factories/mat2df32"],function(t,n,m){Object.defineProperty(n,"__esModule",{value:!0});n.mat2df32=m})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["require","exports"],function(t,n){Object.defineProperty(n,"__esModule",{value:!0});n.create=function(){var m=new Float32Array(6);m[0]=1;m[3]=1;return m};n.clone=function(m){var h=new Float32Array(6);h[0]=m[0];h[1]=m[1];h[2]=m[2];h[3]=m[3];h[4]=m[4];h[5]=m[5];return h};n.fromValues=function(m,h,b,a,f,k){var u=new Float32Array(6);
u[0]=m;u[1]=h;u[2]=b;u[3]=a;u[4]=f;u[5]=k;return u};n.createView=function(m,h){return new Float32Array(m,h,6)}})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["require","exports","./common"],function(t,n,m){function h(a,b,k){var f=b[0],g=b[1],m=b[2],h=b[3],c=b[4];b=b[5];var l=k[0],d=k[1],n=k[2],p=k[3],x=k[4];k=k[5];a[0]=f*l+m*d;a[1]=g*l+h*d;a[2]=f*n+m*p;a[3]=g*n+h*p;a[4]=f*x+m*k+c;a[5]=g*x+h*k+b;return a}function b(a,b,k){a[0]=b[0]-k[0];a[1]=b[1]-k[1];a[2]=b[2]-k[2];a[3]=b[3]-k[3];a[4]=
b[4]-k[4];a[5]=b[5]-k[5];return a}Object.defineProperty(n,"__esModule",{value:!0});n.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a};n.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};n.set=function(a,b,k,m,g,h,n){a[0]=b;a[1]=k;a[2]=m;a[3]=g;a[4]=h;a[5]=n;return a};n.invert=function(a,b){var f=b[0],m=b[1],g=b[2],h=b[3],n=b[4];b=b[5];var c=f*h-m*g;if(!c)return null;c=1/c;a[0]=h*c;a[1]=-m*c;a[2]=-g*c;a[3]=f*c;a[4]=(g*b-h*n)*c;a[5]=(m*
n-f*b)*c;return a};n.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};n.multiply=h;n.rotate=function(a,b,k){var f=b[0],g=b[1],m=b[2],h=b[3],c=b[4];b=b[5];var l=Math.sin(k);k=Math.cos(k);a[0]=f*k+m*l;a[1]=g*k+h*l;a[2]=f*-l+m*k;a[3]=g*-l+h*k;a[4]=c;a[5]=b;return a};n.scale=function(a,b,k){var f=b[1],g=b[2],m=b[3],h=b[4],c=b[5],l=k[0];k=k[1];a[0]=b[0]*l;a[1]=f*l;a[2]=g*k;a[3]=m*k;a[4]=h;a[5]=c;return a};n.translate=function(a,b,k){var f=b[0],g=b[1],m=b[2],h=b[3],c=b[4];b=b[5];var l=k[0];k=k[1];a[0]=
f;a[1]=g;a[2]=m;a[3]=h;a[4]=f*l+m*k+c;a[5]=g*l+h*k+b;return a};n.fromRotation=function(a,b){var f=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=f;a[2]=-f;a[3]=b;a[4]=0;a[5]=0;return a};n.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];a[4]=0;a[5]=0;return a};n.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=b[0];a[5]=b[1];return a};n.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};n.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],
2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};n.add=function(a,b,k){a[0]=b[0]+k[0];a[1]=b[1]+k[1];a[2]=b[2]+k[2];a[3]=b[3]+k[3];a[4]=b[4]+k[4];a[5]=b[5]+k[5];return a};n.subtract=b;n.multiplyScalar=function(a,b,k){a[0]=b[0]*k;a[1]=b[1]*k;a[2]=b[2]*k;a[3]=b[3]*k;a[4]=b[4]*k;a[5]=b[5]*k;return a};n.multiplyScalarAndAdd=function(a,b,k,m){a[0]=b[0]+k[0]*m;a[1]=b[1]+k[1]*m;a[2]=b[2]+k[2]*m;a[3]=b[3]+k[3]*m;a[4]=b[4]+k[4]*m;a[5]=b[5]+k[5]*m;return a};n.exactEquals=function(a,
b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]};n.equals=function(a,b){var f=a[0],h=a[1],g=a[2],n=a[3],t=a[4];a=a[5];var c=b[0],l=b[1],d=b[2],q=b[3],p=b[4];b=b[5];return Math.abs(f-c)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(c))&&Math.abs(h-l)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(l))&&Math.abs(g-d)<=m.EPSILON*Math.max(1,Math.abs(g),Math.abs(d))&&Math.abs(n-q)<=m.EPSILON*Math.max(1,Math.abs(n),Math.abs(q))&&Math.abs(t-p)<=m.EPSILON*Math.max(1,Math.abs(t),
Math.abs(p))&&Math.abs(a-b)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};n.mul=h;n.sub=b})},"esri/symbols/support/previewSymbol3D":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/colorUtils ../../core/compilerUtils ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./styleUtils ./utils".split(" "),function(t,n,m,h,b,a,
f,k,u,g,r,w,c,l,d,q,p){function x(a){var c=a.outline,e=k.isSome(a.material)?a.material.color:null,e=k.isSome(e)?e.toRgba().toString():null;if(k.isNone(c))return"fill"===a.type&&"255,255,255,1"===e?{color:"#bdc3c7",width:.75}:null;a=g.pt2px(c.size)||0;return{color:"rgba("+(k.isSome(c.color)?c.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function B(a,c){var e=c&&c.resource,e=e&&e.href;return a.thumbnail&&a.thumbnail.url?u.resolve(a.thumbnail.url):e&&"object"!==c.type?u.resolve(p.getIconHref(a,
c)):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?q.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal},"webRef").catch(function(a){return a}).then(function(a){return a&&a.thumbnail&&a.thumbnail.url||J}):u.resolve(J)}function D(a,c){void 0===c&&(c=1);var e=a.a;a=h.toHSV(a);c=h.toRGB({h:a.h,s:a.s/c,v:100-(100-a.v)/c});return[c.r,c.g,c.b,e]}function y(a,c){return Math.round(Math.min(Math.max(a+191.25*c,0),255))}function z(a){return"water"===a.type?k.isNone(a.color)?
null:a.color:k.isNone(a.material)||k.isNone(a.material.color)?null:a.material.color}function e(a,c){void 0===c&&(c=0);a=z(a);if(!a)return c=y(r.defaultThematicColor.r,c),[c,c,c,100];a=a.toRgba();for(var e=0;3>e;e++)a[e]=y(a[e],c);return a}function v(a){return a.outline?x(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function C(a,c){a=z(a);if(!a)return null;var e;e="rgba("+(y(a.r,c)+",");e+=y(a.g,c)+",";e+=y(a.b,c)+",";return e+a.a+");"}function E(a,c){c=C(a,c);if(!c)return{};a=Math.min(a.size?g.pt2px(a.size):
.75,80);return{color:c,width:a}}function G(a,c,e){e*=.75;return{type:"linear",x1:e?.25*e:0,y1:e?.5*e:0,x2:e||4,y2:e?.5*e:4,colors:[{color:a,offset:0},{color:c,offset:1}]}}function H(a){var c=a.depth,e=a.height;return(a=a.width)&&c&&e&&a===c&&a<e}function A(a,d,g){var f=[];if(!a)return f;switch(a.type){case "icon":var p=a.resource&&a.resource.primitive||w.defaultPrimitive;switch(p){case "circle":f.push({shape:{type:"circle",cx:0,cy:0,r:.5*d},fill:e(a,0),stroke:x(a)});break;case "square":f.push({shape:{type:"path",
path:[{command:"M",values:[0,d]},{command:"L",values:[0,0]},{command:"L",values:[d,0]},{command:"L",values:[d,d]},{command:"Z",values:[]}]},fill:e(a,0),stroke:x(a)});break;case "triangle":f.push({shape:{type:"path",path:[{command:"M",values:[0,d]},{command:"L",values:[.5*d,0]},{command:"L",values:[d,d]},{command:"Z",values:[]}]},fill:e(a,0),stroke:x(a)});break;case "cross":f.push({shape:{type:"path",path:[{command:"M",values:[.5*d,0]},{command:"L",values:[.5*d,d]},{command:"M",values:[0,.5*d]},{command:"L",
values:[d,.5*d]}]},stroke:v(a)});break;case "x":f.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[d,d]},{command:"M",values:[d,0]},{command:"L",values:[0,d]}]},stroke:v(a)});break;case "kite":f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[.5*d,0]},{command:"L",values:[d,.5*d]},{command:"L",values:[.5*d,d]},{command:"Z",values:[]}]},fill:e(a,0),stroke:x(a)});break;default:b.neverReached(p)}break;case "object":switch(p=a.resource&&
a.resource.primitive||c.defaultPrimitive,p){case "cone":p=e(a,0);a=e(a,-.6);a=G(p,a,g?20:d);d=l.getConeShapes(d,g);f.push({shape:d[0],fill:a});f.push({shape:d[1],fill:a});break;case "inverted-cone":g=e(a,0);a=e(a,-.6);a=G(g,a,d);d=l.getInvertedConeShapes(d);f.push({shape:d[0],fill:a});f.push({shape:d[1],fill:g});break;case "cube":d=l.getCubeShapes(d,g);f.push({shape:d[0],fill:e(a,0)});f.push({shape:d[1],fill:e(a,-.3)});f.push({shape:d[2],fill:e(a,-.5)});break;case "cylinder":var p=e(a,0),k=e(a,-.6),
p=G(p,k,g?20:d);d=l.getCylinderShapes(d,g);f.push({shape:d[0],fill:p});f.push({shape:d[1],fill:p});f.push({shape:d[2],fill:e(a,0)});break;case "diamond":d=l.getDiamondShapes(d);f.push({shape:d[0],fill:e(a,-.3)});f.push({shape:d[1],fill:e(a,0)});f.push({shape:d[2],fill:e(a,-.3)});f.push({shape:d[3],fill:e(a,-.7)});break;case "sphere":g=e(a,0);a=e(a,-.6);a=G(g,a);a.x1=0;a.y1=0;a.x2=.25*d;a.y2=.25*d;f.push({shape:{type:"circle",cx:0,cy:0,r:.5*d},fill:a});break;case "tetrahedron":d=l.getTetrahedronShapes(d);
f.push({shape:d[0],fill:e(a,-.3)});f.push({shape:d[1],fill:e(a,0)});f.push({shape:d[2],fill:e(a,-.6)});break;default:b.neverReached(p)}}return f}function I(a,c){var e=c&&c.size?g.pt2px(c.size):null,b=c&&c.maxSize?g.pt2px(c.maxSize):null,l=c&&c.disableUpsampling,f=a.symbolLayers,p=[],v=0,k=0,m=f.getItemAt(f.length-1),h;m&&"icon"===m.type&&(h=m.size&&g.pt2px(m.size));f.forEach(function(f,m){if("icon"===f.type||"object"===f.type){var x="icon"===f.type?f.size&&g.pt2px(f.size):0,n=e||x?Math.ceil(Math.min(e||
x,b||120)):22;f&&f.resource&&f.resource.href?(m=B(a,f).then(function(a){var c=f.get("material.color"),e;e="icon"===f.type?"multiply":"tint";return d.tintImageWithColor(a,n,c,e,l)}).then(function(a){var c=a.width,e=a.height;v=Math.max(v,c);k=Math.max(k,e);return[{shape:{type:"image",x:0,y:0,width:c,height:e,src:a.url},fill:null,stroke:null}]}),p.unshift(m)):(m=n,"icon"===f.type&&h&&e&&(m=x/h*n),x=c&&"tall"===c.symbolConfig||("object"===f.type?H(f):!1),v=Math.max(v,x?20:m),k=Math.max(k,m),p.unshift(u.resolve(A(f,
m,x))))}});return u.eachAlways(p).then(function(a){var e=[];a.forEach(function(a){a.value?e.push(a.value):a.error&&S.warn("error while building swatchInfo!",a.error)});return d.renderSymbol(e,[v,k],{node:c&&c.node,scale:!1,opacity:c&&c.opacity})})}function M(a,c){var b=a.symbolLayers,f=[];a=p.isVolumetricSymbol(a);var v=c&&c.size?g.pt2px(c.size):null,k=(c&&c.maxSize?g.pt2px(c.maxSize):null)||80,h=0,x=0,n;b.forEach(function(a,c){if(a&&("line"===a.type||"path"===a.type)){var b=[];switch(a.type){case "line":var d=
E(a,0),g=d&&d.width||0;0===c&&(n=g);var p=Math.min(v||g,k);c=0===c?p:v?g/n*p:p;x=Math.max(x,c);h=Math.max(h,20<c?2*c:40);d.width=c;b.push({shape:{type:"path",path:[{command:"M",values:[0,.5*x]},{command:"L",values:[h,.5*x]}]},stroke:d});break;case "path":c=Math.min(v||22,k);g=e(a,0);p=e(a,-.2);d=(d=C(a,-.4))?{color:d,width:1}:{};if("quad"===a.profile){var y=a.width||a.size;a=a.height||a.size;a=l.getPathSymbolShapes(y&&a?y/a:1);d=m({},d,{join:"bevel"});b.push({shape:a[0],fill:p,stroke:d});b.push({shape:a[1],
fill:p,stroke:d});b.push({shape:a[2],fill:g,stroke:d})}else b.push({shape:l.shapes.pathSymbol3DLayer[0],fill:p,stroke:d}),b.push({shape:l.shapes.pathSymbol3DLayer[1],fill:g,stroke:d});h=x=Math.max(x,c)}f.push(b)}});return u.resolve(d.renderSymbol(f,[h,x],{node:c&&c.node,scale:a,opacity:c&&c.opacity}))}Object.defineProperty(n,"__esModule",{value:!0});var J=t.toUrl("../../images/Legend/legend3dsymboldefault.png"),S=f.getLogger("esri.symbols.support.previewSymbol3D");n.getSymbolLayerFill=e;n.previewSymbol3D=
function(c,b){if(0===c.symbolLayers.length)return u.reject(new a("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var f=null;switch(c.type){case "point-3d":f=I(c,b);break;case "line-3d":f=M(c,b);break;case "polygon-3d":case "mesh-3d":f="mesh-3d"===c.type;c=c.symbolLayers;for(var p=b&&b.size?g.pt2px(b.size):null,v=b&&b.maxSize?g.pt2px(b.maxSize):null,p=p||22,k=[],h=0,n=0,y=!1,q=0;q<c.length;q++){var B=c.getItemAt(q),C=[];if(!f||"fill"===B.type){var r=l.shapes.fill[0];switch(B.type){case "fill":var t=
x(B),G=Math.min(p,v||120),h=Math.max(h,G),n=Math.max(n,G),y=!0;C.push({shape:r,fill:e(B,0),stroke:t});break;case "line":r={stroke:E(B,0),shape:r};h=Math.max(h,22);n=Math.max(n,22);C.push(r);break;case "extrude":var t=m({join:"round"},E(B,-.4)),r=e(B,0),B=e(B,-.2),G=Math.min(p,v||120),A=l.getExtrudeSymbolShapes(G);t.width=1;C.push({shape:A[0],fill:B,stroke:t});C.push({shape:A[1],fill:B,stroke:t});C.push({shape:A[2],fill:r,stroke:t});r=22*.7+.5*G;h=Math.max(h,22);n=Math.max(n,r);break;case "water":y=
z(B),r=D(y),B=D(y,2),t=D(y,3),G=l.getWaterSymbolShapes(),y=!0,C.push({shape:G[0],fill:r}),C.push({shape:G[1],fill:B}),C.push({shape:G[2],fill:t}),G=Math.min(p,v||120),h=Math.max(h,G),n=Math.max(n,G)}k.push(C)}}f=u.resolve(d.renderSymbol(k,[h,n],{node:b&&b.node,scale:y,opacity:b&&b.opacity}))}return f?f:u.reject(new a("symbolPreview: swatchInfo3D","symbol not supported."))}})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/compilerUtils ../../core/has ../../core/Logger ../../core/maybe ../../core/screenUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(t,n,m,h,b,a,f,k,u,g,r){function w(a,c){if(null==c)return a;a=a.toRgba();a[3]*=c;return new m(a)}function c(a,c,b){if(a=a.symbolLayers){var d=function(a){a=k.isSome(a)?a:null;c=c||a||null!=b&&p;return w(c,b)};a.forEach(function(a){if("water"===a.type)a.color=d(a.color);else{var c=k.isSome(a.material)?a.material.color:null,c=d(c);k.isNone(a.material)?a.material=new r.default({color:c}):a.material.color=c;null!=b&&"outline"in a&&k.isSome(a.outline)&&k.isSome(a.outline.color)&&(a.outline.color=
w(a.outline.color,b))}})}}function l(a,c,b){(a=a.symbolLayers)&&a.forEach(function(a){if(a)switch(a.type){case "icon":case "line":case "path":case "extrude":case "text":a.size=c;break;case "object":switch(b){case "width":a.width=c;break;case "depth":a.depth=c;break;case "height":a.height=c;break;case "width-and-depth":a.width=c;a.depth=c;break;default:a.width=c,a.depth=c,a.height=c}break;default:d.warn("symbolUtils: applySizeToSymbol","symbolLayer not supported")}})}Object.defineProperty(n,"__esModule",
{value:!0});var d=f.getLogger("esri.symbols.support.utils"),q=/\/resource\/(.*?)\.svg$/,p=new m("white");n.getSymbolOutlineSize=function(a){if(!a)return 0;if(h.isSymbol3D(a)){var c=a.symbolLayers&&a.symbolLayers.length;c?(a=a.symbolLayers.getItemAt(c-1),a="outline"in a?k.get(a,"outline","size"):void 0):a=void 0;return k.isSome(a)?a:0}return(a=g.getStroke(a))&&u.px2pt(a.width)||0};n.isVolumetricSymbol=function(a){if(!a||!a.symbolLayers)return!1;switch(a.type){case "point-3d":return a.symbolLayers.some(function(a){return"object"===
a.type});case "line-3d":return a.symbolLayers.some(function(a){return"path"===a.type});case "polygon-3d":return a.symbolLayers.some(function(a){return"object"===a.type||"extrude"===a.type});default:return!1}};n.getIconHref=function(c,b){b=b.resource.href;return!a("esri-canvas-svg-support")&&c.styleOrigin&&q.test(b)?b.replace(q,"/resource/png/$1.png"):b};n.applyOpacityToColor=w;n.applyColorToSymbol=function(a,b,d){if(a&&(b||null!=d))if(b&&(b=new m(b)),h.isSymbol3D(a))c(a,b,d);else if(h.isSymbol2D(a)){if(b=
b||a.color)a.color=w(b,d);null!=d&&"outline"in a&&a.outline&&a.outline.color&&(a.outline.color=w(a.outline.color,d))}};n.applySizeToSymbol=function(a,c,d){if(a&&null!=c)if(h.isSymbol3D(a))l(a,c,d);else if(h.isSymbol2D(a))switch(a.type){case "simple-marker":a.size=c;break;case "picture-marker":d=a.width/a.height;1<d?(a.width=c,a.height=c*d):(a.width=c*d,a.height=c);break;case "simple-line":a.width=c;break;case "text":a.font.size=c;break;case "simple-fill":case "picture-fill":break;case "cim":break;
default:b.neverReached(a)}};n.applyRotationToSymbol=function(a,c,b){a&&null!=c&&(h.isSymbol3D(a)?(a=a.symbolLayers)&&a.forEach(function(a){if(a&&"object"===a.type)switch(b){case "tilt":a.tilt=c;break;case "roll":a.roll=c;break;default:a.heading=c}}):!h.isSymbol2D(a)||"simple-marker"!==a.type&&"picture-marker"!==a.type&&"text"!==a.type||(a.angle=c))}})},"esri/symbols/support/previewWebStyleSymbol":function(){define(["require","exports","../../request","../../core/screenUtils"],function(t,n,m,h){Object.defineProperty(n,
"__esModule",{value:!0});n.previewWebStyleSymbol=function(b,a,f){var k=b.thumbnail&&b.thumbnail.url;return k?m(k,{responseType:"image"}).then(function(a){a=a.data;var b=!/\\.svg$/i.test(a.src)&&f&&f.disableUpsampling,k=Math.max(a.width,a.height),m=f&&null!=f.maxSize?h.pt2px(f.maxSize):120;b&&(m=Math.min(k,m));b=Math.min(m,f&&null!=f.size?h.pt2px(f.size):k);b!==k&&(k=0!==a.width&&0!==a.height?a.width/a.height:1,1<=k?(a.width=b,a.height=b/k):(a.width=b*k,a.height=b));return f&&f.node?(f.node.appendChild(a),
f.node):a}):b.fetchSymbol().then(function(b){return a(b,f)})}})},"esri/widgets/Legend/support/colorRampUtils":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../Color ../../../core/promiseUtils ./utils @dojo/framework/shim/Promise".split(" "),function(t,n,m,h,b,a,f){function k(a,b){var c=[],l=a.length-1;5===a.length?c.push(0,2,4):c.push(0,l);return a.map(function(a,d){return-1<c.indexOf(d)?f.createStopLabel(a,d,l,b):null})}function u(a,
l,d){void 0===d&&(d=w);return m(this,void 0,void 0,function(){var c,f;return h(this,function(g){switch(g.label){case 0:return c=new b(d),[4,new Promise(function(a,c){t(["../../../renderers/visualVariables/support/visualVariableUtils"],a,c)})];case 1:return f=g.sent().getOpacity(l,a),null!=f&&(c.a=f),[2,c]}})})}function g(a,l){a=r(a,l);var c=a.startIndex,f=a.endIndex;if(c===f)return l[c].color;l=b.blendColors(l[c].color,l[f].color,a.weight);return new b(l)}function r(a,b){var c=0,l=b.length-1;b.some(function(b,
d){if(a<b.value)return l=d,!0;c=d;return!1});return{startIndex:c,endIndex:l,weight:(a-b[c].value)/(b[l].value-b[c].value)}}Object.defineProperty(n,"__esModule",{value:!0});var w=new b([64,64,64]);n.getRampStops=function(c,b,d){return m(this,void 0,void 0,function(){var l,f,g,n,r,y,z,e,v=this;return h(this,function(p){switch(p.label){case 0:l=!1;f=[];g=[];c.stops&&(n=c.stops,f=n.map(function(a){return a.value}),(l=n.some(function(a){return!!a.label}))&&(g=n.map(function(a){return a.label})));r=f[0];
y=f[f.length-1];if(null==r&&null==y)return[2,null];z=l?null:k(f,d);return[4,a.all(f.map(function(a,e){return m(v,void 0,void 0,function(){var d,f,p;return h(this,function(k){switch(k.label){case 0:return"opacity"!==c.type?[3,2]:[4,u(a,c,b)];case 1:return f=k.sent(),[3,4];case 2:return[4,new Promise(function(a,c){t(["../../../renderers/visualVariables/support/visualVariableUtils"],a,c)})];case 3:f=k.sent().getColor(c,a),k.label=4;case 4:return d=f,p=l?g[e]:z[e],[2,{value:a,color:d,label:p}]}})})}))];
case 1:return e=p.sent(),[2,e.reverse()]}})})};n.getRampStopsForPointCloud=function(a){var c=!1,b=[],f=[],b=a.map(function(a){return a.value});(c=a.some(function(a){return!!a.label}))&&(f=a.map(function(a){return a.label}));var p=b[b.length-1];if(null==b[0]&&null==p)return null;var m=c?null:k(b,!1);return b.map(function(b,d){var l=g(b,a);return{value:b,color:l,label:c?f[d]:m[d]}}).reverse()};n.getColorFromPointCloudStops=g;n.getStrectchRampStops=function(a,l){var c=[];if(a&&"multipart"===a.type)a.colorRamps.reverse().forEach(function(d,
f){0===f?c.push({value:l.max,color:new b(d.toColor),label:"high"}):c.push({value:null,color:new b(d.toColor),label:""});f===a.colorRamps.length-1?c.push({value:l.min,color:new b(d.fromColor),label:"low"}):c.push({value:null,color:new b(d.fromColor),label:""})});else{var f=void 0,g=void 0;a&&"algorithmic"===a.type?(f=a.fromColor,g=a.toColor):(f=[0,0,0,1],g=[255,255,255,1]);c=[{value:l.max,color:new b(g),label:"high"},{value:l.min,color:new b(f),label:"low"}]}return c}})},"esri/widgets/Legend/support/utils":function(){define(["require",
"exports","../../../intl/date","../../../renderers/support/numberUtils"],function(t,n,m,h){Object.defineProperty(n,"__esModule",{value:!0});var b=m.convertDateFormatToIntlOptions("short-date");n.createStopLabel=function(a,f,k,n){var g="";0===f?g="\x3c ":f===k&&(g="\x3e ");f=null;f=n?m.formatDate(a,b):h.format(a);return g+f};n.RGB_IMG_SOURCE=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII\x3d",
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII\x3d","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII\x3d"]})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["require","exports","../../../renderers/support/HeatmapColorStop"],
function(t,n,m){Object.defineProperty(n,"__esModule",{value:!0});n.getHeatmapRampStops=function(h){h=h.colorStops;var b=h.length-1;if(h&&h[0]){var a=h[b];a&&1!==a.ratio&&(h=h.slice(0),h.push(new m.HeatmapColorStop({ratio:1,color:a.color})),b++)}return h.map(function(a,k){var f="";0===k?f="low":k===b&&(f="high");return{color:a.color,label:f,ratio:a.ratio}}).reverse()}})},"esri/widgets/Legend/support/relationshipRampUtils":function(){define(["require","exports","../../../symbols/support/gfxUtils","../../../symbols/support/previewSymbol3D"],
function(t,n,m,h){function b(a){if(a){var b=a.type;return-1<b.indexOf("3d")?h.getSymbolLayerFill(a.symbolLayers.getItemAt(0)):"simple-line"===b||"simple-marker"===a.type&&("x"===a.style||"cross"===a.style)?(a=m.getStroke(a))&&a.color:m.getFill(a)}}function a(a,b){var f=b.HH.label,c=b.LL.label,l=b.HL.label;b=b.LH.label;switch(a){case "HH":return{top:f,bottom:c,left:l,right:b};case "HL":return{top:l,bottom:b,left:c,right:f};case "LL":return{top:c,bottom:f,left:b,right:l};case "LH":return{top:b,bottom:l,
left:f,right:c};default:return{top:f,bottom:c,left:l,right:b}}}function f(a){var b=k[a];a&&null==b&&(b=k.HH);return b||0}Object.defineProperty(n,"__esModule",{value:!0});var k={HH:315,HL:45,LL:135,LH:225},u={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};n.getRelationshipRampElement=function(g){var k=g.focus,m=g.numClasses,c=u[m],l={};g.infos.forEach(function(a){l[a.value]=
{label:a.label,fill:b(a.symbol)}});g=[];for(var d=0;d<m;d++){for(var h=[],p=0;p<m;p++)h.push(l[c[d][p]].fill);g.push(h)}c=a(k,l);return{type:"relationship-ramp",numClasses:m,focus:k,colors:g,labels:c,rotation:f(k)}};n.getRotationAngleForFocus=f})},"esri/widgets/Legend/support/sizeRampUtils":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../symbols ../../../core/promiseUtils ../../../renderers/support/numberUtils ../../../symbols/support/utils ./utils @dojo/framework/shim/Promise".split(" "),
function(t,n,m,h,b,a,f,k,u){function g(a,c){var e=a.length-1;return a.map(function(a,b){return u.createStopLabel(a,b,e,c)})}function r(a,e){var b=null,d=null;"simple"===a.type?b=a.symbol:"class-breaks"===a.type?(b=(a=a.classBreakInfos)&&a[0]&&a[0].symbol,d=1<a.length):"unique-value"===a.type&&(b=(a=a.uniqueValueInfos)&&a[0]&&a[0].symbol,d=1<a.length);if(!b||w(b))return null;b=b.clone();if(e||d)-1<b.type.indexOf("3d")?c(b):(e=b,-1!==e.type.indexOf("line")?e.color=y:(e.color=B,"simple-marker"===e.type&&
(e.outline={color:y,width:1.5})));return b}function w(a){return a?b.isSymbol3D(a)?a.symbolLayers?a.symbolLayers.some(function(a){return a&&"fill"===a.type}):!1:-1!==a.type.indexOf("fill"):!1}function c(a){k.isVolumetricSymbol(a)||("line-3d"===a.type?a.symbolLayers.forEach(function(a){a.material={color:y}}):a.symbolLayers.forEach(function(a){"icon"!==a.type||a.resource&&a.resource.href?a.material={color:D}:(a.material={color:B},a.outline={color:y,size:1.5})}))}function l(a,c,b,l){return m(this,void 0,
void 0,function(){var e,g,p,k,v;return h(this,function(m){switch(m.label){case 0:return[4,new Promise(function(a,c){t(["../../../renderers/visualVariables/support/visualVariableUtils"],a,c)})];case 1:g=(e=m.sent().getSizeRangeAtScale(a,b,l))&&d(e);if(!e&&!g)return[2,void 0];p=g.map(function(c){var b=e.minSize,d=e.maxSize,l=a.minDataValue,f=a.maxDataValue;return c<=b?l:c>=d?f:(c-b)/(d-b)*(f-l)+l});p=f.round(p);k=1;m.label=2;case 2:return k<p.length-1?[4,q(a,c,p[k],p[k-1],b,l)]:[3,5];case 3:if(v=m.sent())p[k]=
v[0],g[k]=v[1];m.label=4;case 4:return k++,[3,2];case 5:return[2,p]}})})}function d(a){var c=a.minSize;a=(a.maxSize-c)/4;for(var b=[],d=0;5>d;d++)b.push(c+a*d);return b}function q(a,c,b,d,l,g){return m(this,void 0,void 0,function(){var e,k,m,v,n,y,q,C,u,x,z,B,r,E,t,G,D,w,Q,ca,V,W;return h(this,function(h){switch(h.label){case 0:return[4,p(a,c,b,l,g)];case 1:return k=h.sent(),[4,p(a,c,d,l,g)];case 2:m=h.sent(),v=f.numDigits(b),n=v.fractional,y=20,q=v.integer,u=C=null,0<b&&1>b&&(C=Math.pow(10,n),b*=
C,q=f.numDigits(b).integer),x=q-1,h.label=3;case 3:if(!(0<=x))return[3,8];z=Math.pow(10,x);B=Math.floor(b/z)*z;r=Math.ceil(b/z)*z;null!=C&&(B/=C,r/=C);E=(B+r)/2;e=f.round([B,E,r],{indexes:[1]});E=e[1];return[4,p(a,c,B,l,g)];case 4:return t=h.sent(),[4,p(a,c,r,l,g)];case 5:return G=h.sent(),[4,p(a,c,E,l,g)];case 6:D=h.sent();w=f.percentChange(k,t,m,null);Q=f.percentChange(k,G,m,null);ca=f.percentChange(k,D,m,null);V=w.previous<=y;W=Q.previous<=y;V&&W&&(w.previous<=Q.previous?(V=!0,W=!1):(W=!0,V=!1));
V?u=[B,t]:W?u=[r,G]:ca.previous<=y&&(u=[E,D]);if(u)return[3,8];h.label=7;case 7:return x--,[3,3];case 8:return[2,u]}})})}function p(a,c,b,d,l){return m(this,void 0,void 0,function(){var e;return h(this,function(f){switch(f.label){case 0:return[4,new Promise(function(a,c){t(["../../../renderers/visualVariables/support/visualVariableUtils"],a,c)})];case 1:return e=f.sent().getSize,[2,e(a,b,{scale:d,view:l,shape:"simple-marker"===c.type?c.style:null})]}})})}function x(a,c){a=a.clone();if(b.isSymbol3D(a))k.isVolumetricSymbol(a)||
a.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=c)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=c;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){var e=a.width,d=a.height;a.height=c;a.width=e/d*c}else"esri.symbols.SimpleLineSymbol"===a.declaredClass?a.width=c:"esri.symbols.TextSymbol"===a.declaredClass&&a.font&&(a.font.size=c);return a}Object.defineProperty(n,"__esModule",{value:!0});n.REAL_WORLD_MAX_SIZE=30;n.REAL_WORLD_MIN_SIZE=12;var B=[255,255,
255],D=[200,200,200],y=[128,128,128];n.getRampStops=function(c,e,b,d,y,q){return m(this,void 0,void 0,function(){var v,u,C,B,z,E,t,D,G,w,F,L,N,X,Y,O,R,U=this;return h(this,function(A){switch(A.label){case 0:u=(v=e.legendOptions)&&v.customValues;C=r(c,b);B=!!C;z=!!u;E=null!=e.minSize&&null!=e.maxSize;t=e.stops&&1<e.stops.length;D=!!e.target;if(!B||!(z||E||t&&!D))return[2,void 0];G=k.isVolumetricSymbol(C);L=F=w=null;if(!G||t)return[3,1];F=f.round([e.minDataValue,e.maxDataValue]);return[3,4];case 1:return(N=
u)?[3,3]:[4,l(e,C,d,y)];case 2:N=A.sent(),A.label=3;case 3:F=N,A.label=4;case 4:!F&&t&&(F=e.stops.map(function(a){return a.value}),(w=e.stops.some(function(a){return!!a.label}))&&(L=e.stops.map(function(a){return a.label})));G&&F&&2<F.length&&(F=[F[0],F[F.length-1]]);if(!F)return[2,null];X=[n.REAL_WORLD_MIN_SIZE,n.REAL_WORLD_MAX_SIZE];Y=k.getSymbolOutlineSize(C);O=w?null:g(F,q);return[4,a.all(F.map(function(a,c){return m(U,void 0,void 0,function(){var b,l,f,g;return h(this,function(k){switch(k.label){case 0:if(!G)return[3,
1];f=X[c];return[3,3];case 1:return[4,p(e,C,a,d,y)];case 2:f=k.sent(),k.label=3;case 3:return b=f,l=x(C,b),g=w?L[c]:O[c],[2,{value:a,symbol:l,label:g,size:b,outlineSize:Y}]}})})}))];case 5:return R=A.sent(),[2,R.reverse()]}})})}})},"esri/widgets/Legend/styles/Card":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper dojo/i18n!../../../nls/common dojo/i18n!../../Legend/nls/Legend ../../../intl ../../../core/Handles ../../../core/screenUtils ../../../core/accessorSupport/decorators ../../../symbols/support/svgUtils ../../Widget ./support/utils ../support/styleUtils ../../support/colorUtils ../../support/widget".split(" "),
function(t,n,m,h,b,a,f,k,u,g,r,w,c,l,d,q,p){var x=window.devicePixelRatio;return function(c){function b(a){a=c.call(this)||this;a._handles=new u;a._hasIndicators=!1;a._selectedSectionName=null;a._sectionNames=[];a._sectionMap=new Map;a.activeLayerInfos=null;a.layout="stack";a.type="card";a.view=null;return a}m(b,c);b.prototype.postInitialize=function(){var a=this;this.own([this.watch("activeLayerInfos",function(c){a._handles.removeAll();a._watchForSectionChanges(c)})])};b.prototype.destroy=function(){this._handles.destroy();
this._handles=null};b.prototype.render=function(){var c=this,b;this._hasIndicators="auto"===this.layout&&768>=this.view.container.clientWidth||"stack"===this.layout;var e=this.activeLayerInfos,d=e&&e.toArray().map(function(a){return c._renderLegendForLayer(a)}).filter(function(a){return!!a});this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;
var l=this._sectionNames.length,e=this._sectionNames.map(function(e,b){var d;b=k.substitute(a.pagination.pageText,{index:b+1,total:l});return p.tsx("div",{key:e,"aria-label":b,title:b,tabIndex:0,onclick:c._selectSection,onkeydown:c._selectSection,bind:c,class:c.classes("esri-legend--card__carousel-indicator",(d={},d["esri-legend--card__carousel-indicator--activated"]=c._selectedSectionName===e,d)),"data-section-name":e})}),e=this._hasIndicators&&1<l?p.tsx("div",{class:"esri-legend--card__carousel-indicator-container",
key:"carousel-navigation"},e):null,d=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):d&&d.length?d:null,g=(b={},b["esri-legend--stacked"]=this._hasIndicators,b);return p.tsx("div",{class:this.classes("esri-legend--card esri-widget",g)},e,d?d:p.tsx("div",{class:"esri-legend--card__message"},f.noLegend))};b.prototype._selectSection=function(a){if(a=a.target.getAttribute("data-section-name"))this._selectedSectionName=a};b.prototype._watchForSectionChanges=function(a){var c=this;this._generateSectionNames();
a&&(a.forEach(function(a){var e="activeLayerInfo-"+a.layer.uid+"-version-change";c._handles.remove(e);c._watchForSectionChanges(a.children);c._handles.add(a.watch("version",function(){return c._generateSectionNames()}),e)}),this._handles.remove("activeLayerInfos-collection-change"),this._handles.add(a.on("change",function(){return c._watchForSectionChanges(a)}),"activeLayerInfos-collection-change"))};b.prototype._generateSectionNames=function(){this._sectionNames.length=0;this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,
this)};b.prototype._generateSectionNamesForActiveLayerInfo=function(a){var c=this;a.children.forEach(this._generateSectionNamesForActiveLayerInfo,this);a.legendElements&&a.legendElements.forEach(function(e,b){c._sectionNames.push("esri-legend--card__"+a.layer.uid+"-type-"+e.type+"-"+b)})};b.prototype._renderLegendForLayer=function(a){var c=this,e;if(!a.ready)return null;if(a.children.length)return e=a.children.map(function(a){return c._renderLegendForLayer(a)}).toArray(),p.tsx("div",{key:a.layer.uid,
class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},p.tsx("div",{class:"esri-legend--card__service-caption-container"},a.title),e);var b=a.legendElements;if(b&&!b.length)return null;var d=b.some(function(a){return"relationship-ramp"===a.type}),b=b.map(function(e,b){return c._renderLegendForElement(e,a,b,d)}).filter(function(a){return!!a});if(!b.length)return null;var l=(e={},e["esri-legend--card__group-layer-child"]=!!a.parent,e);return p.tsx("div",{key:a.layer.uid,
class:this.classes("esri-legend--card__service",l)},p.tsx("div",{class:"esri-legend--card__service-caption-container"},p.tsx("div",{class:"esri-legend--card__service-caption-text"},a.title)),p.tsx("div",{class:"esri-legend--card__service-content"},b))};b.prototype._renderLegendForElement=function(a,c,e,b){var f=this;void 0===b&&(b=!1);var g,k="color-ramp"===a.type,m="opacity-ramp"===a.type,h="size-ramp"===a.type,v=c.layer,n=a.title,q=null;"string"===typeof n?q=n:n&&(q=d.getTitle(n,k||m),q=n.title?
n.title+" ("+q+")":q);e="esri-legend--card__"+v.uid+"-type-"+a.type+"-"+e;n=this._hasIndicators?p.tsx("div",null,p.tsx("h3",{class:this.classes("esri-widget__heading","esri-legend--card__carousel-title")},c.title),p.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},q)):q?p.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},q):null;q=null;"symbol-table"===a.type?(h=a.infos.map(function(e,b){return f._renderLegendForElementInfo(e,
c,a.legendType,b)}).filter(function(a){return!!a}),h.length&&(v=h[0].properties.classes&&h[0].properties.classes["esri-legend--card__symbol-row"],b=(g={},g["esri-legend--card__label-container"]=!v&&!b,g["esri-legend--card__relationship-label-container"]=b,g),q=p.tsx("div",{key:e,class:"esri-legend--card__section"},n,p.tsx("div",{class:this.classes(b)},h)))):"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?q=p.tsx("div",{key:e,class:"esri-legend--card__section"},n,this._renderLegendForRamp(a,
v.opacity)):h?q=p.tsx("div",{key:e,class:"esri-legend--card__section"},n,this._renderSizeRamps(a,v.opacity)):"relationship-ramp"===a.type&&(q=p.tsx("div",{key:e,class:this.classes("esri-legend--card__section","esri-legend--card__relationship-section")},n,l.renderRelationshipRamp(a,this.id,v.opacity)));if(!q)return null;this._sectionMap.set(e,q);return q};b.prototype._renderLegendForElementInfo=function(a,c,e,b){var l,f,g,k=c.layer;if(a.type)return this._renderLegendForElement(a,c,b);c=d.isImageryStretchedLegend(k,
e);if(a.symbol&&a.preview){if(-1===a.symbol.type.indexOf("simple-fill")){if(!a.label)return p.tsx("div",{key:b,bind:a.preview,afterCreate:d.attachToNode});k=(l={},l["esri-legend--card__symbol-cell"]=this._hasIndicators,l);return p.tsx("div",{key:b,class:this.classes("esri-legend--card__layer-row",(f={},f["esri-legend--card__symbol-row"]=this._hasIndicators,f))},p.tsx("div",{class:this.classes(k),bind:a.preview,afterCreate:d.attachToNode}),p.tsx("div",{class:this.classes("esri-legend--card__image-label",
(g={},g["esri-legend--card__label-cell"]=this._hasIndicators,g))},d.getTitle(a.label,!1)||""))}g=f=l=255;c=0;var m=e=255,h=255,v=0,n=a.symbol.color&&a.symbol.color.a,u=a.symbol.outline&&a.symbol.outline.color&&a.symbol.outline.color.a;n&&(l=a.symbol.color.r,f=a.symbol.color.g,g=a.symbol.color.b,c=a.symbol.color.a*k.opacity);u&&(e=a.symbol.outline.color.r,m=a.symbol.outline.color.g,h=a.symbol.outline.color.b,v=a.symbol.outline.color.a*k.opacity);var x=(k=a.symbol.color?q.isBright(a.symbol.color):!0)?
"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return p.tsx("div",{key:b,class:"esri-legend--card__layer-row"},p.tsx("div",{class:"esri-legend--card__label-element",styles:{background:n?"rgba("+l+", "+f+", "+g+", "+c+")":"none",color:k?"black":"white",textShadow:"-1px -1px 0 "+x+",\n                                              1px -1px 0 "+x+",\n                                              -1px 1px 0 "+x+",\n                                              1px 1px 0 "+x,border:u?"1px solid rgba("+e+
", "+m+", "+h+", "+v+")":"none"}}," ",a.label," "))}if(a.src)return k=this._renderImage(a,k,c),p.tsx("div",{key:b,class:"esri-legend--card__layer-row"},k,p.tsx("div",{class:"esri-legend--card__image-label"},a.label||""))};b.prototype._renderImage=function(a,c,b){var e,l=a.label,f=a.src,g=a.opacity;b=(e={},e["esri-legend--card__imagery-layer-image--stretched"]=b,e["esri-legend--card__symbol"]=!b,e);c={opacity:""+(null!=g?g:c.opacity)};return p.tsx("img",{alt:d.getTitle(l,!1),src:f,border:0,width:a.width,
height:a.height,class:this.classes(b),styles:c})};b.prototype._drawImageOnSizeRamp=function(a,c,b){var e=b.x,d=b.y,l=b.width,f=b.height,g=new Image;g.src=c;g.onload=function(){a.drawImage(g,e,d,l,f);URL.revokeObjectURL(c)}};b.prototype._attachSizeRampToNode=function(a){var c=a["data-layer-opacity"];null!=c&&(a.style.opacity=c.toString());var c=a["data-legend-element"].infos,b=c[0],d=c[c.length-1],l=b.symbol,f=d.symbol,p="picture-marker"===l.type;l?-1<l.type.indexOf("3d")?(c=l.symbolLayers&&l.symbolLayers.length)?
(c=l.symbolLayers.getItemAt(c-1).get("resource.primitive"),c="triangle"===c||"cone"===c||"tetrahedron"===c):c=void 0:c="triangle"===l.style:c=void 0;var k;l?-1<l.type.indexOf("3d")?(k=l.symbolLayers&&l.symbolLayers.length)?(k=l.symbolLayers.getItemAt(k-1),k=k.resource&&k.resource.primitive,k="circle"===k||"cross"===k||"kite"===k||"sphere"===k||"cube"===k||"diamond"===k):k=void 0:(k=l.style,k="circle"===k||"diamond"===k||"cross"===k):k=void 0;var m,h;p?(m=l.url,h=f.url):(b.preview&&(m=new Blob([b.preview.innerHTML],
{type:"image/svg+xml"}),m=URL.createObjectURL(m)),d.preview&&(h=new Blob([d.preview.innerHTML],{type:"image/svg+xml"}),h=URL.createObjectURL(h)));var n=g.pt2px(b.size+b.outlineSize)*x,l=g.pt2px(d.size+d.outlineSize)*x,f=this._hasIndicators?n:n+100*x,p=this._hasIndicators?f+50*x:n,b=document.createElement("canvas");b.width=f;b.height=p;b.style.width=b.width/x+"px";b.style.height=b.height/x+"px";d=b.getContext("2d");this._hasIndicators?(this._drawImageOnSizeRamp(d,m,{x:0,y:0,width:n,height:n}),this._drawImageOnSizeRamp(d,
h,{x:f/2-l/2,y:p-l,width:l,height:l}),d.beginPath(),m=f/2-l/2,h=p-(c?0:k?l/2:l),d.moveTo(0,k?f/2:f),d.lineTo(m,h),m=f/2+l/2,c=p-(c?0:k?l/2:l),d.moveTo(f,k?f/2:f),d.lineTo(m,c)):(this._drawImageOnSizeRamp(d,m,{x:f-n,y:0,width:n,height:n}),this._drawImageOnSizeRamp(d,h,{x:0,y:p/2-l/2,width:l,height:l}),d.beginPath(),m=f-(k||c?n/2:n),d.moveTo(l-(k||c?l/2:0),p/2-l/2),d.lineTo(m,0),c=f-(k?n/2:n),d.moveTo(l-(k?l/2:0),p/2+l/2),d.lineTo(c,p));d.strokeStyle="#ddd";d.stroke();a.appendChild(b)};b.prototype._renderSizeRamps=
function(a,c){var b,d=a.infos,l=d[0].label,d=d[d.length-1].label;return p.tsx("div",{class:this.classes("esri-legend--card__layer-row",(b={},b["esri-legend--card__size-ramp-row"]=this._hasIndicators,b))},p.tsx("div",{class:"esri-legend--card__ramp-label"},this._hasIndicators?l:d),p.tsx("div",{class:"esri-legend--card__size-ramp-container"},p.tsx("div",{bind:this,"data-layer-opacity":c,"data-legend-element":a,afterCreate:this._attachSizeRampToNode})),p.tsx("div",{class:"esri-legend--card__ramp-label"},
this._hasIndicators?d:l))};b.prototype._renderLegendForRamp=function(a,c){var b=a.infos,d="heatmap-ramp"===a.type,l=b.length-1;a=2<l&&!d?25*l:100;var g=a+20,k=b.slice(0).reverse();k.forEach(function(a,c){a.offset=d?a.ratio:c/l});var m=k.length-1,h=0!==k.length%2&&k[k.length/2|0],h=h&&p.tsx("div",{class:"esri-legend--card__interval-separators-container"},p.tsx("div",{class:"esri-legend--card__interval-separator"},"|"),p.tsx("div",{class:"esri-legend--card__ramp-label"},h.label)),n=b[b.length-1].label,
b=b[0].label,q=null;null!=c&&(q="opacity: "+c);c=w.renderSVG([[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:k[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:a,height:25},fill:{type:"linear",x1:10,y1:0,x2:a+10,y2:0,colors:k},stroke:{width:0}},{shape:{type:"path",path:"M"+(a+10)+" 0 L"+g+" 12.5 L"+(a+10)+" 25 Z"},fill:k[m].color,stroke:{width:0}}]],g,25);return p.tsx("div",{class:"esri-legend--card__layer-row"},p.tsx("div",{class:"esri-legend--card__ramp-label"},d?f[n]:n),
p.tsx("div",{class:"esri-legend--card__symbol-container"},p.tsx("div",{style:q},c),h),p.tsx("div",{class:"esri-legend--card__ramp-label"},d?f[b]:b))};h([p.renderable(),r.property()],b.prototype,"activeLayerInfos",void 0);h([r.property()],b.prototype,"layout",void 0);h([r.property({readOnly:!0})],b.prototype,"type",void 0);h([r.property()],b.prototype,"view",void 0);h([p.accessibleHandler()],b.prototype,"_selectSection",null);return b=h([r.subclass("esri.widgets.Legend.styles.Card")],b)}(r.declared(c))})},
"esri/widgets/Legend/styles/support/utils":function(){define(["require","exports","../../../../symbols/support/svgUtils","../../../support/widget"],function(t,n,m,h){function b(a,b,k){var f=k+"_arrowStart";k+="_arrowEnd";a="left"===a;var g={markerStart:null,markerEnd:null};switch(b){case "HL":a?g.markerStart="url(#"+k+")":g.markerEnd="url(#"+f+")";break;case "LL":g.markerStart="url(#"+k+")";break;case "LH":a?g.markerEnd="url(#"+f+")":g.markerStart="url(#"+k+")";break;default:g.markerEnd="url(#"+f+
")"}return g}Object.defineProperty(n,"__esModule",{value:!0});n.renderRelationshipRamp=function(a,f,k){var n=a.labels,g=!!a.focus,r=void 0;void 0===r&&(r=60);var t=a.focus,c=a.numClasses,l=a.colors,d=a.rotation;a=!!t;var q=Math.sqrt(Math.pow(r,2)+Math.pow(r,2))+(a?0:5),p=null;null!=k&&(p="opacity: "+k);k=[];for(var x=[],B=[],D=(r||75)/c,y=0;y<c;y++)for(var z=y*D,e=0;e<c;e++){var v=e*D,C=m.generateFillAttributes(l[y][e]),E=m.generateStrokeAttributes(null),v={type:"rect",x:v,y:z,width:D,height:D};k.push(m.renderDef(C));
x.push(m.renderShape(v,C.fill,E,null));B.push(m.getBoundingBox(v))}c=null;a||(c="margin: -15px -15px -18px -15px");l=b("left",t,f);t=b("right",t,f);B=m.computeBBox(B);d=m.getTransformMatrix(B,q,q,0,!1,d);B=m.getTransformMatrix(B,q,q,0,!1,a?-45:null);f=h.tsx("div",{style:p,class:a?"esri-relationship-ramp--diamond__middle-column--ramp":"esri-relationship-ramp--square__table-cell"},h.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:q,height:q,style:c},h.tsx("defs",null,h.tsx("marker",{id:f+"_arrowStart",
markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},h.tsx("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),h.tsx("marker",{id:f+"_arrowEnd",markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},h.tsx("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),k),h.tsx("g",{transform:d},x),h.tsx("g",{transform:B},h.tsx("line",{fill:"none",stroke:"#555555","stroke-width":"1",
"marker-start":l.markerStart,"marker-end":l.markerEnd,x1:-10,y1:r-15,x2:-10,y2:15}),h.tsx("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":t.markerStart,"marker-end":t.markerEnd,x1:15,y1:r+10,x2:r-15,y2:r+10}))));return g?h.tsx("div",{class:"esri-relationship-ramp--diamond__container"},h.tsx("div",{class:"esri-relationship-ramp--diamond__left-column"},n.left),h.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column"},h.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},
n.top),f,h.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},n.bottom)),h.tsx("div",{class:"esri-relationship-ramp--diamond__right-column"},n.right)):h.tsx("div",{class:"esri-relationship-ramp--square__table"},h.tsx("div",{class:"esri-relationship-ramp--square__table-row"},h.tsx("div",{class:h.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-bottom")},n.left),h.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),
h.tsx("div",{class:h.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-bottom")},n.top)),h.tsx("div",{class:"esri-relationship-ramp--square__table-row"},h.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),f,h.tsx("div",{class:"esri-relationship-ramp--square__table-cell"})),h.tsx("div",{class:"esri-relationship-ramp--square__table-row"},h.tsx("div",{class:h.classes("esri-relationship-ramp--square__table-cell",
"esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-top")},n.bottom),h.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),h.tsx("div",{class:h.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-top")},n.right)))}})},"esri/widgets/Legend/support/styleUtils":function(){define(["require","exports","dojo/i18n!../../Legend/nls/Legend","../../../intl"],
function(t,n,m,h){Object.defineProperty(n,"__esModule",{value:!0});n.attachToNode=function(b){b.appendChild(this)};n.getTitle=function(b,a){if(b){if("string"===typeof b)return b;if("value"in b||"unit"in b)return h.substitute(m.dotValue,b);if("colorName"in b||"bandName"in b)return m[b.colorName]+": "+(m[b.bandName]||b.bandName);var f=null;a?f=b.ratioPercentTotal?"showRatioPercentTotal":b.ratioPercent?"showRatioPercent":b.ratio?"showRatio":b.normField?"showNormField":b.field?"showField":null:a||(f=
b.normField?"showNormField":b.normByPct?"showNormPct":b.field?"showField":null);return f?h.substitute("showField"===f?"{field}":m[f],{field:b.field,normField:b.normField}):null}};n.isRendererTitle=function(b,a){return!a};n.isImageryStretchedLegend=function(b,a){return!!(a&&"Stretched"===a&&10.3<=b.version&&"esri.layers.ImageryLayer"===b.declaredClass)}})},"esri/widgets/support/colorUtils":function(){define(["require","exports","../../Color"],function(t,n,m){function h(a){return new m(a)}function b(a){return!!a&&
4===a.length&&r.test(a)}function a(a){return!!a&&7===a.length&&w.test(a)}function f(a){return 127<=.299*a.r+.587*a.g+.114*a.b}function k(a,c){void 0===c&&(c=1);c=Math.pow(.7,c);return new m([Math.round(a.r*c),Math.round(a.g*c),Math.round(a.b*c),a.a])}function u(a,c){void 0===c&&(c=1);c=Math.pow(.7,c);var b=a.r,d=a.g,l=a.b;30>b&&(b=30);30>d&&(d=30);30>l&&(l=30);return new m([Math.min(255,Math.round(b/c)),Math.min(255,Math.round(d/c)),Math.min(255,Math.round(l/c)),a.a])}function g(a,c){var b=a.r,d=
a.g,l=a.b;a=a.a;1>a&&(b=Math.round(a*b+(1-a)*c.r),d=Math.round(a*d+(1-a)*c.g),l=Math.round(a*l+(1-a)*c.b));return new m({r:b,g:d,b:l})}Object.defineProperty(n,"__esModule",{value:!0});var r=/^#[0-9A-F]{3}$/i,w=/^#[0-9A-F]{6}$/i,c=new m({r:255,g:255,b:255});n.equal=function(a,c){return a&&c&&a.r===c.r&&a.g===c.g&&a.b===c.b&&a.a===c.a};n.normalizeHex=function(a){return a?"#"+a.trim().replace(/#/g,"").substr(0,6):""};n.normalizeColor=h;n.isValidHex=function(c){return b(c)||a(c)};n.isShorthandHex=b;n.isLonghandHex=
a;n.toHex=function(a){return h(a).toHex()};n.getContrastingColor=function(a){return f(a)?k(a):u(a,3)};n.isBright=f;n.darker=k;n.brighter=u;n.blendWithBackground=g;n.getColorTheme=function(a,b){void 0===b&&(b=c);a=g(a,b);return f(a)?"light":"dark"}})},"esri/widgets/Legend/styles/Classic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/i18n!../../Legend/nls/Legend ../../../intl ../../../core/accessorSupport/decorators ../../Widget ./support/utils ../support/styleUtils ../../support/widget".split(" "),
function(t,n,m,h,b,a,f,k,u,g,r){return function(k){function c(a){a=k.call(this)||this;a.activeLayerInfos=null;a.type="classic";return a}m(c,k);c.prototype.render=function(){var a=this,c=this.activeLayerInfos,f=this.classes("esri-legend esri-widget--panel","esri-widget"),c=c&&c.toArray().map(function(c){return a._renderLegendForLayer(c)}).filter(function(a){return!!a});return r.tsx("div",{class:f},c&&c.length?c:r.tsx("div",{class:"esri-legend__message"},b.noLegend))};c.prototype._renderLegendForLayer=
function(a){var c=this,b;if(!a.ready)return null;var f=!!a.children.length,l="esri-legend__"+a.layer.uid+"-version-"+a.version,g=a.title?r.tsx("h3",{class:this.classes("esri-widget__heading","esri-legend__service-label")},a.title):null;if(f)return b=a.children.map(function(a){return c._renderLegendForLayer(a)}).toArray(),r.tsx("div",{key:l,class:this.classes("esri-legend__service","esri-legend__group-layer")},g,b);if((f=a.legendElements)&&!f.length)return null;f=f.map(function(b){return c._renderLegendForElement(b,
a.layer)}).filter(function(a){return!!a});if(!f.length)return null;var k=(b={},b["esri-legend__group-layer-child"]=!!a.parent,b);return r.tsx("div",{key:l,class:this.classes("esri-legend__service",k)},g,r.tsx("div",{class:"esri-legend__layer"},f))};c.prototype._renderLegendForElement=function(a,c,b){var d=this,f,l="color-ramp"===a.type,k="opacity-ramp"===a.type,m="size-ramp"===a.type,h=null;if("symbol-table"===a.type||m){var e=a.infos.map(function(b){return d._renderLegendForElementInfo(b,c,m,a.legendType)}).filter(function(a){return!!a});
e.length&&(h=r.tsx("div",{class:"esri-legend__layer-body"},e))}else"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type||"stretch-ramp"===a.type?h=this._renderLegendForRamp(a,c.opacity):"relationship-ramp"===a.type&&(h=u.renderRelationshipRamp(a,this.id,c.opacity));if(!h)return null;var e=a.title,n=null;"string"===typeof e?n=e:e&&(n=g.getTitle(e,l||k),n=g.isRendererTitle(e,l||k)&&e.title?e.title+" ("+n+")":n);l=b?"esri-legend__layer-child-table":"esri-legend__layer-table";k=n?r.tsx("div",
{class:"esri-legend__layer-caption"},n):null;b=(f={},f["esri-legend__layer-table--size-ramp"]=m||!b,f);return r.tsx("div",{class:this.classes(l,b)},k,h)};c.prototype._renderLegendForRamp=function(a,c){var d=this,f=a.infos,l="heatmap-ramp"===a.type,k="stretch-ramp"===a.type,m=a.preview;m.className="esri-legend__color-ramp "+("opacity-ramp"===a.type?"esri-legend__opacity-ramp":"");null!=c&&(m.style.opacity=c.toString());a=f.map(function(a){return r.tsx("div",{class:a.label?"esri-legend__ramp-label":
null},l?b[a.label]:k?d._getStretchStopLabel(a):a.label)});c={height:m.style.height};return r.tsx("div",{class:"esri-legend__layer-row"},r.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--symbols",styles:{width:"24px"}},r.tsx("div",{class:"esri-legend__ramps",bind:m,afterCreate:g.attachToNode})),r.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},r.tsx("div",{class:"esri-legend__ramp-labels",styles:c},a)))};c.prototype._getStretchStopLabel=function(c){return c.label?
b[c.label]+": "+a.formatNumber(c.value,{style:"decimal"}):""};c.prototype._renderLegendForElementInfo=function(a,c,b,f){var d,l;if(a.type)return this._renderLegendForElement(a,c,!0);var k=null;f=g.isImageryStretchedLegend(c,f);a.symbol&&a.preview?k=r.tsx("div",{class:"esri-legend__symbol",bind:a.preview,afterCreate:g.attachToNode}):a.src&&(k=this._renderImage(a,c,f));if(!k)return null;c=(d={},d["esri-legend__imagery-layer-info--stretched"]=f,d);b=(l={},l["esri-legend__imagery-layer-info--stretched"]=
f,l["esri-legend__size-ramp"]=!f&&b,l);return r.tsx("div",{class:"esri-legend__layer-row"},r.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--symbols",b)},k),r.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--info",c)},g.getTitle(a.label,!1)||""))};c.prototype._renderImage=function(a,c,b){var d,f=a.label,l=a.src,k=a.opacity;b=(d={},d["esri-legend__imagery-layer-image--stretched"]=b,d["esri-legend__symbol"]=!b,d);c={opacity:""+(null!=k?
k:c.opacity)};return r.tsx("img",{alt:g.getTitle(f,!1),src:l,border:0,width:a.width,height:a.height,class:this.classes(b),styles:c})};h([r.renderable(),f.property()],c.prototype,"activeLayerInfos",void 0);h([f.property({readOnly:!0})],c.prototype,"type",void 0);return c=h([f.subclass("esri.widgets.Legend.styles.Classic")],c)}(f.declared(k))})},"dojox/gfx/svg":function(){define("dojo/_base/lang dojo/_base/sniff dojo/_base/window dojo/dom dojo/_base/declare dojo/_base/array dojo/dom-geometry dojo/dom-attr dojo/_base/Color ./_base ./shape ./path".split(" "),
function(t,n,m,h,b,a,f,k,u,g,r,w){function c(a,c){return m.doc.createElementNS?m.doc.createElementNS(a,c):m.doc.createElement(c)}function l(a,c,b,d){return a.setAttributeNS?a.setAttributeNS(c,b,d):a.setAttribute(b,d)}function d(a){return q.useSvgWeb?m.doc.createTextNode(a,!0):m.doc.createTextNode(a)}var q=g.svg={};q.useSvgWeb="undefined"!=typeof window.svgweb;var p=navigator.userAgent,x=n("ios"),B=n("chrome")?"auto":"optimizeLegibility";q.xmlns={xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"};
q.getRef=function(a){return a&&"none"!=a?a.match(/^url\(#.+\)$/)?h.byId(a.slice(5,-1)):a.match(/^#dojoUnique\d+$/)?h.byId(a.slice(1)):null:null};q.dasharray={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};var D=0;q.Shape=b("dojox.gfx.svg.Shape",r.Shape,{destroy:function(){if(this.fillStyle&&"type"in this.fillStyle){var a=this.rawNode.getAttribute("fill");
(a=q.getRef(a))&&a.parentNode.removeChild(a)}this.clip&&(a=this.rawNode.getAttribute("clip-path"))&&(a=h.byId(a.match(/gfx_clip[\d]+/)[0]))&&a.parentNode.removeChild(a);r.Shape.prototype.destroy.apply(this,arguments)},setFill:function(c){if(!c)return this.fillStyle=null,this.rawNode.setAttribute("fill","none"),this.rawNode.setAttribute("fill-opacity",0),this;var b,e=function(a){this.setAttribute(a,b[a].toFixed(8))};if("object"==typeof c&&"type"in c){switch(c.type){case "linear":b=g.makeParameters(g.defaultLinearGradient,
c);c=this._setFillObject(b,"linearGradient");a.forEach(["x1","y1","x2","y2"],e,c);break;case "radial":b=g.makeParameters(g.defaultRadialGradient,c);c=this._setFillObject(b,"radialGradient");a.forEach(["cx","cy","r"],e,c);break;case "pattern":b=g.makeParameters(g.defaultPattern,c),c=this._setFillObject(b,"pattern"),a.forEach(["x","y","width","height"],e,c)}this.fillStyle=b;return this}this.fillStyle=b=g.normalizeColor(c);this.rawNode.setAttribute("fill",b.toCss());this.rawNode.setAttribute("fill-opacity",
b.a);this.rawNode.setAttribute("fill-rule","evenodd");return this},setStroke:function(a){var c=this.rawNode;if(!a)return this.strokeStyle=null,c.setAttribute("stroke","none"),c.setAttribute("stroke-opacity",0),this;if("string"==typeof a||t.isArray(a)||a instanceof u)a={color:a};a=this.strokeStyle=g.makeParameters(g.defaultStroke,a);a.color=g.normalizeColor(a.color);if(a){var b=0>a.width?0:a.width;c.setAttribute("stroke",a.color.toCss());c.setAttribute("stroke-opacity",a.color.a);c.setAttribute("stroke-width",
b);c.setAttribute("stroke-linecap",a.cap);"number"==typeof a.join?(c.setAttribute("stroke-linejoin","miter"),c.setAttribute("stroke-miterlimit",a.join)):c.setAttribute("stroke-linejoin",a.join);var e=a.style.toLowerCase();e in q.dasharray&&(e=q.dasharray[e]);if(e instanceof Array){var e=t._toArray(e),d;for(d=0;d<e.length;++d)e[d]*=b;if("butt"!=a.cap){for(d=0;d<e.length;d+=2)e[d]-=b,1>e[d]&&(e[d]=1);for(d=1;d<e.length;d+=2)e[d]+=b}e=e.join(",")}c.setAttribute("stroke-dasharray",e);c.setAttribute("dojoGfxStrokeStyle",
a.style)}return this},_getParentSurface:function(){for(var a=this.parent;a&&!(a instanceof g.Surface);a=a.parent);return a},_setFillObject:function(a,b){var e=q.xmlns.svg;this.fillStyle=a;var d=this._getParentSurface().defNode,f=this.rawNode.getAttribute("fill");if(f=q.getRef(f))if(f.tagName.toLowerCase()!=b.toLowerCase()){var k=f.id;f.parentNode.removeChild(f);f=c(e,b);f.setAttribute("id",k);d.appendChild(f)}else for(;f.childNodes.length;)f.removeChild(f.lastChild);else f=c(e,b),f.setAttribute("id",
g._base._getUniqueId()),d.appendChild(f);if("pattern"==b)f.setAttribute("patternUnits","userSpaceOnUse"),e=c(e,"image"),e.setAttribute("x",0),e.setAttribute("y",0),e.setAttribute("width",(0>a.width?0:a.width).toFixed(8)),e.setAttribute("height",(0>a.height?0:a.height).toFixed(8)),l(e,q.xmlns.xlink,"xlink:href",a.src),f.appendChild(e);else for(f.setAttribute("gradientUnits","userSpaceOnUse"),b=0;b<a.colors.length;++b){var d=a.colors[b],k=c(e,"stop"),m=d.color=g.normalizeColor(d.color);k.setAttribute("offset",
d.offset.toFixed(8));k.setAttribute("stop-color",m.toCss());k.setAttribute("stop-opacity",m.a);f.appendChild(k)}this.rawNode.setAttribute("fill","url(#"+f.getAttribute("id")+")");this.rawNode.removeAttribute("fill-opacity");this.rawNode.setAttribute("fill-rule","evenodd");return f},_applyTransform:function(){if(this.matrix){var a=this.matrix;this.rawNode.setAttribute("transform","matrix("+a.xx.toFixed(8)+","+a.yx.toFixed(8)+","+a.xy.toFixed(8)+","+a.yy.toFixed(8)+","+a.dx.toFixed(8)+","+a.dy.toFixed(8)+
")")}else this.rawNode.removeAttribute("transform");return this},setRawNode:function(a){a=this.rawNode=a;"image"!=this.shape.type&&a.setAttribute("fill","none");a.setAttribute("fill-opacity",0);a.setAttribute("stroke","none");a.setAttribute("stroke-opacity",0);a.setAttribute("stroke-width",1);a.setAttribute("stroke-linecap","butt");a.setAttribute("stroke-linejoin","miter");a.setAttribute("stroke-miterlimit",4);a.__gfxObject__=this},setShape:function(a){this.shape=g.makeParameters(this.shape,a);for(var c in this.shape)if("type"!=
c){a=this.shape[c];if("width"===c||"height"===c)a=0>a?0:a;this.rawNode.setAttribute(c,a)}this.bbox=null;return this},_moveToFront:function(){this.rawNode.parentNode.appendChild(this.rawNode);return this},_moveToBack:function(){this.rawNode.parentNode.insertBefore(this.rawNode,this.rawNode.parentNode.firstChild);return this},setClip:function(a){this.inherited(arguments);var b=a?"width"in a?"rect":"cx"in a?"ellipse":"points"in a?"polyline":"d"in a?"path":null:null;if(a&&!b)return this;"polyline"===
b&&(a=t.clone(a),a.points=a.points.join(","));var e,d=k.get(this.rawNode,"clip-path");d&&(e=h.byId(d.match(/gfx_clip[\d]+/)[0]))&&e.removeChild(e.childNodes[0]);a?(e?(b=c(q.xmlns.svg,b),e.appendChild(b)):(d="gfx_clip"+ ++D,this.rawNode.setAttribute("clip-path","url(#"+d+")"),e=c(q.xmlns.svg,"clipPath"),b=c(q.xmlns.svg,b),e.appendChild(b),this.rawNode.parentNode.insertBefore(e,this.rawNode),k.set(e,"id",d)),k.set(b,a)):(this.rawNode.removeAttribute("clip-path"),e&&e.parentNode.removeChild(e));return this},
_removeClipNode:function(){var a,c=k.get(this.rawNode,"clip-path");c&&(a=h.byId(c.match(/gfx_clip[\d]+/)[0]))&&a.parentNode.removeChild(a);return a}});q.Group=b("dojox.gfx.svg.Group",q.Shape,{constructor:function(){r.Container._init.call(this)},setRawNode:function(a){this.rawNode=a;this.rawNode.__gfxObject__=this},destroy:function(){this.clear(!0);q.Shape.prototype.destroy.apply(this,arguments)}});q.Group.nodeType="g";q.Rect=b("dojox.gfx.svg.Rect",[q.Shape,r.Rect],{setShape:function(a){this.shape=
g.makeParameters(this.shape,a);this.bbox=null;for(var c in this.shape)if("type"!=c&&"r"!=c){a=this.shape[c];if("width"===c||"height"===c)a=0>a?0:a;this.rawNode.setAttribute(c,a)}null!=this.shape.r&&(this.rawNode.setAttribute("ry",this.shape.r),this.rawNode.setAttribute("rx",this.shape.r));return this}});q.Rect.nodeType="rect";q.Ellipse=b("dojox.gfx.svg.Ellipse",[q.Shape,r.Ellipse],{});q.Ellipse.nodeType="ellipse";q.Circle=b("dojox.gfx.svg.Circle",[q.Shape,r.Circle],{});q.Circle.nodeType="circle";
q.Line=b("dojox.gfx.svg.Line",[q.Shape,r.Line],{});q.Line.nodeType="line";q.Polyline=b("dojox.gfx.svg.Polyline",[q.Shape,r.Polyline],{setShape:function(a,c){a&&a instanceof Array?(this.shape=g.makeParameters(this.shape,{points:a}),c&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.shape=g.makeParameters(this.shape,a);this.bbox=null;this._normalizePoints();a=[];c=this.shape.points;for(var b=0;b<c.length;++b)a.push(c[b].x.toFixed(8),c[b].y.toFixed(8));this.rawNode.setAttribute("points",
a.join(" "));return this}});q.Polyline.nodeType="polyline";q.Image=b("dojox.gfx.svg.Image",[q.Shape,r.Image],{setShape:function(a){this.shape=g.makeParameters(this.shape,a);this.bbox=null;a=this.rawNode;for(var c in this.shape)if("type"!=c&&"src"!=c){var b=this.shape[c];if("width"===c||"height"===c)b=0>b?0:b;a.setAttribute(c,b)}a.setAttribute("preserveAspectRatio","none");l(a,q.xmlns.xlink,"xlink:href",this.shape.src);a.__gfxObject__=this;return this}});q.Image.nodeType="image";q.Text=b("dojox.gfx.svg.Text",
[q.Shape,r.Text],{setShape:function(a){this.shape=g.makeParameters(this.shape,a);this.bbox=null;a=this.rawNode;var c=this.shape;a.setAttribute("x",c.x);a.setAttribute("y",c.y);a.setAttribute("text-anchor",c.align);a.setAttribute("text-decoration",c.decoration);a.setAttribute("rotate",c.rotated?90:0);a.setAttribute("kerning",c.kerning?"auto":0);a.setAttribute("text-rendering",B);a.firstChild?a.firstChild.nodeValue=c.text:a.appendChild(d(c.text));return this},getTextWidth:function(){var a=this.rawNode,
c=a.parentNode,a=a.cloneNode(!0);a.style.visibility="hidden";var b=0,d=a.firstChild.nodeValue;c.appendChild(a);if(""!=d)for(;!b;)b=a.getBBox?parseInt(a.getBBox().width):68;c.removeChild(a);return b},getBoundingBox:function(){var a=null;if(this.getShape().text)try{a=this.rawNode.getBBox()}catch(v){a={x:0,y:0,width:0,height:0}}return a}});q.Text.nodeType="text";q.Path=b("dojox.gfx.svg.Path",[q.Shape,w.Path],{_updateWithSegment:function(a){this.inherited(arguments);"string"==typeof this.shape.path&&
this.rawNode.setAttribute("d",this.shape.path)},setShape:function(a){this.inherited(arguments);this.shape.path?this.rawNode.setAttribute("d",this.shape.path):this.rawNode.removeAttribute("d");return this}});q.Path.nodeType="path";q.TextPath=b("dojox.gfx.svg.TextPath",[q.Shape,w.TextPath],{_updateWithSegment:function(a){this.inherited(arguments);this._setTextPath()},setShape:function(a){this.inherited(arguments);this._setTextPath();return this},_setTextPath:function(){if("string"==typeof this.shape.path){var a=
this.rawNode;if(!a.firstChild){var b=c(q.xmlns.svg,"textPath"),f=d("");b.appendChild(f);a.appendChild(b)}b=(b=a.firstChild.getAttributeNS(q.xmlns.xlink,"href"))&&q.getRef(b);if(!b&&(f=this._getParentSurface())){var f=f.defNode,b=c(q.xmlns.svg,"path"),k=g._base._getUniqueId();b.setAttribute("id",k);f.appendChild(b);l(a.firstChild,q.xmlns.xlink,"xlink:href","#"+k)}b&&b.setAttribute("d",this.shape.path)}},_setText:function(){var a=this.rawNode;if(!a.firstChild){var b=c(q.xmlns.svg,"textPath"),f=d("");
b.appendChild(f);a.appendChild(b)}a=a.firstChild;b=this.text;a.setAttribute("alignment-baseline","middle");switch(b.align){case "middle":a.setAttribute("text-anchor","middle");a.setAttribute("startOffset","50%");break;case "end":a.setAttribute("text-anchor","end");a.setAttribute("startOffset","100%");break;default:a.setAttribute("text-anchor","start"),a.setAttribute("startOffset","0%")}a.setAttribute("baseline-shift","0.5ex");a.setAttribute("text-decoration",b.decoration);a.setAttribute("rotate",
b.rotated?90:0);a.setAttribute("kerning",b.kerning?"auto":0);a.firstChild.data=b.text}});q.TextPath.nodeType="text";var y=534<function(){var a=/WebKit\/(\d*)/.exec(p);return a?a[1]:0}();q.Surface=b("dojox.gfx.svg.Surface",r.Surface,{constructor:function(){r.Container._init.call(this)},destroy:function(){r.Container.clear.call(this,!0);this.defNode=null;this.inherited(arguments)},setDimensions:function(a,c){if(!this.rawNode)return this;a=0>a?0:a;c=0>c?0:c;this.rawNode.setAttribute("width",a);this.rawNode.setAttribute("height",
c);y&&(this.rawNode.style.width=a,this.rawNode.style.height=c);return this},getDimensions:function(){return this.rawNode?{width:g.normalizedLength(this.rawNode.getAttribute("width")),height:g.normalizedLength(this.rawNode.getAttribute("height"))}:null}});q.createSurface=function(a,b,d){var e=new q.Surface;e.rawNode=c(q.xmlns.svg,"svg");e.rawNode.setAttribute("overflow","hidden");b&&e.rawNode.setAttribute("width",0>b?0:b);d&&e.rawNode.setAttribute("height",0>d?0:d);b=c(q.xmlns.svg,"defs");e.rawNode.appendChild(b);
e.defNode=b;e._parent=h.byId(a);e._parent.appendChild(e.rawNode);g._base._fixMsTouchAction(e);return e};n={_setFont:function(){var a=this.fontStyle;this.rawNode.setAttribute("font-style",a.style);this.rawNode.setAttribute("font-variant",a.variant);this.rawNode.setAttribute("font-weight",a.weight);this.rawNode.setAttribute("font-size",a.size);this.rawNode.setAttribute("font-family",a.family)}};var z=r.Container;b=q.Container={openBatch:function(){if(!this._batch){var a;a=q.useSvgWeb?m.doc.createDocumentFragment(!0):
m.doc.createDocumentFragment();this.fragment=a}++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this.fragment&&!this._batch&&(this.rawNode.appendChild(this.fragment),delete this.fragment);return this},add:function(a){this!=a.getParent()&&(this.fragment?this.fragment.appendChild(a.rawNode):this.rawNode.appendChild(a.rawNode),z.add.apply(this,arguments),a.setClip(a.clip));return this},remove:function(a,c){this==a.getParent()&&(this.rawNode==a.rawNode.parentNode&&
this.rawNode.removeChild(a.rawNode),this.fragment&&this.fragment==a.rawNode.parentNode&&this.fragment.removeChild(a.rawNode),a._removeClipNode(),z.remove.apply(this,arguments));return this},clear:function(){for(var a=this.rawNode;a.lastChild;)a.removeChild(a.lastChild);var c=this.defNode;if(c){for(;c.lastChild;)c.removeChild(c.lastChild);a.appendChild(c)}return z.clear.apply(this,arguments)},getBoundingBox:z.getBoundingBox,_moveChildToFront:z._moveChildToFront,_moveChildToBack:z._moveChildToBack};
w=q.Creator={createObject:function(a,b){if(!this.rawNode)return null;var e=new a;a=c(q.xmlns.svg,a.nodeType);e.setRawNode(a);e.setShape(b);this.add(e);return e}};t.extend(q.Text,n);t.extend(q.TextPath,n);t.extend(q.Group,b);t.extend(q.Group,r.Creator);t.extend(q.Group,w);t.extend(q.Surface,b);t.extend(q.Surface,r.Creator);t.extend(q.Surface,w);q.fixTarget=function(a,c){a.gfxTarget||(a.gfxTarget=x&&a.target.wholeText?a.target.parentElement.__gfxObject__:a.target.__gfxObject__);return!0};q.useSvgWeb&&
(q.createSurface=function(a,b,d){var e=new q.Surface;b=0>b?0:b;d=0>d?0:d;if(!b||!d){var l=f.position(a);b=b||l.w;d=d||l.h}a=h.byId(a);var l=a.id?a.id+"_svgweb":g._base._getUniqueId(),k=c(q.xmlns.svg,"svg");k.id=l;k.setAttribute("width",b);k.setAttribute("height",d);svgweb.appendChild(k,a);k.addEventListener("SVGLoad",function(){e.rawNode=this;e.isLoaded=!0;var a=c(q.xmlns.svg,"defs");e.rawNode.appendChild(a);e.defNode=a;if(e.onLoad)e.onLoad(e)},!1);e.isLoaded=!1;return e},q.Surface.extend({destroy:function(){var a=
this.rawNode;svgweb.removeChild(a,a.parentNode)}}),n={connect:function(a,c,b){"on"===a.substring(0,2)&&(a=a.substring(2));b=2==arguments.length?c:t.hitch(c,b);this.getEventSource().addEventListener(a,b,!1);return[this,a,b]},disconnect:function(a){this.getEventSource().removeEventListener(a[1],a[2],!1);delete a[0]}},t.extend(q.Shape,n),t.extend(q.Surface,n));return q})},"dojox/gfx/_base":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/Color dojo/_base/sniff dojo/_base/window dojo/_base/array dojo/dom dojo/dom-construct dojo/dom-geometry".split(" "),
function(t,n,m,h,b,a,f,k,u){var g=n.getObject("dojox.gfx",!0),r=g._base={};g._hasClass=function(a,c){return(a=a.getAttribute("className"))&&0<=(" "+a+" ").indexOf(" "+c+" ")};g._addClass=function(a,c){var b=a.getAttribute("className")||"";(!b||0>(" "+b+" ").indexOf(" "+c+" "))&&a.setAttribute("className",b+(b?" ":"")+c)};g._removeClass=function(a,c){var b=a.getAttribute("className");b&&a.setAttribute("className",b.replace(new RegExp("(^|\\s+)"+c+"(\\s+|$)"),"$1$2"))};r._getFontMeasurements=function(){var a=
{"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0},c,d;h("ie")&&(d=b.doc.documentElement.style.fontSize||"",d||(b.doc.documentElement.style.fontSize="100%"));var f=k.create("div",{style:{position:"absolute",left:"0",top:"-100px",width:"30px",height:"1000em",borderWidth:"0",margin:"0",padding:"0",outline:"none",lineHeight:"1",overflow:"hidden"}},b.body());for(c in a)f.style.fontSize=c,a[c]=16*Math.round(12*f.offsetHeight/16)/12/1E3;
h("ie")&&(b.doc.documentElement.style.fontSize=d);b.body().removeChild(f);return a};var w=null;r._getCachedFontMeasurements=function(a){if(a||!w)w=r._getFontMeasurements();return w};var c=null,l={};r._getTextBox=function(a,d,f){var g,m,h=arguments.length,e;c||(c=k.create("div",{style:{position:"absolute",top:"-10000px",left:"0",visibility:"hidden"}},b.body()));g=c;g.className="";m=g.style;m.borderWidth="0";m.margin="0";m.padding="0";m.outline="0";if(1<h&&d)for(e in d)e in l||(m[e]=d[e]);2<h&&f&&(g.className=
f);g.innerHTML=a;g.getBoundingClientRect?(m=g.getBoundingClientRect(),m={l:m.left,t:m.top,w:m.width||m.right-m.left,h:m.height||m.bottom-m.top}):m=u.getMarginBox(g);g.innerHTML="";return m};r._computeTextLocation=function(a,c,b,d){var f={};switch(a.align){case "end":f.x=a.x-c;break;case "middle":f.x=a.x-c/2;break;default:f.x=a.x}f.y=a.y-b*(d?.75:1);return f};r._computeTextBoundingBox=function(a){if(!g._base._isRendered(a))return{x:0,y:0,width:0,height:0};var c;c=a.getShape();var b=a.getFont()||g.defaultFont;
a=a.getTextWidth();b=g.normalizedLength(b.size);c=r._computeTextLocation(c,a,b,!0);return{x:c.x,y:c.y,width:a,height:b}};r._isRendered=function(a){for(a=a.parent;a&&a.getParent;)a=a.parent;return null!==a};var d=0;r._getUniqueId=function(){var a;do a=t._scopeName+"xUnique"+ ++d;while(f.byId(a));return a};var q=h("pointer-events")?"touchAction":null;r._fixMsTouchAction=q?function(a){a.rawNode.style[q]="none"}:function(){};n.mixin(g,{defaultPath:{type:"path",path:""},defaultPolyline:{type:"polyline",
points:[]},defaultRect:{type:"rect",x:0,y:0,width:100,height:100,r:0},defaultEllipse:{type:"ellipse",cx:0,cy:0,rx:200,ry:100},defaultCircle:{type:"circle",cx:0,cy:0,r:100},defaultLine:{type:"line",x1:0,y1:0,x2:100,y2:100},defaultImage:{type:"image",x:0,y:0,width:0,height:0,src:""},defaultText:{type:"text",x:0,y:0,text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultTextPath:{type:"textpath",text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultStroke:{type:"stroke",
color:"black",style:"solid",width:1,cap:"butt",join:4},defaultLinearGradient:{type:"linear",x1:0,y1:0,x2:100,y2:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultRadialGradient:{type:"radial",cx:0,cy:0,r:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultPattern:{type:"pattern",x:0,y:0,width:0,height:0,src:""},defaultFont:{type:"font",style:"normal",variant:"normal",weight:"normal",size:"10pt",family:"serif"},getDefault:function(){var a={};return function(c){var b=
a[c];if(b)return new b;b=a[c]=new Function;b.prototype=g["default"+c];return new b}}(),normalizeColor:function(a){return a instanceof m?a:new m(a)},normalizeParameters:function(a,c){var b;if(c){var d={};for(b in a)b in c&&!(b in d)&&(a[b]=c[b])}return a},makeParameters:function(a,c){var b=null;if(!c)return n.delegate(a);var d={};for(b in a)b in d||(d[b]=n.clone(b in c?c[b]:a[b]));return d},formatNumber:function(a,c){var b=a.toString();if(0<=b.indexOf("e"))b=a.toFixed(4);else{var d=b.indexOf(".");
0<=d&&5<b.length-d&&(b=a.toFixed(4))}return 0>a?b:c?" "+b:b},makeFontString:function(a){return a.style+" "+a.variant+" "+a.weight+" "+a.size+" "+a.family},splitFontString:function(a){var c=g.getDefault("Font");a=a.split(/\s+/);if(!(5>a.length)){c.style=a[0];c.variant=a[1];c.weight=a[2];var b=a[3].indexOf("/");c.size=0>b?a[3]:a[3].substring(0,b);var d=4;0>b&&("/"==a[4]?d=6:"/"==a[4].charAt(0)&&(d=5));d<a.length&&(c.family=a.slice(d).join(" "))}return c},cm_in_pt:72/2.54,mm_in_pt:7.2/2.54,px_in_pt:function(){return g._base._getCachedFontMeasurements()["12pt"]/
12},pt2px:function(a){return a*g.px_in_pt()},px2pt:function(a){return a/g.px_in_pt()},normalizedLength:function(a){if(0===a.length)return 0;if(2<a.length){var c=g.px_in_pt(),b=parseFloat(a);switch(a.slice(-2)){case "px":return b;case "pt":return b*c;case "in":return 72*b*c;case "pc":return 12*b*c;case "mm":return b*g.mm_in_pt*c;case "cm":return b*g.cm_in_pt*c}}return parseFloat(a)},pathVmlRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,pathSvgRegExp:/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,
equalSources:function(a,c){return a&&c&&a===c},switchTo:function(c){var b="string"==typeof c?g[c]:c;b&&(a.forEach("Group Rect Ellipse Circle Line Polyline Image Text Path TextPath Surface createSurface fixTarget".split(" "),function(a){g[a]=b[a]}),"string"==typeof c?g.renderer=c:a.some(["svg","vml","canvas","canvasWithEvents","silverlight"],function(a){return g.renderer=g[a]&&g[a].Surface===g.Surface?a:null}))}});return g})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),
function(t,n,m,h,b,a,f,k,u,g){function r(a,b){for(var c=a.length-1;b<c;)a[b]=a[++b];a.length=c}var w=t.shape={};w.Shape=m("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(b("gfxRegistry")){var a=w.register(this);this.getUID=function(){return a}}},destroy:function(){b("gfxRegistry")&&w.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=
null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var a=this.getBoundingBox();if(!a)return null;var b=this._getRealMatrix();return[g.multiplyPoint(b,a.x,a.y),g.multiplyPoint(b,a.x+a.width,a.y),g.multiplyPoint(b,a.x+
a.width,a.y+a.height),g.multiplyPoint(b,a.x,a.y+a.height)]},getEventSource:function(){return this.rawNode},setClip:function(a){this.clip=a},getClip:function(){return this.clip},setShape:function(a){this.shape=t.makeParameters(this.shape,a);this.bbox=null;return this},setFill:function(a){if(!a)return this.fillStyle=null,this;var c=null;if("object"==typeof a&&"type"in a)switch(a.type){case "linear":c=t.makeParameters(t.defaultLinearGradient,a);break;case "radial":c=t.makeParameters(t.defaultRadialGradient,
a);break;case "pattern":c=t.makeParameters(t.defaultPattern,a)}else c=t.normalizeColor(a);this.fillStyle=c;return this},setStroke:function(a){if(!a)return this.strokeStyle=null,this;if("string"==typeof a||n.isArray(a)||a instanceof u)a={color:a};a=this.strokeStyle=t.makeParameters(t.defaultStroke,a);a.color=t.normalizeColor(a.color);return this},setTransform:function(a){this.matrix=g.clone(a?g.normalize(a):g.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var a=
this.getParent();a&&(a._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var a=this.getParent();a&&(a._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(a){return a?this.setTransform([this.matrix,a]):this},applyLeftTransform:function(a){return a?this.setTransform([a,this.matrix]):this},applyTransform:function(a){return a?this.setTransform([this.matrix,a]):this},removeShape:function(a){this.parent&&
this.parent.remove(this,a);return this},_setParent:function(a,b){this.parent=a;return this._updateParentMatrix(b)},_updateParentMatrix:function(a){this.parentMatrix=a?g.clone(a):null;return this._applyTransform()},_getRealMatrix:function(){for(var a=this.matrix,b=this.parent;b;)b.matrix&&(a=g.multiply(b.matrix,a)),b=b.parent;return a}});w._eventsProcessing={on:function(c,b){return a(this.getEventSource(),c,w.fixCallback(this,t.fixTarget,b))},connect:function(a,b,d){"on"==a.substring(0,2)&&(a=a.substring(2));
return this.on(a,d?n.hitch(b,d):b)},disconnect:function(a){return a.remove()}};w.fixCallback=function(a,b,d,f){f||(f=d,d=null);if(n.isString(f)){d=d||h.global;if(!d[f])throw['dojox.gfx.shape.fixCallback: scope["',f,'"] is null (scope\x3d"',d,'")'].join("");return function(c){return b(c,a)?d[f].apply(d,arguments||[]):void 0}}return d?function(c){return b(c,a)?f.apply(d,arguments||[]):void 0}:function(c){return b(c,a)?f.apply(d,arguments):void 0}};n.extend(w.Shape,w._eventsProcessing);w.Container={_init:function(){this.children=
[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(a){var c=a.getParent();c&&c.remove(a,!0);this.children.push(a);return a._setParent(this,this._getRealMatrix())},remove:function(a,b){for(var c=0;c<this.children.length;++c)if(this.children[c]==a){b||(a.parent=null,a.parentMatrix=null);r(this.children,c);break}return this},clear:function(a){for(var c,b=0;b<this.children.length;++b)c=this.children[b],c.parent=null,c.parentMatrix=null,a&&c.destroy();this.children=
[];return this},getBoundingBox:function(){if(this.children){var a=null;f.forEach(this.children,function(c){var b=c.getBoundingBox();b&&((c=c.getTransform())&&(b=g.multiplyRectangle(c,b)),a?(a.x=Math.min(a.x,b.x),a.y=Math.min(a.y,b.y),a.endX=Math.max(a.endX,b.x+b.width),a.endY=Math.max(a.endY,b.y+b.height)):a={x:b.x,y:b.y,endX:b.x+b.width,endY:b.y+b.height})});a&&(a.width=a.endX-a.x,a.height=a.endY-a.y);return a}return null},_moveChildToFront:function(a){for(var c=0;c<this.children.length;++c)if(this.children[c]==
a){r(this.children,c);this.children.push(a);break}return this},_moveChildToBack:function(a){for(var c=0;c<this.children.length;++c)if(this.children[c]==a){r(this.children,c);this.children.unshift(a);break}return this}};w.Surface=m("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){f.forEach(this._nodes,k.destroy);this._nodes=[];f.forEach(this._events,function(a){a&&a.remove()});this._events=[];this.rawNode=null;
if(b("ie"))for(;this._parent.lastChild;)k.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(a){},whenLoaded:function(c,b){var d=n.hitch(c,b);if(this.isLoaded)d(this);else a.once(this,"load",function(a){d(a)})}});n.extend(w.Surface,w._eventsProcessing);w.Rect=m("dojox.gfx.shape.Rect",w.Shape,{constructor:function(a){this.shape=t.getDefault("Rect");this.rawNode=
a},getBoundingBox:function(){return this.shape}});w.Ellipse=m("dojox.gfx.shape.Ellipse",w.Shape,{constructor:function(a){this.shape=t.getDefault("Ellipse");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-a.rx,y:a.cy-a.ry,width:2*a.rx,height:2*a.ry}}return this.bbox}});w.Circle=m("dojox.gfx.shape.Circle",w.Shape,{constructor:function(a){this.shape=t.getDefault("Circle");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-
a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r}}return this.bbox}});w.Line=m("dojox.gfx.shape.Line",w.Shape,{constructor:function(a){this.shape=t.getDefault("Line");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:Math.min(a.x1,a.x2),y:Math.min(a.y1,a.y2),width:Math.abs(a.x2-a.x1),height:Math.abs(a.y2-a.y1)}}return this.bbox}});w.Polyline=m("dojox.gfx.shape.Polyline",w.Shape,{constructor:function(a){this.shape=t.getDefault("Polyline");this.rawNode=a},setShape:function(a,
b){a&&a instanceof Array?(this.inherited(arguments,[{points:a}]),b&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[a]);return this},_normalizePoints:function(){var a=this.shape.points,b=a&&a.length;if(b&&"number"==typeof a[0]){for(var d=[],f=0;f<b;f+=2)d.push({x:a[f],y:a[f+1]});this.shape.points=d}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var a=this.shape.points,b=a.length,d=a[0],f=d.x,k=d.y,g=d.x,m=d.y,h=1;h<b;++h)d=
a[h],f>d.x&&(f=d.x),g<d.x&&(g=d.x),k>d.y&&(k=d.y),m<d.y&&(m=d.y);this.bbox={x:f,y:k,width:g-f,height:m-k}}return this.bbox}});w.Image=m("dojox.gfx.shape.Image",w.Shape,{constructor:function(a){this.shape=t.getDefault("Image");this.rawNode=a},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});w.Text=m(w.Shape,{constructor:function(a){this.fontStyle=null;this.shape=t.getDefault("Text");this.rawNode=a},getFont:function(){return this.fontStyle},
setFont:function(a){this.fontStyle="string"==typeof a?t.splitFontString(a):t.makeParameters(t.defaultFont,a);this._setFont();return this},getBoundingBox:function(){var a=null;this.getShape().text&&(a=t._base._computeTextBoundingBox(this));return a}});w.Creator={createShape:function(a){switch(a.type){case t.defaultPath.type:return this.createPath(a);case t.defaultRect.type:return this.createRect(a);case t.defaultCircle.type:return this.createCircle(a);case t.defaultEllipse.type:return this.createEllipse(a);
case t.defaultLine.type:return this.createLine(a);case t.defaultPolyline.type:return this.createPolyline(a);case t.defaultImage.type:return this.createImage(a);case t.defaultText.type:return this.createText(a);case t.defaultTextPath.type:return this.createTextPath(a)}return null},createGroup:function(){return this.createObject(t.Group)},createRect:function(a){return this.createObject(t.Rect,a)},createEllipse:function(a){return this.createObject(t.Ellipse,a)},createCircle:function(a){return this.createObject(t.Circle,
a)},createLine:function(a){return this.createObject(t.Line,a)},createPolyline:function(a){return this.createObject(t.Polyline,a)},createImage:function(a){return this.createObject(t.Image,a)},createText:function(a){return this.createObject(t.Text,a)},createPath:function(a){return this.createObject(t.Path,a)},createTextPath:function(a){return this.createObject(t.TextPath,{}).setText(a)},createObject:function(a,b){return null}};return w})},"dojox/gfx/matrix":function(){define(["./_base","dojo/_base/lang"],
function(t,n){var m=t.matrix={},h={};m._degToRad=function(b){return h[b]||(h[b]=Math.PI*b/180)};m._radToDeg=function(b){return b/Math.PI*180};m.Matrix2D=function(b){if(b)if("number"==typeof b)this.xx=this.yy=b;else if(b instanceof Array){if(0<b.length){for(var a=m.normalize(b[0]),f=1;f<b.length;++f){var k=a,h=m.normalize(b[f]),a=new m.Matrix2D;a.xx=k.xx*h.xx+k.xy*h.yx;a.xy=k.xx*h.xy+k.xy*h.yy;a.yx=k.yx*h.xx+k.yy*h.yx;a.yy=k.yx*h.xy+k.yy*h.yy;a.dx=k.xx*h.dx+k.xy*h.dy+k.dx;a.dy=k.yx*h.dx+k.yy*h.dy+
k.dy}n.mixin(this,a)}}else n.mixin(this,b)};n.extend(m.Matrix2D,{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0});n.mixin(m,{identity:new m.Matrix2D,flipX:new m.Matrix2D({xx:-1}),flipY:new m.Matrix2D({yy:-1}),flipXY:new m.Matrix2D({xx:-1,yy:-1}),translate:function(b,a){return 1<arguments.length?new m.Matrix2D({dx:b,dy:a}):new m.Matrix2D({dx:b.x,dy:b.y})},scale:function(b,a){return 1<arguments.length?new m.Matrix2D({xx:b,yy:a}):"number"==typeof b?new m.Matrix2D({xx:b,yy:b}):new m.Matrix2D({xx:b.x,yy:b.y})},rotate:function(b){var a=
Math.cos(b);b=Math.sin(b);return new m.Matrix2D({xx:a,xy:-b,yx:b,yy:a})},rotateg:function(b){return m.rotate(m._degToRad(b))},skewX:function(b){return new m.Matrix2D({xy:Math.tan(b)})},skewXg:function(b){return m.skewX(m._degToRad(b))},skewY:function(b){return new m.Matrix2D({yx:Math.tan(b)})},skewYg:function(b){return m.skewY(m._degToRad(b))},reflect:function(b,a){1==arguments.length&&(a=b.y,b=b.x);var f=b*b,k=a*a,h=f+k,g=2*b*a/h;return new m.Matrix2D({xx:2*f/h-1,xy:g,yx:g,yy:2*k/h-1})},project:function(b,
a){1==arguments.length&&(a=b.y,b=b.x);var f=b*b,k=a*a,h=f+k,g=b*a/h;return new m.Matrix2D({xx:f/h,xy:g,yx:g,yy:k/h})},normalize:function(b){return b instanceof m.Matrix2D?b:new m.Matrix2D(b)},isIdentity:function(b){return 1==b.xx&&0==b.xy&&0==b.yx&&1==b.yy&&0==b.dx&&0==b.dy},clone:function(b){var a=new m.Matrix2D,f;for(f in b)"number"==typeof b[f]&&"number"==typeof a[f]&&a[f]!=b[f]&&(a[f]=b[f]);return a},invert:function(b){b=m.normalize(b);var a=b.xx*b.yy-b.xy*b.yx;return b=new m.Matrix2D({xx:b.yy/
a,xy:-b.xy/a,yx:-b.yx/a,yy:b.xx/a,dx:(b.xy*b.dy-b.yy*b.dx)/a,dy:(b.yx*b.dx-b.xx*b.dy)/a})},_multiplyPoint:function(b,a,f){return{x:b.xx*a+b.xy*f+b.dx,y:b.yx*a+b.yy*f+b.dy}},multiplyPoint:function(b,a,f){b=m.normalize(b);return"number"==typeof a&&"number"==typeof f?m._multiplyPoint(b,a,f):m._multiplyPoint(b,a.x,a.y)},multiplyRectangle:function(b,a){var f=m.normalize(b);a=a||{x:0,y:0,width:0,height:0};if(m.isIdentity(f))return{x:a.x,y:a.y,width:a.width,height:a.height};b=m.multiplyPoint(f,a.x,a.y);
var k=m.multiplyPoint(f,a.x,a.y+a.height),h=m.multiplyPoint(f,a.x+a.width,a.y);a=m.multiplyPoint(f,a.x+a.width,a.y+a.height);var f=Math.min(b.x,k.x,h.x,a.x),g=Math.min(b.y,k.y,h.y,a.y);return{x:f,y:g,width:Math.max(b.x,k.x,h.x,a.x)-f,height:Math.max(b.y,k.y,h.y,a.y)-g}},multiply:function(b){for(var a=m.normalize(b),f=1;f<arguments.length;++f){var k=a,h=m.normalize(arguments[f]),a=new m.Matrix2D;a.xx=k.xx*h.xx+k.xy*h.yx;a.xy=k.xx*h.xy+k.xy*h.yy;a.yx=k.yx*h.xx+k.yy*h.yx;a.yy=k.yx*h.xy+k.yy*h.yy;a.dx=
k.xx*h.dx+k.xy*h.dy+k.dx;a.dy=k.yx*h.dx+k.yy*h.dy+k.dy}return a},_sandwich:function(b,a,f){return m.multiply(m.translate(a,f),b,m.translate(-a,-f))},scaleAt:function(b,a,f,k){switch(arguments.length){case 4:return m._sandwich(m.scale(b,a),f,k);case 3:return"number"==typeof f?m._sandwich(m.scale(b),a,f):m._sandwich(m.scale(b,a),f.x,f.y)}return m._sandwich(m.scale(b),a.x,a.y)},rotateAt:function(b,a,f){return 2<arguments.length?m._sandwich(m.rotate(b),a,f):m._sandwich(m.rotate(b),a.x,a.y)},rotategAt:function(b,
a,f){return 2<arguments.length?m._sandwich(m.rotateg(b),a,f):m._sandwich(m.rotateg(b),a.x,a.y)},skewXAt:function(b,a,f){return 2<arguments.length?m._sandwich(m.skewX(b),a,f):m._sandwich(m.skewX(b),a.x,a.y)},skewXgAt:function(b,a,f){return 2<arguments.length?m._sandwich(m.skewXg(b),a,f):m._sandwich(m.skewXg(b),a.x,a.y)},skewYAt:function(b,a,f){return 2<arguments.length?m._sandwich(m.skewY(b),a,f):m._sandwich(m.skewY(b),a.x,a.y)},skewYgAt:function(b,a,f){return 2<arguments.length?m._sandwich(m.skewYg(b),
a,f):m._sandwich(m.skewYg(b),a.x,a.y)}});t.Matrix2D=m.Matrix2D;return m})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","./matrix","./shape"],function(t,n,m,h,b){b=m("dojox.gfx.path.Path",b.Shape,{constructor:function(a){this.shape=n.clone(t.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=a;this.segmented=!1},setAbsoluteMode:function(a){this._confirmSegmented();this.absolute="string"==typeof a?"absolute"==a:a;return this},
getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var a=this.bbox,b=this._getRealMatrix();this.bbox=null;for(var k=0,h=this.segments.length;k<h;++k)this._updateWithSegment(this.segments[k],b);b=this.bbox;this.bbox=
a;return this.tbbox=b?[{x:b.l,y:b.t},{x:b.r,y:b.t},{x:b.r,y:b.b},{x:b.l,y:b.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(a,b,k){k&&(b=h.multiplyPoint(k,a,b),a=b.x,b=b.y);this.bbox&&"l"in this.bbox?(this.bbox.l>a&&(this.bbox.l=a),this.bbox.r<a&&(this.bbox.r=a),this.bbox.t>b&&(this.bbox.t=b),this.bbox.b<b&&(this.bbox.b=b)):this.bbox={l:a,b:b,r:a,t:b}},
_updateWithSegment:function(a,b){var f=a.args,h=f.length,g;switch(a.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(g=0;g<h;g+=2)this._updateBBox(f[g],f[g+1],b);this.last.x=f[h-2];this.last.y=f[h-1];this.absolute=!0;break;case "H":for(g=0;g<h;++g)this._updateBBox(f[g],this.last.y,b);this.last.x=f[h-1];this.absolute=!0;break;case "V":for(g=0;g<h;++g)this._updateBBox(this.last.x,f[g],b);this.last.y=f[h-1];this.absolute=!0;break;case "m":g=0;"x"in this.last||(this._updateBBox(this.last.x=
f[0],this.last.y=f[1],b),g=2);for(;g<h;g+=2)this._updateBBox(this.last.x+=f[g],this.last.y+=f[g+1],b);this.absolute=!1;break;case "l":case "t":for(g=0;g<h;g+=2)this._updateBBox(this.last.x+=f[g],this.last.y+=f[g+1],b);this.absolute=!1;break;case "h":for(g=0;g<h;++g)this._updateBBox(this.last.x+=f[g],this.last.y,b);this.absolute=!1;break;case "v":for(g=0;g<h;++g)this._updateBBox(this.last.x,this.last.y+=f[g],b);this.absolute=!1;break;case "c":for(g=0;g<h;g+=6)this._updateBBox(this.last.x+f[g],this.last.y+
f[g+1],b),this._updateBBox(this.last.x+f[g+2],this.last.y+f[g+3],b),this._updateBBox(this.last.x+=f[g+4],this.last.y+=f[g+5],b);this.absolute=!1;break;case "s":case "q":for(g=0;g<h;g+=4)this._updateBBox(this.last.x+f[g],this.last.y+f[g+1],b),this._updateBBox(this.last.x+=f[g+2],this.last.y+=f[g+3],b);this.absolute=!1;break;case "A":for(g=0;g<h;g+=7)this._updateBBox(f[g+5],f[g+6],b);this.last.x=f[h-2];this.last.y=f[h-1];this.absolute=!0;break;case "a":for(g=0;g<h;g+=7)this._updateBBox(this.last.x+=
f[g+5],this.last.y+=f[g+6],b);this.absolute=!1}a=[a.action];for(g=0;g<h;++g)a.push(t.formatNumber(f[g],!0));if("string"==typeof this.shape.path)this.shape.path+=a.join("");else for(g=0,h=a.length;g<h;++g)this.shape.path.push(a[g])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(a,b){this.tbbox=null;var f=this._validSegments[a.toLowerCase()];"number"==typeof f&&(f?b.length>=f&&(a={action:a,args:b.slice(0,b.length-b.length%f)},this.segments.push(a),this._updateWithSegment(a)):
(a={action:a,args:[]},this.segments.push(a),this._updateWithSegment(a)))},_collectArgs:function(a,b){for(var f=0;f<b.length;++f){var h=b[f];"boolean"==typeof h?a.push(h?1:0):"number"==typeof h?a.push(h):h instanceof Array?this._collectArgs(a,h):"x"in h&&"y"in h&&a.push(h.x,h.y)}},moveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"M":"m",a);return this},lineTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);
this._pushSegment(this.absolute?"L":"l",a);return this},hLineTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"H":"h",a);return this},vLineTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"V":"v",a);return this},curveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"C":"c",a);return this},smoothCurveTo:function(){this._confirmSegmented();
var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"S":"s",a);return this},qCurveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"Q":"q",a);return this},qSmoothCurveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"T":"t",a);return this},arcTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"A":
"a",a);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var a=this.shape.path;this.shape.path=[];this._setPath(a);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(a){a=n.isArray(a)?a:a.match(t.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(a){for(var b="",h=[],m=a.length,g=0;g<m;++g){var r=a[g],w=parseFloat(r);isNaN(w)?(b&&this._pushSegment(b,
h),h=[],b=r):h.push(w)}this._pushSegment(b,h)}},setShape:function(a){this.inherited(arguments,["string"==typeof a?{path:a}:a]);this.segmented=!1;this.segments=[];t.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});m=m("dojox.gfx.path.TextPath",b,{constructor:function(a){"text"in this||(this.text=n.clone(t.defaultTextPath));"fontStyle"in this||(this.fontStyle=n.clone(t.defaultFont))},getText:function(){return this.text},setText:function(a){this.text=t.makeParameters(this.text,
"string"==typeof a?{text:a}:a);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(a){this.fontStyle="string"==typeof a?t.splitFontString(a):t.makeParameters(t.defaultFont,a);this._setFont();return this}});return t.path={Path:b,TextPath:m}})},"*now":function(t){t(['dojo/i18n!*preload*esri/widgets/nls/Legend*["ar","bs","ca","cs","da","de","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Legend/nls/Legend ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/decorators/cast ./Widget ./Legend/LegendViewModel ./Legend/styles/Card ./Legend/styles/Classic ./support/widget".split(" "),function(t,n,m,h,b,a,f,k,u,g,r,w,c,l,d){return function(n){function p(b){b=n.call(this)||this;b._handles=new f;b.activeLayerInfos=null;
b.basemapLegendVisible=!1;b.groundLegendVisible=!1;b.respectLayerVisibility=!0;b.iconClass="esri-icon-layer-list";b.label=a.widgetLabel;b.layerInfos=null;b.style=new l;b.view=null;b.viewModel=new w;return b}h(p,n);p.prototype.postInitialize=function(){var a=this;this.own(k.on(this,"activeLayerInfos","change",function(){return a._refreshActiveLayerInfos(a.activeLayerInfos)}),k.init(this,"style",function(b,c){c&&b!==c&&c.destroy();b&&(b.activeLayerInfos=a.activeLayerInfos,"card"===b.type&&(b.view=a.view))}))};
p.prototype.destroy=function(){this._handles.destroy();this._handles=null};p.prototype.castStyle=function(a){if(a instanceof c||a instanceof l)return a;if("string"===typeof a)return"card"===a?new c:new l;if(a&&"string"===typeof a.type){var b=m({},a);delete b.type;return new ("card"===a.type?c:l)(b)}return new l};p.prototype.render=function(){return this.style.render()};p.prototype._refreshActiveLayerInfos=function(a){var b=this;this._handles.removeAll();a.forEach(function(a){return b._renderOnActiveLayerInfoChange(a)});
this.scheduleRender()};p.prototype._renderOnActiveLayerInfoChange=function(a){var b=this,c=k.init(a,"version",function(){return b.scheduleRender()});this._handles.add(c,"version_"+a.layer.uid);a.children.forEach(function(a){return b._renderOnActiveLayerInfoChange(a)})};b([u.aliasOf("viewModel.activeLayerInfos"),d.renderable()],p.prototype,"activeLayerInfos",void 0);b([u.aliasOf("viewModel.basemapLegendVisible"),d.renderable()],p.prototype,"basemapLegendVisible",void 0);b([u.aliasOf("viewModel.groundLegendVisible"),
d.renderable()],p.prototype,"groundLegendVisible",void 0);b([u.aliasOf("viewModel.respectLayerVisibility"),d.renderable()],p.prototype,"respectLayerVisibility",void 0);b([u.property()],p.prototype,"iconClass",void 0);b([u.property()],p.prototype,"label",void 0);b([u.aliasOf("viewModel.layerInfos"),d.renderable()],p.prototype,"layerInfos",void 0);b([u.property(),d.renderable()],p.prototype,"style",void 0);b([g.cast("style")],p.prototype,"castStyle",null);b([u.aliasOf("viewModel.view"),d.renderable()],
p.prototype,"view",void 0);b([u.property(),d.renderable(["view.size"])],p.prototype,"viewModel",void 0);return p=b([u.subclass("esri.widgets.Legend")],p)}(u.declared(r))});