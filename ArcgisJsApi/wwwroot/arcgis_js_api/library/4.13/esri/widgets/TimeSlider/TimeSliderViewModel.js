// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../TimeExtent ../../TimeInterval ../../core/Accessor ../../core/compilerUtils ../../core/mathUtils ../../core/accessorSupport/decorators ../../layers/support/timeUtils".split(" "),function(r,t,h,e,f,k,l,m,n,d,p){return function(g){function c(b){b=g.call(this,b)||this;b.fullTimeExtent=null;b.loop=!0;b.mode="time-window";b.stops={count:10};b.timerId=null;b.view=null;return b}h(c,g);c.prototype.destroy=
function(){null!=this.timerId&&(clearInterval(this.timerId),this.timerId=null)};Object.defineProperty(c.prototype,"effectiveStops",{get:function(){var b=this.fullTimeExtent,a=this.stops;if(!a)return[];if("dates"in a){a=a.dates;if(null==a||0===a.length)return null;a=a.sort(function(a,b){return a.getTime()-b.getTime()});return b?a.filter(function(a){var c=b.start,q=b.end;return!(a.getTime()<c.getTime()||a.getTime()>q.getTime())}):a}if("count"in a){var c=a.timeExtent||b;return this._divideTimeExtentByCount(c,
a.count)}return"interval"in a?(c=a.timeExtent||b,this._divideTimeExtentByInterval(c,a.interval)):[]},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"playRate",{set:function(b){0>=b||36E5<b||("playing"===this.state&&this._startAnimation(),this._set("playRate",b))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"state",{get:function(){return this.values&&this.fullTimeExtent?this.timerId?"playing":"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"timeExtent",{get:function(){var b=this.mode,a=this.values;if(!a||0===a.length)return null;switch(b){case "instant":return new f({start:a[0],end:a[0]});case "time-window":return 1<a.length?new f({start:a[0],end:a[1]}):null;case "cumulative-from-start":return new f({start:null,end:a[0]});case "cumulative-from-end":return new f({start:a[0],end:null});default:m.neverReached(b)}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"values",{set:function(b){var a=this.fullTimeExtent,c=this.view;
if(a){var d=a.end,e=a.start.getTime(),f=d.getTime();b=b.map(function(a){a=a.getTime();a=n.clamp(a,e,f);return new Date(a)})}c&&(c.timeExtent=this._toTimeExtent(b));this._set("values",b)},enumerable:!0,configurable:!0});c.prototype.next=function(){this.values&&this.fullTimeExtent&&this._step(!0)};c.prototype.play=function(){this._clearAnimation();this._startAnimation()};c.prototype.previous=function(){this._step(!1)};c.prototype.stop=function(){this._clearAnimation()};c.prototype._clearAnimation=function(){null!=
this.timerId&&(clearInterval(this.timerId),this.timerId=null)};c.prototype._startAnimation=function(){var b=this;this._step();this.timerId=setInterval(function(){b._step()},this.playRate)};c.prototype._step=function(b){void 0===b&&(b=!0);var a=this.effectiveStops,c=this.values;if(c&&0!==c.length&&!(c.length>a.length)){var d=a.map(function(a){return a.getTime()}).sort(function(a,b){return a-b}),a=c.map(function(a){return a.getTime()}).map(function(a){var b=d.indexOf(a);if(-1!==b)return b;b=d.reduce(function(b,
c){return Math.abs(c-a)<Math.abs(b-a)?c:b});return d.indexOf(b)}),c=a.map(function(a){return a+=b?1:-1}),e=c.some(function(a){return 0>a||a>d.length-1}),f=this.loop,g=this.state;if(e)if(f){var h=Math.min.apply(Math,a),k=Math.max.apply(Math,a);this.values=(b?a.map(function(a){return a-h}):a.map(function(a){return a+(d.length-1-k)})).map(function(a){return new Date(d[a])})}else"playing"===g&&this.stop();else this.values=c.map(function(a){return new Date(d[a])})}};c.prototype._divideTimeExtentByCount=
function(b,a){if(!b||!a)return[];var c=b.start,d=b.end;if(!c||!d)return[];a=Math.floor((d.getTime()-c.getTime())/a);a=new k({value:a});return this._divideTimeExtentByInterval(b,a)};c.prototype._divideTimeExtentByInterval=function(b,a){if(!b||!a)return[];var c=b.start;b=b.end;if(!c||!b)return[];var d=[],e=a.value;for(a=a.unit;c.getTime()<=b.getTime();)d.push(new Date(c.getTime())),c=p.offsetDate(c,e,a);return d};c.prototype._toTimeExtent=function(b){if(!b||0===b.length)return null;var a=b[0];b=1<b.length?
b[1]:b[0];switch(this.mode){case "instant":case "time-window":return new f({start:a,end:b});case "cumulative-from-start":return new f({start:null,end:a});case "cumulative-from-end":return new f({start:a,end:null});default:return null}};e([d.property({dependsOn:["stops","fullTimeExtent"],readOnly:!0})],c.prototype,"effectiveStops",null);e([d.property({type:f})],c.prototype,"fullTimeExtent",void 0);e([d.property({nonNullable:!0})],c.prototype,"loop",void 0);e([d.property({nonNullable:!0})],c.prototype,
"mode",void 0);e([d.property({nonNullable:!0,value:1E3})],c.prototype,"playRate",null);e([d.property({dependsOn:["fullTimeExtent","timerId","values"],readOnly:!0})],c.prototype,"state",null);e([d.property()],c.prototype,"stops",void 0);e([d.property({dependsOn:["values"],readOnly:!0})],c.prototype,"timeExtent",null);e([d.property()],c.prototype,"timerId",void 0);e([d.property({value:null})],c.prototype,"values",null);e([d.property()],c.prototype,"view",void 0);e([d.property()],c.prototype,"next",
null);e([d.property()],c.prototype,"play",null);e([d.property()],c.prototype,"previous",null);e([d.property()],c.prototype,"stop",null);return c=e([d.subclass("esri.widgets.TimeSlider.TimeSliderViewModel")],c)}(d.declared(l))});