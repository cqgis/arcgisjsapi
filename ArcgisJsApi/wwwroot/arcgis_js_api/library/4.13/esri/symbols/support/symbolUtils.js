// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/compilerUtils ../../core/maybe ../../core/promiseUtils ./previewSymbol2D ./previewSymbol3D ./previewWebStyleSymbol ./utils".split(" "),function(z,n,A,B,C,D,E,F,G,H,u){function r(a,c){switch(a.type){case "web-style":return H.previewWebStyleSymbol(a,r,c);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return G.previewSymbol3D(a,c);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":case "cim":return F.previewSymbol2D(a,
c);default:C.neverReached(a)}}function w(a){return a&&"opacity"in a?a.opacity*w(a.parent):1}Object.defineProperty(n,"__esModule",{value:!0});var m=null;n.renderDotDensityPreviewHTML=function(a,c,d){var k=a.backgroundColor,b=a.outline;a=a.dotSize;var e=d&&d.swatchSize||22,l=Math.round(e*e/Math.pow(a,2)*.8),f=window.devicePixelRatio;d=document.createElement("canvas");var g=e*f;d.width=g;d.height=g;d.style.width=d.width/f+"px";d.style.height=d.height/f+"px";var h=d.getContext("2d");k&&(h.fillStyle=k.toCss(!0),
h.fillRect(0,0,g,g),h.fill());h.fillStyle=c.toCss(!0);if(m&&m.length/2===l)for(c=0;c<2*l;c+=2){var k=m[c],p=m[c+1];h.fillRect(k,p,a*f,a*f);h.fill()}else for(m=[],c=0;c<2*l;c+=2)k=Math.floor(Math.random()*(g-0+1)+0),p=Math.floor(Math.random()*(g-0+1)+0),m.push(k,p),h.fillRect(k,p,a*f,a*f),h.fill();b&&(b.color&&(h.strokeStyle=b.color.toCss(!0)),h.lineWidth=b.width,h.strokeRect(0,0,g,g));b=new Image(e,e);b.src=d.toDataURL();return b};n.renderColorRampPreviewHTML=function(a,c){var d=c&&"horizontal"===
c.align,k=c&&c.width||(d?75:24);c=c&&c.height||(d?24:75);var b=window.devicePixelRatio,e=k*b,l=c*b,b=document.createElement("canvas");b.width=e;b.height=l;b.style.width=k+"px";b.style.height=c+"px";var f=b.getContext("2d"),g=f.createLinearGradient(0,0,d?e:0,d?0:l),h=1/(a.length-1);a.forEach(function(a,c){return g.addColorStop(c*h,a.toString())});f.fillStyle=g;f.fillRect(0,0,e,l);a=document.createElement("div");a.style.width=k+"px";a.style.height=c+"px";a.appendChild(b);return a};n.renderPreviewHTML=
r;n.getDisplayedSymbol=function(a,c){return B(this,void 0,void 0,function(){var d,k,b,e,l,f,g,h,p,m,n,q,r,x,y,t;return A(this,function(v){switch(v.label){case 0:if(!a)return[2,void 0];d=w(a.layer||a.sourceLayer);if(D.isSome(a.symbol))return k=a.symbol.clone(),u.applyColorToSymbol(k,null,d),[2,k];b=a.get("layer.renderer")||a.get("sourceLayer.renderer");return[4,b.getSymbolAsync(a)];case 1:e=v.sent();if(!e)return[2,void 0];e=e.clone();return!("visualVariables"in b)||"visualVariables"in b&&!b.visualVariables||
"visualVariables"in b&&b.visualVariables&&!b.visualVariables.length?[2,e]:[4,E.create(function(a){return z(["../../renderers/visualVariables/support/visualVariableUtils"],a)})];case 2:l=v.sent();f=[];g=[];h=[];p=[];m=0;for(n=b.visualVariables;m<n.length;m++)switch(q=n[m],q.type){case "color":f.push(q);break;case "opacity":g.push(q);break;case "rotation":p.push(q);break;case "size":h.push(q)}x=(r=!!f.length&&f[f.length-1])?l.getColor(r,a,c):null;t=(y=!!g.length&&g[g.length-1])?l.getOpacity(y,a,c):
null;null!=d&&(t=null!=t?t*d:d);u.applyColorToSymbol(e,x,t);h.forEach(function(b){return u.applySizeToSymbol(e,l.getSize(b,a,c),b.axis)});p.forEach(function(b){return u.applyRotationToSymbol(e,l.getRotationAngle(b,a,c),b.axis)});return[2,e]}})})}});