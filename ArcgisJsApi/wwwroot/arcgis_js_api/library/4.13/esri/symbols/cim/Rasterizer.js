// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define(["require","exports","./CIMSymbolHelper","./SDFHelper","./utils"],function(m,n,h,p,q){Object.defineProperty(n,"__esModule",{value:!0});m=function(){function k(){}k.prototype.dispose=function(){this._rasterizationCanvas=null};k.prototype.rasterizeJSONResource=function(b,a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===b.type||"esriSFS"===b.type)return a=h.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,b.style),{size:[a[1],
a[2]],image:new Uint32Array(a[0].buffer),sdf:!1,simplePattern:!0};if("simple-line"===b.type||"esriSLS"===b.type)return a=h.SymbolHelper.rasterizeSimpleLine(this._rasterizationCanvas,b.style,b.cap),{size:[a[1],a[2]],image:new Uint32Array(a[0].buffer),sdf:!0,simplePattern:!0};var c;b="simple-marker"===b.type||"esriSMS"===b.type?h.CIMSymbolHelper.fromSimpleMarker(b):b;if((c=p.getSDFInfo(b))&&!a)return a=p.buildSDF(c),(b=a[0])?{size:[a[1],a[2]],image:new Uint32Array(b.buffer),sdf:!0,simplePattern:!0}:
null;a=h.CIMSymbolHelper.rasterize(this._rasterizationCanvas,b,!a);return(b=a[0])?{size:[a[1],a[2]],image:new Uint32Array(b.buffer),sdf:!1,simplePattern:!1}:null};k.prototype.rasterizeImageResource=function(b,a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=b.width;this._rasterizationCanvas.height=b.height;var c=this._rasterizationCanvas.getContext("2d");c.drawImage(b,0,0,b.width,b.height);c=c.getImageData(0,0,b.width,b.height);
c=new Uint8Array(c.data);if(a)for(var e=0;e<a.length;e++){var f=a[e];if(f&&f.oldColor&&4===f.oldColor.length&&f.newColor&&4===f.newColor.length){var l=f.oldColor,g=l[0],h=l[1],k=l[2],l=l[3],d=f.newColor,f=d[0],m=d[1],n=d[2],p=d[3];if(g!==f||h!==m||k!==n||l!==p)for(d=0;d<c.length;d+=4)g===c[d]&&h===c[d+1]&&k===c[d+2]&&l===c[d+3]&&(c[d]=f,c[d+1]=m,c[d+2]=n,c[d+3]=p)}}for(d=0;d<c.length;d+=4)a=c[d+3]/255,c[d]*=a,c[d+1]*=a,c[d+2]*=a;a=b.width;e=b.height;g=c;if(512<=a||512<=e)g=b.width/b.height,1<g?(a=
512,e=Math.round(512/g)):(e=512,a=Math.round(512*g)),g=new Uint8Array(4*a*e),q.resampleHermite(c,b.width,b.height,new Uint8ClampedArray(g.buffer),a,e,!1);return{size:[a,e],image:new Uint32Array(g.buffer),sdf:!1,simplePattern:!1}};return k}();n.default=m});