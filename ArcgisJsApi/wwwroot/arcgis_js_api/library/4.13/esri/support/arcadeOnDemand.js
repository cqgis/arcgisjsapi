// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/assignHelper ../geometry ../core/maybe ../core/promiseUtils".split(" "),function(r,c,w,k,D,E,F,l){function x(){return k(this,void 0,void 0,function(){var b;return w(this,function(a){g||(b={arcade:null,arcadeUtils:null,Dictionary:null,Feature:null},g=l.all([l.create(function(b){return r(["./arcadeUtils"],b)})]).then(function(a){a=a[0];b.arcade=a.arcade;b.arcadeUtils=a;b.Dictionary=a.Dictionary;
b.Feature=a.arcadeFeature;return b.arcade.load()}).then(function(){return b}));return[2,g]})})}Object.defineProperty(c,"__esModule",{value:!0});var g;c.loadArcade=x;c.createLabelExpression=function(b,a,d){return f.create(b,a,d,null,["$feature"])};c.createVVExpression=function(b,a,d){return f.create(b,a,d,null,["$feature","$view"])};c.createRendererExpression=function(b,a,d){return f.create(b,a,d,null,["$feature","$view"])};c.createDictionaryExpression=function(b,a,d,c){return f.create(b,a,d,c,["$feature",
"$view"])};var f=function(){function b(a,b,c,f,l,g,H){this.evaluate=f;this._syntaxTree=c;this._arcade=a;this._arcadeDictionary=b;this._arcadeFeature=l;this._fields=g;this._spatialReference=H;this._referencesGeometry=a.scriptTouchesGeometry(this._syntaxTree);this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"$view.scale")}b.create=function(a,c,f,g,r,G){return k(this,void 0,void 0,function(){var d,e,k,p,q,h,t,m,y,z,u,A,n,B,C;return w(this,function(v){switch(v.label){case 0:return[4,
x()];case 1:return d=v.sent(),e=d.arcade,k=d.Feature,p=d.Dictionary,q=E.SpatialReference.fromJSON(c),h=e.parseScript(a,G),t=r.reduce(function(a,b){var c;return D({},a,(c={},c[b]=null,c))},{}),m=null,F.isSome(g)&&(m=new p(g),m.immutable=!0,t.$config=null),y=e.scriptUsesGeometryEngine(h)&&e.enableGeometrySupport(),z=e.scriptUsesFeatureSet(h)&&e.enableFeatureSetSupport(),u=e.scriptIsAsync(h)&&e.enableAsyncSupport(),A={vars:t,spatialReference:q,useAsync:!!u},n=new p,n.immutable=!1,n.setField("scale",
0),B=e.compileScript(h,A),C=function(a){"$view"in a&&a.$view&&(n.setField("scale",a.$view.scale),a.$view=n);m&&(a.$config=m);return B({vars:a,spatialReference:q})},[4,l.all([y,z,u])];case 2:return v.sent(),[2,new b(e,p,h,C,new k,f,q)]}})})};b.prototype.repurposeFeature=function(a){a.geometry&&!a.geometry.spatialReference&&(a.geometry.spatialReference=this._spatialReference);this._arcadeFeature.repurposeFromGraphicLikeObject(a.geometry,a.attributes,{fields:this._fields});return this._arcadeFeature};
b.prototype.createDictionary=function(){return new this._arcadeDictionary};b.prototype.referencesMember=function(a){return this._arcade.referencesMember(this._syntaxTree,a)};b.prototype.referencesFunction=function(a){return this._arcade.referencesFunction(this._syntaxTree,a)};b.prototype.referencesGeometry=function(){return this._referencesGeometry};b.prototype.referencesScale=function(){return this._referencesScale};b.prototype.extractFieldLiterals=function(a){return this._arcade.extractFieldLiterals(this._syntaxTree,
a)};return b}();c.default=f});