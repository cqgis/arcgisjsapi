// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/graphics/featureConversionUtils":function(){define("require exports ../../core/Error ../../core/Logger ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),function(B,a,r,p,b,c,l,k){function u(a,n){return a?n?4:3:n?3:2}function y(a,n){return Math.round((n-a.translate[0])/a.scale[0])}function C(a,n){return Math.round((a.translate[1]-n)/a.scale[1])}function w(a,n){return n*a.scale[0]+a.translate[0]}function G(a,n){return a.translate[1]-
n*a.scale[1]}function E(a){a=a.coords;return{x:a[0],y:a[1]}}function I(a,n){a.coords[0]=n.x;a.coords[1]=n.y;return a}function D(a){a=a.coords;return{x:a[0],y:a[1],z:a[2]}}function F(a,n){a.coords[0]=n.x;a.coords[1]=n.y;a.coords[2]=n.z;return a}function m(a){a=a.coords;return{x:a[0],y:a[1],m:a[2]}}function q(a,n){a.coords[0]=n.x;a.coords[1]=n.y;a.coords[2]=n.m;return a}function h(a){a=a.coords;return{x:a[0],y:a[1],z:a[2],m:a[3]}}function e(a,n){a.coords[0]=n.x;a.coords[1]=n.y;a.coords[2]=n.z;a.coords[3]=
n.m;return a}function g(a,n){return a&&n?e:a?F:n?q:I}function t(a,n,g){if(!a)return null;for(var h=u(n,g),e=[],b=0;b<a.coords.length;b+=h){for(var c=[],m=0;m<h;m++)c.push(a.coords[b+m]);e.push(c)}return n?g?{points:e,hasZ:n,hasM:g}:{points:e,hasZ:n}:g?{points:e,hasM:g}:{points:e}}function v(a,n,g){void 0===g&&(g=u(n.hasZ,n.hasM));a.lengths[0]=n.points.length;var e=a.coords,h=0,b=0;for(n=n.points;b<n.length;b++)for(var c=n[b],m=0;m<g;m++)e[h++]=c[m];return a}function V(a,n,g){if(!a)return null;var e=
u(n,g),h=a.coords,b=[],m=0,c=0;for(a=a.lengths;c<a.length;c++){for(var t=a[c],q=[],A=0;A<t;A++){for(var v=[],k=0;k<e;k++)v.push(h[m++]);q.push(v)}b.push(q)}return n?g?{paths:b,hasZ:n,hasM:g}:{paths:b,hasZ:n}:g?{paths:b,hasM:g}:{paths:b}}function ca(a,n,g){void 0===g&&(g=u(n.hasZ,n.hasM));var e=a.lengths,h=a.coords,b=0,c=0;for(n=n.paths;c<n.length;c++){for(var m=n[c],t=0,q=m;t<q.length;t++)for(var A=q[t],v=0;v<g;v++)h[b++]=A[v];e.push(m.length)}return a}function na(a,n,g){if(!a)return null;var e=u(n,
g),h=a.coords,b=[],c=0,m=0;for(a=a.lengths;m<a.length;m++){for(var t=a[m],q=[],A=0;A<t;A++){for(var v=[],k=0;k<e;k++)v.push(h[c++]);q.push(v)}b.push(q)}return n?g?{rings:b,hasZ:n,hasM:g}:{rings:b,hasZ:n}:g?{rings:b,hasM:g}:{rings:b}}function fa(a,n,g,e){void 0===g&&(g=n.hasZ);void 0===e&&(e=n.hasM);K(a,n.rings,g,e);return a}function K(a,n,g,e){g=u(g,e);e=a.lengths;for(var h=a.coords,b=0,m=e.length=h.length=0;m<n.length;m++){for(var c=n[m],t=0,q=c;t<q.length;t++)for(var A=q[t],v=0;v<g;v++)h[b++]=A[v];
e.push(c.length)}return a}function n(a,n,e,h,b,m){a.length=0;if(!e){for(h=0;h<n.length;h++)b=n[h],a.push(new c.default(null,b.attributes,null,b.attributes[m]));return a}switch(e){case "esriGeometryPoint":h=g(h,b);for(b=0;b<n.length;b++){var t=n[b];e=t.geometry;var t=t.attributes,q=void 0;e&&(q=h(new k.default,e));a.push(new c.default(q,t,null,t[m]))}break;case "esriGeometryMultipoint":h=u(h,b);for(b=0;b<n.length;b++)t=n[b],e=t.geometry,t=t.attributes,q=void 0,e&&(q=v(new k.default,e,h)),a.push(new c.default(q,
t,null,t[m]));break;case "esriGeometryPolyline":h=u(h,b);for(b=0;b<n.length;b++)t=n[b],e=t.geometry,t=t.attributes,q=void 0,e&&(q=ca(new k.default,e,h)),a.push(new c.default(q,t,null,t[m]));break;case "esriGeometryPolygon":for(e=0;e<n.length;e++){var A=n[e],t=A.geometry,q=A.centroid,A=A.attributes,l=void 0;t&&(l=fa(new k.default,t,h,b));q?a.push(new c.default(l,A,I(new k.default,q),A[m])):a.push(new c.default(l,A,null,A[m]))}break;default:U.error("convertToFeatureSet:unknown-geometry",new r("Unable to parse unknown geometry type '"+
e+"'")),a.length=0}return a}function A(a,n,g,e,b){a.length=0;switch(g){case "esriGeometryPoint":g=E;e&&b?g=h:e?g=D:b&&(g=m);for(e=0;e<n.length;e++){var c=n[e];b=c.geometry;c=c.attributes;b=b?g(b):null;a.push({attributes:c,geometry:b})}break;case "esriGeometryMultipoint":for(g=0;g<n.length;g++){var q=n[g],c=q.geometry,q=q.attributes,A=void 0;c&&(A=t(c,e,b));a.push({attributes:q,geometry:A})}break;case "esriGeometryPolyline":for(g=0;g<n.length;g++)q=n[g],c=q.geometry,q=q.attributes,A=void 0,c&&(A=V(c,
e,b)),a.push({attributes:q,geometry:A});break;case "esriGeometryPolygon":for(g=0;g<n.length;g++){var A=n[g],q=A.geometry,c=A.attributes,v=A.centroid,A=void 0;q&&(A=na(q,e,b));v?(q=E(v),a.push({attributes:c,centroid:q,geometry:A})):a.push({attributes:c,geometry:A})}break;default:U.error("convertToFeatureSet:unknown-geometry",new r("Unable to parse unknown geometry type '"+g+"'"))}return a}function H(a,n,g,e,b,h){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!n||!n.coords.length)return null;
b=ua[b];var c=n.coords;n=n.lengths;var m=u(g,e);g=g?e?W:da:e?da:M;if(!n.length)return g(a.coords,c,0,0,y(h,c[0]),C(h,c[1])),a.lengths.length&&(a.lengths.length=0),a.coords.length=m,a;for(var t,q,A,v=0,k,l=0,F=0;F<n.length;F++){var E=n[F];if(!(E<b)){var p=0;k=l;q=e=y(h,c[v]);A=t=C(h,c[v+1]);g(a.coords,c,k,v,q,A);p++;v+=m;k+=m;for(var Y=1;Y<E;Y++,v+=m)if(q=y(h,c[v]),A=C(h,c[v+1]),q!==e||A!==t)g(a.coords,c,k,v,q-e,A-t),k+=m,p++,e=q,t=A;p>=b&&(a.lengths.push(p),l=k)}}a.coords.length=l;return a.coords.length?
a:null}function X(a,n,g,e,b,h,c){for(var m=c-g,t=0,q=0,A,v=h+g;v<c-g;v+=g){A=n[v];var k=n[v+1],l=n[h],F=n[h+1],E=n[m],u=n[m+1];l===E?A=Math.abs(A-l):(E=(u-F)/(E-l),A=Math.abs(E*A-k+(F-E*l))/Math.sqrt(E*E+1));A>t&&(q=v,t=A)}t>e?(X(a,n,g,e,b,h,q+g),X(a,n,g,e,b,q,c)):(b(a,n,a.length,h,n[h],n[h+1]),b(a,n,a.length,m,n[m],n[m+1]))}function Y(a,n,g,e,b){var h=n.coords,c=n.lengths,m=g?e?W:da:e?da:M;g=u(g,e);if(!h.length)return a!==n&&(a.lengths.length=0,a.coords.length=0),a;if(!c.length)return m(a.coords,
h,0,0,w(b,h[0]),G(b,h[1])),a!==n&&(a.lengths.length=0,a.coords.length=g),a;var t=b.scale;e=t[0];for(var t=t[1],q=0,A=0;A<c.length;A++){var v=c[A];a.lengths[A]=v;var k=w(b,h[q]),l=G(b,h[q+1]);m(a.coords,h,q,q,k,l);for(var q=q+g,F=1;F<v;F++,q+=g)k+=h[q]*e,l-=h[q+1]*t,m(a.coords,h,q,q,k,l)}a!==n&&(a.lengths.length=c.length,a.coords.length=h.length);return a}Object.defineProperty(a,"__esModule",{value:!0});var U=p.getLogger("esri.tasks.support.optimizedFeatureSet"),ua={esriGeometryPoint:0,esriGeometryPolyline:2,
esriGeometryPolygon:3,esriGeometryMultipoint:0},M=function(a,n,g,e,b,h){a[g]=b;a[g+1]=h},da=function(a,n,g,e,b,h){a[g]=b;a[g+1]=h;a[g+2]=n[e+2]},W=function(a,n,g,e,b,h){a[g]=b;a[g+1]=h;a[g+2]=n[e+2];a[g+3]=n[e+3]};a.quantizeX=y;a.quantizeY=C;a.hydrateX=w;a.hydrateY=G;a.convertToPoint=function(a,n,g){return a?n?g?h(a):D(a):g?m(a):E(a):null};a.convertFromPoint=function(a,n,e){void 0===e&&(e=g(null!=n.z,null!=n.m));return e(a,n)};a.convertToMultipoint=t;a.convertFromMultipoint=v;a.convertToPolyline=
V;a.convertFromPolyline=ca;a.convertToPolygon=na;a.convertFromPolygon=fa;a.convertFromNestedArray=K;var Q=[],T=[];a.convertFromFeature=function(a,g,e,b,h){Q[0]=a;a=n(T,Q,g,e,b,h)[0];Q.length=T.length=0;return a};a.convertFromFeatures=n;a.convertToFeature=function(a,n,g,e){T[0]=a;A(Q,T,n,g,e);a=Q[0];Q.length=T.length=0;return a};a.convertFromGeometry=function(a,n,e){if(!a)return null;var h=new k.default;"hasZ"in a&&null==n&&(n=a.hasZ);"hasM"in a&&null==e&&(e=a.hasM);if(b.isPoint(a))return g(null!=
n?n:null!=a.z,null!=e?e:null!=a.m)(h,a);if(b.isPolygon(a))return fa(h,a,n,e);if(b.isPolyline(a))return ca(h,a,u(n,e));if(b.isMultipoint(a))return v(h,a,u(n,e));U.error("convertFromGeometry:unknown-geometry",new r("Unable to parse unknown geometry type '"+a+"'"))};a.convertToGeometry=function(a,n,g,e){a=a&&("coords"in a?a:a.geometry);if(!a)return null;switch(n){case "esriGeometryPoint":return n=E,g&&e?n=h:g?n=D:e&&(n=m),n(a);case "esriGeometryMultipoint":return t(a,g,e);case "esriGeometryPolyline":return V(a,
g,e);case "esriGeometryPolygon":return na(a,g,e);default:U.error("convertToGeometry:unknown-geometry",new r("Unable to parse unknown geometry type '"+n+"'"))}};a.convertToFeatures=A;a.convertToFeatureSet=function(a){var n=a.objectIdFieldName,g=a.spatialReference,e=a.transform,h=a.fields,b=a.hasM,c=a.hasZ,m=a.geometryType,t=a.exceededTransferLimit;a={features:A([],a.features,m,c,b),fields:h,geometryType:m,objectIdFieldName:n,spatialReference:g};e&&(a.transform=e);t&&(a.exceededTransferLimit=t);b&&
(a.hasM=b);c&&(a.hasZ=c);return a};a.convertFromFeatureSet=function(a,g){var e=new l.default,b=a.hasM,h=a.hasZ,c=a.features,m=a.objectIdFieldName,t=a.spatialReference,q=a.geometryType,A=a.exceededTransferLimit,v=a.transform;e.fields=a.fields;e.geometryType=q;e.objectIdFieldName=m||g;e.spatialReference=t;if(!e.objectIdFieldName)return U.error(new r("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),e;c&&n(e.features,c,q,h,b,e.objectIdFieldName);A&&(e.exceededTransferLimit=
A);b&&(e.hasM=b);h&&(e.hasZ=h);v&&(e.transform=v);return e};a.hydrateOptimizedFeatureSet=function(a){var n=a.transform,g=a.hasM,e=a.hasZ;if(!n)return a;for(var b=0,h=a.features;b<h.length;b++){var c=h[b];c.geometry&&Y(c.geometry,c.geometry,g,e,n);c.centroid&&Y(c.centroid,c.centroid,g,e,n)}a.transform=null;return a};a.quantizeOptimizedFeatureSet=function(a,n){var g=n.geometryType,e=n.features,b=n.hasM,h=n.hasZ;if(!a)return n;for(var m=0;m<e.length;m++){var t=e[m],q=new c.default(new k.default,t.attributes);
H(q.geometry,t.geometry,b,h,g,a);t.centroid&&(q.centroid=new k.default,H(q.centroid,t.centroid,b,h,"esriGeometryPoint",a));e[m]=q}n.transform=a;return n};a.quantizeOptimizedGeometry=H;a.quantizeOptimizedGeometryRemoveCollinear=function(a,n,g,e,b,h){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!n||!n.coords.length)return null;b=ua[b];var c=n.coords;n=n.lengths;var m=u(g,e);g=g?e?W:da:e?da:M;if(!n.length)return g(a.coords,c,0,0,y(h,c[0]),C(h,c[1])),a.lengths.length&&
(a.lengths.length=0),a.coords.length=m,a;for(var t,q,A,v=0,k,l=0,F=0;F<n.length;F++){var E=n[F];if(!(E<b)){var p=0;k=l;e=t=y(h,c[v]);A=q=C(h,c[v+1]);g(a.coords,c,k,v,e,A);p++;for(var v=v+m,Y=!1,K=0,H=0,I=1;I<E;I++,v+=m)if(e=y(h,c[v]),A=C(h,c[v+1]),e!==t||A!==q)t=e-t,q=A-q,Y&&(0===K&&0===t||0===H&&0===q)?(K+=t,H+=q):(Y=!0,K=t,H=q,k+=m,p++),g(a.coords,c,k,v,K,H),t=e,q=A;Y&&(k+=m,g(a.coords,c,k,v,K,H));p>=b&&(a.lengths.push(p),l=k)}}a.coords.length!==l&&(a.coords.length=l);return a.coords.length?a:null};
a.generalizeOptimizedGeometry=function(a,n,g,e,h,b){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!n||!n.coords.length)return null;h=ua[h];var c=n.coords;n=n.lengths;var m=u(g,e);g=g?e?W:da:e?da:M;if(!n.length)return g(a.coords,c,0,0,c[0],c[1]),a.lengths.length&&(a.lengths.length=0),a.coords.length=m,a;for(var t=e=0;t<n.length;t++){var q=n[t];if(!(q<h)){var A=a.coords.length/m;X(a.coords,c,m,b,g,e,e+q*m);var v=a.coords.length/m-A;v>=h?a.lengths.push(v):a.coords.length=
A*m}e+=q*m}return a.coords.length?a:null};a.getBoundsOptimizedGeometry=function(a,n,g,e){g=u(g,e);var h=e=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(n&&n.coords){n=n.coords;for(var m=0;m<n.length;m+=g){var t=n[m],q=n[m+1];e=Math.min(e,t);b=Math.max(b,t);h=Math.min(h,q);c=Math.max(c,q)}}a[0]=e;a[1]=h;a[2]=b;a[3]=c;return a};a.getQuantizedBoundsOptimizedGeometry=function(a,n,g,e){g=u(g,e);e=n.coords;var h=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,
m=Number.NEGATIVE_INFINITY,t=0,q=0;for(n=n.lengths;q<n.length;q++)for(var A=n[q],v=e[t],k=e[t+1],h=Math.min(v,h),b=Math.min(k,b),c=Math.max(v,c),m=Math.max(k,m),t=t+g,l=1;l<A;l++,t+=g){var F=e[t],E=e[t+1],v=v+F,k=k+E;0>F&&(h=Math.min(h,v));0<F&&(c=Math.max(c,v));0>E?b=Math.min(b,k):0<E&&(m=Math.max(m,k))}a[0]=h;a[1]=b;a[2]=c;a[3]=m;return a};a.hydrateOptimizedGeometry=Y})},"esri/layers/graphics/data/FeatureStore":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/extendsHelper ../../../core/Error ../../../core/Evented ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/libs/rbush/rbush ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./optimizedFeatureQueryEngineAdapter".split(" "),
function(B,a,r,p,b,c,l,k,u,y,C,w,G,E,I){Object.defineProperty(a,"__esModule",{value:!0});var D=[],F=u.getLogger("esri.layers.graphics.data.FeatureStore"),m={minX:0,minY:0,maxX:0,maxY:0};B=function(){function a(a,e,g){this._geometryInfo=a;this._onFeatureAdd=e;this._onFeatureRemove=g;this._featuresById=new Map;this._boundsByFeature=new Map;this._featuresByBounds=new Map;this._index=C(9,k("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:["[0]","[1]","[2]","[3]"]);this.events=
new l;this.featureAdapter=I.optimizedFeatureQueryEngineAdapter}Object.defineProperty(a.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numFeatures",{get:function(){return this._featuresById.size},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var a=G.create(G.NEGATIVE_INFINITY);this._boundsByFeature.forEach(function(e){e&&(a[0]=Math.min(e[0],a[0]),a[1]=Math.min(e[1],a[1]),a[2]=Math.max(e[2],a[2]),a[3]=Math.max(e[3],a[3]))});return a},enumerable:!0,configurable:!0});a.prototype.add=function(a){this._add(a,D);this._index.load(D);this._emitChanged();D.length=0};a.prototype.addMany=function(a){for(var e=0;e<a.length;e++)this._add(a[e],
D);this._index.load(D);this._emitChanged();D.length=0};a.prototype.clear=function(){this._featuresById.clear();this._boundsByFeature.clear();this._featuresByBounds.clear();this._index.clear();this._emitChanged()};a.prototype.removeById=function(a){var e=this._featuresById.get(a);if(!e)return null;var g=this._boundsByFeature.get(e);g&&(this._index.remove(g),this._featuresByBounds.delete(g));this._boundsByFeature.delete(e);this._featuresById.delete(a);this._emitChanged();return e};a.prototype.removeIf=
function(a,e){var g=this;this._featuresById.forEach(function(b,h){e(b)&&(g._remove(b),a.push(b))});this._emitChanged()};a.prototype.removeManyById=function(a){for(var e=0;e<a.length;e++){var g=a[e],b=this._featuresById.get(g);if(b){var h=this._boundsByFeature.get(b);h&&(this._index.remove(h),this._featuresByBounds.delete(h));this._boundsByFeature.delete(b)}this._featuresById.delete(g)}this._emitChanged()};a.prototype.forEachBounds=function(a,e,g){for(var b=0;b<a.length;b++){var h=this._boundsByFeature.get(a[b]);
h&&e(w.fromRect(g,h))}};a.prototype.getFeature=function(a){return this._featuresById.get(a)};a.prototype.has=function(a){return this._featuresById.has(a)};a.prototype.forEach=function(a){this._featuresById.forEach(function(e){return a(e)})};a.prototype.forEachInBounds=function(a,e){var g=0,b=this._index;m.minX=a[0];m.minY=a[1];m.maxX=a[2];m.maxY=a[3];for(a=b.search(m);g<a.length;g++)e(this._featuresByBounds.get(a[g]))};a.prototype.transferById=function(a,e){if(e=this._featuresById.get(e))this._remove(e),
a.add(e),this._emitChanged()};a.prototype.transferByIds=function(a,e){for(var g=[],b=0;b<e.length;b++){var h=this._featuresById.get(e[b]);h&&(this._remove(h),g.push(h))}a.addMany(g);this._emitChanged()};a.prototype.transferIdRange=function(a,e,g){for(var b=[];e<g;e++){var h=this._featuresById.get(e);h&&(this._remove(h),b.push(h))}a.addMany(b);this._emitChanged()};a.prototype.transferIf=function(a,e){var g=this,b=[];this._featuresById.forEach(function(a,h){e(a)&&(g._remove(a),b.push(a))});a.addMany(b);
this._emitChanged()};a.prototype.transferAll=function(a){var e=this,g=[];this._featuresById.forEach(function(a,b){e._remove(a);g.push(a)});a.addMany(g);this._emitChanged()};a.prototype._emitChanged=function(){this.events.emit("changed",void 0)};a.prototype._add=function(a,e){if(a){var g=a.objectId;if(null==g)F.error(new c("featurestore:invalid-feature","feature id is missing",{feature:a}));else{var b=this._featuresById.get(g),h;b?(h=this._boundsByFeature.get(b),a.localId=b.localId,h&&(this._index.remove(h),
this._boundsByFeature.delete(b),this._featuresByBounds.delete(h))):y.isSome(this._onFeatureAdd)&&this._onFeatureAdd(a);a.geometry&&a.geometry.coords&&a.geometry.coords.length?(h=E.getBoundsOptimizedGeometry(h||G.create(),a.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(a,h),this._featuresByBounds.set(h,a),this._featuresById.set(g,a),e.push(h)):(this._boundsByFeature.set(a,null),this._featuresById.set(g,a))}}};a.prototype._remove=function(a){var e;if(a){y.isSome(this._onFeatureRemove)&&
this._onFeatureRemove(a);if(e=this._boundsByFeature.get(a))this._index.remove(e),this._boundsByFeature.delete(a),this._featuresByBounds.delete(e);this._featuresById.delete(a.objectId)}};return a}();a.default=B})},"esri/core/libs/rbush/rbush":function(){define(["../quickselect/quickselect"],function(B){function a(b,c){if(!(this instanceof a))return new a(b,c);this._maxEntries=Math.max(4,b||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));c&&("function"===typeof c?this.toBBox=c:this._initFormat(c));
this.clear()}function r(a,b){p(a,0,a.children.length,b,a)}function p(a,c,k,l,m){m||(m=w(null));m.minX=Infinity;m.minY=Infinity;m.maxX=-Infinity;m.maxY=-Infinity;for(var q;c<k;c++)q=a.children[c],b(m,a.leaf?l(q):q);return m}function b(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function c(a,b){return a.minX-b.minX}function l(a,b){return a.minY-b.minY}function k(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function u(a){return a.maxX-
a.minX+(a.maxY-a.minY)}function y(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function C(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function w(a){return{children:a,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function G(a,b,c,k,m){for(var q=[b,c],h;q.length;)c=q.pop(),b=q.pop(),c-b<=k||(h=b+Math.ceil((c-b)/k/2)*k,B(a,h,b,c,m),q.push(b,h,h,c))}a.prototype={all:function(){return this._all(this.data,[])},search:function(a){var b=
this.data,c=[],k=this.toBBox;if(!C(a,b))return c;for(var m=[],q,h,e,g;b;){q=0;for(h=b.children.length;q<h;q++)e=b.children[q],g=b.leaf?k(e):e,C(a,g)&&(b.leaf?c.push(e):y(a,g)?this._all(e,c):m.push(e));b=m.pop()}return c},collides:function(a){var b=this.data,c=this.toBBox;if(!C(a,b))return!1;for(var k=[],m,q,h,e;b;){m=0;for(q=b.children.length;m<q;m++)if(h=b.children[m],e=b.leaf?c(h):h,C(a,e)){if(b.leaf||y(a,e))return!0;k.push(h)}b=k.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<
this._minEntries){for(var b=0,c=a.length;b<c;b++)this.insert(a[b]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(b=this.data,this.data=a,a=b),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this},insert:function(a){a&&this._insert(a,this.data.height-1);return this},clear:function(){this.data=w([]);return this},remove:function(a,b){if(!a)return this;for(var c=this.data,
k=this.toBBox(a),m=[],q=[],h,e,g,t;c||m.length;){c||(c=m.pop(),e=m[m.length-1],h=q.pop(),t=!0);if(c.leaf){a:{g=a;var v=c.children,l=b;if(l){for(var u=0;u<v.length;u++)if(l(g,v[u])){g=u;break a}g=-1}else g=v.indexOf(g)}if(-1!==g){c.children.splice(g,1);m.push(c);this._condense(m);break}}t||c.leaf||!y(c,k)?e?(h++,c=e.children[h],t=!1):c=null:(m.push(c),q.push(h),h=0,e=c,c=c.children[0])}return this},toBBox:function(a){return a},compareMinX:c,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(a){this.data=
a;return this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,k){var m=c-b+1,q=this._maxEntries,h;if(m<=q)return h=w(a.slice(b,c+1)),r(h,this.toBBox),h;k||(k=Math.ceil(Math.log(m)/Math.log(q)),q=Math.ceil(m/Math.pow(q,k-1)));h=w([]);h.leaf=!1;h.height=k;var m=Math.ceil(m/q),q=m*Math.ceil(Math.sqrt(q)),e,g,t;for(G(a,b,c,q,this.compareMinX);b<=c;b+=q)for(g=Math.min(b+q-1,c),G(a,b,g,m,this.compareMinY),e=b;e<=
g;e+=m)t=Math.min(e+m-1,g),h.children.push(this._build(a,e,t,k-1));r(h,this.toBBox);return h},_chooseSubtree:function(a,b,c,l){for(var m,q,h,e,g,t,v,F;;){l.push(b);if(b.leaf||l.length-1===c)break;v=F=Infinity;m=0;for(q=b.children.length;m<q;m++)h=b.children[m],g=k(h),t=(Math.max(h.maxX,a.maxX)-Math.min(h.minX,a.minX))*(Math.max(h.maxY,a.maxY)-Math.min(h.minY,a.minY))-g,t<F?(F=t,v=g<v?g:v,e=h):t===F&&g<v&&(v=g,e=h);b=e||b.children[0]}return b},_insert:function(a,c,k){var l=this.toBBox;k=k?a:l(a);var l=
[],m=this._chooseSubtree(k,this.data,c,l);m.children.push(a);for(b(m,k);0<=c;)if(l[c].children.length>this._maxEntries)this._split(l,c),c--;else break;this._adjustParentBBoxes(k,l,c)},_split:function(a,b){var c=a[b],k=c.children.length,m=this._minEntries;this._chooseSplitAxis(c,m,k);k=this._chooseSplitIndex(c,m,k);k=w(c.children.splice(k,c.children.length-k));k.height=c.height;k.leaf=c.leaf;r(c,this.toBBox);r(k,this.toBBox);b?a[b-1].children.push(k):this._splitRoot(c,k)},_splitRoot:function(a,b){this.data=
w([a,b]);this.data.height=a.height+1;this.data.leaf=!1;r(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var l,m,q,h,e,g,t;e=g=Infinity;for(l=b;l<=c-b;l++)m=p(a,0,l,this.toBBox),q=p(a,l,c,this.toBBox),h=Math.max(0,Math.min(m.maxX,q.maxX)-Math.max(m.minX,q.minX))*Math.max(0,Math.min(m.maxY,q.maxY)-Math.max(m.minY,q.minY)),m=k(m)+k(q),h<e?(e=h,t=l,g=m<g?m:g):h===e&&m<g&&(g=m,t=l);return t},_chooseSplitAxis:function(a,b,k){var u=a.leaf?this.compareMinX:c,m=a.leaf?this.compareMinY:l,q=this._allDistMargin(a,
b,k,u);b=this._allDistMargin(a,b,k,m);q<b&&a.children.sort(u)},_allDistMargin:function(a,c,k,l){a.children.sort(l);l=this.toBBox;var m=p(a,0,c,l),q=p(a,k-c,k,l),h=u(m)+u(q),e,g;for(e=c;e<k-c;e++)g=a.children[e],b(m,a.leaf?l(g):g),h+=u(m);for(e=k-c-1;e>=c;e--)g=a.children[e],b(q,a.leaf?l(g):g),h+=u(q);return h},_adjustParentBBoxes:function(a,c,k){for(;0<=k;k--)b(c[k],a)},_condense:function(a){for(var b=a.length-1,c;0<=b;b--)0===a[b].children.length?0<b?(c=a[b-1].children,c.splice(c.indexOf(a[b]),1)):
this.clear():r(a[b],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")}};return a})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function B(p,b,c,l,k){for(;l>c;){if(600<l-c){var u=l-c+1,y=b-c+1,C=Math.log(u),w=.5*Math.exp(2*C/3),C=.5*Math.sqrt(C*
w*(u-w)/u)*(0>y-u/2?-1:1);B(p,b,Math.max(c,Math.floor(b-y*w/u+C)),Math.min(l,Math.floor(b+(u-y)*w/u+C)),k)}u=p[b];y=c;w=l;a(p,c,b);for(0<k(p[l],u)&&a(p,c,l);y<w;){a(p,y,w);y++;for(w--;0>k(p[y],u);)y++;for(;0<k(p[w],u);)w--}0===k(p[c],u)?a(p,c,w):(w++,a(p,w,l));w<=b&&(c=w+1);b<=w&&(l=w-1)}}function a(a,b,c){var l=a[b];a[b]=a[c];a[c]=l}function r(a,b){return a<b?-1:a>b?1:0}return function(a,b,c,l,k){B(a,b,c||0,l||a.length-1,k||r)}})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["require",
"exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(B,a,r,p,b){Object.defineProperty(a,"__esModule",{value:!0});a.optimizedFeatureQueryEngineAdapter={getObjectId:function(a){return a.objectId},getAttributes:function(a){return a.attributes},getAttribute:function(a,b){return a.attributes[b]},cloneWithGeometry:function(a,b){return new p.default(b,a.attributes,null,a.objectId)},getGeometry:function(a){return a.geometry},getCentroid:function(a,l){a.centroid||(a.centroid=r.getCentroidOptimizedGeometry(new b.default,
a.geometry,l.hasZ,l.hasM));return a.centroid}};a.default=a.optimizedFeatureQueryEngineAdapter})},"esri/layers/graphics/centroid":function(){define(["require","exports"],function(B,a){function r(a,c,l,k,u,p){p=u?p?4:3:p?3:2;var b=l,y=l+p,G=0,E=0,r=l=0,D=0,F=0;for(--k;F<k;F++,b+=p,y+=p){var m=c[b],q=c[b+1],h=c[b+2],e=c[y],g=c[y+1],t=c[y+2],v=m*g-e*q,r=r+v,G=G+(m+e)*v,E=E+(q+g)*v;u&&(v=m*t-e*h,l+=(h+t)*v,D+=v);m<a[0]&&(a[0]=m);m>a[1]&&(a[1]=m);q<a[2]&&(a[2]=q);q>a[3]&&(a[3]=q);u&&(h<a[4]&&(a[4]=h),h>
a[5]&&(a[5]=h))}0<r&&(r*=-1);0<D&&(D*=-1);if(!r)return null;a=[G,E,.5*r];u&&(a[3]=l,a[4]=.5*D);return a}function p(a,c,l,k,u){u=k?u?4:3:u?3:2;for(var b=c,p=c+u,w=0,r=0,E=0,B=0,D=0,F=l-1;D<F;D++,b+=u,p+=u){var m=a[b],q=a[b+1],h=a[b+2],e=a[p],g=a[p+1],t=a[p+2],v;if(k){v=e-m;var V=g-q,ca=t-h;v=Math.sqrt(v*v+V*V+ca*ca)}else v=e-m,V=g-q,v=Math.sqrt(v*v+V*V);v&&(w+=v,k?(m=[m+.5*(e-m),q+.5*(g-q),h+.5*(t-h)],r+=v*m[0],E+=v*m[1],B+=v*m[2]):(m=[m+.5*(e-m),q+.5*(g-q)],r+=v*m[0],E+=v*m[1]))}return 0<w?k?[r/w,
E/w,B/w]:[r/w,E/w]:0<l?k?[a[c],a[c+1],a[c+2]]:[a[c],a[c+1]]:null}Object.defineProperty(a,"__esModule",{value:!0});a.getCentroidOptimizedGeometry=function(a,c,l,k){if(!c||!c.lengths.length)return null;a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);for(var b=a.coords,y=[],C=l?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,
Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],w=c.lengths,G=c.coords,E=l?k?4:3:k?3:2,B=0,D=0;D<w.length;D++){var F=w[D],m=r(C,G,B,F,l,k);m&&y.push(m);B+=F*E}y.sort(function(a,b){var e=a[2]-b[2];0===e&&l&&(e=a[4]-b[4]);return e});y.length&&(E=6*y[0][2],b[0]=y[0][0]/E,b[1]=y[0][1]/E,l&&(E=6*y[0][4],b[2]=0!==E?y[0][3]/E:0),b[0]<C[0]||b[0]>C[1]||b[1]<C[2]||b[1]>C[3]||l&&(b[2]<C[4]||b[2]>C[5]))&&(b.length=0);if(!b.length)if(c=c.lengths[0]?p(G,0,w[0],l,k):null)b[0]=c[0],b[1]=c[1],l&&2<c.length&&(b[2]=
c[2]);else return null;return a};a.lineCentroid=p})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(B,a,r,p,b,c,l,k,u){function y(a,b){var c;if(!b)return null;if("x"in b){var e={x:0,y:0};a=a(b.x,b.y,E);
e.x=a[0];e.y=a[1];null!=b.z&&(e.z=b.z);null!=b.m&&(e.m=b.m);return e}if("xmin"in b)return e={xmin:0,ymin:0,xmax:0,ymax:0},c=a(b.xmin,b.ymin,E),e.xmin=c[0],e.ymin=c[1],a=a(b.xmax,b.ymax,E),e.xmax=a[0],e.ymax=a[1],b.hasZ&&(e.zmin=b.zmin,e.zmax=b.zmax,e.hasZ=!0),b.hasM&&(e.mmin=b.mmin,e.mmax=b.mmax,e.hasM=!0),e;if("rings"in b)return{rings:C(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:C(b.paths,a),hasM:b.hasM,hasZ:b.hasZ};if("points"in b)return{points:w(b.points,a),hasM:b.hasM,hasZ:b.hasZ}}
function C(a,b){for(var c=[],e=0;e<a.length;e++)c.push(w(a[e],b));return c}function w(a,b){for(var c=[],e=0;e<a.length;e++){var g=a[e],m=b(g[0],g[1],[0,0]);c.push(m);2<g.length&&m.push(g[2]);3<g.length&&m.push(g[3])}return c}function G(a,b){return!k.isValid(a)||!k.isValid(b)||k.equals(a,b)||u.canProject(a,b)?!1:!0}Object.defineProperty(a,"__esModule",{value:!0});var E=[0,0];a.checkProjectionSupport=function(a,c){return p(this,void 0,void 0,function(){var h,e,g;return r(this,function(m){if(!c)return[2];
if(Array.isArray(a)){h=0;for(e=a;h<e.length;h++)if(g=e[h],G(g.geometry&&g.geometry.spatialReference,c)){if(l.isSupported())return[2,l.load()];throw new b("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:c});}return[2]}if(!G(a,c))return[2];if(l.isSupported())return[2,l.load()];throw new b("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:c});})})};var I=y.bind(null,u.lngLatToXY),D=y.bind(null,
u.xyToLngLat);a.project=function(a,b,c){c||(c=b,b=a.spatialReference);return k.isValid(b)&&k.isValid(c)&&!k.equals(b,c)?u.canProject(b,c)?k.isWebMercator(c)?I(a):D(a):l.projectMany([a],b,c,null,!0)[0]:a};var F=new (function(){function a(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a,b,e){return p(this,void 0,void 0,function(){var g,h=this;return r(this,function(m){a&&a.length&&b&&e&&!k.equals(b,e)||c.resolve(a);g={geometries:a,inSpatialReference:b,
outSpatialReference:e,resolve:null};this._jobs.push(g);return[2,c.create(function(a){g.resolve=a;null===h._timer&&(h._timer=setTimeout(h._process,10))},function(){var a=h._jobs.indexOf(g);-1<a&&h._jobs.splice(a,1)})]})})};a.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var b=a.geometries,c=a.inSpatialReference,g=a.outSpatialReference,a=a.resolve;u.canProject(c,g)?k.isWebMercator(g)?a(b.map(I)):a(b.map(D)):a(l.projectMany(b,c,g,null,!0));0<this._jobs.length&&(this._timer=
setTimeout(this._process,10))}};return a}());a.projectMany=function(a,b,c){return p(this,void 0,void 0,function(){return r(this,function(e){return[2,F.push(a,b,c)]})})}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),function(B,a,r,p,b,c){function l(a,l,p,y,r){void 0===y&&(y=null);void 0===r&&(r=!1);if(null===y){var F=c.cacheKey(l,p);void 0!==C[F]?y=C[F]:(y=k(l,p,null),null===y&&(y=new c),
C[F]=y)}return u._project(a,l,p instanceof b||!1===r?p:new b(p),y,r)}function k(a,b,k){void 0===k&&(k=null);a=u._getTransformation(a,b,k);return null!==a?c.fromGE(a):null}Object.defineProperty(a,"__esModule",{value:!0});var u=null;a.isLoaded=function(){return!!u&&p.isLoaded()};a.isSupported=function(){return p.isSupported()};var y=null;a.load=function(){return y?y:y=r.create(function(a,b){var c=p.load();B(["./geometryEngine"],function(k){u=k;c.then(function(){u._enableProjection(p);a()},function(a){b(a)})})})};
a.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:l(a,a[0].spatialReference,b,c):l([a],a.spatialReference,b,c)[0]};var C={};a.projectMany=l;a.getTransformation=k;a.getTransformations=function(a,b,k){void 0===k&&(k=null);a=u._getTransformationBySuitability(a,b,k);if(null!==a){b=[];for(k=0;k<a.length;k++)b.push(c.fromGE(a[k]));return b}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],
function(B,a,r,p,b){function c(b){function c(a,b,c){a[b]=c(a[b])}a._pe=b;w.init();G.init();E.init();I.init();D.init();a.PeGCSExtent=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}r(c,b);c.prototype.destroy=function(){a._pe.destroy(this)};return c}(a._pe.PeGCSExtent);for(var k=0,h=[a._pe.PeDatum,a._pe.PeGeogcs,a._pe.PeGeogtran,a._pe.PeObject,a._pe.PeParameter,a._pe.PePrimem,a._pe.PeProjcs,a._pe.PeSpheroid,a._pe.PeUnit];k<h.length;k++)b=h[k],c(b.prototype,"getName",function(a){return function(){return a.call(this,
Array(w.PE_NAME_MAX))}});k=0;for(h=[a._pe.PeGeogtran,a._pe.PeProjcs];k<h.length;k++)b=h[k],c(b.prototype,"getParameters",function(b){return function(){for(var c=Array(w.PE_PARM_MAX),e=b.call(this),g=0;g<c.length;g++){var h=a._pe.getValue(e,"*");c[g]=h?a._pe.wrapPointer(h,a._pe.PeParameter):null;e+=Int32Array.BYTES_PER_ELEMENT}return c}});c(a._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var c=[],e=a.call(this);y(c,b,e);return c}});c(a._pe.PeGTlistExtendedEntry.prototype,
"getEntries",function(b){var c=a._pe._pe_getPeGTlistExtendedGTsSize();return function(){var e=null,g=b.call(this);if(!a._pe.compare(g,a._pe.NULL)){var e=[g],h=this.getSteps();if(1<h)for(var g=a._pe.getPointer(g),m=1;m<h;m++)e.push(a._pe.wrapPointer(g+c*m,a._pe.PeGTlistExtendedGTs))}return e}});var e=a._pe._pe_getPeHorizonSize();b=function(b){return function(){var c=this._cache;c||(this._cache=c=new Map);if(c.has(b))return c.get(b);var g=null,h=b.call(this);if(!a._pe.compare(h,a._pe.NULL)){var g=[h],
m=h.getNump();if(1<m)for(var h=a._pe.getPointer(h),k=1;k<m;k++)g.push(a._pe.wrapPointer(h+e*k,a._pe.PeHorizon))}c.set(b,g);return g}};c(a._pe.PeProjcs.prototype,"horizonGcsGenerate",b);c(a._pe.PeProjcs.prototype,"horizonPcsGenerate",b);a._pe.PeObject.prototype.toString=function(b){void 0===b&&(b=w.PE_STR_OPTS_NONE);a._pe.ensureCache.prepare();var c=a._pe.getPointer(this),e=a._pe.ensureInt8(Array(w.PE_BUFFER_MAX));return a._pe.UTF8ToString(a._pe._pe_object_to_string_ext(c,b,e))}}function l(b){if(b){var c=
a._pe.getClass(b);c&&(c=a._pe.getCache(c))&&(b=a._pe.getPointer(b))&&delete c[b]}}function k(b,c){var m=[];c=Array(c);for(var h=0;h<b;h++)m.push(a._pe.ensureInt8(c));return m}function u(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):b=a;return b}function y(b,c,k,h){void 0===h&&(h=!1);if(h)for(h=0;h<2*c;h++)b[h]=a._pe.getValue(k+h*Float64Array.BYTES_PER_ELEMENT,"double");else{var e=0===b.length;for(h=0;h<c;h++)e&&(b[h]=Array(2)),b[h][0]=a._pe.getValue(k,"double"),b[h][1]=
a._pe.getValue(k+Float64Array.BYTES_PER_ELEMENT,"double"),k+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(a,"__esModule",{value:!0});var C;a._pe=null;a.isLoaded=function(){return!!a._pe};a.isSupported=function(){return!!p("esri-wasm")};a.load=function(){return C?C:C=b.create(function(a,b){B(["./support/pe-wasm"],function(k){k({locateFile:function(a){return B.toUrl("./support/"+a)},onAbort:function(a){b(Error(a))}}).then(function(b){c(b);a()})})})};(function(b){function c(b,c,h){a._pe.ensureCache.prepare();
var e=u(h),g=h===e,e=a._pe.ensureFloat64(e);(b=a._pe._pe_geog_to_proj(a._pe.getPointer(b),c,e))&&y(h,c,e,g);return b}function k(a,b,c){return h(a,b,c,0)}function h(b,c,h,k){a._pe.ensureCache.prepare();var e=u(h),g=h===e,e=a._pe.ensureFloat64(e);(b=a._pe._pe_proj_to_geog_center(a._pe.getPointer(b),c,e,k))&&y(h,c,e,g);return b}b.geogToProj=c;b.projGeog=function(a,b,h,m){switch(m){case w.PE_TRANSFORM_P_TO_G:return k(a,b,h);case w.PE_TRANSFORM_G_TO_P:return c(a,b,h)}return 0};b.projToGeog=k;b.projToGeogCenter=
h})(a.PeCSTransformations||(a.PeCSTransformations={}));var w;(function(b){b.init=function(){b.PE_BUFFER_MAX=a._pe.PeDefs.prototype.PE_BUFFER_MAX;b.PE_NAME_MAX=a._pe.PeDefs.prototype.PE_NAME_MAX;b.PE_MGRS_MAX=a._pe.PeDefs.prototype.PE_MGRS_MAX;b.PE_USNG_MAX=a._pe.PeDefs.prototype.PE_USNG_MAX;b.PE_DD_MAX=a._pe.PeDefs.prototype.PE_DD_MAX;b.PE_DDM_MAX=a._pe.PeDefs.prototype.PE_DDM_MAX;b.PE_DMS_MAX=a._pe.PeDefs.prototype.PE_DMS_MAX;b.PE_UTM_MAX=a._pe.PeDefs.prototype.PE_UTM_MAX;b.PE_PARM_MAX=a._pe.PeDefs.prototype.PE_PARM_MAX;
b.PE_TYPE_NONE=a._pe.PeDefs.prototype.PE_TYPE_NONE;b.PE_TYPE_GEOGCS=a._pe.PeDefs.prototype.PE_TYPE_GEOGCS;b.PE_TYPE_PROJCS=a._pe.PeDefs.prototype.PE_TYPE_PROJCS;b.PE_TYPE_GEOGTRAN=a._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;b.PE_TYPE_COORDSYS=a._pe.PeDefs.prototype.PE_TYPE_COORDSYS;b.PE_TYPE_UNIT=a._pe.PeDefs.prototype.PE_TYPE_UNIT;b.PE_STR_OPTS_NONE=a._pe.PeDefs.prototype.PE_STR_OPTS_NONE;b.PE_STR_AUTH_NONE=a._pe.PeDefs.prototype.PE_STR_AUTH_NONE;b.PE_STR_AUTH_TOP=a._pe.PeDefs.prototype.PE_STR_AUTH_TOP;
b.PE_STR_NAME_CANON=a._pe.PeDefs.prototype.PE_STR_NAME_CANON;b.PE_PARM_X0=a._pe.PeDefs.prototype.PE_PARM_X0;b.PE_PARM_ND=a._pe.PeDefs.prototype.PE_PARM_ND;b.PE_TRANSFORM_1_TO_2=a._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;b.PE_TRANSFORM_2_TO_1=a._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;b.PE_TRANSFORM_P_TO_G=a._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;b.PE_TRANSFORM_G_TO_P=a._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;b.PE_HORIZON_RECT=a._pe.PeDefs.prototype.PE_HORIZON_RECT;b.PE_HORIZON_POLY=a._pe.PeDefs.prototype.PE_HORIZON_POLY;
b.PE_HORIZON_LINE=a._pe.PeDefs.prototype.PE_HORIZON_LINE;b.PE_HORIZON_DELTA=a._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(w=a.PeDefs||(a.PeDefs={}));(function(b){function c(b,c){var e=null,g=h[b];g||(g={},h[b]=g);g.hasOwnProperty(String(c))?e=g[c]:(b=a._pe.PeFactory.prototype.factoryByType(b,c),a._pe.compare(b,a._pe.NULL)||(e=b,g[c]=e));return e=k(e)}function k(b){if(b){var c=b.getType();switch(c){case w.PE_TYPE_GEOGCS:b=a._pe.castObject(b,a._pe.PeGeogcs);break;case w.PE_TYPE_PROJCS:b=a._pe.castObject(b,
a._pe.PeProjcs);break;case w.PE_TYPE_GEOGTRAN:b=a._pe.castObject(b,a._pe.PeGeogtran);break;default:c&w.PE_TYPE_UNIT&&(b=a._pe.castObject(b,a._pe.PeUnit))}}return b}var h={},e={};b.initialize=function(){a._pe.PeFactory.prototype.initialize(null)};b.coordsys=function(a){return c(w.PE_TYPE_COORDSYS,a)};b.factoryByType=c;b.fromString=function(b,c){var g=null,h=e[b];h||(h={},e[b]=h);h.hasOwnProperty(c)?g=h[c]:(b=a._pe.PeFactory.prototype.fromString(b,c),a._pe.compare(b,a._pe.NULL)||(g=b,h[c]=g));return g=
k(g)};b.geogcs=function(a){return c(w.PE_TYPE_GEOGCS,a)};b.geogtran=function(a){return c(w.PE_TYPE_GEOGTRAN,a)};b.getCode=function(b){return a._pe.PeFactory.prototype.getCode(b)};b.projcs=function(a){return c(w.PE_TYPE_PROJCS,a)};b.unit=function(a){return c(w.PE_TYPE_UNIT,a)}})(a.PeFactory||(a.PeFactory={}));a.PeGCSExtent=null;var G;(function(b){var c;b.init=function(){b.PE_GTLIST_OPTS_COMMON=a._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;c=a._pe._pe_getPeGTlistExtendedEntrySize()};b.getGTlist=
function(b,h,e,g,k,m){var t=null,l=new a._pe.PeInteger(m);try{var q=a._pe.PeGTlistExtended.prototype.getGTlist(b,h,e,g,k,l);if(m=l.val)if(t=[q],1<m){var v=a._pe.getPointer(q);for(b=1;b<m;b++)t.push(a._pe.wrapPointer(v+c*b,a._pe.PeGTlistExtendedEntry))}}finally{a._pe.destroy(l)}return t}})(G=a.PeGTlistExtended||(a.PeGTlistExtended={}));(function(b){b.destroy=function(b){if(b&&b.length){for(var c=0;c<b.length;c++){var h=b[c];l(h);h.getEntries().forEach(function(a){l(a);a=a.getGeogtran();l(a);a.getParameters().forEach(l);
[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){l(a);var b=a.getDatum();l(b);l(b.getSpheroid());l(a.getPrimem());l(a.getUnit())})})}a._pe.PeGTlistExtendedEntry.prototype.Delete(b[0])}}})(a.PeGTlistExtendedEntry||(a.PeGTlistExtendedEntry={}));(function(b){b.geogToGeog=function(b,c,h,e,g){a._pe.ensureCache.prepare();var k=u(h),m=h===k,k=a._pe.ensureFloat64(k),l=0;e&&(l=a._pe.ensureFloat64(e));(b=a._pe._pe_geog_to_geog(a._pe.getPointer(b),c,k,l,g))&&y(h,c,k,m);return b}})(a.PeGTTransformations||
(a.PeGTTransformations={}));(function(b){function c(b,c,g,m,l,q){a._pe.ensureCache.prepare();var e,h;switch(b){case "dd":e=a._pe._pe_geog_to_dd;h=w.PE_DD_MAX;break;case "ddm":e=a._pe._pe_geog_to_ddm;h=w.PE_DDM_MAX;break;case "dms":e=a._pe._pe_geog_to_dms,h=w.PE_DMS_MAX}b=0;c&&(b=a._pe.getPointer(c));c=u(m);c=a._pe.ensureFloat64(c);h=k(g,h);m=a._pe.ensureInt32(h);if(l=e(b,g,c,l,m))for(e=0;e<g;e++)q[e]=a._pe.UTF8ToString(h[e]);return l}function l(b,c,g,k,m){a._pe.ensureCache.prepare();var e;switch(b){case "dd":e=
a._pe._pe_dd_to_geog;break;case "ddm":e=a._pe._pe_ddm_to_geog;break;case "dms":e=a._pe._pe_dms_to_geog}b=0;c&&(b=a._pe.getPointer(c));c=k.map(function(b){return a._pe.ensureString(b)});k=a._pe.ensureInt32(c);c=a._pe.ensureFloat64(Array(2*g));(e=e(b,g,k,c))&&y(m,g,c);return e}b.geog_to_dms=function(a,b,g,k,m){return c("dms",a,b,g,k,m)};b.dms_to_geog=function(a,b,c,k){return l("dms",a,b,c,k)};b.geog_to_ddm=function(a,b,g,k,m){return c("ddm",a,b,g,k,m)};b.ddm_to_geog=function(a,b,c,k){return l("ddm",
a,b,c,k)};b.geog_to_dd=function(a,b,g,k,m){return c("dd",a,b,g,k,m)};b.dd_to_geog=function(a,b,c,k){return l("dd",a,b,c,k)}})(a.PeNotationDms||(a.PeNotationDms={}));var E;(function(b){b.init=function(){b.PE_MGRS_STYLE_NEW=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;b.PE_MGRS_STYLE_OLD=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;b.PE_MGRS_STYLE_AUTO=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;b.PE_MGRS_180_ZONE_1_PLUS=a._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;b.PE_MGRS_ADD_SPACES=
a._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};b.geog_to_mgrs_extended=function(b,c,h,e,g,l,v){a._pe.ensureCache.prepare();var m=0;b&&(m=a._pe.getPointer(b));b=u(h);h=a._pe.ensureFloat64(b);b=k(c,w.PE_MGRS_MAX);var t=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_mgrs_extended(m,c,h,e,g,l,t))for(g=0;g<c;g++)v[g]=a._pe.UTF8ToString(b[g]);return e};b.mgrs_to_geog_extended=function(b,c,h,e,g){a._pe.ensureCache.prepare();var k=0;b&&(k=a._pe.getPointer(b));b=h.map(function(b){return a._pe.ensureString(b)});
h=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(e=a._pe._pe_mgrs_to_geog_extended(k,c,h,e,b))&&y(g,c,b);return e}})(E=a.PeNotationMgrs||(a.PeNotationMgrs={}));(function(b){b.geog_to_usng=function(b,c,h,e,g,l,v){a._pe.ensureCache.prepare();var m=0;b&&(m=a._pe.getPointer(b));b=u(h);h=a._pe.ensureFloat64(b);b=k(c,w.PE_MGRS_MAX);var t=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_usng(m,c,h,e,g,l,t))for(g=0;g<c;g++)v[g]=a._pe.UTF8ToString(b[g]);return e};b.usng_to_geog=function(b,c,h,e){a._pe.ensureCache.prepare();
var g=0;b&&(g=a._pe.getPointer(b));b=h.map(function(b){return a._pe.ensureString(b)});h=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(g=a._pe._pe_usng_to_geog(g,c,h,b))&&y(e,c,b);return g}})(a.PeNotationUsng||(a.PeNotationUsng={}));var I;(function(b){b.init=function(){b.PE_UTM_OPTS_NONE=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;b.PE_UTM_OPTS_ADD_SPACES=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;b.PE_UTM_OPTS_NS=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};b.geog_to_utm=function(b,
c,h,e,g){a._pe.ensureCache.prepare();var m=0;b&&(m=a._pe.getPointer(b));b=u(h);h=a._pe.ensureFloat64(b);b=k(c,w.PE_UTM_MAX);var l=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_utm(m,c,h,e,l))for(m=0;m<c;m++)g[m]=a._pe.UTF8ToString(b[m]);return e};b.utm_to_geog=function(b,c,h,e,g){a._pe.ensureCache.prepare();var k=0;b&&(k=a._pe.getPointer(b));b=h.map(function(b){return a._pe.ensureString(b)});h=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(e=a._pe._pe_utm_to_geog(k,c,h,e,b))&&y(g,c,b);return e}})(I=
a.PeNotationUtm||(a.PeNotationUtm={}));var D;(function(b){var c=new Map;b.init=function(){b.PE_PCSINFO_OPTION_NONE=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;b.PE_PCSINFO_OPTION_DOMAIN=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;b.PE_POLE_OUTSIDE_BOUNDARY=a._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;b.PE_POLE_POINT=a._pe.PePCSInfo.prototype.PE_POLE_POINT};b.generate=function(k,h){void 0===h&&(h=b.PE_PCSINFO_OPTION_DOMAIN);var e,g;c.has(k)&&(g=c.get(k),g[h]&&(e=g[h]));e||(e=a._pe.PePCSInfo.prototype.generate(k,
h),g||(g=[],c.set(k,g)),g[h]=e);return e}})(D=a.PePCSInfo||(a.PePCSInfo={}));(function(b){b.version_string=function(){return a._pe.PeVersion.prototype.version_string()}})(a.PeVersion||(a.PeVersion={}));a._init=c})},"esri/geometry/support/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(B,a,r){return function(){function a(a){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(a&&a.steps){var b=0;for(a=a.steps;b<
a.length;b++){var l=a[b];l instanceof r?this.steps.push(l):this.steps.push(new r({wkid:l.wkid,wkt:l.wkt,isInverse:l.isInverse}))}}}a.cacheKey=function(a,c){return[void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():"",void 0!==c.wkid&&null!==c.wkid?c.wkid.toString():"-1",void 0!==c.wkt&&null!==c.wkt?c.wkt.toString():""].join()};a.fromGE=function(b){var c=new a,l="",k=0;for(b=b.steps;k<b.length;k++){var u=r.fromGE(b[k]);c.steps.push(u);l+=u.uid.toString()+
","}c._cached_projection={};c._gtlistentry=null;c._chain=l;return c};a.prototype.getInverse=function(){var b=new a;b.steps=[];for(var c=this.steps.length-1;0<=c;c--)b.steps.push(this.steps[c].getInverse());return b};a.prototype.getGTListEntry=function(){for(var a="",c=0,l=this.steps;c<l.length;c++)a+=l[c].uid.toString()+",";a!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=a);return this._gtlistentry};a.prototype.assignCachedGe=function(b,c,l){this._cached_projection[a.cacheKey(b,
c)]=l};a.prototype.getCachedGeTransformation=function(b,c){for(var l="",k=0,u=this.steps;k<u.length;k++)l+=u[k].uid.toString()+",";l!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=l);b=this._cached_projection[a.cacheKey(b,c)];return void 0===b?null:b};return a}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(B,a){var r=0;return function(){function a(a){void 0===a&&(a=null);this.uid=r++;a?(this._wkt=void 0!==
a.wkt?a.wkt:null,this._wkid=void 0!==a.wkid?a.wkid:-1,this._isInverse=void 0!==a.isInverse?!0===a.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}a.fromGE=function(b){var c=new a;c._wkt=b.wkt;c._wkid=b.wkid;c._isInverse=b.isInverse;return c};Object.defineProperty(a.prototype,"wkt",{get:function(){return this._wkt},set:function(a){this._wkt=a;this.uid=r++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wkid",{get:function(){return this._wkid},set:function(a){this._wkid=
a;this.uid=r++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isInverse",{get:function(){return this._isInverse},set:function(a){this._isInverse=a;this.uid=r++},enumerable:!0,configurable:!0});a.prototype.getInverse=function(){var b=new a;b._wkt=this.wkt;b._wkid=this._wkid;b._isInverse=!this.isInverse;return b};return a}()})},"esri/layers/graphics/data/QueryEngine":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/iteratorUtils ../../../core/lang ../../../core/Logger ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../support/PromiseQueue".split(" "),
function(B,a,r,p,b,c,l,k,u,y,C,w,G,E,I,D,F,m,q,h,e,g,t,v,V,ca){Object.defineProperty(a,"__esModule",{value:!0});var na=u.getLogger("esri.layers.graphics.data.QueryEngine");B=function(){return function(a,b,c,n,e){void 0===b&&(b=null);this.attributes=a;this.geometry=c;this.centroid=n;this.filterFlags=e;this.groupId=-1;this.localId=b}}();a.Feature=B;var fa=new Set,K=new y.MemCacheStorage(2E6),n=0;B=function(){function a(a){var b=this;this.capabilities={query:h.queryCapabilities};this.geometryType=a.geometryType;
this.hasM=a.hasM;this.hasZ=a.hasZ;this.objectIdField=a.objectIdField;this.spatialReference=a.spatialReference;this.definitionExpression=a.definitionExpression;this.cacheSpatialQueries=a.cacheSpatialQueries||!1;this.gdbVersion=a.gdbVersion;this.historicMoment=a.historicMoment;this.featureStore=a.featureStore;this._changeHandle=this.featureStore.events.on("changed",function(){return b.clearCache()});this.timeInfo=a.timeInfo;this.cacheSpatialQueries&&(this._geometryQueryCache=new y.MemCache(n++ +"$$",
K));this.fieldsIndex=new V(a.fields);a.scheduler&&a.task&&(this._frameQueue=new ca.PromiseQueue,this._frameTask=a.scheduler.registerTask(a.task,function(a){return b._update(a)},function(){return 0<b._frameQueue.length}))}a.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=
null);this.fieldsIndex.destroy()};Object.defineProperty(a.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullExtent",{get:function(){var a=this.featureStore.fullBounds;return a?{xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:v.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"timeExtent",{get:function(){return this.timeInfo?
this._timeExtent?this._timeExtent:this._timeExtent=t.getTimeExtent(this.timeInfo,this.featureStore):null},enumerable:!0,configurable:!0});a.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};a.prototype.executeQuery=function(a,c){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,c,n;return p(this,function(g){switch(g.label){case 0:b=k.clone(a),g.label=1;case 1:return g.trys.push([1,14,,15]),[4,this._schedule()];
case 2:return g.sent(),[4,v.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=g.sent(),[4,this._reschedule()];case 4:return g.sent(),[4,this._checkQuerySupport(b)];case 5:return b=g.sent(),[4,this._reschedule()];case 6:return g.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=g.sent(),[4,this._reschedule()];case 8:return g.sent(),[4,c.executeObjectIdsQuery(b)];case 9:return c=g.sent(),[4,this._reschedule()];case 10:return g.sent(),[4,c.executeTimeQuery(b)];
case 11:return c=g.sent(),[4,this._reschedule()];case 12:return g.sent(),[4,c.executeAttributesQuery(b)];case 13:return c=g.sent(),[3,15];case 14:n=g.sent();if(n!==v.QUERY_ENGINE_EMPTY_RESULT)throw n;c=new e.default([],null,this);return[3,15];case 15:return[2,c.createQueryResponse(b)]}})})};a.prototype.executeQueryForCount=function(a,c){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,c,n;return p(this,function(e){switch(e.label){case 0:b=k.clone(a),b.returnGeometry=!1,b.returnCentroid=
!1,b.outSR=null,e.label=1;case 1:return e.trys.push([1,14,,15]),[4,this._schedule()];case 2:return e.sent(),[4,v.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=e.sent(),[4,this._reschedule()];case 4:return e.sent(),[4,this._checkQuerySupport(b)];case 5:return b=e.sent(),[4,this._reschedule()];case 6:return e.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=e.sent(),[4,this._reschedule()];case 8:return e.sent(),[4,c.executeObjectIdsQuery(b)];case 9:return c=
e.sent(),[4,this._reschedule()];case 10:return e.sent(),[4,c.executeTimeQuery(b)];case 11:return c=e.sent(),[4,this._reschedule()];case 12:return e.sent(),[4,c.executeAttributesQuery(b)];case 13:return c=e.sent(),[2,c.size];case 14:n=e.sent();if(n!==v.QUERY_ENGINE_EMPTY_RESULT)throw n;return[2,0];case 15:return[2]}})})};a.prototype.executeQueryForExtent=function(a,c){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,c,n,e,g,h,m,l;return p(this,function(t){switch(t.label){case 0:b=k.clone(a),
n=b.outSR,t.label=1;case 1:return t.trys.push([1,14,,15]),[4,this._schedule()];case 2:return t.sent(),[4,v.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=t.sent(),[4,this._reschedule()];case 4:return t.sent(),[4,this._checkQuerySupport(b)];case 5:return b=t.sent(),b.returnGeometry=!0,b.returnCentroid=!1,b.outSR=null,[4,this._reschedule()];case 6:return t.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=t.sent(),[4,this._reschedule()];case 8:return t.sent(),
[4,c.executeObjectIdsQuery(b)];case 9:return c=t.sent(),[4,this._reschedule()];case 10:return t.sent(),[4,c.executeTimeQuery(b)];case 11:return c=t.sent(),[4,this._reschedule()];case 12:return t.sent(),[4,c.executeAttributesQuery(b)];case 13:c=t.sent();e=c.size;if(!e)return[2,{count:e,extent:null}];G.set(H,G.NEGATIVE_INFINITY);this.featureStore.forEachBounds(c.items,function(a){return G.expand(H,a)},A);g={xmin:H[0],ymin:H[1],xmax:H[3],ymax:H[4],spatialReference:v.cleanFromGeometryEngine(this.spatialReference)};
this.hasZ&&isFinite(H[2])&&isFinite(H[5])&&(g.zmin=H[2],g.zmax=H[5]);h=q.project(g,c.spatialReference,n);h.spatialReference=v.cleanFromGeometryEngine(n||this.spatialReference);0===h.xmax-h.xmin&&(m=w.getMetersPerUnitForSR(h.spatialReference),h.xmin-=m,h.xmax+=m);0===h.ymax-h.ymin&&(m=w.getMetersPerUnitForSR(h.spatialReference),h.ymin-=m,h.ymax+=m);this.hasZ&&null!=h.zmin&&null!=h.zmax&&0===h.zmax-h.zmin&&(m=w.getMetersPerUnitForSR(h.spatialReference),h.zmin-=m,h.zmax+=m);return[2,{count:e,extent:h}];
case 14:l=t.sent();if(l===v.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw l;case 15:return[2]}})})};a.prototype.executeQueryForIds=function(a,c){void 0===a&&(a={});return b(this,void 0,void 0,function(){return p(this,function(b){return[2,this.executeQueryForIdSet(a,c).then(function(a){return l.valuesOfSet(a)})]})})};a.prototype.executeQueryForIdSet=function(a,c){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,c,n,e,g,h,A,m;return p(this,function(l){switch(l.label){case 0:b=
k.clone(a),b.returnGeometry=!1,b.returnCentroid=!1,b.outSR=null,l.label=1;case 1:return l.trys.push([1,13,,14]),[4,this._schedule()];case 2:return l.sent(),[4,v.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=l.sent(),[4,this._reschedule()];case 4:return l.sent(),[4,this._executeGeometryQuery(b)];case 5:return c=l.sent(),[4,this._reschedule()];case 6:return l.sent(),[4,c.executeObjectIdsQuery(b)];case 7:return c=l.sent(),[4,this._reschedule()];case 8:return l.sent(),
[4,c.executeTimeQuery(b)];case 9:return c=l.sent(),[4,this._reschedule()];case 10:return l.sent(),[4,c.executeAttributesQuery(b)];case 11:return c=l.sent(),[4,this._reschedule()];case 12:l.sent();n=c.items;e=new Set;g=0;for(h=n;g<h.length;g++)A=h[g],e.add(c.featureAdapter.getObjectId(A));return[2,e];case 13:m=l.sent();if(m===v.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw m;case 14:return[2]}})})};a.prototype.executeQueryForLatestObservations=function(a,b){var n=this;if(this.timeInfo)return this.executeQuery(a,
b).then(function(a){return n._filterLatest(a,n.timeInfo)});na.error(new c("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))};a.prototype._schedule=function(a){return b(this,void 0,void 0,function(){return p(this,function(b){return this._frameQueue?[2,this._frameQueue.push(a).then(function(a){return a})]:[2,a]})})};a.prototype._reschedule=function(a){return b(this,void 0,void 0,function(){return p(this,function(b){return this._frameQueue?[2,this._frameQueue.unshift(a).then(function(a){return a})]:
[2,a]})})};a.prototype._update=function(a){for(this._budget=a;!a.done&&this._frameQueue&&this._frameQueue.process();)a.madeProgress();this._budget=null};a.prototype._filterLatest=function(a,b){var c=b.trackIdField,n=b.startTimeField;b=b.endTimeField||n;for(var n=new Map,e=[],g=0,h=a.features;g<h.length;g++){var k=h[g],A=k.attributes[c],m=k.attributes[b];(!n.has(A)||n.get(A).attributes[b]<m)&&n.set(A,k)}n.forEach(function(a){return e.push(a)});return r({},a,{features:e})};a.prototype._getAll=function(){if(!this._allItems){var a=
[];this.featureStore.forEach(function(b){return a.push(b)});this._allItems=new e.default(a,null,this)}return this._allItems};a.prototype._executeGeometryQuery=function(a){return b(this,void 0,void 0,function(){var c,n,h,k,A,m,l,t,v,q,u,K,H,y,Y,w,na,r,X,V,C,G,E,D,fa=this;return p(this,function(U){switch(U.label){case 0:c=a.geometry;n=a.outSR;h=a.spatialRel;k=F.isValid(n)&&!F.equals(this.spatialReference,n);if(A=this.cacheSpatialQueries?k?JSON.stringify({geometry:c,spatialRelationship:h,outSpatialReference:n}):
JSON.stringify({geometry:c,spatialRelationship:h}):null)if(m=this._geometryQueryCache.get(A),void 0!==m)return[2,m];l=function(c){return b(fa,void 0,void 0,function(){var b;return p(this,function(e){switch(e.label){case 0:return k&&(a.returnGeometry||a.returnCentroid)?[4,c.project(n)]:[3,2];case 1:return b=e.sent(),A&&this._geometryQueryCache.put(A,b,b.size||1),[2,b];case 2:return A&&this._geometryQueryCache.put(A,c,c.size||1),[2,c]}})})};if(!c)return[2,l(this._getAll())];t=this.featureAdapter;if("esriSpatialRelDisjoint"!==
h)return[3,5];v=this._searchFeatures(this._getQueryBBoxes(c));if(!v.length)return[2,l(this._getAll())];K=new Set;H=0;for(y=v;H<y.length;H++)Y=y[H],K.add(t.getObjectId(Y));return[4,this._reschedule(K)];case 1:return K=U.sent(),w=0,q=Array(K.size),this.featureStore.forEach(function(a){return q[w++]=a}),u=K,[4,this._reschedule()];case 2:return U.sent(),[4,g.getSpatialQueryOperator(h,c,this)];case 3:return na=U.sent(),r=function(a){return!u.has(t.getObjectId(a))||na(t.getGeometry(a))},V=e.default.bind,
[4,this._runSpatialFilter(q,r)];case 4:return X=new (V.apply(e.default,[void 0,U.sent(),c,this])),[2,l(X)];case 5:return C=this._searchFeatures(this._getQueryBBoxes(c)),C.length?(G=this._canExecuteSoloPass(c,a))?[2,l(new e.default(C,c,this))]:[4,g.getSpatialQueryOperator(h,c,this)]:(X=new e.default([],c,this),A&&this._geometryQueryCache.put(A,X,X.size||1),[2,X]);case 6:return E=U.sent(),[4,this._runSpatialFilter(C,function(a){return E(t.getGeometry(a))})];case 7:return D=U.sent(),[2,l(new e.default(D,
c,this))]}})})};a.prototype._runSpatialFilter=function(a,c){return b(this,void 0,void 0,function(){var n,e,g,h=this;return p(this,function(k){if(!c)return[2,a];if(!this._budget)return[2,a.filter(function(a){return c(a)})];n=0;e=[];g=function(){return b(h,void 0,void 0,function(){var b;return p(this,function(h){switch(h.label){case 0:if(!(n<a.length))return[3,3];b=a[n];c(b)&&e.push(b);return this._budget.done?[4,this._reschedule()]:[3,2];case 1:return h.sent(),[2,g()];case 2:return++n,[3,0];case 3:return[2]}})})};
return[2,this._reschedule().then(function(){return g()}).then(function(){return e})]})})};a.prototype._canExecuteSoloPass=function(a,b){var c=this.geometryType;b=b.spatialRel;return g.canQueryWithRBush(a)&&("esriSpatialRelEnvelopeIntersects"===b||"esriGeometryPoint"===c&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b||"esriSpatialRelWithin"===b))};a.prototype._getQueryBBoxes=function(a){if(g.canQueryWithRBush(a)){if(D.isExtent(a))return[E.fromValues(a.xmin,a.ymin,a.xmax,a.ymax)];if(D.isPolygon(a))return a.rings.map(function(a){return E.fromValues(Math.min(a[0][0],
a[2][0]),Math.min(a[0][1],a[2][1]),Math.max(a[0][0],a[2][0]),Math.max(a[0][1],a[2][1]))})}return[I.getBoundsXY(E.create(),a)]};a.prototype._searchFeatures=function(a){for(var b=0;b<a.length;b++)this.featureStore.forEachInBounds(a[b],function(a){fa.add(a)});var c=Array(fa.size),n=0;fa.forEach(function(a){return c[n++]=a});fa.clear();return c};a.prototype._checkQuerySupport=function(a){return b(this,void 0,void 0,function(){return p(this,function(b){if(0>a.distance||null!=a.geometryPrecision||a.multipatchOption||
a.pixelSize||a.relationParam||a.text)throw new c("feature-store:unsupported-query","Unsupported query options",{query:a});return[2,C.all([this._checkAttributesQuerySupport(a),this._checkStatisticsQuerySupport(a),g.checkSpatialQuerySupport(a,this.geometryType,this.spatialReference),q.checkProjectionSupport(this.spatialReference,a.outSR)]).then(function(){return a})]})})};a.prototype._checkAttributesQuerySupport=function(a){var b=a.outFields,n=a.orderByFields,e=a.returnDistinctValues;n&&0<n.length&&
(n=n.map(function(a){return-1<a.indexOf(" ASC")?a.split(" ASC")[0]:-1<a.indexOf(" DESC")?a.split(" DESC")[0]:a}),m.validateFields(this.fieldsIndex,n,"orderByFields contains missing fields"));if(b&&0<b.length)m.validateFields(this.fieldsIndex,b,"outFields contains missing fields");else if(e)throw new c("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:a});m.validateWhere(this.fieldsIndex,a.where)};a.prototype._checkStatisticsQuerySupport=function(a){return b(this,
void 0,void 0,function(){var b,n,e,g,h,k,A,l,t,v,q,u;return p(this,function(p){b=a.outStatistics;n=a.groupByFieldsForStatistics;e=a.having;g=n&&n.length;h=b&&b.length;if(e){if(!g||!h)throw new c("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:a});m.validateHaving(this.fieldsIndex,e,b)}if(h){if(k=b.some(function(a){return"exceedslimit"===a.statisticType}))return[2];A=b.map(function(a){return a.onStatisticField});m.validateFields(this.fieldsIndex,
A,"onStatisticFields contains missing fields");g&&m.validateFields(this.fieldsIndex,n,"groupByFieldsForStatistics contains missing fields");l=0;for(t=b;l<t.length;l++){v=t[l];q=v.onStatisticField;u=v.statisticType;if("exceedslimit"===u)throw new c("feature-store:unsupported-query","statistic type exceedslimit is not supported",{definition:v,query:a});if((!g||"count"!==u)&&q&&m.hasInvalidFieldType(q,this.fieldsIndex))throw new c("feature-store:unsupported-query","outStatistics contains non-numeric fields",
{definition:v,query:a});}}return[2]})})};return a}();a.default=B;var A=G.create(),H=G.create()})},"esri/layers/graphics/data/attributeSupport":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/iteratorUtils ../../../core/sql/WhereClauseCache".split(" "),function(B,a,r,p,b,c){function l(a,b){return a?y.get(a,b):null}function k(a,b,c,y){void 0===y&&(y=!0);for(var w=[],r=0;r<b.length;r++){var m=b[r];if("*"!==m&&!a.has(m))if(y){var q=u(m);try{var h=
l(q,a);if(!h)throw new p("feature-store:unsupported-query","invalid SQL expression",{where:q});if(!h.isStandardized)throw new p("feature-store:unsupported-query","expression is not standard",{clause:h});k(a,h.fieldNames,"expression contains missing fields")}catch(e){if((q=e&&e.details)&&(q.clause||q.where))throw e;q&&q.missingFields?w.push.apply(w,q.missingFields):w.push(m)}}else w.push(m)}if(w.length)throw new p("feature-store:unsupported-query",c,{missingFields:w});}function u(a){return a.split(" as ")[0]}
Object.defineProperty(a,"__esModule",{value:!0});var y=new c.WhereClauseCache(50,500),C=b.SetFromValues("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));a.validateWhere=function(a,b){if(!b)return!0;var c=y.get(b,a);if(!c)throw new p("feature-store:unsupported-query","invalid SQL expression",{where:b});if(!c.isStandardized)throw new p("feature-store:unsupported-query","where clause is not standard",
{where:b});k(a,c.fieldNames,"where clause contains missing fields");return!0};a.validateHaving=function(a,b,c){if(!b)return!0;var l=y.get(b,a);if(!l)throw new p("feature-store:unsupported-query","invalid SQL expression",{having:b});if(!l.isAggregate)throw new p("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:b});k(a,l.fieldNames,"having contains missing fields");if(!l.getExpressions().every(function(b){var k=b.aggregateType;b=b.field;var l=a.has(b)&&
a.get(b).name;return c.some(function(b){var c=b.onStatisticField;b=b.statisticType;return(a.has(c)&&a.get(c).name)===l&&b.toLowerCase().trim()===k})}))throw new p("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:b});return!0};a.getWhereClause=l;a.validateFields=k;a.getExpressionFromFieldName=u;a.getAliasFromFieldName=function(a){return a.split(" as ")[1]};a.hasInvalidFieldType=function(a,b){return(a=b.get(a))?!C.has(a.type):!1}})},"esri/core/sql/WhereClauseCache":function(){define(["require",
"exports","../ItemCache","./WhereClause"],function(B,a,r,p){Object.defineProperty(a,"__esModule",{value:!0});B=function(){function a(a,b){this._cache=new r(a);this._invalidCache=new r(b)}a.prototype.get=function(a,b){var c=b.uid+":"+a,l=this._cache.get(c);if(l)return l;if(void 0!==this._invalidCache.get(c))return null;try{var y=p.WhereClause.create(a,b);this._cache.put(c,y);return y}catch(C){return this._invalidCache.put(c,null),null}};return a}();a.WhereClauseCache=B})},"esri/core/ItemCache":function(){define(["require",
"exports","./MemCache"],function(B,a,r){return function(){function a(a,c){this._storage=new r.MemCacheStorage;this._storage.maxSize=a;c&&this._storage.registerRemoveFunc("",c)}a.prototype.put=function(a,c){this._storage.put(a,c,1,1)};a.prototype.pop=function(a){return this._storage.pop(a)};a.prototype.get=function(a){return this._storage.get(a)};a.prototype.clear=function(){this._storage.clearAll()};a.prototype.destroy=function(){this._storage.clearAll()};return a}()})},"esri/core/sql/WhereClause":function(){define("require exports ../has ../iteratorUtils ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),
function(B,a,r,p,b,c,l){function k(a,b){a+="";return a.length>=b?a:Array(b-a.length+1).join("0")+a}function u(a,b,c,e,g,h,l,m,t){void 0===c&&(c="0");void 0===e&&(e="0");void 0===g&&(g="0");void 0===h&&(h="0");void 0===l&&(l="");void 0===m&&(m="0");void 0===t&&(t="0");return"+"===l||"-"===l?(a=k(parseInt(a,10),4)+"-"+k(parseInt(b,10),2)+"-"+k(parseInt(c,10),2),b="",10>parseFloat(h)&&(b="0"),e=k(parseInt(e,10),2)+":"+k(parseInt(g,10),2)+":"+(b+parseFloat(h).toString()),l=""+l+k(parseInt(m,10),2)+":"+
k(parseInt(t,10),2),new Date(a+"T"+e+l)):new Date(parseInt(a,10),parseInt(b,10),parseInt(c,10),parseInt(e,10),parseInt(g,10),parseFloat(h))}function y(a){var b=v.exec(a);if(null!==b){a=b[1];var c=b[2],e=b[3],g=b[4],h=b[5],k=b[6];return u(a,c,e,g,h,k)}b=V.exec(a);if(null!==b){a=b[1];var c=b[2],e=b[3],g=b[4],h=b[5],k=b[6],l=b[7],m=b[8],b=b[9];return u(a,c,e,g,h,k,l,m,b)}b=ca.exec(a);if(null!==b)return a=b[1],c=b[2],e=b[3],g=b[4],h=b[5],l=b[6],m=b[7],b=b[8],u(a,c,e,g,h,"0",l,m,b);b=na.exec(a);if(null!==
b)return a=b[1],c=b[2],e=b[3],g=b[4],h=b[5],u(a,c,e,g,h);b=t.exec(a);if(null!==b)return a=b[1],c=b[2],e=b[3],u(a,c,e);throw Error("SQL Invalid Timestamp");}function C(a){a=t.exec(a);if(null===a)throw Error("SQL Invalid Date");var b=a[2],c=a[3];return new Date(parseInt(a[1],10),parseInt(b,10)-1,parseInt(c,10))}function w(a){return Array.isArray(a)?a:[a]}function G(a){return null!==a?!0!==a:null}function E(a,b){return null!=a&&null!=b?!0===a&&!0===b:!1===a||!1===b?!1:null}function I(a,b){return null!=
a&&null!=b?!0===a||!0===b:!0===a||!0===b?!0:null}function D(a,b){if(null==a)return null;for(var c=!1,n=0;n<b.length;n++){var e=b[n];if(null==e)c=null;else if(a===e){c=!0;break}}return c}function F(a,b,c){if(null==a)return null;for(var n="",e=0,g=0;g<b.length;g++){var h=b.charAt(g);switch(e){case 0:h===c?e=1:n=0<="-[]/{}()*+?.\\^$|".indexOf(h)?n+("\\"+h):"%"===h?n+".*":"_"===h?n+".":n+h;break;case 1:n=0<="-[]/{}()*+?.\\^$|".indexOf(h)?n+("\\"+h):n+h,e=0}}return(new RegExp("^"+n+"$")).test(a)}function m(a){return a instanceof
Date?a.valueOf():a}function q(a,b,c){if(null==b||null==c)return null;b=m(b);c=m(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function h(a){for(var b=[],c={},e=0;e<a.length;e++){var g=a[e],h=g.toLowerCase();void 0===c[h]&&(b.push(g),c[h]=1)}return b}function e(a,b,e){if(b instanceof c.SqlInterval)if(e instanceof Date)switch(a){case "+":return new Date(b.valueInMilliseconds()+
e.getTime());case "-":return b.valueInMilliseconds()-e.getTime();case "*":return b.valueInMilliseconds()*e.getTime();case "/":return b.valueInMilliseconds()/e.getTime()}else if(e instanceof c.SqlInterval)switch(a){case "+":return c.SqlInterval.createFromMilliseconds(b.valueInMilliseconds()+e.valueInMilliseconds());case "-":return c.SqlInterval.createFromMilliseconds(b.valueInMilliseconds()-e.valueInMilliseconds());case "*":return b.valueInMilliseconds()*e.valueInMilliseconds();case "/":return b.valueInMilliseconds()/
e.valueInMilliseconds()}else b=b.valueInMilliseconds();else if(e instanceof c.SqlInterval)if(b instanceof Date)switch(a){case "+":return new Date(e.valueInMilliseconds()+b.getTime());case "-":return new Date(b.getTime()-e.valueInMilliseconds());case "*":return b.getTime()*e.valueInMilliseconds();case "/":return b.getTime()/e.valueInMilliseconds()}else e=e.valueInMilliseconds();else if(b instanceof Date&&"number"===typeof e)switch(e*=864E5,b=b.getTime(),a){case "+":return new Date(b+e);case "-":return new Date(b-
e);case "*":return new Date(b*e);case "/":return new Date(b/e)}else if(e instanceof Date&&"number"===typeof b)switch(b*=864E5,e=e.getTime(),a){case "+":return new Date(b+e);case "-":return new Date(b-e);case "*":return new Date(b*e);case "/":return new Date(b/e)}switch(a){case "+":return b+e;case "-":return b-e;case "*":return b*e;case "/":return b/e}}function g(a,b,c,e){a=e.getAttribute(a,b);return null!=a&&1===c[b]?new Date(a):a}Object.defineProperty(a,"__esModule",{value:!0});var t=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,
v=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,V=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,ca=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,na=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,fa=function(){function a(){}a.makeBool=function(a){return!0===a};a.featureValue=function(a,b,c,e){return g(a,b,c,e)};a.equalsNull=function(a){return null===a};a.applyLike=function(a,b,c){return F(a,
b,c)};a.ensureArray=function(a){return w(a)};a.applyIn=function(a,b){return D(a,b)};a.currentDate=function(){var a=new Date;a.setHours(0,0,0,0);return a};a.makeSqlInterval=function(a,b,e){return c.SqlInterval.createFromValueAndQualifer(a,b,e)};a.convertInterval=function(a){return a instanceof c.SqlInterval?a.valueInMilliseconds():a};a.currentTimestamp=function(){return new Date};a.compare=function(a,b,c){return q(a,b,c)};a.calculate=function(a,b,c){return e(a,b,c)};a.makeComparable=function(a){return m(a)};
a.evaluateFunction=function(a,b){return c.evaluateFunction(a,b)};a.lookup=function(a,b){a=b[a];return void 0===a?null:a};a.between=function(a,b){return null==a||null==b[0]||null==b[1]?null:a>=b[0]&&a<=b[1]};a.notbetween=function(a,b){return null==a||null==b[0]||null==b[1]?null:a<b[0]||a>b[1]};a.ternaryNot=function(a){return G(a)};a.ternaryAnd=function(a,b){return E(a,b)};a.ternaryOr=function(a,b){return I(a,b)};return a}();B=function(){function k(a,b){this.fieldsIndex=b;this.datefields={};this.parameters=
{};this.parseTree=l.WhereGrammar.parse(a);a=this.extractExpressionInfo(b);b=a.isStandardized;var c=a.isAggregate;this.referencedFieldNames=a.referencedFieldNames;this.isStandardized=b;this.isAggregate=c}k.create=function(a,b){return new k(a,b)};Object.defineProperty(k.prototype,"fieldNames",{get:function(){return this.referencedFieldNames},enumerable:!0,configurable:!0});k.prototype.testSet=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);for(var e={},g=function(a){e[a]=b.map(function(b){return c.getAttribute(b,
a)})},n=0,h=this.fieldNames;n<h.length;n++)g(h[n]);return!!this.evaluateNode(this.parseTree,{attributes:e},a.defaultAttributeAdapter)};k.prototype.calculateValue=function(b,e){void 0===e&&(e=a.defaultAttributeAdapter);b=this.evaluateNode(this.parseTree,b,e);return b instanceof c.SqlInterval?b.valueInMilliseconds()/864E5:b};k.prototype.calculateValueCompiled=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(b,this.parameters,
c,this.datefields);if(r("csp-restrictions"))return this.calculateValue(b,c);this.compileMe();return this.parseTree._compiledVersion(b,this.parameters,c,this.datefields)};k.prototype.testFeature=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);return!!this.evaluateNode(this.parseTree,b,c)};k.prototype.testFeatureCompiled=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);if(void 0===this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(b,this.parameters,c,this.datefields);
if(r("csp-restrictions"))return this.testFeature(b,c);this.compileMe();return!!this.parseTree._compiledVersion(b,this.parameters,c,this.datefields)};k.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&a.push(b.name.toLowerCase())});return h(a)};k.prototype.getExpressions=function(){var a=new Map;this.visitAll(this.parseTree,function(b){if("function"===b.type){var c=b.name.toLowerCase();b=b.args.value[0];if("column_ref"===b.type){b=b.column;var e=
c+"-"+b;a.has(e)||a.set(e,{aggregateType:c,field:b})}}});return p.valuesOfMap(a)};k.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return h(a)};k.prototype.compileMe=function(){var a="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",a)).bind(fa)};k.prototype.extractExpressionInfo=function(a){var e=
this,g=[],n=!0,k=!0;this.visitAll(this.parseTree,function(h){switch(h.type){case "column_ref":var l=h.column.toUpperCase();if("CURRENT_DATE"!==l&&"CURRENT_TIMESTAMP"!==l){var m=(l=a.get(h.column))&&l.name;!l||"date"!==l.type&&"esriFieldTypeDate"!==l.type||(e.datefields[l.name]=1);void 0!==m?(g.push(m),h.column=m):g.push(h.column)}break;case "function":l=h.name,h=h.args.value.length,n&&(n=c.isStandardized(l,h)),k&&(k=b.isAggregate(l,h))}});return{referencedFieldNames:h(g),isStandardized:n,isAggregate:k}};
k.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,e=a.clauses;c<e.length;c++){var g=e[c];this.visitAll(g,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)g=a[c],this.visitAll(g,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);
this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};k.prototype.evaluateNodeToJavaScript=function(a){switch(a.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(a.value)+", "+JSON.stringify(a.qualifier)+","+JSON.stringify(a.op)+")";case "case_expression":var b="";if("simple"===a.format)for(var c="this.makeComparable("+this.evaluateNodeToJavaScript(a.operand)+")",b="( ",e=0;e<a.clauses.length;e++)b+=" ("+c+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(a.clauses[e].operand)+
")) ? ("+this.evaluateNodeToJavaScript(a.clauses[e].value)+") : ";else for(b="( ",e=0;e<a.clauses.length;e++)b+=" this.makeBool("+this.evaluateNodeToJavaScript(a.clauses[e].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(a.clauses[e].value)+") : ";b=null!==a.else?b+this.evaluateNodeToJavaScript(a.else):b+"null";return b+" )";case "param":return"this.lookup("+JSON.stringify(a.value.toLowerCase())+",lookups)";case "expr_list":b="[";c=0;for(a=a.value;c<a.length;c++)e=a[c],"["!==b&&(b+=
","),b+=this.evaluateNodeToJavaScript(e);return b+"]";case "unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(a.expr)+")";case "binary_expr":switch(a.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+
this.evaluateNodeToJavaScript(a.left)+")";case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+")))";case "BETWEEN":return"this.between("+
this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+
JSON.stringify(a.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")"}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(a.value);
case "date":return"(new Date("+C(a.value).getTime().toString()+"))";case "timestamp":return"(new Date("+y(a.value).getTime().toString()+"))";case "column_ref":return"CURRENT_DATE"===a.column.toUpperCase()?"this.currentDate()":"CURRENT_TIMESTAMP"===a.column.toUpperCase()?"this.currentTimestamp()":"this.featureValue(feature,"+JSON.stringify(a.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(a.name)+","+this.evaluateNodeToJavaScript(a.args)+")"}throw Error("Unsupported sql syntax "+
a.type);};k.prototype.evaluateNode=function(a,h,k){switch(a.type){case "interval":return h=this.evaluateNode(a.value,h,k),c.SqlInterval.createFromValueAndQualifer(h,a.qualifier,a.op);case "case_expression":if("simple"===a.format)for(var l=m(this.evaluateNode(a.operand,h,k)),n=0;n<a.clauses.length;n++){if(l===m(this.evaluateNode(a.clauses[n].operand,h,k)))return this.evaluateNode(a.clauses[n].value,h,k)}else for(n=0;n<a.clauses.length;n++)if(!0===this.evaluateNode(a.clauses[n].operand,h,k))return this.evaluateNode(a.clauses[n].value,
h,k);return null!==a.else?this.evaluateNode(a.else,h,k):null;case "param":return this.parameters[a.value.toLowerCase()];case "expr_list":l=[];n=0;for(a=a.value;n<a.length;n++){var t=a[n];l.push(this.evaluateNode(t,h,k))}return l;case "unary_expr":return G(this.evaluateNode(a.expr,h,k));case "binary_expr":switch(a.operator){case "AND":return E(this.evaluateNode(a.left,h,k),this.evaluateNode(a.right,h,k));case "OR":return I(this.evaluateNode(a.left,h,k),this.evaluateNode(a.right,h,k));case "IS":if("null"!==
a.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(a.left,h,k);case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(a.left,h,k);case "IN":return l=w(this.evaluateNode(a.right,h,k)),D(this.evaluateNode(a.left,h,k),l);case "NOT IN":return l=w(this.evaluateNode(a.right,h,k)),G(D(this.evaluateNode(a.left,h,k),l));case "BETWEEN":return l=this.evaluateNode(a.left,h,k),a=this.evaluateNode(a.right,h,k),null==l||null==a[0]||
null==a[1]?null:l>=m(a[0])&&l<=m(a[1]);case "NOTBETWEEN":return l=this.evaluateNode(a.left,h,k),a=this.evaluateNode(a.right,h,k),null==l||null==a[0]||null==a[1]?null:l<m(a[0])||l>m(a[1]);case "LIKE":return F(this.evaluateNode(a.left,h,k),this.evaluateNode(a.right,h,k),a.escape);case "NOT LIKE":return G(F(this.evaluateNode(a.left,h,k),this.evaluateNode(a.right,h,k),a.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return q(a.operator,this.evaluateNode(a.left,
h,k),this.evaluateNode(a.right,h,k));case "-":case "+":case "*":case "/":return e(a.operator,this.evaluateNode(a.left,h,k),this.evaluateNode(a.right,h,k))}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return a.value;case "date":return C(a.value);case "timestamp":return y(a.value);case "column_ref":return"CURRENT_DATE"===a.column.toUpperCase()?(t=new Date,t.setHours(0,0,0,0),t):"CURRENT_TIMESTAMP"===a.column.toUpperCase()?new Date:g(h,a.column,
this.datefields,k);case "function":return h=this.evaluateNode(a.args,h,k),this.isAggregate?b.aggregateFunction(a.name,h):c.evaluateFunction(a.name,h)}throw Error("Unsupported sql syntax "+a.type);};return k}();a.WhereClause=B;a.defaultAttributeAdapter={getAttribute:function(a,b){return(a&&"object"===typeof a.attributes?a.attributes:a)[b]}}})},"esri/core/sql/AggregateFunctions":function(){define(["require","exports"],function(B,a){function r(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b/a.length}
function p(a){for(var b=r(a),c=a.length,u=0,p=0;p<a.length;p++)u+=Math.pow(a[p]-b,2);return 1<c?u/(c-1):0}Object.defineProperty(a,"__esModule",{value:!0});a.aggregateFunction=function(a,l){var c=b[a.toLowerCase()];if(null==c)throw Error("Function Not Recognised");if(l.length<c.minParams||l.length>c.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return c.evaluate(l)};a.isAggregate=function(a,l){a=b[a.toLowerCase()];return null!=a&&l>=a.minParams&&l<=a.maxParams};var b=
{min:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.min.apply(Math,a[0])}},max:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.max.apply(Math,a[0])}},avg:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:r(a[0])}},sum:{minParams:1,maxParams:1,evaluate:function(a){if(null==a[0])a=null;else{a=a[0];for(var b=0,c=0;c<a.length;c++)b+=a[c];a=b}return a}},stddev:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sqrt(p(a[0]))}},
count:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].length}},var:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:p(a[0])}}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","dojo/regexp"],function(B,a,r){Object.defineProperty(a,"__esModule",{value:!0});B=function(){function a(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}a.fixDefaults=function(a){if(null!==a.precision||null!==a.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");
};a.createFromMilliseconds=function(b){var c=new a;c.second=b/1E3;return c};a.createFromValueAndQualifer=function(b,l,k){var c=null,p=new a;p.op="-"===k?"-":"+";if("interval-period"===l.type){a.fixDefaults(l);if("year"===l.period||"month"===l.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(b))p[l.period]=parseFloat(b);else throw Error("Illegal Interval");}else{a.fixDefaults(l.start);a.fixDefaults(l.end);if("year"===l.start.period||"month"===l.start.period)throw Error("Year-Month Intervals not supported");
if("year"===l.end.period||"month"===l.end.period)throw Error("Year-Month Intervals not supported");switch(l.start.period){case "day":switch(l.end.period){case "hour":c=/^[0-9]{1,} [0-9]{1,}$/;if(c.test(b))p[l.start.period]=parseFloat(b.split(" ")[0]),p[l.end.period]=parseFloat(b.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":c=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(c.test(b))p[l.start.period]=parseFloat(b.split(" ")[0]),b=b.split(" ")[1].split(":"),p.hour=parseFloat(b[0]),
p.minute=parseFloat(b[1]);else throw Error("Illegal Interval");break;case "second":c=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(c.test(b))p[l.start.period]=parseFloat(b.split(" ")[0]),b=b.split(" ")[1].split(":"),p.hour=parseFloat(b[0]),p.minute=parseFloat(b[1]),p.second=parseFloat(b[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(l.end.period){case "minute":c=/^[0-9]{1,}:[0-9]{1,}$/;if(c.test(b))p.hour=parseFloat(b.split(":")[0]),
p.minute=parseFloat(b.split(":")[1]);else throw Error("Illegal Interval");break;case "second":c=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(c.test(b))b=b.split(":"),p.hour=parseFloat(b[0]),p.minute=parseFloat(b[1]),p.second=parseFloat(b[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(l.end.period){case "second":c=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(c.test(b))b=b.split(":"),p.minute=parseFloat(b[0]),p.second=parseFloat(b[1]);
else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return p};a.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return a}();a.SqlInterval=B;a.evaluateFunction=function(a,c){var b=p[a.toLowerCase()];if(null==b)throw Error("Function Not Recognised");if(c.length<b.minParams||c.length>b.maxParams)throw Error("Invalid Parameter count for call to "+
a.toUpperCase());return b.evaluate(c)};a.isStandardized=function(a,c){a=p[a.toLowerCase()];return null!=a&&c>=a.minParams&&c<=a.maxParams};var p={extract:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];if(null==a)return null;if(a instanceof Date)switch(b.toUpperCase()){case "SECOND":return a.getSeconds();case "MINUTE":return a.getMinutes();case "HOUR":return a.getHours();case "DAY":return a.getDate();case "MONTH":return a.getMonth()+1;case "YEAR":return a.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");
}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var b=a[0],l=a[1];return null==b||null==l?null:b.toString().substring(l-1)}if(3===a.length)return b=a[0],l=a[1],a=a[2],null==b||null==l||null==a?null:0>=a?"":b.toString().substring(l-1,l+a-1)}},position:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];return null==b||null==a?null:a.indexOf(b)+1}},trim:{minParams:2,maxParams:3,evaluate:function(a){var b=3===a.length,l=b?a[1]:" ",b=b?a[2]:a[1];if(null==l||null==
b)return null;l="("+r.escapeString(l)+")";switch(a[0]){case "BOTH":return b.replace(new RegExp("^"+l+"*|"+l+"*$","g"),"");case "LEADING":return b.replace(new RegExp("^"+l+"*","g"),"");case "TRAILING":return b.replace(new RegExp(l+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,
maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])}},log10:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==
a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.asin(a[0])}},acos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:0<a[0]?1:0>a[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],
a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var b=a[0];a=2===a.length?Math.pow(10,a[1]):1;return null==b?null:Math.round(b*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"===typeof a[0]||a[0]instanceof String?
a[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(a){for(var b="",l=0;l<a.length;l++){if(null==a[l])return null;b+=a[l].toString()}return b}},lower:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toUpperCase()}}}})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(B,a){var r={};a.setObject("dojo.regexp",r);
r.escapeString=function(a,b){return a.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(a){return b&&-1!=b.indexOf(a)?a:"\\"+a})};r.buildGroupRE=function(a,b,c){if(!(a instanceof Array))return b(a);for(var l=[],k=0;k<a.length;k++)l.push(b(a[k]));return r.group(l.join("|"),c)};r.group=function(a,b){return"("+(b?"?:":"")+a+")"};return r})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(B,a,r){Object.defineProperty(a,"__esModule",{value:!0});B=function(){function a(){}
a.parse=function(a){return r.parse(a)};return a}();a.WhereGrammar=B})},"esri/core/sql/sql92grammar":function(){define([],function(){function B(a,r,p,b){this.message=a;this.expected=r;this.found=p;this.location=b;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,B)}(function(a,r){function p(){this.constructor=a}p.prototype=r.prototype;a.prototype=new p})(B,Error);B.buildMessage=function(a,r){function p(a){return a.charCodeAt(0).toString(16).toUpperCase()}
function b(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+p(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+p(a)})}function c(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+
p(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+p(a)})}var l={literal:function(a){return'"'+b(a.text)+'"'},"class":function(a){var b="",k;for(k=0;k<a.parts.length;k++)b+=a.parts[k]instanceof Array?c(a.parts[k][0])+"-"+c(a.parts[k][1]):c(a.parts[k]);return"["+(a.inverted?"^":"")+b+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),c;for(c=0;c<a.length;c++){var k=
c,p;p=a[c];p=l[p.type](p);b[k]=p}b.sort();if(0<b.length){for(a=c=1;c<b.length;c++)b[c-1]!==b[c]&&(b[a]=b[c],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(a)+" but "+(r?'"'+b(r)+'"':"end of input")+" found."};return{SyntaxError:B,parse:function(a,r){function p(a,b){return{type:"literal",text:a,ignoreCase:b}}function b(a,b,d){return{type:"class",parts:a,inverted:b,ignoreCase:d}}function c(b){var d=Ha[b],
c;if(!d){for(c=b-1;!Ha[c];)c--;d=Ha[c];for(d={line:d.line,column:d.column};c<b;)10===a.charCodeAt(c)?(d.line++,d.column=1):d.column++,c++;Ha[b]=d}return d}function l(a,b){var d=c(a),f=c(b);return{start:{offset:a,line:d.line,column:d.column},end:{offset:b,line:f.line,column:f.column}}}function k(a){f<Z||(f>Z&&(Z=f,Pa=[]),Pa.push(a))}function u(){var a,b,c;a=f;b=z();b!==d?(b=C(),b!==d?(c=z(),c!==d?a=b:(f=a,a=d)):(f=a,a=d)):(f=a,a=d);return a}function y(){var a,b,c,e,h,g,k,l;a=f;b=C();if(b!==d){c=[];
e=f;h=z();h!==d?(g=Ba(),g!==d?(k=z(),k!==d?(l=C(),l!==d?e=h=[h,g,k,l]:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d);for(;e!==d;)c.push(e),e=f,h=z(),h!==d?(g=Ba(),g!==d?(k=z(),k!==d?(l=C(),l!==d?e=h=[h,g,k,l]:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d);if(c!==d){a={type:"expr_list"};b=[b];for(e=0;e<c.length;e++)b.push(c[e][3]);a.value=b}else f=a,a=d}else f=a,a=d;return a}function C(){var a,b,c,e,h,g,k,l;a=f;b=w();if(b!==d){c=[];e=f;h=z();h!==d?(g=la(),g!==d?(k=z(),k!==d?(l=w(),l!==d?e=h=[h,g,k,l]:(f=e,
e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d);for(;e!==d;)c.push(e),e=f,h=z(),h!==d?(g=la(),g!==d?(k=z(),k!==d?(l=w(),l!==d?e=h=[h,g,k,l]:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d);c!==d?a=b=Ca(b,c):(f=a,a=d)}else f=a,a=d;return a}function w(){var a,b,c,e,h,g,k,l;a=f;b=G();if(b!==d){c=[];e=f;h=z();h!==d?(g=ka(),g!==d?(k=z(),k!==d?(l=G(),l!==d?e=h=[h,g,k,l]:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d);for(;e!==d;)c.push(e),e=f,h=z(),h!==d?(g=ka(),g!==d?(k=z(),k!==d?(l=G(),l!==d?e=h=[h,g,k,l]:(f=e,e=d)):(f=e,
e=d)):(f=e,e=d)):(f=e,e=d);c!==d?a=b=Ca(b,c):(f=a,a=d)}else f=a,a=d;return a}function G(){var b,c,e,h,g;b=f;c=oa();c===d&&(c=f,33===a.charCodeAt(f)?(e=$c,f++):(e=d,0===x&&k(ad)),e!==d?(h=f,x++,61===a.charCodeAt(f)?(g=ab,f++):(g=d,0===x&&k(bb)),x--,g===d?h=void 0:(f=h,h=d),h!==d?c=e=[e,h]:(f=c,c=d)):(f=c,c=d));c!==d?(e=z(),e!==d?(h=G(),h!==d?b=c={type:"unary_expr",operator:"NOT",expr:h}:(f=b,b=d)):(f=b,b=d)):(f=b,b=d);if(b===d)if(b=f,c=F(),c!==d)if(e=z(),e!==d){var l,m,n;e=[];h=f;g=z();g!==d?(l=E(),
l!==d?(m=z(),m!==d?(n=F(),n!==d?h=g=[g,l,m,n]:(f=h,h=d)):(f=h,h=d)):(f=h,h=d)):(f=h,h=d);if(h!==d)for(;h!==d;)e.push(h),h=f,g=z(),g!==d?(l=E(),l!==d?(m=z(),m!==d?(n=F(),n!==d?h=g=[g,l,m,n]:(f=h,h=d)):(f=h,h=d)):(f=h,h=d)):(f=h,h=d);else e=d;e!==d&&(e={type:"arithmetic",tail:e});e===d&&(e=f,h=D(),h!==d?(g=z(),g!==d?(g=ga(),g!==d?(g=z(),g!==d?(g=y(),g!==d?(l=z(),l!==d?(l=ha(),l!==d?e=h={op:h,right:g}:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d),e===d&&(e=f,h=D(),h!==d?
(g=z(),g!==d?(g=ga(),g!==d?(g=z(),g!==d?(g=ha(),g!==d?e=h={op:h,right:{type:"expr_list",value:[]}}:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d),e===d&&(e=f,h=D(),h!==d?(g=z(),g!==d?(g=ca(),g!==d?e=h={op:h,right:g}:(f=e,e=d)):(f=e,e=d)):(f=e,e=d))),e===d&&(e=f,g=oa(),g!==d?(h=z(),h!==d?(h=ma(),h!==d?(l=z(),l!==d?(l=F(),l!==d?(m=z(),m!==d?(m=ka(),m!==d?(g=z(),g!==d?(g=F(),g!==d?e=g={op:"NOT"+h,right:{type:"expr_list",value:[l,g]}}:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,
e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d),e===d&&(e=f,g=ma(),g!==d?(h=z(),h!==d?(h=F(),h!==d?(l=z(),l!==d?(l=ka(),l!==d?(m=z(),m!==d?(m=F(),m!==d?e=g={op:g,right:{type:"expr_list",value:[h,m]}}:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)),e===d&&(e=f,h=ba(),h!==d?(g=z(),g!==d?(g=oa(),g!==d?(g=z(),g!==d?(g=F(),g!==d?e=h={op:h+"NOT",right:g}:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d),e===d&&(e=f,h=ba(),h!==d?(g=z(),g!==d?(g=F(),g!==d?e=h={op:h,right:g}:(f=e,e=
d)):(f=e,e=d)):(f=e,e=d)),e===d&&(e=f,h=I(),h!==d?(g=z(),g!==d?(g=H(),g!==d?(l=z(),l!==d?(l=f,a.substr(f,6).toLowerCase()===bd?(m=a.substr(f,6),f+=6):(m=d,0===x&&k(cd)),m!==d?(m=f,x++,n=v(),x--,n===d?m=void 0:(f=m,m=d),m!==d?l="ESCAPE":(f=l,l=d)):(f=l,l=d),l!==d?(l=z(),l!==d?(l=X(),l!==d?e=h={op:h,right:g,escape:l.value}:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d),e===d&&(e=f,h=I(),h!==d?(g=z(),g!==d?(g=H(),g!==d?e=h={op:h,right:g,escape:""}:(f=e,e=d)):(f=e,e=d)):(f=
e,e=d))))));e===d&&(e=null);e!==d?(b=c,c=e,""==c||void 0==c||null==c?c=b:(e=null,c=e="arithmetic"==c.type?Ca(b,c.tail):cb(c.op,b,c.right,c.escape)),b=c):(f=b,b=d)}else f=b,b=d;else f=b,b=d;return b}function E(){var b;a.substr(f,2)===db?(b=db,f+=2):(b=d,0===x&&k(dd));b===d&&(62===a.charCodeAt(f)?(b=ed,f++):(b=d,0===x&&k(fd)),b===d&&(a.substr(f,2)===eb?(b=eb,f+=2):(b=d,0===x&&k(gd)),b===d&&(a.substr(f,2)===fb?(b=fb,f+=2):(b=d,0===x&&k(hd)),b===d&&(60===a.charCodeAt(f)?(b=id,f++):(b=d,0===x&&k(jd)),
b===d&&(61===a.charCodeAt(f)?(b=ab,f++):(b=d,0===x&&k(bb)),b===d&&(a.substr(f,2)===gb?(b=gb,f+=2):(b=d,0===x&&k(kd))))))));return b}function I(){var a,b,e,c;a=a=f;b=oa();b!==d?(e=z(),e!==d?(c=ea(),c!==d?a=b=[b,e,c]:(f=a,a=d)):(f=a,a=d)):(f=a,a=d);a!==d&&(a=a[0]+" "+a[2]);a===d&&(a=ea());return a}function D(){var a,b,e,c;a=a=f;b=oa();b!==d?(e=z(),e!==d?(c=ja(),c!==d?a=b=[b,e,c]:(f=a,a=d)):(f=a,a=d)):(f=a,a=d);a!==d&&(a=a[0]+" "+a[2]);a===d&&(a=ja());return a}function F(){var a,b,e,c,h,g,k,l;a=f;b=
q();if(b!==d){e=[];c=f;h=z();h!==d?(g=m(),g!==d?(k=z(),k!==d?(l=q(),l!==d?c=h=[h,g,k,l]:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d);for(;c!==d;)e.push(c),c=f,h=z(),h!==d?(g=m(),g!==d?(k=z(),k!==d?(l=q(),l!==d?c=h=[h,g,k,l]:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d);e!==d?a=b=Ca(b,e):(f=a,a=d)}else f=a,a=d;return a}function m(){var b;43===a.charCodeAt(f)?(b=ac,f++):(b=d,0===x&&k(bc));b===d&&(45===a.charCodeAt(f)?(b=cc,f++):(b=d,0===x&&k(dc)));return b}function q(){var a,b,c,g,k,l,m,n;a=f;b=e();if(b!==
d){c=[];g=f;k=z();k!==d?(l=h(),l!==d?(m=z(),m!==d?(n=e(),n!==d?g=k=[k,l,m,n]:(f=g,g=d)):(f=g,g=d)):(f=g,g=d)):(f=g,g=d);for(;g!==d;)c.push(g),g=f,k=z(),k!==d?(l=h(),l!==d?(m=z(),m!==d?(n=e(),n!==d?g=k=[k,l,m,n]:(f=g,g=d)):(f=g,g=d)):(f=g,g=d)):(f=g,g=d);c!==d?a=b=Ca(b,c):(f=a,a=d)}else f=a,a=d;return a}function h(){var b;42===a.charCodeAt(f)?(b=ld,f++):(b=d,0===x&&k(md));b===d&&(47===a.charCodeAt(f)?(b=nd,f++):(b=d,0===x&&k(od)));return b}function e(){var b,e,c,h,l,m,n;n=X();if(n===d){var q,p,u,A;
q=f;var r,w,K,E;r=f;w=M();w!==d?(K=da(),K!==d?(E=W(),E!==d?r=w=parseFloat(w+K+E):(f=r,r=d)):(f=r,r=d)):(f=r,r=d);r===d&&(r=f,w=M(),w!==d?(K=da(),K!==d?r=w=parseFloat(w+K):(f=r,r=d)):(f=r,r=d),r===d&&(r=f,w=M(),w!==d?(K=W(),K!==d?r=w=parseFloat(w+K):(f=r,r=d)):(f=r,r=d),r===d&&(r=f,w=M(),w!==d&&(w=parseFloat(w)),r=w)));p=r;p!==d?(u=f,x++,A=t(),x--,A===d?u=void 0:(f=u,u=d),u!==d?q=p={type:"number",value:p}:(f=q,q=d)):(f=q,q=d);n=q;if(n===d){var F,D;F=f;var G,B,I,Q;G=f;a.substr(f,4).toLowerCase()===
pd?(B=a.substr(f,4),f+=4):(B=d,0===x&&k(qd));B!==d?(I=f,x++,Q=v(),x--,Q===d?I=void 0:(f=I,I=d),I!==d?G=B=[B,I]:(f=G,G=d)):(f=G,G=d);D=G;D!==d&&(D={type:"bool",value:!0});F=D;if(F===d){F=f;var T,ba,Z,oa;T=f;a.substr(f,5).toLowerCase()===rd?(ba=a.substr(f,5),f+=5):(ba=d,0===x&&k(sd));ba!==d?(Z=f,x++,oa=v(),x--,oa===d?Z=void 0:(f=Z,Z=d),Z!==d?T=ba=[ba,Z]:(f=T,T=d)):(f=T,T=d);D=T;D!==d&&(D={type:"bool",value:!1});F=D}n=F;if(n===d){var ka,ea,la,ma,Ca;ea=f;a.substr(f,4).toLowerCase()===td?(la=a.substr(f,
4),f+=4):(la=d,0===x&&k(ud));la!==d?(ma=f,x++,Ca=v(),x--,Ca===d?ma=void 0:(f=ma,ma=d),ma!==d?ea=la=[la,ma]:(f=ea,ea=d)):(f=ea,ea=d);ka=ea;ka!==d&&(ka={type:"null",value:null});n=ka;if(n===d){var xa,Ba,Ha,Fa;xa=f;var Ia,za,hb,Pa;Ia=f;a.substr(f,4).toLowerCase()===vd?(za=a.substr(f,4),f+=4):(za=d,0===x&&k(wd));za!==d?(hb=f,x++,Pa=v(),x--,Pa===d?hb=void 0:(f=hb,hb=d),hb!==d?Ia=za="DATE":(f=Ia,Ia=d)):(f=Ia,Ia=d);Ba=Ia;Ba!==d?(Ha=z(),Ha!==d?(Fa=H(),Fa!==d?xa=Ba={type:"date",value:Fa.value}:(f=xa,xa=d)):
(f=xa,xa=d)):(f=xa,xa=d);n=xa;if(n===d){var ya,ec,Za,fc;ya=f;var Ja,Fb,ib,$a;Ja=f;a.substr(f,9).toLowerCase()===xd?(Fb=a.substr(f,9),f+=9):(Fb=d,0===x&&k(yd));Fb!==d?(ib=f,x++,$a=v(),x--,$a===d?ib=void 0:(f=ib,ib=d),ib!==d?Ja=Fb="TIMESTAMP":(f=Ja,Ja=d)):(f=Ja,Ja=d);ec=Ja;ec!==d?(Za=z(),Za!==d?(fc=H(),fc!==d?ya=ec={type:"timestamp",value:fc.value}:(f=ya,ya=d)):(f=ya,ya=d)):(f=ya,ya=d);n=ya;if(n===d){var N,Qa,Gb,va,Hb,Ra,ab,gc;N=f;Qa=uc();Qa!==d?(Gb=z(),Gb!==d?(45===a.charCodeAt(f)?(va=cc,f++):(va=
d,0===x&&k(dc)),va===d&&(43===a.charCodeAt(f)?(va=ac,f++):(va=d,0===x&&k(bc))),va!==d?(Hb=z(),Hb!==d?(Ra=H(),Ra!==d?(ab=z(),ab!==d?(gc=fa(),gc!==d?N=Qa={type:"interval",value:Ra,qualifier:gc,op:va}:(f=N,N=d)):(f=N,N=d)):(f=N,N=d)):(f=N,N=d)):(f=N,N=d)):(f=N,N=d)):(f=N,N=d);N===d&&(N=f,Qa=uc(),Qa!==d?(Gb=z(),Gb!==d?(va=H(),va!==d?(Hb=z(),Hb!==d?(Ra=fa(),Ra!==d?N=Qa={type:"interval",value:va,qualifier:Ra,op:""}:(f=N,N=d)):(f=N,N=d)):(f=N,N=d)):(f=N,N=d)):(f=N,N=d));n=N}}}}}}b=n;if(b===d){var R,hc,bb,
cb,db,ic,eb,fb,gb,jc,sb,tb;R=f;var Ka,Ib,jb,ub;Ka=f;a.substr(f,7).toLowerCase()===zd?(Ib=a.substr(f,7),f+=7):(Ib=d,0===x&&k(Ad));Ib!==d?(jb=f,x++,ub=v(),x--,ub===d?jb=void 0:(f=jb,jb=d),jb!==d?Ka=Ib="EXTRACT":(f=Ka,Ka=d)):(f=Ka,Ka=d);hc=Ka;if(hc!==d)if(bb=z(),bb!==d)if(cb=ga(),cb!==d)if(db=z(),db!==d){var pa;pa=vc();pa===d&&(pa=wc(),pa===d&&(pa=xc(),pa===d&&(pa=yc(),pa===d&&(pa=zc(),pa===d&&(pa=Ga())))));ic=pa;ic!==d?(eb=z(),eb!==d?(fb=Aa(),fb!==d?(gb=z(),gb!==d?(jc=C(),jc!==d?(sb=z(),sb!==d?(tb=
ha(),tb!==d?R=hc={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:ic},jc]}}:(f=R,R=d)):(f=R,R=d)):(f=R,R=d)):(f=R,R=d)):(f=R,R=d)):(f=R,R=d)):(f=R,R=d)}else f=R,R=d;else f=R,R=d;else f=R,R=d;else f=R,R=d;b=R;if(b===d){var P,kc,vb,wb,xb,Jb,yb,zb,Ab,Kb,Bb,ia,Sa,lc,mc,nc;P=f;var La,Lb,kb,Cb;La=f;a.substr(f,9).toLowerCase()===Bd?(Lb=a.substr(f,9),f+=9):(Lb=d,0===x&&k(Cd));Lb!==d?(kb=f,x++,Cb=v(),x--,Cb===d?kb=void 0:(f=kb,kb=d),kb!==d?La=Lb="SUBSTRING":(f=La,La=d)):(f=
La,La=d);kc=La;if(kc!==d)if(vb=z(),vb!==d)if(wb=ga(),wb!==d)if(xb=z(),xb!==d)if(Jb=C(),Jb!==d)if(yb=z(),yb!==d)if(zb=Aa(),zb!==d)if(Ab=z(),Ab!==d)if(Kb=C(),Kb!==d)if(Bb=z(),Bb!==d){ia=f;var Ma,Mb,lb,Ac;Ma=f;a.substr(f,3).toLowerCase()===Dd?(Mb=a.substr(f,3),f+=3):(Mb=d,0===x&&k(Ed));Mb!==d?(lb=f,x++,Ac=v(),x--,Ac===d?lb=void 0:(f=lb,lb=d),lb!==d?Ma=Mb="FOR":(f=Ma,Ma=d)):(f=Ma,Ma=d);Sa=Ma;Sa!==d?(lc=z(),lc!==d?(mc=C(),mc!==d?(nc=z(),nc!==d?ia=Sa=[Sa,lc,mc,nc]:(f=ia,ia=d)):(f=ia,ia=d)):(f=ia,ia=d)):
(f=ia,ia=d);ia===d&&(ia=null);ia!==d?(Sa=ha(),Sa!==d?P=kc={type:"function",name:"substring",args:{type:"expr_list",value:ia?[Jb,Kb,ia[2]]:[Jb,Kb]}}:(f=P,P=d)):(f=P,P=d)}else f=P,P=d;else f=P,P=d;else f=P,P=d;else f=P,P=d;else f=P,P=d;else f=P,P=d;else f=P,P=d;else f=P,P=d;else f=P,P=d;else f=P,P=d;b=P;if(b===d){var J,Ta,Nb,Ob,Pb,qa,Qb,Ua,Rb,Sb,Bc,oc,Cc,Dc;J=f;Ta=tc();Ta!==d?(Nb=z(),Nb!==d?(Ob=ga(),Ob!==d?(Pb=z(),Pb!==d?(qa=na(),qa===d&&(qa=null),qa!==d?(Qb=z(),Qb!==d?(Ua=C(),Ua!==d?(Rb=z(),Rb!==d?
(Sb=Aa(),Sb!==d?(Bc=z(),Bc!==d?(oc=C(),oc!==d?(Cc=z(),Cc!==d?(Dc=ha(),Dc!==d?J=Ta={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==qa?"BOTH":qa},Ua,oc]}}:(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d);J===d&&(J=f,Ta=tc(),Ta!==d?(Nb=z(),Nb!==d?(Ob=ga(),Ob!==d?(Pb=z(),Pb!==d?(qa=na(),qa===d&&(qa=null),qa!==d?(Qb=z(),Qb!==d?(Ua=C(),Ua!==d?(Rb=z(),Rb!==d?(Sb=ha(),Sb!==d?
J=Ta={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==qa?"BOTH":qa},Ua]}}:(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d));b=J;if(b===d){var S,pc,Ec,Fc,Gc,qc,Hc,Ic,Jc,rc,Kc,Lc;S=f;var Na,Tb,mb,Mc;Na=f;a.substr(f,8).toLowerCase()===Fd?(Tb=a.substr(f,8),f+=8):(Tb=d,0===x&&k(Gd));Tb!==d?(mb=f,x++,Mc=v(),x--,Mc===d?mb=void 0:(f=mb,mb=d),mb!==d?Na=Tb="POSITION":(f=Na,Na=d)):(f=Na,Na=d);pc=Na;pc!==d?(Ec=z(),Ec!==d?(Fc=
ga(),Fc!==d?(Gc=z(),Gc!==d?(qc=C(),qc!==d?(Hc=z(),Hc!==d?(Ic=ja(),Ic!==d?(Jc=z(),Jc!==d?(rc=C(),rc!==d?(Kc=z(),Kc!==d?(Lc=ha(),Lc!==d?S=pc={type:"function",name:"position",args:{type:"expr_list",value:[qc,rc]}}:(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d);b=S;if(b===d){var aa,Ub,Nc,Oc,Pc,Va,Qc,Rc;aa=f;var ra,nb,ob,wa;ra=f;ra=nb=g();if(ra===d)if(ra=f,96===a.charCodeAt(f)?(nb=Sc,f++):(nb=d,0===x&&k(Tc)),nb!==d){ob=[];Uc.test(a.charAt(f))?
(wa=a.charAt(f),f++):(wa=d,0===x&&k(Vc));if(wa!==d)for(;wa!==d;)ob.push(wa),Uc.test(a.charAt(f))?(wa=a.charAt(f),f++):(wa=d,0===x&&k(Vc));else ob=d;ob!==d?(96===a.charCodeAt(f)?(wa=Sc,f++):(wa=d,0===x&&k(Tc)),wa!==d?ra=nb=ob.join(""):(f=ra,ra=d)):(f=ra,ra=d)}else f=ra,ra=d;Ub=ra;Ub!==d?(Nc=z(),Nc!==d?(Oc=ga(),Oc!==d?(Pc=z(),Pc!==d?(Va=y(),Va===d&&(Va=null),Va!==d?(Qc=z(),Qc!==d?(Rc=ha(),Rc!==d?aa=Ub={type:"function",name:Ub,args:Va?Va:{type:"expr_list",value:[]}}:(f=aa,aa=d)):(f=aa,aa=d)):(f=aa,aa=
d)):(f=aa,aa=d)):(f=aa,aa=d)):(f=aa,aa=d)):(f=aa,aa=d);b=aa;if(b===d){var Vb,L,Wa,Wb,Xa,Xb,Da,sa,pb,Wc,Xc;L=f;Wa=Db();if(Wa!==d)if(Wb=z(),Wb!==d)if(Xa=C(),Xa!==d)if(Xb=z(),Xb!==d){Da=[];for(sa=U();sa!==d;)Da.push(sa),sa=U();Da!==d?(sa=z(),sa!==d?(pb=Eb(),pb!==d?L=Wa={type:"case_expression",format:"simple",operand:Xa,clauses:Da,else:null}:(f=L,L=d)):(f=L,L=d)):(f=L,L=d)}else f=L,L=d;else f=L,L=d;else f=L,L=d;else f=L,L=d;if(L===d)if(L=f,Wa=Db(),Wa!==d)if(Wb=z(),Wb!==d)if(Xa=C(),Xa!==d)if(Xb=z(),Xb!==
d){Da=[];for(sa=U();sa!==d;)Da.push(sa),sa=U();Da!==d?(sa=z(),sa!==d?(pb=ua(),pb!==d?(Wc=z(),Wc!==d?(Xc=Eb(),Xc!==d?L=Wa={type:"case_expression",format:"simple",operand:Xa,clauses:Da,else:pb.value}:(f=L,L=d)):(f=L,L=d)):(f=L,L=d)):(f=L,L=d)):(f=L,L=d)}else f=L,L=d;else f=L,L=d;else f=L,L=d;else f=L,L=d;Vb=L;if(Vb===d){var O,Ya,Yb,Ea,ta,qb,Yc,Zc;O=f;Ya=Db();if(Ya!==d)if(Yb=z(),Yb!==d){Ea=[];for(ta=Y();ta!==d;)Ea.push(ta),ta=Y();Ea!==d?(ta=z(),ta!==d?(qb=Eb(),qb!==d?O=Ya={type:"case_expression",format:"searched",
clauses:Ea,else:null}:(f=O,O=d)):(f=O,O=d)):(f=O,O=d)}else f=O,O=d;else f=O,O=d;if(O===d)if(O=f,Ya=Db(),Ya!==d)if(Yb=z(),Yb!==d){Ea=[];for(ta=Y();ta!==d;)Ea.push(ta),ta=Y();Ea!==d?(ta=z(),ta!==d?(qb=ua(),qb!==d?(Yc=z(),Yc!==d?(Zc=Eb(),Zc!==d?O=Ya={type:"case_expression",format:"searched",clauses:Ea,else:qb.value}:(f=O,O=d)):(f=O,O=d)):(f=O,O=d)):(f=O,O=d)):(f=O,O=d)}else f=O,O=d;else f=O,O=d;Vb=O}b=Vb;if(b===d){var rb,Oa,sc,Zb,$b;Oa=f;sc=t();if(sc!==d){Zb=[];for($b=V();$b!==d;)Zb.push($b),$b=V();
Zb!==d?Oa=sc+=Zb.join(""):(f=Oa,Oa=d)}else f=Oa,Oa=d;rb=Oa;rb!==d&&(rb={type:"column_ref",table:"",column:rb});b=rb;b===d&&(b=ca(),b===d&&(b=f,e=ga(),e!==d?(c=z(),c!==d?(h=C(),h!==d?(l=z(),l!==d?(m=ha(),m!==d?(h.paren=!0,b=e=h):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)))}}}}}}}return b}function g(){var a,b,e,c;a=f;b=t();if(b!==d){e=[];for(c=v();c!==d;)e.push(c),c=v();e!==d?a=b+=e.join(""):(f=a,a=d)}else f=a,a=d;return a}function t(){var b;Hd.test(a.charAt(f))?(b=a.charAt(f),f++):(b=d,
0===x&&k(Id));return b}function v(){var b;Jd.test(a.charAt(f))?(b=a.charAt(f),f++):(b=d,0===x&&k(Kd));return b}function V(){var b;Ld.test(a.charAt(f))?(b=a.charAt(f),f++):(b=d,0===x&&k(Md));return b}function ca(){var b,e,c;b=f;64===a.charCodeAt(f)?(e=Nd,f++):(e=d,0===x&&k(Od));e!==d?(c=g(),c!==d?b=e=[e,c]:(f=b,b=d)):(f=b,b=d);b!==d&&(b={type:"param",value:b[1]});return b}function na(){var b,e,c;b=f;a.substr(f,7).toLowerCase()===Pd?(e=a.substr(f,7),f+=7):(e=d,0===x&&k(Qd));e!==d?(e=f,x++,c=v(),x--,
c===d?e=void 0:(f=e,e=d),e!==d?b="LEADING":(f=b,b=d)):(f=b,b=d);b===d&&(b=f,a.substr(f,8).toLowerCase()===Rd?(e=a.substr(f,8),f+=8):(e=d,0===x&&k(Sd)),e!==d?(e=f,x++,c=v(),x--,c===d?e=void 0:(f=e,e=d),e!==d?b="TRAILING":(f=b,b=d)):(f=b,b=d),b===d&&(b=f,a.substr(f,4).toLowerCase()===Td?(e=a.substr(f,4),f+=4):(e=d,0===x&&k(Ud)),e!==d?(e=f,x++,c=v(),x--,c===d?e=void 0:(f=e,e=d),e!==d?b="BOTH":(f=b,b=d)):(f=b,b=d)));return b}function fa(){var b,e,c;b=f;var g,h;e=f;c=K();c!==d?(g=z(),g!==d?(g=ga(),g!==
d?(g=z(),g!==d?(g=A(),g!==d?(h=z(),h!==d?(h=ha(),h!==d?e=c={type:"interval-period",period:c.value,precision:g,secondary:null}:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d);e===d&&(e=f,c=K(),c!==d&&(c=sb(c)),e=c);if(e!==d)if(c=z(),c!==d)if(c=f,a.substr(f,2).toLowerCase()===Vd?(g=a.substr(f,2),f+=2):(g=d,0===x&&k(Wd)),g!==d?(g=f,x++,h=v(),x--,h===d?g=void 0:(f=g,g=d),g!==d?c="TO":(f=c,c=d)):(f=c,c=d),c!==d)if(c=z(),c!==d){var l;c=f;g=K();g!==d&&(g={type:"interval-period",
period:g.value,precision:null,secondary:null});c=g;c===d&&(c=f,g=Ga(),g!==d?(g=z(),g!==d?(g=ga(),g!==d?(g=z(),g!==d?(g=A(),g!==d?(h=z(),h!==d?(h=Ba(),h!==d?(h=z(),h!==d?(h=n(),h!==d?(l=z(),l!==d?(l=ha(),l!==d?c=g=tb(g,h):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d),c===d&&(c=f,g=Ga(),g!==d?(g=z(),g!==d?(g=ga(),g!==d?(g=z(),g!==d?(g=A(),g!==d?(h=z(),h!==d?(h=ha(),h!==d?c=g={type:"interval-period",period:"second",precision:g,
secondary:null}:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d),c===d&&(c=f,g=Ga(),g!==d&&(g={type:"interval-period",period:"second",precision:null,secondary:null}),c=g)));c!==d?b=e={type:"interval-qualifier",start:e,end:c}:(f=b,b=d)}else f=b,b=d;else f=b,b=d;else f=b,b=d;else f=b,b=d;b===d&&(b=f,c=K(),c!==d?(e=z(),e!==d?(e=ga(),e!==d?(e=z(),e!==d?(e=n(),e!==d?(g=z(),g!==d?(g=ha(),g!==d?b=c={type:"interval-period",period:c.value,precision:e,secondary:null}:(f=b,b=d)):(f=
b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d),b===d&&(b=f,c=K(),c!==d&&(c=sb(c)),b=c,b===d&&(b=f,c=Ga(),c!==d?(e=z(),e!==d?(e=ga(),e!==d?(e=z(),e!==d?(e=A(),e!==d?(g=z(),g!==d?(g=Ba(),g!==d?(c=z(),c!==d?(c=n(),c!==d?(g=z(),g!==d?(g=ha(),g!==d?b=c=tb(e,c):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d),b===d&&(b=f,c=Ga(),c!==d?(e=z(),e!==d?(e=ga(),e!==d?(e=z(),e!==d?(e=n(),e!==d?(g=z(),g!==d?(g=ha(),g!==d?b=c={type:"interval-period",
period:"second",precision:e,secondary:null}:(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d),b===d&&(b=f,c=Ga(),c!==d&&(c={type:"interval-period",period:"second",precision:null,secondary:null}),b=c)))));return b}function K(){var a;a=f;a=xc();a!==d&&(a={type:"string",value:"day"});a===d&&(a=f,a=yc(),a!==d&&(a={type:"string",value:"hour"}),a===d&&(a=f,a=zc(),a!==d&&(a={type:"string",value:"minute"}),a===d&&(a=f,a=wc(),a!==d&&(a={type:"string",value:"month"}),a===d&&(a=f,a=
vc(),a!==d&&(a={type:"string",value:"year"})))));return a}function n(){var a;a=Q();a!==d&&(a=parseFloat(a));return a}function A(){var a;a=Q();a!==d&&(a=parseFloat(a));return a}function H(){var a;a=X();a===d&&(a=ca());return a}function X(){var b,e,c;b=f;39===a.charCodeAt(f)?(e=ub,f++):(e=d,0===x&&k(vb));e===d&&(a.substr(f,2)===wb?(e=wb,f+=2):(e=d,0===x&&k(Xd)));if(e!==d){e=[];c=f;a.substr(f,2)===Fa?(c=Fa,f+=2):(c=d,0===x&&k(xb));c!==d&&(c="'");c===d&&(yb.test(a.charAt(f))?(c=a.charAt(f),f++):(c=d,
0===x&&k(zb)));for(;c!==d;)e.push(c),c=f,a.substr(f,2)===Fa?(c=Fa,f+=2):(c=d,0===x&&k(xb)),c!==d&&(c="'"),c===d&&(yb.test(a.charAt(f))?(c=a.charAt(f),f++):(c=d,0===x&&k(zb)));e!==d?(39===a.charCodeAt(f)?(c=ub,f++):(c=d,0===x&&k(vb)),c!==d?b=e={type:"string",value:e.join("")}:(f=b,b=d)):(f=b,b=d)}else f=b,b=d;return b}function Y(){var a,b,c;a=f;b=Za();b!==d?(b=z(),b!==d?(b=C(),b!==d?(c=z(),c!==d?(c=$a(),c!==d?(c=z(),c!==d?(c=C(),c!==d?a=b={type:"when_clause",operand:b,value:c}:(f=a,a=d)):(f=a,a=d)):
(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d);return a}function U(){var a,b,c;a=f;b=Za();b!==d?(b=z(),b!==d?(b=C(),b!==d?(c=z(),c!==d?(c=$a(),c!==d?(c=z(),c!==d?(c=C(),c!==d?a=b={type:"when_clause",operand:b,value:c}:(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d);return a}function ua(){var b,c;b=f;var e,g;c=f;a.substr(f,4).toLowerCase()===Yd?(e=a.substr(f,4),f+=4):(e=d,0===x&&k(Zd));e!==d?(e=f,x++,g=v(),x--,g===d?e=void 0:(f=e,e=d),e!==d?c="ELSE":(f=c,c=d)):(f=
c,c=d);c!==d?(c=z(),c!==d?(c=C(),c!==d?b={type:"else_clause",value:c}:(f=b,b=d)):(f=b,b=d)):(f=b,b=d);return b}function M(){var b,c,e;b=Q();b===d&&(b=f,45===a.charCodeAt(f)?(c=cc,f++):(c=d,0===x&&k(dc)),c===d&&(43===a.charCodeAt(f)?(c=ac,f++):(c=d,0===x&&k(bc))),c!==d?(e=Q(),e!==d?b=c=c[0]+e:(f=b,b=d)):(f=b,b=d));return b}function da(){var b,c;b=f;46===a.charCodeAt(f)?(c=$d,f++):(c=d,0===x&&k(ae));c!==d?(c=Q(),c===d&&(c=null),c!==d?b="."+(null!=c?c:""):(f=b,b=d)):(f=b,b=d);return b}function W(){var b,
c,e;c=b=f;be.test(a.charAt(f))?(e=a.charAt(f),f++):(e=d,0===x&&k(ce));e!==d?(de.test(a.charAt(f))?(e=a.charAt(f),f++):(e=d,0===x&&k(ee)),e===d&&(e=null),e!==d?c="e"+(null===e?"":e):(f=c,c=d)):(f=c,c=d);c!==d?(e=Q(),e!==d?b=c+e:(f=b,b=d)):(f=b,b=d);return b}function Q(){var a,b;a=[];b=T();if(b!==d)for(;b!==d;)a.push(b),b=T();else a=d;a!==d&&(a=a.join(""));return a}function T(){var b;fe.test(a.charAt(f))?(b=a.charAt(f),f++):(b=d,0===x&&k(ge));return b}function ja(){var b,c,e;b=f;a.substr(f,2).toLowerCase()===
he?(c=a.substr(f,2),f+=2):(c=d,0===x&&k(ie));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="IN":(f=b,b=d)):(f=b,b=d);return b}function ba(){var b,c,e;b=f;a.substr(f,2).toLowerCase()===je?(c=a.substr(f,2),f+=2):(c=d,0===x&&k(ke));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="IS":(f=b,b=d)):(f=b,b=d);return b}function ea(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===le?(c=a.substr(f,4),f+=4):(c=d,0===x&&k(me));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="LIKE":
(f=b,b=d)):(f=b,b=d);return b}function oa(){var b,c,e;b=f;a.substr(f,3).toLowerCase()===ne?(c=a.substr(f,3),f+=3):(c=d,0===x&&k(oe));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="NOT":(f=b,b=d)):(f=b,b=d);return b}function ka(){var b,c,e;b=f;a.substr(f,3).toLowerCase()===pe?(c=a.substr(f,3),f+=3):(c=d,0===x&&k(qe));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="AND":(f=b,b=d)):(f=b,b=d);return b}function la(){var b,c,e;b=f;a.substr(f,2).toLowerCase()===re?(c=a.substr(f,2),
f+=2):(c=d,0===x&&k(se));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="OR":(f=b,b=d)):(f=b,b=d);return b}function ma(){var b,c,e;b=f;a.substr(f,7).toLowerCase()===te?(c=a.substr(f,7),f+=7):(c=d,0===x&&k(ue));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="BETWEEN":(f=b,b=d)):(f=b,b=d);return b}function Aa(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===ve?(c=a.substr(f,4),f+=4):(c=d,0===x&&k(we));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="FROM":(f=b,b=d)):(f=
b,b=d);return b}function tc(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===xe?(c=a.substr(f,4),f+=4):(c=d,0===x&&k(ye));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="TRIM":(f=b,b=d)):(f=b,b=d);return b}function uc(){var b,c,e;b=f;a.substr(f,8).toLowerCase()===ze?(c=a.substr(f,8),f+=8):(c=d,0===x&&k(Ae));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="INTERVAL":(f=b,b=d)):(f=b,b=d);return b}function vc(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===Be?(c=a.substr(f,4),f+=4):(c=
d,0===x&&k(Ce));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="YEAR":(f=b,b=d)):(f=b,b=d);return b}function wc(){var b,c,e;b=f;a.substr(f,5).toLowerCase()===De?(c=a.substr(f,5),f+=5):(c=d,0===x&&k(Ee));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="MONTH":(f=b,b=d)):(f=b,b=d);return b}function xc(){var b,c,e;b=f;a.substr(f,3).toLowerCase()===Fe?(c=a.substr(f,3),f+=3):(c=d,0===x&&k(Ge));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="DAY":(f=b,b=d)):(f=b,b=d);return b}
function yc(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===He?(c=a.substr(f,4),f+=4):(c=d,0===x&&k(Ie));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="HOUR":(f=b,b=d)):(f=b,b=d);return b}function zc(){var b,c,e;b=f;a.substr(f,6).toLowerCase()===Je?(c=a.substr(f,6),f+=6):(c=d,0===x&&k(Ke));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="MINUTE":(f=b,b=d)):(f=b,b=d);return b}function Ga(){var b,c,e;b=f;a.substr(f,6).toLowerCase()===Le?(c=a.substr(f,6),f+=6):(c=d,0===x&&k(Me));
c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="SECOND":(f=b,b=d)):(f=b,b=d);return b}function Db(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===Ne?(c=a.substr(f,4),f+=4):(c=d,0===x&&k(Oe));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="CASE":(f=b,b=d)):(f=b,b=d);return b}function Eb(){var b,c,e;b=f;a.substr(f,3).toLowerCase()===Pe?(c=a.substr(f,3),f+=3):(c=d,0===x&&k(Qe));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="END":(f=b,b=d)):(f=b,b=d);return b}function Za(){var b,
c,e;b=f;a.substr(f,4).toLowerCase()===Re?(c=a.substr(f,4),f+=4):(c=d,0===x&&k(Se));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="WHEN":(f=b,b=d)):(f=b,b=d);return b}function $a(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===Te?(c=a.substr(f,4),f+=4):(c=d,0===x&&k(Ue));c!==d?(c=f,x++,e=v(),x--,e===d?c=void 0:(f=c,c=d),c!==d?b="THEN":(f=b,b=d)):(f=b,b=d);return b}function Ba(){var b;44===a.charCodeAt(f)?(b=Ve,f++):(b=d,0===x&&k(We));return b}function ga(){var b;40===a.charCodeAt(f)?(b=Xe,
f++):(b=d,0===x&&k(Ye));return b}function ha(){var b;41===a.charCodeAt(f)?(b=Ze,f++):(b=d,0===x&&k($e));return b}function z(){var a,b;a=[];for(b=Ab();b!==d;)a.push(b),b=Ab();return a}function Ab(){var b;af.test(a.charAt(f))?(b=a.charAt(f),f++):(b=d,0===x&&k(bf));return b}function cb(a,b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function Ca(a,b){for(var c=0;c<b.length;c++)a=cb(b[c][1],a,b[c][3]);return a}r=void 0!==r?r:{};var d={},Bb={start:u},Cb=u,$c=
"!",ad=p("!",!1),ab="\x3d",bb=p("\x3d",!1),db="\x3e\x3d",dd=p("\x3e\x3d",!1),ed="\x3e",fd=p("\x3e",!1),eb="\x3c\x3d",gd=p("\x3c\x3d",!1),fb="\x3c\x3e",hd=p("\x3c\x3e",!1),id="\x3c",jd=p("\x3c",!1),gb="!\x3d",kd=p("!\x3d",!1),ac="+",bc=p("+",!1),cc="-",dc=p("-",!1),ld="*",md=p("*",!1),nd="/",od=p("/",!1),Hd=/^[A-Za-z_\x80-\uFFFF]/,Id=b([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Jd=/^[A-Za-z0-9_]/,Kd=b([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Ld=/^[A-Za-z0-9_.\x80-\uFFFF]/,Md=b([["A","Z"],
["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),Nd="@",Od=p("@",!1),sb=function(a){return{type:"interval-period",period:a.value,precision:null,secondary:null}},tb=function(a,b){return{type:"interval-period",period:"second",precision:a,secondary:b}},ub="'",vb=p("'",!1),wb="N'",Xd=p("N'",!1),Fa="''",xb=p("''",!1),yb=/^[^']/,zb=b(["'"],!0,!1),$d=".",ae=p(".",!1),fe=/^[0-9]/,ge=b([["0","9"]],!1,!1),be=/^[eE]/,ce=b(["e","E"],!1,!1),de=/^[+\-]/,ee=b(["+","-"],!1,!1),td="null",ud=p("NULL",!0),pd=
"true",qd=p("TRUE",!0),rd="false",sd=p("FALSE",!0),he="in",ie=p("IN",!0),je="is",ke=p("IS",!0),le="like",me=p("LIKE",!0),bd="escape",cd=p("ESCAPE",!0),ne="not",oe=p("NOT",!0),pe="and",qe=p("AND",!0),re="or",se=p("OR",!0),te="between",ue=p("BETWEEN",!0),ve="from",we=p("FROM",!0),Dd="for",Ed=p("FOR",!0),Bd="substring",Cd=p("SUBSTRING",!0),zd="extract",Ad=p("EXTRACT",!0),xe="trim",ye=p("TRIM",!0),Fd="position",Gd=p("POSITION",!0),xd="timestamp",yd=p("TIMESTAMP",!0),vd="date",wd=p("DATE",!0),Pd="leading",
Qd=p("LEADING",!0),Rd="trailing",Sd=p("TRAILING",!0),Td="both",Ud=p("BOTH",!0),Vd="to",Wd=p("TO",!0),ze="interval",Ae=p("INTERVAL",!0),Be="year",Ce=p("YEAR",!0),De="month",Ee=p("MONTH",!0),Fe="day",Ge=p("DAY",!0),He="hour",Ie=p("HOUR",!0),Je="minute",Ke=p("MINUTE",!0),Le="second",Me=p("SECOND",!0),Ne="case",Oe=p("CASE",!0),Pe="end",Qe=p("END",!0),Re="when",Se=p("WHEN",!0),Te="then",Ue=p("THEN",!0),Yd="else",Zd=p("ELSE",!0),Ve=",",We=p(",",!1),Xe="(",Ye=p("(",!1),Ze=")",$e=p(")",!1),af=/^[ \t\n\r]/,
bf=b([" ","\t","\n","\r"],!1,!1),Sc="`",Tc=p("`",!1),Uc=/^[^`]/,Vc=b(["`"],!0,!1),f=0,Ha=[{line:1,column:1}],Z=0,Pa=[],x=0,za;if("startRule"in r){if(!(r.startRule in Bb))throw Error("Can't start parsing from rule \""+r.startRule+'".');Cb=Bb[r.startRule]}za=Cb();if(za!==d&&f===a.length)return za;za!==d&&f<a.length&&k({type:"end"});throw function(a,b,c){return new B(B.buildMessage(a,b),a,b,c)}(Pa,Z<a.length?a.charAt(Z):null,Z<a.length?l(Z,Z+1):l(Z,Z));}}})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require",
"exports"],function(B,a){Object.defineProperty(a,"__esModule",{value:!0});a.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,
supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/iteratorUtils ../../../core/maybe ../../../core/promiseUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils".split(" "),
function(B,a,r,p,b,c,l,k,u,y,C,w,G,E,I,D){Object.defineProperty(a,"__esModule",{value:!0});B=function(){function a(a,b,c){this.items=a;this.queryGeometry=b;this.definitionExpression=c.definitionExpression;this.geometryType=c.geometryType;this.hasM=c.hasM;this.hasZ=c.hasZ;this.objectIdField=c.objectIdField;this.spatialReference=c.spatialReference;this.fieldsIndex=c.fieldsIndex;this.timeInfo=c.timeInfo;this.featureAdapter=c.featureAdapter}Object.defineProperty(a.prototype,"size",{get:function(){return this.items.length},
enumerable:!0,configurable:!0});a.prototype.createQueryResponse=function(a){var b;b=a.outStatistics?a.outStatistics.some(function(a){return"exceedslimit"===a.statisticType})?this._createExceedsLimitQueryResponse(a):this._createStatisticsQueryResponse(a):this._createFeatureQueryResponse(a);a.returnQueryGeometry&&(y.isValid(a.outSR)&&!y.equals(this.queryGeometry.spatialReference,a.outSR)?b.queryGeometry=D.cleanFromGeometryEngine(r({spatialReference:a.outSR},E.project(this.queryGeometry,this.queryGeometry.spatialReference,
a.outSR))):b.queryGeometry=D.cleanFromGeometryEngine(r({spatialReference:a.outSR},this.queryGeometry)));return b};a.prototype.executeAttributesQuery=function(b){var c=G.getWhereClause(b.where,this.fieldsIndex);if(!c)return k.resolve(this);if(c.isStandardized){for(var h=0,e=[],g=0,l=this.items;g<l.length;g++){var m=l[g];c.testFeature(m,this.featureAdapter)&&(e[h++]=m)}c=new a(e,this.queryGeometry,this);c.definitionExpression=b.where;return k.resolve(c)}return k.reject(new TypeError("Where clause is not standardized"))};
a.prototype.executeObjectIdsQuery=function(b){if(!b.objectIds||!b.objectIds.length)return k.resolve(this);var l=c.SetFromValues(b.objectIds),h=this.featureAdapter.getObjectId;return k.resolve(new a(this.items.filter(function(a){return l.has(h(a))}),this.queryGeometry,this))};a.prototype.executeTimeQuery=function(b){b=I.getTimeOperator(this.timeInfo,b.timeExtent,this.featureAdapter);if(!l.isSome(b))return k.resolve(this);b=this.items.filter(b);return k.resolve(new a(b,this.queryGeometry,this))};a.prototype.project=
function(c){return b(this,void 0,void 0,function(){var b,h,e,g=this;return p(this,function(k){switch(k.label){case 0:if(!c||y.equals(this.spatialReference,c))return[2,this];b=this.featureAdapter;return[4,E.projectMany(this.items.map(function(a){return D.getGeometry(g,b.getGeometry(a))}),this.spatialReference,c)];case 1:return h=k.sent(),e=h.map(function(a,c){return b.cloneWithGeometry(g.items[c],C.convertFromGeometry(a,g.hasZ,g.hasM))}),[2,new a(e,this.queryGeometry,{definitionExpression:this.definitionExpression,
geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:c,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}})})};a.prototype._createFeatureQueryResponse=function(a){var b=this,c=this.items,e=this.geometryType,g=this.hasM,k=this.hasZ,l=this.objectIdField,m=this.spatialReference,p=a.outFields,r=a.outSR,y=a.quantizationParameters,w=a.resultRecordCount,n=a.resultOffset,A=!1;null!=w&&null!=n&&(w=n+w,A=c.length>
w,c=c.slice(n,Math.min(c.length,w)));return{exceededTransferLimit:A,features:this._createFeatures(a,c),fields:p&&p.map(function(a){return b.fieldsIndex.get(a)}),geometryType:e,hasM:g,hasZ:k,objectIdFieldName:l,spatialReference:D.cleanFromGeometryEngine(r?r:m),transform:y&&u.toQuantizationTransform(y)||null}};a.prototype._createFeatures=function(a,b){var c=new w.default(a,this.featureAdapter,this.fieldsIndex),e=a.quantizationParameters,g=a.returnGeometry,k=a.returnCentroid,l=a.maxAllowableOffset,m=
a.orderByFields;a=[];var p=0;if(b.length&&m&&m.length){var m=m[0].split(" "),q=m[0],r=this.fieldsIndex.get(q),y="DESC"===m[1];b.sort(function(a,b){a=c.getFieldValue(a,q,r);b=c.getFieldValue(b,q,r);if("number"===typeof a&&"number"===typeof b)return y?b-a:a-b;if("string"===typeof a&&"string"===typeof b)return a=a.toUpperCase(),b=b.toUpperCase(),(y?a>b:a<b)?-1:(y?a<b:a>b)?1:0})}if(g||k)if(e=u.toQuantizationTransform(e),g&&!k)for(k=0;k<b.length;k++)g=b[k],a[p++]={attributes:c.getAttributes(g),geometry:D.getGeometry(this,
this.featureAdapter.getGeometry(g),l,e)};else if(!g&&k)for(l=0;l<b.length;l++)g=b[l],a[p++]={attributes:c.getAttributes(g),centroid:D.transformCentroid(this,this.featureAdapter.getCentroid(g,this),e)};else for(k=0;k<b.length;k++)g=b[k],a[p++]={attributes:c.getAttributes(g),centroid:D.transformCentroid(this,this.featureAdapter.getCentroid(g,this),e),geometry:D.getGeometry(this,this.featureAdapter.getGeometry(g),l,e)};else for(l=0;l<b.length;l++)g=b[l],(g=c.getAttributes(g))&&(a[p++]={attributes:g});
return a};a.prototype._createExceedsLimitQueryResponse=function(a){var b=!1,c=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,g=0;for(a=a.outStatistics;g<a.length;g++){var k=a[g];if("exceedslimit"===k.statisticType){c=null!=k.maxPointCount?k.maxPointCount:Number.POSITIVE_INFINITY;e=null!=k.maxRecordCount?k.maxRecordCount:Number.POSITIVE_INFINITY;b=null!=k.maxVertexCount?k.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)b=this.items.length>
c;else if(this.items.length>e)b=!0;else var c=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter,b=this.items.reduce(function(a,b){b=l.getGeometry(b);return a+(b&&b.coords.length||0)},0)/c>b;return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(b)}}]}};a.prototype._createStatisticsQueryResponse=function(a){var b=new w.default(a,this.featureAdapter,this.fieldsIndex),
c=a.outStatistics,e=[],g=[],k=a.groupByFieldsForStatistics;a=a.having;for(var l=k&&k.length,k=l&&k[0],m=this.fieldsIndex.get(k),p=!m,u={},r={},y={},n={attributes:{}},A=0;A<c.length;A++){var C=c[A],E=C.outStatisticFieldName,D=C.statisticType,C="exceedslimit"!==D?C.onStatisticField:void 0,G=this.fieldsIndex.get(C),B=l&&(C===k||p)&&"count"===D;if(l){u[C]||(u[C]=this._calculateUniqueValues(b,k,m));var F=u[C],I;for(I in F){var W=F[I],Q=W.count,T=W.data,ja=W.items;if(!a||b.validateItems(ja,a)){var W=r[T]||
{attributes:{}},ba=null;B?ba=Q:(Q=this._calculateStatistics(ja,b,C,G),ja="var"===D?"variance":D,ba=Q[ja]);W.attributes[E]=ba;W.attributes[p?"EXPR_1":k]=T;r[T]=W}}}else y[C]||(y[C]=this._calculateStatistics(this.items,b,C,G)),Q=y[C],ja="var"===D?"variance":D,n.attributes[E]=Q[ja];g.push({name:E,alias:E,type:"esriFieldTypeDouble"})}if(l)for(var ea in r)e.push(r[ea]);else e.push(n);return{fields:g,features:e}};a.prototype._calculateStatistics=function(a,b,c,e){for(var g=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,
k=null,l=null,m=null,p=null,q=[],u=0,n=0;n<a.length;n++){var A=b.getFieldValue(a[n],c,e);"string"===typeof A?u++:null==A||isNaN(A)||(k+=A,g=Math.min(g,A),h=Math.max(h,A),q.push(A),u++)}if(u){l=k/u;for(b=a=0;b<q.length;b++)A=q[b],a+=Math.pow(A-l,2);p=1<u?a/(u-1):0;m=Math.sqrt(p)}else h=g=null;return{avg:l,count:u,max:h,min:g,stddev:m,sum:k,variance:p}};a.prototype._calculateUniqueValues=function(a,b,c){for(var e={},g=0,h=this.items;g<h.length;g++){var k=h[g],l=a.getFieldValue(k,b,c);if(null==l||"string"===
typeof l&&""===l.trim())l=null;null==e[l]?e[l]={count:1,data:l,items:[k]}:(e[l].count++,e[l].items.push(k))}return e};return a}();a.default=B})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["require","exports","../../../core/maybe","./attributeSupport"],function(B,a,r,p){Object.defineProperty(a,"__esModule",{value:!0});B=function(){function a(a,b,k){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=a.returnDistinctValues;this.fieldsIndex=k;
this.featureAdapter=b;if((a=a.outFields)&&-1===a.indexOf("*")){this.outFields=a;for(var c=b=0;c<a.length;c++){var l=a[c],r=p.getExpressionFromFieldName(l),w=this.fieldsIndex.get(r),r=w?null:p.getWhereClause(r,k),w=w?w.name:p.getAliasFromFieldName(l)||"FIELD_EXP_"+b++;this._fieldDataCache.set(l,{alias:w,clause:r})}}}a.prototype.getAttributes=function(a){a=this._processAttributesForOutFields(a);return this._processAttributesForDistinctValues(a)};a.prototype.getFieldValue=function(a,b,k){var c=k?k.name:
b,l=null;this._fieldDataCache.has(c)?l=this._fieldDataCache.get(c).clause:k||(l=p.getWhereClause(b,this.fieldsIndex),this._fieldDataCache.set(c,{alias:c,clause:l}));return k?this.featureAdapter.getAttribute(a,c):l.calculateValue(a,this.featureAdapter)};a.prototype.validateItem=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:p.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testFeature(a,this.featureAdapter)};a.prototype.validateItems=
function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:p.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testSet(a,this.featureAdapter)};a.prototype._processAttributesForOutFields=function(a){var b=this.outFields;if(!b||!b.length)return this.featureAdapter.getAttributes(a);for(var c={},p=0;p<b.length;p++){var r=this._fieldDataCache.get(b[p]),C=r.alias,r=r.clause;c[C]=r?r.calculateValue(a,this.featureAdapter):this.featureAdapter.getAttribute(a,
C)}return c};a.prototype._processAttributesForDistinctValues=function(a){if(r.isNone(a)||!this.returnDistinctValues)return a;var b=this.outFields,c=[];if(b)for(var p=0;p<b.length;p++){var y=this._fieldDataCache.get(b[p]).alias;c.push(a[y])}else for(y in a)c.push(a[y]);b=(b||["*"]).join(",")+"\x3d"+c.join(",");c=this._returnDistinctMap.get(b)||0;this._returnDistinctMap.set(b,++c);return 1<c?null:a};return a}();a.default=B})},"esri/layers/graphics/data/timeSupport":function(){define(["require","exports"],
function(B,a){function r(a,c,l,k,p){if(null!=k&&null!=p&&k===p)return function(b){return k>=a.getAttribute(b,c)&&k<=a.getAttribute(b,l)};if(null!=k&&null!=p)return function(b){var r=a.getAttribute(b,c);b=a.getAttribute(b,l);return!(r>p||b<k)};if(null!=k)return function(b){return!(a.getAttribute(b,l)<k)};if(null!=p)return function(b){return!(a.getAttribute(b,c)>p)}}function p(a,c,l,k){if(null!=l&&null!=k&&l===k)return function(b){return a.getAttribute(b,c)===l};if(null!=l&&null!=k)return function(b){return a.getAttribute(b,
c)>=l&&a.getAttribute(b,c)<=k};if(null!=l)return function(b){return a.getAttribute(b,c)>=l};if(null!=k)return function(b){return a.getAttribute(b,c)<=k}}Object.defineProperty(a,"__esModule",{value:!0});a.getTimeExtent=function(a,c){if(!a)return null;var b=c.featureAdapter,k=a.startTimeField,p=a.endTimeField,r=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY;if(k&&p)c.forEach(function(a){var c=b.getAttribute(a,k);a=b.getAttribute(a,p);null==c||isNaN(c)||(r=Math.min(r,c));null==a||isNaN(a)||(C=Math.max(C,
a))});else{var w=k||p;c.forEach(function(a){a=b.getAttribute(a,w);null==a||isNaN(a)||(r=Math.min(r,a),C=Math.max(C,a))})}return{start:r,end:C}};a.getTimeOperator=function(a,c,l){if(!c||!a)return null;var b=a.startTimeField;a=a.endTimeField;if(!b&&!a)return null;var u=c.start;c=c.end;return null==u&&null==c?null:b&&a?r(l,b,a,u,c):p(l,b||a,u,c)}})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/jsonMap ../../../core/maybe ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),
function(B,a,r,p,b,c,l,k,u,y,C,w,G,E,I,D,F){function m(a,b,c){c&&(b=E.quantizeOptimizedGeometry(t,b,a.hasZ,a.hasM,"esriGeometryPoint",c));return E.convertToPoint(b,a.hasZ,a.hasM)}function q(b,e,g){return p(this,void 0,void 0,function(){var k,l,m,t,p,v;return r(this,function(n){switch(n.label){case 0:if(!b)return[2,null];k=b.where;b.where=k=k&&k.trim();if(!k||/^1 *= *1$/.test(k)||e&&e===k)b.where=null;return b.geometry?[4,h(b)]:[2,b];case 1:return l=n.sent(),b.distance=0,b.units=null,"esriSpatialRelEnvelopeIntersects"===
b.spatialRel&&(m=b.geometry.spatialReference,l=u.getGeometryExtent(l),l.spatialReference=m),b.geometry=l,[4,D.checkProjectionSupport(l.spatialReference,g)];case 2:return n.sent(),[4,C.normalizeCentralMeridian(y.fromJSON(l))];case 3:t=n.sent()[0];if(c.isNone(t))throw a.QUERY_ENGINE_EMPTY_RESULT;p=t.toJSON();return[4,D.project(p,p.spatialReference,g)];case 4:v=n.sent();if(!v)throw a.QUERY_ENGINE_EMPTY_RESULT;v.spatialReference=g;b.geometry=v;return[2,b]}})})}function h(a){return p(this,void 0,void 0,
function(){var b,c,g,h,m,t,p,v,q,u;return r(this,function(n){switch(n.label){case 0:b=a.geometry;c=a.distance;g=a.units;if(null==c)return[2,l.resolve(b)];h=b.spatialReference;m=g&&e.fromJSON(g)||k.getUnitString(h);t=h&&(w.isGeographic(h)||w.isWebMercator(h));if(!t)return[3,1];v=b;return[3,3];case 1:return[4,D.checkProjectionSupport(h,w.WGS84).then(function(){return D.project(b,w.WGS84)})];case 2:v=n.sent(),n.label=3;case 3:return p=v,[4,F.getGeodesicBufferOperator()];case 4:return q=n.sent(),u=q(p,
c,m),[2,u?u.toJSON():null]}})})}Object.defineProperty(a,"__esModule",{value:!0});var e=new b.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});a.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var g=new I.default,t=new I.default,v={esriGeometryPoint:E.convertToPoint,esriGeometryPolyline:E.convertToPolyline,esriGeometryPolygon:E.convertToPolygon,
esriGeometryMultipoint:E.convertToMultipoint};a.transformCentroid=m;a.getCentroid=function(a,b,c){if("esriGeometryPolygon"!==a.geometryType||!b||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=G.getCentroidOptimizedGeometry(new I.default,b.geometry,a.hasZ,a.hasM));return m(a,b.centroid,c)};a.getGeometry=function(a,b,c,e){b=b?"coords"in b?b:b.geometry:null;return b?c?(c=E.generalizeOptimizedGeometry(g,b,a.hasZ,a.hasM,a.geometryType,c),e&&(c=E.quantizeOptimizedGeometry(t,c,a.hasZ,a.hasM,
a.geometryType,e)),v[a.geometryType](c,a.hasZ,a.hasM)):e?(c=E.quantizeOptimizedGeometry(t,b,a.hasZ,a.hasM,a.geometryType,e),v[a.geometryType](c,a.hasZ,a.hasM)):v[a.geometryType](b,a.hasZ,a.hasM):null};a.normalizeQuery=function(a,b,c){return p(this,void 0,void 0,function(){var e,g,h,k,l;return r(this,function(n){e=a.outFields;g=a.orderByFields;h=a.groupByFieldsForStatistics;k=a.outStatistics;if(e)for(l=0;l<e.length;l++)e[l]=e[l].trim();if(g)for(l=0;l<g.length;l++)g[l]=g[l].trim();if(h)for(l=0;l<h.length;l++)h[l]=
h[l].trim();if(k)for(l=0;l<k.length;l++)k[l].onStatisticField&&(k[l].onStatisticField=k[l].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,q(a,b,c)]})})};a.normalizeFilter=function(a,b,c){return p(this,void 0,void 0,function(){return r(this,function(e){return[2,q(a,b,c)]})})};a.normalizeQueryLike=q;a.cleanFromGeometryEngine=function(a){return a&&V in a?JSON.parse(JSON.stringify(a,ca)):a};var V="_geVersion",ca=function(a,b){return a!==V?b:void 0}})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(B,a,r,p,b,c,l,k,u,y,C,w,G,E,I){function D(){return c.create(function(a){return B(["../../../geometry/geometryEngine"],a)})}Object.defineProperty(a,"__esModule",{value:!0});var F={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",
esriSpatialRelRelation:null},m={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},q={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},h={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,
esriGeometryPolygon:!0,esriGeometryEnvelope:!1};a.importGeometryEngine=D;a.getGeodesicBufferOperator=function(){return D().then(function(a){return a.geodesicBuffer})};a.getSpatialQueryOperator=function(a,b,h){if(u.isPolygon(b)&&"esriGeometryPoint"===h.geometryType&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a)){var e=w.convertFromPolygon(new G.default,b,!1,!1);return c.resolve(function(a){return C.polygonContainsPoint(e,!1,!1,a)})}if(u.isPolygon(b)&&"esriGeometryMultipoint"===h.geometryType){var g=
w.convertFromPolygon(new G.default,b,!1,!1);if("esriSpatialRelContains"===a)return c.resolve(function(a){return C.polygonContainsMultipoint(g,!1,!1,a,h.hasZ,h.hasM)})}if(u.isExtent(b)&&"esriGeometryPoint"===h.geometryType&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a))return c.resolve(function(a){return l.extentContainsPoint(b,I.getGeometry(h,a))});if(u.isExtent(b)&&"esriGeometryMultipoint"===h.geometryType&&"esriSpatialRelContains"===a)return c.resolve(function(a){return l.extentContainsMultipoint(b,
I.getGeometry(h,a))});if(u.isExtent(b)&&"esriSpatialRelIntersects"===a){var m=k.getExtentIntersector(h.geometryType);return c.resolve(function(a){return m(b,I.getGeometry(h,a))})}return D().then(function(c){var e=c[F[a]].bind(null,b);return function(a){return e(I.getGeometry(h,a))}})};a.checkSpatialQuerySupport=function(a,c,k){return p(this,void 0,void 0,function(){var e,g;return r(this,function(l){e=a.spatialRel;g=a.geometry;if(!g)return[2];if(!0!==m[e])throw new b("feature-store:unsupported-query",
"Unsupported query spatial relationship",{query:a});if(!y.isValid(g.spatialReference)||!y.isValid(k))return[2];if(!0!==q[u.getJsonType(g)])throw new b("feature-store:unsupported-query","Unsupported query geometry type",{query:a});if(!0!==h[c])throw new b("feature-store:unsupported-query","Unsupported layer geometry type",{query:a});return a.outSR?[2,E.checkProjectionSupport(a.geometry&&a.geometry.spatialReference,a.outSR)]:[2]})})};a.canQueryWithRBush=function(a){if(u.isExtent(a))return!0;if(u.isPolygon(a)){var b=
0;for(a=a.rings;b<a.length;b++){var c=a[b];if(5!==c.length||c[0][0]!==c[1][0]||c[0][0]!==c[4][0]||c[2][0]!==c[3][0]||c[0][1]!==c[3][1]||c[0][1]!==c[4][1]||c[1][1]!==c[2][1])return!1}return!0}return!1}})},"esri/layers/graphics/contains":function(){define(["require","exports"],function(B,a){function r(a,b,c,l,k){if(!a)return!1;b=b?c?4:3:c?3:2;c=a.coords;var p=!1,r=0,C=0;for(a=a.lengths;C<a.length;C++){for(var w=a[C],B=r,E=r,I=r+w*b;E<I;E+=b){B=E+b;B===I&&(B=r);var D=c[E],F=c[E+1],m=c[B],B=c[B+1];(F<
k&&B>=k||B<k&&F>=k)&&D+(k-F)/(B-F)*(m-D)<l&&(p=!p)}r+=w*b}return p}Object.defineProperty(a,"__esModule",{value:!0});a.polygonContainsPoint=function(a,b,c,l){return r(a,b,c,l.coords[0],l.coords[1])};a.polygonContainsMultipoint=function(a,b,c,l,k,u){k=k?u?4:3:u?3:2;u=l.coords;l=l.lengths;if(!l)return!1;for(var p=0,C=0;p<l.length;p++,C+=k)if(!r(a,b,c,u[C],u[C+1]))return!1;return!0};a.polygonContainsCoords=r})},"esri/layers/support/PromiseQueue":function(){define(["require","exports","../../core/promiseUtils"],
function(B,a,r){Object.defineProperty(a,"__esModule",{value:!0});B=function(){function a(){this._deferreds=[];this._values=[]}a.prototype.push=function(a){var b=this;return r.create(function(c,k){b._deferreds.push({resolve:c,reject:k});b._values.push(a)})};a.prototype.unshift=function(a){var b=this;return r.create(function(c,k){b._deferreds.unshift({resolve:c,reject:k});b._values.unshift(a)})};Object.defineProperty(a.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,
configurable:!0});a.prototype.process=function(){if(0===this.length)return!1;this._deferreds.shift().resolve(this._values.shift());return!0};a.prototype.cancelAll=function(){for(var a=r.createAbortError(),c=0,l=this._deferreds;c<l.length;c++)l[c].reject(a);this._deferreds.length=0;this._values.length=0};return a}();a.PromiseQueue=B})},"esri/layers/graphics/sources/geojson/geojson":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/valuesHelper ../../../../core/Error ../../OptimizedFeature ../../OptimizedGeometry".split(" "),
function(B,a,r,p,b,c,l,k){function u(a){var b=[];a.forEach(function(a){return b.push(a)});return b}function y(a){var b,c,h,k;return r(this,function(e){switch(e.label){case 0:b=a.type;switch(b){case "Feature":return[3,1];case "FeatureCollection":return[3,3]}return[3,7];case 1:return[4,a];case 2:return e.sent(),[3,7];case 3:c=0,h=a.features,e.label=4;case 4:return c<h.length?(k=h[c])?[4,k]:[3,6]:[3,7];case 5:e.sent(),e.label=6;case 6:return c++,[3,4];case 7:return[2]}})}function C(a){var c,g,h,k,l,
m,p,q,u,n;return r(this,function(e){switch(e.label){case 0:if(!a)return[2,null];c=a.type;switch(c){case "Point":return[3,1];case "LineString":return[3,3];case "MultiPoint":return[3,3];case "MultiLineString":return[3,5];case "Polygon":return[3,5];case "MultiPolygon":return[3,10]}return[3,17];case 1:return[4,a.coordinates];case 2:return e.sent(),[3,17];case 3:return[5,b(a.coordinates)];case 4:return e.sent(),[3,17];case 5:g=0,h=a.coordinates,e.label=6;case 6:if(!(g<h.length))return[3,9];k=h[g];return[5,
b(k)];case 7:e.sent(),e.label=8;case 8:return g++,[3,6];case 9:return[3,17];case 10:l=0,m=a.coordinates,e.label=11;case 11:if(!(l<m.length))return[3,16];p=m[l];q=0;u=p;e.label=12;case 12:if(!(q<u.length))return[3,15];n=u[q];return[5,b(n)];case 13:e.sent(),e.label=14;case 14:return q++,[3,12];case 15:return l++,[3,11];case 16:return[3,17];case 17:return[2]}})}function w(a,b){var c,e,h,m,p,u,w,y,n,A,C;void 0===b&&(b={});return r(this,function(g){switch(g.label){case 0:c=b.geometryType,e=b.ignoreIds,
h=b.nextObjectId,m=void 0===h?1:h,g.label=1;case 1:p=a.next();u=p.value;if(w=p.done)return[2];y=u.geometry;n=u.properties;A=u.id;if(y&&q[y.type]!==c)return[3,1];C=new l.default(y?I(new k.default,y,b):null,n);C.objectId=e||null==A?m++:A;return[4,C];case 2:return g.sent(),[3,1];case 3:return[2]}})}function G(a){for(var b=0,c=0;c<a.length;c++)var h=a[c],k=a[(c+1)%a.length],b=b+(h[0]*k[1]-k[0]*h[1]);return 0>=b}function E(a){var b=a[0],c=a[a.length-1];b[0]===c[0]&&b[1]===c[1]&&b[2]===c[2]||a.push(b);
return a}function I(a,b,c){switch(b.type){case "LineString":return D(a,b.coordinates,c),a;case "MultiLineString":var e=0;for(b=b.coordinates;e<b.length;e++)D(a,b[e],c);return a;case "MultiPoint":return D(a,b.coordinates,c),a;case "MultiPolygon":e=0;for(b=b.coordinates;e<b.length;e++){var g=b[e],h=a,k=c,l=E(g[0]);G(l)?D(h,l,k):F(h,l,k);for(h=1;h<g.length;h++){var k=a,l=c,p=E(g[h]);G(p)?F(k,p,l):D(k,p,l)}}return a;case "Point":return m(a,b.coordinates,c),a;case "Polygon":e=b.coordinates;b=E(e[0]);G(b)?
D(a,b,c):F(a,b,c);for(b=1;b<e.length;b++)g=a,h=c,k=E(e[b]),G(k)?F(g,k,h):D(g,k,h);return a}}function D(a,b,c){for(var e=0;e<b.length;e++)m(a,b[e],c);a.lengths.push(b.length)}function F(a,b,c){for(var e=b.length-1;0<=e;e--)m(a,b[e],c);a.lengths.push(b.length)}function m(a,b,c){var e=b[2];a.coords.push(b[0],b[1]);c.hasZ&&a.coords.push(e||0)}Object.defineProperty(a,"__esModule",{value:!0});var q={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",
Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};a.validateGeoJSON=function(a){if(!a)throw new c("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==a.type&&"FeatureCollection"!==a.type)throw new c("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:a});if(a.crs){a=a.crs;var b=["urn:ogc:def:crs:OGC:1.3:CRS84","EPSG:4326"].map(function(a){return a.toLowerCase()});if("link"===a.type||-1===b.indexOf(a.properties.name.toLowerCase()))throw new c("geojson-layer:unsupported-crs",
"unsupported GeoJSON 'crs' member",{crs:a});}};a.inferLayerProperties=function(a,b){void 0===b&&(b={});a=y(a);var c=[],e=new Set,h=new Set,k=!1,l=Number.NEGATIVE_INFINITY,m=!1,p=void 0;b=b.geometryType;b=void 0===b?null:b;for(var r=!1;;){var n=a.next(),w=n.value;if(n.done)return{fields:c,geometryType:b,hasZ:k,maxObjectId:Math.max(0,l),objectIdFieldType:p,objectIdOnFeature:m,unknownFields:u(h)};var D=w.geometry,n=w.properties,w=w.id;if(D&&(b||(b=q[D.type]),q[D.type]!==b))continue;if(!k)a:for(k=C(D);;){var D=
k.next(),E=D.value;if(D.done){k=!1;break a}if(2<E.length){k=!0;break a}}m||(m=null!=w)&&(p=typeof w);m&&"number"===p&&null!=w&&(l=Math.max(l,w));if(!r&&n){var r=!0,B;for(B in n)if(!e.has(B))if(w=n[B],null==w)r=!1,h.add(B);else{a:switch(typeof w){case "string":w="esriFieldTypeString";break a;case "number":w="esriFieldTypeDouble";break a;default:w="unknown"}"unknown"===w?h.add(B):(h.delete(B),e.add(B),c.push({name:B,alias:B,type:w}))}}}};a.createOptimizedFeatures=function(a,b){a:for(a=w(y(a),b),b=[];;){var c=
a.next(),e=c.value;if(c.done)break a;b.push(e)}return b}})},"esri/core/tsSupport/valuesHelper":function(){define([],function(){return function(B){var a="function"===typeof Symbol&&B[Symbol.iterator],r=0;return a?a.call(B):{next:function(){B&&r>=B.length&&(B=void 0);return{value:B&&B[r++],done:!B}}}}})},"esri/layers/graphics/sources/support/clientSideDefaults":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/lang ../../../../symbols/support/defaultsJSON".split(" "),
function(B,a,r,p,b,c){Object.defineProperty(a,"__esModule",{value:!0});a.createDrawingInfo=function(a){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===a||"esriGeometryMultipoint"===a?c.defaultPointSymbolJSON:"esriGeometryPolyline"===a?c.defaultPolylineSymbolJSON:c.defaultPolygonSymbolJSON}}};a.createDefaultAttributesFunction=function(a,b){if(p("csp-restrictions"))return function(){var c;return r((c={},c[b]=null,c),a)};try{var c="this."+b+" \x3d null;",k;for(k in a)c+="this."+k+" \x3d "+
JSON.stringify(a[k])+";";var l=new Function(c);return function(){return new l}}catch(w){return function(){var c;return r((c={},c[b]=null,c),a)}}};a.createDefaultTemplate=function(a){void 0===a&&(a={});return[{name:"New Feature",description:"",prototype:{attributes:b.clone(a)}}]}})},"esri/layers/graphics/sources/support/sourceUtils":function(){define(["require","exports","../../../support/fieldUtils"],function(B,a,r){function p(a){return new c(a)}Object.defineProperty(a,"__esModule",{value:!0});var b=
function(){return function(){this.description=this.code=null}}();a.createFeatureEditError=function(a){return new b};var c=function(){return function(a){this.error=new b;this.objectId=this.globalId=null;this.success=!1;this.uniqueId=null;this.error.description=a}}();a.createFeatureEditErrorResult=p;var l=function(){return function(a){this.globalId=null;this.success=!0;this.objectId=this.uniqueId=a}}();a.createFeatureEditSuccessResult=function(a){return new l(a)};var k=new Set;a.mixAttributes=function(a,
b,c,l,B,E){void 0===B&&(B=!1);k.clear();for(var u in l){var w=a.get(u);if(w){var y=l[u],m;m=w;var q=y,h=q;"string"===typeof q&&r.isNumericField(m)?h=parseFloat(q):null!=q&&r.isStringField(m)&&"string"!==typeof q&&(h=String(q));m=r.sanitizeNullFieldValue(h);m!==y&&E&&E.push({name:"invalid-value-type",message:"attribute value was converted to match the field type",details:{field:w,originalValue:y,sanitizedValue:m}});k.add(w.name);if(w&&(B||w.editable)){if(y=r.validateFieldValue(w,m))return p(r.validationErrorToString(y,
w,m));c[w.name]=m}}}for(a=0;a<b.length;a++)if(c=b[a],!k.has(c.name))return p('missing required field "'+c.name+'"');return null}})},"*noref":1}});
define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/awaiterHelper ../../../../request ../../../../core/Error ../../../../geometry/support/jsonUtils ../../../../geometry/support/spatialReferenceUtils ../../featureConversionUtils ../../data/FeatureStore ../../data/projectionSupport ../../data/QueryEngine ./geojson ../support/clientSideDefaults ../support/sourceUtils ../../../support/FieldsIndex ../../../support/fieldType ../../../support/fieldUtils".split(" "),function(B,
a,r,p,b,c,l,k,u,y,C,w,G,E,I,D,F,m,q){Object.defineProperty(a,"__esModule",{value:!0});var h={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,
supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};B=function(){function a(){this._featuresInfo=this._queryEngine=null}a.prototype.destroy=function(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy();this._queryEngine=this._featuresInfo=this._requiredFields=this._fieldsIndex=this._createDefaultAttributes=null};a.prototype.load=function(a){return b(this,void 0,void 0,function(){var b,e,g,k,B,D,K,n,A,H,X,Y,
U,ua,M,da,W,Q,T,ja,ba,ea,oa,ka,la,ma,Aa;return r(this,function(t){switch(t.label){case 0:return b=[],[4,this._checkProjection(a.spatialReference)];case 1:return t.sent(),e=null,a.url?[4,c(a.url,{responseType:"json"})]:[3,4];case 2:return g=t.sent(),e=g.data,[4,E.validateGeoJSON(e)];case 3:t.sent(),t.label=4;case 4:k=E.inferLayerProperties(e,{geometryType:a.geometryType});B=a.fields||k.fields||[];D=null!=a.hasZ?a.hasZ:k.hasZ;K=k.geometryType;n=a.objectIdField||"OBJECTID";A=a.spatialReference||u.WGS84;
H=a.timeInfo;if(!K)throw new l("geojson-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");"string"===k.objectIdFieldType&&b.push({name:"geojson-layer:unsupported-id-type",message:"Feature ids are of type string and can't be honored."});B===k.fields&&0<k.unknownFields.length&&b.push({name:"geojson-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:k.unknownFields}});
n&&(X=null,(Y=B.some(function(a){return a.name===n?(X=a,!0):!1}))?(X.type="esriFieldTypeOID",X.editable=!1,X.nullable=!1):B.unshift({alias:n,name:n,type:"esriFieldTypeOID",editable:!1,nullable:!1}));U=0;for(ua=B;U<ua.length;U++){M=ua[U];null==M.name&&(M.name=M.alias);null==M.alias&&(M.alias=M.name);if(!M.name)throw new l("geojson-layer:invalid-field-name","field name is missing",{field:M});M.name===n&&(M.type="esriFieldTypeOID");if(-1===m.kebabDict.jsonValues.indexOf(M.type))throw new l("geojson-layer:invalid-field-type",
'invalid type for field "'+M.name+'"',{field:M});}da={};this._requiredFields=[];W=0;for(Q=B;W<Q.length;W++)M=Q[W],"esriFieldTypeOID"!==M.type&&"esriFieldTypeGlobalID"!==M.type&&(M.editable=null==M.editable?!0:!!M.editable,M.nullable=null==M.nullable?!0:!!M.nullable,T=q.getFieldDefaultValue(M),M.nullable||void 0!==T?da[M.name]=T:this._requiredFields.push(M));this._fieldsIndex=new F(B);H&&(H.startTimeField&&((ja=this._fieldsIndex.get(H.startTimeField))?(H.startTimeField=ja.name,ja.type="esriFieldTypeDate"):
H.startTimeField=null),H.endTimeField&&((ba=this._fieldsIndex.get(H.endTimeField))?(H.endTimeField=ba.name,ba.type="esriFieldTypeDate"):H.endTimeField=null),H.trackIdField&&((ea=this._fieldsIndex.get(H.trackIdField))?H.trackIdField=ea.name:(H.trackIdField=null,b.push({name:"geojson-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:H}}))),H.startTimeField||H.endTimeField||(b.push({name:"geojson-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",
details:{timeInfo:H}}),H=null));oa={warnings:b,featureErrors:[],layerDefinition:p({},h,{drawingInfo:I.createDrawingInfo(K),templates:I.createDefaultTemplate(da),extent:null,geometryType:K,objectIdField:n,fields:B,hasZ:!!D,timeInfo:H})};this._queryEngine=new G.default({fields:B,geometryType:K,hasM:!1,hasZ:D,objectIdField:n,spatialReference:A,timeInfo:H,featureStore:new C.default({geometryType:K,hasM:!1,hasZ:D})});this._createDefaultAttributes=I.createDefaultAttributesFunction(da,n);this._featuresInfo=
{nextObjectId:k.maxObjectId+1,geometryType:K,hasZ:D,ignoreIds:"string"===k.objectIdFieldType};ka=E.createOptimizedFeatures(e,this._featuresInfo);if(!u.equals(A,u.WGS84))for(la=0,ma=ka;la<ma.length;la++)Aa=ma[la],Aa.geometry&&(Aa.geometry=y.convertFromGeometry(w.project(y.convertToGeometry(Aa.geometry,K,D,!1),u.WGS84,A)));this._loadInitialFeatures(oa,ka);return[2,oa]}})})};a.prototype.applyEdits=function(a){return b(this,void 0,void 0,function(){var b,c=this;return r(this,function(e){b=this._queryEngine.spatialReference;
return[2,w.checkProjectionSupport(a.adds,b).then(function(){return w.checkProjectionSupport(a.updates,b)}).then(function(){return c._applyEdits(a)})]})})};a.prototype.queryFeatures=function(a,c){void 0===a&&(a={});void 0===c&&(c={});return b(this,void 0,void 0,function(){return r(this,function(b){return[2,this._queryEngine.executeQuery(a,c.signal)]})})};a.prototype.queryFeatureCount=function(a,c){void 0===a&&(a={});void 0===c&&(c={});return b(this,void 0,void 0,function(){return r(this,function(b){return[2,
this._queryEngine.executeQueryForCount(a,c.signal)]})})};a.prototype.queryObjectIds=function(a,c){void 0===a&&(a={});void 0===c&&(c={});return b(this,void 0,void 0,function(){return r(this,function(b){return[2,this._queryEngine.executeQueryForIds(a,c.signal)]})})};a.prototype.queryExtent=function(a,c){void 0===a&&(a={});void 0===c&&(c={});return b(this,void 0,void 0,function(){return r(this,function(b){return[2,this._queryEngine.executeQueryForExtent(a,c.signal)]})})};a.prototype._loadInitialFeatures=
function(a,b){for(var c=this._queryEngine.featureStore,e=[],g=0;g<b.length;g++){var h=b[g],k=this._createDefaultAttributes(),l=D.mixAttributes(this._fieldsIndex,this._requiredFields,k,h.attributes,!0,a.warnings);l?a.featureErrors.push(l):(this._assignObjectId(k,h.attributes,!0),h.attributes=k,e.push(h))}c.addMany(e);a.layerDefinition.extent=this._queryEngine.fullExtent;a.layerDefinition.timeInfo&&(b=this._queryEngine.timeExtent,a.layerDefinition.timeInfo.timeExtent=[b.start,b.end]);return a};a.prototype._applyEdits=
function(a){var b=a.adds,c=a.updates;a=a.deletes;var e={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};b&&b.length&&this._applyAddEdits(e,b);c&&c.length&&this._applyUpdateEdits(e,c);if(a&&a.length){for(b=0;b<a.length;b++)e.deleteResults.push(D.createFeatureEditSuccessResult(a[b]));this._queryEngine.featureStore.removeManyById(a)}return{fullExtent:this._queryEngine.fullExtent,timeExtent:this._queryEngine.timeExtent,featureEditResults:e}};a.prototype._applyAddEdits=function(a,b){for(var c=
a.addResults,e=this._queryEngine,g=e.geometryType,h=e.hasM,l=e.hasZ,m=e.objectIdField,n=e.spatialReference,e=e.featureStore,p=[],q=0;q<b.length;q++){var r=b[q];if(r.geometry&&g!==k.getJsonType(r.geometry))c.push(D.createFeatureEditErrorResult("Incorrect geometry type."));else{var t=this._createDefaultAttributes(),u=D.mixAttributes(this._fieldsIndex,this._requiredFields,t,r.attributes);u?c.push(u):(this._assignObjectId(t,r.attributes),r.attributes=t,null!=r.uid&&(a.uidToObjectId[r.uid]=r.attributes[m]),
r.geometry&&(r.geometry=w.project(r.geometry,r.geometry.spatialReference,n)),p.push(r),c.push(D.createFeatureEditSuccessResult(r.attributes[m])))}}e.addMany(y.convertFromFeatures([],p,g,l,h,m))};a.prototype._applyUpdateEdits=function(a,b){a=a.updateResults;for(var c=this._queryEngine,e=c.geometryType,g=c.hasM,h=c.hasZ,l=c.objectIdField,m=c.spatialReference,c=c.featureStore,n=0;n<b.length;n++){var p=b[n],q=p.attributes,r=p.geometry,p=q&&q[l];if(null==p)a.push(D.createFeatureEditErrorResult("Identifier field "+
l+" missing"));else if(c.has(p)){var t=y.convertToFeature(c.getFeature(p),e,h,g);if(r){if(e!==k.getJsonType(r)){a.push(D.createFeatureEditErrorResult("Incorrect geometry type."));continue}t.geometry=w.project(r,r.spatialReference,m)}if(q&&(q=D.mixAttributes(this._fieldsIndex,this._requiredFields,t.attributes,q))){a.push(q);continue}c.add(y.convertFromFeature(t,e,h,g,l));a.push(D.createFeatureEditSuccessResult(p))}else a.push(D.createFeatureEditErrorResult("Feature with object id "+p+" missing"))}};
a.prototype._assignObjectId=function(a,b,c){void 0===c&&(c=!1);var e=this._queryEngine.objectIdField;c?b&&isFinite(b[e])?a[e]=b[e]:a[e]=this._featuresInfo.nextObjectId++:a[e]=this._featuresInfo.nextObjectId++};a.prototype._checkProjection=function(a){return b(this,void 0,void 0,function(){return r(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,w.checkProjectionSupport(u.WGS84,a)];case 1:return b.sent(),[3,3];case 2:throw b.sent(),new l("geojson-layer","Projection not supported");
case 3:return[2]}})})};return a}();a.default=B});