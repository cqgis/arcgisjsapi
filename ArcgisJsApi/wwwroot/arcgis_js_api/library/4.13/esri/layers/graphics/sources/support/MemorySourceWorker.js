// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/graphics/featureConversionUtils":function(){define("require exports ../../core/Error ../../core/Logger ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),function(C,a,q,l,b,c,k,h){function u(a,m){return a?m?4:3:m?3:2}function t(a,m){return Math.round((m-a.translate[0])/a.scale[0])}function z(a,m){return Math.round((a.translate[1]-m)/a.scale[1])}function w(a,m){return m*a.scale[0]+a.translate[0]}function F(a,m){return a.translate[1]-
m*a.scale[1]}function B(a){a=a.coords;return{x:a[0],y:a[1]}}function I(a,m){a.coords[0]=m.x;a.coords[1]=m.y;return a}function E(a){a=a.coords;return{x:a[0],y:a[1],z:a[2]}}function G(a,m){a.coords[0]=m.x;a.coords[1]=m.y;a.coords[2]=m.z;return a}function d(a){a=a.coords;return{x:a[0],y:a[1],m:a[2]}}function n(a,m){a.coords[0]=m.x;a.coords[1]=m.y;a.coords[2]=m.m;return a}function g(a){a=a.coords;return{x:a[0],y:a[1],z:a[2],m:a[3]}}function p(a,m){a.coords[0]=m.x;a.coords[1]=m.y;a.coords[2]=m.z;a.coords[3]=
m.m;return a}function r(a,m){return a&&m?p:a?G:m?n:I}function A(a,m,b){if(!a)return null;for(var c=u(m,b),d=[],g=0;g<a.coords.length;g+=c){for(var n=[],r=0;r<c;r++)n.push(a.coords[g+r]);d.push(n)}return m?b?{points:d,hasZ:m,hasM:b}:{points:d,hasZ:m}:b?{points:d,hasM:b}:{points:d}}function D(a,m,b){void 0===b&&(b=u(m.hasZ,m.hasM));a.lengths[0]=m.points.length;var c=a.coords,d=0,g=0;for(m=m.points;g<m.length;g++)for(var n=m[g],r=0;r<b;r++)c[d++]=n[r];return a}function V(a,m,b){if(!a)return null;var c=
u(m,b),d=a.coords,g=[],n=0,r=0;for(a=a.lengths;r<a.length;r++){for(var p=a[r],x=[],h=0;h<p;h++){for(var ia=[],A=0;A<c;A++)ia.push(d[n++]);x.push(ia)}g.push(x)}return m?b?{paths:g,hasZ:m,hasM:b}:{paths:g,hasZ:m}:b?{paths:g,hasM:b}:{paths:g}}function W(a,m,b){void 0===b&&(b=u(m.hasZ,m.hasM));var c=a.lengths,d=a.coords,g=0,n=0;for(m=m.paths;n<m.length;n++){for(var r=m[n],p=0,x=r;p<x.length;p++)for(var h=x[p],A=0;A<b;A++)d[g++]=h[A];c.push(r.length)}return a}function J(a,m,b){if(!a)return null;var c=
u(m,b),d=a.coords,g=[],n=0,r=0;for(a=a.lengths;r<a.length;r++){for(var p=a[r],x=[],h=0;h<p;h++){for(var A=[],k=0;k<c;k++)A.push(d[n++]);x.push(A)}g.push(x)}return m?b?{rings:g,hasZ:m,hasM:b}:{rings:g,hasZ:m}:b?{rings:g,hasM:b}:{rings:g}}function R(a,m,b,c){void 0===b&&(b=m.hasZ);void 0===c&&(c=m.hasM);H(a,m.rings,b,c);return a}function H(a,m,b,c){b=u(b,c);c=a.lengths;for(var d=a.coords,g=0,n=c.length=d.length=0;n<m.length;n++){for(var r=m[n],p=0,x=r;p<x.length;p++)for(var h=x[p],A=0;A<b;A++)d[g++]=
h[A];c.push(r.length)}return a}function m(a,m,b,d,g,n){a.length=0;if(!b){for(d=0;d<m.length;d++)g=m[d],a.push(new c.default(null,g.attributes,null,g.attributes[n]));return a}switch(b){case "esriGeometryPoint":d=r(d,g);for(g=0;g<m.length;g++){var p=m[g];b=p.geometry;var p=p.attributes,x=void 0;b&&(x=d(new h.default,b));a.push(new c.default(x,p,null,p[n]))}break;case "esriGeometryMultipoint":d=u(d,g);for(g=0;g<m.length;g++)p=m[g],b=p.geometry,p=p.attributes,x=void 0,b&&(x=D(new h.default,b,d)),a.push(new c.default(x,
p,null,p[n]));break;case "esriGeometryPolyline":d=u(d,g);for(g=0;g<m.length;g++)p=m[g],b=p.geometry,p=p.attributes,x=void 0,b&&(x=W(new h.default,b,d)),a.push(new c.default(x,p,null,p[n]));break;case "esriGeometryPolygon":for(b=0;b<m.length;b++){var A=m[b],p=A.geometry,x=A.centroid,A=A.attributes,k=void 0;p&&(k=R(new h.default,p,d,g));x?a.push(new c.default(k,A,I(new h.default,x),A[n])):a.push(new c.default(k,A,null,A[n]))}break;default:Y.error("convertToFeatureSet:unknown-geometry",new q("Unable to parse unknown geometry type '"+
b+"'")),a.length=0}return a}function x(a,m,b,c,n){a.length=0;switch(b){case "esriGeometryPoint":b=B;c&&n?b=g:c?b=E:n&&(b=d);for(c=0;c<m.length;c++){var p=m[c];n=p.geometry;p=p.attributes;n=n?b(n):null;a.push({attributes:p,geometry:n})}break;case "esriGeometryMultipoint":for(b=0;b<m.length;b++){var r=m[b],p=r.geometry,r=r.attributes,x=void 0;p&&(x=A(p,c,n));a.push({attributes:r,geometry:x})}break;case "esriGeometryPolyline":for(b=0;b<m.length;b++)r=m[b],p=r.geometry,r=r.attributes,x=void 0,p&&(x=V(p,
c,n)),a.push({attributes:r,geometry:x});break;case "esriGeometryPolygon":for(b=0;b<m.length;b++){var x=m[b],r=x.geometry,p=x.attributes,h=x.centroid,x=void 0;r&&(x=J(r,c,n));h?(r=B(h),a.push({attributes:p,centroid:r,geometry:x})):a.push({attributes:p,geometry:x})}break;default:Y.error("convertToFeatureSet:unknown-geometry",new q("Unable to parse unknown geometry type '"+b+"'"))}return a}function P(a,m,b,c,d,g){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!m||!m.coords.length)return null;
d=Ra[d];var p=m.coords;m=m.lengths;var n=u(b,c);b=b?c?da:sa:c?sa:va;if(!m.length)return b(a.coords,p,0,0,t(g,p[0]),z(g,p[1])),a.lengths.length&&(a.lengths.length=0),a.coords.length=n,a;for(var r,x,h,A=0,k,G=0,B=0;B<m.length;B++){var D=m[B];if(!(D<d)){var l=0;k=G;x=c=t(g,p[A]);h=r=z(g,p[A+1]);b(a.coords,p,k,A,x,h);l++;A+=n;k+=n;for(var H=1;H<D;H++,A+=n)if(x=t(g,p[A]),h=z(g,p[A+1]),x!==c||h!==r)b(a.coords,p,k,A,x-c,h-r),k+=n,l++,c=x,r=h;l>=d&&(a.lengths.push(l),G=k)}}a.coords.length=G;return a.coords.length?
a:null}function ma(a,m,b,c,d,g,p){for(var n=p-b,r=0,x=0,h,A=g+b;A<p-b;A+=b){h=m[A];var k=m[A+1],G=m[g],B=m[g+1],u=m[n],l=m[n+1];G===u?h=Math.abs(h-G):(u=(l-B)/(u-G),h=Math.abs(u*h-k+(B-u*G))/Math.sqrt(u*u+1));h>r&&(x=A,r=h)}r>c?(ma(a,m,b,c,d,g,x+b),ma(a,m,b,c,d,x,p)):(d(a,m,a.length,g,m[g],m[g+1]),d(a,m,a.length,n,m[n],m[n+1]))}function aa(a,m,b,c,d){var g=m.coords,p=m.lengths,n=b?c?da:sa:c?sa:va;b=u(b,c);if(!g.length)return a!==m&&(a.lengths.length=0,a.coords.length=0),a;if(!p.length)return n(a.coords,
g,0,0,w(d,g[0]),F(d,g[1])),a!==m&&(a.lengths.length=0,a.coords.length=b),a;var r=d.scale;c=r[0];for(var r=r[1],x=0,h=0;h<p.length;h++){var A=p[h];a.lengths[h]=A;var k=w(d,g[x]),G=F(d,g[x+1]);n(a.coords,g,x,x,k,G);for(var x=x+b,B=1;B<A;B++,x+=b)k+=g[x]*c,G-=g[x+1]*r,n(a.coords,g,x,x,k,G)}a!==m&&(a.lengths.length=p.length,a.coords.length=g.length);return a}Object.defineProperty(a,"__esModule",{value:!0});var Y=l.getLogger("esri.tasks.support.optimizedFeatureSet"),Ra={esriGeometryPoint:0,esriGeometryPolyline:2,
esriGeometryPolygon:3,esriGeometryMultipoint:0},va=function(a,m,b,c,d,g){a[b]=d;a[b+1]=g},sa=function(a,m,b,c,d,g){a[b]=d;a[b+1]=g;a[b+2]=m[c+2]},da=function(a,m,b,c,d,g){a[b]=d;a[b+1]=g;a[b+2]=m[c+2];a[b+3]=m[c+3]};a.quantizeX=t;a.quantizeY=z;a.hydrateX=w;a.hydrateY=F;a.convertToPoint=function(a,m,b){return a?m?b?g(a):E(a):b?d(a):B(a):null};a.convertFromPoint=function(a,m,b){void 0===b&&(b=r(null!=m.z,null!=m.m));return b(a,m)};a.convertToMultipoint=A;a.convertFromMultipoint=D;a.convertToPolyline=
V;a.convertFromPolyline=W;a.convertToPolygon=J;a.convertFromPolygon=R;a.convertFromNestedArray=H;var U=[],Z=[];a.convertFromFeature=function(a,b,c,d,g){U[0]=a;a=m(Z,U,b,c,d,g)[0];U.length=Z.length=0;return a};a.convertFromFeatures=m;a.convertToFeature=function(a,m,b,c){Z[0]=a;x(U,Z,m,b,c);a=U[0];U.length=Z.length=0;return a};a.convertFromGeometry=function(a,m,c){if(!a)return null;var d=new h.default;"hasZ"in a&&null==m&&(m=a.hasZ);"hasM"in a&&null==c&&(c=a.hasM);if(b.isPoint(a))return r(null!=m?m:
null!=a.z,null!=c?c:null!=a.m)(d,a);if(b.isPolygon(a))return R(d,a,m,c);if(b.isPolyline(a))return W(d,a,u(m,c));if(b.isMultipoint(a))return D(d,a,u(m,c));Y.error("convertFromGeometry:unknown-geometry",new q("Unable to parse unknown geometry type '"+a+"'"))};a.convertToGeometry=function(a,m,b,c){a=a&&("coords"in a?a:a.geometry);if(!a)return null;switch(m){case "esriGeometryPoint":return m=B,b&&c?m=g:b?m=E:c&&(m=d),m(a);case "esriGeometryMultipoint":return A(a,b,c);case "esriGeometryPolyline":return V(a,
b,c);case "esriGeometryPolygon":return J(a,b,c);default:Y.error("convertToGeometry:unknown-geometry",new q("Unable to parse unknown geometry type '"+m+"'"))}};a.convertToFeatures=x;a.convertToFeatureSet=function(a){var m=a.objectIdFieldName,b=a.spatialReference,c=a.transform,d=a.fields,g=a.hasM,p=a.hasZ,n=a.geometryType,r=a.exceededTransferLimit;a={features:x([],a.features,n,p,g),fields:d,geometryType:n,objectIdFieldName:m,spatialReference:b};c&&(a.transform=c);r&&(a.exceededTransferLimit=r);g&&(a.hasM=
g);p&&(a.hasZ=p);return a};a.convertFromFeatureSet=function(a,b){var c=new k.default,d=a.hasM,g=a.hasZ,p=a.features,n=a.objectIdFieldName,r=a.spatialReference,x=a.geometryType,h=a.exceededTransferLimit,A=a.transform;c.fields=a.fields;c.geometryType=x;c.objectIdFieldName=n||b;c.spatialReference=r;if(!c.objectIdFieldName)return Y.error(new q("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),c;p&&m(c.features,p,x,g,d,c.objectIdFieldName);h&&(c.exceededTransferLimit=h);d&&
(c.hasM=d);g&&(c.hasZ=g);A&&(c.transform=A);return c};a.hydrateOptimizedFeatureSet=function(a){var m=a.transform,b=a.hasM,c=a.hasZ;if(!m)return a;for(var d=0,g=a.features;d<g.length;d++){var p=g[d];p.geometry&&aa(p.geometry,p.geometry,b,c,m);p.centroid&&aa(p.centroid,p.centroid,b,c,m)}a.transform=null;return a};a.quantizeOptimizedFeatureSet=function(a,m){var b=m.geometryType,d=m.features,g=m.hasM,p=m.hasZ;if(!a)return m;for(var n=0;n<d.length;n++){var r=d[n],x=new c.default(new h.default,r.attributes);
P(x.geometry,r.geometry,g,p,b,a);r.centroid&&(x.centroid=new h.default,P(x.centroid,r.centroid,g,p,"esriGeometryPoint",a));d[n]=x}m.transform=a;return m};a.quantizeOptimizedGeometry=P;a.quantizeOptimizedGeometryRemoveCollinear=function(a,m,b,c,d,g){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!m||!m.coords.length)return null;d=Ra[d];var p=m.coords;m=m.lengths;var n=u(b,c);b=b?c?da:sa:c?sa:va;if(!m.length)return b(a.coords,p,0,0,t(g,p[0]),z(g,p[1])),a.lengths.length&&
(a.lengths.length=0),a.coords.length=n,a;for(var r,x,h,A=0,k,G=0,B=0;B<m.length;B++){var l=m[B];if(!(l<d)){var D=0;k=G;c=r=t(g,p[A]);h=x=z(g,p[A+1]);b(a.coords,p,k,A,c,h);D++;for(var A=A+n,H=!1,aa=0,I=0,J=1;J<l;J++,A+=n)if(c=t(g,p[A]),h=z(g,p[A+1]),c!==r||h!==x)r=c-r,x=h-x,H&&(0===aa&&0===r||0===I&&0===x)?(aa+=r,I+=x):(H=!0,aa=r,I=x,k+=n,D++),b(a.coords,p,k,A,aa,I),r=c,x=h;H&&(k+=n,b(a.coords,p,k,A,aa,I));D>=d&&(a.lengths.push(D),G=k)}}a.coords.length!==G&&(a.coords.length=G);return a.coords.length?
a:null};a.generalizeOptimizedGeometry=function(a,m,b,c,d,g){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!m||!m.coords.length)return null;d=Ra[d];var p=m.coords;m=m.lengths;var n=u(b,c);b=b?c?da:sa:c?sa:va;if(!m.length)return b(a.coords,p,0,0,p[0],p[1]),a.lengths.length&&(a.lengths.length=0),a.coords.length=n,a;for(var r=c=0;r<m.length;r++){var x=m[r];if(!(x<d)){var h=a.coords.length/n;ma(a.coords,p,n,g,b,c,c+x*n);var A=a.coords.length/n-h;A>=d?a.lengths.push(A):
a.coords.length=h*n}c+=x*n}return a.coords.length?a:null};a.getBoundsOptimizedGeometry=function(a,m,b,c){b=u(b,c);var d=c=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,p=Number.NEGATIVE_INFINITY;if(m&&m.coords){m=m.coords;for(var n=0;n<m.length;n+=b){var r=m[n],x=m[n+1];c=Math.min(c,r);g=Math.max(g,r);d=Math.min(d,x);p=Math.max(p,x)}}a[0]=c;a[1]=d;a[2]=g;a[3]=p;return a};a.getQuantizedBoundsOptimizedGeometry=function(a,m,b,c){b=u(b,c);c=m.coords;var d=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,
p=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=0,x=0;for(m=m.lengths;x<m.length;x++)for(var h=m[x],A=c[r],k=c[r+1],d=Math.min(A,d),g=Math.min(k,g),p=Math.max(A,p),n=Math.max(k,n),r=r+b,G=1;G<h;G++,r+=b){var B=c[r],l=c[r+1],A=A+B,k=k+l;0>B&&(d=Math.min(d,A));0<B&&(p=Math.max(p,A));0>l?g=Math.min(g,k):0<l&&(n=Math.max(n,k))}a[0]=d;a[1]=g;a[2]=p;a[3]=n;return a};a.hydrateOptimizedGeometry=aa})},"esri/layers/graphics/data/FeatureStore":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/extendsHelper ../../../core/Error ../../../core/Evented ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/libs/rbush/rbush ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./optimizedFeatureQueryEngineAdapter".split(" "),
function(C,a,q,l,b,c,k,h,u,t,z,w,F,B,I){Object.defineProperty(a,"__esModule",{value:!0});var E=[],G=u.getLogger("esri.layers.graphics.data.FeatureStore"),d={minX:0,minY:0,maxX:0,maxY:0};C=function(){function a(a,b,c){this._geometryInfo=a;this._onFeatureAdd=b;this._onFeatureRemove=c;this._featuresById=new Map;this._boundsByFeature=new Map;this._featuresByBounds=new Map;this._index=z(9,h("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:["[0]","[1]","[2]","[3]"]);this.events=
new k;this.featureAdapter=I.optimizedFeatureQueryEngineAdapter}Object.defineProperty(a.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numFeatures",{get:function(){return this._featuresById.size},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var a=F.create(F.NEGATIVE_INFINITY);this._boundsByFeature.forEach(function(b){b&&(a[0]=Math.min(b[0],a[0]),a[1]=Math.min(b[1],a[1]),a[2]=Math.max(b[2],a[2]),a[3]=Math.max(b[3],a[3]))});return a},enumerable:!0,configurable:!0});a.prototype.add=function(a){this._add(a,E);this._index.load(E);this._emitChanged();E.length=0};a.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this._add(a[b],
E);this._index.load(E);this._emitChanged();E.length=0};a.prototype.clear=function(){this._featuresById.clear();this._boundsByFeature.clear();this._featuresByBounds.clear();this._index.clear();this._emitChanged()};a.prototype.removeById=function(a){var b=this._featuresById.get(a);if(!b)return null;var c=this._boundsByFeature.get(b);c&&(this._index.remove(c),this._featuresByBounds.delete(c));this._boundsByFeature.delete(b);this._featuresById.delete(a);this._emitChanged();return b};a.prototype.removeIf=
function(a,b){var c=this;this._featuresById.forEach(function(d,g){b(d)&&(c._remove(d),a.push(d))});this._emitChanged()};a.prototype.removeManyById=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=this._featuresById.get(c);if(d){var g=this._boundsByFeature.get(d);g&&(this._index.remove(g),this._featuresByBounds.delete(g));this._boundsByFeature.delete(d)}this._featuresById.delete(c)}this._emitChanged()};a.prototype.forEachBounds=function(a,b,c){for(var d=0;d<a.length;d++){var g=this._boundsByFeature.get(a[d]);
g&&b(w.fromRect(c,g))}};a.prototype.getFeature=function(a){return this._featuresById.get(a)};a.prototype.has=function(a){return this._featuresById.has(a)};a.prototype.forEach=function(a){this._featuresById.forEach(function(b){return a(b)})};a.prototype.forEachInBounds=function(a,b){var c=0,g=this._index;d.minX=a[0];d.minY=a[1];d.maxX=a[2];d.maxY=a[3];for(a=g.search(d);c<a.length;c++)b(this._featuresByBounds.get(a[c]))};a.prototype.transferById=function(a,b){if(b=this._featuresById.get(b))this._remove(b),
a.add(b),this._emitChanged()};a.prototype.transferByIds=function(a,b){for(var c=[],d=0;d<b.length;d++){var g=this._featuresById.get(b[d]);g&&(this._remove(g),c.push(g))}a.addMany(c);this._emitChanged()};a.prototype.transferIdRange=function(a,b,c){for(var d=[];b<c;b++){var g=this._featuresById.get(b);g&&(this._remove(g),d.push(g))}a.addMany(d);this._emitChanged()};a.prototype.transferIf=function(a,b){var c=this,d=[];this._featuresById.forEach(function(a,g){b(a)&&(c._remove(a),d.push(a))});a.addMany(d);
this._emitChanged()};a.prototype.transferAll=function(a){var b=this,c=[];this._featuresById.forEach(function(a,d){b._remove(a);c.push(a)});a.addMany(c);this._emitChanged()};a.prototype._emitChanged=function(){this.events.emit("changed",void 0)};a.prototype._add=function(a,b){if(a){var d=a.objectId;if(null==d)G.error(new c("featurestore:invalid-feature","feature id is missing",{feature:a}));else{var g=this._featuresById.get(d),n;g?(n=this._boundsByFeature.get(g),a.localId=g.localId,n&&(this._index.remove(n),
this._boundsByFeature.delete(g),this._featuresByBounds.delete(n))):t.isSome(this._onFeatureAdd)&&this._onFeatureAdd(a);a.geometry&&a.geometry.coords&&a.geometry.coords.length?(n=B.getBoundsOptimizedGeometry(n||F.create(),a.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(a,n),this._featuresByBounds.set(n,a),this._featuresById.set(d,a),b.push(n)):(this._boundsByFeature.set(a,null),this._featuresById.set(d,a))}}};a.prototype._remove=function(a){var b;if(a){t.isSome(this._onFeatureRemove)&&
this._onFeatureRemove(a);if(b=this._boundsByFeature.get(a))this._index.remove(b),this._boundsByFeature.delete(a),this._featuresByBounds.delete(b);this._featuresById.delete(a.objectId)}};return a}();a.default=C})},"esri/core/libs/rbush/rbush":function(){define(["../quickselect/quickselect"],function(C){function a(b,c){if(!(this instanceof a))return new a(b,c);this._maxEntries=Math.max(4,b||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));c&&("function"===typeof c?this.toBBox=c:this._initFormat(c));
this.clear()}function q(a,b){l(a,0,a.children.length,b,a)}function l(a,c,h,k,d){d||(d=w(null));d.minX=Infinity;d.minY=Infinity;d.maxX=-Infinity;d.maxY=-Infinity;for(var n;c<h;c++)n=a.children[c],b(d,a.leaf?k(n):n);return d}function b(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function c(a,b){return a.minX-b.minX}function k(a,b){return a.minY-b.minY}function h(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function u(a){return a.maxX-
a.minX+(a.maxY-a.minY)}function t(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function z(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function w(a){return{children:a,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function F(a,b,c,h,d){for(var n=[b,c],g;n.length;)c=n.pop(),b=n.pop(),c-b<=h||(g=b+Math.ceil((c-b)/h/2)*h,C(a,g,b,c,d),n.push(b,g,g,c))}a.prototype={all:function(){return this._all(this.data,[])},search:function(a){var b=
this.data,c=[],h=this.toBBox;if(!z(a,b))return c;for(var d=[],n,g,p,r;b;){n=0;for(g=b.children.length;n<g;n++)p=b.children[n],r=b.leaf?h(p):p,z(a,r)&&(b.leaf?c.push(p):t(a,r)?this._all(p,c):d.push(p));b=d.pop()}return c},collides:function(a){var b=this.data,c=this.toBBox;if(!z(a,b))return!1;for(var h=[],d,n,g,p;b;){d=0;for(n=b.children.length;d<n;d++)if(g=b.children[d],p=b.leaf?c(g):g,z(a,p)){if(b.leaf||t(a,p))return!0;h.push(g)}b=h.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<
this._minEntries){for(var b=0,c=a.length;b<c;b++)this.insert(a[b]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(b=this.data,this.data=a,a=b),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this},insert:function(a){a&&this._insert(a,this.data.height-1);return this},clear:function(){this.data=w([]);return this},remove:function(a,b){if(!a)return this;for(var c=this.data,
h=this.toBBox(a),d=[],n=[],g,p,r,k;c||d.length;){c||(c=d.pop(),p=d[d.length-1],g=n.pop(),k=!0);if(c.leaf){a:{r=a;var l=c.children,u=b;if(u){for(var B=0;B<l.length;B++)if(u(r,l[B])){r=B;break a}r=-1}else r=l.indexOf(r)}if(-1!==r){c.children.splice(r,1);d.push(c);this._condense(d);break}}k||c.leaf||!t(c,h)?p?(g++,c=p.children[g],k=!1):c=null:(d.push(c),n.push(g),g=0,p=c,c=c.children[0])}return this},toBBox:function(a){return a},compareMinX:c,compareMinY:k,toJSON:function(){return this.data},fromJSON:function(a){this.data=
a;return this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,h){var d=c-b+1,n=this._maxEntries,g;if(d<=n)return g=w(a.slice(b,c+1)),q(g,this.toBBox),g;h||(h=Math.ceil(Math.log(d)/Math.log(n)),n=Math.ceil(d/Math.pow(n,h-1)));g=w([]);g.leaf=!1;g.height=h;var d=Math.ceil(d/n),n=d*Math.ceil(Math.sqrt(n)),p,r,k;for(F(a,b,c,n,this.compareMinX);b<=c;b+=n)for(r=Math.min(b+n-1,c),F(a,b,r,d,this.compareMinY),p=b;p<=
r;p+=d)k=Math.min(p+d-1,r),g.children.push(this._build(a,p,k,h-1));q(g,this.toBBox);return g},_chooseSubtree:function(a,b,c,k){for(var d,n,g,p,r,A,l,u;;){k.push(b);if(b.leaf||k.length-1===c)break;l=u=Infinity;d=0;for(n=b.children.length;d<n;d++)g=b.children[d],r=h(g),A=(Math.max(g.maxX,a.maxX)-Math.min(g.minX,a.minX))*(Math.max(g.maxY,a.maxY)-Math.min(g.minY,a.minY))-r,A<u?(u=A,l=r<l?r:l,p=g):A===u&&r<l&&(l=r,p=g);b=p||b.children[0]}return b},_insert:function(a,c,h){var k=this.toBBox;h=h?a:k(a);var k=
[],d=this._chooseSubtree(h,this.data,c,k);d.children.push(a);for(b(d,h);0<=c;)if(k[c].children.length>this._maxEntries)this._split(k,c),c--;else break;this._adjustParentBBoxes(h,k,c)},_split:function(a,b){var c=a[b],h=c.children.length,d=this._minEntries;this._chooseSplitAxis(c,d,h);h=this._chooseSplitIndex(c,d,h);h=w(c.children.splice(h,c.children.length-h));h.height=c.height;h.leaf=c.leaf;q(c,this.toBBox);q(h,this.toBBox);b?a[b-1].children.push(h):this._splitRoot(c,h)},_splitRoot:function(a,b){this.data=
w([a,b]);this.data.height=a.height+1;this.data.leaf=!1;q(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var k,d,n,g,p,r,A;p=r=Infinity;for(k=b;k<=c-b;k++)d=l(a,0,k,this.toBBox),n=l(a,k,c,this.toBBox),g=Math.max(0,Math.min(d.maxX,n.maxX)-Math.max(d.minX,n.minX))*Math.max(0,Math.min(d.maxY,n.maxY)-Math.max(d.minY,n.minY)),d=h(d)+h(n),g<p?(p=g,A=k,r=d<r?d:r):g===p&&d<r&&(r=d,A=k);return A},_chooseSplitAxis:function(a,b,h){var l=a.leaf?this.compareMinX:c,d=a.leaf?this.compareMinY:k,n=this._allDistMargin(a,
b,h,l);b=this._allDistMargin(a,b,h,d);n<b&&a.children.sort(l)},_allDistMargin:function(a,c,h,k){a.children.sort(k);k=this.toBBox;var d=l(a,0,c,k),n=l(a,h-c,h,k),g=u(d)+u(n),p,r;for(p=c;p<h-c;p++)r=a.children[p],b(d,a.leaf?k(r):r),g+=u(d);for(p=h-c-1;p>=c;p--)r=a.children[p],b(n,a.leaf?k(r):r),g+=u(n);return g},_adjustParentBBoxes:function(a,c,h){for(;0<=h;h--)b(c[h],a)},_condense:function(a){for(var b=a.length-1,c;0<=b;b--)0===a[b].children.length?0<b?(c=a[b-1].children,c.splice(c.indexOf(a[b]),1)):
this.clear():q(a[b],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")}};return a})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function C(l,b,c,k,h){for(;k>c;){if(600<k-c){var u=k-c+1,t=b-c+1,z=Math.log(u),w=.5*Math.exp(2*z/3),z=.5*Math.sqrt(z*
w*(u-w)/u)*(0>t-u/2?-1:1);C(l,b,Math.max(c,Math.floor(b-t*w/u+z)),Math.min(k,Math.floor(b+(u-t)*w/u+z)),h)}u=l[b];t=c;w=k;a(l,c,b);for(0<h(l[k],u)&&a(l,c,k);t<w;){a(l,t,w);t++;for(w--;0>h(l[t],u);)t++;for(;0<h(l[w],u);)w--}0===h(l[c],u)?a(l,c,w):(w++,a(l,w,k));w<=b&&(c=w+1);b<=w&&(k=w-1)}}function a(a,b,c){var k=a[b];a[b]=a[c];a[c]=k}function q(a,b){return a<b?-1:a>b?1:0}return function(a,b,c,k,h){C(a,b,c||0,k||a.length-1,h||q)}})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["require",
"exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(C,a,q,l,b){Object.defineProperty(a,"__esModule",{value:!0});a.optimizedFeatureQueryEngineAdapter={getObjectId:function(a){return a.objectId},getAttributes:function(a){return a.attributes},getAttribute:function(a,b){return a.attributes[b]},cloneWithGeometry:function(a,b){return new l.default(b,a.attributes,null,a.objectId)},getGeometry:function(a){return a.geometry},getCentroid:function(a,k){a.centroid||(a.centroid=q.getCentroidOptimizedGeometry(new b.default,
a.geometry,k.hasZ,k.hasM));return a.centroid}};a.default=a.optimizedFeatureQueryEngineAdapter})},"esri/layers/graphics/centroid":function(){define(["require","exports"],function(C,a){function q(a,c,k,h,u,l){l=u?l?4:3:l?3:2;var b=k,t=k+l,F=0,B=0,q=k=0,E=0,G=0;for(--h;G<h;G++,b+=l,t+=l){var d=c[b],n=c[b+1],g=c[b+2],p=c[t],r=c[t+1],A=c[t+2],D=d*r-p*n,q=q+D,F=F+(d+p)*D,B=B+(n+r)*D;u&&(D=d*A-p*g,k+=(g+A)*D,E+=D);d<a[0]&&(a[0]=d);d>a[1]&&(a[1]=d);n<a[2]&&(a[2]=n);n>a[3]&&(a[3]=n);u&&(g<a[4]&&(a[4]=g),g>
a[5]&&(a[5]=g))}0<q&&(q*=-1);0<E&&(E*=-1);if(!q)return null;a=[F,B,.5*q];u&&(a[3]=k,a[4]=.5*E);return a}function l(a,c,k,h,l){l=h?l?4:3:l?3:2;for(var b=c,u=c+l,w=0,F=0,B=0,q=0,E=0,G=k-1;E<G;E++,b+=l,u+=l){var d=a[b],n=a[b+1],g=a[b+2],p=a[u],r=a[u+1],A=a[u+2],D;if(h){D=p-d;var V=r-n,W=A-g;D=Math.sqrt(D*D+V*V+W*W)}else D=p-d,V=r-n,D=Math.sqrt(D*D+V*V);D&&(w+=D,h?(d=[d+.5*(p-d),n+.5*(r-n),g+.5*(A-g)],F+=D*d[0],B+=D*d[1],q+=D*d[2]):(d=[d+.5*(p-d),n+.5*(r-n)],F+=D*d[0],B+=D*d[1]))}return 0<w?h?[F/w,B/
w,q/w]:[F/w,B/w]:0<k?h?[a[c],a[c+1],a[c+2]]:[a[c],a[c+1]]:null}Object.defineProperty(a,"__esModule",{value:!0});a.getCentroidOptimizedGeometry=function(a,c,k,h){if(!c||!c.lengths.length)return null;a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);for(var b=a.coords,t=[],z=k?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,
Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],w=c.lengths,F=c.coords,B=k?h?4:3:h?3:2,I=0,E=0;E<w.length;E++){var G=w[E],d=q(z,F,I,G,k,h);d&&t.push(d);I+=G*B}t.sort(function(a,b){var c=a[2]-b[2];0===c&&k&&(c=a[4]-b[4]);return c});t.length&&(B=6*t[0][2],b[0]=t[0][0]/B,b[1]=t[0][1]/B,k&&(B=6*t[0][4],b[2]=0!==B?t[0][3]/B:0),b[0]<z[0]||b[0]>z[1]||b[1]<z[2]||b[1]>z[3]||k&&(b[2]<z[4]||b[2]>z[5]))&&(b.length=0);if(!b.length)if(c=c.lengths[0]?l(F,0,w[0],k,h):null)b[0]=c[0],b[1]=c[1],k&&2<c.length&&(b[2]=
c[2]);else return null;return a};a.lineCentroid=l})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(C,a,q,l,b,c,k,h,u){function t(a,b){var c;if(!b)return null;if("x"in b){var d={x:0,y:0};a=a(b.x,b.y,B);
d.x=a[0];d.y=a[1];null!=b.z&&(d.z=b.z);null!=b.m&&(d.m=b.m);return d}if("xmin"in b)return d={xmin:0,ymin:0,xmax:0,ymax:0},c=a(b.xmin,b.ymin,B),d.xmin=c[0],d.ymin=c[1],a=a(b.xmax,b.ymax,B),d.xmax=a[0],d.ymax=a[1],b.hasZ&&(d.zmin=b.zmin,d.zmax=b.zmax,d.hasZ=!0),b.hasM&&(d.mmin=b.mmin,d.mmax=b.mmax,d.hasM=!0),d;if("rings"in b)return{rings:z(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:z(b.paths,a),hasM:b.hasM,hasZ:b.hasZ};if("points"in b)return{points:w(b.points,a),hasM:b.hasM,hasZ:b.hasZ}}
function z(a,b){for(var c=[],d=0;d<a.length;d++)c.push(w(a[d],b));return c}function w(a,b){for(var c=[],d=0;d<a.length;d++){var h=a[d],n=b(h[0],h[1],[0,0]);c.push(n);2<h.length&&n.push(h[2]);3<h.length&&n.push(h[3])}return c}function F(a,b){return!h.isValid(a)||!h.isValid(b)||h.equals(a,b)||u.canProject(a,b)?!1:!0}Object.defineProperty(a,"__esModule",{value:!0});var B=[0,0];a.checkProjectionSupport=function(a,c){return l(this,void 0,void 0,function(){var d,h,r;return q(this,function(g){if(!c)return[2];
if(Array.isArray(a)){d=0;for(h=a;d<h.length;d++)if(r=h[d],F(r.geometry&&r.geometry.spatialReference,c)){if(k.isSupported())return[2,k.load()];throw new b("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:c});}return[2]}if(!F(a,c))return[2];if(k.isSupported())return[2,k.load()];throw new b("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:c});})})};var I=t.bind(null,u.lngLatToXY),E=t.bind(null,
u.xyToLngLat);a.project=function(a,b,c){c||(c=b,b=a.spatialReference);return h.isValid(b)&&h.isValid(c)&&!h.equals(b,c)?u.canProject(b,c)?h.isWebMercator(c)?I(a):E(a):k.projectMany([a],b,c,null,!0)[0]:a};var G=new (function(){function a(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a,b,d){return l(this,void 0,void 0,function(){var g,n=this;return q(this,function(r){a&&a.length&&b&&d&&!h.equals(b,d)||c.resolve(a);g={geometries:a,inSpatialReference:b,
outSpatialReference:d,resolve:null};this._jobs.push(g);return[2,c.create(function(a){g.resolve=a;null===n._timer&&(n._timer=setTimeout(n._process,10))},function(){var a=n._jobs.indexOf(g);-1<a&&n._jobs.splice(a,1)})]})})};a.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var b=a.geometries,c=a.inSpatialReference,d=a.outSpatialReference,a=a.resolve;u.canProject(c,d)?h.isWebMercator(d)?a(b.map(I)):a(b.map(E)):a(k.projectMany(b,c,d,null,!0));0<this._jobs.length&&(this._timer=
setTimeout(this._process,10))}};return a}());a.projectMany=function(a,b,c){return l(this,void 0,void 0,function(){return q(this,function(d){return[2,G.push(a,b,c)]})})}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),function(C,a,q,l,b,c){function k(a,k,l,t,q){void 0===t&&(t=null);void 0===q&&(q=!1);if(null===t){var G=c.cacheKey(k,l);void 0!==z[G]?t=z[G]:(t=h(k,l,null),null===t&&(t=new c),
z[G]=t)}return u._project(a,k,l instanceof b||!1===q?l:new b(l),t,q)}function h(a,b,h){void 0===h&&(h=null);a=u._getTransformation(a,b,h);return null!==a?c.fromGE(a):null}Object.defineProperty(a,"__esModule",{value:!0});var u=null;a.isLoaded=function(){return!!u&&l.isLoaded()};a.isSupported=function(){return l.isSupported()};var t=null;a.load=function(){return t?t:t=q.create(function(a,b){var c=l.load();C(["./geometryEngine"],function(h){u=h;c.then(function(){u._enableProjection(l);a()},function(a){b(a)})})})};
a.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:k(a,a[0].spatialReference,b,c):k([a],a.spatialReference,b,c)[0]};var z={};a.projectMany=k;a.getTransformation=h;a.getTransformations=function(a,b,h){void 0===h&&(h=null);a=u._getTransformationBySuitability(a,b,h);if(null!==a){b=[];for(h=0;h<a.length;h++)b.push(c.fromGE(a[h]));return b}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],
function(C,a,q,l,b){function c(b){function c(a,b,c){a[b]=c(a[b])}a._pe=b;w.init();F.init();B.init();I.init();E.init();a.PeGCSExtent=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}q(c,b);c.prototype.destroy=function(){a._pe.destroy(this)};return c}(a._pe.PeGCSExtent);for(var h=0,g=[a._pe.PeDatum,a._pe.PeGeogcs,a._pe.PeGeogtran,a._pe.PeObject,a._pe.PeParameter,a._pe.PePrimem,a._pe.PeProjcs,a._pe.PeSpheroid,a._pe.PeUnit];h<g.length;h++)b=g[h],c(b.prototype,"getName",function(a){return function(){return a.call(this,
Array(w.PE_NAME_MAX))}});h=0;for(g=[a._pe.PeGeogtran,a._pe.PeProjcs];h<g.length;h++)b=g[h],c(b.prototype,"getParameters",function(b){return function(){for(var c=Array(w.PE_PARM_MAX),d=b.call(this),h=0;h<c.length;h++){var g=a._pe.getValue(d,"*");c[h]=g?a._pe.wrapPointer(g,a._pe.PeParameter):null;d+=Int32Array.BYTES_PER_ELEMENT}return c}});c(a._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var c=[],d=a.call(this);t(c,b,d);return c}});c(a._pe.PeGTlistExtendedEntry.prototype,
"getEntries",function(b){var c=a._pe._pe_getPeGTlistExtendedGTsSize();return function(){var d=null,h=b.call(this);if(!a._pe.compare(h,a._pe.NULL)){var d=[h],g=this.getSteps();if(1<g)for(var h=a._pe.getPointer(h),r=1;r<g;r++)d.push(a._pe.wrapPointer(h+c*r,a._pe.PeGTlistExtendedGTs))}return d}});var p=a._pe._pe_getPeHorizonSize();b=function(b){return function(){var c=this._cache;c||(this._cache=c=new Map);if(c.has(b))return c.get(b);var d=null,h=b.call(this);if(!a._pe.compare(h,a._pe.NULL)){var d=[h],
g=h.getNump();if(1<g)for(var h=a._pe.getPointer(h),r=1;r<g;r++)d.push(a._pe.wrapPointer(h+p*r,a._pe.PeHorizon))}c.set(b,d);return d}};c(a._pe.PeProjcs.prototype,"horizonGcsGenerate",b);c(a._pe.PeProjcs.prototype,"horizonPcsGenerate",b);a._pe.PeObject.prototype.toString=function(b){void 0===b&&(b=w.PE_STR_OPTS_NONE);a._pe.ensureCache.prepare();var c=a._pe.getPointer(this),d=a._pe.ensureInt8(Array(w.PE_BUFFER_MAX));return a._pe.UTF8ToString(a._pe._pe_object_to_string_ext(c,b,d))}}function k(b){if(b){var c=
a._pe.getClass(b);c&&(c=a._pe.getCache(c))&&(b=a._pe.getPointer(b))&&delete c[b]}}function h(b,c){var d=[];c=Array(c);for(var h=0;h<b;h++)d.push(a._pe.ensureInt8(c));return d}function u(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):b=a;return b}function t(b,c,h,g){void 0===g&&(g=!1);if(g)for(g=0;g<2*c;g++)b[g]=a._pe.getValue(h+g*Float64Array.BYTES_PER_ELEMENT,"double");else{var d=0===b.length;for(g=0;g<c;g++)d&&(b[g]=Array(2)),b[g][0]=a._pe.getValue(h,"double"),b[g][1]=
a._pe.getValue(h+Float64Array.BYTES_PER_ELEMENT,"double"),h+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(a,"__esModule",{value:!0});var z;a._pe=null;a.isLoaded=function(){return!!a._pe};a.isSupported=function(){return!!l("esri-wasm")};a.load=function(){return z?z:z=b.create(function(a,b){C(["./support/pe-wasm"],function(d){d({locateFile:function(a){return C.toUrl("./support/"+a)},onAbort:function(a){b(Error(a))}}).then(function(b){c(b);a()})})})};(function(b){function c(b,c,d){a._pe.ensureCache.prepare();
var h=u(d),g=d===h,h=a._pe.ensureFloat64(h);(b=a._pe._pe_geog_to_proj(a._pe.getPointer(b),c,h))&&t(d,c,h,g);return b}function h(a,b,c){return g(a,b,c,0)}function g(b,c,d,h){a._pe.ensureCache.prepare();var g=u(d),r=d===g,g=a._pe.ensureFloat64(g);(b=a._pe._pe_proj_to_geog_center(a._pe.getPointer(b),c,g,h))&&t(d,c,g,r);return b}b.geogToProj=c;b.projGeog=function(a,b,d,g){switch(g){case w.PE_TRANSFORM_P_TO_G:return h(a,b,d);case w.PE_TRANSFORM_G_TO_P:return c(a,b,d)}return 0};b.projToGeog=h;b.projToGeogCenter=
g})(a.PeCSTransformations||(a.PeCSTransformations={}));var w;(function(b){b.init=function(){b.PE_BUFFER_MAX=a._pe.PeDefs.prototype.PE_BUFFER_MAX;b.PE_NAME_MAX=a._pe.PeDefs.prototype.PE_NAME_MAX;b.PE_MGRS_MAX=a._pe.PeDefs.prototype.PE_MGRS_MAX;b.PE_USNG_MAX=a._pe.PeDefs.prototype.PE_USNG_MAX;b.PE_DD_MAX=a._pe.PeDefs.prototype.PE_DD_MAX;b.PE_DDM_MAX=a._pe.PeDefs.prototype.PE_DDM_MAX;b.PE_DMS_MAX=a._pe.PeDefs.prototype.PE_DMS_MAX;b.PE_UTM_MAX=a._pe.PeDefs.prototype.PE_UTM_MAX;b.PE_PARM_MAX=a._pe.PeDefs.prototype.PE_PARM_MAX;
b.PE_TYPE_NONE=a._pe.PeDefs.prototype.PE_TYPE_NONE;b.PE_TYPE_GEOGCS=a._pe.PeDefs.prototype.PE_TYPE_GEOGCS;b.PE_TYPE_PROJCS=a._pe.PeDefs.prototype.PE_TYPE_PROJCS;b.PE_TYPE_GEOGTRAN=a._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;b.PE_TYPE_COORDSYS=a._pe.PeDefs.prototype.PE_TYPE_COORDSYS;b.PE_TYPE_UNIT=a._pe.PeDefs.prototype.PE_TYPE_UNIT;b.PE_STR_OPTS_NONE=a._pe.PeDefs.prototype.PE_STR_OPTS_NONE;b.PE_STR_AUTH_NONE=a._pe.PeDefs.prototype.PE_STR_AUTH_NONE;b.PE_STR_AUTH_TOP=a._pe.PeDefs.prototype.PE_STR_AUTH_TOP;
b.PE_STR_NAME_CANON=a._pe.PeDefs.prototype.PE_STR_NAME_CANON;b.PE_PARM_X0=a._pe.PeDefs.prototype.PE_PARM_X0;b.PE_PARM_ND=a._pe.PeDefs.prototype.PE_PARM_ND;b.PE_TRANSFORM_1_TO_2=a._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;b.PE_TRANSFORM_2_TO_1=a._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;b.PE_TRANSFORM_P_TO_G=a._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;b.PE_TRANSFORM_G_TO_P=a._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;b.PE_HORIZON_RECT=a._pe.PeDefs.prototype.PE_HORIZON_RECT;b.PE_HORIZON_POLY=a._pe.PeDefs.prototype.PE_HORIZON_POLY;
b.PE_HORIZON_LINE=a._pe.PeDefs.prototype.PE_HORIZON_LINE;b.PE_HORIZON_DELTA=a._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(w=a.PeDefs||(a.PeDefs={}));(function(b){function c(b,c){var d=null,k=g[b];k||(k={},g[b]=k);k.hasOwnProperty(String(c))?d=k[c]:(b=a._pe.PeFactory.prototype.factoryByType(b,c),a._pe.compare(b,a._pe.NULL)||(d=b,k[c]=d));return d=h(d)}function h(b){if(b){var c=b.getType();switch(c){case w.PE_TYPE_GEOGCS:b=a._pe.castObject(b,a._pe.PeGeogcs);break;case w.PE_TYPE_PROJCS:b=a._pe.castObject(b,
a._pe.PeProjcs);break;case w.PE_TYPE_GEOGTRAN:b=a._pe.castObject(b,a._pe.PeGeogtran);break;default:c&w.PE_TYPE_UNIT&&(b=a._pe.castObject(b,a._pe.PeUnit))}}return b}var g={},k={};b.initialize=function(){a._pe.PeFactory.prototype.initialize(null)};b.coordsys=function(a){return c(w.PE_TYPE_COORDSYS,a)};b.factoryByType=c;b.fromString=function(b,c){var d=null,g=k[b];g||(g={},k[b]=g);g.hasOwnProperty(c)?d=g[c]:(b=a._pe.PeFactory.prototype.fromString(b,c),a._pe.compare(b,a._pe.NULL)||(d=b,g[c]=d));return d=
h(d)};b.geogcs=function(a){return c(w.PE_TYPE_GEOGCS,a)};b.geogtran=function(a){return c(w.PE_TYPE_GEOGTRAN,a)};b.getCode=function(b){return a._pe.PeFactory.prototype.getCode(b)};b.projcs=function(a){return c(w.PE_TYPE_PROJCS,a)};b.unit=function(a){return c(w.PE_TYPE_UNIT,a)}})(a.PeFactory||(a.PeFactory={}));a.PeGCSExtent=null;var F;(function(b){var c;b.init=function(){b.PE_GTLIST_OPTS_COMMON=a._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;c=a._pe._pe_getPeGTlistExtendedEntrySize()};b.getGTlist=
function(b,d,h,k,l,u){var g=null,p=new a._pe.PeInteger(u);try{var n=a._pe.PeGTlistExtended.prototype.getGTlist(b,d,h,k,l,p);if(u=p.val)if(g=[n],1<u){var r=a._pe.getPointer(n);for(b=1;b<u;b++)g.push(a._pe.wrapPointer(r+c*b,a._pe.PeGTlistExtendedEntry))}}finally{a._pe.destroy(p)}return g}})(F=a.PeGTlistExtended||(a.PeGTlistExtended={}));(function(b){b.destroy=function(b){if(b&&b.length){for(var c=0;c<b.length;c++){var d=b[c];k(d);d.getEntries().forEach(function(a){k(a);a=a.getGeogtran();k(a);a.getParameters().forEach(k);
[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){k(a);var b=a.getDatum();k(b);k(b.getSpheroid());k(a.getPrimem());k(a.getUnit())})})}a._pe.PeGTlistExtendedEntry.prototype.Delete(b[0])}}})(a.PeGTlistExtendedEntry||(a.PeGTlistExtendedEntry={}));(function(b){b.geogToGeog=function(b,c,h,k,r){a._pe.ensureCache.prepare();var d=u(h),g=h===d,d=a._pe.ensureFloat64(d),p=0;k&&(p=a._pe.ensureFloat64(k));(b=a._pe._pe_geog_to_geog(a._pe.getPointer(b),c,d,p,r))&&t(h,c,d,g);return b}})(a.PeGTTransformations||
(a.PeGTTransformations={}));(function(b){function c(b,c,d,k,n,l){a._pe.ensureCache.prepare();var g,p;switch(b){case "dd":g=a._pe._pe_geog_to_dd;p=w.PE_DD_MAX;break;case "ddm":g=a._pe._pe_geog_to_ddm;p=w.PE_DDM_MAX;break;case "dms":g=a._pe._pe_geog_to_dms,p=w.PE_DMS_MAX}b=0;c&&(b=a._pe.getPointer(c));c=u(k);c=a._pe.ensureFloat64(c);p=h(d,p);k=a._pe.ensureInt32(p);if(n=g(b,d,c,n,k))for(g=0;g<d;g++)l[g]=a._pe.UTF8ToString(p[g]);return n}function k(b,c,d,h,k){a._pe.ensureCache.prepare();var g;switch(b){case "dd":g=
a._pe._pe_dd_to_geog;break;case "ddm":g=a._pe._pe_ddm_to_geog;break;case "dms":g=a._pe._pe_dms_to_geog}b=0;c&&(b=a._pe.getPointer(c));c=h.map(function(b){return a._pe.ensureString(b)});h=a._pe.ensureInt32(c);c=a._pe.ensureFloat64(Array(2*d));(g=g(b,d,h,c))&&t(k,d,c);return g}b.geog_to_dms=function(a,b,d,h,k){return c("dms",a,b,d,h,k)};b.dms_to_geog=function(a,b,c,d){return k("dms",a,b,c,d)};b.geog_to_ddm=function(a,b,d,h,k){return c("ddm",a,b,d,h,k)};b.ddm_to_geog=function(a,b,c,d){return k("ddm",
a,b,c,d)};b.geog_to_dd=function(a,b,d,h,k){return c("dd",a,b,d,h,k)};b.dd_to_geog=function(a,b,c,d){return k("dd",a,b,c,d)}})(a.PeNotationDms||(a.PeNotationDms={}));var B;(function(b){b.init=function(){b.PE_MGRS_STYLE_NEW=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;b.PE_MGRS_STYLE_OLD=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;b.PE_MGRS_STYLE_AUTO=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;b.PE_MGRS_180_ZONE_1_PLUS=a._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;b.PE_MGRS_ADD_SPACES=
a._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};b.geog_to_mgrs_extended=function(b,c,g,k,l,A,t){a._pe.ensureCache.prepare();var d=0;b&&(d=a._pe.getPointer(b));b=u(g);g=a._pe.ensureFloat64(b);b=h(c,w.PE_MGRS_MAX);var n=a._pe.ensureInt32(b);if(k=a._pe._pe_geog_to_mgrs_extended(d,c,g,k,l,A,n))for(l=0;l<c;l++)t[l]=a._pe.UTF8ToString(b[l]);return k};b.mgrs_to_geog_extended=function(b,c,h,k,l){a._pe.ensureCache.prepare();var d=0;b&&(d=a._pe.getPointer(b));b=h.map(function(b){return a._pe.ensureString(b)});
h=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(k=a._pe._pe_mgrs_to_geog_extended(d,c,h,k,b))&&t(l,c,b);return k}})(B=a.PeNotationMgrs||(a.PeNotationMgrs={}));(function(b){b.geog_to_usng=function(b,c,g,k,l,t,D){a._pe.ensureCache.prepare();var d=0;b&&(d=a._pe.getPointer(b));b=u(g);g=a._pe.ensureFloat64(b);b=h(c,w.PE_MGRS_MAX);var n=a._pe.ensureInt32(b);if(k=a._pe._pe_geog_to_usng(d,c,g,k,l,t,n))for(l=0;l<c;l++)D[l]=a._pe.UTF8ToString(b[l]);return k};b.usng_to_geog=function(b,c,h,k){a._pe.ensureCache.prepare();
var d=0;b&&(d=a._pe.getPointer(b));b=h.map(function(b){return a._pe.ensureString(b)});h=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(d=a._pe._pe_usng_to_geog(d,c,h,b))&&t(k,c,b);return d}})(a.PeNotationUsng||(a.PeNotationUsng={}));var I;(function(b){b.init=function(){b.PE_UTM_OPTS_NONE=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;b.PE_UTM_OPTS_ADD_SPACES=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;b.PE_UTM_OPTS_NS=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};b.geog_to_utm=function(b,
c,k,l,r){a._pe.ensureCache.prepare();var d=0;b&&(d=a._pe.getPointer(b));b=u(k);k=a._pe.ensureFloat64(b);b=h(c,w.PE_UTM_MAX);var g=a._pe.ensureInt32(b);if(l=a._pe._pe_geog_to_utm(d,c,k,l,g))for(d=0;d<c;d++)r[d]=a._pe.UTF8ToString(b[d]);return l};b.utm_to_geog=function(b,c,h,k,l){a._pe.ensureCache.prepare();var d=0;b&&(d=a._pe.getPointer(b));b=h.map(function(b){return a._pe.ensureString(b)});h=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(k=a._pe._pe_utm_to_geog(d,c,h,k,b))&&t(l,c,b);return k}})(I=
a.PeNotationUtm||(a.PeNotationUtm={}));var E;(function(b){var c=new Map;b.init=function(){b.PE_PCSINFO_OPTION_NONE=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;b.PE_PCSINFO_OPTION_DOMAIN=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;b.PE_POLE_OUTSIDE_BOUNDARY=a._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;b.PE_POLE_POINT=a._pe.PePCSInfo.prototype.PE_POLE_POINT};b.generate=function(h,d){void 0===d&&(d=b.PE_PCSINFO_OPTION_DOMAIN);var k,g;c.has(h)&&(g=c.get(h),g[d]&&(k=g[d]));k||(k=a._pe.PePCSInfo.prototype.generate(h,
d),g||(g=[],c.set(h,g)),g[d]=k);return k}})(E=a.PePCSInfo||(a.PePCSInfo={}));(function(b){b.version_string=function(){return a._pe.PeVersion.prototype.version_string()}})(a.PeVersion||(a.PeVersion={}));a._init=c})},"esri/geometry/support/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(C,a,q){return function(){function a(a){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(a&&a.steps){var b=0;for(a=a.steps;b<
a.length;b++){var k=a[b];k instanceof q?this.steps.push(k):this.steps.push(new q({wkid:k.wkid,wkt:k.wkt,isInverse:k.isInverse}))}}}a.cacheKey=function(a,c){return[void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():"",void 0!==c.wkid&&null!==c.wkid?c.wkid.toString():"-1",void 0!==c.wkt&&null!==c.wkt?c.wkt.toString():""].join()};a.fromGE=function(b){var c=new a,k="",h=0;for(b=b.steps;h<b.length;h++){var l=q.fromGE(b[h]);c.steps.push(l);k+=l.uid.toString()+
","}c._cached_projection={};c._gtlistentry=null;c._chain=k;return c};a.prototype.getInverse=function(){var b=new a;b.steps=[];for(var c=this.steps.length-1;0<=c;c--)b.steps.push(this.steps[c].getInverse());return b};a.prototype.getGTListEntry=function(){for(var a="",c=0,k=this.steps;c<k.length;c++)a+=k[c].uid.toString()+",";a!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=a);return this._gtlistentry};a.prototype.assignCachedGe=function(b,c,k){this._cached_projection[a.cacheKey(b,
c)]=k};a.prototype.getCachedGeTransformation=function(b,c){for(var k="",h=0,l=this.steps;h<l.length;h++)k+=l[h].uid.toString()+",";k!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=k);b=this._cached_projection[a.cacheKey(b,c)];return void 0===b?null:b};return a}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(C,a){var q=0;return function(){function a(a){void 0===a&&(a=null);this.uid=q++;a?(this._wkt=void 0!==
a.wkt?a.wkt:null,this._wkid=void 0!==a.wkid?a.wkid:-1,this._isInverse=void 0!==a.isInverse?!0===a.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}a.fromGE=function(b){var c=new a;c._wkt=b.wkt;c._wkid=b.wkid;c._isInverse=b.isInverse;return c};Object.defineProperty(a.prototype,"wkt",{get:function(){return this._wkt},set:function(a){this._wkt=a;this.uid=q++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wkid",{get:function(){return this._wkid},set:function(a){this._wkid=
a;this.uid=q++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isInverse",{get:function(){return this._isInverse},set:function(a){this._isInverse=a;this.uid=q++},enumerable:!0,configurable:!0});a.prototype.getInverse=function(){var b=new a;b._wkt=this.wkt;b._wkid=this._wkid;b._isInverse=!this.isInverse;return b};return a}()})},"esri/layers/graphics/data/QueryEngine":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/iteratorUtils ../../../core/lang ../../../core/Logger ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../support/PromiseQueue".split(" "),
function(C,a,q,l,b,c,k,h,u,t,z,w,F,B,I,E,G,d,n,g,p,r,A,D,V,W){Object.defineProperty(a,"__esModule",{value:!0});var J=u.getLogger("esri.layers.graphics.data.QueryEngine");C=function(){return function(a,b,c,m,d){void 0===b&&(b=null);this.attributes=a;this.geometry=c;this.centroid=m;this.filterFlags=d;this.groupId=-1;this.localId=b}}();a.Feature=C;var R=new Set,H=new t.MemCacheStorage(2E6),m=0;C=function(){function a(a){var b=this;this.capabilities={query:g.queryCapabilities};this.geometryType=a.geometryType;
this.hasM=a.hasM;this.hasZ=a.hasZ;this.objectIdField=a.objectIdField;this.spatialReference=a.spatialReference;this.definitionExpression=a.definitionExpression;this.cacheSpatialQueries=a.cacheSpatialQueries||!1;this.gdbVersion=a.gdbVersion;this.historicMoment=a.historicMoment;this.featureStore=a.featureStore;this._changeHandle=this.featureStore.events.on("changed",function(){return b.clearCache()});this.timeInfo=a.timeInfo;this.cacheSpatialQueries&&(this._geometryQueryCache=new t.MemCache(m++ +"$$",
H));this.fieldsIndex=new V(a.fields);a.scheduler&&a.task&&(this._frameQueue=new W.PromiseQueue,this._frameTask=a.scheduler.registerTask(a.task,function(a){return b._update(a)},function(){return 0<b._frameQueue.length}))}a.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=
null);this.fieldsIndex.destroy()};Object.defineProperty(a.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullExtent",{get:function(){var a=this.featureStore.fullBounds;return a?{xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:D.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"timeExtent",{get:function(){return this.timeInfo?
this._timeExtent?this._timeExtent:this._timeExtent=A.getTimeExtent(this.timeInfo,this.featureStore):null},enumerable:!0,configurable:!0});a.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};a.prototype.executeQuery=function(a,c){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,c,m;return l(this,function(d){switch(d.label){case 0:b=h.clone(a),d.label=1;case 1:return d.trys.push([1,14,,15]),[4,this._schedule()];
case 2:return d.sent(),[4,D.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=d.sent(),[4,this._reschedule()];case 4:return d.sent(),[4,this._checkQuerySupport(b)];case 5:return b=d.sent(),[4,this._reschedule()];case 6:return d.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=d.sent(),[4,this._reschedule()];case 8:return d.sent(),[4,c.executeObjectIdsQuery(b)];case 9:return c=d.sent(),[4,this._reschedule()];case 10:return d.sent(),[4,c.executeTimeQuery(b)];
case 11:return c=d.sent(),[4,this._reschedule()];case 12:return d.sent(),[4,c.executeAttributesQuery(b)];case 13:return c=d.sent(),[3,15];case 14:m=d.sent();if(m!==D.QUERY_ENGINE_EMPTY_RESULT)throw m;c=new p.default([],null,this);return[3,15];case 15:return[2,c.createQueryResponse(b)]}})})};a.prototype.executeQueryForCount=function(a,c){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,c,m;return l(this,function(d){switch(d.label){case 0:b=h.clone(a),b.returnGeometry=!1,b.returnCentroid=
!1,b.outSR=null,d.label=1;case 1:return d.trys.push([1,14,,15]),[4,this._schedule()];case 2:return d.sent(),[4,D.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=d.sent(),[4,this._reschedule()];case 4:return d.sent(),[4,this._checkQuerySupport(b)];case 5:return b=d.sent(),[4,this._reschedule()];case 6:return d.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=d.sent(),[4,this._reschedule()];case 8:return d.sent(),[4,c.executeObjectIdsQuery(b)];case 9:return c=
d.sent(),[4,this._reschedule()];case 10:return d.sent(),[4,c.executeTimeQuery(b)];case 11:return c=d.sent(),[4,this._reschedule()];case 12:return d.sent(),[4,c.executeAttributesQuery(b)];case 13:return c=d.sent(),[2,c.size];case 14:m=d.sent();if(m!==D.QUERY_ENGINE_EMPTY_RESULT)throw m;return[2,0];case 15:return[2]}})})};a.prototype.executeQueryForExtent=function(a,c){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,c,m,d,k,g,p,u;return l(this,function(l){switch(l.label){case 0:b=h.clone(a),
m=b.outSR,l.label=1;case 1:return l.trys.push([1,14,,15]),[4,this._schedule()];case 2:return l.sent(),[4,D.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=l.sent(),[4,this._reschedule()];case 4:return l.sent(),[4,this._checkQuerySupport(b)];case 5:return b=l.sent(),b.returnGeometry=!0,b.returnCentroid=!1,b.outSR=null,[4,this._reschedule()];case 6:return l.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=l.sent(),[4,this._reschedule()];case 8:return l.sent(),
[4,c.executeObjectIdsQuery(b)];case 9:return c=l.sent(),[4,this._reschedule()];case 10:return l.sent(),[4,c.executeTimeQuery(b)];case 11:return c=l.sent(),[4,this._reschedule()];case 12:return l.sent(),[4,c.executeAttributesQuery(b)];case 13:c=l.sent();d=c.size;if(!d)return[2,{count:d,extent:null}];F.set(P,F.NEGATIVE_INFINITY);this.featureStore.forEachBounds(c.items,function(a){return F.expand(P,a)},x);k={xmin:P[0],ymin:P[1],xmax:P[3],ymax:P[4],spatialReference:D.cleanFromGeometryEngine(this.spatialReference)};
this.hasZ&&isFinite(P[2])&&isFinite(P[5])&&(k.zmin=P[2],k.zmax=P[5]);g=n.project(k,c.spatialReference,m);g.spatialReference=D.cleanFromGeometryEngine(m||this.spatialReference);0===g.xmax-g.xmin&&(p=w.getMetersPerUnitForSR(g.spatialReference),g.xmin-=p,g.xmax+=p);0===g.ymax-g.ymin&&(p=w.getMetersPerUnitForSR(g.spatialReference),g.ymin-=p,g.ymax+=p);this.hasZ&&null!=g.zmin&&null!=g.zmax&&0===g.zmax-g.zmin&&(p=w.getMetersPerUnitForSR(g.spatialReference),g.zmin-=p,g.zmax+=p);return[2,{count:d,extent:g}];
case 14:u=l.sent();if(u===D.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw u;case 15:return[2]}})})};a.prototype.executeQueryForIds=function(a,c){void 0===a&&(a={});return b(this,void 0,void 0,function(){return l(this,function(b){return[2,this.executeQueryForIdSet(a,c).then(function(a){return k.valuesOfSet(a)})]})})};a.prototype.executeQueryForIdSet=function(a,c){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,c,m,d,g,x,k,n;return l(this,function(l){switch(l.label){case 0:b=
h.clone(a),b.returnGeometry=!1,b.returnCentroid=!1,b.outSR=null,l.label=1;case 1:return l.trys.push([1,13,,14]),[4,this._schedule()];case 2:return l.sent(),[4,D.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=l.sent(),[4,this._reschedule()];case 4:return l.sent(),[4,this._executeGeometryQuery(b)];case 5:return c=l.sent(),[4,this._reschedule()];case 6:return l.sent(),[4,c.executeObjectIdsQuery(b)];case 7:return c=l.sent(),[4,this._reschedule()];case 8:return l.sent(),
[4,c.executeTimeQuery(b)];case 9:return c=l.sent(),[4,this._reschedule()];case 10:return l.sent(),[4,c.executeAttributesQuery(b)];case 11:return c=l.sent(),[4,this._reschedule()];case 12:l.sent();m=c.items;d=new Set;g=0;for(x=m;g<x.length;g++)k=x[g],d.add(c.featureAdapter.getObjectId(k));return[2,d];case 13:n=l.sent();if(n===D.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw n;case 14:return[2]}})})};a.prototype.executeQueryForLatestObservations=function(a,b){var m=this;if(this.timeInfo)return this.executeQuery(a,
b).then(function(a){return m._filterLatest(a,m.timeInfo)});J.error(new c("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))};a.prototype._schedule=function(a){return b(this,void 0,void 0,function(){return l(this,function(b){return this._frameQueue?[2,this._frameQueue.push(a).then(function(a){return a})]:[2,a]})})};a.prototype._reschedule=function(a){return b(this,void 0,void 0,function(){return l(this,function(b){return this._frameQueue?[2,this._frameQueue.unshift(a).then(function(a){return a})]:
[2,a]})})};a.prototype._update=function(a){for(this._budget=a;!a.done&&this._frameQueue&&this._frameQueue.process();)a.madeProgress();this._budget=null};a.prototype._filterLatest=function(a,b){var c=b.trackIdField,m=b.startTimeField;b=b.endTimeField||m;for(var m=new Map,d=[],h=0,g=a.features;h<g.length;h++){var x=g[h],k=x.attributes[c],l=x.attributes[b];(!m.has(k)||m.get(k).attributes[b]<l)&&m.set(k,x)}m.forEach(function(a){return d.push(a)});return q({},a,{features:d})};a.prototype._getAll=function(){if(!this._allItems){var a=
[];this.featureStore.forEach(function(b){return a.push(b)});this._allItems=new p.default(a,null,this)}return this._allItems};a.prototype._executeGeometryQuery=function(a){return b(this,void 0,void 0,function(){var c,m,d,h,g,x,k,n,u,H,t,P,A,J,aa,w,D,q,R,z,ma,F,B,E,W=this;return l(this,function(Y){switch(Y.label){case 0:c=a.geometry;m=a.outSR;d=a.spatialRel;h=G.isValid(m)&&!G.equals(this.spatialReference,m);if(g=this.cacheSpatialQueries?h?JSON.stringify({geometry:c,spatialRelationship:d,outSpatialReference:m}):
JSON.stringify({geometry:c,spatialRelationship:d}):null)if(x=this._geometryQueryCache.get(g),void 0!==x)return[2,x];k=function(c){return b(W,void 0,void 0,function(){var b;return l(this,function(d){switch(d.label){case 0:return h&&(a.returnGeometry||a.returnCentroid)?[4,c.project(m)]:[3,2];case 1:return b=d.sent(),g&&this._geometryQueryCache.put(g,b,b.size||1),[2,b];case 2:return g&&this._geometryQueryCache.put(g,c,c.size||1),[2,c]}})})};if(!c)return[2,k(this._getAll())];n=this.featureAdapter;if("esriSpatialRelDisjoint"!==
d)return[3,5];u=this._searchFeatures(this._getQueryBBoxes(c));if(!u.length)return[2,k(this._getAll())];P=new Set;A=0;for(J=u;A<J.length;A++)aa=J[A],P.add(n.getObjectId(aa));return[4,this._reschedule(P)];case 1:return P=Y.sent(),w=0,H=Array(P.size),this.featureStore.forEach(function(a){return H[w++]=a}),t=P,[4,this._reschedule()];case 2:return Y.sent(),[4,r.getSpatialQueryOperator(d,c,this)];case 3:return D=Y.sent(),q=function(a){return!t.has(n.getObjectId(a))||D(n.getGeometry(a))},z=p.default.bind,
[4,this._runSpatialFilter(H,q)];case 4:return R=new (z.apply(p.default,[void 0,Y.sent(),c,this])),[2,k(R)];case 5:return ma=this._searchFeatures(this._getQueryBBoxes(c)),ma.length?(F=this._canExecuteSoloPass(c,a))?[2,k(new p.default(ma,c,this))]:[4,r.getSpatialQueryOperator(d,c,this)]:(R=new p.default([],c,this),g&&this._geometryQueryCache.put(g,R,R.size||1),[2,R]);case 6:return B=Y.sent(),[4,this._runSpatialFilter(ma,function(a){return B(n.getGeometry(a))})];case 7:return E=Y.sent(),[2,k(new p.default(E,
c,this))]}})})};a.prototype._runSpatialFilter=function(a,c){return b(this,void 0,void 0,function(){var m,d,h,g=this;return l(this,function(k){if(!c)return[2,a];if(!this._budget)return[2,a.filter(function(a){return c(a)})];m=0;d=[];h=function(){return b(g,void 0,void 0,function(){var b;return l(this,function(g){switch(g.label){case 0:if(!(m<a.length))return[3,3];b=a[m];c(b)&&d.push(b);return this._budget.done?[4,this._reschedule()]:[3,2];case 1:return g.sent(),[2,h()];case 2:return++m,[3,0];case 3:return[2]}})})};
return[2,this._reschedule().then(function(){return h()}).then(function(){return d})]})})};a.prototype._canExecuteSoloPass=function(a,b){var c=this.geometryType;b=b.spatialRel;return r.canQueryWithRBush(a)&&("esriSpatialRelEnvelopeIntersects"===b||"esriGeometryPoint"===c&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b||"esriSpatialRelWithin"===b))};a.prototype._getQueryBBoxes=function(a){if(r.canQueryWithRBush(a)){if(E.isExtent(a))return[B.fromValues(a.xmin,a.ymin,a.xmax,a.ymax)];if(E.isPolygon(a))return a.rings.map(function(a){return B.fromValues(Math.min(a[0][0],
a[2][0]),Math.min(a[0][1],a[2][1]),Math.max(a[0][0],a[2][0]),Math.max(a[0][1],a[2][1]))})}return[I.getBoundsXY(B.create(),a)]};a.prototype._searchFeatures=function(a){for(var b=0;b<a.length;b++)this.featureStore.forEachInBounds(a[b],function(a){R.add(a)});var c=Array(R.size),m=0;R.forEach(function(a){return c[m++]=a});R.clear();return c};a.prototype._checkQuerySupport=function(a){return b(this,void 0,void 0,function(){return l(this,function(b){if(0>a.distance||null!=a.geometryPrecision||a.multipatchOption||
a.pixelSize||a.relationParam||a.text)throw new c("feature-store:unsupported-query","Unsupported query options",{query:a});return[2,z.all([this._checkAttributesQuerySupport(a),this._checkStatisticsQuerySupport(a),r.checkSpatialQuerySupport(a,this.geometryType,this.spatialReference),n.checkProjectionSupport(this.spatialReference,a.outSR)]).then(function(){return a})]})})};a.prototype._checkAttributesQuerySupport=function(a){var b=a.outFields,m=a.orderByFields,h=a.returnDistinctValues;m&&0<m.length&&
(m=m.map(function(a){return-1<a.indexOf(" ASC")?a.split(" ASC")[0]:-1<a.indexOf(" DESC")?a.split(" DESC")[0]:a}),d.validateFields(this.fieldsIndex,m,"orderByFields contains missing fields"));if(b&&0<b.length)d.validateFields(this.fieldsIndex,b,"outFields contains missing fields");else if(h)throw new c("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:a});d.validateWhere(this.fieldsIndex,a.where)};a.prototype._checkStatisticsQuerySupport=function(a){return b(this,
void 0,void 0,function(){var b,m,h,g,k,x,n,p,u,H,r,t;return l(this,function(l){b=a.outStatistics;m=a.groupByFieldsForStatistics;h=a.having;g=m&&m.length;k=b&&b.length;if(h){if(!g||!k)throw new c("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:a});d.validateHaving(this.fieldsIndex,h,b)}if(k){if(x=b.some(function(a){return"exceedslimit"===a.statisticType}))return[2];n=b.map(function(a){return a.onStatisticField});d.validateFields(this.fieldsIndex,
n,"onStatisticFields contains missing fields");g&&d.validateFields(this.fieldsIndex,m,"groupByFieldsForStatistics contains missing fields");p=0;for(u=b;p<u.length;p++){H=u[p];r=H.onStatisticField;t=H.statisticType;if("exceedslimit"===t)throw new c("feature-store:unsupported-query","statistic type exceedslimit is not supported",{definition:H,query:a});if((!g||"count"!==t)&&r&&d.hasInvalidFieldType(r,this.fieldsIndex))throw new c("feature-store:unsupported-query","outStatistics contains non-numeric fields",
{definition:H,query:a});}}return[2]})})};return a}();a.default=C;var x=F.create(),P=F.create()})},"esri/layers/graphics/data/attributeSupport":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/iteratorUtils ../../../core/sql/WhereClauseCache".split(" "),function(C,a,q,l,b,c){function k(a,b){return a?t.get(a,b):null}function h(a,b,c,t){void 0===t&&(t=!0);for(var w=[],q=0;q<b.length;q++){var d=b[q];if("*"!==d&&!a.has(d))if(t){var n=u(d);try{var g=
k(n,a);if(!g)throw new l("feature-store:unsupported-query","invalid SQL expression",{where:n});if(!g.isStandardized)throw new l("feature-store:unsupported-query","expression is not standard",{clause:g});h(a,g.fieldNames,"expression contains missing fields")}catch(p){if((n=p&&p.details)&&(n.clause||n.where))throw p;n&&n.missingFields?w.push.apply(w,n.missingFields):w.push(d)}}else w.push(d)}if(w.length)throw new l("feature-store:unsupported-query",c,{missingFields:w});}function u(a){return a.split(" as ")[0]}
Object.defineProperty(a,"__esModule",{value:!0});var t=new c.WhereClauseCache(50,500),z=b.SetFromValues("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));a.validateWhere=function(a,b){if(!b)return!0;var c=t.get(b,a);if(!c)throw new l("feature-store:unsupported-query","invalid SQL expression",{where:b});if(!c.isStandardized)throw new l("feature-store:unsupported-query","where clause is not standard",
{where:b});h(a,c.fieldNames,"where clause contains missing fields");return!0};a.validateHaving=function(a,b,c){if(!b)return!0;var k=t.get(b,a);if(!k)throw new l("feature-store:unsupported-query","invalid SQL expression",{having:b});if(!k.isAggregate)throw new l("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:b});h(a,k.fieldNames,"having contains missing fields");if(!k.getExpressions().every(function(b){var h=b.aggregateType;b=b.field;var d=a.has(b)&&
a.get(b).name;return c.some(function(b){var c=b.onStatisticField;b=b.statisticType;return(a.has(c)&&a.get(c).name)===d&&b.toLowerCase().trim()===h})}))throw new l("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:b});return!0};a.getWhereClause=k;a.validateFields=h;a.getExpressionFromFieldName=u;a.getAliasFromFieldName=function(a){return a.split(" as ")[1]};a.hasInvalidFieldType=function(a,b){return(a=b.get(a))?!z.has(a.type):!1}})},"esri/core/sql/WhereClauseCache":function(){define(["require",
"exports","../ItemCache","./WhereClause"],function(C,a,q,l){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(a,b){this._cache=new q(a);this._invalidCache=new q(b)}a.prototype.get=function(a,b){var c=b.uid+":"+a,k=this._cache.get(c);if(k)return k;if(void 0!==this._invalidCache.get(c))return null;try{var t=l.WhereClause.create(a,b);this._cache.put(c,t);return t}catch(z){return this._invalidCache.put(c,null),null}};return a}();a.WhereClauseCache=C})},"esri/core/ItemCache":function(){define(["require",
"exports","./MemCache"],function(C,a,q){return function(){function a(a,c){this._storage=new q.MemCacheStorage;this._storage.maxSize=a;c&&this._storage.registerRemoveFunc("",c)}a.prototype.put=function(a,c){this._storage.put(a,c,1,1)};a.prototype.pop=function(a){return this._storage.pop(a)};a.prototype.get=function(a){return this._storage.get(a)};a.prototype.clear=function(){this._storage.clearAll()};a.prototype.destroy=function(){this._storage.clearAll()};return a}()})},"esri/core/sql/WhereClause":function(){define("require exports ../has ../iteratorUtils ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),
function(C,a,q,l,b,c,k){function h(a,b){a+="";return a.length>=b?a:Array(b-a.length+1).join("0")+a}function u(a,b,c,d,g,k,l,n,p){void 0===c&&(c="0");void 0===d&&(d="0");void 0===g&&(g="0");void 0===k&&(k="0");void 0===l&&(l="");void 0===n&&(n="0");void 0===p&&(p="0");return"+"===l||"-"===l?(a=h(parseInt(a,10),4)+"-"+h(parseInt(b,10),2)+"-"+h(parseInt(c,10),2),b="",10>parseFloat(k)&&(b="0"),d=h(parseInt(d,10),2)+":"+h(parseInt(g,10),2)+":"+(b+parseFloat(k).toString()),l=""+l+h(parseInt(n,10),2)+":"+
h(parseInt(p,10),2),new Date(a+"T"+d+l)):new Date(parseInt(a,10),parseInt(b,10),parseInt(c,10),parseInt(d,10),parseInt(g,10),parseFloat(k))}function t(a){var b=D.exec(a);if(null!==b){a=b[1];var c=b[2],d=b[3],h=b[4],g=b[5],k=b[6];return u(a,c,d,h,g,k)}b=V.exec(a);if(null!==b){a=b[1];var c=b[2],d=b[3],h=b[4],g=b[5],k=b[6],l=b[7],n=b[8],b=b[9];return u(a,c,d,h,g,k,l,n,b)}b=W.exec(a);if(null!==b)return a=b[1],c=b[2],d=b[3],h=b[4],g=b[5],l=b[6],n=b[7],b=b[8],u(a,c,d,h,g,"0",l,n,b);b=J.exec(a);if(null!==
b)return a=b[1],c=b[2],d=b[3],h=b[4],g=b[5],u(a,c,d,h,g);b=A.exec(a);if(null!==b)return a=b[1],c=b[2],d=b[3],u(a,c,d);throw Error("SQL Invalid Timestamp");}function z(a){a=A.exec(a);if(null===a)throw Error("SQL Invalid Date");var b=a[2],c=a[3];return new Date(parseInt(a[1],10),parseInt(b,10)-1,parseInt(c,10))}function w(a){return Array.isArray(a)?a:[a]}function F(a){return null!==a?!0!==a:null}function B(a,b){return null!=a&&null!=b?!0===a&&!0===b:!1===a||!1===b?!1:null}function I(a,b){return null!=
a&&null!=b?!0===a||!0===b:!0===a||!0===b?!0:null}function E(a,b){if(null==a)return null;for(var c=!1,m=0;m<b.length;m++){var d=b[m];if(null==d)c=null;else if(a===d){c=!0;break}}return c}function G(a,b,c){if(null==a)return null;for(var m="",d=0,h=0;h<b.length;h++){var g=b.charAt(h);switch(d){case 0:g===c?d=1:m=0<="-[]/{}()*+?.\\^$|".indexOf(g)?m+("\\"+g):"%"===g?m+".*":"_"===g?m+".":m+g;break;case 1:m=0<="-[]/{}()*+?.\\^$|".indexOf(g)?m+("\\"+g):m+g,d=0}}return(new RegExp("^"+m+"$")).test(a)}function d(a){return a instanceof
Date?a.valueOf():a}function n(a,b,c){if(null==b||null==c)return null;b=d(b);c=d(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function g(a){for(var b=[],c={},d=0;d<a.length;d++){var h=a[d],g=h.toLowerCase();void 0===c[g]&&(b.push(h),c[g]=1)}return b}function p(a,b,d){if(b instanceof c.SqlInterval)if(d instanceof Date)switch(a){case "+":return new Date(b.valueInMilliseconds()+
d.getTime());case "-":return b.valueInMilliseconds()-d.getTime();case "*":return b.valueInMilliseconds()*d.getTime();case "/":return b.valueInMilliseconds()/d.getTime()}else if(d instanceof c.SqlInterval)switch(a){case "+":return c.SqlInterval.createFromMilliseconds(b.valueInMilliseconds()+d.valueInMilliseconds());case "-":return c.SqlInterval.createFromMilliseconds(b.valueInMilliseconds()-d.valueInMilliseconds());case "*":return b.valueInMilliseconds()*d.valueInMilliseconds();case "/":return b.valueInMilliseconds()/
d.valueInMilliseconds()}else b=b.valueInMilliseconds();else if(d instanceof c.SqlInterval)if(b instanceof Date)switch(a){case "+":return new Date(d.valueInMilliseconds()+b.getTime());case "-":return new Date(b.getTime()-d.valueInMilliseconds());case "*":return b.getTime()*d.valueInMilliseconds();case "/":return b.getTime()/d.valueInMilliseconds()}else d=d.valueInMilliseconds();else if(b instanceof Date&&"number"===typeof d)switch(d*=864E5,b=b.getTime(),a){case "+":return new Date(b+d);case "-":return new Date(b-
d);case "*":return new Date(b*d);case "/":return new Date(b/d)}else if(d instanceof Date&&"number"===typeof b)switch(b*=864E5,d=d.getTime(),a){case "+":return new Date(b+d);case "-":return new Date(b-d);case "*":return new Date(b*d);case "/":return new Date(b/d)}switch(a){case "+":return b+d;case "-":return b-d;case "*":return b*d;case "/":return b/d}}function r(a,b,c,d){a=d.getAttribute(a,b);return null!=a&&1===c[b]?new Date(a):a}Object.defineProperty(a,"__esModule",{value:!0});var A=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,
D=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,V=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,W=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,J=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,R=function(){function a(){}a.makeBool=function(a){return!0===a};a.featureValue=function(a,b,c,d){return r(a,b,c,d)};a.equalsNull=function(a){return null===a};a.applyLike=function(a,b,c){return G(a,
b,c)};a.ensureArray=function(a){return w(a)};a.applyIn=function(a,b){return E(a,b)};a.currentDate=function(){var a=new Date;a.setHours(0,0,0,0);return a};a.makeSqlInterval=function(a,b,d){return c.SqlInterval.createFromValueAndQualifer(a,b,d)};a.convertInterval=function(a){return a instanceof c.SqlInterval?a.valueInMilliseconds():a};a.currentTimestamp=function(){return new Date};a.compare=function(a,b,c){return n(a,b,c)};a.calculate=function(a,b,c){return p(a,b,c)};a.makeComparable=function(a){return d(a)};
a.evaluateFunction=function(a,b){return c.evaluateFunction(a,b)};a.lookup=function(a,b){a=b[a];return void 0===a?null:a};a.between=function(a,b){return null==a||null==b[0]||null==b[1]?null:a>=b[0]&&a<=b[1]};a.notbetween=function(a,b){return null==a||null==b[0]||null==b[1]?null:a<b[0]||a>b[1]};a.ternaryNot=function(a){return F(a)};a.ternaryAnd=function(a,b){return B(a,b)};a.ternaryOr=function(a,b){return I(a,b)};return a}();C=function(){function h(a,b){this.fieldsIndex=b;this.datefields={};this.parameters=
{};this.parseTree=k.WhereGrammar.parse(a);a=this.extractExpressionInfo(b);b=a.isStandardized;var c=a.isAggregate;this.referencedFieldNames=a.referencedFieldNames;this.isStandardized=b;this.isAggregate=c}h.create=function(a,b){return new h(a,b)};Object.defineProperty(h.prototype,"fieldNames",{get:function(){return this.referencedFieldNames},enumerable:!0,configurable:!0});h.prototype.testSet=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);for(var d={},h=function(a){d[a]=b.map(function(b){return c.getAttribute(b,
a)})},m=0,g=this.fieldNames;m<g.length;m++)h(g[m]);return!!this.evaluateNode(this.parseTree,{attributes:d},a.defaultAttributeAdapter)};h.prototype.calculateValue=function(b,d){void 0===d&&(d=a.defaultAttributeAdapter);b=this.evaluateNode(this.parseTree,b,d);return b instanceof c.SqlInterval?b.valueInMilliseconds()/864E5:b};h.prototype.calculateValueCompiled=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(b,this.parameters,
c,this.datefields);if(q("csp-restrictions"))return this.calculateValue(b,c);this.compileMe();return this.parseTree._compiledVersion(b,this.parameters,c,this.datefields)};h.prototype.testFeature=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);return!!this.evaluateNode(this.parseTree,b,c)};h.prototype.testFeatureCompiled=function(b,c){void 0===c&&(c=a.defaultAttributeAdapter);if(void 0===this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(b,this.parameters,c,this.datefields);
if(q("csp-restrictions"))return this.testFeature(b,c);this.compileMe();return!!this.parseTree._compiledVersion(b,this.parameters,c,this.datefields)};h.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&a.push(b.name.toLowerCase())});return g(a)};h.prototype.getExpressions=function(){var a=new Map;this.visitAll(this.parseTree,function(b){if("function"===b.type){var c=b.name.toLowerCase();b=b.args.value[0];if("column_ref"===b.type){b=b.column;var d=
c+"-"+b;a.has(d)||a.set(d,{aggregateType:c,field:b})}}});return l.valuesOfMap(a)};h.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return g(a)};h.prototype.compileMe=function(){var a="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",a)).bind(R)};h.prototype.extractExpressionInfo=function(a){var d=
this,h=[],m=!0,k=!0;this.visitAll(this.parseTree,function(g){switch(g.type){case "column_ref":var l=g.column.toUpperCase();if("CURRENT_DATE"!==l&&"CURRENT_TIMESTAMP"!==l){var n=(l=a.get(g.column))&&l.name;!l||"date"!==l.type&&"esriFieldTypeDate"!==l.type||(d.datefields[l.name]=1);void 0!==n?(h.push(n),g.column=n):h.push(g.column)}break;case "function":l=g.name,g=g.args.value.length,m&&(m=c.isStandardized(l,g)),k&&(k=b.isAggregate(l,g))}});return{referencedFieldNames:g(h),isStandardized:m,isAggregate:k}};
h.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,d=a.clauses;c<d.length;c++){var h=d[c];this.visitAll(h,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)h=a[c],this.visitAll(h,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);
this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};h.prototype.evaluateNodeToJavaScript=function(a){switch(a.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(a.value)+", "+JSON.stringify(a.qualifier)+","+JSON.stringify(a.op)+")";case "case_expression":var b="";if("simple"===a.format)for(var c="this.makeComparable("+this.evaluateNodeToJavaScript(a.operand)+")",b="( ",d=0;d<a.clauses.length;d++)b+=" ("+c+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(a.clauses[d].operand)+
")) ? ("+this.evaluateNodeToJavaScript(a.clauses[d].value)+") : ";else for(b="( ",d=0;d<a.clauses.length;d++)b+=" this.makeBool("+this.evaluateNodeToJavaScript(a.clauses[d].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(a.clauses[d].value)+") : ";b=null!==a.else?b+this.evaluateNodeToJavaScript(a.else):b+"null";return b+" )";case "param":return"this.lookup("+JSON.stringify(a.value.toLowerCase())+",lookups)";case "expr_list":b="[";c=0;for(a=a.value;c<a.length;c++)d=a[c],"["!==b&&(b+=
","),b+=this.evaluateNodeToJavaScript(d);return b+"]";case "unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(a.expr)+")";case "binary_expr":switch(a.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+
this.evaluateNodeToJavaScript(a.left)+")";case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+")))";case "BETWEEN":return"this.between("+
this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+
JSON.stringify(a.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")"}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(a.value);
case "date":return"(new Date("+z(a.value).getTime().toString()+"))";case "timestamp":return"(new Date("+t(a.value).getTime().toString()+"))";case "column_ref":return"CURRENT_DATE"===a.column.toUpperCase()?"this.currentDate()":"CURRENT_TIMESTAMP"===a.column.toUpperCase()?"this.currentTimestamp()":"this.featureValue(feature,"+JSON.stringify(a.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(a.name)+","+this.evaluateNodeToJavaScript(a.args)+")"}throw Error("Unsupported sql syntax "+
a.type);};h.prototype.evaluateNode=function(a,h,g){switch(a.type){case "interval":return h=this.evaluateNode(a.value,h,g),c.SqlInterval.createFromValueAndQualifer(h,a.qualifier,a.op);case "case_expression":if("simple"===a.format)for(var k=d(this.evaluateNode(a.operand,h,g)),m=0;m<a.clauses.length;m++){if(k===d(this.evaluateNode(a.clauses[m].operand,h,g)))return this.evaluateNode(a.clauses[m].value,h,g)}else for(m=0;m<a.clauses.length;m++)if(!0===this.evaluateNode(a.clauses[m].operand,h,g))return this.evaluateNode(a.clauses[m].value,
h,g);return null!==a.else?this.evaluateNode(a.else,h,g):null;case "param":return this.parameters[a.value.toLowerCase()];case "expr_list":k=[];m=0;for(a=a.value;m<a.length;m++){var l=a[m];k.push(this.evaluateNode(l,h,g))}return k;case "unary_expr":return F(this.evaluateNode(a.expr,h,g));case "binary_expr":switch(a.operator){case "AND":return B(this.evaluateNode(a.left,h,g),this.evaluateNode(a.right,h,g));case "OR":return I(this.evaluateNode(a.left,h,g),this.evaluateNode(a.right,h,g));case "IS":if("null"!==
a.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(a.left,h,g);case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(a.left,h,g);case "IN":return k=w(this.evaluateNode(a.right,h,g)),E(this.evaluateNode(a.left,h,g),k);case "NOT IN":return k=w(this.evaluateNode(a.right,h,g)),F(E(this.evaluateNode(a.left,h,g),k));case "BETWEEN":return k=this.evaluateNode(a.left,h,g),a=this.evaluateNode(a.right,h,g),null==k||null==a[0]||
null==a[1]?null:k>=d(a[0])&&k<=d(a[1]);case "NOTBETWEEN":return k=this.evaluateNode(a.left,h,g),a=this.evaluateNode(a.right,h,g),null==k||null==a[0]||null==a[1]?null:k<d(a[0])||k>d(a[1]);case "LIKE":return G(this.evaluateNode(a.left,h,g),this.evaluateNode(a.right,h,g),a.escape);case "NOT LIKE":return F(G(this.evaluateNode(a.left,h,g),this.evaluateNode(a.right,h,g),a.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return n(a.operator,this.evaluateNode(a.left,
h,g),this.evaluateNode(a.right,h,g));case "-":case "+":case "*":case "/":return p(a.operator,this.evaluateNode(a.left,h,g),this.evaluateNode(a.right,h,g))}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return a.value;case "date":return z(a.value);case "timestamp":return t(a.value);case "column_ref":return"CURRENT_DATE"===a.column.toUpperCase()?(l=new Date,l.setHours(0,0,0,0),l):"CURRENT_TIMESTAMP"===a.column.toUpperCase()?new Date:r(h,a.column,
this.datefields,g);case "function":return h=this.evaluateNode(a.args,h,g),this.isAggregate?b.aggregateFunction(a.name,h):c.evaluateFunction(a.name,h)}throw Error("Unsupported sql syntax "+a.type);};return h}();a.WhereClause=C;a.defaultAttributeAdapter={getAttribute:function(a,b){return(a&&"object"===typeof a.attributes?a.attributes:a)[b]}}})},"esri/core/sql/AggregateFunctions":function(){define(["require","exports"],function(C,a){function q(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b/a.length}
function l(a){for(var b=q(a),c=a.length,l=0,t=0;t<a.length;t++)l+=Math.pow(a[t]-b,2);return 1<c?l/(c-1):0}Object.defineProperty(a,"__esModule",{value:!0});a.aggregateFunction=function(a,k){var c=b[a.toLowerCase()];if(null==c)throw Error("Function Not Recognised");if(k.length<c.minParams||k.length>c.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return c.evaluate(k)};a.isAggregate=function(a,k){a=b[a.toLowerCase()];return null!=a&&k>=a.minParams&&k<=a.maxParams};var b=
{min:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.min.apply(Math,a[0])}},max:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.max.apply(Math,a[0])}},avg:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:q(a[0])}},sum:{minParams:1,maxParams:1,evaluate:function(a){if(null==a[0])a=null;else{a=a[0];for(var b=0,c=0;c<a.length;c++)b+=a[c];a=b}return a}},stddev:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sqrt(l(a[0]))}},
count:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].length}},var:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:l(a[0])}}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","dojo/regexp"],function(C,a,q){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}a.fixDefaults=function(a){if(null!==a.precision||null!==a.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");
};a.createFromMilliseconds=function(b){var c=new a;c.second=b/1E3;return c};a.createFromValueAndQualifer=function(b,k,h){var c=null,l=new a;l.op="-"===h?"-":"+";if("interval-period"===k.type){a.fixDefaults(k);if("year"===k.period||"month"===k.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(b))l[k.period]=parseFloat(b);else throw Error("Illegal Interval");}else{a.fixDefaults(k.start);a.fixDefaults(k.end);if("year"===k.start.period||"month"===k.start.period)throw Error("Year-Month Intervals not supported");
if("year"===k.end.period||"month"===k.end.period)throw Error("Year-Month Intervals not supported");switch(k.start.period){case "day":switch(k.end.period){case "hour":c=/^[0-9]{1,} [0-9]{1,}$/;if(c.test(b))l[k.start.period]=parseFloat(b.split(" ")[0]),l[k.end.period]=parseFloat(b.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":c=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(c.test(b))l[k.start.period]=parseFloat(b.split(" ")[0]),b=b.split(" ")[1].split(":"),l.hour=parseFloat(b[0]),
l.minute=parseFloat(b[1]);else throw Error("Illegal Interval");break;case "second":c=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(c.test(b))l[k.start.period]=parseFloat(b.split(" ")[0]),b=b.split(" ")[1].split(":"),l.hour=parseFloat(b[0]),l.minute=parseFloat(b[1]),l.second=parseFloat(b[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(k.end.period){case "minute":c=/^[0-9]{1,}:[0-9]{1,}$/;if(c.test(b))l.hour=parseFloat(b.split(":")[0]),
l.minute=parseFloat(b.split(":")[1]);else throw Error("Illegal Interval");break;case "second":c=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(c.test(b))b=b.split(":"),l.hour=parseFloat(b[0]),l.minute=parseFloat(b[1]),l.second=parseFloat(b[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(k.end.period){case "second":c=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(c.test(b))b=b.split(":"),l.minute=parseFloat(b[0]),l.second=parseFloat(b[1]);
else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return l};a.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return a}();a.SqlInterval=C;a.evaluateFunction=function(a,c){var b=l[a.toLowerCase()];if(null==b)throw Error("Function Not Recognised");if(c.length<b.minParams||c.length>b.maxParams)throw Error("Invalid Parameter count for call to "+
a.toUpperCase());return b.evaluate(c)};a.isStandardized=function(a,c){a=l[a.toLowerCase()];return null!=a&&c>=a.minParams&&c<=a.maxParams};var l={extract:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];if(null==a)return null;if(a instanceof Date)switch(b.toUpperCase()){case "SECOND":return a.getSeconds();case "MINUTE":return a.getMinutes();case "HOUR":return a.getHours();case "DAY":return a.getDate();case "MONTH":return a.getMonth()+1;case "YEAR":return a.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");
}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var b=a[0],k=a[1];return null==b||null==k?null:b.toString().substring(k-1)}if(3===a.length)return b=a[0],k=a[1],a=a[2],null==b||null==k||null==a?null:0>=a?"":b.toString().substring(k-1,k+a-1)}},position:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];return null==b||null==a?null:a.indexOf(b)+1}},trim:{minParams:2,maxParams:3,evaluate:function(a){var b=3===a.length,k=b?a[1]:" ",b=b?a[2]:a[1];if(null==k||null==
b)return null;k="("+q.escapeString(k)+")";switch(a[0]){case "BOTH":return b.replace(new RegExp("^"+k+"*|"+k+"*$","g"),"");case "LEADING":return b.replace(new RegExp("^"+k+"*","g"),"");case "TRAILING":return b.replace(new RegExp(k+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,
maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])}},log10:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==
a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.asin(a[0])}},acos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:0<a[0]?1:0>a[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],
a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var b=a[0];a=2===a.length?Math.pow(10,a[1]):1;return null==b?null:Math.round(b*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"===typeof a[0]||a[0]instanceof String?
a[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(a){for(var b="",k=0;k<a.length;k++){if(null==a[k])return null;b+=a[k].toString()}return b}},lower:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toUpperCase()}}}})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(C,a){var q={};a.setObject("dojo.regexp",q);
q.escapeString=function(a,b){return a.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(a){return b&&-1!=b.indexOf(a)?a:"\\"+a})};q.buildGroupRE=function(a,b,c){if(!(a instanceof Array))return b(a);for(var k=[],h=0;h<a.length;h++)k.push(b(a[h]));return q.group(k.join("|"),c)};q.group=function(a,b){return"("+(b?"?:":"")+a+")"};return q})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(C,a,q){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(){}
a.parse=function(a){return q.parse(a)};return a}();a.WhereGrammar=C})},"esri/core/sql/sql92grammar":function(){define([],function(){function C(a,q,l,b){this.message=a;this.expected=q;this.found=l;this.location=b;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,C)}(function(a,q){function l(){this.constructor=a}l.prototype=q.prototype;a.prototype=new l})(C,Error);C.buildMessage=function(a,q){function l(a){return a.charCodeAt(0).toString(16).toUpperCase()}
function b(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+l(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+l(a)})}function c(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+
l(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+l(a)})}var k={literal:function(a){return'"'+b(a.text)+'"'},"class":function(a){var b="",h;for(h=0;h<a.parts.length;h++)b+=a.parts[h]instanceof Array?c(a.parts[h][0])+"-"+c(a.parts[h][1]):c(a.parts[h]);return"["+(a.inverted?"^":"")+b+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),c;for(c=0;c<a.length;c++){var h=
c,l;l=a[c];l=k[l.type](l);b[h]=l}b.sort();if(0<b.length){for(a=c=1;c<b.length;c++)b[c-1]!==b[c]&&(b[a]=b[c],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(a)+" but "+(q?'"'+b(q)+'"':"end of input")+" found."};return{SyntaxError:C,parse:function(a,q){function l(a,b){return{type:"literal",text:a,ignoreCase:b}}function b(a,b,e){return{type:"class",parts:a,inverted:b,ignoreCase:e}}function c(b){var e=Ga[b],
c;if(!e){for(c=b-1;!Ga[c];)c--;e=Ga[c];for(e={line:e.line,column:e.column};c<b;)10===a.charCodeAt(c)?(e.line++,e.column=1):e.column++,c++;Ga[b]=e}return e}function k(a,b){var e=c(a),f=c(b);return{start:{offset:a,line:e.line,column:e.column},end:{offset:b,line:f.line,column:f.column}}}function h(a){f<la||(f>la&&(la=f,Sa=[]),Sa.push(a))}function u(){var a,b,c;a=f;b=y();b!==e?(b=z(),b!==e?(c=y(),c!==e?a=b:(f=a,a=e)):(f=a,a=e)):(f=a,a=e);return a}function t(){var a,b,c,d,h,g,k,m;a=f;b=z();if(b!==e){c=
[];d=f;h=y();h!==e?(g=za(),g!==e?(k=y(),k!==e?(m=z(),m!==e?d=h=[h,g,k,m]:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e);for(;d!==e;)c.push(d),d=f,h=y(),h!==e?(g=za(),g!==e?(k=y(),k!==e?(m=z(),m!==e?d=h=[h,g,k,m]:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e);if(c!==e){a={type:"expr_list"};b=[b];for(d=0;d<c.length;d++)b.push(c[d][3]);a.value=b}else f=a,a=e}else f=a,a=e;return a}function z(){var a,b,c,d,h,g,k,m;a=f;b=w();if(b!==e){c=[];d=f;h=y();h!==e?(g=ja(),g!==e?(k=y(),k!==e?(m=w(),m!==e?d=h=[h,g,k,m]:(f=
d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e);for(;d!==e;)c.push(d),d=f,h=y(),h!==e?(g=ja(),g!==e?(k=y(),k!==e?(m=w(),m!==e?d=h=[h,g,k,m]:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e);c!==e?a=b=Aa(b,c):(f=a,a=e)}else f=a,a=e;return a}function w(){var a,b,c,d,h,g,k,m;a=f;b=F();if(b!==e){c=[];d=f;h=y();h!==e?(g=ha(),g!==e?(k=y(),k!==e?(m=F(),m!==e?d=h=[h,g,k,m]:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e);for(;d!==e;)c.push(d),d=f,h=y(),h!==e?(g=ha(),g!==e?(k=y(),k!==e?(m=F(),m!==e?d=h=[h,g,k,m]:(f=d,d=e)):(f=
d,d=e)):(f=d,d=e)):(f=d,d=e);c!==e?a=b=Aa(b,c):(f=a,a=e)}else f=a,a=e;return a}function F(){var b,c,d,g,k;b=f;c=L();c===e&&(c=f,33===a.charCodeAt(f)?(d=$c,f++):(d=e,0===v&&h(ad)),d!==e?(g=f,v++,61===a.charCodeAt(f)?(k=fb,f++):(k=e,0===v&&h(gb)),v--,k===e?g=void 0:(f=g,g=e),g!==e?c=d=[d,g]:(f=c,c=e)):(f=c,c=e));c!==e?(d=y(),d!==e?(g=F(),g!==e?b=c={type:"unary_expr",operator:"NOT",expr:g}:(f=b,b=e)):(f=b,b=e)):(f=b,b=e);if(b===e)if(b=f,c=G(),c!==e)if(d=y(),d!==e){var m,l,n;d=[];g=f;k=y();k!==e?(m=B(),
m!==e?(l=y(),l!==e?(n=G(),n!==e?g=k=[k,m,l,n]:(f=g,g=e)):(f=g,g=e)):(f=g,g=e)):(f=g,g=e);if(g!==e)for(;g!==e;)d.push(g),g=f,k=y(),k!==e?(m=B(),m!==e?(l=y(),l!==e?(n=G(),n!==e?g=k=[k,m,l,n]:(f=g,g=e)):(f=g,g=e)):(f=g,g=e)):(f=g,g=e);else d=e;d!==e&&(d={type:"arithmetic",tail:d});d===e&&(d=f,g=E(),g!==e?(k=y(),k!==e?(k=ea(),k!==e?(k=y(),k!==e?(k=t(),k!==e?(m=y(),m!==e?(m=fa(),m!==e?d=g={op:g,right:k}:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e),d===e&&(d=f,g=E(),g!==e?
(k=y(),k!==e?(k=ea(),k!==e?(k=y(),k!==e?(k=fa(),k!==e?d=g={op:g,right:{type:"expr_list",value:[]}}:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e),d===e&&(d=f,g=E(),g!==e?(k=y(),k!==e?(k=W(),k!==e?d=g={op:g,right:k}:(f=d,d=e)):(f=d,d=e)):(f=d,d=e))),d===e&&(d=f,k=L(),k!==e?(g=y(),g!==e?(g=ka(),g!==e?(m=y(),m!==e?(m=G(),m!==e?(l=y(),l!==e?(l=ha(),l!==e?(k=y(),k!==e?(k=G(),k!==e?d=k={op:"NOT"+g,right:{type:"expr_list",value:[m,k]}}:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=
e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e),d===e&&(d=f,k=ka(),k!==e?(g=y(),g!==e?(g=G(),g!==e?(m=y(),m!==e?(m=ha(),m!==e?(l=y(),l!==e?(l=G(),l!==e?d=k={op:k,right:{type:"expr_list",value:[g,l]}}:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)),d===e&&(d=f,g=X(),g!==e?(k=y(),k!==e?(k=L(),k!==e?(k=y(),k!==e?(k=G(),k!==e?d=g={op:g+"NOT",right:k}:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e),d===e&&(d=f,g=X(),g!==e?(k=y(),k!==e?(k=G(),k!==e?d=g={op:g,right:k}:(f=d,d=e)):(f=
d,d=e)):(f=d,d=e)),d===e&&(d=f,g=I(),g!==e?(k=y(),k!==e?(k=P(),k!==e?(m=y(),m!==e?(m=f,a.substr(f,6).toLowerCase()===bd?(l=a.substr(f,6),f+=6):(l=e,0===v&&h(cd)),l!==e?(l=f,v++,n=D(),v--,n===e?l=void 0:(f=l,l=e),l!==e?m="ESCAPE":(f=m,m=e)):(f=m,m=e),m!==e?(m=y(),m!==e?(m=ma(),m!==e?d=g={op:g,right:k,escape:m.value}:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e),d===e&&(d=f,g=I(),g!==e?(k=y(),k!==e?(k=P(),k!==e?d=g={op:g,right:k,escape:""}:(f=d,d=e)):(f=d,d=e)):(f=d,d=
e))))));d===e&&(d=null);d!==e?(b=c,c=d,""==c||void 0==c||null==c?c=b:(d=null,c=d="arithmetic"==c.type?Aa(b,c.tail):hb(c.op,b,c.right,c.escape)),b=c):(f=b,b=e)}else f=b,b=e;else f=b,b=e;return b}function B(){var b;a.substr(f,2)===ib?(b=ib,f+=2):(b=e,0===v&&h(dd));b===e&&(62===a.charCodeAt(f)?(b=ed,f++):(b=e,0===v&&h(fd)),b===e&&(a.substr(f,2)===jb?(b=jb,f+=2):(b=e,0===v&&h(gd)),b===e&&(a.substr(f,2)===kb?(b=kb,f+=2):(b=e,0===v&&h(hd)),b===e&&(60===a.charCodeAt(f)?(b=id,f++):(b=e,0===v&&h(jd)),b===
e&&(61===a.charCodeAt(f)?(b=fb,f++):(b=e,0===v&&h(gb)),b===e&&(a.substr(f,2)===lb?(b=lb,f+=2):(b=e,0===v&&h(kd))))))));return b}function I(){var a,b,c,d;a=a=f;b=L();b!==e?(c=y(),c!==e?(d=ca(),d!==e?a=b=[b,c,d]:(f=a,a=e)):(f=a,a=e)):(f=a,a=e);a!==e&&(a=a[0]+" "+a[2]);a===e&&(a=ca());return a}function E(){var a,b,c,d;a=a=f;b=L();b!==e?(c=y(),c!==e?(d=ia(),d!==e?a=b=[b,c,d]:(f=a,a=e)):(f=a,a=e)):(f=a,a=e);a!==e&&(a=a[0]+" "+a[2]);a===e&&(a=ia());return a}function G(){var a,b,c,g,h,k,m,l;a=f;b=n();if(b!==
e){c=[];g=f;h=y();h!==e?(k=d(),k!==e?(m=y(),m!==e?(l=n(),l!==e?g=h=[h,k,m,l]:(f=g,g=e)):(f=g,g=e)):(f=g,g=e)):(f=g,g=e);for(;g!==e;)c.push(g),g=f,h=y(),h!==e?(k=d(),k!==e?(m=y(),m!==e?(l=n(),l!==e?g=h=[h,k,m,l]:(f=g,g=e)):(f=g,g=e)):(f=g,g=e)):(f=g,g=e);c!==e?a=b=Aa(b,c):(f=a,a=e)}else f=a,a=e;return a}function d(){var b;43===a.charCodeAt(f)?(b=fc,f++):(b=e,0===v&&h(gc));b===e&&(45===a.charCodeAt(f)?(b=hc,f++):(b=e,0===v&&h(ic)));return b}function n(){var a,b,c,d,h,k,m,l;a=f;b=p();if(b!==e){c=[];
d=f;h=y();h!==e?(k=g(),k!==e?(m=y(),m!==e?(l=p(),l!==e?d=h=[h,k,m,l]:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e);for(;d!==e;)c.push(d),d=f,h=y(),h!==e?(k=g(),k!==e?(m=y(),m!==e?(l=p(),l!==e?d=h=[h,k,m,l]:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e);c!==e?a=b=Aa(b,c):(f=a,a=e)}else f=a,a=e;return a}function g(){var b;42===a.charCodeAt(f)?(b=ld,f++):(b=e,0===v&&h(md));b===e&&(47===a.charCodeAt(f)?(b=nd,f++):(b=e,0===v&&h(od)));return b}function p(){var b,c,d,g,k,m,l;l=ma();if(l===e){var n,p,u,x;n=f;var q,
H,w,B;q=f;H=va();H!==e?(w=sa(),w!==e?(B=da(),B!==e?q=H=parseFloat(H+w+B):(f=q,q=e)):(f=q,q=e)):(f=q,q=e);q===e&&(q=f,H=va(),H!==e?(w=sa(),w!==e?q=H=parseFloat(H+w):(f=q,q=e)):(f=q,q=e),q===e&&(q=f,H=va(),H!==e?(w=da(),w!==e?q=H=parseFloat(H+w):(f=q,q=e)):(f=q,q=e),q===e&&(q=f,H=va(),H!==e&&(H=parseFloat(H)),q=H)));p=q;p!==e?(u=f,v++,x=A(),v--,x===e?u=void 0:(f=u,u=e),u!==e?n=p={type:"number",value:p}:(f=n,n=e)):(f=n,n=e);l=n;if(l===e){var F,G;F=f;var E,C,I,U;E=f;a.substr(f,4).toLowerCase()===pd?(C=
a.substr(f,4),f+=4):(C=e,0===v&&h(qd));C!==e?(I=f,v++,U=D(),v--,U===e?I=void 0:(f=I,I=e),I!==e?E=C=[C,I]:(f=E,E=e)):(f=E,E=e);G=E;G!==e&&(G={type:"bool",value:!0});F=G;if(F===e){F=f;var L,Z,X,la;L=f;a.substr(f,5).toLowerCase()===rd?(Z=a.substr(f,5),f+=5):(Z=e,0===v&&h(sd));Z!==e?(X=f,v++,la=D(),v--,la===e?X=void 0:(f=X,X=e),X!==e?L=Z=[Z,X]:(f=L,L=e)):(f=L,L=e);G=L;G!==e&&(G={type:"bool",value:!1});F=G}l=F;if(l===e){var ha,ca,ja,ka,Aa;ca=f;a.substr(f,4).toLowerCase()===td?(ja=a.substr(f,4),f+=4):(ja=
e,0===v&&h(ud));ja!==e?(ka=f,v++,Aa=D(),v--,Aa===e?ka=void 0:(f=ka,ka=e),ka!==e?ca=ja=[ja,ka]:(f=ca,ca=e)):(f=ca,ca=e);ha=ca;ha!==e&&(ha={type:"null",value:null});l=ha;if(l===e){var wa,za,Ga,Da;wa=f;var Ha,ya,mb,Sa;Ha=f;a.substr(f,4).toLowerCase()===vd?(ya=a.substr(f,4),f+=4):(ya=e,0===v&&h(wd));ya!==e?(mb=f,v++,Sa=D(),v--,Sa===e?mb=void 0:(f=mb,mb=e),mb!==e?Ha=ya="DATE":(f=Ha,Ha=e)):(f=Ha,Ha=e);za=Ha;za!==e?(Ga=y(),Ga!==e?(Da=P(),Da!==e?wa=za={type:"date",value:Da.value}:(f=wa,wa=e)):(f=wa,wa=e)):
(f=wa,wa=e);l=wa;if(l===e){var xa,jc,db,kc;xa=f;var Ia,Kb,nb,eb;Ia=f;a.substr(f,9).toLowerCase()===xd?(Kb=a.substr(f,9),f+=9):(Kb=e,0===v&&h(yd));Kb!==e?(nb=f,v++,eb=D(),v--,eb===e?nb=void 0:(f=nb,nb=e),nb!==e?Ia=Kb="TIMESTAMP":(f=Ia,Ia=e)):(f=Ia,Ia=e);jc=Ia;jc!==e?(db=y(),db!==e?(kc=P(),kc!==e?xa=jc={type:"timestamp",value:kc.value}:(f=xa,xa=e)):(f=xa,xa=e)):(f=xa,xa=e);l=xa;if(l===e){var N,Ta,Lb,ta,Mb,Ua,fb,lc;N=f;Ta=Pa();Ta!==e?(Lb=y(),Lb!==e?(45===a.charCodeAt(f)?(ta=hc,f++):(ta=e,0===v&&h(ic)),
ta===e&&(43===a.charCodeAt(f)?(ta=fc,f++):(ta=e,0===v&&h(gc))),ta!==e?(Mb=y(),Mb!==e?(Ua=P(),Ua!==e?(fb=y(),fb!==e?(lc=R(),lc!==e?N=Ta={type:"interval",value:Ua,qualifier:lc,op:ta}:(f=N,N=e)):(f=N,N=e)):(f=N,N=e)):(f=N,N=e)):(f=N,N=e)):(f=N,N=e)):(f=N,N=e);N===e&&(N=f,Ta=Pa(),Ta!==e?(Lb=y(),Lb!==e?(ta=P(),ta!==e?(Mb=y(),Mb!==e?(Ua=R(),Ua!==e?N=Ta={type:"interval",value:ta,qualifier:Ua,op:""}:(f=N,N=e)):(f=N,N=e)):(f=N,N=e)):(f=N,N=e)):(f=N,N=e));l=N}}}}}}b=l;if(b===e){var S,mc,gb,hb,ib,nc,jb,kb,lb,
oc,xb,yb;S=f;var Ja,Nb,ob,zb;Ja=f;a.substr(f,7).toLowerCase()===zd?(Nb=a.substr(f,7),f+=7):(Nb=e,0===v&&h(Ad));Nb!==e?(ob=f,v++,zb=D(),v--,zb===e?ob=void 0:(f=ob,ob=e),ob!==e?Ja=Nb="EXTRACT":(f=Ja,Ja=e)):(f=Ja,Ja=e);mc=Ja;if(mc!==e)if(gb=y(),gb!==e)if(hb=ea(),hb!==e)if(ib=y(),ib!==e){var na;na=bb();na===e&&(na=Qa(),na===e&&(na=cb(),na===e&&(na=yc(),na===e&&(na=zc(),na===e&&(na=Fa())))));nc=na;nc!==e?(jb=y(),jb!==e?(kb=Ea(),kb!==e?(lb=y(),lb!==e?(oc=z(),oc!==e?(xb=y(),xb!==e?(yb=fa(),yb!==e?S=mc={type:"function",
name:"extract",args:{type:"expr_list",value:[{type:"string",value:nc},oc]}}:(f=S,S=e)):(f=S,S=e)):(f=S,S=e)):(f=S,S=e)):(f=S,S=e)):(f=S,S=e)):(f=S,S=e)}else f=S,S=e;else f=S,S=e;else f=S,S=e;else f=S,S=e;b=S;if(b===e){var Q,pc,Ab,Bb,Cb,Ob,Db,Eb,Fb,Pb,Gb,ga,Va,qc,rc,sc;Q=f;var Ka,Qb,pb,Hb;Ka=f;a.substr(f,9).toLowerCase()===Bd?(Qb=a.substr(f,9),f+=9):(Qb=e,0===v&&h(Cd));Qb!==e?(pb=f,v++,Hb=D(),v--,Hb===e?pb=void 0:(f=pb,pb=e),pb!==e?Ka=Qb="SUBSTRING":(f=Ka,Ka=e)):(f=Ka,Ka=e);pc=Ka;if(pc!==e)if(Ab=y(),
Ab!==e)if(Bb=ea(),Bb!==e)if(Cb=y(),Cb!==e)if(Ob=z(),Ob!==e)if(Db=y(),Db!==e)if(Eb=Ea(),Eb!==e)if(Fb=y(),Fb!==e)if(Pb=z(),Pb!==e)if(Gb=y(),Gb!==e){ga=f;var La,Rb,qb,Ac;La=f;a.substr(f,3).toLowerCase()===Dd?(Rb=a.substr(f,3),f+=3):(Rb=e,0===v&&h(Ed));Rb!==e?(qb=f,v++,Ac=D(),v--,Ac===e?qb=void 0:(f=qb,qb=e),qb!==e?La=Rb="FOR":(f=La,La=e)):(f=La,La=e);Va=La;Va!==e?(qc=y(),qc!==e?(rc=z(),rc!==e?(sc=y(),sc!==e?ga=Va=[Va,qc,rc,sc]:(f=ga,ga=e)):(f=ga,ga=e)):(f=ga,ga=e)):(f=ga,ga=e);ga===e&&(ga=null);ga!==
e?(Va=fa(),Va!==e?Q=pc={type:"function",name:"substring",args:{type:"expr_list",value:ga?[Ob,Pb,ga[2]]:[Ob,Pb]}}:(f=Q,Q=e)):(f=Q,Q=e)}else f=Q,Q=e;else f=Q,Q=e;else f=Q,Q=e;else f=Q,Q=e;else f=Q,Q=e;else f=Q,Q=e;else f=Q,Q=e;else f=Q,Q=e;else f=Q,Q=e;else f=Q,Q=e;b=Q;if(b===e){var K,Wa,Sb,Tb,Ub,oa,Vb,Xa,Wb,Xb,Bc,tc,Cc,Dc;K=f;Wa=Oa();Wa!==e?(Sb=y(),Sb!==e?(Tb=ea(),Tb!==e?(Ub=y(),Ub!==e?(oa=J(),oa===e&&(oa=null),oa!==e?(Vb=y(),Vb!==e?(Xa=z(),Xa!==e?(Wb=y(),Wb!==e?(Xb=Ea(),Xb!==e?(Bc=y(),Bc!==e?(tc=
z(),tc!==e?(Cc=y(),Cc!==e?(Dc=fa(),Dc!==e?K=Wa={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==oa?"BOTH":oa},Xa,tc]}}:(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e);K===e&&(K=f,Wa=Oa(),Wa!==e?(Sb=y(),Sb!==e?(Tb=ea(),Tb!==e?(Ub=y(),Ub!==e?(oa=J(),oa===e&&(oa=null),oa!==e?(Vb=y(),Vb!==e?(Xa=z(),Xa!==e?(Wb=y(),Wb!==e?(Xb=fa(),Xb!==e?K=Wa={type:"function",name:"trim",args:{type:"expr_list",
value:[{type:"string",value:null==oa?"BOTH":oa},Xa]}}:(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e)):(f=K,K=e));b=K;if(b===e){var T,uc,Ec,Fc,Gc,vc,Hc,Ic,Jc,wc,Kc,Lc;T=f;var Ma,Yb,rb,Mc;Ma=f;a.substr(f,8).toLowerCase()===Fd?(Yb=a.substr(f,8),f+=8):(Yb=e,0===v&&h(Gd));Yb!==e?(rb=f,v++,Mc=D(),v--,Mc===e?rb=void 0:(f=rb,rb=e),rb!==e?Ma=Yb="POSITION":(f=Ma,Ma=e)):(f=Ma,Ma=e);uc=Ma;uc!==e?(Ec=y(),Ec!==e?(Fc=ea(),Fc!==e?(Gc=y(),Gc!==e?(vc=z(),vc!==e?(Hc=y(),Hc!==
e?(Ic=ia(),Ic!==e?(Jc=y(),Jc!==e?(wc=z(),wc!==e?(Kc=y(),Kc!==e?(Lc=fa(),Lc!==e?T=uc={type:"function",name:"position",args:{type:"expr_list",value:[vc,wc]}}:(f=T,T=e)):(f=T,T=e)):(f=T,T=e)):(f=T,T=e)):(f=T,T=e)):(f=T,T=e)):(f=T,T=e)):(f=T,T=e)):(f=T,T=e)):(f=T,T=e)):(f=T,T=e);b=T;if(b===e){var ba,Zb,Nc,Oc,Pc,Ya,Qc,Rc;ba=f;var pa,sb,tb,ua;pa=f;pa=sb=r();if(pa===e)if(pa=f,96===a.charCodeAt(f)?(sb=Sc,f++):(sb=e,0===v&&h(Tc)),sb!==e){tb=[];Uc.test(a.charAt(f))?(ua=a.charAt(f),f++):(ua=e,0===v&&h(Vc));
if(ua!==e)for(;ua!==e;)tb.push(ua),Uc.test(a.charAt(f))?(ua=a.charAt(f),f++):(ua=e,0===v&&h(Vc));else tb=e;tb!==e?(96===a.charCodeAt(f)?(ua=Sc,f++):(ua=e,0===v&&h(Tc)),ua!==e?pa=sb=tb.join(""):(f=pa,pa=e)):(f=pa,pa=e)}else f=pa,pa=e;Zb=pa;Zb!==e?(Nc=y(),Nc!==e?(Oc=ea(),Oc!==e?(Pc=y(),Pc!==e?(Ya=t(),Ya===e&&(Ya=null),Ya!==e?(Qc=y(),Qc!==e?(Rc=fa(),Rc!==e?ba=Zb={type:"function",name:Zb,args:Ya?Ya:{type:"expr_list",value:[]}}:(f=ba,ba=e)):(f=ba,ba=e)):(f=ba,ba=e)):(f=ba,ba=e)):(f=ba,ba=e)):(f=ba,ba=
e)):(f=ba,ba=e);b=ba;if(b===e){var $b,M,Za,ac,$a,bc,Ba,qa,ub,Wc,Xc;M=f;Za=Ib();if(Za!==e)if(ac=y(),ac!==e)if($a=z(),$a!==e)if(bc=y(),bc!==e){Ba=[];for(qa=Y();qa!==e;)Ba.push(qa),qa=Y();Ba!==e?(qa=y(),qa!==e?(ub=Jb(),ub!==e?M=Za={type:"case_expression",format:"simple",operand:$a,clauses:Ba,else:null}:(f=M,M=e)):(f=M,M=e)):(f=M,M=e)}else f=M,M=e;else f=M,M=e;else f=M,M=e;else f=M,M=e;if(M===e)if(M=f,Za=Ib(),Za!==e)if(ac=y(),ac!==e)if($a=z(),$a!==e)if(bc=y(),bc!==e){Ba=[];for(qa=Y();qa!==e;)Ba.push(qa),
qa=Y();Ba!==e?(qa=y(),qa!==e?(ub=Ra(),ub!==e?(Wc=y(),Wc!==e?(Xc=Jb(),Xc!==e?M=Za={type:"case_expression",format:"simple",operand:$a,clauses:Ba,else:ub.value}:(f=M,M=e)):(f=M,M=e)):(f=M,M=e)):(f=M,M=e)):(f=M,M=e)}else f=M,M=e;else f=M,M=e;else f=M,M=e;else f=M,M=e;$b=M;if($b===e){var O,ab,cc,Ca,ra,vb,Yc,Zc;O=f;ab=Ib();if(ab!==e)if(cc=y(),cc!==e){Ca=[];for(ra=aa();ra!==e;)Ca.push(ra),ra=aa();Ca!==e?(ra=y(),ra!==e?(vb=Jb(),vb!==e?O=ab={type:"case_expression",format:"searched",clauses:Ca,else:null}:(f=
O,O=e)):(f=O,O=e)):(f=O,O=e)}else f=O,O=e;else f=O,O=e;if(O===e)if(O=f,ab=Ib(),ab!==e)if(cc=y(),cc!==e){Ca=[];for(ra=aa();ra!==e;)Ca.push(ra),ra=aa();Ca!==e?(ra=y(),ra!==e?(vb=Ra(),vb!==e?(Yc=y(),Yc!==e?(Zc=Jb(),Zc!==e?O=ab={type:"case_expression",format:"searched",clauses:Ca,else:vb.value}:(f=O,O=e)):(f=O,O=e)):(f=O,O=e)):(f=O,O=e)):(f=O,O=e)}else f=O,O=e;else f=O,O=e;$b=O}b=$b;if(b===e){var wb,Na,xc,dc,ec;Na=f;xc=A();if(xc!==e){dc=[];for(ec=V();ec!==e;)dc.push(ec),ec=V();dc!==e?Na=xc+=dc.join(""):
(f=Na,Na=e)}else f=Na,Na=e;wb=Na;wb!==e&&(wb={type:"column_ref",table:"",column:wb});b=wb;b===e&&(b=W(),b===e&&(b=f,c=ea(),c!==e?(d=y(),d!==e?(g=z(),g!==e?(k=y(),k!==e?(m=fa(),m!==e?(g.paren=!0,b=c=g):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)))}}}}}}}return b}function r(){var a,b,c,d;a=f;b=A();if(b!==e){c=[];for(d=D();d!==e;)c.push(d),d=D();c!==e?a=b+=c.join(""):(f=a,a=e)}else f=a,a=e;return a}function A(){var b;Hd.test(a.charAt(f))?(b=a.charAt(f),f++):(b=e,0===v&&h(Id));return b}function D(){var b;
Jd.test(a.charAt(f))?(b=a.charAt(f),f++):(b=e,0===v&&h(Kd));return b}function V(){var b;Ld.test(a.charAt(f))?(b=a.charAt(f),f++):(b=e,0===v&&h(Md));return b}function W(){var b,c,d;b=f;64===a.charCodeAt(f)?(c=Nd,f++):(c=e,0===v&&h(Od));c!==e?(d=r(),d!==e?b=c=[c,d]:(f=b,b=e)):(f=b,b=e);b!==e&&(b={type:"param",value:b[1]});return b}function J(){var b,c,d;b=f;a.substr(f,7).toLowerCase()===Pd?(c=a.substr(f,7),f+=7):(c=e,0===v&&h(Qd));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="LEADING":
(f=b,b=e)):(f=b,b=e);b===e&&(b=f,a.substr(f,8).toLowerCase()===Rd?(c=a.substr(f,8),f+=8):(c=e,0===v&&h(Sd)),c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="TRAILING":(f=b,b=e)):(f=b,b=e),b===e&&(b=f,a.substr(f,4).toLowerCase()===Td?(c=a.substr(f,4),f+=4):(c=e,0===v&&h(Ud)),c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="BOTH":(f=b,b=e)):(f=b,b=e)));return b}function R(){var b,c,d;b=f;var g,k;c=f;d=H();d!==e?(g=y(),g!==e?(g=ea(),g!==e?(g=y(),g!==e?(g=x(),g!==e?(k=y(),k!==e?(k=
fa(),k!==e?c=d={type:"interval-period",period:d.value,precision:g,secondary:null}:(f=c,c=e)):(f=c,c=e)):(f=c,c=e)):(f=c,c=e)):(f=c,c=e)):(f=c,c=e)):(f=c,c=e);c===e&&(c=f,d=H(),d!==e&&(d=xb(d)),c=d);if(c!==e)if(d=y(),d!==e)if(d=f,a.substr(f,2).toLowerCase()===Vd?(g=a.substr(f,2),f+=2):(g=e,0===v&&h(Wd)),g!==e?(g=f,v++,k=D(),v--,k===e?g=void 0:(f=g,g=e),g!==e?d="TO":(f=d,d=e)):(f=d,d=e),d!==e)if(d=y(),d!==e){var l;d=f;g=H();g!==e&&(g={type:"interval-period",period:g.value,precision:null,secondary:null});
d=g;d===e&&(d=f,g=Fa(),g!==e?(g=y(),g!==e?(g=ea(),g!==e?(g=y(),g!==e?(g=x(),g!==e?(k=y(),k!==e?(k=za(),k!==e?(k=y(),k!==e?(k=m(),k!==e?(l=y(),l!==e?(l=fa(),l!==e?d=g=yb(g,k):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e),d===e&&(d=f,g=Fa(),g!==e?(g=y(),g!==e?(g=ea(),g!==e?(g=y(),g!==e?(g=x(),g!==e?(k=y(),k!==e?(k=fa(),k!==e?d=g={type:"interval-period",period:"second",precision:g,secondary:null}:(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):
(f=d,d=e)):(f=d,d=e)):(f=d,d=e)):(f=d,d=e),d===e&&(d=f,g=Fa(),g!==e&&(g={type:"interval-period",period:"second",precision:null,secondary:null}),d=g)));d!==e?b=c={type:"interval-qualifier",start:c,end:d}:(f=b,b=e)}else f=b,b=e;else f=b,b=e;else f=b,b=e;else f=b,b=e;b===e&&(b=f,d=H(),d!==e?(c=y(),c!==e?(c=ea(),c!==e?(c=y(),c!==e?(c=m(),c!==e?(g=y(),g!==e?(g=fa(),g!==e?b=d={type:"interval-period",period:d.value,precision:c,secondary:null}:(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=
e)):(f=b,b=e),b===e&&(b=f,d=H(),d!==e&&(d=xb(d)),b=d,b===e&&(b=f,d=Fa(),d!==e?(c=y(),c!==e?(c=ea(),c!==e?(c=y(),c!==e?(c=x(),c!==e?(g=y(),g!==e?(g=za(),g!==e?(d=y(),d!==e?(d=m(),d!==e?(g=y(),g!==e?(g=fa(),g!==e?b=d=yb(c,d):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e),b===e&&(b=f,d=Fa(),d!==e?(c=y(),c!==e?(c=ea(),c!==e?(c=y(),c!==e?(c=m(),c!==e?(g=y(),g!==e?(g=fa(),g!==e?b=d={type:"interval-period",period:"second",precision:c,
secondary:null}:(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e)):(f=b,b=e),b===e&&(b=f,d=Fa(),d!==e&&(d={type:"interval-period",period:"second",precision:null,secondary:null}),b=d)))));return b}function H(){var a;a=f;a=cb();a!==e&&(a={type:"string",value:"day"});a===e&&(a=f,a=yc(),a!==e&&(a={type:"string",value:"hour"}),a===e&&(a=f,a=zc(),a!==e&&(a={type:"string",value:"minute"}),a===e&&(a=f,a=Qa(),a!==e&&(a={type:"string",value:"month"}),a===e&&(a=f,a=bb(),a!==e&&(a={type:"string",
value:"year"})))));return a}function m(){var a;a=U();a!==e&&(a=parseFloat(a));return a}function x(){var a;a=U();a!==e&&(a=parseFloat(a));return a}function P(){var a;a=ma();a===e&&(a=W());return a}function ma(){var b,c,d;b=f;39===a.charCodeAt(f)?(c=zb,f++):(c=e,0===v&&h(Ab));c===e&&(a.substr(f,2)===Bb?(c=Bb,f+=2):(c=e,0===v&&h(Xd)));if(c!==e){c=[];d=f;a.substr(f,2)===Da?(d=Da,f+=2):(d=e,0===v&&h(Cb));d!==e&&(d="'");d===e&&(Db.test(a.charAt(f))?(d=a.charAt(f),f++):(d=e,0===v&&h(Eb)));for(;d!==e;)c.push(d),
d=f,a.substr(f,2)===Da?(d=Da,f+=2):(d=e,0===v&&h(Cb)),d!==e&&(d="'"),d===e&&(Db.test(a.charAt(f))?(d=a.charAt(f),f++):(d=e,0===v&&h(Eb)));c!==e?(39===a.charCodeAt(f)?(d=zb,f++):(d=e,0===v&&h(Ab)),d!==e?b=c={type:"string",value:c.join("")}:(f=b,b=e)):(f=b,b=e)}else f=b,b=e;return b}function aa(){var a,b,c;a=f;b=db();b!==e?(b=y(),b!==e?(b=z(),b!==e?(c=y(),c!==e?(c=eb(),c!==e?(c=y(),c!==e?(c=z(),c!==e?a=b={type:"when_clause",operand:b,value:c}:(f=a,a=e)):(f=a,a=e)):(f=a,a=e)):(f=a,a=e)):(f=a,a=e)):(f=
a,a=e)):(f=a,a=e);return a}function Y(){var a,b,c;a=f;b=db();b!==e?(b=y(),b!==e?(b=z(),b!==e?(c=y(),c!==e?(c=eb(),c!==e?(c=y(),c!==e?(c=z(),c!==e?a=b={type:"when_clause",operand:b,value:c}:(f=a,a=e)):(f=a,a=e)):(f=a,a=e)):(f=a,a=e)):(f=a,a=e)):(f=a,a=e)):(f=a,a=e);return a}function Ra(){var b,c;b=f;var d,g;c=f;a.substr(f,4).toLowerCase()===Yd?(d=a.substr(f,4),f+=4):(d=e,0===v&&h(Zd));d!==e?(d=f,v++,g=D(),v--,g===e?d=void 0:(f=d,d=e),d!==e?c="ELSE":(f=c,c=e)):(f=c,c=e);c!==e?(c=y(),c!==e?(c=z(),c!==
e?b={type:"else_clause",value:c}:(f=b,b=e)):(f=b,b=e)):(f=b,b=e);return b}function va(){var b,c,d;b=U();b===e&&(b=f,45===a.charCodeAt(f)?(c=hc,f++):(c=e,0===v&&h(ic)),c===e&&(43===a.charCodeAt(f)?(c=fc,f++):(c=e,0===v&&h(gc))),c!==e?(d=U(),d!==e?b=c=c[0]+d:(f=b,b=e)):(f=b,b=e));return b}function sa(){var b,c;b=f;46===a.charCodeAt(f)?(c=$d,f++):(c=e,0===v&&h(ae));c!==e?(c=U(),c===e&&(c=null),c!==e?b="."+(null!=c?c:""):(f=b,b=e)):(f=b,b=e);return b}function da(){var b,c,d;c=b=f;be.test(a.charAt(f))?
(d=a.charAt(f),f++):(d=e,0===v&&h(ce));d!==e?(de.test(a.charAt(f))?(d=a.charAt(f),f++):(d=e,0===v&&h(ee)),d===e&&(d=null),d!==e?c="e"+(null===d?"":d):(f=c,c=e)):(f=c,c=e);c!==e?(d=U(),d!==e?b=c+d:(f=b,b=e)):(f=b,b=e);return b}function U(){var a,b;a=[];b=Z();if(b!==e)for(;b!==e;)a.push(b),b=Z();else a=e;a!==e&&(a=a.join(""));return a}function Z(){var b;fe.test(a.charAt(f))?(b=a.charAt(f),f++):(b=e,0===v&&h(ge));return b}function ia(){var b,c,d;b=f;a.substr(f,2).toLowerCase()===he?(c=a.substr(f,2),
f+=2):(c=e,0===v&&h(ie));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="IN":(f=b,b=e)):(f=b,b=e);return b}function X(){var b,c,d;b=f;a.substr(f,2).toLowerCase()===je?(c=a.substr(f,2),f+=2):(c=e,0===v&&h(ke));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="IS":(f=b,b=e)):(f=b,b=e);return b}function ca(){var b,c,d;b=f;a.substr(f,4).toLowerCase()===le?(c=a.substr(f,4),f+=4):(c=e,0===v&&h(me));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="LIKE":(f=b,b=e)):(f=b,b=e);
return b}function L(){var b,c,d;b=f;a.substr(f,3).toLowerCase()===ne?(c=a.substr(f,3),f+=3):(c=e,0===v&&h(oe));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="NOT":(f=b,b=e)):(f=b,b=e);return b}function ha(){var b,c,d;b=f;a.substr(f,3).toLowerCase()===pe?(c=a.substr(f,3),f+=3):(c=e,0===v&&h(qe));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="AND":(f=b,b=e)):(f=b,b=e);return b}function ja(){var b,c,d;b=f;a.substr(f,2).toLowerCase()===re?(c=a.substr(f,2),f+=2):(c=e,0===v&&h(se));
c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="OR":(f=b,b=e)):(f=b,b=e);return b}function ka(){var b,c,d;b=f;a.substr(f,7).toLowerCase()===te?(c=a.substr(f,7),f+=7):(c=e,0===v&&h(ue));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="BETWEEN":(f=b,b=e)):(f=b,b=e);return b}function Ea(){var b,c,d;b=f;a.substr(f,4).toLowerCase()===ve?(c=a.substr(f,4),f+=4):(c=e,0===v&&h(we));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="FROM":(f=b,b=e)):(f=b,b=e);return b}function Oa(){var b,
c,d;b=f;a.substr(f,4).toLowerCase()===xe?(c=a.substr(f,4),f+=4):(c=e,0===v&&h(ye));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="TRIM":(f=b,b=e)):(f=b,b=e);return b}function Pa(){var b,c,d;b=f;a.substr(f,8).toLowerCase()===ze?(c=a.substr(f,8),f+=8):(c=e,0===v&&h(Ae));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="INTERVAL":(f=b,b=e)):(f=b,b=e);return b}function bb(){var b,c,d;b=f;a.substr(f,4).toLowerCase()===Be?(c=a.substr(f,4),f+=4):(c=e,0===v&&h(Ce));c!==e?(c=f,v++,d=D(),
v--,d===e?c=void 0:(f=c,c=e),c!==e?b="YEAR":(f=b,b=e)):(f=b,b=e);return b}function Qa(){var b,c,d;b=f;a.substr(f,5).toLowerCase()===De?(c=a.substr(f,5),f+=5):(c=e,0===v&&h(Ee));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="MONTH":(f=b,b=e)):(f=b,b=e);return b}function cb(){var b,c,d;b=f;a.substr(f,3).toLowerCase()===Fe?(c=a.substr(f,3),f+=3):(c=e,0===v&&h(Ge));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="DAY":(f=b,b=e)):(f=b,b=e);return b}function yc(){var b,c,d;b=f;a.substr(f,
4).toLowerCase()===He?(c=a.substr(f,4),f+=4):(c=e,0===v&&h(Ie));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="HOUR":(f=b,b=e)):(f=b,b=e);return b}function zc(){var b,c,d;b=f;a.substr(f,6).toLowerCase()===Je?(c=a.substr(f,6),f+=6):(c=e,0===v&&h(Ke));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="MINUTE":(f=b,b=e)):(f=b,b=e);return b}function Fa(){var b,c,d;b=f;a.substr(f,6).toLowerCase()===Le?(c=a.substr(f,6),f+=6):(c=e,0===v&&h(Me));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:
(f=c,c=e),c!==e?b="SECOND":(f=b,b=e)):(f=b,b=e);return b}function Ib(){var b,c,d;b=f;a.substr(f,4).toLowerCase()===Ne?(c=a.substr(f,4),f+=4):(c=e,0===v&&h(Oe));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="CASE":(f=b,b=e)):(f=b,b=e);return b}function Jb(){var b,c,d;b=f;a.substr(f,3).toLowerCase()===Pe?(c=a.substr(f,3),f+=3):(c=e,0===v&&h(Qe));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="END":(f=b,b=e)):(f=b,b=e);return b}function db(){var b,c,d;b=f;a.substr(f,4).toLowerCase()===
Re?(c=a.substr(f,4),f+=4):(c=e,0===v&&h(Se));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="WHEN":(f=b,b=e)):(f=b,b=e);return b}function eb(){var b,c,d;b=f;a.substr(f,4).toLowerCase()===Te?(c=a.substr(f,4),f+=4):(c=e,0===v&&h(Ue));c!==e?(c=f,v++,d=D(),v--,d===e?c=void 0:(f=c,c=e),c!==e?b="THEN":(f=b,b=e)):(f=b,b=e);return b}function za(){var b;44===a.charCodeAt(f)?(b=Ve,f++):(b=e,0===v&&h(We));return b}function ea(){var b;40===a.charCodeAt(f)?(b=Xe,f++):(b=e,0===v&&h(Ye));return b}function fa(){var b;
41===a.charCodeAt(f)?(b=Ze,f++):(b=e,0===v&&h($e));return b}function y(){var a,b;a=[];for(b=Fb();b!==e;)a.push(b),b=Fb();return a}function Fb(){var b;af.test(a.charAt(f))?(b=a.charAt(f),f++):(b=e,0===v&&h(bf));return b}function hb(a,b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function Aa(a,b){for(var c=0;c<b.length;c++)a=hb(b[c][1],a,b[c][3]);return a}q=void 0!==q?q:{};var e={},Gb={start:u},Hb=u,$c="!",ad=l("!",!1),fb="\x3d",gb=l("\x3d",!1),ib="\x3e\x3d",
dd=l("\x3e\x3d",!1),ed="\x3e",fd=l("\x3e",!1),jb="\x3c\x3d",gd=l("\x3c\x3d",!1),kb="\x3c\x3e",hd=l("\x3c\x3e",!1),id="\x3c",jd=l("\x3c",!1),lb="!\x3d",kd=l("!\x3d",!1),fc="+",gc=l("+",!1),hc="-",ic=l("-",!1),ld="*",md=l("*",!1),nd="/",od=l("/",!1),Hd=/^[A-Za-z_\x80-\uFFFF]/,Id=b([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Jd=/^[A-Za-z0-9_]/,Kd=b([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Ld=/^[A-Za-z0-9_.\x80-\uFFFF]/,Md=b([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),
Nd="@",Od=l("@",!1),xb=function(a){return{type:"interval-period",period:a.value,precision:null,secondary:null}},yb=function(a,b){return{type:"interval-period",period:"second",precision:a,secondary:b}},zb="'",Ab=l("'",!1),Bb="N'",Xd=l("N'",!1),Da="''",Cb=l("''",!1),Db=/^[^']/,Eb=b(["'"],!0,!1),$d=".",ae=l(".",!1),fe=/^[0-9]/,ge=b([["0","9"]],!1,!1),be=/^[eE]/,ce=b(["e","E"],!1,!1),de=/^[+\-]/,ee=b(["+","-"],!1,!1),td="null",ud=l("NULL",!0),pd="true",qd=l("TRUE",!0),rd="false",sd=l("FALSE",!0),he="in",
ie=l("IN",!0),je="is",ke=l("IS",!0),le="like",me=l("LIKE",!0),bd="escape",cd=l("ESCAPE",!0),ne="not",oe=l("NOT",!0),pe="and",qe=l("AND",!0),re="or",se=l("OR",!0),te="between",ue=l("BETWEEN",!0),ve="from",we=l("FROM",!0),Dd="for",Ed=l("FOR",!0),Bd="substring",Cd=l("SUBSTRING",!0),zd="extract",Ad=l("EXTRACT",!0),xe="trim",ye=l("TRIM",!0),Fd="position",Gd=l("POSITION",!0),xd="timestamp",yd=l("TIMESTAMP",!0),vd="date",wd=l("DATE",!0),Pd="leading",Qd=l("LEADING",!0),Rd="trailing",Sd=l("TRAILING",!0),Td=
"both",Ud=l("BOTH",!0),Vd="to",Wd=l("TO",!0),ze="interval",Ae=l("INTERVAL",!0),Be="year",Ce=l("YEAR",!0),De="month",Ee=l("MONTH",!0),Fe="day",Ge=l("DAY",!0),He="hour",Ie=l("HOUR",!0),Je="minute",Ke=l("MINUTE",!0),Le="second",Me=l("SECOND",!0),Ne="case",Oe=l("CASE",!0),Pe="end",Qe=l("END",!0),Re="when",Se=l("WHEN",!0),Te="then",Ue=l("THEN",!0),Yd="else",Zd=l("ELSE",!0),Ve=",",We=l(",",!1),Xe="(",Ye=l("(",!1),Ze=")",$e=l(")",!1),af=/^[ \t\n\r]/,bf=b([" ","\t","\n","\r"],!1,!1),Sc="`",Tc=l("`",!1),Uc=
/^[^`]/,Vc=b(["`"],!0,!1),f=0,Ga=[{line:1,column:1}],la=0,Sa=[],v=0,ya;if("startRule"in q){if(!(q.startRule in Gb))throw Error("Can't start parsing from rule \""+q.startRule+'".');Hb=Gb[q.startRule]}ya=Hb();if(ya!==e&&f===a.length)return ya;ya!==e&&f<a.length&&h({type:"end"});throw function(a,b,c){return new C(C.buildMessage(a,b),a,b,c)}(Sa,la<a.length?a.charAt(la):null,la<a.length?k(la,la+1):k(la,la));}}})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require","exports"],
function(C,a){Object.defineProperty(a,"__esModule",{value:!0});a.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,
supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/iteratorUtils ../../../core/maybe ../../../core/promiseUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils".split(" "),
function(C,a,q,l,b,c,k,h,u,t,z,w,F,B,I,E){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(a,b,c){this.items=a;this.queryGeometry=b;this.definitionExpression=c.definitionExpression;this.geometryType=c.geometryType;this.hasM=c.hasM;this.hasZ=c.hasZ;this.objectIdField=c.objectIdField;this.spatialReference=c.spatialReference;this.fieldsIndex=c.fieldsIndex;this.timeInfo=c.timeInfo;this.featureAdapter=c.featureAdapter}Object.defineProperty(a.prototype,"size",{get:function(){return this.items.length},
enumerable:!0,configurable:!0});a.prototype.createQueryResponse=function(a){var b;b=a.outStatistics?a.outStatistics.some(function(a){return"exceedslimit"===a.statisticType})?this._createExceedsLimitQueryResponse(a):this._createStatisticsQueryResponse(a):this._createFeatureQueryResponse(a);a.returnQueryGeometry&&(t.isValid(a.outSR)&&!t.equals(this.queryGeometry.spatialReference,a.outSR)?b.queryGeometry=E.cleanFromGeometryEngine(q({spatialReference:a.outSR},B.project(this.queryGeometry,this.queryGeometry.spatialReference,
a.outSR))):b.queryGeometry=E.cleanFromGeometryEngine(q({spatialReference:a.outSR},this.queryGeometry)));return b};a.prototype.executeAttributesQuery=function(b){var c=F.getWhereClause(b.where,this.fieldsIndex);if(!c)return h.resolve(this);if(c.isStandardized){for(var d=0,k=[],l=0,u=this.items;l<u.length;l++){var t=u[l];c.testFeature(t,this.featureAdapter)&&(k[d++]=t)}c=new a(k,this.queryGeometry,this);c.definitionExpression=b.where;return h.resolve(c)}return h.reject(new TypeError("Where clause is not standardized"))};
a.prototype.executeObjectIdsQuery=function(b){if(!b.objectIds||!b.objectIds.length)return h.resolve(this);var d=c.SetFromValues(b.objectIds),g=this.featureAdapter.getObjectId;return h.resolve(new a(this.items.filter(function(a){return d.has(g(a))}),this.queryGeometry,this))};a.prototype.executeTimeQuery=function(b){b=I.getTimeOperator(this.timeInfo,b.timeExtent,this.featureAdapter);if(!k.isSome(b))return h.resolve(this);b=this.items.filter(b);return h.resolve(new a(b,this.queryGeometry,this))};a.prototype.project=
function(c){return b(this,void 0,void 0,function(){var b,d,h,k=this;return l(this,function(g){switch(g.label){case 0:if(!c||t.equals(this.spatialReference,c))return[2,this];b=this.featureAdapter;return[4,B.projectMany(this.items.map(function(a){return E.getGeometry(k,b.getGeometry(a))}),this.spatialReference,c)];case 1:return d=g.sent(),h=d.map(function(a,c){return b.cloneWithGeometry(k.items[c],z.convertFromGeometry(a,k.hasZ,k.hasM))}),[2,new a(h,this.queryGeometry,{definitionExpression:this.definitionExpression,
geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:c,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}})})};a.prototype._createFeatureQueryResponse=function(a){var b=this,c=this.items,d=this.geometryType,h=this.hasM,k=this.hasZ,l=this.objectIdField,t=this.spatialReference,q=a.outFields,J=a.outSR,w=a.quantizationParameters,H=a.resultRecordCount,m=a.resultOffset,x=!1;null!=H&&null!=m&&(H=m+H,x=c.length>
H,c=c.slice(m,Math.min(c.length,H)));return{exceededTransferLimit:x,features:this._createFeatures(a,c),fields:q&&q.map(function(a){return b.fieldsIndex.get(a)}),geometryType:d,hasM:h,hasZ:k,objectIdFieldName:l,spatialReference:E.cleanFromGeometryEngine(J?J:t),transform:w&&u.toQuantizationTransform(w)||null}};a.prototype._createFeatures=function(a,b){var c=new w.default(a,this.featureAdapter,this.fieldsIndex),d=a.quantizationParameters,h=a.returnGeometry,k=a.returnCentroid,l=a.maxAllowableOffset,n=
a.orderByFields;a=[];var t=0;if(b.length&&n&&n.length){var n=n[0].split(" "),J=n[0],q=this.fieldsIndex.get(J),H="DESC"===n[1];b.sort(function(a,b){a=c.getFieldValue(a,J,q);b=c.getFieldValue(b,J,q);if("number"===typeof a&&"number"===typeof b)return H?b-a:a-b;if("string"===typeof a&&"string"===typeof b)return a=a.toUpperCase(),b=b.toUpperCase(),(H?a>b:a<b)?-1:(H?a<b:a>b)?1:0})}if(h||k)if(d=u.toQuantizationTransform(d),h&&!k)for(k=0;k<b.length;k++)h=b[k],a[t++]={attributes:c.getAttributes(h),geometry:E.getGeometry(this,
this.featureAdapter.getGeometry(h),l,d)};else if(!h&&k)for(l=0;l<b.length;l++)h=b[l],a[t++]={attributes:c.getAttributes(h),centroid:E.transformCentroid(this,this.featureAdapter.getCentroid(h,this),d)};else for(k=0;k<b.length;k++)h=b[k],a[t++]={attributes:c.getAttributes(h),centroid:E.transformCentroid(this,this.featureAdapter.getCentroid(h,this),d),geometry:E.getGeometry(this,this.featureAdapter.getGeometry(h),l,d)};else for(l=0;l<b.length;l++)h=b[l],(h=c.getAttributes(h))&&(a[t++]={attributes:h});
return a};a.prototype._createExceedsLimitQueryResponse=function(a){var b=!1,c=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,h=0;for(a=a.outStatistics;h<a.length;h++){var k=a[h];if("exceedslimit"===k.statisticType){c=null!=k.maxPointCount?k.maxPointCount:Number.POSITIVE_INFINITY;d=null!=k.maxRecordCount?k.maxRecordCount:Number.POSITIVE_INFINITY;b=null!=k.maxVertexCount?k.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)b=this.items.length>
c;else if(this.items.length>d)b=!0;else var c=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter,b=this.items.reduce(function(a,b){b=l.getGeometry(b);return a+(b&&b.coords.length||0)},0)/c>b;return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(b)}}]}};a.prototype._createStatisticsQueryResponse=function(a){var b=new w.default(a,this.featureAdapter,this.fieldsIndex),
c=a.outStatistics,d=[],h=[],k=a.groupByFieldsForStatistics;a=a.having;for(var l=k&&k.length,k=l&&k[0],u=this.fieldsIndex.get(k),t=!u,J={},q={},H={},m={attributes:{}},x=0;x<c.length;x++){var z=c[x],B=z.outStatisticFieldName,F=z.statisticType,z="exceedslimit"!==F?z.onStatisticField:void 0,E=this.fieldsIndex.get(z),G=l&&(z===k||t)&&"count"===F;if(l){J[z]||(J[z]=this._calculateUniqueValues(b,k,u));var C=J[z],I;for(I in C){var da=C[I],U=da.count,Z=da.data,ia=da.items;if(!a||b.validateItems(ia,a)){var da=
q[Z]||{attributes:{}},X=null;G?X=U:(U=this._calculateStatistics(ia,b,z,E),ia="var"===F?"variance":F,X=U[ia]);da.attributes[B]=X;da.attributes[t?"EXPR_1":k]=Z;q[Z]=da}}}else H[z]||(H[z]=this._calculateStatistics(this.items,b,z,E)),U=H[z],ia="var"===F?"variance":F,m.attributes[B]=U[ia];h.push({name:B,alias:B,type:"esriFieldTypeDouble"})}if(l)for(var ca in q)d.push(q[ca]);else d.push(m);return{fields:h,features:d}};a.prototype._calculateStatistics=function(a,b,c,h){for(var d=Number.POSITIVE_INFINITY,
g=Number.NEGATIVE_INFINITY,k=null,l=null,n=null,p=null,u=[],t=0,m=0;m<a.length;m++){var x=b.getFieldValue(a[m],c,h);"string"===typeof x?t++:null==x||isNaN(x)||(k+=x,d=Math.min(d,x),g=Math.max(g,x),u.push(x),t++)}if(t){l=k/t;for(b=a=0;b<u.length;b++)x=u[b],a+=Math.pow(x-l,2);p=1<t?a/(t-1):0;n=Math.sqrt(p)}else g=d=null;return{avg:l,count:t,max:g,min:d,stddev:n,sum:k,variance:p}};a.prototype._calculateUniqueValues=function(a,b,c){for(var d={},g=0,h=this.items;g<h.length;g++){var k=h[g],l=a.getFieldValue(k,
b,c);if(null==l||"string"===typeof l&&""===l.trim())l=null;null==d[l]?d[l]={count:1,data:l,items:[k]}:(d[l].count++,d[l].items.push(k))}return d};return a}();a.default=C})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["require","exports","../../../core/maybe","./attributeSupport"],function(C,a,q,l){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(a,b,h){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=a.returnDistinctValues;
this.fieldsIndex=h;this.featureAdapter=b;if((a=a.outFields)&&-1===a.indexOf("*")){this.outFields=a;for(var c=b=0;c<a.length;c++){var k=a[c],q=l.getExpressionFromFieldName(k),w=this.fieldsIndex.get(q),q=w?null:l.getWhereClause(q,h),w=w?w.name:l.getAliasFromFieldName(k)||"FIELD_EXP_"+b++;this._fieldDataCache.set(k,{alias:w,clause:q})}}}a.prototype.getAttributes=function(a){a=this._processAttributesForOutFields(a);return this._processAttributesForDistinctValues(a)};a.prototype.getFieldValue=function(a,
b,h){var c=h?h.name:b,k=null;this._fieldDataCache.has(c)?k=this._fieldDataCache.get(c).clause:h||(k=l.getWhereClause(b,this.fieldsIndex),this._fieldDataCache.set(c,{alias:c,clause:k}));return h?this.featureAdapter.getAttribute(a,c):k.calculateValue(a,this.featureAdapter)};a.prototype.validateItem=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:l.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testFeature(a,this.featureAdapter)};
a.prototype.validateItems=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:l.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testSet(a,this.featureAdapter)};a.prototype._processAttributesForOutFields=function(a){var b=this.outFields;if(!b||!b.length)return this.featureAdapter.getAttributes(a);for(var c={},l=0;l<b.length;l++){var q=this._fieldDataCache.get(b[l]),z=q.alias,q=q.clause;c[z]=q?q.calculateValue(a,this.featureAdapter):this.featureAdapter.getAttribute(a,
z)}return c};a.prototype._processAttributesForDistinctValues=function(a){if(q.isNone(a)||!this.returnDistinctValues)return a;var b=this.outFields,c=[];if(b)for(var l=0;l<b.length;l++){var t=this._fieldDataCache.get(b[l]).alias;c.push(a[t])}else for(t in a)c.push(a[t]);b=(b||["*"]).join(",")+"\x3d"+c.join(",");c=this._returnDistinctMap.get(b)||0;this._returnDistinctMap.set(b,++c);return 1<c?null:a};return a}();a.default=C})},"esri/layers/graphics/data/timeSupport":function(){define(["require","exports"],
function(C,a){function q(a,c,k,h,l){if(null!=h&&null!=l&&h===l)return function(b){return h>=a.getAttribute(b,c)&&h<=a.getAttribute(b,k)};if(null!=h&&null!=l)return function(b){var u=a.getAttribute(b,c);b=a.getAttribute(b,k);return!(u>l||b<h)};if(null!=h)return function(b){return!(a.getAttribute(b,k)<h)};if(null!=l)return function(b){return!(a.getAttribute(b,c)>l)}}function l(a,c,k,h){if(null!=k&&null!=h&&k===h)return function(b){return a.getAttribute(b,c)===k};if(null!=k&&null!=h)return function(b){return a.getAttribute(b,
c)>=k&&a.getAttribute(b,c)<=h};if(null!=k)return function(b){return a.getAttribute(b,c)>=k};if(null!=h)return function(b){return a.getAttribute(b,c)<=h}}Object.defineProperty(a,"__esModule",{value:!0});a.getTimeExtent=function(a,c){if(!a)return null;var b=c.featureAdapter,h=a.startTimeField,l=a.endTimeField,q=Number.POSITIVE_INFINITY,z=Number.NEGATIVE_INFINITY;if(h&&l)c.forEach(function(a){var c=b.getAttribute(a,h);a=b.getAttribute(a,l);null==c||isNaN(c)||(q=Math.min(q,c));null==a||isNaN(a)||(z=Math.max(z,
a))});else{var w=h||l;c.forEach(function(a){a=b.getAttribute(a,w);null==a||isNaN(a)||(q=Math.min(q,a),z=Math.max(z,a))})}return{start:q,end:z}};a.getTimeOperator=function(a,c,k){if(!c||!a)return null;var b=a.startTimeField;a=a.endTimeField;if(!b&&!a)return null;var u=c.start;c=c.end;return null==u&&null==c?null:b&&a?q(k,b,a,u,c):l(k,b||a,u,c)}})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/jsonMap ../../../core/maybe ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),
function(C,a,q,l,b,c,k,h,u,t,z,w,F,B,I,E,G){function d(a,b,c){c&&(b=B.quantizeOptimizedGeometry(A,b,a.hasZ,a.hasM,"esriGeometryPoint",c));return B.convertToPoint(b,a.hasZ,a.hasM)}function n(b,d,h){return l(this,void 0,void 0,function(){var k,l,n,p,r,J;return q(this,function(m){switch(m.label){case 0:if(!b)return[2,null];k=b.where;b.where=k=k&&k.trim();if(!k||/^1 *= *1$/.test(k)||d&&d===k)b.where=null;return b.geometry?[4,g(b)]:[2,b];case 1:return l=m.sent(),b.distance=0,b.units=null,"esriSpatialRelEnvelopeIntersects"===
b.spatialRel&&(n=b.geometry.spatialReference,l=u.getGeometryExtent(l),l.spatialReference=n),b.geometry=l,[4,E.checkProjectionSupport(l.spatialReference,h)];case 2:return m.sent(),[4,z.normalizeCentralMeridian(t.fromJSON(l))];case 3:p=m.sent()[0];if(c.isNone(p))throw a.QUERY_ENGINE_EMPTY_RESULT;r=p.toJSON();return[4,E.project(r,r.spatialReference,h)];case 4:J=m.sent();if(!J)throw a.QUERY_ENGINE_EMPTY_RESULT;J.spatialReference=h;b.geometry=J;return[2,b]}})})}function g(a){return l(this,void 0,void 0,
function(){var b,c,d,g,l,n,r,u,J,t;return q(this,function(m){switch(m.label){case 0:b=a.geometry;c=a.distance;d=a.units;if(null==c)return[2,k.resolve(b)];g=b.spatialReference;l=d&&p.fromJSON(d)||h.getUnitString(g);n=g&&(w.isGeographic(g)||w.isWebMercator(g));if(!n)return[3,1];u=b;return[3,3];case 1:return[4,E.checkProjectionSupport(g,w.WGS84).then(function(){return E.project(b,w.WGS84)})];case 2:u=m.sent(),m.label=3;case 3:return r=u,[4,G.getGeodesicBufferOperator()];case 4:return J=m.sent(),t=J(r,
c,l),[2,t?t.toJSON():null]}})})}Object.defineProperty(a,"__esModule",{value:!0});var p=new b.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});a.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var r=new I.default,A=new I.default,D={esriGeometryPoint:B.convertToPoint,esriGeometryPolyline:B.convertToPolyline,esriGeometryPolygon:B.convertToPolygon,
esriGeometryMultipoint:B.convertToMultipoint};a.transformCentroid=d;a.getCentroid=function(a,b,c){if("esriGeometryPolygon"!==a.geometryType||!b||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=F.getCentroidOptimizedGeometry(new I.default,b.geometry,a.hasZ,a.hasM));return d(a,b.centroid,c)};a.getGeometry=function(a,b,c,d){b=b?"coords"in b?b:b.geometry:null;return b?c?(c=B.generalizeOptimizedGeometry(r,b,a.hasZ,a.hasM,a.geometryType,c),d&&(c=B.quantizeOptimizedGeometry(A,c,a.hasZ,a.hasM,
a.geometryType,d)),D[a.geometryType](c,a.hasZ,a.hasM)):d?(c=B.quantizeOptimizedGeometry(A,b,a.hasZ,a.hasM,a.geometryType,d),D[a.geometryType](c,a.hasZ,a.hasM)):D[a.geometryType](b,a.hasZ,a.hasM):null};a.normalizeQuery=function(a,b,c){return l(this,void 0,void 0,function(){var d,g,h,k,l;return q(this,function(m){d=a.outFields;g=a.orderByFields;h=a.groupByFieldsForStatistics;k=a.outStatistics;if(d)for(l=0;l<d.length;l++)d[l]=d[l].trim();if(g)for(l=0;l<g.length;l++)g[l]=g[l].trim();if(h)for(l=0;l<h.length;l++)h[l]=
h[l].trim();if(k)for(l=0;l<k.length;l++)k[l].onStatisticField&&(k[l].onStatisticField=k[l].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,n(a,b,c)]})})};a.normalizeFilter=function(a,b,c){return l(this,void 0,void 0,function(){return q(this,function(d){return[2,n(a,b,c)]})})};a.normalizeQueryLike=n;a.cleanFromGeometryEngine=function(a){return a&&V in a?JSON.parse(JSON.stringify(a,W)):a};var V="_geVersion",W=function(a,b){return a!==V?b:void 0}})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(C,a,q,l,b,c,k,h,u,t,z,w,F,B,I){function E(){return c.create(function(a){return C(["../../../geometry/geometryEngine"],a)})}Object.defineProperty(a,"__esModule",{value:!0});var G={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",
esriSpatialRelRelation:null},d={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},n={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},g={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,
esriGeometryPolygon:!0,esriGeometryEnvelope:!1};a.importGeometryEngine=E;a.getGeodesicBufferOperator=function(){return E().then(function(a){return a.geodesicBuffer})};a.getSpatialQueryOperator=function(a,b,d){if(u.isPolygon(b)&&"esriGeometryPoint"===d.geometryType&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a)){var g=w.convertFromPolygon(new F.default,b,!1,!1);return c.resolve(function(a){return z.polygonContainsPoint(g,!1,!1,a)})}if(u.isPolygon(b)&&"esriGeometryMultipoint"===d.geometryType){var l=
w.convertFromPolygon(new F.default,b,!1,!1);if("esriSpatialRelContains"===a)return c.resolve(function(a){return z.polygonContainsMultipoint(l,!1,!1,a,d.hasZ,d.hasM)})}if(u.isExtent(b)&&"esriGeometryPoint"===d.geometryType&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a))return c.resolve(function(a){return k.extentContainsPoint(b,I.getGeometry(d,a))});if(u.isExtent(b)&&"esriGeometryMultipoint"===d.geometryType&&"esriSpatialRelContains"===a)return c.resolve(function(a){return k.extentContainsMultipoint(b,
I.getGeometry(d,a))});if(u.isExtent(b)&&"esriSpatialRelIntersects"===a){var n=h.getExtentIntersector(d.geometryType);return c.resolve(function(a){return n(b,I.getGeometry(d,a))})}return E().then(function(c){var g=c[G[a]].bind(null,b);return function(a){return g(I.getGeometry(d,a))}})};a.checkSpatialQuerySupport=function(a,c,h){return l(this,void 0,void 0,function(){var k,l;return q(this,function(p){k=a.spatialRel;l=a.geometry;if(!l)return[2];if(!0!==d[k])throw new b("feature-store:unsupported-query",
"Unsupported query spatial relationship",{query:a});if(!t.isValid(l.spatialReference)||!t.isValid(h))return[2];if(!0!==n[u.getJsonType(l)])throw new b("feature-store:unsupported-query","Unsupported query geometry type",{query:a});if(!0!==g[c])throw new b("feature-store:unsupported-query","Unsupported layer geometry type",{query:a});return a.outSR?[2,B.checkProjectionSupport(a.geometry&&a.geometry.spatialReference,a.outSR)]:[2]})})};a.canQueryWithRBush=function(a){if(u.isExtent(a))return!0;if(u.isPolygon(a)){var b=
0;for(a=a.rings;b<a.length;b++){var c=a[b];if(5!==c.length||c[0][0]!==c[1][0]||c[0][0]!==c[4][0]||c[2][0]!==c[3][0]||c[0][1]!==c[3][1]||c[0][1]!==c[4][1]||c[1][1]!==c[2][1])return!1}return!0}return!1}})},"esri/layers/graphics/contains":function(){define(["require","exports"],function(C,a){function q(a,b,c,k,h){if(!a)return!1;b=b?c?4:3:c?3:2;c=a.coords;var l=!1,q=0,z=0;for(a=a.lengths;z<a.length;z++){for(var w=a[z],F=q,B=q,C=q+w*b;B<C;B+=b){F=B+b;F===C&&(F=q);var E=c[B],G=c[B+1],d=c[F],F=c[F+1];(G<
h&&F>=h||F<h&&G>=h)&&E+(h-G)/(F-G)*(d-E)<k&&(l=!l)}q+=w*b}return l}Object.defineProperty(a,"__esModule",{value:!0});a.polygonContainsPoint=function(a,b,c,k){return q(a,b,c,k.coords[0],k.coords[1])};a.polygonContainsMultipoint=function(a,b,c,k,h,u){h=h?u?4:3:u?3:2;u=k.coords;k=k.lengths;if(!k)return!1;for(var l=0,z=0;l<k.length;l++,z+=h)if(!q(a,b,c,u[z],u[z+1]))return!1;return!0};a.polygonContainsCoords=q})},"esri/layers/support/PromiseQueue":function(){define(["require","exports","../../core/promiseUtils"],
function(C,a,q){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(){this._deferreds=[];this._values=[]}a.prototype.push=function(a){var b=this;return q.create(function(c,h){b._deferreds.push({resolve:c,reject:h});b._values.push(a)})};a.prototype.unshift=function(a){var b=this;return q.create(function(c,h){b._deferreds.unshift({resolve:c,reject:h});b._values.unshift(a)})};Object.defineProperty(a.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,
configurable:!0});a.prototype.process=function(){if(0===this.length)return!1;this._deferreds.shift().resolve(this._values.shift());return!0};a.prototype.cancelAll=function(){for(var a=q.createAbortError(),c=0,k=this._deferreds;c<k.length;c++)k[c].reject(a);this._deferreds.length=0;this._values.length=0};return a}();a.PromiseQueue=C})},"esri/layers/graphics/sources/support/clientSideDefaults":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/lang ../../../../symbols/support/defaultsJSON".split(" "),
function(C,a,q,l,b,c){Object.defineProperty(a,"__esModule",{value:!0});a.createDrawingInfo=function(a){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===a||"esriGeometryMultipoint"===a?c.defaultPointSymbolJSON:"esriGeometryPolyline"===a?c.defaultPolylineSymbolJSON:c.defaultPolygonSymbolJSON}}};a.createDefaultAttributesFunction=function(a,b){if(l("csp-restrictions"))return function(){var c;return q((c={},c[b]=null,c),a)};try{var c="this."+b+" \x3d null;",h;for(h in a)c+="this."+h+" \x3d "+
JSON.stringify(a[h])+";";var k=new Function(c);return function(){return new k}}catch(w){return function(){var c;return q((c={},c[b]=null,c),a)}}};a.createDefaultTemplate=function(a){void 0===a&&(a={});return[{name:"New Feature",description:"",prototype:{attributes:b.clone(a)}}]}})},"esri/layers/graphics/sources/support/sourceUtils":function(){define(["require","exports","../../../support/fieldUtils"],function(C,a,q){function l(a){return new c(a)}Object.defineProperty(a,"__esModule",{value:!0});var b=
function(){return function(){this.description=this.code=null}}();a.createFeatureEditError=function(a){return new b};var c=function(){return function(a){this.error=new b;this.objectId=this.globalId=null;this.success=!1;this.uniqueId=null;this.error.description=a}}();a.createFeatureEditErrorResult=l;var k=function(){return function(a){this.globalId=null;this.success=!0;this.objectId=this.uniqueId=a}}();a.createFeatureEditSuccessResult=function(a){return new k(a)};var h=new Set;a.mixAttributes=function(a,
b,c,k,F,B){void 0===F&&(F=!1);h.clear();for(var u in k){var t=a.get(u);if(t){var w=k[u],d;d=t;var n=w,g=n;"string"===typeof n&&q.isNumericField(d)?g=parseFloat(n):null!=n&&q.isStringField(d)&&"string"!==typeof n&&(g=String(n));d=q.sanitizeNullFieldValue(g);d!==w&&B&&B.push({name:"invalid-value-type",message:"attribute value was converted to match the field type",details:{field:t,originalValue:w,sanitizedValue:d}});h.add(t.name);if(t&&(F||t.editable)){if(w=q.validateFieldValue(t,d))return l(q.validationErrorToString(w,
t,d));c[t.name]=d}}}for(a=0;a<b.length;a++)if(c=b[a],!h.has(c.name))return l('missing required field "'+c.name+'"');return null}})},"*noref":1}});
define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/promiseUtils ../../../../geometry/support/coordsUtils ../../../../geometry/support/jsonUtils ../../../../geometry/support/spatialReferenceUtils ../../featureConversionUtils ../../data/FeatureStore ../../data/projectionSupport ../../data/QueryEngine ./clientSideDefaults ./sourceUtils ../../../support/FieldsIndex ../../../support/fieldType ../../../support/fieldUtils".split(" "),function(C,
a,q,l,b,c,k,h,u,t,z,w,F,B,I,E,G,d,n){function g(a){return u.isPoint(a)?null!=a.z:!!a.hasZ}function p(a){return u.isPoint(a)?null!=a.m:!!a.hasM}function r(a,b,c){a.geometry&&"rings"in a.geometry&&a.geometry.rings&&0<a.geometry.rings.length&&(h.isClockwise(a.geometry.rings[0],b,c)||h.closeRingsAndFixWinding(a.geometry))}Object.defineProperty(a,"__esModule",{value:!0});var A=t.WGS84,D={xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:t.WGS84},V={hasAttachments:!1,capabilities:"query, editing, create, delete, update",
useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};C=function(){function a(){this._nextObjectId=
this._queryEngine=null}a.prototype.destroy=function(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy();this._queryEngine=this._requiredFields=this._fieldsIndex=this._createDefaultAttributes=null};a.prototype.load=function(a,g){void 0===g&&(g={});return l(this,void 0,void 0,function(){var g,h,k,l,p,r,u,t,z,E,J,C,R,W,X,ca,L,ha,ja,ka,Ea,Oa,Pa,bb,Qa,cb;return q(this,function(m){switch(m.label){case 0:g=[];h=a.features;k=this._inferLayerProperties(h,a.fields);l=a.fields||[];p=null!=a.hasM?
a.hasM:k.hasM;r=null!=a.hasZ?a.hasZ:k.hasZ;t=(u=!a.spatialReference&&!k.spatialReference)?A:a.spatialReference||k.spatialReference;z=u?D:null;E=a.geometryType||k.geometryType;J=a.objectIdField||k.objectIdField;C=a.timeInfo;u&&g.push({name:"feature-layer:spatial-reference-not-found",message:"Spatial reference not provided or found in features. Defaults to WGS84"});if(!E)throw new c("feature-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");if(!J)throw new c("feature-layer:missing-property",
"objectIdField not set and couldn't be found in the provided fields");k.objectIdField&&J!==k.objectIdField&&(g.push({name:"feature-layer:duplicated-oid-field",message:'Provided objectIdField "'+J+'" doesn\'t match the field name "'+k.objectIdField+'", found in the provided fields'}),J=k.objectIdField);J&&!k.objectIdField&&(R=null,(W=l.some(function(a){return a.name===J?(R=a,!0):!1}))?(R.type="esriFieldTypeOID",R.editable=!1,R.nullable=!1):l.unshift({alias:J,name:J,type:"esriFieldTypeOID",editable:!1,
nullable:!1}));X=0;for(ca=l;X<ca.length;X++){L=ca[X];null==L.name&&(L.name=L.alias);null==L.alias&&(L.alias=L.name);if(!L.name)throw new c("feature-layer:invalid-field-name","field name is missing",{field:L});L.name===J&&(L.type="esriFieldTypeOID");if(-1===d.kebabDict.jsonValues.indexOf(L.type))throw new c("feature-layer:invalid-field-type",'invalid type for field "'+L.name+'"',{field:L});}ha={};this._requiredFields=[];ja=0;for(ka=l;ja<ka.length;ja++)L=ka[ja],"esriFieldTypeOID"!==L.type&&"esriFieldTypeGlobalID"!==
L.type&&(L.editable=null==L.editable?!0:!!L.editable,L.nullable=null==L.nullable?!0:!!L.nullable,Ea=n.getFieldDefaultValue(L),L.nullable||void 0!==Ea?ha[L.name]=Ea:this._requiredFields.push(L));this._fieldsIndex=new G(l);this._createDefaultAttributes=I.createDefaultAttributesFunction(ha,J);C&&(C.startTimeField&&((Oa=this._fieldsIndex.get(C.startTimeField))?(C.startTimeField=Oa.name,Oa.type="esriFieldTypeDate"):C.startTimeField=null),C.endTimeField&&((Pa=this._fieldsIndex.get(C.endTimeField))?(C.endTimeField=
Pa.name,Pa.type="esriFieldTypeDate"):C.endTimeField=null),C.trackIdField&&((bb=this._fieldsIndex.get(C.trackIdField))?C.trackIdField=bb.name:(C.trackIdField=null,g.push({name:"feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:C}}))),C.startTimeField||C.endTimeField||(g.push({name:"feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing or invalid",details:{timeInfo:C}}),C=null));Qa={warnings:g,featureErrors:[],layerDefinition:b({},
V,{drawingInfo:I.createDrawingInfo(E),templates:I.createDefaultTemplate(ha),extent:z,geometryType:E,objectIdField:J,fields:l,hasZ:!!r,hasM:!!p,timeInfo:C}),assignedObjectIds:{}};this._queryEngine=new B.default({fields:l,geometryType:E,hasM:p,hasZ:r,objectIdField:J,spatialReference:t,featureStore:new w.default({geometryType:E,hasM:p,hasZ:r}),timeInfo:C});if(!h||!h.length)return this._nextObjectId=1,[2,Qa];cb=h.reduce(function(a,b){b=b.attributes&&b.attributes[J];return null==b||isNaN(b)||!isFinite(b)?
a:Math.max(a,b)},0);this._nextObjectId=1+cb;return[4,F.checkProjectionSupport(h,t)];case 1:return m.sent(),[2,this._loadInitialFeatures(Qa,h)]}})})};a.prototype.applyEdits=function(a){return l(this,void 0,void 0,function(){var b;return q(this,function(c){switch(c.label){case 0:return b=this._queryEngine.spatialReference,[4,k.all([F.checkProjectionSupport(a.adds,b),F.checkProjectionSupport(a.updates,b)])];case 1:return c.sent(),[2,this._applyEdits(a)]}})})};a.prototype.queryFeatures=function(a,b){void 0===
b&&(b={});return l(this,void 0,void 0,function(){return q(this,function(c){return[2,this._queryEngine.executeQuery(a,b.signal)]})})};a.prototype.queryFeatureCount=function(a,b){void 0===b&&(b={});return l(this,void 0,void 0,function(){return q(this,function(c){return[2,this._queryEngine.executeQueryForCount(a,b.signal)]})})};a.prototype.queryObjectIds=function(a,b){void 0===b&&(b={});return l(this,void 0,void 0,function(){return q(this,function(c){return[2,this._queryEngine.executeQueryForIds(a,b.signal)]})})};
a.prototype.queryExtent=function(a,b){void 0===b&&(b={});return l(this,void 0,void 0,function(){return q(this,function(c){return[2,this._queryEngine.executeQueryForExtent(a,b.signal)]})})};a.prototype._inferLayerProperties=function(a,b){for(var c=void 0,d=void 0,h=null,k=null,l=null,n=0;n<a.length;n++){var q=a[n].geometry;if(q&&(h||(h=u.getJsonType(q)),k||(k=q.spatialReference),null==c&&(c=g(q)),null==d&&(d=p(q)),h&&k&&null!=c&&null!=d))break}if(b&&b.length){var r=null;b.some(function(a){var b="esriFieldTypeOID"===
a.type,c=!a.type&&a.name&&"objectid"===a.name.toLowerCase();r=a;return b||c})&&(l=r.name)}return{geometryType:h,spatialReference:k,objectIdField:l,hasM:d,hasZ:c}};a.prototype._loadInitialFeatures=function(a,b){for(var c=this._queryEngine,d=c.geometryType,g=c.hasM,h=c.hasZ,k=c.objectIdField,l=c.spatialReference,c=c.featureStore,n=[],p=0;p<b.length;p++){var q=b[p];null!=q.uid&&(a.assignedObjectIds[q.uid]=-1);if(q.geometry&&d!==u.getJsonType(q.geometry))a.featureErrors.push(E.createFeatureEditErrorResult("Incorrect geometry type."));
else{var t=this._createDefaultAttributes(),w=E.mixAttributes(this._fieldsIndex,this._requiredFields,t,q.attributes,!0,a.warnings);w?a.featureErrors.push(w):(this._assignObjectId(t,q.attributes,!0),q.attributes=t,null!=q.uid&&(a.assignedObjectIds[q.uid]=q.attributes[k]),q.geometry&&(r(q,g,h),q.geometry=F.project(q.geometry,q.geometry.spatialReference,l)),n.push(q))}}c.addMany(z.convertFromFeatures([],n,d,h,g,k));a.layerDefinition.extent=this._queryEngine.fullExtent;a.layerDefinition.timeInfo&&(b=this._queryEngine.timeExtent,
a.layerDefinition.timeInfo.timeExtent=[b.start,b.end]);return a};a.prototype._applyEdits=function(a){var b=a.adds,c=a.updates;a=a.deletes;var d={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};b&&b.length&&this._applyAddEdits(d,b);c&&c.length&&this._applyUpdateEdits(d,c);if(a&&a.length){for(b=0;b<a.length;b++)d.deleteResults.push(E.createFeatureEditSuccessResult(a[b]));this._queryEngine.featureStore.removeManyById(a)}return{fullExtent:this._queryEngine.fullExtent,featureEditResults:d}};
a.prototype._applyAddEdits=function(a,b){for(var c=a.addResults,d=this._queryEngine,g=d.geometryType,h=d.hasM,k=d.hasZ,l=d.objectIdField,n=d.spatialReference,d=d.featureStore,p=[],q=0;q<b.length;q++){var t=b[q];r(t,h,k);if(t.geometry&&g!==u.getJsonType(t.geometry))c.push(E.createFeatureEditErrorResult("Incorrect geometry type."));else{var w=this._createDefaultAttributes(),A=E.mixAttributes(this._fieldsIndex,this._requiredFields,w,t.attributes);A?c.push(A):(this._assignObjectId(w,t.attributes),t.attributes=
w,null!=t.uid&&(a.uidToObjectId[t.uid]=t.attributes[l]),t.geometry&&(t.geometry=F.project(t.geometry,t.geometry.spatialReference,n)),p.push(t),c.push(E.createFeatureEditSuccessResult(t.attributes[l])))}}d.addMany(z.convertFromFeatures([],p,g,k,h,l))};a.prototype._applyUpdateEdits=function(a,b){a=a.updateResults;for(var c=this._queryEngine,d=c.geometryType,g=c.hasM,h=c.hasZ,k=c.objectIdField,l=c.spatialReference,c=c.featureStore,n=0;n<b.length;n++){var p=b[n],q=p.attributes,t=p.geometry,p=q&&q[k];
if(null==p)a.push(E.createFeatureEditErrorResult("Identifier field "+k+" missing"));else if(c.has(p)){var w=z.convertToFeature(c.getFeature(p),d,h,g);if(t){if(d!==u.getJsonType(t)){a.push(E.createFeatureEditErrorResult("Incorrect geometry type."));continue}w.geometry=F.project(t,t.spatialReference,l);r(w,g,h)}if(q&&(q=E.mixAttributes(this._fieldsIndex,this._requiredFields,w.attributes,q))){a.push(q);continue}c.add(z.convertFromFeature(w,d,h,g,k));a.push(E.createFeatureEditSuccessResult(p))}else a.push(E.createFeatureEditErrorResult("Feature with object id "+
p+" missing"))}};a.prototype._assignObjectId=function(a,b,c){void 0===c&&(c=!1);var d=this._queryEngine.objectIdField;c?b&&isFinite(b[d])?a[d]=b[d]:a[d]=this._nextObjectId++:a[d]=this._nextObjectId++};return a}();a.default=C});