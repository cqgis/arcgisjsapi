// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.13/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../core/maybe ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f64 ./MeshMaterial ./MeshTexture ./meshUtils/georeference ../../views/3d/glTF/DefaultLoadingContext ../../views/3d/glTF/loader ../../views/3d/glTF/internal/indexUtils ../../views/3d/support/buffer/BufferView ../../views/3d/support/buffer/math ../../views/3d/support/buffer/utils ../../views/3d/webgl-engine/materials/DefaultMaterial".split(" "),
function(K,n,u,v,w,e,p,q,x,y,z,A,B,m,d,g,f,C){function D(a,d){var h=C.COLOR_GAMMA,h=[255*Math.pow(a.color[0],1/h),255*Math.pow(a.color[1],1/h),255*Math.pow(a.color[2],1/h),a.opacity],c=e.unwrap(e.applySome(a.textureColor,function(a){return d.get(a)})),l=e.unwrap(e.applySome(a.textureNormal,function(a){return d.get(a)})),b;a:{switch(a.alphaMode){case "OPAQUE":b="opaque";break a;case "MASK":b="mask";break a;case "BLEND":b="blend";break a}b=void 0}return new x({color:h,colorTexture:c,normalTexture:l,
alphaMode:b,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided})}function F(a,r,h,c,l){var b=f.createBuffer(d.BufferViewVec3f64,c.attributes.position.count);g.vec3.transformMat4(b,c.attributes.position,c.transform);var E=e.applySome(c.attributes.normal,function(a){var k=f.createBuffer(d.BufferViewVec3f,a.count),b=p.mat3.normalFromMat4(q.mat3f64.create(),c.transform);g.vec3.transformMat3(k,a,b);return k.typedBuffer}),G=e.applySome(c.attributes.tangent,function(a){var k=f.createBuffer(d.BufferViewVec4f,
a.count),b=p.mat3.normalFromMat4(q.mat3f64.create(),c.transform);g.vec4.transformMat3(k,a,b);return k.typedBuffer});r=e.applySome(c.attributes.texCoord0,function(a){var k=f.createBuffer(d.BufferViewVec2f,a.count);f.vec2.normalizeIntegerBuffer(k,a);return k.typedBuffer});var H=e.applySome(c.attributes.color,function(a){var b=f.createBuffer(d.BufferViewVec4u8,a.count);if(4===a.elementCount)a instanceof d.BufferViewVec4f?g.vec4.scale(b,a,255):a instanceof d.BufferViewVec4u8?f.vec4.copy(b,a):a instanceof
d.BufferViewVec4u16&&g.vec4.scale(b,a,1/255);else{f.vec4.fill(b,255,255,255,255);var c=new d.BufferViewVec3u8(b.buffer,0,4);a instanceof d.BufferViewVec3f?g.vec3.scale(c,a,255):a instanceof d.BufferViewVec3u8?f.vec3.copy(c,a):a instanceof d.BufferViewVec3u16&&g.vec3.scale(c,a,1/255)}return b.typedBuffer});l=z.georeference({position:b.typedBuffer,normal:e.unwrap(E),tangent:e.unwrap(G)},a,w({},l,{unit:"meters"}));b=I(c.indices||c.attributes.position.count,c.primitiveType);return{vertexAttributes:{position:l.position,
normal:l.normal,tangent:l.tangent,uv:e.unwrap(r),color:e.unwrap(H)},components:[{faces:b,material:h.get(c.material),trustSourceNormals:!0}],spatialReference:a.spatialReference}}function I(a,d){switch(d){case 4:return m.trianglesToTriangles(a);case 5:return m.triangleStripToTriangles(a);case 6:return m.triangleFanToTriangles(a)}}function J(a){return{horizontal:t(a.s),vertical:t(a.t)}}function t(a){switch(a){case 33071:return"clamp";case 33648:return"mirror";case 10497:return"repeat"}}Object.defineProperty(n,
"__esModule",{value:!0});n.loadGLTFMesh=function(a,d,e){return v(this,void 0,void 0,function(){var c,l,b,f,g,h;return u(this,function(k){switch(k.label){case 0:return c=new A.DefaultLoadingContext,[4,B.load(c,d,e)];case 1:return l=k.sent(),b=l.model,f=b.lods.shift(),g=new Map,h=new Map,b.textures.forEach(function(a,b){return g.set(b,new y({data:a.data,wrap:J(a.parameters.wrap)}))}),b.materials.forEach(function(a,b){return h.set(b,D(a,g))}),[2,f.parts.map(function(c){return F(a,b,h,c,e)})]}})})}});