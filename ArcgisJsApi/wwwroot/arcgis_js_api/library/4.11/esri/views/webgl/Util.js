// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils","../../core/Error"],function(w,e,t,u,v){function p(a){return a[0].stride}function q(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}function r(a){switch(a){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:return 4;case 34041:return 4;case 33325:return 2;
case 33326:return 4;case 35898:return 4;case 33327:return 4;case 33328:return 8;case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1;default:u.neverReached(a)}return 0}function n(a){if(!a)return 0;if("colorAttachment"in a)return a.glName?n(a.colorAttachment)+n(a.depthStencilAttachment):0;if("descriptor"in a)return a.glName?n(a.descriptor):0;var c=a.internalFormat||"pixelFormat"in a&&a.pixelFormat;if(!c)return 0;var b="hasMipmap"in
a&&a.hasMipmap?1.3:1;a=a.width*a.height;return r(c)*a*b}Object.defineProperty(e,"__esModule",{value:!0});e.vertexCount=function(a,c){return a.vertexBuffers[c].size/p(a.layout[c])};e.getStride=p;e.getBytesPerElement=q;e.addDescriptor=function(a,c,b,g,m,h){var d=q(g);if(0<a.length){var f=a[0].stride,k=f+d*b;a.forEach(function(a){return a.stride=k});a.push({name:c,count:b,type:g,offset:f,stride:k,normalized:m,divisor:h})}else a.push({name:c,count:b,type:g,offset:0,stride:d*b,normalized:m,divisor:h})};
e.assertCompatibleVertexAttributeLocations=function(a,c){(a=a.locations===c.locations)||console.error("VertexAttributeLocations are incompatible");return a};e.hasAttribute=function(a,c){for(var b=0;b<a.length;b++)if(a[b].name===c)return!0;return!1};e.findAttribute=function(a,c){for(var b=0;b<a.length;b++)if(a[b].name===c)return a[b];return null};e.copyFramebufferToTexture=function(a,c,b,g,m){void 0===m&&(m=0);var h=a.getBoundFramebufferObject(),d=a.getBoundTexture(0);a.bindFramebuffer(c);a.bindTexture(b,
0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,m,b.descriptor.pixelFormat,g[0],g[1],g[2],g[3],0);a.gl.flush();a.bindFramebuffer(h);a.bindTexture(d,0)};e.assert=function(a,c){if(!a)throw new v(c);};e.setBaseInstanceOffset=function(a,c){var b={},g;for(g in a)b[g]=a[g].map(function(a){return a.divisor?t({},a,{baseInstance:c}):a});return b};e.bindVertexBufferLayout=function(a,c,b,g,e){var h=a.gl,d=a.capabilities.instancing;a.bindBuffer(b);for(a=0;a<g.length;a++){b=g[a];var f=c[b.name],k=(e?e:0+b.baseInstance?
b.baseInstance:0)*b.stride;void 0===f&&console.error("There is no location for vertex attribute '"+b.name+"' defined.");b.baseInstance&&!b.divisor&&console.error("Vertex attribute '"+b.name+"' uses baseInstanceOffset without divisor.");if(4>=b.count)h.vertexAttribPointer(f,b.count,b.type,b.normalized,b.stride,b.offset+k),h.enableVertexAttribArray(f),b.divisor&&0<b.divisor&&d&&d.vertexAttribDivisor(f,b.divisor);else if(9===b.count)for(var l=0;3>l;l++)h.vertexAttribPointer(f+l,3,b.type,b.normalized,
b.stride,b.offset+12*l+k),h.enableVertexAttribArray(f+l),b.divisor&&0<b.divisor&&d&&d.vertexAttribDivisor(f+l,b.divisor);else if(16===b.count)for(l=0;4>l;l++)h.vertexAttribPointer(f+l,4,b.type,b.normalized,b.stride,b.offset+16*l+k),h.enableVertexAttribArray(f+l),b.divisor&&0<b.divisor&&d&&d.vertexAttribDivisor(f+l,b.divisor);else console.error("Unsupported vertex attribute element count: "+b.count)}};e.unbindVertexBufferLayout=function(a,c,b,e){var g=a.gl,h=a.capabilities.instancing;a.bindBuffer(b);
for(b=0;b<e.length;b++){var d=e[b],f=c[d.name];if(4>=d.count)g.disableVertexAttribArray(f),d.divisor&&0<d.divisor&&h&&h.vertexAttribDivisor(f,0);else if(9===d.count)for(var k=0;3>k;k++)g.disableVertexAttribArray(f+k),d.divisor&&0<d.divisor&&h&&h.vertexAttribDivisor(f+k,0);else if(16===d.count)for(k=0;4>k;k++)g.disableVertexAttribArray(f+k),d.divisor&&0<d.divisor&&h&&h.vertexAttribDivisor(f+k,0);else console.error("Unsupported vertex attribute element count: "+d.count)}a.unbindBuffer(34962)};e.getBytesPerElementFormat=
r;e.getGpuMemoryUsage=n});