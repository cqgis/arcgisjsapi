// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators ../../renderers/support/clickToleranceUtils ./RefreshableLayerView".split(" "),function(r,t,g,d,k,l,m,n,h,c,p,q){return function(f){function b(b){return f.call(this,b)||this}g(b,f);b.prototype.fetchPopupFeatures=function(b){return l(this,
void 0,void 0,function(){var c,e,d,f=this;return k(this,function(g){c=this.layer;if(!b)return[2,h.reject(new n("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:c}))];e=this.get("view.scale");d=c.allSublayers.toArray().filter(function(a){var b=0===a.minScale||e<=a.minScale,c=0===a.maxScale||e>=a.maxScale;return a.popupTemplate&&a.popupEnabled&&a.visible&&b&&c});return[2,h.eachAlways(d.map(function(a){return m.safeCast(a.popupTemplate.getRequiredFields()).then(function(c){var d=
a.createQuery(),e=p.calculateTolerance(a.renderer);d.geometry=f.createFetchPopupFeaturesQueryGeometry(b,e);d.outFields=c;return a.queryFeatures(d).then(function(a){return a.features})})})).then(function(a){return[].concat.apply([],a.map(function(a){return a.value}).filter(Boolean))})]})})};d([c.property()],b.prototype,"layer",void 0);return b=d([c.subclass("esri.views.layers.MapImageLayerView")],b)}(c.declared(q))});