// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators ../../renderers/support/clickToleranceUtils ./RefreshableLayerView".split(" "),function(q,r,h,b,k,l,m,f,d,n,p){return function(g){function c(c){return g.call(this,c)||this}h(c,g);c.prototype.fetchPopupFeatures=function(c){return l(this,void 0,void 0,
function(){var e,d,b,g=this;return k(this,function(h){e=this.layer;if(!c)return[2,f.reject(new m("tilelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:e}))];if("tile"!==e.type)return[2,f.reject(new m("tilelayerview:fetchPopupFeatures","Layer type should be 'tile'",{type:e.type}))];d=this.get("view.scale");b=e.allSublayers.toArray().filter(function(a){var c=0===a.minScale||d<=a.minScale,b=0===a.maxScale||d>=a.maxScale;return a.popupTemplate&&a.popupEnabled&&a.visible&&c&&b});return[2,
f.eachAlways(b.map(function(a){return l(g,void 0,void 0,function(){var b,d,e,g;return k(this,function(f){switch(f.label){case 0:return b=a.createQuery(),d=n.calculateTolerance(a.renderer),b.geometry=this.createFetchPopupFeaturesQueryGeometry(c,d),e=b,[4,a.popupTemplate.getRequiredFields()];case 1:return e.outFields=f.sent(),[4,a.queryFeatures(b)];case 2:return g=f.sent(),[2,g.features]}})})})).then(function(a){return[].concat.apply([],a.map(function(a){return a.value}).filter(Boolean))})]})})};b([d.property()],
c.prototype,"layer",void 0);return c=b([d.subclass("esri.views.layers.TileLayerView")],c)}(d.declared(p))});