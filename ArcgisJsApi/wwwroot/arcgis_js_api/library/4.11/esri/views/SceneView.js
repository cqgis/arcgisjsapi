// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/aaBoundingRect":function(){define(["require","exports","../../core/compilerUtils","../Extent"],function(t,d,q,g){function l(a){void 0===a&&(a=d.ZERO);return[a[0],a[1],a[2],a[3]]}function b(a){return a[0]>=a[2]?0:a[2]-a[0]}function f(a){return a[1]>=a[3]?0:a[3]-a[1]}function e(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];return a}function k(a){return 4===a.length}function c(a,c,b){return a<c?c:a>b?b:a}Object.defineProperty(d,"__esModule",{value:!0});d.create=
l;d.clone=function(a){return[a[0],a[1],a[2],a[3]]};d.fromValues=function(a,c,b,n,e){void 0===e&&(e=l());e[0]=a;e[1]=c;e[2]=b;e[3]=n;return e};d.fromExtent=function(a,c){void 0===c&&(c=l());c[0]=a.xmin;c[1]=a.ymin;c[2]=a.xmax;c[3]=a.ymax;return c};d.toExtent=function(a,c){return new g({xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:c})};d.expandPointInPlace=function(a,c){c[0]<a[0]&&(a[0]=c[0]);c[0]>a[2]&&(a[2]=c[0]);c[1]<a[1]&&(a[1]=c[1]);c[1]>a[3]&&(a[3]=c[1])};d.expand=function(a,c,b){void 0===
b&&(b=a);if("length"in c)if(k(c))b[0]=Math.min(a[0],c[0]),b[1]=Math.min(a[1],c[1]),b[2]=Math.max(a[2],c[2]),b[3]=Math.max(a[3],c[3]);else{if(2===c.length||3===c.length)b[0]=Math.min(a[0],c[0]),b[1]=Math.min(a[1],c[1]),b[2]=Math.max(a[2],c[0]),b[3]=Math.max(a[3],c[1])}else switch(c.type){case "extent":b[0]=Math.min(a[0],c.xmin);b[1]=Math.min(a[1],c.ymin);b[2]=Math.max(a[2],c.xmax);b[3]=Math.max(a[3],c.ymax);break;case "point":b[0]=Math.min(a[0],c.x);b[1]=Math.min(a[1],c.y);b[2]=Math.max(a[2],c.x);
b[3]=Math.max(a[3],c.y);break;default:q.neverReached(c)}return b};d.expandWithNestedArray=function(a,c,b){void 0===b&&(b=a);var h=c.length,p=a[0],e=a[1],f=a[2];a=a[3];for(var k=0;k<h;k++){var g=c[k],p=Math.min(p,g[0]),e=Math.min(e,g[1]),f=Math.max(f,g[0]);a=Math.max(a,g[1])}b[0]=p;b[1]=e;b[2]=f;b[3]=a;return b};d.allFinite=function(a){for(var c=0;4>c;c++)if(!isFinite(a[c]))return!1;return!0};d.width=b;d.height=f;d.diameter=function(a){var c=b(a);a=f(a);return Math.sqrt(c*c+a*a)};d.area=function(a){return b(a)*
f(a)};d.center=function(a,c){void 0===c&&(c=[0,0]);c[0]=a[0]+b(a)/2;c[1]=a[1]+f(a)/2;return c};d.containsPoint=function(a,c){return c[0]>=a[0]&&c[1]>=a[1]&&c[0]<=a[2]&&c[1]<=a[3]};d.containsPointWithMargin=function(a,c,b){return c[0]>=a[0]-b&&c[1]>=a[1]-b&&c[0]<=a[2]+b&&c[1]<=a[3]+b};d.intersects=function(a,c){return Math.max(c[0],a[0])<=Math.min(c[2],a[2])&&Math.max(c[1],a[1])<=Math.min(c[3],a[3])};d.contains=function(a,c){return c[0]>=a[0]&&c[2]<=a[2]&&c[1]>=a[1]&&c[3]<=a[3]};d.intersection=function(a,
b,p){void 0===p&&(p=a);var h=b[0],e=b[1],f=b[2];b=b[3];p[0]=c(a[0],h,f);p[1]=c(a[1],e,b);p[2]=c(a[2],h,f);p[3]=c(a[3],e,b);return p};d.distance=function(a,c){var h=(a[1]+a[3])/2,e=Math.max(Math.abs(c[0]-(a[0]+a[2])/2)-b(a)/2,0);a=Math.max(Math.abs(c[1]-h)-f(a)/2,0);return Math.sqrt(e*e+a*a)};d.offset=function(a,c,b,e){void 0===e&&(e=a);e[0]=a[0]+c;e[1]=a[1]+b;e[2]=a[2]+c;e[3]=a[3]+b;return e};d.pad=function(a,c,b){void 0===b&&(b=a);b[0]=a[0]-c;b[1]=a[1]-c;b[2]=a[2]+c;b[3]=a[3]+c;return b};d.setMin=
function(a,c,b){void 0===b&&(b=a);b[0]=c[0];b[1]=c[1];b!==a&&(b[2]=a[2],b[3]=a[3]);return b};d.setMax=function(a,c,b){void 0===b&&(b=a);b[2]=c[0];b[3]=c[1];b!==a&&(b[0]=a[0],b[1]=a[1]);return a};d.set=e;d.empty=function(a){return a?e(a,d.NEGATIVE_INFINITY):l(d.NEGATIVE_INFINITY)};d.is=k;d.isPoint=function(a){return(0===b(a)||!isFinite(a[0]))&&(0===f(a)||!isFinite(a[1]))};d.equals=function(a,c,b){if(null==a||null==c)return a===c;if(!k(a)||!k(c))return!1;if(b)for(var h=0;h<a.length;h++){if(!b(a[h],
c[h]))return!1}else for(h=0;h<a.length;h++)if(a[h]!==c[h])return!1;return!0};d.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];d.NEGATIVE_INFINITY=[Infinity,Infinity,-Infinity,-Infinity];d.ZERO=[0,0,0,0]})},"esri/geometry/support/scaleUtils":function(){define(["require","exports","../../config","../../core/unitUtils"],function(t,d,q,g){function l(b,f){f=g.getMetersPerUnitForSR(f);return b/(f*g.inchesPerMeter*q.screenDPI)}Object.defineProperty(d,"__esModule",{value:!0});d.getScale=function(b,
f){f=f||b.extent;b=b.width;var e=g.getMetersPerUnit(f&&f.spatialReference);return f&&b?f.width/b*(e||g.decDegToMeters)*g.inchesPerMeter*q.screenDPI:0};d.getResolutionForScale=l;d.getExtentForScale=function(b,f){var e=b.extent;b=b.width;f=l(f,e.spatialReference);return e.clone().expand(f*b/e.width)}})},"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-class ../core/Accessor ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./DOMContainer".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){var p={widthBreakpoint:{getValue:function(a){var c=a.viewSize[0];a=a.breakpoints;var b=this.values;return c<=a.xsmall?b.xsmall:c<=a.small?b.small:c<=a.medium?b.medium:c<=a.large?b.large:b.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue:function(a){var c=a.viewSize[1];a=a.breakpoints;var b=this.values;return c<=a.xsmall?b.xsmall:c<=a.small?b.small:c<=a.medium?b.medium:c<=a.large?b.large:b.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue:function(a){a=a.viewSize;var c=this.values;return a[1]>=a[0]?c.portrait:c.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},n={xsmall:544,small:768,medium:992,large:1200};return function(h){function f(){var a=null!==h&&h.apply(this,arguments)||this;a._breakpointsHandles=new k;a.breakpoints=n;a.orientation=null;a.widthBreakpoint=null;a.heightBreakpoint=null;return a}
q(f,h);f.prototype.initialize=function(){this._breakpointsHandles.add([c.init(this,["breakpoints","size"],this._updateClassNames)])};f.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};f.prototype._updateClassNames=function(){if(this.container){var a=e.acquire(),c=e.acquire(),b=!1,h,n,f;for(h in p)n=this[h],f=p[h].getValue({viewSize:this.size,breakpoints:this.breakpoints}),n!==f&&(b=!0,this[h]=f,c.push(p[h].valueToClassName[n]),
a.push(p[h].valueToClassName[f]));b&&(this._applyClassNameChanges(a,c),e.release(a),e.release(c))}};f.prototype._applyClassNameChanges=function(a,c){var h=this.container;h&&(b.remove(h,c),b.add(h,a))};f.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var c in p)b.remove(a,p[c].valueToClassName[this[c]])};g([a.property({set:function(a){var c=this._get("breakpoints");if(a!==c){c=(c=a)&&c.xsmall<c.small&&c.small<c.medium&&c.medium<c.large;if(!c){var b=JSON.stringify(n,null,
2);console.warn("provided breakpoints are not valid, using defaults:"+b)}a=c?a:n;this._set("breakpoints",l({},a))}}})],f.prototype,"breakpoints",void 0);g([a.property()],f.prototype,"orientation",void 0);g([a.property()],f.prototype,"widthBreakpoint",void 0);g([a.property()],f.prototype,"heightBreakpoint",void 0);return f=g([a.subclass("esri.views.BreakpointsOwner")],f)}(a.declared(f,h))})},"esri/views/DOMContainer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/dom-construct ../core/Accessor ../core/domUtils ../core/Evented ../core/Handles ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u){function v(a){a&&(e.empty(a),a.parentNode&&a.parentNode.removeChild(a))}var r=[0,0];return function(f){function k(){var a=f.call(this)||this;a._domHandles=new c;a._freqInfo={freq:16,time:750};a._overlayRenderTaskHandle=null;a.height=0;a.position=null;a.resizing=!1;a.root=null;a.surface=null;a.suspended=!0;a.ui=null;a.userContent=null;a.width=0;a.watch("cursor",function(c){var b=a.surface;b&&b.setAttribute("data-cursor",c)});a.watch("interacting",function(c){var b=
a.surface;b&&b.setAttribute("data-interacting",c.toString())});return a}q(k,f);k.prototype.initialize=function(){var a=this;this.watch("ui",this._handleUIChange);this._wireUI(this.ui);this._focusHandle=this.on("focus",function(){return a.notifyChange("focused")});this._blurHandle=this.on("blur",function(){return a.notifyChange("focused")})};k.prototype.destroy=function(){this.destroyed||(this.ui.destroy(),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null,this._domHandles.destroy(),
this._focusHandle&&(this._focusHandle.remove(),this._focusHandle=null),this._blurHandle&&(this._blurHandle.remove(),this._blurHandle=null))};Object.defineProperty(k.prototype,"container",{set:function(c){var b=this,p=this._get("container");if(p!==c)if(this._domHandles.remove("dom-size"),this._stopMeasuring(),p&&(p.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),
v(this.root),this._set("root",null),e.reparent(this.userContent,p),v(this.userContent),this._set("userContent",null)),c){c.classList.add("esri-view");p=document.createElement("div");p.className="esri-view-user-storage";e.reparent(c,p);c.appendChild(p);this._set("userContent",p);p=document.createElement("div");p.className="esri-view-root";c.insertBefore(p,c.firstChild);this._set("root",p);var m=document.createElement("div");m.className="esri-view-surface";m.setAttribute("role","application");m.tabIndex=
0;l.setSelectable(m,!1);p.appendChild(m);this._set("surface",m);var f=new n;p.appendChild(f.surface);this._set("overlay",f);f.watch("needsRender",function(c){c&&!b._overlayRenderTaskHandle?b._overlayRenderTaskHandle=a.addFrameTask({render:function(){b.overlay.render()}}):b._overlayRenderTaskHandle&&(b._overlayRenderTaskHandle.remove(),b._overlayRenderTaskHandle=null)});this.forceDOMReadyCycle();this._domHandles.add(h.init(this,"size",function(a){var c=a[1];m.classList.toggle("esri-view-surface--inset-outline",
a[0]>=document.body.clientWidth||c>=document.body.clientHeight)}),"dom-size");this._set("container",c);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"focused",{get:function(){var a=document.activeElement===this.surface;return document.hasFocus()&&a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"popup",{get:function(){return this._get("popup")||new u({view:this})},set:function(a){var c=this._get("popup");c&&c!==a&&c.destroy();this._set("popup",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"size",{get:function(){return[this.width,this.height]},enumerable:!0,configurable:!0});k.prototype.blur=function(){this.surface&&this.surface.blur()};k.prototype.focus=function(){this.surface&&this.surface.focus()};k.prototype.pageToContainer=function(a,c,b){var h=this.position;
a-=h[0];c-=h[1];b?(b[0]=a,b[1]=c):b=[a,c];return b};k.prototype.containerToPage=function(a,c,b){var h=this.position;a+=h[0];c+=h[1];b?(b[0]=a,b[1]=c):b=[a,c];return b};k.prototype._handleUIChange=function(a,c){c&&(this._domHandles.remove("ui"),c.destroy());a&&this._wireUI(a);this._set("ui",a)};k.prototype._wireUI=function(a){this._domHandles.remove("ui");a&&(a.view=this,this._domHandles.add([h.init(this,"root",function(c){a.container=c?b.create("div",null,c):null}),h.init(this,"popup",function(c,
b){b&&a.remove(b,"popup");c&&(c.view=a.view,a.add(c,{key:"popup",position:"manual"}))})],"ui"))};k.prototype._stopMeasuring=function(){this._domHandles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};k.prototype._startMeasuring=function(){var c=this,b=this._freqInfo;b.freq=16;b.time=750;this._domHandles.add([function(){var a=function(){b.freq=16;b.time=750};window.addEventListener("resize",a);return{remove:function(){window.removeEventListener("resize",a)}}}(),a.addFrameTask({prepare:function(a){var b=
c._measure(),h=c._freqInfo;h.time+=a.deltaTime;b&&(h.freq=16,c._get("resizing")||c._set("resizing",!0));h.time<h.freq||(h.time=0,c._position()||b?h.freq=16:h.freq=Math.min(750,2*h.freq),!b&&512<=h.freq&&c._get("resizing")&&c._set("resizing",!1))}})],"measuring");this._measure();this._position()};k.prototype._measure=function(){var a=this.container,c=a?a.clientWidth:0,b=a?a.clientHeight:0;if(0===c||0===b||"hidden"===window.getComputedStyle(a).visibility)return this.suspended||this._set("suspended",
!0),!1;var a=this.width,h=this.height;if(c===a&&b===h)return this.suspended&&this._set("suspended",!1),!1;this._set("width",c);this._set("height",b);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:a,oldHeight:h,width:c,height:b});return!0};k.prototype._position=function(){var a=this.container,c=this.position,b=(a.ownerDocument||window.document).defaultView,a=a.getBoundingClientRect();r[0]=a.left+b.pageXOffset;r[1]=a.top+b.pageYOffset;return c&&r[0]===c[0]&&r[1]===c[1]?!1:(this._set("position",
[r[0],r[1]]),!0)};k.prototype.forceDOMReadyCycle=function(){};g([p.property({value:null,cast:function(a){return l.byId(a)}})],k.prototype,"container",null);g([p.property({readOnly:!0,dependsOn:["surface"]})],k.prototype,"focused",null);g([p.property({readOnly:!0})],k.prototype,"height",void 0);g([p.property({type:u})],k.prototype,"popup",null);g([p.property({type:n})],k.prototype,"overlay",void 0);g([p.property({readOnly:!0})],k.prototype,"position",void 0);g([p.property({readOnly:!0})],k.prototype,
"resizing",void 0);g([p.property({readOnly:!0})],k.prototype,"root",void 0);g([p.property({value:null,dependsOn:["width","height"],readOnly:!0})],k.prototype,"size",null);g([p.property({readOnly:!0})],k.prototype,"surface",void 0);g([p.property({readOnly:!0})],k.prototype,"suspended",void 0);g([p.property()],k.prototype,"ui",void 0);g([p.property({readOnly:!0})],k.prototype,"userContent",void 0);g([p.property({readOnly:!0})],k.prototype,"width",void 0);return k=g([p.subclass("esri.views.DOMContainer")],
k)}(p.declared(f,k))})},"esri/core/domUtils":function(){define(["require","exports","../widgets/support/widget"],function(t,d,q){function g(g){return q.isWidgetBase(g)?g.domNode:g}Object.defineProperty(d,"__esModule",{value:!0});d.show=function(l){if(l=g(l))l.style.display="block"};d.getNode=g;d.hide=function(l){if(l=g(l))l.style.display="none"};d.toggle=function(l){if(l=g(l))l.style.display="none"===l.style.display?"block":"none"};d.empty=function(g){for(;g.hasChildNodes();)g.removeChild(g.firstChild)};
d.reparent=function(g,b){for(;g.hasChildNodes();)b.appendChild(g.firstChild)}})},"esri/views/overlay/ViewOverlay":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators maquette".split(" "),function(t,d,q,g,l,b,f,e,k){return function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.items=new f;a._callbacks=new Map;a._projector=k.createProjector();
a._hiddenProjector=k.createProjector();return a}q(a,c);Object.defineProperty(a.prototype,"needsRender",{get:function(){return 0<this.items.length},enumerable:!0,configurable:!0});a.prototype.initialize=function(){var a=this,c=document.createElement("div");c.className="esri-overlay-surface";l.setSelectable(c,!1);this._set("surface",c);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style","visibility: hidden;");c.appendChild(this._hiddenSurface);this._itemsChangeHandle=
this.items.on("change",function(c){c.added.map(function(c){var b=function(){return c.render()};a._callbacks.set(c,b);a._projector.append(a.surface,b)});c.removed.map(function(c){var b=a._projector.detach(a._callbacks.get(c));a.surface.removeChild(b.domNode);a._callbacks.delete(c)})})};a.prototype.addItem=function(a){this.items.add(a)};a.prototype.removeItem=function(a){this.items.remove(a)};a.prototype.destroy=function(){this.items.removeAll();this._itemsChangeHandle.remove();this._projector=this._callbacks=
null};a.prototype.render=function(){this._projector.renderNow()};a.prototype.computeBoundingRect=function(a){var c=this._hiddenSurface,b=this._hiddenProjector,h=null,e=function(){return h=a.render()};b.append(c,e);b.renderNow();var f={left:0,top:0,right:0,bottom:0};if(h&&h.domNode){var k=h.domNode.getBoundingClientRect();f.left=k.left;f.top=k.top;f.right=k.right;f.bottom=k.bottom}for(b.detach(e);c.firstChild;)c.removeChild(c.firstChild);return f};a.prototype.overlaps=function(a,c){a=this.computeBoundingRect(a);
c=this.computeBoundingRect(c);return Math.max(a.left,c.left)<=Math.min(a.right,c.right)&&Math.max(a.top,c.top)<=Math.min(a.bottom,c.bottom)};Object.defineProperty(a.prototype,"hasVisibleItems",{get:function(){return this.items.some(function(a){return a.visible})},enumerable:!0,configurable:!0});a.prototype.renderCanvas=function(a){if(this.items.some(function(a){return a.visible})){var c=a.getContext("2d");c.save();c.font="10px "+getComputedStyle(this.surface).fontFamily;this.items.forEach(function(a){c.save();
a.renderCanvas(c);c.restore()});c.restore()}};g([e.property({readOnly:!0})],a.prototype,"surface",void 0);g([e.property({readOnly:!0})],a.prototype,"items",void 0);g([e.property({readOnly:!0,dependsOn:["items.length"]})],a.prototype,"needsRender",null);return a=g([e.subclass("esri.views.overlay.ViewOverlay")],a)}(e.declared(b))})},"esri/widgets/Popup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper dojo/dom-geometry dojo/i18n!../nls/common dojo/i18n!./Popup/nls/Popup dojo/keys ../core/Handles ../core/lang ../core/Logger ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Spinner ./Widget ./Popup/PopupViewModel ./support/widget ./support/widgetUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A){function C(a,c){return void 0===c?"esri-popup__"+a:"esri-popup__"+a+"-"+c}function B(){return f(this,void 0,void 0,function(){return b(this,function(a){return[2,u.create(function(a){t(["./Feature"],function(c){a(c)})})]})})}var E={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},I=n.getLogger("esri.widgets.Popup");return function(n){function u(a){var c=n.call(this)||this;c._blurContainer=!1;c._containerNode=null;c._mainContainerNode=null;
c._featureMenuNode=null;c._actionsMenuNode=null;c._focusContainer=!1;c._focusDockButton=!1;c._focusFeatureMenuButton=!1;c._focusActionsMenuButton=!1;c._focusFirstFeature=!1;c._focusFirstAction=!1;c._handles=new h;c._pointerOffsetInPx=16;c._spinner=null;c.actions=null;c.actionsMenuEnabled=!0;c.alignment="auto";c.autoCloseEnabled=null;c.autoOpenEnabled=null;c.defaultPopupTemplateEnabled=null;c.content=null;c.collapsed=!1;c.collapseEnabled=!0;c.dockEnabled=!1;c.featureCount=null;c.features=null;c.featureNavigationEnabled=
!0;c.goToOverride=null;c.highlightEnabled=null;c.location=null;c.featureWidgets=[];c.promises=null;c.selectedFeature=null;c.selectedFeatureIndex=null;c.selectedFeatureWidget=null;c.spinnerEnabled=!0;c.title=null;c.updateLocationEnabled=null;c.view=null;c.viewModel=new m;c.visible=null;c._addSelectedFeatureIndexHandle();c.own([v.watch(c,"viewModel.screenLocation",function(){return c._positionContainer()}),v.watch(c,["viewModel.visible","dockEnabled"],function(){return c._toggleScreenLocationEnabled()}),
v.watch(c,"viewModel.screenLocation",function(a,b){!!a!==!!b&&c.reposition()}),v.watch(c,"viewModel.features",function(){return c._updateFeatureWidgets()}),v.watch(c,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),function(){return c.reposition()}),v.watch(c,"spinnerEnabled",function(a){return c._spinnerEnabledChange(a)}),v.watch(c,"viewModel.view.size",function(a,b){return c._updateDockEnabledForViewSize(a,b)}),v.watch(c,
"viewModel.view",function(a,b){return c._viewChange(a,b)}),v.watch(c,"viewModel.view.ready",function(a,b){return c._viewReadyChange(a,b)}),v.watch(c,["viewModel.waitingForResult","viewModel.location"],function(){return c._displaySpinner()}),v.watch(c,["featureWidgets","viewModel.selectedFeatureIndex"],function(){return c._updateFeatureWidget()}),v.watch(c,"selectedFeatureWidget.viewModel.title",function(a){return c._setTitleFromFeatureWidget(a)}),v.watch(c,["selectedFeatureWidget.viewModel.content",
"selectedFeatureWidget.viewModel.waitingForContent"],function(){return c._setContentFromFeatureWidget()}),v.whenFalse(c,"collapsed",function(){"xsmall"===c.get("viewModel.view.widthBreakpoint")&&c.visible&&c.collapseEnabled&&c.viewModel.centerAtLocation()})]);return c}q(u,n);u.prototype.destroy=function(){this._destroyFeatureWidgets();this._destroySpinner();this._handles&&this._handles.destroy();this.viewModel=this._handles=null};Object.defineProperty(u.prototype,"actionsMenuOpen",{get:function(){return this.viewModel.visible&&
this.actionsMenuEnabled?this._get("actionsMenuOpen"):!1},set:function(a){this._set("actionsMenuOpen",!!a)},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||
E},set:function(a){var c=l({},E),b=this.get("viewModel.view.breakpoints"),h={};b&&(h.width=b.xsmall,h.height=b.xsmall);a=l({},c,a);c=l({},c.breakpoint,h);h=a.breakpoint;!0===h?a.breakpoint=c:"object"===typeof h&&(a.breakpoint=l({},c,h));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"featureMenuOpen",{get:function(){return this.viewModel.visible?this._get("featureMenuOpen"):!1},set:function(a){this._set("featureMenuOpen",
!!a)},enumerable:!0,configurable:!0});u.prototype.blur=function(){this.visible||I.warn("Popup cannot be blurred while visible is false");this._blurContainer=!0;this.scheduleRender()};u.prototype.clear=function(){};u.prototype.close=function(){this.visible=!1};u.prototype.focus=function(){this.visible||I.warn("Popup cannot be focused while visible is false");this._focusContainer=!0;this.scheduleRender()};u.prototype.next=function(){return null};u.prototype.open=function(a){this._handles.remove("selected-index");
var c={collapsed:a?!!a.collapsed:!1,actionsMenuOpen:a?!!a.actionsMenuOpen:!1,featureMenuOpen:a?!!a.featureMenuOpen:!1};"xsmall"===this.get("viewModel.view.widthBreakpoint")&&(c.collapsed=!0,a.updateLocationEnabled=!0);this.set(c);this.viewModel.open(a);this._addSelectedFeatureIndexHandle()};u.prototype.previous=function(){return null};u.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};u.prototype.triggerAction=function(a){return null};u.prototype.render=
function(){var a=this,b,h,e,m,n,f,r=this.actionsMenuOpen,u=this.collapsed,g=this.collapseEnabled,v=this.dockEnabled,l=this.featureMenuOpen,d=this.featureNavigationEnabled,y=this.featureWidgets,w=this.visible,B=this.actionsMenuEnabled,E=this.viewModel,L=E.allActions,q=E.content,G=E.featureCount,I=E.pendingPromisesCount,t=E.selectedFeatureIndex,ha=E.title,ea=L&&L.length,ma=1<G&&d,d=1<G&&l,L=1<ea&&r,aa=ma&&this._getPageText(G,t),qa=this._renderContent(),na=A.isRTL(),sa=!!(this.get("selectedFeatureWidget")?
this.get("selectedFeatureWidget.viewModel.waitingForContent")||this.get("selectedFeatureWidget.viewModel.content"):qa),E=(g=!!(g&&ha&&sa))&&!d&&u,z=this.get("viewModel.view.widthBreakpoint"),la=v?c.undock:c.dock,u=this.currentAlignment,G=this.currentDockPosition,I=I?x.tsx("div",{key:C("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":k.loading,title:k.loading},x.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator",
"esri-rotating")})):null,oa=(b={},b["esri-icon-right-triangle-arrow"]=na,b["esri-popup__pagination-previous-icon--rtl"]=na,b["esri-icon-left-triangle-arrow"]=!na,b["esri-popup__pagination-previous-icon"]=!na,b);b=x.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",oa)});oa=x.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":c.previous,title:c.previous},
b);b=(h={},h["esri-icon-left-triangle-arrow"]=na,h["esri-popup__pagination-next-icon--rtl"]=na,h["esri-icon-right-triangle-arrow"]=!na,h["esri-popup__pagination-next-icon"]=!na,h);h=x.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",b)});na=x.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":c.next,title:c.next},h);b=A.cssTransition("enter","esri-popup--feature-updated");
h=this.id+"-feature-menu";l=x.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":h,"aria-expanded":l,"aria-label":k.menu,title:k.menu},aa);aa=ma?[oa,I||l,na]:null;l=this._wouldDockTo();l=(e={},e["esri-icon-minimize"]=v,e["esri-popup__icon--dock-icon"]=
!v,e["esri-icon-dock-right"]=!v&&("top-right"===l||"bottom-right"===l),e["esri-icon-dock-left"]=!v&&("top-left"===l||"bottom-left"===l),e["esri-icon-maximize"]=!v&&"top-center"===l,e["esri-icon-dock-bottom"]=!v&&"bottom-center"===l,e);e=x.tsx("span",{"aria-hidden":"true",class:this.classes(l,"esri-popup__icon")});e="xsmall"!==z&&this.get("dockOptions.buttonEnabled")?x.tsx("div",{role:"button","aria-label":la,title:la,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,
afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},e):null;l=(m={},m["esri-popup__header-container--button"]=g,m);z=g?"button":"heading";la=g?E?k.expand:k.collapse:"";m=this.id+"-popup-title";ha=ha?x.tsx("div",{class:this.classes("esri-popup__header-container",l),key:ha,enterAnimation:b,id:m,role:z,"aria-label":la,title:la,tabIndex:g?0:-1,bind:this,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed},
x.tsx("h2",{class:"esri-popup__header-title",innerHTML:ha})):null;l=x.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")});l=x.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":k.close,title:k.close},l);e=x.tsx("header",{class:"esri-popup__header"},ha,x.tsx("div",{class:"esri-popup__header-buttons"},e,l));var l=this.id+"-popup-content",q=!sa||g&&E?null:x.tsx("article",{key:q,enterAnimation:b,
id:l,class:"esri-popup__content"},qa),sa="bottom-left"===u||"bottom-center"===u||"bottom-right"===u||"top-left"===G||"top-center"===G||"top-right"===G,qa="top-left"===u||"top-center"===u||"top-right"===u||"bottom-left"===G||"bottom-center"===G||"bottom-right"===G,z=r?k.close:k.open,ta=this._getInlineActions();b=(b=ta&&ta.toArray().map(function(c,b){return a._renderAction({action:c,index:b,key:"actions",type:"inline",showText:2>ta.length})}))?x.tsx("div",{key:"inline-actions-container",class:"esri-popup__inline-actions-container"},
b):null;B=B&&ea&&!b?x.tsx("div",{key:C("actions-menu-button"),class:this.classes("esri-popup__button","esri-popup__actions-menu-button"),role:"button",id:this.id+"-actions-menu-button","aria-haspopup":"true","aria-controls":r?this.id+"-actions-menu":null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":z,title:z},x.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):
null;aa=ma?x.tsx("section",{key:C("navigation"),class:this.classes("esri-popup__navigation")},aa):null;B=ma||ea?x.tsx("div",{key:C("feature-buttons"),class:"esri-popup__footer"},aa,B,b):null;r=ea&&r?x.tsx("ul",{id:this.id+"-actions-menu",role:"menu","aria-labelledby":this.id+"-actions-menu-button",key:C("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},this._renderActions()):null;
t=this._renderFeatureMenuNode(y,t,h);y=p.substitute({total:y.length},c.selectedFeatures);ma=x.tsx("section",{key:C("menu"),class:"esri-popup__feature-menu"},x.tsx("h2",{class:"esri-popup__feature-menu-header"},y),x.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},t));y=v?null:x.tsx("div",{key:C("pointer"),class:"esri-popup__pointer",role:"presentation"},x.tsx("div",{class:this.classes("esri-popup__pointer-direction",
"esri-popup--shadow")}));t=this.get("selectedFeature.layer.title");ea=this.get("selectedFeature.layer.id");g=(n={},n["esri-popup--shadow"]=v,n["esri-popup--is-collapsible"]=g,n["esri-popup--is-collapsed"]=E,n);n=(f={},f["esri-popup--aligned-top-center"]=w&&"top-center"===u,f["esri-popup--aligned-bottom-center"]=w&&"bottom-center"===u,f["esri-popup--aligned-top-left"]=w&&"top-left"===u,f["esri-popup--aligned-bottom-left"]=w&&"bottom-left"===u,f["esri-popup--aligned-top-right"]=w&&"top-right"===u,f["esri-popup--aligned-bottom-right"]=
"bottom-right"===u,f["esri-popup--is-docked"]=w&&v,f["esri-popup--shadow"]=w&&!v,f["esri-popup--is-docked-top-left"]=w&&"top-left"===G,f["esri-popup--is-docked-top-center"]=w&&"top-center"===G,f["esri-popup--is-docked-top-right"]=w&&"top-right"===G,f["esri-popup--is-docked-bottom-left"]=w&&"bottom-left"===G,f["esri-popup--is-docked-bottom-center"]=w&&"bottom-center"===G,f["esri-popup--is-docked-bottom-right"]=w&&"bottom-right"===G,f["esri-popup--feature-menu-open"]=w&&d,f["esri-popup--actions-menu-open"]=
w&&L,f);f=sa?[ma,r]:null;v=qa?[ma,r]:null;d=sa?B:null;L=qa?B:null;f=x.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",g),tabIndex:-1,role:"dialog","aria-labelledby":ha?m:"","aria-describedby":q?l:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},d,f,e,q,L,v);return x.tsx("div",{key:C("base"),class:this.classes("esri-popup",n),role:"presentation","data-layer-title":t,"data-layer-id":ea,bind:this,
afterCreate:this._positionContainer,afterUpdate:this._positionContainer},w?[f,y]:null)};u.prototype._getInlineActions=function(){var a=this.viewModel.allActions;if(!(this.actionsMenuEnabled&&2<=a.length))return a};u.prototype._featureMenuOpenChanged=function(a){a?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};u.prototype._actionsMenuOpenChanged=function(a){a?this._focusFirstAction=!0:this._focusActionsMenuButton=!0};u.prototype._setTitleFromFeatureWidget=function(a){this.selectedFeatureWidget&&
(this.viewModel.title=a||"")};u.prototype._setContentFromFeatureWidget=function(){var a=this.selectedFeatureWidget;a&&(this.viewModel.content=a)};u.prototype._handleFeatureMenuKeyup=function(c){c.keyCode===a.ESCAPE&&(c.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())};u.prototype._handleActionMenuKeyup=function(c){c.keyCode===a.ESCAPE&&(c.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};u.prototype._handleFeatureMenuItemKeyup=
function(c){var b=c.keyCode,h=this._featureMenuNode,e=c.currentTarget["data-feature-index"];if(h){var h=h.querySelectorAll("li"),p=h.length;b===a.UP_ARROW?(c.stopPropagation(),h[(e-1+p)%p].focus()):b===a.DOWN_ARROW?(c.stopPropagation(),h[(e+1+p)%p].focus()):b===a.HOME?(c.stopPropagation(),h[0].focus()):b===a.END&&(c.stopPropagation(),h[h.length-1].focus())}};u.prototype._handleActionMenuItemKeyup=function(c){var b=c.keyCode,h=this._actionsMenuNode,e=c.currentTarget["data-action-index"];if(h){var h=
h.querySelectorAll("li"),p=h.length;b===a.UP_ARROW?(c.stopPropagation(),h[(e-1+p)%p].focus()):b===a.DOWN_ARROW?(c.stopPropagation(),h[(e+1+p)%p].focus()):b===a.HOME?(c.stopPropagation(),h[0].focus()):b===a.END&&(c.stopPropagation(),h[h.length-1].focus())}};u.prototype._handleMainKeyup=function(c){var b=c.keyCode;b===a.LEFT_ARROW&&(c.stopPropagation(),this.previous());b===a.RIGHT_ARROW&&(c.stopPropagation(),this.next())};u.prototype._spinnerEnabledChange=function(a){this._destroySpinner();a&&(a=this.get("viewModel.view"),
this._createSpinner(a))};u.prototype._displaySpinner=function(){var a=this._spinner;if(a){var c=this.viewModel,b=c.location;c.waitingForResult?a.show({location:b}):a.hide()}};u.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};u.prototype._renderAction=function(a){var c=this,b,h,e=a.action,m=a.index,n=a.key,f=a.type;a=a.showText;var k=v.watch(e,"active className disabled id title image visible".split(" "),function(){return c.scheduleRender()});this._handles.add(k,
n);var k=this.get("selectedFeature.attributes"),n=e.title,r=e.className,u=e.image,r=u||r?r:"esri-icon-default-action",n=n&&k?p.substitute(k,n):n,g=r&&k?p.substitute(k,r):r,k=u&&k?p.substitute(k,u):u,u=(b={},b["esri-icon-loading-indicator"]=e.active,b["esri-rotating"]=e.active,b["esri-popup__icon"]=!!r,b["esri-popup__action-image"]=!e.active&&!!k,b);g&&(u[g]=!e.active);b=(h={},h["esri-popup__action"]="toggle"!==e.type,h["esri-popup__action-toggle"]="toggle"===e.type,h["esri-popup__action-toggle--on"]=
"toggle"===e.type&&e.value,h["esri-popup__button--disabled"]=e.disabled,h);h=a?x.tsx("span",{key:"text",class:"esri-popup__action-text"},n):null;h=[x.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",u),styles:this._getIconStyles(k)}),h];m="menu-item"===f?x.tsx("li",{key:e,role:"menuitem",tabIndex:0,title:n,"aria-label":n,class:this.classes("esri-popup__button",b),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":m,onclick:this._triggerAction,onkeydown:this._triggerAction},
h):x.tsx("div",{key:e,role:"button",tabIndex:0,title:n,"aria-label":n,class:this.classes("esri-popup__button",b),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":m,onclick:this._triggerAction,onkeydown:this._triggerAction},h);return e.visible?m:null};u.prototype._renderActions=function(){var a=this;this._handles.remove("actions");var c=this.viewModel.allActions;if(c)return c.map(function(c,b){return a._renderAction({action:c,index:b,key:"actions",type:"menu-item",showText:!0})}).toArray()};
u.prototype._addSelectedFeatureIndexHandle=function(){var a=this,c=v.watch(this,"viewModel.selectedFeatureIndex",function(c,b){return a._selectedFeatureIndexUpdated(c,b)});this._handles.add(c,"selected-index")};u.prototype._selectedFeatureIndexUpdated=function(a,c){this.featureCount&&a!==c&&-1!==a&&(this.featureMenuOpen=this.actionsMenuOpen=!1)};u.prototype._updateFeatureWidget=function(){this._set("selectedFeatureWidget",this.featureWidgets[this.viewModel.selectedFeatureIndex]||null)};u.prototype._destroyFeatureWidgets=
function(){this.featureWidgets.forEach(function(a){return a.destroy()});this._set("featureWidgets",[])};u.prototype._updateFeatureWidgets=function(){return f(this,void 0,void 0,function(){var a,c,h,e,p,n,m=this;return b(this,function(b){switch(b.label){case 0:return a=this,c=a.features,h=a.featureWidgets,c&&c.length?[4,B()]:(h.forEach(function(a){return a.destroy()}),this._set("featureWidgets",[]),[2]);case 1:return e=b.sent(),p=h.slice(0),n=[],c.forEach(function(a,c){if(a){var b=null;p.some(function(c,
h){c&&c.graphic===a&&(b=c,p.splice(h,1));return!!b});if(b)n[c]=b;else{var h=new e({defaultPopupTemplateEnabled:m.defaultPopupTemplateEnabled,graphic:a,spatialReference:m.get("view.spatialReference"),map:m.get("view.map")});h.visibleElements=l({},h.visibleElements,{title:!1});n[c]=h}}}),p.forEach(function(a){return a&&a.destroy()}),this._set("featureWidgets",n),[2]}})})};u.prototype._isScreenLocationWithinView=function(a,c){return-1<a.x&&-1<a.y&&a.x<=c.width&&a.y<=c.height};u.prototype._isOutsideView=
function(a){var c=a.popupHeight,b=a.popupWidth,h=a.screenLocation,e=a.side;a=a.view;if(isNaN(b)||isNaN(c)||!a||!h)return!1;var p=a.padding;return"right"===e&&h.x+b/2>a.width-p.right||"left"===e&&h.x-b/2<p.left||"top"===e&&h.y-c<p.top||"bottom"===e&&h.y+c>a.height-p.bottom?!0:!1};u.prototype._determineCurrentAlignment=function(){var a=this._pointerOffsetInPx,c=this._containerNode,b=this._mainContainerNode,h=this.viewModel,p=h.screenLocation,h=h.view;if(!p||!h||!c)return"top-center";if(!this._isScreenLocationWithinView(p,
h))return this._get("currentAlignment")||"top-center";var n=b?window.getComputedStyle(b,null):null,b=n?parseInt(n.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,n=n?parseInt(n.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,m=e.getContentBox(c),c=m.w+a,m=Math.max(m.h,b,n)+a,a=this._isOutsideView({popupHeight:m,popupWidth:c,screenLocation:p,side:"right",view:h}),b=this._isOutsideView({popupHeight:m,popupWidth:c,screenLocation:p,side:"left",view:h}),n=this._isOutsideView({popupHeight:m,
popupWidth:c,screenLocation:p,side:"top",view:h}),p=this._isOutsideView({popupHeight:m,popupWidth:c,screenLocation:p,side:"bottom",view:h});return b?n?"bottom-right":"top-right":a?n?"bottom-left":"top-left":n?p?"top-center":"bottom-center":"top-center"};u.prototype._getCurrentAlignment=function(){var a=this.alignment;return this.dockEnabled?null:"auto"===a?this._determineCurrentAlignment():"function"===typeof a?a.call(this):a};u.prototype._setCurrentAlignment=function(){this._set("currentAlignment",
this._getCurrentAlignment())};u.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};u.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?this._determineCurrentDockPosition():"function"===typeof a?a.call(this):a};u.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null};u.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};
u.prototype._renderFeatureMenuItemNode=function(a,b,h){var e,p=b===h,n=(e={},e["esri-popup__feature-menu-item--selected"]=p,e);e=p?x.tsx("span",{key:C("feature-menu-selected-feature-"+h),title:c.selectedFeature,"aria-label":c.selectedFeature,class:"esri-icon-check-mark"}):null;a=x.tsx("span",{innerHTML:a.title||k.untitled});return x.tsx("li",{role:"menuitem",tabIndex:-1,key:C("feature-menu-feature-"+h),class:this.classes(n,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":b,onkeyup:this._handleFeatureMenuItemKeyup,
onclick:this._selectFeature,onkeydown:this._selectFeature},x.tsx("span",{class:"esri-popup__feature-menu-title"},a,e))};u.prototype._renderFeatureMenuNode=function(a,c,b){var h=this;return 1<a.length?x.tsx("ol",{class:"esri-popup__feature-menu-list",id:b,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(a,b){return h._renderFeatureMenuItemNode(a,b,c)})):null};u.prototype._determineCurrentDockPosition=
function(){var a=this.get("viewModel.view"),c=A.isRTL()?"top-left":"top-right";if(!a)return c;var b=a.padding||{left:0,right:0,top:0,bottom:0},b=a.width-b.left-b.right;return(a=a.get("breakpoints"))&&b<=a.xsmall?"bottom-center":c};u.prototype._renderContent=function(){var a=this.get("viewModel.content");if(!a)return null;if("string"===typeof a)return x.tsx("div",{key:a,innerHTML:a});if(x.isWidget(a))return x.tsx("div",{key:a},a.render());if(a instanceof HTMLElement)return x.tsx("div",{key:a,bind:a,
afterCreate:this._attachToNode});if(x.isWidgetBase(a))return x.tsx("div",{key:a,bind:a.domNode,afterCreate:this._attachToNode})};u.prototype._attachToNode=function(a){a.appendChild(this)};u.prototype._positionContainer=function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=a);if(a){var c=this.viewModel.screenLocation,b=e.getContentBox(a);if(c=this._calculatePositionStyle(c,b))a.style.top=c.top,a.style.left=c.left,a.style.bottom=c.bottom,a.style.right=c.right}};u.prototype._calculateFullWidth=
function(a){var c=this.currentAlignment,b=this._pointerOffsetInPx;return"top-left"===c||"bottom-left"===c||"top-right"===c||"bottom-right"===c?a+b:a};u.prototype._calculateAlignmentPosition=function(a,c,b,h){var e=this.currentAlignment,p=this._pointerOffsetInPx;h/=2;var n=b.height-c;b=b.width-a;var m=this.view.padding;if("bottom-center"===e)return{top:c+p-m.top,left:a-h-m.left};if("top-left"===e)return{bottom:n+p-m.bottom,right:b+p-m.right};if("bottom-left"===e)return{top:c+p-m.top,right:b+p-m.right};
if("top-right"===e)return{bottom:n+p-m.bottom,left:a+p-m.left};if("bottom-right"===e)return{top:c+p-m.top,left:a+p-m.left};if("top-center"===e)return{bottom:n+p-m.bottom,left:a-h-m.left}};u.prototype._calculatePositionStyle=function(a,c){var b=this.view;if(b){if(this.dockEnabled)return{left:"",top:"",right:"",bottom:""};if(a&&c&&(c=this._calculateFullWidth(c.w),a=this._calculateAlignmentPosition(a.x,a.y,b,c)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==
a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}};u.prototype._viewChange=function(a,c){a&&c&&(this.close(),this.clear())};u.prototype._viewReadyChange=function(a,c){a?(a=this.get("viewModel.view"),this._wireUpView(a)):c&&(this.close(),this.clear())};u.prototype._wireUpView=function(a){this._destroySpinner();a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};u.prototype._dockingThresholdCrossed=function(a,c,b){var h=a[0];a=
a[1];var e=c[0];c=c[1];var p=b.width;b=b.height;return h<=p&&e>p||h>p&&e<=p||a<=b&&c>b||a>b&&c<=b};u.prototype._updateDockEnabledForViewSize=function(a,c){if(a&&c){var b=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},h=b.left+b.right,e=b.top+b.bottom,b=[],p=[];b[0]=a[0]-h;b[1]=a[1]-e;p[0]=c[0]-h;p[1]=c[1]-e;a=this.dockOptions;this._dockingThresholdCrossed(b,p,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};u.prototype._focusDockButtonNode=function(a){this._focusDockButton&&
(this._focusDockButton=!1,a.focus())};u.prototype._mainContainerNodeUpdated=function(a){this._mainContainerNode=a;this._focusContainer?(this._focusContainer=!1,a.focus()):this._blurContainer&&(this._blurContainer=!1,a.blur())};u.prototype._featureMenuNodeUpdated=function(a){(this._featureMenuNode=a)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};u.prototype._actionsMenuNodeUpdated=function(a){(this._actionsMenuNode=a)&&this._focusFirstAction&&
(this._focusFirstAction=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};u.prototype._focusFeatureMenuButtonNode=function(a){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,a.focus())};u.prototype._focusActionsMenuButtonNode=function(a){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,a.focus())};u.prototype._featureMenuViewportNodeUpdated=function(a){a&&(a.scrollTop=0)};u.prototype._toggleScreenLocationEnabled=function(){var a=this.dockEnabled,c=this.viewModel;
c&&(c.screenLocationEnabled=this.visible&&!a)};u.prototype._shouldDockAtCurrentViewSize=function(a){a=a.breakpoint;var c=this.get("viewModel.view.ui"),b=c.width,c=c.height;if(isNaN(b)||isNaN(c))return!1;b=a.hasOwnProperty("width")&&b<=a.width;a=a.hasOwnProperty("height")&&c<=a.height;return b||a};u.prototype._setDockEnabledForViewSize=function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};u.prototype._getPageText=function(a,b){return p.substitute({index:b+1,total:a},c.pageText)};
u.prototype._destroySpinner=function(){var a=this._spinner,c=this.view;a&&(c&&c.ui.remove(this._spinner,"popup-spinner"),a.destroy(),this._spinner=null)};u.prototype._createSpinner=function(a){a&&(this._spinner=new y({view:a}),a.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};u.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed};u.prototype._close=function(){this.close();this.view&&this.view.focus()};u.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;
this._focusDockButton=!0;this.scheduleRender()};u.prototype._toggleFeatureMenu=function(){var a=!this.featureMenuOpen;this._featureMenuOpenChanged(a);this.actionsMenuOpen=!1;this.featureMenuOpen=a};u.prototype._toggleActionsMenu=function(){var a=!this.actionsMenuOpen;this._actionsMenuOpenChanged(a);this.featureMenuOpen=!1;this.actionsMenuOpen=a};u.prototype._triggerAction=function(a){a=a.currentTarget["data-action-index"];var c=this.viewModel.allActions.getItemAt(a);c&&"toggle"===c.type&&(c.value=
!c.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(a)};u.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||(this.viewModel.selectedFeatureIndex=a);this._focusFeatureMenuButton=!0;this.scheduleRender()};u.prototype._next=function(){this.next()};u.prototype._previous=function(){this.previous()};g([r.aliasOf("viewModel.actions"),x.renderable()],u.prototype,"actions",void 0);g([r.property({dependsOn:["viewModel.visible","actionsMenuEnabled"]}),x.renderable()],
u.prototype,"actionsMenuOpen",null);g([r.property(),x.renderable()],u.prototype,"actionsMenuEnabled",void 0);g([r.property()],u.prototype,"alignment",void 0);g([r.aliasOf("viewModel.autoCloseEnabled")],u.prototype,"autoCloseEnabled",void 0);g([r.aliasOf("viewModel.autoOpenEnabled")],u.prototype,"autoOpenEnabled",void 0);g([r.aliasOf("viewModel.defaultPopupTemplateEnabled")],u.prototype,"defaultPopupTemplateEnabled",void 0);g([r.aliasOf("viewModel.content"),x.renderable()],u.prototype,"content",void 0);
g([r.property(),x.renderable()],u.prototype,"collapsed",void 0);g([r.property(),x.renderable()],u.prototype,"collapseEnabled",void 0);g([r.property({readOnly:!0,dependsOn:["dockEnabled","alignment"]}),x.renderable()],u.prototype,"currentAlignment",null);g([r.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions"]}),x.renderable()],u.prototype,"currentDockPosition",null);g([r.property(),x.renderable()],u.prototype,"dockOptions",null);g([r.property(),x.renderable()],u.prototype,
"dockEnabled",void 0);g([r.aliasOf("viewModel.featureCount"),x.renderable()],u.prototype,"featureCount",void 0);g([r.property({dependsOn:["viewModel.visible"]}),x.renderable()],u.prototype,"featureMenuOpen",null);g([r.aliasOf("viewModel.features"),x.renderable()],u.prototype,"features",void 0);g([r.property(),x.renderable()],u.prototype,"featureNavigationEnabled",void 0);g([r.aliasOf("viewModel.goToOverride")],u.prototype,"goToOverride",void 0);g([r.aliasOf("viewModel.highlightEnabled")],u.prototype,
"highlightEnabled",void 0);g([r.aliasOf("viewModel.location"),x.renderable()],u.prototype,"location",void 0);g([r.property({readOnly:!0}),x.renderable()],u.prototype,"featureWidgets",void 0);g([r.aliasOf("viewModel.promises")],u.prototype,"promises",void 0);g([r.aliasOf("viewModel.selectedFeature"),x.renderable()],u.prototype,"selectedFeature",void 0);g([r.aliasOf("viewModel.selectedFeatureIndex"),x.renderable()],u.prototype,"selectedFeatureIndex",void 0);g([r.property({readOnly:!0}),x.renderable()],
u.prototype,"selectedFeatureWidget",void 0);g([r.property()],u.prototype,"spinnerEnabled",void 0);g([r.aliasOf("viewModel.title"),x.renderable()],u.prototype,"title",void 0);g([r.aliasOf("viewModel.updateLocationEnabled")],u.prototype,"updateLocationEnabled",void 0);g([r.aliasOf("viewModel.view")],u.prototype,"view",void 0);g([r.property({type:m}),x.renderable("viewModel.view.widthBreakpoint viewModel.allActions viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),
x.vmEvent(["triggerAction","trigger-action"])],u.prototype,"viewModel",void 0);g([r.aliasOf("viewModel.visible"),x.renderable()],u.prototype,"visible",void 0);g([r.aliasOf("viewModel.clear")],u.prototype,"clear",null);g([r.aliasOf("viewModel.next")],u.prototype,"next",null);g([r.aliasOf("viewModel.previous")],u.prototype,"previous",null);g([r.aliasOf("viewModel.triggerAction")],u.prototype,"triggerAction",null);g([x.accessibleHandler()],u.prototype,"_toggleCollapsed",null);g([x.accessibleHandler()],
u.prototype,"_close",null);g([x.accessibleHandler()],u.prototype,"_toggleDockEnabled",null);g([x.accessibleHandler()],u.prototype,"_toggleFeatureMenu",null);g([x.accessibleHandler()],u.prototype,"_toggleActionsMenu",null);g([x.accessibleHandler()],u.prototype,"_triggerAction",null);g([x.accessibleHandler()],u.prototype,"_selectFeature",null);g([x.accessibleHandler()],u.prototype,"_next",null);g([x.accessibleHandler()],u.prototype,"_previous",null);return u=g([r.subclass("esri.widgets.Popup")],u)}(r.declared(w))})},
"esri/widgets/Spinner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./support/AnchorElementViewModel ./support/widget".split(" "),function(t,d,q,g,l,b,f,e,k,c){return function(a){function h(c){c=a.call(this)||this;c._animationDelay=500;c._animationPromise=null;c.location=null;c.view=null;c.visible=!1;c.viewModel=new k;return c}q(h,a);h.prototype.postInitialize=
function(){var a=this;this.own([b.watch(this,"visible",function(c){return a._visibleChange(c)})])};h.prototype.destroy=function(){this._cancelAnimationPromise()};h.prototype.show=function(a){var c=this,b=a.location;a=a.promise;b&&(this.viewModel.location=b);this.visible=!0;b=function(){return c.hide()};a&&a.catch(function(){}).then(b)};h.prototype.hide=function(){this.visible=!1};h.prototype.render=function(){var a,b=this.visible,h=!!this.viewModel.screenLocation,b=(a={},a["esri-spinner--start"]=
b&&h,a["esri-spinner--finish"]=!b&&h,a);a=this._getPositionStyles();return c.tsx("div",{class:this.classes("esri-spinner",b),styles:a})};h.prototype._cancelAnimationPromise=function(){var a=this._animationPromise;a&&a.cancel();this._animationPromise=null};h.prototype._visibleChange=function(a){var c=this;a?this.viewModel.screenLocationEnabled=!0:(this._cancelAnimationPromise(),this._animationPromise=l.after(this._animationDelay).then(function(){c.viewModel.screenLocationEnabled=!1;c._animationPromise=
null}))};h.prototype._getPositionStyles=function(){var a=this.viewModel,c=a.screenLocation,a=a.view;if(!a||!c)return{};a=a.padding;return{left:c.x-a.left+"px",top:c.y-a.top+"px"}};g([f.aliasOf("viewModel.location")],h.prototype,"location",void 0);g([f.aliasOf("viewModel.view")],h.prototype,"view",void 0);g([f.property(),c.renderable()],h.prototype,"visible",void 0);g([f.property({type:k}),c.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],h.prototype,"viewModel",void 0);
return h=g([f.subclass("esri.widgets.Spinner")],h)}(f.declared(e))})},"esri/widgets/support/AnchorElementViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(t,d,q,g,l,b,f,e,k,c){return function(a){function b(c){var b=a.call(this)||this;b._anchorHandles=new f;b.location=
null;b.screenLocation=null;b.screenLocationEnabled=!1;b.view=null;b._anchorHandles.add([k.watch(b,["screenLocationEnabled","location","view.size","view.stationary"],function(){return b._updateScreenPointAndHandle()}),k.watch(b,["view","view.ready"],function(){return b._wireUpView()})]);return b}q(b,a);b.prototype.destroy=function(){this.view=null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=this._anchorHandles=null};b.prototype._wireUpView=function(){var a=this;this._anchorHandles.remove("view");
this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var c=this.view,c=e.pausable(c,"3d"===c.type?"camera":"viewpoint",function(){return a._viewpointChange()});this._anchorHandles.add(c,"view");this._viewpointHandle=c;this._toggleWatchingViewpoint()}};b.prototype._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};b.prototype._updateScreenPointAndHandle=function(){this._setScreenLocation();this._toggleWatchingViewpoint()};b.prototype._toggleWatchingViewpoint=
function(){var a=this._viewpointHandle,c=this.screenLocationEnabled;a&&(this.location&&c?a.resume():a.pause())};b.prototype._setScreenLocation=function(){var a=this.location,c=this.view,b=this.screenLocationEnabled,h=this.get("view.ready"),a=b&&a&&h?c.toScreen(a):null;this._set("screenLocation",a)};g([c.property()],b.prototype,"location",void 0);g([c.property({readOnly:!0})],b.prototype,"screenLocation",void 0);g([c.property()],b.prototype,"screenLocationEnabled",void 0);g([c.property()],b.prototype,
"view",void 0);return b=g([c.subclass("esri.widgets.support.AnchorElementViewModel")],b)}(c.declared(l,b))})},"esri/widgets/Popup/PopupViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../geometry ../../core/Collection ../../core/compilerUtils ../../core/Error ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/webMercatorUtils ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../views/support/layerViewUtils ./actions ../support/AnchorElementViewModel ../support/GoTo".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A){var C=f.ofType({key:"type",defaultKeyValue:"button",base:v,typeMap:{button:r,toggle:y}}),B=new C([m.zoomToFeature.clone()]),E=a.getLogger("esri.widgets.Popup.PopupViewModel");return function(a){function f(b){b=a.call(this)||this;b._handles=new c;b._pendingPromises=new Set;b._zoomToLocation=null;b._fetchingFeatures=null;b.actions=B;b.defaultPopupTemplateEnabled=!1;b.autoCloseEnabled=!1;b.autoOpenEnabled=!0;b.content=null;b.highlightEnabled=!0;b.title=
null;b.updateLocationEnabled=!1;b.view=null;b.visible=!1;b.zoomFactor=4;return b}q(f,a);f.prototype.initialize=function(){var a=this;this._handles.add([p.init(this,"autoOpenEnabled",this._autoOpenEnabledChange),this.on("view-change",this._autoClose),p.watch(this,["highlightEnabled","selectedFeature","visible","view"],this._highlightFeature),p.watch(this,"view.animation.state",function(c){a._zoomToLocation||(m.zoomToFeature.disabled="waiting-for-target"===c)}),this.on("trigger-action",function(c){return m.triggerAction({event:c,
view:a.view})})])};f.prototype.destroy=function(){this._cancelFetchingFeatures();this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.view=null};Object.defineProperty(f.prototype,"allActions",{get:function(){var a=this._get("allActions")||new C;a.removeAll();var c=this.selectedFeature&&("function"===typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled)||this.selectedFeature.popupTemplate),b=
c&&c.actions;(c=c&&c.overwriteActions?b:this.actions.concat(b))&&c.filter(Boolean).forEach(function(c){return a.add(c)});return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"featureCount",{get:function(){return this.features.length},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"features",{get:function(){return this._get("features")||[]},set:function(a){a=a||[];this._set("features",a);var c=this.pendingPromisesCount,b=this.selectedFeatureIndex,h=this.promiseCount&&
a.length;h&&c&&-1===b?this.selectedFeatureIndex=0:h&&-1!==b||(this.selectedFeatureIndex=a.length?0:-1)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"location",{get:function(){return this._get("location")||null},set:function(a){var c=this.get("location"),b=this.get("view.spatialReference.isWebMercator");a&&a.get("spatialReference.isWGS84")&&b&&(a=u.geographicToWebMercator(a));this._set("location",a);a!==c&&this._centerAtLocation()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"pendingPromisesCount",{get:function(){return this._pendingPromises.size},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"waitingForResult",{get:function(){return 0<this.pendingPromisesCount&&0===this.featureCount},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"promiseCount",{get:function(){return this.promises.length},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"promises",{get:function(){return this._get("promises")||[]},set:function(a){var c=
this,b=this._get("promises");b&&b.forEach(function(a){a&&"function"===typeof a.cancel&&a.cancel()});this._pendingPromises.clear();this.features=[];Array.isArray(a)&&a.length?(this._set("promises",a),a=a.slice(0),a.forEach(function(a){c._pendingPromises.add(a);a.then(function(b){c._updatePendingPromises(a);c._updateFeatures(b)},function(){return c._updatePendingPromises(a)})})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"selectedFeature",{get:function(){var a=this.location,c=this.selectedFeatureIndex;if(-1===c)return null;c=this.features[c];if(!c)return null;!this.updateLocationEnabled&&a||!c.geometry||(this.location=this._getPointFromGeometry(c.geometry));return c},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"selectedFeatureIndex",{get:function(){var a=this._get("selectedFeatureIndex");return"number"===typeof a?a:-1},set:function(a){var c=this.featureCount;a=isNaN(a)||-1>a||!c?-1:(a+c)%c;this._set("selectedFeatureIndex",
a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});f.prototype.centerAtLocation=function(){var a=this.view,c=this._getSelectedTarget();return c?this.callGoTo({target:{target:c,scale:a.scale}}):(a=new k("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:c,view:a}),E.error(a),h.reject(a))};f.prototype.clear=function(){this.set({promises:[],
features:[],content:null,title:null,location:null})};f.prototype.open=function(a){this.set(l({visible:!1},{updateLocationEnabled:!1,promises:[]},a));this._setVisibleWhenContentExists()};f.prototype.triggerAction=function(a){(a=this.allActions.getItemAt(a))&&this.emit("trigger-action",{action:a})};f.prototype.next=function(){this.selectedFeatureIndex+=1;return this};f.prototype.previous=function(){--this.selectedFeatureIndex;return this};f.prototype.zoomToLocation=function(){var a=this,c=this.location,
b=this.selectedFeature,e=this.view,p=this.zoomFactor,f=this._getSelectedTarget();if(!f)return c=new k("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:f,view:e}),E.error(c),h.reject(c);var e=e.scale/p,n=this.get("selectedFeature.geometry")||c,r=n&&"point"===n.type&&this._isScreenSize(b);m.zoomToFeature.active=!0;m.zoomToFeature.disabled=!0;return this._zoomToLocation=c=this.callGoTo({target:{target:f,scale:r?e:void 0}}).then(function(){r&&(a.location=n);
m.zoomToFeature.active=!1;m.zoomToFeature.disabled=!1;a._zoomToLocation=null}).catch(function(){m.zoomToFeature.active=!1;m.zoomToFeature.disabled=!1;a._zoomToLocation=null})};f.prototype._getSelectedTarget=function(){var a=this.selectedFeature,c=this.location,b=this.view;if(!b)return null;var b="3d"===b.type,h=this.get("selectedFeature.geometry");return b?a||c:h||c};f.prototype._fetchFeatures=function(a){var c=this.view;return c&&a?c.fetchPopupFeatures(a,{defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled}):
(a=new k("fetch-features:invalid-screenPoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:a,view:c}),E.error(a),h.reject(a))};f.prototype._autoOpenEnabledChange=function(){var a=this,c=this._handles,b=this.autoOpenEnabled;c.remove("auto-fetch-features");b&&(b=p.on(this,"view","click",function(c){a.view.toolViewManager.handlesClickEvent(c)||"mouse"===c.pointerType&&0!==c.button||a._fetchFeaturesAndOpen(c)}),c.add(b,"auto-fetch-features"))};f.prototype._cancelFetchingFeatures=
function(){var a=this._fetchingFeatures;a&&a.cancel();this._fetchingFeatures=null};f.prototype._fetchFeaturesAndOpen=function(a){var c=this,b=a.screenPoint,h=a.mapPoint,e=this.view;this._cancelFetchingFeatures();this._fetchingFeatures=this._fetchFeatures(b).then(function(a){var b=a.promises,p=a.location;c._fetchingFeatures=null;e.popup.open({location:p||h,promises:b});return a})};f.prototype._updatePendingPromises=function(a){a&&this._pendingPromises.has(a)&&(this._pendingPromises.delete(a),this.notifyChange("pendingPromisesCount"))};
f.prototype._setVisibleWhenContentExists=function(){var a=this,c=this._handles,b=this.promiseCount;c.remove("pendingVisible");b?(b=p.init(this,"pendingPromisesCount",function(b){a.featureCount&&(a.set("visible",!0),c.remove("pendingVisible"));b||c.remove("pendingVisible")}),c.add(b,"pendingVisible")):this.set("visible",!0)};f.prototype._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};f.prototype._isScreenSize=function(a){var c=this.view;if("3d"!==c.type||!a||"esri.Graphic"!==a.declaredClass)return!0;
if((c=c.getViewForGraphic(a))&&"whenGraphicBounds"in c){var b=!1;c.whenGraphicBounds(a,{useViewElevation:!0}).then(function(a){b=!a||!a.boundingBox||a.boundingBox[0]===a.boundingBox[3]&&a.boundingBox[1]===a.boundingBox[4]&&a.boundingBox[2]===a.boundingBox[5]});return b}return!0};f.prototype._getPointFromGeometry=function(a){return a?"point"===a.type?a:"extent"===a.type?a.center:"polygon"===a.type?a.centroid:"multipoint"===a.type||"polyline"===a.type?a.extent.center:null:null};f.prototype._isLocationOffScreen=
function(a){return a?(a=this.view.toScreen(a))?!(0<=a.x&&a.x<=this.view.width&&0<=a.y&&a.y<=this.view.height):!1:!1};f.prototype._centerAtLocation=function(){var a=this.location;this.updateLocationEnabled&&a&&this._isLocationOffScreen(a)&&this.centerAtLocation()};f.prototype._highlightFeature=function(){var a=this;this._handles.remove("highlight");var c=this.selectedFeature,b=this.highlightEnabled,h=this.view,p=this.visible;if(c&&h&&b&&p){var m=c.layer;m&&h.when().then(function(){e.typeCast(h)().whenLayerView(m).then(function(b){if(b&&
w.hasHighlight(b)){var h=m.objectIdField,e=c.attributes;b=b.highlight(e&&e[h]||c);a._handles.add(b,"highlight")}})})}};f.prototype._updateFeatures=function(a){var c=this.features;a&&a.length&&(c.length?(a=a.filter(function(a){return-1===c.indexOf(a)}),this.features=c.concat(a)):this.features=a)};g([n.property({type:C})],f.prototype,"actions",void 0);g([n.property({dependsOn:["actions.length","selectedFeature.sourceLayer.popupTemplate.actions.length","selectedFeature.sourceLayer.popupTemplate.overwriteActions",
"selectedFeature.popupTemplate.actions.length","selectedFeature.popupTemplate.overwriteActions"],readOnly:!0})],f.prototype,"allActions",null);g([n.property({type:Boolean})],f.prototype,"defaultPopupTemplateEnabled",void 0);g([n.property()],f.prototype,"autoCloseEnabled",void 0);g([n.property()],f.prototype,"autoOpenEnabled",void 0);g([n.property()],f.prototype,"content",void 0);g([n.property({readOnly:!0,dependsOn:["features"]})],f.prototype,"featureCount",null);g([n.property()],f.prototype,"features",
null);g([n.property()],f.prototype,"highlightEnabled",void 0);g([n.property({type:b.Point})],f.prototype,"location",null);g([n.property({readOnly:!0,dependsOn:["promises"]})],f.prototype,"pendingPromisesCount",null);g([n.property({readOnly:!0,dependsOn:["featureCount","pendingPromisesCount"]})],f.prototype,"waitingForResult",null);g([n.property({readOnly:!0,dependsOn:["promises"]})],f.prototype,"promiseCount",null);g([n.property()],f.prototype,"promises",null);g([n.property({value:null,readOnly:!0,
dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],f.prototype,"selectedFeature",null);g([n.property({value:-1})],f.prototype,"selectedFeatureIndex",null);g([n.property({readOnly:!0,dependsOn:["view.ready"]})],f.prototype,"state",null);g([n.property()],f.prototype,"title",void 0);g([n.property()],f.prototype,"updateLocationEnabled",void 0);g([n.property()],f.prototype,"view",void 0);g([n.property()],f.prototype,"visible",void 0);g([n.property()],f.prototype,"zoomFactor",void 0);
g([n.property()],f.prototype,"centerAtLocation",null);g([n.property()],f.prototype,"clear",null);g([n.property()],f.prototype,"triggerAction",null);g([n.property()],f.prototype,"next",null);g([n.property()],f.prototype,"previous",null);g([n.property()],f.prototype,"zoomToLocation",null);return f=g([n.subclass("esri.widgets.Popup.PopupViewModel")],f)}(n.declared(x,A))})},"esri/views/support/layerViewUtils":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});
d.hasHighlight=function(d){return d&&"function"===typeof d.highlight}})},"esri/widgets/Popup/actions":function(){define("require exports dojo/i18n!../../nls/common dojo/i18n!./nls/Popup ../../core/Error ../../core/promiseUtils ../../support/actions/ActionButton".split(" "),function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});d.zoomToFeature=new f({id:"zoom-to-feature",title:g.zoom,className:"esri-icon-zoom-in-magnifying-glass"});d.removeSelectedFeature=new f({id:"remove-selected-feature",
title:q.remove,className:"esri-icon-trash"});d.all=[d.zoomToFeature,d.removeSelectedFeature];d.triggerAction=function(e){var f=e.view;e=e.event.action;var c=f&&f.popup;if(!e)return b.reject(new l("trigger-action:missing-arguments","Event has no action"));if(!c)return b.reject(new l("trigger-action:missing-arguments","view.popup is missing"));var a=e.disabled,h=e.id;if(!h)return b.reject(new l("trigger-action:invalid-action","action.id is missing"));if(a)return b.reject(new l("trigger-action:invalid-action",
"Action is disabled"));if(h===d.zoomToFeature.id)return c.viewModel.zoomToLocation();if(h===d.removeSelectedFeature.id){c.close();e=c.selectedFeature;if(!e)return b.reject(new l("trigger-action:"+d.removeSelectedFeature.id,"selectedFeature is required",{selectedFeature:e}));(c=e.sourceLayer)?c.remove(e):f.graphics.remove(e);return b.resolve()}return b.reject(new l("trigger-action:unknown-action","Unable to identify action to perform",{action:e,popup:c}))}})},"esri/widgets/support/GoTo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b){return function(f){function e(){var b=null!==f&&f.apply(this,arguments)||this;b.goToOverride=null;b.view=null;return b}q(e,f);e.prototype.callGoTo=function(b){var c=this.view;return this.goToOverride?this.goToOverride(c,b):c.goTo(b.target,b.options)};g([b.property()],e.prototype,"goToOverride",void 0);g([b.property()],e.prototype,"view",void 0);return e=g([b.subclass("esri.widgets.support.GoTo")],e)}(b.declared(l))})},"esri/views/GroundView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./support/GroundViewElevationSampler".split(" "),
function(t,d,q,g,l,b,f,e,k,c){return function(a){function h(c){c=a.call(this)||this;c.handles=new f;c.view=null;c.layerViews=new b;return c}q(h,a);h.prototype.initialize=function(){var a=this;this.handles.add(e.when(this,"view.map.ground",function(a){return a.load()}));this.handles.add(this.layerViews.on("after-changes",function(){return a.layerViewsAfterChangesHandler()}))};h.prototype.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};Object.defineProperty(h.prototype,
"elevationSampler",{get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new c({view:this.view}):null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return this.suspended?!1:this.layerViews.some(function(a){return a.updating})},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!0,configurable:!0});
h.prototype.layerViewsAfterChangesHandler=function(){var a=this;this.handles.remove("updating");this.handles.add(this.layerViews.map(function(c){return c.watch("updating",function(){return a.updateUpdating()},!0)}).toArray(),"updating");this.updateUpdating()};h.prototype.updateUpdating=function(){this.notifyChange("updating")};g([k.property({readOnly:!0,dependsOn:["view.ready","view.basemapTerrain?.ready"]})],h.prototype,"elevationSampler",null);g([k.property({type:Boolean,dependsOn:["suspended"],
readOnly:!0})],h.prototype,"updating",null);g([k.property({constructOnly:!0})],h.prototype,"view",void 0);g([k.property({type:b,readOnly:!0})],h.prototype,"layerViews",void 0);g([k.property({readOnly:!0,dependsOn:["view.suspended"]})],h.prototype,"suspended",null);return h=g([k.subclass("esri.views.GroundView")],h)}(k.declared(l))})},"esri/views/support/GroundViewElevationSampler":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){var n=f.getLogger("esri.views.support.GroundViewElevationSampler");return function(b){function f(a){a=b.call(this,a)||this;a.demResolution={min:-1,max:-1};a.noDataValue=p.noDataValueOpt.noDataValue;return a}q(f,b);f.prototype.initialize=function(){var a=this;this.view.basemapTerrain.on("elevation-change",function(){return a.emit("changed",{})})};Object.defineProperty(f.prototype,"extent",{get:function(){var a=this.view.basemapTerrain;return a.extent&&a.spatialReference?
k.toExtent(a.extent,a.spatialReference):null},enumerable:!0,configurable:!0});f.prototype.elevationAt=function(b){var h=b.spatialReference,e=this.spatialReference;if(!a.canProject(h,e))return n.error("Cannot sample elevation at a location with spatial reference ("+(h?h.wkid:"unknown")+") different from the view ("+e.wkid+")"),null;c.extentContainsPoint(this.extent,b)||(h=this.extent,n.warn("#elevationAt()","Point used to sample elevation ("+b.x+", "+b.y+") is outside of the sampler extent ("+(h.xmin+
", "+h.ymin+", "+h.xmax+", "+h.ymax)+")"));return this.view.basemapTerrain.getElevation(b)};f.prototype.queryElevation=function(a){return h.updateGeometryElevation(a.clone(),this)};g([e.property({readOnly:!0})],f.prototype,"demResolution",void 0);g([e.property({readOnly:!0,dependsOn:["view.basemapTerrain.extent","view.basemapTerrain.spatialReference"]})],f.prototype,"extent",null);g([e.property({readOnly:!0})],f.prototype,"noDataValue",void 0);g([e.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],
f.prototype,"spatialReference",void 0);g([e.property({constructOnly:!0})],f.prototype,"view",void 0);return f=g([e.subclass("esri.views.support.GroundViewElevationSampler")],f)}(e.declared(l,b))})},"esri/layers/support/ElevationSampler":function(){define("require exports ../../geometry ../../core/compilerUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),function(t,d,q,g,l,b,f,e,k){function c(c,
b){var h=a(c,b.spatialReference);if(!h)return null;switch(c.type){case "point":c.z=b.elevationAt(h)||0;break;case "polyline":n.spatialReference=h.spatialReference;for(var e=c.hasM&&!c.hasZ,f=0;f<c.paths.length;f++)for(var p=c.paths[f],k=h.paths[f],r=0;r<p.length;r++){var u=p[r],v=k[r];n.x=v[0];n.y=v[1];v=b.elevationAt(n)||0;e&&(u[3]=u[2]);u[2]=v}c.hasZ=!0;break;case "multipoint":n.spatialReference=h.spatialReference;e=c.hasM&&!c.hasZ;for(f=0;f<c.points.length;f++)p=c.points[f],k=h.points[f],n.x=k[0],
n.y=k[1],k=b.elevationAt(n)||0,e&&(p[3]=p[2]),p[2]=k;c.hasZ=!0;break;default:g.neverReached(c)}return c}function a(a,c){var b=a.spatialReference;return b.equals(c)?a:k.canProject(b,c)?k.project(a,c):(h.error("Cannot project geometry spatial reference (wkid:"+b.wkid+") to elevation sampler spatial reference (wkid:"+c.wkid+")"),null)}Object.defineProperty(d,"__esModule",{value:!0});var h=l.getLogger("esri.layers.support.ElevationSampler"),p=function(){function p(a,c,h){this.tile=a;this.noDataValue=
h;this.extent=f.toExtent(a.tile.extent,c.spatialReference);h=b.getMetersPerUnitForSR(c.spatialReference);a=c.lodAt(a.tile.level).resolution*h;this.demResolution={min:a,max:a}}Object.defineProperty(p.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});p.prototype.contains=function(c){c=a(c,this.spatialReference);return e.extentContainsPoint(this.extent,c)};p.prototype.elevationAt=function(c){var b=a(c,this.spatialReference);if(!b)return null;
if(!this.contains(c)){var e=this.extent;h.warn("#elevationAt()","Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler extent ("+(e.xmin+", "+e.ymin+", "+e.xmax+", "+e.ymax)+")")}return this.tile.sample(b.x,b.y)};p.prototype.queryElevation=function(a){return c(a.clone(),this)};p.prototype.on=function(a,c){return u};return p}();d.TileElevationSampler=p;t=function(){function b(a,c,b){var h=this,e;"number"===typeof c?(this.noDataValue=c,e=null):(e=c,this.noDataValue=b);this.samplers=
e?a.map(function(a){return new p(a,e,h.noDataValue)}):a;if(a=this.samplers[0])for(this.extent=a.extent.clone(),a=a.demResolution,this.demResolution={min:a.min,max:a.max},a=1;a<this.samplers.length;a++)c=this.samplers[a],this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max);else this.extent=f.toExtent(f.create(),e.spatialReference),this.demResolution={min:0,max:0}}Object.defineProperty(b.prototype,
"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});b.prototype.elevationAt=function(c){var b=a(c,this.spatialReference);if(!b)return null;for(var e=0,p=this.samplers;e<p.length;e++){var f=p[e];if(f.contains(b))return f.elevationAt(b)}h.warn("#elevationAt()","Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler");return null};b.prototype.queryElevation=function(a){return c(a.clone(),this)};b.prototype.on=function(a,c){return u};
return b}();d.MultiTileElevationSampler=t;d.updateGeometryElevation=c;var n=new q.Point,u={remove:function(){}}})},"esri/views/3d/terrain/TerrainConst":function(){define(["require","exports","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});(function(g){g[g.ELEVATION=0]="ELEVATION";g[g.MAP=1]="MAP";g[g.COUNT=2]="COUNT"})(d.LayerClass||(d.LayerClass={}));(function(g){g[g.NONE=0]="NONE";g[g.SPLIT=1]="SPLIT";g[g.VSPLITMERGE=
2]="VSPLITMERGE";g[g.MERGE=4]="MERGE";g[g.GEOMETRY=8]="GEOMETRY";g[g.TEXTURE=16]="TEXTURE"})(d.TileUpdate||(d.TileUpdate={}));(function(g){g[g.BACK_TO_FRONT=-1]="BACK_TO_FRONT";g[g.NONE=0]="NONE";g[g.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(d.RenderOrder||(d.RenderOrder={}));d.TILE_LOADING_DEBUGLOG=!1;d.MAX_ROOT_TILES=64;d.MAX_TILE_TESSELATION=512;d.MAX_MEMORY_LOD_BIAS=2.5;d.ELEVATION_NODATA_VALUE=3.40282347E38/10;d.noDataValueOpt={noDataValue:d.ELEVATION_NODATA_VALUE};d.START_LOADING_LEVEL_DELTA=8;d.LOADING_LEVEL_MODULO=
2;d.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;d.TILEMAP_SIZE_EXP=5;d.TILEMAP_SIZE=1<<d.TILEMAP_SIZE_EXP;d.WEBMERCATOR_WORLD_EXTENT=q.create();g.WebMercatorAuxiliarySphere.getExtent(0,0,0,d.WEBMERCATOR_WORLD_EXTENT);d.GEOGRAPHIC_WORLD_EXTENT=q.create([-180,-90,180,90]);d.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";d.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";
d.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
d.GEOMETRY_VERTEX_STRIDE=5})},"esri/views/3d/terrain/TilingScheme":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/support/TileInfo ../support/mathUtils ../support/projectionUtils".split(" "),function(t,d,q,g,l,b,f,e,k,c){var a=c.webMercator.x2lon,h=c.webMercator.y2lat;t=function(){function c(a){var b=c._checkUnsupported(a);if(b)throw b;this.spatialReference=
a.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84=this.spatialReference.isWGS84;this.origin=[a.origin.x,a.origin.y];this.pixelSize=[a.size[0],a.size[1]];this.dpi=a.dpi;var h=a.lods.reduce(function(a,c,b){c.level<a.min&&(a.min=c.level,a.minIndex=b);a.max=Math.max(a.max,c.level);return a},{min:Infinity,minIndex:0,max:-Infinity}),e=a.lods[h.minIndex],p=Math.pow(2,e.level),b=e.resolution*p,e=e.scale*p;this.levels=Array(h.max+1);for(h=0;h<this.levels.length;h++)this.levels[h]=
{resolution:b,scale:e,tileSize:[b*a.size[0],b*a.size[1]]},b/=2,e/=2}c.prototype.clone=function(){return new c(this.toTileInfo())};c.prototype.toTileInfo=function(){return new e({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:this.pixelSize,spatialReference:this.spatialReference,lods:this.levels.map(function(a,c){return{level:c,scale:a.scale,resolution:a.resolution}})})};c.prototype.getExtent=function(c,b,e,p,n){void 0===p&&(p=f.create());var m=
this.levels[c];c=m.tileSize[0];m=m.tileSize[1];p[0]=this.origin[0]+e*c;p[2]=p[0]+c;p[3]=this.origin[1]-b*m;p[1]=p[3]-m;n&&(this._isWebMercator?(n[0]=a(p[0]),n[1]=h(p[1]),n[2]=a(p[2]),n[3]=h(p[3])):this._isWGS84&&(n[0]=k.deg2rad(p[0]),n[1]=k.deg2rad(p[1]),n[2]=k.deg2rad(p[2]),n[3]=k.deg2rad(p[3])));return p};c.prototype.getExtentGeometry=function(a,c,b,h){void 0===h&&(h=new q.Extent);this.getExtent(a,c,b,p);h.spatialReference=this.spatialReference;h.xmin=p[0];h.ymin=p[1];h.xmax=p[2];h.ymax=p[3];h.zmin=
void 0;h.zmax=void 0;return h};c.prototype.ensureMaxLod=function(a){for(;this.levels.length<=a;){var c=this.levels[this.levels.length-1],b=c.resolution/2;this.levels.push({resolution:b,scale:c.scale/2,tileSize:[b*this.pixelSize[0],b*this.pixelSize[1]]})}};c.prototype.capMaxLod=function(a){this.levels.length>a+1&&(this.levels.length=a+1)};c.prototype.getMaxLod=function(){return this.levels.length-1};c.prototype.scaleAtLevel=function(a){return this.levels[0].scale/Math.pow(2,a)};c.prototype.levelAtScale=
function(a){var c=this.levels[0].scale;return a>=c?0:Math.log(c/a)*Math.LOG2E};c.prototype.resolutionAtLevel=function(a){return this.levels[0].resolution/Math.pow(2,a)};c.prototype.compatibleWith=function(a){if(!(a instanceof c)){if(c._checkUnsupported(a))return!1;a=new c(a)}if(!a.spatialReference.equals(this.spatialReference)||a.pixelSize[0]!==this.pixelSize[0]||a.pixelSize[1]!==this.pixelSize[1])return!1;var b=Math.min(this.levels.length,a.levels.length)-1,h=this.levels[b].resolution,e=.5*h;if(!k.floatEqualAbsolute(a.origin[0],
this.origin[0],e)||!k.floatEqualAbsolute(a.origin[1],this.origin[1],e))return!1;e=.5*h/Math.pow(2,b)/Math.max(this.pixelSize[0],this.pixelSize[1])*12;return k.floatEqualAbsolute(h,a.levels[b].resolution,e)};c.prototype.rootTilesInExtent=function(a,b,h){var e=this.levels[0].tileSize;if(0===e[0]||0===e[1])return[];c.computeRowColExtent(a,e,this.origin,p);a=p[1];var f=p[3],m=p[0],n=p[2],k=n-m,u=f-a;k*u>h&&(h=Math.floor(Math.sqrt(h)),u>h&&(a=a+Math.floor(.5*u)-Math.floor(.5*h),f=a+h),k>h&&(m=m+Math.floor(.5*
k)-Math.floor(.5*h),n=m+h));h=Array((n-m)*(f-a));k=0;for(u=a;u<f;u++)for(var g=m;g<n;g++)h[k++]=[0,u,g];b&&(b[0]=this.origin[0]+m*e[0],b[1]=this.origin[1]-f*e[1],b[2]=this.origin[0]+n*e[0],b[3]=this.origin[1]-a*e[1]);return h};c.computeRowColExtent=function(a,c,b,h){var e=.001*(a[2]-a[0]+(a[3]-a[1]));h[0]=Math.floor((a[0]+e-b[0])/c[0]);h[2]=Math.ceil((a[2]-e-b[0])/c[0]);h[1]=Math.floor((b[1]-a[3]+e)/c[1]);h[3]=Math.ceil((b[1]-a[1]-e)/c[1])};c.isPowerOfTwo=function(a){a=a.lods;var c=a[0].resolution*
Math.pow(2,a[0].level);return!a.some(function(a){return!k.floatEqualRelative(a.resolution,c/Math.pow(2,a.level))})};c.hasGapInLevels=function(a){a=a.lods.map(function(a){return a.level});a.sort(function(a,c){return a-c});for(var c=1;c<a.length;c++)if(a[c]!==a[0]+c)return!0;return!1};c.tileSizeSupported=function(a){var c=a.size[1];return c===a.size[0]&&0===(c&c-1)&&128<=c&&512>=c};c._checkUnsupported=function(a){return a?1>a.lods.length?new g("tilingscheme:generic","Tiling scheme must have at least one level"):
c.isPowerOfTwo(a)?null:new g("tilingscheme:power-of-two","Tiling scheme must be power of two"):new g("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};c.checkUnsupported=function(a){var b=c._checkUnsupported(a);return b?b:c.hasGapInLevels(a)?new g("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):c.tileSizeSupported(a)?null:new g("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]")};c.fromExtent=
function(a,b){var h=a[2]-a[0],p=a[3]-a[1],f=l.getMetersPerUnitForSR(b),m=1.2*Math.max(h,p);a=new c(new e({size:[256,256],origin:{x:a[0]-.5*(m-h),y:a[3]+.5*(m-p)},lods:[{level:0,resolution:m/256,scale:1/(256/96*.0254/(m*f))}],spatialReference:b}));a.ensureMaxLod(20);return a};c.makeWebMercatorAuxiliarySphere=function(a){void 0===a&&(a=19);var b=new c(c.WebMercatorAuxiliarySphereTileInfo);b.ensureMaxLod(a);return b};c.makeWGS84WithTileSize=function(a,h){void 0===h&&(h=16);var p=256/a;a=new c(new e({size:[a,
a],origin:{x:-180,y:90,spatialReference:b.WGS84},spatialReference:b.WGS84,lods:[{level:0,resolution:.703125*p,scale:2.95497598570834E8*p}]}));a.ensureMaxLod(h);return a};c.WebMercatorAuxiliarySphereTileInfo=new e({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:b.WebMercator},spatialReference:b.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});c.WebMercatorAuxiliarySphere=c.makeWebMercatorAuxiliarySphere(19);return c}();var p=f.create();
return t})},"esri/layers/support/TileInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/JSONSupport ../../core/kebabDictionary ../../core/unitUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),function(t,
d,q,g,l,b,f,e,k,c,a,h,p,n,u){var v=new e.default({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc"});return function(e){function f(a){a=e.call(this)||this;a.dpi=96;a.format=null;a.origin=null;a.minScale=0;a.maxScale=0;a.size=null;a.spatialReference=null;return a}g(f,e);r=f;f.create=function(a){void 0===a&&(a={size:256,spatialReference:b.SpatialReference.WebMercator});
var c=a.resolutionFactor||1,h=a.scales,e=a.size||256;a=a.spatialReference||b.SpatialReference.WebMercator;if(!p.isValid(a)){for(var c=[],f=5E-4,m=23;0<=m;m--)c.unshift({level:m,scale:f,resolution:f}),f*=2;return new r({dpi:96,lods:c,origin:new b.Point(0,0,a),size:e,spatialReference:a})}var n=(m=p.getInfo(a))?new b.Point(m.origin[0],m.origin[1],a):new b.Point(0,0,a),g=1/(39.37*k.getMetersPerUnitForSR(a)*96),u=[];if(h)for(m=0;m<h.length;m++){var v=h[m],f=v*g;u.push({level:m,scale:v,resolution:f})}else for(f=
p.isGeographic(a)?512/e*5.916575275917094E8:256/e*5.91657527591555E8,h=Math.ceil(24/c),u.push({level:0,scale:f,resolution:f*g}),m=1;m<h;m++)v=f/Math.pow(2,c),f=v*g,u.push({level:m,scale:v,resolution:f}),f=v;return new r({dpi:96,lods:u,origin:n,size:e,spatialReference:a})};Object.defineProperty(f.prototype,"isWrappable",{get:function(){var a=this.spatialReference,c=this.origin;if(a&&c){var b=p.getInfo(a);return a.isWrappable&&Math.abs(b.origin[0]-c.x)<=b.dx}return!1},enumerable:!0,configurable:!0});
f.prototype.readOrigin=function(a,c){return b.Point.fromJSON(q({spatialReference:c.spatialReference},a))};Object.defineProperty(f.prototype,"lods",{set:function(a){var c=this,b=0,h=0,e=[];this._levelToLOD={};a&&(b=-Infinity,h=Infinity,a.forEach(function(a){e.push(a.scale);b=a.scale>b?a.scale:b;h=a.scale<h?a.scale:h;c._levelToLOD[a.level]=a}));this._set("scales",e);this._set("minScale",b);this._set("maxScale",h);this._set("lods",a);this._initializeUpsampleLevels()},enumerable:!0,configurable:!0});
f.prototype.readSize=function(a,c){return[c.cols,c.rows]};f.prototype.writeSize=function(a,c){c.cols=a[0];c.rows=a[0]};f.prototype.zoomToScale=function(a){var c=this.scales;if(0>=a)return c[0];if(a>=c.length)return c[c.length-1];var b=Math.round(a);return c[b]+(b-a)*(c[Math.round(a-.5)]-c[b])};f.prototype.scaleToZoom=function(a){for(var c=this.scales,b=c.length-1,h=0;h<b;h++){var e=c[h],f=c[h+1];if(e<=a)break;if(f===a)return h+1;if(e>a&&f<a)return h+1-(a-f)/(e-f)}return h};f.prototype.snapScale=function(a,
c){void 0===c&&(c=.95);a=this.scaleToZoom(a);return a%Math.floor(a)>=c?this.zoomToScale(Math.ceil(a)):this.zoomToScale(Math.floor(a))};f.prototype.tileAt=function(a,c,b,e){var f=this.lodAt(a);if(!f)return null;var m;if("number"===typeof c)m=c,c=b;else{if(p.equals(c.spatialReference,this.spatialReference))m=c.x,c=c.y;else{e=n.project(c,this.spatialReference);if(!e)return null;m=e.x;c=e.y}e=b}b=f.resolution*this.size[0];f=f.resolution*this.size[1];e||(e={id:null,level:0,row:0,col:0,extent:h.create()});
e.level=a;e.row=Math.floor((this.origin.y-c)/f+.001);e.col=Math.floor((m-this.origin.x)/b+.001);this.updateTileInfo(e);return e};f.prototype.updateTileInfo=function(a){var c=this.lodAt(a.level);if(c){var b=c.resolution*this.size[0],c=c.resolution*this.size[1];a.id=a.level+"/"+a.row+"/"+a.col;a.extent||(a.extent=h.create());a.extent[0]=this.origin.x+a.col*b;a.extent[1]=this.origin.y-(a.row+1)*c;a.extent[2]=a.extent[0]+b;a.extent[3]=a.extent[1]+c}};f.prototype.upsampleTile=function(a){var c=this._upsampleLevels[a.level];
if(!c||-1===c.parentLevel)return!1;a.level=c.parentLevel;a.row=Math.floor(a.row/c.factor+.001);a.col=Math.floor(a.col/c.factor+.001);this.updateTileInfo(a);return!0};f.prototype.getTileBounds=function(a,c){var b=this.lodAt(c.level).resolution,h=b*this.size[0],b=b*this.size[1];a[0]=this.origin.x+c.col*h;a[1]=this.origin.y-(c.row+1)*b;a[2]=a[0]+h;a[3]=a[1]+b;return a};f.prototype.lodAt=function(a){return this._levelToLOD&&this._levelToLOD[a]||null};f.prototype.clone=function(){return r.fromJSON(this.write({}))};
f.prototype._initializeUpsampleLevels=function(){var a=this.lods;this._upsampleLevels=[];for(var c=null,b=0;b<a.length;b++){var h=a[b];this._upsampleLevels[h.level]={parentLevel:c?c.level:-1,factor:c?c.resolution/h.resolution:0};c=h}};var r;l([c.property({type:Number,json:{write:!0}})],f.prototype,"compressionQuality",void 0);l([c.property({type:Number,json:{write:!0}})],f.prototype,"dpi",void 0);l([c.property({type:String,json:{read:v.read,write:v.write,origins:{"web-scene":{read:!1,write:!1}}}})],
f.prototype,"format",void 0);l([c.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],f.prototype,"isWrappable",null);l([c.property({type:b.Point,json:{write:!0}})],f.prototype,"origin",void 0);l([c.reader("origin")],f.prototype,"readOrigin",null);l([c.property({type:[u],value:null,json:{write:!0}})],f.prototype,"lods",null);l([c.property({readOnly:!0})],f.prototype,"minScale",void 0);l([c.property({readOnly:!0})],f.prototype,"maxScale",void 0);l([c.property({readOnly:!0})],f.prototype,
"scales",void 0);l([c.property({cast:function(a){return Array.isArray(a)?a:"number"===typeof a?[a,a]:[256,256]}})],f.prototype,"size",void 0);l([c.reader("size",["rows","cols"])],f.prototype,"readSize",null);l([c.writer("size",{cols:{type:a.Integer},rows:{type:a.Integer}})],f.prototype,"writeSize",null);l([c.property({type:b.SpatialReference,json:{write:!0}})],f.prototype,"spatialReference",void 0);return f=r=l([c.subclass("esri.layers.support.TileInfo")],f)}(c.declared(f))})},"esri/layers/support/LOD":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(t,d,q,g,l,b,f){return function(e){function k(a){a=e.call(this,a)||this;a.level=0;a.levelValue=null;a.resolution=0;a.scale=0;return a}q(k,e);c=k;k.prototype.clone=function(){return new c({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};var c;g([b.property({type:f.Integer,json:{write:!0}})],k.prototype,"level",void 0);g([b.property({type:String,json:{write:!0}})],k.prototype,"levelValue",void 0);g([b.property({type:Number,json:{write:!0}})],k.prototype,
"resolution",void 0);g([b.property({type:Number,json:{write:!0}})],k.prototype,"scale",void 0);return k=c=g([b.subclass("esri.layers.support.LOD")],k)}(b.declared(l))})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ./mathUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){function p(a,c,b,h){2===a.length?(F[0]=a[0],F[1]=a[1],F[2]=0,a=F):a===b&&(g.vec3.copy(F,a),a=F);return n(a,c,0,b,h,0,1)}function n(a,c,b,h,e,f,p){void 0===p&&(p=1);w!==c&&(m=u(c),w=c);x!==e&&(A=u(e),x=e);p=b+3*p;if(m!==A||0===m&&!c.equals(e))if(0<m&&0<A)if(2!==A)if(c=C[A],2!==m)for(e=B[m];b<p;b+=3,f+=3)e(a,b,K,0),c(K,0,h,f);else for(;b<p;b+=3,f+=3)c(a,b,h,f);else for(e=B[m];b<p;b+=3,f+=3)e(a,b,h,f);else return!1;else if(h!==a||b!==f)for(;b<p;b++,f++)h[f]=a[b];return!0}
function u(a){return a.wkt===d.SphericalECEFSpatialReference.wkt?1:a.isWGS84?2:a.isWebMercator?3:a.wkt===d.WGS84ECEFSpatialReference.wkt?4:0}function v(a,c,b,h){b[h++]=a[c++];b[h++]=a[c++];b[h]=a[c]}function r(c,b,h,e){var f=.4999999*Math.PI,f=a.clamp(E*c[b+1],-f,f),f=Math.sin(f);h[e++]=E*c[b]*G;h[e++]=G/2*Math.log((1+f)/(1-f));h[e]=c[b+2]}function y(a,c,b,h){var e=G+a[c+2],f=E*a[c+1];a=E*a[c];c=Math.cos(f);b[h++]=Math.cos(a)*c*e;b[h++]=Math.sin(a)*c*e;b[h]=Math.sin(f)*e}Object.defineProperty(d,"__esModule",
{value:!0});d.SphericalECEFSpatialReference=new f({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});d.WGS84ECEFSpatialReference=new f({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});
var w,m,x,A;d.vectorToVector=p;d.pointToVector=function(a,c,b,h){void 0===h&&(h=0);F[0]=a.x;F[1]=a.y;var e=a.z;F[2]=void 0!==e?e:h;return n(F,a.spatialReference,0,c,b,0,1)};d.vectorToPoint=function(a,c,h,e){h instanceof b?e=e||h.spatialReference:k.isPoint(h)?(h.hasZ=!0,e=e||h.spatialReference):(e=h,h=new b({spatialReference:e}));return n(a,c,0,F,e,0,1)?(h.x=F[0],h.y=F[1],h.z=F[2],h.spatialReference=e,h):null};d.xyzToVector=function(a,c,b,h,e,f){F[0]=a;F[1]=c;F[2]=b;return n(F,h,0,e,f,0,1)};d.bufferToBuffer=
n;d.computeLinearTransformation=function(a,c,b,h){var e=u(a),f=u(h);if(e===f&&1!==f&&(0!==e||a.equals(h)))return q.mat4.identity(b),q.mat4.translate(b,b,c),!0;if(1===f){if(a=B[e])return a(c,0,K,0),y(K,0,M,0),h=E*K[0],a=E*K[1],c=Math.sin(h),h=Math.cos(h),e=Math.sin(a),a=Math.cos(a),b[0]=-c,b[4]=-e*h,b[8]=a*h,b[12]=M[0],b[1]=h,b[5]=-e*c,b[9]=a*c,b[13]=M[1],b[2]=0,b[6]=a,b[10]=e,b[14]=M[2],b[3]=0,b[7]=0,b[11]=0,b[15]=1,!0}else if(3===f&&(2===e||1===e))return B[e](c,0,K,0),c=E*K[1],r(K,0,M,0),q.mat4.identity(b),
q.mat4.translate(b,b,M),c=1/Math.cos(c),q.mat4.scale(b,b,[c,c,1]),!0;return!1};d.transformDirection=function(a,c,b,h,e){g.vec3.copy(Q,a);g.vec3.add(P,a,c);p(Q,b,Q,e);p(P,b,P,e);g.vec3.subtract(h,P,Q);g.vec3.normalize(h,h)};d.mbsToMbs=function(a,c,b,h){var e=u(c),f=u(h);if(e===f&&(0!==e||c.equals(h)))return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],!0;if(1===f){if(c=B[e])return c(a,0,K,0),y(K,0,b,0),b[3]=a[3],!0}else if(3===f&&(2===e||1===e))return B[e](a,0,K,0),c=Math.abs(E*K[1])+Math.asin(a[3]/(G+
a[2])),r(K,0,b,0),b[3]=c>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(c)*a[3],!0;return!1};d.extentToBoundingBox=function(a,c,b){if(null==a)return!1;var h;F[0]=null!=a.xmin?a.xmin:0;F[1]=null!=a.ymin?a.ymin:0;F[2]=null!=a.zmin?a.zmin:0;h=n(F,a.spatialReference,0,c,b,0,1);F[0]=null!=a.xmax?a.xmax:0;F[1]=null!=a.ymax?a.ymax:0;F[2]=null!=a.zmax?a.zmax:0;h=h&&n(F,a.spatialReference,0,c,b,3,1);null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.zmin&&(c[2]=-Infinity);null==a.xmax&&(c[3]=
Infinity);null==a.ymax&&(c[4]=Infinity);null==a.zmax&&(c[5]=Infinity);return h};d.extentToBoundingRect=function(a,c,b){if(null==a)return!1;var h;F[0]=null!=a.xmin?a.xmin:0;F[1]=null!=a.ymin?a.ymin:0;F[2]=null!=a.zmin?a.zmin:0;h=n(F,a.spatialReference,0,F,b,0,1);c[0]=F[0];c[1]=F[1];F[0]=null!=a.xmax?a.xmax:0;F[1]=null!=a.ymax?a.ymax:0;F[2]=null!=a.zmax?a.zmax:0;h=h&&n(F,a.spatialReference,0,F,b,0,1);c[2]=F[0];c[3]=F[1];null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.xmax&&(c[2]=
Infinity);null==a.ymax&&(c[3]=Infinity);return h};d.boundingRectToBoundingRect=function(a,c,b,h){if(null==a)return!1;if(c.equals(h))return e.set(b,a),!0;var f;F[0]=a[0];F[1]=a[1];F[2]=0;f=n(F,c,0,F,h,0,1);b[0]=F[0];b[1]=F[1];F[0]=a[2];F[1]=a[3];F[2]=0;f=f&&n(F,c,0,F,h,0,1);b[2]=F[0];b[3]=F[1];return f};(function(a){a.x2lon=function(a){return a/G};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/G))};a.lon2x=function(a){return a*G};a.lat2y=function(a){a=Math.sin(a);return G/2*Math.log((1+
a)/(1-a))}})(d.webMercator||(d.webMercator={}));var C=[void 0,y,v,r,function(a,c,b,h){var e=L,f=E*a[c],p=E*a[c+1];a=a[c+2];c=Math.sin(p);var p=Math.cos(p),n=e.a/Math.sqrt(1-e.e2*c*c);b[h++]=(n+a)*p*Math.cos(f);b[h++]=(n+a)*p*Math.sin(f);b[h++]=(n*(1-e.e2)+a)*c}],B=[void 0,function(c,b,e,f){var p=h.Vec3Compact.length(c,b),n=a.asin(c[b+2]/(0===p?1:p)),m=Math.cos(n)*p;c=(0<c[b+1]?1:-1)*a.acos(c[b]/(0===m?1:m));e[f++]=I*c;e[f++]=I*n;e[f]=p-G},v,function(a,c,b,h){b[h++]=I*(a[c++]/G);b[h++]=I*(Math.PI/
2-2*Math.atan(Math.exp(-1*a[c++]/G)));b[h]=a[c]},function(a,c,b,h){var e=L,f=a[c],p=a[c+1];a=a[c+2];var n,m,k,g,r,u;c=Math.abs(a);n=f*f+p*p;m=Math.sqrt(n);k=n+a*a;g=Math.sqrt(k);f=Math.atan2(p,f);r=a*a/k;k=n/k;p=e.a2/g;n=e.a3-e.a4/g;.3<k?(r=c/g*(1+k*(e.a1+p+r*n)/g),g=Math.asin(r),p=r*r,k=Math.sqrt(1-p)):(k=m/g*(1-r*(e.a5-p-k*n)/g),g=Math.acos(k),p=1-k*k,r=Math.sqrt(p));u=1-e.e2*p;p=e.a/Math.sqrt(u);e=e.a6*p;p=m-p*k;n=c-e*r;c=k*p+r*n;m=k*n-r*p;e=m/(e/u+c);g+=e;0>a&&(g=-g);b[h++]=I*f;b[h++]=I*g;b[h]=
c+m*e/2}],E=a.deg2rad(1),I=a.rad2deg(1),G=c.earthRadius,L={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},F=l.vec3f64.create(),K=l.vec3f64.create(),M=l.vec3f64.create(),Q=l.vec3f64.create(),P=l.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require","exports","./math/mat4"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.mat4=q})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require",
"exports","../factories/vec3f64","./common"],function(t,d,q,g){function l(c){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c}function b(c,a,b){var h=a[0],e=a[1],f=a[2],k=a[3],g=a[4],l=a[5],d=a[6],m=a[7],x=a[8],A=a[9],C=a[10],B=a[11],E=a[12],q=a[13],G=a[14];a=a[15];var L=b[0],F=b[1],K=b[2],M=b[3];c[0]=L*h+F*g+K*x+M*E;c[1]=L*e+F*l+K*A+M*q;c[2]=L*f+F*d+K*C+M*G;c[3]=L*k+F*m+K*B+M*a;L=b[4];F=b[5];K=b[6];M=b[7];c[4]=L*h+F*g+
K*x+M*E;c[5]=L*e+F*l+K*A+M*q;c[6]=L*f+F*d+K*C+M*G;c[7]=L*k+F*m+K*B+M*a;L=b[8];F=b[9];K=b[10];M=b[11];c[8]=L*h+F*g+K*x+M*E;c[9]=L*e+F*l+K*A+M*q;c[10]=L*f+F*d+K*C+M*G;c[11]=L*k+F*m+K*B+M*a;L=b[12];F=b[13];K=b[14];M=b[15];c[12]=L*h+F*g+K*x+M*E;c[13]=L*e+F*l+K*A+M*q;c[14]=L*f+F*d+K*C+M*G;c[15]=L*k+F*m+K*B+M*a;return c}function f(c,a,b){var h=a[0],e=a[1],f=a[2],k=a[3],g=h+h,l=e+e,d=f+f;a=h*g;var m=h*l,h=h*d,x=e*l,e=e*d,f=f*d,g=k*g,l=k*l,k=k*d;c[0]=1-(x+f);c[1]=m+k;c[2]=h-l;c[3]=0;c[4]=m-k;c[5]=1-(a+f);
c[6]=e+g;c[7]=0;c[8]=h+l;c[9]=e-g;c[10]=1-(a+x);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c}function e(c,a,b){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];c[4]=a[4]-b[4];c[5]=a[5]-b[5];c[6]=a[6]-b[6];c[7]=a[7]-b[7];c[8]=a[8]-b[8];c[9]=a[9]-b[9];c[10]=a[10]-b[10];c[11]=a[11]-b[11];c[12]=a[12]-b[12];c[13]=a[13]-b[13];c[14]=a[14]-b[14];c[15]=a[15]-b[15];return c}Object.defineProperty(d,"__esModule",{value:!0});d.copy=function(c,a){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];
c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};d.set=function(c,a,b,e,f,k,g,r,l,d,m,x,A,C,B,E,q){c[0]=a;c[1]=b;c[2]=e;c[3]=f;c[4]=k;c[5]=g;c[6]=r;c[7]=l;c[8]=d;c[9]=m;c[10]=x;c[11]=A;c[12]=C;c[13]=B;c[14]=E;c[15]=q;return c};d.identity=l;d.transpose=function(c,a){if(c===a){var b=a[1],e=a[2],f=a[3],k=a[6],g=a[7],r=a[11];c[1]=a[4];c[2]=a[8];c[3]=a[12];c[4]=b;c[6]=a[9];c[7]=a[13];c[8]=e;c[9]=k;c[11]=a[14];
c[12]=f;c[13]=g;c[14]=r}else c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15];return c};d.invert=function(c,a){var b=a[0],e=a[1],f=a[2],k=a[3],g=a[4],r=a[5],l=a[6],d=a[7],m=a[8],x=a[9],A=a[10],C=a[11],B=a[12],E=a[13],q=a[14];a=a[15];var G=b*r-e*g,L=b*l-f*g,F=b*d-k*g,K=e*l-f*r,M=e*d-k*r,Q=f*d-k*l,P=m*E-x*B,O=m*q-A*B,U=m*a-C*B,N=x*q-A*E,V=x*a-C*E,X=A*a-C*q,J=G*X-L*V+F*N+K*U-M*O+
Q*P;if(!J)return null;J=1/J;c[0]=(r*X-l*V+d*N)*J;c[1]=(f*V-e*X-k*N)*J;c[2]=(E*Q-q*M+a*K)*J;c[3]=(A*M-x*Q-C*K)*J;c[4]=(l*U-g*X-d*O)*J;c[5]=(b*X-f*U+k*O)*J;c[6]=(q*F-B*Q-a*L)*J;c[7]=(m*Q-A*F+C*L)*J;c[8]=(g*V-r*U+d*P)*J;c[9]=(e*U-b*V-k*P)*J;c[10]=(B*M-E*F+a*G)*J;c[11]=(x*F-m*M-C*G)*J;c[12]=(r*O-g*N-l*P)*J;c[13]=(b*N-e*O+f*P)*J;c[14]=(E*L-B*K-q*G)*J;c[15]=(m*K-x*L+A*G)*J;return c};d.adjoint=function(c,a){var b=a[0],e=a[1],f=a[2],k=a[3],g=a[4],r=a[5],l=a[6],d=a[7],m=a[8],x=a[9],A=a[10],C=a[11],B=a[12],
E=a[13],q=a[14];a=a[15];c[0]=r*(A*a-C*q)-x*(l*a-d*q)+E*(l*C-d*A);c[1]=-(e*(A*a-C*q)-x*(f*a-k*q)+E*(f*C-k*A));c[2]=e*(l*a-d*q)-r*(f*a-k*q)+E*(f*d-k*l);c[3]=-(e*(l*C-d*A)-r*(f*C-k*A)+x*(f*d-k*l));c[4]=-(g*(A*a-C*q)-m*(l*a-d*q)+B*(l*C-d*A));c[5]=b*(A*a-C*q)-m*(f*a-k*q)+B*(f*C-k*A);c[6]=-(b*(l*a-d*q)-g*(f*a-k*q)+B*(f*d-k*l));c[7]=b*(l*C-d*A)-g*(f*C-k*A)+m*(f*d-k*l);c[8]=g*(x*a-C*E)-m*(r*a-d*E)+B*(r*C-d*x);c[9]=-(b*(x*a-C*E)-m*(e*a-k*E)+B*(e*C-k*x));c[10]=b*(r*a-d*E)-g*(e*a-k*E)+B*(e*d-k*r);c[11]=-(b*
(r*C-d*x)-g*(e*C-k*x)+m*(e*d-k*r));c[12]=-(g*(x*q-A*E)-m*(r*q-l*E)+B*(r*A-l*x));c[13]=b*(x*q-A*E)-m*(e*q-f*E)+B*(e*A-f*x);c[14]=-(b*(r*q-l*E)-g*(e*q-f*E)+B*(e*l-f*r));c[15]=b*(r*A-l*x)-g*(e*A-f*x)+m*(e*l-f*r);return c};d.determinant=function(c){var a=c[0],b=c[1],e=c[2],f=c[3],k=c[4],g=c[5],r=c[6],l=c[7],d=c[8],m=c[9],x=c[10],A=c[11],C=c[12],B=c[13],E=c[14];c=c[15];return(a*g-b*k)*(x*c-A*E)-(a*r-e*k)*(m*c-A*B)+(a*l-f*k)*(m*E-x*B)+(b*r-e*g)*(d*c-A*C)-(b*l-f*g)*(d*E-x*C)+(e*l-f*r)*(d*B-m*C)};d.multiply=
b;d.translate=function(c,a,b){var h=b[0],e=b[1];b=b[2];var f=void 0,k=void 0,g=void 0,l=void 0,d=void 0,m=void 0,x=void 0,A=void 0,C=void 0,B=void 0,E=void 0,q=void 0;a===c?(c[12]=a[0]*h+a[4]*e+a[8]*b+a[12],c[13]=a[1]*h+a[5]*e+a[9]*b+a[13],c[14]=a[2]*h+a[6]*e+a[10]*b+a[14],c[15]=a[3]*h+a[7]*e+a[11]*b+a[15]):(f=a[0],k=a[1],g=a[2],l=a[3],d=a[4],m=a[5],x=a[6],A=a[7],C=a[8],B=a[9],E=a[10],q=a[11],c[0]=f,c[1]=k,c[2]=g,c[3]=l,c[4]=d,c[5]=m,c[6]=x,c[7]=A,c[8]=C,c[9]=B,c[10]=E,c[11]=q,c[12]=f*h+d*e+C*b+a[12],
c[13]=k*h+m*e+B*b+a[13],c[14]=g*h+x*e+E*b+a[14],c[15]=l*h+A*e+q*b+a[15]);return c};d.scale=function(c,a,b){var h=b[0],e=b[1];b=b[2];c[0]=a[0]*h;c[1]=a[1]*h;c[2]=a[2]*h;c[3]=a[3]*h;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};d.rotate=function(c,a,b,e){var h=e[0],f=e[1];e=e[2];var p=Math.sqrt(h*h+f*f+e*e),k=void 0,l=void 0,d=void 0,m=void 0,x=void 0,A=void 0,C=void 0,B=void 0,E=void 0,q=
void 0,G=void 0,L=void 0,F=void 0,K=void 0,M=void 0,Q=void 0,P=void 0,O=void 0,U=void 0,N=void 0,V=void 0,X=void 0,l=k=void 0;if(p<g.EPSILON)return null;p=1/p;h*=p;f*=p;e*=p;k=Math.sin(b);l=Math.cos(b);d=1-l;m=a[0];x=a[1];A=a[2];C=a[3];B=a[4];E=a[5];q=a[6];G=a[7];L=a[8];F=a[9];K=a[10];M=a[11];Q=h*h*d+l;P=f*h*d+e*k;O=e*h*d-f*k;U=h*f*d-e*k;N=f*f*d+l;V=e*f*d+h*k;X=h*e*d+f*k;k=f*e*d-h*k;l=e*e*d+l;c[0]=m*Q+B*P+L*O;c[1]=x*Q+E*P+F*O;c[2]=A*Q+q*P+K*O;c[3]=C*Q+G*P+M*O;c[4]=m*U+B*N+L*V;c[5]=x*U+E*N+F*V;c[6]=
A*U+q*N+K*V;c[7]=C*U+G*N+M*V;c[8]=m*X+B*k+L*l;c[9]=x*X+E*k+F*l;c[10]=A*X+q*k+K*l;c[11]=C*X+G*k+M*l;a!==c&&(c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);return c};d.rotateX=function(c,a,b){var e=Math.sin(b);b=Math.cos(b);var h=a[4],f=a[5],k=a[6],g=a[7],l=a[8],d=a[9],m=a[10],x=a[11];a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[4]=h*b+l*e;c[5]=f*b+d*e;c[6]=k*b+m*e;c[7]=g*b+x*e;c[8]=l*b-h*e;c[9]=d*b-f*e;c[10]=m*b-k*e;c[11]=x*b-g*e;return c};d.rotateY=
function(c,a,b){var e=Math.sin(b);b=Math.cos(b);var h=a[0],f=a[1],k=a[2],g=a[3],l=a[8],d=a[9],m=a[10],x=a[11];a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=h*b-l*e;c[1]=f*b-d*e;c[2]=k*b-m*e;c[3]=g*b-x*e;c[8]=h*e+l*b;c[9]=f*e+d*b;c[10]=k*e+m*b;c[11]=g*e+x*b;return c};d.rotateZ=function(c,a,b){var e=Math.sin(b);b=Math.cos(b);var h=a[0],f=a[1],k=a[2],g=a[3],l=a[4],d=a[5],m=a[6],x=a[7];a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],
c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=h*b+l*e;c[1]=f*b+d*e;c[2]=k*b+m*e;c[3]=g*b+x*e;c[4]=l*b-h*e;c[5]=d*b-f*e;c[6]=m*b-k*e;c[7]=x*b-g*e;return c};d.fromTranslation=function(c,a){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=a[0];c[13]=a[1];c[14]=a[2];c[15]=1;return c};d.fromScaling=function(c,a){c[0]=a[0];c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a[1];c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=a[2];c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};d.fromRotation=function(c,
a,b){var e=b[0],h=b[1];b=b[2];var f=Math.sqrt(e*e+h*h+b*b),k=void 0,r=void 0,l=void 0;if(f<g.EPSILON)return null;f=1/f;e*=f;h*=f;b*=f;k=Math.sin(a);r=Math.cos(a);l=1-r;c[0]=e*e*l+r;c[1]=h*e*l+b*k;c[2]=b*e*l-h*k;c[3]=0;c[4]=e*h*l-b*k;c[5]=h*h*l+r;c[6]=b*h*l+e*k;c[7]=0;c[8]=e*b*l+h*k;c[9]=h*b*l-e*k;c[10]=b*b*l+r;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};d.fromXRotation=function(c,a){var b=Math.sin(a);a=Math.cos(a);c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a;c[6]=b;c[7]=0;c[8]=0;c[9]=-b;c[10]=
a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};d.fromYRotation=function(c,a){var b=Math.sin(a);a=Math.cos(a);c[0]=a;c[1]=0;c[2]=-b;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=b;c[9]=0;c[10]=a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};d.fromZRotation=function(c,a){var b=Math.sin(a);a=Math.cos(a);c[0]=a;c[1]=b;c[2]=0;c[3]=0;c[4]=-b;c[5]=a;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};d.fromRotationTranslation=f;d.fromQuat2=function(c,a){var b=k,e=-a[0],
n=-a[1],g=-a[2],l=a[3],r=a[4],d=a[5],w=a[6],m=a[7],x=e*e+n*n+g*g+l*l;0<x?(b[0]=2*(r*l+m*e+d*g-w*n)/x,b[1]=2*(d*l+m*n+w*e-r*g)/x,b[2]=2*(w*l+m*g+r*n-d*e)/x):(b[0]=2*(r*l+m*e+d*g-w*n),b[1]=2*(d*l+m*n+w*e-r*g),b[2]=2*(w*l+m*g+r*n-d*e));f(c,a,b);return c};var k=q.create();d.getTranslation=function(c,a){c[0]=a[12];c[1]=a[13];c[2]=a[14];return c};d.getScaling=function(c,a){var b=a[0],e=a[1],f=a[2],k=a[4],g=a[5],r=a[6],l=a[8],d=a[9];a=a[10];c[0]=Math.sqrt(b*b+e*e+f*f);c[1]=Math.sqrt(k*k+g*g+r*r);c[2]=Math.sqrt(l*
l+d*d+a*a);return c};d.getRotation=function(c,a){var b=a[0]+a[5]+a[10],e=0;0<b?(e=2*Math.sqrt(b+1),c[3]=.25*e,c[0]=(a[6]-a[9])/e,c[1]=(a[8]-a[2])/e,c[2]=(a[1]-a[4])/e):a[0]>a[5]&&a[0]>a[10]?(e=2*Math.sqrt(1+a[0]-a[5]-a[10]),c[3]=(a[6]-a[9])/e,c[0]=.25*e,c[1]=(a[1]+a[4])/e,c[2]=(a[8]+a[2])/e):a[5]>a[10]?(e=2*Math.sqrt(1+a[5]-a[0]-a[10]),c[3]=(a[8]-a[2])/e,c[0]=(a[1]+a[4])/e,c[1]=.25*e,c[2]=(a[6]+a[9])/e):(e=2*Math.sqrt(1+a[10]-a[0]-a[5]),c[3]=(a[1]-a[4])/e,c[0]=(a[8]+a[2])/e,c[1]=(a[6]+a[9])/e,c[2]=
.25*e);return c};d.fromRotationTranslationScale=function(c,a,b,e){var h=a[0],f=a[1],p=a[2],k=a[3],g=h+h,l=f+f,m=p+p;a=h*g;var d=h*l,h=h*m,A=f*l,f=f*m,p=p*m,g=k*g,l=k*l,k=k*m,m=e[0],C=e[1];e=e[2];c[0]=(1-(A+p))*m;c[1]=(d+k)*m;c[2]=(h-l)*m;c[3]=0;c[4]=(d-k)*C;c[5]=(1-(a+p))*C;c[6]=(f+g)*C;c[7]=0;c[8]=(h+l)*e;c[9]=(f-g)*e;c[10]=(1-(a+A))*e;c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c};d.fromRotationTranslationScaleOrigin=function(c,a,b,e,f){var h=a[0],p=a[1],k=a[2],n=a[3],g=h+h,m=p+p,l=
k+k;a=h*g;var d=h*m,C=h*l,h=p*m,p=p*l,B=k*l,k=n*g,m=n*m,E=n*l,q=e[0],G=e[1],l=e[2];e=f[0];n=f[1];f=f[2];var g=(1-(h+B))*q,L=(d+E)*q,q=(C-m)*q,d=(d-E)*G,B=(1-(a+B))*G,G=(p+k)*G,C=(C+m)*l,p=(p-k)*l;a=(1-(a+h))*l;c[0]=g;c[1]=L;c[2]=q;c[3]=0;c[4]=d;c[5]=B;c[6]=G;c[7]=0;c[8]=C;c[9]=p;c[10]=a;c[11]=0;c[12]=b[0]+e-(g*e+d*n+C*f);c[13]=b[1]+n-(L*e+B*n+p*f);c[14]=b[2]+f-(q*e+G*n+a*f);c[15]=1;return c};d.fromQuat=function(c,a){var b=a[0],e=a[1],f=a[2];a=a[3];var k=b+b,g=e+e,r=f+f,b=b*k,l=e*k,e=e*g,d=f*k,m=f*
g,f=f*r,k=a*k,g=a*g;a*=r;c[0]=1-e-f;c[1]=l+a;c[2]=d-g;c[3]=0;c[4]=l-a;c[5]=1-b-f;c[6]=m+k;c[7]=0;c[8]=d+g;c[9]=m-k;c[10]=1-b-e;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};d.frustum=function(c,a,b,e,f,k,g){var h=1/(b-a),p=1/(f-e),n=1/(k-g);c[0]=2*k*h;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=2*k*p;c[6]=0;c[7]=0;c[8]=(b+a)*h;c[9]=(f+e)*p;c[10]=(g+k)*n;c[11]=-1;c[12]=0;c[13]=0;c[14]=g*k*2*n;c[15]=0;return c};d.perspective=function(c,a,b,e,f){a=1/Math.tan(a/2);var h=void 0;c[0]=a/b;c[1]=0;c[2]=0;c[3]=0;
c[4]=0;c[5]=a;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[11]=-1;c[12]=0;c[13]=0;c[15]=0;null!=f&&Infinity!==f?(h=1/(e-f),c[10]=(f+e)*h,c[14]=2*f*e*h):(c[10]=-1,c[14]=-2*e);return c};d.perspectiveFromFieldOfView=function(c,a,b,e){var h=Math.tan(a.upDegrees*Math.PI/180),f=Math.tan(a.downDegrees*Math.PI/180),p=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var k=2/(p+a),g=2/(h+f);c[0]=k;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=g;c[6]=0;c[7]=0;c[8]=-((p-a)*k*.5);c[9]=(h-f)*g*.5;c[10]=e/(b-e);c[11]=
-1;c[12]=0;c[13]=0;c[14]=e*b/(b-e);c[15]=0;return c};d.ortho=function(c,a,b,e,f,k,g){var h=1/(a-b),p=1/(e-f),n=1/(k-g);c[0]=-2*h;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=-2*p;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=2*n;c[11]=0;c[12]=(a+b)*h;c[13]=(f+e)*p;c[14]=(g+k)*n;c[15]=1;return c};d.lookAt=function(c,a,b,e){var f=void 0,h=void 0,k=void 0,p=void 0,d=void 0,w=void 0,m=void 0,x=void 0,A=void 0,C=void 0,B=a[0],E=a[1];a=a[2];k=e[0];p=e[1];e=e[2];m=b[0];x=b[1];b=b[2];if(Math.abs(B-m)<g.EPSILON&&Math.abs(E-x)<g.EPSILON&&
Math.abs(a-b)<g.EPSILON)return l(c);m=B-m;x=E-x;A=a-b;C=1/Math.sqrt(m*m+x*x+A*A);m*=C;x*=C;A*=C;f=p*A-e*x;h=e*m-k*A;k=k*x-p*m;(C=Math.sqrt(f*f+h*h+k*k))?(C=1/C,f*=C,h*=C,k*=C):k=h=f=0;p=x*k-A*h;d=A*f-m*k;w=m*h-x*f;(C=Math.sqrt(p*p+d*d+w*w))?(C=1/C,p*=C,d*=C,w*=C):w=d=p=0;c[0]=f;c[1]=p;c[2]=m;c[3]=0;c[4]=h;c[5]=d;c[6]=x;c[7]=0;c[8]=k;c[9]=w;c[10]=A;c[11]=0;c[12]=-(f*B+h*E+k*a);c[13]=-(p*B+d*E+w*a);c[14]=-(m*B+x*E+A*a);c[15]=1;return c};d.targetTo=function(c,a,b,e){var f=a[0],h=a[1];a=a[2];var k=e[0],
p=e[1],g=e[2];e=f-b[0];var l=h-b[1];b=a-b[2];var m=e*e+l*l+b*b;0<m&&(m=1/Math.sqrt(m),e*=m,l*=m,b*=m);var d=p*b-g*l,g=g*e-k*b,k=k*l-p*e,m=d*d+g*g+k*k;0<m&&(m=1/Math.sqrt(m),d*=m,g*=m,k*=m);c[0]=d;c[1]=g;c[2]=k;c[3]=0;c[4]=l*k-b*g;c[5]=b*d-e*k;c[6]=e*g-l*d;c[7]=0;c[8]=e;c[9]=l;c[10]=b;c[11]=0;c[12]=f;c[13]=h;c[14]=a;c[15]=1;return c};d.str=function(c){return"mat4("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+", "+c[6]+", "+c[7]+", "+c[8]+", "+c[9]+", "+c[10]+", "+c[11]+", "+c[12]+", "+c[13]+
", "+c[14]+", "+c[15]+")"};d.frob=function(c){return Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)+Math.pow(c[2],2)+Math.pow(c[3],2)+Math.pow(c[4],2)+Math.pow(c[5],2)+Math.pow(c[6],2)+Math.pow(c[7],2)+Math.pow(c[8],2)+Math.pow(c[9],2)+Math.pow(c[10],2)+Math.pow(c[11],2)+Math.pow(c[12],2)+Math.pow(c[13],2)+Math.pow(c[14],2)+Math.pow(c[15],2))};d.add=function(c,a,b){c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];c[4]=a[4]+b[4];c[5]=a[5]+b[5];c[6]=a[6]+b[6];c[7]=a[7]+b[7];c[8]=a[8]+b[8];c[9]=
a[9]+b[9];c[10]=a[10]+b[10];c[11]=a[11]+b[11];c[12]=a[12]+b[12];c[13]=a[13]+b[13];c[14]=a[14]+b[14];c[15]=a[15]+b[15];return c};d.subtract=e;d.multiplyScalar=function(c,a,b){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;c[4]=a[4]*b;c[5]=a[5]*b;c[6]=a[6]*b;c[7]=a[7]*b;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12]*b;c[13]=a[13]*b;c[14]=a[14]*b;c[15]=a[15]*b;return c};d.multiplyScalarAndAdd=function(c,a,b,e){c[0]=a[0]+b[0]*e;c[1]=a[1]+b[1]*e;c[2]=a[2]+b[2]*e;c[3]=a[3]+b[3]*e;c[4]=
a[4]+b[4]*e;c[5]=a[5]+b[5]*e;c[6]=a[6]+b[6]*e;c[7]=a[7]+b[7]*e;c[8]=a[8]+b[8]*e;c[9]=a[9]+b[9]*e;c[10]=a[10]+b[10]*e;c[11]=a[11]+b[11]*e;c[12]=a[12]+b[12]*e;c[13]=a[13]+b[13]*e;c[14]=a[14]+b[14]*e;c[15]=a[15]+b[15]*e;return c};d.exactEquals=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[7]===a[7]&&c[8]===a[8]&&c[9]===a[9]&&c[10]===a[10]&&c[11]===a[11]&&c[12]===a[12]&&c[13]===a[13]&&c[14]===a[14]&&c[15]===a[15]};d.equals=function(c,
a){var b=c[0],e=c[1],f=c[2],k=c[3],l=c[4],r=c[5],d=c[6],w=c[7],m=c[8],x=c[9],A=c[10],C=c[11],B=c[12],E=c[13],q=c[14];c=c[15];var G=a[0],L=a[1],F=a[2],K=a[3],M=a[4],Q=a[5],P=a[6],O=a[7],U=a[8],N=a[9],V=a[10],X=a[11],J=a[12],R=a[13],T=a[14];a=a[15];return Math.abs(b-G)<=g.EPSILON*Math.max(1,Math.abs(b),Math.abs(G))&&Math.abs(e-L)<=g.EPSILON*Math.max(1,Math.abs(e),Math.abs(L))&&Math.abs(f-F)<=g.EPSILON*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(k-K)<=g.EPSILON*Math.max(1,Math.abs(k),Math.abs(K))&&
Math.abs(l-M)<=g.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(r-Q)<=g.EPSILON*Math.max(1,Math.abs(r),Math.abs(Q))&&Math.abs(d-P)<=g.EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(w-O)<=g.EPSILON*Math.max(1,Math.abs(w),Math.abs(O))&&Math.abs(m-U)<=g.EPSILON*Math.max(1,Math.abs(m),Math.abs(U))&&Math.abs(x-N)<=g.EPSILON*Math.max(1,Math.abs(x),Math.abs(N))&&Math.abs(A-V)<=g.EPSILON*Math.max(1,Math.abs(A),Math.abs(V))&&Math.abs(C-X)<=g.EPSILON*Math.max(1,Math.abs(C),Math.abs(X))&&Math.abs(B-
J)<=g.EPSILON*Math.max(1,Math.abs(B),Math.abs(J))&&Math.abs(E-R)<=g.EPSILON*Math.max(1,Math.abs(E),Math.abs(R))&&Math.abs(q-T)<=g.EPSILON*Math.max(1,Math.abs(q),Math.abs(T))&&Math.abs(c-a)<=g.EPSILON*Math.max(1,Math.abs(c),Math.abs(a))};d.mul=b;d.sub=e})},"esri/layers/graphics/dehydratedFeatures":function(){define("require exports ../../geometry ../../Graphic ../../core/compilerUtils ../../core/lang ../../core/typedArrayUtil ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){function n(a,c,b){if(!a)return null;switch(c){case "point":return a={x:a.x,y:a.y,z:a.z,m:a.m,hasZ:null!=a.z,hasM:null!=a.m,type:"point",spatialReference:b};case "polyline":return a={paths:a.paths,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"polyline",spatialReference:b};case "polygon":return a={rings:a.rings,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"polygon",spatialReference:b};case "multipoint":return a={points:a.points,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"multipoint",spatialReference:b}}}
function u(a,c,b,e){return{x:a,y:c,z:b,hasZ:null!=b,hasM:!1,spatialReference:e,type:"point"}}function v(a){return"declaredClass"in a}function r(a){return"declaredClass"in a}function y(a){if(!a)return 0;switch(a.type){case "point":return 1;case "polyline":var c=0,b=0;for(a=a.paths;b<a.length;b++)c+=a[b].length;return c;case "polygon":b=c=0;for(a=a.rings;b<a.length;b++)c+=a[b].length;return c;case "multipoint":return a.points.length;case "extent":return 2;case "mesh":return(c=a.vertexAttributes&&a.vertexAttributes.position)?
c.length/3:0;default:l.neverReached(a)}}function w(a){var c=a.spatialReference.toJSON();switch(a.type){case "point":return{x:a.x,y:a.y,z:a.z,m:a.m,spatialReference:c};case "polygon":var b=a.hasZ,e=a.hasM;return{rings:m(a.rings),hasZ:b,hasM:e,spatialReference:c};case "polyline":var f=a.paths,b=a.hasZ,e=a.hasM;return{paths:m(f),hasZ:b,hasM:e,spatialReference:c};case "extent":var f=a.xmin,h=a.xmax,k=a.ymin,p=a.ymax,n=a.zmin,g=a.zmax,r=a.mmin,u=a.mmax,b=a.hasZ,e=a.hasM;return{xmin:f,xmax:h,ymin:k,ymax:p,
zmin:n,zmax:g,mmin:r,mmax:u,hasZ:b,hasM:e,spatialReference:c};case "multipoint":return f=a.points,b=a.hasZ,e=a.hasM,{points:C(f)?x(f):f,hasZ:b,hasM:e,spatialReference:c};default:l.neverReached(a)}}function m(a){return A(a)?a.map(function(a){return x(a)}):a}function x(a){return a.map(function(a){return f.toArray(a)})}function A(a){for(var c=0;c<a.length;c++){var b=a[c];if(0!==b.length)return C(b)}return!1}function C(a){return a.length&&(f.isFloat32Array(a[0])||f.isFloat64Array(a[0]))}function B(a,
c){k.empty(c);"mesh"===a.type&&(a=a.extent);switch(a.type){case "point":c[0]=c[3]=a.x;c[1]=c[4]=a.y;a.hasZ&&(c[2]=c[5]=a.z);break;case "polyline":for(var b=0;b<a.paths.length;b++)k.expandWithNestedArray(c,a.paths[b],a.hasZ);break;case "polygon":for(b=0;b<a.rings.length;b++)k.expandWithNestedArray(c,a.rings[b],a.hasZ);break;case "multipoint":k.expandWithNestedArray(c,a.points,a.hasZ);break;case "extent":c[0]=a.xmin;c[1]=a.ymin;c[3]=a.xmax;c[4]=a.ymax;null!=a.zmin&&(c[2]=a.zmin);null!=a.zmax&&(c[5]=
a.zmax);break;default:l.neverReached(a)}}function E(a,b){c.empty(b);"mesh"===a.type&&(a=a.extent);switch(a.type){case "point":b[0]=b[2]=a.x;b[1]=b[3]=a.y;break;case "polyline":for(var e=0;e<a.paths.length;e++)c.expandWithNestedArray(b,a.paths[e]);break;case "polygon":for(e=0;e<a.rings.length;e++)c.expandWithNestedArray(b,a.rings[e]);break;case "multipoint":c.expandWithNestedArray(b,a.points);break;case "extent":b[0]=a.xmin;b[1]=a.ymin;b[2]=a.xmax;b[3]=a.ymax;break;default:l.neverReached(a)}}Object.defineProperty(d,
"__esModule",{value:!0});d.equals=p.equals;d.isFeatureGeometry=function(a){return q.isFeatureGeometryType(a.type)};d.isPoint=function(a){return"point"===a.type};d.fromFeatureSetJSON=function(c){var b=q.featureGeometryTypeKebabDictionary.fromJSON(c.geometryType),f=e.fromJSON(c.spatialReference),k=c.transform,p=c.features.map(function(e){var h=c.objectIdFieldName;e={uid:g.generateUID(),objectId:h&&e.attributes?e.attributes[h]:null,attributes:e.attributes,geometry:n(e.geometry,b,f),visible:!0};if((h=
e.geometry)&&k)switch(h.type){case "point":e.geometry=a.hydratePoint(k,h,h,h.hasZ,h.hasM);break;case "multipoint":e.geometry=a.hydrateMultipoint(k,h,h,h.hasZ,h.hasM);break;case "polygon":e.geometry=a.hydratePolygon(k,h,h,h.hasZ,h.hasM);break;case "polyline":e.geometry=a.hydratePolyline(k,h,h,h.hasZ,h.hasM);break;default:l.neverReached(h)}return e});return{geometryType:b,features:p,spatialReference:f,fields:c.fields?c.fields.map(function(a){return h.fromJSON(a)}):null,objectIdFieldName:c.objectIdFieldName,
globalIdFieldName:c.globalIdFieldName,geohashFieldName:c.geohashFieldName,geometryProperties:c.geometryProperties,hasZ:c.hasZ,hasM:c.hasM,exceededTransferLimit:c.exceededTransferLimit,transform:null}};d.fromJSONGeometry=n;d.makeDehydratedPoint=u;d.isHydratedGeometry=function(a){return"declaredClass"in a};d.isHydratedPoint=v;d.isHydratedGraphic=r;d.hydrateGraphic=function(a,c){if(!a||r(a))return a;c=new g({layer:c,sourceLayer:c});c.visible=a.visible;c.symbol=b.clone(a.symbol);c.attributes=b.clone(a.attributes);
a.geometry&&("mesh"===a.geometry.type?c.geometry=a.geometry:c.read({geometry:w(a.geometry)}));return c};d.clonePoint=function(a,c){if(!a)return null;if(v(a)){if(null==c)return a.clone();if(v(c))return c.copy(a)}null!=c?(c.x=a.x,c.y=a.y,c.spatialReference=a.spatialReference,a.hasZ?(c.z=a.z,c.hasZ=a.hasZ):(c.z=null,c.hasZ=!1),a.hasM?(c.m=a.m,c.hasM=!0):(c.m=null,c.hasM=!1)):(c=u(a.x,a.y,a.z,a.spatialReference),a.hasM&&(c.m=a.m,c.hasM=!0));return c};d.estimateSize=function(a){for(var c=32,b=0,e=Object.keys(a.attributes);b<
e.length;b++){var f=e[b],c=c+f.length,f=a.attributes[f];switch(typeof f){case "string":c+=f.length;break;default:case "number":c+=8}}a=a.geometry?"mesh"===a.geometry.type?0:y(a.geometry):0;return c+12*a};d.numVertices=y;d.hasVertices=function(a){if(!a)return!1;switch(a.type){case "extent":case "point":return!0;case "polyline":var c=0;for(a=a.paths;c<a.length;c++)if(0<a[c].length)return!0;return!1;case "polygon":c=0;for(a=a.rings;c<a.length;c++)if(0<a[c].length)return!0;return!1;case "multipoint":return 0<
a.points.length;case "mesh":return a.vertexAttributes&&a.vertexAttributes.position&&0<a.vertexAttributes.position.length;default:l.neverReached(a)}};d.computeAABB=B;d.expandAABB=function(a,c){B(a,I);k.expand(c,I)};d.computeAABR=E;d.expandAABR=function(a,b){E(a,G);c.expand(b,G)};var I=k.create(),G=c.create()})},"esri/geometry/support/aaBoundingBox":function(){define(["require","exports","../Extent","./aaBoundingRect"],function(t,d,q,g){function l(a){void 0===a&&(a=d.ZERO);return[a[0],a[1],a[2],a[3],
a[4],a[5]]}function b(a,c,b,e,f,h,k){void 0===k&&(k=l());k[0]=a;k[1]=c;k[2]=b;k[3]=e;k[4]=f;k[5]=h;return k}function f(a){return a[0]>=a[3]?0:a[3]-a[0]}function e(a){return a[1]>=a[4]?0:a[4]-a[1]}function k(a){return a[2]>=a[5]?0:a[5]-a[2]}function c(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];return a}function a(a){return 6===a.length}Object.defineProperty(d,"__esModule",{value:!0});d.create=l;d.fromValues=b;d.fromExtent=function(a,c){void 0===c&&(c=l());c[0]=a.xmin;c[1]=a.ymin;
c[2]=a.zmin;c[3]=a.xmax;c[4]=a.ymax;c[5]=a.zmax;return c};d.toExtent=function(a,c){return isFinite(a[2])||isFinite(a[5])?new q({xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],zmin:a[2],zmax:a[5],spatialReference:c}):new q({xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],spatialReference:c})};d.fromMinMax=function(a,c,b){void 0===b&&(b=l());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=c[0];b[4]=c[1];b[5]=c[2];return b};d.expandPointInPlace=function(a,c){c[0]<a[0]&&(a[0]=c[0]);c[0]>a[3]&&(a[3]=c[0]);c[1]<a[1]&&(a[1]=c[1]);
c[1]>a[4]&&(a[4]=c[1]);c[2]<a[2]&&(a[2]=c[2]);c[2]>a[5]&&(a[5]=c[2])};d.expand=function(c,b,e){void 0===e&&(e=c);a(b)?(e[0]=Math.min(c[0],b[0]),e[1]=Math.min(c[1],b[1]),e[2]=Math.min(c[2],b[2]),e[3]=Math.max(c[3],b[3]),e[4]=Math.max(c[4],b[4]),e[5]=Math.max(c[5],b[5])):g.is(b)?(e[0]=Math.min(c[0],b[0]),e[1]=Math.min(c[1],b[1]),e[3]=Math.max(c[3],b[2]),e[4]=Math.max(c[4],b[3])):2===b.length?(e[0]=Math.min(c[0],b[0]),e[1]=Math.min(c[1],b[1]),e[3]=Math.max(c[3],b[0]),e[4]=Math.max(c[4],b[1])):3===b.length&&
(e[0]=Math.min(c[0],b[0]),e[1]=Math.min(c[1],b[1]),e[2]=Math.min(c[2],b[2]),e[3]=Math.max(c[3],b[0]),e[4]=Math.max(c[4],b[1]),e[5]=Math.max(c[5],b[2]));return e};d.expandWithBuffer=function(a,c,b,e,f){void 0===f&&(f=a);var h=a[0],k=a[1],m=a[2],p=a[3],n=a[4];a=a[5];for(var g=0;g<e;g++)h=Math.min(h,c[b+3*g]),k=Math.min(k,c[b+3*g+1]),m=Math.min(m,c[b+3*g+2]),p=Math.max(p,c[b+3*g]),n=Math.max(n,c[b+3*g+1]),a=Math.max(a,c[b+3*g+2]);f[0]=h;f[1]=k;f[2]=m;f[3]=p;f[4]=n;f[5]=a;return f};d.expandWithNestedArray=
function(a,c,b,e){void 0===e&&(e=a);var f=c.length,h=a[0],k=a[1],m=a[2],p=a[3],n=a[4];a=a[5];if(b)for(b=0;b<f;b++){var g=c[b],h=Math.min(h,g[0]),k=Math.min(k,g[1]),m=Math.min(m,g[2]),p=Math.max(p,g[0]),n=Math.max(n,g[1]);a=Math.max(a,g[2])}else for(b=0;b<f;b++)g=c[b],h=Math.min(h,g[0]),k=Math.min(k,g[1]),p=Math.max(p,g[0]),n=Math.max(n,g[1]);e[0]=h;e[1]=k;e[2]=m;e[3]=p;e[4]=n;e[5]=a;return e};d.allFinite=function(a){for(var c=0;6>c;c++)if(!isFinite(a[c]))return!1;return!0};d.width=f;d.depth=e;d.height=
k;d.diameter=function(a){var c=f(a),b=k(a);a=e(a);return Math.sqrt(c*c+b*b+a*a)};d.center=function(a,c){void 0===c&&(c=[0,0,0]);c[0]=a[0]+f(a)/2;c[1]=a[1]+e(a)/2;c[2]=a[2]+k(a)/2;return c};d.size=function(a,c){void 0===c&&(c=[0,0,0]);c[0]=f(a);c[1]=e(a);c[2]=k(a);return c};d.maximumDimension=function(a){return Math.max(f(a),k(a),e(a))};d.containsPoint=function(a,c){return c[0]>=a[0]&&c[1]>=a[1]&&c[2]>=a[2]&&c[0]<=a[3]&&c[1]<=a[4]&&c[2]<=a[5]};d.containsPointWithMargin=function(a,c,b){return c[0]>=
a[0]-b&&c[1]>=a[1]-b&&c[2]>=a[2]-b&&c[0]<=a[3]+b&&c[1]<=a[4]+b&&c[2]<=a[5]+b};d.contains=function(a,c){return c[0]>=a[0]&&c[1]>=a[1]&&c[2]>=a[2]&&c[3]<=a[3]&&c[4]<=a[4]&&c[5]<=a[5]};d.intersects=function(a,c){return Math.max(c[0],a[0])<=Math.min(c[3],a[3])&&Math.max(c[1],a[1])<=Math.min(c[4],a[4])&&Math.max(c[2],a[2])<=Math.min(c[5],a[5])};d.offset=function(a,c,b,e,f){void 0===f&&(f=a);f[0]=a[0]+c;f[1]=a[1]+b;f[2]=a[2]+e;f[3]=a[3]+c;f[4]=a[4]+b;f[5]=a[5]+e;return f};d.setMin=function(a,c,b){void 0===
b&&(b=a);b[0]=c[0];b[1]=c[1];b[2]=c[2];b!==a&&(b[3]=a[3],b[4]=a[4],b[5]=a[5]);return b};d.setMax=function(a,c,b){void 0===b&&(b=a);b[3]=c[0];b[4]=c[1];b[5]=c[2];b!==a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return a};d.set=c;d.empty=function(a){return a?c(a,d.NEGATIVE_INFINITY):l(d.NEGATIVE_INFINITY)};d.toRect=function(a,c){c||(c=g.create());c[0]=a[0];c[1]=a[1];c[2]=a[3];c[3]=a[4];return c};d.fromRect=function(a,c){a[0]=c[0];a[1]=c[1];a[3]=c[2];a[4]=c[3];return a};d.is=a;d.isPoint=function(a){return 0===
f(a)&&0===e(a)&&0===k(a)};d.equals=function(c,b,e){if(null==c||null==b)return c===b;if(!a(c)||!a(b))return!1;if(e)for(var f=0;f<c.length;f++){if(!e(c[f],b[f]))return!1}else for(f=0;f<c.length;f++)if(c[f]!==b[f])return!1;return!0};d.wrap=function(a,c,e,f,k,g){return b(a,c,e,f,k,g,h)};d.POSITIVE_INFINITY=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];d.NEGATIVE_INFINITY=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity];d.ZERO=[0,0,0,0,0,0];var h=l()})},"esri/geometry/support/quantizationUtils":function(){define(["require",
"exports","./jsonUtils"],function(t,d,q){function g(a,c){return Math.round((c-a.translate[0])/a.scale[0])}function l(a,c){return Math.round((a.translate[1]-c)/a.scale[1])}function b(a,c,b){for(var e=[],f,h,k,m,p=0;p<b.length;p++){var n=b[p];if(0<p){if(k=g(a,n[0]),m=l(a,n[1]),k!==f||m!==h)e.push(c(n,k-f,m-h)),f=k,h=m}else f=g(a,n[0]),h=l(a,n[1]),e.push(c(n,f,h))}return 0<e.length?e:null}function f(a,c,e,f){return b(a,e?f?I:E:f?E:B,c)}function e(a,c,e,f){var h=[];e=e?f?I:E:f?E:B;for(f=0;f<c.length;f++){var k=
b(a,e,c[f]);k&&3<=k.length&&h.push(k)}return h.length?h:null}function k(a,c,e,f){var h=[];e=e?f?I:E:f?E:B;for(f=0;f<c.length;f++){var k=b(a,e,c[f]);k&&2<=k.length&&h.push(k)}return h.length?h:null}function c(a,c){return c*a.scale[0]+a.translate[0]}function a(a,c){return a.translate[1]-c*a.scale[1]}function h(b,e,f){var h=Array(f.length);if(!f.length)return h;var k=b.scale,m=k[0],k=k[1],g=c(b,f[0][0]);b=a(b,f[0][1]);h[0]=e(f[0],g,b);for(var p=1;p<f.length;p++){var n=f[p],g=g+n[0]*m;b-=n[1]*k;h[p]=
e(n,g,b)}return h}function p(a,c,b){for(var e=Array(b.length),f=0;f<b.length;f++)e[f]=h(a,c,b[f]);return e}function n(a,c,b,e){return h(a,b?e?I:E:e?E:B,c)}function u(a,c,b,e){return p(a,b?e?I:E:e?E:B,c)}function v(a,c,b,e){return p(a,b?e?I:E:e?E:B,c)}function r(a,c,b){var e=b[0],f=e[0],e=e[1],h=Math.min(f,c[0]),k=Math.min(e,c[1]),m=Math.max(f,c[2]);c=Math.max(e,c[3]);for(var g=1;g<b.length;g++){var p=b[g],n=p[0],p=p[1],f=f+n,e=e+p;0>n&&(h=Math.min(h,f));0<n&&(m=Math.max(m,f));0>p?k=Math.min(k,e):
0<p&&(c=Math.max(c,e))}a[0]=h;a[1]=k;a[2]=m;a[3]=c;return a}function y(a,c){if(!c.length)return null;a[0]=a[1]=Number.POSITIVE_INFINITY;a[2]=a[3]=Number.NEGATIVE_INFINITY;for(var b=0;b<c.length;b++)r(a,a,c[b]);return a}function w(a,c,b,e,f){c.xmin=g(a,b.xmin);c.ymin=l(a,b.ymin);c.xmax=g(a,b.xmax);c.ymax=l(a,b.ymax);c!==b&&(e&&(c.zmin=b.zmin,c.zmax=b.zmax),f&&(c.mmin=b.mmin,c.mmax=b.mmax));return c}function m(a,c,b,e,h){c.points=f(a,b.points,e,h);return c}function x(a,c,b,e,f){c.x=g(a,b.x);c.y=l(a,
b.y);c!==b&&(e&&(c.z=b.z),f&&(c.m=b.m));return c}function A(a,c,b,f,h){a=e(a,b.rings,f,h);if(!a)return null;c.rings=a;return c}function C(a,c,b,e,f){a=k(a,b.paths,e,f);if(!a)return null;c.paths=a;return c}Object.defineProperty(d,"__esModule",{value:!0});var B=function(a,c,b){return[c,b]},E=function(a,c,b){return[c,b,a[2]]},I=function(a,c,b){return[c,b,a[2],a[3]]};d.toQuantizationTransform=function(a){return a?{originPosition:"upperLeft",scale:[a.tolerance,a.tolerance],translate:[a.extent.xmin,a.extent.ymax]}:
null};d.equals=function(a,c){if(a===c||null==a&&null==c)return!0;if(null==a||null==c)return!1;var b,e,f,h;a&&"upperLeft"===a.originPosition?(b=a.translate[0],e=a.translate[1],a=a.scale[0]):(b=a.extent.xmin,e=a.extent.ymax,a=a.tolerance);c&&"upperLeft"===c.originPosition?(f=c.translate[0],h=c.translate[1],c=c.scale[0]):(f=c.extent.xmin,h=c.extent.ymax,c=c.tolerance);return b===f&&e===h&&a===c};d.quantizeX=g;d.quantizeY=l;d.quantizeBounds=function(a,c,b){c[0]=g(a,b[0]);c[3]=l(a,b[1]);c[2]=g(a,b[2]);
c[1]=l(a,b[3]);return c};d.quantizePoints=f;d.quantizeRings=e;d.quantizePaths=k;d.hydrateX=c;d.hydrateY=a;d.hydrateCoordsArray=h;d.hydrateCoordsArrayArray=p;d.hydrateBounds=function(b,e,f){return f?(e[0]=c(b,f[0]),e[1]=a(b,f[3]),e[2]=c(b,f[2]),e[3]=a(b,f[1]),e):[c(b,e[0]),a(b,e[3]),c(b,e[2]),a(b,e[1])]};d.hydratePoints=n;d.hydratePaths=u;d.hydrateRings=v;d.getQuantizedBoundsCoordsArray=r;d.getQuantizedBoundsCoordsArrayArray=y;d.getQuantizedBoundsPoints=function(a){var c=[Number.POSITIVE_INFINITY,
Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return r(c,c,a)};d.getQuantizedBoundsPaths=function(a){return y([0,0,0,0],a)};d.getQuantizedBoundsRings=function(a){return y([0,0,0,0],a)};d.quantizeExtent=w;d.quantizeMultipoint=m;d.quantizePoint=x;d.quantizePolygon=A;d.quantizePolyline=C;d.quantizeGeometry=function(a,c){return a&&c?q.isPoint(c)?x(a,{},c,!1,!1):q.isPolyline(c)?C(a,{},c,!1,!1):q.isPolygon(c)?A(a,{},c,!1,!1):q.isMultipoint(c)?m(a,{},c,!1,!1):q.isExtent(c)?
w(a,{},c,!1,!1):null:null};d.hydrateExtent=function(b,e,f,h,k){e.xmin=c(b,f.xmin);e.ymin=a(b,f.ymin);e.xmax=c(b,f.xmax);e.ymax=a(b,f.ymax);e!==f&&(h&&(e.zmin=f.zmin,e.zmax=f.zmax),k&&(e.mmin=f.mmin,e.mmax=f.mmax));return e};d.hydrateMultipoint=function(a,c,b,e,f){c.points=n(a,b.points,e,f);return c};d.hydratePoint=function(b,e,f,h,k){e.x=c(b,f.x);e.y=a(b,f.y);e!==f&&(h&&(e.z=f.z),k&&(e.m=f.m));return e};d.hydratePolygon=function(a,c,b,e,f){c.rings=v(a,b.rings,e,f);return c};d.hydratePolyline=function(a,
c,b,e,f){c.paths=u(a,b.paths,e,f);return c}})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["require","exports","../../core/compilerUtils"],function(t,d,q){function g(b,c){if(b===c)return!0;if(null==b||null==c||b.length!==c.length)return!1;for(var a=0;a<b.length;a++){var e=b[a],f=c[a];if(e.length!==f.length)return!1;for(var k=0;k<e.length;k++)if(e[k]!==f[k])return!1}return!0}function l(b,c){if(b===c)return!0;if(null==b||null==c||b.length!==c.length)return!1;for(var a=0;a<
b.length;a++)if(!g(b[a],c[a]))return!1;return!0}function b(b,c){return b===c||b&&c&&b.equals(c)}function f(e,c){if(e===c)return!0;if(!e||!c||e.type!==c.type)return!1;switch(e.type){case "point":return e=b(e.spatialReference,c.spatialReference)?e.x===c.x&&e.y===c.y&&e.z===c.z&&e.m===c.m:!1,e;case "extent":return e=e.hasZ!==c.hasZ||e.hasM!==c.hasM?!1:b(e.spatialReference,c.spatialReference)?e.xmin===c.xmin&&e.ymin===c.ymin&&e.zmin===c.zmin&&e.xmax===c.xmax&&e.ymax===c.ymax&&e.zmax===c.zmax:!1,e;case "polyline":return e=
e.hasZ!==c.hasZ||e.hasM!==c.hasM?!1:b(e.spatialReference,c.spatialReference)?l(e.paths,c.paths):!1,e;case "polygon":return e=e.hasZ!==c.hasZ||e.hasM!==c.hasM?!1:b(e.spatialReference,c.spatialReference)?l(e.rings,c.rings):!1,e;case "multipoint":return e=e.hasZ!==c.hasZ||e.hasM!==c.hasM?!1:b(e.spatialReference,c.spatialReference)?g(e.points,c.points):!1,e;case "mesh":return!1;default:q.neverReached(e)}}function e(b,c){if(b===c)return!0;if(!b||!c)return!1;var a=Object.keys(b),e=Object.keys(c);if(a.length!==
e.length)return!1;for(e=0;e<a.length;e++){var f=a[e];if(b[f]!==c[f])return!1}return!0}Object.defineProperty(d,"__esModule",{value:!0});d.equals=function(b,c){return b===c?!0:null!=b&&null!=c&&b.objectId===c.objectId&&f(b.geometry,c.geometry)&&e(b.attributes,c.attributes)?!0:!1}})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./mathUtils".split(" "),
function(t,d,q,g,l,b,f,e){function k(a,c,b,f){var h,k;a instanceof l&&c instanceof l&&(b=c.longitude,f=c.latitude,k=a.latitude,h=a.longitude);a=e.deg2rad(k);f=e.deg2rad(f);h=e.deg2rad(h);c=e.deg2rad(b);b=Math.sin((a-f)/2);h=Math.sin((h-c)/2);b=2*e.asin(Math.sqrt(b*b+Math.cos(a)*Math.cos(f)*h*h))*d.earthRadius;return Math.round(1E4*b)/1E4}function c(a,c,b){a=b/d.earthRadius;c=e.deg2rad(c);a=Math.sin(a/2);c=Math.cos(c);c=2*e.asin(Math.sqrt(a*a/(c*c)));return e.rad2deg(c)}function a(a,c,b){return e.rad2deg(b/
d.earthRadius)}function h(a,c){a/=15;c||(a=Math.round(a));return a}Object.defineProperty(d,"__esModule",{value:!0});d.earthRadius=q.wgs84Radius;d.halfEarthCircumference=Math.PI*d.earthRadius;d.earthCircumference=2*d.halfEarthCircumference;d.metersPerDegree=d.halfEarthCircumference/180;var p=new l(0,0,b.WGS84);d.getGreatCircleDistance=k;d.getGreatCircleSpanAt=function(a,c,b){var e=c.spatialReference,f=new l(c.x,a.y,e),h=new l(b.x,a.y,e);c=new l(a.x,c.y,e);a=new l(a.x,b.y,e);return{lon:k(f,h),lat:k(c,
a)}};d.getLonDeltaForDistance=c;d.getLatDeltaForDistance=a;d.getLatLonDeltaForDistance=function(b,e,f){return{lat:a(b,e,f),lon:c(b,e,f)}};d.getMaxCameraAltitude=function(a){a=e.deg2rad(a/2);return(1-Math.sin(a))*d.earthRadius/Math.sin(a)};d.getViewExtentDistance=function(a,c){c=e.deg2rad(c/2);return 2*e.acos((Math.pow(a+d.earthRadius,2)+Math.pow(d.earthRadius,2)-Math.pow((a+d.earthRadius)*Math.cos(c)-Math.sqrt(Math.pow(Math.cos(c)*(a+d.earthRadius),2)-a*a-2*a*d.earthRadius),2))/(2*(a+d.earthRadius)*
d.earthRadius))*d.earthRadius};d.computeCarthesianDistance=function(a,c){function b(a){var c=e.deg2rad(a.latitude),b=e.deg2rad(a.longitude),f=Math.cos(c);a=d.earthRadius+(a.z||0);return[Math.cos(b)*f*a,Math.sin(c)*a,-Math.sin(b)*f*a]}a=b(a);c=b(c);c=[c[0]-a[0],c[1]-a[1],c[2]-a[2]];return Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2])};d.longitudeToTimezone=h;d.positionToTimezone=function(a,c){a.spatialReference.wkid!==b.WGS84.wkid?f.webMercatorToGeographic(a,!1,p):(p.x=a.x,p.y=a.y);p.z=a.z;c||(c={hours:0,
minutes:0,seconds:0});c.hours=h(p.x,!0);a=c.hours%1;c.hours-=a;c.minutes=60*a;a=c.minutes%1;c.minutes-=a;c.seconds=Math.round(60*a);return c};d.distanceToIdealHorizon=function(a,c){c=c||d.earthRadius;a=g.vec3.dot(a,a);return Math.sqrt(Math.abs(a-c*c))}})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});(function(d){d.length=function(g,l){var b=g[l],f=g[l+1];g=g[l+2];return Math.sqrt(b*b+f*f+g*
g)};d.normalize=function(g,l){var b=g[l],f=g[l+1],e=g[l+2],b=1/Math.sqrt(b*b+f*f+e*e);g[l]*=b;g[l+1]*=b;g[l+2]*=b};d.scale=function(g,l,b){g[l]*=b;g[l+1]*=b;g[l+2]*=b};d.add=function(g,l,b,f,e,k){void 0===k&&(k=l);e=e||g;e[k]=g[l]+b[f];e[k+1]=g[l+1]+b[f+1];e[k+2]=g[l+2]+b[f+2]};d.subtract=function(g,l,b,f,e,k){void 0===k&&(k=l);e=e||g;e[k]=g[l]-b[f];e[k+1]=g[l+1]-b[f+1];e[k+2]=g[l+2]-b[f+2]}})(d.Vec3Compact||(d.Vec3Compact={}))})},"esri/views/PopupView":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/generatorHelper ../core/Accessor ../core/arrayUtils ../core/asyncUtils ../core/maybe ../core/Promise ../core/promiseUtils ../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n){return function(e){function h(){return null!==e&&e.apply(this,arguments)||this}g(h,e);h.prototype.when=function(a,c){return this.inherited(arguments)};h.prototype.fetchPopupFeatures=function(a,b){return c.safeCast(this._fetchPopupFeaturesAsync(a,b))};h.prototype._fetchPopupFeaturesAsync=function(a,c){return b(this,void 0,void 0,function(){var b,e,h,g,n,r;return f(this,function(f){switch(f.label){case 0:return[4,this.when()];case 1:return f.sent(),[4,this._prepareFetchPopupFeatures(a,
c)];case 2:return b=f.sent(),e=b.location,h=this._queryLayerPopupFeatures(b,c),g=p.resolve(b.clientOnlyGraphics),n=[g].concat(h),r=p.eachAlwaysValues(n).then(k.flatten),[2,{promise:r,location:e,promises:n}]}})})};h.prototype._queryLayerPopupFeatures=function(c,b){var e=c.queryArea;return c.layerViewsAndGraphics.map(function(c){var f=c.layerView;c={clientGraphics:c.graphics,defaultPopupTemplateEnabled:a.isSome(b)?!!b.defaultPopupTemplateEnabled:!1};return f.fetchPopupFeatures(e,c)})};h.prototype._isValidPopupGraphic=
function(c,b){return c&&!!c.getEffectivePopupTemplate(a.isSome(b)&&b.defaultPopupTemplateEnabled)};h.prototype._prepareFetchPopupFeatures=function(a,c){return b(this,void 0,void 0,function(){var b,e,h,k,g,p,n,r;return f(this,function(f){switch(f.label){case 0:return[4,this._popupHitTestGraphics(a,c)];case 1:return b=f.sent(),e=b.clientGraphics,h=b.queryArea,k=b.location,g=this._getFetchPopupLayerViews(),p=this._graphicsPerFetchPopupLayerView(e,g),n=p.layerViewsAndGraphics,r=p.clientOnlyGraphics,[2,
{clientOnlyGraphics:r,layerViewsAndGraphics:n,queryArea:h,location:k}]}})})};h.prototype._popupHitTestGraphics=function(a,c){return b(this,void 0,void 0,function(){var b,e,h,k,g,p,n=this;return f(this,function(f){switch(f.label){case 0:return[4,this.popupHitTest(a)];case 1:return b=f.sent(),e=b.results,h=b.mapPoint,k=e.filter(function(a){return n._isValidPopupGraphic(a.graphic,c)}),g=k.length?k[0].mapPoint:null,p=k.map(function(a){return a.graphic}),[2,{clientGraphics:p,queryArea:h,location:h||g}]}})})};
h.prototype._getFetchPopupLayerViews=function(){var a=this,c=[];this.allLayerViews.forEach(function(b){a._isValidPopupLayerView(b)&&c.push(b)});this._isValidPopupLayerView(this.graphicsView)&&c.push(this.graphicsView);return c.reverse()};h.prototype._isValidPopupLayerView=function(c){return a.isSome(c)&&(!("layer"in c)||!c.suspended)&&"function"===typeof c.fetchPopupFeatures};h.prototype._graphicsPerFetchPopupLayerView=function(a,c){var b=[],e=new Map;c=c.map(function(a){var c=[];"layer"in a?e.set(a.layer,
c):e.set(a.graphics,c);return{layerView:a,graphics:c}});for(var f=0;f<a.length;f++){var h=a[f],k=e.get(h.layer)||null;k?k.push(h):b.push(h)}return{layerViewsAndGraphics:c,clientOnlyGraphics:b}};return h=l([n.subclass("esri.views.PopupView")],h)}(n.declared(e,h))})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(t,d,q,g,l,b,f,e,k,c){Object.defineProperty(d,"__esModule",{value:!0});t=function(a){function h(){var b=null!==a&&a.apply(this,arguments)||this;b.tilt=new c.default;b.altitude=new f.default;b.clipDistance=new e.default;b.collision=new k.default;return b}q(h,a);g([b.property({type:c.default})],h.prototype,"tilt",void 0);g([b.property({type:f.default})],h.prototype,"altitude",void 0);g([b.property({type:e.default})],h.prototype,"clipDistance",void 0);g([b.property({type:k.default})],h.prototype,
"collision",void 0);return h=g([b.subclass("esri.views.3d.constraints.Constraints")],h)}(b.declared(l));d.Constraints=t;d.default=t})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function c(){var a=
null!==b&&b.apply(this,arguments)||this;a.min=e.AltitudeDefault.min;a.max=e.AltitudeDefault.max;return a}q(c,b);Object.defineProperty(c.prototype,"mode",{get:function(){l.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.","","4.6");return"manual"},set:function(a){l.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
"","4.6")},enumerable:!0,configurable:!0});g([f.property({type:Number})],c.prototype,"min",void 0);g([f.property({type:Number})],c.prototype,"max",void 0);return c=g([f.subclass("esri.views.3d.constraints.AltitudeConstraint")],c)}(f.declared(b));d.AltitudeConstraint=t;d.default=t})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,"__esModule",{value:!0});var c=b.getLogger("esri.views.3d.state.Constraints");t=function(b){function e(a){a=b.call(this)||this;a.collision=new h;a.distance=Infinity;a.minimumPoiDistance=4;return a}q(e,b);Object.defineProperty(e.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(a){"local"===this.mode?c.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",a)},enumerable:!0,
configurable:!0});e.prototype.clampAltitude=function(a){return this.altitude?k.clamp(a,this.altitude.min,this.altitude.max):a};e.prototype.clampTilt=function(a,c){if(!this.tilt)return c;a=this.tilt(a);return k.clamp(c,a.min,a.max)};e.prototype.clampDistance=function(a){return Math.min(a,this.distance)};e.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};e.prototype.createConstantMaxTilt=function(c){return function(b,e){void 0===
e&&(e=a);e.min=d.TiltDefault.min;e.max=c;return e}};e.prototype.createDefaultTiltLocal=function(){var c=this.collision.enabled?k.makePiecewiseLinearFunction([[4E3,d.TiltDefault.max],[1E4,k.deg2rad(88)],[6E6,k.deg2rad(88)]]):function(){return d.TiltDefault.max};return function(b,e){void 0===e&&(e=a);e.min=d.TiltDefault.min;e.max=c(b);return e}};e.prototype.createDefaultTiltGlobal=function(){var c=this.collision.enabled?k.makePiecewiseLinearFunction([[4E3,d.TiltDefault.max],[5E4,k.deg2rad(88)],[6E6,
k.deg2rad(88)],[2E7,d.TiltDefault.min]]):k.makePiecewiseLinearFunction([[3E5,d.TiltDefault.max],[3E6,k.deg2rad(88)],[6E6,k.deg2rad(88)],[2E7,d.TiltDefault.min]]);return function(b,e){void 0===e&&(e=a);e.min=d.TiltDefault.min;e.max=c(b);return e}};g([f.property()],e.prototype,"altitude",null);g([f.property({readOnly:!0})],e.prototype,"collision",void 0);g([f.property()],e.prototype,"distance",void 0);g([f.property({readOnly:!0})],e.prototype,"minimumPoiDistance",void 0);g([f.property()],e.prototype,
"tilt",void 0);g([f.property({constructOnly:!0})],e.prototype,"mode",void 0);return e=g([f.subclass("esri.views.3d.state.Constraints")],e)}(f.declared(l));d.Constraints=t;d.AltitudeDefault={min:-2E5,max:4*e.earthRadius};d.TiltDefault={min:k.deg2rad(.5),max:k.deg2rad(179.5)};var a={min:0,max:0},h=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.enabled=!0;c.elevationMargin=5;return c}q(c,a);g([f.property({type:Boolean})],c.prototype,"enabled",void 0);g([f.property({type:Number})],
c.prototype,"elevationMargin",void 0);return c=g([f.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],c)}(f.declared(l));d.default=t})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(f){function e(){var b=
null!==f&&f.apply(this,arguments)||this;b.mode="auto";return b}q(e,f);Object.defineProperty(e.prototype,"near",{get:function(){return this._get("near")},set:function(b){this._set("near",b);b>=this._get("far")&&(this.far=b+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});e.prototype.castNear=function(b){return Math.max(1E-8,b)};Object.defineProperty(e.prototype,"far",{get:function(){return this._get("far")},set:function(b){this._set("far",b);b<=this._get("near")&&(this.near=b-1E-9);this.mode=
"manual"},enumerable:!0,configurable:!0});e.prototype.castFar=function(b){return Math.max(1E-8,b)};e.prototype.autoUpdate=function(b,c){"auto"===this.mode&&(this._get("near")!==b&&this._set("near",b),this._get("far")!==c&&this._set("far",c))};g([b.property({type:Number,value:1E-8})],e.prototype,"near",null);g([b.cast("near")],e.prototype,"castNear",null);g([b.property({type:Number,value:1E-8})],e.prototype,"far",null);g([b.cast("far")],e.prototype,"castFar",null);g([b.property({type:["auto","manual"]})],
e.prototype,"mode",void 0);return e=g([b.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],e)}(b.declared(l));d.ClipDistanceConstraint=t;d.default=t})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function e(){return null!==
b&&b.apply(this,arguments)||this}q(e,b);Object.defineProperty(e.prototype,"enabled",{set:function(c){l.deprecated("SceneView.constraint.collision.enabled","Use Map.ground.navigationConstraint instead","4.8");this._set("enabled",c)},enumerable:!0,configurable:!0});g([f.property({value:!0})],e.prototype,"enabled",null);return e=g([f.subclass("esri.views.3d.constraints.CollisionConstraint")],e)}(f.declared(b));d.CollisionConstraint=t;d.default=t})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints ../support/mathUtils".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});var k=e.rad2deg(f.TiltDefault.min),c=e.rad2deg(f.TiltDefault.max);t=function(a){function f(){var c=null!==a&&a.apply(this,arguments)||this;c.mode="auto";return c}q(f,a);Object.defineProperty(f.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0});f.prototype.castMax=function(a){return e.clamp(a,k,c)};f.prototype.autoUpdate=function(a){"auto"===
this.mode&&this._get("max")!==a&&this._set("max",a)};g([b.property({type:["auto","manual"]})],f.prototype,"mode",void 0);g([b.property({type:Number,value:c})],f.prototype,"max",null);g([b.cast("max")],f.prototype,"castMax",null);return f=g([b.subclass("esri.views.3d.constraints.TiltConstraint")],f)}(b.declared(l));d.TiltConstraint=t;d.default=t})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){return function(a){function p(c){c=a.call(this,c)||this;c.atmosphere=new k.default;return c}q(p,a);d=p;p.fromWebsceneEnvironment=function(a){a=a.cloneConstructProperties();return new d(l({},a,{lighting:c.SceneViewLighting.fromWebsceneLighting(a.lighting)}))};p.prototype.castLighting=function(a){return a?a instanceof c.SceneViewLighting?a:a instanceof h?this.lighting?this.lighting.cloneWithWebsceneLighting(a):c.SceneViewLighting.fromWebsceneLighting(a):e.ensureType(c.SceneViewLighting,
a):new c.SceneViewLighting};p.prototype.clone=function(){return new d({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:b.clone(this.background)})};var d;g([f.property({type:k.default,json:{read:!1}})],p.prototype,"atmosphere",void 0);g([f.property()],p.prototype,"lighting",void 0);g([f.cast("lighting")],p.prototype,"castLighting",null);return p=d=g([f.subclass("esri.views.3d.environment.SceneViewEnvironment")],
p)}(f.declared(a))})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(f){function e(){return null!==f&&f.apply(this,arguments)||this}q(e,f);k=e;Object.defineProperty(e.prototype,"quality",{set:function(c){-1!==["low","high"].indexOf(c)&&
this._set("quality",c)},enumerable:!0,configurable:!0});e.prototype.clone=function(){return new k({quality:this.quality})};var k;g([b.property({type:["low","high"],value:"low"})],e.prototype,"quality",null);return e=k=g([b.subclass("esri.views.3d.environment.SceneViewAtmosphere")],e)}(b.declared(l));d.SceneViewAtmosphere=t;d.default=t})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(c){function a(a){a=c.call(this,a)||this;a.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};a.cameraTrackingEnabled=!0;a.ambientOcclusionEnabled=!1;var b=(new Date).getFullYear(),b=new Date("March 15, "+b+" 12:00:00 UTC");a._set("defaultDate",b);a._set("date",b);return a}q(a,c);b=a;a.fromWebsceneLighting=function(a){return new b(l({},a.cloneConstructProperties()))};Object.defineProperty(a.prototype,
"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var c=this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);c&&this._set("date",a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(a.getTime())))},enumerable:!0,configurable:!0});a.prototype.autoUpdate=function(a,c){var b=this._calculateTimezoneOffset(this.positionTimezoneInfo);
this.positionTimezoneInfo.hours=c.hours;this.positionTimezoneInfo.minutes=c.minutes;this.positionTimezoneInfo.seconds=c.seconds;c=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=!0,c=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())));var e=this._calculateTimezoneOffset(this.positionTimezoneInfo);b!==e&&(k.target=this,k.timezoneOffset=e,this.emit("timezone-will-change",k));if(null!=a)return c!==a.getTime()};a.prototype.clone=function(){var a=this._get("date")===this._get("defaultDate"),
c=new b(l({},this.cloneConstructProperties(),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled}));a&&c._set("date",c._get("defaultDate"));c.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;c.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;c.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;c.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return c};a.prototype.cloneWithWebsceneLighting=
function(a){var c=this.clone();null!=a.date&&(c.date=a.date);c.directShadowsEnabled=a.directShadowsEnabled;c.displayUTCOffset=a.displayUTCOffset;return c};a.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)};var b;g([f.property({type:Boolean})],a.prototype,"cameraTrackingEnabled",void 0);g([f.property({type:Boolean})],a.prototype,"ambientOcclusionEnabled",void 0);g([f.property({type:Date})],a.prototype,"defaultDate",null);g([f.property({type:Date})],
a.prototype,"date",null);return a=b=g([f.subclass("esri.views.3d.environment.SceneViewLighting")],a)}(f.declared(e,b));d.SceneViewLighting=t;var k={target:null,timezoneOffset:0};d.default=t})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(t,d,q,g,l,b){return function(f){function e(c){c=f.call(this,c)||this;c.date=null;c.directShadowsEnabled=
!1;c.displayUTCOffset=null;return c}q(e,f);k=e;e.prototype.readDate=function(c,a){return null!=a.datetime&&new Date(a.datetime)||null};e.prototype.writeDate=function(c,a,b){a[b]=c.getTime()};e.prototype.readDirectShadowsEnabled=function(c,a){return!!a.directShadows};e.prototype.writedirectShadowsEnabled=function(c,a,b){c&&(a[b]=c)};e.prototype.writeDisplayUTCOffset=function(c,a){null!=c&&(a.displayUTCOffset=c)};e.prototype.clone=function(){return new k(this.cloneConstructProperties())};e.prototype.cloneConstructProperties=
function(){var c={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(c.date=new Date(this.date.getTime()));return c};var k;g([b.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],e.prototype,"date",void 0);g([b.reader("date",["datetime"])],e.prototype,"readDate",null);g([b.writer("date")],e.prototype,"writeDate",null);g([b.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],
e.prototype,"directShadowsEnabled",void 0);g([b.reader("directShadowsEnabled",["directShadows"])],e.prototype,"readDirectShadowsEnabled",null);g([b.writer("directShadowsEnabled")],e.prototype,"writedirectShadowsEnabled",null);g([b.property({type:Number,json:{write:!0}})],e.prototype,"displayUTCOffset",void 0);g([b.writer("displayUTCOffset")],e.prototype,"writeDisplayUTCOffset",null);return e=k=g([b.subclass("esri.webscene.Lighting")],e)}(b.declared(l))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(t,d,q,g,l,b,f,e,k){var c=function(a,c,b){return{enabled:!b||!b.isPresentation}};return function(a){function h(c){c=a.call(this,c)||this;c.lighting=new e;c.background=null;c.atmosphereEnabled=!0;c.starsEnabled=!0;return c}q(h,a);p=h;h.prototype.clone=function(){return new p(this.cloneConstructProperties())};h.prototype.cloneConstructProperties=function(){return{lighting:e.prototype.clone.call(this.lighting),background:b.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var p;g([f.property({type:e,json:{write:!0}})],h.prototype,"lighting",void 0);g([f.property(k.backgroundProperty)],h.prototype,"background",void 0);g([f.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:c}}})],h.prototype,"atmosphereEnabled",void 0);g([f.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:c}}})],h.prototype,"starsEnabled",void 0);return h=p=g([f.subclass("esri.webscene.Environment")],h)}(f.declared(l))})},"esri/webscene/background/utils":function(){define(["require",
"exports","./Background","./ColorBackground"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t={base:q,key:"type",typeMap:{color:g}};d.backgroundProperty={types:t,json:{read:function(g){return function(b,f,e){if(!b)return b;for(var k in g.typeMap)if(b.type===k)return f=new g.typeMap[k],f.read(b,e),f}}(t),write:{overridePolicy:function(g,b,f){return{enabled:!f||!f.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b,f,e){var k=f.strict()({color:"color"});return function(c){function a(a){return c.call(this)||this}q(a,c);a.prototype.normalizeCtorArgs=function(a){a&&a.type&&(a=l({},a),delete a.type);return a};a.prototype.clone=function(){};g([e.property({type:k.apiValues,readOnly:!0,json:{type:k.jsonValues,read:!1,write:k.write}})],a.prototype,"type",void 0);return a=g([e.subclass("esri.webscene.background.Background")],a)}(e.declared(b))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(t,d,q,g,l,b,f,e,k){var c=l({},e.colorAndTransparencyProperty,{nonNullable:!0});return function(a){function e(c){c=a.call(this)||this;c.type="color";c.color=new b([0,0,0,1]);return c}q(e,a);k=e;e.prototype.clone=function(){return new k(this.cloneProperties())};e.prototype.cloneProperties=function(){return{color:this.color.clone()}};var k;g([f.enumeration.serializable()({color:"color"})],e.prototype,"type",void 0);g([f.property(c)],e.prototype,"color",void 0);return e=k=g([f.subclass("esri.webscene.background.ColorBackground")],
e)}(f.declared(k))})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A){Object.defineProperty(d,"__esModule",{value:!0});var C=p.vec3f64.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);t=function(b){function f(a){var c=b.call(this)||this;c.referencePointUpdateDelay=200;c.referencePointUpdateInterval=3E3;c.referencePointUpdateDistThreshold=1E6;c._referencePosUpdateQuery=null;c._referencePosMapCoordsRequested=null;c._viewHandles=new e;c._preserveAbsoluteDateTime=!1;c._trackingEnabled=!1;c._viewConnected=
!1;c._referencePosResetPreserveAbsoluteTime=!1;c.referencePosUpdateTimer=null;c._referencePosWGS84=null;c._referencePosMapCoords=null;c._mainLight=new x.MainLight;c._ambientLight=new x.AmbientLight;c._moonLight=new x.FillLight;c._environmentRenderer=null;c.debug=function(){return{set referencePointUpdateInterval(a){c.referencePointUpdateInterval=a},set referencePointUpdateDistThreshold(a){c.referencePointUpdateDistThreshold=a},set referencePosUpdateTimer(a){c.referencePosUpdateTimer=a},set referencePointUpdateDelay(a){c.referencePointUpdateDelay=
a}}}();c._resetReferencePosition();return c}q(f,b);f.prototype.destroy=function(){this._viewHandles.destroy();this.disposeRendering()};Object.defineProperty(f.prototype,"updating",{get:function(){return!this.noReferencePositionQueries&&(!!this._referencePosUpdateQuery||!!this._referencePosMapCoordsRequested)||this._environmentRenderer.updating},enumerable:!0,configurable:!0});f.prototype.updateReadyChange=function(a){a&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view)):!a&&
this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view))};f.prototype.disposeRendering=function(){this._environmentRenderer&&(this._environmentRenderer.destroy(),this._environmentRenderer=null);this._resetReferencePosition(!0)};f.prototype.connectView=function(a){var b=this;this._environmentRenderer=new y({view:a});this._viewHandles.add([this.view.watch("environment.lighting.date",function(a){return b._lightingDateHandler(a)},!0),this.view.watch("interacting,stationary",this._interactingStationaryHandler.bind(this)),
this.view.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.background.color"],this._updateRenderParamsHandler.bind(this)),this.view.watch("spatialReference",this._spatialReferenceHandler.bind(this)),c.init(this.view,"viewingMode",this._viewingModeHandler.bind(this)),c.init(this.view,"environment.lighting.cameraTrackingEnabled",this._updateCameraTracking.bind(this),!0),c.init(this,"view.state.camera",this._cameraHandler.bind(this,null),
!0),this.watch("noReferencePositionQueries",this._cameraHandler.bind(this,null))]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()};f.prototype._updateCameraTracking=function(a){if(this._trackingEnabled=a)this._cameraHandler();else if(a=this.get("view.environment.lighting"))a.positionTimezoneInfo.autoUpdated=!1};f.prototype.disconnectView=function(a){this.disposeRendering();this._viewHandles.removeAll()};f.prototype._lightingDateHandler=function(a){if(a){var c=this.view.environment.lighting;
if(!c.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var b=this.view.spatialReference;if(!(b.isWGS84||b.isWebMercator||(b=this.view.camera.position,this._referencePosMapCoords&&this._referencePosMapCoords.equals(b)))){this._requestReferencePositionUpdate(b);return}this._preupdateTracking(a);this._referencePosWGS84&&(b=w.positionToTimezone(this._referencePosWGS84,E),c.autoUpdate(null,b),this._trackingEnabled&&(c.positionTimezoneInfo.autoUpdated=!0))}this._updateLightParams(a)}};
f.prototype._preupdateTracking=function(a){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&this._cameraHandler(a)};f.prototype._cameraHandler=function(a){void 0===a&&(a=null);if(this.view.ready){var c=this.view.camera;if(c){var b=this.view.spatialReference;b.isWGS84||b.isWebMercator?this._cameraHandlerGlobal(c,a):this._cameraHandlerLocal(c,a)}}};f.prototype._cameraHandlerGlobal=function(a,c){a=a.position;this._referencePosWGS84||(this._referencePosWGS84=new u({spatialReference:v.WGS84}));
a.spatialReference.isWebMercator?r.webMercatorToGeographic(a,!1,this._referencePosWGS84):(this._referencePosWGS84.x=a.x,this._referencePosWGS84.y=a.y);this._referencePosWGS84.z=a.z;this._autoUpdateTimezone(a,c)||this._updateLightParams(c)};f.prototype._cameraHandlerLocal=function(a,c){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this.view.mapCoordsHelper&&this._referencePosWGS84&&
(this._referencePosWGS84.z=a.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};f.prototype._interactingStationaryHandler=function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()};f.prototype._updateLightParams=function(a){void 0===a&&(a=null);var c=this.view.environment.lighting;a=a||c.date;var c=this.view._stage,b;this._referencePosWGS84?(b=m.computeColorAndIntensity(a,this._referencePosWGS84),m.computeDirection(a,this._referencePosWGS84,
this.view.viewingMode,b.diffuse.direction)):b={diffuse:{color:[1,1,1],intensity:.55,direction:C},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};h.vec3.scale(this._mainLight.intensity,b.diffuse.color,b.diffuse.intensity*Math.PI);h.vec3.negate(this._mainLight.direction,b.diffuse.direction);h.vec3.scale(this._ambientLight.intensity,b.ambient.color,b.ambient.intensity);h.vec3.lerp(this._moonLight.intensity,I,G,b.globalFactor);h.vec3.scale(this._moonLight.intensity,this._moonLight.intensity,
(1-.5*b.globalFactor)*(1-.4*b.noonFactor*(1-b.globalFactor)));h.vec3.copy(this._moonLight.direction,b.diffuse.direction);c.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:b.globalFactor,groundLightingFactor:1-b.noonFactor});this._updateRenderParamsHandler()};f.prototype._autoUpdateTimezone=function(a,c){void 0===c&&(c=null);if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;var b=B;b.setTime((c||this.view.environment.lighting.date).getTime());
a=w.positionToTimezone(a,E);var e=this.view.environment.lighting.positionTimezoneInfo;if(!e.autoUpdated)e=a;else if(e.hours===a.hours&&e.minutes===a.minutes&&e.seconds===a.seconds)return!1;var f=b.getUTCHours()-(a.hours-e.hours),h=b.getUTCMinutes()-(a.minutes-e.minutes),e=b.getUTCSeconds()-(a.seconds-e.seconds);b.setUTCHours(f);b.setUTCMinutes(h);b.setUTCSeconds(e);return c?!1:this.view.environment.lighting.autoUpdate(b,a)};f.prototype._updateRenderParamsHandler=function(){var a=this.view._stage,
c=!0;this._referencePosWGS84&&(c=m.computeShadowsEnabled(this._referencePosWGS84,this.view.viewingMode));var b=this.view.environment.background,b=b instanceof A?{type:"color",color:n.vec4f64.fromArray(l.toUnitRGBA(b.color))}:{type:"color",color:n.vec4f64.fromValues(0,0,0,1)};a&&a.setRenderParams({shadowMap:this.view.environment.lighting.directShadowsEnabled&&c,ssao:this.view.environment.lighting.ambientOcclusionEnabled,background:b})};f.prototype._spatialReferenceHandler=function(){this._resetReferencePosition()};
f.prototype._viewingModeHandler=function(){this._resetReferencePosition()};f.prototype._resetReferencePosition=function(a){void 0===a&&(a=!1);this._cancelReferencePosUpdates();this._referencePosWGS84=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;a||this.notifyChange("updating")};f.prototype._requestReferencePositionUpdate=function(a,c){var b=this;void 0===c&&(c=!1);if(this.view.mapCoordsHelper.canProject()&&!this.noReferencePositionQueries&&
(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(a):this._referencePosMapCoordsRequested=a.clone(),this._referencePosResetPreserveAbsoluteTime=!!c,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var e=this._referencePosUpdateQuery=k.after(this.referencePointUpdateDelay).then(function(){if(b._referencePosUpdateQuery===e)return b._doReferencePositionUpdateQuery(function(){return b._referencePosUpdateQuery!==
e})}).catch(function(){}).then(function(){b._referencePosUpdateQuery===e&&(b._referencePosUpdateQuery=null,b.referencePosUpdateTimer||b._executePendingReferencePositionUpdate(),b.notifyChange("updating"))}),f=this.referencePosUpdateTimer=k.after(this.referencePointUpdateInterval).then(function(){b.referencePosUpdateTimer===f&&(b.referencePosUpdateTimer=null,b._referencePosUpdateQuery||b._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};f.prototype._doReferencePositionUpdateQuery=
function(a){var c=this;this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;return this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords).then(function(b){if(!a()&&!isNaN(b[0])&&!isNaN(b[1])){var e=c._referencePosMapCoords.z*
c.view.mapCoordsHelper.unitInMeters;c._referencePosWGS84?(c._referencePosWGS84.x=b[0],c._referencePosWGS84.y=b[1],c._referencePosWGS84.z=e):c._referencePosWGS84=new u({x:b[0],y:b[1],z:e,spatialReference:v.WGS84});c._referencePosChanged()}})};f.prototype._executePendingReferencePositionUpdate=function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)};f.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?
this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84)||this._updateLightParams()};f.prototype._exceedsReferencePosDistThreshold=function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this.view.mapCoordsHelper&&(a*=this.view.mapCoordsHelper.unitInMeters),a>this.referencePointUpdateDistThreshold):!0};f.prototype._cancelReferencePosUpdates=function(){this.referencePosUpdateTimer=this._referencePosUpdateQuery=null};f.FIXED_LIGHT_DIRECTION=C;g([a.property({type:Boolean,
dependsOn:["noReferencePositionQueries","_environmentRenderer.updating"],readOnly:!0})],f.prototype,"updating",null);g([a.property()],f.prototype,"noReferencePositionQueries",void 0);g([a.property({constructOnly:!0})],f.prototype,"view",void 0);g([a.property()],f.prototype,"_environmentRenderer",void 0);return f=g([a.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],f)}(a.declared(b,f));d.SceneViewEnvironmentManager=t;var B=new Date,E={hours:0,minutes:0,seconds:0},I=p.vec3f64.fromValues(.22,
.22,.33),G=p.vec3f64.fromValues(.22,.22,.22);d.default=t})},"esri/core/libs/gl-matrix-2/vec4f64":function(){define(["require","exports","./factories/vec4f64"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.vec4f64=q})},"esri/core/libs/gl-matrix-2/factories/vec4f64":function(){define(["require","exports"],function(t,d){function q(){return[0,0,0,0]}Object.defineProperty(d,"__esModule",{value:!0});d.create=q;d.clone=function(g){return[g[0],g[1],g[2],g[3]]};d.fromValues=function(g,
l,b,f){return[g,l,b,f]};d.fromArray=function(g){for(var l=q(),b=Math.min(4,g.length),f=0;f<b;++f)l[f]=g[f];return l};d.createView=function(g,l){return new Float64Array(g,l,4)}})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/compilerUtils ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){var n=[12,13];return function(l){function d(){var a=null!==l&&l.apply(this,arguments)||this;a.needsRender=!1;a.didRender=!0;a._handles=new f;a._initContext=null;a._atmosphereReadyPromise=null;a._atmosphere=null;a._stars=null;return a}q(d,l);Object.defineProperty(d.prototype,"updating",{get:function(){return!(!this._atmosphereReadyPromise||this._atmosphereReadyPromise.isFulfilled())},enumerable:!0,configurable:!0});d.prototype.initialize=function(){this.view._stage.addRenderPlugin(n,
this)};d.prototype.destroy=function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&(this.view._stage.removeRenderPlugin(this),this.view=null)};d.prototype.initializeRenderContext=function(a){this._initContext=a;this.setup()};d.prototype.setup=function(){var a=this;this._handles.add(e.when(this.view,"basemapTerrain",function(){return a._updateBasemapTerrain()}));this._handles.add([e.init(this.view,
["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],function(){return a._updateAtmosphere()}),e.init(this.view,"environment.starsEnabled",function(){return a._updateStars()})])};d.prototype.uninitializeRenderContext=function(a){this._stars&&(this._stars.uninitializeRenderContext(a),this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(a),this._atmosphere.destroy(),this._atmosphere=null)};d.prototype.render=function(a){var c=
this.view.basemapTerrain;if(!(c&&c.loaded||"global"!==this.view.viewingMode))return!1;c=!0;this._stars&&(c=this._stars.render(a)&&c);this._atmosphere&&(c=this._atmosphere.render(a)&&c);return c};d.prototype._updateStars=function(){var a=this.view.get("environment.starsEnabled")||!1;a&&!this._stars?(this._stars=new p(this.view),this._stars.initializeRenderContext(this._initContext),this.needsRender=!0):!a&&this._stars&&(this._stars.destroy(),this._stars=null,this.needsRender=!0)};d.prototype._updateAtmosphere=
function(){var a=this,c=this._getAtmosphereType(this._initContext);if(this.atmosphereType!==c)if(this.atmosphereType=c,this._atmosphereReadyPromise&&(this._atmosphereReadyPromise.cancel(),this._atmosphereReadyPromise=null),c=this._getAtmosphereClass(c)){var b=new c(this.view);b.initializeRenderContext(this._initContext);null==this._atmosphere&&(this._atmosphere=b,this.needsRender=!0);this._atmosphereReadyPromise=b.when(function(){a._atmosphere!==b&&(a._atmosphere&&(a._atmosphere.destroy(),a._atmosphere=
null),a._atmosphere=b);a._atmosphereReadyPromise=null;a.needsRender=!0;a._updateBasemapTerrain();a.notifyChange("updating")});this.notifyChange("updating")}else this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null,this.needsRender=!0),this._updateBasemapTerrain()};d.prototype._getAtmosphereClass=function(e){switch(e){case "none":return null;case "realistic":return a;case "panoramic":return c;case "simple":return h;default:b.neverReached(e)}};d.prototype._getAtmosphereType=function(c){var b=
this.view.get("environment.atmosphereEnabled"),e=this.view.get("environment.atmosphere.quality");return b&&null!=e?"local"===this.view.viewingMode?"panoramic":"high"===e&&a.isSupported(c)?"realistic":"simple":"none"};d.prototype._updateBasemapTerrain=function(){var a=this.view.basemapTerrain;a&&(a.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};g([k.property()],d.prototype,"view",void 0);g([k.property()],d.prototype,"updating",null);return d=g([k.subclass("esri.views.3d.environment.EnvironmentRenderer")],
d)}(k.declared(l))})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Texture ../../webgl/Util ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y){t=function(){function e(a){this.needsRender=!1;this.didRender=!0;this.slot=12;this.view=a}e.prototype.destroy=function(){this._program&&(this._program.dispose(),this._program=null);this._texture&&(this._texture.dispose(),this._texture=null);this._readyPromise&&(this._readyPromise.cancel(),this._readyPromise=null)};e.prototype.when=function(a){return this._readyPromise.then(a)};e.prototype.initializeRenderContext=function(c){var e=this,f=c.rctx;this._program=
p.createProgram(f,a.colorPass,{panoramic:!0});this._pipelineState=n.makePipelineState({blending:n.separateBlendingParams(770,1,771,771),culling:n.backFaceCullingParams,depthTest:{func:515},colorWrite:n.defaultColorWriteParams});this._vao=this._createVertexArrayObject(f);this._vaoCount=r.vertexCount(this._vao,"geometry");this._readyPromise=b.requestImage(l).then(function(a){e._texture=new u(c.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);e.needsRender=!0})};e.prototype.uninitializeRenderContext=
function(a){this.destroy()};e.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass||null==this._texture)return!1;var c=a.rctx,b=this._program;c.bindProgram(b);c.setPipelineState(this._pipelineState);c.bindTexture(this._texture);b.setUniform1i("tex",0);b.setUniformMatrix4fv("proj",a.camera.projectionMatrix);var e=w;q.mat4.copy(e,a.camera.viewMatrix);e[12]=0;e[13]=0;e[14]=0;e[15]=1;b.setUniformMatrix4fv("view",w);b.setUniform4f("color",1,1,1,1);b.setUniform3fv("lightDirection",a.lightingData.direction);
c.bindVAO(this._vao);v.assertCompatibleVertexAttributeLocations(this._vao,b);c.drawArrays(4,0,this._vaoCount);return!0};e.prototype._createVertexArrayObject=function(b){for(var e=k.createPolySphereGeometry(1,2,!1),g=e.indices[c.VertexAttrConstants.POSITION],p=0;p<g.length;p+=3){var n=g[p];g[p]=g[p+2];g[p+2]=n}for(var e=e.vertexAttributes[c.VertexAttrConstants.POSITION].data,n=m.createBuffer(g.length),l=n.position,p=0;p<g.length;++p){var r=3*g[p];l.set(p,0,e[r]);l.set(p,1,e[r+1]);l.set(p,2,e[r+2])}return new y(b,
a.colorPass.attributes,{geometry:f.glLayout(m)},{geometry:h.createVertex(b,35044,n.buffer)})};return e}();var w=g.mat4f64.create(),m=e.newLayout().vec3f("position");return t})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.mat4f64=q})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});
d.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};d.clone=function(d){return[d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],d[12],d[13],d[14],d[15]]};d.fromValues=function(d,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y){return[d,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y]};d.createView=function(d,g){return new Float64Array(d,g,16)}})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(t,d){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../request"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.dataURItoBlob=function(g){var l=atob(g.split(",")[1]);g=g.split(",")[0].split(":")[1].split(";")[0];for(var b=new ArrayBuffer(l.length),f=new Uint8Array(b),e=0;e<l.length;e++)f[e]=l.charCodeAt(e);return new Blob([b],{type:g})};d.requestImage=function(g){return q(g,{responseType:"image"}).then(function(g){return g.data})}})},"esri/views/3d/support/buffer/glUtil":function(){define(["require",
"exports","../../../../core/tsSupport/assignHelper"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});var g={divisor:0,prefixA:!1};d.glLayout=function(b,f){void 0===f&&(f={});f=q({},g,f);var e=b.stride;return b.fieldNames.filter(function(e){e=b.fields.get(e).optional;return!(e&&e.glPadding)}).map(function(k){var c=b.fields.get(k),a=c.constructor.ElementCount,h;h=l[c.constructor.ElementType];if(!h)throw Error("BufferType not supported in WebGL");var g=c.offset,c=!(!c.optional||!c.optional.glNormalized);
return{name:f.prefixA?"a"+k[0].toUpperCase()+k.substr(1):k,stride:e,count:a,type:h,offset:g,normalized:c,divisor:f.divisor}})};var l={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView","./types"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});var l=function(){function b(b,f){this.layout=b;this.buffer="number"===typeof f?new ArrayBuffer(f*b.stride):f;f=0;for(var c=
b.fieldNames;f<c.length;f++){var a=c[f],e=b.fields.get(a);this[a]=new e.constructor(this.buffer,e.offset,this.stride)}}Object.defineProperty(b.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"byteLength",{get:function(){return this.buffer.byteLength},enumerable:!0,configurable:!0});b.prototype.getField=
function(b,f){return(b=this[b])&&b.elementCount===f.ElementCount&&b.elementType===f.ElementType?b:null};b.prototype.slice=function(e,f){return new b(this.layout,this.buffer.slice(e*this.stride,f*this.stride))};b.prototype.copyFrom=function(b,f,c,a){var e=this.stride;0===e%4?(b=new Uint32Array(b.buffer,f*e,a*e/4),c=new Uint32Array(this.buffer,c*e,a*e/4)):(b=new Uint8Array(b.buffer,f*e,a*e),c=new Uint8Array(this.buffer,c*e,a*e));c.set(b)};return b}();d.InterleavedBuffer=l;var b=function(){function b(){this.stride=
0;this.fields=new Map;this.fieldNames=[]}b.prototype.vec2f=function(b,f){this.appendField(b,q.BufferViewVec2f,f);return this};b.prototype.vec2f64=function(b,f){this.appendField(b,q.BufferViewVec2f64,f);return this};b.prototype.vec3f=function(b,f){this.appendField(b,q.BufferViewVec3f,f);return this};b.prototype.vec3f64=function(b,f){this.appendField(b,q.BufferViewVec3f64,f);return this};b.prototype.vec4f=function(b,f){this.appendField(b,q.BufferViewVec4f,f);return this};b.prototype.vec4f64=function(b,
f){this.appendField(b,q.BufferViewVec4f64,f);return this};b.prototype.mat3f=function(b,f){this.appendField(b,q.BufferViewMat3f,f);return this};b.prototype.mat3f64=function(b,f){this.appendField(b,q.BufferViewMat3f64,f);return this};b.prototype.mat4f=function(b,f){this.appendField(b,q.BufferViewMat4f,f);return this};b.prototype.mat4f64=function(b,f){this.appendField(b,q.BufferViewMat4f64,f);return this};b.prototype.vec4u8=function(b,f){this.appendField(b,q.BufferViewVec4u8,f);return this};b.prototype.f32=
function(b,f){this.appendField(b,q.BufferViewFloat,f);return this};b.prototype.f64=function(b,f){this.appendField(b,q.BufferViewFloat64,f);return this};b.prototype.u8=function(b,f){this.appendField(b,q.BufferViewUint8,f);return this};b.prototype.u16=function(b,f){this.appendField(b,q.BufferViewUint16,f);return this};b.prototype.i8=function(b,f){this.appendField(b,q.BufferViewInt8,f);return this};b.prototype.vec2i8=function(b,f){this.appendField(b,q.BufferViewVec2i8,f);return this};b.prototype.vec2i16=
function(b,f){this.appendField(b,q.BufferViewVec2i16,f);return this};b.prototype.vec2u8=function(b,f){this.appendField(b,q.BufferViewVec2u8,f);return this};b.prototype.vec4u16=function(b,f){this.appendField(b,q.BufferViewVec4u16,f);return this};b.prototype.u32=function(b,f){this.appendField(b,q.BufferViewUint32,f);return this};b.prototype.appendField=function(b,f,c){var a=f.ElementCount*g.elementTypeSize(f.ElementType);this.fields.set(b,{size:a,constructor:f,offset:this.stride,optional:c});this.stride+=
a;this.fieldNames.push(b)};b.prototype.alignTo=function(b){this.stride=Math.floor((this.stride+b-1)/b)*b;return this};b.prototype.hasField=function(b){return 0<=this.fieldNames.indexOf(b)};b.prototype.createBuffer=function(b){return new l(this,b)};b.prototype.createView=function(b){return new l(this,b)};b.prototype.clone=function(){var e=new b;e.stride=this.stride;e.fields=new Map;this.fields.forEach(function(b,c){return e.fields.set(c,b)});e.fieldNames=this.fieldNames.slice();e.BufferType=this.BufferType;
return e};return b}();d.InterleavedLayout=b;d.newLayout=function(){return new b}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,"__esModule",{value:!0});t=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float32Array,a,b,e,f)||this;a.elementType=
"f32";return a}q(a,c);a.ElementType="f32";return a}(b.BufferViewScalarImpl);d.BufferViewFloat=t;t=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float32Array,a,b,e,f)||this;a.elementType="f32";return a}q(a,c);a.ElementType="f32";return a}(f.BufferViewVec2Impl);d.BufferViewVec2f=t;t=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float32Array,a,b,e,f)||this;a.elementType="f32";return a}q(a,c);a.ElementType="f32";return a}(e.BufferViewVec3Impl);d.BufferViewVec3f=t;t=
function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float32Array,a,b,e,f)||this;a.elementType="f32";return a}q(a,c);a.ElementType="f32";return a}(k.BufferViewVec4Impl);d.BufferViewVec4f=t;t=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float32Array,a,b,e,f)||this;a.elementType="f32";return a}q(a,c);a.ElementType="f32";return a}(g.BufferViewMat3Impl);d.BufferViewMat3f=t;g=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float64Array,a,b,e,f)||this;a.elementType=
"f64";return a}q(a,c);a.ElementType="f64";return a}(g.BufferViewMat3Impl);d.BufferViewMat3f64=g;g=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float32Array,a,b,e,f)||this;a.elementType="f32";return a}q(a,c);a.ElementType="f32";return a}(l.BufferViewMat4Impl);d.BufferViewMat4f=g;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float64Array,a,b,e,f)||this;a.elementType="f64";return a}q(a,c);a.ElementType="f64";return a}(l.BufferViewMat4Impl);d.BufferViewMat4f64=l;
l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float64Array,a,b,e,f)||this;a.elementType="f64";return a}q(a,c);a.ElementType="f64";return a}(b.BufferViewScalarImpl);d.BufferViewFloat64=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float64Array,a,b,e,f)||this;a.elementType="f64";return a}q(a,c);a.ElementType="f64";return a}(f.BufferViewVec2Impl);d.BufferViewVec2f64=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float64Array,a,b,e,f)||this;
a.elementType="f64";return a}q(a,c);a.ElementType="f64";return a}(e.BufferViewVec3Impl);d.BufferViewVec3f64=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Float64Array,a,b,e,f)||this;a.elementType="f64";return a}q(a,c);a.ElementType="f64";return a}(k.BufferViewVec4Impl);d.BufferViewVec4f64=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint8Array,a,b,e,f)||this;a.elementType="u8";return a}q(a,c);a.ElementType="u8";return a}(b.BufferViewScalarImpl);d.BufferViewUint8=
l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint8Array,a,b,e,f)||this;a.elementType="u8";return a}q(a,c);a.ElementType="u8";return a}(f.BufferViewVec2Impl);d.BufferViewVec2u8=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint8Array,a,b,e,f)||this;a.elementType="u8";return a}q(a,c);a.ElementType="u8";return a}(e.BufferViewVec3Impl);d.BufferViewVec3u8=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint8Array,a,b,e,f)||this;a.elementType=
"u8";return a}q(a,c);a.ElementType="u8";return a}(k.BufferViewVec4Impl);d.BufferViewVec4u8=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint16Array,a,b,e,f)||this;a.elementType="u16";return a}q(a,c);a.ElementType="u16";return a}(b.BufferViewScalarImpl);d.BufferViewUint16=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint16Array,a,b,e,f)||this;a.elementType="u16";return a}q(a,c);a.ElementType="u16";return a}(f.BufferViewVec2Impl);d.BufferViewVec2u16=l;l=
function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint16Array,a,b,e,f)||this;a.elementType="u16";return a}q(a,c);a.ElementType="u16";return a}(e.BufferViewVec3Impl);d.BufferViewVec3u16=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint16Array,a,b,e,f)||this;a.elementType="u16";return a}q(a,c);a.ElementType="u16";return a}(k.BufferViewVec4Impl);d.BufferViewVec4u16=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint32Array,a,b,e,f)||this;a.elementType=
"u32";return a}q(a,c);a.ElementType="u32";return a}(b.BufferViewScalarImpl);d.BufferViewUint32=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint32Array,a,b,e,f)||this;a.elementType="u32";return a}q(a,c);a.ElementType="u32";return a}(f.BufferViewVec2Impl);d.BufferViewVec2u32=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint32Array,a,b,e,f)||this;a.elementType="u32";return a}q(a,c);a.ElementType="u32";return a}(e.BufferViewVec3Impl);d.BufferViewVec3u32=
l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Uint32Array,a,b,e,f)||this;a.elementType="u32";return a}q(a,c);a.ElementType="u32";return a}(k.BufferViewVec4Impl);d.BufferViewVec4u32=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Int8Array,a,b,e,f)||this;a.elementType="i8";return a}q(a,c);a.ElementType="i8";return a}(b.BufferViewScalarImpl);d.BufferViewInt8=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Int8Array,a,b,e,f)||this;a.elementType=
"i8";return a}q(a,c);a.ElementType="i8";return a}(f.BufferViewVec2Impl);d.BufferViewVec2i8=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Int8Array,a,b,e,f)||this;a.elementType="i8";return a}q(a,c);a.ElementType="i8";return a}(e.BufferViewVec3Impl);d.BufferViewVec3i8=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Int8Array,a,b,e,f)||this;a.elementType="i8";return a}q(a,c);a.ElementType="i8";return a}(k.BufferViewVec4Impl);d.BufferViewVec4i8=l;l=function(c){function a(a,
b,e,f){void 0===b&&(b=0);a=c.call(this,Int16Array,a,b,e,f)||this;a.elementType="i16";return a}q(a,c);a.ElementType="i16";return a}(b.BufferViewScalarImpl);d.BufferViewInt16=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Int16Array,a,b,e,f)||this;a.elementType="i16";return a}q(a,c);a.ElementType="i16";return a}(f.BufferViewVec2Impl);d.BufferViewVec2i16=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Int16Array,a,b,e,f)||this;a.elementType="i16";return a}q(a,
c);a.ElementType="i16";return a}(e.BufferViewVec3Impl);d.BufferViewVec3i16=l;l=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Int16Array,a,b,e,f)||this;a.elementType="i16";return a}q(a,c);a.ElementType="i16";return a}(k.BufferViewVec4Impl);d.BufferViewVec4i16=l;b=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Int32Array,a,b,e,f)||this;a.elementType="i32";return a}q(a,c);a.ElementType="i32";return a}(b.BufferViewScalarImpl);d.BufferViewInt32=b;f=function(c){function a(a,
b,e,f){void 0===b&&(b=0);a=c.call(this,Int32Array,a,b,e,f)||this;a.elementType="i32";return a}q(a,c);a.ElementType="i32";return a}(f.BufferViewVec2Impl);d.BufferViewVec2i32=f;e=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Int32Array,a,b,e,f)||this;a.elementType="i32";return a}q(a,c);a.ElementType="i32";return a}(e.BufferViewVec3Impl);d.BufferViewVec3i32=e;k=function(c){function a(a,b,e,f){void 0===b&&(b=0);a=c.call(this,Int32Array,a,b,e,f)||this;a.elementType="i32";return a}q(a,
c);a.ElementType="i32";return a}(k.BufferViewVec4Impl);d.BufferViewVec4i32=k})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(g,l,b,f,e){void 0===b&&(b=0);this.TypedArrayConstructor=g;this.elementCount=9;g=this.TypedArrayConstructor;void 0===f&&(f=9*g.BYTES_PER_ELEMENT);var k=0===l.byteLength?0:b;this.typedBuffer=null==e?new g(l,k):new g(l,k,(e-b)/g.BYTES_PER_ELEMENT);this.typedBufferStride=
f/g.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}d.prototype.getMat=function(g,l){g*=this.typedBufferStride;for(var b=0;9>b;b++)l[b]=this.typedBuffer[g+b];return l};d.prototype.setMat=function(g,l){g*=this.typedBufferStride;for(var b=0;9>b;b++)this.typedBuffer[g+b]=l[b]};d.prototype.get=function(g,l){return this.typedBuffer[g*this.typedBufferStride+l]};d.prototype.set=function(g,
l,b){this.typedBuffer[g*this.typedBufferStride+l]=b};d.prototype.copyFrom=function(g,l,b){var f=this.typedBuffer,e=l.typedBuffer;g*=this.typedBufferStride;l=b*l.typedBufferStride;for(b=0;9>b;++b)f[g+b]=e[l+b]};Object.defineProperty(d.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});d.ElementCount=9;return d}();d.BufferViewMat3Impl=t})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,
"__esModule",{value:!0});t=function(){function d(g,l,b,f,e){void 0===b&&(b=0);this.TypedArrayConstructor=g;this.elementCount=16;g=this.TypedArrayConstructor;void 0===f&&(f=16*g.BYTES_PER_ELEMENT);var k=0===l.byteLength?0:b;this.typedBuffer=null==e?new g(l,k):new g(l,k,(e-b)/g.BYTES_PER_ELEMENT);this.typedBufferStride=f/g.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}d.prototype.getMat=
function(g,l){g*=this.typedBufferStride;for(var b=0;16>b;b++)l[b]=this.typedBuffer[g+b];return l};d.prototype.setMat=function(g,l){g*=this.typedBufferStride;for(var b=0;16>b;b++)this.typedBuffer[g+b]=l[b]};d.prototype.get=function(g,l){return this.typedBuffer[g*this.typedBufferStride+l]};d.prototype.set=function(g,l,b){this.typedBuffer[g*this.typedBufferStride+l]=b};d.prototype.copyFrom=function(g,l,b){var f=this.typedBuffer,e=l.typedBuffer;g*=this.typedBufferStride;l=b*l.typedBufferStride;for(b=
0;16>b;++b)f[g+b]=e[l+b]};Object.defineProperty(d.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});d.ElementCount=16;return d}();d.BufferViewMat4Impl=t})},"esri/views/3d/support/buffer/internals/Scalar":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(g,l,b,f,e){void 0===b&&(b=0);this.TypedArrayConstructor=g;this.elementCount=1;g=this.TypedArrayConstructor;void 0===f&&(f=
g.BYTES_PER_ELEMENT);var k=0===l.byteLength?0:b;this.typedBuffer=null==e?new g(l,k):new g(l,k,(e-b)/g.BYTES_PER_ELEMENT);this.typedBufferStride=f/g.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}d.prototype.get=function(g){return this.typedBuffer[g*this.typedBufferStride]};d.prototype.set=function(g,l){this.typedBuffer[g*this.typedBufferStride]=l};Object.defineProperty(d.prototype,
"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});d.ElementCount=1;return d}();d.BufferViewScalarImpl=t})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function g(g,b,f,e,k){void 0===f&&(f=0);this.TypedArrayConstructor=g;this.elementCount=2;g=this.TypedArrayConstructor;void 0===e&&(e=2*g.BYTES_PER_ELEMENT);
var c=0===b.byteLength?0:f;this.typedBuffer=null==k?new g(b,c):new g(b,c,(k-f)/g.BYTES_PER_ELEMENT);this.typedBufferStride=e/g.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}g.prototype.getVec=function(g,b){return q.vec2.set(b,this.typedBuffer[g*this.typedBufferStride],this.typedBuffer[g*this.typedBufferStride+1])};g.prototype.setVec=function(g,b){this.typedBuffer[g*this.typedBufferStride]=
b[0];this.typedBuffer[g*this.typedBufferStride+1]=b[1]};g.prototype.get=function(g,b){return this.typedBuffer[g*this.typedBufferStride+b]};g.prototype.set=function(g,b,f){this.typedBuffer[g*this.typedBufferStride+b]=f};g.prototype.copyFrom=function(g,b,f){var e=this.typedBuffer,k=b.typedBuffer;g*=this.typedBufferStride;b=f*b.typedBufferStride;e[g]=k[b];e[g+1]=k[b+1]};Object.defineProperty(g.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});g.ElementCount=
2;return g}();d.BufferViewVec2Impl=t})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec3"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function g(g,b,f,e,k){void 0===f&&(f=0);this.TypedArrayConstructor=g;this.elementCount=3;g=this.TypedArrayConstructor;void 0===e&&(e=3*g.BYTES_PER_ELEMENT);var c=0===b.byteLength?0:f;this.typedBuffer=null==k?new g(b,c):new g(b,c,(k-f)/g.BYTES_PER_ELEMENT);
this.typedBufferStride=e/g.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}g.prototype.getVec=function(g,b){return q.vec3.set(b,this.typedBuffer[g*this.typedBufferStride],this.typedBuffer[g*this.typedBufferStride+1],this.typedBuffer[g*this.typedBufferStride+2])};g.prototype.setVec=function(g,b){this.typedBuffer[g*this.typedBufferStride]=b[0];this.typedBuffer[g*this.typedBufferStride+
1]=b[1];this.typedBuffer[g*this.typedBufferStride+2]=b[2]};g.prototype.get=function(g,b){return this.typedBuffer[g*this.typedBufferStride+b]};g.prototype.set=function(g,b,f){this.typedBuffer[g*this.typedBufferStride+b]=f};g.prototype.copyFrom=function(g,b,f){var e=this.typedBuffer,k=b.typedBuffer;g*=this.typedBufferStride;b=f*b.typedBufferStride;e[g]=k[b];e[g+1]=k[b+1];e[g+2]=k[b+2]};Object.defineProperty(g.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});
g.ElementCount=3;return g}();d.BufferViewVec3Impl=t})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec4"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function g(g,b,f,e,k){void 0===f&&(f=0);this.TypedArrayConstructor=g;this.elementCount=4;g=this.TypedArrayConstructor;void 0===e&&(e=4*g.BYTES_PER_ELEMENT);var c=0===b.byteLength?0:f;this.typedBuffer=null==k?new g(b,c):new g(b,c,(k-f)/g.BYTES_PER_ELEMENT);
this.typedBufferStride=e/g.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}g.prototype.getVec=function(g,b){return q.vec4.set(b,this.typedBuffer[g*this.typedBufferStride],this.typedBuffer[g*this.typedBufferStride+1],this.typedBuffer[g*this.typedBufferStride+2],this.typedBuffer[g*this.typedBufferStride+3])};g.prototype.setVec=function(g,b){this.typedBuffer[g*this.typedBufferStride]=
b[0];this.typedBuffer[g*this.typedBufferStride+1]=b[1];this.typedBuffer[g*this.typedBufferStride+2]=b[2];this.typedBuffer[g*this.typedBufferStride+3]=b[3]};g.prototype.get=function(g,b){return this.typedBuffer[g*this.typedBufferStride+b]};g.prototype.set=function(g,b,f){this.typedBuffer[g*this.typedBufferStride+b]=f};g.prototype.copyFrom=function(g,b,f){var e=this.typedBuffer,k=b.typedBuffer;g*=this.typedBufferStride;b=f*b.typedBufferStride;e[g]=k[b];e[g+1]=k[b+1];e[g+2]=k[b+2];e[g+3]=k[b+3]};Object.defineProperty(g.prototype,
"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});g.ElementCount=4;return g}();d.BufferViewVec4Impl=t})},"esri/core/libs/gl-matrix-2/vec4":function(){define(["require","exports","./math/vec4"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.vec4=q})},"esri/core/libs/gl-matrix-2/math/vec4":function(){define(["require","exports","./common"],function(t,d,q){function g(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];a[3]=c[3]-b[3];return a}
function l(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];a[2]=c[2]*b[2];a[3]=c[3]*b[3];return a}function b(a,c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];a[2]=c[2]/b[2];a[3]=c[3]/b[3];return a}function f(a,c){var b=c[0]-a[0],e=c[1]-a[1],f=c[2]-a[2];a=c[3]-a[3];return Math.sqrt(b*b+e*e+f*f+a*a)}function e(a,c){var b=c[0]-a[0],e=c[1]-a[1],f=c[2]-a[2];a=c[3]-a[3];return b*b+e*e+f*f+a*a}function k(a){var c=a[0],b=a[1],e=a[2];a=a[3];return Math.sqrt(c*c+b*b+e*e+a*a)}function c(a){var c=a[0],b=a[1],e=a[2];a=a[3];return c*
c+b*b+e*e+a*a}Object.defineProperty(d,"__esModule",{value:!0});d.copy=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];return a};d.set=function(a,c,b,e,f){a[0]=c;a[1]=b;a[2]=e;a[3]=f;return a};d.add=function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];a[3]=c[3]+b[3];return a};d.subtract=g;d.multiply=l;d.divide=b;d.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);a[2]=Math.ceil(c[2]);a[3]=Math.ceil(c[3]);return a};d.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);
a[2]=Math.floor(c[2]);a[3]=Math.floor(c[3]);return a};d.min=function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],b[1]);a[2]=Math.min(c[2],b[2]);a[3]=Math.min(c[3],b[3]);return a};d.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);a[1]=Math.max(c[1],b[1]);a[2]=Math.max(c[2],b[2]);a[3]=Math.max(c[3],b[3]);return a};d.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);a[2]=Math.round(c[2]);a[3]=Math.round(c[3]);return a};d.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;a[3]=
c[3]*b;return a};d.scaleAndAdd=function(a,c,b,e){a[0]=c[0]+b[0]*e;a[1]=c[1]+b[1]*e;a[2]=c[2]+b[2]*e;a[3]=c[3]+b[3]*e;return a};d.distance=f;d.squaredDistance=e;d.length=k;d.squaredLength=c;d.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=-c[3];return a};d.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];a[3]=1/c[3];return a};d.normalize=function(a,c){var b=c[0],e=c[1],f=c[2];c=c[3];var h=b*b+e*e+f*f+c*c;0<h&&(h=1/Math.sqrt(h),a[0]=b*h,a[1]=e*h,a[2]=f*h,a[3]=c*h);return a};d.dot=
function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};d.lerp=function(a,c,b,e){var f=c[0],h=c[1],k=c[2];c=c[3];a[0]=f+e*(b[0]-f);a[1]=h+e*(b[1]-h);a[2]=k+e*(b[2]-k);a[3]=c+e*(b[3]-c);return a};d.random=function(a,c){c=c||1;var b,e,f,h,k,g;do b=2*q.RANDOM()-1,e=2*q.RANDOM()-1,k=b*b+e*e;while(1<=k);do f=2*q.RANDOM()-1,h=2*q.RANDOM()-1,g=f*f+h*h;while(1<=g);k=Math.sqrt((1-k)/g);a[0]=c*b;a[1]=c*e;a[2]=c*f*k;a[3]=c*h*k;return a};d.transformMat4=function(a,c,b){var e=c[0],f=c[1],h=c[2];c=c[3];a[0]=
b[0]*e+b[4]*f+b[8]*h+b[12]*c;a[1]=b[1]*e+b[5]*f+b[9]*h+b[13]*c;a[2]=b[2]*e+b[6]*f+b[10]*h+b[14]*c;a[3]=b[3]*e+b[7]*f+b[11]*h+b[15]*c;return a};d.transformQuat=function(a,c,b){var e=c[0],f=c[1],h=c[2],k=b[0],g=b[1],p=b[2];b=b[3];var m=b*e+g*h-p*f,l=b*f+p*e-k*h,d=b*h+k*f-g*e,e=-k*e-g*f-p*h;a[0]=m*b+e*-k+l*-p-d*-g;a[1]=l*b+e*-g+d*-k-m*-p;a[2]=d*b+e*-p+m*-g-l*-k;a[3]=c[3];return a};d.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};d.exactEquals=function(a,c){return a[0]===c[0]&&
a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]};d.equals=function(a,c){var b=a[0],e=a[1],f=a[2];a=a[3];var h=c[0],k=c[1],g=c[2];c=c[3];return Math.abs(b-h)<=q.EPSILON*Math.max(1,Math.abs(b),Math.abs(h))&&Math.abs(e-k)<=q.EPSILON*Math.max(1,Math.abs(e),Math.abs(k))&&Math.abs(f-g)<=q.EPSILON*Math.max(1,Math.abs(f),Math.abs(g))&&Math.abs(a-c)<=q.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};d.sub=g;d.mul=l;d.div=b;d.dist=f;d.sqrDist=e;d.len=k;d.sqrLen=c})},"esri/views/3d/support/buffer/types":function(){define(["require",
"exports","../../../../core/compilerUtils"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.elementTypeSize=function(g){switch(g){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8;default:q.neverReached(g)}};d.isSigned=function(g){switch(g){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0;default:q.neverReached(g)}};d.isInteger=
function(g){switch(g){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1;default:q.neverReached(g)}};d.maximumValue=function(g){switch(g){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308;default:q.neverReached(g)}}})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./Util".split(" "),
function(t,d,q,g,l,b,f,e,k){var c=f.Vec3Compact,a;(function(a){for(var c=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],b=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],f=[0,0,1,0,1,1,0,1],h=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],g=Array(36),p=0;6>p;p++)for(var n=0;6>n;n++)g[6*p+n]=p;for(var r=Array(36),p=0;6>p;p++)r[6*p+0]=0,r[6*p+1]=1,r[6*p+2]=2,r[6*p+3]=2,r[6*p+4]=3,r[6*p+5]=0;a.createGeometry=function(a){Array.isArray(a)||
(a=[a,a,a]);for(var m=new Float32Array(24),p=0;8>p;p++)m[3*p]=c[p][0]*a[0],m[3*p+1]=c[p][1]*a[1],m[3*p+2]=c[p][2]*a[2];a={};a[k.VertexAttrConstants.POSITION]=new Uint32Array(h);a[k.VertexAttrConstants.NORMAL]=new Uint32Array(g);a[k.VertexAttrConstants.UV0]=new Uint32Array(r);p={};p[k.VertexAttrConstants.POSITION]={size:3,data:m};p[k.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(b)};p[k.VertexAttrConstants.UV0]={size:2,data:new Float32Array(f)};return new e(p,a)}})(a||(a={}));var h;(function(a){var c=
[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],b=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],f=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],h=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var m=new Float32Array(18),g=0;6>g;g++)m[3*g]=c[g][0]*a[0],m[3*g+1]=c[g][1]*a[1],m[3*g+2]=c[g][2]*a[2];a={};a[k.VertexAttrConstants.POSITION]=new Uint32Array(f);a[k.VertexAttrConstants.NORMAL]=new Uint32Array(h);
g={};g[k.VertexAttrConstants.POSITION]={size:3,data:m};g[k.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(b)};return new e(g,a)}})(h||(h={}));var p;(function(a){var c=g.vec3f32.fromValues(-.5,0,-.5),b=g.vec3f32.fromValues(.5,0,-.5),f=g.vec3f32.fromValues(0,0,.5),h=g.vec3f32.fromValues(0,.5,0),p=g.vec3f32.create(),n=g.vec3f32.create(),r=g.vec3f32.create(),l=g.vec3f32.create(),d=g.vec3f32.create();q.vec3.subtract(p,c,h);q.vec3.subtract(n,c,b);q.vec3.cross(r,p,n);q.vec3.normalize(r,r);q.vec3.subtract(p,
b,h);q.vec3.subtract(n,b,f);q.vec3.cross(l,p,n);q.vec3.normalize(l,l);q.vec3.subtract(p,f,h);q.vec3.subtract(n,f,c);q.vec3.cross(d,p,n);q.vec3.normalize(d,d);var v=[c,b,f,h],u=[0,-1,0,r[0],r[1],r[2],l[0],l[1],l[2],d[0],d[1],d[2]],y=[0,1,2,3,1,0,3,2,1,3,0,2],M=[0,0,0,1,1,1,2,2,2,3,3,3];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var c=new Float32Array(12),b=0;4>b;b++)c[3*b]=v[b][0]*a[0],c[3*b+1]=v[b][1]*a[1],c[3*b+2]=v[b][2]*a[2];a={};a[k.VertexAttrConstants.POSITION]=new Uint32Array(y);
a[k.VertexAttrConstants.NORMAL]=new Uint32Array(M);b={};b[k.VertexAttrConstants.POSITION]={size:3,data:c};b[k.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(u)};return new e(b,a)}})(p||(p={}));var n;(function(n){function d(a,c,b,e,f){if(Math.abs(q.vec3.dot(c,a))>f)return!1;q.vec3.cross(b,a,c);q.vec3.normalize(b,b);q.vec3.cross(e,b,a);q.vec3.normalize(e,e);return!0}function m(a,c,b,e,f,h,m){return d(a,c,f,h,m)||d(a,b,f,h,m)||d(a,e,f,h,m)}n.createBoxGeometry=a.createGeometry;n.createDiamondGeometry=
h.createGeometry;n.createTetrahedronGeometry=p.createGeometry;n.createSphereGeometry=function(a,c,b,f,h,m,g){a=a||50;f=void 0!==f?f:-Math.PI;h=void 0!==h?h:2*Math.PI;m=void 0!==m?m:.5*-Math.PI;g=void 0!==g?g:Math.PI;var p=Math.max(3,Math.floor(c)||8),n=Math.max(2,Math.floor(b)||6),r=(p+1)*(n+1);b=new Float32Array(3*r);c=new Float32Array(3*r);for(var r=new Float32Array(2*r),l=[],d=0,v=0;v<=n;v++){for(var u=[],x=v/n,A=m+x*g,y=Math.cos(A),C=0;C<=p;C++){var w=C/p,B=f+w*h,E=Math.cos(B)*y,q=Math.sin(A),
B=-Math.sin(B)*y;b[3*d]=E*a;b[3*d+1]=q*a;b[3*d+2]=B*a;c[3*d]=E;c[3*d+1]=q;c[3*d+2]=B;r[2*d]=w;r[2*d+1]=x;u.push(d);++d}l.push(u)}a=new Uint32Array(2*p*(n-1)*3);for(v=d=0;v<n;v++)for(C=0;C<p;C++)f=l[v][C],h=l[v][C+1],m=l[v+1][C+1],g=l[v+1][C],0===v?(a[d++]=f,a[d++]=m,a[d++]=g):v===n-1?(a[d++]=f,a[d++]=h,a[d++]=m):(a[d++]=f,a[d++]=h,a[d++]=m,a[d++]=m,a[d++]=g,a[d++]=f);k.assert(d===a.length);p={};p[k.VertexAttrConstants.POSITION]=a;p[k.VertexAttrConstants.NORMAL]=a;p[k.VertexAttrConstants.UV0]=a;n=
{};n[k.VertexAttrConstants.POSITION]={size:3,data:b};n[k.VertexAttrConstants.NORMAL]={size:3,data:c};n[k.VertexAttrConstants.UV0]={size:2,data:r};return new e(n,p)};n.createPolySphereGeometry=function(a,b,f){function h(b,e){b>e&&(e=[e,b],b=e[0],e=e[1]);var f=b.toString()+"."+e.toString();if(p[f])return p[f];var h=m.length;m.length+=3;c.add(m,3*b,m,3*e,m,h);c.scale(m,h,a/c.length(m,h));h/=3;return p[f]=h}var m;f?(m=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],f=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,
1,5,2,2,5,3,3,5,4,4,5,1])):(f=a*(1+Math.sqrt(5))/2,m=[-a,f,0,a,f,0,-a,-f,0,a,-f,0,0,-a,f,0,a,f,0,-a,-f,0,a,-f,f,0,-a,f,0,a,-f,0,-a,-f,0,a],f=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var g=0;g<m.length;g+=3)c.scale(m,g,a/c.length(m,g));for(var p={},g=0;g<b;g++){for(var n=f.length,d=new Uint32Array(4*n),r=0;r<n;r+=3){var l=f[r],v=f[r+1],u=f[r+2],x=h(l,v),A=h(v,u),y=h(u,l),C=4*r;d[C]=l;d[C+
1]=x;d[C+2]=y;d[C+3]=v;d[C+4]=A;d[C+5]=x;d[C+6]=u;d[C+7]=y;d[C+8]=A;d[C+9]=x;d[C+10]=A;d[C+11]=y}f=d;p={}}b=new Float32Array(m);for(g=0;g<b.length;g+=3)c.normalize(b,g);g={};g[k.VertexAttrConstants.POSITION]=f;g[k.VertexAttrConstants.NORMAL]=f;f={};f[k.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(m)};f[k.VertexAttrConstants.NORMAL]={size:3,data:b};return new e(f,g)};n.createPointGeometry=function(a,c,b,f,h,m,g){c=c?new Float64Array([c[0],c[1],c[2]]):new Float32Array([0,0,0]);a=a?new Float32Array([a[0],
a[1],a[2]]):new Float32Array([0,0,1]);m=m?new Float32Array(m):new Float32Array([0,0]);var p=b?new Uint8Array([255*b[0],255*b[1],255*b[2],3<b.length?255*b[3]:255]):new Uint8Array([255,255,255,255]),n=null!=f&&2===f.length?new Float32Array(f):new Float32Array([1,1]);f=new Uint32Array([0]);b={};b[k.VertexAttrConstants.POSITION]=f;b[k.VertexAttrConstants.NORMAL]=f;b[k.VertexAttrConstants.UV0]=f;b[k.VertexAttrConstants.COLOR]=f;b[k.VertexAttrConstants.SIZE]=f;var d={};d[k.VertexAttrConstants.POSITION]=
{size:3,data:c};d[k.VertexAttrConstants.NORMAL]={size:3,data:a};d[k.VertexAttrConstants.UV0]={size:m.length,data:m};d[k.VertexAttrConstants.COLOR]={size:4,data:p};d[k.VertexAttrConstants.SIZE]={size:2,data:n};null!=h&&(h=new Float32Array([h[0],h[1],h[2],h[3]]),b[k.VertexAttrConstants.AUXPOS1]=f,d[k.VertexAttrConstants.AUXPOS1]={size:4,data:h});null!=g&&(g=new Float32Array([g[0],g[1],g[2],g[3]]),b[k.VertexAttrConstants.AUXPOS2]=f,d[k.VertexAttrConstants.AUXPOS2]={size:4,data:g});return new e(d,b,e.DefaultOffsets,
"point")};n.createPointArrayGeometry=function(a,c){for(var b=new Float32Array(3*a.length),f=new Float32Array(c?3*a.length:3),h=new Uint32Array(a.length),m=new Uint32Array(a.length),g=0;g<a.length;g++)b[3*g]=a[g][0],b[3*g+1]=a[g][1],b[3*g+2]=a[g][2],c&&(f[3*g]=c[g][0],f[3*g+1]=c[g][1],f[3*g+2]=c[g][2]),h[g]=g,m[g]=0;c||(f[0]=0,f[1]=1,f[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;g={};g[k.VertexAttrConstants.POSITION]=h;g[k.VertexAttrConstants.NORMAL]=c?h:m;g[k.VertexAttrConstants.UV0]=m;c={};c[k.VertexAttrConstants.POSITION]=
{size:3,data:b};c[k.VertexAttrConstants.NORMAL]={size:3,data:f};c[k.VertexAttrConstants.UV0]={size:2,data:a};return new e(c,g,e.DefaultOffsets,"point")};n.createTriangleGeometry=function(){var a=new Float32Array([0,0,0,0,0,100,100,0,0]),c=new Uint32Array([0,1,2]),b=new Float32Array([0,1,0]),f=new Uint32Array([0,0,0]),h=new Float32Array([0,0]),m=new Uint32Array([0,0,0]),g={};g[k.VertexAttrConstants.POSITION]=c;g[k.VertexAttrConstants.NORMAL]=f;g[k.VertexAttrConstants.UV0]=m;c={};c[k.VertexAttrConstants.POSITION]=
{size:3,data:a};c[k.VertexAttrConstants.NORMAL]={size:3,data:b};c[k.VertexAttrConstants.UV0]={size:2,data:h};return new e(c,g)};n.createSquareGeometry=function(a){var c=new Float32Array(12);if(a)for(var b=0;4>b;b++)for(var f=0;3>f;f++)c[3*b+f]=a[b][f];else c[0]=-1,c[1]=-1,c[2]=0,c[3]=1,c[4]=-1,c[5]=0,c[6]=1,c[7]=1,c[8]=0,c[9]=-1,c[10]=1,c[11]=0;var h=new Uint32Array([0,1,2,2,3,0]);a=new Float32Array([0,0,1]);var g=new Uint32Array([0,0,0,0,0,0]),b=new Float32Array([0,0,1,0,1,1,0,1]),f=new Uint8Array([255,
255,255,255]),m={};m[k.VertexAttrConstants.POSITION]=h;m[k.VertexAttrConstants.NORMAL]=g;m[k.VertexAttrConstants.UV0]=h;m[k.VertexAttrConstants.COLOR]=g;h={};h[k.VertexAttrConstants.POSITION]={size:3,data:c};h[k.VertexAttrConstants.NORMAL]={size:3,data:a};h[k.VertexAttrConstants.UV0]={size:2,data:b};h[k.VertexAttrConstants.COLOR]={size:4,data:f};return new e(h,m)};n.createConeGeometry=function(a,c,b,f,h,m){void 0===h&&(h=!0);void 0===m&&(m=!0);var p=0,n=g.vec3f32.fromValues(0,p,0),d=g.vec3f32.fromValues(0,
p+a,0),r=g.vec3f32.fromValues(0,-1,0),l=g.vec3f32.fromValues(0,1,0);f&&(p=a,d=g.vec3f32.fromValues(0,0,0),n=g.vec3f32.fromValues(0,p,0),r=g.vec3f32.fromValues(0,1,0),l=g.vec3f32.fromValues(0,-1,0));n=[d,n];r=[r,l];l=b+2;d=Math.sqrt(a*a+c*c);if(f)for(f=b-1;0<=f;f--)v=2*Math.PI/b*f,u=g.vec3f32.fromValues(Math.cos(v)*c,p,Math.sin(v)*c),n.push(u),v=g.vec3f32.fromValues(a*Math.cos(v)/d,-c/d,a*Math.sin(v)/d),r.push(v);else for(f=0;f<b;f++){var v=2*Math.PI/b*f,u=g.vec3f32.fromValues(Math.cos(v)*c,p,Math.sin(v)*
c);n.push(u);v=g.vec3f32.fromValues(a*Math.cos(v)/d,c/d,a*Math.sin(v)/d);r.push(v)}a=new Uint32Array(6*(b+2));b=new Uint32Array(6*(b+2));p=c=0;if(h){for(f=3;f<n.length;f++)a[c++]=1,a[c++]=f-1,a[c++]=f,b[p++]=0,b[p++]=0,b[p++]=0;a[c++]=n.length-1;a[c++]=2;a[c++]=1;b[p++]=0;b[p++]=0;b[p++]=0}if(m){for(f=3;f<n.length;f++)a[c++]=f,a[c++]=f-1,a[c++]=0,b[p++]=f,b[p++]=f-1,b[p++]=1;a[c++]=0;a[c++]=2;a[c++]=n.length-1;b[p++]=1;b[p++]=2;b[p++]=r.length-1}h=new Float32Array(3*l);for(f=0;f<l;f++)h[3*f]=n[f][0],
h[3*f+1]=n[f][1],h[3*f+2]=n[f][2];m=new Float32Array(3*l);for(f=0;f<l;f++)m[3*f]=r[f][0],m[3*f+1]=r[f][1],m[3*f+2]=r[f][2];n={};n[k.VertexAttrConstants.POSITION]=a;n[k.VertexAttrConstants.NORMAL]=b;r={};r[k.VertexAttrConstants.POSITION]={size:3,data:h};r[k.VertexAttrConstants.NORMAL]={size:3,data:m};return new e(r,n)};n.createCylinderGeometry=function(a,c,b,f,h,m){f=f?g.vec3f32.clone(f):g.vec3f32.fromValues(1,0,0);h=h?g.vec3f32.clone(h):g.vec3f32.fromValues(0,0,0);m=void 0===m?!0:m;var p=g.vec3f32.create();
q.vec3.normalize(p,f);f=g.vec3f32.create();q.vec3.scale(f,p,Math.abs(a));var n=g.vec3f32.create();q.vec3.scale(n,f,-.5);q.vec3.add(n,n,h);var d=g.vec3f32.fromValues(0,1,0);.2>Math.abs(1-q.vec3.dot(p,d))&&q.vec3.set(d,0,0,1);var r=g.vec3f32.create();q.vec3.cross(r,p,d);q.vec3.normalize(r,r);q.vec3.cross(d,r,p);var l=2*b+(m?2:0),v=b+(m?2:0);a=new Float32Array(3*l);h=new Float32Array(3*v);var u=new Float32Array(2*l),x=new Uint32Array(3*b*(m?4:2)),A=new Uint32Array(3*b*(m?4:2));m&&(a[3*(l-2)+0]=n[0],
a[3*(l-2)+1]=n[1],a[3*(l-2)+2]=n[2],u[2*(l-2)]=0,u[2*(l-2)+1]=0,a[3*(l-1)+0]=a[3*(l-2)+0]+f[0],a[3*(l-1)+1]=a[3*(l-2)+1]+f[1],a[3*(l-1)+2]=a[3*(l-2)+2]+f[2],u[2*(l-1)]=1,u[2*(l-1)+1]=1,h[3*(v-2)+0]=-p[0],h[3*(v-2)+1]=-p[1],h[3*(v-2)+2]=-p[2],h[3*(v-1)+0]=p[0],h[3*(v-1)+1]=p[1],h[3*(v-1)+2]=p[2]);for(var p=function(a,c,b){x[a]=c;A[a]=b},y=0,w=g.vec3f32.create(),C=g.vec3f32.create(),B=0;B<b;B++){var E=2*Math.PI/b*B;q.vec3.scale(w,d,Math.sin(E));q.vec3.scale(C,r,Math.cos(E));q.vec3.add(w,w,C);h[3*B+
0]=w[0];h[3*B+1]=w[1];h[3*B+2]=w[2];q.vec3.scale(w,w,c);q.vec3.add(w,w,n);a[3*B+0]=w[0];a[3*B+1]=w[1];a[3*B+2]=w[2];u[2*B+0]=B/b;u[2*B+1]=0;a[3*(B+b)+0]=a[3*B+0]+f[0];a[3*(B+b)+1]=a[3*B+1]+f[1];a[3*(B+b)+2]=a[3*B+2]+f[2];u[2*(B+b)+0]=B/b;u[2*B+1]=1;E=(B+1)%b;p(y++,B,B);p(y++,B+b,B);p(y++,E,E);p(y++,E,E);p(y++,B+b,B);p(y++,E+b,E)}if(m){for(B=0;B<b;B++)E=(B+1)%b,p(y++,l-2,v-2),p(y++,B,v-2),p(y++,E,v-2);for(B=0;B<b;B++)E=(B+1)%b,p(y++,B+b,v-1),p(y++,l-1,v-1),p(y++,E+b,v-1)}c={};c[k.VertexAttrConstants.POSITION]=
x;c[k.VertexAttrConstants.NORMAL]=A;c[k.VertexAttrConstants.UV0]=x;b={};b[k.VertexAttrConstants.POSITION]={size:3,data:a};b[k.VertexAttrConstants.NORMAL]={size:3,data:h};b[k.VertexAttrConstants.UV0]={size:2,data:u};return new e(b,c)};n.createTubeGeometry=function(a,c,b,e,f){b=b||10;e=null!=e?e:!0;k.assert(1<a.length);for(var h=[],m=[],g=0;g<b;g++){h.push([0,-g-1,-((g+1)%b)-1]);var p=g/b*2*Math.PI;m.push([Math.cos(p)*c,Math.sin(p)*c])}return n.createPathExtrusionGeometry(m,a,[[0,0,0]],h,e,f)};n.createPathExtrusionGeometry=
function(a,c,f,h,p,n){void 0===n&&(n=g.vec3f32.fromValues(0,0,0));var d=a.length,r=new Float32Array(c.length*d*3+(6*f.length||0)),v=new Float32Array(c.length*d+(2*f.length||0)),x=new Float32Array(c.length*d*3+(f?6:0)),A=(c.length-1)*d*6+6*h.length,y=new Uint32Array(A),A=new Uint32Array(A),w=0,C=0,B=0,E=0,I=0,X=g.vec3f32.create(),J=g.vec3f32.create(),R=g.vec3f32.create(),T=g.vec3f32.create(),t=g.vec3f32.create(),Z=g.vec3f32.create(),fa=g.vec3f32.create(),ga=l.vec3f64.create(),ja=g.vec3f32.create(),
ia=g.vec3f32.create(),ka=g.vec3f32.create(),da=g.vec3f32.create(),Y=g.vec3f32.create(),ha=b.plane.create();q.vec3.set(ja,0,1,0);q.vec3.subtract(J,c[1],c[0]);q.vec3.normalize(J,J);p?(q.vec3.add(ga,c[0],n),q.vec3.normalize(R,ga)):q.vec3.set(R,0,0,1);m(J,R,ja,ja,t,R,u);q.vec3.copy(T,R);q.vec3.copy(da,t);for(var ea=0;ea<f.length;ea++)q.vec3.scale(Z,t,f[ea][0]),q.vec3.scale(ga,R,f[ea][2]),q.vec3.add(Z,Z,ga),q.vec3.add(Z,Z,c[0]),r[w++]=Z[0],r[w++]=Z[1],r[w++]=Z[2],v[B++]=0;x[C++]=-J[0];x[C++]=-J[1];x[C++]=
-J[2];for(ea=0;ea<h.length;ea++)y[E++]=0<h[ea][0]?h[ea][0]:-h[ea][0]-1+f.length,y[E++]=0<h[ea][1]?h[ea][1]:-h[ea][1]-1+f.length,y[E++]=0<h[ea][2]?h[ea][2]:-h[ea][2]-1+f.length,A[I++]=0,A[I++]=0,A[I++]=0;for(var ma=f.length,ea=f.length-1,aa=0;aa<c.length;aa++){var qa=!1;0<aa&&(q.vec3.copy(X,J),aa<c.length-1?(q.vec3.subtract(J,c[aa+1],c[aa]),q.vec3.normalize(J,J)):qa=!0,q.vec3.add(ia,X,J),q.vec3.normalize(ia,ia),q.vec3.add(ka,c[aa-1],T),b.plane.fromPositionAndNormal(c[aa],ia,ha),b.plane.intersectRay(ha,
b.ray.wrap(ka,X),ga)?(q.vec3.subtract(ga,ga,c[aa]),q.vec3.normalize(R,ga),q.vec3.cross(t,ia,R),q.vec3.normalize(t,t)):m(ia,T,da,ja,t,R,u),q.vec3.copy(T,R),q.vec3.copy(da,t));p&&(q.vec3.add(ga,c[aa],n),q.vec3.normalize(Y,ga));for(var na=0;na<d;na++)if(q.vec3.scale(Z,t,a[na][0]),q.vec3.scale(ga,R,a[na][1]),q.vec3.add(Z,Z,ga),q.vec3.normalize(fa,Z),x[C++]=fa[0],x[C++]=fa[1],x[C++]=fa[2],p?v[B++]=q.vec3.dot(Z,Y):v[B++]=Z[2],q.vec3.add(Z,Z,c[aa]),r[w++]=Z[0],r[w++]=Z[1],r[w++]=Z[2],!qa){var sa=(na+1)%
d;y[E++]=ma+na;y[E++]=ma+d+na;y[E++]=ma+sa;y[E++]=ma+sa;y[E++]=ma+d+na;y[E++]=ma+d+sa;for(sa=0;6>sa;sa++)A[I++]=y[E-6+sa]-ea}ma+=d}a=c[c.length-1];for(ea=0;ea<f.length;ea++)q.vec3.scale(Z,t,f[ea][0]),q.vec3.scale(ga,R,f[ea][1]),q.vec3.add(Z,Z,ga),q.vec3.add(Z,Z,a),r[w++]=Z[0],r[w++]=Z[1],r[w++]=Z[2],v[B++]=0;f=C/3;x[C++]=J[0];x[C++]=J[1];x[C++]=J[2];d=ma-d;for(ea=0;ea<h.length;ea++)y[E++]=0<=h[ea][0]?ma+h[ea][0]:-h[ea][0]-1+d,y[E++]=0<=h[ea][2]?ma+h[ea][2]:-h[ea][2]-1+d,y[E++]=0<=h[ea][1]?ma+h[ea][1]:
-h[ea][1]-1+d,A[I++]=f,A[I++]=f,A[I++]=f;h={};h[k.VertexAttrConstants.POSITION]=y;h[k.VertexAttrConstants.NORMAL]=A;y={};y[k.VertexAttrConstants.POSITION]={size:3,data:r};y.zOffset={size:1,data:v};y[k.VertexAttrConstants.NORMAL]={size:3,data:x};return new e(y,h)};n.createPolylineGeometry=function(a,c){k.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");k.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");k.assert(void 0===c||c.length===a.length,"createPolylineGeometry: need same number of points and normals");
k.assert(void 0===c||3===c[0].length,"createPolylineGeometry(): malformed normal");for(var b=new Float32Array(3*a.length),f=new Uint32Array(2*(a.length-1)),h=0,m=0,g=0;g<a.length;g++){for(var p=0;3>p;p++)b[h++]=a[g][p];0<g&&(f[m++]=g-1,f[m++]=g)}h={};m={};h[k.VertexAttrConstants.POSITION]=f;m[k.VertexAttrConstants.POSITION]={size:3,data:b};if(c){for(var b=new Float32Array(3*c.length),n=0,g=0;g<a.length;g++)for(p=0;3>p;p++)b[n++]=c[g][p];h[k.VertexAttrConstants.NORMAL]=f;m[k.VertexAttrConstants.NORMAL]=
{size:3,data:b}}return new e(m,h,e.DefaultOffsets,"line")};n.createExtrudedTriangle=function(a,c,b,f){var h,m,g=new Float32Array(18);a=[[-c,0,f/2],[b,0,f/2],[0,a,f/2],[-c,0,-f/2],[b,0,-f/2],[0,a,-f/2]];for(c=0;6>c;c++)g[3*c]=a[c][0],g[3*c+1]=a[c][1],g[3*c+2]=a[c][2];a=(h={},h[k.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),h);h=(m={},m[k.VertexAttrConstants.POSITION]={size:3,data:g},m);return new e(h,a)};n.transformInPlace=function(a,c){a=a.vertexAttributes[k.VertexAttrConstants.POSITION].data;
for(var b=0;b<a.length;b+=3)q.vec3.set(v,a[b],a[b+1],a[b+2]),q.vec3.transformMat4(v,v,c),a[b]=v[0],a[b+1]=v[1],a[b+2]=v[2]};n.addVertexColors=function(a,c){var b=c||[1,1,1,1];c=new Uint8Array(4);c[0]=255*b[0];c[1]=255*b[1];c[2]=255*b[2];c[3]=255*(3<b.length?b[3]:1);var b={},f=a.getVertexAttr(),h;for(h in f)b[h]=f[h];b[k.VertexAttrConstants.COLOR]={size:4,data:c};c={};for(h in a.indices)c[h]=a.indices[h];c[k.VertexAttrConstants.COLOR]=new Uint32Array(c[k.VertexAttrConstants.POSITION].length);return a=
new e(b,c,a.componentOffsets,a.primitiveType)};n.addNormals=function(a){var c=a.getVertexAttr();a=a.indices;for(var b=f.Vec3Compact.subtract,e=new Float32Array(a.position.length/3*3),h=c.position.data,m=0,g=a.position,p=new Uint32Array(g.length),n=0;n<g.length;n+=3){b(h,3*g[n],h,3*g[n+2],r,0);b(h,3*g[n],h,3*g[n+1],v,0);q.vec3.cross(v,v,r);q.vec3.normalize(v,v);var d=m/3;e[m++]=v[0];e[m++]=v[1];e[m++]=v[2];p[n]=d;p[n+1]=d;p[n+2]=d}c[k.VertexAttrConstants.NORMAL]={size:3,data:e,offsetIdx:0,strideIdx:3};
a[k.VertexAttrConstants.NORMAL]=p};n.cgToGIS=function(a,c){void 0===c&&(c=a);var b=a.getVertexAttr();a=b.position.data;var b=b.normal.data,e=c.getVertexAttr(),f=e.position.data,e=e.normal.data;if(b)for(var h=0;h<b.length;h+=3){var m=b[h+1];e[h+1]=-b[h+2];e[h+2]=m}if(a)for(h=0;h<a.length;h+=3)m=a[h+1],f[h+1]=-a[h+2],f[h+2]=m;return c};n.makeOrthoBasisDirUp=d;n.makeOrthoBasisDirUpFallback=m})(n||(n={}));var u=.99619469809,v=g.vec3f32.create(),r=g.vec3f32.create();return n})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["require",
"exports","./factories/vec3f32"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.vec3f32=q})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.create=function(){return new Float32Array(3)};d.clone=function(d){var g=new Float32Array(3);g[0]=d[0];g[1]=d[1];g[2]=d[2];return g};d.fromValues=function(d,g,l){var b=new Float32Array(3);b[0]=d;b[1]=g;b[2]=l;return b};d.createView=function(d,
g){return new Float32Array(d,g,3)}})},"esri/views/3d/support/geometryUtils":function(){define("require exports ./geometryUtils/axisAngle ./geometryUtils/boundedPlane ./geometryUtils/frustum ./geometryUtils/lineSegment ./geometryUtils/plane ./geometryUtils/ray ./geometryUtils/sphere ./geometryUtils/triangle ./geometryUtils/vector".split(" "),function(t,d,q,g,l,b,f,e,k,c,a){Object.defineProperty(d,"__esModule",{value:!0});d.plane=f;d.boundedPlane=g;d.triangle=c;d.lineSegment=b;d.ray=e;d.sphere=k;d.frustum=
l;d.vector=a;d.axisAngle=q})},"esri/views/3d/support/geometryUtils/axisAngle":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../stack","./vector"],function(t,d,q,g,l){function b(b){void 0===b&&(b=d.UP);return[b[0],b[1],b[2],b[3]]}function f(e,f,c,a,h){void 0===h&&(h=b());h[0]=e;h[1]=f;h[2]=c;h[3]=a;return h}Object.defineProperty(d,"__esModule",{value:!0});d.create=b;d.wrap=function(b,k,c,a){return f(b,k,c,a,g.sv4d.get())};d.wrapAxisAngle=function(b,k){return f(b[0],
b[1],b[2],k,g.sv4d.get())};d.copy=function(e,g){void 0===g&&(g=b());return f(e[0],e[1],e[2],e[3],g)};d.fromValues=f;d.fromAxisAndAngle=function(e,f,c){void 0===c&&(c=b());q.vec3.copy(c,e);c[3]=f;return c};d.fromPoints=function(e,f,c){void 0===c&&(c=b());q.vec3.cross(c,e,f);q.vec3.normalize(c,c);c[3]=l.angle(e,f);return c};d.UP=[0,0,1,0]})},"esri/views/3d/support/stack":function(){define(["require","exports","../../../core/VectorStack"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});
d.sv2d=q.VectorStack.createVec2f64();d.sv3d=q.VectorStack.createVec3f64();d.sv4d=q.VectorStack.createVec4f64();d.sm3d=q.VectorStack.createMat3f64();d.sm4d=q.VectorStack.createMat4f64();d.sq4d=q.VectorStack.createQuatf64()})},"esri/core/VectorStack":function(){define("require exports ./nextTick ./libs/gl-matrix-2/mat3f64 ./libs/gl-matrix-2/mat4f64 ./libs/gl-matrix-2/quatf64 ./libs/gl-matrix-2/vec2f64 ./libs/gl-matrix-2/vec3f64 ./libs/gl-matrix-2/vec4f64".split(" "),function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,
"__esModule",{value:!0});t=function(){function a(a,c,b){var e=this;this.itemByteSize=a;this.itemCreate=c;this.buffers=[];this.items=[];this.itemsPtr=this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(b/this.itemByteSize);this.tickHandle=q.before(function(){return e.reset()})}a.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.itemsPtr=0;this.buffers=this.items=null};a.prototype.get=function(){0===this.itemsPtr&&q(function(){});for(var a=Math.floor(this.itemsPtr/
this.itemsPerBuffer);this.buffers.length<=a;){for(var c=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),b=0;b<this.itemsPerBuffer;++b)this.items.push(this.itemCreate(c,b*this.itemByteSize));this.buffers.push(c)}return this.items[this.itemsPtr++]};a.prototype.reset=function(){for(var a=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>a;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0};a.createVec2f64=function(b){void 0===b&&
(b=c);return new a(16,f.vec2f64.createView,b)};a.createVec3f64=function(b){void 0===b&&(b=c);return new a(24,e.vec3f64.createView,b)};a.createVec4f64=function(b){void 0===b&&(b=c);return new a(32,k.vec4f64.createView,b)};a.createMat3f64=function(b){void 0===b&&(b=c);return new a(72,g.mat3f64.createView,b)};a.createMat4f64=function(b){void 0===b&&(b=c);return new a(128,l.mat4f64.createView,b)};a.createQuatf64=function(e){void 0===e&&(e=c);return new a(32,b.quatf64.createView,e)};Object.defineProperty(a.prototype,
"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!0,configurable:!0});return a}();d.VectorStack=t;var c=4096})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.mat3f64=q})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.create=
function(){return[1,0,0,0,1,0,0,0,1]};d.clone=function(d){return[d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8]]};d.fromValues=function(d,g,l,b,f,e,k,c,a){return[d,g,l,b,f,e,k,c,a]};d.createView=function(d,g){return new Float64Array(d,g,9)}})},"esri/core/libs/gl-matrix-2/quatf64":function(){define(["require","exports","./factories/quatf64"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.quatf64=q})},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["require","exports"],
function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.create=function(){return[0,0,0,1]};d.clone=function(d){return[d[0],d[1],d[2],d[3]]};d.fromValues=function(d,g,l,b){return[d,g,l,b]};d.createView=function(d,g){return new Float64Array(d,g,4)}})},"esri/views/3d/support/geometryUtils/vector":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../mathUtils"],function(t,d,q,g){function l(b,f){return q.vec3.dot(b,f)/q.vec3.length(b)}Object.defineProperty(d,"__esModule",
{value:!0});d.projectPoint=function(b,f,e){f=l(b,f);return q.vec3.scale(e,b,f)};d.projectPointSignedLength=l;d.angle=function(b,f){b=q.vec3.dot(b,f)/(q.vec3.length(b)*q.vec3.length(f));return-g.acos(b)}})},"esri/views/3d/support/geometryUtils/boundedPlane":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack ./lineSegment ./plane ./ray ./vector".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u){function v(a){void 0===a&&(a=d.UP);return{plane:p.create(a.plane),origin:k.vec3f64.clone(a.origin),basis1:k.vec3f64.clone(a.basis1),basis2:k.vec3f64.clone(a.basis2)}}function r(a,c){void 0===c&&(c=v());return y(a.origin,a.basis1,a.basis2,c)}function y(a,c,b,f){void 0===f&&(f=v());e.vec3.copy(f.origin,a);e.vec3.copy(f.basis1,c);e.vec3.copy(f.basis2,b);p.fromVectorsAndPoint(b,c,a,f.plane);a=f;1E-6<Math.abs(e.vec3.dot(a.basis1,a.basis2)/(e.vec3.length(a.basis1)*
e.vec3.length(a.basis2)))&&M.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(e.vec3.dot(a.basis1,a.plane))&&M.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-e.vec3.dot(a.plane,a.origin)-a.plane[3])&&M.warn("fromValues()","Plane offset is not consistent with plane origin");return f}function w(c,b,f){c!==f&&r(c,f);c=e.vec3.scale(a.sv3d.get(),c.plane,b);e.vec3.add(f.origin,f.origin,c);f.plane[3]-=b;return f}function m(a,c){void 0===
c&&(c=v());var b=(a[2]-a[0])/2,f=(a[3]-a[1])/2;e.vec3.set(c.origin,a[0]+b,a[1]+f,0);e.vec3.set(c.basis1,b,0,0);e.vec3.set(c.basis2,0,f,0);p.fromValues(0,0,1,0,c.plane);return c}function x(a,c,b){return p.intersectRay(a.plane,c,b)?G(a,b):!1}function A(b,f,h){var m=Q.get(),g=Q.get();K(b,f,m,g);for(var g=Number.POSITIVE_INFINITY,k=0,n=N;k<n.length;k++){var d=F(b,n[k],P.get()),r=a.sv3d.get();p.intersectLineSegment(m,d,r)&&(d=c.directionFromTo(a.sv3d.get(),f.origin,r),d=Math.abs(c.acos(e.vec3.dot(f.direction,
d))),d<g&&(g=d,e.vec3.copy(h,r)))}return g===Number.POSITIVE_INFINITY?C(b,f,h):h}function C(c,b,f){if(x(c,b,f))return f;var h=Q.get(),m=Q.get();K(c,b,h,m);for(var g=Number.POSITIVE_INFINITY,k=0,d=N;k<d.length;k++){var r=F(c,d[k],P.get()),l=a.sv3d.get();p.intersectLineSegmentClamp(h,r,l)&&(r=n.distance2(b,l),p.isPointInside(m,l)&&r<g&&(g=r,e.vec3.copy(f,l)))}E(c,b.origin)<g&&e.vec3.copy(f,b.origin);return f}function B(c,b,f){var h=c.origin,m=c.basis1,g=c.basis2;b=e.vec3.subtract(a.sv3d.get(),b,h);
m=u.projectPointSignedLength(m,b)/e.vec3.length(m);g=u.projectPointSignedLength(g,b)/e.vec3.length(g);c=u.projectPointSignedLength(c.plane,b);return e.vec3.set(f,m,g,c)}function E(c,b){b=B(c,b,a.sv3d.get());var f=c.basis2;c=e.vec3.length(c.basis1);f=e.vec3.length(f);c=Math.max(Math.abs(b[0])-c,0);f=Math.max(Math.abs(b[1])-f,0);b=b[2];return c*c+f*f+b*b}function I(a,c){var b=-a.plane[3];return u.projectPointSignedLength(a.plane,c)-b}function G(c,b){var f=e.vec3.subtract(a.sv3d.get(),b,c.origin);b=
e.vec3.squaredLength(c.basis1);var h=e.vec3.squaredLength(c.basis2),m=e.vec3.dot(c.basis1,f);c=e.vec3.dot(c.basis2,f);return 0>-m-b&&0>m-b&&0>-c-h&&0>c-h}function L(a,c){var b=P.get();e.vec3.copy(b.origin,a.origin);e.vec3.copy(b.vector,c);return b}function F(c,b,f){var h=c.basis1,m=c.basis2;c=c.origin;var g=e.vec3.scale(a.sv3d.get(),h,b.origin[0]),k=e.vec3.scale(a.sv3d.get(),m,b.origin[1]);e.vec3.add(f.origin,g,k);e.vec3.add(f.origin,f.origin,c);h=e.vec3.scale(a.sv3d.get(),h,b.direction[0]);b=e.vec3.scale(a.sv3d.get(),
m,b.direction[1]);e.vec3.scale(f.vector,e.vec3.add(h,h,b),2);return f}function K(a,c,b,e){a=a.plane;p.fromVectorsAndPoint(a,c.direction,c.origin,b);p.fromVectorsAndPoint(b,a,c.origin,e)}Object.defineProperty(d,"__esModule",{value:!0});var M=g.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");t=function(){return function(){this.plane=p.create();this.origin=k.vec3f64.create();this.basis1=k.vec3f64.create();this.basis2=k.vec3f64.create()}}();d.BoundedPlaneClass=t;d.create=v;d.wrap=function(a,
c,b){var e=U.get();e.origin=a;e.basis1=c;e.basis2=b;e.plane=p.fromVectorsAndPoint(b,c,a,p.wrap(0,0,0,0));return e};d.copy=r;d.fromValues=y;d.elevate=w;d.setExtent=function(a,c,b){m(c,b);w(b,I(a,a.origin),b);return b};d.fromAABoundingRect=m;d.intersectRay=x;d.intersectRayClosestSilhouette=function(c,b,f){if(x(c,b,f))return f;c=A(c,b,a.sv3d.get());e.vec3.add(f,b.origin,e.vec3.scale(a.sv3d.get(),b.direction,e.vec3.distance(b.origin,c)/e.vec3.length(b.direction)));return f};d.closestPointOnSilhouette=
A;d.closestPoint=C;d.projectPoint=function(c,b,f){var m=p.projectPoint(c.plane,b,a.sv3d.get());b=h.projectPointClamp(L(c,c.basis1),m,-1,1,a.sv3d.get());m=h.projectPointClamp(L(c,c.basis2),m,-1,1,a.sv3d.get());e.vec3.subtract(f,e.vec3.add(a.sv3d.get(),b,m),c.origin);return f};d.projectPointLocal=B;d.distance2=E;d.distance=function(a,c){return Math.sqrt(E(a,c))};d.distanceToSilhouette=function(a,c){for(var b=Number.NEGATIVE_INFINITY,e=0,f=N;e<f.length;e++){var m=F(a,f[e],P.get()),m=h.distance2(m,c);
m>b&&(b=m)}return Math.sqrt(b)};d.extrusionContainsPoint=function(a,c){return p.isPointInside(a.plane,c)&&G(a,c)};d.axisAt=function(a,c,b,f){switch(b){case 0:e.vec3.copy(f,a.basis1);e.vec3.normalize(f,f);break;case 1:e.vec3.copy(f,a.basis2);e.vec3.normalize(f,f);break;case 2:e.vec3.copy(f,a.plane);break;default:q.neverReached(b)}return f};d.altitudeAt=I;d.setAltitudeAt=function(a,c,b,f){var h=I(a,c);a=e.vec3.scale(O,a.plane,b-h);e.vec3.add(f,c,a);return f};d.transform=function(a,c,f){a!==f&&r(a,f);
b.mat4.invert(V,c);b.mat4.transpose(V,V);e.vec3.transformMat4(f.basis1,a.basis1,V);e.vec3.transformMat4(f.basis2,a.basis2,V);e.vec3.transformMat4(f.plane,a.plane,V);e.vec3.transformMat4(f.origin,a.origin,c);p.setOffsetFromPoint(f.plane,f.origin,f.plane);return f};d.UP={plane:p.create(),origin:k.vec3f64.fromValues(0,0,0),basis1:k.vec3f64.fromValues(1,0,0),basis2:k.vec3f64.fromValues(0,1,0)};var Q=new l.ObjectStack(p.create),P=new l.ObjectStack(h.create),O=k.vec3f64.create(),U=new l.ObjectStack(function(){return{origin:null,
basis1:null,basis2:null,plane:null}}),N=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],V=f.mat4f64.create()})},"esri/core/ObjectStack":function(){define(["require","exports","./nextTick"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(b){var f=this;this.allocator=b;this.items=[];this.itemsPtr=0;this.tickHandle=q.before(function(){return f.reset()});this.grow()}d.prototype.destroy=
function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.items=null};d.prototype.get=function(){0===this.itemsPtr&&q(function(){});this.itemsPtr===this.items.length&&this.grow();return this.items[this.itemsPtr++]};d.prototype.reset=function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*g),this.items.length);this.itemsPtr=0};d.prototype.grow=function(){for(var b=0;b<Math.max(8,Math.min(this.items.length,g));b++)this.items.push(this.allocator())};
return d}();d.ObjectStack=t;var g=1024;d.default=t})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack".split(" "),function(t,d,q,g,l,b,f){function e(a){return a?{origin:l.vec3f64.clone(a.origin),vector:l.vec3f64.clone(a.vector)}:{origin:l.vec3f64.create(),vector:l.vec3f64.create()}}function k(a,c){var b=u.get();b.origin=a;b.vector=
c;return b}function c(a,c,b){void 0===b&&(b=e());g.vec3.copy(b.origin,a);g.vec3.copy(b.vector,c);return b}function a(a,c){c=g.vec3.subtract(f.sv3d.get(),c,a.origin);var e=g.vec3.dot(a.vector,c),h=g.vec3.dot(a.vector,a.vector),e=b.clamp(e/h,0,1);a=g.vec3.subtract(f.sv3d.get(),g.vec3.scale(f.sv3d.get(),a.vector,e),c);return g.vec3.dot(a,a)}function h(a,c,e,h,m){var k=a.vector,p=a.origin;c=g.vec3.subtract(f.sv3d.get(),c,p);p=g.vec3.length(k);c=g.vec3.dot(k,c)/p;g.vec3.scale(m,k,b.clamp(c,e,h));return g.vec3.add(m,
m,a.origin)}function p(a,c,e,h){var m=a.origin,k=g.vec3.add(f.sv3d.get(),m,a.vector);a=c.origin;var p=g.vec3.add(f.sv3d.get(),a,c.vector),n=f.sv3d.get();c=f.sv3d.get();n[0]=m[0]-a[0];n[1]=m[1]-a[1];n[2]=m[2]-a[2];c[0]=p[0]-a[0];c[1]=p[1]-a[1];c[2]=p[2]-a[2];if(1E-6>Math.abs(c[0])&&1E-6>Math.abs(c[1])&&1E-6>Math.abs(c[2]))return!1;p=f.sv3d.get();p[0]=k[0]-m[0];p[1]=k[1]-m[1];p[2]=k[2]-m[2];if(1E-6>Math.abs(p[0])&&1E-6>Math.abs(p[1])&&1E-6>Math.abs(p[2]))return!1;var k=n[0]*c[0]+n[1]*c[1]+n[2]*c[2],
d=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],l=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],r=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*l-d*d;if(1E-6>Math.abs(r))return!1;n=(k*d-(n[0]*p[0]+n[1]*p[1]+n[2]*p[2])*l)/r;k=(k+d*n)/l;e&&(n=b.clamp(n,0,1),k=b.clamp(k,0,1));e=f.sv3d.get();d=f.sv3d.get();e[0]=m[0]+n*p[0];e[1]=m[1]+n*p[1];e[2]=m[2]+n*p[2];d[0]=a[0]+k*c[0];d[1]=a[1]+k*c[1];d[2]=a[2]+k*c[2];h.tA=n;h.tB=k;h.pA=e;h.pB=d;h.distance2=g.vec3.squaredDistance(e,d);return!0}Object.defineProperty(d,"__esModule",{value:!0});d.create=e;d.wrap=
k;d.copy=function(a,b){void 0===b&&(b=e());return c(a.origin,a.vector,b)};d.fromValues=c;d.fromPoints=function(a,c,b){void 0===b&&(b=e());g.vec3.copy(b.origin,a);g.vec3.subtract(b.vector,c,a);return b};d.distance2=a;d.distance=function(c,b){return Math.sqrt(a(c,b))};d.projectPoint=function(a,c,b){return h(a,c,0,1,b)};d.projectPointClamp=h;d.closestRayDistance2=function(a,c){if(p(a,k(c.origin,c.direction),!1,n)){c=n.tA;var b=n.pB,e=n.distance2;if(0<=c&&1>=c)return e;if(0>c)return g.vec3.squaredDistance(a.origin,
b);if(1<c)return g.vec3.squaredDistance(g.vec3.add(f.sv3d.get(),a.origin,a.vector),b)}return null};d.closestLineSegmentPoint=function(a,c,b){return p(a,c,!0,n)?(g.vec3.copy(b,n.pA),!0):!1};d.closestLineSegmentDistance2=function(a,c){return p(a,c,!0,n)?n.distance2:null};var n={tA:0,tB:0,pA:l.vec3f64.create(),pB:l.vec3f64.create(),distance2:0},u=new q.ObjectStack(function(){return{origin:null,vector:null}})})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3",
"../mathUtils","../stack"],function(t,d,q,g,l){function b(a){void 0===a&&(a=d.UP);return[a[0],a[1],a[2],a[3]]}function f(a,c){void 0===c&&(c=b());return e(a[0],a[1],a[2],a[3],c)}function e(a,c,e,f,h){void 0===h&&(h=b());h[0]=a;h[1]=c;h[2]=e;h[3]=f;return h}function k(a,e,f){void 0===f&&(f=b());q.vec3.copy(f,e);e=q.vec3.dot(e,e);1E-5<Math.abs(e-1)&&1E-12<e&&q.vec3.scale(f,f,1/Math.sqrt(e));c(f,a,f);return f}function c(a,c,b){a!==b&&f(a,b);b[3]=-q.vec3.dot(b,c);return b}function a(a,c,e,f){void 0===
f&&(f=b());a=q.vec3.cross(l.sv3d.get(),c,a);return k(e,a,f)}function h(a,c,b){a=q.vec3.scale(l.sv3d.get(),a,q.vec3.dot(a,c));q.vec3.subtract(b,c,a);return b}function p(a,c){return q.vec3.dot(a,c)+a[3]}function n(a,c,b,e,f,h){var m=q.vec3.dot(a,b);if(0===m)return!1;a=-(q.vec3.dot(a,c)+a[3])/m;f&&(a=e?Math.max(0,a):g.clamp(a,0,1));if(0>a||!e&&1<a)return!1;q.vec3.add(h,c,q.vec3.scale(h,b,a));return!0}Object.defineProperty(d,"__esModule",{value:!0});d.create=b;d.wrap=function(a,c,b,f){return e(a,c,b,
f,l.sv4d.get())};d.copy=f;d.fromValues=e;d.fromNormalAndOffset=function(a,c,e){void 0===e&&(e=b());q.vec3.copy(e,a);e[3]=c;return e};d.fromPositionAndNormal=k;d.fromPoints=function(c,e,f,h){void 0===h&&(h=b());return a(q.vec3.subtract(l.sv3d.get(),c,e),q.vec3.subtract(l.sv3d.get(),f,e),c,h)};d.setOffsetFromPoint=c;d.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};d.fromVectorsAndPoint=a;d.intersectRay=function(a,c,b){return n(a,c.origin,c.direction,!0,!1,b)};d.intersectLineSegment=
function(a,c,b){return n(a,c.origin,c.vector,!1,!1,b)};d.intersectLineSegmentClamp=function(a,c,b){return n(a,c.origin,c.vector,!1,!0,b)};d.isSphereFullyInside=function(a,c){var b=c.radius;return 0<=p(a,c.center)-b};d.isSphereFullyOutside=function(a,c){var b=c.radius;return 0>p(a,c.center)+b};d.isPointInside=function(a,c){return 0<=p(a,c)};d.isPointOutside=function(a,c){return 0>p(a,c)};d.isAABBFullyInside=function(a,c){var b=c[0],e=c[1],f=c[2],h=c[3],g=c[4];c=c[5];return 0<=a[0]*(0<a[0]?b:h)+a[1]*
(0<a[1]?e:g)+a[2]*(0<a[2]?f:c)+a[3]};d.clip=function(a,c){var b=q.vec3.dot(a,c.ray.direction);a=-p(a,c.ray.origin);if(0>a&&0<=b)return!1;if(-1E-6<b&&1E-6>b)return 0<a;if((0>a||0>b)&&!(0>a&&0>b))return!0;a/=b;0<b?a<c.c1&&(c.c1=a):a>c.c0&&(c.c0=a);return c.c0<=c.c1};d.projectPoint=function(a,c,b){var e=q.vec3.scale(l.sv3d.get(),a,-a[3]);c=q.vec3.subtract(l.sv3d.get(),c,e);a=h(a,c,l.sv3d.get());q.vec3.add(b,a,e);return b};d.projectVector=h;d.distance=function(a,c){return Math.abs(p(a,c))};d.signedDistance=
p;d.UP=[0,0,1,0]})},"esri/views/3d/support/geometryUtils/ray":function(){define("require exports ../../../../core/ObjectStack ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),function(t,d,q,g,l,b,f,e){function k(a){return a?{origin:f.vec3f64.clone(a.origin),direction:f.vec3f64.clone(a.direction)}:{origin:f.vec3f64.create(),direction:f.vec3f64.create()}}function c(a,c,e){void 0===
e&&(e=k());b.vec3.copy(e.origin,a);b.vec3.copy(e.direction,c);return e}function a(a,c,f){void 0===f&&(f=k());var h=g.castRenderScreenPointArray3(l.vec2.copy(e.sv3d.get(),c));h[2]=0;a.unprojectPoint(h,f.origin);c=g.castRenderScreenPointArray3(l.vec2.copy(e.sv3d.get(),c));c[2]=1;a=a.unprojectPoint(c,e.sv3d.get());b.vec3.subtract(f.direction,a,f.origin);return f}function h(a,c,f){void 0===f&&(f=k());b.vec3.copy(f.origin,a.eye);c=b.vec3.set(e.sv3d.get(),c[0],c[1],1);a=a.unprojectPoint(c,e.sv3d.get());
b.vec3.subtract(f.direction,a,f.origin);return f}function p(a,c){a=b.vec3.cross(e.sv3d.get(),b.vec3.normalize(e.sv3d.get(),a.direction),b.vec3.subtract(e.sv3d.get(),c,a.origin));return b.vec3.dot(a,a)}function n(){return{origin:null,direction:null}}Object.defineProperty(d,"__esModule",{value:!0});d.create=k;d.wrap=function(a,c){var b=u.get();b.origin=a;b.direction=c;return b};d.copy=function(a,b){void 0===b&&(b=k());return c(a.origin,a.direction,b)};d.fromPoints=function(a,c,e){void 0===e&&(e=k());
b.vec3.copy(e.origin,a);b.vec3.subtract(e.direction,c,a);return e};d.fromValues=c;d.fromScreen=function(c,b,f){void 0===f&&(f=k());return a(c,c.screenToRender(b,g.castRenderScreenPointArray3(e.sv3d.get())),f)};d.fromRender=a;d.fromScreenAtEye=function(a,c,b){void 0===b&&(b=k());return h(a,a.screenToRender(c,g.castRenderScreenPointArray3(e.sv3d.get())),b)};d.fromRenderAtEye=h;d.distance2=p;d.distance=function(a,c){return Math.sqrt(p(a,c))};d.closestPoint=function(a,c,e){c=b.vec3.dot(a.direction,b.vec3.subtract(e,
c,a.origin));b.vec3.add(e,a.origin,b.vec3.scale(e,a.direction,c));return e};d.createWrapper=n;var u=new q.ObjectStack(n)})},"esri/views/3d/support/geometryUtils/frustum":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../stack ./clipRay ./plane".split(" "),function(t,d,q,g,l,b,f,e,k,
c,a){function h(c){if(c){var e=c.planes;c=c.points;return{planes:[a.create(e[0]),a.create(e[1]),a.create(e[2]),a.create(e[3]),a.create(e[4]),a.create(e[5])],points:[b.vec3f64.clone(c[0]),b.vec3f64.clone(c[1]),b.vec3f64.clone(c[2]),b.vec3f64.clone(c[3]),b.vec3f64.clone(c[4]),b.vec3f64.clone(c[5]),b.vec3f64.clone(c[6]),b.vec3f64.clone(c[7])]}}return{planes:[a.create(),a.create(),a.create(),a.create(),a.create(),a.create()],points:[b.vec3f64.create(),b.vec3f64.create(),b.vec3f64.create(),b.vec3f64.create(),
b.vec3f64.create(),b.vec3f64.create(),b.vec3f64.create(),b.vec3f64.create()]}}function p(c,b,e){void 0===e&&(e=h());for(var f=0;6>f;f++)a.copy(c[f],e.planes[f]);for(f=0;8>f;f++)l.vec3.copy(e.points[f],b[f]);return e}function n(c){var b=c.planes;c=c.points;a.fromPoints(c[4],c[0],c[3],b[0]);a.fromPoints(c[1],c[5],c[6],b[1]);a.fromPoints(c[4],c[5],c[1],b[2]);a.fromPoints(c[3],c[2],c[6],b[3]);a.fromPoints(c[0],c[1],c[2],b[4]);a.fromPoints(c[5],c[4],c[7],b[5])}function u(c,b){for(var e=0;6>e;e++)if(!a.clip(c[e],
b))return!1;return!0}Object.defineProperty(d,"__esModule",{value:!0});d.create=h;d.copy=function(a,c){void 0===c&&(c=h());return p(a.planes,a.points,c)};d.fromValues=p;d.fromMatrix=function(a,c,b){void 0===b&&(b=h());var e=b.points;a=g.mat4.multiply(k.sm4d.get(),c,a);g.mat4.invert(a,a);for(c=0;8>c;++c){var m=f.vec4.transformMat4(k.sv4d.get(),v[c],a);l.vec3.set(e[c],m[0]/m[3],m[1]/m[3],m[2]/m[3])}n(b);return b};d.recomputePlanes=n;d.intersectsSphere=function(c,b){for(var e=0;6>e;e++)if(a.isSphereFullyInside(c[e],
b))return!1;return!0};d.intersectsRay=function(a,b){return u(a,c.fromRay(b,r.get()))};d.intersectsLineSegment=function(a,b,e){return u(a,c.fromLineSegmentAndDirection(b,e,r.get()))};d.intersectsPoint=function(c,b){for(var e=0;6>e;e++)if(0<a.signedDistance(c[e],b))return!1;return!0};d.intersectsAABB=function(c,b){for(var e=0;6>e;e++)if(a.isAABBFullyInside(c[e],b))return!1;return!0};d.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};var v=
[e.vec4f64.fromValues(-1,-1,-1,1),e.vec4f64.fromValues(1,-1,-1,1),e.vec4f64.fromValues(1,1,-1,1),e.vec4f64.fromValues(-1,1,-1,1),e.vec4f64.fromValues(-1,-1,1,1),e.vec4f64.fromValues(1,-1,1,1),e.vec4f64.fromValues(1,1,1,1),e.vec4f64.fromValues(-1,1,1,1)],r=new q.ObjectStack(c.create)})},"esri/views/3d/support/geometryUtils/clipRay":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../stack ./ray".split(" "),function(t,d,q,g,l,b){function f(a){return a?
{ray:b.create(a.ray),c0:a.c0,c1:a.c1}:{ray:b.create(),c0:0,c1:Number.MAX_VALUE}}function e(a,c,e,g){void 0===g&&(g=f());b.copy(a,g.ray);g.c0=c;g.c1=e;return g}function k(a,c,e){void 0===e&&(e=f());var h=g.vec3.length(a.vector);b.fromValues(a.origin,c,e.ray);e.c0=0;e.c1=h;return e}Object.defineProperty(d,"__esModule",{value:!0});d.create=f;d.wrap=function(a,b,e){var f=c.get();f.ray=a;f.c0=b;f.c1=e;return f};d.copy=function(a,c){void 0===c&&(c=f());return e(a.ray,a.c0,a.c1,c)};d.fromValues=e;d.fromRay=
function(a,c){void 0===c&&(c=f());b.copy(a,c.ray);c.c0=0;c.c1=Number.MAX_VALUE;return c};d.fromLineSegment=function(a,c){void 0===c&&(c=f());var b=g.vec3.normalize(l.sv3d.get(),a.vector);return k(a,b,c)};d.fromLineSegmentAndDirection=k;var c=new q.ObjectStack(function(){return{c0:0,c1:0,ray:null}})})},"esri/views/3d/support/geometryUtils/sphere":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../geometryUtils ../mathUtils ../stack ./ray".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){function p(a){return a?{radius:a.radius,center:e.vec3f64.clone(a.center)}:{radius:1,center:e.vec3f64.create()}}function n(a,c){void 0===c&&(c=p());return u(a.radius,a.center,c)}function u(a,c,b){void 0===b&&(b=p());f.vec3.copy(b.center,c);b.radius=a;return b}function v(c,b,e){var h=f.vec3.subtract(a.sv3d.get(),b.origin,c.center),g=f.vec3.dot(b.direction,b.direction),m=2*f.vec3.dot(b.direction,h);c=f.vec3.dot(h,h)-c.radius*c.radius;c=m*m-4*g*c;if(0>c)return!1;h=Math.sqrt(c);
c=(-m-h)/(2*g);g=(-m+h)/(2*g);if(0>c||g<c&&0<g)c=g;if(0>c)return!1;e&&f.vec3.add(e,b.origin,f.vec3.scale(a.sv3d.get(),b.direction,c));return!0}function r(c,e,h){var g=a.sv3d.get(),m=a.sm4d.get();f.vec3.cross(g,e.origin,e.direction);f.vec3.cross(h,g,e.origin);f.vec3.scale(h,h,1/f.vec3.length(h)*c.radius);c=w(c,e.origin);e=k.vector.angle(e.origin,h);b.mat4.identity(m);b.mat4.rotate(m,m,e+c,g);f.vec3.transformMat4(h,h,m);return h}function y(c,b,e){b=f.vec3.subtract(a.sv3d.get(),b,c.center);b=f.vec3.scale(a.sv3d.get(),
b,c.radius/f.vec3.length(b));return f.vec3.add(e,b,c.center)}function w(b,e){e=f.vec3.subtract(a.sv3d.get(),e,b.center);e=f.vec3.length(e);return c.acos(b.radius/(b.radius+Math.abs(b.radius-e)))}function m(a,b,e,h){a=f.vec3.subtract(C,b,a.center);switch(e){case 0:return a=c.cartesianToSpherical(a,C),a=a[2],f.vec3.set(h,-Math.sin(a),Math.cos(a),0);case 1:return a=c.cartesianToSpherical(a,C),e=a[1],a=a[2],b=Math.sin(e),f.vec3.set(h,-b*Math.cos(a),-b*Math.sin(a),Math.cos(e));case 2:return f.vec3.normalize(h,
a);default:q.neverReached(e)}}function x(a,c){c=f.vec3.subtract(G,c,a.center);return f.vec3.length(c)-a.radius}Object.defineProperty(d,"__esModule",{value:!0});var A=g.getLogger("esri.views.3d.support.geometryUtils.sphere");d.create=p;d.wrap=function(a,c){var b=B.get();b.radius=a;b.center=c||I;return b};d.copy=n;d.fromValues=u;d.elevate=function(a,c,b){a!==b&&f.vec3.copy(b.center,a.center);b.radius=a.radius+c;return b};d.setExtent=function(a,c,b){A.error("sphere.setExtent is not yet supported");return a===
b?b:n(a,b)};d.intersectRay=v;d.intersectScreen=function(a,c,b,e){c=h.fromScreenAtEye(c,b,E);return v(a,c,e)};d.intersectsRay=function(a,c){return v(a,c,null)};d.intersectRayClosestSilhouette=function(c,b,e){if(v(c,b,e))return e;c=r(c,b,a.sv3d.get());f.vec3.add(e,b.origin,f.vec3.scale(a.sv3d.get(),b.direction,f.vec3.distance(b.origin,c)/f.vec3.length(b.direction)));return e};d.closestPointOnSilhouette=r;d.closestPoint=function(a,c,b){if(v(a,c,b))return b;h.closestPoint(c,a.center,b);return y(a,b,b)};
d.projectPoint=y;d.distanceToSilhouette=function(c,b){b=f.vec3.subtract(a.sv3d.get(),b,c.center);b=f.vec3.squaredLength(b);return Math.sqrt(Math.abs(b-c.radius*c.radius))};d.angleToSilhouette=w;var C=e.vec3f64.create();d.axisAt=m;d.altitudeAt=x;d.setAltitudeAt=function(a,c,b,e){var h=x(a,c);a=m(a,c,2,G);b=f.vec3.scale(G,a,b-h);f.vec3.add(e,c,b);return e};var B=new l.ObjectStack(function(){return{center:null,radius:0}}),E=h.create(),I=e.vec3f64.create(),G=e.vec3f64.create();Object.freeze(I)})},"esri/views/3d/support/geometryUtils/triangle":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack ./lineSegment".split(" "),
function(t,d,q,g,l,b,f,e){function k(a){return a?{p0:b.vec3f64.clone(a.p0),p1:b.vec3f64.clone(a.p1),p2:b.vec3f64.clone(a.p2)}:{p0:b.vec3f64.create(),p1:b.vec3f64.create(),p2:b.vec3f64.create()}}function c(a,c,b,e){void 0===e&&(e=k());l.vec3.copy(e.p0,a);l.vec3.copy(e.p1,c);l.vec3.copy(e.p2,b);return e}function a(a,c,b){var e=g.vec2.distance(a,c);c=g.vec2.distance(c,b);a=g.vec2.distance(b,a);b=(e+c+a)/2;e=b*(b-e)*(b-c)*(b-a);return 0>=e?0:Math.sqrt(e)}Object.defineProperty(d,"__esModule",{value:!0});
d.create=k;d.wrap=function(a,c,b){var e=p.get();e.p0=a;e.p1=c;e.p2=b;return e};d.copy=function(a,b){void 0===b&&(b=k());return c(a.p0,a.p1,a.p2,b)};d.fromValues=c;d.distance2=function(a,c){var b=a.p0,g=a.p1;a=a.p2;var k=l.vec3.subtract(f.sv3d.get(),g,b),p=l.vec3.subtract(f.sv3d.get(),a,g),m=l.vec3.subtract(f.sv3d.get(),b,a),d=l.vec3.subtract(f.sv3d.get(),c,b),n=l.vec3.subtract(f.sv3d.get(),c,g),u=l.vec3.subtract(f.sv3d.get(),c,a),B=l.vec3.cross(k,k,m),E=l.vec3.dot(l.vec3.cross(f.sv3d.get(),k,B),d),
n=l.vec3.dot(l.vec3.cross(f.sv3d.get(),p,B),n),u=l.vec3.dot(l.vec3.cross(f.sv3d.get(),m,B),u);if(0<E&&0<n&&0<u)return c=l.vec3.dot(B,d),c*c/l.vec3.dot(B,B);b=e.distance2(e.fromValues(b,k,h.get()),c);g=e.distance2(e.fromValues(g,p,h.get()),c);c=e.distance2(e.fromValues(a,m,h.get()),c);return Math.min(b,g,c)};d.areaPoints2d=a;d.area2d=function(c){return a(c.p0,c.p1,c.p2)};var h=new q.ObjectStack(e.create),p=new q.ObjectStack(function(){return{p0:null,p1:null,p2:null}})})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require",
"exports","./ComponentUtils","./geometryDataUtils","./Util"],function(t,d,q,g,l){return function(){function b(f,e,k,c){void 0===e&&(e=b.DefaultIndices);void 0===k&&(k=b.DefaultOffsets);void 0===c&&(c="triangle");this.preinterleaved=!1;var a={},h;for(h in f){var p=f[h],d=p.size;a[h]={data:p.data,size:d,offsetIdx:0,strideIdx:d}}if(e===b.DefaultIndices){e=l.getFirstObjectValue(a);f=g.generateDefaultIndexArray(e.data.length/e.size);e={};for(var u in a)e[u]=f}this._id=g.getNewId();this._vertexAttributes=
a;this._indices=e;this._componentOffsets=q.createOffsets(k);this._primitiveType=c}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this._componentOffsets},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexCount",{get:function(){return l.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});b.prototype.getVertexAttr=function(){return this.vertexAttributes};b.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}};
b.prototype.getIndices=function(b){return this._indices[b]};b.prototype.getAttribute=function(b){return this._vertexAttributes[b]};b.prototype.estimateGpuMemoryUsage=function(){var b=0;this._indices.position&&(b+=12*this._indices.position.length);this._indices.normal&&(b+=12*this._indices.normal.length);this._indices.uv0&&(b+=8*this._indices.uv0.length);this._indices.color&&(b+=4*this._indices.color.length);return b};b.DefaultIndices={};b.DefaultOffsets=new Uint32Array(0);return b}()})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require",
"exports","../../../../core/arrayUtils","../../../../core/maybe"],function(t,d,q,g){function l(a,c){if(null!=a){var b=a.isVisibleBit,e=a.data,f=8*e.BYTES_PER_ELEMENT;return c<e.length*f?n(b,e,c,f):!a.isVisibleBit}return!0}function b(a){return g.isSome(a.component)?a.component:-1}function f(a,c,b,f,h){l(c,f)&&e(a,c,b,b[f],b[f+1]-1,h)}function e(a,c,b,e,f,h){b=(c=0<a.length?a[a.length-1]:null)?c.range[1]:-1;var g=c?c.options:null;b>=e||(b+1===e&&g===h?c.range[1]=f:a.push({range:[e,f],options:h}))}function k(a){void 0===
a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}function c(a,c){return h(a,c,!0)}function a(a,c){return h(a,c,!1)}function h(a,c,b){var e=!1;a=a||v;e=a.isVisibleBit;a=a.data;c=u(c);var f=8*a.BYTES_PER_ELEMENT,h=a.length*f;b=b===e;if(0===a.length||0===c)e=!b;else if(h<c&&!b)e=!0;else{for(var g=r[f],h=r[0],m=0;m<a.length-1;m++)if(e=!b&&a[m]!==g||b&&a[m]!==h)return e;e=a.length-1;c=r[(c-1)%f+1];e=!b&&(a[e]&c)!==c||b&&(a[e]&c)!==h}return e}function p(a){return 0<a.length}function n(a,c,b,e){var f=
b/e|0;return 0!==(c[f]&1<<b-f*e)===a}function u(a){return Math.max(0,a.length-1)}Object.defineProperty(d,"__esModule",{value:!0});d.updateVisibility=function(a,c,b,e){if(b<u(c)){null==a&&(a=k());var f=a.isVisibleBit,h=a.data,g=8*h.BYTES_PER_ELEMENT,m=b/g|0,p=b-g*m;c=(u(c)-1)/g|0;var d=h;e=e===f;b<d.length*g||!e||(b=Math.max(m+1,Math.ceil(1.5*d.length)),b=Math.min(b,c+1),h=new Uint32Array(b),h.set(d));m<h.length&&(h[m]=h[m]&~(1<<p)|(e?1:0)<<p);a.data=h}return a};d.getVisibility=l;d.hideAllComponents=
function(a){if(null==a)a=k(!1);else{a.isVisibleBit=!0;for(var c=0;c<a.data.length;c++)a.data[c]=0}return a};d.unhideAllComponents=function(a){var c;if(null!=a)for(c=a,c.isVisibleBit=!1,a=0;a<c.data.length;a++)c.data[a]=0;return c};d.generateVisibleIndexRanges=function(a,c){var b;if(a)if(p(c))if(0===a.data.length)b=[],c=[[c[0],c[c.length-1]-1]],b=a.isVisibleBit?b:c;else{b=[];for(var e=a.isVisibleBit,f=a.data,h=8*f.BYTES_PER_ELEMENT,g=f.length*h,k=u(c),d=!1,l=0;l<g&&l<k;l++){var r=n(e,f,l,h);if(r!==
d){var v=c[l];r?b.push([v,0]):(d=b[b.length-1],d[1]=v-1);d=r}}a=!a.isVisibleBit;k>g&&a&&!d?b.push([c[g],c[k]-1]):d&&(d=b[b.length-1],d[1]=c[a?k:Math.min(k,g)]-1)}else b=[],b=a.isVisibleBit?b:null;else b=null;return b};d.addHighlight=function(a,c,e,f){a=a||[];c={component:c,options:e,id:f};a.push(c);e=b(c);for(f=a.length-1;0<f&&e<b(a[f-1]);)c=[a[f],a[f-1]],a[f-1]=c[0],a[f]=c[1],--f;return a};d.removeHighlight=function(a,c){if(!a)return a;a=a.filter(function(a){return a.id!==c});return 0===a.length?
null:a};d.generateHighlightedIndexRanges=function(c,b,h){if(!b)return null;if(!p(h))return c&&c.isVisibleBit?null:b.map(function(a){return{range:null,options:a.options}});for(var m=h[0],k=h[h.length-1]-1,d=[],n=!a(c,h),l=0;l<b.length;++l){var r=b[l].options,v=b[l].component;if(g.isSome(v))f(d,c,h,v,r);else if(n)e(d,c,h,m,k,r);else for(v=0;v<u(h);++v)f(d,c,h,v,r)}return 0<d.length?d:null};d.hasHighlights=function(c,b,e){if(!b)return!1;if(!p(e))return c&&c.isVisibleBit?!1:0<b.length;c=!a(c,e);for(var f=
0;f<b.length;f++)if(g.isSome(b[f].component)||c||0<u(e))return!0;return!1};d.defaultVisibilities=k;d.isAllVisible=function(c,b){return!a(c,b)};d.isAllHidden=function(a,b){return!c(a,b)};d.hasVisible=c;d.hasHidden=a;var v=k();d.createOffsets=function(a){return Array.isArray(a)?new Uint32Array(a):a};d.hasComponent=function(a,c){return c<u(a)};d.hasComponents=p;var r=[];for(t=0;65>t;t++)r.push(Math.pow(2,t)-1);d.componentCount=u;d.componentFind=function(a,c){a=q.binaryIndexOf(a,c,!0);return 0<=a?a:null}})},
"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});var q=1,g=null;d.generateDefaultIndexArray=function(b){if(b>q||null==g){for(;b>q;)q*=2;g=new Uint32Array(q);for(var f=0;f<q;f++)g[f]=f}return new Uint32Array(g.buffer,0,b)};var l=0;d.getNewId=function(){return l++}})},"esri/views/3d/webgl-engine/lib/Util":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/mathUtils".split(" "),
function(t,d,q,g,l,b,f,e,k){function c(a,c){if(!a)throw a=Error(c||"assert"),a.stack&&console.log(a.stack),new v(c);}function a(a){for(var c in a)return c}function h(a,c){a[12]=c[0];a[13]=c[1];a[14]=c[2]}function p(a,c){void 0===c&&(c=0);for(var b=0,e=0;4>e;e++)b+=a[c+e]*y[e];return b}function n(a){return a-Math.floor(a)}Object.defineProperty(d,"__esModule",{value:!0});var u=e.vec4f64.create(),v=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};
return a}();d.AssertException=v;d.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex",TANGENT:"aTangent"};d.assert=c;d.verify=function(a,c){a||console.warn("Verify failed: "+(c||"")+"\n"+Error("verify").stack)};d.encodeInt16=function(a){return k.clamp(Math.round(32767*a),-32767,32767)};d.encodeNormal=function(a,c){var b=
Math.abs(a[0]),e=Math.abs(a[1]),f=1/(b+e+Math.abs(a[2])),h=Math.min(a[2]*f,0);c[0]=(0>a[0]?-1:1)*(b*f-h);c[1]=(0>a[1]?-1:1)*(e*f-h)};d.fallbackIfUndefined=function(a,c){return void 0===a?c:a};d.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};d.rgb2hex=function(a){var c=k.clamp(Math.round(255*a[0]),0,255),b=k.clamp(Math.round(255*a[1]),0,255);a=k.clamp(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(b<<8)+a).toString(16)};d.dec2hex=function(a){a=a.toString(16);
return"00000000".substr(0,8-a.length)+a};d.rayTriangle3D=function(a,c,e,f,h,g,k,p,d){void 0===d&&(d=b.vec3f64.create());var m=f[k]-e[g],n=f[k+1]-e[g+1],l=f[k+2]-e[g+2];f=h[p]-e[g];k=h[p+1]-e[g+1];h=h[p+2]-e[g+2];var r=c[1]*h-k*c[2],u=c[2]*f-h*c[0],v=c[0]*k-f*c[1];p=m*r+n*u+l*v;if(-1E-5<p&&1E-5>p)return!1;p=1/p;var A=a[0]-e[g],x=a[1]-e[g+1];a=a[2]-e[g+2];d[1]=p*(A*r+x*u+a*v);if(0>d[1]||1<d[1])return!1;e=x*l-n*a;a=a*m-l*A;m=A*n-m*x;d[2]=p*(c[0]*e+c[1]*a+c[2]*m);if(0>d[2]||1<d[1]+d[2])return!1;d[0]=
p*(f*e+k*a+h*m);return!0};d.rayBoxTest=function(a,c,b,e){var f,h=(b[0]-a[0])/c[0],g=(e[0]-a[0])/c[0];h>g&&(f=h,h=g,g=f);var k=(b[1]-a[1])/c[1],m=(e[1]-a[1])/c[1];k>m&&(f=k,k=m,m=f);if(h>m||k>g)return!1;k>h&&(h=k);m<g&&(g=m);b=(b[2]-a[2])/c[2];a=(e[2]-a[2])/c[2];b>a&&(f=b,b=a,a=f);if(h>a||b>g)return!1;a<g&&(g=a);return 0>g?!1:!0};d.rayRay2D=function(a,c,b,e,f,h){void 0===h&&(h=l.vec2f64.create());var g=(e[f]-b[f])*(c[0]-a[0])-(e[0]-b[0])*(c[f]-a[f]);if(0===g)return!1;b=((e[0]-b[0])*(a[f]-b[f])-(e[f]-
b[f])*(a[0]-b[0]))/g;h[0]=a[0]+b*(c[0]-a[0]);h[1]=a[f]+b*(c[f]-a[f]);return!0};d.project=function(a,b,e,h,g){g||(g=a);u[0]=a[0];u[1]=a[1];u[2]=a[2];u[3]=1;f.vec4.transformMat4(u,u,b);2<g.length&&(g[2]=-u[2]);f.vec4.transformMat4(u,u,e);c(0!==u[3]);g[0]=u[0]/u[3];g[1]=u[1]/u[3];g[2]=u[2]/u[3];g[0]=(.5*g[0]+.5)*h[2]+h[0];g[1]=(.5*g[1]+.5)*h[3]+h[1]};d.getFirstObjectKey=a;d.getFirstObjectValue=function(c){return c[a(c)]};d.objectEmpty=function(a){for(var c in a)return!1;return!0};d.logWithBase=function(a,
c){return Math.log(a)/Math.log(c)};d.setMatrixTranslation=h;d.setMatrixTranslation3=function(a,c,b,e){a[12]=c;a[13]=b;a[14]=e};d.getMatrixTranslation=function(a,c){void 0===c&&(c=b.vec3f64.create());c[0]=a[12];c[1]=a[13];c[2]=a[14];return c};d.createTranslationMatrix=function(a,c){a=q.mat4.identity(a);h(a,c);return a};d.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};d.fovx2fovy=
function(a,c,b){return 2*Math.atan(b*Math.tan(.5*a)/c)};d.fovy2fovx=function(a,c,b){return 2*Math.atan(c*Math.tan(.5*a)/b)};d.fovx2fovd=function(a,c,b){return 2*Math.atan(Math.sqrt(c*c+b*b)*Math.tan(.5*a)/c)};d.fovy2fovd=function(a,c,b){return 2*Math.atan(Math.sqrt(c*c+b*b)*Math.tan(.5*a)/b)};d.fovd2fovx=function(a,c,b){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(c*c+b*b))};d.fovd2fovy=function(a,c,b){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(c*c+b*b))};d.packFloatRGBA=function(a,c,b){void 0===
b&&(b=0);a=k.clamp(a,0,w);for(var e=0;4>e;e++)c[b+e]=Math.floor(256*n(a*r[e]))};d.unpackFloatRGBA=p;var r=[1,256,65536,16777216],y=[1/256,1/65536,1/16777216,1/4294967296],w=p(new Uint8ClampedArray([255,255,255,255]));d.inverseProjectionInfo=function(a,c,b,e,f){0===a[11]?(e[0]=2/(c*a[0]),e[1]=2/(b*a[5]),e[2]=(1+a[12])/a[0],e[3]=(1+a[13])/a[5],g.vec2.set(f,0,1)):(e[0]=-2/(c*a[0]),e[1]=-2/(b*a[5]),e[2]=(1-a[8])/a[0],e[3]=(1-a[9])/a[5],g.vec2.set(f,1,0))}})},"esri/views/3d/webgl-engine/shaders/SimpleAtmospherePrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});d.colorPass={name:"simple-atmosphere-color",shaders:function(b){return{vertexShader:l.glslifyDefineMap({PANORAMIC:b.panoramic})+g.resolveIncludes("environment/simpleAtmosphere.vert"),fragmentShader:l.glslifyDefineMap({PANORAMIC:b.panoramic})+g.resolveIncludes("environment/simpleAtmosphere.frag")}},attributes:q.Default3D};d.fadePass=
{name:"simple-atmosphere-fade",shaders:{vertexShader:g.resolveIncludes("environment/simpleAtmosphereFade.vert"),fragmentShader:g.resolveIncludes("environment/simpleAtmosphereFade.frag")},attributes:q.Default3D}})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,aTangent:4,auxpos1:5,symbolColor:5,
componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}})},"esri/views/3d/webgl-engine/shaders/sources/resolver":function(){define(["require","exports","./shaderRepository","../../../../webgl/ShaderCompiler"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});var l=new g(function(b){var f=q;b.split("/").forEach(function(b){f&&(f=f[b])});return f});d.resolveIncludes=function(b){return l.resolveIncludes(b)}})},
"esri/views/3d/webgl-engine/shaders/sources/shaderRepository":function(){define(["require","exports"],function(t,d){return{edgeRenderer:{"adjustProjectedPosition.glsl":"uniform vec2 uDepthBias;\r\nuniform vec2 uViewportDimInv;\r\n\r\n// Utility function to check for NaN values\r\nbool isNaN(float val) {\r\n  return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\r\n  // important: some nVidias failed to cope with version below.\r\n  // Probably wrong optimization.\r\n  /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\r\n}\r\n\r\n// An offset in xy screen space, along the projected normal of the edge\r\n// This reduces depth fighting when looking at a face from a flat angle\r\nvec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\r\n  float offsetXY \x3d uDepthBias.x;\r\n  float offsetZ  \x3d uDepthBias.y;\r\n\r\n  // screen space pixel offset\r\n  // we multiply by two to account for the fact that NDC go from -1 to 1\r\n  // we multiply by projPos.w to compensate for the perspective divison that happens later\r\n  // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\r\n  // towards the camera\r\n  vec4 projNormal \x3d uProj * uView * vec4(worldNormal, 0.0);\r\n\r\n  return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\r\n}\r\n\r\n// A z-offset, using a depth based heuristic.\r\nfloat calculateProjectedBiasZ(vec4 projPos) {\r\n  float offsetZ \x3d uDepthBias.y;\r\n  return sqrt(projPos.z) * offsetZ;\r\n}\r\n\r\nvec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\r\n  vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\r\n\r\n  // we currently have to do this check because some geometries come with 0 length edge normals.\r\n  // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\r\n  if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\r\n    projPos.xy +\x3d offsetXY;\r\n  }\r\n\r\n  projPos.z +\x3d calculateProjectedBiasZ(projPos);\r\n\r\n  return projPos;\r\n}\r\n",
"edgeRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec4 vColor;\r\nvarying float vRadius;\r\nvarying vec3 vPosition;\r\nvarying vec3 vWorldPosition;\r\nvarying float vLineLengthPixels;\r\nvarying float vSizeFalloffFactor;\r\nvarying float vLineIndex;\r\n\r\n// At which coverage threshold we discard a fragment completely\r\n#define COVERAGE_TEST_THRESHOLD 0.01\r\n\r\n#include \x3cedgeRenderer/lineOffset.glsl\x3e\r\n\r\nvec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\r\n  float lineOffset \x3d calculateLineOffset();\r\n  float positionX \x3d position.x - lineOffset;\r\n\r\n  if (radius \x3c 1.0) {\r\n    // Handle this specifically for subpixel sizes:\r\n    // 1. Compute correct coverage (note coverage is computed by\r\n    //    0.5 - dist, so we make sure that that will lead to correct\r\n    //    subpixel coverage\r\n    // 2. Ignore rounded caps\r\n    float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\r\n    float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\r\n\r\n    float coverage \x3d min(coverageX, coverageY);\r\n\r\n    return vec2(0.5 - coverage, 0.0);\r\n  }\r\n  else {\r\n    // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\r\n    float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\r\n\r\n    vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\r\n    return vec2(length(lineToPosition) - radius, positionOnCap / radius);\r\n  }\r\n}\r\n\r\nvoid main() {\r\n\r\n  float radius \x3d vRadius * calculateLinePressure();\r\n\r\n  vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\r\n  float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\r\n\r\n#ifdef ANTIALIASING\r\n\r\n  const float coverageLimit \x3d COVERAGE_TEST_THRESHOLD;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n  // Use subpixel coverage computation when lines get subpixel widths\r\n  // so we still render them appropriately. Otherwise discard anything\r\n  // that is not fully within the line\r\n  float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n  if (coverage \x3c coverageLimit) {\r\n    discard;\r\n  }\r\n\r\n  discardBySlice(vWorldPosition);\r\n\r\n  float alpha \x3d vColor.a * coverage;\r\n\r\n  gl_FragColor \x3d vec4(vColor.rgb, alpha);\r\n}\r\n",
"edgeRenderer.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n// Transformations\r\nuniform mat4 uProj;\r\nuniform mat4 uView;\r\nuniform mat4 uModel;\r\nuniform vec3 uCameraPosition;\r\n\r\n// Line configuration\r\n\r\n// Conversion constants\r\nuniform vec2 uPixelToNDC;\r\nuniform vec2 uNDCToPixel;\r\nuniform float uPixelRatio;\r\n\r\n// Inputs\r\nattribute vec3 aPosition0;\r\nattribute vec3 aPosition1;\r\nattribute float aVariantOffset;\r\nattribute float aVariantStroke;\r\nattribute float aVariantExtension;\r\n\r\n#ifdef SILHOUETTE\r\n\r\nattribute vec3 aNormalA;\r\nattribute vec3 aNormalB;\r\n\r\n#else /* SILHOUETTE */\r\n\r\nattribute vec3 aNormal;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\nattribute vec2 aSideness;\r\nattribute vec2 aPackedAttributes;\r\n\r\nstruct UnpackedAttributes {\r\nvec2 sideness;\r\nvec2 sidenessNorm;\r\nfloat lineWidthPixels;\r\nfloat extensionLengthPixels;\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\nfloat type;\r\n\r\n#endif\r\n};\r\n\r\n// Output required to compute color\r\nvarying vec4 vColor;\r\n\r\n// Output required to compute distance to line/caps\r\nvarying vec3 vPosition;\r\nvarying vec3 vWorldPosition;\r\nvarying float vRadius;\r\nvarying float vLineLengthPixels;\r\nvarying float vSizeFalloffFactor;\r\n\r\n#include \x3cedgeRenderer/adjustProjectedPosition.glsl\x3e\r\n#include \x3cedgeRenderer/styleOutputs.glsl\x3e\r\n#include \x3cedgeRenderer/lineAmplitude.glsl\x3e\r\n#include \x3cedgeRenderer/util.glsl\x3e\r\n\r\nvec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  vec2 sideness \x3d unpackedAttributes.sideness;\r\n  vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n  vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\r\n\r\n  vec4 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\r\n  vec4 projPosV0 \x3d uProj * viewPosV0;\r\n  vec4 projPosV1 \x3d uProj * viewPosV1;\r\n  vec4 projPos \x3d uProj * viewPos;\r\n\r\n  vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\r\n  vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\r\n  float lineLengthPixels \x3d length(screenSpaceLinePixels);\r\n\r\n  float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\r\n  vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\r\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\r\n\r\n  float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\r\n  float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\r\n\r\n  float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\r\n  float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\r\n\r\n  vSizeFalloffFactor \x3d falloffFactor;\r\n\r\n  float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\r\n  float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\r\n\r\n#ifdef ANTIALIASING\r\n\r\n  const float aaPaddingPixels \x3d 1.0;\r\n\r\n  // Line size with padding\r\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\r\n  float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\r\n\r\n  // Line length with padding\r\n  float aaPaddedLineLengthPixels \x3d extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\r\n  float halfAAPaddedLineLengthPixels \x3d aaPaddedLineLengthPixels * 0.5;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n  // Even if there is no AA, we still want to do proper \x3c1px rendering,\r\n  // so we effectively clamp the pixel sizes to minimum of 1px and compute\r\n  // coverage in the fragment shader\r\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\r\n  float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\r\n\r\n  float halfAAPaddedLineLengthPixels \x3d max(extendedLineLengthPixels, 1.0) * 0.5;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n  // Half line width in NDC including padding for anti aliasing\r\n  vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\r\n  vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\r\n  vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\r\n\r\n  // Compute screen space position of vertex, offsetting for line size and end caps\r\n  vec2 ndcOffset \x3d (\r\n      screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\r\n    + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\r\n  );\r\n\r\n  projPos.xy +\x3d ndcOffset * projPos.w;\r\n  projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\r\n\r\n  projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\r\n\r\n  // Line length with end caps\r\n  float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\r\n\r\n  float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\r\n\r\n  // Position in pixels with origin at first vertex of line segment\r\n  vPosition \x3d vec3(\r\n    halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\r\n    pixelPositionAlongLine,\r\n    pixelPositionAlongLine / extendedLineLengthPixels\r\n  );\r\n\r\n  // The line width radius in pixels\r\n  vRadius \x3d lineWidthPixels * 0.5;\r\n  vLineLengthPixels \x3d extendedLineLengthPixels;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  gl_Position \x3d isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10.0, 10.0, 10.0, 1.0);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  gl_Position \x3d projPos;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\n  if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) {\r\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\r\n  }\r\n\r\n#elif (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  if (lineLengthPixels \x3c\x3d 3.0) {\r\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\r\n  }\r\n\r\n#endif\r\n\r\n  return projPos;\r\n}\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\nUnpackedAttributes unpackAttributes(ComponentData component) {\r\n\r\n  vec2 sidenessNorm \x3d aSideness;\r\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n\r\n  float fType \x3d component.type;\r\n  float extensionLengthPixels \x3d component.extensionLength;\r\n  float lineWidth \x3d component.lineWidth;\r\n\r\n  if (fType \x3c\x3d 0.0) {\r\n    extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n  }\r\n\r\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\r\n}\r\n\r\n#else /* (MODE \x3d\x3d MODE_UBER) */\r\n\r\nUnpackedAttributes unpackAttributes(ComponentData component) {\r\n  vec2 sidenessNorm \x3d aSideness;\r\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n  float extensionLengthPixels \x3d component.extensionLength;\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n\r\n#endif\r\n\r\n  float lineWidth \x3d component.lineWidth;\r\n\r\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\r\n}\r\n\r\n#endif /* (MODE \x3d\x3d MODE_UBER) */\r\n\r\nvoid main() {\r\n  ComponentData component \x3d readComponentData();\r\n  UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\r\n\r\n  vec4 worldPosV0 \x3d uModel * vec4(aPosition0, 1.0);\r\n  vec4 worldPosV1 \x3d uModel * vec4(aPosition1, 1.0);\r\n\r\n  vec4 viewPosV0 \x3d uView * worldPosV0;\r\n  vec4 viewPosV1 \x3d uView * worldPosV1;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  vec3 worldNormal \x3d silhouetteWorldNormal(aNormalA, aNormalB);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  vec3 worldNormal \x3d modelToWorldNormal(aNormal);\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n  // General geometric computation for all types of edges\r\n  vec4 projPos \x3d calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\r\n\r\n  // Component color\r\n  vColor \x3d component.color;\r\n\r\n  // Specific computation for different edge styles\r\n  calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\r\n}\r\n",
"lineAmplitude.glsl":"// Solid\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineAmplitudeSolid() {\r\n    return 0.0;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSolid();\r\n  }\r\n\r\n#endif\r\n\r\n// Sketch\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform float uStrokesAmplitude;\r\n\r\n  float calculateLineAmplitudeSketch() {\r\n    return uStrokesAmplitude;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSketch();\r\n  }\r\n\r\n#endif\r\n\r\n// Uber\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    float type \x3d unpackedAttributes.type;\r\n\r\n    if (type \x3c\x3d 0.0) {\r\n      return calculateLineAmplitudeSketch();\r\n    }\r\n    else {\r\n      return calculateLineAmplitudeSolid();\r\n    }\r\n  }\r\n\r\n#endif\r\n",
"lineOffset.glsl":"#include \x3cutil/encoding.glsl\x3e\r\n\r\n// Sketch\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform sampler2D uStrokesTexture;\r\n  uniform float uStrokesNormalizationScale;\r\n\r\n  varying vec2 vStrokeUV;\r\n\r\n  float calculateLineOffsetSketch() {\r\n    float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\r\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\r\n  }\r\n\r\n  float calculateLinePressureSketch() {\r\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSketch();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSketch();\r\n  }\r\n\r\n#endif\r\n\r\n// Solid\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineOffsetSolid() {\r\n    return 0.0;\r\n  }\r\n\r\n  float calculateLinePressureSolid() {\r\n    return 1.0;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSolid();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSolid();\r\n  }\r\n\r\n#endif\r\n\r\n// Uber\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n  varying float vType;\r\n\r\n  float calculateLineOffset() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLineOffsetSketch();\r\n    }\r\n    else {\r\n      return calculateLineOffsetSolid();\r\n    }\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLinePressureSketch();\r\n    }\r\n    else {\r\n      return calculateLinePressureSolid();\r\n    }\r\n  }\r\n#endif\r\n",
"styleOutputs.glsl":"#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform vec2 uStrokesTextureScale;\r\n  uniform float uStrokesLog2Resolution;\r\n  uniform float uStrokeVariants;\r\n\r\n  varying vec2 vStrokeUV;\r\n  varying float vLineIndex;\r\n\r\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\r\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n    float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\r\n\r\n    vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\r\n    vStrokeUV.x +\x3d aVariantOffset;\r\n\r\n    vLineIndex \x3d lineIndex;\r\n  }\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  }\r\n#elif (MODE \x3d\x3d MODE_SKETCH)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n  }\r\n#elif (MODE \x3d\x3d MODE_UBER)\r\n  varying float vType;\r\n\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    vType \x3d unpackedAttributes.type;\r\n\r\n    if (unpackedAttributes.type \x3c\x3d 0.0) {\r\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n    }\r\n  }\r\n#endif\r\n",
"util.glsl":"uniform float uDistanceFalloffFactor;\r\n\r\nfloat distanceBasedPerspectiveFactor(float distance) {\r\n  return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\r\n}\r\n\r\nuniform sampler2D uComponentDataTex;\r\nuniform vec2 uComponentDataTexInvDim;\r\n\r\nattribute float aComponentIndex;\r\n\r\n#define COMPONENT_COLOR_FIELD_OFFSET 0.0\r\n#define COMPONENT_OTHER_FIELDS_OFFSET 1.0\r\n#define COMPONENT_FIELD_COUNT 2.0\r\n\r\n#define LINE_WIDTH_FRACTION_FACTOR 8.0\r\n#define EXTENSION_LENGTH_OFFSET 128.0\r\n\r\n#define COMPONENT_TEX_WIDTH 4096.0\r\n\r\nvec2 componentTextureCoords(float componentIndex, float fieldOffset) {\r\n  float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\r\n\r\n  float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\r\n  float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\r\n\r\n  vec2 linearIndex \x3d vec2(\r\n    (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\r\n    (rowIndex + 0.5) * uComponentDataTexInvDim.y\r\n  );\r\n\r\n  return linearIndex;\r\n}\r\n\r\nstruct ComponentData {\r\n  vec4 color;\r\n  float lineWidth;\r\n  float extensionLength;\r\n  float type;\r\n};\r\n\r\nComponentData readComponentData() {\r\n  vec2 colorIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\r\n  vec2 otherIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\r\n\r\n  vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\r\n  vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\r\n\r\n  return ComponentData(\r\n    vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\r\n    otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\r\n    otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\r\n    -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\r\n  );\r\n}\r\n\r\nvec3 modelToWorldNormal(vec3 normal) {\r\n  return (uModel * vec4(normal, 0.0)).xyz;\r\n}\r\n\r\nvec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\r\n  return modelToWorldNormal(normalize(normalA + normalB));\r\n}\r\n\r\n// Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\r\n// fall-off exponentially\r\nfloat calculateExtensionLength(float extensionLength, float lineLength) {\r\n  return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\r\n}\r\n\r\n#ifdef SILHOUETTE\r\n\r\n// #uniforms: uView, uModel\r\nbool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\r\n  // transform the two face normals\r\n  vec3 viewNormalA \x3d (uView * uModel * vec4(normalA, 0.0)).xyz;\r\n  vec3 viewNormalB \x3d (uView * uModel * vec4(normalB, 0.0)).xyz;\r\n\r\n  // compute the direction from the edge to the camera\r\n  vec3 viewDir \x3d -viewPos.xyz;\r\n\r\n  // check which of the two faces are visible\r\n  // display the edge if exactly one of the two is visible\r\n  float faceAVisible \x3d dot(viewDir, viewNormalA); // positive if visible\r\n  float faceBVisible \x3d dot(viewDir, viewNormalB); // positive if visible\r\n\r\n  // 1 if exactly one face visible, 0 otherwise\r\n  return faceAVisible * faceBVisible \x3c 0.0;\r\n}\r\n\r\n#endif /* SILHOUETTE */\r\n"},
environment:{"realisticAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/color.glsl\x3e\r\n\r\n// Light\r\nuniform vec3 v3LightDir;      // The direction vector to the light source\r\nuniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\r\nuniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\r\n\r\n// Atmosphere\r\nconst float fKrESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\r\nconst float fKmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\r\n\r\n// Radii\r\nuniform vec4 v4Radii; // (fInnerRadius, fInnerRadius^2, fOuterRadius, fOuterRadius^2)\r\n\r\n// The inner (planetary) radius\r\n#define fInnerRadius v4Radii[0]\r\n// fInnerRadius^2\r\n#define fInnerRadius2 v4Radii[1]\r\n// The outer (atmosphere) radius\r\n#define fOuterRadius v4Radii[2]\r\n// fOuterRadius^2\r\n#define fOuterRadius2 v4Radii[3]\r\n\r\n// Atmosphere parameters:\r\n// fScale:                    1.0 / (fOuterRadius - fInnerRadius)\r\n// fScaleDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\r\n// fScaleOverScaleDepth:      fScale / fScaleDepth\r\n// fOneOverScaleDepth:        1.0 / fScaleDepth\r\n\r\n// fScaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\r\n// fScaleOverScaleDepthBlue:  fScale / fScaleDepthBlue\r\n// fOneOverScaleDepthBlue;    1.0 / fScaleDepthBlue\r\n\r\nuniform vec4 v4AtmosParams1; // (fScale, fScaleDepth, fScaleOverScaleDepth, fOneOverScaleDepth)\r\nuniform vec4 v4AtmosParams2; // (g, fScaleDepthBlue, fScaleOverScaleDepthBlue, fOneOverScaleDepthBlue)\r\n\r\n#define fScale v4AtmosParams1.x\r\n// fScaleDepth, fScaleDepthBlue\r\n#define v2ScaleDepth vec2(v4AtmosParams1.y,v4AtmosParams2.y)\r\n// fScaleOverScaleDepth, fScaleOverScaleDepthBlue\r\n#define v2ScaleOverScaleDepth vec2(v4AtmosParams1.z,v4AtmosParams2.z)\r\n// fOneOverScaleDepth, fOneOverScaleDepthBlue\r\n#define v2OneOverScaleDepth vec2(v4AtmosParams1.w,v4AtmosParams2.w)\r\n\r\n#ifndef HAZE\r\nuniform vec4 v4AtmosParams3; // (g2, fMiePhaseCoefficients, fLowerAlphaBlendBound, fOneOverOuterRadiusMinusAlphaBlendBound)\r\nuniform float fInnerFadeDistance;\r\nuniform float fAltitudeFade;\r\n\r\n#define fg v4AtmosParams2.x\r\n#define fg2 v4AtmosParams3.x\r\n#define fMiePhaseCoefficients v4AtmosParams3.y\r\n#define fLowerAlphaBlendBound v4AtmosParams3.z\r\n#define fOneOverOuterRadiusMinusAlphaBlendBound v4AtmosParams3.w\r\n#endif\r\n\r\n// Camera\r\nuniform vec3 v3CameraPos;     // The camera's current position\r\nuniform vec2 nearFar;\r\n\r\nuniform vec4 v4SphereComp;              // (fCameraHeight, fCameraHeight2, fC, fCSur)\r\n// The camera's current height\r\n#define fCameraHeight v4SphereComp[0]\r\n// fCameraHeight^2\r\n#define fCameraHeight2 v4SphereComp[1]\r\n// fCameraHeight2 - fOuterRadius2; // C \x3d ||o-c||^2 - r^2\r\n#define fC v4SphereComp[2]\r\n// fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C \x3d ||o-c||^2 - r^2\r\n#define fCSur v4SphereComp[3]\r\n\r\n// Camera HDR\r\n#ifdef HAZE\r\nconst float fExposure \x3d 1.5;\r\n#else\r\nconst float fExposure \x3d 2.0;\r\n#endif\r\n\r\n#ifdef HAZE\r\n// Depth texture\r\nuniform sampler2D tDepth;\r\n#endif\r\n\r\n// Testing variables\r\nuniform float showTest;\r\n\r\n// Varyings\r\nvarying vec3 v3EyeDir;\r\nvarying vec3 v3WorldRay;\r\nvarying vec2 vtc;\r\n\r\n// Loop constants for integral approximation\r\nconst float fSamples \x3d 5.0;\r\nconst int maxSamples \x3d 5;\r\n\r\n#ifdef HAZE\r\n  const float fOneOverGamma \x3d 1.0;//Gamma \x3d 1.0\r\n#else\r\n  const float fOneOverGamma \x3d 0.454545; // Gamma \x3d 2.2\r\n#endif\r\n\r\nconst vec3 v3OneOverGamma \x3d vec3(fOneOverGamma);\r\n\r\n// ToneMapping operators\r\nvec3 expTM(vec3 inputColor,float exposure){\r\n    return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\r\n}\r\n\r\n#ifndef HAZE\r\nvec3 reinhardTM(vec3 inputColor, float exposure){\r\n  vec3 intermediate \x3d inputColor *exposure;\r\n  intermediate /\x3d (1.0+intermediate);\r\n  return pow(intermediate, v3OneOverGamma);\r\n}\r\n#endif\r\n\r\n// Approximation for inner integral based on a radii ratio of 10.25:10\r\nfloat scale(float fCos){\r\n  float x \x3d 1.0 - fCos;\r\n  return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n}\r\n\r\nvoid main() {\r\n  vec3 cameraPosition \x3d v3CameraPos;\r\n\r\n  // Debug variables\r\n  vec3 test \x3d vec3(0.0,0.0,0.0);\r\n\r\n  // Obtain ray from Camera\r\n  vec3 worldSpaceRay \x3d normalize(v3WorldRay);\r\n\r\n  // Compute Atmosphere intersection; i.e. ray/sphere intersection\r\n  float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\r\n  float det \x3d B*B - 4.0 * fC; // det \x3d B^2 - 4.0* C\r\n\r\n  // idealized sphere intersection to discard early some pixels\r\n  float detSur \x3d B*B - 4.0 * fCSur; // det \x3d B^2 - 4.0* C\r\n\r\n  // the minimal sample start position:\r\n  // at the camera by default, on the earth radius surface if the camera is underground.\r\n  float fMinRayStart \x3d 0.0;\r\n#ifndef HAZE\r\n  // When the ray intersects the earth surface, fade the sky to a simple light direction\r\n  // based color. This is used to make sure we have a white background in underground\r\n  // mode (at noon).\r\n  float fSurfaceBlend \x3d 0.0;\r\n  vec4 surfaceColor \x3d vec4(0.0);\r\n  if (detSur \x3e\x3d 0.0) {\r\n    float nearSurfaceT \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\r\n    float farSurfaceT \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\r\n\r\n    if (nearSurfaceT \x3d\x3d 0.0) {\r\n      fMinRayStart \x3d farSurfaceT;\r\n    }\r\n\r\n    // Compute lighting at the point where the ray enters the earth surface\r\n    // Lighting computation is copied from the terrain shader.\r\n    vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurfaceT;\r\n    float fLightAngle \x3d dot(v3LightDir, normalize(vPos));\r\n    float fBrightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * fLightAngle)));\r\n\r\n    // Make the surface transparent based on altitude\r\n    surfaceColor \x3d vec4(fBrightness, fBrightness, fBrightness, 1.0 - fAltitudeFade);\r\n\r\n    // Fade based on the distance the ray travels below the earth surface\r\n    float fRelDist \x3d (farSurfaceT - nearSurfaceT) / fInnerFadeDistance;\r\n\r\n    // early exit\r\n    if (fRelDist \x3e 1.0) {\r\n      gl_FragColor \x3d surfaceColor;\r\n      return;\r\n    }\r\n\r\n    fSurfaceBlend \x3d smoothstep(0.0, 1.0, fRelDist * fRelDist);\r\n  }\r\n#endif\r\n\r\n  // Inside Atmosphere\r\n  if (det \x3e\x3d 0.0) {\r\n#ifdef HAZE\r\n    // only use red channel from depth texture.\r\n    // see 'Issues' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\r\n    float depthSample \x3d texture2D(tDepth, vtc).r;\r\n\r\n    float zNear \x3d nearFar[0];\r\n    float zFar \x3d nearFar[1];\r\n\r\n    // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\r\n    float zNorm \x3d 2.0 * depthSample - 1.0;\r\n    float linDepth \x3d 2.0 * zNear * zFar /\r\n      (zFar + zNear - zNorm * (zFar - zNear));\r\n\r\n    float rayEndT;\r\n    float altitudeAlpha \x3d 1.0;\r\n\r\n    // find intersections with ground, but only between the near and far\r\n    // clipping planes.\r\n    if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\r\n      vec3 cameraSpaceRay \x3d normalize(v3EyeDir);\r\n      cameraSpaceRay /\x3d cameraSpaceRay.z;\r\n      cameraSpaceRay *\x3d linDepth;\r\n\r\n      float cameraSpaceRayLength \x3d length(cameraSpaceRay);\r\n\r\n      vec3 v3World \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\r\n      float v3WorldRadius2 \x3d dot(v3World, v3World);\r\n\r\n      // Handle tall structures:\r\n      // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\r\n      float transitionStart \x3d fInnerRadius + 20000.0;\r\n      float transitionHeight \x3d 25000.0;\r\n      float transitionEnd \x3d transitionStart + transitionHeight;\r\n\r\n      float edge0 \x3d transitionStart * transitionStart;\r\n      float edge1 \x3d transitionEnd * transitionEnd;\r\n\r\n      altitudeAlpha \x3d 1.0 - clamp((v3WorldRadius2 - edge0) / (edge1 - edge0), 0.0, 1.0);\r\n      rayEndT \x3d cameraSpaceRayLength;\r\n\r\n      if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\r\n        float nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\r\n        float interp \x3d clamp(((fCameraHeight - fInnerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\r\n        rayEndT \x3d mix(cameraSpaceRayLength, nearSurfaceT, interp);\r\n      }\r\n    }\r\n#endif\r\n\r\n    float rayStartT \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\r\n#ifdef HAZE\r\n    float nearT \x3d abs(rayStartT);\r\n    float farT \x3d abs(rayEndT);\r\n#else\r\n    float rayEndT \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\r\n\r\n#endif\r\n\r\n    float fDistance; // calculate its scattering offset\r\n    // Calculate the ray's starting position\r\n    if (rayStartT \x3c fMinRayStart)\r\n    { // ray starts from camera or inner radius sphere to far\r\n      rayStartT \x3d fMinRayStart;\r\n#ifndef HAZE\r\n      // clamp to value at inner radius altitude\r\n      fDistance \x3d fScale * min(0.0, fInnerRadius - fCameraHeight);\r\n#endif\r\n    }\r\n#ifndef HAZE\r\n    else\r\n    { // outside atmosphere\r\n      fDistance \x3d -1.0;\r\n    }\r\n#endif\r\n\r\n    // Initialize the scattering loop variables\r\n    vec3 v3Start \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n\r\n#ifdef HAZE\r\n    vec3 v3End \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n\r\n    float fEndLength \x3d length(v3End);\r\n    float fAltitudeEnd \x3d fEndLength - fInnerRadius;\r\n    float fAltitudeStart \x3d length(v3Start) - fInnerRadius;\r\n\r\n    // for camera positions below altitude 0, invert the altitudes, to achieve\r\n    // a similar haze as above ground. Note that there is a small but visible change\r\n    // when the camera passes altitude 0.\r\n    if (fAltitudeStart \x3c 0.0) {\r\n      fAltitudeStart \x3d -fAltitudeStart;\r\n      fAltitudeEnd \x3d -fAltitudeEnd;\r\n    }\r\n\r\n    // computed for the original end point to get consistent light angles after possible inversions\r\n    float fLightAngle \x3d dot(v3LightDir, v3End) / fEndLength;\r\n\r\n    if (nearT \x3e farT)\r\n    {\r\n      if (fAltitudeStart \x3c fAltitudeEnd)\r\n      {\r\n        // Switch positive slopes for flipped rays\r\n        v3End \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n        v3Start \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n        worldSpaceRay *\x3d -1.0;\r\n        float fTmp \x3d fAltitudeStart;\r\n        fAltitudeStart \x3d fAltitudeEnd;\r\n        fAltitudeEnd \x3d fTmp;\r\n      }\r\n      else if (fAltitudeStart \x3d\x3d fAltitudeEnd)\r\n      { // create minuscule fake slope for integration if the slope is zero\r\n        fAltitudeStart +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\r\n        // slope for the camera function\r\n      }\r\n    }\r\n\r\n    // Calculate its scattering offset\r\n    // Assumes camera constrains of WSV 3.8\r\n    float fCameraDepth;\r\n    float fCameraDepthBlue;\r\n    if (fAltitudeStart \x3e fOuterRadius - fInnerRadius)\r\n    { // outside atmosphere\r\n      fDistance \x3d fInnerRadius - fOuterRadius;\r\n    } else\r\n    {\r\n      fDistance \x3d fAltitudeEnd - fAltitudeStart;\r\n    }\r\n\r\n#endif\r\n    vec2 v2OpticalStartDepth \x3d exp(fDistance * v2OneOverScaleDepth);\r\n\r\n    float fRayLength \x3d rayEndT - rayStartT;\r\n    float fSampleLength \x3d fRayLength / fSamples;\r\n    float fScaledLength \x3d fSampleLength * fScale;\r\n    vec3 v3SampleRay \x3d worldSpaceRay * fSampleLength;\r\n    vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\r\n\r\n#ifdef HAZE\r\n    float fCameraAngle \x3d dot(-worldSpaceRay, v3End) / length(v3End);\r\n    float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n    vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth;\r\n\r\n    float scaledValues \x3d scale(fLightAngle) + fScaleCameraAngle;\r\n    vec2 v2ScaledValuesDepth \x3d scaledValues * v2ScaleDepth;\r\n#else\r\n    float fCameraAngle \x3d dot(worldSpaceRay, v3Start / length(v3Start));\r\n    float angleMultiplier \x3d fCameraAngle\x3e0.0?fCameraAngle:0.0;\r\n\r\n    float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n    vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\r\n#endif\r\n\r\n    // Loop variables\r\n    vec3 v3FrontColor \x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3FrontColorBlue \x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3Attenuate\x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3AttenuateBlue \x3d vec3(0.0, 0.0, 0.0);\r\n\r\n    // Now loop through the sample rays\r\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\r\n      float fHeight \x3d length(v3SamplePoint);\r\n      float fAltitude \x3d abs(fHeight - fInnerRadius);\r\n\r\n      vec2 v2Depth \x3d exp(-fAltitude * v2ScaleOverScaleDepth);\r\n#ifdef HAZE\r\n      vec2 v2Scatter \x3d v2Depth*v2ScaledValuesDepth-v2CameraOffset;\r\n#else\r\n      float fLightAngle \x3d dot(v3LightDir, v3SamplePoint) / fHeight;\r\n      float fCameraAngle \x3d dot(worldSpaceRay, v3SamplePoint) / fHeight;\r\n      float fTempScaledValues \x3d scale(fLightAngle) - scale(fCameraAngle);\r\n      vec2 v2Scatter \x3d v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\r\n#endif\r\n      v3Attenuate \x3d exp(-v2Scatter.x * v3InvWavelengthScaled);\r\n      v3AttenuateBlue \x3d exp(-v2Scatter.y * v3InvWavelengthScaled);\r\n\r\n      v3FrontColor +\x3d v3Attenuate * v2Depth.x;\r\n      v3FrontColorBlue +\x3d v3AttenuateBlue * v2Depth.y;\r\n\r\n      v3SamplePoint +\x3d v3SampleRay;\r\n    }\r\n\r\n    // Phase computation\r\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\r\n    float fCos \x3d clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\r\n    float fOnePlusCos2 \x3d fCos*fCos + 1.0;\r\n#ifdef HAZE\r\n    // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\r\n    vec3 colorCoefficients \x3d (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\r\n\r\n    // Scaled Length is only applied afterwards to save multiplications\r\n    vec3 v3Color \x3d colorCoefficients *v3FrontColor;\r\n    vec3 v3ColorBlue \x3d colorCoefficients *v3FrontColorBlue;\r\n#else\r\n    vec3 v3RayleighCoefficients \x3d (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\r\n    float fMieCoefficients \x3d fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + fg2 - 2.0*fg*fCos, 1.5);\r\n\r\n    // Calculate the attenuation factor for the ground\r\n    vec3 v3Color \x3d v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\r\n    vec3 v3ColorBlue \x3d v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\r\n#endif\r\n\r\n    // HDR to LDR conversion\r\n    vec3 ldrBlue \x3d expTM(v3ColorBlue,2.0*fExposure);\r\n    vec3 ldrRed \x3d expTM(v3Color,fExposure);\r\n\r\n    // mix reddish and blueish atmosphere\r\n    vec3 LDR \x3d mix(ldrBlue,ldrRed,0.2);\r\n#ifdef HAZE\r\n    LDR *\x3d (1.0-fCameraAngle);\r\n    vec3 hsv \x3d rgb2hsv(LDR);\r\n    hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0); // boost haze saturation by 50%\r\n    LDR \x3d hsv2rgb(hsv);\r\n    vec3 finalColor \x3d LDR;\r\n    // when rendering we specify the blend functions such that\r\n    // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\r\n#else\r\n    // reinhard tonemapper for looking upwards\r\n    vec3 ldrReinhard \x3d reinhardTM(v3Color,fExposure);\r\n    LDR +\x3d angleMultiplier*ldrReinhard;\r\n\r\n    // height dependent parameter to smooth out reddish atmosphere\r\n    float side \x3d (rayEndT+rayStartT)*0.5;\r\n    float atmoHeight \x3d sqrt(fCameraHeight2 - side*side);\r\n    float h2 \x3d clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\r\n\r\n    vec3 finalColor \x3d LDR*h2;\r\n    vec3 hsv \x3d rgb2hsv(finalColor);\r\n    hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0); // boost sky saturation by 50%\r\n    finalColor \x3d hsv2rgb(hsv);\r\n#endif\r\n\r\n#ifndef HAZE\r\n    float atmosStrength \x3d clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\r\n    gl_FragColor \x3d vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\r\n    if (fSurfaceBlend \x3e 0.0) {\r\n      gl_FragColor \x3d mix(gl_FragColor, surfaceColor, fSurfaceBlend);\r\n    }\r\n#else\r\n    gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;\r\n#endif\r\n\r\n    // Debug variable overlay\r\n    if(showTest\x3e0.0){\r\n      gl_FragColor \x3d vec4(test,1.0);\r\n    }\r\n  } else { // Outside Atmosphere\r\n    gl_FragColor \x3d vec4(0.0);\r\n  }\r\n}\r\n",
"realisticAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n// Camera\r\nuniform vec2 halfSizeNearPlane;\r\nuniform vec3 v3CameraUp;\r\nuniform vec3 v3CameraRight;\r\nuniform vec3 v3CameraDir;\r\nuniform vec2 v2CameraCenterOffset;\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\n// Varyings\r\nvarying vec3 v3WorldRay;\r\nvarying vec2 vtc;\r\n\r\n#ifdef HAZE\r\nvarying vec3 v3EyeDir;\r\n#endif\r\n\r\nvoid main(void) {\r\n  vec3 v3Pos \x3d position;\r\n  vtc \x3d uv0;\r\n  vec2 rayvtc \x3d uv0 - v2CameraCenterOffset;\r\n\r\n#ifdef HAZE\r\n  v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#else\r\n  vec3 v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#endif\r\n  v3WorldRay \x3d v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\r\n  gl_Position \x3d vec4(v3Pos, 1.0);\r\n}\r\n",
"simpleAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\nvarying float falloff;\r\n\r\n#ifndef PANORAMIC\r\nuniform float altitudeFade;\r\nvarying float innerFactor;\r\n#endif\r\n\r\nvoid main() {\r\n  vec4 texColor \x3d texture2D(tex, vtc);\r\n\r\n#ifdef PANORAMIC\r\n  gl_FragColor \x3d texColor * falloff;\r\n#else\r\n  vec4 atmosphereColor \x3d texColor * falloff;\r\n  vec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\r\n  gl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\r\n#endif\r\n}\r\n",
"simpleAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\n\r\n#ifndef PANORAMIC\r\nconst float TWICEPI \x3d 2.0*3.14159265;\r\nconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\r\n\r\nuniform vec3 silCircleCenter;\r\nuniform vec3 silCircleV1;\r\nuniform vec3 silCircleV2;\r\nuniform vec2 texV;\r\n\r\nuniform float innerScale;  // scale for inner rim\r\nvarying float innerFactor; // 0: outer atmosphere, 1: inner atmosphere\r\n#endif\r\n\r\nuniform vec3 lightDirection;\r\n\r\nattribute vec3 position;\r\nvarying vec2 vtc;\r\nvarying float falloff;\r\n\r\nvoid main(void) {\r\n\r\n#ifdef PANORAMIC\r\n\r\n  vec3 pos \x3d position;\r\n  float ndotl \x3d lightDirection.z;\r\n  vtc \x3d vec2(0.0, position.z+0.05);\r\n\r\n#else\r\n\r\n  innerFactor \x3d clamp(-position.z, 0.0, 1.0);\r\n  float scale \x3d position.y * (1.0 + innerFactor * innerScale);\r\n  float phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\r\n  vec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\r\n  float ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\r\n\r\n  vtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\r\n  vtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\r\n\r\n#endif\r\n\r\n  falloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n  gl_Position \x3d proj * view * vec4(pos, 1.0);\r\n  gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n}\r\n",
"simpleAtmosphereFade.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","simpleAtmosphereFade.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\n\r\nuniform vec3 lightDirection;\r\nuniform vec3 cameraPosition;\r\n\r\nuniform float undergroundFadeAlpha;\r\n\r\nvarying vec4 color;\r\n\r\nvoid main(void) {\r\n  float ndotl \x3d dot(normalize(cameraPosition), lightDirection);\r\n  float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n  color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\r\n\r\n  gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\r\n}\r\n",
"stars.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec4 vcolor;\r\nvarying float vsize;\r\n\r\nvoid main() {\r\n  float cap \x3d 0.7;\r\n  float scale \x3d 1.0/cap;\r\n  float helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\r\n  float alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\r\n  float intensity \x3d alpha*alpha*alpha;\r\n  if (vsize \x3c 3.0)\r\n    intensity *\x3d 0.5;\r\n  gl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\r\n  gl_FragColor.xyz *\x3d vcolor.xyz;\r\n}\r\n",
"stars.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform vec4 viewport;\r\nuniform float pixelRatio;\r\n\r\nattribute vec3 position;\r\nattribute vec4 color;\r\nattribute float size;\r\n\r\nvarying vec4 vcolor;\r\nvarying float vsize;\r\n\r\nvoid main(void) {\r\n  vec4 posProj \x3d proj * view * model*vec4(position*1.0e25,1.0);//move infinitely far away\r\n  gl_Position \x3d alignToPixelCenter(posProj, viewport.zw); //pixel align position\r\n  gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n  vcolor \x3d color / 1.2;\r\n  vsize \x3d size * 5.0 * pixelRatio;\r\n  gl_PointSize \x3d vsize;\r\n}\r\n"},
materials:{checkerBoard:{"checkerBoard.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec2 size;\r\nuniform vec4 color1;\r\nuniform vec4 color2;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main() {\r\n  vec2 uvScaled \x3d vUV / (2.0 * size);\r\n\r\n  vec2 uv \x3d fract(uvScaled - 0.25);\r\n  vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\r\n  float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\r\n  float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\r\n\r\n  gl_FragColor \x3d mix(color2, color1, t);\r\n}\r\n",
"checkerBoard.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n  vUV \x3d uv0;\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n}\r\n"},color:{"color.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 eColor;\r\n#ifdef VERTEX_COLORS\r\nvarying vec4 vColor;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef VERTEX_COLORS\r\n  gl_FragColor \x3d vColor * eColor;\r\n#else\r\n  gl_FragColor \x3d eColor;\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\r\n}\r\n",
"color.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n#ifdef VERTEX_COLORS\r\nattribute vec4 color;\r\n\r\nvarying vec4 vColor;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#ifdef VERTEX_COLORS\r\n  vColor \x3d color * 0.003921568627451; // \x3d 1/255;\r\n#endif\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n"},
defaultMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n * \r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3e maxReplace) {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  } else if (symbolColor.a \x3e maxTint) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  } else if (symbolColor.a \x3e 0.0) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  } else {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n\r\n  return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n#endif\r\n\r\n#define FRAGMENT_SHADER\r\n#include \x3cmaterials/defaultMaterial/vertexTangents.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/textureNormals.glsl\x3e\r\n\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n// material parameters\r\n//////////////////////////////////////////\r\nuniform vec3 ambient;\r\nuniform vec3 diffuse;\r\nuniform vec3 specular;\r\nuniform float opacity;\r\nuniform float layerOpacity;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\nuniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n  varying vec3 vnormal;\r\n#endif\r\n\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\nvarying vec4 vcolorExt;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#include \x3cutil/shadow.glsl\x3e\r\n#endif\r\n\r\n#ifdef TREE_RENDERING\r\n  uniform mat4 view;\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  vec4 texColor \x3d textureLookup(tex, vtc);\r\n\r\n  #if defined(TEXTURE_ALPHA_PREMULTIPLIED)\r\n    texColor.rgb /\x3d texColor.a;\r\n  #endif\r\n\r\n  discardOrAdjustTextureAlpha(texColor);\r\n#else /* TEXTURING */\r\n  vec4 texColor \x3d vec4(1.0);\r\n#endif /* TEXTURING */\r\n\r\n  vec3 viewDir \x3d vpos - camPos;\r\n\r\n  // compute normal\r\n  // TODO: this is not in sync with the normal pass\r\n#ifdef GROUND_NORMAL_SHADING\r\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n    vec3 normal \x3d normalize(vpos + localOrigin);\r\n  #else\r\n    vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n  #endif\r\n#else\r\n  #if (NORMALS \x3d\x3d NORMALS_SCREEN_DERIVATIVE)\r\n    vec3 normal \x3d normalize(cross(dFdx(vpos),dFdy(vpos)));\r\n  #else\r\n    #ifdef DOUBLESIDED\r\n      vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n    #elif defined(WINDINGORDERDOUBLESIDED)\r\n      vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\r\n    #else\r\n      vec3 normal \x3d vnormal;\r\n    #endif\r\n    normal \x3d normalize(normal);\r\n  #endif\r\n#endif\r\n\r\n  // compute ssao\r\n#ifdef RECEIVE_SSAO\r\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n#else\r\n  float ssao \x3d 1.0;\r\n#endif\r\n\r\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n  float additionalAmbientScale;\r\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\r\n\r\n  // compute shadowing\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#elif VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  // at global scale (and in global scenes) we fall back to this approximation\r\n  // to shadow objects on the dark side of the earth\r\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n#endif\r\n\r\n  vec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n#if defined(VERTEXCOLORS)\r\n  // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#else\r\n  // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#endif\r\n  albedo_+\x3d 0.25 * specular; // don't completely ignore specular for now\r\n\r\n\r\n  #if defined(TEXTURE_NORMALS)\r\n    mat3 tangentSpace \x3d computeTangentSpace(normal);\r\n    vec3 shadingNormal \x3d computeTextureNormal(tangentSpace);\r\n  #else\r\n    vec3 shadingNormal \x3d normal;\r\n  #endif\r\n\r\n  #ifdef TREE_RENDERING\r\n    // make sure we use unflipped normal\r\n    shadingNormal \x3d normalize(vnormal);\r\n\r\n    // make tree 20% brighter\r\n    albedo_ *\x3d 1.2;\r\n\r\n    // view forward vector in global coordinates\r\n    vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\r\n\r\n    // factor indicating how aligned the lighting direction and view axis are\r\n    float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\r\n\r\n    // we approximate the tree crown transmittance based on view direction and tree crown normal\r\n    float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadingNormal), 0.0, 1.0);\r\n\r\n    float treeRadialFalloff \x3d vcolor.r;\r\n    float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\r\n    additionalLight +\x3d backLightFactor * lightingMainIntensity;\r\n  #endif\r\n\r\n  vec3 shadedColor \x3d evaluateSceneLighting(shadingNormal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n  gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\n#define VERTEX_SHADER\r\n#include \x3cmaterials/defaultMaterial/vertexTangents.glsl\x3e\r\n\r\n#ifdef INSTANCEDCOLOR\r\nattribute vec4 instanceColor;\r\n#endif\r\nattribute vec3 position;\r\n\r\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\r\n  attribute vec2 normalCompressed;\r\n  varying vec3 vnormal;\r\n#elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n  attribute vec3 normal;\r\n  varying vec3 vnormal;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\n    attribute vec2 uv0;\r\n    varying vec2 vtc;\r\n  #ifdef TEXTURE_ATLAS\r\n    attribute vec4 region;\r\n    varying vec4 regionV;\r\n  #endif\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\n#include \x3cmaterials/defaultMaterial/componentColors.glsl\x3e\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\nattribute vec4 color;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\nattribute vec4 symbolColor;\r\n#endif\r\n\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\n\r\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\r\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\r\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\r\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\r\n// This should be further cleaned up later with through the following issue:\r\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\r\nuniform vec4 externalColor;\r\nvarying vec4 vcolorExt;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/constants.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\r\n\r\nvoid main() {\r\n\r\n#ifdef VERTEXCOLORS\r\n  vcolor \x3d color * 0.003921568627451; // \x3d 1/255\r\n#endif\r\n\r\n  vcolorExt \x3d externalColor;\r\n\r\n#ifdef INSTANCEDCOLOR\r\n  vcolorExt *\x3d instanceColor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  vcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n  if (vcolorExt.a \x3c SYMBOL_ALPHA_CUTOFF) {\r\n    // Discard this vertex\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\r\n  }\r\n  else {\r\n    vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vnormal \x3d normalize(modelNormal * localNormal().xyz);\r\n  #endif\r\n\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n  #ifdef IOS_SAFARI_FIX\r\n    originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n  #endif\r\n  vpos -\x3d originDelta;\r\n\r\n  #ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n  #endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vnormal \x3d normalize((modelNormal * localNormal()).xyz);\r\n  #endif\r\n\r\n  #ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * localCenter()).xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n  #endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n    #if defined(VERTEX_TANGENTS)\r\n      transformVertexTangent(mat3(modelNormal));\r\n    #endif\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n  }\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n\r\n#ifdef TEXTURING\r\n  #ifndef FLIPV\r\n    vtc \x3d uv0;\r\n  #else\r\n    vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n  #endif\r\n  #ifdef TEXTURE_ATLAS\r\n    regionV \x3d region;\r\n  #endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"commonFunctions.glsl":"#include \x3cmaterials/defaultMaterial/localPosition.glsl\x3e\r\n#include \x3cutil/doublePrecision.glsl\x3e\r\n\r\nvec3 calculateVPos() {\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  return model * localPosition().xyz;\r\n#else\r\n  return (model * localPosition()).xyz;\r\n#endif\r\n}\r\n\r\n#ifdef VERTICAL_OFFSET\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n#include \x3cutil/screenSizePerspective.glsl\x3e\r\n#endif\r\n\r\nvec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\r\n  float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\r\n  float verticalOffsetOffsetDistance \x3d verticalOffset.x * viewDistance;\r\n\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  vec3 worldNormal \x3d normalize(worldPos + localOrigin);\r\n#else\r\n  vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\r\n\r\n  float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\r\n#else\r\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n  // Screen sized offset in world space, used for example for line callouts\r\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\r\n\r\n  return worldNormal * worldOffset;\r\n}\r\n#endif\r\n",
"commonInputs.glsl":"uniform mat4 proj;\r\nuniform mat4 view;\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\nuniform vec3 viewOriginHi;\r\nuniform vec3 viewOriginLo;\r\n#endif\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\nattribute vec3 modelOriginHi;\r\nattribute vec3 modelOriginLo;\r\nattribute mat3 model;\r\nattribute mat3 modelNormal;\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\nattribute mat4 model;\r\nattribute mat4 modelNormal;\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n#else /* INSTANCED */\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n#endif /* INSTANCED */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n// [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\r\nuniform vec4 verticalOffset;\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\nuniform vec4 screenSizePerspectiveAlignment;\r\n#endif\r\n#endif\r\n",
"componentColors.glsl":"\r\nuniform sampler2D uComponentColorTex;\r\nuniform vec2 uComponentColorTexInvDim;\r\n\r\nattribute float componentIndex;\r\n\r\nvec4 readComponentColor() {\r\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n  vec2 indexCoord \x3d vec2(\r\n    mod(normalizedIndex, 1.0),\r\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n  );\r\n  vec4 componentColor \x3d texture2D(uComponentColorTex, indexCoord);\r\n  // NB: we clear the least significant bit of the blue channel as this contains\r\n  // the castShadows flag\r\n  return vec4( componentColor.r, componentColor.g, componentColor.b - mod(componentColor.b*255.0, 2.0)/255.0, componentColor.a);\r\n}\r\n\r\n// returns 1.0 if shadowCasting is enabled and 0.0 otherwise\r\n// this is found by reading the least significant bit of the\r\n// componentColors blue color channel which contains the castShadows flag\r\nbool readComponentCastShadowsFlag(){\r\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n  vec2 indexCoord \x3d vec2(\r\n    mod(normalizedIndex, 1.0),\r\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n  );\r\n  if( mod(texture2D(uComponentColorTex, indexCoord).b*255.0, 2.0) \x3c 1.0 )\r\n      return false;\r\n  return true;\r\n}\r\n",
"constants.glsl":"#define SYMBOL_ALPHA_CUTOFF 0.001\r\n","depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#if defined(TEXTURING)\r\n  #include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n  #include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  #if defined(TEXTURING)\r\n    vec4 texColor \x3d textureLookup(tex, vtc);\r\n    discardOrAdjustTextureAlpha(texColor);\r\n  #endif\r\n\r\n  #ifndef BIAS_SHADOWMAP\r\n    gl_FragColor \x3d float2rgba(depth);\r\n  #else\r\n    gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n  #endif\r\n}\r\n",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nuniform vec2 nearFar;\r\nattribute vec3 position;\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n\r\n#if defined(COMPONENTCOLORS)\r\n#include \x3cmaterials/defaultMaterial/componentColors.glsl\x3e\r\n#endif\r\n\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n\r\n\r\n#if defined(COMPONENTCOLORS)\r\n  if( !readComponentCastShadowsFlag() ){\r\n    // discard vertex so that it doesnt show up in depth buffer\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\r\n  }else\r\n  {\r\n#endif\r\n\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n#ifdef IOS_SAFARI_FIX\r\n  originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n#endif\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1.0);\r\n\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n\r\n#if defined(COMPONENTCOLORS)\r\n  } // if readComponentCastShadowsFlag\x3d\x3dtrue\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\n#if defined(TEXTURING)\r\n  #include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n  #include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  #if defined(TEXTURING)\r\n    vec4 texColor \x3d textureLookup(tex, vtc);\r\n    discardOrAdjustTextureAlpha(texColor);\r\n  #endif\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nattribute vec3 position;\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n#ifdef IOS_SAFARI_FIX\r\n  originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n#endif\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"localCenter.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vvTransformPosition(vec3(0.0), instanceFeatureAttribute); }\r\n# endif\r\n#else\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vec4(vec3(0.0), 1.0); }\r\n# endif\r\n#endif\r\n","localNormal.glsl":"#include \x3cutil/normalEncoding.glsl\x3e\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  # if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\r\n    vec4 localNormal() { return vvTransformNormal(decodeNormal(normalCompressed), instanceFeatureAttribute); }\r\n  # elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vec4 localNormal() { return vvTransformNormal(normal, instanceFeatureAttribute); }\r\n  # endif\r\n#else\r\n  # if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\r\n    vec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\r\n  # elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vec4 localNormal() { return vec4(normal, 1.0); }\r\n  # endif\r\n#endif\r\n",
"localPosition.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\r\nvec4 localPosition() { return vvTransformPosition(position, instanceFeatureAttribute); }\r\n#else\r\nvec4 localPosition() { return vec4(position, 1.0); }\r\n#endif\r\n","normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n  varying vec3 vnormal;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\n#if defined(TEXTURING)\r\n  #include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n  #include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  #if defined(TEXTURING)\r\n    vec4 texColor \x3d textureLookup(tex, vtc);\r\n    discardOrAdjustTextureAlpha(texColor);\r\n  #endif\r\n\r\n#if (NORMALS \x3d\x3d NORMALS_SCREEN_DERIVATIVE)\r\n  vec3 normal \x3d normalize(cross(dFdx(vpos),dFdy(vpos)));\r\n#else\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n#endif\r\n\r\n  #ifndef ALPHA_ZERO\r\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n  #else\r\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n  #endif\r\n}\r\n",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nuniform mat4 viewNormal;\r\nattribute vec3 position;\r\n\r\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\r\n  attribute vec2 normalCompressed;\r\n  varying vec3 vnormal;\r\n#elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n  attribute vec3 normal;\r\n  varying vec3 vnormal;\r\n#endif\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n\r\nvarying vec3 vpos;\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vnormal \x3d normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\r\n  #endif\r\n\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n\r\n  #ifdef IOS_SAFARI_FIX\r\n    originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n  #endif\r\n  vpos -\x3d originDelta;\r\n\r\n  #ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n  #endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\r\n  #endif\r\n\r\n  #ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * localCenter()).xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n  #endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"textureNormals.glsl":"#if defined(TEXTURE_NORMALS)\r\n  uniform sampler2D texNormal;\r\n\r\n  vec3 computeTextureNormal(mat3 tangentSpace) {\r\n    vec3 rawNormal \x3d texture2D(texNormal, vtc).rgb * 2.0 - 1.0;\r\n    return tangentSpace * rawNormal;\r\n  }\r\n#endif","texturing.glsl":'float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n  // from:\r\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n  //   - http://www.linedef.com/virtual-texture-demo.html\r\n  float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\r\n}\r\n\r\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\r\n  //[umin, vmin, umax, vmax]\r\n  vec2 atlasScale \x3d region.zw - region.xy;\r\n  vec2 uvAtlas \x3d fract(uv) * atlasScale + region.xy;\r\n\r\n  vec4 texColor;\r\n\r\n  // calculate derivative of continuous texture coordinate\r\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\r\n  vec2 dUVdx \x3d dFdx(uv) * atlasScale;\r\n  vec2 dUVdy \x3d dFdy(uv) * atlasScale;\r\n\r\n#ifdef GL_EXT_shader_texture_lod\r\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\r\n#else\r\n  // use bias to compensate for difference in automatic vs desired mipmap level\r\n  vec2 dUVdxAuto \x3d dFdx(uvAtlas);\r\n  vec2 dUVdyAuto \x3d dFdy(uvAtlas);\r\n  float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n  float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n\r\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\r\n#endif\r\n}\r\n\r\nvec4 textureLookup(sampler2D tex, vec2 uv) {\r\n#ifdef TEXTURE_ATLAS\r\n  return textureAtlasLookup(tex, uv, regionV, texSize);\r\n#else\r\n  return texture2D(tex, uv);\r\n#endif\r\n}\r\n\r\n/**\r\n * Based on the texture alpha mode:\r\n * - discards fragments if necessary\r\n * - adjusts read texture alpha if necessary\r\n */\r\nvoid discardOrAdjustTextureAlpha(inout vec4 texColor) {\r\n  // if the texture alpha mode is set to "mask"\r\n  // the resulting alpha is either 0.0 (discard) or 1.0\r\n  #if defined(TEXTURE_ALPHA_MODE_MASK)\r\n    if (texColor.a \x3c textureAlphaCutoff) {\r\n      discard;\r\n    } else {\r\n      texColor.a \x3d 1.0;\r\n    }\r\n  // if the texture alpha mode is set to "maskBlend"\r\n  // the resulting alpha is either 0.0 (discard) or untouched for further use in blending\r\n  #elif defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\r\n    if (texColor.a \x3c textureAlphaCutoff) {\r\n      discard;\r\n    }\r\n  // if the texture alpha mode is set to "opaque"\r\n  // the resulting alpha is always 1.0\r\n  #elif defined(TEXTURE_ALPHA_MODE_OPAQUE)\r\n    texColor.a \x3d 1.0;\r\n  // for "blend" we don\'t need to do anyting\r\n  #else // defined(TEXTURE_ALPHA_MODE_BLEND)\r\n\r\n  #endif\r\n}\r\n\r\n\r\n\r\n',
"texturingInputs.glsl":"#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\n\r\n#if defined(TEXTURE_ALPHA_MODE_MASK) || defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\r\nuniform float textureAlphaCutoff;\r\n#endif\r\n\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n\r\n#endif\r\n\r\n#if defined(TEXTURING) || defined(TEXTURE_COORDINATES)\r\nvarying vec2 vtc;\r\n#endif\r\n","vertexTangents.glsl":"#if defined(VERTEX_SHADER)\r\n\r\n  #if defined(VERTEX_TANGENTS)\r\n    attribute vec4 aTangent;\r\n    varying vec4 vTangent;\r\n\r\n    void transformVertexTangent(mat3 modelTransformForNormals) {\r\n      vTangent.xyz \x3d modelTransformForNormals * aTangent.xyz;\r\n      vTangent.w \x3d aTangent.w;\r\n    }\r\n  #endif // VERTEX_TANGENTS\r\n\r\n#elif defined(FRAGMENT_SHADER)\r\n\r\n  #if defined(VERTEX_TANGENTS)\r\n    varying vec4 vTangent;\r\n\r\n    #if defined(WINDINGORDERDOUBLESIDED)\r\n      mat3 computeTangentSpace(vec3 normal) {\r\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\r\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\r\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\r\n        return mat3(tangent, bitangent, normal);\r\n      }\r\n    #else // WINDINGORDERDOUBLESIDED\r\n      mat3 computeTangentSpace(vec3 normal) {\r\n        float tangentHeadedness \x3d vTangent.w;\r\n        vec3 tangent \x3d normalize(vTangent.xyz);\r\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\r\n        return mat3(tangent, bitangent, normal);\r\n      }\r\n    #endif // WINDINGORDERDOUBLESIDED\r\n  #endif // VERTEX_TANGENTS\r\n\r\n#endif // VERTEX_SHADER\r\n"},
hud:{"colorPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\r\n\r\nvoid main() {\r\n#include \x3cmaterials/hud/hudMain.glsl\x3e\r\n}\r\n","highlightPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvoid main() {\r\n#include \x3cmaterials/hud/hudMain.glsl\x3e\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  // Instead of deciding on a per-pixel basis if the highlight is occluded,\r\n  // do it for all highlight pixel based on the centroid occlusion. This\r\n  // is a temporary solution for:\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\r\n  if (voccluded \x3d\x3d 1.0) {\r\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n  } else {\r\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n#else\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n#endif\r\n}\r\n",
"hud.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec2 screenOffset;\r\nuniform vec2 anchorPos;\r\n\r\n// textureCoordinateScaleFactor can be used when there is a uniform texture scaling per material.\r\n// This is used in the case where we enforce a POT texture (for mipmaps) and the effective\r\n// texture is only in a subregion of the full POT texture.\r\nuniform vec2 textureCoordinateScaleFactor;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\nuniform vec4 screenSizePerspective;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\nvarying vec3 debugBorderCoords;\r\n#endif\r\n\r\nattribute vec2 uv0;\r\nattribute vec4 color;\r\nattribute vec2 size;\r\nattribute vec4 auxpos2;\r\n\r\nvarying vec4 vcolor;\r\n\r\nvarying vec2 vtc;\r\nvarying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvarying float voccluded;\r\n#endif\r\n\r\nvoid main(void) {\r\n  ProjectHUDAux projectAux;\r\n  vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n  if (rejectBySlice(projectAux.posModel)) {\r\n    // Project outside of clip plane\r\n    gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    return;\r\n  }\r\n\r\n  vec2 inputSize;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\r\n\r\n  vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n\r\n#else\r\n\r\n  inputSize \x3d size;\r\n\r\n  vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n#ifdef VV_SIZE\r\n  // only use width (.xx) for proportional scaling\r\n  // (if no width was defined in vv, width\r\n  //  will be a copy of height vv)\r\n  inputSize *\x3d vvGetScale(auxpos2).xx;\r\n#endif\r\n\r\n  vec2 combinedSize \x3d inputSize * pixelRatio;\r\n  vec4 quadOffset \x3d vec4(0.0);\r\n\r\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\r\n  bool visible \x3d testVisibilityHUD(posProj);\r\n#endif\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvoccluded \x3d visible ? 0.0 : 1.0;\r\n#endif\r\n\r\n#ifdef OCCL_TEST\r\n  if (visible) {\r\n#endif\r\n    // UV goes from 0 to 1.99999, where the integer part is used\r\n    // for the normalized vertex coordinates, and the fractional\r\n    // part is used for texture sampling\r\n    vec2 uv01 \x3d floor(uv0);\r\n    vec2 uv \x3d uv0 - uv01;\r\n\r\n    // Displace icon based on anchor position (normalized for size) and\r\n    // absolute screen offset. anchorPos is [-0.5, 0.5]\r\n    quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n\r\n    // SDF primitives might be scaled so that the SDF texture resolution does\r\n    // not match the resolution of the canvas, but we still want to render\r\n    // outline-only ('cross' and 'x') primitives cleanly. Aligning to a screen\r\n    // pixel border at the geometry center achieves this, since SDF textures\r\n    // always have power of 2 dimensions.\r\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\r\n#else\r\n    posProj +\x3d quadOffset;\r\n\r\n    // Aligning vertex positions to the nearest (using 'floor') screen pixel\r\n    // border renders textures with pixel-perfect results. If the texture\r\n    // resolution does not match the canvas resolution then aligning is\r\n    // redundant.\r\n    if (inputSize.x \x3d\x3d size.x) {\r\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\r\n    }\r\n#endif\r\n\r\n    gl_Position \x3d posProj;\r\n\r\n    vtc \x3d uv * textureCoordinateScaleFactor;\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n    debugBorderCoords \x3d vec3(uv01, 1.0 / combinedSize);\r\n#endif\r\n\r\n    vsize \x3d inputSize;\r\n#ifdef OCCL_TEST\r\n  } else {\r\n    vtc \x3d vec2(.0);\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n    debugBorderCoords \x3d vec3(0.0);\r\n#endif\r\n\r\n  }\r\n#endif\r\n\r\n  gl_Position \x3d posProj;\r\n\r\n#ifdef VV_COLOR\r\n  vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors);\r\n#else\r\n  vcolor \x3d color / 255.0;\r\n#endif\r\n}\r\n",
"hudHeader.glsl":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/color.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\nuniform vec4 overrideColor;\r\nuniform vec4 outlineColor;\r\nuniform float outlineSize;\r\n\r\nvarying vec4 vcolor;\r\n\r\nvarying vec2 vtc;\r\nvarying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvarying float voccluded;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\nvarying vec3 debugBorderCoords;\r\n#endif\r\n",
"hudMain.glsl":"#ifdef SIGNED_DISTANCE_FIELD\r\n  vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n  vec4 fillPixelColor \x3d overrideColor * vcolor;\r\n\r\n  // Attempt to sample texel centers to avoid that thin cross outlines\r\n  // disappear with large symbol sizes.\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\r\n  const float txSize \x3d 128.0;\r\n  const float texelSize \x3d 1.0 / txSize;\r\n  // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\r\n  vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\r\n  vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\r\n\r\n  // Get distance and map it into [-0.5, 0.5]\r\n  float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\r\n\r\n  // Distance in output units (i.e. pixels)\r\n  float dist \x3d d * vsize.x;\r\n\r\n  // Create smooth transition from the icon into its outline\r\n  fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n  if (outlineSize \x3e 0.25) {\r\n    vec4 outlinePixelColor \x3d outlineColor;\r\n    float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\r\n\r\n    // Create smooth transition around outline\r\n    outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\r\n\r\n    // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\r\n    float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n    vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\r\n      vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n\r\n    gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\r\n  }\r\n\r\n  // visualize SDF:\r\n  // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\r\n#else\r\n\r\n  // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\r\n  // fragment color. Input textures should already be pre-multiplied and so\r\n  // don't require adjustment, but the override and vertex colors must be\r\n  // modulated by their alpha values.\r\n\r\n  gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n   float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\r\n   gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);\r\n#endif\r\n\r\n  if (gl_FragColor.a \x3c 0.1) {\r\n    discard;\r\n  }\r\n",
"occlusionTest.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","occlusionTest.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vec4 posProjCenter;\r\n\r\n  // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\r\n  // are removed before the VBO is recompacted. If this is the case, then we just project outside\r\n  // of clip space.\r\n  if (dot(position, position) \x3e 0.0) {\r\n    // Render single point to center of the pixel to avoid subpixel filtering to affect\r\n    // the marker color\r\n    ProjectHUDAux projectAux;\r\n    vec4 posProj \x3d projectPositionHUD(projectAux);\r\n    posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n    vec3 vpos \x3d projectAux.posModel;\r\n    if (rejectBySlice(vpos)) {\r\n      // Project out of clip space\r\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    }\r\n  }\r\n  else {\r\n    // Project out of clip space\r\n    posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n  }\r\n\r\n  gl_Position \x3d posProjCenter;\r\n  gl_PointSize \x3d 1.0;\r\n}\r\n"},
lineCallout:{"lineCallout.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\nuniform vec4 borderColor;\r\n\r\nvarying vec4 coverageSampling;\r\nvarying vec2 lineSizes;\r\n\r\nvoid main() {\r\n  // Mix between line and border coverage offsets depending on whether we need\r\n  // a border (based on the sidedness).\r\n  vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\r\n\r\n  // Mix between border and line color based on the line coverage (conceptually the line\r\n  // blends on top of the border background).\r\n  //\r\n  // Anti-alias by blending final result using the full (including optional border) coverage\r\n  // and the color alpha\r\n  float borderAlpha \x3d color.a * borderColor.a * coverage.y;\r\n  float colorAlpha \x3d color.a * coverage.x;\r\n\r\n  float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n  if (finalAlpha \x3c 0.01) {\r\n    discard;\r\n  }\r\n\r\n#else\r\n\r\n  // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\r\n  // need to divide by finalAlpha). We avoid the division here by setting the\r\n  // appropriate blending function in the material.\r\n  vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\r\n\r\n  gl_FragColor \x3d vec4(finalRgb, finalAlpha);\r\n\r\n#endif\r\n\r\n}\r\n",
"lineCallout.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nattribute vec2 uv0;\r\n\r\nuniform float lineSize;\r\nuniform vec2 pixelToNDC;\r\nuniform float borderSize;\r\nuniform vec2 screenOffset;\r\n\r\nvarying vec4 coverageSampling;\r\nvarying vec2 lineSizes;\r\n\r\nvoid main(void) {\r\n\r\n  ProjectHUDAux projectAux;\r\n  vec4 endPoint \x3d projectPositionHUD(projectAux);\r\n\r\n  vec3 vpos \x3d projectAux.posModel;\r\n  if (rejectBySlice(vpos)) {\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\r\n    return;\r\n  }\r\n\r\n#ifdef OCCL_TEST\r\n  if (!testVisibilityHUD(endPoint)) {\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\r\n    return;\r\n  }\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n  vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\r\n#else\r\n  vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n  // Add view dependent polygon offset to get exact same original starting point. This is mostly\r\n  // used to get the correct depth value\r\n  vec3 posView \x3d (view * (model * vec4(position, 1.0))).xyz;\r\n  applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\r\n\r\n  vec4 startPoint \x3d proj * vec4(posView, 1.0);\r\n\r\n  // Apply screen offset to both start and end point\r\n  vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\r\n\r\n  startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\r\n  endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\r\n\r\n  // Align start and end to pixel origin\r\n  vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\r\n  vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n#ifdef DEPTH_HUD_ALIGN_START\r\n  endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\r\n#else\r\n  startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\r\n#endif\r\n\r\n#endif\r\n\r\n  vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\r\n\r\n  // The direction of the line in screen space\r\n  vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\r\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\r\n  float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\r\n\r\n#else\r\n\r\n  float lineSizeScaled \x3d lineSize;\r\n  float borderSizeScaled \x3d borderSize;\r\n\r\n#endif\r\n\r\n  float halfPixelSize \x3d lineSizeScaled * 0.5;\r\n  // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\r\n  // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\r\n  // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\r\n  // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\r\n  float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\r\n  float halfPixelSizeInt \x3d floor(halfWholePixelSize);\r\n\r\n  // Sub-pixel offset if we need to grow sub-pixels to the left\r\n  float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\r\n\r\n  // Pixel offset aligning to whole pixels and adding subpixel offset if needed\r\n  float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\r\n\r\n  // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\r\n  float padding \x3d 1.0 + borderSizeScaled;\r\n  vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\r\n\r\n  // Offset x/y from the center of the line in screen space\r\n  projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\r\n\r\n  // Compute a coverage varying which we can use in the fragment shader to determine\r\n  // how much a pixel is actually covered by the line (i.e. to anti alias the line).\r\n  // This works by computing two coordinates that can be linearly interpolated and then\r\n  // subtracted to find out how far away from the line edge we are.\r\n  float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\r\n\r\n  float halfBorderSize \x3d 0.5 * borderSizeScaled;\r\n  float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\r\n  float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\r\n\r\n  float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\r\n\r\n  coverageSampling \x3d vec4(\r\n    // Edge coordinate\r\n    outerEdgeCoverageSampler,\r\n\r\n    // Border edge coordinate\r\n    outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\r\n\r\n    // Line offset\r\n    halfPixelSize - 0.5,\r\n\r\n    // Border offset\r\n    halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\r\n  );\r\n\r\n  lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\r\n\r\n  gl_Position \x3d projectedPosition;\r\n}\r\n"},
measurementArrow:{"measurementArrow.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform float outlineSize;\r\nuniform vec4 outlineColor;\r\nuniform float stripeLength;\r\nuniform vec4 stripeEvenColor;\r\nuniform vec4 stripeOddColor;\r\n\r\nvarying vec2 vtc;\r\nvarying float vlength;\r\nvarying float vradius;\r\n\r\n#define INV_SQRT2 (1.0 / sqrt(2.0))\r\n\r\nvec4 arrowColor(vec2 tc, float len) {\r\n  float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\r\n  d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\r\n  d \x3d min(d, 1.0 - abs(tc.y));\r\n\r\n  if (d \x3c 0.0) {\r\n    return vec4(0.0);\r\n  } else if (d \x3c outlineSize) {\r\n    return outlineColor;\r\n  } else {\r\n    return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\r\n  }\r\n}\r\n\r\nvoid main(void) {\r\n  vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\r\n  vec4 color \x3d arrowColor(ntc, vlength / vradius);\r\n  if (color.a \x3d\x3d 0.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d color;\r\n}\r\n",
"measurementArrow.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nuniform float width;\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv0;\r\nattribute float auxpos1;\r\n\r\nvarying vec2 vtc;\r\nvarying float vlength;\r\nvarying float vradius;\r\n\r\nvoid main(void) {\r\n  vec3 bitangent \x3d normal;\r\n\r\n  vtc \x3d uv0;\r\n  vlength \x3d auxpos1;\r\n  vradius \x3d 0.5 * width;\r\n\r\n  vec4 pos \x3d view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\r\n  gl_Position \x3d proj * pos;\r\n}\r\n"},
nativeLine:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 constantColor;\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef VERTEXCOLORS\r\nvarying vec4 vcolor;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n#ifdef VERTEXCOLORS\r\n  gl_FragColor \x3d highlightSlice(vcolor, vpos);\r\n#else\r\n  gl_FragColor \x3d highlightSlice(constantColor, vpos);\r\n#endif\r\n}\r\n","highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"nativeLine.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n\r\n#ifdef VERTEXCOLORS\r\nattribute vec4 color;\r\n#endif\r\n\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef VERTEXCOLORS\r\nvarying vec4 vcolor;\r\n#endif\r\n\r\n\r\nvoid main(void) {\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n  #ifdef VERTEXCOLORS\r\n    vcolor \x3d color * 0.003921568627451; // \x3d 1/255\r\n  #endif\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n"},
pathMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3d\x3d 0.0) {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxTint) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxReplace) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  }\r\n  else {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  }\r\n\r\n  return vec4(symbolColor.rgb, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n// material parameters\r\n//////////////////////////////////////////\r\nuniform vec3 ambient;\r\nuniform vec3 diffuse;\r\nuniform vec3 specular;\r\nuniform float opacity;\r\nuniform float layerOpacity;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\nuniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n// the vertex color variable will contain vvColor and/or vvOpacity or 1,1,1,1\r\nvarying vec4 vcolor; \r\nvarying vec4 vcolorExt;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#include \x3cutil/shadow.glsl\x3e\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  vec4 texColor \x3d textureLookup(tex, vtc);\r\n  if (texColor.a \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#else /* TEXTURING */\r\n  vec4 texColor \x3d vec4(1.0);\r\n#endif /* TEXTURING */\r\n\r\n  vec3 viewDir \x3d vpos - camPos;\r\n\r\n  // compute normal\r\n  // TODO: this is not in sync with the normal pass\r\n#ifdef GROUND_NORMAL_SHADING\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  vec3 normal \x3d normalize(vpos + localOrigin);\r\n#else\r\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n#else\r\n#ifdef DOUBLESIDED\r\n  vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n#elif defined(WINDINGORDERDOUBLESIDED)\r\n  vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\r\n#else\r\n  vec3 normal \x3d vnormal;\r\n#endif\r\n  normal \x3d normalize(normal);\r\n#endif\r\n\r\n  // compute ssao\r\n#ifdef RECEIVE_SSAO\r\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n#else\r\n  float ssao \x3d 1.0;\r\n#endif\r\n\r\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n  float additionalAmbientScale;\r\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\r\n\r\n  // compute shadowing\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#elif VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  // at global scale (and in global scenes) we fall back to this approximation\r\n  // to shadow objects on the dark side of the earth\r\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n#endif\r\n\r\n  vec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n\r\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n  albedo_+\x3d 0.25 * specular; // don't completely ignore specular for now\r\n\r\n#ifdef TRANSPARENCY_DISCARD\r\n  if (opacity_ \x3c 0.001) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n  gl_FragColor \x3d vec4(shadedColor, opacity_);\r\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\nuniform sampler2D uComponentColorTex;\r\nuniform vec2 uComponentColorTexInvDim;\r\n\r\nattribute float componentIndex;\r\n\r\nvec4 readComponentColor() {\r\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n  vec2 indexCoord \x3d vec2(\r\n    mod(normalizedIndex, 1.0),\r\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n  );\r\n  return texture2D(uComponentColorTex, indexCoord);\r\n}\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\nattribute vec4 symbolColor;\r\n#endif\r\n\r\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\r\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\r\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\r\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\r\n// This should be further cleaned up later with through the following issue:\r\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\r\nuniform vec4 externalColor;\r\n// the vertex color variable will contain vvColor and/or vvOpacity or 1,1,1,1\r\nvarying vec4 vcolor;\r\nvarying vec4 vcolorExt;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR) || defined(VV_OPACITY)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/pathMaterial/localNormal.glsl\x3e\r\n#include \x3cmaterials/pathMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  vpos \x3d calculateVPos();\r\n\r\n  vnormal \x3d normalize((modelNormal * localNormal()).xyz);\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n  vcolorExt \x3d externalColor;\r\n\r\n  vcolor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n#ifdef VV_COLOR\r\n  vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors);\r\n#endif\r\n#ifdef VV_OPACITY\r\n  // there might be opacity values in vvColor but according to the logic in graphicUtils.mixinColorAndOpacity,\r\n  // this value will be overridden by vvOpacity so we do the same here\r\n  vcolor.a \x3d vvGetOpacity(auxpos2, vvOpacityValues, vvOpacityOpacities);\r\n#endif\r\n\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n  // the v coordinate is stored in auxpos1.w\r\n#ifndef FLIPV\r\n  vtc \x3d vec2(uv0.x, auxpos1.w);\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-auxpos1.w);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"commonFunctions.glsl":"#include \x3cmaterials/pathMaterial/localPosition.glsl\x3e\r\n#include \x3cutil/doublePrecision.glsl\x3e\r\n\r\nvec3 calculateVPos() {\r\n  return (model * localPosition()).xyz;\r\n}","commonInputs.glsl":"uniform mat4 proj;\r\nuniform mat4 view;\r\n\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n\r\nuniform float size;\r\n\r\n// ---------------------------------------------- ++","depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n#ifndef BIAS_SHADOWMAP\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n}\r\n",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nuniform vec2 nearFar;\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1.0);\r\n\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"localNormal.glsl":"#include \x3cutil/normalEncoding.glsl\x3e\r\n\r\n# ifdef COMPRESSED_NORMALS\r\nvec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\r\n# else\r\nvec4 localNormal() { return vec4(normal, 1.0); }\r\n# endif\r\n","localPosition.glsl":"#ifdef VV_SIZE\r\nvec4 localPosition() {\r\n    vec3 sizeScale \x3d vvGetScale(auxpos2);\r\n    vec3 positionOffset \x3d auxpos1.xyz*sizeScale;\r\n    return vec4( position+positionOffset, 1.0 );\r\n}\r\n#else\r\nvec4 localPosition() {\r\n    vec3 sizeScale \x3d vec3(size);\r\n    vec3 positionOffset \x3d auxpos1.xyz*sizeScale;\r\n    return vec4(position+positionOffset, 1.0);\r\n}\r\n#endif\r\n",
"normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n}\r\n",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nuniform mat4 viewNormal;\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/pathMaterial/localNormal.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n  vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"texturing.glsl":"float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n  // from:\r\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n  //   - http://www.linedef.com/virtual-texture-demo.html\r\n  float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\r\n}\r\n\r\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\r\n  //[umin, vmin, umax, vmax]\r\n  vec2 atlasScale \x3d region.zw - region.xy;\r\n  vec2 uvAtlas \x3d fract(uv) * atlasScale + region.xy;\r\n\r\n  // calculate derivative of continuous texture coordinate\r\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\r\n  vec2 dUVdx \x3d dFdx(uv) * atlasScale;\r\n  vec2 dUVdy \x3d dFdy(uv) * atlasScale;\r\n\r\n#ifdef GL_EXT_shader_texture_lod\r\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\r\n#else\r\n  // use bias to compensate for difference in automatic vs desired mipmap level\r\n  vec2 dUVdxAuto \x3d dFdx(uvAtlas);\r\n  vec2 dUVdyAuto \x3d dFdy(uvAtlas);\r\n  float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n  float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n\r\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\r\n#endif\r\n}\r\n\r\nvec4 textureLookup(sampler2D tex, vec2 uv) {\r\n#ifdef TEXTURE_ATLAS\r\n  return textureAtlasLookup(tex, uv, regionV, texSize);\r\n#else\r\n  return texture2D(tex, uv);\r\n#endif\r\n}\r\n\r\n",
"visualVariables.glsl":"\r\n#if defined(VV_SIZE)\r\n  uniform vec3 vvSizeMinSize;\r\n  uniform vec3 vvSizeMaxSize;\r\n  uniform vec3 vvSizeOffset;\r\n  uniform vec3 vvSizeFactor;\r\n\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    // the 0.5 factor comes from the fact that the generated profiles have radius of 1\r\n    // but the old implementation of the Graphics3DPathSymbolLayer actually had a profile radius of 0.5\r\n    // for constant size values the 0.5 is applied in Graphcis3DPathSymbolLayer when setting material parms\r\n    // we might want to change the path geometry generation so that it produces profile radius of 0.5 too\r\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize)*0.5;\r\n  }\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  #define VV_COLOR_N 8\r\n  uniform float vvColorValues[VV_COLOR_N];\r\n  uniform vec4 vvColorColors[VV_COLOR_N];\r\n\r\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n    float value \x3d featureAttribute.y;\r\n    if (value \x3c\x3d values[0]) {\r\n      return colors[0];\r\n    }\r\n\r\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n      if (values[i] \x3e\x3d value) {\r\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n        return mix(colors[i-1], colors[i], f);\r\n      }\r\n    }\r\n\r\n    return colors[VV_COLOR_N - 1];\r\n  }\r\n#endif\r\n\r\n\r\n#ifdef VV_OPACITY\r\n  #define VV_OPACITY_N 8\r\n  uniform float vvOpacityValues[VV_OPACITY_N];\r\n  uniform float vvOpacityOpacities[VV_OPACITY_N];\r\n\r\n  float vvGetOpacity(vec4 featureAttribute, float values[VV_OPACITY_N], float opacities[VV_OPACITY_N]) {\r\n    float value \x3d featureAttribute.z;\r\n    if (value \x3c\x3d values[0]) {\r\n      return opacities[0];\r\n    }\r\n\r\n    for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\r\n      if (values[i] \x3e\x3d value) {\r\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n        return mix(opacities[i-1], opacities[i], f);\r\n      }\r\n    }\r\n\r\n    return opacities[VV_OPACITY_N - 1];\r\n  }\r\n#endif\r\n\r\n"},
ribbonLine:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 eColor;\r\nvarying vec4 vColor;\r\nvarying vec2 vtc;\r\nvarying vec3 vpos;\r\n\r\n#ifdef STIPPLE\r\nuniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef STIPPLE\r\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightSlice(eColor * vColor, vpos);\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec2 vtc;\r\nvarying vec3 vpos;\r\n\r\n#ifdef STIPPLE\r\nuniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef STIPPLE\r\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n}\r\n","ribbonLine.vert":'#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nuniform float extLineWidth;\r\nuniform float nearPlane;\r\nuniform float pixelRatio;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\nattribute vec4 color;\r\n\r\nvarying vec2 vtc;\r\nvarying vec4 vColor;\r\nvarying vec3 vpos;\r\n\r\nattribute float size;\r\n\r\n#ifndef WALL\r\nuniform float miterLimit;\r\nattribute vec3 auxpos1;\r\nattribute vec3 auxpos2;\r\n#endif\r\n\r\n#ifdef SCREENSCALE\r\nuniform vec2 screenSize;\r\n\r\nvec4 toScreenCoords(vec3 vertex) {\r\n  vec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\r\n  vClipSpace.xy *\x3d screenSize;\r\n  return vClipSpace/abs(vClipSpace.w);\r\n}\r\n\r\n#define VECTYPE vec2\r\n#define ZEROVEC vec2(0.0, 0.0)\r\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\r\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\r\n\r\n#else //ifdef SCREENSCALE\r\n\r\n#define VECTYPE vec3\r\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\r\n// these macros are only valid for "strip" type lines:\r\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\r\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*uv0.y \x3c 0.0\r\n\r\n#endif //ifdef SCREENSCALE\r\n\r\nfloat interp(float ncp, vec4 a, vec4 b) {\r\n  return (-ncp - a.z) / (b.z - a.z);\r\n}\r\n\r\n#ifdef SCREENSCALE\r\n\r\nvoid clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\r\n  float vnp \x3d nearPlane*0.99;\r\n\r\n  //We have four vertices per point on the line. Start and end vertices\r\n  //are treated differently --\x3e d \x3e 0, d \x3c 0\r\n  float d \x3d abs(uv0.y) - 1.1;\r\n\r\n  //current pos behind ncp --\x3e we need to clip\r\n  if(pos.z \x3e -nearPlane) {\r\n    if (d \x3c 0.0) {\r\n      //previous in front of ncp\r\n      if(prev.z \x3c -nearPlane) {\r\n        pos \x3d mix(prev, pos, interp(vnp, prev, pos));\r\n        next \x3d pos;\r\n      } else {\r\n        pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\r\n      }\r\n    }\r\n    //next in front of ncp\r\n    if(d \x3e 0.0) {\r\n      if(next.z \x3c -nearPlane) {\r\n        pos \x3d mix(pos, next, interp(vnp, pos, next));\r\n        prev \x3d pos;\r\n      } else {\r\n        pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\r\n      }\r\n    }\r\n  } else {\r\n    //current position visible\r\n    //previous behind ncp\r\n    if (prev.z \x3e -nearPlane) {\r\n      prev \x3d mix(pos, prev, interp(vnp, pos, prev));\r\n    }\r\n    //next behind ncp\r\n    if (next.z \x3e -nearPlane) {\r\n      next \x3d mix(next, pos, interp(vnp, next, pos));\r\n    }\r\n  }\r\n\r\n  pos\x3d proj * pos;\r\n  pos.xy *\x3d screenSize;\r\n  pos /\x3d pos.w;\r\n\r\n  next \x3d proj * next;\r\n  next.xy *\x3d screenSize;\r\n  next /\x3d next.w;\r\n\r\n  prev \x3d proj * prev;\r\n  prev.xy *\x3d screenSize;\r\n  prev /\x3d prev.w;\r\n}\r\n\r\n#endif // SCREENSCALE\r\n\r\nvoid main(void) {\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n\r\n#ifdef SCREENSCALE\r\n// Check for special value of uv0.y which is used by the Renderer when graphics\r\n// are removed before the VBO is recompacted. If this is the case, then we just\r\n// project outside of clip space.\r\nif (uv0.y \x3d\x3d 0.0) {\r\n  // Project out of clip space\r\n  gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n}\r\nelse {\r\n#endif\r\n\r\nfloat lineWidth \x3d (extLineWidth + size) * pixelRatio;\r\n\r\n#ifdef SCREENSCALE\r\n\r\n#if 0\r\n  vec4 pos \x3d toScreenCoords(position.xyz);\r\n  vec2 left \x3d (pos - toScreenCoords(auxpos1)).xy;\r\n  vec2 right \x3d (toScreenCoords(auxpos2) - pos).xy;\r\n#else\r\n  vec4 pos  \x3d view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\r\n  vec4 prev \x3d view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\r\n  vec4 next \x3d view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\r\n\r\n  clipAndTransform(pos, prev, next);\r\n\r\n  vec2 left \x3d (pos - prev).xy;\r\n  vec2 right \x3d (next - pos).xy;\r\n#endif\r\n\r\n#else // ifdef SCREENSCALE\r\n  vec4 pos \x3d vec4(position, 1.0);\r\n#ifndef WALL\r\n  vec3 left \x3d position.xyz - auxpos1;\r\n  vec3 right \x3d auxpos2 - position.xyz;\r\n  vec3 up \x3d normalize(position.xyz);\r\n#endif // ifndef WALL\r\n#endif // ifdef SCREENSCALE\r\n\r\n#ifdef WALL\r\n  float displacementLen \x3d lineWidth;\r\n  vec3 displacementDir \x3d normalize(position.xyz);//vec3(0.0, 1.0, 0.0);\r\n#else // ifdef WALL\r\n\r\n  float leftLen \x3d length(left);\r\n  left \x3d (leftLen \x3e 0.001) ? left/leftLen : ZEROVEC;\r\n\r\n  float rightLen \x3d length(right);\r\n  right \x3d (rightLen \x3e 0.001) ? right/rightLen : ZEROVEC;\r\n\r\n  // determine if vertex is on the "outside or "inside" of the join\r\n  bool isOutside \x3d ISOUTSIDE;\r\n\r\n  // compute miter join position first\r\n  float displacementLen \x3d lineWidth;\r\n  VECTYPE displacementDir \x3d normalize(left + right);\r\n  displacementDir \x3d PERPENDICULAR(displacementDir);\r\n  if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\r\n    float nDotSeg \x3d dot(displacementDir, left);\r\n    displacementLen /\x3d length(nDotSeg*left - displacementDir);\r\n\r\n    // limit displacement of inner vertices\r\n    if (!isOutside) {\r\n      displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\r\n    }\r\n  }\r\n\r\n  if (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\r\n    // convert to bevel join if miterLimit is exceeded\r\n    if (leftLen \x3c 0.001) {\r\n      displacementDir \x3d right;\r\n    }\r\n    else if (rightLen \x3c 0.001) {\r\n      displacementDir \x3d left;\r\n    }\r\n    else {\r\n      displacementDir \x3d (abs(uv0.y) - 1.1 \x3c 0.0) ? left : right;\r\n    }\r\n    displacementDir \x3d normalize(displacementDir);\r\n    displacementDir \x3d PERPENDICULAR(displacementDir);\r\n    displacementLen \x3d lineWidth;\r\n  }\r\n\r\n#endif // ifdef WALL\r\n\r\n#ifdef SCREENSCALE\r\n  pos.xy +\x3d displacementDir * floor(uv0.y + 0.5) * displacementLen;\r\n  pos.xy /\x3d screenSize;\r\n#else\r\n  pos.xyz +\x3d displacementDir * floor(uv0.y + 0.5) * displacementLen;\r\n  pos \x3d proj * view * model * pos;\r\n#endif\r\n\r\n  vtc \x3d uv0;\r\n  vColor \x3d color * 0.003921568627451; // \x3d 1/255\r\n  gl_Position \x3d pos;\r\n\r\n#ifdef SCREENSCALE\r\n  }\r\n#endif\r\n}\r\n'},
slicePlane:{"slicePlane.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 backgroundColor;\r\nuniform vec4 gridColor;\r\nuniform float ratio;\r\nuniform float gridWidth;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main() {\r\n  const float LINE_WIDTH \x3d 1.0;\r\n\r\n  vec2 uvScaled \x3d vUV * gridWidth;\r\n  vec2 gridUV \x3d (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\r\n  vec2 grid \x3d (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\r\n\r\n  // mask aliasing along edges\r\n  grid.x *\x3d step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\r\n  grid.y *\x3d step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\r\n\r\n  float gridFade \x3d max(grid.x, grid.y);\r\n\r\n  float gridAlpha \x3d gridColor.a * gridFade;\r\n\r\n  // premultiply alpha in output\r\n  gl_FragColor \x3d\r\n    vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\r\n    vec4(gridColor.rgb, 1.0) * gridAlpha;\r\n}\r\n",
"slicePlane.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n  vUV \x3d uv0;\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n}\r\n"}},misc:{"blendLayers.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec2 uv;\r\n\r\nuniform sampler2D tex;\r\nuniform float opacity;\r\n\r\nvoid main() {\r\n  vec4 color \x3d texture2D(tex, uv);\r\n\r\n  // Note: output in pre-multiplied alpha for correct alpha compositing\r\n  gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\r\n}\r\n",
"blendLayers.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nuniform float scale;\r\nuniform vec2 offset;\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position, 1.0);\r\n  uv \x3d uv0 * scale + offset;;\r\n}\r\n","texOnly.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\nuniform vec4 color;\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  vec4 texColor \x3d texture2D(tex, vtc);\r\n  gl_FragColor \x3d texColor * color;\r\n}\r\n",
"texOnly.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position, 1.0);\r\n  vtc \x3d uv0;\r\n}\r\n"},pointRenderer:{"pointRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\n#ifdef DEPTH_PASS\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n  vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\r\n  float r2 \x3d dot(vOffset, vOffset);\r\n\r\n  if (r2 \x3e 0.25) {\r\n    discard;\r\n  }\r\n\r\n#ifdef DEPTH_PASS\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d vec4(vColor, 1.0);\r\n#endif\r\n}\r\n",
"pointRenderer.vert":"#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 aPosition;\r\nattribute vec3 aColor;\r\n\r\nuniform mat4 uModelViewMatrix;\r\nuniform mat4 uProjectionMatrix;\r\nuniform vec2 uScreenMinMaxSize;\r\nuniform vec2 uPointScale;\r\nuniform vec3 uClipMin;\r\nuniform vec3 uClipMax;\r\n\r\n#ifdef DEPTH_PASS\r\nuniform vec2 nearFar;\r\n\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n  // Move clipped points outside of clipspace\r\n  if (aPosition.x \x3c uClipMin.x || aPosition.y \x3c uClipMin.y || aPosition.z \x3c uClipMin.z ||\r\n      aPosition.x \x3e uClipMax.x || aPosition.y \x3e uClipMax.y || aPosition.z \x3e uClipMax.z) {\r\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\r\n    gl_PointSize \x3d 0.0;\r\n    return;\r\n  }\r\n\r\n  if (rejectBySlice(aPosition)) {\r\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\r\n    gl_PointSize \x3d 0.0;\r\n    return;\r\n  }\r\n\r\n  // Position in camera space\r\n  vec4 camera \x3d uModelViewMatrix * vec4(aPosition, 1.0);\r\n\r\n  float pointSize \x3d uPointScale.x;\r\n  vec4 position \x3d uProjectionMatrix * camera;\r\n\r\n  // Calculate Size\r\n#ifdef DRAW_SCREEN_SIZE\r\n    float clampedScreenSize \x3d pointSize;\r\n#else\r\n    float pointRadius \x3d 0.5 * pointSize;\r\n    vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\r\n    vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\r\n    float radius \x3d abs(positionOffset.y - position.y);\r\n\r\n    float viewHeight \x3d uPointScale.y;\r\n\r\n    // screen diameter \x3d (2 * r / w) * (h / 2)\r\n    float screenPointSize \x3d (radius / position.w) * viewHeight;\r\n    float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\r\n\r\n    // Shift towards camera, to move rendered point out of terrain i.e. to\r\n    // the camera-facing end of the virtual point when considering it as a\r\n    // 3D sphere.\r\n    camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\r\n    position \x3d uProjectionMatrix * camera;\r\n#endif\r\n\r\n  gl_PointSize \x3d clampedScreenSize;\r\n  gl_Position \x3d position;\r\n\r\n#ifdef DEPTH_PASS\r\n  depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n#else\r\n  vColor \x3d aColor;\r\n#endif\r\n}\r\n"},
renderer:{highlight:{"apply.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Merging blurred outlines with source image, advanced version\r\n\r\n// Defines:\r\n// GRID_OPTIMIZATION (set or !set)\r\n// GRID_DEBUG (set or !set)\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\nuniform sampler2D origin;\r\n\r\nuniform vec4 color;\r\nuniform float outlineSize;\r\nuniform float blurSize;\r\nuniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main() {\r\n  #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\r\n    gl_FragColor \x3d vec4(uv, 0.0, 1.0);\r\n  #else\r\n    // Read the highlight intensity from the blurred highlight image\r\n    vec4 blurredHighlightValue \x3d texture2D(tex, uv);\r\n    float highlightIntensity \x3d blurredHighlightValue.a;\r\n\r\n    // Discard all pixels which are not affected by highlight\r\n    if (highlightIntensity \x3d\x3d 0.0) {\r\n      discard;\r\n    }\r\n\r\n    vec4 origin_color \x3d texture2D(origin, uv);\r\n\r\n    float outlineIntensity;\r\n    float fillIntensity;\r\n\r\n    // if occluded\r\n    if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\r\n      outlineIntensity \x3d color.w * opacities[1];\r\n      fillIntensity \x3d color.w * opacities[3];\r\n    }\r\n    // if unoccluded\r\n    else {\r\n      outlineIntensity \x3d color.w * opacities[0];\r\n      fillIntensity \x3d color.w * opacities[2];\r\n    }\r\n\r\n    float inner \x3d 1.0 - outlineSize / 9.0;\r\n    float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\r\n\r\n    float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\r\n    //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\r\n    float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\r\n    float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\r\n\r\n    // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n    // I.e., color should not be premultiplied with alpha\r\n    gl_FragColor \x3d vec4(color.xyz, intensity);\r\n  #endif\r\n}\r\n",
"apply.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 uv;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  attribute vec2 uv0;\r\n  uniform sampler2D coverageTex;\r\n#endif\r\n\r\nvoid main() {\r\n  #ifdef GRID_OPTIMIZATION\r\n    #ifdef GRID_DEBUG\r\n      vec4 cov \x3d texture2D(coverageTex, uv0);\r\n      // if no highlight pixel set in this block,\r\n      // or all pixels set, hide block\r\n      if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\r\n        gl_Position \x3d vec4(0.0);\r\n        return;\r\n      }\r\n      gl_Position \x3d vec4(position, .0, 1.0);\r\n      uv \x3d uv0;\r\n      return;\r\n    #else\r\n      vec4 cov \x3d texture2D(coverageTex, uv0);\r\n      // if no highlight pixel set in this block, hide block\r\n      if (cov.r \x3d\x3d 0.0) {\r\n        gl_Position \x3d vec4(0.0);\r\n        return;\r\n      }\r\n    #endif\r\n  #endif\r\n\r\n  gl_Position \x3d vec4(position, .0, 1.0);\r\n  uv \x3d position.xy * .5 + vec2(.5);\r\n}\r\n",
"blur.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Gaussian blur with linear sampling. Supports different number of samples, but\r\n// only 5 samples have proper weights. Uses linear texture interpolation to reduce\r\n// the number of samples taken.\r\n\r\n// Defines:\r\n// GRID_OPTIMIZATION (set or !set)\r\n// GAUSSIAN_SAMPLES (3,5,7)\r\n\r\n// This technique requires linear filtering on source texture\r\n// http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  uniform vec2 blurSize;\r\n  varying vec3 blurCoordinate;\r\n#else\r\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n#endif\r\n\r\nvoid main() {\r\n  #ifdef GRID_OPTIMIZATION\r\n    vec2 uv \x3d blurCoordinate.xy;\r\n    vec4 center \x3d texture2D(tex, uv);\r\n\r\n    // do not blur if no pixel or all pixels in neighborhood are set\r\n    if (blurCoordinate.z \x3d\x3d 1.0) {\r\n      gl_FragColor \x3d center;\r\n    }\r\n    else {\r\n      vec4 sum \x3d vec4(0.0);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.154164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\r\n      #endif\r\n\r\n      gl_FragColor \x3d sum;\r\n    }\r\n  #else\r\n    vec4 sum \x3d vec4(0.0);\r\n\r\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\r\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\r\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\r\n      sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\r\n      sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\r\n    #endif\r\n\r\n    gl_FragColor \x3d sum;\r\n  #endif\r\n}\r\n",
"blur.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nattribute vec2 uv0;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  uniform sampler2D coverageTex;\r\n  varying vec3 blurCoordinate;\r\n#else\r\n  uniform vec2 blurSize;\r\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n#endif\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(position, 0.0, 1.0);\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    // sample the coverage texture at the block center\r\n    // and if no coverage detected, create degenerate triangle\r\n    vec4 cov \x3d texture2D(coverageTex, uv0);\r\n    if (cov.r \x3d\x3d 0.0) {\r\n      gl_Position \x3d vec4(0.0);\r\n    }\r\n\r\n    // create texture coordinate for blur center\r\n    // encode information about fully inside block in z coordinate\r\n    blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\r\n  #else\r\n    vec2 uv \x3d position.xy * .5 + vec2(.5);\r\n\r\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n      blurCoordinates[7] \x3d uv + blurSize * 7.1;\r\n      blurCoordinates[8] \x3d uv - blurSize * 7.1;\r\n    #endif\r\n  #endif\r\n}\r\n",
"downsample.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Smartly downsamples a texture, halfing its resolution. This allows for a square\r\n// screen region to check if none, any or all pixels were set.\r\n\r\n// The red channel is always ceiled after interpolating the 4 merged pixels.\r\n// This allows to evaluate:\r\n// any(pixels.red !\x3d 0.0) as red \x3d\x3d 1.0\r\n// none(pixels.red !\x3d 0.0) as red \x3d\x3d 0.0\r\n\r\n// The green and blue channels are set to floor(max(green, blue)).\r\n// This allows to evaluate:\r\n// all(pixels.green || pixels.blue) as green \x3d\x3d 1.0\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\nuniform vec2 invFramebufferDim;\r\n\r\nvoid main() {\r\n  vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\r\n  vec4 value \x3d texture2D(tex, coord);\r\n  float mx \x3d floor(max(value.g, value.b));\r\n  gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\r\n}\r\n",
"downsample.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(vec2(1.0) - position * 2.0, .0, 1.0);\r\n}\r\n"},laserLine:{"laserLine.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n\r\n//--------------------------------------------------------------------------\r\n// Uniforms\r\n//--------------------------------------------------------------------------\r\n\r\nuniform sampler2D depthMap;\r\n\r\nuniform vec2 nearFar;\r\nuniform vec4 projInfo;\r\nuniform vec2 zScale;\r\nuniform float maxPixelDistance;\r\n\r\n// focus plane in camera space\r\nuniform vec4 focusPlane;\r\n\r\n// focus sphere in camera space\r\nuniform vec4 focusSphere;\r\n\r\n// segment plane in camera space\r\nuniform vec4 segmentPlane;\r\n\r\n// line segment\r\nuniform vec3 segmentStart;\r\nuniform vec3 segmentEnd;\r\n\r\n// styling\r\nuniform vec3 glowColor;\r\nuniform float glowWidth;\r\nuniform vec3 innerColor;\r\nuniform float innerWidth;\r\nuniform float globalAlpha;\r\n\r\n//--------------------------------------------------------------------------\r\n// Inputs\r\n//--------------------------------------------------------------------------\r\n\r\nvarying vec2 uv;\r\n\r\n//--------------------------------------------------------------------------\r\n// Defines\r\n//--------------------------------------------------------------------------\r\n\r\n#define INFINITY 100000.0\r\n\r\n// reconstruct position in view space\r\nvec3 reconstructPosition(vec2 fragCoord, float depth) {\r\n  return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\r\n}\r\n\r\nfloat planeDistancePixels(vec4 plane, vec3 pos) {\r\n  // compute distance to plane\r\n  float dist \x3d dot(plane.xyz, pos) + plane.w;\r\n  // compute derivative of distance function with respect to pixels\r\n  float width \x3d fwidth(dist);\r\n  // normalize distance by the derivative to get a measurement with respect to pixels\r\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\r\n  dist /\x3d min(width, maxPixelDistance);\r\n  return abs(dist);\r\n}\r\n\r\nfloat sphereDistancePixels(vec4 sphere, vec3 pos) {\r\n  // compute distance to sphere\r\n  float dist \x3d distance(sphere.xyz, pos) - sphere.w;\r\n  // compute derivative of distance function with respect to pixels\r\n  float width \x3d fwidth(dist);\r\n  // normalize distance by the derivative to get a measurement with respect to pixels\r\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\r\n  dist /\x3d min(width, maxPixelDistance);\r\n  return abs(dist);\r\n}\r\n\r\nvec4 blendPremultiplied(vec4 source, vec4 dest) {\r\n  float oneMinusSourceAlpha \x3d 1.0 - source.a;\r\n\r\n  return vec4(\r\n    source.rgb + dest.rgb * oneMinusSourceAlpha,\r\n    source.a + dest.a * oneMinusSourceAlpha\r\n  );\r\n}\r\n\r\nvec4 premultipliedColor(vec3 rgb, float alpha) {\r\n  return vec4(rgb * alpha, alpha);\r\n}\r\n\r\n// computes laser line color based on distance in pixels\r\nvec4 laserLineProfile(float dist) {\r\n  if (dist \x3e glowWidth) {\r\n    return vec4(0.0);\r\n  }\r\n\r\n  float innerAlpha \x3d (1.0 - smoothstep(0.0, innerWidth, dist));\r\n  float glowAlpha \x3d pow(max(0.0, 1.0 - dist / glowWidth), 8.0);\r\n\r\n  return blendPremultiplied(\r\n    premultipliedColor(innerColor, innerAlpha),\r\n    premultipliedColor(glowColor, glowAlpha)\r\n  );\r\n}\r\n\r\nvoid main() {\r\n  // do not draw laserline on background\r\n  float depth \x3d linearDepth(depthMap, uv, nearFar);\r\n  if (-depth \x3d\x3d nearFar[0]) {\r\n    discard;\r\n  }\r\n\r\n  // reconstruct position in view space\r\n  vec3 pos \x3d reconstructPosition(gl_FragCoord.xy, depth);\r\n\r\n  // empirical hack to fade out laser line in problematic areas:\r\n  // the derivatives to normalize the distance function are valid inside smooth surfaces,\r\n  // but break down at depth discontinuities (e.g. edges). We fade out the laser lines in\r\n  // areas where depth valus have large variations in order to avoid this problem.\r\n  float ddepth \x3d fwidth(depth);\r\n  float depthDiscontinuityAlpha \x3d 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\r\n\r\n  // reconstruct normal using derivatives\r\n  vec3 normal \x3d normalize(cross(dFdx(pos), dFdy(pos)));\r\n\r\n  // distance to focus plane\r\n  float focusPlaneDistance \x3d planeDistancePixels(focusPlane, pos);\r\n\r\n  // distance to focus sphere\r\n  float focusSphereDistance \x3d sphereDistancePixels(focusSphere, pos);\r\n\r\n  // distance to segment plane\r\n  float segmentDistance \x3d INFINITY;\r\n  float segmentLength \x3d length(segmentEnd - segmentStart);\r\n  vec3 segmentDir \x3d (segmentEnd - segmentStart) / segmentLength;\r\n  float t \x3d dot(segmentDir, pos - segmentStart);\r\n\r\n  if (segmentLength \x3e 0.0 \x26\x26 t \x3e\x3d 0.0 \x26\x26 t \x3c\x3d segmentLength) {\r\n    segmentDistance \x3d planeDistancePixels(segmentPlane, pos);\r\n  }\r\n\r\n  // evaluate color profile for both planes and the sphere\r\n  vec4 focusPlaneColor \x3d laserLineProfile(focusPlaneDistance);\r\n  vec4 focusSphereColor \x3d laserLineProfile(focusSphereDistance);\r\n  vec4 segmentColor \x3d laserLineProfile(segmentDistance);\r\n\r\n  // empirical hack to fade out laser line when planes are nearly parallel\r\n  float focusPlaneAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, focusPlane.xyz)));\r\n  float focusSphereAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, normalize(pos - focusSphere.xyz))));\r\n  float segmentAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, segmentPlane.xyz)));\r\n\r\n  // combine colors\r\n  vec4 color \x3d max(\r\n    focusPlaneColor * focusPlaneAlpha,\r\n    max(\r\n      focusSphereColor * focusSphereAlpha,\r\n      segmentColor * segmentAlpha\r\n    )\r\n  );\r\n\r\n  gl_FragColor \x3d color * globalAlpha * depthDiscontinuityAlpha;\r\n}\r\n"},
offscreen:{"composite.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d texture2D(tex, vtc);\r\n}\r\n","compositeOccluded.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D occludedColorMap;\r\nuniform float opacity;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  vec4 occludedColor \x3d texture2D(occludedColorMap, vtc);\r\n  gl_FragColor \x3d occludedColor * opacity;\r\n}\r\n","compositeTransparentToHUDVisibility.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d vec4(1.0 - texture2D(tex, vtc).a);\r\n}\r\n",
"offscreen.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position.xy, 0.0, 1.0);\r\n  vtc \x3d position.xy * 0.5 + 0.5;\r\n}\r\n"},ssao:{"blur.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n\r\n#ifndef RADIUS\r\n#define RADIUS 4\r\n#endif\r\n\r\nuniform sampler2D normalMap;\r\nuniform sampler2D depthMap;\r\nuniform sampler2D tex;\r\n\r\nuniform vec2 blurSize;\r\n\r\nuniform float g_BlurFalloff;\r\nuniform float projScale;\r\n\r\nuniform vec2 nearFar;\r\n//set z scaling, used to prevent division in ortho mode\r\nuniform vec2 zScale;\r\n\r\nvarying vec2 uv;\r\n\r\nfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\r\n  float c \x3d texture2D(tex, uv).r;\r\n  float d \x3d linearDepth(depthMap, uv, nearFar);\r\n\r\n  float ddiff \x3d d - center_d;\r\n\r\n  float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\r\n\r\n  w_total +\x3d w;\r\n\r\n  return w*c;\r\n}\r\n\r\nvoid main(void) {\r\n  float b \x3d 0.0;\r\n  float w_total \x3d 0.0;\r\n\r\n  float center_d \x3d linearDepth(depthMap, uv, nearFar);\r\n\r\n  float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\r\n  for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\r\n    float rf \x3d float(r);\r\n    vec2 uvOffset \x3d uv + rf*blurSize;\r\n    b +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\r\n  }\r\n\r\n  gl_FragColor \x3d vec4(b/w_total);\r\n}\r\n",
"ssao.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n\r\n#ifndef SAMPLES\r\n#define SAMPLES 4\r\n#endif\r\n\r\nuniform mat4 projMatrixInv;\r\n\r\nuniform sampler2D normalMap;\r\nuniform sampler2D depthMap;\r\n\r\nuniform float intensity;\r\n\r\nuniform float projScale;\r\nuniform float radius;\r\nuniform vec2 nearFar;\r\nuniform vec4 projInfo;\r\nuniform vec2 screenDimensions;\r\n\r\n//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\r\nuniform vec3 pSphere[SAMPLES]; //tap position\r\nuniform vec2 rnmScale;\r\nuniform sampler2D rnm; //noise texture\r\n\r\n//set z scaling, used to prevent division in ortho mode\r\nuniform vec2 zScale;\r\n\r\nvarying vec2  uv;\r\nvarying vec4  camPos;\r\n\r\nfloat fallOffFunction(float vv, float vn, float bias) {\r\n  float radius2 \x3d radius * radius;\r\n\r\n  // A: From the HPG12 paper\r\n  // Note large epsilon to avoid overdarkening within cracks\r\n  // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\r\n\r\n  // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\r\n  float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\r\n\r\n  // C: Medium contrast (which looks better at high radii), no division.  Note that the\r\n  // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\r\n  // more computationally efficient and happens to be aesthetically pleasing.\r\n  // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\r\n\r\n  // D: Low contrast, no division operation\r\n  // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\r\n}\r\n\r\n\r\n/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\r\nfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\r\n  vec3 v \x3d Q - C;\r\n  float vv \x3d dot(v, v);\r\n  float vn \x3d dot(normalize(v), n_C);\r\n  return fallOffFunction(vv, vn, 0.1);\r\n}\r\n\r\n\r\n/**\r\n * Reconstruct camera-space P.xyz from screen-space S \x3d (x, y) in\r\n * pixels and camera-space z \x3c 0.  Assumes that the upper-left pixel center\r\n * is at (0.5, 0.5) [but that need not be the location at which the sample tap\r\n * was placed!]\r\n *\r\n * Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\r\n */\r\nvec3 reconstructCSPosition(vec2 S, float z) {\r\n  return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\r\n}\r\n\r\nvoid main(void) {\r\n  //Hash function used in the HPG12 AlchemyAO paper\r\n  //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\r\n  //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\r\n  //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\r\n  vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\r\n  float currentPixelDepth \x3d linearDepth(depthMap, uv, nearFar);\r\n\r\n  if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\r\n    gl_FragColor \x3d vec4(0.0);\r\n    return;\r\n  }\r\n\r\n  vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\r\n\r\n  // get the normal of current fragment\r\n  vec4 norm4 \x3d texture2D(normalMap, uv);\r\n  vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\r\n  bool isTerrain \x3d norm4.w\x3c0.5;\r\n\r\n  float sum \x3d .0;\r\n\r\n  vec4 occluderFragment;\r\n  vec3 ray;\r\n\r\n  vec3 tapPixelPos;\r\n\r\n  // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\r\n  // bug or deviation from CE somewhere else?\r\n  float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\r\n\r\n  for(int i \x3d 0; i \x3c SAMPLES; ++i) {\r\n    // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\r\n    //float ssR;\r\n    //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\r\n    // get the depth of the occluder fragment\r\n    //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\r\n\r\n    vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\r\n    vec2 offset \x3d vec2(-unitOffset*radius*ps);\r\n\r\n    //don't use current or very nearby samples\r\n    if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\r\n\r\n    vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\r\n    if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\r\n    vec2 tcTap \x3d tc/screenDimensions;\r\n    float occluderFragmentDepth \x3d linearDepth(depthMap, tcTap, nearFar);\r\n\r\n    if (isTerrain) {\r\n      bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\r\n      if (isTerrainTap) {\r\n        continue;\r\n      }\r\n    }\r\n\r\n    tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\r\n\r\n    sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\r\n  }\r\n\r\n  // output the result\r\n\r\n  float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\r\n\r\n  // Anti-tone map to reduce contrast and drag dark region farther\r\n  // (x^0.2 + 1.2 * x^4)/2.2\r\n  A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\r\n\r\n  //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\r\n  //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\r\n  //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\r\n  gl_FragColor \x3d vec4(A);\r\n}\r\n"}},
terrainRenderer:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n#include \x3cutil/screenSizePerspective.glsl\x3e\r\n#include \x3cutil/shadow.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cterrainRenderer/overlay.glsl\x3e\r\n\r\nuniform vec3 lightDirection;\r\nuniform vec3 viewDirection;\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\nuniform sampler2D tex;\r\nuniform float opacity;\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nstruct WireframeSettings {\r\n  float width;\r\n  float falloff;\r\n  float subdivision;\r\n  vec4 color;\r\n  float wireOpacity;\r\n  float surfaceOpacity;\r\n};\r\n\r\nuniform WireframeSettings wireframe;\r\n#endif\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\nvarying vec2 vtc;\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nvarying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\nvarying vec3 wpos;\r\nvarying vec3 wview;\r\nvarying vec3 wnormal;\r\nvarying vec3 wlight;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\nuniform vec4 screenSizePerspective;\r\n\r\nvarying float screenSizeDistanceToCamera;\r\nvarying float screenSizeCosAngle;\r\n#endif\r\n\r\nconst vec3 ambient \x3d vec3(0.2,0.2,0.2);\r\nconst vec3 diffuse \x3d vec3(0.8,0.8,0.8);\r\nconst float diffuseHardness \x3d 2.5;\r\nconst float sliceOpacity \x3d 0.2;\r\n\r\n#ifdef OVERLAY\r\nuniform sampler2D overlay0Tex;\r\nuniform sampler2D overlay1Tex;\r\nuniform float overlayOpacity;\r\nvarying vec4 vtcOverlay;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\nfloat lum(vec3 c) {\r\n  float max \x3d max(max(c.r, c.g), c.b);\r\n  float min \x3d min(min(c.r, c.g), c.b);\r\n  return (min + max) * 0.5;\r\n}\r\n\r\n#ifdef ATMOSPHERE\r\nvec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\r\n  vec3 surfaceColor   \x3d vec3(0.0);\r\n  vec3 fuzzySpecColor \x3d vec3(1.0);\r\n  vec3 subColor       \x3d vec3(0.0);\r\n  float rollOff       \x3d 1.0;\r\n\r\n  vec3 Ln \x3d normalize(lightPos);\r\n  vec3 Nn \x3d normalize(normal);\r\n  vec3 Hn \x3d normalize(view + Ln);\r\n\r\n  float ldn \x3d dot(Ln, Nn);\r\n  float diffComp \x3d max(0.0, ldn);\r\n  float vdn \x3d 1.0 - dot(view, Nn);\r\n  float ndv \x3d dot(view, Ln);\r\n\r\n  vec3 diffContrib \x3d surfaceColor * diffComp;\r\n  float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\r\n\r\n  vec3 subContrib \x3d subLamb * subColor;\r\n  vec3 vecColor \x3d vec3(vdn);\r\n\r\n  vec3 diffuseContrib \x3d (subContrib + diffContrib);\r\n  vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\r\n\r\n  return (diffContrib + specularContrib) * rollOff;\r\n}\r\n#endif\r\n\r\nvoid main() {\r\n  vec3 a \x3d ambient;\r\n\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#endif\r\n  float vndl \x3d dot(normalize(vnormal), lightDirection);\r\n  float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\r\n  vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\r\n\r\n  float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n\r\n  vec4 tileColor \x3d texture2D(tex, vtc) * opacity;\r\n\r\n#ifdef OVERLAY\r\n  vec4 overlayColor \x3d getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\r\n\r\n  // tileColor and overlayTexCols have pre-multiplied alpha\r\n  tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;\r\n#endif\r\n\r\n  if (rejectBySlice(vpos)) {\r\n    tileColor *\x3d sliceOpacity;\r\n  }\r\n\r\n  vec3 atm \x3d vec3(0.0);\r\n#ifdef ATMOSPHERE\r\n  float ndotl \x3d max(0.0, min(1.0, vndl));\r\n  atm \x3d atmosphere(wlight, wnormal, -viewDirection);\r\n  atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\r\n  atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\r\n  atm *\x3d tileColor.a; // premultiply with tile alpha\r\n#endif\r\n\r\n  vec3 albedo \x3d atm + tileColor.rgb;\r\n  vec3 normal \x3d normalize(vnormal);\r\n\r\n  // heuristic shading function used in the old terrain, now used to add ambient lighting\r\n  float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\r\n  vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n\r\n  gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n  // This is only used for debug rendering the screenSize perspective\r\n\r\n  float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\r\n\r\n  if (perspectiveScale \x3c\x3d 0.25) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\r\n  }\r\n  else if (perspectiveScale \x3c\x3d 0.5) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\r\n  }\r\n  else if (perspectiveScale \x3e\x3d 0.99) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\r\n  }\r\n\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n\r\n  vec2 vuvScaled \x3d vuv * wireframe.subdivision;\r\n  vec2 vuvMod \x3d fract(vuvScaled);\r\n\r\n  vec2 dVuv \x3d fwidth(vuvScaled);\r\n  dVuv \x3d max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\r\n\r\n  vec2 edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                                wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\r\n\r\n  float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n#ifdef WIREFRAME_TEXTURE\r\n  vec3 wireframeColor \x3d mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a);\r\n  float wireframeAlpha \x3d mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor);\r\n  gl_FragColor \x3d vec4(wireframeColor * wireframeAlpha, wireframeAlpha * gl_FragColor.a);\r\n#endif\r\n\r\n\r\n#ifdef TILE_BORDERS\r\n  dVuv \x3d fwidth(vuv);\r\n  edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                            wireframe.width * dVuv, min(vuv, 1.0 - vuv));\r\n  edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n  gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\r\n#endif\r\n\r\n#endif // defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n\r\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec3 origin;\r\nuniform vec4 texOffsetAndScale;\r\nuniform mat4 viewNormal;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\nvarying vec2 vtc;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nvarying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\nuniform vec3 lightDirection;\r\nvarying vec3 wpos;\r\nvarying vec3 wview;\r\nvarying vec3 wnormal;\r\nvarying vec3 wlight;\r\n#endif\r\n\r\n#ifdef OVERLAY\r\n// these variables combine two possible overlays into one by using a vec4:\r\n// components x/y are x/y of overlay 0, and components z/w are x/y of overlay 1\r\nuniform vec4 overlayTexOffset;\r\nuniform vec4 overlayTexScale;\r\nvarying vec4 vtcOverlay;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\nuniform vec4 screenSizePerspective;\r\n\r\nvarying float screenSizeDistanceToCamera;\r\nvarying float screenSizeCosAngle;\r\n\r\n#endif\r\n\r\nvoid main(void) {\r\n  vpos \x3d position;\r\n\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  vnormal \x3d normalize(vpos + origin);\r\n#else\r\n  vnormal \x3d vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\r\n#endif\r\n\r\nvec2 uv \x3d uv0;\r\nvpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\r\n\r\n#ifdef ATMOSPHERE\r\n  wpos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n  wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\r\n  wlight \x3d (view  * vec4(lightDirection, 1.0)).xyz;\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n  vuv \x3d uv;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n  vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n\r\n  screenSizeDistanceToCamera \x3d length(viewPos);\r\n\r\n  vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\r\n  screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\r\n\r\n#endif\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n  vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\r\n\r\n#ifdef OVERLAY\r\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n#endif\r\n}\r\n",
"depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n#ifndef BIAS_SHADOWMAP\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n}\r\n","depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec2 nearFar;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  vec3 normal \x3d normalize(position + origin);\r\n#else\r\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1.0);\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n#include \x3cterrainRenderer/overlay.glsl\x3e\r\n\r\nuniform sampler2D overlay0Tex;\r\nuniform sampler2D overlay1Tex;\r\nuniform float overlayOpacity;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvarying vec4 vtcOverlay;\r\n\r\nvoid main() {\r\n  vec4 overlayColor \x3d getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\r\n\r\n  if (overlayColor.a \x3d\x3d 0.0) {\r\n    // Here we have to write black, instead of discarding the fragment in order to overwrite\r\n    // the highlights which might have been written by skirts of other tiles.\r\n    // As a consequence skirts are not visible, but terrain overwrites draped highlights.\r\n    gl_FragColor \x3d vec4(0.0);\r\n    return;\r\n  }\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec4 overlayTexScale;\r\nuniform vec4 overlayTexOffset;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vpos;\r\nvarying vec4 vtcOverlay;\r\n\r\nvoid main() {\r\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n    vec3 vnormal \x3d normalize(position + origin);\r\n  #else\r\n    vec3 vnormal \x3d vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\r\n  #endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\r\n\r\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n",
"normalPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n}\r\n","normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 viewNormal;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  vec4 normal \x3d vec4(normalize(position + origin), 1.0);\r\n#else\r\n  vec4 normal \x3d vec4(0.0, 0.0, 1.0, 1.0);\r\n#endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n  vnormal \x3d normalize((viewNormal * normal).xyz);\r\n}\r\n",
"overlay.glsl":"vec4 getOverlayColor(sampler2D overlay0Tex, sampler2D overlay1Tex, vec4 texCoords, float opacity) {\r\n  vec4 color \x3d vec4(0.0);\r\n\r\n  // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\r\n  // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\r\n  // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\r\n  vec4 colorInner \x3d texture2D(overlay0Tex, texCoords.xy);\r\n  vec4 colorOuter \x3d texture2D(overlay1Tex, texCoords.zw);\r\n\r\n  if ((texCoords.x \x3e 0.0) \x26\x26 (texCoords.x \x3c 1.0) \x26\x26 (texCoords.y \x3e 0.0) \x26\x26 (texCoords.y \x3c 1.0)) {\r\n    // inner overlay texture coordinates are within bounds -\x3e sample from inner overlay\r\n    color \x3d colorInner;\r\n  } else if ((texCoords.z \x3e 0.0) \x26\x26 (texCoords.z \x3c 1.0) \x26\x26 (texCoords.w \x3e 0.0) \x26\x26 (texCoords.w \x3c 1.0)) {\r\n    // sample from outer overlay\r\n    color \x3d colorOuter;\r\n  }\r\n\r\n  return color * opacity;\r\n}\r\n",
"skirts.glsl":'vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\r\n  float skirtLength \x3d 0.0;\r\n\r\n  if (uv.x \x3e\x3d 2.0) {\r\n    skirtLength \x3d uv.y * skirtScale;\r\n    // decode original uv-coordinates (see "encodeSkirtPos")\r\n    vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\r\n    uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\r\n  }\r\n\r\n  return vpos - vnormal * skirtLength;\r\n}\r\n'},util:{"alignPixel.glsl":"vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\r\n  // From clip space to (0 : 1), bias towards right pixel edge\r\n  vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n  // Size of a pixel in range (0 : 1)\r\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n  // Round to nearest pixel center\r\n  vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\r\n\r\n  // Convert back to clip space\r\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n  return vec4(result, clipCoord.zw);\r\n}\r\n\r\nvec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\r\n  // From clip space to (0 : 1),\r\n  vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n  // Size of a pixel in range (0 : 1)\r\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n  // Round to nearest pixel border, (0 : 1)\r\n  vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\r\n\r\n  // Convert back to clip space\r\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n  return vec4(result, clipCoord.zw);\r\n}\r\n",
"color.glsl":"vec4 premultiplyAlpha(vec4 v) {\r\n  return vec4(v.rgb * v.a, v.a);\r\n}\r\n\r\nvec3 rgb2hsv(vec3 c) {\r\n  vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n  vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n  vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n  float d \x3d q.x - min(q.w, q.y);\r\n  float e \x3d 1.0e-10;\r\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n\r\nvec3 hsv2rgb(vec3 c) {\r\n  vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n  vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n",
"depth.glsl":"#include \x3cutil/encoding.glsl\x3e\r\n\r\n// read linear depth either from native depth texture or custom depth texture encoded in rgba\r\nfloat linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\r\n  return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\r\n}\r\n\r\nfloat calcFragDepth(const in float depth) {\r\n  // calc polygon offset\r\n  const float SLOPE_SCALE \x3d 2.0;\r\n  const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\r\n  float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\r\n  float result \x3d depth + SLOPE_SCALE * m + BIAS;\r\n  return clamp(result, .0, .999999);\r\n}\r\n",
"doublePrecision.glsl":"// based on https://www.thasler.com/blog/blog/glsl-part2-emu\r\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\r\n  vec3 t1 \x3d hiA + hiB;\r\n  vec3 e \x3d t1 - hiA;\r\n  vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\r\n  return t1 + t2;\r\n}\r\n","enableExtensions.glsl":"#define EXTENSIONS_ENABLED\r\n#extension GL_OES_standard_derivatives : enable\r\n#extension GL_EXT_shader_texture_lod : enable\r\n","encoding.glsl":"// This is the maximum float value representable as 32bit fixed point,\r\n// it is rgba2float(vec4(1)) inlined.\r\nconst float MAX_RGBA_FLOAT \x3d\r\n  255.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 / 256.0 / 256.0;\r\n\r\n// Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\r\nconst vec4 fixedPointFactors \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\r\n\r\nvec4 float2rgba(const float value) {\r\n  // Make sure value is in the domain we can represent\r\n  float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\r\n\r\n  // Decompose value in 32bit fixed point parts represented as\r\n  // uint8 rgba components. Decomposition uses the fractional part after multiplying\r\n  // by a power of 256 (this removes the bits that are represented in the previous\r\n  // component) and then converts the fractional part to 8bits.\r\n  vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\r\n\r\n  // Convert uint8 values (from 0 to 255) to floating point representation for\r\n  // the shader\r\n  const float toU8AsFloat \x3d 1.0 / 255.0;\r\n\r\n  return fixedPointU8 * toU8AsFloat;\r\n}\r\n\r\n// Factors to convert rgba back to float\r\nconst vec4 rgba2float_factors \x3d vec4(\r\n  255.0 / (256.0),\r\n  255.0 / (256.0 * 256.0),\r\n  255.0 / (256.0 * 256.0 * 256.0),\r\n  255.0 / (256.0 * 256.0 * 256.0 * 256.0)\r\n);\r\n\r\nfloat rgba2float(vec4 rgba) {\r\n  // Convert components from 0-\x3e1 back to 0-\x3e255 and then\r\n  // add the components together with their corresponding\r\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\r\n  return dot(rgba, rgba2float_factors);\r\n}\r\n",
"fsPrecision.glsl":"#ifdef GL_FRAGMENT_PRECISION_HIGH\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n#else\r\nprecision mediump float;\r\nprecision mediump sampler2D;\r\n#endif\r\n","highlight.glsl":"vec4 highlightData(vec4 fragCoord, sampler2D depthTex, vec4 viewportPixelSize) {\r\n  float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - viewportPixelSize.xy) * viewportPixelSize.zw).r;\r\n  if (fragCoord.z \x3e sceneDepth + 5e-7) {\r\n    return vec4(1.0, 1.0, 0.0, 1.0);\r\n  }\r\n  else {\r\n    return vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n}\r\n",
"hud.glsl":"#include \x3cutil/screenSizePerspective.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec4 auxpos1;\r\n\r\nuniform mat4 proj;\r\n\r\nuniform mat4 view;\r\nuniform mat4 viewNormal;\r\n\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n\r\nuniform vec4 viewport;\r\n\r\nuniform vec3 camPos;\r\n\r\nuniform float polygonOffset;\r\nuniform float cameraGroundRelative;\r\nuniform float pixelRatio;\r\n\r\nuniform float perDistancePixelRatio;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n// [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\r\nuniform vec4 verticalOffset;\r\n\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n// [ divisor, offset, minPixelSize, paddingPixels ]\r\nuniform vec4 screenSizePerspectiveAlignment;\r\n\r\n#endif\r\n\r\nuniform sampler2D hudVisibilityTexture;\r\n\r\n\r\n// Corresponds to cos(10 deg), used to compare against dot product of two vectors\r\nconst float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\r\n\r\nstruct ProjectHUDAux {\r\n  vec3 posModel;\r\n  vec3 posView;\r\n  vec3 vnormal;\r\n\r\n  float distanceToCamera;\r\n  float absCosAngle;\r\n};\r\n\r\n\r\n/**\r\n  * Apply the simulated polygon offset for HUD objects that improves\r\n  * issues with Z-fighting.\r\n  *\r\n  * @param posView {vec3} (inout) the position in view space. Will be modified in place.\r\n  * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\r\n  * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\r\n  *   and the view direction.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Attributes:\r\n  *     - auxpos1: contains centerOffset and pointGroundDistance\r\n  *\r\n  *   Uniforms:\r\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n  *         reduced flickering.\r\n  *     - viewport: the viewport [x, y, width, height]\r\n  */\r\nfloat applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\r\n  float pointGroundSign \x3d sign(pointGroundDistance);\r\n\r\n  if (pointGroundSign \x3d\x3d 0.0) {\r\n    pointGroundSign \x3d cameraGroundRelative;\r\n  }\r\n\r\n  // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\r\n  // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\r\n  float groundRelative \x3d cameraGroundRelative * pointGroundSign;\r\n\r\n  // view angle dependent part of polygon offset emulation\r\n  // we take the absolute value because the sign that is dropped is\r\n  // instead introduced using the ground-relative position of the symbol and the camera\r\n  if (polygonOffset \x3e .0) {\r\n    float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\r\n\r\n    float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\r\n    float factor \x3d (1.0 - tanAlpha / viewport[2]);\r\n\r\n    // same side of the terrain\r\n    if (groundRelative \x3e 0.0) {\r\n      posView *\x3d factor;\r\n    }\r\n    // opposite sides of the terrain\r\n    else {\r\n      posView /\x3d factor;\r\n    }\r\n  }\r\n\r\n  return groundRelative;\r\n}\r\n\r\n/**\r\n * Apply small vertical offset along world normal to reduce flickering. The offset\r\n * is distance based is approximately half of a pixel in the plane parallel to the\r\n * view at the HUD origin.\r\n *\r\n * @param normalModel {vec3} the normal in model/world space.\r\n * @param posModel {vec3} (inout) the position in model/world space. This value will\r\n *   be updated with the additional vertical offset.\r\n * @param posView {vec3} (inout) the position in view space. This value is used to\r\n *   determine the distance to the HUD origin and will also be updated with the\r\n *   additional vertical offset.\r\n *\r\n * Dependencies:\r\n *\r\n *   Uniforms:\r\n *     - perDistancePixelRatio: world units per distance per pixel.\r\n *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n *     - viewNormal: the view normal transformation.\r\n */\r\nvoid applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\r\n  float distanceToCamera \x3d length(posView);\r\n\r\n  // Compute offset in world units for a half pixel shift\r\n  float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\r\n\r\n  // Apply offset along normal in the direction away from the ground surface\r\n  vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\r\n\r\n  // Apply the same offset also on the view space position\r\n  vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\r\n\r\n  posModel +\x3d modelOffset;\r\n  posView +\x3d viewOffset;\r\n}\r\n\r\n/**\r\n  * Project the 3d position of a HUD object from world space to clip space. In addition\r\n  * to standard model view projection, it also emulates a polygon offset to\r\n  * help with points above/below ground and icon flickering. The resulting location\r\n  * is the anchor of the HUD object, i.e. the position that is used also for testing\r\n  * visibility of the HUD object. Note that the returned projected position is not\r\n  * aligned to a pixel center or border, it is up to the caller to align if necessary.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Attributes:\r\n  *     - position: contains the point world position\r\n  *     - normal: contains the world normal pointing up at the point\r\n  *     - auxpos1: contains centerOffset and pointGroundDistance\r\n  *\r\n  *   Uniforms:\r\n  *     - model: the object -\x3e world transformation matrix\r\n  *     - modelNormal: the object -\x3e world normal transformation matrix (inv transp of model)\r\n  *     - view: the world -\x3e view transformation matrix\r\n  *     - viewNormal: the world -\x3e view normal transformation matrix (inv transp of view)\r\n  *     - proj: the view -\x3e clip projection matrix\r\n  *     - verticalOffset: a vec4 containing:\r\n  *         - the screen height of the vertical offset\r\n  *         - the screen height of the vertical offset as a fraction of camera distance.\r\n  *         - the minimum world size vertical offset.\r\n  *         - the maximum world size vertical offset.\r\n  *       This will do a screen sized offset of the point along its normal (used for line callouts)\r\n  *     - screenSizePerspectiveAlignment: a vec3 containing\r\n  *         - the view distance dependent divisor\r\n  *         - the view distance dependent offset\r\n  *         - the minimum pixel size\r\n  *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\r\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n  *         reduced flickering.\r\n  *     - camPos: the position of the camera in world space\r\n  *     - viewport: the viewport [x, y, width, height]\r\n  */\r\nvec4 projectPositionHUD(out ProjectHUDAux aux) {\r\n  // centerOffset is in view space and is used to implement world size offsetting\r\n  // of labels with respect to objects. It also pulls the label towards the viewer\r\n  // so that the label is visible in front of the object.\r\n  vec3 centerOffset \x3d auxpos1.xyz;\r\n\r\n  // The pointGroundDistance is the distance of the geometry to the ground and is\r\n  // negative if the point is below the ground, or positive if the point is above\r\n  // ground.\r\n  float pointGroundDistance \x3d auxpos1.w;\r\n\r\n  aux.posModel \x3d (model * vec4(position, 1.0)).xyz;\r\n  aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\r\n  aux.vnormal \x3d (modelNormal * vec4(normal, 1.0)).xyz;\r\n\r\n  applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\r\n\r\n  // Screen sized offset in world space, used for example for line callouts\r\n  // Note: keep this implementation in sync with the CPU implementation, see\r\n  //   - MaterialUtil.verticalOffsetAtDistance\r\n  //   - HUDMaterial.applyVerticalOffsetTransformation\r\n\r\n  aux.distanceToCamera \x3d length(aux.posView);\r\n\r\n  vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\r\n  float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\r\n\r\n  aux.absCosAngle \x3d abs(cosAngle);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\r\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\r\n#endif\r\n\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\r\n#else\r\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\r\n  vec3 modelOffset \x3d aux.vnormal * worldOffset;\r\n\r\n  aux.posModel +\x3d modelOffset;\r\n\r\n  vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\r\n  aux.posView +\x3d viewOffset;\r\n\r\n  // Since we elevate the object, we need to take that into account\r\n  // in the distance to ground\r\n  pointGroundDistance +\x3d worldOffset;\r\n\r\n#endif\r\n\r\n  float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\r\n\r\n#ifndef CENTER_OFFSET_UNITS_SCREEN\r\n  // Apply x/y in view space, but z in screen space (i.e. along posView direction)\r\n  aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\r\n\r\n  // Same material all have same z !\x3d 0.0 condition so should not lead to\r\n  // branch fragmentation and will save a normalization if it's not needed\r\n  if (centerOffset.z !\x3d 0.0) {\r\n    aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\r\n  }\r\n#endif\r\n\r\n  vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\r\n\r\n#ifdef CENTER_OFFSET_UNITS_SCREEN\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\r\n#else\r\n  float centerOffsetY \x3d centerOffset.y;\r\n#endif\r\n\r\n  posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;\r\n\r\n#endif\r\n\r\n  // constant part of polygon offset emulation\r\n  posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\r\n\r\n  return posProj;\r\n}\r\n\r\nuniform float uRenderTransparentlyOccludedHUD;\r\n\r\n/**\r\n  * Test for visibility of a HUD object.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Uniforms:\r\n  *     - hudVisibilityTexture: the texture that contains the visibility information\r\n  *     - markerColor: the special marker color that is used to write visibility information\r\n  *     - viewport: the viewport\r\n  */\r\nbool testVisibilityHUD(vec4 posProj) {\r\n  // For occlusion testing, use the nearest pixel center to avoid\r\n  // subpixel filtering messing up the color we use to test for\r\n  vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n  vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\r\n\r\n  // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\r\n  // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\r\n  // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\r\n\r\n  // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\r\n  if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\r\n    // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\r\n    // uRenderTransparentlyOccludedHUD \x3d 0.75\r\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\r\n  }\r\n  // and visible pixels that are not occluded by semi-transparent geometry here\r\n  else {\r\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\r\n  }\r\n\r\n  // return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r \x3e 0.0;\r\n}\r\n",
"normalEncoding.glsl":"vec3 decodeNormal(vec2 f) {\r\n    float z \x3d 1.0 - abs(f.x) - abs(f.y);\r\n    return vec3(f + sign(f) * min(z, 0.0), z);\r\n}\r\n","quad.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position.x, position.y, .0, 1.0);\r\n  uv \x3d position * .5 + vec2(.5);\r\n}\r\n","sceneLighting.glsl":"// Scene Lighting Definitions:\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\n// defines:\r\n//   - SH_ORDER: 1|2|3\r\n// input:\r\n//   - normal: vec3\r\n//   - albedo: vec3\r\n//   - shadow: float\r\n//   - ssao: float\r\n// return:\r\n//   - color: vec3\r\n\r\n// main light\r\n/////////////////////////////////////////\r\nuniform vec3 lightingMainDirection;\r\nuniform vec3 lightingMainIntensity;\r\n\r\n// ambient lighting\r\n/////////////////////////////////////////\r\n#ifndef SH_ORDER\r\n  #define SH_ORDER 2\r\n#endif\r\n\r\n#if SH_ORDER \x3d\x3d 0\r\n  uniform vec3 lightingAmbientSH0;\r\n#elif SH_ORDER \x3d\x3d 1\r\n  uniform vec4 lightingAmbientSH_R;\r\n  uniform vec4 lightingAmbientSH_G;\r\n  uniform vec4 lightingAmbientSH_B;\r\n#elif SH_ORDER \x3d\x3d 2\r\n  uniform vec3 lightingAmbientSH0;\r\n  uniform vec4 lightingAmbientSH_R1;\r\n  uniform vec4 lightingAmbientSH_G1;\r\n  uniform vec4 lightingAmbientSH_B1;\r\n  uniform vec4 lightingAmbientSH_R2;\r\n  uniform vec4 lightingAmbientSH_G2;\r\n  uniform vec4 lightingAmbientSH_B2;\r\n#endif\r\n\r\n// special tweaking\r\n//////////////////////////////////////////\r\nuniform float lightingFixedFactor;\r\nuniform float lightingGlobalFactor;\r\n\r\nuniform float ambientBoostFactor;\r\n\r\n// evaluation\r\n//////////////////////////////////////////\r\n\r\nvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\r\n  // evaluate the main light\r\n  #if defined(TREE_RENDERING)\r\n    // Special case for tree rendering:\r\n    // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\r\n    // facing away from the light. The idea is to get an effect where light is transmitted\r\n    // through the tree.\r\n    float minDot \x3d -0.5;\r\n    float dotRange \x3d 1.0 - minDot;\r\n    float dotNormalization \x3d 0.66; // guessed \x26 hand tweaked value, for an exact value we could precompute an integral over the sphere\r\n\r\n    float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\r\n  #else\r\n    float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\r\n  #endif\r\n\r\n  // move lighting towards (1.0, 1.0, 1.0) if requested\r\n  dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\r\n\r\n  vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\r\n\r\n  // evaluate the sh ambient light\r\n  #if SH_ORDER \x3d\x3d 0\r\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n  #elif SH_ORDER \x3d\x3d 1\r\n    vec4 sh0 \x3d vec4(\r\n      0.282095,\r\n      0.488603 * normal.x,\r\n      0.488603 * normal.z,\r\n      0.488603 * normal.y\r\n    );\r\n    vec3 ambientLight \x3d vec3(\r\n      dot(lightingAmbientSH_R, sh0),\r\n      dot(lightingAmbientSH_G, sh0),\r\n      dot(lightingAmbientSH_B, sh0)\r\n    );\r\n  #elif SH_ORDER \x3d\x3d 2\r\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\r\n    vec4 sh1 \x3d vec4(\r\n      0.488603 * normal.x,\r\n      0.488603 * normal.z,\r\n      0.488603 * normal.y,\r\n      1.092548 * normal.x * normal.y\r\n    );\r\n    vec4 sh2 \x3d vec4(\r\n      1.092548 * normal.y * normal.z,\r\n      0.315392 * (3.0 * normal.z * normal.z - 1.0),\r\n      1.092548 * normal.x * normal.z,\r\n      0.546274 * (normal.x * normal.x - normal.y * normal.y)\r\n    );\r\n    ambientLight +\x3d vec3(\r\n      dot(lightingAmbientSH_R1, sh1),\r\n      dot(lightingAmbientSH_G1, sh1),\r\n      dot(lightingAmbientSH_B1, sh1)\r\n    );\r\n    ambientLight +\x3d vec3(\r\n      dot(lightingAmbientSH_R2, sh2),\r\n      dot(lightingAmbientSH_G2, sh2),\r\n      dot(lightingAmbientSH_B2, sh2)\r\n    );\r\n  #endif\r\n  ambientLight *\x3d (1.0 - ssao);\r\n\r\n  // inverse gamma correction on the albedo color\r\n  float gamma \x3d 2.1;\r\n  vec3 albedoGammaC \x3d pow(albedo, vec3(gamma));\r\n\r\n  // physically correct BRDF normalizes by PI\r\n  const float PI \x3d 3.14159;\r\n  vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\r\n  totalLight \x3d min(totalLight, vec3(PI, PI, PI));\r\n  vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\r\n\r\n  // apply gamma correction to the computed color\r\n  outColor \x3d pow(outColor, vec3(1.0/gamma));\r\n\r\n  return outColor;\r\n}\r\n\r\nvec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\r\n  // heuristic lighting model originally used in the terrain shading\r\n  // now used to generated additional ambient light\r\n\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n    float vndl \x3d -dot(normalize(worldPos), lightingMainDirection);\r\n#else\r\n    float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\r\n#endif\r\n\r\n  additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\r\n  return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n}\r\n",
"screenSizePerspective.glsl":"// Note that the implementation here should be kept in sync with the corresponding\r\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\r\n\r\n/**\r\n * Compute the screen size perspective lower bound from pre-computed screen\r\n * size perspective factors (or parameters, since both store the pixel lower\r\n * bound information in the same place). When computing the minimum size,\r\n * the padding (e.g. text halo) is scaled with the same factor as the\r\n * original size scales to reach the minimum size.\r\n *\r\n * {\r\n *    x: N/A\r\n *    y: N/A\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\r\n\r\n  // Original calculation:\r\n  //   padding \x3d 2 * factor.w\r\n  //   minSize \x3d factor.z\r\n  //\r\n  //   minSize + minSize / size * padding\r\n  //\r\n  // Incorporates padding (factor.w, e.g. text halo size) into the\r\n  // minimum bounds calculation, taking into account that padding\r\n  // would scale down proportionally to the size.\r\n  //\r\n  // Calculation below is the same, but avoids division by zero when\r\n  // size would be zero, without branching using step.\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\r\n\r\n  // nonZeroSize is 1 if size \x3e 0, and 0 otherwise\r\n  float nonZeroSize \x3d 1.0 - step(size, 0.0);\r\n\r\n  return (\r\n    factor.z * (\r\n      1.0 +\r\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\r\n                                   // proportionally scaled padding\r\n      2.0 * factor.w / (\r\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\n/**\r\n * Computes the view angle dependent screen size perspective factor. The goal\r\n * of this factor is that:\r\n *\r\n *   1. There is no perspective when looking top-down\r\n *   2. There is a smooth and quick transition to full perspective when\r\n *      tilting.\r\n */\r\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\r\n  return absCosAngle * absCosAngle * absCosAngle;\r\n}\r\n\r\n/**\r\n * Precomputes a set of factors that can be used to apply screen size perspective\r\n * The factors are based on the viewing angle, distance to camera and the screen size\r\n * perspective parameters:\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n *\r\n * The result is a set of factors that can be used to apply the perspective:\r\n *\r\n * {\r\n *    x: distance based relative scale factor (0 -\x3e 1)\r\n *    y: view dependent scale factor\r\n *    z: minPixelSize (abs)\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\r\n */\r\n\r\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\r\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\r\n */\r\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\r\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n",
"shadow.glsl":'#include \x3cutil/encoding.glsl\x3e\r\n\r\n// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\r\n// once IE11 is fine with it, const should probably be re-introduced\r\nfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\r\n  //choose correct cascade\r\n  int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\r\n\r\n  if (i \x3e\x3d num) { return .0; }\r\n\r\n  mat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\r\n\r\n  vec4 lv \x3d mat * vec4(vpos, 1.0);\r\n  lv.xy /\x3d lv.w;\r\n\r\n  //vertex completely outside? -\x3e no shadow\r\n  vec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\r\n  if (lvpos.z \x3e\x3d 1.0) { return .0; }\r\n  if (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) { return .0; }\r\n\r\n  //calc coord in cascade texture\r\n  vec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\r\n\r\n  float texSize \x3d .5 / halfPxSz;\r\n\r\n  //filter, offset by half pixels\r\n  vec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\r\n\r\n  float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\r\n  return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\r\n}\r\n',
"slice.glsl":"#ifdef SLICE\r\nuniform vec3 slicePlaneOrigin;\r\nuniform vec3 slicePlaneBasis1;\r\nuniform vec3 slicePlaneBasis2;\r\n\r\nstruct SliceFactors {\r\n  float front;\r\n  float side0;\r\n  float side1;\r\n  float side2;\r\n  float side3;\r\n};\r\n\r\nSliceFactors calculateSliceFactors(vec3 pos) {\r\n  vec3 rel \x3d pos - slicePlaneOrigin;\r\n\r\n  vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\r\n  float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\r\n\r\n  float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\r\n  float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\r\n\r\n  float basis1Dot \x3d dot(slicePlaneBasis1, rel);\r\n  float basis2Dot \x3d dot(slicePlaneBasis2, rel);\r\n\r\n  return SliceFactors(\r\n    dot(slicePlaneNormal, pos) + slicePlaneW,\r\n    -basis1Dot - basis1Len2,\r\n    basis1Dot - basis1Len2,\r\n    -basis2Dot - basis2Len2,\r\n    basis2Dot - basis2Len2\r\n  );\r\n}\r\n\r\nbool sliceByFactors(SliceFactors factors) {\r\n  return factors.front \x3c 0.0\r\n    \x26\x26 factors.side0 \x3c 0.0\r\n    \x26\x26 factors.side1 \x3c 0.0\r\n    \x26\x26 factors.side2 \x3c 0.0\r\n    \x26\x26 factors.side3 \x3c 0.0;\r\n}\r\n\r\nbool sliceByPlane(vec3 pos) {\r\n  return sliceByFactors(calculateSliceFactors(pos));\r\n}\r\n\r\n#ifdef EXTENSIONS_ENABLED\r\n\r\nvec4 applySliceHighlight(vec4 color, vec3 pos) {\r\n  SliceFactors factors \x3d calculateSliceFactors(pos);\r\n\r\n  if (sliceByFactors(factors)) {\r\n    return color;\r\n  }\r\n\r\n  const float HIGHLIGHT_WIDTH \x3d 1.0;\r\n  const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\r\n\r\n  factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\r\n  factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\r\n  factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\r\n  factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\r\n  factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\r\n\r\n  float highlightFactor \x3d (1.0 - step(0.5, factors.front))\r\n    * (1.0 - step(0.5, factors.side0))\r\n    * (1.0 - step(0.5, factors.side1))\r\n    * (1.0 - step(0.5, factors.side2))\r\n    * (1.0 - step(0.5, factors.side3));\r\n\r\n  return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\r\n}\r\n\r\n#else // EXTENSIONS_ENABLED\r\n\r\n// GL_OES_standard_derivatives must be enabled for applySliceHighlight\r\n\r\n#endif // EXTENSIONS_ENABLED\r\n\r\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\r\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\r\n#define highlightSlice(_color_, _pos_) applySliceHighlight(_color_, _pos_)\r\n\r\n#else // SLICE\r\n\r\n#define rejectBySlice(_pos_) false\r\n#define discardBySlice(_pos_) {}\r\n#define highlightSlice(_color_, _pos_) (_color_)\r\n\r\n#endif // SLICE\r\n",
"visualVariables.glsl":"#if defined(VV_SIZE)\r\n  #define VV_CUSTOM_MODEL_MATRIX\r\n#endif\r\n\r\n#if defined(VV_SIZE)\r\n  uniform vec3 vvSizeMinSize;\r\n  uniform vec3 vvSizeMaxSize;\r\n  uniform vec3 vvSizeOffset;\r\n  uniform vec3 vvSizeFactor;\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  uniform vec3 vvSizeValue;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform mat3 vvSymbolRotationMatrix;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform vec3 vvSymbolAnchor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  #define VV_COLOR_N 8\r\n  uniform float vvColorValues[VV_COLOR_N];\r\n  uniform vec4 vvColorColors[VV_COLOR_N];\r\n#endif\r\n\r\n// Evaluation of size\r\n#if defined(VV_SIZE)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\r\n  }\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return vvSizeValue;\r\n  }\r\n#endif\r\n\r\n// Applying the model matrix\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\r\n    return vec4(vvSymbolRotationMatrix * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\r\n  }\r\n\r\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\r\n    // Normal transform is the inverse transpose of model transform\r\n    return vec4(vvSymbolRotationMatrix * normal / vvGetScale(featureAttribute), 1.0);\r\n  }\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n    float value \x3d featureAttribute.y;\r\n    if (value \x3c\x3d values[0]) {\r\n      return colors[0];\r\n    }\r\n\r\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n      if (values[i] \x3e\x3d value) {\r\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n        return mix(colors[i-1], colors[i], f);\r\n      }\r\n    }\r\n\r\n    return colors[VV_COLOR_N - 1];\r\n  }\r\n#endif\r\n",
"vsPrecision.glsl":"precision highp float;\r\nprecision highp sampler2D;\r\n"}}})},"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(t,d){return function(){function d(g){this.readFile=g}d.prototype.resolveIncludes=function(g){return this.resolve(g)};d.prototype.resolve=function(g,d){var b=this;void 0===d&&(d=new Map);if(d.has(g))return d.get(g);var f=this.read(g);if(!f)throw Error("cannot find shader file "+g);for(var e=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm,k=e.exec(f),
c=[];null!=k;)c.push({path:k[1],start:k.index,length:k[0].length}),k=e.exec(f);var a=0,h="";c.forEach(function(c){h+=f.slice(a,c.start);h+=d.has(c.path)?"":b.resolve(c.path,d);a=c.start+c.length});h+=f.slice(a);d.set(g,h);return h};d.prototype.read=function(g){return this.readFile(g)};return d}()})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(t,d,q){function g(g,b,f,e){f=f||{};e=e||"";f="function"===typeof b.shaders?b.shaders(f):b.shaders;return new q(g,
e+f.vertexShader,e+f.fragmentShader,b.attributes)}Object.defineProperty(d,"__esModule",{value:!0});d.glslifyDefineMap=function(g){var b="",f;for(f in g){var e=g[f];if("boolean"===typeof e)e&&(b+="#define "+f+"\n");else if("number"===typeof e)b+="#define "+f+" "+e.toFixed()+"\n";else if("object"===typeof e){var k=e.options,c=0,a;for(a in k)b+="#define "+k[a]+" "+(c++).toFixed()+"\n";b+="#define "+f+" "+k[e.value]+"\n"}}return b};t=function(){function d(b){this._programCacheByTemplate=new Map;this._rctx=
b}d.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(b){b.programs.forEach(function(b){b.dispose()})});this._programCacheByTemplate=null};d.prototype.getProgram=function(b,f){var e=this;this._programCacheByTemplate.has(b)||this.addProgramTemplate(b,function(f){return g(e._rctx,b,f)});return this.getProgramTemplateInstance(b,f)};d.prototype.addProgramTemplate=function(b,f){this._programCacheByTemplate.set(b,{constructor:f,programs:new Map})};d.prototype.getProgramTemplateInstance=
function(b,f){if(b=this._programCacheByTemplate.get(b)){var e=f?JSON.stringify(f):"default";b.programs.has(e)||(f=b.constructor(f),b.programs.set(e,f));return b.programs.get(e)}return null};return d}();d.ProgramCache=t;d.createProgram=g})},"esri/views/webgl/Program":function(){define(["require","exports","../../core/has","./ShaderTranspiler"],function(t,d,q,g){return function(){function d(b,f,e,g,c){void 0===c&&(c={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=
!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};b||console.error("RenderingContext isn't initialized!");0===f.length&&console.error("Shaders source should not be empty!");this._context=b;this._vertexShaderSource=f;this._fragmentShaderSource=e;if(Array.isArray(c))for(b=
0;b<c.length;b++)this._defines[c[b]]="1";else this._defines=c;this._id=d._nextId++;this._locations=g}Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});d.prototype.getDefine=function(b){return this._defines[b]};d.prototype.dispose=
function(){if(this._context){var b=this._context.gl;this._vShader&&(b.deleteShader(this._vShader),this._vShader=null);this._fShader&&(b.deleteShader(this._fShader),this._fShader=null);this._glName&&(b.deleteProgram(this._glName),this._glName=null);this._context=null}};d.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var b=this._context.gl,f=b.createProgram();
b.attachShader(f,this._vShader);b.attachShader(f,this._fShader);for(var e in this._locations)b.bindAttribLocation(f,this._locations[e],e);b.linkProgram(f);b.getProgramParameter(f,b.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+b.getProgramParameter(f,b.VALIDATE_STATUS)+", gl error ["+b.getError()+"]infoLog: "+b.getProgramInfoLog(f));this._glName=f;this._initialized=!0}};d.prototype.getUniformLocation=function(b){this.initialize();void 0===this._nameToUniformLocation[b]&&
(this._nameToUniformLocation[b]=this._context.gl.getUniformLocation(this._glName,b));return this._nameToUniformLocation[b]};d.prototype.hasUniform=function(b){return null!==this.getUniformLocation(b)};d.prototype.getAttribLocation=function(b){this.initialize();void 0===this._nameToAttribLocation[b]&&(this._nameToAttribLocation[b]=this._context.gl.getAttribLocation(this._glName,b));return this._nameToAttribLocation[b]};d.prototype.setUniform1i=function(b,f){var e=this._nameToUniform1[b];if(void 0===
e||f!==e)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(b),f),this._nameToUniform1[b]=f};d.prototype.setUniform1iv=function(b,f){var e=this._nameToUniform1v[b];void 0!==e&&d._arraysEqual(f,e)||(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(b),f),void 0===e?this._nameToUniform1v[b]=d._arrayCopy(f):d._arrayAssign(f,e))};d.prototype.setUniform1f=function(b,f){var e=this._nameToUniform1[b];if(void 0===e||f!==e)this._context.bindProgram(this),
this._context.gl.uniform1f(this.getUniformLocation(b),f),this._nameToUniform1[b]=f};d.prototype.setUniform1fv=function(b,f){var e=this._nameToUniform1v[b];void 0!==e&&d._arraysEqual(f,e)||(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(b),f),void 0===e?this._nameToUniform1v[b]=d._arrayCopy(f):d._arrayAssign(f,e))};d.prototype.setUniform2f=function(b,f,e){var g=this._nameToUniform2[b];if(void 0===g||f!==g[0]||e!==g[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(b),
f,e),void 0===g?this._nameToUniform2[b]=[f,e]:(g[0]=f,g[1]=e)};d.prototype.setUniform2fv=function(b,f){var e=this._nameToUniform2[b];void 0!==e&&d._arraysEqual(f,e)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(b),f),void 0===e?this._nameToUniform2[b]=d._arrayCopy(f):d._arrayAssign(f,e))};d.prototype.setUniform3f=function(b,f,e,g){var c=this._nameToUniform3[b];if(void 0===c||f!==c[0]||e!==c[1]||g!==c[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(b),
f,e,g),void 0===c?this._nameToUniform3[b]=[f,e,g]:(c[0]=f,c[1]=e,c[2]=g)};d.prototype.setUniform3fv=function(b,f){var e=this._nameToUniform3[b];void 0!==e&&d._arraysEqual(f,e)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(b),f),void 0===e?this._nameToUniform3[b]=d._arrayCopy(f):d._arrayAssign(f,e))};d.prototype.setUniform4f=function(b,f,e,g,c){var a=this._nameToUniform4[b];if(void 0===a||f!==a[0]||e!==a[1]||g!==a[2]||c!==a[3])this._context.bindProgram(this),
this._context.gl.uniform4f(this.getUniformLocation(b),f,e,g,c),void 0===a?this._nameToUniform4[b]=[f,e,g,c]:(a[0]=f,a[1]=e,a[2]=g,a[3]=c)};d.prototype.setUniform4fv=function(b,f){var e=this._nameToUniform4[b];void 0!==e&&d._arraysEqual(f,e)||(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(b),f),void 0===e?this._nameToUniform4[b]=d._arrayCopy(f):d._arrayAssign(f,e))};d.prototype.setUniformMatrix3fv=function(b,f,e){void 0===e&&(e=!1);var g=this._nameToUniformMatrix3[b];
void 0!==g&&(9===g.length?d._matrix3Equal(g,f):d._arraysEqual(f,g))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(b),e,f),void 0===g?this._nameToUniformMatrix3[b]=d._arrayCopy(f):d._arrayAssign(f,g))};d.prototype.setUniformMatrix4fv=function(b,f,e){void 0===e&&(e=!1);var g=this._nameToUniformMatrix4[b];void 0!==g&&(16===g.length?d._matrix4Equal(g,f):d._arraysEqual(f,g))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(b),
e,f),void 0===g?this._nameToUniformMatrix4[b]=d._arrayCopy(f):d._arrayAssign(f,g))};d._padToThree=function(b){var f=b.toString();1E3>b&&(f=("  "+b).slice(-3));return f};d.prototype._addLineNumbers=function(b){var f=2;return b.replace(/\n/g,function(){return"\n"+d._padToThree(f++)+":"})};d.prototype._loadShader=function(b){var f=35633===b,e=f?this._vertexShaderSource:this._fragmentShaderSource,k;k="";for(var c in this._defines)k+="#define "+c+" "+this._defines[c]+"\n";k+=e;"webgl2"===this._context.contextVersion&&
(k=g.transpileShader(k,f?"vertex":"fragment"));f=this._context.gl;b=f.createShader(b);f.shaderSource(b,k);f.compileShader(b);f.getShaderParameter(b,f.COMPILE_STATUS)||(console.error(f.getShaderInfoLog(b)),console.error(this._addLineNumbers(k)),"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),console.log(e)));return b};d._matrix4Equal=function(b,f){return b[0]===f[0]&&b[1]===f[1]&&b[2]===f[2]&&b[3]===f[3]&&b[4]===f[4]&&b[5]===f[5]&&b[6]===f[6]&&b[7]===f[7]&&
b[8]===f[8]&&b[9]===f[9]&&b[10]===f[10]&&b[11]===f[11]&&b[12]===f[12]&&b[13]===f[13]&&b[14]===f[14]&&b[15]===f[15]};d._matrix3Equal=function(b,f){return b[0]===f[0]&&b[1]===f[1]&&b[2]===f[2]&&b[3]===f[3]&&b[4]===f[4]&&b[5]===f[5]&&b[6]===f[6]&&b[7]===f[7]&&b[8]===f[8]};d._arraysEqual=function(b,f){if(b.length!==f.length)return!1;for(var e=0;e<b.length;++e)if(b[e]!==f[e])return!1;return!0};d._arrayCopy=function(b){for(var f=[],e=0;e<b.length;++e)f.push(b[e]);return f};d._arrayAssign=function(b,f){for(var e=
0;e<b.length;++e)f[e]=b[e]};d._nextId=0;return d}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(t,d,q,g){function l(b){return b.map(function(c){return"eof"!==c.type?c.data:""}).join("")}function b(e,c,a,f){f=f||a;for(var h=0;h<e.length;h++){var g=e[h];if("ident"===g.type&&g.data===a)return f in c?c[f]++:c[f]=0,b(e,c,f+"_"+c[f],f)}return a}function f(b,c,a){void 0===a&&(a="afterVersion");var e={data:"\n",
type:"whitespace"},f=function(a){return a<b.length?/[^\r\n]$/.test(b[a].data):!1},g=function(c){for(var b=-1,e=0,f=-1,h=0;h<c.length;h++){var g=c[h];"preprocessor"===g.type&&(g.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++e:g.data.match(/\#endif\s*.*/)&&--e);("afterVersion"===a||"afterPrecision"===a)&&"preprocessor"===g.type&&/^#version/.test(g.data)&&(f=Math.max(f,h));if("afterPrecision"===a&&"keyword"===g.type&&"precision"===g.data){a:{for(g=h;g<c.length;g++){var k=c[g];if("operator"===k.type&&";"===
k.data)break a}g=null}if(null===g)throw Error("precision statement not followed by any semicolons!");f=Math.max(f,g)}b<f&&0===e&&(b=h)}return b+1}(b);f(g-1)&&b.splice(g++,0,e);for(var k=0;k<c.length;k++){var d=c[k];b.splice(g++,0,d)}f(g-1)&&f(g)&&b.splice(g,0,e)}Object.defineProperty(d,"__esModule",{value:!0});var e=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];d.transpileShader=function(k,c){k=g(k);var a;a:{a="100";var h="300 es";void 0===a&&
(a="100");void 0===h&&(h="300 es");for(var d=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,n=0;n<k.length;n++){var u=k[n];if("preprocessor"===u.type){var v=d.exec(u.data);if(v){d=v[1].replace(/\s\s+/g," ");if(d===h){a=d;break a}if(d===a){u.data="#version "+h;break a}throw Error("unknown glsl version: "+d);}}}k.splice(0,0,{type:"preprocessor",data:"#version "+h},{type:"whitespace",data:"\n"});a=null}if("300 es"===a)throw Error("shader is already glsl 300 es");d=u=null;n={};v={};for(a=0;a<k.length;++a)switch(h=
k[a],h.type){case "keyword":"vertex"===c&&"attribute"===h.data?h.data="in":"varying"===h.data&&(h.data="vertex"===c?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(h.data.trim())&&(h.data=h.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===c&&"gl_FragColor"===h.data){if(!u){var u=b(k,n,"fragColor"),r=void 0;void 0===r&&(r="lowp");f(k,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},
{type:"whitespace",data:" "},{type:"ident",data:u},{type:"operator",data:";"}],"afterPrecision")}h.data=u}else"fragment"===c&&"gl_FragDepthEXT"===h.data&&(d||(d=b(k,n,"gl_FragDepth")),h.data=d);break;case "ident":if(0<=q.indexOf(h.data)){if(r="vertex"===c)a:{for(r=a-1;0<=r;r--){var y=k[r];if("whitespace"!==y.type&&"block-comment"!==y.type)if("keyword"===y.type){if("attribute"===y.data||"in"===y.data){r=!0;break a}}else break}r=!1}if(r)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");
h.data in v||(v[h.data]=b(k,n,h.data));h.data=v[h.data]}}for(a=k.length-1;0<=a;--a)h=k[a],"preprocessor"===h.type&&((c=h.data.match(/\#extension\s+(.*)\:/))&&c[1]&&0<=e.indexOf(c[1].trim())&&(c=k[a+1],k.splice(a,c&&"whitespace"===c.type?2:1)),(c=h.data.match(/\#ifdef\s+(.*)/))&&c[1]&&0<=e.indexOf(c[1].trim())&&(h.data="#if 1"),(c=h.data.match(/\#ifndef\s+(.*)/))&&c[1]&&0<=e.indexOf(c[1].trim())&&(h.data="#if 0"));return l(k)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],
function(t,d){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(t){"use strict;";return function(d){var q=t(),g=[],g=g.concat(q(d));return g=g.concat(q(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(t,d,q){"use strict;";var g="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function l(a){a.length&&y.push({type:g[n],
data:a,position:x,line:w,column:m})}function b(){r=r.length?[]:r;if("/"===v&&"*"===u)return x=p+h-1,n=0,v=u,h+1;if("/"===v&&"/"===u)return x=p+h-1,n=1,v=u,h+1;if("#"===u)return n=2,x=p+h,h;if(/\s/.test(u))return n=9,x=p+h,h;A=/\d/.test(u);C=/[^\w_]/.test(u);x=p+h;n=A?4:C?3:9999;return h}function f(){if(("\r"===u||"\n"===u)&&"\\"!==v)return l(r.join("")),n=999,h;r.push(u);v=u;return h+1}function e(){if("."===v&&/\d/.test(u))return n=5,h;if("/"===v&&"*"===u)return n=0,h;if("/"===v&&"/"===u)return n=
1,h;if("."===u&&r.length){for(;k(r););n=5;return h}if(";"===u||")"===u||"("===u){if(r.length)for(;k(r););l(u);n=999;return h+1}var a=2===r.length&&"\x3d"!==u;if(/[\w_\d\s]/.test(u)||a){for(;k(r););n=999;return h}r.push(u);v=u;return h+1}function k(a){var c=0,b,e;do{b=d.indexOf(a.slice(0,a.length+c).join(""));e=d[b];if(-1===b){if(0<c--+a.length)continue;e=a.slice(0,1).join("")}l(e);x+=e.length;r=r.slice(e.length);return r.length}while(1)}function c(){if("."===u||/[eE]/.test(u))return r.push(u),n=5,
v=u,h+1;if("x"===u&&1===r.length&&"0"===r[0])return n=11,r.push(u),v=u,h+1;if(/[^\d]/.test(u))return l(r.join("")),n=999,h;r.push(u);v=u;return h+1}function a(){"f"===u&&(r.push(u),v=u,h+=1);if(/[eE]/.test(u)||"-"===u&&/[eE]/.test(v))return r.push(u),v=u,h+1;if(/[^\d]/.test(u))return l(r.join("")),n=999,h;r.push(u);v=u;return h+1}var h=0,p=0,n=999,u,v,r=[],y=[],w=1,m=0,x=0,A=!1,C=!1,B="",E;return function(g){y=[];if(null!==g){g=g.replace?g.replace(/\r\n/g,"\n"):g;h=0;B+=g;for(E=B.length;u=B[h],h<
E;){g=h;switch(n){case 0:"/"===u&&"*"===v?(r.push(u),l(r.join("")),n=999):(r.push(u),v=u);h+=1;break;case 1:h=f();break;case 2:h=f();break;case 3:h=e();break;case 4:h=c();break;case 11:/[^a-fA-F0-9]/.test(u)?(l(r.join("")),n=999):(r.push(u),v=u,h+=1);break;case 5:h=a();break;case 9999:if(/[^\d\w_]/.test(u)){var k=r.join("");n=-1<t.indexOf(k)?8:-1<q.indexOf(k)?7:6;l(r.join(""));n=999}else r.push(u),v=u,h+=1;break;case 9:/[^\s]/g.test(u)?(l(r.join("")),n=999):(r.push(u),v=u,h+=1);break;case 999:h=b()}if(g!==
h)switch(B[g]){case "\n":m=0;++w;break;default:++m}}p+=h;B=B.slice(h);return y}r.length&&l(r.join(""));n=10;l("(eof)");return y}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../../core/typedArrayUtil"],function(t,d,q,g){return function(){function d(b,f,e,g,c){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=b;this._bufferType=f;this._usage=e;this._id=d._nextId++;this._glName=this._context.gl.createBuffer();g&&this.setData(g,c)}d.createIndex=function(b,f,e,g){return new d(b,34963,f,e,g)};d.createVertex=function(b,
f,e){return new d(b,34962,f,e)};Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"bufferType",
{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});d.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),
this._context=null)};d.prototype.setData=function(b,f){if(b){if("number"===typeof b){if(0>b&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&f)switch(this._indexType=f,this._size=b,f){case 5123:b*=2;break;case 5125:b*=4}}else f=b.byteLength,g.isUint16Array(b)&&(f/=2,this._indexType=5123),g.isUint32Array(b)&&(f/=4,this._indexType=5125),this._size=f;f=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,
b,this._usage);this._context.bindVAO(f)}};d.prototype.setSubData=function(b,f,e,k){void 0===f&&(f=0);void 0===e&&(e=0);if(b){(0>f||f>=this._size)&&console.error("offset is out of range!");var c=f,a=e,h=k,d=b.byteLength;g.isUint16Array(b)&&(d/=2,c*=2,a*=2,h*=2);g.isUint32Array(b)&&(d/=4,c*=4,a*=4,h*=4);void 0===k&&(k=d-1);e>=k&&console.error("end must be bigger than start!");f+e-k>this._size&&console.error("An attempt to write beyond the end of the buffer!");f=this._context.getBoundVAO();this._context.bindVAO(null);
this._context.bindBuffer(this);e=this._context.gl;b=ArrayBuffer.isView(b)?b.buffer:b;e.bufferSubData(this._bufferType,c,b.slice(a,h));this._context.bindVAO(f)}};d._nextId=0;return d}()})},"esri/views/webgl/renderState":function(){define(["require","exports","../../core/tsSupport/assignHelper"],function(t,d,q){function g(a){return x.intern(a)}function l(a){return A.intern(a)}function b(a){return C.intern(a)}function f(a){return B.intern(a)}function e(a){return E.intern(a)}function k(a){return I.intern(a)}
function c(a){return G.intern(a)}function a(a){return L.intern(a)}function h(a){return"["+a.join(",")+"]"}function p(a){return a?h([a.srcRgb,a.srcAlpha,a.dstRgb,a.dstAlpha,a.opRgb,a.opAlpha,a.color.r,a.color.g,a.color.b,a.color.a]):null}function n(a){return a?h([a.face,a.mode]):null}function u(a){return a?h([a.factor,a.units]):null}function v(a){return a?h([a.func]):null}function r(a){return a?h([a.function.func,a.function.ref,a.function.mask,a.operation.fail,a.operation.zFail,a.operation.zPass]):
null}function y(a){return a?h([a.zNear,a.zFar]):null}function w(a){return a?h([a.r,a.g,a.b,a.a]):null}function m(a){return a?h([a.mask]):null}Object.defineProperty(d,"__esModule",{value:!0});d.simpleBlendingParams=function(a,c,b,e){void 0===b&&(b=32774);void 0===e&&(e=[0,0,0,0]);return{srcRgb:a,srcAlpha:a,dstRgb:c,dstAlpha:c,opRgb:b,opAlpha:b,color:{r:e[0],g:e[1],b:e[2],a:e[3]}}};d.separateBlendingParams=function(a,c,b,e,f,h,g){void 0===f&&(f=32774);void 0===h&&(h=32774);void 0===g&&(g=[0,0,0,0]);
return{srcRgb:a,srcAlpha:c,dstRgb:b,dstAlpha:e,opRgb:f,opAlpha:h,color:{r:g[0],g:g[1],b:g[2],a:g[3]}}};d.backFaceCullingParams={face:1029,mode:2305};d.defaultDepthWriteParams={zNear:0,zFar:1};d.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};d.makeBlending=g;d.makeCulling=l;d.makePolygonOffset=b;d.makeDepthTest=f;d.makeStencilTest=e;d.makeDepthWrite=k;d.makeColorWrite=c;d.makeStencilWrite=a;d.makePipelineState=function(a){return F.intern(a)};t=function(){function a(a,c){this.makeKey=a;this.makeRef=
c;this.interns=new Map}a.prototype.intern=function(a){if(!a)return null;var c=this.makeKey(a),b=this.interns;b.has(c)||b.set(c,this.makeRef(a));return b.get(c)};return a}();var x=new t(p,function(a){return q({__tag:"Blending"},a)}),A=new t(n,function(a){return q({__tag:"Culling"},a)}),C=new t(u,function(a){return q({__tag:"PolygonOffset"},a)}),B=new t(v,function(a){return q({__tag:"DepthTest"},a)}),E=new t(r,function(a){return q({__tag:"StencilTest"},a)}),I=new t(y,function(a){return q({__tag:"DepthWrite"},
a)}),G=new t(w,function(a){return q({__tag:"ColorWrite"},a)}),L=new t(m,function(a){return q({__tag:"StencilWrite"},a)}),F=new t(function(a){return a?h([p(a.blending),n(a.culling),u(a.polygonOffset),v(a.depthTest),r(a.stencilTest),y(a.depthWrite),w(a.colorWrite),m(a.stencilWrite)]):null},function(h){return{blending:g(h.blending),culling:l(h.culling),polygonOffset:b(h.polygonOffset),depthTest:f(h.depthTest),stencilTest:e(h.stencilTest),depthWrite:k(h.depthWrite),colorWrite:c(h.colorWrite),stencilWrite:a(h.stencilWrite)}});
t=function(){function a(a){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=a}a.prototype.setPipeline=function(a){if(this._pipelineInvalid||a!==this._pipeline)this.setBlending(a.blending),this.setCulling(a.culling),this.setPolygonOffset(a.polygonOffset),this.setDepthTest(a.depthTest),this.setStencilTest(a.stencilTest),
this.setDepthWrite(a.depthWrite),this.setColorWrite(a.colorWrite),this.setStencilWrite(a.stencilWrite),this._pipeline=a;this._pipelineInvalid=!1};a.prototype.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};a.prototype.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};a.prototype.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};a.prototype.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=
!0};a.prototype.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};a.prototype.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};a.prototype.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.setBlending=function(a){this._blending=this.setSubState(a,this._blending,this._blendingInvalid,this._stateSetters.setBlending);
this._blendingInvalid=!1};a.prototype.setCulling=function(a){this._culling=this.setSubState(a,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};a.prototype.setPolygonOffset=function(a){this._polygonOffset=this.setSubState(a,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};a.prototype.setDepthTest=function(a){this._depthTest=this.setSubState(a,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);
this._depthTestInvalid=!1};a.prototype.setStencilTest=function(a){this._stencilTest=this.setSubState(a,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};a.prototype.setDepthWrite=function(a){this._depthWrite=this.setSubState(a,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};a.prototype.setColorWrite=function(a){this._colorWrite=this.setSubState(a,this._colorWrite,this._colorWriteInvalid,
this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};a.prototype.setStencilWrite=function(a){this._stencilWrite=this.setSubState(a,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};a.prototype.setSubState=function(a,c,b,e){if(b||a!==c)e(a),this._pipelineInvalid=!0;return a};return a}();d.StateTracker=t})},"esri/views/webgl/Texture":function(){define(["require","exports","../../core/has"],function(t,d,q){return function(){function g(d,
b,f){this._glName=this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=d;this._desc={pixelFormat:b.pixelFormat,internalFormat:b.internalFormat,dataType:b.dataType,target:b.target?b.target:3553,samplingMode:b.samplingMode?b.samplingMode:9729,wrapMode:b.wrapMode?b.wrapMode:10497,maxAnisotropy:b.maxAnisotropy,flipped:void 0!==b.flipped?b.flipped:!1,hasMipmap:void 0!==b.hasMipmap?b.hasMipmap:!1,unpackAlignment:b.unpackAlignment?
b.unpackAlignment:4,width:b.width,height:b.height,preMultiplyAlpha:void 0!==b.preMultiplyAlpha?b.preMultiplyAlpha:!1,textureCoordinateScaleFactor:b.textureCoordinateScaleFactor||null};this._id=++g._nextId;this.setData(f)}Object.defineProperty(g.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"descriptor",{get:function(){return this._desc},
enumerable:!0,configurable:!0});g.prototype.dispose=function(){var g=this;if(this._context){if(this._glName){var b=this._context.gl;this._boundToUnits.forEach(function(b){g._context.bindTexture(null,b)});b.deleteTexture(this._glName);this._glName=null}this._context=null}};g.prototype.resize=function(g,b){var f=this._desc;if(f.width!==g||f.height!==b)f.width=g,f.height=b,this.setData(null)};g.prototype.setData=function(d){var b=this._context.gl;this._glName||(this._glName=b.createTexture());void 0===
d&&(d=null);null===d&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var f=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var e=this._desc;g._validateTexture(e);b.pixelStorei(b.UNPACK_ALIGNMENT,e.unpackAlignment);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,e.flipped?1:0);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.preMultiplyAlpha?1:0);var k=e.pixelFormat,c=e.internalFormat?e.internalFormat:k;if(d instanceof ImageData||d instanceof HTMLImageElement||
d instanceof HTMLCanvasElement||d instanceof HTMLVideoElement)e.width&&e.height&&console.assert(d.width===e.width&&d.height===e.height),b.texImage2D(b.TEXTURE_2D,0,c,k,e.dataType,d),e.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=d.width),void 0===this._desc.height&&(this._desc.height=d.height);else{null!=e.width&&null!=e.height||console.error("Width and height must be specified!");b.DEPTH24_STENCIL8&&c===b.DEPTH_STENCIL&&(c=b.DEPTH24_STENCIL8);var a=e.width,h=e.height;
if(null!=d&&"type"in d&&"compressed"===d.type){k=Math.round(Math.log(Math.max(a,h))/Math.LN2)+1;e.hasMipmap=e.hasMipmap&&k===d.levels.length;for(var p=0;;++p){b.compressedTexImage2D(b.TEXTURE_2D,p,c,a,h,0,d.levels[Math.min(p,d.levels.length-1)]);if(1===a&&1===h||!e.hasMipmap)break;a=Math.max(1,a>>1);h=Math.max(1,h>>1)}}else if(d)b.texImage2D(b.TEXTURE_2D,0,c,a,h,0,k,e.dataType,d),e.hasMipmap&&this.generateMipmap();else for(p=0;;++p){b.texImage2D(b.TEXTURE_2D,p,c,a,h,0,k,e.dataType,null);if(1===a&&
1===h||!e.hasMipmap)break;a=Math.max(1,a>>1);h=Math.max(1,h>>1)}}g._applySamplingMode(b,this._desc);g._applyWrapMode(b,this._desc);g._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(f,0)};g.prototype.updateData=function(g,b,f,e,k,c){c||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var a=this._context.gl,h=this._desc,d=this._context.getBoundTexture(0);this._context.bindTexture(this,
0);(0>b||0>f||e>h.width||k>h.height||b+e>h.width||f+k>h.height)&&console.error("An attempt to update out of bounds of the texture!");c instanceof ImageData||c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement?(console.assert(c.width===e&&c.height===k),a.texSubImage2D(a.TEXTURE_2D,g,b,f,h.pixelFormat,h.dataType,c)):a.texSubImage2D(a.TEXTURE_2D,g,b,f,e,k,h.pixelFormat,h.dataType,c);this._context.bindTexture(d,0)};g.prototype.generateMipmap=function(){var d=this._desc;
d.hasMipmap||(d.hasMipmap=!0,g._validateTexture(d));9729===d.samplingMode?(this._samplingModeDirty=!0,d.samplingMode=9985):9728===d.samplingMode&&(this._samplingModeDirty=!0,d.samplingMode=9984);d=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var b=this._context.gl;b.generateMipmap(b.TEXTURE_2D);this._context.bindTexture(d,0)};g.prototype.setSamplingMode=function(d){d!==this._desc.samplingMode&&(this._desc.samplingMode=d,g._validateTexture(this._desc),this._samplingModeDirty=
!0)};g.prototype.setWrapMode=function(d){d!==this._desc.wrapMode&&(this._desc.wrapMode=d,g._validateTexture(this._desc),this._wrapModeDirty=!0)};g.prototype.applyChanges=function(){var d=this._context.gl,b=this._desc;this._samplingModeDirty&&(g._applySamplingMode(d,b),this._samplingModeDirty=!1);this._wrapModeDirty&&(g._applyWrapMode(d,b),this._wrapModeDirty=!1)};g.prototype.setBoundToUnit=function(g,b){b?this._boundToUnits.add(g):this._boundToUnits.delete(g)};g._isPowerOfTwo=function(g){return 0===
(g&g-1)};g._validateTexture=function(d){(0>d.width||0>d.height)&&console.error("Negative dimension parameters are not allowed!");g._isPowerOfTwo(d.width)&&g._isPowerOfTwo(d.height)||("number"===typeof d.wrapMode?33071!==d.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===d.wrapMode.s&&33071===d.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),d.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};
g._applySamplingMode=function(g,b){var f=b.samplingMode,e=b.samplingMode;if(9985===f||9987===f)f=9729,b.hasMipmap||(e=9729);else if(9984===f||9986===f)f=9728,b.hasMipmap||(e=9728);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,f);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,e)};g._applyWrapMode=function(g,b){"number"===typeof b.wrapMode?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,b.wrapMode),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,b.wrapMode)):(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,
b.wrapMode.s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,b.wrapMode.t))};g._applyAnisotropicFilteringParameters=function(g,b){if(null!=b.maxAnisotropy){var f=g.capabilities.textureFilterAnisotropic;f&&(g=g.gl,g.texParameterf(g.TEXTURE_2D,f.TEXTURE_MAX_ANISOTROPY,b.maxAnisotropy))}};g._nextId=0;return g}()})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils","../../core/Error"],function(t,d,q,g,l){function b(c){return c[0].stride}
function f(c){switch(c){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}function e(c){switch(c){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:return 4;case 34041:return 4;case 33325:return 2;case 33326:return 4;case 35898:return 4;case 33327:return 4;case 33328:return 8;case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;
case 32854:return 2;case 36168:return 1;default:g.neverReached(c)}return 0}function k(c){if(!c)return 0;if("colorAttachment"in c)return c.glName?k(c.colorAttachment)+k(c.depthStencilAttachment):0;if("descriptor"in c)return c.glName?k(c.descriptor):0;var a=c.internalFormat||"pixelFormat"in c&&c.pixelFormat;if(!a)return 0;var b="hasMipmap"in c&&c.hasMipmap?1.3:1;c=c.width*c.height;return e(a)*c*b}Object.defineProperty(d,"__esModule",{value:!0});d.vertexCount=function(c,a){return c.vertexBuffers[a].size/
b(c.layout[a])};d.getStride=b;d.getBytesPerElement=f;d.addDescriptor=function(c,a,b,e,g,k){var h=f(e);if(0<c.length){var d=c[0].stride,p=d+h*b;c.forEach(function(a){return a.stride=p});c.push({name:a,count:b,type:e,offset:d,stride:p,normalized:g,divisor:k})}else c.push({name:a,count:b,type:e,offset:0,stride:h*b,normalized:g,divisor:k})};d.assertCompatibleVertexAttributeLocations=function(c,a){(c=c.locations===a.locations)||console.error("VertexAttributeLocations are incompatible");return c};d.hasAttribute=
function(c,a){for(var b=0;b<c.length;b++)if(c[b].name===a)return!0;return!1};d.findAttribute=function(c,a){for(var b=0;b<c.length;b++)if(c[b].name===a)return c[b];return null};d.copyFramebufferToTexture=function(c,a,b,e,f){void 0===f&&(f=0);var g=c.getBoundFramebufferObject(),h=c.getBoundTexture(0);c.bindFramebuffer(a);c.bindTexture(b,0);c.gl.copyTexImage2D(c.gl.TEXTURE_2D,f,b.descriptor.pixelFormat,e[0],e[1],e[2],e[3],0);c.gl.flush();c.bindFramebuffer(g);c.bindTexture(h,0)};d.assert=function(c,a){if(!c)throw new l(a);
};d.setBaseInstanceOffset=function(c,a){var b={},e;for(e in c)b[e]=c[e].map(function(c){return c.divisor?q({},c,{baseInstance:a}):c});return b};d.bindVertexBufferLayout=function(c,a,b,e,f){var g=c.gl,h=c.capabilities.instancing;c.bindBuffer(b);for(c=0;c<e.length;c++){b=e[c];var k=a[b.name],d=(f?f:0+b.baseInstance?b.baseInstance:0)*b.stride;void 0===k&&console.error("There is no location for vertex attribute '"+b.name+"' defined.");b.baseInstance&&!b.divisor&&console.error("Vertex attribute '"+b.name+
"' uses baseInstanceOffset without divisor.");if(4>=b.count)g.vertexAttribPointer(k,b.count,b.type,b.normalized,b.stride,b.offset+d),g.enableVertexAttribArray(k),b.divisor&&0<b.divisor&&h&&h.vertexAttribDivisor(k,b.divisor);else if(9===b.count)for(var p=0;3>p;p++)g.vertexAttribPointer(k+p,3,b.type,b.normalized,b.stride,b.offset+12*p+d),g.enableVertexAttribArray(k+p),b.divisor&&0<b.divisor&&h&&h.vertexAttribDivisor(k+p,b.divisor);else if(16===b.count)for(p=0;4>p;p++)g.vertexAttribPointer(k+p,4,b.type,
b.normalized,b.stride,b.offset+16*p+d),g.enableVertexAttribArray(k+p),b.divisor&&0<b.divisor&&h&&h.vertexAttribDivisor(k+p,b.divisor);else console.error("Unsupported vertex attribute element count: "+b.count)}};d.unbindVertexBufferLayout=function(c,a,b,e){var f=c.gl,g=c.capabilities.instancing;c.bindBuffer(b);for(b=0;b<e.length;b++){var h=e[b],k=a[h.name];if(4>=h.count)f.disableVertexAttribArray(k),h.divisor&&0<h.divisor&&g&&g.vertexAttribDivisor(k,0);else if(9===h.count)for(var d=0;3>d;d++)f.disableVertexAttribArray(k+
d),h.divisor&&0<h.divisor&&g&&g.vertexAttribDivisor(k+d,0);else if(16===h.count)for(d=0;4>d;d++)f.disableVertexAttribArray(k+d),h.divisor&&0<h.divisor&&g&&g.vertexAttribDivisor(k+d,0);else console.error("Unsupported vertex attribute element count: "+h.count)}c.unbindBuffer(34962)};d.getBytesPerElementFormat=e;d.getGpuMemoryUsage=k})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/has","./Util"],function(t,d,q,g){return function(){function d(b,f,e,g,c){this._locations=
this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=b;this._layout=e;this._buffers=g;this._locations=f;c&&(this._indexBuffer=c);this._id=d._nextId++}Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexBuffers",{get:function(){return this._buffers},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){var b=this;return Object.keys(this._buffers).reduce(function(f,e){return f+b._buffers[e].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});d.prototype.dispose=function(b){void 0===b&&(b=!0);if(this._context){var f=this._context.capabilities.vao;f&&this._glName&&(f.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(b){for(var e in this._buffers)this._buffers[e].dispose(),delete this._buffers[e];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};
d.prototype.initialize=function(){if(!this._initialized){var b=this._context.capabilities.vao;if(b){var f=b.createVertexArray();b.bindVertexArray(f);this._bindLayout();b.bindVertexArray(null);this._glName=f}this._initialized=!0}};d.prototype.bind=function(){this.initialize();var b=this._context.capabilities.vao;b?b.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};d.prototype._bindLayout=function(){var b=this._buffers,f=!!this._context.capabilities.vao,e=this._layout,
k=this._indexBuffer;b||console.error("Vertex buffer dictionary is empty!");var c=this._context.gl,a;for(a in b){var h=b[a];h||console.error("Vertex buffer is uninitialized!");var d=e[a];d||console.error("Vertex element descriptor is empty!");g.bindVertexBufferLayout(this._context,this._locations,h,d)}k&&(f?c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,k.glName):this._context.bindBuffer(k))};d.prototype.unbind=function(){this.initialize();var b=this._context.capabilities.vao;b?b.bindVertexArray(null):this._unbindLayout()};
d.prototype._unbindLayout=function(){var b=this._buffers,f=this._layout;b||console.error("Vertex buffer dictionary is empty!");for(var e in b){var k=b[e];k||console.error("Vertex buffer is uninitialized!");g.unbindVertexBufferLayout(this._context,this._locations,k,f[e])}(b=this._indexBuffer)&&this._context.unbindBuffer(b.bufferType)};d._nextId=0;return d}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ./atmosphereUtils ../support/earthUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/shaders/RealisticAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x){t=function(){function d(c){this.needsRender=!1;this.didRender=!0;this.slot=12;this._hazeSlot=13;this._renderData={texDepth:f.vec2f64.create(),v3CameraPos:k.vec3f64.create(),v3CameraUp:k.vec3f64.create(),v3CameraRight:k.vec3f64.create(),v3CameraDir:k.vec3f64.create(),halfSizeNearPlane:f.vec2f64.create(),v2CameraCenterOffset:f.vec2f64.create(),v4SphereComp:a.vec4f64.create(),v4AtmosParams1:a.vec4f64.create(),v4AtmosParams2:a.vec4f64.create(),v4AtmosParams3:a.vec4f64.create(),
v3InvWavelength:C,v3InvWavelengthScaled:B,v4Radii:a.vec4f64.create(),fScale:0,fScaleDepth:E,fLowerAlphaBlendBound:0,fScaleOverScaleDepth:0,fOneOverScaleDepth:0,fScaleDepthBlue:I,fOneOverScaleDepthBlue:L,fScaleOverScaleDepthBlue:0,g:F,g2:F*F,fMiePhaseCoefficients:K,showTest:0,nearFar:f.vec2f64.create(),fCameraHeight:0,fCameraHeight2:0,fC:0,fCSur:0,fInnerFadeDistance:0,fAltitudeFade:0};this._lowerElevationBoundRadius=0;this._earthRadius=p.earthRadius;this.view=c;this._updateRadius(p.earthRadius)}d.prototype.destroy=
function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&(this._hazeProgram.dispose(),this._hazeProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null);this._vao&&(this._vao.dispose(),this._vao=null)};d.prototype.when=function(a){return g.resolve().then(a)};d.prototype.initializeRenderContext=function(a){var c=this;a=a.rctx;this._handles=new q;this._updateElevation({spatialReference:this.view.basemapTerrain.spatialReference,tile:this.view.basemapTerrain.rootTiles[0],
extent:this.view.basemapTerrain.rootTiles[0].extent});this._handles.add(l.on(this.view,"basemapTerrain","elevation-change",function(a){return c._updateElevation(a)},function(){return c._updateElevation()}));this._handles.add(l.on(this.view,"basemapTerrain","elevation-bounds-change",function(){return c._updateVisibleElevationBounds()},function(){return c._updateVisibleElevationBounds()}));this._hazeProgram=y.createProgram(a,v.program,{haze:!0});this._skyProgram=y.createProgram(a,v.program);this._hazePipelineState=
w.makePipelineState({blending:w.separateBlendingParams(1,0,769,1),colorWrite:w.defaultColorWriteParams});this._skyPipelineState=w.makePipelineState({blending:w.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:w.defaultColorWriteParams});this._vao=this._createVertexArrayObject(a)};d.prototype.uninitializeRenderContext=function(a){this.destroy()};d.prototype.render=function(a){if(a.slot!==this._hazeSlot&&a.slot!==this.slot||0!==a.pass)return!1;this._update(a.camera);a.slot===this.slot&&
this._renderSky(a);a.slot===this._hazeSlot&&this._renderHaze(a);this.needsRender=!1;return!0};d.prototype._renderSky=function(a){var c=a.rctx,b=this._skyProgram;c.bindProgram(b);c.setPipelineState(this._skyPipelineState);b.setUniform4fv("v4AtmosParams3",this._renderData.v4AtmosParams3);this._renderCommon(b,a)};d.prototype._renderHaze=function(a){var c=this,b=a.rctx,e=a.offscreenRenderingHelper,f=this._hazeProgram;b.bindProgram(f);b.setPipelineState(this._hazePipelineState);e.renderDepthDetached(function(){b.bindTexture(e.depthTexture,
0);f.setUniform1i("tDepth",0);c._renderCommon(f,a)})};d.prototype._renderCommon=function(a,c){var b=c.rctx;a.setUniform3fv("v3InvWavelength",this._renderData.v3InvWavelength);a.setUniform3fv("v3InvWavelengthScaled",this._renderData.v3InvWavelengthScaled);a.setUniform3fv("v3LightDir",c.lightingData.direction);a.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp);a.setUniform3fv("v3CameraPos",this._renderData.v3CameraPos);a.setUniform3fv("v3CameraUp",this._renderData.v3CameraUp);a.setUniform3fv("v3CameraRight",
this._renderData.v3CameraRight);a.setUniform3fv("v3CameraDir",this._renderData.v3CameraDir);a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);a.setUniform2fv("v2CameraCenterOffset",this._renderData.v2CameraCenterOffset);a.setUniform4fv("v4Radii",this._renderData.v4Radii);a.setUniform4fv("v4AtmosParams1",this._renderData.v4AtmosParams1);a.setUniform4fv("v4AtmosParams2",this._renderData.v4AtmosParams2);a.setUniform1f("showTest",
this._renderData.showTest);a.setUniform1f("fInnerFadeDistance",this._renderData.fInnerFadeDistance);a.setUniform1f("fAltitudeFade",this._renderData.fAltitudeFade);b.bindVAO(this._vao);m.assertCompatibleVertexAttributeLocations(this._vao,a);b.drawArrays(5,0,4)};d.prototype._createVertexArrayObject=function(a){var c=M.createBuffer(4);c.position.setVec(0,[-1,-1,1]);c.position.setVec(1,[1,-1,1]);c.position.setVec(2,[-1,1,1]);c.position.setVec(3,[1,1,1]);c.uv0.setVec(0,[0,0]);c.uv0.setVec(1,[1,0]);c.uv0.setVec(2,
[0,1]);c.uv0.setVec(3,[1,1]);return new x(a,v.program.attributes,{geometry:n.glLayout(M)},{geometry:r.createVertex(a,35044,c.buffer)})};d.prototype._adjustRadiusForTesselation=function(a){return a*Math.cos(Math.PI/Math.pow(2,4)/16)};d.prototype._updateElevation=function(a){a=a?a.tile:this.view.basemapTerrain.rootTiles[0];0===a.lij[0]&&(a=this._adjustRadiusForTesselation(p.earthRadius+a.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,
this._updateVisibleElevationBounds()))};d.prototype._updateVisibleElevationBounds=function(){var a=this._adjustRadiusForTesselation(p.earthRadius+this.view.basemapTerrain.getElevationBounds()[0]);(0>this._earthRadius||a<this._earthRadius)&&this._updateRadius(a)};d.prototype._updateRadius=function(a){this._earthRadius=a;var b=a*a,e=a/10*10.25,f=e*e,g=1/(e-a),k=g/E,m=g/I,d=.3*(e-a)+a,p=1/(e-d),n=this._renderData;c.vec4.set(n.v4AtmosParams1,g,E,k,G);c.vec4.set(n.v4AtmosParams2,F,I,m,L);c.vec4.set(n.v4AtmosParams3,
F*F,K,d,p);c.vec4.set(n.v4Radii,a,b,e,f);n.fScale=g;n.fLowerAlphaBlendBound=d;n.fScaleOverScaleDepth=k;n.fScaleOverScaleDepthBlue=m;b=h.INNER_ATMOSPHERE_DEPTH;n.fInnerFadeDistance=2*Math.sqrt((2*a-b)*b)};d.prototype._update=function(c){c&&(e.vec3.negate(this._renderData.v3CameraDir,c.viewForward),e.vec3.copy(this._renderData.v3CameraUp,c.viewUp),e.vec3.copy(this._renderData.v3CameraRight,c.viewRight),this._renderData.fCameraHeight=e.vec3.length(c.eye),this._renderData.fCameraHeight2=this._renderData.fCameraHeight*
this._renderData.fCameraHeight,this._renderData.fC=this._renderData.fCameraHeight2-this._renderData.v4Radii[3],this._renderData.fCSur=this._renderData.fCameraHeight2-this._renderData.v4Radii[1],this._renderData.v4SphereComp=a.vec4f64.fromValues(this._renderData.fCameraHeight,this._renderData.fCameraHeight2,this._renderData.fC,this._renderData.fCSur),e.vec3.copy(this._renderData.v3CameraPos,c.eye),b.vec2.set(this._renderData.halfSizeNearPlane,Math.tan(c.fovX/2)/(c.width/c.fullWidth),Math.tan(c.fovY/
2)/(c.height/c.fullHeight)),b.vec2.set(this._renderData.v2CameraCenterOffset,(c.padding[3]+c.width/2)/c.fullWidth-.5,(c.padding[2]+c.height/2)/c.fullHeight-.5),b.vec2.set(this._renderData.nearFar,c.near,c.far),this._renderData.fAltitudeFade=h.computeInnerAltitudeFade(this._renderData.fCameraHeight-this._earthRadius))};d.isSupported=function(a){return a.rctx.capabilities.depthTexture};return d}();d=.02*Math.PI;var A=.004*Math.PI,C=k.vec3f64.fromValues(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,
4)),B=k.vec3f64.clone(C);e.vec3.scale(B,B,d);e.vec3.add(B,B,k.vec3f64.fromValues(A,A,A));var E=.25,I=.05,G=1/E,L=1/I,F=-.99999,K=(1-F*F)/(2+F*F)*1.5,M=u.newLayout().vec3f("position").vec2f("uv0");return t})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.computeInnerAltitudeFade=function(d){return Math.min(1,Math.max(0,(d-1E5)/9E5))};d.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/webgl-engine/shaders/RealisticAtmospherePrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});d.program={name:"realistic-atmosphere-color",shaders:function(b){return{vertexShader:l.glslifyDefineMap({HAZE:b.haze})+g.resolveIncludes("environment/realisticAtmosphere.vert"),fragmentShader:l.glslifyDefineMap({HAZE:b.haze})+g.resolveIncludes("environment/realisticAtmosphere.frag")}},attributes:q.Default3D}})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./atmosphereUtils ./resources/SimpleAtmosphereTexture ../support/earthUtils ../support/imageUtils ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E){function I(a,c,b,f,g){var h=e.vec3.length(a),k=f*Math.sqrt(h*h-f*f)/h,m=g.silCircleV1,d=g.silCircleV2;e.vec3.scale(g.silCircleCenter,a,Math.sqrt(f*f-k*k)/h);e.vec3.cross(m,a,c);1>e.vec3.squaredLength(m)&&e.vec3.cross(m,a,b);e.vec3.scale(m,m,k/e.vec3.length(m));e.vec3.cross(d,m,a);e.vec3.scale(d,d,k/e.vec3.length(d));return k}function G(a,c,b,f){e.vec3.add(O,f.silCircleCenter,f.silCircleV2);e.vec3.scale(U,O,M);g.mat4.lookAt(P,c,O,b);y.project(O,
P,a.projectionMatrix,a.viewport);y.project(U,P,a.projectionMatrix,a.viewport);return e.vec3.distance(O,U)/a.height}var L=-c.INNER_ATMOSPHERE_DEPTH,F=(h.earthRadius+L)/h.earthRadius,K=(h.earthRadius+0)/h.earthRadius,M=(h.earthRadius+3E5)/h.earthRadius,Q=n.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);t=function(){function g(a){this.needsRender=!1;this.didRender=!0;this.slot=12;this._renderData={texV:f.vec2f64.create(),silCircleCenter:k.vec3f64.create(),silCircleV1:k.vec3f64.create(),
silCircleV2:k.vec3f64.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this.view=a}g.prototype.when=function(a){return this._readyPromise.then(a)};g.prototype.initializeRenderContext=function(c){var b=this,e=c.rctx;this._cameraChangeHandle=q.init(this.view,"state.camera",function(){return b.needsRender=!0},!0);this._program=x.createProgram(e,w.colorPass);this._fadeProgram=x.createProgram(e,w.fadePass);this._vao=this._createRibbon(e);this._vaoCount=B.vertexCount(this._vao,
"geometry");this._fadeVao=r.createQuadVAO(e);this._fadeVaoCount=B.vertexCount(this._fadeVao,"geometry");this._readyPromise=p.requestImage(a).then(function(a){b._texture=new C(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);b.needsRender=!0});this._pipelineState=A.makePipelineState({blending:A.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:A.defaultColorWriteParams})};g.prototype.uninitializeRenderContext=function(a){this.destroy()};g.prototype.destroy=
function(){this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&(this._texture.dispose(),this._texture=null);this._program&&(this._program.dispose(),this._program=null);this._fadeProgram&&(this._fadeProgram.dispose(),this._fadeProgram=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._readyPromise&&(this._readyPromise.cancel(),this._readyPromise=null)};g.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass||null==
this._texture)return!1;this._update(a.camera);var c=a.rctx;c.setPipelineState(this._pipelineState);if(1>this._renderData.undergroundFadeAlpha){var b=this._program;c.bindProgram(b);b.setUniformMatrix4fv("proj",a.camera.projectionMatrix);b.setUniformMatrix4fv("view",a.camera.viewMatrix);b.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);b.setUniform3fv("silCircleV1",this._renderData.silCircleV1);b.setUniform3fv("silCircleV2",this._renderData.silCircleV2);b.setUniform2fv("texV",this._renderData.texV);
c.bindTexture(this._texture,0);b.setUniform1i("tex",0);b.setUniform3fv("lightDirection",a.lightingData.direction);b.setUniform1f("altitudeFade",this._renderData.altitudeFade);b.setUniform1f("innerScale",this._renderData.innerScale);c.bindVAO(this._vao);c.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(b=this._fadeProgram,c.bindProgram(b),b.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),b.setUniform3fv("lightDirection",a.lightingData.direction),
b.setUniform3fv("cameraPosition",a.camera.eye),c.bindVAO(this._fadeVao),c.drawArrays(5,0,this._fadeVaoCount));this.needsRender=!1;return!0};g.prototype._update=function(a){var f=k.vec3f64.create(),g=h.earthRadius,m=e.vec3.length(a.eye),d=m-g;this._renderData.undergroundFadeAlpha=0>d?Math.min(-d/5E3,1):0;var p=g+L,r=g+Math.max(50,d);this._renderData.innerScale=r*r/(Math.sqrt(r*r-g*g)*Math.sqrt(r*r-p*p)+g*p)-1;this._renderData.altitudeFade=c.computeInnerAltitudeFade(d);e.vec3.scale(f,a.eye,(g+50)/m);
I(f,a.center,a.up,g,this._renderData);f=G(a,f,a.up,this._renderData);m=Q(d);p=.001953125;r=0+f*m*1;50<d&&(I(a.eye,a.center,a.up,g,this._renderData),a=G(a,a.eye,a.up,this._renderData),a=n.clamp((a-1.5)/(f-1.5),0,1),p=0+.001953125*a,r=0+1*n.lerp(1,f*m,a));b.vec2.set(this._renderData.texV,p,r)};g.prototype._createRibbon=function(a){var c=new Float32Array(1155),b=new Uint32Array(1920);c[0]=0;c[1]=0;c[2]=-1;for(var e=0;128>e;e++){var f=9*e+3;c[f+0]=e;c[f+1]=F;c[f+2]=-1;c[f+3]=e;c[f+4]=K;c[f+5]=0;c[f+6]=
e;c[f+7]=M;c[f+8]=1;var f=3*e+1,g=127===e?1:f+3,h=15*e;b[h+0]=f;b[h+1]=f+1;b[h+2]=g+1;b[h+3]=g+1;b[h+4]=g;b[h+5]=f;b[h+6]=f+1;b[h+7]=f+2;b[h+8]=g+2;b[h+9]=g+2;b[h+10]=g+1;b[h+11]=f+1;b[h+12]=f;b[h+13]=g;b[h+14]=0}f=N.createBuffer(b.length);g=f.position;for(e=0;e<b.length;++e)h=3*b[e],g.set(e,0,c[h]),g.set(e,1,c[h+1]),g.set(e,2,c[h+2]);return new E(a,w.colorPass.attributes,{geometry:u.glLayout(N)},{geometry:m.createVertex(a,35044,f.buffer)})};return g}();var P=l.mat4f64.create(),O=k.vec3f64.create(),
U=k.vec3f64.create(),N=v.newLayout().vec3f("position");return t})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});d.createQuadVAO=function(b,k){void 0===k&&(k=g.Pos2);var c=null;switch(k){case g.Pos3Tex:c=new Float32Array([-1,-1,0,0,0,1,-1,
0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case g.Pos3:c=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case g.Pos2Tex:c=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;default:c=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new f(b,q.Default3D,{geometry:k},{geometry:l.createVertex(b,35044,c)})};d.createEmptyTexture=function(e,f){void 0===f&&(f=4);return new b(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:f,height:f})};d.createColorTexture=function(e,f,c){void 0===
c&&(c=4);for(var a=new Uint8Array(c*c*4),g=0;g<a.length;g+=4)a[g+0]=255*f[0],a[g+1]=255*f[1],a[g+2]=255*f[2],a[g+3]=255*f[3];return new b(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:c,height:c},a)}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];d.Pos3Tex=[{name:"position",count:3,
type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];d.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}];d.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];d.Pos2=[{name:"position",
count:2,type:5126,offset:0,stride:8,normalized:!1}];d.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/environment/Stars":function(){define("require exports ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/shaders/StarsPrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r){var y=l.getLogger("esri.views.3d.environment.Stars");d=function(){function a(a){this.slot=12;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this.needsRender=!1;this.didRender=!0;this._numStars=0;this._modelMatrix=k.mat4f64.create();this.view=a;this._loadDataPromise=this._loadBrightStarCatalogue()}a.prototype.destroy=function(){this._loadDataPromise.isFulfilled()||this._loadDataPromise.cancel();this._dateHandle&&(this._dateHandle.remove(),
this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};a.prototype.initializeRenderContext=function(a){var c=this,b=a.rctx;this._program=n.createProgram(b,h.program);this._pipelineState=u.makePipelineState({blending:u.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:u.defaultColorWriteParams});this._dateHandle=f.init(this.view,"environment.lighting.date",function(a){return c._update(a)});this._loadDataPromise.then(function(){c._numStars=
c._starData.byteLength/c.bytesPerStar;var a=new Float32Array(c._starData,0,c._numStars*c.numBinaryFloats),e=new Uint8Array(c._starData,c._numStars*c.numBinaryFloats*4,c._numStars*c.numBinaryUInt8);c._vao=c._createVertexArrayObject(b,a,e);c.needsRender=!0})};a.prototype.uninitializeRenderContext=function(a){this.destroy()};a.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass||null==this._starData)return!1;var c=a.rctx,b=this._program;c.bindProgram(b);a=a.camera;b.setUniformMatrix4fv("view",
a.viewMatrix);b.setUniformMatrix4fv("proj",a.projectionMatrix);b.setUniform4fv("viewport",a.fullViewport);b.setUniformMatrix4fv("model",this._modelMatrix);b.setUniform1f("pixelRatio",a.pixelRatio);c.setPipelineState(this._pipelineState);c.bindVAO(this._vao);v.assertCompatibleVertexAttributeLocations(this._vao,b);c.drawArrays(0,0,this._numStars);this.needsRender=!1;return!0};a.prototype._computeDayDuration=function(a){var c=new Date(a.getFullYear(),0,1,11,58,56),b=new Date(a.getFullYear()+1,0,1,11,
58,55);return(+a-+c)/(+b-+c)};a.prototype._update=function(a){if(a){var c=a.getHours()/12,b=a.getMinutes()/60*(2/24),f=a.getSeconds()/60*(2/1440),c=(c+b+f-.9972222)%2;a=2*this._computeDayDuration(a);b=this._modelMatrix;e.mat4.copy(b,x);e.mat4.rotateZ(b,b,-a*Math.PI);e.mat4.multiply(b,m,b);e.mat4.rotateZ(b,b,-c*Math.PI);this.needsRender=!0}};a.prototype._hexToRGB=function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]};a.prototype._unpackUint8Attributes=
function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]};a.prototype._createVertexArrayObject=function(a,b,e){for(var f=A.createBuffer(this._numStars),g=f.position,k=f.color,m=f.size,d=0;d<this._numStars;d++){var n=b[2*d+0],l=b[2*d+1];g.set(d,0,-Math.cos(n)*Math.sin(l));g.set(d,1,-Math.sin(n)*Math.sin(l));g.set(d,2,-Math.cos(l));n=this._unpackUint8Attributes(e[d]);l=this._hexToRGB(w[n[1]]);k.set(d,0,255*l[0]);k.set(d,1,255*l[1]);
k.set(d,2,255*l[2]);k.set(d,3,255);m.set(d,n[0])}return new r(a,h.program.attributes,{geometry:c.glLayout(A)},{geometry:p.createVertex(a,35044,f.buffer)})};a.prototype._verifyStartData=function(a){if(!a)throw new g("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new g("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};a.prototype._loadBrightStarCatalogue=function(){var a=
this;return C?(this._starData=C,b.resolve()):q(t.toUrl("./resources/stars.wsv"),{responseType:"array-buffer"}).then(function(c){c=c.data;a._verifyStartData(c);C=c;a._starData=c}).catch(function(a){a&&"cancel"!==a.dojoType&&y.error("loadBrightStarCatalogue",a.message);throw a;})};return a}();var w="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),m=k.mat4f64.fromValues(1,
0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),x=k.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),A=a.newLayout().vec3f("position").vec4u8("color").f32("size"),C=null;return d})},"esri/views/3d/webgl-engine/shaders/StarsPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(t,d,q,g){Object.defineProperty(d,"__esModule",
{value:!0});d.program={name:"stars",shaders:{vertexShader:g.resolveIncludes("environment/stars.vert"),fragmentShader:g.resolveIncludes("environment/stars.frag")},attributes:q.Default3D}})},"esri/views/3d/support/sunUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../lib/SunCalc ./mathUtils".split(" "),function(t,d,q,g,l,b,f,e){function k(a,c,b,e){for(var f=
[],g=0;g<b.length;g++)f[g]=(e[g]-b[g])*a/c+b[g];return f}Object.defineProperty(d,"__esModule",{value:!0});d.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};d.computeColorAndIntensity=function(a,c){var g,p,n,y,w=c.z,m=h;l.vec3.set(m.ambient.color,1,1,1);m.ambient.intensity=
d.settings.global.ambient;l.vec3.set(m.diffuse.color,1,1,1);m.diffuse.intensity=d.settings.global.diffuse;w=(Math.abs(w)-d.settings.local.altitude)/(d.settings.global.altitude-d.settings.local.altitude);w=e.clamp(w,0,1);m.globalFactor=w;c=f.getTimes(a,c.y,c.x);if(1>w){n=a.valueOf();var x,A;c.polarException===f.POLAR_EXCEPTION.MIDNIGHT_SUN?(x=n-36E5*(a.getHours()+48)-6E4*a.getMinutes(),A=x+432E6):c.polarException===f.POLAR_EXCEPTION.POLAR_NIGHT?(x=n-2,A=n-1):(x=c.sunrise.valueOf(),A=c.sunset.valueOf());
var C=A-x;y=x+C/2;p=C/4;g=y-p;p=y+p;var B=.06*C,C=x-B/2;x+=B/2;var q=A-B/2,I=A+B/2;A=d.settings.local;var G=[.01,A.ambientAtNight],L=[.8,.8,1],F=[.01,.01,.01],K=[A.diffuseAtTwilight,A.ambientAtTwilight],M=[1,.75,.75],Q=[.8,.8,1],P=[.9*A.diffuseAtNoon,A.ambientAtNoon],O=[1,.98,.98],U=[.98,.98,1],N=[A.diffuseAtNoon,A.ambientAtNoon],V=[1,1,1],t=[1,1,1];A=[0,0];var J=[0,0,0],B=[0,0,0];n<C||n>I?(A=G,J=F,B=L):n<x?(B=x-C,A=k(n-C,B,G,K),J=k(n-C,B,F,M),B=k(n-C,B,L,Q)):n<g?(B=g-x,A=k(n-x,B,K,P),J=k(n-x,B,M,
O),B=k(n-x,B,Q,U)):n<y?(B=y-g,A=k(n-g,B,P,N),J=k(n-g,B,O,V),B=k(n-g,B,U,t)):n<p?(B=p-y,A=k(n-y,B,N,P),J=k(n-y,B,V,O),B=k(n-y,B,t,U)):n<q?(B=q-p,A=k(n-p,B,P,K),J=k(n-p,B,O,M),B=k(n-p,B,U,Q)):n<I&&(B=I-q,A=k(n-q,B,K,G),J=k(n-q,B,M,F),B=k(n-q,B,Q,L));n=A[0];y=b.vec3f64.fromValues(J[0],J[1],J[2]);g=A[1];p=b.vec3f64.fromValues(B[0],B[1],B[2]);l.vec3.lerp(m.ambient.color,p,m.ambient.color,w);m.ambient.intensity=e.lerp(g,m.ambient.intensity,w);l.vec3.lerp(m.diffuse.color,y,m.diffuse.color,w);m.diffuse.intensity=
e.lerp(n,m.diffuse.intensity,w)}w=a.valueOf();c.polarException===f.POLAR_EXCEPTION.MIDNIGHT_SUN?(a=w-36E5*(a.getHours()+48)-6E4*a.getMinutes(),c=a+432E6):c.polarException===f.POLAR_EXCEPTION.POLAR_NIGHT?(a=w-2,c=w-1):(a=c.sunrise.valueOf(),c=c.sunset.valueOf());a=1-e.clamp(Math.abs(w-(a+(c-a)/2))/432E5,0,1);m.noonFactor=a;return m};d.computeDirection=function(g,h,k,v){v||(v=b.vec3f64.create());var p=a,n=q.mat4.identity(c);if("global"===k)f.getPosition(g,0,0,p),l.vec3.set(v,0,0,-1),q.mat4.rotateX(n,
n,-p.azimuth),q.mat4.rotateY(n,n,-p.altitude);else{var u=d.settings.planarDirection;k=u.globalAngles;u=(Math.abs(h.z)-u.localAltitude)/(u.globalAltitude-u.localAltitude);u=e.clamp(u,0,1);1>u?(f.getPosition(g,h.y,h.x,p),p.azimuth=(1-u)*p.azimuth+u*k.azimuth,p.altitude=(1-u)*p.altitude+u*k.altitude):(p.azimuth=k.azimuth,p.altitude=k.altitude);l.vec3.set(v,0,-1,0);q.mat4.rotateZ(n,n,-p.azimuth);q.mat4.rotateX(n,n,-p.altitude)}l.vec3.transformMat4(v,v,n);return v};d.computeShadowsEnabled=function(a,c){return"global"===
c?!0:Math.abs(a.z)<d.settings.planarDirection.localAltitude};var c=g.mat4f64.create(),a={azimuth:0,altitude:0},h={ambient:{color:b.vec3f64.create(),intensity:0},diffuse:{color:b.vec3f64.create(),intensity:0,direction:b.vec3f64.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function t(a){return new Date(864E5*(a+.5-2440588))}function d(c,b){return u(a(c)*h(w)-p(b)*a(w),h(c))}function q(c,b){return n(a(b)*h(w)+h(b)*a(w)*a(c))}function g(c,b,e){return u(a(c),
h(c)*a(b)-p(e)*h(b))}function l(c,b,e){return n(a(b)*a(e)+h(b)*h(e)*h(c))}function b(c){return r*(1.9148*a(c)+.02*a(2*c)+3E-4*a(3*c))}function f(a,e){a=r*(357.5291+.98560028*a);var f=b(a);a=a+f+102.9372*r+c;e||(e={dec:0,ra:0});e.dec=q(a,0);e.ra=d(a,0);return e}function e(c,b,e){return 2451545+c+.0053*a(b)-.0069*a(2*e)}function k(c){var b=r*(134.963+13.064993*c),e=r*(93.272+13.22935*c);c=r*(218.316+13.176396*c)+6.289*r*a(b);e=5.128*r*a(e);b=385001-20905*h(b);return{ra:d(c,e),dec:q(c,e),dist:b}}var c=
Math.PI,a=Math.sin,h=Math.cos,p=Math.tan,n=Math.asin,u=Math.atan2,v=Math.acos,r=c/180,y={dec:0,ra:0},w=23.4397*r,m={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(a,c,b,e){b=r*-b;c*=r;var h=a.valueOf()/864E5-.5+2440588-2451545;a=f(h,y);b=r*(280.16+360.9856235*h)-b-a.ra;e||(e={azimuth:0,altitude:0});e.azimuth=g(b,c,a.dec);e.altitude=l(b,c,a.dec);return e}},x=[[-.83,"sunrise","sunset"]];m.addTime=function(a,c,b){x.push([a,c,b])};m.getTimes=function(f,g,k){function d(b){var f=
n,g=y;b=v((a(b)-a(f)*a(g))/(h(f)*h(g)));return e(9E-4+(b+p)/(2*c)+l,u,A)}var p=r*-k,n=r*g,l=Math.round(f.valueOf()/864E5-.5+2440588-2451545-9E-4-p/(2*c));f=9E-4+(0+p)/(2*c)+l;var u=r*(357.5291+.98560028*f);g=b(u);var A=u+g+102.9372*r+c,y=q(A,0);f=e(f,u,A);g={solarNoon:t(f),nadir:t(f-.5),polarException:m.POLAR_EXCEPTION.NORMAL};var w,C,B,U;k=0;for(w=x.length;k<w;k+=1)C=x[k],B=d(C[0]*r),U=f-(B-f),g[C[1]]=t(U),g[C[2]]=t(B);g.polarException=function(c){c=(a(c)-a(n)*a(y))/(h(n)*h(y));return-1>c?m.POLAR_EXCEPTION.MIDNIGHT_SUN:
1<c?m.POLAR_EXCEPTION.POLAR_NIGHT:m.POLAR_EXCEPTION.NORMAL}(x[0][0]*r);return g};m.getMoonPosition=function(a,c,b){b=r*-b;c*=r;var e=a.valueOf()/864E5-.5+2440588-2451545;a=k(e);b=r*(280.16+360.9856235*e)-b-a.ra;e=l(b,c,a.dec);e+=.017*r/p(e+10.26*r/(e+5.1*r));return{azimuth:g(b,c,a.dec),altitude:e,distance:a.dist}};m.getMoonFraction=function(c){var b=c.valueOf()/864E5-.5+2440588-2451545;c=f(b);b=k(b);c=v(a(c.dec)*a(b.dec)+h(c.dec)*h(b.dec)*h(c.ra-b.ra));c=u(149598E3*a(c),b.dist-149598E3*h(c));return(1+
h(c))/2};return m})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){return function(g,d,b){void 0===g&&(g=q.vec3f64.create());void 0===d&&(d=q.vec3f64.fromValues(.57735,.57735,.57735));void 0===b&&(b=!0);this.intensity=g;this.direction=d;this.castShadows=b}}();d.MainLight=t;t=function(){return function(g,d){void 0===g&&(g=q.vec3f64.create());
void 0===d&&(d=q.vec3f64.fromValues(.57735,.57735,.57735));this.intensity=q.vec3f64.create();this.direction=q.vec3f64.create();this.intensity=g;this.direction=d}}();d.FillLight=t;t=function(){return function(g){void 0===g&&(g=q.vec3f64.create());this.intensity=g}}();d.AmbientLight=t;t=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();d.SphericalHarmonicsLight=t})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/ViewEvents ../../input/handlers/PreventContextMenu".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A){t=function(d){function l(){var a=null!==d&&d.apply(this,arguments)||this;a._handles=new b;return a}q(l,d);l.prototype.initialize=function(){this.viewEvents=new x.ViewEvents(this.view)};l.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};Object.defineProperty(l.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||
a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});l.prototype.disconnect=function(){this.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),
this._source=null)};l.prototype.connect=function(){var b=this.view;this._source=new w.BrowserEventSource(this.view.surface,b.input);var f=new m.InputManager(this._source);this._inputManager=f;f.installHandlers("prevent-context-menu",[new A.PreventContextMenu]);this._modeDragPan=new n.PinchAndPanNavigation(b,"primary");this._modeDragRotate=new k.DragRotate(b,"secondary","center");this._modeDragZoom=new c.DragZoom(b,"tertiary");f.installHandlers("navigation",[new u.PointerDownCancelAnimation(b),new e.DoubleClickZoom(b),
new a.GamepadNavigation(b),new h.KeyboardNavigation(b,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s"}),new p.MouseWheelZoom(b),new r.SingleKeyResetTilt(b,"p"),new v.SingleKeyResetHeading(b,"n"),new k.DragRotate(b,"primary","eye",["b"]),new k.DragRotate(b,"secondary","center",["b"]),new n.PinchAndPanNavigation(b,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new y.TwoFingerTilt(b)]);
this.viewEvents.connect(f);this._updateMode()};l.prototype._updateMode=function(){var a=this.primaryDragAction,a=C.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};Object.defineProperty(l.prototype,"debug",{get:function(){return{inputManager:this._inputManager}},enumerable:!0,configurable:!0});g([f.property()],l.prototype,"view",void 0);
g([f.property({value:"pan"})],l.prototype,"primaryDragAction",null);g([f.property({value:"default"})],l.prototype,"mode",null);g([f.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],l.prototype,"hasPendingInputs",void 0);g([f.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],l.prototype,"latestPointerType",void 0);g([f.property()],l.prototype,"_inputManager",void 0);return l=g([f.subclass("esri.views.3d.input.SceneInputManager")],l)}(f.declared(l));var C=new Map;d=
new Map;l=new Map;d.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});d.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});l.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});l.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});C.set("default",d);C.set("pro",l);return t})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(f){function c(a,c){var b=f.call(this,!0)||this;b.view=a;b.registerIncoming("double-click",c,function(a){return b.handleDoubleClick(a)});return b}q(c,f);c.prototype.handleDoubleClick=function(a){var c=a.data;if(e.eventMatchesPointerAction(c,"primary")){var f=this.view.state.isGlobal?new l.ZoomStepController(this.view,"animation"):new b.ZoomStepController(this.view,"animation");this.view.state.switchCameraController(f);
f.zoomStep(Math.log(.5)/Math.log(.6),g.createScreenPointArray(c.x,c.y));a.stopPropagation()}};return c}(f.InputHandler);d.DoubleClickZoom=t})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){Object.defineProperty(d,"__esModule",{value:!0});t=function(f){function h(a,b){var e=f.call(this,a.state,a.sceneIntersectionHelper,"interaction"===b?null:void 0)||this;e.view=a;e.mode=b;e.zoomLocation=l.vec3f64.create();e.tmpCamera=new c;e.tmpViewDir=l.vec3f64.create();e.targetOnSphere=l.vec3f64.create();e.tmpCenter=l.vec3f64.create();e.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new c,interactionDirection:null,tiltMode:0};
e.sphere=k.sphere.create();return e}q(h,f);Object.defineProperty(h.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});h.prototype.zoomStep=function(a,c){if(this.active){var b=this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(b.camera):this.animation.cameraAt(1,e);e=!1;0<a&&this.intersectionHelper.intersectScreen(c,this.zoomLocation)&&(e=!0);this.tmpCamera.copyFrom(b.camera);e?this.intersectionHelper.intersectRay(this.tmpCamera.ray,
this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:g.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,c);this.begin(this.tmpCamera)}};h.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:a.outExpo}};h.prototype.updateCamera=function(a,c,f,h){this.sphere.radius=g.vec3.length(f);g.vec3.subtract(this.tmpViewDir,
a.center,a.eye);var d=g.vec3.length(this.tmpViewDir),p=d*c;1>=c&&4>p&&(p=4,c=p/d);1E-6>Math.abs(d-p)||(d=g.vec3.length(a.center),this.sphere.radius!==d&&g.vec3.scale(a.center,a.center,(this.sphere.radius+c*(d-this.sphere.radius))/d),g.vec3.scale(this.tmpViewDir,this.tmpViewDir,-c),g.vec3.add(a.eye,a.center,this.tmpViewDir),b.applyAll(this.view,a,this.constraintOptions),1E-12<g.vec3.squaredDistance(f,a.center)&&k.sphere.intersectScreen(this.sphere,a,h,this.targetOnSphere)&&e.panToPosition(this.sphere,
a,f,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0),b.applySurfaceCollision(this.view,a))};return h}(f.PointToPointAnimationController);d.ZoomStepController=t})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){Object.defineProperty(d,"__esModule",{value:!0});d.applyTilt=c.apply;d.tiltError=c.error;d.applyAltitude=a.apply;d.altitudeError=a.error;d.applyDistance=h.apply;d.distanceError=h.error;d.applySurfaceCollision=p.apply;d.applyAll=function(a,c,b,e){void 0===b&&(b=u);void 0===e&&(e=c);var g=!1;e!==c&&e.copyFrom(c);e.markViewDirty();e.computeUp(a.state.mode);for(c=0;c<v;c++){for(var h=0,k=0,d=n;k<d.length;k++){var m=d[k];if(l.hasConstraintType(b.selection,m.type)){var p=
Math.abs(m.error(a,e,b));m.apply(a,e,b)&&(g=!0,h+=p)}}if(0===h)break}c=l.hasConstraintType(b.selection,8);a:switch(b.interactionType){case 4:b=1;break a;case 5:b=a.state.isGlobal?2:1;break a;default:b=0}c&&f.apply(a,e,b)&&(g=!0);g&&e.computeUp(a.state.mode);return g};d.pixelDistanceToInteractionFactor=function(a,c){a="number"===typeof a?a:q.vec2.distance(a,c);return k.inOutCubic(Math.min(1,a/150))};var n=[{type:1,error:function(a,c,b){return e.error(a,c,b)*c.distance},apply:e.apply},{type:2,error:g.error,
apply:g.apply},{type:4,error:b.error,apply:b.apply}],u={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},v=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/intersectionUtils ../../support/mathUtils".split(" "),function(t,d,q,g,l,b,f,e){function k(c,b,f){void 0===
f&&(f=l.defaultApplyOptions);var g;g=c.state.constraints.altitude;g=c.state.isGlobal&&g?2===f.interactionType&&l.hasConstraintType(f.selection,1)?!1:!0:!1;if(!g)return 0;var h=c.state.constraints.altitude;g=a;g.min=h.min;g.max=h.max;var d=f.interactionType;if(0!==d){var h=g.min,p=g.max,n=f.interactionStartCamera;f=f.interactionFactor;var d=2===d||1===d,r=k(c,n),n=0===r?0:c.renderCoordsHelper.getAltitude(n.eye);g.min=h;g.max=p;l.adjustRangeForInteraction(r,n,d,f,.05*n,g)}c=c.renderCoordsHelper.getAltitude(b.eye);
c=e.clamp(c,g.min,g.max)-c;return 1E-6>=Math.abs(c)?0:c}function c(a,c,b,e){a.renderCoordsHelper.worldUpAtPosition(c.eye,e);q.vec3.scale(e,e,b);return e}Object.defineProperty(d,"__esModule",{value:!0});d.apply=function(a,g,d,y){void 0===d&&(d=l.defaultApplyOptions);void 0===y&&(y=g);y!==g&&y.copyFrom(g);var r=k(a,g,d);if(0===r)return!1;var m=a.renderCoordsHelper,u=m.getAltitude(g.eye)+r;a=l.interactionDirectionTowardsConstraintMinimization(a,g,d.interactionDirection,c(a,g,e.sign(r),p),h);d=q.vec3.copy(n,
g.viewForward);m.intersectInfiniteManifold(b.ray.wrap(g.eye,a),u,y.eye)||m.setAltitude(u,y.eye);f.closestPointOnRay(g.eye,d,g.center,g.center);y.markViewDirty();return!0};d.error=k;var a={min:0,max:0},h=g.vec3f64.create(),p=g.vec3f64.create(),n=g.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../support/mathUtils"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.hasConstraintType=
function(g,b){return 0!==(g&b)};d.adjustRangeForInteraction=function(g,b,f,e,k,c){0!==g&&(f?(c.min=Math.min(c.min,b),c.max=Math.max(c.max,b)):null!=e?(c.min-=Math.max(0,(b-c.min)*(1-e)),c.max+=Math.max(0,(b-c.max)*(1-e))):k&&(c.min-=Math.max(0,b-c.min-k),c.max+=Math.max(0,b-c.max-k)))};d.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};d.interactionDirectionTowardsConstraintMinimization=function(d,b,f,e,k){f||
(f=b.viewForward);q.vec3.copy(k,f);q.vec3.scale(k,k,g.sign(q.vec3.dot(f,e)));return k}})},"esri/views/3d/support/intersectionUtils":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(t,d,q,g,l){function b(c,a,b,e){var f=k;c?(b&&e&&(f.len=g.vec3.distance(a,b)),g.vec3.copy(f.dir,c)):e?(f.len=g.vec3.distance(a,b),g.vec3.subtract(f.dir,b,a),g.vec3.scale(f.dir,f.dir,1/f.len)):(g.vec3.subtract(f.dir,
b,a),g.vec3.normalize(f.dir,f.dir));return f}function f(c,a){return-g.vec3.dot(a,c)-c[3]}function e(c,a,b,e){e.clip[0]=0;e.clip[1]=b?e.len:Number.MAX_VALUE;for(b=0;b<c.length;b++){var h;var k=c[b],d=a;h=e;var p=g.vec3.dot(k,h.dir),k=f(k,d);0>k&&0<=p?h=!1:-1E-6<p&&1E-6>p?h=0<k:!(0>k||0>p)||0>k&&0>p?(k/=p,0<p?k<h.clip[1]&&(h.clip[1]=k):k>h.clip[0]&&(h.clip[0]=k),h=h.clip[0]<=h.clip[1]):h=!0;if(!h)return!1}return!0}Object.defineProperty(d,"__esModule",{value:!0});d.planeSphere=function(c,a,b){return c[0]*
a[0]+c[1]*a[1]+c[2]*a[2]+c[3]<b};d.frustumSphere=function(c,a,b){var e=a[0],f=a[1];a=a[2];return c[0][0]*e+c[0][1]*f+c[0][2]*a+c[0][3]>b||c[1][0]*e+c[1][1]*f+c[1][2]*a+c[1][3]>b||c[2][0]*e+c[2][1]*f+c[2][2]*a+c[2][3]>b||c[3][0]*e+c[3][1]*f+c[3][2]*a+c[3][3]>b||c[4][0]*e+c[4][1]*f+c[4][2]*a+c[4][3]>b||c[5][0]*e+c[5][1]*f+c[5][2]*a+c[5][3]>b?!1:!0};d.frustumRay=function(c,a,f,g){f=b(g,a,f,!1);return e(c,a,null,f)};d.frustumPoint=function(c,a){for(var b=0;6>b;b++)if(0>f(c[b],a))return!1;return!0};d.frustumLineSegment=
function(c,a,f,g){g=b(g,a,f,!0);return e(c,a,f,g)};d.closestPointOnRay=function(c,a,b,e){b=g.vec3.dot(a,g.vec3.subtract(e,b,c));g.vec3.add(e,c,g.vec3.scale(e,a,b));return e};var k={dir:l.vec3f64.create(),len:0,clip:q.vec2f64.create()}})},"esri/views/3d/camera/constraintUtils/distance":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/mathUtils".split(" "),function(t,d,q,g,l,b,f){function e(a,
c,b){void 0===b&&(b=l.defaultApplyOptions);if(!a.state.isLocal)return 0;var f=a.state.constraints.distance;if(!a.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===f)return 0;k.min=0;k.max=f;var f=k,g=b.interactionType;if(0!==g){var h=f.min,d=f.max,p=b.interactionStartCamera;b=b.interactionFactor;var g=1===g||4===g,n=e(a,p),p=0===n?0:q.vec3.distance(p.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);f.min=h;f.max=d;l.adjustRangeForInteraction(n,p,g,b,.05*p,f)}a=q.vec3.distance(c.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);
a=k.max-a;return-1E-6<=a?0:a}Object.defineProperty(d,"__esModule",{value:!0});d.error=e;d.apply=function(g,k,d,r){void 0===d&&(d=l.defaultApplyOptions);void 0===r&&(r=k);r!==k&&r.copyFrom(k);var n=e(g,k,d);if(0===n)return!1;var u=g.pointsOfInterest.surfaceOrigin,n=q.vec3.distance(k.eye,g.pointsOfInterest.surfaceOrigin.renderLocation)+n,m=q.vec3.copy(c,k.eye);d=l.interactionDirectionTowardsConstraintMinimization(g,k,d.interactionDirection,f.directionFromTo(p,k.eye,g.pointsOfInterest.surfaceOrigin.renderLocation),
h);return b.sphere.intersectRay(b.sphere.wrap(n,u.renderLocation),b.ray.wrap(k.eye,d),r.eye)?(k=q.vec3.subtract(a,r.eye,m),q.vec3.add(r.center,r.center,k),r.markViewDirty(),k=g.renderCoordsHelper.getAltitude(r.center),g.renderCoordsHelper.intersectInfiniteManifold(r.ray,k,r.center),r.markViewDirty(),!0):!1};var k={min:0,max:0},c=g.vec3f64.create(),a=g.vec3f64.create(),h=g.vec3f64.create(),p=g.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../intersectionUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});d.apply=function(f,e,g,c){void 0===g&&(g=0);void 0===c&&(c=e);var a=f.state.constraints;e!==c&&c.copyFrom(e);if(!a.collision.enabled)return!1;var h=l.surfaceElevationBelowEye(f,e);e=f.renderCoordsHelper.getAltitude(e.eye);a=h+a.collision.elevationMargin;if(e>=a)return!1;h=q.vec3.length(c.eye);q.vec3.subtract(b,c.center,
c.eye);f.renderCoordsHelper.setAltitude(a,c.eye);1===g?q.vec3.add(c.center,c.eye,b):2===g&&q.vec3.scale(c.center,c.center,(h-e+a)/h);c.markViewDirty();return!0};var b=g.vec3f64.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../support/earthUtils ../webgl-engine/lib/Intersector".split(" "),function(t,d,q,g,l,b,f,e){function k(a,
c){return a.renderCoordsHelper.fromRenderCoords(c,u,a.basemapTerrain.spatialReference)?a.basemapTerrain.getElevation(u)||0:0}function c(a,c,b){if(!a.state.isGlobal)return!1;var e=k(a,c);a=a.stateManager.constraintsManager.nearFarHeuristic.compute(c,b,a.dataExtent,e,r).far;a*=a;return q.vec3.squaredDistance(c,b)>a}function a(a,b,k){void 0===k&&(k=g.vec3f64.create());var d=h[a.viewingMode];d||(d=new e(a.viewingMode),d.enable.backfacesTerrain=!a.state.isGlobal,d.enable.invisibleTerrain=!0,h[a.viewingMode]=
d);var m=a.state.isGlobal;return a.sceneIntersectionHelper.intersectRay(b,k,null,d)&&!c(a,b.origin,k)?!0:!a.renderCoordsHelper.intersectManifold(b,0,k)||c(a,b.origin,k)?m?(a=k,k=q.vec3.dot(b.origin,b.origin)-f.earthRadius*f.earthRadius,q.vec3.scale(a,b.direction,(0<k?Math.sqrt(k)/3:1)/q.vec3.length(b.direction)),q.vec3.add(a,a,b.origin),!0):!1:!0}Object.defineProperty(d,"__esModule",{value:!0});d.eyeWithinExtent=function(a,c,e,f){return a.renderCoordsHelper.fromRenderCoords(c.eye,p,f)&&b.containsPoint(e,
p)};d.surfaceElevationBelowEye=function(a,c){return k(a,c.eye)};d.cameraOnContentAlongViewDirection=function(c,b,e,f){var g=c.state.camera.copy();b&&(g.eye=b);e&&(g.center=e);f&&(g.up=f);a(c,g.ray,n)||q.vec3.copy(n,g.center);e=c.state.constraints;f=e.minimumPoiDistance;q.vec3.squaredDistance(g.eye,n)<f&&(b=e.collision.enabled,q.vec3.copy(v,g.viewForward),q.vec3.scale(v,v,f),b?q.vec3.subtract(g.eye,n,v):q.vec3.add(n,g.eye,v),c=c.renderCoordsHelper,f=c.getAltitude(g.eye),e=e.collision.elevationMargin,
b&&f<e&&(q.vec3.subtract(v,n,g.eye),c.setAltitude(e,g.eye),q.vec3.add(n,g.eye,v)));g.center=n;return g};var h={},p=g.vec3f64.create(),n=g.vec3f64.create(),u=new l,v=g.vec3f64.create(),r={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("require exports ../../../../core/has ../../../../core/now ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./intersectorUtils".split(" "),
function(t,d,q,g,l,b,f,e,k){var c=l.mat4f64.create();return function(){function a(a){this.enable=new k.EnableIntersectorOptions;this.results=new k.IntersectorResults;this.transform=new k.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};this._ray={origin:f.vec3f64.create(),direction:f.vec3f64.create()};this._rayEndPoint=f.vec3f64.create();this._rayStartPointTransformed=f.vec3f64.create();this._rayEndPointTransformed=f.vec3f64.create();this.viewingMode=a||"global"}Object.defineProperty(a.prototype,
"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rayEndPoint",{get:function(){return this._rayEndPoint},enumerable:!0,configurable:!0});a.prototype.intersect=function(a,c,f,g,k,d,l,w,m){var h=this;if(void 0===m||!0===m)this._numObjectsTested=0,e.ray.fromPoints(c,f,this._ray),this.results.init(this._ray);this.point=g;this.camera=
k;this.enable.selectionMode=l;this.filterPredicate=w;this.tolerance=null==d?1E-5:d;b.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction);if(a&&0<a.length)for(c=0;c<a.length;c++)if(f=a[c],g=f.getSpatialQueryAccelerator?f.getSpatialQueryAccelerator():void 0)f=function(a){h.intersectObject(a)},g.forEachAlongRay(this._ray.origin,this._ray.direction,f),l&&g.forEachDegenerateObject(f);else for(g=0,f=f.getObjects();g<f.length;g++)this.intersectObject(f[g]);this.sortResults()};a.prototype.intersectObject=
function(a){var e=this;this._numObjectsTested++;for(var f=a.id,g=a.getGeometryRecords(),h=a.objectTransformation,d,l=function(m){m=g[m];var p=m.geometry,n=m.material,l=m.instanceParameters;if(l.hidden)return"continue";d=p.id;w.transform.setAndInvalidateLazyTransforms(h,m.getShaderTransformation());b.vec3.transformMat4(w._rayStartPointTransformed,w._ray.origin,w.transform.inverse);b.vec3.transformMat4(w._rayEndPointTransformed,w._rayEndPoint,w.transform.inverse);var r=w.transform.transform;n.intersect(p,
l,w.transform.transform,w,w._rayStartPointTransformed,w._rayEndPointTransformed,function(b,g,h,m,p,n){0<=b&&(null==e.filterPredicate||e.filterPredicate(e._ray.origin,e._rayEndPoint,b))&&(p?(null==e.results.hud.dist||b<e.results.hud.dist)&&e.results.hud.set(a,f,b,g,c,m,n,d,h):(p=function(c){return c.set(a,f,b,g,r,m,null,d,h)},(null==e.results.min.drapedLayerOrder||m>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||b<e.results.min.dist)&&p(e.results.min),(null==e.results.max.drapedLayerOrder||
m<e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||b>e.results.max.dist)&&p(e.results.max),e.enable.storeAll&&(n=new k.IntersectorResult(e._ray),p(n),e.results.all.push(n))))},m.shaderTransformation)},w=this,m=0;m<g.length;m++)l(m)};a.prototype.sortResults=function(){this.results.all.sort(function(a,c){return a.dist!==c.dist?a.dist-c.dist:a.drapedLayerOrder!==c.drapedLayerOrder?(void 0!==a.drapedLayerOrder?a.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==c.drapedLayerOrder?c.drapedLayerOrder:
Number.MAX_VALUE):(void 0!==c.drapedLayerGraphicOrder?c.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==a.drapedLayerGraphicOrder?a.drapedLayerGraphicOrder:Number.MIN_VALUE)})};a.DEFAULT_TOLERANCE=1E-5;return a}()})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("require exports ../../../../Graphic ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/geometryUtils/boundedPlane ./Object3D".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u){function v(a,c){return g.isNone(a)||null==a.layerUid?null:g.isSome(c.graphicsView)&&a.layerUid===c.graphicsView.mockLayerId?c.graphics:c.map.findLayerByUid(a.layerUid)}function r(a,c,b){if(g.isNone(a))return null;var e=v(a,c);return g.isNone(e)?null:e===c.graphics?g.isSome(c.graphicsView)?g.expect(c.graphicsView.getGraphicFromGraphicUid(a.graphicUid)):null:(c=c.allLayerViews.find(function(a){return a.layer===e}))?y(c,a,b):null}function y(a,c,b){return!a||a.suspended?
null:g.isSome(b)&&"getGraphicFromStageObject"in a?a.getGraphicFromStageObject(b.obj,b.triangleNr):"getGraphicFromGraphicUid"in a&&null!=c.graphicUid?a.getGraphicFromGraphicUid(c.graphicUid):null}Object.defineProperty(d,"__esModule",{value:!0});d.sliceFilterPredicate=function(a){return function(c,b,e){k.vec3.lerp(x,c,b,e);return!n.extrusionContainsPoint(a,x)}};t=function(){return function(){this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.storeAll=this.storeTerrainResults=this.backfacesTerrain=
!0}}();d.EnableIntersectorOptions=t;t=function(){function a(){this._transform=e.mat4f64.create();this._transformInverse=new w({value:this._transform},f.mat4.invert,e.mat4f64.create);this._transformInverseTranspose=new w(this._transformInverse,f.mat4.transpose,e.mat4f64.create);this._transformTranspose=new w({value:this._transform},f.mat4.transpose,e.mat4f64.create);this._transformInverseRotation=new w({value:this._transform},l.mat3.normalFromMat4Legacy,b.mat3f64.create)}a.prototype.invalidateLazyTransforms=
function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};Object.defineProperty(a.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});a.prototype.setTransformMatrix=function(a){f.mat4.copy(this._transform,a)};a.prototype.multiplyTransform=function(a){f.mat4.multiply(this._transform,this._transform,a)};a.prototype.set=function(a){f.mat4.copy(this._transform,
a);this.invalidateLazyTransforms()};a.prototype.setAndInvalidateLazyTransforms=function(a,c){this.setTransformMatrix(a);this.multiplyTransform(c);this.invalidateLazyTransforms()};return a}();d.IntersectorTransform=t;var w=function(){function a(a,c,b){this.original=a;this.update=c;this.dirty=!0;this.transform=b()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform},
enumerable:!0,configurable:!0});return a}();t=function(){function a(){this.min=new m;this.max=new m;this.hud=new m;this.terrain=new m}a.prototype.init=function(a){this.min.init(a);this.max.init(a);this.hud.init(a);this.terrain.init(a);this.all=[]};return a}();d.IntersectorResults=t;var m=function(){function b(a){this.normal=c.vec3f64.create();this.transformation=e.mat4f64.create();this._ray=p.ray.create();this.init(a)}Object.defineProperty(b.prototype,"ray",{get:function(){return this._ray},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return k.vec3.scale(A,this.ray.direction,this.dist),k.vec3.length(A)},enumerable:!0,configurable:!0});b.prototype.getIntersectionPoint=function(a){if(!this.hasIntersectionPoint)return!1;k.vec3.scale(A,this.ray.direction,this.dist);k.vec3.add(a,this.ray.origin,A);
return!0};b.prototype.getTransformedNormal=function(c){k.vec3.copy(C,this.normal);C[3]=0;a.vec4.transformMat4(C,C,this.transformation);k.vec3.copy(c,C);k.vec3.normalize(c,c);return c};b.prototype.set=function(a,b,e,g,h,d,m,p,n,l){a instanceof u&&(a={type:"stage",obj:a});this.dist=e;k.vec3.copy(this.normal,g);f.mat4.copy(this.transformation,h);this.target=a;this.name=b;this.drapedLayerOrder=d;this.center=m?c.vec3f64.clone(m):null;this.geometryId=p;this.triangleNr=n;this.drapedLayerGraphicOrder=l};
b.prototype.copyFrom=function(a){p.ray.copy(a._ray,this._ray);this.dist=a.dist;this.target=a.target;this.name=a.name;this.drapedLayerOrder=a.drapedLayerOrder;this.center=a.center?c.vec3f64.clone(a.center):null;this.geometryId=a.geometryId;this.triangleNr=a.triangleNr;this.intersector=a.intersector;this.drapedLayerGraphicOrder=a.drapedLayerGraphicOrder;k.vec3.copy(this.normal,a.normal);f.mat4.copy(this.transformation,a.transformation)};b.prototype.init=function(a){this.drapedLayerGraphicOrder=this.drapedLayerOrder=
this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";a?p.ray.copy(a,this._ray):this._ray=p.ray.create()};b.prototype.toOwner=function(a){if(!this.target)return null;switch(this.target.type){case "stage":var c=this.target.obj.getMetadata();return v(c,a);case "external":switch(this.intersector){case "PointRenderer":return c=this.target.metadata.layerUid,null!=c?a.map.findLayerByUid(c):null;case "LodRenderer":case "DrapedRenderer":return v(this.target.metadata,
a);case "TerrainRenderer":return a.map&&a.map.ground}}return null};b.prototype.toGraphic=function(a){if(!this.target)return null;switch(this.target.type){case "stage":var c=this.target.obj,b=this.triangleNr,e=c.getMetadata();return r(e,a,{obj:c,triangleNr:b});case "external":switch(this.intersector){case "PointRenderer":return b=this.target,c=a.computeMapPointFromVec3d(b.point),c=new q(c),b=b.metadata.layerUid,null!=b&&(a=a.map.findLayerByUid(b),c.layer=a,c.sourceLayer=a),c;case "LodRenderer":case "DrapedRenderer":return r(this.target.metadata,
a,null)}}return null};return b}();d.IntersectorResult=m;d.TERRAIN_ID="terrain";var x=c.vec3f64.create(),A=c.vec3f64.create(),C=h.vec4f64.create()})},"esri/core/libs/gl-matrix-2/mat3":function(){define(["require","exports","./math/mat3"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.mat3=q})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["require","exports","./common"],function(t,d,q){function g(b,f,e){var g=f[0],c=f[1],a=f[2],h=f[3],d=f[4],n=f[5],l=f[6],v=f[7];f=f[8];
var r=e[0],y=e[1],w=e[2],m=e[3],x=e[4],A=e[5],C=e[6],q=e[7];e=e[8];b[0]=r*g+y*h+w*l;b[1]=r*c+y*d+w*v;b[2]=r*a+y*n+w*f;b[3]=m*g+x*h+A*l;b[4]=m*c+x*d+A*v;b[5]=m*a+x*n+A*f;b[6]=C*g+q*h+e*l;b[7]=C*c+q*d+e*v;b[8]=C*a+q*n+e*f;return b}function l(b,f,e){b[0]=f[0]-e[0];b[1]=f[1]-e[1];b[2]=f[2]-e[2];b[3]=f[3]-e[3];b[4]=f[4]-e[4];b[5]=f[5]-e[5];b[6]=f[6]-e[6];b[7]=f[7]-e[7];b[8]=f[8]-e[8];return b}Object.defineProperty(d,"__esModule",{value:!0});d.fromMat4=function(b,f){b[0]=f[0];b[1]=f[1];b[2]=f[2];b[3]=f[4];
b[4]=f[5];b[5]=f[6];b[6]=f[8];b[7]=f[9];b[8]=f[10];return b};d.copy=function(b,f){b[0]=f[0];b[1]=f[1];b[2]=f[2];b[3]=f[3];b[4]=f[4];b[5]=f[5];b[6]=f[6];b[7]=f[7];b[8]=f[8];return b};d.set=function(b,f,e,g,c,a,h,d,n,l){b[0]=f;b[1]=e;b[2]=g;b[3]=c;b[4]=a;b[5]=h;b[6]=d;b[7]=n;b[8]=l;return b};d.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};d.transpose=function(b,f){if(b===f){var e=f[1],g=f[2],c=f[5];b[1]=f[3];b[2]=f[6];b[3]=e;b[5]=f[7];b[6]=g;b[7]=c}else b[0]=
f[0],b[1]=f[3],b[2]=f[6],b[3]=f[1],b[4]=f[4],b[5]=f[7],b[6]=f[2],b[7]=f[5],b[8]=f[8];return b};d.invert=function(b,f){var e=f[0],g=f[1],c=f[2],a=f[3],h=f[4],d=f[5],n=f[6],l=f[7];f=f[8];var v=f*h-d*l,r=-f*a+d*n,y=l*a-h*n,w=e*v+g*r+c*y;if(!w)return null;w=1/w;b[0]=v*w;b[1]=(-f*g+c*l)*w;b[2]=(d*g-c*h)*w;b[3]=r*w;b[4]=(f*e-c*n)*w;b[5]=(-d*e+c*a)*w;b[6]=y*w;b[7]=(-l*e+g*n)*w;b[8]=(h*e-g*a)*w;return b};d.adjoint=function(b,f){var e=f[0],g=f[1],c=f[2],a=f[3],h=f[4],d=f[5],n=f[6],l=f[7];f=f[8];b[0]=h*f-d*
l;b[1]=c*l-g*f;b[2]=g*d-c*h;b[3]=d*n-a*f;b[4]=e*f-c*n;b[5]=c*a-e*d;b[6]=a*l-h*n;b[7]=g*n-e*l;b[8]=e*h-g*a;return b};d.determinant=function(b){var f=b[3],e=b[4],g=b[5],c=b[6],a=b[7],h=b[8];return b[0]*(h*e-g*a)+b[1]*(-h*f+g*c)+b[2]*(a*f-e*c)};d.multiply=g;d.translate=function(b,f,e){var g=f[0],c=f[1],a=f[2],h=f[3],d=f[4],n=f[5],l=f[6],v=f[7];f=f[8];var r=e[0];e=e[1];b[0]=g;b[1]=c;b[2]=a;b[3]=h;b[4]=d;b[5]=n;b[6]=r*g+e*h+l;b[7]=r*c+e*d+v;b[8]=r*a+e*n+f;return b};d.rotate=function(b,f,e){var g=f[0],
c=f[1],a=f[2],h=f[3],d=f[4],n=f[5],l=f[6],v=f[7];f=f[8];var r=Math.sin(e);e=Math.cos(e);b[0]=e*g+r*h;b[1]=e*c+r*d;b[2]=e*a+r*n;b[3]=e*h-r*g;b[4]=e*d-r*c;b[5]=e*n-r*a;b[6]=l;b[7]=v;b[8]=f;return b};d.scale=function(b,f,e){var g=e[0];e=e[1];b[0]=g*f[0];b[1]=g*f[1];b[2]=g*f[2];b[3]=e*f[3];b[4]=e*f[4];b[5]=e*f[5];b[6]=f[6];b[7]=f[7];b[8]=f[8];return b};d.fromTranslation=function(b,f){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=f[0];b[7]=f[1];b[8]=1;return b};d.fromRotation=function(b,f){var e=Math.sin(f);
f=Math.cos(f);b[0]=f;b[1]=e;b[2]=0;b[3]=-e;b[4]=f;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};d.fromScaling=function(b,f){b[0]=f[0];b[1]=0;b[2]=0;b[3]=0;b[4]=f[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};d.fromMat2d=function(b,f){b[0]=f[0];b[1]=f[1];b[2]=0;b[3]=f[2];b[4]=f[3];b[5]=0;b[6]=f[4];b[7]=f[5];b[8]=1;return b};d.fromQuat=function(b,f){var e=f[0],g=f[1],c=f[2];f=f[3];var a=e+e,h=g+g,d=c+c,e=e*a,n=g*a,g=g*h,l=c*a,v=c*h,c=c*d,a=f*a,h=f*h;f*=d;b[0]=1-g-c;b[3]=n-f;b[6]=l+h;b[1]=n+f;b[4]=1-e-c;b[7]=v-a;
b[2]=l-h;b[5]=v+a;b[8]=1-e-g;return b};d.normalFromMat4Legacy=function(b,f){var e=f[0],g=f[1],c=f[2],a=f[4],h=f[5],d=f[6],n=f[8],l=f[9];f=f[10];var v=f*h-d*l,r=-f*a+d*n,y=l*a-h*n,w=e*v+g*r+c*y;if(!w)return null;w=1/w;b[0]=v*w;b[1]=(-f*g+c*l)*w;b[2]=(d*g-c*h)*w;b[3]=r*w;b[4]=(f*e-c*n)*w;b[5]=(-d*e+c*a)*w;b[6]=y*w;b[7]=(-l*e+g*n)*w;b[8]=(h*e-g*a)*w;return b};d.normalFromMat4=function(b,f){var e=f[0],g=f[1],c=f[2],a=f[3],h=f[4],d=f[5],n=f[6],l=f[7],v=f[8],r=f[9],y=f[10],w=f[11],m=f[12],x=f[13],A=f[14];
f=f[15];var C=e*d-g*h,q=e*n-c*h,E=e*l-a*h,I=g*n-c*d,G=g*l-a*d,L=c*l-a*n,F=v*x-r*m,K=v*A-y*m,v=v*f-w*m,M=r*A-y*x,r=r*f-w*x,y=y*f-w*A,w=C*y-q*r+E*M+I*v-G*K+L*F;if(!w)return null;w=1/w;b[0]=(d*y-n*r+l*M)*w;b[1]=(n*v-h*y-l*K)*w;b[2]=(h*r-d*v+l*F)*w;b[3]=(c*r-g*y-a*M)*w;b[4]=(e*y-c*v+a*K)*w;b[5]=(g*v-e*r-a*F)*w;b[6]=(x*L-A*G+f*I)*w;b[7]=(A*E-m*L-f*q)*w;b[8]=(m*G-x*E+f*C)*w;return b};d.projection=function(b,f,e){b[0]=2/f;b[1]=0;b[2]=0;b[3]=0;b[4]=-2/e;b[5]=0;b[6]=-1;b[7]=1;b[8]=1;return b};d.str=function(b){return"mat3("+
b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+")"};d.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+Math.pow(b[6],2)+Math.pow(b[7],2)+Math.pow(b[8],2))};d.add=function(b,f,e){b[0]=f[0]+e[0];b[1]=f[1]+e[1];b[2]=f[2]+e[2];b[3]=f[3]+e[3];b[4]=f[4]+e[4];b[5]=f[5]+e[5];b[6]=f[6]+e[6];b[7]=f[7]+e[7];b[8]=f[8]+e[8];return b};d.subtract=l;d.multiplyScalar=function(b,f,e){b[0]=f[0]*
e;b[1]=f[1]*e;b[2]=f[2]*e;b[3]=f[3]*e;b[4]=f[4]*e;b[5]=f[5]*e;b[6]=f[6]*e;b[7]=f[7]*e;b[8]=f[8]*e;return b};d.multiplyScalarAndAdd=function(b,f,e,g){b[0]=f[0]+e[0]*g;b[1]=f[1]+e[1]*g;b[2]=f[2]+e[2]*g;b[3]=f[3]+e[3]*g;b[4]=f[4]+e[4]*g;b[5]=f[5]+e[5]*g;b[6]=f[6]+e[6]*g;b[7]=f[7]+e[7]*g;b[8]=f[8]+e[8]*g;return b};d.exactEquals=function(b,f){return b[0]===f[0]&&b[1]===f[1]&&b[2]===f[2]&&b[3]===f[3]&&b[4]===f[4]&&b[5]===f[5]&&b[6]===f[6]&&b[7]===f[7]&&b[8]===f[8]};d.equals=function(b,f){var e=b[0],g=b[1],
c=b[2],a=b[3],h=b[4],d=b[5],n=b[6],l=b[7];b=b[8];var v=f[0],r=f[1],y=f[2],w=f[3],m=f[4],x=f[5],A=f[6],C=f[7];f=f[8];return Math.abs(e-v)<=q.EPSILON*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(g-r)<=q.EPSILON*Math.max(1,Math.abs(g),Math.abs(r))&&Math.abs(c-y)<=q.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(a-w)<=q.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(h-m)<=q.EPSILON*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(d-x)<=q.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(n-
A)<=q.EPSILON*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(l-C)<=q.EPSILON*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(b-f)<=q.EPSILON*Math.max(1,Math.abs(b),Math.abs(f))};d.mul=g;d.sub=l})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./ComponentUtils ./GeometryRecord ./HighlightUtils ./IdGen ./ModelContentType ./Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){var n=p.assert,u=g.mat4f64.create();t=function(){function d(a){void 0===a&&(a={});this._objectTransformation=g.mat4f64.create();this._bvObjectSpace=new v;this._bvWorldSpace=new v;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;this.id=d._idGen.gen(a.idHint);this.name=a.name;this.castShadow=null!=a.castShadow?a.castShadow:!0;this.metadata=a.metadata;this.objectTransformation=g.mat4f64.create();
this._initializeGeometryRecords(a.geometries,a.materials,a.transformations,a.origins)}Object.defineProperty(d.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(a){q.mat4.copy(this._objectTransformation,a);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")},enumerable:!0,configurable:!0});d.prototype._initializeGeometryRecords=function(a,c,b,e){if(Array.isArray(a)){n(c.length===a.length,"Object3D: materials don't match geometries");
n(b.length===a.length,"Object3D: transformations don't match geometries");this.geometryRecords=Array(a.length);this.geometries=a.slice();for(var f=0;f<a.length;f++)this.geometryRecords[f]=new k(a[f],c[f],g.mat4f64.clone(b[f]),{},e&&e[f]);this._hasVolatileTransformation=!1}else this.geometryRecords=[],this.geometries=[]};Object.defineProperty(d.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(a){n(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");
this._parentLayer=a},enumerable:!0,configurable:!0});d.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length};d.prototype.getFirstGeometryIndex=function(a){a=this.geometries.indexOf(a);n(-1<a,"Object3D.getFirstGeometryIndex: geometry not found");return a};d.prototype.findGeometryRecords=function(a){for(var c=[],b=0;b<this.geometries.length;b++)this.geometries[b]===a&&c.push(this.geometryRecords[b]);return c};d.prototype.getGeometryRecord=function(a){n(0<=a&&a<this.geometryRecords.length,
"Object3d.getGeometryDataByIndex: index out of range");return this.geometryRecords[a]};d.prototype.getGeometryRecords=function(){return this.geometryRecords};d.prototype.addGeometry=function(a,c,b,e,f,h){void 0===b&&(b=u);this.geometries.push(a);a=new k(a,c,g.mat4f64.clone(b),e||{},f,h);this.geometryRecords.push(a);this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.shaderTransformation});this._notifyDirty("objGeometryAdded",a);this._invalidateBoundingVolume();this._allComponentsVisibleDirty=
this._allComponentsHiddenDirty=!0;return a};d.prototype.hasGeometry=function(a){return-1<this.geometries.indexOf(a)};d.prototype.removeGeometry=function(a){var c=this.geometryRecords.splice(a,1)[0];this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.shaderTransformation});this.geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",c);this._invalidateBoundingVolume();this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;return c};d.prototype.removeAllGeometries=
function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};d.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[a]);this._invalidateBoundingVolume()};d.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;for(var a=0,c=this.geometryRecords;a<c.length;a++){var b=c[a];if(!e.isAllHidden(b.instanceParameters.componentVisibilities,b.geometry.data.componentOffsets)){this._allComponentsHidden=
!1;break}}}return this._allComponentsHidden};d.prototype.areAllComponentsVisible=function(){if(this._allComponentsVisibleDirty){this._allComponentsVisibleDirty=!1;this._allComponentsVisible=!0;for(var a=0,c=this.geometryRecords;a<c.length;a++){var b=c[a];if(!e.isAllVisible(b.instanceParameters.componentVisibilities,b.geometry.data.componentOffsets)){this._allComponentsVisible=!1;break}}}return this._allComponentsVisible};d.prototype.hasComponents=function(){for(var a=!1,c=0;c<this.geometries.length&&
!(a=e.hasComponents(this.geometries[c].data.componentOffsets));c++);return a};d.prototype.setComponentVisibility=function(a,c,b){c=e.updateVisibility(a.instanceParameters.componentVisibilities,a.geometry.data.componentOffsets,c,b);a.instanceParameters.componentVisibilities=c;this._notifyDirty("visibilityChanged",a);this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0};d.prototype.setHidden=function(a,c){a.instanceParameters.hidden=!!c;this._notifyDirty("visibilityChanged",a)};d.prototype.isHidden=
function(a){return!!a.instanceParameters.hidden};d.prototype.getComponentVisibility=function(a,c){return e.getVisibility(a.instanceParameters.componentVisibilities,c)};d.prototype.hideAllComponents=function(){if(this._allComponentsHiddenDirty||!this._allComponentsHidden){for(var a=0,c=this.geometryRecords;a<c.length;a++){var b=c[a],f=e.hideAllComponents(b.instanceParameters.componentVisibilities);b.instanceParameters.componentVisibilities=f}this._notifyDirty("visibilityChanged");this._allComponentsVisibleDirty=
this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;this._allComponentsVisible=!1}};d.prototype.unhideAllComponents=function(){if(this._allComponentsVisibleDirty||!this._allComponentsVisible){for(var a=0,c=this.geometryRecords;a<c.length;a++){var b=c[a],f=e.unhideAllComponents(b.instanceParameters.componentVisibilities);b.instanceParameters.componentVisibilities=f}this._notifyDirty("visibilityChanged");this._allComponentsHidden=this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=
!1;this._allComponentsVisible=!0}};d.prototype._setComponentHighlight=function(a,c,b,f){c=e.addHighlight(a.instanceParameters.componentHighlights,c,b,f);a.instanceParameters.componentHighlights=c};d.prototype.setComponentHighlight=function(a,b,e){var f=c.generateHighlightId();this._setComponentHighlight(a,b,e,f);this._notifyDirty("componentHighlightChanged");return f};d.prototype.highlightAllComponents=function(a){for(var b=c.generateHighlightId(),e=0,f=this.geometryRecords;e<f.length;e++)this._setComponentHighlight(f[e],
null,a,b);this._notifyDirty("componentHighlightChanged");return b};d.prototype.removeHighlights=function(a){for(var c=0,b=this.geometryRecords;c<b.length;c++){var f=b[c].instanceParameters,g=e.removeHighlight(f.componentHighlights,a);f.componentHighlights=g}this._notifyDirty("componentHighlightChanged")};d.prototype.getComponentFromTriangleNr=function(a,c){n(0<=a&&a<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");return e.componentFind(this.geometryRecords[a].geometry.data.componentOffsets,
3*c)};d.prototype.setGeometryTransformation=function(a,c){n(0<=a&&a<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var b=this.geometryRecords[a];c=new k(b.geometry,b.material,g.mat4f64.clone(c),b.instanceParameters);this.geometryRecords[a]=c;this._notifyDirty("objGeometryReplaced",[b,c]);this._invalidateBoundingVolume()};d.prototype.getCombinedStaticTransformation=function(a,c){c=c||g.mat4f64.create();q.mat4.multiply(c,this.objectTransformation,a.getStaticTransformation());
return c};d.prototype.getCombinedShaderTransformation=function(a,c){c=c||g.mat4f64.create();q.mat4.multiply(c,this.objectTransformation,a.getShaderTransformation());return c};d.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};d.prototype.getCastShadow=function(){return this.castShadow};d.prototype.setCastShadow=function(a){this.castShadow=a};d.prototype.getMetadata=function(){return this.metadata};d.prototype.getName=function(){return this.name};d.prototype.getBBMin=
function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};d.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};d.prototype.getCenter=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.center:this._bvWorldSpace.center};d.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};d.prototype._validateBoundingVolume=
function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this.geometryRecords.length;++a){var c=this.geometries[a],e=this.geometryRecords[a],c=c.boundingInfo;this._calculateTransformedBoundingVolume(c,this._bvObjectSpace,e.getShaderTransformation());this._calculateTransformedBoundingVolume(c,this._bvWorldSpace,this.getCombinedShaderTransformation(e))}l.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,
.5);l.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);for(var e=b.vec3f64.create(),g=b.vec3f64.create(),h=f.maxScale(this.objectTransformation),a=0;a<this.geometryRecords.length;++a){var c=this.geometries[a],d=this.geometryRecords[a].getShaderTransformation(),k=f.maxScale(d),c=c.boundingInfo;l.vec3.transformMat4(e,c.getCenter(),d);d=l.vec3.distance(e,this._bvObjectSpace.center);c=c.getBSRadius()*k;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,
d+c);l.vec3.transformMat4(g,e,this.objectTransformation);k=l.vec3.distance(g,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,k+c*h)}this._bvDirty=!1}};d.prototype._calculateTransformedBoundingVolume=function(a,c,e){var f=a.getBBMin();a=a.getBBMax();var g=b.vec3f64.clone(f),h=b.vec3f64.clone(a);l.vec3.transformMat4(g,g,e);l.vec3.transformMat4(h,h,e);for(var d=0;3>d;++d)c.bbMin[d]=Math.min(c.bbMin[d],g[d],h[d]),c.bbMax[d]=Math.max(c.bbMax[d],g[d],h[d]);for(d=
0;3>d;++d){l.vec3.copy(g,f);l.vec3.copy(h,a);g[d]=a[d];h[d]=f[d];l.vec3.transformMat4(g,g,e);l.vec3.transformMat4(h,h,e);for(var k=0;3>k;++k)c.bbMin[k]=Math.min(c.bbMin[k],g[k],h[k]),c.bbMax[k]=Math.max(c.bbMax[k],g[k],h[k])}};d.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};d.prototype._notifyDirty=function(a,c,b,e){this._parentLayer&&(b=b||h.OBJECT,
this._parentLayer.notifyDirty(a,c,b,e||this))};d._idGen=new a;return d}();var v=function(){function a(){this.bbMin=b.vec3f64.create();this.bbMax=b.vec3f64.create();this.center=b.vec3f64.create();this.bsRadius=0}a.prototype.init=function(){l.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);l.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);l.vec3.set(this.center,0,0,0);this.bsRadius=0};a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=
function(){return this.bsRadius};return a}();return t})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","./IdGen"],function(t,d,q){return function(){function g(d,b,f,e,k,c){this.id=g._idGen.gen(d.id);this.geometry=d;this.material=b;this.transformation=f;this.instanceParameters=e;this.origin=k;this.shaderTransformation=c}g.prototype.getStaticTransformation=function(){return this.transformation};g.prototype.getShaderTransformation=function(){return this.shaderTransformation?
this.shaderTransformation(this.transformation):this.transformation};g._idGen=new q;return g}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(t,d){return function(){function d(){this._count=0}d.prototype.gen=function(g){null==g&&(g="a");return g+"_"+this._count++};return d}()})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});var g=new q;d.generateHighlightId=
function(){return g.gen("highlight")}})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(t,d){return function(){function d(){}d.LAYER="layers";d.OBJECT="objects";d.GEOMETRY="geometries";d.MATERIAL="materials";d.TEXTURE="textures";return d}()})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../state/utils/viewUtils ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){function p(a,c,f,h,d){void 0===f&&(f=e.defaultApplyOptions);void 0===h&&(h=c);void 0===d&&(d=!0);c!==h&&h.copyFrom(c);C.eyeCenterDistance=0;C.requiresTwoSteps=!1;var k=n(a,c,f,void 0,C);if(0===k)return!1;g.mat4.identity(y);g.mat4.rotate(y,y,-k,c.viewRight);switch(f.tiltMode){case 1:b.vec3.transformMat4(r,c.viewForward,y);b.vec3.scale(r,r,C.eyeCenterDistance);b.vec3.add(h.center,c.eye,r);break;case 0:b.vec3.subtract(r,c.center,c.eye);b.vec3.transformMat4(r,r,y);b.vec3.subtract(h.eye,
c.center,r);break;default:q.neverReached(f.tiltMode)}b.vec3.transformMat4(h.up,h.up,y);h.markViewDirty();return C.requiresTwoSteps&&d?p(a,h,f,h,!1):!0}function n(f,g,d,p,l){void 0===d&&(d=e.defaultApplyOptions);void 0===p&&(p=e.defaultApplyOptions);if(!f.state.constraints.tilt)return 0;var r=f.state.constraints.tilt(g.distance,x);var C=d;if(0!==C.interactionType){var y=C.interactionStartCamera,B=C.interactionFactor,E=r.min,L=r.max,I=n(f,y,e.defaultApplyOptions,C),G=0===I?0:k.viewAngle(f.renderCoordsHelper,
y.center,y.eye);r.min=E;r.max=L;2===C.interactionType?(e.hasConstraintType(C.selection,2)&&v(f,y,r),e.adjustRangeForInteraction(I,G,!0,B,m,r)):e.adjustRangeForInteraction(I,G,!1,B,m,r)}2===p.interactionType&&e.hasConstraintType(p.selection,2)&&v(f,p.interactionStartCamera,r);if(1===d.tiltMode||1===p.tiltMode){a:{l&&(l.requiresTwoSteps=!1);switch(f.viewingMode){case "global":d=A;C=f.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;p=C+c.earthRadius;C=f.renderCoordsHelper.intersectManifold(g.ray,
C,w);d.eyeCenterDistance=g.distance;C?(d.eyeCenterDistance=b.vec3.distance(g.eye,w),d.tiltAtCenter=k.viewAngle(f.renderCoordsHelper,w,g.eye)):f.state.isLocal?d.tiltAtCenter=k.viewAngle(f.renderCoordsHelper,g.center,g.eye):(a.sphere.closestPointOnSilhouette(a.sphere.wrap(p),g.ray,w),d.eyeCenterDistance=b.vec3.distance(g.eye,w),d.tiltAtCenter=h.acos(-b.vec3.dot(g.viewForward,b.vec3.normalize(w,w))));d.radius=p;d.eyeRadius=b.vec3.length(g.eye);d.constraints=f.state.constraints;d.centerIsOnSurface=C;
g=h.clamp(d.tiltAtCenter,r.min,r.max);if(1E-9<Math.abs(d.tiltAtCenter-g)){if(d.centerIsOnSurface){g=d.constraints;f=p=d.tiltAtCenter;r=g.clampTilt(d.eyeCenterDistance,p);C=u(d,r);if(g.clampTilt(C,p)!==r)for(p=0;10>p&&1E-9<Math.abs(r-f);)C=(f+r)/2,y=u(d,C),y=g.clampTilt(y,C),1E-9<Math.abs(y-C)?f=C:r=C,p++;g=r;r=g;f=h.asin(d.radius/d.eyeRadius*Math.sin(d.tiltAtCenter));r=h.asin(d.radius/d.eyeRadius*Math.sin(r));f=d.eyeRadius>d.radius?f-r:r-f}else g=d.constraints.clampTilt(d.eyeCenterDistance,d.tiltAtCenter),
l&&g<Math.PI/2&&(l.requiresTwoSteps=!0,g=Math.PI/2-1E-5),f=d.tiltAtCenter-Math.PI/2-(g-Math.PI/2);l&&(l.eyeCenterDistance=u(d,g));l=f}else l=0;break a;case "local":p=k.viewAngle(f.renderCoordsHelper,g.center,g.eye);d=h.clamp(p,r.min,r.max);r=p-d;1E-9<Math.abs(r)?(l&&(p=f.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,f=f.renderCoordsHelper.getAltitude(g.eye)-p,d=Math.cos(d),l.eyeCenterDistance=1E-4<Math.abs(d)?f/d:g.distance),l=r):l=0;break a;default:q.neverReached(f.viewingMode)}l=
void 0}return l}l=k.viewAngle(f.renderCoordsHelper,g.center,g.eye);g=h.clamp(l,r.min,r.max);l-=g;l=1E-9<Math.abs(l)?l:0;return l}function u(a,c){if(!a.centerIsOnSurface)return a.eyeCenterDistance;c=Math.PI-h.clamp(c,0,Math.PI);var b=h.asin(a.radius/a.eyeRadius*Math.sin(c)),e=Math.sin(Math.PI-c-b)/Math.sin(c);return a.eyeRadius<a.radius&&1<e?Math.sin(Math.PI-c-(Math.PI-b))/Math.sin(c)*a.eyeRadius:e*a.eyeRadius}function v(a,e,f){if(!a.state.isLocal){var g=a.state.constraints;if(g.altitude){a=b.vec3.squaredLength(e.center);
var d=Math.sqrt(a);e=e.distance;var k=g.altitude.min+c.earthRadius,g=g.altitude.max+c.earthRadius,k=(k*k-e*e-a)/(-2*d*e);f.min=Math.max(f.min,Math.min(Math.PI-h.acos((g*g-e*e-a)/(-2*d*e)),f.max));f.max=Math.min(f.max,Math.PI-h.acos(k))}}}Object.defineProperty(d,"__esModule",{value:!0});d.apply=p;d.error=n;var r=f.vec3f64.create(),y=l.mat4f64.create(),w=f.vec3f64.create(),m=h.deg2rad(5),x={min:0,max:0},A={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},
C={eyeCenterDistance:0,requiresTwoSteps:!1}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../../support/mathUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});d.viewAngle=function(e,g,c){e.worldUpAtPosition(g,b);q.vec3.subtract(f,c,g);e=q.vec3.length(f);return 0===e?0:l.acos(q.vec3.dot(f,b)/e)};var b=g.vec3f64.create(),f=g.vec3f64.create()})},"esri/views/animation/easing":function(){define(["require",
"exports"],function(t,d){function q(b){return b}function g(b){var f=2*(b-Math.sqrt((b-1)*b)),e=f/2/b;return function(g){return g<e?b*g*g:f*g-f+1}}function l(b,f){return function(e){return e<f?f*b(e/f):1-b((1-e)/(1-f))*(1-f)}}Object.defineProperty(d,"__esModule",{value:!0});d.linear=q;d.inQuad=function(b){return b*b};d.outQuad=function(b){return 1-d.inQuad(1-b)};d.inOutQuad=function(b){return.5>b?d.inQuad(2*b)/2:(d.outQuad(2*(b-.5))+1)/2};d.inCubic=function(b){return b*b*b};d.outCubic=function(b){return 1-
d.inCubic(1-b)};d.inOutCubic=function(b){return.5>b?d.inCubic(2*b)/2:(d.outCubic(2*(b-.5))+1)/2};d.inQuart=function(b){return b*b*b*b};d.outQuart=function(b){return 1-d.inQuart(1-b)};d.inOutQuart=function(b){return.5>b?d.inQuart(2*b)/2:(d.outQuart(2*(b-.5))+1)/2};d.inQuint=function(b){return b*b*b*b*b};d.outQuint=function(b){return 1-d.inQuint(1-b)};d.inOutQuint=function(b){return.5>b?d.inQuint(2*b)/2:(d.outQuint(2*(b-.5))+1)/2};d.inSine=function(b){return-Math.cos(b*Math.PI/2)+1};d.outSine=function(b){return 1-
d.inSine(1-b)};d.inOutSine=function(b){return.5>b?d.inSine(2*b)/2:(d.outSine(2*(b-.5))+1)/2};d.inExpo=function(b){return Math.pow(2,10*(b-1))};d.outExpo=function(b){return 1-d.inExpo(1-b)};d.inOutExpo=function(b){return.5>b?d.inExpo(2*b)/2:(d.outExpo(2*(b-.5))+1)/2};d.inCirc=function(b){return-(Math.sqrt(1-b*b)-1)};d.outCirc=function(b){return 1-d.inCirc(1-b)};d.inOutCirc=function(b){return.5>b?d.inCirc(2*b)/2:(d.outCirc(2*(b-.5))+1)/2};d.inCoastQuad=l(g(1),1);d.outCoastQuad=l(g(1),0);d.inOutCoastQuad=
l(g(1),.5);d.inCoastCubic=l(g(2),1);d.outCoastCubic=l(g(2),0);d.inOutCoastCubic=l(g(2),.5);d.inCoastQuart=l(g(3),1);d.outCoastQuart=l(g(3),0);d.inOutCoastQuart=l(g(3),.5);d.inCoastQuint=l(g(4),1);d.outCoastQuint=l(g(4),0);d.inOutCoastQuint=l(g(4),.5);d.named={linear:q,"in-quad":d.inQuad,"out-quad":d.outQuad,"in-out-quad":d.inOutQuad,"in-coast-quad":d.inCoastQuad,"out-coast-quad":d.outCoastQuad,"in-out-coast-quad":d.inOutCoastQuad,"in-cubic":d.inCubic,"out-cubic":d.outCubic,"in-out-cubic":d.inOutCubic,
"in-coast-cubic":d.inCoastCubic,"out-coast-cubic":d.outCoastCubic,"in-out-coast-cubic":d.inOutCoastCubic,"in-quart":d.inQuart,"out-quart":d.outQuart,"in-out-quart":d.inOutQuart,"in-coast-quart":d.inCoastQuart,"out-coast-quart":d.outCoastQuart,"in-out-coast-quart":d.inOutCoastQuart,"in-quint":d.inQuint,"out-quint":d.outQuint,"in-out-quint":d.inOutQuint,"in-coast-quint":d.inCoastQuint,"out-coast-quint":d.outCoastQuint,"in-out-coast-quint":d.inOutCoastQuint,"in-sine":d.inSine,"out-sine":d.outSine,"in-out-sine":d.inOutSine,
"in-expo":d.inExpo,"out-expo":d.outExpo,"in-out-expo":d.inOutExpo,"in-circ":d.inCirc,"out-circ":d.outCirc,"in-out-circ":d.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3f64 ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera".split(" "),function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});t=function(c){function a(a,
b,e){e=c.call(this,e)||this;e.viewState=a;e.intersectionHelper=b;e.hasTarget=!1;e.animation=new l.default(e.viewState.mode);return e}q(a,c);a.prototype.begin=function(a,c){this.hasTarget=!0;c=this.animationSettings(c);e.copyFrom(this.viewState.camera);this.intersectionHelper.intersectRay(e.ray,k)&&(e.center=k);this.animation.update(e,a,c);this.animation.finished&&this.finish()};a.prototype.finish=function(){this.animation.currentTime=this.animation.time;c.prototype.finish.call(this)};Object.defineProperty(a.prototype,
"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});a.prototype.stepController=function(a,b){c.prototype.stepController.call(this,a,b);this.hasTarget&&this.animation.step(a,b)};a.prototype.onControllerEnd=function(a){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,a),this.animation.currentTime=this.animation.time);c.prototype.onControllerEnd.call(this,a)};a.prototype.animationSettings=function(a){void 0===
a&&(a={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};return a}(b.AnimationController);d.PointToPointAnimationController=t;var e=new f,k=g.vec3f64.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});var k=l.vec3f64.create();t=function(){function c(a){this.currentTime=0;this.animation=new e.Animation(function(){return new b.default(a)});this._current=new b.default(a)}Object.defineProperty(c.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});
c.prototype.update=function(a,c,b){var e=this.animation.definition.source,f=this.animation.definition.target,h=g.vec3.subtract(k,c.center,a.center),d=g.vec3.length(h);1E-5<=d?(h[0]/=d,h[1]/=d,h[2]/=d):(h[0]=0,h[1]=1,h[0]=0);g.vec3.copy(e.lookAtDirection,h);g.vec3.copy(f.lookAtDirection,h);e.copyFromRenderCamera(a);f.copyFromRenderCamera(c);this._current.copyFrom(e);this.animation.update(e,f,b);this.currentTime=0;a.almostEquals(c,5E-4,!0)&&(this.currentTime=this.animation.time)};c.prototype.cameraAt=
function(a,c){this.animation.cameraAt(a,this._current);c=c||new f;this._current.copyToRenderCamera(c);return c};c.prototype.step=function(a,c){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,c)};return c}();d.Animation=t;d.default=t})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});var e=f.angle,k=f.lerp,c=f.slerp,a=b.vec3f64.create(),h=b.vec3f64.create(),p=b.vec3f64.create(),n=b.vec3f64.create(),u=b.vec3f64.create(),v=b.vec3f64.create(),r=b.vec3f64.fromValues(0,0,1),y=b.vec3f64.fromValues(0,1,0),w=b.vec3f64.fromValues(1,0,0),m=g.mat3f64.create();t=function(){function f(a){void 0===a&&(a="global");this.viewingMode=a;this.center=b.vec3f64.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=
b.vec3f64.clone(y)}f.prototype.pixelsPerPanAtZoom=function(a){return this.size/2/(this._zoomToPanScale*a)};f.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};f.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};f.prototype.compareTo=function(a,c){c||(c={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var b=l.vec3.length(this.center),f=l.vec3.length(a.center),b=(b+f)/2;c.pan=e(this.center,
a.center)*b}else c.pan=l.vec3.distance(this.center,a.center);b=Math.abs(a.yaw-this.yaw);b>=Math.PI&&(b=2*Math.PI-b);c.rotate=Math.max(b,Math.abs(a.pitch-this.pitch));c.sourceZoom=this.distance;c.targetZoom=a.distance;return c};f.prototype.interpolate=function(a,b,e){"global"===this.viewingMode?c(a.center,b.center,e.pan,this.center):l.vec3.lerp(this.center,a.center,b.center,e.pan);this.distance=k(a.distance,b.distance,e.zoom);this.pitch=k(a.pitch,b.pitch,e.rotate);a=a.yaw;b=b.yaw;Math.abs(b-a)>=Math.PI&&
(a+=2*(a<b?1:-1)*Math.PI);this.yaw=k(a,b,e.rotate)};f.prototype.copyFrom=function(a){l.vec3.copy(this.center,a.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;l.vec3.copy(this.lookAtDirection,a.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};f.prototype.copyFromRenderCamera=function(a){var c=this._lookAtOrientation(a.center,m);l.vec3.copy(this.center,a.center);l.vec3.subtract(n,a.center,a.eye);l.vec3.transformMat3(n,n,c);l.vec3.transformMat3(u,
a.up,c);this.distance=l.vec3.length(n);n[0]/=this.distance;n[1]/=this.distance;n[2]/=this.distance;this.pitch=this._eyeUpToPitch(n,u);this.yaw=this._eyeUpToYaw(n,u);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};f.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};f.prototype.copyToRenderCamera=function(a){var c=this._lookAtOrientation(this.center,m);q.mat3.transpose(c,c);this._axisAngleVec3(w,this.pitch-Math.PI/2,y,n);
this._axisAngleVec3(r,this.yaw,n);this._axisAngleVec3(w,this.pitch-Math.PI/2,r,u);this._axisAngleVec3(r,this.yaw,u);l.vec3.scale(n,n,this.distance);l.vec3.transformMat3(n,n,c);l.vec3.transformMat3(u,u,c);a.center=this.center;a.eye=l.vec3.subtract(n,this.center,n);a.up=u};f.prototype._axisAngleVec3=function(c,b,e,f){void 0===f&&(f=e);var g=Math.cos(b);b=Math.sin(b);l.vec3.scale(a,e,g);l.vec3.cross(h,c,e);l.vec3.scale(h,h,b);l.vec3.scale(p,c,(1-g)*l.vec3.dot(c,e));return l.vec3.add(f,l.vec3.add(f,a,
h),p)};f.prototype._lookAtOrientation=function(c,b){this._upAtLookAt(c,p);l.vec3.cross(a,this.lookAtDirection,p);l.vec3.normalize(a,a);0===a[0]&&0===a[1]&&0===a[2]&&l.vec3.copy(a,w);l.vec3.cross(h,p,a);l.vec3.normalize(h,h);b||(b=g.mat3f64.create());b[0]=a[0];b[1]=h[0];b[2]=p[0];b[3]=a[1];b[4]=h[1];b[5]=p[1];b[6]=a[2];b[7]=h[2];b[8]=p[2];return b};f.prototype._upAtLookAt=function(a,c){return"local"===this.viewingMode?l.vec3.copy(c,r):l.vec3.normalize(c,a)};f.prototype._eyeUpToPitch=function(a,c){return Math.PI-
e(r,a)};f.prototype._eyeUpToYaw=function(a,c){.5>Math.abs(c[2])?(l.vec3.copy(v,c),0<a[2]&&l.vec3.scale(v,v,-1)):l.vec3.copy(v,a);l.vec3.cross(h,v,r);l.vec3.normalize(h,h);return e(w,h,r)};return f}();d.default=t})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/vector ./Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){function n(a,c){var b=c[0]-a[0],e=c[1]-a[1],f=c[2]-a[2];a=c[3]-a[3];return b*b+e*e+f*f+a*a}function u(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]}function v(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]}t=function(){function d(a,b,e){void 0===a&&(a=f.vec3f64.create());void 0===b&&(b=f.vec3f64.create());void 0===e&&(e=f.vec3f64.fromValues(0,0,1));this._viewUp=f.vec3f64.create();this._viewForward=f.vec3f64.create();this._viewRight=f.vec3f64.create();
this._ray=c.ray.createWrapper();this._viewport=k.vec4f64.fromValues(0,0,1,1);this._padding=k.vec4f64.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._near=1;this._far=1E3;this._viewDirty=!0;this._viewMatrix=l.mat4f64.create();this._projectionDirty=!0;this._projectionMatrix=l.mat4f64.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=l.mat4f64.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=l.mat4f64.create();this._frustumDirty=!0;this._frustum=c.frustum.create();
this._fullViewport=null;this.pixelRatio=1;this.relativeElevation=0;this._eye=f.vec3f64.clone(a);this._center=f.vec3f64.clone(b);this._up=f.vec3f64.clone(e);this._padding=k.vec4f64.create()}Object.defineProperty(d.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"ray",{get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=f.vec3f64.create());b.vec3.subtract(this._ray.direction,this.center,this.eye);return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewMatrix",{get:function(){this._ensureViewClean();return this._viewMatrix},
set:function(a){g.mat4.copy(this._viewMatrix,a);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==a&&(this._far=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=
!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fullHeight",{get:function(){return this._viewport[3]+
this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=k.vec4f64.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+
this._padding[2]),e.vec4.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(g.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=
this.width,c=this.height,b=this.near*Math.tan(this.fovY/2),e=b*this.aspect;g.mat4.frustum(this._projectionMatrix,-e*(1+2*this._padding[3]/a),e*(1+2*this._padding[1]/a),-b*(1+2*this._padding[2]/c),b*(1+2*this._padding[0]/c),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){g.mat4.copy(this._projectionMatrix,a);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fov",{get:function(){return this._fov},
set:function(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fovX",{get:function(){return p.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=p.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fovY",{get:function(){return p.fovd2fovy(this._fov,this.width,
this.height)},set:function(a){this._fov=p.fovy2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"distance",{get:function(){return b.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"frustum",{get:function(){this._recomputeFrustum();return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewInverseTransposeMatrix",
{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=l.mat4f64.create()),g.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),g.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/
2)/(this.width/2)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"aboveGround",{get:function(){return 0<=this.relativeElevation},enumerable:!0,configurable:!0});d.prototype.copyFrom=function(a){b.vec3.copy(this._eye,a._eye);b.vec3.copy(this._center,a._center);b.vec3.copy(this._up,a._up);e.vec4.copy(this._viewport,a._viewport);
e.vec4.copy(this._padding,a._padding);this._near=a._near;this._far=a._far;this._fov=a._fov;this.relativeElevation=a.relativeElevation;this._viewDirty=a._viewDirty;this._viewDirty||(g.mat4.copy(this._viewMatrix,a._viewMatrix),b.vec3.copy(this._viewRight,a._viewRight),b.vec3.copy(this._viewUp,a._viewUp),b.vec3.copy(this._viewForward,a._viewForward));a._projectionDirty?this._projectionDirty=!0:(g.mat4.copy(this._projectionMatrix,a._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=
!0;this._frustumDirty=a._frustumDirty;this._frustumDirty||(c.frustum.copy(a._frustum,this._frustum),this._frustumDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?g.mat4.copy(this._viewInverseTransposeMatrix,a._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=l.mat4f64.clone(a._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);a._fullViewport?this._fullViewport?e.vec4.copy(this._fullViewport,a._fullViewport):
this._fullViewport=k.vec4f64.clone(a._fullViewport):this._fullViewport=null;this.pixelRatio=a.pixelRatio;return this};d.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};d.prototype.copy=function(){var a=new d;a.copyFrom(this);return a};d.prototype.equals=function(a){return u(this._eye,a._eye)&&u(this._center,a._center)&&u(this._up,a._up)&&v(this._viewport,a._viewport)&&v(this._padding,a._padding)&&this._near===a._near&&this._far===a._far&&this._fov===a._fov&&this.pixelRatio===
a.pixelRatio};d.prototype.almostEquals=function(c,e,f){void 0===f&&(f=!1);e=b.vec3.distance(this._eye,this._center)*(e||5E-4);e*=e;f?(a.directionFromTo(w,c._eye,c._center),a.directionFromTo(m,this._eye,this._center),f=1E-10):(b.vec3.copy(w,c._center),b.vec3.copy(m,this._center),f=e);return b.vec3.squaredDistance(c._eye,this._eye)<e&&b.vec3.squaredDistance(w,m)<f&&.001>Math.abs(c._fov-this._fov)&&.5>n(c._padding,this._padding)&&.5>n(c._viewport,this._viewport)&&this.pixelRatio===c.pixelRatio};d.prototype.markViewDirty=
function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};d.prototype.computeRenderPixelSizeAt=function(a){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(a))};d.prototype.computeRenderPixelSizeAtDist=function(a){return a*this.perRenderPixelRatio};d.prototype.computeScreenPixelSizeAt=function(a){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(a))};d.prototype.viewDirectionDistance=function(a){return Math.abs(h.projectPointSignedLength(this.viewForward,
b.vec3.subtract(w,a,this._eye)))};d.prototype.computeScreenPixelSizeAtDist=function(a){return a*this.perScreenPixelRatio};d.prototype.computeDistanceFromRadius=function(a,c){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(c||1)))};d.prototype.getScreenCenter=function(a){void 0===a&&(a=q.createScreenPointArray());a[0]=(this.padding[3]+this.width/2)/this.pixelRatio;a[1]=(this.padding[2]+this.height/2)/this.pixelRatio;return a};d.prototype.getRenderCenter=function(a){a||(a=q.createRenderScreenPointArray3());
a[0]=this.padding[3]+this.width/2;a[1]=this.padding[2]+this.height/2;2<a.length&&(a[2]=.5);return a};d.prototype.setGLViewport=function(a){var c=this.viewport,b=this.padding;a.setViewport(c[0]-b[3],c[1]-b[2],c[2]+b[1]+b[3],c[3]+b[0]+b[2])};d.prototype.applyProjection=function(c,f,g){void 0===g&&(g=!1);c!==r&&b.vec3.copy(r,c);r[3]=1;g&&(f[2]=-r[2]);e.vec4.transformMat4(r,r,this.projectionMatrix);b.vec3.scale(r,r,1/Math.abs(r[3]));c=this.fullViewport;f[0]=a.lerp(0,c[0]+c[2],.5+.5*r[0]);f[1]=a.lerp(0,
c[1]+c[3],.5+.5*r[1]);g||(f[2]=.5*(r[2]+1));return f};d.prototype.projectPoint=function(c,f){r[0]=c[0];r[1]=c[1];r[2]=c[2];r[3]=1;e.vec4.transformMat4(r,r,this.viewProjectionMatrix);if(0===r[3])return null;b.vec3.scale(r,r,1/Math.abs(r[3]));c=this.fullViewport;"x"in f?(f.x=a.lerp(0,c[0]+c[2],.5+.5*r[0]),f.y=a.lerp(0,c[1]+c[3],.5+.5*r[1])):(f[0]=a.lerp(0,c[0]+c[2],.5+.5*r[0]),f[1]=a.lerp(0,c[1]+c[3],.5+.5*r[1]),2<f.length&&(f[2]=.5*(r[2]+1)));return f};d.prototype.unprojectPoint=function(a,c){g.mat4.multiply(y,
this.projectionMatrix,this.viewMatrix);if(!g.mat4.invert(y,y))return null;var b=this.fullViewport;r[0]=2*(a[0]-b[0])/b[2]-1;r[1]=2*(a[1]-b[1])/b[3]-1;r[2]=2*a[2]-1;r[3]=1;e.vec4.transformMat4(r,r,y);if(0===r[3])return null;c[0]=r[0]/r[3];c[1]=r[1]/r[3];c[2]=r[2]/r[3];return c};d.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()};d.prototype.screenToRender=function(a,c){var b=this.fullHeight-a[1]*this.pixelRatio;c[0]=a[0]*this.pixelRatio;c[1]=b;return c};d.prototype.renderToScreen=
function(a,c){var b=(this.fullHeight-a[1])/this.pixelRatio;c[0]=a[0]/this.pixelRatio;c[1]=b;return c};d.prototype.computeUpGlobal=function(){b.vec3.subtract(w,this.center,this.eye);var a=b.vec3.length(this.center);1>a?(b.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(b.vec3.dot(w,this.center))>.9999*b.vec3.length(w)*a||(b.vec3.cross(this.up,w,this.center),b.vec3.cross(this.up,this.up,w),b.vec3.normalize(this.up,this.up),this.markViewDirty())};d.prototype.computeUpLocal=function(){a.directionFromTo(w,
this.eye,this.center);.9999>=Math.abs(w[2])&&(b.vec3.scale(w,w,w[2]),b.vec3.set(this.up,-w[0],-w[1],1-w[2]),b.vec3.normalize(this.up,this.up),this.markViewDirty())};d.prototype._compareAndSetView=function(a,c){u(a,c)||(b.vec3.copy(c,a),this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0)};d.prototype._recomputeFrustum=function(){this._frustumDirty&&(c.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};d.prototype._ensureViewClean=function(){this._viewDirty&&
(g.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),b.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),b.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),b.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return d}();var r=k.vec4f64.create(),y=l.mat4f64.create(),w=f.vec3f64.create(),m=f.vec3f64.create();return t})},
"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});var f={zoom:0,pan:0,rotate:0};t=function(){function e(e){this.createCamera=e;this.time=0;this.definition=new g.Definition(e);this.path=new b.Path}e.prototype.update=function(b,c,a){this.definition.update(b,c,a);this.path.update(this.definition,a);this.time=this._applyTimeSettings(this.path.time,
a);this.settings=a};e.prototype.cameraAt=function(b,c){c=c||this.createCamera();b=Math.min(Math.max(0,b),1);b=this.settings.easing?this.normalizedEasing(this.settings.easing,b,1E3*this.time):1<=this.time?this.normalizedEasing(q.inOutCoastQuad,b):this.normalizedEasing(q.outExpo,b);b=this.path.interpolateComponentsAt(b,f);c.interpolate(this.definition.source,this.definition.target,b);return c};e.prototype.normalizedEasing=function(b,c,a){a=b(0);var e=b(1);return(b(c)-a)/(e-a)};e.prototype._applyTimeSettings=
function(b,c){var a=null!=c.speedFactor?c.speedFactor:1;null!=c.duration?b=c.duration:null!=c.speedFactor&&(b/=a);return b=Math.min(Math.max(null!=c.minDuration?c.minDuration:l.defaultSettings.minDuration/a,b),null!=c.maxDuration?c.maxDuration:l.defaultSettings.maxDuration/a)};return e}();d.Animation=t;d.default=t})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function g(g){this.createCamera=
g;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:q.defaultSettings.desiredScreenFlow};this.source=g();this.target=g()}g.prototype.clone=function(){var d=new g(this.createCamera);d.copyFrom(this);return d};g.prototype.copyFrom=function(g){this.update(g.source,g.target,g.settings)};g.prototype.update=function(g,b,f){this.source!==g&&this.source.copyFrom(g);this.target!==b&&this.target.copyFrom(b);this.compared=this.source.compareTo(this.target,this.compared);
this.settings.desiredScreenFlow=null!=f.desiredScreenFlow?f.desiredScreenFlow:q.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};g.prototype.halfWindowPanAtZoom=function(g){g=this.target.pixelsPerPanAtZoom(g);return this.halfWindowSize/g};Object.defineProperty(g.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,configurable:!0});return g}();d.Definition=t;d.default=t})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});t=function(e){function d(c,a){var f=e.call(this)||this;f._preallocSegments=[new b.default,new b.default,new b.default];f.update(c,a);return f}q(d,e);d.prototype.update=function(c,a){if(c){this.definition?this.definition.copyFrom(c):this.definition=c.clone();var b=null;a&&a.apex&&(b=f.optimalDistance(c,a.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==b?this._updateWithoutApex():this._updateWithApex(b,
a.apex)}};d.prototype.segmentInterpolateComponentsAt=function(c,a,b){b=c.interpolateComponentsAt(a,b);c===this._ascensionSegment?b.zoom=g.outQuad(b.zoom):c===this._descensionSegment&&(b.zoom=g.inQuad(b.zoom));return b};d.prototype._updateWithApex=function(c,a){var b=this._preallocSegments,e=b[0],f=b[1],b=b[2],g=null!=a.ascensionFactor?a.ascensionFactor:.5;a=Math.min(1-g,null!=a.ascensionFactor?a.descensionFactor:.5);var d=1-g-a;e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone();
e.definition.compared.targetZoom=c;e.definition.compared.pan=this.definition.compared.pan*g;e.definition.compared.rotate=this.definition.compared.rotate*g;e.update();this._ascensionSegment=e;this.segments.push(e);0<d&&(f.definition?f.definition.copyFrom(this.definition):f.definition=this.definition.clone(),f.definition.copyFrom(this.definition),f.definition.compared.sourceZoom=c,f.definition.compared.targetZoom=c,f.definition.compared.pan=this.definition.compared.pan*d,f.definition.compared.rotate=
this.definition.compared.rotate*d,f.update(),this.segments.push(f));b.definition?b.definition.copyFrom(this.definition):b.definition=this.definition.clone();b.definition.compared.sourceZoom=c;b.definition.compared.pan=this.definition.compared.pan*a;b.definition.compared.rotate=this.definition.compared.rotate*a;b.update();this._descensionSegment=b;this.segments.push(b)};d.prototype._updateWithoutApex=function(){var c=this._preallocSegments[0];c.update(this.definition);this.segments.push(c)};return d}(l.default);
d.Path=t;d.default=t})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(){this.segments=[]}Object.defineProperty(d.prototype,"time",{get:function(){return this.segments.reduce(function(g,d){return g+d.time},0)},enumerable:!0,configurable:!0});d.prototype.interpolateComponentsAt=function(g,d){g=Math.min(Math.max(g,0),1);g*=this.time;for(var b=0,f=0,e=this.definition,k=0;k<this.segments.length;k++){var c=
this.segments[k],a=c.definition;if(g<=c.time||k===this.segments.length-1)return d=this.segmentInterpolateComponentsAt(c,g/c.time,d),d.pan=e.hasPan?(b+a.compared.pan*d.pan)/e.compared.pan:1,d.rotate=e.hasRotate?(f+a.compared.rotate*d.rotate)/e.compared.rotate:1,g=d.zoom*(a.compared.targetZoom-a.compared.sourceZoom)+a.compared.sourceZoom,b=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,d.zoom=e.hasZoom?(g-b)/(f-b):1,d;g-=c.time;
b+=a.compared.pan;f+=a.compared.rotate}};d.prototype.segmentInterpolateComponentsAt=function(g,d,b){return g.interpolateComponentsAt(d,b)};return d}();d.Path=t;d.default=t})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(g){g&&this.update(g)}d.prototype.update=function(g){g&&(this.definition?this.definition.copyFrom(g):this.definition=g.clone());this._updatePrecomputedVariables();
this._updatePixelFlow()};d.prototype._updatePrecomputedVariables=function(){var g=this.definition,d=g.compared,b=d.sourceZoom,f=d.targetZoom;this._zoomSign=b>f?1:-1;this._panPixelsAtSource=d.pan*g.source.pixelsPerPanAtZoom(b);g=(g.source.pixelsPerRotateAtZoom(b)+g.target.pixelsPerRotateAtZoom(f))/2;this._rotatePixels=d.rotate*g};d.prototype._updatePixelFlow=function(){var g=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom,b=this.definition,f=b.hasZoom,e=b.hasPan,b=b.hasRotate,
k=0,c=0;f&&(e&&(k=(d/g-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),b&&(c=Math.log(g/d)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;g=this.definition.desiredPixelFlow;f&&e&&b?(d=k+c+k*c,this._zoomPixelFlow=k*c/d*g,this._panPixelFlow=c/d*g,this._rotatePixelFlow=k/d*g):f&&e?(d=1+k,this._zoomPixelFlow=k/d*g,this._panPixelFlow=1/d*g):f&&b?(d=1+c,this._zoomPixelFlow=
c/d*g,this._rotatePixelFlow=1/d*g):e&&b?(k=this._panPixelsAtSource/this._rotatePixels,d=1+k,this._panPixelFlow=k/d*g,this._rotatePixelFlow=1/d*g):e?this._panPixelFlow=g:f?this._zoomPixelFlow=g:b&&(this._rotatePixelFlow=g);this.time=b?this.rotateTime:f?this.zoomTime:e?this.panTime:0};Object.defineProperty(d.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/
this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var g=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*g+1)/(g*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?
this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});d.prototype._interpolateComponentsZoom=function(g){if(0===g||1===g)return g;if(this.definition.hasZoom){var d=this.definition.compared.sourceZoom,b=this.definition.compared.targetZoom;return(d*Math.pow(d/b,-g)-d)/(b-d)}return g};d.prototype._interpolateComponentsPan=function(g){if(0===g||1===g)return g;if(this.definition.hasPan&&this.definition.hasZoom){var d=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;
return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,d*g*this.time)-1)/(d*Math.LN2)}return g};d.prototype._interpolateComponentsRotate=function(g){return g};d.prototype.interpolateComponentsAt=function(g,d){g=Math.min(Math.max(g,0),1);var b=this._interpolateComponentsZoom(g),f=this._interpolateComponentsPan(g);g=this._interpolateComponentsRotate(g);d?(d.zoom=b,d.pan=f,d.rotate=g):d={zoom:b,pan:f,rotate:g};return d};return d}();d.Segment=t;d.default=t})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require",
"exports","./functions"],function(t,d,q){function g(g,b){var f=Math.max(g.compared.sourceZoom,g.compared.targetZoom);g=g.source.zoomAtPixelsPerPan(g.desiredPixelFlow/g.compared.pan)/2;return g<f?null!=b.maximumDistance?f+(b.maximumDistance-f)/2:1.5*f:b.maximumDistance?Math.min(b.maximumDistance,g):g}Object.defineProperty(d,"__esModule",{value:!0});d.optimalDistance=function(d,b){var f=g(d,b),e={ascensionFactor:null!=b.ascensionFactor?b.ascensionFactor:.5,descensionFactor:null!=b.descensionFactor?
b.descensionFactor:.5},k=0===e.ascensionFactor,c=0===e.descensionFactor,a=k?q.tAscensionZoomOnly:q.tAscensionZoomPan,h=k?q.dtAscensionZoomOnly:q.dtAscensionZoomPan,p=k?q.ddtAscensionZoomOnly:q.ddtAscensionZoomPan,n=c?q.tDescensionZoomOnly:q.tDescensionZoomPan,l=c?q.dtDescensionZoomOnly:q.dtDescensionZoomPan,v=c?q.ddtDescensionZoomOnly:q.ddtDescensionZoomPan,k=function(c){return a(d,e,c)+q.tPanion(d,e,c)+n(d,e,c)},c=function(a){return h(d,e,a)+q.dtPanion(d,e,a)+l(d,e,a)},r=function(a){return p(d,e,
a)+q.ddtPanion(d,e,a)+v(d,e,a)},y=k(f),w=q.tBaseLine(d),m=b.maximumIterations||20,x=null!=b.maximumDistance?b.maximumDistance:Infinity;for(b=0;b<m;b++){var A=(c(f)+1E-6)/r(f);if(isNaN(A)||f>=x&&0>A){if(!isFinite(x))return null;f=x;y=k(f);break}f-=A;if(f<d.compared.sourceZoom||f<d.compared.targetZoom)return null;A=k(f);if(.005>=Math.abs(A-y)/y)break;y=A}return y>.7*w||f<d.compared.sourceZoom||f<d.compared.targetZoom?null:f}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require",
"exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.tAscensionZoomPan=function(d,g,l){var b=d.halfWindowPanAtZoom(l-d.compared.sourceZoom);return-d.halfWindowSize*(g.ascensionFactor*Math.LN2*d.compared.pan+b)*Math.log(d.compared.sourceZoom/l)/(d.desiredPixelFlow*Math.LN2*b)};d.dtAscensionZoomPan=function(d,g,l){var b=1/l,f=Math.log(d.compared.sourceZoom*b),e=1/d.desiredPixelFlow,k=1/Math.LN2;l-=d.compared.sourceZoom;var c=1/l;g=(g.ascensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(l))/
d.halfWindowPanAtZoom(1);return d.halfWindowSize*b*e*k*c*g-d.halfWindowSize*f*e*k*c+d.halfWindowSize*f*e*k*g/(l*l)};d.ddtAscensionZoomPan=function(d,g,l){var b=l-d.compared.sourceZoom,f=1/b,e=1/l,k=Math.log(d.compared.sourceZoom*e);g=(g.ascensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(b))/d.halfWindowPanAtZoom(1);return d.halfWindowSize*f*(-2*f*e*g+2*f*k+2*e-2*k*g/(b*b)-g/(l*l))/(d.desiredPixelFlow*Math.LN2)};d.tAscensionZoomOnly=function(d,g,l){return-d.halfWindowSize*Math.log(d.compared.sourceZoom/
l)/(d.desiredPixelFlow*Math.LN2)};d.dtAscensionZoomOnly=function(d,g,l){return d.halfWindowSize/(l*d.desiredPixelFlow*Math.LN2)};d.ddtAscensionZoomOnly=function(d,g,l){return-d.halfWindowSize/(l*l*d.desiredPixelFlow*Math.LN2)};d.tPanion=function(d,g,l){return-d.compared.pan*d.halfWindowSize*(g.ascensionFactor+g.descensionFactor-1)/(d.desiredPixelFlow*d.halfWindowPanAtZoom(l))};d.dtPanion=function(d,g,l){return d.compared.pan*d.halfWindowSize*(g.ascensionFactor+g.descensionFactor-1)/(d.desiredPixelFlow*
d.halfWindowPanAtZoom(l*l))};d.ddtPanion=function(d,g,l){return-2*d.compared.pan*d.halfWindowSize*(g.ascensionFactor+g.descensionFactor-1)/(d.desiredPixelFlow*d.halfWindowPanAtZoom(l*l*l))};d.tDescensionZoomPan=function(d,g,l){return d.halfWindowSize*(-d.halfWindowPanAtZoom(l)-g.descensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(d.compared.targetZoom))*Math.log(l/d.compared.targetZoom)/(d.desiredPixelFlow*Math.LN2*d.halfWindowPanAtZoom(-l+d.compared.targetZoom))};d.dtDescensionZoomPan=
function(d,g,l){var b=Math.log(l/d.compared.targetZoom),f=1/d.desiredPixelFlow,e=1/Math.LN2,k=-l+d.compared.targetZoom,c=1/k;g=(-d.halfWindowPanAtZoom(l)-g.descensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(d.compared.targetZoom))/d.halfWindowPanAtZoom(1);return-d.halfWindowSize*b*f*e*c+d.halfWindowSize*b*f*e*g/(k*k)+d.halfWindowSize*f*e*c*g/l};d.ddtDescensionZoomPan=function(d,g,l){var b=l-d.compared.targetZoom,f=1/b,e=1/l,k=Math.log(l/d.compared.targetZoom);g=(d.halfWindowPanAtZoom(l)+
g.descensionFactor*Math.LN2*d.compared.pan-d.halfWindowPanAtZoom(d.compared.targetZoom))/d.halfWindowPanAtZoom(1);return d.halfWindowSize*f*(-2*f*e*g-2*f*k+2*e+2*k*g/(b*b)-g/(l*l))/(d.desiredPixelFlow*Math.LN2)};d.tDescensionZoomOnly=function(d,g,l){return d.halfWindowSize*Math.log(l/d.compared.targetZoom)/(d.desiredPixelFlow*Math.LN2)};d.dtDescensionZoomOnly=function(d,g,l){return d.halfWindowSize/(l*d.desiredPixelFlow*Math.LN2)};d.ddtDescensionZoomOnly=function(d,g,l){return-d.halfWindowSize/(l*
l*d.desiredPixelFlow*Math.LN2)};d.tBaseLine=function(d){var g=Math.LN2*d.compared.pan,l=d.halfWindowPanAtZoom(d.compared.sourceZoom-d.compared.targetZoom),b=d.halfWindowSize*Math.log(d.compared.sourceZoom/d.compared.targetZoom)/(d.desiredPixelFlow*Math.LN2*l);return d.compared.sourceZoom<=d.compared.targetZoom?b*(g-l):b*(g+l)}})},"esri/views/3d/state/controllers/AnimationController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../ViewAnimation","./CameraController"],
function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function f(e){void 0===e&&(e=new g);var f=b.call(this)||this;f.viewAnimation=e;return f}q(f,b);Object.defineProperty(f.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(b){this._asyncResult&&this._asyncResult.reject();this._asyncResult=b;if(this.state===l.State.Finished||this.state===l.State.Stopped)this._asyncResult=
null,this.state===l.State.Finished?b.resolve():b.reject()},enumerable:!0,configurable:!0});f.prototype.onControllerStart=function(e){var f=this;b.prototype.onControllerStart.call(this,e);this.viewAnimation&&this.viewAnimation.when().catch(function(){}).then(function(){f.updateStateFromViewAnimation()})};f.prototype.updateStateFromViewAnimation=function(){!this.viewAnimation||this.state!==l.State.Ready&&this.state!==l.State.Running||(this.viewAnimation.state===g.State.FINISHED?this.finish():this.viewAnimation.state===
g.State.STOPPED&&(this.state=l.State.Stopped))};f.prototype.onControllerEnd=function(e){this.viewAnimation&&(this.viewAnimation.done||(this.state===l.State.Finished?this.viewAnimation.finish():this.state===l.State.Stopped&&this.viewAnimation.stop()));this._asyncResult&&(this.state===l.State.Finished?this._asyncResult.resolve():this._asyncResult.reject());b.prototype.onControllerEnd.call(this,e)};f.prototype.finish=function(){this.finishController()};return f}(l.CameraController);d.AnimationController=
t})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});var f;(function(b){b.Ready="ready";b.Rejected="rejected";b.Running="running";b.Stopped="stopped";b.Finished="finished"})(f=d.State||(d.State={}));t=function(e){function d(){var c=
null!==e&&e.apply(this,arguments)||this;c.state=f.Ready;return c}q(d,e);Object.defineProperty(d.prototype,"active",{get:function(){return this.state===f.Running},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isInteractive",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0});d.prototype.stopController=function(){return this.canStop?(this.state=f.Stopped,!0):!1};d.prototype.finishController=
function(){this.state=f.Finished};d.prototype.onControllerStart=function(c){this.state=f.Running};d.prototype.onControllerEnd=function(c){};d.prototype.stepController=function(c,a){};Object.defineProperty(d.prototype,"steppingFinished",{get:function(){return!1},enumerable:!0,configurable:!0});g([b.property({readOnly:!0,dependsOn:["state"]})],d.prototype,"active",null);g([b.property()],d.prototype,"state",void 0);return d=g([b.subclass()],d)}(b.declared(l));d.CameraController=t})},"esri/views/3d/state/utils/navigationUtils":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../support/geometryUtils/coordinateSystem ../../webgl-engine/lib/Camera".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u){function v(a,c,b){var f=p.sm4d.get();g.mat4.identity(f);g.mat4.rotate(f,f,b[3],b);e.vec3.subtract(a.eye,a.eye,c);e.vec3.transformMat4(a.eye,a.eye,f);e.vec3.add(a.eye,a.eye,c);e.vec3.subtract(a.center,a.center,c);e.vec3.transformMat4(a.center,a.center,f);e.vec3.add(a.center,a.center,c);e.vec3.transformMat4(a.up,a.up,f);a.markViewDirty()}function r(a,c){e.vec3.set(c,0,0,0);for(var b=0;b<a.length;b++)e.vec3.add(c,c,a[b]);e.vec3.scale(c,c,1/a.length)}function y(a,
b,f){return Math.sin(a/e.vec3.length(b))*(f+c.earthRadius)}function w(c,b,f,g){f=a.ray.fromScreenAtEye(b,f,na);a.sphere.closestPointOnSilhouette(c,f,P);return a.sphere.intersectRay(c,f,g)?e.vec3.squaredDistance(P,f.origin)<e.vec3.squaredDistance(g,f.origin)?(e.vec3.copy(g,P),!1):!0:(e.vec3.subtract(O,b.eye,b.center),e.vec3.normalize(O,O),a.plane.fromNormalAndOffset(O,-e.vec3.dot(e.vec3.normalize(O,O),P),U),a.plane.intersectRay(U,f,g),!1)}function m(a,c,b,f,g,k){e.vec3.cross(aa,a,c);e.vec3.subtract(ea,
a,c);e.vec3.length(a)<=g||!f.aboveGround?(e.vec3.cross(b,ea,f.eye),a=e.vec3.dot(a,c)/(e.vec3.length(a)*e.vec3.length(c)),k=Math.cos(h.clamp(h.cyclicalPI.normalize(h.deg2rad(k)),0,d.TiltThresholdPanningSpeed)),c=-h.acos(a)-Math.max(0,e.vec3.length(c)-g)/(k*g)):(e.vec3.subtract(N,f.eye,f.center),e.vec3.cross(b,ea,N),c=-e.vec3.length(ea)/g);e.vec3.normalize(b,b);e.vec3.scale(b,b,e.vec3.length(aa));return c}function x(a,c,b,e){e=Math.cos(h.clamp(h.cyclicalPI.normalize(h.deg2rad(e)),0,d.TiltThresholdPanningSpeed));
c=c>b?-(c-b)/(e*b):c<-b?Math.PI-(c+b)/(e*b):h.acos(c/b);return((a>b?-(a-b)/(e*b):a<-b?Math.PI-(a+b)/(e*b):h.acos(a/b))-c)*b}function A(a,c,f,g,d,h,k,m,p,n){p=x(a[2],c[2],k.radius,p);c=n?x(a[0],c[0],k.radius,180):c[0]-a[0];a=Math.sin(m)*c-Math.cos(m)*p;m=Math.cos(m)*c+Math.sin(m)*p;e.vec3.normalize(ha,d);d=n?a/Math.sqrt(Math.abs(Math.pow(k.radius,2)-Math.pow(e.vec3.dot(f,ha),2))):a/k.radius;f=m/Math.sqrt(Math.abs(Math.pow(k.radius,2)-Math.pow(e.vec3.dot(f,g),2)));b.vec2.set(h,d,f)}function C(a,c,b,
f,g,d,h,k,m,p){e.vec3.cross(aa,a,c);n.coordinateSystemFromOneAxisAndNormalVector(d.up,d.eye,R,T,W);n.coordinateSystemFromOneAxisAndNormalVector([0,0,1],d.eye,V,X,J);e.vec3.copy(b,X);e.vec3.copy(f,V);e.vec3.normalize(b,b);e.vec3.scale(b,b,e.vec3.length(aa));n.vectorCoordinates(a,e.vec3.normalize(T,T),e.vec3.normalize(W,W),e.vec3.normalize(R,R),Z);n.vectorCoordinates(c,T,W,R,fa);A(Z,fa,a,V,X,g,h,k,m,p)}function B(a,c,b,f,d,h,k){g.mat4.identity(ia);g.mat4.identity(ka);g.mat4.identity(da);g.mat4.rotate(ia,
ia,d,f);g.mat4.rotate(ka,ka,k,h);g.mat4.multiply(da,ia,ka);e.vec3.subtract(c,a,b);e.vec3.transformMat4(c,c,da);e.vec3.add(c,c,b)}function E(a,c,b,f,d,h){g.mat4.identity(ia);g.mat4.identity(ka);g.mat4.identity(da);g.mat4.rotate(ia,ia,f,b);g.mat4.rotate(ka,ka,h,d);g.mat4.multiply(da,ia,ka);e.vec3.subtract(a.eye,a.eye,c);e.vec3.transformMat4(a.eye,a.eye,da);e.vec3.add(a.eye,a.eye,c);e.vec3.subtract(a.center,a.center,c);e.vec3.transformMat4(a.center,a.center,da);e.vec3.add(a.center,a.center,c);e.vec3.subtract(a.up,
a.up,c);e.vec3.transformMat4(a.up,a.up,da);e.vec3.add(a.up,a.up,c);a.markViewDirty()}function I(a,c,b,e,f,g,h,k){void 0===h&&(h=d.PreservingHeadingThreshold.Pole);void 0===k&&(k=d.PreservingHeadingThreshold.Angle);a=Math.abs(a[2])<b*h||Math.abs(c)>b;return(Math.abs(e)>Math.PI-k||Math.abs(e)<k)&&a&&g.aboveGround&&f<d.PreservingHeadingThreshold.Tilt?!0:!1}function G(c,b,e,f,g,d){d?(a.axisAngle.fromPoints(e,f,ja),v(b,c.center,ja)):(e=m(e,f,qa,b,c.radius,g),v(b,c.center,a.axisAngle.wrapAxisAngle(qa,e)))}
function L(a,c,b,f,g,d,h){var k=h?20:1;e.vec3.copy(Y,f);ma.copyFrom(c);for(var m,p=0;p<k&&1E-12<e.vec3.squaredDistance(b,Y);p++)if(f=e.vec3.squaredDistance(b,Y),C(b,Y,X,V,ga,ma,a,g,d,h),E(ma,a.center,V,ga[1],X,ga[0]),B(Y,Y,a.center,V,ga[1],X,ga[0]),m=e.vec3.squaredDistance(b,Y),m<f||0===p)c.copyFrom(ma);else break}Object.defineProperty(d,"__esModule",{value:!0});d.Earth=a.sphere.fromValues(c.earthRadius,k.vec3f64.create());d.normalizeCoordinate=function(a,c,b){b[0]=c[0]/(a.fullWidth/a.pixelRatio);
b[1]=c[1]/(a.fullHeight/a.pixelRatio);return b};d.rotationFromPointsAroundAxis=function(a,c,b){var f=p.sv3d.get(),g=p.sv3d.get(),d=p.sv3d.get();e.vec3.copy(g,a);e.vec3.copy(d,c);a=e.vec3.dot(g,b);c=e.vec3.dot(d,b);e.vec3.scale(f,b,a);e.vec3.subtract(g,g,f);e.vec3.normalize(g,g);e.vec3.scale(f,b,c);e.vec3.subtract(d,d,f);e.vec3.normalize(d,d);a=e.vec3.dot(g,d);e.vec3.cross(f,b,g);b=e.vec3.dot(d,f);return Math.atan2(b,a)};d.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=
2*Math.PI;return a};d.applyRotation=v;d.intersectPlaneFromScreenPoint=function(c,b,e,f){return a.plane.intersectRay(c,a.ray.fromScreen(b,e,na),f)};d.applyZoomToPoint=function(a,c,b,f){var g=p.sv3d.get();b=1-b;e.vec3.subtract(g,c,a.eye);var d=e.vec3.length(g),h=d*(1-b);0<=b&&h<f&&(h=f,b=-(h-d)/d);1E-6>Math.abs(d-h)||(e.vec3.scale(g,g,b),e.vec3.add(a.eye,a.eye,g),e.vec3.lerp(a.center,a.center,c,b))};d.applyZoomOnSphere=function(c,b,f){b.getScreenCenter(F);a.sphere.intersectScreen(c,b,F,b.center);b.markViewDirty();
c=b.distance;f*=c;1E-6>Math.abs(c-f)||(f=e.vec3.scale(p.sv3d.get(),b.viewForward,f),e.vec3.subtract(b.eye,b.center,f),b.markViewDirty())};var F=q.createScreenPointArray();d.centroidOnSphere=function(a,c,b){r(c,b);e.vec3.normalize(b,b);e.vec3.scale(b,b,a)};d.centroid=r;d.onSurfaceTiltToEyeTiltGlobal=y;d.offSurfaceTiltToEyeTiltGlobal=function(a,c,b){return y(Math.PI/2,c,b)+(a-Math.PI/2)};var K;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(K=d.PanMode||(d.PanMode={}));d.VerticalPanTresholds=
{Elevation:3E4,Angle:h.deg2rad(8)};d.PreservingHeadingThreshold={Pole:.95,Angle:h.deg2rad(18),Tilt:45};d.TiltThresholdPanningSpeed=h.deg2rad(80);d.pickPointAndInitSphere=function(c,b,f,g){var h=k.vec3f64.create(),m=a.sphere.create(),p=!0;c.intersectScreen(f,h)?m.radius=e.vec3.length(h):(m.radius=b.aboveGround?Math.max(e.vec3.length(b.center),.9*d.Earth.radius):e.vec3.length(b.eye)-b.relativeElevation,g?w(m,b,f,h):p=a.sphere.intersectScreen(m,b,f,h));return{sphere:m,scenePickPoint:p?h:null}};d.decidePanMode=
function(a,c,b){var f=e.vec3.length(a.eye);if(Math.abs(f-d.Earth.radius)>d.VerticalPanTresholds.Elevation)return K.Horizontal;if(a.aboveGround===c.radius>f)return K.Vertical;e.vec3.subtract(M,a.eye,b);e.vec3.normalize(M,M);return Math.abs(.5*Math.PI-h.acos(e.vec3.dot(b,M)/e.vec3.length(b)))<d.VerticalPanTresholds.Angle?K.Vertical:K.Horizontal};var M=k.vec3f64.create();d.applyPanPlanar=function(a,c,b){e.vec3.subtract(Q,b,c);e.vec3.subtract(a.eye,a.eye,Q);e.vec3.subtract(a.center,a.center,Q);a.markViewDirty()};
var Q=k.vec3f64.create();d.sphereOrPlanePointFromScreenPoint=w;var P=k.vec3f64.create(),O=k.vec3f64.create(),U=a.plane.create();d.rotationAngleAndAxisDirectRotation=m;var N=k.vec3f64.create();d.lengthFromPoints=x;d.rotationAnglesHeadingPreserving=A;d.rotationAnglesAndAxesHeadingPreserving=C;d.rotatePointAroundTwoAxes=B;d.applyRotationWithTwoAxes=E;d.preserveHeadingThreshold=I;d.applyPanSphericalDirectRotation=G;d.applyPanSphericalPreserveHeading=L;d.panToPosition=function(a,c,b,f,g,k,m){I(b,e.vec3.dot(c.up,
b),a.radius,-h.cyclicalPI.normalize(h.deg2rad(g)),k,c,d.PreservingHeadingThreshold.Pole,d.PreservingHeadingThreshold.Angle)?L(a,c,b,f,-h.cyclicalPI.normalize(h.deg2rad(g)),k,m):G(a,c,b,f,k,m)};d.panMotionToRotationMatrix=function(a,c,b,f,d,k,m,l,r){if(I(a.center,e.vec3.dot(a.up,a.center),e.vec3.length(a.center),-h.cyclicalPI.normalize(h.deg2rad(k)),m,c))switch(a=-h.cyclicalPI.normalize(h.deg2rad(d)),n.coordinateSystemFromOneAxisAndNormalVector([0,0,1],c.eye,V,X,J),d=b.translation[0]*f.pan,k=b.translation[1]*
f.pan,c=Math.max(Math.sqrt(Math.abs(1-Math.pow(e.vec3.dot(c.center,V),2)/Math.pow(e.vec3.length(c.center),2))),.5),m=-Math.cos(a)*k+Math.sin(a)*d,g.mat4.rotate(l.pan.matrix,l.pan.matrix,(Math.sin(a)*k+Math.cos(a)*d)/c,V),l.pan.enabled=!0,r.mode){case "pan":g.mat4.rotate(l.pan.matrix,l.pan.matrix,m,X);l.pan.enabled=!0;break;case "zoom":l.zoom=-b.translation[1]*f.zoom}else switch(a=c.eye,c=c.viewRight,a=e.vec3.cross(p.sv3d.get(),c,a),d=b.translation[0]*f.pan,0!==d&&(g.mat4.rotate(l.pan.matrix,l.pan.matrix,
-d,a),l.pan.enabled=!0),r.mode){case "pan":b=b.translation[1]*f.pan;0!==b&&(g.mat4.rotate(l.pan.matrix,l.pan.matrix,b,c),l.pan.enabled=!0);break;case "zoom":l.zoom=-b.translation[1]*f.zoom}};var V=k.vec3f64.create(),X=k.vec3f64.create(),J=k.vec3f64.create(),R=k.vec3f64.create(),T=k.vec3f64.create(),W=k.vec3f64.create(),Z=k.vec3f64.create(),fa=k.vec3f64.create(),ga=f.vec2f64.create(),ja=a.axisAngle.create(),ia=l.mat4f64.create(),ka=l.mat4f64.create(),da=l.mat4f64.create(),Y=k.vec3f64.create(),ha=k.vec3f64.create(),
ea=k.vec3f64.create(),ma=new u,aa=k.vec3f64.create(),qa=k.vec3f64.create(),na={origin:k.vec3f64.create(),direction:k.vec3f64.create()}})},"esri/views/3d/support/geometryUtils/coordinateSystem":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(t,d,q,g,l){function b(a){return{operations:a,value:a.create()}}function f(a,c,b,e){return a.operations.setAltitudeAt(a.value,c,b,e)}Object.defineProperty(d,
"__esModule",{value:!0});d.create=function(a){var c=a.operations;return{operations:c,value:c.create(a.value)}};d.setExtent=function(a,c,b){a.operations.setExtent(a.value,c,b.value);return b};d.createFromOperations=b;d.fromValues=function(a,c,e){void 0===e&&(e=b(a));e.operations=a;a.copy(c,e.value);return e};d.wrap=function(a,c){k.operations=a;k.value=c;return k};d.normalAt=function(a,c,b){return a.operations.axisAt(a.value,c,2,b)};d.axisAt=function(a,c,b,e){return a.operations.axisAt(a.value,c,b,
e)};d.intersectRay=function(a,c,b){return a.operations.intersectRay(a.value,c,b)};d.intersectsRay=function(a,c){return a.operations.intersectRay(a.value,c,null)};d.closestPoint=function(a,c,b){return a.operations.closestPoint(a.value,c,b)};d.intersectRayClosestSilhouette=function(a,c,b){return a.operations.intersectRayClosestSilhouette(a.value,c,b)};d.closestPointOnSilhouette=function(a,c,b){return a.operations.closestPointOnSilhouette(a.value,c,b)};d.distanceToSilhouette=function(a,c){return a.operations.distanceToSilhouette(a.value,
c)};d.altitudeAt=function(a,c){return a.operations.altitudeAt(a.value,c)};d.setAltitudeAt=f;d.setAltitudeOfTransformation=function(a,c,b,d){c!==d&&q.mat4.copy(d,c);g.vec3.set(e,d[12],d[13],d[14]);f(a,e,b,e);d[12]=e[0];d[13]=e[1];d[14]=e[2];return d};d.elevate=function(a,c,b){return a.operations.elevate(a.value,c,b.value)};var e=l.vec3f64.create(),k={operations:null,value:null};d.vectorCoordinates=function(a,c,b,e,f){f[0]=g.vec3.dot(a,c);f[1]=g.vec3.dot(a,b);f[2]=g.vec3.dot(a,e);return f};d.coordinateSystemFromOneAxisAndNormalVector=
function(a,b,e,f,d){g.vec3.copy(e,a);g.vec3.copy(c,b);g.vec3.normalize(c,c);g.vec3.cross(f,c,e);g.vec3.cross(d,f,e)};var c=l.vec3f64.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,"__esModule",{value:!0});t=function(c){function a(a,b){var f=c.call(this,a.state,a.sceneIntersectionHelper,"interaction"===b?null:void 0)||this;f.view=a;f.mode=b;f.zoomLocation=l.vec3f64.create();f.tmpCamera=new e;f.tmpRayDir=l.vec3f64.create();f.tmpCenter=l.vec3f64.create();f.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new e,interactionDirection:null,tiltMode:0};return f}q(a,c);Object.defineProperty(a.prototype,
"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});a.prototype.zoomStep=function(a,c){if(this.active){var b=this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(b.camera):this.animation.cameraAt(1,e);this.tmpCamera.copyFrom(b.camera);0<a?(this.intersectionHelper.intersectScreenFreePointFallback(c,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.tmpCenter)&&(this.tmpCamera.center=
this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:g.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,c);this.begin(this.tmpCamera)}};a.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:k.outExpo}};a.prototype.updateCamera=function(a,c,e,f){g.vec3.subtract(this.tmpRayDir,e,a.eye);f=g.vec3.length(this.tmpRayDir);var d=f*c;1>=c&&
4>d&&(d=4,c=d/f);1E-6>Math.abs(f-d)||(g.vec3.scale(this.tmpRayDir,this.tmpRayDir,c),g.vec3.subtract(a.eye,e,this.tmpRayDir),g.vec3.lerp(a.center,a.center,e,1-c),b.applyAll(this.view,a,this.constraintOptions))};return a}(f.PointToPointAnimationController);d.ZoomStepController=t})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.eventMatchesPointerAction=function(d,g){switch(g){case "primary":return"touch"===
d.pointerType||0===d.button;case "secondary":return"touch"!==d.pointerType&&2===d.button;case "tertiary":return"touch"!==d.pointerType&&1===d.button}};d.eventMatchesMousePointerAction=function(d,g){if("touch"===d.pointerType)return!1;switch(g){case "primary":return 0===d.button;case "secondary":return 2===d.button;case "tertiary":return 1===d.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function e(c,a,e,f){var g=b.call(this,!0)||this;g.view=c;g.pointerAction=a;g.pivotPoint=e;g.registerIncoming("drag",f,function(a){return g.handleDrag(a)});return g}q(e,b);e.prototype.handleDrag=function(c){var a=c.data;if(!(1<a.pointers.size)&&f.eventMatchesMousePointerAction(c.data,this.pointerAction)){var b=g.createScreenPointArray(a.center.x,a.center.y);switch(a.action){case "start":this.cameraController&&(this.cameraController.end(),
this.cameraController=null);this.cameraController=new l.RotateController(this.view,this.view.sceneIntersectionHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(b);break;case "update":this.cameraController&&this.cameraController.update(b);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}c.stopPropagation()}};return e}(b.InputHandler);d.DragRotate=t})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../../support/mathUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function h(a,c,b){var e=d.call(this)||this;e.view=a;e.intersectionHelper=c;e.pivot=b;e.lastPoint=f.vec2f64.create();e.tmpWorldUp=k.vec3f64.create();e.tmpViewDir=k.vec3f64.create();e.tmpRotCurPoint=f.vec2f64.create();e.tmpTransf=l.mat4f64.create();e.tmpAxis=k.vec3f64.create();e.pivotPos=k.vec3f64.create();e.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};e.rotScale="center"===b?3:1.5;return e}q(h,d);h.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":e.vec3.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||e.vec3.copy(this.pivotPos,this.beginCamera.center),this.beginCamera.center=
this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;p.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};h.prototype.update=function(a){if(this.active){var b;switch(this.pivot){case "eye":b=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,b=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,b,this.pivotPos);c.applyAll(this.view,
this.currentCamera,this.constraintOptions)}};h.prototype.end=function(){this.active&&this.finishController()};h.prototype.applyRotation=function(c,f,d,h){this.view.renderCoordsHelper.worldUpAtPosition(h,this.tmpWorldUp);p.normalizeCoordinate(c,f,this.tmpRotCurPoint);f=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;var k=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;e.vec3.subtract(this.tmpViewDir,d,h);var m=e.vec3.length(this.tmpViewDir),m=n.acos(e.vec3.dot(this.tmpViewDir,this.tmpWorldUp)/
m);if("eye"===this.pivot){var l=.5*Math.PI-m,r=.495*Math.PI;f=l-Math.max(-r,Math.min(r,l+-.5*f))}f=n.clamp(f+m,a.TiltDefault.min,a.TiltDefault.max)-m;g.mat4.identity(this.tmpTransf);e.vec3.cross(this.tmpAxis,c.up,this.tmpViewDir);"center"===this.pivot&&(k=-k);g.mat4.rotate(this.tmpTransf,this.tmpTransf,k,this.tmpWorldUp);g.mat4.rotate(this.tmpTransf,this.tmpTransf,f,this.tmpAxis);e.vec3.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);e.vec3.add(d,h,this.tmpViewDir);e.vec3.transformMat4(c.up,
c.up,this.tmpTransf);b.vec2.copy(this.lastPoint,this.tmpRotCurPoint);c.markViewDirty()};return h}(h.InteractiveController);d.RotateController=t})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function f(){var e=null!==b&&b.apply(this,arguments)||this;e.beginCamera=new l;
e.currentCamera=new l;return e}q(f,b);Object.defineProperty(f.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});f.prototype.stepController=function(e,f){b.prototype.stepController.call(this,e,f);f.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(f)};f.prototype.onControllerStart=function(e){b.prototype.onControllerStart.call(this,e);this.beginCamera.copyFrom(e);this.currentCamera.copyFrom(e)};f.prototype.onControllerEnd=function(e){e.copyViewFrom(this.currentCamera);
b.prototype.onControllerEnd.call(this,e)};return f}(g.CameraController);d.InteractiveController=t})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(f){function c(a,
c,b){var e=f.call(this,!0)||this;e.view=a;e.pointerAction=c;e.registerIncoming("drag",b,function(a){return e.handleDrag(a)});return e}q(c,f);c.prototype.handleDrag=function(a){var c=a.data;if(!(1<c.pointers.size)&&e.eventMatchesMousePointerAction(a.data,this.pointerAction)){var f=g.createScreenPointArray(c.center.x,c.center.y);switch(c.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=this.view.state.isGlobal?new l.ZoomController(this.view,
this.view.sceneIntersectionHelper):new b.ZoomController(this.view,this.view.sceneIntersectionHelper);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(f);break;case "update":this.cameraController&&this.cameraController.update(f);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}a.stopPropagation()}};return c}(f.InputHandler);d.DragZoom=t})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){Object.defineProperty(d,"__esModule",{value:!0});t=function(c){function d(a,f){var d=c.call(this)||this;d.view=a;d.intersectionHelper=f;d.pickPoint=e.vec3f64.create();d.tmpP0=b.vec2f64.create();d.panAxisAngle=h.axisAngle.create();d.tmpRayDir=e.vec3f64.create();d.targetOnSphere=e.vec3f64.create();d.dragBeginPoint=g.createScreenPointArray();d.normalizedAnchorPoint=b.vec2f64.create();d.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};d.sphere=h.sphere.create();d.hasPickPoint=!1;return d}q(d,c);d.prototype.begin=function(c){this.active&&(l.vec2.copy(this.dragBeginPoint,c),a.normalizeCoordinate(this.beginCamera,c,this.normalizedAnchorPoint),c=a.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,c,!1),this.hasPickPoint=!!c.scenePickPoint,this.pickPoint=c.scenePickPoint,this.sphere=c.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};d.prototype.update=function(c){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;f.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var b=f.vec3.length(this.tmpRayDir);a.normalizeCoordinate(this.currentCamera,c,this.tmpP0);var e=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),g=b*Math.pow(2,e),d=this.view.state.constraints.minimumPoiDistance;0>e&&g<d&&(g=d);1E-6>Math.abs(b-g)||(this.hasPickPoint&&g<b&&(e=1-(1-g/b)*(1-this.sphere.radius/
f.vec3.length(this.currentCamera.center)),f.vec3.scale(this.currentCamera.center,this.currentCamera.center,e)),f.vec3.scale(this.tmpRayDir,this.tmpRayDir,-g/b),f.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(this.dragBeginPoint,c),k.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(a.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,
this.targetOnSphere),h.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),a.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),k.applySurfaceCollision(this.view,this.currentCamera))}};d.prototype.end=function(){this.active&&this.finishController()};return d}(c.InteractiveController);d.ZoomController=t})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){Object.defineProperty(d,"__esModule",{value:!0});t=function(c){function d(a,f){var d=c.call(this)||this;d.view=a;d.intersectionHelper=f;d.tmpP=e.vec3f64.create();d.tmpN=e.vec3f64.create();d.tmpP0=b.vec2f64.create();d.tmpPoi=e.vec3f64.create();d.tmpRayDir=e.vec3f64.create();d.dragBeginPoint=g.createScreenPointArray();d.normalizedAnchorPoint=b.vec2f64.create();d.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:e.vec3f64.create(),
tiltMode:0};d.plane=h.plane.create();return d}q(d,c);d.prototype.begin=function(c){this.active&&(l.vec2.copy(this.dragBeginPoint,c),a.normalizeCoordinate(this.beginCamera,c,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(c,this.tmpP),f.vec3.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center),f.vec3.normalize(this.tmpN,this.tmpN),0>this.tmpN[1]&&f.vec3.negate(this.tmpN,this.tmpN),h.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)};d.prototype.update=function(c){if(this.active){a.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||f.vec3.copy(this.tmpPoi,this.currentCamera.center);a.normalizeCoordinate(this.currentCamera,c,this.tmpP0);var b=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);l.vec2.copy(this.normalizedAnchorPoint,this.tmpP0);f.vec3.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var e=f.vec3.length(this.tmpRayDir),g=e*(1-b);f.vec3.copy(this.constraintOptions.interactionDirection,
this.tmpRayDir);f.vec3.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,p.sign(b)/e);var d=this.view.state.constraints.minimumPoiDistance;0<=b&&g<d&&(g=d,b=-(g-e)/e);1E-6>Math.abs(e-g)||(f.vec3.scale(this.tmpRayDir,this.tmpRayDir,b),f.vec3.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),f.vec3.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,b),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?
Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(this.dragBeginPoint,c),k.applyAll(this.view,this.currentCamera,this.constraintOptions))}};d.prototype.end=function(){this.active&&this.finishController()};return d}(c.InteractiveController);d.ZoomController=t})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});t=function(e){function f(c,a){var b=e.call(this,!0)||this;b.view=c;b.watchHandles=new g;b.handle=b.registerIncoming("gamepad",function(a){return b.handleEventGamepad(a)});b.handle.pause();return b}q(f,e);f.prototype.onInstall=function(c){var a=this;e.prototype.onInstall.call(this,c);this.watchHandles.add([l.init(this.view.navigation.gamepad,"enabled",function(c){c?a.handle.resume():(a.handle.pause(),a.cameraControllerGamepad&&
(a.cameraControllerGamepad.finishController(),a.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",function(c){a.cameraControllerGamepad&&c&&a.cameraControllerGamepad.gamepadDevice!==c&&(a.cameraControllerGamepad.finishController(),a.cameraControllerGamepad=null)})])};f.prototype.onUninstall=function(){this.watchHandles.removeAll();e.prototype.onUninstall.call(this)};f.prototype.handleEventGamepad=function(c){var a=this.view.navigation.gamepad.device;if(!a||c.data.device===
a)if((a=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||b.GamepadKeyboardController.activatesFor(this.view,c.data))a||(a=new b.GamepadKeyboardController(this.view,c.data.device),this.view.state.switchCameraController(a)&&(this.cameraControllerGamepad=a)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===c.data.device&&this.cameraControllerGamepad.handleEventGamepad(c.data)};return f}(f.InputHandler);d.GamepadNavigation=
t})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A){Object.defineProperty(d,"__esModule",{value:!0});t=function(a){function b(c,b,e){var f=a.call(this)||this;f.view=c;f.gamepadDevice=b;f.disableMovements=e;f.transformation={translation:[0,0,0],heading:0,tilt:0};f.keysButtonState=[0,0,0,0,0,0,0,0,0,0];f.tmpCamera=new x;f.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new x,interactionFactor:0,interactionDirection:null,tiltMode:1};return f}q(b,a);b.prototype.handleEventGamepad=
function(a){var c=A.extractTransformation(a,this.view.navigation.gamepad,this.transformation);("end"===a.action||A.isZeroTransformation(c))&&this.finishController()};b.prototype.activateDirection=function(a){this.keysButtonState[a]=1;A.extractTransformationKeyboard(this.keysButtonState,this.transformation)};b.prototype.deactivateDirection=function(a){this.keysButtonState[a]=0;a=A.extractTransformationKeyboard(this.keysButtonState,this.transformation);A.isZeroTransformation(a)&&this.finishController()};
b.prototype.onControllerStart=function(c){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;a.prototype.onControllerStart.call(this,c)};b.prototype.updateFilteredSurfaceElevation=function(a){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*a};b.prototype.stepController=function(c,b){this.updateStartHeading();this.updateFilteredSurfaceElevation(c);this.currentCamera.copyViewFrom(b);
this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this.calculateControlTransformation(c,this.currentCamera,K);this.applyDisabledMovementTypes(K);this.applyPan(K.pan);this.applyRotate(K.rotate);this.applyZoom(K.zoom);this.applyAscend(K.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;k.applyAll(this.view,this.currentCamera,this.constraintOptions);a.prototype.stepController.call(this,c,b)};b.prototype.updateStartHeading=
function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};b.prototype.applyRotate=function(a){if(a.enabled){var c=this.currentCamera,b=c.center,e=c.up,g=c.eye;f.vec3.subtract(b,b,g);f.vec3.transformMat4(b,b,a.matrix);f.vec3.add(b,b,g);f.vec3.transformMat4(e,e,a.matrix);c.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;k.applyAll(this.view,c,this.constraintOptions)}};b.prototype.applyPan=function(a,c){void 0===c&&(c=this.currentCamera);
if(a.enabled){var b=c.center,e=c.eye,g=c.up;f.vec3.transformMat4(e,e,a.matrix);f.vec3.transformMat4(b,b,a.matrix);this.view.state.isGlobal&&f.vec3.transformMat4(g,g,a.matrix);c.markViewDirty();this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;k.applyAll(this.view,c,this.constraintOptions)}};b.prototype.applyZoom=function(a){if(a){var c=this.currentCamera,b=c.eye,c=c.viewForward;f.vec3.add(b,b,f.vec3.scale(m.sv3d.get(),c,a));this.currentCamera.markViewDirty();f.vec3.copy(M,
c);f.vec3.negate(M,M);this.constraintOptions.interactionDirection=M;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;k.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};b.prototype.applyAscend=function(a){if(a){var c=this.currentCamera,b=c.center,c=c.eye,e=this.view.renderCoordsHelper.worldUpAtPosition(c,m.sv3d.get());this.constraintOptions.interactionDirection=f.vec3.copy(M,e);this.view.state.isGlobal?(e=f.vec3.length(c),
a=(e+a)/e,f.vec3.scale(c,c,a),f.vec3.scale(b,b,a)):(a=f.vec3.scale(m.sv3d.get(),e,a),f.vec3.add(c,c,a),f.vec3.add(b,b,a));this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=8;k.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;k.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};b.prototype.calculateControlTransformation=
function(a,c,b){b.zoom=0;b.ascend=0;b.pan.enabled=!1;l.mat4.identity(b.pan.matrix);b.rotate.enabled=!1;l.mat4.identity(b.rotate.matrix);a=this.computeVelocities(a);this.view.state.isLocal?this.calculateControlTransformationLocal(a,c,b):this.calculateControlTransformationGlobal(a,c,b)};b.prototype.updateCameraCenter=function(){var a=this.currentCamera;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(a.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a.center);
this.currentCamera.markViewDirty()};b.prototype.calculateControlTransformationLocal=function(a,b,e){var d=b.viewRight,h=b.viewForward,k=this.transformation,p=this.view.navigation.gamepad,h=f.vec3.set(m.sv3d.get(),h[0],h[1],0);f.vec3.normalize(h,h);var r=k.translation[0]*a.pan;0!==r&&(r=f.vec3.scale(m.sv3d.get(),d,r),l.mat4.translate(e.pan.matrix,e.pan.matrix,r),e.pan.enabled=!0);switch(p.mode){case "pan":p=-k.translation[1]*a.pan;0!==p&&(p=f.vec3.scale(m.sv3d.get(),h,p),l.mat4.translate(e.pan.matrix,
e.pan.matrix,p),e.pan.enabled=!0);break;case "zoom":e.zoom=-k.translation[1]*a.zoom;break;default:g.neverReached(p.mode)}e.ascend=k.translation[2]*a.ascend;p=-k.heading*a.rotate;0!==p&&(l.mat4.rotate(e.rotate.matrix,e.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(b.eye,m.sv3d.get())),e.rotate.enabled=!0);a=k.tilt*a.rotate;b=n.viewAngle(this.view.renderCoordsHelper,b.center,b.eye);if(b=w.clamp(b+a,c.TiltDefault.min,c.TiltDefault.max)-b)l.mat4.rotate(e.rotate.matrix,e.rotate.matrix,
b,d),e.rotate.enabled=!0};b.prototype.calculateControlTransformationGlobal=function(a,c,b){var e=c.eye,g=c.viewRight,d=this.transformation,k=this.view.navigation.gamepad,e=f.vec3.cross(m.sv3d.get(),g,e);f.vec3.normalize(e,e);f.vec3.negate(e,e);h.panMotionToRotationMatrix(this.beginCamera,c,d,a,this.view.camera.heading,this.headingStart,this.view.camera.tilt,b,k);this.tmpCamera.copyFrom(this.currentCamera);this.applyPan(K.pan,this.tmpCamera);k=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;
b.ascend=d.translation[2]*a.ascend;e=-d.heading*a.rotate;0!==e&&(l.mat4.rotate(b.rotate.matrix,b.rotate.matrix,e,this.tmpCamera.eye),b.rotate.enabled=!0);a=this.clampTiltDeltaGlobalToValidRange(d.tilt*a.rotate,c.ray,k);0!==a&&(l.mat4.rotate(b.rotate.matrix,b.rotate.matrix,a,this.tmpCamera.viewRight),b.rotate.enabled=!0)};b.prototype.clampTiltDeltaGlobalToValidRange=function(a,b,e){var g=p.onSurfaceTiltToEyeTiltGlobal(c.TiltDefault.min,b.origin,e),d=0,h=0,d=m.sv3d.get();this.view.renderCoordsHelper.intersectManifold(b,
e,d)?(d=n.viewAngle(this.view.renderCoordsHelper,d,b.origin),d=p.onSurfaceTiltToEyeTiltGlobal(d,b.origin,e),h=p.onSurfaceTiltToEyeTiltGlobal(c.TiltDefault.max,b.origin,e)):(y.sphere.closestPointOnSilhouette(y.sphere.wrap(e+r.earthRadius),b,d),d=w.acos(-f.vec3.dot(b.direction,f.vec3.normalize(d,d))),d=p.offSurfaceTiltToEyeTiltGlobal(d,b.origin,e),h=p.offSurfaceTiltToEyeTiltGlobal(c.TiltDefault.max,b.origin,e));return w.clamp(d+a,g,h)-d};b.prototype.getPointAbsoluteSurfaceElevation=function(a,c,b){var e=
this.view.renderCoordsHelper,g=e.getAltitude(a);c+=Math.abs(g-c);f.vec3.copy(b,a);e.setAltitude(c,b);return c};b.prototype.clampedDistanceToSurface=function(a,c){var b=this.view.renderCoordsHelper,e=this.view.state.camera,g=u.headingTiltToDirectionUp(this.view,c,0,B,Q).direction,g=b.intersectManifoldClosestSilhouette(y.ray.wrap(c,g),a,m.sv3d.get()),g=f.vec3.distance(c,g);a=b.intersectManifoldClosestSilhouette(y.ray.wrap(c,w.directionFromTo(m.sv3d.get(),c,e.center)),a,m.sv3d.get());c=f.vec3.distance(c,
a);return Math.min(g,c)};b.prototype.computeHeadingRotateRadius=function(a){var c=this.view,b=c.renderCoordsHelper,e=c.state,c=e.isGlobal,e=b.intersectManifoldClosestSilhouette(e.camera.ray,this.filteredSurfaceElevation,m.sv3d.get());if(c)return c=f.vec3.subtract(m.sv3d.get(),a,e),b=f.vec3.length(c),f.vec3.scale(c,c,1/b),a=f.vec3.normalize(m.sv3d.get(),a),a=w.acos(f.vec3.dot(a,c)),b*Math.sin(Math.min(E,a));a=f.vec3.copy(m.sv3d.get(),a);b.setAltitude(this.filteredSurfaceElevation,a);return f.vec3.distance(e,
a)};b.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:G};b.prototype.computeVelocities=function(a){var c=this.filteredSurfaceElevation,b=c+r.earthRadius,e=this.view.state,f=e.camera,g=e.isGlobal,d=m.sv3d.get(),h=this.getPointAbsoluteSurfaceElevation(f.eye,c,d),k=this.clampedDistanceToSurface(c,d),p=f.width/2,n=I*f.width,e=I*f.width,f=k*Math.tan(.5*f.fovX)/p,l=f/b,b=f/this.computeHeadingRotateRadius(d),g=(g?l:f)*n*a,c=h-c,c=Math.max(this.minimumAscendVelocity()*
a,Math.pow(2,n*a/p)*c-c),k=Math.pow(2,n*a/p)*k-k;a*=w.clamp(b*e,L,F);return{pan:g,ascend:c,zoom:k,rotate:a}};b.prototype.applyDisabledMovementTypes=function(a){void 0===this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.mode!==this.disableMovements.mode||(a.zoom=this.disableMovements.zoom?0:a.zoom,a.ascend=this.disableMovements.ascend?0:a.ascend,a.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&l.mat4.identity(a.pan.matrix),a.rotate.enabled=!this.disableMovements.rotate,
this.disableMovements.rotate&&l.mat4.identity(a.rotate.matrix))};b.activatesFor=function(a,c){a=A.extractTransformation(c,a.navigation.gamepad,C);return!("end"===c.action||A.isZeroTransformation(a))};return b}(a.InteractiveController);d.GamepadKeyboardController=t;var C={translation:[0,0,0],heading:0,tilt:0},B=80,E=w.deg2rad(B),I=.75,G=5,L=w.deg2rad(30),F=w.deg2rad(80),K={zoom:0,ascend:0,pan:{enabled:!1,matrix:b.mat4f64.create()},rotate:{enabled:!1,matrix:b.mat4f64.create()}},M=e.vec3f64.create(),
Q=v.createDirectionUp()})},"esri/views/3d/support/cameraUtils":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../Camera ../../../config ../../../core/Logger ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Camera".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m){function x(a){return"global"===a.viewingMode?v:u}function A(b,f,d){var h=b.renderSpatialReference,k=e.vec3.copy(J,f.viewForward),k=I(b,f.eye,k,f.up,R);b=b.spatialReference||a.WGS84;w.vectorToVector(f.eye,h,V,b)||(b=a.WGS84,w.vectorToVector(f.eye,h,V,b));if(!d)return new g(new c(V,b),k.heading,k.tilt,y.rad2deg(f.fov));d.position.x=V[0];d.position.y=V[1];d.position.z=V[2];d.position.spatialReference=b;d.heading=k.heading;d.tilt=k.tilt;d.fov=y.rad2deg(f.fov);
return d}function C(a,c,b){var e=a.state.camera,f=e.fovX,e=e.width/2/e.pixelRatio;"global"===a.viewingMode&&null!=b&&(c*=Math.cos(y.deg2rad(b)));c/=a.renderCoordsHelper.unitInMeters;return e/(39.37*l.screenDPI/c)/Math.tan(f/2)}function B(a,c,b){var e=a.state.camera;c=39.37*l.screenDPI/(e.width/2/e.pixelRatio/(c*Math.tan(e.fovX/2)));"global"===a.viewingMode&&(c/=Math.cos(y.deg2rad(b)));return c*=a.renderCoordsHelper.unitInMeters}function E(a,c,b,e,g,d){if(U(d)){var h=f.createResolver();M(a,e.heading,
e.tilt,c,b,g,h);h.promise.then(function(c){return d.resolve(O(a,c,e.fov))})}else return c=M(a,e.heading,e.tilt,c,b,g),O(a,c,e.fov,d)}function I(a,c,b,e,f){return x(a).directionToHeadingTilt(c,b,e,f)}function G(a,c,b){return a.basemapTerrain&&a.renderCoordsHelper.fromRenderCoords(c,T,a.spatialReference)&&a.basemapTerrain.getElevation(T)>T.z-1}function L(a,c,b){return a.renderCoordsHelper.fromRenderCoords(c,T,a.spatialReference)?a.elevationProvider.queryElevation(T).then(function(a){return a>T.z-10}):
f.resolve(!1)}function F(a,b){var g=k.vec3f64.create();if(b)if(b instanceof c){if(w.pointToVector(b,g,a.renderSpatialReference),null==b.z&&null!=a.basemapTerrain)return a.elevationProvider.queryElevation(b).then(function(c){null!=c&&a.renderCoordsHelper.setAltitude(c,g);return g})}else e.vec3.copy(g,b);else e.vec3.copy(g,a.state.camera.center);return f.resolve(g)}function K(a,b){var f=k.vec3f64.create();b&&b instanceof c?(w.pointToVector(b,f,a.renderSpatialReference),null==b.z&&null!=a.basemapTerrain&&
(b=a.elevationProvider.getElevation(b),null!=b&&a.renderCoordsHelper.setAltitude(b,f))):b?e.vec3.copy(f,b):e.vec3.copy(f,a.state.camera.center);return f}function M(a,b,e,f,g,d,h){var k=f&&f instanceof c?f:null;if(U(h))F(a,f).then(function(c){Q(a,b,e,k,c,g,d,h)});else return f=K(a,f),Q(a,b,e,k,f,g,d,h)}function Q(c,b,e,f,g,d,h,m){f||(f=w.vectorToPoint(g,c.renderSpatialReference,c.spatialReference||a.WGS84));d=Math.max(d,c.state.constraints.minimumPoiDistance);var p=P(c,b,e,g,d,h),n=x(c).eyeForCenterWithHeadingTilt,
l=n(g,d,p.heading,p.tilt);if(h===Z.ADJUST&&"global"===c.viewingMode&&0<e){var r=function(){var a=d,k=d,p=c.state.constraints.tilt(k),k=x(c).eyeTiltToLookAtTilt(g,k,e),k=Math.min(k,.5*Math.PI),p=p.min*(1-fa)+k*fa,a=x(c).lookAtTiltToEyeTilt(g,a,p);h=1>e-a?Z.LOCKED:Z.ADJUST;return Q(c,b,a,f,g,d,h,m)};if(G(c,l.eye,l.tilt))return r();if(U(m)){L(c,l.eye,l.tilt).then(function(a){if(a)return r();m.resolve({eye:l.eye,up:l.up,center:k.vec3f64.clone(g),heading:l.heading,tilt:l.tilt})});return}}p={center:k.vec3f64.create(),
eye:k.vec3f64.create(),up:k.vec3f64.create(),tilt:0,heading:0};m&&!U(m)&&(p=m);p.eye=l.eye;p.up=l.up;p.center=k.vec3f64.clone(g);p.heading=l.heading;p.tilt=l.tilt;U(m)&&m.resolve(p);return p}function P(c,b,e,f,g,d){var h=0;if(d=d===Z.ADJUST)if(h=c.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(g/h)/Math.LN2)d=!0;else{var k=c.renderSpatialReference,m=c.spatialReference||a.WGS84;d=w.vectorToPoint(f,k,m);k=w.vectorToPoint(c.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,k,m);h*=
Math.tan(.5*c.state.camera.fov);d=5<k.distance(d)/h}d?(b=0,d=c.state.constraints.tilt(g),d.max=Math.min(d.max,.5*Math.PI),d=d.min*(1-fa)+d.max*fa,e=x(c).eyeTiltToLookAtTilt(f,g,e),h=Math.min(e,d)):h=x(c).eyeTiltToLookAtTilt(f,g,e);e=h=c.state.constraints.clampTilt(g,h);e=x(c).lookAtTiltToEyeTilt(f,g,e);return{heading:b,tilt:e}}function O(c,b,e,f){c=w.vectorToPoint(b.eye,c.renderSpatialReference,c.spatialReference||a.WGS84);return c?f?(f.position=c,f.heading=b.heading,f.tilt=b.tilt,f.fov=e,f):new g(c,
b.heading,b.tilt,e):null}function U(a){return a&&a.resolve&&a.reject}Object.defineProperty(d,"__esModule",{value:!0});var N=b.getLogger("esri.views.3d.support.cameraUtils"),V=k.vec3f64.create(),X=k.vec3f64.create(),J=k.vec3f64.create(),R={heading:0,tilt:0},T=new c,W=new y.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),Z;(function(a){a[a.LOCKED=0]="LOCKED";a[a.ADJUST=1]="ADJUST"})(Z=d.OrientationMode||(d.OrientationMode={}));d.headingTiltToDirectionUp=function(a,c,b,e,f){return x(a).headingTiltToDirectionUp(c,
b,e,f)};d.externalToInternal=function(a,c){var b=a.renderSpatialReference,f=x(a).headingTiltToDirectionUp,g=k.vec3f64.create();if(!w.pointToVector(c.position,g,b))return null;b=f(g,c.heading,c.tilt);e.vec3.scale(b.direction,b.direction,a.state.camera.distance);e.vec3.add(b.direction,b.direction,g);a=n.cameraOnContentAlongViewDirection(a,g,b.direction,b.up);a.fov=y.deg2rad(c.fov);return a};d.internalToExternal=A;d.scaleToDistance=C;d.distanceToScale=B;d.fromCenterScale=function(a,c,b,e,f,g){b=C(a,
b,c.latitude);return E(a,c,b,e,f,g)};d.fromCenterDistance=E;d.directionToHeadingTilt=I;d.getObserverForPointAtDistance=M;d.fromExtent=function(b,e,g,d,h,k){var m,n=0;null!=e.zmax&&null!=e.zmin&&(m=(e.zmax+e.zmin)/2,n=e.zmax-e.zmin);var l,v;if("global"===b.viewingMode){l=a.WebMercator;v=e.spatialReference||l;var u=new c(e.xmin,e.ymin,v),x=new c(e.xmax,e.ymax,v),u=p.project(u,l),x=p.project(x,l);if(null===u||null===x){U(k)&&k.reject();return}e=new c(W.center(u.x,x.x),(x.y+u.y)/2,l);null!=m&&(e.z=m);
m=r.getGreatCircleSpanAt(e,u,x);l=m.lon;v=m.lat;W.diff(u.x,x.x)>W.range/2&&(l+=r.halfEarthCircumference);l=Math.min(l,r.halfEarthCircumference);v=Math.min(v,r.halfEarthCircumference)}else u=b.spatialReference||a.WGS84,p.canProject(e,u)&&(e=p.project(e,u)),l=e.xmax-e.xmin,v=e.ymax-e.ymin,e=new c({x:e.xmin+.5*l,y:e.ymin+.5*v,z:m,spatialReference:u});m=b.state.camera;n=Math.max(1/Math.tan(m.fovX/2)*l*.5,1/Math.tan(m.fovY/2)*v*.5,1/Math.tan(m.fov/2)*n*.5)/1;if(U(k))m=f.createResolver(),M(b,g,d,e,n,h,
m),m.promise.then(function(a){return k.resolve(O(b,a,b.camera.fov))});else return g=M(b,g,d,e,n,h),O(b,g,b.camera.fov,k)};d.toExtent=function(c,b,e,f,g){b||(e||(e=c.state.camera),b=A(c,e,g));g=c.renderSpatialReference;var d;if(e)g=w.vectorToPoint(e.center,g,c.spatialReference||a.WGS84),d=e.distance;else{g=c.toMap(c.screenCenter);if(!g)return null;d=r.computeCarthesianDistance(b.position,g)}e||(e=c.state.camera);b=2*d*Math.tan(e.fovX/2)*1;e=2*d*Math.tan(e.fovY/2)*1;return"global"===c.viewingMode?v.toExtent(c,
g,b,e,f):u.toExtent(c,g,b,e,f)};var fa=.7;d.observerToCamera=O;d.scaleToZoom=function(a,c){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.levelAtScale(c);N.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};d.zoomToScale=function(a,c){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.scaleAtLevel(c);N.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};d.scaleToResolution=function(a,c){return a.spatialReference?
h.getResolutionForScale(c,a.spatialReference):void 0};d.computeScale=function(c,b,f){var g=c.renderSpatialReference;b||(b=c.state.camera);var d;d=a.WGS84;b instanceof m?(w.vectorToVector(b.center,g,X,d),d=X[1],b=b.distance):(d=b.position.latitude,w.pointToVector(b.position,V,g),w.pointToVector(f,X,g),b=e.vec3.distance(V,X));return B(c,b,d)}})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ./cameraUtilsInternal ./mathUtils ./projectionUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c){function a(a,c,b,f){void 0===f&&(f=e.createDirectionUp());q.mat4.identity(n);a=f.direction;var g=f.up;q.mat4.rotateZ(n,n,-k.deg2rad(c));q.mat4.rotateX(n,n,k.deg2rad(b));l.vec3.transformMat4(a,p,n);l.vec3.scale(a,a,-1);l.vec3.transformMat4(g,h,n);return f}Object.defineProperty(d,"__esModule",{value:!0});var h=b.vec3f64.fromValues(0,1,0),p=b.vec3f64.fromValues(0,0,1),n=g.mat4f64.create(),u=b.vec3f64.create(),v=b.vec3f64.create();d.headingTiltToDirectionUp=a;d.directionToHeadingTilt=
function(a,c,b,f){return e.directionToHeadingTilt(c,b,f,p,h)};d.eyeForCenterWithHeadingTilt=function(c,e,f,g){var d=a(c,f,g),h=b.vec3f64.create();l.vec3.scale(h,d.direction,-e);l.vec3.add(h,h,c);return{up:d.up,eye:h,heading:f,tilt:g}};d.lookAtTiltToEyeTilt=function(a,c,b){return k.rad2deg(b)};d.eyeTiltToLookAtTilt=function(a,c,b){return k.deg2rad(b)};d.toExtent=function(a,b,e,g,d){var h=a.renderSpatialReference;a=a.map&&a.spatialReference||b.spatialReference;c.pointToVector(b,u,h);c.pointToVector(b,
v,h);u[0]-=e/2;v[0]+=e/2;u[1]-=g/2;v[1]+=g/2;c.vectorToVector(u,h,u,a);c.vectorToVector(v,h,v,a);d?(d.xmin=u[0],d.ymin=u[1],d.xmax=v[0],d.ymax=v[1],d.spatialReference=a):d=new f(u[0],u[1],v[0],v[1],a);return d}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64","./mathUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=g.vec3f64.create(),f=g.vec3f64.create();
d.createDirectionUp=function(){return{direction:g.vec3f64.create(),up:g.vec3f64.create()}};d.directionToHeadingTilt=function(e,g,c,a,d){var h=b;q.vec3.normalize(h,e);var k=q.vec3.dot(h,a),u=0<k,k=Math.abs(k);.99<k&&(k=Math.abs(q.vec3.dot(g,a)),.99>k?(q.vec3.copy(h,g),u&&q.vec3.scale(h,h,-1)):h=null);g=0;h&&(q.vec3.scale(f,a,q.vec3.dot(a,h)),q.vec3.subtract(h,h,f),g=q.vec3.dot(h,d)/(q.vec3.length(h)*q.vec3.length(d)),q.vec3.cross(f,h,d),g=(0<q.vec3.dot(f,a)?1:-1)*l.rad2deg(l.acos(g)));e=l.rad2deg(l.acos(-q.vec3.dot(a,
e)/q.vec3.length(e)));if(!c)return{heading:g,tilt:e};c.heading=g;c.tilt=e;return c}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),function(t,d,q,g,l,b,f,
e,k,c,a,h){function p(a,b,e,f){void 0===f&&(f=c.createDirectionUp());l.vec3.cross(m,a,v);0===l.vec3.dot(m,m)&&l.vec3.cross(m,a,r);q.mat4.identity(w);q.mat4.rotate(w,w,-h.deg2rad(b),a);q.mat4.rotate(w,w,-h.deg2rad(e),m);b=f.up;e=f.direction;l.vec3.cross(b,m,a);l.vec3.normalize(b,b);l.vec3.transformMat4(b,b,w);l.vec3.normalize(e,a);l.vec3.negate(e,e);l.vec3.transformMat4(e,e,w);return f}function n(a){var c=a[1];a[1]=-a[2];a[2]=c}function u(a,c){c=p(c,a.heading,a.tilt);a.up=c.up;return a}Object.defineProperty(d,
"__esModule",{value:!0});var v=b.vec3f64.fromValues(0,0,1),r=l.vec3.normalize(b.vec3f64.create(),b.vec3f64.fromValues(1,1,1)),y=new h.Cyclical(-180,180),w=g.mat4f64.create(),m=b.vec3f64.create(),x=b.vec3f64.create();d.headingTiltToDirectionUp=p;d.directionToHeadingTilt=function(a,b,e,f){var g=m;l.vec3.normalize(g,a);l.vec3.cross(x,g,v);0===l.vec3.dot(x,x)&&l.vec3.cross(x,g,r);l.vec3.cross(x,x,g);return c.directionToHeadingTilt(b,e,f,g,x)};d.eyeForCenterWithHeadingTilt=function(a,c,e,f){var g={eye:b.vec3f64.create(),
up:null,tilt:f,heading:e},d=m;d[0]=a[0];d[1]=a[2];d[2]=-a[1];e=h.deg2rad(e);var k=h.deg2rad(f);f=Math.sin(e);e=Math.cos(e);var p=Math.sin(k),r=Math.cos(k),v=l.vec3.length(d);if(1E-8>Math.abs(k))k=c+v;else var x=v/p,A=h.asin(c/x),k=x*Math.sin(Math.PI-k-A);var x=p*c,r=r*c,A=e*x,y=k-r,w=y*y,C=c*c*p*p,p=e*e*C,C=f*f*C,q=d[1]*y,B=p*(p+w-d[1]*d[1]);if(0>B)return l.vec3.scale(g.eye,d,k/v),g.tilt=0,g;var E=Math.sqrt(B),B=p+w,q=0<e?-E+q:E+q;if(1E-8>Math.abs(B))return 1E-8>v?(g.eye[0]=0,g.eye[1]=0,g.eye[2]=
c):l.vec3.scale(g.eye,d,k/v),g.tilt=0,n(g.eye),u(g,a);g.eye[1]=q/B;B=g.eye[1]*g.eye[1];c=1-B;q=Math.sqrt(c);A=p*B+C-2*A*g.eye[1]*q*y+c*w;if(1E-8>Math.abs(A))return l.vec3.scale(g.eye,d,k/v),g.tilt=0,n(g.eye),u(g,a);g.eye[0]=(c*(k*d[0]-r*d[0])-x*q*(d[0]*g.eye[1]*e+d[2]*f))/A;g.eye[2]=(c*(k*d[2]-r*d[2])-x*q*(d[2]*g.eye[1]*e-d[0]*f))/A;l.vec3.scale(g.eye,g.eye,k);n(g.eye);return u(g,a)};d.lookAtTiltToEyeTilt=function(a,c,b){a=l.vec3.length(a);c=h.asin(c/(Math.sqrt(c*c+a*a-2*c*a*Math.cos(Math.PI-b))/
Math.sin(b)));return h.rad2deg(b-c)};d.eyeTiltToLookAtTilt=function(a,c,b){b=h.deg2rad(b);a=l.vec3.length(a);return h.asin(c/(a/Math.sin(b)))+b};d.toExtent=function(c,b,g,d,m){function p(a){var c=Math.PI/2;a=h.cyclical2PI.normalize(a,-c);a>c&&(a=Math.PI-a);return a}var n;n=b.latitude;b=b.longitude;var l=a.getLonDeltaForDistance(b,n,g)/2;g=b-l;b+=l;n=h.deg2rad(n);l=a.earthRadius;n=(1+Math.sin(n))/(1-Math.sin(n));var r=(n+1)*Math.tan(d/l/2);n=1.5*Math.PI-2*Math.atan(.5*(r+Math.sqrt(4*n+r*r)));d=n+d/
l;n=p(n);d=p(d);d<n&&(l=d,d=n,n=l);n=Math.max(h.rad2deg(n),-90);d=Math.min(h.rad2deg(d),90);b=y.monotonic(g,b);180<b-g&&(l=(b-g-180)/2,g+=l,b-=l);m?(m.xmin=g,m.ymin=n,m.xmax=b,m.ymax=d,m.spatialReference=e.WGS84):m=new f(g,n,b,d,e.WGS84);c.spatialReference&&c.spatialReference.isWebMercator&&k.geographicToWebMercator(m,!1,m);return m}})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["require","exports","../../core/libs/gl-matrix-2/vec3"],function(t,d,q){function g(g){var b=g*g;
0>g&&(b*=-1);return b}Object.defineProperty(d,"__esModule",{value:!0});d.quadraticAccentuation=g;d.resetTransformation=function(g){g.translation[0]=0;g.translation[1]=0;g.translation[2]=0;g.heading=0;g.tilt=0;return g};d.extractTransformation=function(d,b,f){var e=d.state;d=d.device;b="forward-down"===b.tiltDirection?1:-1;"standard"===d.deviceType?(f.translation[0]=g(e.axes[0]),f.translation[1]=g(e.axes[1]),f.translation[2]=g(e.buttons[7])-g(e.buttons[6]),f.heading=g(e.axes[2]),f.tilt=g(e.axes[3])):
"spacemouse"===d.deviceType&&(f.translation[0]=1.2*g(e.axes[0]),f.translation[1]=1.2*g(e.axes[1]),f.translation[2]=2*-g(e.axes[2]),f.heading=1.2*g(e.axes[5]),f.tilt=1.2*g(e.axes[3]));f.tilt*=b;q.vec3.scale(f.translation,f.translation,1);return f};d.extractTransformationKeyboard=function(g,b){b.translation[0]=g[1]-g[0];b.translation[1]=g[3]-g[2];b.translation[2]=g[4]-g[5];b.heading=g[7]-g[6];b.tilt=g[8]-g[9];return b};d.isZeroTransformation=function(g){return 0===g.translation[0]&&0===g.translation[1]&&
0===g.translation[2]&&0===g.heading&&0===g.tilt}})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function f(e,f,c){var a,g=b.call(this,!0)||this;g.view=e;g.disableMovements={pan:!0,zoom:!0,ascend:!0,rotate:!1,mode:"local"};g.keyToNumber=(a={},a[f.left]=
0,a[f.right]=1,a[f.forward]=2,a[f.backward]=3,a[f.up]=4,a[f.down]=5,a[f.headingLeft]=6,a[f.headingRight]=7,a[f.tiltUp]=8,a[f.tiltDown]=9,a);g.registerIncoming("key-down",c,function(a){return g.handleKeyDown(a)});g.registerIncoming("key-up",c,function(a){return g.handleKeyUp(a)});return g}q(f,b);f.prototype.handleKeyDown=function(b){if(!b.data.repeat){var e=this.keyToNumber[b.data.key];null!=e&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new g.GamepadKeyboardController(this.view,
void 0,this.disableMovements),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(e),b.stopPropagation()))}};f.prototype.handleKeyUp=function(b){var e=this.keyToNumber[b.data.key];null!=e&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(e),b.stopPropagation())};return f}(l.InputHandler);d.KeyboardNavigation=t})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});t=function(e){function f(c,a){var b=e.call(this,!0)||this;b.view=c;b.registerIncoming("mouse-wheel",a,function(a){return b.handleMouseWheel(a)});return b}q(f,e);f.prototype.handleMouseWheel=function(c){var a=c.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new l.ZoomStepController(this.view,"interaction"):new b.ZoomStepController(this.view,"interaction"),this.view.state.switchCameraController(this.cameraController));
this.cameraController.zoomStep(-1/60*a.deltaY,g.createScreenPointArray(a.x,a.y));c.stopPropagation()};return f}(f.InputHandler);d.MouseWheelZoom=t})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(t,d,q,g,l,b,f){Object.defineProperty(d,
"__esModule",{value:!0});t=function(b){function e(c,a,e){var f=b.call(this,!0)||this;f.view=c;f.pointerAction=a;f.lastEndTimestamp=0;f.lastTimestamp=0;f.registerIncoming("drag",e,function(a){return f.handleDrag(a)});return f}q(e,b);e.prototype.handleDrag=function(c){if("mouse"!==c.data.pointerType||f.eventMatchesMousePointerAction(c.data,this.pointerAction)){var a=c.timestamp-this.lastEndTimestamp,a=this.momentum&&this.momentum.active&&40>a;switch(c.data.action){case "start":case "update":if(a)break;
this.controller&&this.controller.active?2<c.data.timestamp-this.lastTimestamp&&(this.controller.update(c.data),this.lastTimestamp=c.timestamp):this.startController(c);break;case "end":case "removed":this.endController(c,!0);break;case "added":this.endController(c,!1),this.startController(c)}c.stopPropagation()}};e.prototype.endController=function(c,a){this.controller&&this.controller.active&&(this.lastEndTimestamp=c.timestamp,c=this.controller.end(c.data),a&&c&&(this.momentum=c,this.view.state.switchCameraController(this.momentum)));
this.controller=null};e.prototype.startController=function(c){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(c.data);this.lastTimestamp=c.timestamp};e.prototype.createController=function(){return this.view.state.isGlobal?new g.PinchAndPanController(this.view,this.view.sceneIntersectionHelper):new l.PinchAndPanController(this.view,this.view.sceneIntersectionHelper)};return e}(b.InputHandler);d.PinchAndPanNavigation=t})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function h(c,e){var f=d.call(this)||this;f.view=c;f.intersectionHelper=e;f.smoothRotation=new a.ExponentialFalloff(.05);f.rotationAxis=k.vec3f64.create();f.panningPlane=m.plane.create();f.smoothScaling=new a.ExponentialFalloff(.05);f.zoomCenterScreen=g.createScreenPointArray();f.zoomMomentumEstimator=new I.ZoomMomentumEstimator;f.rotationMomentumEstimator=new E.RotationMomentumEstimator;
f.panSphericalMomentumEstimator=new B.PanSphericalMomentumEstimator;f.panPlanarMomentumEstimator=new C.PanPlanarMomentumEstimator;f.adjustedSphere=m.sphere.create();f.tmp3d=k.vec3f64.create();f.tmpMat=b.mat4f64.create();f.tmpAxisAngle=m.axisAngle.create();f.tmpScreenPointArray=g.createScreenPointArray();f.beginScreenPoint=g.createScreenPointArray();f.beginScenePoint=k.vec3f64.create();f.screenPickPoint=g.createScreenPointArray();f.panMode=w.PanMode.Horizontal;f.tmpInteractionDirection=k.vec3f64.create();
f.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new A,interactionDirection:null,tiltMode:0};return f}q(h,d);h.prototype.begin=function(a){if(this.active){this.beginHeading=-x.cyclicalPI.normalize(x.deg2rad(this.view.camera.heading));this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();g.screenPointObjectToArray(a.center,this.screenPickPoint);f.vec2.copy(this.beginScreenPoint,this.screenPickPoint);
var c=y.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=c.scenePickPoint;this.sphere=c.sphere;e.vec3.copy(this.beginScenePoint,this.scenePickPoint);this.panMode=y.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===w.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(a):this.preparePlanarPanMode(a));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};h.prototype.preparePlanarPanModeOverground=
function(a){var c=e.vec3.negate(this.tmp3d,this.beginCamera.viewForward);m.plane.fromPositionAndNormal(this.scenePickPoint,c,this.panningPlane);var b=g.createScreenPointArray(this.screenPickPoint[0],0),c=k.vec3f64.create(),f=e.vec3.length(this.beginCamera.eye);this.adjustedSphere.radius=f<this.sphere.radius?f-100:this.sphere.radius;y.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,b,c);b=g.createRenderScreenPointArray3();this.beginCamera.projectPoint(c,b);this.screenPickPoint[1]=
Math.min(this.screenPickPoint[1],.9*b[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&m.plane.fromPositionAndNormal(this.scenePickPoint,this.panningPlane,this.panningPlane);a=g.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,a,this.beginScenePoint)};h.prototype.preparePlanarPanMode=function(a){var c=e.vec3.negate(this.tmp3d,this.beginCamera.viewForward);m.plane.fromPositionAndNormal(this.scenePickPoint,
c,this.panningPlane);var b=m.sphere.angleToSilhouette(this.sphere,this.currentCamera.eye),c=m.axisAngle.fromPoints(this.currentCamera.eye,this.scenePickPoint,this.tmpAxisAngle),b=-c[3]-(this.currentCamera.aboveGround?.25:.025)*b;if(0<b){var f=l.mat4.identity(this.tmpMat);l.mat4.rotate(f,f,-b,c);e.vec3.subtract(this.scenePickPoint,this.scenePickPoint,this.sphere.center);e.vec3.transformMat4(this.scenePickPoint,this.scenePickPoint,f);e.vec3.add(this.scenePickPoint,this.scenePickPoint,this.sphere.center);
m.plane.setOffsetFromPoint(this.panningPlane,this.scenePickPoint,this.panningPlane);a=g.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,a,this.beginScenePoint)}};h.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var c=1<a.pointers.size;this.panMode===w.PanMode.Horizontal?(c&&this.zoomSpherical(a),this.panningSpherical(a),c&&this.rotateSpherical(a)):(c&&this.zoomPlanar(a),this.panningPlanar(a),
c&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};h.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===w.PanMode.Horizontal?new r.ZoomSphericalMomentumController(this.view,a,this.zoomCenterScreen,this.beginScenePoint,this.sphere.radius):new v.ZoomPlanarMomentumController(this.view,a,this.beginScenePoint);if(a=this.rotationMomentumEstimator.evaluateMomentum())return new u.RotationMomentumController(this.view,
a,this.sphere.center,this.rotationAxis);if(this.panMode===w.PanMode.Horizontal){if(a=this.panSphericalMomentumEstimator.evaluateMomentum())return new n.PanSphericalMomentumController(this.view,a)}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new p.PanPlanarMomentumController(this.view,a);return null};h.prototype.zoomSpherical=function(a){var b=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(b);y.applyZoomOnSphere(this.sphere,
this.currentCamera,this.smoothScaling.value);g.screenPointObjectToArray(a.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.prototype.panningSpherical=function(a){var b=g.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.sphereOrPlanePointFromScreenPoint(this.sphere,
this.currentCamera,b,this.tmp3d);y.preserveHeadingThreshold(this.beginScenePoint,e.vec3.dot(this.currentCamera.up,this.beginScenePoint),this.sphere.radius,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(y.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(b,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):
(y.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(b,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere.radius,this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.screenPickPoint,b);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.prototype.rotateSpherical=
function(a){e.vec3.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||e.vec3.negate(this.rotationAxis,this.rotationAxis);var b=this.smoothRotation.value,f=y.normalizeRotationDelta(a.angle-b),b=b+f;this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(b);f=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(f,.001*a.timestamp);y.applyRotation(this.currentCamera,this.sphere.center,m.axisAngle.wrapAxisAngle(this.rotationAxis,
f));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius*b);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.prototype.panningPlanar=function(a){var b=g.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,b,this.tmp3d)&&(y.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(b,this.tmp3d,
.001*a.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.beginScreenPoint,b),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),c.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};h.prototype.zoomPlanar=function(a){var b=this.beginRadius/a.radius;this.smoothScaling.gain=
.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(b);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);y.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.prototype.rotatePlanar=
function(a){e.vec3.copy(this.rotationAxis,this.beginScenePoint);var b=this.smoothRotation.value,f=a.angle-b,f=y.normalizeRotationDelta(f);this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(b+f);b=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(b,.001*a.timestamp);y.applyRotation(this.currentCamera,this.sphere.center,m.axisAngle.wrapAxisAngle(this.rotationAxis,b));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=
c.pixelDistanceToInteractionFactor(a.radius*b);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};return h}(h.InteractiveController);d.PinchAndPanController=t})},"esri/views/3d/input/util":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(g){this._gain=g}d.prototype.reset=function(g){this._value=g};Object.defineProperty(d.prototype,"gain",{set:function(g){this._gain=g},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});d.prototype.update=function(g){this._value=void 0===this._value?g:this._gain*g+(1-this._gain)*this._value};return d}();d.ExponentialFalloff=t})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController".split(" "),
function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function e(e,c){e=b.call(this,e,4)||this;e.momentum=c;e.tmpPan=l.vec3f64.create();return e}q(e,b);e.prototype.momentumStep=function(b,c){b=this.momentum.value(b);g.vec3.scale(this.tmpPan,this.momentum.direction,b);g.vec3.subtract(c.eye,c.eye,this.tmpPan);g.vec3.subtract(c.center,c.center,this.tmpPan);c.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return e}(b.MomentumController);d.PanPlanarMomentumController=
t})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(f){function e(e,c){c=f.call(this)||this;c.view=e;c.beginCamera=new b;c.elapsedTimeSec=0;c.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new b,
interactionDirection:null,tiltMode:0};return c}q(e,f);Object.defineProperty(e.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!0,configurable:!0});e.prototype.onControllerStart=function(b){this.beginCamera.copyFrom(b);this.constraintOptions.interactionStartCamera=this.beginCamera;f.prototype.onControllerStart.call(this,b)};e.prototype.stepController=function(b,c){c.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=b;this.momentumStep(this.elapsedTimeSec,
c);g.applyAll(this.view,c,this.constraintOptions)};return e}(l.AnimationController);d.MomentumController=t})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});var e=l.vec3f64.create(),
k=l.vec3f64.create();t=function(c){function a(a,b){a=c.call(this,a,4)||this;a.momentum=b;return a}q(a,c);a.prototype.momentumStep=function(a,c){var b=this.momentum.value1(a);a=this.momentum.value2(a);g.vec3.copy(k,c.eye);g.vec3.normalize(k,k);g.vec3.cross(this.momentum.axis2,k,this.momentum.axis1);f.applyRotationWithTwoAxes(c,e,this.momentum.axis1,b,this.momentum.axis2,a)};return a}(b.MomentumController);d.PanSphericalMomentumController=t})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function c(a,c,e,f){a=b.call(this,a,2)||this;a.momentum=c;a.axis=l.vec3f64.create();a.center=l.vec3f64.create();g.vec3.copy(a.axis,f);g.vec3.copy(a.center,e);return a}q(c,b);c.prototype.momentumStep=function(a,c){a=this.momentum.value(a);f.applyRotation(c,this.center,e.axisAngle.wrapAxisAngle(this.axis,a))};return c}(b.MomentumController);d.RotationMomentumController=t})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function c(a,c,e){a=b.call(this,a,1)||this;a.momentum=c;a.zoomCenter=l.vec3f64.create();g.vec3.copy(a.zoomCenter,e);a.constraintOptions.interactionDirection=l.vec3f64.create();return a}q(c,b);c.prototype.momentumStep=function(a,c){g.vec3.copy(this.constraintOptions.interactionDirection,c.eye);a=this.momentum.valueDelta(0,a);f.applyZoomToPoint(c,this.zoomCenter,a,this.view.state.constraints.minimumPoiDistance);
this.constraintOptions.interactionDirection=e.directionFromTo(this.constraintOptions.interactionDirection,c.eye,this.constraintOptions.interactionDirection)};return c}(b.MomentumController);d.ZoomPlanarMomentumController=t})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function h(c,e,h,k,p){c=d.call(this,c,1)||this;c.momentum=e;c.screenCenter=g.createScreenPointArray();c.sceneCenter=f.vec3f64.create();c.tmpSceneCenter=f.vec3f64.create();c.tmpZoomAxisAngle=a.axisAngle.create();c.sphere=a.sphere.create();l.vec2.copy(c.screenCenter,h);b.vec3.copy(c.sceneCenter,k);c.sphere.radius=p;return c}q(h,d);h.prototype.momentumStep=function(b,f){b=this.momentum.valueDelta(0,b);c.applyZoomOnSphere(this.sphere,
f,b);this.constraintOptions.interactionType=1;e.applyAll(this.view,f,this.constraintOptions);c.sphereOrPlanePointFromScreenPoint(this.sphere,f,this.screenCenter,this.tmpSceneCenter);a.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);c.applyRotation(f,this.sphere.center,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};return h}(k.MomentumController);d.ZoomSphericalMomentumController=t})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});var e=function(b){function c(a,c,e,f,g){a=b.call(this,a,c,e)||this;a.sceneVelocity=f;a.direction=g;return a}q(c,b);c.prototype.value=function(a){return b.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,a)};return c}(f.Momentum);d.PanPlanarMomentum=e;t=function(){function f(c,a,e){void 0===c&&(c=300);void 0===a&&(a=12);void 0===e&&(e=.84);this.minimumInitialVelocity=c;this.stopVelocity=a;this.friction=e;this.time=
new b.FilteredFiniteDifference(.6);this.screen=[new b.FilteredFiniteDifference(.4),new b.FilteredFiniteDifference(.4)];this.scene=[new b.FilteredFiniteDifference(.6),new b.FilteredFiniteDifference(.6),new b.FilteredFiniteDifference(.6)];this.tmpDirection=l.vec3f64.create()}f.prototype.add=function(c,a,b){this.time.hasLastValue&&.015>this.time.computeDelta(b)||(this.screen[0].update(c[0]),this.screen[1].update(c[1]),this.scene[0].update(a[0]),this.scene[1].update(a[1]),this.scene[2].update(a[2]),this.time.update(b))};
f.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};f.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var c=this.screen[0].filteredDelta,a=this.screen[1].filteredDelta,c=Math.sqrt(c*c+a*a)/this.time.filteredDelta;return Math.abs(c)<this.minimumInitialVelocity?null:this.createMomentum(c,this.stopVelocity,this.friction)};f.prototype.createMomentum=function(c,
a,b){g.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var f=g.vec3.length(this.tmpDirection);0<f&&g.vec3.scale(this.tmpDirection,this.tmpDirection,1/f);return new e(c,a,b,f/this.time.filteredDelta,this.tmpDirection)};return f}();d.PanPlanarMomentumEstimator=t})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(g){this.gain=
g}d.prototype.update=function(g){if(this.hasLastValue){var d=this.computeDelta(g);this.updateDelta(d)}this.lastValue=g};d.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(d.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});d.prototype.computeDelta=function(g){return g-
this.lastValue};d.prototype.updateDelta=function(g){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*g:g};return d}();d.FilteredFiniteDifference=t})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function g(g,b,f){this._initialVelocity=g;this._stopVelocity=b;this._friction=f;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(g.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});g.prototype.isFinished=function(g){return g>this.duration};Object.defineProperty(g.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});g.prototype.value=function(g){return this.valueFromInitialVelocity(this._initialVelocity,g)};g.prototype.valueDelta=function(g,b){var f=this.value(g);return this.value(g+
b)-f};g.prototype.valueFromInitialVelocity=function(g,b){b=Math.min(b,this.duration);var f=1-this.friction;return g*(Math.pow(f,b)-1)/Math.log(f)};return g}();d.Momentum=t})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(t,d,q,g,l,b,f,e,k,c){Object.defineProperty(d,"__esModule",{value:!0});var a=function(a){function c(c,b,e,f,g,d,h){void 0===d&&(d=0);c=a.call(this,c,b,e)||this;c.angularVelocity1=f;c.axis1=g;c.angularVelocity2=d;c.axis2=h;return c}q(c,a);c.prototype.value1=function(c){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,c)};c.prototype.value2=function(c){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,c)};return c}(c.Momentum);d.PanSphericalMomentum=
a;t=function(){function c(a,c,f){void 0===a&&(a=300);void 0===c&&(c=12);void 0===f&&(f=.84);this.minimumInitialVelocity=a;this.stopVelocity=c;this.friction=f;this.tmpAxis1=b.vec3f64.create();this.tmpAxis2=b.vec3f64.create();this.tmpAngles=g.vec2f64.create();this.time=new e.FilteredFiniteDifference(.3);this.screen=[new e.FilteredFiniteDifference(.4),new e.FilteredFiniteDifference(.4)];this.angle1=new k.FilteredValue(.6);this.angle2=new k.FilteredValue(.6);this.axis1=b.vec3f64.create();this.axis2=b.vec3f64.create();
this.lastScene=b.vec3f64.create()}c.prototype.addMomentumDirectRotation=function(a,c,b,e,g,d){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;e=f.rotationAngleAndAxisDirectRotation(this.lastScene,c,this.tmpAxis2,e,g,d);this.angle2.update(0);1E-5>l.vec3.squaredLength(this.tmpAxis2)?e=0:l.vec3.normalize(this.axis1,this.tmpAxis2);this.angle1.update(e);l.vec3.copy(this.lastScene,c)}this.screen[0].update(a[0]);this.screen[1].update(a[1]);this.time.update(b)};c.prototype.addMomentumPreserveHeading=
function(a,c,b,e,g,d,h){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;f.rotationAnglesAndAxesHeadingPreserving(this.lastScene,c,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,e,g,d,h,!1);1E-5>l.vec3.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),l.vec3.normalize(this.axis1,this.tmpAxis1),l.vec3.normalize(this.axis2,this.tmpAxis2));l.vec3.copy(this.lastScene,c)}this.screen[0].update(a[0]);
this.screen[1].update(a[1]);this.time.update(b)};c.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};c.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,c=this.screen[1].filteredDelta,a=Math.sqrt(a*a+c*c)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};c.prototype.createMomentum=
function(c,b,e){return new a(c,b,e,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return c}();d.PanSphericalMomentumEstimator=t})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(g){this.gain=g}d.prototype.update=function(g){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*
g:g};d.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(d.prototype,"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0});return d}();d.FilteredValue=t})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(g){function b(b,e,d,c){void 0===b&&(b=3);void 0===
e&&(e=.01);void 0===d&&(d=.95);void 0===c&&(c=12);return g.call(this,b,e,d,c)||this}q(b,g);b.prototype.add=function(b,e){if(this.value.hasLastValue){var f=this.value.lastValue;for(b-=f;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=f+b}g.prototype.add.call(this,b,e)};return b}(g.MomentumEstimator);d.RotationMomentumEstimator=t})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/support/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),
function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function f(b,f,c,a){void 0===b&&(b=2.5);void 0===f&&(f=.01);void 0===c&&(c=.95);void 0===a&&(a=12);this.minimumInitialVelocity=b;this.stopVelocity=f;this.friction=c;this.maxVelocity=a;this.value=new l.FilteredFiniteDifference(.8);this.time=new l.FilteredFiniteDifference(.3)}f.prototype.add=function(b,f){if(this.time.hasLastValue){if(.01>this.time.computeDelta(f))return;if(this.value.hasFilteredDelta){var c=this.value.computeDelta(b);
0>this.value.filteredDelta*c&&this.value.reset()}}this.time.update(f);this.value.update(b)};f.prototype.reset=function(){this.value.reset();this.time.reset()};f.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var b=this.value.filteredDelta/this.time.filteredDelta,b=g.clamp(b,-this.maxVelocity,this.maxVelocity);return Math.abs(b)<this.minimumInitialVelocity?null:this.createMomentum(b,this.stopVelocity,this.friction)};f.prototype.createMomentum=function(e,f,c){return new b.Momentum(e,
f,c)};return f}();d.MomentumEstimator=t})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=function(b){function e(e,c,a){return b.call(this,e,c,a)||this}q(e,b);e.prototype.value=function(e){e=b.prototype.value.call(this,e);return Math.exp(e)};e.prototype.valueDelta=function(e,c){var a=b.prototype.value.call(this,e);
e=b.prototype.value.call(this,e+c);return Math.exp(e-a)};return e}(g.Momentum);d.ZoomMomentum=b;t=function(f){function e(b,c,a,e){void 0===b&&(b=2.5);void 0===c&&(c=.01);void 0===a&&(a=.95);void 0===e&&(e=12);return f.call(this,b,c,a,e)||this}q(e,f);e.prototype.add=function(b,c){f.prototype.add.call(this,Math.log(b),c)};e.prototype.createMomentum=function(e,c,a){return new b(e,c,a)};return e}(l.MomentumEstimator);d.ZoomMomentumEstimator=t})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w){Object.defineProperty(d,"__esModule",{value:!0});var m;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(m=d.PanMode||(d.PanMode={}));var x=b.vec3f64.fromValues(0,0,1),A=16/180*Math.PI;t=function(d){function k(a,c){var f=d.call(this)||this;f.view=a;f.intersectionHelper=c;f.rotationValueSmooth=new e.ExponentialFalloff(.05);f.scalingValueSmooth=new e.ExponentialFalloff(.05);f.planeHorizontal=n.plane.create();f.planeVertical=n.plane.create();
f.rotationMomentumEstimator=new y.RotationMomentumEstimator;f.panMomentumEstimator=new r.PanPlanarMomentumEstimator(300,12,.9);f.zoomMomentumEstimator=new w.ZoomMomentumEstimator;f.beginCenter=b.vec3f64.create();f.tmpPoints=[];f.beginCenterScreen=g.createScreenPointArray();f.tmpCentroid3d=b.vec3f64.create();f.tmpCentroid2d=g.createScreenPointArray();f.tmp2d=g.createScreenPointArray();f.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new v,interactionDirection:null,
tiltMode:0};return f}q(k,d);k.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();g.screenPointObjectToArray(a.center,this.beginCenterScreen);n.plane.fromNormalAndOffset(x,0,this.planeHorizontal);var c=b.vec3f64.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,c);var e=b.vec3f64.create();l.vec3.negate(e,this.beginCamera.viewForward);
var f=b.vec3f64.create();l.vec3.copy(f,x);var d=l.vec3.dot(e,f);this.panMode=u.asin(0>d?-d:d)>=A?m.Horizontal:m.Vertical;n.plane.setOffsetFromPoint(this.planeHorizontal,c,this.planeHorizontal);0>n.plane.signedDistance(this.planeHorizontal,this.beginCamera.eye)&&n.plane.negate(this.planeHorizontal,this.planeHorizontal);this.panMode===m.Vertical?(l.vec3.scale(f,f,d),l.vec3.subtract(this.planeVertical,e,f),l.vec3.normalize(this.planeVertical,this.planeVertical),n.plane.setOffsetFromPoint(this.planeVertical,
c,this.planeVertical),this.computePlanePoints(a.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(a.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);p.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};k.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var c=1<a.pointers.size,b=this.panMode===m.Horizontal?this.planeHorizontal:this.planeVertical,
e=this.beginCenter;if(c){var d=this.beginRadius/a.radius,h=.001875*Math.min(Math.max(a.radius,40),120);this.scalingValueSmooth.gain=h;this.scalingValueSmooth.update(d);p.applyZoomToPoint(this.currentCamera,e,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(Math.abs(a.radius-this.beginRadius));
f.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(a.pointers,b,this.currentCamera,this.tmpPoints);p.centroid(this.tmpPoints,this.tmpCentroid3d);g.screenPointObjectToArray(a.center,this.tmpCentroid2d);p.applyPanPlanar(this.currentCamera,e,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*a.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);f.applyAll(this.view,this.currentCamera,this.constraintOptions);c&&(c=this.planeHorizontal,b=this.rotationValueSmooth.value,d=p.normalizeRotationDelta(a.angle-b),h=.00125*Math.min(Math.max(a.radius,40),120),this.rotationValueSmooth.gain=h,this.rotationValueSmooth.update(b+d),h=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(h,.001*a.timestamp),p.applyRotation(this.currentCamera,e,n.axisAngle.wrapAxisAngle(c,h)),this.constraintOptions.interactionType=
2,this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(Math.abs(a.radius*h)),f.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};k.prototype.end=function(b){b.pointers.size===this.pointerCount&&this.update(b);this.finishController();return(b=this.zoomMomentumEstimator.evaluateMomentum())?new h.ZoomPlanarMomentumController(this.view,b,this.beginCenter):(b=this.rotationMomentumEstimator.evaluateMomentum())?new a.RotationMomentumController(this.view,
b,this.beginCenter,this.planeHorizontal):(b=this.panMomentumEstimator.evaluateMomentum())?new c.PanPlanarMomentumController(this.view,b):null};k.prototype.computePlanePoints=function(a,c,e,f){f.length=a.size;var g=this.tmp2d,d=0;a.forEach(function(a){g[0]=a.x;g[1]=a.y;void 0===f[d]&&(f[d]=b.vec3f64.create());p.intersectPlaneFromScreenPoint(c,e,g,f[d]);d+=1});return f};return k}(k.InteractiveController);d.PinchAndPanController=t})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(g){function b(b,e){var f=g.call(this,!0)||this;f.view=b;f.registerIncoming("pointer-down",e,function(c){return f.view.state.stopActiveCameraController()});return f}q(b,g);return b}(g.InputHandler);d.PointerDownCancelAnimation=t})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(g){function b(b,e,d){d=g.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",e,d)||this;d.view=b;d.key=e;return d}q(b,g);b.prototype.activate=function(){this.view.goTo({heading:0})};return b}(g.SingleKey);d.SingleKeyResetHeading=t})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(t,
d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(g){function b(b,e,d){var c=g.call(this,!0)||this;c.key=e;c.registerIncoming("key-down",d,function(a){return c._handleKeyDown(a)});return c}q(b,g);b.prototype._handleKeyDown=function(b){b.data.key===this.key&&(this.activate(),b.stopPropagation())};return b}(g.InputHandler);d.SingleKey=t})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],
function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(g){function b(b,e,d){d=g.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",e,d)||this;d.view=b;d.key=e;return d}q(b,g);b.prototype.activate=function(){this.view.goTo({tilt:0})};return b}(g.SingleKey);d.SingleKeyResetTilt=t})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler".split(" "),
function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function e(e,c){void 0===c&&(c=!1);var a=b.call(this,!0)||this;a.view=e;a.invert=c;a.registerIncoming("vertical-two-finger-drag",function(c){return a.handleTwoFinger(c)});return a}q(e,b);e.prototype.handleTwoFinger=function(b){var c=g.createScreenPointArray(0,b.data.delta*(this.invert?-1:1));switch(b.data.action){case "begin":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
new l.RotateController(this.view,this.view.sceneIntersectionHelper,"center");this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController&&this.cameraController.update(c);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}};return e}(b.InputHandler);d.TwoFingerTilt=t})},"esri/views/input/BrowserEventSource":function(){define("require exports ../../core/has ../../core/screenUtils ../../core/libs/pep/pep ./keys ./gamepad/GamepadSource".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});var e=q("trident"),k=q("edge"),c=q("chrome"),a=q("ff"),h=q("safari");t=function(){function d(a,c){var b=this;this.input=c;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._element=a;l.applyLocal(a);a.getAttribute("tabindex")||a.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,
"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=a.style.touchAction;a.style.touchAction="none";this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new f.GamepadSource(a,this.input);this._gamepadSource.onEvent=function(a){return b._callback("gamepad",
a)}}d.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(c){a._releasePointerCaptureSafe(c)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction;this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(d.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"activeEvents",{set:function(a){var c=this,b;for(b in this._active)a&&a.has(b)||(this._element.removeEventListener(p[b],this._active[b]),delete this._active[b]);a&&a.forEach(function(a){if(!c._active[a]&&p[a]){var b=(c._eventHandlers[a]||c._handleDefault).bind(c,a);c._element.addEventListener(p[a],b);c._active[a]=b}});this._gamepadSource.pollingEnabled=a&&a.has("gamepad")},enumerable:!0,configurable:!0});d.prototype.setPointerCapture=function(a,
c){c?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._releasePointerCaptureSafe(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};d.prototype._releasePointerCaptureSafe=function(a){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(a)||this._element.releasePointerCapture(a)}catch(v){}};d.prototype._updateNormalizedPointerLikeEvent=function(a,c){a=g.createScreenPointFromNativeEvent(this._element,a);d.test.disableSubpixelCoordinates&&
(a.x=Math.round(a.x),a.y=Math.round(a.y));c.x=a.x;c.y=a.y;return c};d.prototype._handleKey=function(a,c){var e=b.eventKey(c);e&&"key-up"===a&&this._keyDownState.delete(e);c={native:c,key:e,repeat:e&&this._keyDownState.has(e)};e&&"key-down"===a&&this._keyDownState.add(c.key);this._callback(a,c)};d.prototype._handlePointer=function(a,c){c=this._updateNormalizedPointerLikeEvent(c,{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});this._callback(a,
c)};d.prototype._handlePointerPreventDefault=function(a,c){var b=this._updateNormalizedPointerLikeEvent(c,{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});c.preventDefault();this._callback(a,b)};d.prototype._handleMouseWheel=function(b,f){f.preventDefault();var g=f.deltaY;switch(f.deltaMode){case 0:if(e||k)g=g/document.documentElement.clientHeight*600;break;case 1:g*=30;break;case 2:g*=900}e||k?g*=.7:c||h?g*=.6:a&&(g*=1.375);var d=Math.abs(g);
100<d&&(g=g/d*200/(1+Math.exp(-.02*(d-100))));f=this._updateNormalizedPointerLikeEvent(f,{native:f,x:0,y:0,deltaY:g});this._callback(b,f)};d.prototype._handlePointerCaptureLost=function(a,c){this._activePointerCaptures.delete(c.pointerId);this._handleDefault(a,c)};d.prototype._handleDefault=function(a,c){var b={native:c};c.preventDefault();this._callback(a,b)};d.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};d.test={disableSubpixelCoordinates:!1};return d}();d.BrowserEventSource=
t;var p={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"}})},"esri/core/libs/pep/pep":function(){define(function(){function t(b,e){e=e||Object.create(null);var f=document.createEvent("Event");
f.initEvent(b,e.bubbles||!1,e.cancelable||!1);b=2;for(var g;b<c.length;b++)g=c[b],f[g]=e[g]||a[b];f.buttons=e.buttons||0;b=0;b=e.pressure&&f.buttons?e.pressure:f.buttons?.5:0;f.x=f.clientX;f.y=f.clientY;f.pointerId=e.pointerId||0;f.width=e.width||0;f.height=e.height||0;f.pressure=b;f.tiltX=e.tiltX||0;f.tiltY=e.tiltY||0;f.twist=e.twist||0;f.tangentialPressure=e.tangentialPressure||0;f.pointerType=e.pointerType||"";f.hwTimestamp=e.hwTimestamp||0;f.isPrimary=e.isPrimary||!1;return f}function d(){this.array=
[];this.size=0}function q(a,c,b,e){this.addCallback=a.bind(e);this.removeCallback=c.bind(e);this.changedCallback=b.bind(e);C&&(this.observer=new C(this.mutationWatcher.bind(this)))}function g(a){return"body /shadow-deep/ "+l(a)}function l(a){return'[touch-action\x3d"'+a+'"]'}function b(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; }"}function f(){if(G){E.forEach(function(a){String(a)===a?(I+=l(a)+b(a)+"\n",L&&(I+=g(a)+b(a)+"\n")):(I+=a.selectors.map(l)+b(a.rule)+"\n",L&&(I+=a.selectors.map(g)+
b(a.rule)+"\n"))});var a=document.createElement("style");a.textContent=I;document.head.appendChild(a)}}function e(a){if(!r.pointermap.has(a))throw a=Error("NotFoundError"),a.name="NotFoundError",a;}function k(a){for(var c=a.parentNode;c&&c!==a.ownerDocument;)c=c.parentNode;if(!c)throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var c="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),a=[!1,!1,
null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],h=window.Map&&window.Map.prototype.forEach?Map:d;d.prototype={set:function(a,c){if(void 0===c)return this.delete(a);this.has(a)||this.size++;this.array[a]=c},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,c){return this.array.forEach(function(b,e){a.call(c,b,e,this)},this)}};var p="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
n=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],u={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},v="undefined"!==typeof SVGElementInstance,r={pointermap:new h,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,c){var b=c.events;b&&(b.forEach(function(a){c[a]&&(this.eventMap[a]=c[a].bind(c))},this),this.eventSources[a]=c,this.eventSourceList.push(c))},register:function(a){for(var c=
this.eventSourceList.length,b=0,e;b<c&&(e=this.eventSourceList[b]);b++)e.register.call(e,a)},unregister:function(a){for(var c=this.eventSourceList.length,b=0,e;b<c&&(e=this.eventSourceList[b]);b++)e.unregister.call(e,a)},contains:function(a,c){try{return a.contains(c)}catch(ka){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var c=a.type;(c=this.eventMap&&
this.eventMap[c])&&c(a);a._handledByPE=!0}},listen:function(a,c){c.forEach(function(c){this.addEvent(a,c)},this)},unlisten:function(a,c){c.forEach(function(c){this.removeEvent(a,c)},this)},addEvent:function(a,c){a.addEventListener(c,this.boundHandler)},removeEvent:function(a,c){a.removeEventListener(c,this.boundHandler)},makeEvent:function(a,c){this.captureInfo[c.pointerId]&&(c.relatedTarget=null);a=new t(a,c);c.preventDefault&&(a.preventDefault=c.preventDefault);a._target=a._target||c.target;return a},
fireEvent:function(a,c){a=this.makeEvent(a,c);return this.dispatchEvent(a)},cloneEvent:function(a){for(var c=Object.create(null),b,e=0;e<p.length;e++)b=p[e],c[b]=a[b]||n[e],v&&("target"===b||"relatedTarget"===b)&&c[b]instanceof SVGElementInstance&&(c[b]=c[b].correspondingUseElement);a.preventDefault&&(c.preventDefault=function(){a.preventDefault()});return c},getTarget:function(a){var c=this.captureInfo[a.pointerId];if(!c)return a._target;if(a._target===c||!(a.type in u))return c},propagate:function(a,
c,b){for(var e=a.target,f=[];null!=e&&e!==document&&!e.contains(a.relatedTarget);)if(f.push(e),e=e.parentNode,!e)return;b&&f.reverse();f.forEach(function(b){a.target=b;c.call(this,a)},this)},setCapture:function(a,c,b){this.captureInfo[a]&&this.releaseCapture(a,b);this.captureInfo[a]=c;this.implicitRelease=this.releaseCapture.bind(this,a,b);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);var e=new t("gotpointercapture");e.pointerId=
a;e._target=c;b||this.asyncDispatchEvent(e)},releaseCapture:function(a,c){var b=this.captureInfo[a];if(b){this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);var e=new t("lostpointercapture");e.pointerId=a;e._target=b;c||this.asyncDispatchEvent(e)}},dispatchEvent:function(a){var c=this.getTarget(a);if(c)return c.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,
a))}};r.boundHandler=r.eventHandler.bind(r);var y={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var c=a.olderShadowRoot;!c&&(a=a.querySelector("shadow"))&&(c=a.olderShadowRoot);return c},allShadows:function(a){var c=[];for(a=this.shadow(a);a;)c.push(a),a=this.olderShadow(a);return c},searchRoot:function(a,c,b){if(a){var e=a.elementFromPoint(c,
b),f;for(f=this.targetingShadow(e);f;){if(a=f.elementFromPoint(c,b))return e=this.targetingShadow(a),this.searchRoot(e,c,b)||a;f=this.olderShadow(f)}return e}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var c=a.clientX,b=a.clientY;a=this.owner(a.target);a.elementFromPoint(c,b)||(a=document);return this.searchRoot(a,c,b)}},w=Array.prototype.forEach.call.bind(Array.prototype.forEach),
m=Array.prototype.map.call.bind(Array.prototype.map),x=Array.prototype.slice.call.bind(Array.prototype.slice),A=Array.prototype.filter.call.bind(Array.prototype.filter),C=window.MutationObserver||window.WebKitMutationObserver,B={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};q.prototype={watchSubtree:function(a){this.observer&&y.canTarget(a)&&this.observer.observe(a,B)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?
this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){w(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,c){this.changedCallback(a,c)},concatLists:function(a,c){return a.concat(x(c))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===
document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var c=m(a,this.findElements,this);c.push(A(a,this.isElement));return c.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,
this)):"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var E=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],I="",G=window.PointerEvent||window.MSPointerEvent,L=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,F=r.pointermap,K=[1,4,2,8,16],M=!1;try{M=1===(new MouseEvent("test",{buttons:1})).buttons}catch(ja){}var Q={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){r.listen(a,
this.events)},unregister:function(a){r.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var c=this.lastTouches,b=a.clientX;a=a.clientY;for(var e=0,f=c.length,g;e<f&&(g=c[e]);e++){var d=Math.abs(a-g.y);if(25>=Math.abs(b-g.x)&&25>=d)return!0}},prepareEvent:function(a){var c=r.cloneEvent(a),b=c.preventDefault;c.preventDefault=function(){a.preventDefault();b()};c.pointerId=this.POINTER_ID;c.isPrimary=!0;c.pointerType=this.POINTER_TYPE;return c},prepareButtonsForMove:function(a,
c){var b=F.get(this.POINTER_ID);a.buttons=0!==c.which&&b?b.buttons:0;c.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=F.get(this.POINTER_ID),b=this.prepareEvent(a);M||(b.buttons=K[b.button],c&&(b.buttons|=c.buttons),a.buttons=b.buttons);F.set(this.POINTER_ID,a);c&&0!==c.buttons?r.move(b):r.down(b)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);M||this.prepareButtonsForMove(c,a);c.button=-1;F.set(this.POINTER_ID,a);r.move(c)}},
mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=F.get(this.POINTER_ID),b=this.prepareEvent(a);if(!M){var e=K[b.button];b.buttons=c?c.buttons&~e:0;a.buttons=b.buttons}F.set(this.POINTER_ID,a);b.buttons&=~K[b.button];0===b.buttons?r.up(b):r.move(b)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);M||this.prepareButtonsForMove(c,a);c.button=-1;F.set(this.POINTER_ID,a);r.enterOver(c)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=
this.prepareEvent(a);M||this.prepareButtonsForMove(c,a);c.button=-1;r.leaveOut(c)}},cancel:function(a){a=this.prepareEvent(a);r.cancel(a);this.deactivateMouse()},deactivateMouse:function(){F.delete(this.POINTER_ID)}},P=r.captureInfo,O=y.findTarget.bind(y),U=y.allShadows.bind(y),N=r.pointermap,V,X={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){V.enableOnSubtree(a)},unregister:function(){},elementAdded:function(a){var c=a.getAttribute("touch-action"),b=this.touchActionToScrollType(c);
b&&(a._scrollType=b,r.listen(a,this.events),U(a).forEach(function(a){a._scrollType=b;r.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;r.unlisten(a,this.events);U(a).forEach(function(a){a._scrollType=void 0;r.unlisten(a,this.events)},this)},elementChanged:function(a,c){var b=a.getAttribute("touch-action"),e=this.touchActionToScrollType(b);c=this.touchActionToScrollType(c);e&&c?(a._scrollType=e,U(a).forEach(function(a){a._scrollType=e},this)):c?this.elementRemoved(a):
e&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var c=this.scrollTypes;if("none"===a)return"none";if(a===c.XSCROLLER)return"X";if(a===c.YSCROLLER)return"Y";if(c.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===N.size||1===N.size&&N.has(1))this.firstTouch=
a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var c=0;if("touchstart"===a||"touchmove"===a)c=
1;return c},touchToPointer:function(a){var c=this.currentTouchEvent,b=r.cloneEvent(a),e=b.pointerId=a.identifier+2;b.target=P[e]||O(b);b.bubbles=!0;b.cancelable=!0;b.detail=this.clickCount;b.button=0;b.buttons=this.typeToButtons(c.type);b.width=2*(a.radiusX||a.webkitRadiusX||0);b.height=2*(a.radiusY||a.webkitRadiusY||0);b.pressure=a.force||a.webkitForce||.5;b.isPrimary=this.isPrimaryTouch(a);b.pointerType=this.POINTER_TYPE;b.altKey=c.altKey;b.ctrlKey=c.ctrlKey;b.metaKey=c.metaKey;b.shiftKey=c.shiftKey;
var f=this;b.preventDefault=function(){f.scrolling=!1;f.firstXY=null;c.preventDefault()};return b},processTouches:function(a,c){var b=a.changedTouches;this.currentTouchEvent=a;a=0;for(var e;a<b.length;a++)e=b[a],c.call(this,this.touchToPointer(e))},shouldScroll:function(a){if(this.firstXY){var c;c=a.currentTarget._scrollType;if("none"===c)c=!1;else if("XY"===c)c=!0;else{a=a.changedTouches[0];var b="Y"===c?"X":"Y";c=Math.abs(a["client"+c]-this.firstXY[c])>=Math.abs(a["client"+b]-this.firstXY[b])}this.firstXY=
null;return c}},findTouch:function(a,c){for(var b=0,e=a.length,f;b<e&&(f=a[b]);b++)if(f.identifier===c)return!0},vacuumTouches:function(a){var c=a.touches;if(N.size>=c.length){var b=[];N.forEach(function(a,e){1===e||this.findTouch(c,e-2)||b.push(a.out)},this);b.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){N.set(a.pointerId,
{target:a.target,out:a,outTarget:a.target});r.enterOver(a);r.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var c=N.get(a.pointerId);if(c){var b=c.out,e=c.outTarget;r.move(a);b&&e!==a.target&&(b.relatedTarget=a.target,a.relatedTarget=e,b.target=e,a.target?(r.leaveOut(b),r.enterOver(a)):(a.target=e,a.relatedTarget=null,this.cancelOut(a)));c.out=a;c.outTarget=
a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||(r.up(a),r.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){r.cancel(a);r.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){N.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var c=Q.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},
c.push(a),c=function(a,c){c=a.indexOf(c);-1<c&&a.splice(c,1)}.bind(null,c,a),setTimeout(c,2500))}};V=new q(X.elementAdded,X.elementRemoved,X.elementChanged,X);var J=r.pointermap,R=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,T={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){r.listen(a,this.events)},unregister:function(a){r.unlisten(a,this.events)},
POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var c=a;R&&(c=r.cloneEvent(a),c.pointerType=this.POINTER_TYPES[a.pointerType]);return c},cleanup:function(a){J.delete(a)},MSPointerDown:function(a){J.set(a.pointerId,a);a=this.prepareEvent(a);r.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);r.move(a)},MSPointerUp:function(a){var c=this.prepareEvent(a);r.up(c);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);r.leaveOut(a)},MSPointerOver:function(a){a=
this.prepareEvent(a);r.enterOver(a)},MSPointerCancel:function(a){var c=this.prepareEvent(a);r.cancel(c);this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){a=r.makeEvent("lostpointercapture",a);r.dispatchEvent(a)},MSGotPointerCapture:function(a){a=r.makeEvent("gotpointercapture",a);r.dispatchEvent(a)}},W,Z,fa;window.navigator.msPointerEnabled?(W=function(a){e(a);k(this);0!==r.pointermap.get(a).buttons&&(r.setCapture(a,this,!0),this.msSetPointerCapture(a))},Z=function(a){e(a);r.releaseCapture(a,
!0);this.msReleasePointerCapture(a)}):(W=function(a){e(a);k(this);0!==r.pointermap.get(a).buttons&&r.setCapture(a,this)},Z=function(a){e(a);r.releaseCapture(a)});fa=function(a){return!!r.captureInfo[a]};var ga=window.PointerEvent||window.MSPointerEvent;return{dispatcher:r,Installer:q,PointerEvent:t,PointerMap:h,targetFinding:y,applyGlobal:function(){f();window.PointerEvent||(window.PointerEvent=t,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,
enumerable:!0}),r.registerSource("ms",T)):(Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),r.registerSource("mouse",Q),void 0!==window.ontouchstart&&r.registerSource("touch",X)),r.register(document));window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:W},releasePointerCapture:{value:Z},hasPointerCapture:{value:fa}})},applyLocal:function(a){ga||(window.PointerEvent||(window.navigator.msPointerEnabled?
r.registerSource("ms",T):(r.registerSource("mouse",Q),void 0!==window.ontouchstart&&r.registerSource("touch",X)),r.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=W.bind(a),a.releasePointerCapture=Z.bind(a),a.hasPointerCapture=fa.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action","none"))}}})},"esri/views/input/keys":function(){define(["require","exports","../../core/has"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});
d.primaryKey=q("mac")?"Meta":"Ctrl";var g={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(t=48;58>t;t++)g[t]=String.fromCharCode(t);for(t=1;25>t;t++)g[111+t]="F"+t;for(t=65;91>t;t++)g[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];var l={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Esc:"Escape"};d.eventKey=function(b){if(void 0!==b.key)return l[b.key]||
b.key;var f=g[b.keyCode];return Array.isArray(f)?b.shiftKey?f[1]:f[0]:f};d.isSystemModifier=function(b){switch(b){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}}})},"esri/views/input/gamepad/GamepadSource":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/scheduling ./GamepadInputDevice ./GamepadState".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function f(e,f){var c=this;this.element=
e;this.input=f;this.handleGamepadConnectedEvent=function(a){c.handleGamepadConnected(a.gamepad)};this.handleGamepadDisconnectedEvent=function(a){a=a.gamepad;var e=c.inputDevices[a.index];e&&(c.emitGamepadEvent(a,b.extractState(e),!1),c.inputDevices[a.index]=void 0,c.latestUpdate[a.index]=void 0,c.input.gamepad.devices.remove(e))};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(function(a){return c.handleGamepadConnected(a)}),
window.addEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent)}f.prototype.destroy=function(){this.pollingEnabled=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent))};Object.defineProperty(f.prototype,"onEvent",{set:function(b){this.callback=b},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"pollingEnabled",{set:function(b){this.supported&&(b?this.startPolling():this.stopPolling())},enumerable:!0,configurable:!0});f.prototype.handleGamepadConnected=function(b){var e=new l(b);"unknown"!==e.deviceType&&(this.inputDevices[b.index]=e,this.input.gamepad.devices.add(e))};f.prototype.startPolling=function(){var b=this;null==this.frameTask&&(this.frameTask=g.addFrameTask({update:function(){return b.readGamepadState()}}))};f.prototype.stopPolling=function(){null!=
this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};f.prototype.readGamepadState=function(){var e=this,f=document.hasFocus(),c=this.element.contains(document.activeElement),a="document"===this.input.gamepad.enabledFocusMode&&!f||"view"===this.input.gamepad.enabledFocusMode&&!c;this.forEachGamepad(function(c){var f=e.inputDevices[c.index];if(f){var g=e.latestUpdate[c.index],f=b.extractState(f),d=a||b.stateIdle(f);g&&(g.timestamp===c.timestamp||!g.active&&d||b.stateEqual(g.state,
f))||e.emitGamepadEvent(c,f,!d)}})};f.prototype.forEachGamepad=function(b){for(var e=window.navigator.getGamepads(),c=0;c<e.length;c++){var a=e[c];this.validate(a)&&b(a)}};f.prototype.emitGamepadEvent=function(b,f,c){var a=this.latestUpdate[b.index];if((a=a&&a.active)||c)this.latestUpdate[b.index]={timestamp:b.timestamp,state:f,active:c},this.callback&&this.callback({device:this.inputDevices[b.index],state:f,action:!a&&c?"start":a&&c?"update":"end"})};f.prototype.validate=function(b){if(!b||!b.connected)return!1;
for(var e=0;e<b.axes.length;e++)if(isNaN(b.axes[e]))return!1;return!0};return f}();d.GamepadSource=t})},"esri/views/input/gamepad/GamepadState":function(){define(["require","exports","../../3d/support/mathUtils"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.extractState=function(g){var d=g.native;return{buttons:d.buttons.map(function(b){return b.pressed?b.value?b.value:1:0}),axes:d.axes.map(function(b){var f=g.axisThreshold,e=Math.abs(b);b=e<f?0:q.sign(b)*(e-f)/(1-f);return b})}};
d.stateEqual=function(g,d){if(g.axes.length!==d.axes.length||g.buttons.length!==d.buttons.length)return!1;for(var b=0;b<g.axes.length;b++)if(g.axes[b]!==d.axes[b])return!1;for(b=0;b<g.buttons.length;b++)if(g.buttons[b]!==d.buttons[b])return!1;return!0};d.stateIdle=function(g){for(var d=0;d<g.axes.length;d++)if(0!==g.axes[d])return!1;for(d=0;d<g.buttons.length;d++)if(0!==g.buttons[d])return!1;return!0}})},"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Logger ../../core/now ../../core/accessorSupport/decorators ./keys ./recognizers ./handlers/LatestPointerType".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){Object.defineProperty(d,"__esModule",{value:!0});var h=b.getLogger("esri.views.input.InputManager");t=function(b){function d(a,c){a=b.call(this)||this;a._pointerCaptures=new Map;a._nameToGroup={};a._handlers=[];a._currentPropagation=null;a._sourceEvents=new Set;a._keyModifiers=new Set;a._activeKeyModifiers=new Set;a.primaryKey=k.primaryKey;a.latestPointerType="mouse";a._installRecognizers();return a}q(d,b);d.prototype.normalizeCtorArgs=function(a,b){this._browserEvents=
a;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=b;this._recognizers||(this._recognizers=c.defaults.map(function(a){return new a}));return{}};d.prototype.destroy=function(){for(var a=0,c=Object.keys(this._nameToGroup);a<c.length;a++)this.uninstallHandlers(c[a]);this._browserEvents=null};Object.defineProperty(d.prototype,"hasPendingInputs",{get:function(){return this._handlers.some(function(a){return a.handler.hasPendingInputs})},enumerable:!0,configurable:!0});
d.prototype.installHandlers=function(a,c){var b=this;if(this._nameToGroup[a])h.error("There is already an InputHandler group registered under the name `"+a+"`");else if(0===c.length)h.error("Can't register a group of zero handlers");else{var e={name:a,handlers:c.map(function(a,c){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};this._nameToGroup[a]=e;a=function(a){var c=e.handlers[a];f._handlers.push(c);c.handler.onInstall({updateDependencies:function(){b.updateDependencies()},
emit:function(a,e,f,g){b._emitInputEvent(c.priorityIndex,a,e,f,g)},setPointerCapture:function(a,f){b._setPointerCapture(e,c,a,f)},setEventCallback:function(a){c.eventCallback=a},setUninstallCallback:function(a){c.uninstallCallback=a},refreshHasPendingInputs:function(){b.notifyChange("hasPendingInputs")}})};var f=this;for(c=e.handlers.length-1;0<=c;c--)a(c);this.updateDependencies()}};d.prototype.uninstallHandlers=function(a){var c=this._nameToGroup[a];c?(c.handlers.forEach(function(a){a.removed=!0;
a.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):h.error("There is no InputHandler group registered under the name `"+a+"`")};d.prototype.hasHandlers=function(a){return void 0!==this._nameToGroup[a]};d.prototype.updateDependencies=function(){var a=new Set,c=new Set;this._handlersPriority=[];for(var b=this._handlers.length-1;0<=b;b--){var e=this._handlers[b];e.priorityIndex=b;this._handlersPriority.push(e)}this._handlersPriority=
this._sortHandlersPriority(this._handlersPriority);for(b=this._handlersPriority.length-1;0<=b;b--){e=this._handlersPriority[b];e.priorityIndex=b;var f=e.handler.hasSideEffects;if(!f)for(var g=0,d=e.handler.outgoingEventTypes;g<d.length;g++)if(a.has(d[g])){f=!0;break}if(f)for(g=0,d=e.handler.incomingEventMatches;g<d.length;g++){var h=d[g];a.add(h.eventType);for(var p=0,h=h.keyModifiers;p<h.length;p++){var n=h[p];k.isSystemModifier(n)||c.add(n)}}e.active=f}this._sourceEvents=a;this._keyModifiers=c;
0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};d.prototype._setLatestPointerType=function(a){this._set("latestPointerType",a)};d.prototype._onEventReceived=function(a,c){"pointer-capture-lost"===a&&this._pointerCaptures.delete(c.native.pointerId);this._updateKeyModifiers(a,c);this._emitInputEventFromSource(a,
c,c.native?c.native.timestamp:void 0)};d.prototype._updateKeyModifiers=function(a,c){var b=this;if(c){var e=!1,f=function(){if(!e){var a=new Set;b._activeKeyModifiers.forEach(function(c){a.add(c)});b._activeKeyModifiers=a;e=!0}},g=function(a,c){c&&!b._activeKeyModifiers.has(a)?(f(),b._activeKeyModifiers.add(a)):!c&&b._activeKeyModifiers.has(a)&&(f(),b._activeKeyModifiers.delete(a))};if("key-down"===a||"key-up"===a){var d=c.key;this._keyModifiers.has(d)&&g(d,"key-down"===a)}a=c.native;g("Alt",!(!a||
!a.altKey));g("Ctrl",!(!a||!a.ctrlKey));g("Shift",!(!a||!a.shiftKey));g("Meta",!(!a||!a.metaKey));g("Primary",this._activeKeyModifiers.has(this.primaryKey))}};d.prototype._installRecognizers=function(){var c=this;this._latestPointerTypeHandler=new a.LatestPointerType(function(a){return c._setLatestPointerType(a)});0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};d.prototype._setPointerCapture=
function(a,c,b,e){a=a.name+"-"+c.priorityIndex;c=this._pointerCaptures.get(b.pointerId)||new Set;this._pointerCaptures.set(b.pointerId,c);e?(c.add(a),1===c.size&&this._browserEvents&&this._browserEvents.setPointerCapture(b,!0)):c.has(a)&&(c.delete(a),0===c.size&&(this._pointerCaptures.delete(b.pointerId),this._browserEvents&&this._browserEvents.setPointerCapture(b,!1)))};d.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});this.updateDependencies()};
d.prototype._emitInputEventFromSource=function(a,c,b){this._emitInputEvent(0,a,c,b)};d.prototype._emitInputEvent=function(a,c,b,e,g){e=void 0!==e?e:this._currentPropagation?this._currentPropagation.timestamp:f();c=new p(c,b,e,g||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(c):this._doNewPropagation(a,c)};d.prototype._doNewPropagation=function(a,c){for(a=this._currentPropagation={events:[c],addedEvents:[],currentHandler:this._handlersPriority[a],needsHandlerGarbageCollect:!1,
timestamp:c.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=!0;else{c=a.events;var b=[];a.addedEvents=[];for(var e=0;e<c.length;e++){var f=c[e];a.currentHandler.active&&a.currentHandler.eventCallback(f);f.shouldStopPropagation()||b.push(f)}a.events=b.concat(a.addedEvents)}a.currentHandler=this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=null};d.prototype._compareHandlerPriority=
function(a,c){if(a.handler.hasSideEffects!==c.handler.hasSideEffects)return a.handler.hasSideEffects?1:-1;for(var b=0,e=a.handler.incomingEventMatches;b<e.length;b++)for(var f=e[b],g=function(a){if(f.eventType!==a.eventType)return"continue";var c=f.keyModifiers.filter(function(c){return-1!==a.keyModifiers.indexOf(c)});if(c.length===f.keyModifiers.length!==(c.length===a.keyModifiers.length))return{value:f.keyModifiers.length>a.keyModifiers.length?-1:1}},d=0,h=c.handler.incomingEventMatches;d<h.length;d++){var k=
g(h[d]);if("object"===typeof k)return k.value}return a.priorityIndex>c.priorityIndex?-1:1};d.prototype._sortHandlersPriority=function(a){for(var c=[],b=0;b<a.length;b++){for(var e=a[b],f=0;f<c.length&&0<=this._compareHandlerPriority(e,c[f]);)f++;c.splice(f,0,e)}return c};Object.defineProperty(d.prototype,"debug",{get:function(){var a=this,c=function(c){var b=a._setPointerCapture;a._setPointerCapture=function(){};c();a._setPointerCapture=b};return{injectEvent:function(b,e){c(function(){a._onEventReceived(b,
e)})},disablePointerCapture:c}},enumerable:!0,configurable:!0});g([e.property({readOnly:!0})],d.prototype,"hasPendingInputs",null);g([e.property({readOnly:!0})],d.prototype,"latestPointerType",void 0);return d=g([e.subclass("esri.views.input.InputManager")],d)}(e.declared(l));d.InputManager=t;var p=function(){function a(a,c,b,e){this.type=a;this.data=c;this.timestamp=b;this.modifiers=e;this._stopPropagation=!1}a.prototype.stopPropagation=function(){this._stopPropagation=!0};a.prototype.shouldStopPropagation=
function(){return this._stopPropagation};return a}()})},"esri/views/input/recognizers":function(){define("require exports ./recognizers/Drag ./recognizers/PointerClickHoldAndDrag ./recognizers/SingleAndDoubleClick ./recognizers/VerticalTwoFingerDrag".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});d.defaults=[g.PointerClickHoldAndDrag,l.SingleAndDoubleClick,q.Drag,b.VerticalTwoFingerDrag]})},"esri/views/input/recognizers/Drag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/screenUtils ../InputHandler ./support".split(" "),
function(t,d,q,g,l,b){function f(a){var c=[];a.forEach(function(a){c.push(g.createScreenPoint(a.event.x,a.event.y))});return b.fitCircleLSQ(c)}function e(a){var b=f(a),e=0;a.forEach(function(a){for(var f=c(a,b),f=f-a.lastAngle;f>Math.PI;)f-=2*Math.PI;for(;f<-Math.PI;)f+=2*Math.PI;f=a.lastAngle+f;a.lastAngle=f;e+=f-a.initialAngle});e/=a.size||1;return{angle:e,radius:b.radius,center:b.center}}function k(a){var c=new Map;a.forEach(function(a,b){return c.set(b,a.event)});return c}function c(a,c){a=a.event;
return Math.atan2(a.y-c.center.y,a.x-c.center.x)}Object.defineProperty(d,"__esModule",{value:!0});t=function(a){function b(){var c=a.call(this,!1)||this;c.startStateModifiers=new Set;c.activePointerMap=new Map;c.isDragging=!1;c.drag=c.registerOutgoing("drag");c.registerIncoming("pointer-drag",c.handlePointerDrag.bind(c));c.registerIncoming("pointer-up",c.handlePointerUpAndPointerLost.bind(c));c.registerIncoming("pointer-capture-lost",c.handlePointerUpAndPointerLost.bind(c));c.registerIncoming("pointer-cancel",
c.handlePointerUpAndPointerLost.bind(c));return c}q(b,a);b.prototype.createPayload=function(a,c,b,e){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:c.buttons,timestamp:e,pointers:k(this.activePointerMap),pointer:c,angle:b.angle,radius:b.radius,center:b.center}};b.prototype.addPointer=function(a){var b=a.native.pointerId,g=e(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};this.activePointerMap.set(b,a);b=c(a,f(this.activePointerMap));a.initialAngle=
b;a.lastAngle=b;this.updatePointerAngles(g)};b.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var c=this.activePointerMap.get(a.native.pointerId);c?c.event=a:this.addPointer(a)}};b.prototype.removePointer=function(a){var c=e(this.activePointerMap).angle;this.activePointerMap.delete(a);this.updatePointerAngles(c)};b.prototype.updatePointerAngles=function(a){var b=e(this.activePointerMap);this.activePointerMap.forEach(function(e){e.initialAngle=c(e,b)-a;e.lastAngle=c(e,b)-a})};b.prototype.emitEvent=
function(a,c,b){var f=e(this.activePointerMap);this.drag.emit(this.createPayload(a,c,f,b),void 0,this.startStateModifiers)};b.prototype.handlePointerUpAndPointerLost=function(a){var c=a.data.native.pointerId,b=a.timestamp;this.activePointerMap.get(c)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),this.emitEvent("end",a.data,b),this.isDragging=!1,this.removePointer(c)):(this.removePointer(c),this.emitEvent("removed",a.data,a.timestamp)))};b.prototype.handlePointerDrag=function(a){var c=
a.data,b=c.currentEvent,e=a.timestamp;switch(c.action){case "start":case "update":this.isDragging?this.activePointerMap.has(b.native.pointerId)?(this.updatePointer(b),this.emitEvent("update",b,e)):(this.addPointer(b),this.emitEvent("added",b,e)):(this.updatePointer(b),this.pointerType=a.data.startEvent.pointerType,this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.emitEvent("start",b,e))}};return b}(l.InputHandler);d.Drag=t;(function(a){a[a.Left=
0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(d.Button||(d.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports","../../../core/screenUtils"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.manhattanDistance=function(g,d){return Math.abs(d.x-g.x)+Math.abs(d.y-g.y)};d.euclideanDistance=function(g,d){var b=d.x-g.x;g=d.y-g.y;return Math.sqrt(b*b+g*g)};d.fitCircleLSQ=
function(g,d){d?(d.radius=0,d.center.x=0,d.center.y=0):d={radius:0,center:q.createScreenPoint()};if(0===g.length)return d;if(1===g.length)return d.center.x=g[0].x,d.center.y=g[0].y,d;if(2===g.length){var b=g[0];g=g[1];var f=[g.x-b.x,g.y-b.y],e=f[0],f=f[1];d.radius=Math.sqrt(e*e+f*f)/2;d.center.x=(b.x+g.x)/2;d.center.y=(b.y+g.y)/2;return d}for(var k=0,c=0,a=0;a<g.length;a++)k+=g[a].x,c+=g[a].y;for(var k=k/g.length,c=c/g.length,h=g.map(function(a){return a.x-k}),p=g.map(function(a){return a.y-c}),n=
b=d=0,l=0,v=e=0,a=f=0;a<h.length;a++){var r=h[a],y=p[a],w=r*r,m=y*y;d+=w;b+=m;n+=r*y;l+=w*r;e+=m*y;v+=r*m;f+=y*w}a=d;h=n;p=b;l=.5*(l+v);e=.5*(e+f);f=a*p-n*h;v=(l*p-e*h)/f;e=(a*e-n*l)/f;f=q.createScreenPoint(v+k,e+c);return{radius:Math.sqrt(v*v+e*e+(d+b)/g.length),center:f}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../InputHandler ./support".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,
"__esModule",{value:!0});d.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};t=function(f){function e(b,c,a,e,p){void 0===b&&(b=d.DefaultParameters.maximumClickDelay);void 0===c&&(c=d.DefaultParameters.movementUntilMouseDrag);void 0===a&&(a=d.DefaultParameters.movementUntilTouchDrag);void 0===e&&(e=d.DefaultParameters.holdDelay);void 0===p&&(p=g.default);var h=f.call(this,!1)||this;h.maximumClickDelay=b;h.movementUntilMouseDrag=c;h.movementUntilTouchDrag=
a;h.holdDelay=e;h._clock=p;h._pointerState=new Map;h._pointerDrag=h.registerOutgoing("pointer-drag");h._immediateClick=h.registerOutgoing("immediate-click");h._pointerHold=h.registerOutgoing("hold");h.registerIncoming("pointer-down",h._handlePointerDown.bind(h));h.registerIncoming("pointer-up",function(a){h._handlePointerLoss(a,"pointer-up")});h.registerIncoming("pointer-capture-lost",function(a){h._handlePointerLoss(a,"pointer-capture-lost")});h.registerIncoming("pointer-cancel",function(a){h._handlePointerLoss(a,
"pointer-cancel")});h._moveHandle=h.registerIncoming("pointer-move",h._handlePointerMove.bind(h));h._moveHandle.pause();return h}q(e,f);e.prototype.onUninstall=function(){this._pointerState.forEach(function(b){null!=b.holdTimeout&&(b.holdTimeout.remove(),b.holdTimeout=null)});f.prototype.onUninstall.call(this)};e.prototype._handlePointerDown=function(b){var c=this,a=b.data,e=a.native.pointerId,f=null;0===this._pointerState.size&&(f=this._clock.setTimeout(function(){var a=c._pointerState.get(e);a&&
(a.isDragging||(c._pointerHold.emit(a.previousEvent,void 0,b.modifiers),a.holdEmitted=!0),a.holdTimeout=null)},this.holdDelay));f={startEvent:a,previousEvent:a,startTimestamp:b.timestamp,isDragging:!1,downButton:a.native.button,holdTimeout:f,modifiers:new Set};this._pointerState.set(e,f);this.startCapturingPointer(a.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(b)};e.prototype._createPointerDragData=function(b,c,a){return{action:b,startEvent:c.startEvent,previousEvent:c.previousEvent,
currentEvent:a}};e.prototype._handlePointerMove=function(e){var c=e.data,a=this._pointerState.get(c.native.pointerId);a&&(a.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",a,c),void 0,a.modifiers):b.euclideanDistance(c,a.startEvent)>("touch"===c.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&this.startDragging(e),a.previousEvent=c)};e.prototype.startDragging=function(b){var c=this,a=b.data,e=a.native.pointerId;this._pointerState.forEach(function(f){null!=
f.holdTimeout&&(f.holdTimeout.remove(),f.holdTimeout=null);f.isDragging||(f.modifiers=b.modifiers,f.isDragging=!0,e===f.startEvent.native.pointerId?c._pointerDrag.emit(c._createPointerDragData("start",f,a)):c._pointerDrag.emit(c._createPointerDragData("start",f,f.previousEvent),b.timestamp))})};e.prototype._handlePointerLoss=function(b,c){var a=b.data,e=a.native.pointerId,f=this._pointerState.get(e);f&&(null!=f.holdTimeout&&(f.holdTimeout.remove(),f.holdTimeout=null),f.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",
f,"pointer-up"===c?a:f.previousEvent),void 0,f.modifiers):"pointer-up"===c&&f.downButton===a.native.button&&b.timestamp-f.startTimestamp<=this.maximumClickDelay&&!f.holdEmitted&&this._immediateClick.emit(a),this._pointerState.delete(e),this.stopCapturingPointer(a.native),0===this._pointerState.size&&this._moveHandle.pause())};return e}(l.InputHandler);d.PointerClickHoldAndDrag=t})},"esri/core/clock":function(){define(["require","exports","./global"],function(t,d,q){function g(g){return{setTimeout:function(b,
f){var e=g.setTimeout(b,f);return{remove:function(){return g.clearTimeout(e)}}}}}Object.defineProperty(d,"__esModule",{value:!0});d.wrap=g;d.default=g(q)})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../../../core/iteratorUtils ../InputHandler ./support".split(" "),function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});d.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,
maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};t=function(b){function e(c,a,e,f,k){void 0===c&&(c=d.DefaultParameters.maximumDoubleClickDelay);void 0===a&&(a=d.DefaultParameters.maximumDoubleClickDistance);void 0===e&&(e=d.DefaultParameters.maximumDoubleTouchDelay);void 0===f&&(f=d.DefaultParameters.maximumDoubleTouchDistance);void 0===k&&(k=g.default);var h=b.call(this,!1)||this;h.maximumDoubleClickDelay=c;h.maximumDoubleClickDistance=a;h.maximumDoubleTouchDelay=e;h.maximumDoubleTouchDistance=
f;h._clock=k;h._pointerState=new Map;h._click=h.registerOutgoing("click");h._doubleClick=h.registerOutgoing("double-click");h.registerIncoming("immediate-click",h._handleImmediateClick.bind(h));h.registerIncoming("pointer-drag",h._handlePointerDrag.bind(h));h.registerIncoming("drag",h._handleDrag.bind(h));return h}q(e,b);e.prototype.onUninstall=function(){this._pointerState.forEach(function(c){null!=c.doubleClickTimeout&&(c.doubleClickTimeout.remove(),c.doubleClickTimeout=null)})};Object.defineProperty(e.prototype,
"hasPendingInputs",{get:function(){return!l.everyMap(this._pointerState,function(c){return null==c.doubleClickTimeout})},enumerable:!0,configurable:!0});e.prototype._pointerId=function(c){c=c.native;return"mouse"===c.pointerType?c.pointerId+":"+c.button:""+c.pointerType};e.prototype._handleImmediateClick=function(c){var a=c.data,b=this._pointerId(a),e=this._pointerState.get(b);if(e){var g="touch"===a.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;f.manhattanDistance(e.event.data,
a)>g?(this._clearDoubleClickTimeout(b,!0),this._startClick(c)):(this._clearDoubleClickTimeout(b,!1),this._doubleClick.emit(a,void 0,e.event.modifiers))}else this._startClick(c)};e.prototype._startClick=function(c){var a=this,b=this._pointerId(c.data);this._pointerState.set(b,{event:c,doubleClickTimeout:this._clock.setTimeout(function(){return a._doubleClickTimeoutExceeded(b)},"touch"===c.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};
e.prototype._handlePointerDrag=function(c){c=this._pointerId(c.data.currentEvent);this._clearDoubleClickTimeout(c,!0)};e.prototype._handleDrag=function(c){c=this._pointerId(c.data.pointer);this._clearDoubleClickTimeout(c,!0)};e.prototype._clearDoubleClickTimeout=function(c,a){var b=this._pointerState.get(c);b&&(b.doubleClickTimeout.remove(),b.doubleClickTimeout=null,a&&this._doubleClickTimeoutExceeded(c),this._pointerState.delete(c),this.refreshHasPendingInputs())};e.prototype._doubleClickTimeoutExceeded=
function(c){var a=this._pointerState.get(c);this._click.emit(a.event.data,void 0,a.event.modifiers);a.doubleClickTimeout=null;this._pointerState.delete(c);this.refreshHasPendingInputs()};return e}(b.InputHandler);d.SingleAndDoubleClick=t})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../DragEventSeparator","../InputHandler"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function f(e,
f){void 0===e&&(e=20);void 0===f&&(f=40);var c=b.call(this,!1)||this;c._threshold=e;c._maxDelta=f;c.state="ready";c.emittedArtificalEnd2=!1;c._vertical=c.registerOutgoing("vertical-two-finger-drag");c._artificalDrag=c.registerOutgoing("drag");c.dragEventSeparator=new g.DragEventSeparator({start:function(a,b){return c.observeStart(a,b)},update:function(a,b,e){return c.observeUpdate(a,b,e)},end:function(a,b){return c.observeEnd(a,b)}});c.registerIncoming("drag",function(a){return c.dragEventSeparator.handle(a)});
return c}q(f,b);Object.defineProperty(f.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});f.prototype.observeStart=function(b,f){1===b&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:f.data.button,buttons:f.data.buttons,pointerType:f.data.pointerType,timestamp:f.data.timestamp,pointers:f.data.pointers,pointer:f.data.pointer,angle:f.data.angle,radius:f.data.radius,center:f.data.center,artifical:!0}),
f.stopPropagation());this.state=2===b?"ready":"failed"};f.prototype.observeUpdate=function(b,f,c){"failed"!==this.state&&2===b&&("active"===this.state?(this._vertical.emit({delta:f.data.center.y-this._thresholdReachedCenter.y,action:"update"}),f.stopPropagation()):this.checkMovementWithinLimits(f.data,c.data)?this.checkVerticalThresholdReached(f.data,c.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=f.data.center,this._artificalDrag.emit({action:"end",button:f.data.button,
buttons:f.data.buttons,pointerType:f.data.pointerType,timestamp:f.data.timestamp,pointers:f.data.pointers,pointer:f.data.pointer,angle:f.data.angle,radius:f.data.radius,center:f.data.center,artifical:!0}),this._vertical.emit({delta:f.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),f.stopPropagation()):this.state="failed")};f.prototype.observeEnd=function(b,f){"active"===this.state&&(this._vertical.emit({delta:f.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",
f.stopPropagation())};f.prototype.checkMovementWithinLimits=function(b,f){var c=-Infinity,a=Infinity,e=-Infinity,g=Infinity;f.pointers.forEach(function(b){c=Math.max(c,b.x);a=Math.min(a,b.x);e=Math.max(e,b.y);g=Math.min(g,b.y)});var d=-Infinity,k=Infinity,l=-Infinity,r=Infinity;b.pointers.forEach(function(a){d=Math.max(d,a.x);k=Math.min(k,a.x);l=Math.max(l,a.y);r=Math.min(r,a.y)});return Math.abs(b.center.x-f.center.x)<this._threshold&&Math.abs(d-k-(c-a))<=this._maxDelta&&Math.abs(l-r-(e-g))<=this._maxDelta};
f.prototype.checkVerticalThresholdReached=function(b,f){var c=Math.abs(b.center.y-f.center.y);b.pointers.forEach(function(a,b){b=f.pointers.get(b);c=Math.min(c,Math.abs(a.y-b.y))});return c>=this._threshold};return f}(l.InputHandler);d.VerticalTwoFingerDrag=t})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(g){this.callbacks=g;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=
function(){return!0})}d.prototype.handle=function(g){var d=g.data,b=d.pointers.size;switch(d.action){case "start":this.currentCount=b;this.emitStart(g);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=b;this.emitStart(g);break;case "update":this.emitUpdate(g);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=b;this.emitStart(g);break;case "end":this.emitEnd(g),this.currentCount=0}this.previousEvent=g};d.prototype.emitStart=function(g){this.startEvent=
g;this.callbacks.condition(this.currentCount,g)&&this.callbacks.start(this.currentCount,g,this.startEvent)};d.prototype.emitUpdate=function(g){this.callbacks.condition(this.currentCount,g)&&this.callbacks.update(this.currentCount,g,this.startEvent)};d.prototype.emitEnd=function(g){this.callbacks.condition(this.currentCount,g)&&this.callbacks.end(this.currentCount,g,this.startEvent);this.startEvent=null};return d}();d.DragEventSeparator=t})},"esri/views/input/handlers/LatestPointerType":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(g){function b(b){var e=g.call(this,!0)||this;e._onChange=b;e._value="mouse";e.registerIncoming("pointer-down",function(b){e._setValue("touch"===b.data.native.pointerType?"touch":"mouse")});e._moveHandler=e.registerIncoming("pointer-move",function(b){e._setValue("touch"===b.data.native.pointerType?"touch":"mouse")});e._moveHandler.pause();return e}q(b,g);
b.prototype._setValue=function(b){b!==this._value&&("touch"===b?this._moveHandler.resume():this._moveHandler.pause(),this._value=b,this._onChange(b))};return b}(g.InputHandler);d.LatestPointerType=t})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(g){function b(){var b=g.call(this,!0)||this;b.registerIncoming("context-menu",
function(b){b.data.native.preventDefault()});return b}q(b,g);return b}(g.InputHandler);d.PreventContextMenu=t;d.default=t})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/Handles ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../support/debugFlags ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/sphere ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A){function C(a){var c,b,e,f;return g(this,function(g){switch(g.label){case 0:c=[];for(b in a)c.push(b);e=0;g.label=1;case 1:if(!(e<c.length))return[3,4];f=c[e];return[4,a[f]];case 2:g.sent(),g.label=3;case 3:return e++,[3,1];case 4:return[2]}})}Object.defineProperty(d,"__esModule",{value:!0});var B=a.vec4f64.create(),E=a.vec4f64.create(),I=a.vec4f64.create(),G=a.vec4f64.create(),L=c.vec3f64.fromValues(0,0,0),F=v.sphere.create(),K=v.ray.create(),
M=c.vec3f64.create(),Q=h.create(),P=h.create(),O=function(){return function(){this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.pooled=this.visible=this.culled=!1}}(),U=function(){return function(a,c,b){void 0===b&&(b={});this.graphics3DGraphic=a;this.slicePlaneEnabled=c;this.info=b}}(),N=function(){return function(a,c){void 0===c&&(c=new Map);this.graphics3DCore=a;this.graphics=c}}();t=function(){function a(a){var c,e,g=this;this.handles=new l;this.dirty=!0;this.state=0;this.contexts=[];
this.iterators=this.graphics=null;this.accBinsNumX=15;this.accBinsNumY=20;this.accBinsSizeY=this.accBinsSizeX=0;this.accBins=null;this.accNumTests=0;this._iconMarginFactor=-.1;this.slicePlaneViewSpace=null;this.view=a;this.graphics=(c={},c[0]={active:{},visible:new b,remove:new b},c[1]={active:{},visible:new b,remove:new b},c);this.iterators=(e={},e[0]={active:null,visible:null,remove:null,sort:null},e[1]={active:null,visible:null,remove:null,sort:null},e);this.handles.add([a.watch("state.camera",
function(){g.updateSlicePlane();g.setDirtyUrgent()}),a.watch("map.ground.opacity",function(a,c){1!==a&&1!==c||g.setDirtyUrgent()}),f.init(a,"slicePlane",function(){return g.updateSlicePlane()})]);this.frameWorker=a.resourceController.scheduler.registerTask(12,function(a){return g.run(a)},function(){return g.shouldRun()})}Object.defineProperty(a.prototype,"iconMarginFactor",{get:function(){return this._iconMarginFactor},set:function(a){this._iconMarginFactor=a;this.setDirty()},enumerable:!0,configurable:!0});
a.prototype.updateSlicePlane=function(){var a=this.view&&this.view.slicePlane;a?(this.slicePlaneViewSpace||(this.slicePlaneViewSpace=v.boundedPlane.create()),v.boundedPlane.transform(a,this.view.state.camera.viewMatrix,this.slicePlaneViewSpace),this.slicePlaneChanged()):this.slicePlaneViewSpace&&(this.slicePlaneViewSpace=null,this.slicePlaneChanged())};a.prototype.slicePlaneChanged=function(){for(var a=0,c=this.contexts;a<c.length;a++)if(c[a].graphics3DCore.symbolCreationContext.slicePlaneEnabled){this.setDirty();
break}};a.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.graphics[0].active=null;this.graphics[0].visible.clear();this.graphics[0].remove.clear();this.graphics[1].active=null;this.graphics[1].visible.clear();this.graphics[1].remove.clear();this.view=this.iterators=this.graphics=null};a.prototype.addGraphicsOwner=function(a){var c=this,b=this.findDeconflictionContext(a),e;-1!==b?e=this.contexts[b]:(e=new N(a),
this.contexts.push(e),this.setDirtyUrgent());return{addGraphic:function(a){return c.addGraphic(e,a)},removeGraphic:function(a){return c.removeGraphic(e,a)},labelingInfoChange:function(){return c.globalLabelingInfoChanged(e)},visibilityInfoChange:function(){},featureReductionChange:function(){return c.globalFeatureReductionChanged(e)},slicePlaneEnabledChange:function(){return c.globalSlicePlaneEnabledChanged(e)},clear:function(){e.graphics.forEach(function(a){c.removeGraphic(e,a.graphics3DGraphic)})}}};
a.prototype.removeGraphicsOwner=function(a){var c=this;a=this.findDeconflictionContext(a);if(-1!==a){var b=this.contexts.splice(a,1)[0];b.graphics.forEach(function(a){return c.removeGraphic(b,a.graphics3DGraphic)});this.setDirtyUrgent()}};a.prototype.setInitialIconVisibilityFlag=function(a,c){a=!(this.graphicSupportsDeconfliction(c)&&this.isFeatureReductionEnabled(a));c.setVisibilityFlag(3,a,0)};Object.defineProperty(a.prototype,"isDirty",{get:function(){return 0!==this.state||this.dirty},enumerable:!0,
configurable:!0});a.prototype.setDirtyUrgent=function(){this.dirty=!0;this.frameWorker.priority=2};a.prototype.setDirty=function(){this.dirty=!0;this.frameWorker.priority=12};a.prototype.shouldRun=function(){return this.view.ready&&null!=this.view.state&&this.isDirty};a.prototype.run=function(a){switch(this.state){case 0:p.prepare(this.view),this.dirty=!1,this.camera=this.view.state.camera,this.initBins(this.camera.fullWidth,this.camera.fullHeight),this.resetIterators(),a.madeProgress();case 1:if(this.state=
1,!this.processActiveGraphics(0,a))break;case 3:if(this.state=3,!this.cleanVisibleGraphics(0,a))break;case 5:if(this.state=5,!this.sortVisibleGraphics(0,a))break;case 7:this.state=7;if(!this.deconflictVisibleGraphics(0,a))break;p.drawAccelerationStruct(this,this.graphics[0].visible);case 2:if(this.state=2,!this.processActiveGraphics(1,a))break;case 4:if(this.state=4,!this.cleanVisibleGraphics(1,a))break;case 6:if(this.state=6,!this.sortVisibleGraphics(1,a))break;case 8:this.state=8;if(!this.deconflictVisibleGraphics(1,
a))break;p.drawAccelerationStruct(this,this.graphics[1].visible);default:this.state=0}};a.prototype.findDeconflictionContext=function(a){for(var c=0;c<this.contexts.length;c++)if(this.contexts[c].graphics3DCore===a)return c;return-1};a.prototype.globalFeatureReductionChanged=function(a){var c=this.isFeatureReductionEnabled(a.graphics3DCore);c||this.clearVisibilityFlags(a);this.modifyGraphics(a,c,0)};a.prototype.globalLabelingInfoChanged=function(a){var c=this.isLabelDeconflictionEnabled(a.graphics3DCore);
this.modifyGraphics(a,c,1)};a.prototype.globalSlicePlaneEnabledChanged=function(a){var c=a.graphics3DCore.symbolCreationContext.slicePlaneEnabled;a.graphics.forEach(function(a){a.slicePlaneEnabled=c});this.setDirtyUrgent()};a.prototype.modifyGraphics=function(a,c,b){var e=this;c?a.graphics.forEach(function(a){return e.addToActiveGraphics(a,b)}):a.graphics.forEach(function(a){return e.removeFromActiveGraphics(a,b)});this.setDirtyUrgent()};a.prototype.graphicSupportsDeconfliction=function(a){var c=
a._graphics;if(!c||!c.length||a.isDraped())return!1;for(a=0;a<c.length;a++)if(this.graphics3DGraphicsLayerSupportsDeconfliction(c[a]))return!0;return!1};a.prototype.graphics3DGraphicsLayerSupportsDeconfliction=function(a){if(!a||"object3d"!==a.type)return!1;a=a.stageObject;return 1===(a?a.getNumGeometryRecords():0)&&a.getGeometryRecord(0).material instanceof x?!0:!1};a.prototype.addGraphic=function(a,c){var b=c.graphic.uid;c=new U(c,a.graphics3DCore.symbolCreationContext.slicePlaneEnabled);a.graphics.set(b,
c);this.isFeatureReductionEnabled(a.graphics3DCore)&&this.addToActiveGraphics(c,0);this.isLabelDeconflictionEnabled(a.graphics3DCore)&&this.addToActiveGraphics(c,1);this.setDirty()};a.prototype.removeGraphic=function(a,c){c=c.graphic.uid;var b=a.graphics.get(c);b&&(this.removeFromActiveGraphics(b,0),this.removeFromActiveGraphics(b,1),a.graphics.delete(c),this.setDirty())};a.prototype.addToActiveGraphics=function(a,c){a.info[c]=new O;this.graphics[c].active[a.graphics3DGraphic.graphic.uid]=a};a.prototype.removeFromActiveGraphics=
function(a,c){this.removeFromVisibleGraphics(a,c);this.clearGraphicVisibility(a,c);delete a.info[c];delete this.graphics[c].active[a.graphics3DGraphic.graphic.uid]};a.prototype.addToVisibleGraphics=function(a,c){var b=a.info[c];b&&!b.pooled&&(this.graphics[c].visible.push(a),b.pooled=!0)};a.prototype.removeFromVisibleGraphics=function(a,c){var b=a.info[c];b&&b.pooled&&(this.graphics[c].remove.push(a),b.pooled=!1)};a.prototype.processActiveGraphics=function(a,c){for(var b=this.getOrCreateActiveGraphicsIterator(a),
e="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this.camera&&0<this.camera.relativeElevation;!c.done;){c.madeProgress();var f=b.next();if(f.done)return this.resetActiveGraphicsIterator(a),!0;var g=(f=f.value)&&f.info[a];g&&(this.collectGraphics3DGraphics(f,a,e),g.culled?this.removeFromVisibleGraphics(f,a):this.addToVisibleGraphics(f,a))}return!1};a.prototype.cleanVisibleGraphics=function(a,c){for(var b=this.graphics[a],e=this.ensureRemoveGraphicsIterator(a,c);!c.done;){var f=
e.next();c.madeProgress();if(f.done)return b.remove.clear(),this.resetRemoveGraphicsIterator(a),!0}return!1};a.prototype.sortVisibleGraphics=function(a,c){for(var b=this.ensureSortGraphicsIterator(a,function(c,b){return c.info[a]&&b.info[a]?b.info[a].posView-c.info[a].posView:Number.MAX_VALUE},c);!c.done;){var e=b.next();c.madeProgress();if(e.done)return this.resetSortGraphicsIterator(a),!0}return!1};a.prototype.deconflictVisibleGraphics=function(a,c){for(var b=this.getOrCreateVisibleGraphicsIterator(a),
e=1===a;!c.done;){c.madeProgress();var f=b.next();if(f.done)return this.resetVisibleGraphicsIterator(a),!0;var f=f.value,g=f.info[a];if(g&&!g.culled){var d=f.graphics3DGraphic,d=!(e&&!d.isVisible())&&!this.doesIntersectExistingPoly(f,a);(g.visible=d)&&this.addToBins(f,a);this.setGraphicVisibility(f,a,d);d&&p.drawPoly(g,d?"green":"red")}}return!1};a.prototype.resetIterators=function(){this.iterators[0].active=null;this.iterators[0].visible=null;this.iterators[0].remove=null;this.iterators[0].sort=
null;this.iterators[1].active=null;this.iterators[1].visible=null;this.iterators[1].remove=null;this.iterators[1].sort=null};a.prototype.getOrCreateActiveGraphicsIterator=function(a){var c=this.graphics[a];a=this.iterators[a];a.active||(a.active=C(c.active));return a.active};a.prototype.resetActiveGraphicsIterator=function(a){this.iterators[a].active=null};a.prototype.getOrCreateVisibleGraphicsIterator=function(a){var c=this.graphics[a];a=this.iterators[a];a.visible||(a.visible=c.visible.iterableForEach());
return a.visible};a.prototype.resetVisibleGraphicsIterator=function(a){this.iterators[a].visible=null};a.prototype.ensureRemoveGraphicsIterator=function(a,c){var b=this.graphics[a];a=this.iterators[a];a.remove||(a.remove=b.visible.iterableRemoveMany(b.remove.data,function(){return c.done}));return a.remove};a.prototype.resetRemoveGraphicsIterator=function(a){this.iterators[a].remove=null};a.prototype.ensureSortGraphicsIterator=function(a,c,b){var e=this.graphics[a];a=this.iterators[a];a.sort||(a.sort=
e.visible.iterableSort(c,function(){return b.done}));return a.sort};a.prototype.resetSortGraphicsIterator=function(a){this.iterators[a].sort=null};a.prototype.collectGraphics3DGraphics=function(a,c,b){var e=a.graphics3DGraphic;if(!e.destroyed){var f=1===c,g=f?e._labelGraphics:e._graphics,f=f?0:this.iconMarginFactor;c=a.info[c];if(e.isVisible(0,3)){for(var e=h.empty(Q),d,p,l=0;l<g.length;l++){var x=g[l];if(this.graphics3DGraphicsLayerSupportsDeconfliction(x)){var C=x.stageObject,q=C.getGeometryRecord(0),
J=q.material,R=this.camera,O=q.geometry.data.getVertexAttr();if(b&&(F.radius=u.earthRadius,k.vec3.sub(K.direction,C.getCenter(),this.camera.eye),k.vec3.copy(K.origin,this.camera.eye),y.intersectRay(F,K,M))){var t=1-Math.abs(Math.tan(k.vec3.angle(C.getCenter(),K.direction)))/this.view.width,t=Math.pow(t,4),T=k.vec3.sqrDist(this.camera.eye,M),U=k.vec3.sqrDist(this.camera.eye,C.getCenter());if(t*U>T){c.culled=!0;return}}if(!p){p=C.getCenter();q=q.origin.vec3;A.transformToWorld(p,q,B);A.transformToView(B,
q,R.viewMatrix,E);J.applyVerticalOffsetTransformation(E,O[m.VertexAttrConstants.NORMAL].data,C.objectTransformation,R,V);if(a.slicePlaneEnabled&&this.slicePlaneViewSpace&&v.boundedPlane.extrusionContainsPoint(this.slicePlaneViewSpace,E)){c.culled=!0;return}C=O[m.VertexAttrConstants.AUXPOS1].data;O="screen"!==J.getParameters().centerOffsetUnits;A.transformToProjection(E,R.projectionMatrix,O?C:L,I);p=A.transformToNDC(I,G);O||(p[0]+=C[0]/R.fullWidth*2,p[1]+=C[1]/R.fullHeight*2);if(-1>p[0]||-1>p[1]||
-1>p[2]||1<=p[0]||1<=p[1])break;d=E[2];!n.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&c.visible&&(d*=.7)}x=x.getScreenSize(X);x[0]*=R.pixelRatio;x[1]*=R.pixelRatio;w.applyPrecomputedScaleFactorVec2(x,V.factor,x);J=h.offset(J.calculateRelativeScreenBounds(x,V.factorAlignment.scale,P),r.lerp(0,R.fullWidth,.5+.5*p[0]),r.lerp(0,R.fullHeight,.5+.5*p[1]));0!==f&&(R=f*Math.min(h.width(J),h.height(J)),J[0]-=R,J[1]-=R,J[2]+=R,J[3]+=R);h.expand(e,J)}}null==d?c.culled=!0:(c.xMin=e[0],c.yMin=e[1],c.xMax=e[2],c.yMax=
e[3],c.posView=d,c.culled=!1)}else c.culled=!0}};a.prototype.doesIntersectExistingPoly=function(a,c){var b=a.graphics3DGraphic.graphic.uid;a=a.info[c];for(var e=Math.floor(a.xMin/this.accBinsSizeX);e<=Math.floor(a.xMax/this.accBinsSizeX);e++)if(!(0>e||e>=this.accBinsNumX))for(var f=Math.floor(a.yMin/this.accBinsSizeY);f<=Math.floor(a.yMax/this.accBinsSizeY);f++)if(!(0>f||f>=this.accBinsNumY))for(var g=this.accBins[e][f],d=0;d<g.length;d++){var h=g.data[d],m=h.info[c];if(m&&m.visible&&h.graphics3DGraphic.graphic.uid!==
b&&(this.accNumTests++,!(m.xMin>a.xMax||m.xMax<a.xMin||m.yMin>a.yMax||m.yMax<a.yMin)))return!0}return!1};a.prototype.initBins=function(a,c){if(null==this.accBins){this.accBins=[];for(var e=0;e<this.accBinsNumX;e++){this.accBins.push([]);for(var f=this.accBins[this.accBins.length-1],g=0;g<this.accBinsNumY;g++)f.push(new b)}}for(e=0;e<this.accBinsNumX;e++)for(g=0;g<this.accBinsNumY;g++)this.accBins[e][g].clear();this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=c/this.accBinsNumY;this.accNumTests=
0};a.prototype.addToBins=function(a,c){c=a.info[c];for(var b=Math.floor(c.xMin/this.accBinsSizeX);b<=Math.floor(c.xMax/this.accBinsSizeX);b++)if(!(0>b||b>=this.accBinsNumX))for(var e=Math.floor(c.yMin/this.accBinsSizeY);e<=Math.floor(c.yMax/this.accBinsSizeY);e++)0>e||e>=this.accBinsNumY||this.accBins[b][e].push(a)};a.prototype.isFeatureReductionEnabled=function(a){a=a.layer;return!(!a||!a.featureReduction||"selection"!==a.featureReduction.type)};a.prototype.isLabelDeconflictionEnabled=function(a){return a.labelsEnabled};
a.prototype.clearVisibilityFlags=function(a){(a=a.graphics3DCore.graphics3DGraphics)&&a.forEach(function(a){return a.clearVisibilityFlag(3)})};a.prototype.setGraphicVisibility=function(a,c,b){a=a.graphics3DGraphic;a.destroyed||(a.setVisibilityFlag(3,b,c),1===c&&this.view.labeler.setLabelGraphicVisibility(a,b))};a.prototype.clearGraphicVisibility=function(a,c){a=a.graphics3DGraphic;a.destroyed||a.clearVisibilityFlag(3,c)};return a}();d.Deconflictor=t;var V={factor:{scale:0,factor:0,minPixelSize:0,
paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},X=e.vec2f64.create()})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/debugFlags"],function(t,d,q,g){function l(c,a,b,f,g){var d=e.height,h=k;h.beginPath();h.lineWidth=1;h.strokeStyle=g;h.moveTo(c,d-b);h.lineTo(a,d-b);h.stroke();h.lineTo(a,d-f);h.stroke();h.lineTo(a,d-b);h.stroke();h.lineTo(c,d-b);h.stroke();h.lineTo(c,
d-b);h.stroke();h.closePath()}Object.defineProperty(d,"__esModule",{value:!0});var b=!1,f=!1,e,k;d.drawAccelerationStruct=function(c,a){if(f&&k){for(var b=k,e=0,g=0;g<c.accBinsNumX;g++)for(var d=0;d<c.accBinsNumY;d++){var v=c.accBins[g][c.accBinsNumY-1-d],e=e+v.length,r=g*c.accBinsSizeX,y=(g+1)*c.accBinsSizeX,w=d*c.accBinsSizeY,m=(d+1)*c.accBinsSizeY;b.fillText(v.length.toFixed(),r+5,w+15);l(r,y,w,m,"blue")}b.fillText("total totalShownLabels: "+e,70,40);b.fillText("total visible labels: "+a.length,
70,50);b.fillText("total numTests: "+c.accNumTests,70,30)}};d.prepare=function(c){b=g.DECONFLICTOR_SHOW_OUTLINES;f=g.DECONFLICTOR_SHOW_GRID;if(b||f){null==e&&(e=document.createElement("canvas"),e.setAttribute("id","canvas2d"),c.surface.parentElement.style.position="relative",c.surface.parentElement.appendChild(e));var a=c.height*c.pixelRatio;e.setAttribute("width",c.width*c.pixelRatio+"px");e.setAttribute("height",a+"px");e.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:"+
c.width+"px;height:"+c.height+"px");k=e.getContext("2d");k.clearRect(0,0,c.width,c.height);k.font="12px Arial"}};d.drawPoly=function(c,a){b&&l(c.xMin,c.xMax,c.yMin,c.yMax,a)}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(t,d,q,g,l,b){return new (function(f){function e(){var b=null!==f&&f.apply(this,arguments)||
this;b.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;b.SCENEVIEW_LOCKING_LOG=!1;b.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;b.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;b.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;b.DECONFLICTOR_SHOW_OUTLINES=!1;b.DECONFLICTOR_SHOW_GRID=!1;b.LABELS_SHOW_BORDER=!1;b.OVERLAY_DRAW_TEST_TEXTURE=!1;b.OVERLAY_SHOW_CENTER=!1;b.TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING=!1;b.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1;b.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1;b.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=
!1;b.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;b.DRAW_MESH_GEOMETRY_NORMALS=!1;b.FEATURE_TILE_FETCH_SHOW_TILES=!1;b.FEATURE_TILE_TREE_SHOW_TILES=!1;b.ENABLE_PROFILE_DEPTH_RANGE=!1;b.DISABLE_FAST_UPDATES=!1;b.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;b.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;return b}q(e,f);g([b.property()],e.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);g([b.property()],e.prototype,"SCENEVIEW_LOCKING_LOG",void 0);g([b.property()],e.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",
void 0);g([b.property()],e.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);g([b.property()],e.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);g([b.property()],e.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);g([b.property()],e.prototype,"DECONFLICTOR_SHOW_GRID",void 0);g([b.property()],e.prototype,"LABELS_SHOW_BORDER",void 0);g([b.property()],e.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);g([b.property()],e.prototype,"OVERLAY_SHOW_CENTER",void 0);g([b.property()],e.prototype,"TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING",
void 0);g([b.property()],e.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0);g([b.property()],e.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);g([b.property()],e.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0);g([b.property()],e.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);g([b.property()],e.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);g([b.property()],e.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);g([b.property()],e.prototype,"FEATURE_TILE_TREE_SHOW_TILES",
void 0);g([b.property()],e.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);g([b.property()],e.prototype,"DISABLE_FAST_UPDATES",void 0);g([b.property()],e.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);g([b.property()],e.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);return e=g([b.subclass()],e)}(b.declared(l)))})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","../../support/earthUtils","../../support/mathUtils"],function(t,
d,q,g){function l(a){return Math.abs(a*a*a)}function b(a,c,b,e){void 0===e&&(e=h);var f=b.parameters;b=b.paddingPixelsOverride;e.scale=Math.min(f.divisor/(c-f.offset),1);e.factor=l(a);e.minPixelSize=f.minPixelSize;e.paddingPixels=b;return e}function f(a,c){return 0===a?c.minPixelSize:c.minPixelSize*(1+2*c.paddingPixels/a)}function e(a,c){return Math.max(g.lerp(a*c.scale,a,c.factor),f(a,c))}function k(a,c,f){a=b(a,c,f);a.minPixelSize=0;a.paddingPixels=0;return e(1,a)}Object.defineProperty(d,"__esModule",
{value:!0});d.getSettings=function(a){return new c(a,d.defaultDescription)};d.getLabelSettings=function(b){var e=d.defaultDescription.curvatureDependent;return new c(b,{curvatureDependent:{min:{curvature:e.min.curvature,tiltAngle:e.min.tiltAngle,scaleFallOffFactor:a.curvatureDependent.min.scaleFallOffFactor},max:{curvature:e.max.curvature,tiltAngle:e.max.tiltAngle,scaleFallOffFactor:a.curvatureDependent.max.scaleFallOffFactor}},scaleStart:d.defaultDescription.scaleStart,scaleFallOffRange:d.defaultDescription.scaleFallOffRange,
minPixelSize:a.minPixelSize})};d.perspectiveFactor=l;d.scaleFactor=b;d.applyScaleFactor=e;d.applyScaleFactorVec2=function(a,c,b){void 0===b&&(b=[0,0]);var e=Math.min(Math.max(c.scale,f(a[1],c)/a[1]),1);b[0]=g.lerp(a[0]*e,a[0],c.factor);b[1]=g.lerp(a[1]*e,a[1],c.factor);return b};d.precomputeScale=k;d.precomputeScaleFactor=function(a,c,b,e){e.scale=k(a,c,b);e.factor=0;e.minPixelSize=b.parameters.minPixelSize;e.paddingPixels=b.paddingPixelsOverride;return e};d.applyPrecomputedScaleFactorVec2=function(a,
c,b){void 0===b&&(b=[0,0]);c=Math.min(Math.max(c.scale,f(a[1],c)/a[1]),1);b[0]=a[0]*c;b[1]=a[1]*c;return b};d.scale=function(a,c,f,g){return e(a,b(c,f,g))};var c=function(){function a(a,c,b,e){void 0===b&&(b={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=c;this.parameters=b;this._paddingPixelsOverride=e;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=
this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===
a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};a.prototype.overridePadding=function(c){return c!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,c):this};a.prototype.calculateParameters=function(a,c){var b=this.description,e=b.scaleStart,f=b.scaleFallOffRange,b=b.minPixelSize,g=a.fovY,d=a.distance,h=this.calculateCurvatureDependentParameters(a),k=this.coverageCompensation(a,h),p=h.tiltAngle,h=h.scaleFallOffFactor,d=Math.sin(p)*d,p=.5*
Math.PI-p-g*(.5-e*k),e=d/Math.cos(p),f=(e-d/Math.cos(p+g*f*k)*h)/(1-h);c.camera.fovY=a.fovY;c.camera.distance=a.distance;c.offset=f;c.divisor=e-f;c.minPixelSize=b;return c};a.prototype.calculateCurvatureDependentParametersLocal=function(a,c){void 0===c&&(c=p);c.tiltAngle=this.description.curvatureDependent.min.tiltAngle;c.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return c};a.prototype.calculateCurvatureDependentParametersGlobal=function(a,c){void 0===c&&(c=p);var b=
this.description.curvatureDependent;a=1+a.distance/q.earthRadius;var e=[b.min.curvature,b.max.curvature],f=e[0];a=g.clamp((Math.sqrt(a*a-1)-f)/(e[1]-f),0,1);e=[b.min,b.max];b=e[0];e=e[1];c.tiltAngle=g.lerp(b.tiltAngle,e.tiltAngle,a);c.scaleFallOffFactor=g.lerp(b.scaleFallOffFactor,e.scaleFallOffFactor,a);return c};a.prototype.surfaceCoverageCompensationLocal=function(a,c){return(a.fovY-c.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,c){var b=q.earthRadius*q.earthRadius;
c=c.tiltAngle+.5*Math.PI;var e=a.fovY;a=a.distance;a=a*a+b-2*Math.cos(c)*a*q.earthRadius;var f=Math.sqrt(a);return(Math.acos(Math.sqrt(a-b)/f)-Math.asin(q.earthRadius/(f/Math.sin(c)))+.5*e)/e};return a}();d.defaultDescription={curvatureDependent:{min:{curvature:g.deg2rad(10),tiltAngle:g.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:g.deg2rad(70),tiltAngle:g.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var a={curvatureDependent:{min:{scaleFallOffFactor:.7},
max:{scaleFallOffFactor:.95}},minPixelSize:14};d.copyParameters=function(a,c){c.camera.distance=a.camera.distance;c.camera.fovY=a.camera.fovY;c.divisor=a.divisor;c.offset=a.offset;c.minPixelSize=a.minPixelSize;return c};var h={scale:0,factor:0,minPixelSize:0,paddingPixels:0},p={tiltAngle:0,scaleFallOffFactor:0}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterialTexture ../lib/Material ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/HUDPrograms ../../../webgl/renderState".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E){function I(a,c,b){a.setUniform1f("cameraGroundRelative",b.cameraAboveGround?1:-1);a.setUniform1f("polygonOffset",c.shaderPolygonOffset);a.setUniform4fv("viewport",b.viewport);a.setUniform1f("perDistancePixelRatio",Math.tan(b.fovY/2)/(b.viewport[2]/2));A.bindVerticalOffset(c.verticalOffset,b,a);a.setUniformMatrix4fv("viewNormal",b.viewInvTransp);c.screenSizePerspective&&(A.bindScreenSizePerspective(c.screenSizePerspective,a,"screenSizePerspective"),
A.bindScreenSizePerspective(c.screenSizePerspectiveAlignment||c.screenSizePerspective,a,"screenSizePerspectiveAlignment"))}function G(a,c,b,e){b.occlusionTest&&(c.setUniform1i("hudVisibilityTexture",1),a.bindTexture(e.hudVisibilityTexture,1),a.setActiveTexture(0));c.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===e.renderTransparentlyOccludedHUD?1:"notOccluded"===e.renderTransparentlyOccludedHUD?0:.75);a=e.pixelRatio||1;c.setUniform4fv("overrideColor",b.color);c.setUniform1f("pixelRatio",
a);b.textureIsSignedDistanceField&&(c.setUniform4fv("outlineColor",b.outlineColor),c.setUniform1f("outlineSize",b.outlineSize));b.vvSizeEnabled&&(c.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),c.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),c.setUniform3fv("vvSizeOffset",b.vvSizeOffset),c.setUniform3fv("vvSizeFactor",b.vvSizeFactor));b.vvColorEnabled&&(c.setUniform1fv("vvColorValues",b.vvColorValues),c.setUniform4fv("vvColorColors",b.vvColorColors));c.setUniform2f("screenOffset",2*b.screenOffset[0]*
a,2*b.screenOffset[1]*a);c.setUniform2fv("anchorPos",L(b))}function L(a,c){void 0===c&&(c=Q);if(a.textureIsSignedDistanceField){var b=a.anchorPos;a=a.distanceFieldBoundingBox;var e=c;e[0]=b[0]*(a[2]-a[0])+a[0];e[1]=b[1]*(a[3]-a[1])+a[1]}else k.vec2.copy(c,a.anchorPos);return c}t=function(c){function b(a,b){b=c.call(this,b)||this;b.params=A.copyParameters(a,ia);return b}q(b,c);b.prototype.dispose=function(){};b.prototype.setParameterValues=function(a){for(var c in a)"textureId"===c&&m.assert(!!this.params.textureId,
"Can only change texture of material that already has a texture"),this.params[c]=a[c];this.notifyDirty("matChanged")};b.prototype.getParameters=function(){return this.params};b.prototype.intersect=function(a,c,b,e,f,g,d,h,m){m?this.intersectDrapedRenderHudGeometry(a,c,b,e,f,g,d,h):this.intersectHudGeometry(a,c,b,e,f,g,d,h)};b.prototype.intersectDrapedRenderHudGeometry=function(c,b,e,f,g,d,h,k){b=c.getAttribute(m.VertexAttrConstants.POSITION);e=c.getAttribute(m.VertexAttrConstants.SIZE);f=this.params;
g=L(f);var p=1,n=1;k&&(n=k(W),p=n[0],n=n[5]);p*=c.pixelRatio;n*=c.pixelRatio;k=fa*c.pixelRatio;for(var l=0;l<b.data.length/b.size;l++){var r=l*b.size;a.vec3.set(P,b.data[r],b.data[r+1],b.data[r+2]);r=l*e.size;ga[0]=e.data[r]*p;ga[1]=e.data[r+1]*n;var r=P[0],v=P[1],x=void 0;f.textureIsSignedDistanceField&&(x=f.outlineSize*c.pixelRatio/2);this._isInsideIconBoundaries(d,r,v,k,x,f,g)&&h()}};b.prototype.intersectHudGeometry=function(c,b,e,g,d,k,p,n){if(g.enable.selectionMode&&g.enable.hud&&!v.isAllHidden(b.componentVisibilities,
c.componentOffsets)){var r=c.data;c=this.params;d=b=1;l.mat3.fromMat4(X,e);if(n){d=n(W);b=d[0];d=d[5];n=X;k=n[0];var x=n[1],u=n[2],A=n[3],y=n[4],C=n[5],q=n[6],B=n[7],E=n[8],F=1/Math.sqrt(k*k+x*x+u*u),K=1/Math.sqrt(A*A+y*y+C*C),Q=1/Math.sqrt(q*q+B*B+E*E);n[0]=k*F;n[1]=x*F;n[2]=u*F;n[3]=A*K;n[4]=y*K;n[5]=C*K;n[6]=q*Q;n[7]=B*Q;n[8]=E*Q}n=r.getVertexAttr()[m.VertexAttrConstants.POSITION];k=r.getVertexAttr()[m.VertexAttrConstants.SIZE];x=r.getVertexAttr()[m.VertexAttrConstants.NORMAL];r=r.getVertexAttr()[m.VertexAttrConstants.AUXPOS1];
m.assert(3<=n.size);u=g.point;A=g.camera;y=L(c);b*=A.pixelRatio;d*=A.pixelRatio;C="screen"===this.params.centerOffsetUnits;for(q=0;q<n.data.length/n.size;q++)B=q*n.size,a.vec3.set(P,n.data[B],n.data[B+1],n.data[B+2]),a.vec3.transformMat4(P,P,e),B=q*k.size,ga[0]=k.data[B]*b,ga[1]=k.data[B+1]*d,a.vec3.transformMat4(P,P,A.viewMatrix),B=q*r.size,a.vec3.set(R,r.data[B+0],r.data[B+1],r.data[B+2]),C||(P[0]+=R[0],P[1]+=R[1],0!==R[2]&&(B=R[2],a.vec3.normalize(R,P),a.vec3.subtract(P,P,a.vec3.scale(R,R,B)))),
B=q*x.size,a.vec3.set(O,x.data[B],x.data[B+1],x.data[B+2]),this.applyVerticalOffsetTransformation(P,O,X,A,M),A.applyProjection(P,U),-1<U[0]&&(B=Math.floor(U[0])+this.params.screenOffset[0],E=Math.floor(U[1])+this.params.screenOffset[1],C&&(B+=R[0],0!==R[1]&&(E+=w.applyScaleFactor(R[1],M.factorAlignment))),w.applyPrecomputedScaleFactorVec2(ga,M.factor,ga),F=Z*A.pixelRatio,K=void 0,c.textureIsSignedDistanceField&&(K=c.outlineSize*A.pixelRatio/2),this._isInsideIconBoundaries(u,B,E,F,K,c,y)&&(E=g.ray,
a.vec3.transformMat4(V,P,f.mat4.invert(J,A.viewMatrix)),U[0]=u[0],U[1]=u[1],A.unprojectPoint(U,P),B=h.vec3f64.create(),a.vec3.copy(B,E.direction),F=1/a.vec3.length(B),a.vec3.scale(B,B,F),E=a.vec3.distance(E.origin,P)*F,p(E,B,-1,1,!0,V)))}};b.prototype._isInsideIconBoundaries=function(a,c,b,e,f,g,d){c=c-e-(0<d[0]?ga[0]*d[0]:0);var h=c+ga[0]+2*e;b=b-e-(0<d[1]?ga[1]*d[1]:0);e=b+ga[1]+2*e;g.textureIsSignedDistanceField&&(g=g.distanceFieldBoundingBox,c+=ga[0]*g[0],b+=ga[1]*g[1],h-=ga[0]*(1-g[2]),e-=ga[1]*
(1-g[3]),c-=f,h+=f,b-=f,e+=f);return a[0]>c&&a[0]<h&&a[1]>b&&a[1]<e};b.prototype.createBufferWriter=function(){return new da(this)};b.prototype.createRenderer=function(a,c){return new C(a,c,this)};b.prototype.normalAndViewAngle=function(c,b,e,f){void 0===f&&(f=T);a.vec3.transformMat3(f.normal,c,b);a.vec3.transformMat4(f.normal,f.normal,e.viewInverseTransposeMatrix);f.cosAngle=a.vec3.dot(N,ja);return f};b.prototype.updateScaleInfo=function(a,c,b){c=this.params;c.screenSizePerspective?a.factor=w.precomputeScaleFactor(T.cosAngle,
b,c.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);c.screenSizePerspectiveAlignment?a.factorAlignment=w.precomputeScaleFactor(T.cosAngle,b,c.screenSizePerspectiveAlignment,a.factorAlignment):(a.factorAlignment.factor=a.factor.factor,a.factorAlignment.scale=a.factor.scale,a.factorAlignment.minPixelSize=a.factor.minPixelSize,a.factorAlignment.paddingPixels=a.factor.paddingPixels)};b.prototype.applyVerticalOffsetTransformation=function(c,
b,e,f,g,d){var h=this.params;p.isMat4(e)&&(e=l.mat3.fromMat4(X,e));if(!h.verticalOffset||!h.verticalOffset.screenLength)return g&&(h.screenSizePerspective||h.screenSizePerspectiveAlignment)?(f=this.normalAndViewAngle(b,e,f),h=a.vec3.length(c),this.updateScaleInfo(g,f.cosAngle,h)):g&&(g.factor.scale=1,g.factorAlignment.scale=1),d?a.vec3.copy(d,c):c;b=this.normalAndViewAngle(b,e,f);e=a.vec3.length(c);f=A.verticalOffsetAtDistance(f,e,h.verticalOffset,b.cosAngle,h.screenSizePerspectiveAlignment||h.screenSizePerspective);
g&&this.updateScaleInfo(g,b.cosAngle,e);return a.vec3.add(d||c,c,a.vec3.scale(b.normal,b.normal,f))};b.prototype.getGLMaterials=function(){return{color:F,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:K}};b.prototype.getAllTextureIds=function(){return[this.params.textureId]};b.prototype.calculateRelativeScreenBounds=function(a,c,b){void 0===b&&(b=n.create());var e=this.params,f=b;void 0===f&&(f=Q);k.vec2.copy(f,e.anchorPos);f[0]*=-a[0];f[1]*=-a[1];f[0]+=e.screenOffset[0]*c;f[1]+=e.screenOffset[1]*
c;b[2]=b[0]+a[0];b[3]=b[1]+a[1];return b};b.prototype.calculateAnchorPosForRendering=function(a){return L(this.params,a)};b.shouldRenderVisibilityDuringRenderPass=function(a){return 0===a||4};return b}(y);var F=function(a){function c(c,b,e){c=a.call(this,c,b,e,c.getParameters().textureId)||this;c.isOcclusionSlot=!1;c.updateParameters();return c}q(c,a);c.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?16:15};c.prototype.selectProgram=function(){var a=this.params;this.occlusionProgram=
this.programRep.getProgram(B.occlusionPass,{verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.renderProgram=this.programRep.getProgram(B.colorPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,vvColor:!!a.vvColorEnabled,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,
debugDrawBorder:!!a.debugDrawBorder,slice:a.slicePlaneEnabled});this.renderPipelineState=E.makePipelineState({blending:E.simpleBlendingParams(1,771),polygonOffset:a.polygonOffset&&Y,depthTest:{func:515},depthWrite:E.defaultDepthWriteParams,colorWrite:E.defaultColorWriteParams});this.occlusionPipelineState=E.makePipelineState({depthTest:{func:515},depthWrite:E.defaultDepthWriteParams,colorWrite:E.defaultColorWriteParams})};c.prototype.beginSlot=function(a){if(this.params.occlusionTest)return this.isOcclusionSlot=
10===a,10===a||a===this.mainSlot;this.isOcclusionSlot=!1;return a===this.mainSlot};c.prototype.getProgram=function(){return this.isOcclusionSlot?this.occlusionProgram:this.renderProgram};c.prototype.getPrograms=function(){return[this.occlusionProgram,this.renderProgram]};c.prototype.updateParameters=function(){this.params=A.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram();this.selectSlot()};c.prototype.bind=function(a,c){if(this.isOcclusionSlot){var b=
this.occlusionProgram;a.bindProgram(b);a.setPipelineState(this.occlusionPipelineState);I(b,this.params,c);b.setUniform4f("color",1,1,1,1);b.setUniform1f("pixelRatio",c.pixelRatio||1)}else b=this.renderProgram,a.bindProgram(b),a.setPipelineState(this.renderPipelineState),this.bindTexture(a,b),this.bindTextureScale(a,b),I(b,this.params,c),G(a,b,this.params,c)};c.prototype.bindView=function(a,c){a=c.origin;var b=this.getProgram();A.bindView(a,c.view,b);A.bindCamPos(a,c.viewInvTransp,b);this.params.slicePlaneEnabled&&
A.bindSlicePlane(c.origin,c.slicePlane,b)};c.prototype.bindInstance=function(a,c){a=this.getProgram();a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};c.prototype.release=function(a){};c.prototype.getDrawMode=function(){return this.isOcclusionSlot?0:4};return c}(r),K=function(a){function c(c,b,e){c=a.call(this,c,b,e,c.getParameters().textureId)||this;c.updateParameters();return c}q(c,a);c.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?
16:15};c.prototype.beginSlot=function(a){return a===this.mainSlot};c.prototype.getProgram=function(){return this.program};c.prototype.updateParameters=function(){this.params=A.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram();this.selectSlot()};c.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(B.highlightPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,
vvColor:!!a.vvColorEnabled,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,binaryHighlightOcclusion:a.binaryHighlightOcclusion,slice:a.slicePlaneEnabled});this.pipelineState=E.makePipelineState({blending:E.separateBlendingParams(1,1,771,771),polygonOffset:a.polygonOffset&&Y,depthTest:{func:513},colorWrite:E.defaultColorWriteParams})};c.prototype.bind=function(a,c){var b=this.program;a.bindProgram(b);a.setPipelineState(this.pipelineState);
this.bindTexture(a,b);this.bindTextureScale(a,b);I(b,this.params,c);G(a,b,this.params,c);A.bindHighlightRendering(a,c,this.program)};c.prototype.bindView=function(a,c){a=c.origin;var b=this.getProgram();A.bindView(a,c.view,b);A.bindCamPos(a,c.viewInvTransp,b);this.params.slicePlaneEnabled&&A.bindSlicePlane(c.origin,c.slicePlane,b)};c.prototype.bindInstance=function(a,c){a=this.getProgram();a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};
c.prototype.release=function(a){};c.prototype.getDrawMode=function(){return 4};return c}(r),M={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},Q=c.vec2f64.create(),P=h.vec3f64.create(),O=h.vec3f64.create(),U=g.createRenderScreenPointArray3(),N=h.vec3f64.create(),V=h.vec3f64.create(),X=b.mat3f64.create(),J=e.mat4f64.create(),R=h.vec3f64.create(),T={normal:N,cosAngle:0},W=e.mat4f64.create();f.mat4.identity(W);var Z=1,fa=2,ga=
[0,0],ja=h.vec3f64.fromValues(0,0,1),ia={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,
screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:c.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},ka=u.newLayout().vec3f(m.VertexAttrConstants.POSITION).vec3f(m.VertexAttrConstants.NORMAL).vec2f(m.VertexAttrConstants.UV0).vec4u8(m.VertexAttrConstants.COLOR).vec2f(m.VertexAttrConstants.SIZE).vec4f(m.VertexAttrConstants.AUXPOS1).vec4f(m.VertexAttrConstants.AUXPOS2),da=function(){function a(a){this.material=
a;this.vertexBufferLayout=ka}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[m.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,b,e,f){x.writePosition(c.indices[m.VertexAttrConstants.POSITION],c.vertexAttr[m.VertexAttrConstants.POSITION].data,a.transformation,e.position,f,6);x.writeNormal(c.indices[m.VertexAttrConstants.NORMAL],c.vertexAttr[m.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,
e.normal,f,6);a=c.vertexAttr[m.VertexAttrConstants.UV0].data;var g=void 0,d=void 0,h=void 0,k=void 0;null==a||4>a.length?(a=this.material.getParameters(),d=g=0,h=a.texCoordScale[0],k=a.texCoordScale[1]):(g=a[0],d=a[1],h=a[2],k=a[3]);var h=Math.min(1.99999,h+1),k=Math.min(1.99999,k+1),p=c.indices[m.VertexAttrConstants.POSITION].length,n=e.uv0;a=f;for(b=0;b<p;++b)n.set(a,0,g),n.set(a,1,d),a+=1,n.set(a,0,h),n.set(a,1,d),a+=1,n.set(a,0,h),n.set(a,1,k),a+=1,n.set(a,0,h),n.set(a,1,k),a+=1,n.set(a,0,g),
n.set(a,1,k),a+=1,n.set(a,0,g),n.set(a,1,d),a+=1;x.writeColor(c.indices[m.VertexAttrConstants.COLOR],c.vertexAttr[m.VertexAttrConstants.COLOR].data,4,e.color,f,6);g=c.indices[m.VertexAttrConstants.SIZE];d=c.vertexAttr[m.VertexAttrConstants.SIZE].data;h=g.length;k=e.size;a=f;for(b=0;b<h;++b)for(var p=d[2*g[b]],n=d[2*g[b]+1],l=0;6>l;++l)k.set(a,0,p),k.set(a,1,n),a+=1;c.indices[m.VertexAttrConstants.AUXPOS1]&&c.vertexAttr[m.VertexAttrConstants.AUXPOS1]&&x.writeBufferVec4(c.indices[m.VertexAttrConstants.AUXPOS1],
c.vertexAttr[m.VertexAttrConstants.AUXPOS1].data,e.auxpos1,f,6);c.indices[m.VertexAttrConstants.AUXPOS2]&&c.vertexAttr[m.VertexAttrConstants.AUXPOS2]&&x.writeBufferVec4(c.indices[m.VertexAttrConstants.AUXPOS2],c.vertexAttr[m.VertexAttrConstants.AUXPOS2].data,e.auxpos2,f,6)};return a}(),Y={factor:0,units:-4};return t})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["require","exports"],function(t,d){function q(g){return g instanceof Float32Array&&16<=g.length}function g(g){return Array.isArray(g)&&
16<=g.length}Object.defineProperty(d,"__esModule",{value:!0});d.isMat4f32=q;d.isMat4f64=g;d.isMat4=function(d){return q(d)||g(d)}})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./DefaultTextureUnits ./GLMaterial ../materials/internal/MaterialUtil".split(" "),function(t,d,q,g,l,b){return function(f){function e(e,c,a,g,d,n){void 0===n&&(n=!1);e=f.call(this,e,c)||this;e.textureRep=a;e.textureId=g;e.initTransparent=n;e.glTextureRef=
b.aquireIfNotUndefined(e.textureId,a,e.initTransparent);d&&(e.glTextureRefNormal=b.aquireIfNotUndefined(d,a,e.initTransparent));return e}q(e,f);e.prototype.dispose=function(){b.releaseIfNotUndefined(this.textureId,this.textureRep)};e.prototype.updateTexture=function(e){e!==this.textureId&&(b.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=e,this.glTextureRef=b.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))};e.prototype.bindTexture=function(b,c){null!=
this.glTextureRef&&(c.setUniform1i("tex",g.DefaultTextureUnits.DIFFUSE),b.bindTexture(this.glTextureRef.getGLTexture(),g.DefaultTextureUnits.DIFFUSE),this.glTextureRefNormal&&(c.setUniform1i("texNormal",g.DefaultTextureUnits.NORMAL),b.bindTexture(this.glTextureRefNormal.getGLTexture(),g.DefaultTextureUnits.NORMAL)))};e.prototype.bindTextureSize=function(b,c){null!=this.glTextureRef&&(b=this.glTextureRef.getGLTexture(),c.setUniform2f("texSize",b.descriptor.width,b.descriptor.height))};e.prototype.bindTextureScale=
function(b,c){(b=this.glTextureRef&&this.glTextureRef.getGLTexture())&&b.descriptor.textureCoordinateScaleFactor?c.setUniform2fv("textureCoordinateScaleFactor",b.descriptor.textureCoordinateScaleFactor):c.setUniform2f("textureCoordinateScaleFactor",1,1)};return e}(l)})},"esri/views/3d/webgl-engine/lib/DefaultTextureUnits":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.DefaultTextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2}})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","./ManagingDisposable"],function(t,d,q,g){return function(g){function b(b,e){var f=g.call(this)||this;f.material=b;f.programRep=e;return f}q(b,g);b.prototype.isVisible=function(){return this.material.isVisible()};b.prototype.isVisibleInPass=function(b){return this.material.isVisibleInPass(b)};b.prototype.getPrograms=function(){return[this.getProgram()]};b.prototype.getDrawMode=function(){return 4};b.prototype.release=function(b,e){};return b}(g.ManagingDisposable)})},
"esri/views/3d/webgl-engine/lib/ManagingDisposable":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(){}d.prototype.dispose=function(){var g=this;(this.__proto__.__managedDisposables__||[]).forEach(function(d){g[d]&&(g[d].dispose(),g[d]=void 0)})};return d}();d.ManagingDisposable=t;d.manageDisposal=function(){return function(d,g){d.__managedDisposables__=d.__managedDisposables__||[];d.__managedDisposables__.push(g)}}})},
"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../../../geometry/support/aaBoundingBox ../../../support/mathUtils ../../lib/ComponentUtils ../../lib/doublePrecisionUtils ../../lib/screenSizePerspectiveUtils ../../lib/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n){function u(a,c,b,e,f){var g=y(c,b,E);k.setMin(C,a.getBBMin());k.setMax(C,a.getBBMax());if(w(C,c,g,e)){var g=a.getPrimitiveIndices(),d=a.getIndices(),h=a.getPosition(),m=g?g.length:d.length/3;if(m>O&&(a=a.getChildren(),void 0!==a)){for(g=0;8>g;++g)void 0!==a[g]&&u(a[g],c,b,e,f);return}v(c,b,0,m,d,h,g,f)}}function v(a,c,b,e,f,g,d,h){if(d){var m=g.data,k=g.offsetIdx;g=g.strideIdx;var p=a[0],n=a[1];a=a[2];var l=c[0]-p,v=c[1]-n;for(c=c[2]-a;b<e;++b){var x=d[b],u=3*
x,A=k+g*f[u++],y=m[A++],w=m[A++],C=m[A],A=k+g*f[u++],q=m[A++],B=m[A++],E=m[A],A=k+g*f[u],u=m[A++],F=m[A++],q=q-y,B=B-w,E=E-C,u=u-y,F=F-w,A=m[A]-C,L=v*A-F*c,M=c*u-A*l,J=l*F-u*v,K=q*L+B*M+E*J;if(!(Math.abs(K)<=I)){y=p-y;w=n-w;C=a-C;L=y*L+w*M+C*J;if(0<K){if(0>L||L>K)continue}else if(0<L||L<K)continue;M=w*E-B*C;C=C*q-E*y;w=y*B-q*w;y=l*M+v*C+c*w;if(0<K){if(0>y||L+y>K)continue}else if(0<y||L+y<K)continue;C=(u*M+F*C+A*w)/K;0<=C&&(q=r(q,B,E,u,F,A,G),h(C,q,x))}}}else for(d=g.data,m=g.offsetIdx,k=g.strideIdx,
g=a[0],p=a[1],n=a[2],a=c[0]-g,l=c[1]-p,v=c[2]-n,c=b,b*=3;c<e;++c)if(F=m+k*f[b++],K=d[F++],w=d[F++],C=d[F],F=m+k*f[b++],x=d[F++],q=d[F++],B=d[F],F=m+k*f[b++],E=d[F++],u=d[F++],x-=K,q-=w,B-=C,E-=K,u-=w,F=d[F]-C,y=l*F-u*v,L=v*E-F*a,M=a*u-E*l,A=x*y+q*L+B*M,!(Math.abs(A)<=I)){K=g-K;w=p-w;C=n-C;y=K*y+w*L+C*M;if(0<A){if(0>y||y>A)continue}else if(0<y||y<A)continue;L=w*B-q*C;C=C*x-B*K;w=K*q-x*w;K=a*L+l*C+v*w;if(0<A){if(0>K||y+K>A)continue}else if(0<K||y+K<A)continue;C=(E*L+u*C+F*w)/A;0<=C&&(x=r(x,q,B,E,u,
F,G),h(C,x,c))}}function r(a,c,e,f,g,d,h){b.vec3.set(L,a,c,e);b.vec3.set(F,f,g,d);b.vec3.cross(h,L,F);b.vec3.normalize(h,h);return h}function y(a,c,e){return b.vec3.set(e,1/(c[0]-a[0]),1/(c[1]-a[1]),1/(c[2]-a[2]))}function w(a,c,b,e){var f=(a[0]-e-c[0])*b[0],g=(a[3]+e-c[0])*b[0],d=Math.min(f,g),f=Math.max(f,g),g=(a[1]-e-c[1])*b[1],h=(a[4]+e-c[1])*b[1],d=Math.max(d,Math.min(g,h)),f=Math.min(f,Math.max(g,h));if(d>f)return!1;g=(a[2]-e-c[2])*b[2];a=(a[5]+e-c[2])*b[2];d=Math.max(d,Math.min(g,a));f=Math.min(f,
Math.max(g,a));return d<=f}function m(a,c){c=c?m(c):{};for(var b in a){var e=a[b];e&&e.forEach&&(e=x(e));null==e&&b in c||(c[b]=e)}return c}function x(a){var c=[];a.forEach(function(a){return c.push(a)});return c}Object.defineProperty(d,"__esModule",{value:!0});var A=l.mat4f64.create(),C=k.create(),B=n.VertexAttrConstants;d.IDENTITY=l.mat4f64.create();d.intersectTriangleGeometry=function(c,b,e,f,g,d,h,m){b=b&&b.componentVisibilities;f=f.tolerance;if(1<c.componentCount)a:{e=y(g,d,E);m=c.componentCount;
var p=c.componentOffsets,l=c.getIndices(B.POSITION),r=c.getAttribute(B.POSITION),x=c.boundingInfo;if(x&&(k.setMin(C,x.getBBMin()),k.setMax(C,x.getBBMax()),!w(C,g,e,f)))break a;for(x=0;x<m;x++)if(!b||a.getVisibility(b,x)){if(c.getComponentAABB){var A=c.getComponentAABB(x,C);if(!w(A,g,e,f))continue}v(g,d,p[x]/3,p[x+1]/3,l,r,void 0,h)}}else if(!b||a.getVisibility(b,0))c.boundingInfo?(n.assert("triangle"===c.data.primitiveType),u(c.boundingInfo,g,d,f,h)):(b=c.getIndices(B.POSITION),c=c.getAttribute(B.POSITION),
v(g,d,0,b.length/3,b,c,void 0,h))};var E=f.vec3f64.create(),I=Math.pow(2,-52),G=f.vec3f64.create();d.intersectTriangles=v;var L=f.vec3f64.create(),F=f.vec3f64.create();d.computeNormal=r;d.intersectAabbInvDir=w;d.transformToWorld=function(a,c,b){return e.vec4.set(b,a[0]-c[0],a[1]-c[1],a[2]-c[2],1)};d.transformToView=function(a,c,b,f){q.mat4.translate(A,b,c);b=A;return e.vec4.transformMat4(f,a,b)};d.transformToProjection=function(a,c,b,f){f[0]=a[0]+b[0];f[1]=a[1]+b[1];f[2]=a[2]+b[2];f[3]=a[3];return e.vec4.transformMat4(f,
f,c)};d.transformToNDC=function(a,c){return e.vec4.scale(c,a,1/Math.abs(a[3]))};d.applyScreenSizePerspectiveScale=function(a,c,b,e,f){return p.scale(a,e,b,f)};d.verticalOffsetAtDistance=function(a,b,e,f,g){var d=(e.screenLength||0)*a.pixelRatio;g&&(d=p.scale(d,f,b,g));return c.clamp(d*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,e.minWorldLength||0,null!=e.maxWorldLength?e.maxWorldLength:Infinity)};d.aquireIfNotUndefined=function(a,c,b){if(void 0!==a)return c.aquire(a,b)};d.releaseIfNotUndefined=function(a,
c){void 0!==a&&c.release(a)};var K=g.mat4f32.create();d.bindView=function(a,c,b){q.mat4.translate(K,c,a);b.setUniform3fv("localOrigin",a);b.setUniformMatrix4fv("view",K)};d.bindCamPos=function(a,c,b){b.setUniform3f("camPos",c[3]-a[0],c[7]-a[1],c[11]-a[2])};var M=f.vec3f64.create(),Q=f.vec3f64.create();d.bindViewOriginDouble=function(a,c){h.encodeDoubleArraySplit(a,M,Q,3);c.setUniform3fv("viewOriginHi",M);c.setUniform3fv("viewOriginLo",Q)};var P=f.vec3f64.create();d.bindSlicePlane=function(a,c,e){b.vec3.subtract(P,
c.origin,a);e.setUniform3fv("slicePlaneOrigin",P);e.setUniform3fv("slicePlaneBasis1",c.basis1);e.setUniform3fv("slicePlaneBasis2",c.basis2)};d.bindVerticalOffset=function(a,c,b){if(a){var e=c.fovY,f=c.viewport[3],g=void 0;void 0===g&&(g=U);g.screenLength=a.screenLength;g.perDistance=Math.tan(.5*e)/(.5*f);g.minWorldLength=a.minWorldLength;g.maxWorldLength=a.maxWorldLength;a=g;b.setUniform4f("verticalOffset",a.screenLength*(c.pixelRatio||1),a.perDistance,a.minWorldLength,a.maxWorldLength)}};d.bindHighlightRendering=
function(a,c,b){a.bindTexture(c.highlightDepthTexture,5);b.setUniform1i("depthTex",5);b.setUniform4f("highlightViewportPixelSz",0,0,1/c.viewport[2],1/c.viewport[3])};d.bindScreenSizePerspective=function(a,c,b){void 0===b&&(b="screenSizePerspectiveAlignment");if(a){var e=a.parameters;c.setUniform4f(b,e.divisor,e.offset,e.minPixelSize,a.paddingPixelsOverride)}};d.copyParameters=m;d.updateParameters=function(a,c){var b=!1,e;for(e in c){var f=c[e];void 0!==f&&(b=!0,Array.isArray(f)?a[e]=f.slice():a[e]=
f)}return b};(function(a){function c(a){return(a.shadowMappingEnabled?1:0)|(a.ssaoEnabled?2:0)}a.create=function(a,b){for(var e=[],f=0;2>f;f++)for(var g=0;2>g;g++){var d=c({shadowMappingEnabled:1===f,ssaoEnabled:1===g}),h=c({shadowMappingEnabled:1===f,ssaoEnabled:1===g&&a.receiveSSAO});e[d]=e[h]||b({receiveShadows:1===f,receiveSSAO:1===g&&a.receiveSSAO})}return{programs:e.filter(function(a){return null!=a}),byParameter:e}};a.lookup=function(a,b){return a.byParameter[c(b)]};a.programs=function(a){return a.programs}})(d.BindParametersMap||
(d.BindParametersMap={}));d.intersectDrapedRenderLineGeometry=function(a,b,e,f,g,d,h,m,k){if(f.enable.selectionMode){b=a.getAttribute(B.POSITION).data;f=a.getAttribute(B.SIZE);e=d[0];d=d[1];a=(((f&&f.data[0])+h)/2+4)*a.pixelRatio;h=Number.MAX_VALUE;for(f=0;f<b.length-5;f+=3){var p=b[f],n=b[f+1];k=e-p;g=d-n;var p=b[f+3]-p,n=b[f+4]-n,l=c.clamp((p*k+n*g)/(p*p+n*n),0,1);k=p*l-k;g=n*l-g;g=k*k+g*g;g<h&&(h=g)}h<a*a&&m()}};d.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var O=1E3,U={screenLength:0,
perDistance:0,minWorldLength:0,maxWorldLength:0}})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["require","exports","./factories/mat4f32"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.mat4f32=q})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.create=function(){var d=new Float32Array(16);d[0]=1;d[5]=1;d[10]=1;d[15]=1;return d};d.clone=function(d){var g=new Float32Array(16);
g[0]=d[0];g[1]=d[1];g[2]=d[2];g[3]=d[3];g[4]=d[4];g[5]=d[5];g[6]=d[6];g[7]=d[7];g[8]=d[8];g[9]=d[9];g[10]=d[10];g[11]=d[11];g[12]=d[12];g[13]=d[13];g[14]=d[14];g[15]=d[15];return g};d.fromValues=function(d,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y){var w=new Float32Array(16);w[0]=d;w[1]=g;w[2]=l;w[3]=b;w[4]=f;w[5]=e;w[6]=k;w[7]=c;w[8]=a;w[9]=h;w[10]=p;w[11]=n;w[12]=u;w[13]=v;w[14]=r;w[15]=y;return w};d.createView=function(d,g){return new Float32Array(d,g,16)}})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require",
"exports"],function(t,d){function q(b,f,e){for(var g=0;g<e;++g)f[2*g]=b[g],f[2*g+1]=b[g]-f[2*g]}Object.defineProperty(d,"__esModule",{value:!0});d.encodeDouble=function(b,f){l[0]=b;l[1]=b-l[0];f[0]=l[0];f[1]=l[1]};d.encodeDoubleArray=q;d.decodeDoubleArray=function(b,f,e){for(var g=0;g<e;++g)f[g]=b[2*g]+b[2*g+1]};d.encodeDoubleArraySplit=function(b,f,e,d){for(var c=0;c<d;++c)g[0]=b[c],q(g,l,1),f[c]=l[0],e[c]=l[1]};var g=new Float64Array(1),l=new Float32Array(2)})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require",
"exports","./IdGen","./ModelContentType"],function(t,d,q,g){return function(){function d(b){this.supportsEdges=!1;this._parentStage=null;this._visible=!0;this._renderOccluded=1;this._renderPriority=0;this.id=d._idGen.gen(b)}Object.defineProperty(d.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0});d.prototype.addParentStage=function(b){this._parentStage=b};d.prototype.removeParentStage=function(b){this._parentStage=null};Object.defineProperty(d.prototype,
"visible",{get:function(){return this._visible},set:function(b){b!==this._visible&&(this._visible=b,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(b){b!==this._renderOccluded&&(this._renderOccluded=b,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(b){b!==
this._renderPriority&&(this._renderPriority=b,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});d.prototype.isVisibleInPass=function(b){return!0};d.prototype.isVisible=function(){return this._visible};d.prototype.notifyDirty=function(b){this.parentStage&&this.parentStage.notifyDirty(g.MATERIAL,this,b)};d._idGen=new q;return d}()})},"esri/views/3d/webgl-engine/materials/internal/bufferWriters":function(){define(["require","exports","../../../support/buffer/BufferView","../../lib/Util"],
function(t,d,q,g){function l(a,c,b,e,f){var g=b.typedBuffer;b=b.typedBufferStride;var d=a.length;e*=b;if(null==f||1===f)for(var h=0;h<d;++h){var m=2*a[h];g[e]=c[m];g[e+1]=c[m+1];e+=b}else for(h=0;h<d;++h)for(var m=2*a[h],k=0;k<f;++k)g[e]=c[m],g[e+1]=c[m+1],e+=b}function b(a,c,b,e,f){var g=b.typedBuffer;b=b.typedBufferStride;var d=a.length;e*=b;if(null==f||1===f)for(var h=0;h<d;++h){var m=3*a[h];g[e]=c[m];g[e+1]=c[m+1];g[e+2]=c[m+2];e+=b}else for(h=0;h<d;++h)for(var m=3*a[h],k=0;k<f;++k)g[e]=c[m],
g[e+1]=c[m+1],g[e+2]=c[m+2],e+=b}function f(a,c,b,e,f){var g=b.typedBuffer;b=b.typedBufferStride;var d=a.length;e*=b;if(null==f||1===f)for(var h=0;h<d;++h){var m=4*a[h];g[e]=c[m];g[e+1]=c[m+1];g[e+2]=c[m+2];g[e+3]=c[m+3];e+=b}else for(h=0;h<d;++h)for(var m=4*a[h],k=0;k<f;++k)g[e]=c[m],g[e+1]=c[m+1],g[e+2]=c[m+2],g[e+3]=c[m+3],e+=b}function e(a,c,e,f,g,d){if(e){var h=f.typedBuffer;f=f.typedBufferStride;var k=a.length;g*=f;if(null==d||1===d)for(var m=0;m<k;++m){var p=3*a[m],n=c[p],l=c[p+1],r=c[p+2];
h[g]=e[0]*n+e[4]*l+e[8]*r+e[12];h[g+1]=e[1]*n+e[5]*l+e[9]*r+e[13];h[g+2]=e[2]*n+e[6]*l+e[10]*r+e[14];g+=f}else for(m=0;m<k;++m)for(var p=3*a[m],n=c[p],l=c[p+1],r=c[p+2],p=e[0]*n+e[4]*l+e[8]*r+e[12],v=e[1]*n+e[5]*l+e[9]*r+e[13],n=e[2]*n+e[6]*l+e[10]*r+e[14],l=0;l<d;++l)h[g]=p,h[g+1]=v,h[g+2]=n,g+=f}else b(a,c,f,g,d)}function k(a,c,e,f,g,d){if(e){var h=f.typedBuffer;f=f.typedBufferStride;var k=a.length;g*=f;if(null==d||1===d)for(var m=0;m<k;++m){var p=3*a[m],n=c[p],l=c[p+1],r=c[p+2];h[g]=e[0]*n+e[4]*
l+e[8]*r;h[g+1]=e[1]*n+e[5]*l+e[9]*r;h[g+2]=e[2]*n+e[6]*l+e[10]*r;g+=f}else for(m=0;m<k;++m)for(var p=3*a[m],n=c[p],l=c[p+1],r=c[p+2],p=e[0]*n+e[4]*l+e[8]*r,v=e[1]*n+e[5]*l+e[9]*r,n=e[2]*n+e[6]*l+e[10]*r,l=0;l<d;++l)h[g]=p,h[g+1]=v,h[g+2]=n,g+=f}else b(a,c,f,g,d)}function c(a,c,b,e,f,g){var d=e.typedBuffer;e=e.typedBufferStride;var h=a.length;f*=e;if(null==g||1===g)if(4===b)for(b=0;b<h;++b){var m=4*a[b];d[f]=c[m];d[f+1]=c[m+1];d[f+2]=c[m+2];d[f+3]=c[m+3];f+=e}else{if(3===b)for(b=0;b<h;++b)m=3*a[b],
d[f]=c[m],d[f+1]=c[m+1],d[f+2]=c[m+2],d[f+3]=255,f+=e}else if(4===b)for(b=0;b<h;++b)for(var m=4*a[b],k=0;k<g;++k)d[f]=c[m],d[f+1]=c[m+1],d[f+2]=c[m+2],d[f+3]=c[m+3],f+=e;else if(3===b)for(b=0;b<h;++b)for(m=3*a[b],k=0;k<g;++k)d[f]=c[m],d[f+1]=c[m+1],d[f+2]=c[m+2],d[f+3]=255,f+=e}function a(a,c,b,e,f,g,d){var h=f.typedBuffer;f=f.typedBufferStride;var m=a.length;g*=f;if(null==d||1===d)if(4===b)for(b=0;b<m;++b){var k=4*a[b];h[g]=c[k]*e[0];h[g+1]=c[k+1]*e[1];h[g+2]=c[k+2]*e[2];h[g+3]=c[k+3]*e[3];g+=f}else{if(3===
b){var p=255*e[3];for(b=0;b<m;++b)k=3*a[b],h[g]=c[k]*e[0],h[g+1]=c[k+1]*e[1],h[g+2]=c[k+2]*e[2],h[g+3]=p,g+=f}}else if(4===b)for(b=0;b<m;++b)for(var k=4*a[b],l=0;l<d;++l)h[g]=c[k]*e[0],h[g+1]=c[k+1]*e[1],h[g+2]=c[k+2]*e[2],h[g+3]=c[k+3]*e[3],g+=f;else if(3===b)for(p=255*e[3],b=0;b<m;++b)for(k=3*a[b],l=0;l<d;++l)h[g]=c[k]*e[0],h[g+1]=c[k+1]*e[1],h[g+2]=c[k+2]*e[2],h[g+3]=p,g+=f}Object.defineProperty(d,"__esModule",{value:!0});d.writeBufferVec2=l;d.writeBufferVec3=b;d.writeBufferVec4=f;d.writePosition=
e;d.writeNormal=k;d.writeColor=c;d.writeMultipliedColor=a;d.writeDefaultAttributes=function(b,d,n,u,v,r,y){var h=0;for(n=n.fieldNames;h<n.length;h++){var m=n[h],p=b.vertexAttr[m],A=b.indices[m];if(p&&A)switch(m){case g.VertexAttrConstants.POSITION:g.assert(3===p.size);(m=r.getField(m,q.BufferViewVec3f))&&e(A,p.data,u,m,y);break;case g.VertexAttrConstants.NORMAL:g.assert(3===p.size);(m=r.getField(m,q.BufferViewVec3f))&&k(A,p.data,v,m,y);break;case g.VertexAttrConstants.UV0:g.assert(2===p.size);(m=
r.getField(m,q.BufferViewVec2f))&&l(A,p.data,m,y);break;case g.VertexAttrConstants.REGION:g.assert(4===p.size);(m=r.getField(m,q.BufferViewVec4u16))&&f(A,p.data,m,y);break;case g.VertexAttrConstants.COLOR:g.assert(3===p.size||4===p.size);(m=r.getField(m,q.BufferViewVec4u8))&&(d&&d.color?a(A,p.data,p.size,d.color,m,y):c(A,p.data,p.size,m,y));break;case g.VertexAttrConstants.SYMBOLCOLOR:g.assert(3===p.size||4===p.size);(m=r.getField(m,q.BufferViewVec4u8))&&c(A,p.data,p.size,m,y);break;case g.VertexAttrConstants.TANGENT:g.assert(4===
p.size),(m=r.getField(m,q.BufferViewVec4f))&&f(A,p.data,m,y)}}}})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ../../lib/Float32ArrayList ../../lib/IntervalUtilities ../../lib/Util ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n){function u(a,c,b,e){for(var f=new Map,g=c.vertexBufferLayout.stride/4,d=function(b,e){var d=b.origin,h=a.get(d.id),m=f.get(d.id);null==m&&(m={optimalCount:null==h?0:h.optimalCount,sparseCount:null==h?0:h.buffer.getSize(),toAdd:[],toRemove:[],origin:d.vec3},f.set(d.id,m));d=c.elementCount(b.data)*g;e?(m.optimalCount+=d,m.sparseCount+=d,m.toAdd.push(b)):(m.optimalCount-=d,m.toRemove.push(b))},h=0;h<b.length;h++){var m=b[h];d(m,!0)}for(b=0;b<e.length;b++)m=e[b],
d(m,!1);return f}t=function(){function g(c,b,e){this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=c;this._material=e;this._materialRep=b;this._glMaterials=a.acquireMaterials(this._material,this._materialRep);this._bufferWriter=e.createBufferWriter()}g.prototype.dispose=function(){a.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(g.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});g.prototype.renderPriority=function(){return this._material.renderPriority};g.prototype.modify=function(a){var c=this,b=x;b.clear();this.updateGeometries(a.toUpdate,b);this.addAndRemoveGeometries(a.toAdd,a.toRemove,b);this.updateHighlightCount();b.forEach(function(a){return c.updateDisplayedIndexRanges(a)})};g.prototype.addAndRemoveGeometries=function(a,c,b){var e=this,f=this._material,g=this._bufferWriter,
d=g.vertexBufferLayout,h=d.stride/4,m=this._dataByOrigin,p=u(m,g,a,c);p.forEach(function(a,c){p.delete(c);var g=a.optimalCount,l=a.sparseCount,n=m.get(c);null==n&&(k.assert(0<g),n=e.createData(d,g,a.origin),m.set(c,n));if(0===g)n.vao.dispose(!0),n.vao=null,m.delete(c);else{var x=(c=g<a.sparseCount/2)?g:l,g=v,l=n.buffer.getSize(),u=n.buffer.getArray(),x=n.buffer.resize(x);c||x?e.removeAndRebuild(n,a.toRemove,h,u,g):0<a.toRemove.length?(e.removeByErasing(n,a.toRemove,h,g),0<a.toAdd.length&&(g.end=l)):
(g.begin=l,g.end=l);c=r;k.setMatrixTranslation3(c,-a.origin[0],-a.origin[1],-a.origin[2]);e.append(n,f,a.toAdd,h,c,g);a=n.vao.vertexBuffers.geometry;a.byteSize!==n.buffer.getArray().buffer.byteLength?a.setData(n.buffer.getArray()):(u=g.begin,c=g.end,u<c&&(l=n.buffer.getArray(),u*=4,a.setSubData(l,u,u,4*c)));(g.updatedDisplayedIndexRange||n.displayedIndexRanges)&&b.add(n)}})};g.prototype.updateGeometries=function(c,b){for(var e=this._bufferWriter,f=e.vertexBufferLayout.stride/4,g=0;g<c.length;g++){var d=
c[g],h=d.updateType,d=d.renderGeometry,m=this._dataByOrigin.get(d.origin.id),p=m&&m.instances.get(d.uniqueName);if(!p)break;h&1&&(p.displayedIndexRange=a.generateRenderGeometryVisibleIndexRanges(d),b.add(m));h&17&&(p.highlightedIndexRanges=a.generateRenderGeometryHighlightRanges(d),m.highlightCount=null);h&6&&(h=m.buffer.getArray(),m=m.vao,a.calculateTransformRelToOrigin(d,y,w),e.write({transformation:y,invTranspTransformation:w},d.data,d.instanceParameters,e.vertexBufferLayout.createView(h.buffer),
p.from),k.assert(p.from+e.elementCount(d.data)===p.to,"material VBO layout has changed"),m.vertexBuffers.geometry.setSubData(h,p.from*f*4,p.from*f*4,p.to*f*4))}};g.prototype.updateDisplayedIndexRanges=function(a){var c=a.instances;a.displayedIndexRanges=[];var b=!0;c.forEach(function(c){c.displayedIndexRange?(a.displayedIndexRanges.push.apply(a.displayedIndexRanges,e.offsetIntervals(c.displayedIndexRange,c.from)),b=!1):a.displayedIndexRanges.push([c.from,c.to-1])});a.displayedIndexRanges=b?null:e.mergeIntervals(a.displayedIndexRanges)};
g.prototype.updateHighlightCount=function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(c){if(null==c.highlightCount){var b=0;c.instances.forEach(function(a){a.highlightedIndexRanges&&++b});c.highlightCount=b}a._highlightCount+=c.highlightCount})};g.prototype.render=function(a,c,b,e){var f=this,g=this._rctx,d=this._glMaterials.get(c.pass),h=4===c.pass;if(!d||null!=a&&!d.beginSlot(a)||h&&0===this._highlightCount)return!1;d.bind(g,b);a=d.getProgram();a.setUniformMatrix4fv("model",
m);a.hasUniform("modelNormal")&&a.setUniformMatrix4fv("modelNormal",m);var k=!1;this._dataByOrigin.forEach(function(a){h&&0===a.highlightCount||(b.origin=a.origin,d.bindView(g,b),k=h?f.renderHighlightPass(d,a,e)||k:f.renderDefaultPass(d,a,e)||k)});d.release(g,b);return k};g.prototype.renderDefaultPass=function(c,b,e){var f=this._rctx,g=c.getProgram();c=c.getDrawMode();var d=b.displayedIndexRanges;if(d&&0===d.length)return!1;p.assertCompatibleVertexAttributeLocations(b.vao,g);f.bindVAO(b.vao);d?a.drawArraysFaceRange(f,
d,0,c,e):a.drawArrays(f,c,0,p.vertexCount(b.vao,"geometry"),e);return!0};g.prototype.renderHighlightPass=function(c,b,e){var f=this._rctx,g=c.getProgram(),d=c.getDrawMode();c=b.vao;p.assertCompatibleVertexAttributeLocations(c,g);f.bindVAO(c);var h=!1;b.instances.forEach(function(c){var b=c.highlightedIndexRanges;if(b&&0!==b.length)for(var g=0;g<b.length;g++){var m=b[g];a.drawArrays(f,d,m.range?m.range[0]+c.from:c.from,m.range?m.range[1]-m.range[0]+1:c.to-c.from,e);h=!0}});return h};g.prototype.createData=
function(a,c,e){return{instances:new Map,vao:new n(this._rctx,b.Default3D,{geometry:l.glLayout(a)},{geometry:h.createVertex(this._rctx,35044)}),buffer:new f(c),optimalCount:0,origin:e,highlightCount:0}};g.prototype.removeAndRebuild=function(a,c,b,e,f){for(var g=0;g<c.length;g++){var d=c[g].uniqueName,h=a.instances.get(d);a.optimalCount-=(h.to-h.from)*b;a.instances.delete(d)}var m=0,k=a.buffer.getArray();f.begin=0;f.end=0;var p=-1,l=-1,n=0;a.instances.forEach(function(a){var c=a.from*b,f=a.to*b,g=
f-c;p!==l&&l!==c?(k.set(e.subarray(p,l),n),n+=l-p,p=c):-1===p&&(p=c);l=f;a.from=m/b;m+=g;a.to=m/b});p!==l&&k.set(e.subarray(p,l),n);f.end=m};g.prototype.removeByErasing=function(a,c,b,e){if(0!==c.length){e.begin=Infinity;e.end=-Infinity;for(var f=-1,g=-1,d=0;d<c.length;d++){var h=c[d].uniqueName,m=a.instances.get(h),k=m.from*b,m=m.to*b;f!==g&&g!==k?(a.buffer.erase(f,g),f=k):-1===f&&(f=k);g=m;a.instances.delete(h);a.optimalCount-=m-k;k<e.begin&&(e.begin=k);m>e.end&&(e.end=m)}f!==g&&a.buffer.erase(f,
g)}};g.prototype.append=function(b,e,f,g,d,h){h.updatedDisplayedIndexRange=!1;e=this._bufferWriter;for(var m=0;m<f.length;m++){var p=f[m],l=p.data;q.mat4.multiply(y,d,p.transformation);q.mat4.invert(w,y);q.mat4.transpose(w,w);var n=h.end;e.write({transformation:y,invTranspTransformation:w},l,p.instanceParameters,e.vertexBufferLayout.createView(b.buffer.getArray().buffer),h.end/g);var l=e.elementCount(l)*g,r=n+l;k.assert(null==b.instances.get(p.uniqueName));var v=a.generateRenderGeometryVisibleIndexRanges(p),
x=a.generateRenderGeometryHighlightRanges(p);x&&(b.highlightCount=null);n=new c(p.name,n/g,r/g,v,x,void 0,void 0,p.idx);b.instances.set(p.uniqueName,n);v&&(h.updatedDisplayedIndexRange=!0);b.optimalCount+=l;h.end+=l}};return g}();var v={updatedDisplayedIndexRange:!1,begin:0,end:0},r=g.mat4f64.create(),y=g.mat4f64.create(),w=g.mat4f64.create(),m=g.mat4f64.create(),x=new Set;return t})},"esri/views/3d/webgl-engine/lib/Float32ArrayList":function(){define(["require","exports","../../../../core/mathUtils"],
function(t,d,q){return function(){function g(g){null==g?g=16:65536>g&&(g=q.nextHighestPowerOfTwo(g));this.array=new Float32Array(g);this.size=0}g.prototype.resize=function(g,b){void 0===b&&(b=!1);this.size=g;var f;if(this.size>this.array.length){for(g=this.array.length||1;g<this.size;)g*=2;f=new Float32Array(g);b&&f.set(this.array);this.array=f;return!0}if(this.size<=this.array.length/2){g=this.array.length;for(f=2*this.size;g>=f;)g=Math.floor(g/2);f=new Float32Array(g);b&&f.set(this.array.subarray(0,
g));this.array=f;return!0}return!1};g.prototype.append=function(g){var b=this.size;this.resize(this.size+g.length,!0);this.array.set(g,b)};g.prototype.erase=function(g,b){for(;g<b;++g)this.array[g]=0};g.prototype.getArray=function(){return this.array};g.prototype.getSize=function(){return this.size};return g}()})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(t,d){return function(){function d(){}d.copyIntervals=function(g){for(var d=[],b=0;b<g.length;b++){var f=
g[b];d.push([f[0],f[1]])}return d};d.convertFaceToIndexRange=function(g,d){for(var b=0;b<g.length;b++){var f=g[b];f[0]*=d;f[1]=f[1]*d+(d-1)}};d.sortIntervals=function(g){return g.sort(function(g,b){return g[0]===b[0]?g[1]>b[1]?1:g[1]<b[1]?-1:0:g[0]>b[0]?1:g[0]<b[0]?-1:0})};d.intersectIntervals=function(g,d){if(0>=g.length)return[];for(var b=[],f=0;f<g.length;f++){var e=g[f];e[1]<d[0]||e[0]>d[1]||(e=[e[0],e[1]],e[0]<d[0]&&(e[0]=d[0]),e[1]>d[1]&&(e[1]=d[1]),b.push(e))}return b};d.mergeIntervals=function(g){if(0>=
g.length)return[];var d=[];g=this.sortIntervals(g);d.push(g[0]);for(var b=1;b<g.length;b++){var f=d[d.length-1];f[1]+1<g[b][0]?d.push(g[b]):f[1]<g[b][1]&&(f[1]=g[b][1],d.pop(),d.push(f))}return d};d.invertIntervals=function(g,d){for(var b=[],f=0,e=0;e<g.length;e++){var k=g[e];k[0]>f&&b.push([f,k[0]-1]);f=k[1]+1}f<=d&&b.push([f,d]);return b};d.offsetIntervals=function(g,d){for(var b=[],f=0;f<g.length;f++){var e=g[f];b.push([e[0]+d,e[1]+d])}return b};return d}()})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["require",
"exports","../../../../../core/libs/gl-matrix-2/mat4","../../../../../core/libs/gl-matrix-2/mat4f64"],function(t,d,q,g){return function(){return function(d,b,f,e,k,c,a,h,p){this.name=d;this.from=b;this.to=f;this.displayedIndexRange=e;this.highlightedIndexRanges=k;this.transformation=c;this.instanceParameters=a;this.idx=h;this.dataId=p;null!=c&&(this.transformationNormal=g.mat4f64.clone(c),q.mat4.invert(this.transformationNormal,this.transformationNormal),q.mat4.transpose(this.transformationNormal,
this.transformationNormal))}}()})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../lib/ComponentUtils ../../lib/Util ../../../../webgl/Util".split(" "),function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});d.generateRenderGeometryVisibleIndexRanges=function(b){return b.instanceParameters.hidden?[]:l.generateVisibleIndexRanges(b.instanceParameters.componentVisibilities,
b.componentOffsets)};d.generateRenderGeometryHighlightRanges=function(b){return b.instanceParameters.hidden?null:l.generateHighlightedIndexRanges(b.instanceParameters.componentVisibilities,b.instanceParameters.componentHighlights,b.componentOffsets)};d.doesRenderGeometryHaveHighlights=function(b){return b.instanceParameters.hidden?!1:l.hasHighlights(b.instanceParameters.componentVisibilities,b.instanceParameters.componentHighlights,b.componentOffsets)};d.isRenderGeometryHidden=function(b){return b.instanceParameters.hidden?
!0:l.isAllHidden(b.instanceParameters.componentVisibilities,b.componentOffsets)};d.drawArrays=function(b,c,a,e,f){b.drawArrays(c,a,e);f&&(f.drawCalls++,4===c&&(f.triangles+=e))};d.drawElements=function(b,c,a,e,g,d){var h=f.getBytesPerElement(a);b.drawElements(c,g,a,e*h);d&&(d.drawCalls++,4===c&&(d.triangles+=g))};d.drawArraysFaceRange=function(b,c,a,e,f){for(var g=0,d=0;d<c.length;d++){var h=c[d],k=h[0]+a,h=h[1]-h[0]+1,g=g+h;b.drawArrays(e,k,h)}f&&(f.drawCalls+=c.length,4===e&&(f.triangles=g/3))};
d.drawElementsFaceRange=function(b,c,a,e,g,d){for(var h=f.getBytesPerElement(g),k=0,p=0;p<c.length;p++){var n=c[p],l=n[0]+a,n=n[1]-n[0]+1,k=k+n;b.drawElements(e,n,g,l*h)}d&&(d.drawCalls+=c.length,4===e&&(d.triangles+=k/3))};d.acquireMaterials=function(b,c){var a=new Map;a.set(0,c.aquire(b,"color"));a.set(3,c.aquire(b,"depthShadowMap"));a.set(2,c.aquire(b,"normal"));a.set(1,c.aquire(b,"depth"));a.set(4,c.aquire(b,"highlight"));return a};d.releaseMaterials=function(b,c){c.release(b.id,"color");c.release(b.id,
"depthShadowMap");c.release(b.id,"normal");c.release(b.id,"depth");c.release(b.id,"highlight")};d.calculateTransformRelToOrigin=function(f,c,a){var g=f.origin.vec3;b.setMatrixTranslation3(e,-g[0],-g[1],-g[2]);q.mat4.multiply(c,e,f.transformation);a&&(q.mat4.invert(a,c),q.mat4.transpose(a,a))};var e=g.mat4f64.create()})},"esri/views/3d/webgl-engine/shaders/HUDPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],
function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=function(b){return l.glslifyDefineMap({OCCL_TEST:b.occlTest,SIGNED_DISTANCE_FIELD:b.sdf,VV_SIZE:b.vvSize,VV_COLOR:b.vvColor,VERTICAL_OFFSET:b.verticalOffset,SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:b.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:b.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:b.binaryHighlightOcclusion,SLICE:b.slice})};d.colorPass={name:"hud-color",shaders:function(f){return{vertexShader:b(f)+
g.resolveIncludes("materials/hud/hud.vert"),fragmentShader:b(f)+g.resolveIncludes("materials/hud/colorPass.frag")}},attributes:q.Default3D};d.highlightPass={name:"hud-highlight",shaders:function(f){return{vertexShader:b(f)+g.resolveIncludes("materials/hud/hud.vert"),fragmentShader:b(f)+g.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:q.Default3D};d.occlusionPass={name:"hud-occlusion",shaders:function(b){return{vertexShader:l.glslifyDefineMap({VERTICAL_OFFSET:b.verticalOffset,SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,
CENTER_OFFSET_UNITS_SCREEN:b.centerOffsetUnitsScreen,SLICE:b.slice})+g.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:g.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:q.Default3D}})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/LabelClass ../../../../layers/support/labelFormatUtils ../../../../support/arcadeUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./graphicSymbolUtils ./labelPlacement ../../support/debugFlags ../../webgl-engine/Stage ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C){Object.defineProperty(d,"__esModule",{value:!0});var B=f.getLogger("esri.views.3d.layers.graphics.Labeler");t=function(f){function d(a){a=f.call(this)||this;a.idHint="__labeler";a._dirty=!1;a.labels={};a.labelsToAdd={};a.labelsToRemove={};a.labelingContexts=[];return a}q(d,f);d.prototype.setup=function(){var a=this;this.handles||(this.handles=new b,this.handles.add([this.view.watch("state.camera",function(){return a.setDirty()}),this.view.watch("pixelRatio",
function(){return a.resetAllLabels()})]));this.textTextureAtlas||(this.textTextureAtlas=new C.default(this.idHint+"_atlas",this.view),this.hudMaterialCollection=new m(this.view._stage),this.calloutMaterialCollection=new m(this.view._stage));this.handles.add(this.view.resourceController.scheduler.registerTask(8,function(c){return a.update(c)},function(){return a.needsUpdate()}))};d.prototype.dispose=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.textTextureAtlas&&(this.textTextureAtlas.dispose(),
this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=[];this.labels={};this.labelsToAdd={};this.labelsToRemove={}};d.prototype.isActiveLabelingContext=function(a){return a.active&&this.labelsEnabled(a)};d.prototype.activateLabelingContext=function(a){for(var c in a.labels){var b=a.labels[c];this.labels[c]=
b;b.graphics3DGraphic.setVisibilityFlag(0,!0,1)}a.active=!0};d.prototype.deactivateLabelingContext=function(a){for(var c in a.labels){var b=a.labels[c];b.graphics3DGraphic.setVisibilityFlag(0,!1,1);b.rendered&&(this.labelsToRemove[c]=a.labels[c]);delete this.labels[c];delete this.labelsToAdd[c]}a.active=!1};d.prototype.addLabelTextureToAtlas=function(a){for(var c=0;c<a.graphics3DGraphic._labelGraphics.length;c++){var b=a.graphics3DGraphic._labelGraphics[c];if(b._labelClass){var e=a.textRenderers[b._labelIndex];
e&&this.textTextureAtlas.addTextTexture(e,b.stageObject)}}a.rendered=!0};d.prototype.removeLabelTextureFromAtlas=function(a){for(var c=a.graphics3DGraphic,b=0;b<c._labelGraphics.length;b++){var e=c._labelGraphics[b];e._labelClass&&(e=a.textRenderers[e._labelIndex])&&this.textTextureAtlas.removeTextTexture(e,c._labelGraphics[b].stageObject)}a.rendered=!1};d.prototype.needsUpdate=function(){return this.view.ready&&this.isDirty};d.prototype.update=function(a){for(var c=null!=a,b=this._dirty=!1,e=0,f=
this.labelingContexts;e<f.length;e++){var g=f[e];if(this.isActiveLabelingContext(g)){if(!this.hasValidLabelClassContext(g)){if(this.hasInvalidLabelClassContext(g)){this.deactivateLabelingContext(g);continue}this.createLabelClassContext(g);if(this.hasPendingLabelClassContext(g)){this._dirty=!0;continue}if(!this.hasValidLabelClassContext(g))continue}for(var d in g.labelsToInitialize){var h=g.labelsToInitialize[d];this.ensureGraphics3DResources(h)&&(this.labels[d]=h,b=!0);(h.visible&&h.hasTextTextureResources||
!h.visible&&h.hasGraphics3DResources)&&delete g.labelsToInitialize[d];if(c&&(a.madeProgress(),a.done)){this._dirty=!0;return}}}}c&&b&&this.view.deconflictor.setDirty();for(d in this.labelsToRemove)this.removeLabelTextureFromAtlas(this.labelsToRemove[d]),delete this.labelsToRemove[d];for(d in this.labelsToAdd)this.addLabelTextureToAtlas(this.labelsToAdd[d]),delete this.labelsToAdd[d]};d.prototype.hasPendingLabelClassContext=function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()};
d.prototype.hasValidLabelClassContext=function(a){return a.labelClassContexts&&a.labelClassContexts.length};d.prototype.hasInvalidLabelClassContext=function(a){return null===a.labelClassContexts};d.prototype.createLabelClassContext=function(c){var b=this;if(c.labelClassPromise)return c.labelClassPromise;c.labelClassPromise=c.layer.when(function(){c.scaleVisibility&&c.scaleVisibility.updateScaleRangeActive();var f=c.graphics3DCore,g=f.layer.labelingInfo&&f.layer.labelingInfo.filter(function(a){return!!a.symbol});
if(!g||0===g.length)return null;if(g.some(function(a){return h.hasGeometryOperations(a)}))return B.warn('Label expressions with arcade geometry operations are not supported. Labels for layer "'+c.layer.title+'" will not display '),null;var d=Array(g.length),g=g.map(function(c,e){var g=c.symbol,h=u.getGraphics3DSymbol(f.getOrCreateGraphics3DSymbol(g)),m=null;p.isCalloutSupport(g)&&g.hasVisibleCallout()&&(m=n.make(g,f.symbolCreationContext));d[e]={labelClass:c,graphics3DSymbol:h,graphics3DCalloutSymbolLayer:m,
options:a.getLabelingOptions(c),calloutSymbolLayerIndex:0,textRenderParameters:b.createTextRenderParameters(h.symbol)};return h});return e.all(g).then(function(){return d})}).then(function(a){a&&(c.labelClassContexts=a)}).catch(function(){c.labelClassContexts=null});return c.labelClassPromise};d.prototype.createTextRenderParameters=function(a){return(a=a.symbolLayers.getItemAt(0))&&"text"===a.type?A.default.fromSymbol(a,this.view.pixelRatio):null};d.prototype.destroyLabelClassContext=function(a){for(var c=
0,b=a.labelClassContexts;c<b.length;c++){var e=b[c];--e.graphics3DSymbol.referenced;e.graphics3DSymbol=null}a.labelClassContexts=[];a.labelClassPromise=null};d.prototype.createLabelText=function(b,e,f,g){if(!c.evaluateWhere(e.where,b.attributes))return null;e=e.getLabelExpression();return e.expression?a.buildLabelText(e.expression,b,g.fields,f):null};d.prototype.createTextSymbolGraphic=function(a,c,b,e,f){a={text:a.text,centerOffset:b.centerOffset,translation:b.translation,elevationOffset:b.elevationOffset,
screenOffset:b.screenOffset,anchor:b.anchor,centerOffsetUnits:b.centerOffsetUnits,verticalOffset:b.verticalOffset,debugDrawBorder:r.LABELS_SHOW_BORDER,displayWidth:a.displayWidth,displayHeight:a.displayHeight};E.graphic=c;E.renderingInfo=null;E.layer=e;return f.createLabel(E,a,this.hudMaterialCollection,this.textTextureAtlas)};d.prototype.createLineCalloutGraphic=function(a,c,b,e,f){c={symbol:c,translation:e.translation,elevationOffset:e.elevationOffset,screenOffset:e.screenOffset,centerOffset:e.centerOffset,
centerOffsetUnits:e.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};E.graphic=a;E.renderingInfo=c;E.layer=f;return b.createGraphics3DGraphic(E)};d.prototype.ensureGraphics3DResources=function(a){var c=a.graphics3DGraphic;if(c.destroyed||a.hasGraphics3DResources)return!1;this.ensureTextTextureResources(a);var b=a.labelingContext,e=!1,f=c.graphic,g=b.labelClassContexts,d=b.layer,h=this.labelsEnabled(b);if(!g||0===g.length||!c._graphics[0])return!1;for(var m=0;m<g.length;m++){var k=
g[m],p=k.labelClass,n=a.textRenderers[m];if(n){var l=k.graphics3DSymbol,r=null;l.symbol&&"label-3d"===l.symbol.type&&(r=l.symbol);var x=l.childGraphics3DSymbols[0],l=v.get({graphics3DGraphic:c,labelSymbol:r,labelClass:k.labelClass});if(x&&l){if(e=this.createTextSymbolGraphic(n,f,l,d,x)){if(e._labelClass=p,e._labelIndex=m,c.addLabelGraphic(e,b.stageLayer,this.view._stage),b.spatialIndex&&b.spatialIndex.add(c),c.setVisibilityFlag(0,h,1),c.clearVisibilityFlag(1,1),c.setVisibilityFlag(3,!1,1),e=!0,k.graphics3DCalloutSymbolLayer&&
l.hasLabelVerticalOffset&&(f=this.createLineCalloutGraphic(f,r,k.graphics3DCalloutSymbolLayer,l,d)))k.calloutSymbolLayerIndex=c._labelGraphics.length,c.addLabelGraphic(f,b.stageLayer,this.view._stage)}else return!1;break}}}b.scaleVisibility&&e&&b.scaleVisibility.updateGraphicLabelScaleVisibility(c);return a.hasGraphics3DResources=!0};d.prototype.destroyGraphics3DResources=function(a){a.graphics3DGraphic.clearLabelGraphics();a.hasGraphics3DResources=!1};d.prototype.ensureTextTextureResources=function(a){if(!a.hasTextTextureResources){var c=
a.labelingContext,b=c.labelClassContexts,c=c.layer,e=a.graphics3DGraphic.graphic;if(b&&0!==b.length){for(var f=0;f<b.length;f++){var g=b[f];a.textRenderers[f]=null;if(g.textRenderParameters){var d=this.createLabelText(e,g.labelClass,g.options,c);d&&(a.textRenderers[f]=new x.default(d,g.textRenderParameters))}}a.hasTextTextureResources=!0}}};d.prototype.destroyTextTextureResources=function(a){a.textRenderers=[];a.hasTextTextureResources=!1};d.prototype.addGraphic=function(a,c){var b={hasGraphics3DResources:!1,
hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:a,graphics3DGraphic:c,textRenderers:[]};c=c.graphic.uid;a.labels[c]=b;this.isActiveLabelingContext(a)&&this.hasValidLabelClassContext(a)&&this.ensureGraphics3DResources(b)?this.labels[c]=b:a.labelsToInitialize[c]=b;this.setDirty(a.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};d.prototype.removeGraphic=function(a,c){c=c.graphic.uid;var b=a.labels[c];b&&(this.labels[c]&&(this.removeLabelTextureFromAtlas(b),delete this.labels[c],
delete this.labelsToAdd[c],delete this.labelsToRemove[c]),b.hasTextTextureResources&&this.destroyTextTextureResources(b),b.hasGraphics3DResources&&this.destroyGraphics3DResources(b),delete a.labels[c],delete a.labelsToInitialize[c],this.setDirty(a.graphics3DCore.asyncUpdates),this.view.deconflictor.setDirty())};d.prototype.labelsEnabled=function(a){return!0===a.layer.labelsVisible&&null!=a.layer.labelingInfo&&0<a.layer.labelingInfo.length};d.prototype.labelingInfoChange=function(a,c){if(c){for(var b=
0;b<c.length;b++){var f=a.labels[c[b]];f&&(this.removeGraphic(a,f.graphics3DGraphic),this.addGraphic(a,f.graphics3DGraphic))}return e.create(function(a){return!0})}this.visibilityInfoChange(a);this.resetLabels(a);return this.createLabelClassContext(a)};d.prototype.globalPropertyChanged=function(a,c){for(var b=function(b){var e=new Map,f;for(f in c.labels){var g=c.labels[f].graphics3DGraphic;e.set(g.graphic.uid,g)}b.graphics3DSymbol.childGraphics3DSymbols[0].globalPropertyChanged(a,e,function(a){return a._labelGraphics[0]});
b.graphics3DCalloutSymbolLayer&&b.graphics3DCalloutSymbolLayer.globalPropertyChanged(a,e,function(a){return a._labelGraphics[b.calloutSymbolLayerIndex]})},e=0,f=c.labelClassContexts;e<f.length;e++)b(f[e])};d.prototype.visibilityInfoChange=function(a){var c=a.layer.labelsVisible;c&&!a.active&&this.activateLabelingContext(a);!c&&a.active&&this.deactivateLabelingContext(a);this.setDirty(a.graphics3DCore.asyncUpdates)};d.prototype.resetAllLabels=function(){for(var a=0,c=this.labelingContexts;a<c.length;a++)this.resetLabels(c[a])};
d.prototype.resetLabels=function(a){for(var c in a.labels){var b=a.labels[c];this.labels[c]&&(this.removeLabelTextureFromAtlas(b),delete this.labels[c],delete this.labelsToAdd[c],delete this.labelsToRemove[c]);b.hasTextTextureResources&&this.destroyTextTextureResources(b);b.hasGraphics3DResources&&this.destroyGraphics3DResources(b);b.visible=!1;b.rendered=!1;a.labelsToInitialize[c]=b}this.destroyLabelClassContext(a);this.setDirty(a.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};d.prototype.findLabelingContext=
function(a){for(var c=0,b=this.labelingContexts;c<b.length;c++){var e=b[c];if(e.graphics3DCore===a)return e}return null};d.prototype.addGraphicsOwner=function(a,c,b){var e=this;if(!this.findLabelingContext(a)){var f=a.layer,g={graphics3DCore:a,layer:f,scaleVisibility:c,spatialIndex:b,active:a.layer.labelsVisible,labelClassPromise:null,labelClassContexts:[],labels:{},labelsToInitialize:{},stageLayer:new w(this.idHint+"_"+f.uid,{isPickable:!0},f.uid)};this.view._stage.add(y.ModelContentType.LAYER,g.stageLayer);
this.view._stage.addToViewContent([g.stageLayer.id]);this.labelingContexts.push(g);this.setDirty();return{addGraphic:function(a){return e.addGraphic(g,a)},removeGraphic:function(a){return e.removeGraphic(g,a)},featureReductionChange:function(){},layerLabelsEnabled:function(){return e.labelsEnabled(g)},labelingInfoChange:function(a){return e.labelingInfoChange(g,a)},elevationInfoChange:function(){return e.globalPropertyChanged("elevationInfo",g)},slicePlaneEnabledChange:function(){return e.globalPropertyChanged("slicePlaneEnabled",
g)},visibilityInfoChange:function(){return e.visibilityInfoChange(g)},reset:function(){return e.resetLabels(g)},clear:function(){},processStageDirty:function(){return e.view._stage.processDirtyLayer(g.stageLayer.id)}}}};d.prototype.removeGraphicsOwner=function(a){if(a=this.findLabelingContext(a)){var c=this.labelingContexts.indexOf(a);this.labelingContexts.splice(c,1);for(var b in a.labels)this.removeGraphic(a,a.labels[b].graphics3DGraphic);b=a.stageLayer.id;this.view._stage.removeFromViewContent([b]);
this.view._stage.remove(y.ModelContentType.LAYER,b);a.stageLayer=null;this.setDirty()}};d.prototype.setLabelGraphicVisibility=function(a,c){a=a.graphic.uid;var b=this.labels[a];b&&(c&&!b.rendered?(this.labelsToAdd[a]=b,b.hasTextTextureResources||(b.labelingContext.labelsToInitialize[a]=b)):!c&&b.rendered&&(this.labelsToRemove[a]=b),b.visible=c,this.setDirty(b.labelingContext.graphics3DCore.asyncUpdates))};Object.defineProperty(d.prototype,"isDirty",{get:function(){return this._dirty||this.textTextureAtlas&&
this.textTextureAtlas.isDirty},enumerable:!0,configurable:!0});d.prototype.setDirty=function(a){void 0===a&&(a=!0);this._dirty=!0;a||this.update(null)};Object.defineProperty(d.prototype,"updating",{get:function(){return this.labelingContexts.some(function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()})},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"test",{get:function(){return{textTextureAtlas:this.textTextureAtlas}},enumerable:!0,configurable:!0});g([k.property({constructOnly:!0})],
d.prototype,"view",void 0);g([k.property({type:Boolean,readOnly:!0})],d.prototype,"updating",null);return d=g([k.subclass()],d)}(k.declared(l));d.Labeler=t;var E={graphic:null,renderingInfo:null,layer:null}})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper dojo/number ../../arcade/Feature ../../core/date ../../core/lang ../../core/promiseUtils ./fieldUtils ../../support/arcadeUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){function n(){return b(this,void 0,void 0,function(){return l(this,function(c){return[2,a.create(function(a){t(["../../core/sql/WhereClause"],a)})]})})}function u(){return b(this,void 0,void 0,function(){return l(this,function(c){return[2,a.create(function(a){t(["../../support/arcadeUtils"],a)})]})})}function v(a,c){c={spatialReference:c};if(a=a.labelExpressionInfo){var b=a.expression;b&&!a.value&&(c.hasArcadeExpression=!0,c.compiledArcadeFunc=p.createFunction(b))}return c}
function r(a,b,e,g){a=h.getField(g,a);if(!a)return b;if(null==e[a.name])return"";if(b=a.domain)if("codedValue"===b.type||"coded-value"===b.type){g=e[a.name];var d=0;for(b=b.codedValues;d<b.length;d++){var m=b[d];if(m.code===g)return m.name}}else if("range"===b.type&&(g=+e[a.name],d="range"in b?b.range[1]:b.maxValue,("range"in b?b.range[0]:b.minValue)<=g&&g<=d))return b.name;e=e[a.name];"date"===a.type||"esriFieldTypeDate"===a.type?(a=k.fromJSON("shortDate"),(a="DateFormat"+k.getFormat(a))&&(e=c.substitute({myKey:e},
"{myKey:"+a+"}"))):h.isNumericField(a)&&(e=f.format(+e));return e?e:""}Object.defineProperty(d,"__esModule",{value:!0});var y=new e,w=function(a){return null};d.createLabelFunction=function(c,e,f){return b(this,void 0,void 0,function(){var b,g,d,h,m,k,p,x,A,q,P;return l(this,function(l){switch(l.label){case 0:if(!c||!c.symbol)return[2,w];b=c.where;g=c.getLabelExpression();return[4,a.all([b?n():null,"arcade"===g.type?u():null])];case 1:return d=l.sent(),h=d[0],m=d[1],"arcade"===g.type?(p=v(c,f),x=
m.createFunction(g.expression),A={fields:e},q={vars:{$feature:y,$view:p.view},spatialReference:f},k=function(a){y.repurposeFromGraphicLikeObject(a.geometry,a.attributes,A);a=m.executeFunction(x,q);return null!=a?a.toString():null}):k=function(a){var c=a&&a.attributes;return c?g.expression.replace(/{[^}]*}/g,function(a){return r(a.slice(1,-1),a,c,e)}):null},b?(P=h.create(b),[2,function(a){return P.testFeature(a)?k(a):null}]):[2,k]}})})};d.getLabelingOptions=v;d.buildLabelText=function(a,c,b,e){var f=
"";if(e&&e.hasArcadeExpression){if(e.compiledArcadeFunc)return y.repurposeFromGraphicLikeObject(c.geometry,c.attributes,{fields:b}),a=p.executeFunction(e.compiledArcadeFunc,{vars:{$feature:y,$view:e.view},spatialReference:e.spatialReference}),null!=a?a.toString():null}else var g=c&&c.attributes||{},f=a.replace(/{[^}]*}/g,function(a){return r(a.slice(1,-1),a,g,b)});return f};d.formatField=r})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require","exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=q.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");d.make=function(e,d){if(!g.isCalloutSupport(e))return b.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+e.type+"' does not support callouts"),null;if(!e.callout)return null;var c=f[e.callout.type];return c?new c(e,d):
(b.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+e.callout.type),null)};var f={line:l.default}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./symbolComplexity ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v){Object.defineProperty(d,"__esModule",{value:!0});var r,y,w=u.VertexAttrConstants;t=function(d){function k(a,c){a=d.call(this,a,null,c,!0)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};c=a._getStageIdHint();a._createMaterialsAndAddToStage(a._context.stage,c);a.resolve();return a}q(k,d);k.prototype.destroy=function(){d.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(h.ModelContentType.MATERIAL,
this._material.id),this._material=null)};k.prototype.perInstanceMaterialParameters=function(a){var c=this.materialParameters;c.screenOffset=a.screenOffset||[0,0];c.centerOffsetUnits=a.centerOffsetUnits||"world";return c};Object.defineProperty(k.prototype,"materialParameters",{get:function(){var a=this.symbol,c=a.callout,b=g.toUnitRGBA(c.color);b[3]*=this._getLayerOpacity();var e=l.pt2px(c.size||0),f=null;if(a.verticalOffset)var f=a.verticalOffset,d=f.minWorldLength,h=f.maxWorldLength,f={screenLength:l.pt2px(f.screenLength),
minWorldLength:d||0,maxWorldLength:null!=h?h:Infinity};c=c.border&&c.border.color?g.toUnitRGBA(c.border.color):null;d="object"===a.symbolLayers.getItemAt(0).type;return{color:b,size:e,verticalOffset:f,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:c,occlusionTest:!d,shaderPolygonOffset:d?0:void 0,depthHUDAlignStart:"label-3d"===a.type,slicePlaneEnabled:this._context.slicePlaneEnabled}},
enumerable:!0,configurable:!0});k.prototype._createMaterialsAndAddToStage=function(a,c){this._material=new v(this.materialParameters,c+"_lineCallout_common");a.add(h.ModelContentType.MATERIAL,this._material)};k.prototype._defaultElevationInfoNoZ=function(){return A};k.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;var e=this.getGraphicElevationContext(a,b.elevationOffset||0),f=b.symbol,g="on-the-ground"===this._elevationContext.mode&&!f.symbolLayers.some(function(a){return"object"===
a.type||"text"===a.type});if("label-3d"!==f.type&&g)return null;f=c.computeCentroid(a.geometry);return null==f?null:this._createAs3DShape(a,f,e,b,"graphic"+a.uid,a.uid)};k.prototype.layerOpacityChanged=function(){this._material.setParameterValues(this.materialParameters);return!0};k.prototype.layerElevationInfoChanged=function(a,c,b){var e=this,f=this._elevationContext.mode;if(b!==f&&("on-the-ground"===b||"on-the-ground"===f))return!1;a.forEach(function(a){var b=c(a);b&&e.updateGraphicElevationContext(a.graphic,
b)});return!0};k.prototype.slicePlaneEnabledChanged=function(a,c){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};k.prototype.pixelRatioChanged=function(a,c){return!0};k.prototype.getGraphicElevationContext=function(a,c){void 0===c&&(c=0);a=d.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(c);return a};k.prototype.updateGraphicElevationContext=function(a,c){a=this.getGraphicElevationContext(a,c.metadata.elevationOffset);c.elevationContext.set(a);
c.needsElevationUpdates=e.needsElevationUpdates2D(a.mode)};k.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,memory:a.emptySymbolComplexity.memory}};k.prototype.createVertexData=function(a){var c,b=a.translation;a=a.centerOffset;if(!b&&!a)return m;b=b?{size:3,data:[b[0],b[1],b[2]]}:m[w.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:m[w.AUXPOS1];return c={},c[w.POSITION]=b,c[w.NORMAL]=m[w.NORMAL],c[w.AUXPOS1]=a,c};k.prototype.getOrCreateMaterial=function(a,
c){var b=this.perInstanceMaterialParameters(a),e=v.uniqueMaterialIdentifier(b);if(e===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var f=a.materialCollection.getMaterial(e);f||(f=new v(b,c+"_lineCallout_shared"),a.materialCollection.addMaterial(e,f));return{material:f,isUnique:!1}}f=new v(b,c+"_lineCallout_unique");return{material:f,isUnique:!0}};k.prototype._createAs3DShape=function(a,c,g,d,h,m){a=new n(this.createVertexData(d),x,n.DefaultOffsets,
"point");a=[new p(a,h)];var k=this.getOrCreateMaterial(d,h);h=e.createStageObjectForPoint(this._context,c,a,[k.material],null,null,g,h,this._context.layer.uid,m,!0);if(null===h)return null;m=new f(this,h.object,a,k.isUnique?[k.material]:null,null,b.perObjectElevationAligner,g);m.metadata={elevationOffset:d.elevationOffset||0};m.alignedTerrainElevation=h.terrainElevation;m.needsElevationUpdates=e.needsElevationUpdates2D(g.mode);e.extendPointGraphicElevationContext(m,c,this._context.elevationProvider);
return m};return k}(k.Graphics3DSymbolLayer);d.Graphics3DLineCalloutSymbolLayer=t;var m=(r={},r[w.POSITION]={size:3,data:[0,0,0]},r[w.NORMAL]={size:3,data:[0,0,1]},r[w.AUXPOS1]={size:4,data:[0,0,0,1]},r);r=new Uint32Array([0]);var x=(y={},y[w.POSITION]=r,y[w.NORMAL]=r,y[w.AUXPOS1]=r,y),A={mode:"relative-to-ground",offset:0};d.default=t})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ./Graphics3DSymbolCommonCode ./graphicUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){Object.defineProperty(d,"__esModule",{value:!0});var p=h.VertexAttrConstants,n=new f,u=b.vec3f64.create(),v=b.vec3f64.create(),r=b.vec3f64.create(),y=g.mat4f64.create(),w=b.vec3f64.create(),m={verticalDistanceToGround:0,terrainElevation:0};d.perVertexElevationAligner=function(a,b,f,g){a=a.stageObject;n.spatialReference=f.spatialReference;for(var h=a.getGeometryRecords(),k=h.length,l="absolute-height"!==b.mode,x=0,A=0;A<k;A++){var y=h[A].geometry,w=h[A].getShaderTransformation();
v[0]=w[12];v[1]=w[13];v[2]=w[14];y.invalidateBoundingInfo();for(var w=y.data.getVertexAttr(),C=w[p.POSITION],y=C.data,w=w.mapPos.data,C=C.size,q=y.length/C,B=0,E=0,t=!1,X=0,J=0;J<q;J++){n.x=w[E++];n.y=w[E++];n.z=w[E++];r[0]=y[B];r[1]=y[B+1];r[2]=y[B+2];var R=e.computeElevation(f,n,b,g,l?m:null);l&&(X+=m.terrainElevation);u[0]=y[B]+v[0];u[1]=y[B+1]+v[1];u[2]=y[B+2]+v[2];g.setAltitude(R,u);y[B]=u[0]-v[0];y[B+1]=u[1]-v[1];y[B+2]=u[2]-v[2];if(c.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)t=!0;else if(R=
d.updateThresholdInMeters/g.unitInMeters,Math.abs(r[0]-y[B])>=R||Math.abs(r[1]-y[B+1])>=R||Math.abs(r[2]-y[B+2])>=R)t=!0;B+=C}x+=X/q;t&&a.geometryVertexAttrsUpdated(A)}return x/k};d.perObjectElevationAligner=function(b,f,g,h,p){b=b.stageObject;var n=f.centerPointInElevationSR,r=0;p=0;if(b.metadata.usesVerticalDistanceToGround)r=e.computeElevation(g,n,f,h,m),k.updateVertexAttributeAuxpos1w(b,m.verticalDistanceToGround),p=m.terrainElevation;else{var v="absolute-height"!==f.mode,r=e.computeElevation(g,
n,f,h,v?m:null);v&&(p=m.terrainElevation)}f=q.mat4.copy(x,b.objectTransformation);g=l.vec3.set(w,f[12],f[13],f[14]);c.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(u[0]=n.x,u[1]=n.y,u[2]=r,a.computeLinearTransformation(n.spatialReference,u,f,h.spatialReference)&&(b.objectTransformation=f)):h.setAltitudeOfTransformation(r,f);h=d.updateThresholdInMeters/h.unitInMeters;if(Math.abs(f[12]-g[0])>=h||Math.abs(f[13]-g[1])>=h||Math.abs(f[14]-g[2])>=h)b.objectTransformation=f;return p};var x=g.mat4f64.create();
d.perLodInstanceElevationAligner=function(b,f,g,h,k){var p=f.centerPointInElevationSR,n=0;k=0;var r="absolute-height"!==f.mode,n=e.computeElevation(g,p,f,h,r?m:null);r&&(k=m.terrainElevation);f=b.graphics3DSymbolLayer.lodRenderer.instanceData;b=b.instanceIndex;f.getGlobalTransform(b,y);g=l.vec3.set(w,y[12],y[13],y[14]);c.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(u[0]=p.x,u[1]=p.y,u[2]=n,a.computeLinearTransformation(p.spatialReference,u,y,h.spatialReference)&&f.setGlobalTransform(b,y)):h.setAltitudeOfTransformation(n,
y);h=d.updateThresholdInMeters/h.unitInMeters;(Math.abs(y[12]-g[0])>=h||Math.abs(y[13]-g[1])>=h||Math.abs(y[14]-g[2])>=h)&&f.setGlobalTransform(b,y);return k};d.updateThresholdInMeters=.01;d.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/coordsUtils ../../../../geometry/support/triangulationUtils ../../../../layers/graphics/dehydratedFeatures ./graphicUtils ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){function p(a,c,b,e,f){var g=c.z||0,d=b.featureExpressionInfoContext;switch(b.mode){case "on-the-ground":return b=a.getElevation(c,"ground")||0,f&&(f.verticalDistanceToGround=0,f.terrainElevation=b),b;case "relative-to-ground":return a=a.getElevation(c,"ground")||0,b=b.calculateOffsetRenderUnits(e),null==d&&(b+=g),f&&(f.verticalDistanceToGround=b,f.terrainElevation=a),b+a;case "relative-to-scene":return a=a.getElevation(c,"scene")||0,b=b.calculateOffsetRenderUnits(e),
f&&(f.verticalDistanceToGround=b,f.terrainElevation=a),b+a;case "absolute-height":return b=b.calculateOffsetRenderUnits(e),null==d&&(b+=g),f&&(a=a.getElevation(c,"ground")||0,f.verticalDistanceToGround=b-a,f.terrainElevation=a),b;default:q.neverReached(b.mode)}return 0}function n(a,c){a=e.pathsToTriangulationInfo(a,c);return{vertexData:a.position,polygons:a.polygons,outlines:a.outlines}}function u(a,c,b,e,f){c*=3;e*=3;for(var g=0;g<f;++g)b[e++]=a[c++],b[e++]=a[c++],b[e++]=a[c++]}function v(c,b,e,
f,g,d,h){return a.bufferToBuffer(c,e,b,f,d,g,h)}function r(c,b,e){a.pointToVector(c,b,e)}function y(a,c){return!(a[0]>c[3]||a[0]<c[0]||a[1]>c[4]||a[1]<c[1])}function w(a,c){return!(c[0]>a[3]||c[3]<a[0]||c[1]>a[4]||c[4]<a[1])}Object.defineProperty(d,"__esModule",{value:!0});var m=b.vec3f64.create(),x=l.mat4f64.create(),A=k.makeDehydratedPoint(0,0,0,null);d.createStageObjectForPoint=function(b,e,f,d,k,n,l,v,u,A,w,q){var E=f?f.length:0,Q=b.clippingExtent;r(e,m,b.elevationProvider.spatialReference);if(Q&&
!y(m,Q))return null;r(e,m,b.renderSpatialReference);Q=b.localOriginFactory.getOrigin(m);v=new h({castShadow:!1,metadata:{layerUid:u,graphicUid:A,usesVerticalDistanceToGround:!!w},idHint:v});for(u=0;u<E;u++)v.addGeometry(f[u],d[u],k?k[u]:x,n,Q,q);f=b.renderSpatialReference;d=b.elevationProvider;k=b.renderCoordsHelper;b=0;var J;v.metadata.usesVerticalDistanceToGround?(b=p(d,e,l,k,B),c.updateVertexAttributeAuxpos1w(v,B.verticalDistanceToGround),J=B.terrainElevation):(n="absolute-height"!==l.mode,b=p(d,
e,l,k,n?B:null),n&&(J=B.terrainElevation));l=g.mat4.copy(C,v.objectTransformation);m[0]=e.x;m[1]=e.y;m[2]=b;a.computeLinearTransformation(e.spatialReference,m,l,f)?v.objectTransformation=l:console.warn("Could not locate symbol object properly, it might be misplaced");return{object:v,terrainElevation:J}};d.extendPointGraphicElevationContext=function(a,c,b){a=a.elevationContext;b=b.spatialReference;r(c,m,b);a.centerPointInElevationSR=k.makeDehydratedPoint(m[0],m[1],c.hasZ?m[2]:0,b)};d.placePointOnGeometry=
function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return c.computeCentroid(a);case "polyline":var b=a.paths[0];if(!b||0===b.length)break;b=f.getPointOnPath(b,f.getPathLength(b)/2);return k.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference);case "mesh":return a.extent.center}return null};d.computeElevation=p;var C=l.mat4f64.create();d.getSingleSizeDriver=function(a,c){void 0===c&&(c=0);return isFinite(a[c])?a[c]:null};d.copyPathData=n;d.copyVertices=u;d.chooseOrigin=
function(a,c,b,e){c=Math.floor(c+(b-1)/2);e[0]=a[3*c+0];e[1]=a[3*c+1];e[2]=a[3*c+2]};d.subtractCoordinates=function(a,c,b,e){c*=3;for(var f=0;f<b;++f)a[c++]-=e[0],a[c++]-=e[1],a[c++]-=e[2]};d.setZ=function(a,c,b,e){c*=3;for(var f=0;f<b;++f)a[c+2]=e,c+=3};d.offsetZ=function(a,c,b,e){c*=3;for(var f=0;f<b;++f)a[c+2]+=e,c+=3};d.scaleZ=function(a,c,b,e){c*=3;for(var f=0;f<b;++f)a[c+2]*=e,c+=3};d.flatArrayToArrayOfArrays=function(a,c,b){var e=[];c*=3;for(var f=0;f<b;++f)e.push([a[c++],a[c++],a[c++]]);return e};
d.reproject=v;d.reprojectPoint=r;d.getGeometryVertexData3D=function(a,c,b,e,f,g,d){var h=f.spatialReference;a=n(a,c);c=a.vertexData;var m=c.length/3,k=new Float64Array(c.length),p=!0;b.equals(h)?u(c,0,k,0,c.length):p=v(c,0,b,k,0,h,m);var l=b=0,r=d.mode,x=0,y=0,w=0;g=d.calculateOffsetRenderUnits(g);d=d.featureExpressionInfoContext;A.spatialReference=f.spatialReference;b*=3;for(var l=3*l,C=0;C<m;++C){A.x=k[b+0];A.y=k[b+1];A.z=k[b+2];switch(r){case "on-the-ground":y=x=f.getElevation(A)||0;w+=x;break;
case "relative-to-ground":x=f.getElevation(A)||0;y=x+g;null==d&&(y+=A.z);w+=x;break;case "relative-to-scene":x=f.getElevation(A,"scene")||0;y=x+g;w+=x;break;case "absolute-height":y=g,null==d&&(y+=A.z)}c[l+0]=k[b+0];c[l+1]=k[b+1];c[l+2]=y;b+=3;l+=3}f=w/m;h.equals(e)||v(c,0,h,c,0,e,m);return{geometryData:a,vertexData:c,eleVertexData:k,terrainElevation:f,projectionSuccess:p}};d.getGeometryVertexDataDraped=function(c,b,e){c=n(c,!1);var f=c.vertexData,g=f.length/3,d=!0;b.equals(e)||(d=a.bufferToBuffer(f,
b,0,f,e,0,g));return{geometryData:c,vertexData:f,projectionSuccess:d}};d.computeBoundingBox=function(a,c,b,e){e[0]=Number.MAX_VALUE;e[1]=Number.MAX_VALUE;e[2]=Number.MAX_VALUE;e[3]=-Number.MAX_VALUE;e[4]=-Number.MAX_VALUE;e[5]=-Number.MAX_VALUE;c*=3;for(var f=0;f<b;++f){var g=a[c++],d=a[c++],h=a[c++];g<e[0]&&(e[0]=g);d<e[1]&&(e[1]=d);h<e[2]&&(e[2]=h);g>e[3]&&(e[3]=g);d>e[4]&&(e[4]=d);h>e[5]&&(e[5]=h)}return e};d.pointInBox2D=y;d.boxesIntersect2D=w;d.boundingBoxClipped=function(a,c){return c?!w(a,
c):!1};d.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};d.needsElevationUpdates3D=function(a){return"absolute-height"!==a};var B={verticalDistanceToGround:0,terrainElevation:0}})},"esri/geometry/support/triangulationUtils":function(){define(["require","exports","../../core/libs/earcut/earcut","./coordsUtils","./meshUtils/deduplicate"],function(t,d,q,g,l){function b(b,c,a){if(1===b.length)return b[0];c=new Float64Array(c);a=new Uint32Array(a);for(var e=
0,f=0,g=0,d=0;d<b.length;d++){for(var k=b[d],l=0;l<k.position.length;l++)c[e++]=k.position[l];for(l=0;l<k.faces.length;l++)a[f++]=k.faces[l]+g;g=e/3}return{position:c,faces:a}}function f(b,c){for(var a=b.length,f=Array(a),d=Array(a),k=Array(a),l=0,v=0,r=0,y=0,w=0;w<a;++w)y+=b[w].length;for(var y=new Float64Array(3*y),m=0,x=a-1;0<=x;x--){var A=b[x],C=!g.isClockwise(A,!1,!1);if(C&&1!==a)f[l++]=A;else{for(var q=A.length,w=0;w<l;++w)q+=f[w].length;w={index:m,pathLengths:Array(l+1),count:q,holeIndices:Array(l)};
w.pathLengths[0]=A.length;0<A.length&&(k[r++]={index:m,count:A.length});m=C?e(A,A.length-1,-1,y,m,A.length,c):e(A,0,1,y,m,A.length,c);for(A=0;A<l;++A)C=f[A],w.holeIndices[A]=m,w.pathLengths[A+1]=C.length,0<C.length&&(k[r++]={index:m,count:C.length}),m=e(C,0,1,y,m,C.length,c);l=0;0<w.count&&(d[v++]=w)}}for(A=0;A<l;++A)C=f[A],0<C.length&&(k[r++]={index:m,count:C.length}),m=e(C,0,1,y,m,C.length,c);v<a&&(d.length=v);r<a&&(k.length=r);return{position:y,polygons:d,outlines:k}}function e(b,c,a,e,f,g,d){f*=
3;for(var h=0;h<g;++h){var k=b[c];e[f++]=k[0];e[f++]=k[1];e[f++]=d?k[2]:0;c+=a}return f/3}Object.defineProperty(d,"__esModule",{value:!0});d.triangulate=function(e){var c=f(e.rings,e.hasZ),a=[],g=0,d=0;e=function(b){var e=b.index,f=new Float64Array(c.position.buffer,3*e*c.position.BYTES_PER_ELEMENT,3*b.count);b=b.holeIndices.map(function(a){return a-e});b=new Uint32Array(q(f,b,3));a.push({position:f,faces:b});g+=f.length;d+=b.length};for(var k=0,u=c.polygons;k<u.length;k++)e(u[k]);e=b(a,g,d);k=l.default(e.position.buffer,
6,e.faces);e.position=new Float64Array(k.buffer);e.faces=k.indices;return e};d.pathsToTriangulationInfo=f})},"esri/core/libs/earcut/earcut":function(){define([],function(){function t(a,c,e){e=e||2;var h=c&&c.length,m=h?c[0]*e:a.length,p=d(a,0,m,e,!0),l=[];if(!p||p.next===p.prev)return l;var n,r,v,x;if(h){var A=e,h=[],y,w,O;x=0;for(y=c.length;x<y;x++)w=c[x]*A,O=x<y-1?c[x+1]*A:a.length,w=d(a,w,O,A,!1),w===w.next&&(w.steiner=!0),h.push(k(w));h.sort(b);for(x=0;x<h.length;x++){c=h[x];A=p;if(A=f(c,A))c=
u(A,c),q(c,c.next);p=q(p,p.next)}}if(a.length>80*e){n=v=a[0];r=h=a[1];for(A=e;A<m;A+=e)x=a[A],c=a[A+1],x<n&&(n=x),c<r&&(r=c),x>v&&(v=x),c>h&&(h=c);v=Math.max(v-n,h-r);v=0!==v?1/v:0}g(p,l,e,n,r,v);return l}function d(a,c,b,e,f){var g;if(f===0<w(a,c,b,e))for(f=c;f<b;f+=e)g=v(f,a[f],a[f+1],g);else for(f=b-e;f>=c;f-=e)g=v(f,a[f],a[f+1],g);g&&h(g,g.next)&&(r(g),g=g.next);return g}function q(c,b){if(!c)return c;b||(b=c);var e;do if(e=!1,c.steiner||!h(c,c.next)&&0!==a(c.prev,c,c.next))c=c.next;else{r(c);
c=b=c.prev;if(c===c.next)break;e=!0}while(e||c!==b);return b}function g(b,f,d,k,v,y,w){if(b){if(!w&&y){var m=b,x=m;do null===x.z&&(x.z=e(x.x,x.y,k,v,y)),x.prevZ=x.prev,x=x.nextZ=x.next;while(x!==m);x.prevZ.nextZ=null;x.prevZ=null;var m=x,A,C,B,E,I,O,t=1;do{x=m;B=m=null;for(E=0;x;){E++;C=x;for(A=I=0;A<t&&(I++,C=C.nextZ,C);A++);for(O=t;0<I||0<O&&C;)0!==I&&(0===O||!C||x.z<=C.z)?(A=x,x=x.nextZ,I--):(A=C,C=C.nextZ,O--),B?B.nextZ=A:m=A,A.prevZ=B,B=A;x=C}B.nextZ=null;t*=2}while(1<E)}for(m=b;b.prev!==b.next;){x=
b.prev;C=b.next;if(y)B=l(b,k,v,y);else a:if(B=b,E=B.prev,I=B,t=B.next,0<=a(E,I,t))B=!1;else{for(A=B.next.next;A!==B.prev;){if(c(E.x,E.y,I.x,I.y,t.x,t.y,A.x,A.y)&&0<=a(A.prev,A,A.next)){B=!1;break a}A=A.next}B=!0}if(B)f.push(x.i/d),f.push(b.i/d),f.push(C.i/d),r(b),m=b=C.next;else if(b=C,b===m){if(!w)g(q(b),f,d,k,v,y,1);else if(1===w){w=f;m=d;x=b;do C=x.prev,B=x.next.next,!h(C,B)&&p(C,x,x.next,B)&&n(C,B)&&n(B,C)&&(w.push(C.i/m),w.push(x.i/m),w.push(B.i/m),r(x),r(x.next),x=b=B),x=x.next;while(x!==b);
b=x;g(b,f,d,k,v,y,2)}else if(2===w)a:{w=b;do{for(m=w.next.next;m!==w.prev;){if(x=w.i!==m.i){x=w;C=m;B=void 0;if(B=x.next.i!==C.i&&x.prev.i!==C.i){B=void 0;b:{B=x;do{if(B.i!==x.i&&B.next.i!==x.i&&B.i!==C.i&&B.next.i!==C.i&&p(B,B.next,x,C)){B=!0;break b}B=B.next}while(B!==x);B=!1}B=!B}E=void 0;if(E=B&&n(x,C)&&n(C,x)){B=x;E=!1;I=(x.x+C.x)/2;C=(x.y+C.y)/2;do B.y>C!==B.next.y>C&&B.next.y!==B.y&&I<(B.next.x-B.x)*(C-B.y)/(B.next.y-B.y)+B.x&&(E=!E),B=B.next;while(B!==x)}x=E}if(x){b=u(w,m);w=q(w,w.next);b=
q(b,b.next);g(w,f,d,k,v,y);g(b,f,d,k,v,y);break a}m=m.next}w=w.next}while(w!==b)}break}}}}function l(b,f,g,d){var h=b.prev,k=b.next;if(0<=a(h,b,k))return!1;var m=h.x>b.x?h.x>k.x?h.x:k.x:b.x>k.x?b.x:k.x,p=h.y>b.y?h.y>k.y?h.y:k.y:b.y>k.y?b.y:k.y,l=e(h.x<b.x?h.x<k.x?h.x:k.x:b.x<k.x?b.x:k.x,h.y<b.y?h.y<k.y?h.y:k.y:b.y<k.y?b.y:k.y,f,g,d);f=e(m,p,f,g,d);g=b.prevZ;for(d=b.nextZ;g&&g.z>=l&&d&&d.z<=f;){if(g!==b.prev&&g!==b.next&&c(h.x,h.y,b.x,b.y,k.x,k.y,g.x,g.y)&&0<=a(g.prev,g,g.next))return!1;g=g.prevZ;
if(d!==b.prev&&d!==b.next&&c(h.x,h.y,b.x,b.y,k.x,k.y,d.x,d.y)&&0<=a(d.prev,d,d.next))return!1;d=d.nextZ}for(;g&&g.z>=l;){if(g!==b.prev&&g!==b.next&&c(h.x,h.y,b.x,b.y,k.x,k.y,g.x,g.y)&&0<=a(g.prev,g,g.next))return!1;g=g.prevZ}for(;d&&d.z<=f;){if(d!==b.prev&&d!==b.next&&c(h.x,h.y,b.x,b.y,k.x,k.y,d.x,d.y)&&0<=a(d.prev,d,d.next))return!1;d=d.nextZ}return!0}function b(a,c){return a.x-c.x}function f(a,b){var e=b,f=a.x,g=a.y,d=-Infinity,h;do{if(g<=e.y&&g>=e.next.y&&e.next.y!==e.y){var k=e.x+(g-e.y)*(e.next.x-
e.x)/(e.next.y-e.y);if(k<=f&&k>d){d=k;if(k===f){if(g===e.y)return e;if(g===e.next.y)return e.next}h=e.x<e.next.x?e:e.next}}e=e.next}while(e!==b);if(!h)return null;if(f===d)return h.prev;b=h;for(var k=h.x,m=h.y,p=Infinity,l,e=h.next;e!==b;)f>=e.x&&e.x>=k&&f!==e.x&&c(g<m?f:d,g,k,m,g<m?d:f,g,e.x,e.y)&&(l=Math.abs(g-e.y)/(f-e.x),(l<p||l===p&&e.x>h.x)&&n(e,a)&&(h=e,p=l)),e=e.next;return h}function e(a,c,b,e,f){a=32767*(a-b)*f;c=32767*(c-e)*f;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;
c=(c|c<<8)&16711935;c=(c|c<<4)&252645135;c=(c|c<<2)&858993459;return(a|a<<1)&1431655765|((c|c<<1)&1431655765)<<1}function k(a){var c=a,b=a;do c.x<b.x&&(b=c),c=c.next;while(c!==a);return b}function c(a,c,b,e,f,g,d,h){return 0<=(f-d)*(c-h)-(a-d)*(g-h)&&0<=(a-d)*(e-h)-(b-d)*(c-h)&&0<=(b-d)*(g-h)-(f-d)*(e-h)}function a(a,c,b){return(c.y-a.y)*(b.x-c.x)-(c.x-a.x)*(b.y-c.y)}function h(a,c){return a.x===c.x&&a.y===c.y}function p(c,b,e,f){return h(c,b)&&h(e,f)||h(c,f)&&h(e,b)?!0:0<a(c,b,e)!==0<a(c,b,f)&&0<
a(e,f,c)!==0<a(e,f,b)}function n(c,b){return 0>a(c.prev,c,c.next)?0<=a(c,b,c.next)&&0<=a(c,c.prev,b):0>a(c,b,c.prev)||0>a(c,c.next,b)}function u(a,c){var b=new y(a.i,a.x,a.y),e=new y(c.i,c.x,c.y),f=a.next,g=c.prev;a.next=c;c.prev=a;b.next=f;f.prev=b;e.next=b;b.prev=e;g.next=e;e.prev=g;return e}function v(a,c,b,e){a=new y(a,c,b);e?(a.next=e.next,a.prev=e,e.next.prev=a,e.next=a):(a.prev=a,a.next=a);return a}function r(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&
(a.nextZ.prevZ=a.prevZ)}function y(a,c,b){this.i=a;this.x=c;this.y=b;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function w(a,c,b,e){for(var f=0,g=b-e;c<b;c+=e)f+=(a[g]-a[c])*(a[c+1]+a[g+1]),g=c;return f}t.deviation=function(a,c,b,e){var f=c&&c.length,g=Math.abs(w(a,0,f?c[0]*b:a.length,b));if(f)for(var f=0,d=c.length;f<d;f++)g-=Math.abs(w(a,c[f]*b,f<d-1?c[f+1]*b:a.length,b));for(f=c=0;f<e.length;f+=3){var d=e[f]*b,h=e[f+1]*b,k=e[f+2]*b;c+=Math.abs((a[d]-a[k])*(a[h+1]-a[d+
1])-(a[d]-a[h])*(a[k+1]-a[d+1]))}return 0===g&&0===c?0:Math.abs((c-g)/g)};t.flatten=function(a){for(var c=a[0][0].length,b={vertices:[],holes:[],dimensions:c},e=0,f=0;f<a.length;f++){for(var g=0;g<a[f].length;g++)for(var d=0;d<c;d++)b.vertices.push(a[f][g][d]);0<f&&(e+=a[f-1].length,b.holes.push(e))}return b};return t})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["require","exports","../../../core/mathUtils"],function(t,d,q){function g(b,f,e,g){void 0===g&&(g=0);var c=b.byteLength/
(4*f),a=new Uint32Array(b,0,c*f);b=new Uint32Array(c);var d=Math.floor(1.1*c)+1;if(null==l||l.length<2*d)l=new Uint32Array(q.nextHighestPowerOfTwo(2*d));for(var k=0;k<2*d;k++)l[k]=0;for(var n=0,u=0!==g?Math.ceil(7.84*1.96/(g*g)*g*(1-g)):c,k=0;k<c;k++){if(k===u){var v=1-n/k;if(v+1.96*Math.sqrt(v*(1-v)/k)<g)return null;u*=2}for(var v=k*f,r,y=r=0;y<f;y++)r=a[v+y]+r|0,r=r+(r<<11)+(r>>>2)|0;r>>>=0;for(var y=r%d,w=n;0!==l[2*y+1];){if(l[2*y]===r){var m=l[2*y+1]-1,x=m*f;a:{for(var A=0;A<f;A++)if(a[v+A]!==
a[x+A]){x=!1;break a}x=!0}if(x){w=b[m];break}}y++;y>=d&&(y-=d)}w===n&&(l[2*y]=r,l[2*y+1]=k+1,n++);b[k]=w}if(0!==g&&1-n/c<g)return null;g=new Uint32Array(f*n);for(k=n=0;k<c;k++)if(b[k]===n){d=a;u=k*f;v=g;r=n*f;y=f;for(w=0;w<y;w++)v[r+w]=d[u+w];n++}if(e){f=new Uint32Array(e.length);for(k=0;k<f.length;k++)f[k]=b[e[k]];b=f}return{buffer:g.buffer,indices:b,uniqueCount:n}}Object.defineProperty(d,"__esModule",{value:!0});d.deduplicate=g;var l=null;d.default=g})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../geometry ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../geometry/support/webMercatorUtils ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u){function v(a){var c=a.paths[0];if(!c||0===c.length)return null;c=p.getPointOnPath(c,p.getPathLength(c)/2);return u.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference)}function r(a,c,b){if(!c||!a)return a;var e=a.spatialReference;e.isWebMercator&&c.isWGS84?(n.xyToLngLat(a.x,a.y,m),b||(a=u.clonePoint(a)),a.x=m[0],a.y=m[1],a.spatialReference=q.SpatialReference.WGS84):c.isWebMercator&&e.isWGS84&&(n.lngLatToXY(a.x,a.y,m),b||(a=u.clonePoint(a)),a.x=m[0],a.y=m[1],
a.spatialReference=q.SpatialReference.WebMercator);return a}function y(a){if(Array.isArray(a)){for(var c=0;c<a.length;c++)if(!y(a[c]))return!1;return!0}return null==a||0<=a}Object.defineProperty(d,"__esModule",{value:!0});var w=e.vec3f64.fromValues(1,1,1);d.computeCentroid=function(a,c){if("point"===a.type)return r(a,c,!1);if(u.isHydratedGeometry(a))switch(a.type){case "extent":return r(a.center,c,!1);case "polygon":return r(a.centroid,c,!1);case "polyline":return r(v(a),c,!0);case "mesh":return r(a.extent.center,
c,!1)}else switch(a.type){case "extent":var b=g.isFinite(a.zmin);a=u.makeDehydratedPoint(.5*(a.xmax+a.xmin),.5*(a.ymax+a.ymin),b?.5*(a.zmax+a.zmin):void 0,a.spatialReference);return r(a,c,!0);case "polygon":return(b=a.rings[0])&&0!==b.length?(b=h.ringsCentroid(a.rings,a.hasZ),a=u.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference)):a=null,r(a,c,!0);case "polyline":return r(v(a),c,!0)}};d.convertPointSR=r;d.enlargeExtent=function(c,b,e){if(c){b||(b=a.create());var f=.5*c.width*(e-1);e=.5*c.height*
(e-1);c.width<1E-7*c.height?f+=e/20:c.height<1E-7*c.width&&(e+=f/20);k.vec4.set(b,c.xmin-f,c.ymin-e,c.xmax+f,c.ymax+e);return b}return null};d.updateVertexAttributeAuxpos1w=function(a,c){for(var b=0;b<a.geometries.length;++b){var e=a.geometries[b].data.vertexAttributes.auxpos1;e&&e.data[3]!==c&&(e.data[3]=c,a.geometryVertexAttrsUpdated(b))}};d.mixinColorAndOpacity=function(a,c){var b=[1,1,1,1];null!=a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);null!==c&&void 0!==c?b[3]=c:null!=a&&3<a.length&&(b[3]=a[3]);return b};
d.overrideColor=function(a,c,b,e,f,g){void 0===g&&(g=[0,0,0,0]);for(var d=0;3>d;++d)g[d]=a&&null!=a[d]?a[d]:b&&null!=b[d]?b[d]:f[d];g[3]=null!=c?c:null!=e?e:f[3];return g};d.computeObjectScale=function(a,c,b,f){void 0===a&&(a=w);void 0===f&&(f=1);var g=Array(3);if(null==c||null==b)g[0]=1,g[1]=1,g[2]=1;else{for(var d=void 0,h=0,k=2;0<=k;k--){var m=a[k],p=void 0,l=null!=m,n=0===k&&!d&&!l,r=b[k];"symbolValue"===m||n?p=0!==r?c[k]/r:1:l&&"proportional"!==m&&isFinite(m)&&(p=0!==r?m/r:1);null!=p&&(d=g[k]=
p,h=Math.max(h,Math.abs(p)))}for(k=2;0<=k;k--)null==g[k]?g[k]=d:0===g[k]&&(g[k]=.001*h)}for(k=2;0<=k;k--)g[k]/=f;return e.vec3f64.fromArray(g)};d.computeSizeWithResourceSize=function(a,c){var b=c.width,f=c.depth,g=c.height;c=c.isPrimitive?10:1;if(null==b&&null==g&&null==f)return[c*a[0],c*a[1],c*a[2]];for(var b=e.vec3f64.fromValues(b,f,g),d,f=0;3>f;f++)if(g=b[f],null!=g){d=g/a[f];break}for(f=0;3>f;f++)null==b[f]&&(b[f]=a[f]*d);return b};d.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=
[a.width,a.depth,a.height]);return y(a)?null:"Symbol sizes may not be negative values"};d.computeObjectRotation=function(a,c,e,f){void 0===f&&(f=b.mat4f64.create());a=a||0;c=c||0;e=e||0;0!==a&&l.mat4.rotateZ(f,f,-a/180*Math.PI);0!==c&&l.mat4.rotateX(f,f,c/180*Math.PI);0!==e&&l.mat4.rotateY(f,f,e/180*Math.PI);return f};d.demResolutionForBoundingBox=function(a,b){return null!=b.minDemResolution?b.minDemResolution:c.isPoint(a)?b.minDemResolutionForPoints:.01*c.maximumDimension(a)};d.namedAnchorToHUDMaterialAnchorPos=
{"bottom-left":f.vec2f64.fromValues(0,0),bottom:f.vec2f64.fromValues(.5,0),"bottom-right":f.vec2f64.fromValues(1,0),left:f.vec2f64.fromValues(0,.5),center:f.vec2f64.fromValues(.5,.5),right:f.vec2f64.fromValues(1,.5),"top-left":f.vec2f64.fromValues(0,1),top:f.vec2f64.fromValues(.5,1),"top-right":f.vec2f64.fromValues(1,1)};var m=[0,0]})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../webgl-engine/Stage".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){t=function(){function d(a,b,e,f,g,h,k,p){this.type="object3d";this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.uniqueMaterials=f;this.uniqueGeometries=e;this.uniqueTextures=g;this.stageObject=b;this.elevationAligner=h;this.elevationContext=new c(k);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=p?p:d.VisibilityModes.HIDE_FACERANGE}d.prototype.initialize=function(a,c){this.stageLayer=
a;this.stage=c;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)c.add(h.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)c.add(h.ModelContentType.GEOMETRY,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)c.add(h.ModelContentType.TEXTURE,this.uniqueTextures[a]);c.add(h.ModelContentType.OBJECT,this.stageObject)};d.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==
a?((this._visible=a)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===d.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),a=this.stage.view.ensureEdgeView(),a.hasObject(this.stageObject)&&a.updateObjectVisibility(this.stageObject,this._visible),!0):!1};Object.defineProperty(d.prototype,"visible",{get:function(){return this._visible},
enumerable:!0,configurable:!0});d.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var c=0;c<this.uniqueMaterials.length;c++)a.remove(h.ModelContentType.MATERIAL,this.uniqueMaterials[c].id);if(this.uniqueGeometries)for(c=0;c<this.uniqueGeometries.length;c++)a.remove(h.ModelContentType.GEOMETRY,this.uniqueGeometries[c].id);if(this.uniqueTextures)for(c=0;c<this.uniqueTextures.length;c++)a.remove(h.ModelContentType.TEXTURE,this.uniqueTextures[c].id)}a.remove(h.ModelContentType.OBJECT,
this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);a=this.stage.view.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this._visible=!1;this.stage=this.stageLayer=null};d.prototype.alignWithElevation=function(a,c,b){this.elevationAligner&&(k.setContextFeature(this.elevationContext.featureExpressionInfoContext,b),a=this.elevationAligner(this,this.elevationContext,a,c),null!=a&&(this.alignedTerrainElevation=
a))};d.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};d.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=f.vec3f64.create());return b.vec3.copy(a,this.stageObject.getCenter(!0))};d.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=e.create());var c=this.stageObject;a||(a=e.create());e.setMin(a,c.getBBMin(!0));e.setMax(a,c.getBBMax(!0));return a};d.prototype.getProjectedBoundingBox=function(c,f,d,h){return l(this,void 0,void 0,function(){var k,m,l,r,x,
w,y,q,K,M;return g(this,function(g){switch(g.label){case 0:k=this.getBoundingBoxObjectSpace(h);m=v;l=e.isPoint(k)?1:m.length;for(r=0;r<l;r++)x=m[r],n[0]=k[x[0]],n[1]=k[x[1]],n[2]=k[x[2]],b.vec3.transformMat4(n,n,this.stageObject.objectTransformation),p[3*r+0]=n[0],p[3*r+1]=n[1],p[3*r+2]=n[2];if(!c(p,0,l))return[2,null];e.empty(k);w=null;this.calculateRelativeScreenBounds&&(w=this.calculateRelativeScreenBounds());for(r=0;r<3*l;r+=3){for(y=0;3>y;y++)k[y]=Math.min(k[y],p[r+y]),k[y+3]=Math.max(k[y+3],
p[r+y]);w&&d.push({location:p.slice(r,r+3),screenSpaceBoundingRect:w})}if(!f||!f.service||"absolute-height"===this.elevationContext.mode)return[3,5];e.center(k,u);q="relative-to-scene"===this.elevationContext.mode?"scene":"ground";K=void 0;if(!f.useViewElevation)return[3,1];K=f.service.getElevation(u[0],u[1],q);return[3,4];case 1:return g.trys.push([1,3,,4]),M=a.demResolutionForBoundingBox(k,f),[4,f.service.queryElevation(u[0],u[1],M,q)];case 2:return K=g.sent(),[3,4];case 3:return g.sent(),K=null,
[3,4];case 4:e.offset(k,0,0,-this.alignedTerrainElevation+K),g.label=5;case 5:return[2,k]}})})};d.prototype.addHighlight=function(a,c){c=this.stageObject.highlightAllComponents(c);a.addObject(this.stageObject,c)};d.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};return d}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";a[a.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(t||(t={}));var p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
n=f.vec3f64.create(),u=f.vec3f64.create(),v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return t})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require","exports","../../../../support/arcadeUtils"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.createContext=function(g,d,b){var f=null;g=g&&g.expression;"string"===typeof g&&(f="0"===g?0:null,null!=f?f={cachedResult:f}:(f=q.createSyntaxTree(g),q.dependsOnView(f)?(null!=b&&
b.error("Expressions containing '$view' are not supported on ElevationInfo"),f={cachedResult:0}):f={arcade:{func:q.createFunction(f),context:q.createExecContext(null,{sr:d})}}));return f};d.createFeature=function(g,d){return q.createFeature(g.attributes,g.geometry,d)};d.setContextFeature=function(g,d){null!=g&&null==g.cachedResult&&q.updateExecContext(g.arcade.context,d)};d.execute=function(g){if(null!=g){if(null!=g.cachedResult)return g.cachedResult;var d=g.arcade,d=q.executeFunction(d.func,d.context);
"number"!==typeof d&&(d=g.cachedResult=0);return d}return 0};d.extractExpressionInfo=function(g,d){void 0===d&&(d=!1);var b=(g=g&&g.featureExpressionInfo)&&g.expression;d||"0"===b||(g=null);return g};d.zeroContext={cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(t,d,q,g){return function(g){function b(b){b=g.call(this,b)||this;b.centerPointInElevationSR=
null;return b}q(b,g);return b}(g)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(t,d,q,g){return function(){function d(b){b?this.set(b):this.setDefaults()}Object.defineProperty(d.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"unit",{get:function(){return this._unit},enumerable:!0,
configurable:!0});d.prototype.setUnit=function(b){this._unit=b;this._metersPerElevationInfoUnit=q.getMetersPerUnit(b)};d.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.setUnit("meters")};d.prototype.set=function(b){this.mode=b.mode;this._meterUnitOffset=b._meterUnitOffset||0;this._renderUnitOffset=b._renderUnitOffset||0;this.featureExpressionInfoContext=b.featureExpressionInfoContext;this.setUnit(b.unit)};
d.prototype.setOffsetMeters=function(b){this._meterUnitOffset=b;this._renderUnitOffset=0};d.prototype.setOffsetElevationInfoUnits=function(b){this._meterUnitOffset=b*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};d.prototype.addOffsetRenderUnits=function(b){this._renderUnitOffset+=b};d.prototype.mixinApi=function(b){null!=b.mode&&(this.mode=b.mode);null!=b.unit&&this.setUnit(b.unit);null!=b.offset&&this.setOffsetElevationInfoUnits(b.offset)};d.prototype.calculateOffsetRenderUnits=function(b){var f=
this._meterUnitOffset,e=this.featureExpressionInfoContext;null!=e&&(f+=g.execute(e)*this._metersPerElevationInfoUnit);return f/b.unitInMeters+this._renderUnitOffset};return d}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3f64 ./lib/ModelContentType ./lighting/Lightsources ./parts/Model ./parts/View".split(" "),function(t,d,q,g,l,b,f){function e(b){return"function"===typeof b.addParentStage&&"function"===typeof b.removeParentStage}return function(){function d(c,
a,e,g){this.sceneIntersectionHelper=g;this._viewContent=[];this.container=a;this.viewingMode=c;this.model=new b;this.view=new f(a,this,this.model.getDirtySet(),e);this.view.setLighting({lights:[new l.MainLight(q.vec3f64.fromValues(.7,.7,.7)),new l.AmbientLight(q.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}d.prototype.setNeedsRender=function(){this.view.setNeedsRender()};d.prototype.dispose=function(){this.view.dispose();this.model=this.view=null};d.prototype.add=function(c,
a){this.model.add(c,a);e(a)&&a.addParentStage(this)};d.prototype.remove=function(c,a){c=this.model.remove(c,a);e(c)&&c.removeParentStage(this);return c};d.prototype.notifyDirty=function(c,a,b,e){this.model.notifyDirty(c,a,b,e)};d.prototype.processDirty=function(){var c=this.model.getDirtySet(),a=c.getDirtyMaterials();if(c.hasDirtyGeometryRecords()||a){d.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var b=c.commitLayers(this._viewContent);(0<b[0].length+
b[1].length+b[2].length||a)&&this.view.modify(b[0],b[1],b[2],a);d.DebugSettings.logDirtySet&&(console.log("RGs add: "+b[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+b[1].map(function(a){return a.uniqueName})));c.commit();c.clearDirtyMaterials();this.view.setNeedsRender()}};d.prototype.processDirtyLayer=function(c){var a=this.model.getDirtySet(),b=a.getDirtyMaterials();c=a.commitLayers([c]);(0<c[0].length+c[1].length+c[2].length||b)&&this.view.modify(c[0],c[1],c[2],b);a.clearDirtyMaterials();
this.view.setNeedsRender()};d.prototype.get=function(c,a){return this.model.get(c,a)};d.prototype.getAll=function(c){return this.model.getAll(c)};d.prototype.getCamera=function(){return this.view.getCamera()};d.prototype.setCamera=function(c){this.view.setCamera(c)};d.prototype.setViewParams=function(c){this.view.setViewParams(c)};d.prototype.getLayers=function(){return this.model.getAll(g.LAYER)};d.prototype.setLighting=function(c){this.view.setLighting(c)};d.prototype.getCanvas=function(){return this.view.getCanvas()};
d.prototype.setRenderParams=function(c){this.view.setRenderParams(c)};d.prototype.getRenderParams=function(){return this.view.getRenderParams()};d.prototype.has=function(c){return this.view.has(c)};d.prototype.getViewContent=function(){return this._viewContent.slice(0)};d.prototype.addToViewContent=function(c){for(var a=[],b=0;b<c.length;b++)-1===this._viewContent.indexOf(c[b])&&a.push(c[b]);0<c.length&&(this.processDirty(),c=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(a),
this.view.modify(c,[],[]),this._viewContent.push.apply(this._viewContent,a))};d.prototype.removeFromViewContent=function(c){this.processDirty();for(var a=this.model.getDirtySet(),b=this._viewContent,e=[],f=0;f<c.length;f++){var g=b.indexOf(c[f]);-1<g&&(b[g]=b[b.length-1],b.pop(),e.push(c[f]))}c=a.getResidentRenderGeometriesFilteredByLayers(e);this.view.modify([],c,[])};d.prototype.getFrameTask=function(){return this.view.getFrameTask()};d.prototype.takeScreenshot=function(c){return this.view.takeScreenshot(c)};
d.prototype.addRenderPlugin=function(c,a){"intersect"in a&&this.sceneIntersectionHelper.addIntersectionHandler(a);return this.view.renderPlugins.add(c,a)};d.prototype.removeRenderPlugin=function(c){"intersect"in c&&this.sceneIntersectionHelper.removeIntersectionHandler(c);return this.view.renderPlugins.remove(c)};d.prototype.getContentDebugStrings=function(c){return this.model.formatDebugInfo(c)};d.prototype.getRenderStats=function(){return this.view.getCombinedStats()};d.prototype.getRenderStatString=
function(c){var a=this.getRenderStats(),b="";if(c){var b=b+"\x3ctable\x3e",e;for(e in a)b+="\x3ctr\x3e\x3ctd\x3e"+e+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(a[e])+"\x3c/td\x3e\x3c/tr\x3e";b+="\x3c/table\x3e"}else for(e in a)b+=e+": "+a[e]+"\n";return b};d.prototype.getFramebufferTexture=function(c){void 0===c&&(c="color");return this.view.getFramebufferTexture(c)};d.prototype.getDrapedRenderer=function(){return this.view.getDrapedRenderer()};d.DebugSettings={endFrameContentValidation:!1,
logDirtySet:!1};d.ModelContentType=g;return d}()})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../../support/mathUtils ../lib/localOrigin ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(t,d,q,g,l,b,f,e,k){var c=k.assert,a=k.logWithBase;return function(){function d(){this.dirtySet=new f(this);this._uniqueIdx=0;this._id2origin={};this.content={};for(var a in b)this.content[b[a]]={}}d.prototype.getAll=function(a){a=
this.content[a];c(void 0!==a);return a};d.prototype.get=function(a,c){return this.getAll(a)[c]};d.prototype.add=function(a,e){var f=this.content[a];c(void 0!==f);var g=e.id;c(null==f[g],"Model/Stage already contains object to be added");f[g]=e;a===b.LAYER&&this.notifyDirty(a,e,"layerAdded")};d.prototype.remove=function(a,e){var f=this.content[a];c(void 0!==f);var g=f[e];c(void 0!==g,"Model/Stage doesn't contain object to be removed");delete f[e];a===b.TEXTURE&&g.unload();a===b.LAYER&&this.notifyDirty(a,
g,"layerRemoved");return g};d.prototype.getDirtySet=function(){return this.dirtySet};d.prototype.notifyDirty=function(a,c,b,e){this.dirtySet.handleUpdate(c,b,e)};d.prototype.getOrigin=function(c,b,e){void 0===e&&(e=10);var f=0;b=b*e/1E4;1<b&&(f=Math.ceil(a(b,2)));b=1E4*Math.pow(2,f);e=Math.round(c[0]/b);var g=Math.round(c[1]/b);c=Math.round(c[2]/b);var f=f+"_"+e+"_"+g+"_"+c,d=this._id2origin[f];null==d&&(d=l.fromValues(e*b,g*b,c*b,f),this._id2origin[f]=d);return d};d.prototype.getGeometryRenderGeometries=
function(a,c,b){var f=a.id,d=c.geometry,h=a.getCombinedStaticTransformation(c),k=g.maxScale(h),m=c.origin,p=c.id,l=this._uniqueIdx++;a=new e(d.data,d.boundingInfo,c.material,h,c.shaderTransformation,k,a.getCastShadow(),!!d.singleUse,f,p,l);a.origin=m||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=c.instanceParameters;b.push(a)};d.prototype.updateRenderGeometryTransformation=function(a,c,b){a.getCombinedStaticTransformation(c,b.transformation);b.updateTransformation(b.transformation);a=
this.getOrigin(b.center,b.bsRadius);return b.origin!==a};d.prototype.formatDebugInfo=function(a){var c=[];if(a){c[0]="\x3ctable\x3e";for(var e in b)a=b[e],c[0]+="\x3ctr\x3e\x3ctd\x3e"+a+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Object.keys(this.getAll(a)).length+"\x3c/td\x3e\x3c/tr\x3e";c[0]+="\x3c/table\x3e";c[1]=this.dirtySet.formatDebugInfo(!0)}else{c[0]="";for(e in b)a=b[e],c[0]+=q.pad(String(Object.keys(this.getAll(a)).length),6," ")+" "+a+", ";c[1]=this.dirtySet.formatDebugInfo(!1)}return c};
d.prototype.validateObject=function(a){a=a.geometryRecords;for(var e=0;e<a.length;++e){var f=a[e];c(null!=this.get(b.GEOMETRY,f.geometry.id));c(null!=this.get(b.MATERIAL,f.material.id))}};d.prototype.validateLayer=function(a){a=a.getObjects();for(var e=0;e<a.length;++e){var f=this.get(b.OBJECT,a[e].id);c(null!=f)}};d.ContentType=b;return d}()})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(t,d,q){Object.defineProperty(d,
"__esModule",{value:!0});d.fromVector=function(g,d){return{vec3:q.vec3f64.clone(g),id:d}};d.fromValues=function(g,d,b,f){return{vec3:q.vec3f64.fromValues(g,d,b),id:f}}})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("require exports ../../../../core/arrayUtils ../../../../core/iteratorUtils ./ModelContentType ./Util".split(" "),function(t,d,q,g,l,b){return function(){function f(b){this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this._dirtyMaterials=new Set;this._model=
b}Object.defineProperty(f.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"residentObjectCount",{get:function(){var b=0;this._residentGeomRecords.forEach(function(e){b+=e.size});return b},enumerable:!0,configurable:!0});f.prototype.getDirtyMaterials=function(){return 0<this._dirtyMaterials.size?this._dirtyMaterials:null};f.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()};f.prototype.hasDirtyGeometryRecords=
function(){var b=!1;g.everyMap(this._dirtyGeomRecords,function(e){if(b)return!1;g.everyMap(e,function(c){if(!b&&c&&0<c.size)return b=!0,!1})});return b};f.prototype.handleUpdate=function(e,f,c){b.assert(this[f],"ModelDirtySet doesn't know how to process "+f);return this[f](e,c)};f.prototype.shaderTransformationChanged=function(b){var e=this;(b=this._residentGeomRecords.get(b.id))&&b.forEach(function(c,a){(a=e._model.content[l.OBJECT][a])&&a.hasVolativeTransformation()&&c.forEach(function(a){var c=
0;for(a=a[1];c<a.length;c++)a[c].shaderTransformationChanged()})})};f.prototype.commit=function(){return this.commitLayers(q.keysOfMap(this._dirtyGeomRecords))};f.prototype.commitLayers=function(e){for(var f=this,c=[],a=[],g=[],d=function(d){var h=e[d];d=n._dirtyGeomRecords.get(h);if(!d)return"continue";d.forEach(function(e,d){var k=f._ensureGeomRecord(h,d);e.forEach(function(e,h){var m=e[0],p=e[1];e=e[2];var n=!1;if(p&2){var r=k.get(h);if(r){r=r[1];if(e&4)for(var v=f._model.get(l.OBJECT,d),u=0;u<
r.length;u++){var x=r[u];if(f._model.updateRenderGeometryTransformation(v,m,x)){n=!0;break}}if(!n)for(v=0;v<r.length;v++)x=r[v],g.push({renderGeometry:x,updateType:e})}else b.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(p&4||n)(r=k.get(h))?a.push.apply(a,r[1]):4===p&&b.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),r&&k.delete(h);if(p&1||n)p=[m,[]],v=f._model.get(l.OBJECT,d),f._model.getGeometryRenderGeometries(v,m,p[1]),c.push.apply(c,
p[1]),k.set(h,p)});0===k.size&&f._residentGeomRecords.get(h).delete(d)});0===n._residentGeomRecords.get(h).size&&n._residentGeomRecords.delete(h);n._dirtyGeomRecords.delete(h)},n=this,u=0;u<e.length;u++)d(u);return[c,a,g]};f.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(q.keysOfMap(this._residentGeomRecords))};f.prototype.getResidentRenderGeometriesFilteredByLayers=function(b){for(var e=[],c=0;c<b.length;c++){var a=this._residentGeomRecords.get(b[c]);
a&&a.forEach(function(a){a.forEach(function(a){e.push.apply(e,a[1])})})}return e};f.prototype.visibilityChanged=function(b,f,c){if(null!=f)this._componentPropertyChanged(b,f,c,1);else{f=0;for(var a=b.getGeometryRecords();f<a.length;f++)this._componentPropertyChanged(b,a[f],c,1)}};f.prototype.componentHighlightChanged=function(b,f,c){if(null!=f)this._componentPropertyChanged(b,f,c,16);else{f=0;for(var a=b.getGeometryRecords();f<a.length;f++)this._componentPropertyChanged(b,a[f],c,16)}};f.prototype.vertexAttrsUpdated=
function(b,f,c){this._updateOrCreateDirtyRecord(b,f,c,2,0,0,2,5,2)};f.prototype.matChanged=function(b){this._dirtyMaterials.add(b.id);if(this.onMaterialChanged)this.onMaterialChanged(b)};f.prototype.layerAdded=function(b){for(var e=b.getObjects(),c=0;c<e.length;c++)this.layObjectAdded(b,e[c])};f.prototype.layerRemoved=function(b){for(var e=b.getObjects(),c=0;c<e.length;c++)this.layObjectRemoved(b,e[c])};f.prototype.layObjectAdded=function(b,f){b=b.id;for(var c=f.getGeometryRecords(),a=0;a<c.length;a++)this.objGeometryAdded(f,
c[a],b)};f.prototype.layObjectRemoved=function(b,f){b=b.id;for(var c=f.getGeometryRecords(),a=0;a<c.length;a++)this.objGeometryRemoved(f,c[a],b)};f.prototype.layObjectReplaced=function(b,f){this.layObjectRemoved(b,f[0]);this.layObjectAdded(b,f[1])};f.prototype.objTransformation=function(b,f){var c=this;f=f||this._getParentLayerId(b);this._ensureGeomRecord(f,b.id).forEach(function(a){c._updateOrCreateDirtyRecord(b,a[0],f,2,0,0,2,5,4)})};f.prototype.objGeometryAdded=function(b,f,c){this._updateOrCreateDirtyRecord(b,
f,c,1,4,0,0,0)};f.prototype.objGeometryRemoved=function(b,f,c){this._updateOrCreateDirtyRecord(b,f,c,4,1,2,0,0)};f.prototype.objGeometryReplaced=function(b,f){this.objGeometryRemoved(b,f[0]);this.objGeometryAdded(b,f[1])};f.prototype.objGeometryTransformation=function(b,f){this.objGeometryReplaced(b,f)};f.prototype._componentPropertyChanged=function(b,f,c,a){this._updateOrCreateDirtyRecord(b,f,c,2,0,0,2,5,a)};f.prototype._updateOrCreateDirtyRecord=function(e,f,c,a,g,d,l,u,v){c=c||this._getParentLayerId(e);
var h=f.id;e=this._ensureDirtyRecord(c,e.id);(c=e.get(h))?(f=c[1],f&g?e.delete(h):f&d?(c[1]=a,c[2]=v):f&l?c[2]|=v:f&u||b.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):e.set(h,[f,a,v])};f.prototype._ensureGeomRecord=function(b,f){var c=this._residentGeomRecords.get(b);c||(c=new Map,this._residentGeomRecords.set(b,c));b=c.get(f);b||(b=new Map,c.set(f,b));return b};f.prototype._ensureDirtyRecord=function(b,f){var c=this._dirtyGeomRecords.get(b);c||(c=new Map,this._dirtyGeomRecords.set(b,
c));b=c.get(f);b||(b=new Map,c.set(f,b));return b};f.prototype._getParentLayerId=function(b){return b.parentLayer.id};f.prototype.formatDebugInfo=function(b){if(b)return"";var e=["ADD","UPD",void 0,"REM"],c="";this._dirtyGeomRecords.forEach(function(a,b){a.forEach(function(a,f){0<c.length&&(c+="\n");c+=b+"."+f;var g=[];a.forEach(function(a){var c=a[1];g[c]||(g[c]=[]);g[c].push(a[0].geometry.id)});for(a=0;a<g.length;a++)if(g[a])for(c+=" "+e[a-1]+": ",f=0;f<g[a].length;f++)c+=g[a][f]+", "})});return c};
return f}()})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./ComponentUtils ./HighlightUtils".split(" "),function(t,d,q,g,l,b,f,e,k){return function(){function c(a,c,e,f,g,d,k,l,w,m,x){this.shaderTransformationDirty=!0;this.data=a.toRenderData();this.componentOffsets=a.componentOffsets;
this.boundingInfo=c;this.material=e;this.origin=null;this.center=b.vec3f64.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=g;f&&this.updateTransformation(f,d);this.castShadow=k;this.singleUse=l;this.name=w;this.uniqueName=m;this.idx=x;this.instanceParameters={}}c.prototype.updateTransformation=function(a,c){this.transformation=a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,c,this.center)};c.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=
!0};c.prototype.getBoundingSphere=function(a,c,b){c=c||f.maxScale(a);l.vec3.transformMat4(b,this.boundingInfo.getCenter(),a);return this.boundingInfo.getBSRadius()*c};Object.defineProperty(c.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"componentCount",{get:function(){return e.componentCount(this.componentOffsets)},enumerable:!0,configurable:!0});c.prototype.getShaderTransformation=
function(){if(!this.calculateShaderTransformation)return this.transformation;this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=g.mat4f64.create()),q.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(this.transformation)),this.shaderTransformationDirty=!1);return this.shaderTransformation};c.prototype.getIndices=function(a){return"indices"in this.data?this.data.indices[a]:null};c.prototype.getAttribute=function(a){return"vertexAttr"in this.data?
this.data.vertexAttr[a]:null};c.prototype.addHighlight=function(a){var c=k.generateHighlightId(),b=this.instanceParameters;b.componentHighlights=e.addHighlight(b.componentHighlights,null,a,c);return c};c.prototype.removeHighlight=function(a){var c=this.instanceParameters;c.componentHighlights=e.removeHighlight(c.componentHighlights,a)};return c}()})},"esri/views/3d/webgl-engine/parts/View":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../lib/DrapedRenderer ../lib/GLMaterialRep ../lib/GLTextureRep ../lib/ProgramRepository ../lib/tracer ../lighting/Lightsources ./Model ./Viewport ../shaders/globalOptions ../../../support/screenshotUtils ../../../webgl/context-util ../../../webgl/FramebufferObject ../../../webgl/RenderingContext".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A){var C=l.getLogger("esri.views.3d.webgl-engine.parts.View");t=function(){function d(b,f,g,d){var m=this;this.options=d;this._backgroundColor=k.vec4f64.fromValues(1,1,1,1);this._lightDirection=e.vec3f64.fromValues(0,1,0);this._didRender=!1;this._idleSuspend=this._needsRender=!0;this._shouldRender=!1;this._supersampleScreenshots=!0;this._screenshotQueue=[];this._container=b;this._stage=f;this._initializeContext(d);b=y.glslifyGlobalOptions({viewingMode:d.viewingMode});
this._programRepository=new p(this._rctx,b);this._textureRep=new h(f.getAll(v.ContentType.TEXTURE),this._programRepository,function(){return m._viewport.getCamera().viewport},this._rctx);this._materialRep=new a(this._textureRep,this._programRepository);this._viewport=new r(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx);this._initializeViewportCamera();this._drapedRenderer=new c(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,g);
this._initializeFrameTask()}Object.defineProperty(d.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0});d.prototype._initializeFrameTask=function(){var a=this;this._frameTask={preRender:function(){n.begin();a._stage.processDirty();a.needsRender()?(a._shouldRender=!0,a._viewport.getCamera().setGLViewport(a._rctx),a._rctx.setClearColor.apply(a._rctx,a._backgroundColor),a._rctx.clearSafe(16640)):a._shouldRender=!1},render:function(){a._shouldRender&&
(a._didRender=!0,B.lightDirection=a._lightDirection,B.disableSlice=!1,a._viewport.render(B))},postRender:function(){n.end()},update:function(){a.resetNeedsRender();a._performScreenshots()}}};d.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),c=this._viewport.getCamera();c.viewport[2]=a.width;c.viewport[3]=a.height;this._viewport.setCamera(c)};d.prototype._initializeContext=function(a){this._canvas=a.canvas;this._canvas||(this._canvas=document.createElement("canvas"));
this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var c=m.createContextOrErrorHTML(this._canvas,{alpha:a.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==a.stencil?!0:a.stencil},a.renderContext);this._gl=n.instrumentContext(c);this._rctx=new A(this._gl,{disabledExtensions:a.deactivatedWebGLExtensions||{}});!a.alpha&&this._rctx.contextAttributes.alpha&&C.error("WebGL context has alpha channel even though no alpha channel was requested");!this._rctx.contextAttributes.alpha&&
11<=g("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas);null!=a.supersampleScreenshots&&(this._supersampleScreenshots=a.supersampleScreenshots)};d.prototype.dispose=function(){this._viewport.dispose();this._viewport=null;this._drapedRenderer.dispose();this._drapedRenderer=null;this._programRepository.dispose();this._programRepository=null;this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=this._gl=this._canvas=
this._container=null};d.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()};d.prototype.setNeedsRender=function(){this._didRender=!1;this._needsRender=!0};d.prototype.resetNeedsRender=function(){this._didRender&&(this._didRender=this._needsRender=!1);this._viewport.resetNeedsRender();this._textureRep.resetNeedsRender()};d.prototype.needsRender=function(){var a=this._viewport.getCamera();return 0===a.fullWidth||0===a.fullHeight?!1:this._needsRender||!this._idleSuspend||
this._viewport.needsRender()||this._textureRep.needsRender()};d.prototype.getFrameTask=function(){return this._frameTask};d.prototype.setLighting=function(a){f.vec3.set(this._lightDirection,0,0,0);for(var c=0,b=a.lights;c<b.length;c++){var e=b[c];if(e instanceof u.MainLight){f.vec3.negate(this._lightDirection,e.direction);break}}this._viewport.setLighting(a);this._needsRender=!0};d.prototype.ensureEdgeView=function(){return this._viewport.ensureEdgeView()};Object.defineProperty(d.prototype,"edgeView",
{get:function(){return this._viewport.edgeView},enumerable:!0,configurable:!0});d.prototype.getMainLightDirection=function(){return this._lightDirection};d.prototype.setViewParams=function(a){"backgroundColor"in a&&(this._needsRender=!0,this._backgroundColor=a.backgroundColor);"supersampleScreenshots"in a&&(this._supersampleScreenshots=a.supersampleScreenshots)};d.prototype.setRenderParams=function(a){this._needsRender=!0;void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._viewport.setRenderParams(a)};
d.prototype.getRenderParams=function(){var a=this._viewport.getRenderParams();a.anisotropicFiltering=this._textureRep.getMaxAnisotropy();a.idleSuspend=this._idleSuspend;return a};Object.defineProperty(d.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});d.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:!1};d.prototype.modify=function(a,c,b,e){this._viewport.modify(a,
c,b,e)};d.prototype.setCamera=function(a){this._viewport.setCamera(a)};d.prototype.getCamera=function(){return this._viewport.getCamera()};d.prototype.getCanvas=function(){return this._canvas};d.prototype.getDrapedRenderer=function(){return this._drapedRenderer};d.prototype.takeScreenshot=function(a){var c=this,e=b.createResolver(function(){c._screenshotQueue=c._screenshotQueue.filter(function(a){return a.resolver!==e})});this._screenshotQueue.push({settings:a,resolver:e});this._needsRender=!0;return e.promise};
d.prototype.getFramebufferTexture=function(a){return this._viewport.getFramebufferTexture(a)};Object.defineProperty(d.prototype,"renderPlugins",{get:function(){return this._viewport.renderPlugins},enumerable:!0,configurable:!0});d.prototype._renderScreenshotOverlay=function(a,c,b){if(this.options.renderScreenshotOverlay){a.width=c.width;a.height=c.height;var e=a.getContext("2d"),f=this._viewport.getCamera().pixelRatio*b.pixelRatio;e.save();e.translate(0,c.height);e.scale(1,-1);b.region&&e.translate(-b.region.x,
-b.region.y);e.scale(f,f);this.options.renderScreenshotOverlay(a,c);e.restore()}};d.prototype._readbackScreenshot=function(a){return a.resample?this._readbackScreenshotResampled(a):this._readbackScreenshotImmediate(a)};d.prototype._readbackScreenshotResampled=function(a){var c=a.framebufferWidth,b=a.framebufferHeight,e=a.region,f=a.resample,g=this._ensureScreenshotEncodeCanvas(),d=w.createEmptyImageData(c,b,g);this._gl.readPixels(0,0,c,b,6408,5121,new Uint8Array(d.data.buffer));this._renderScreenshotOverlay(g,
d,q({},a,{region:null}));a=w.createEmptyImageData(e.width,e.height,g);return w.resampleHermite(d,a,!0,f.region.x,b-(f.region.y+f.region.height),f.region.width,f.region.height)};d.prototype._readbackScreenshotImmediate=function(a){var c=a.framebufferHeight,b=a.region,e=this._ensureScreenshotEncodeCanvas(),f=w.createEmptyImageData(b.width,b.height,e);this._gl.readPixels(b.x,c-(b.y+b.height),b.width,b.height,6408,5121,new Uint8Array(f.data.buffer));this._renderScreenshotOverlay(e,f,a);return f};d.prototype._renderScreenshot=
function(a){var c=null,b=this._viewport.getCamera(),e=w.screenshotSuperSampleSettings(a,this._supersampleScreenshots),f=e.framebufferWidth,g=e.framebufferHeight,d=!1,h=this._viewport.hasSlicePlane&&a.disableSlice;if(h=f!==b.fullWidth||g!==b.fullHeight||h){var k=b.copy();k.fullWidth=f;k.fullHeight=g;k.pixelRatio*=e.pixelRatio;c=b.fovX-k.fovX;d=b.fovY-k.fovY;0>c&&c<d?k.fovX=b.fovX:0>d&&d<c&&(k.fovY=b.fovY);this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(k);d=!0;c=new x(this._rctx,
{width:k.fullWidth,height:k.fullHeight,colorTarget:0,depthStencilTarget:3});this._rctx.bindFramebuffer(c);k.setGLViewport(this._rctx);this._rctx.setClearColor.apply(this._rctx,this._backgroundColor);this._rctx.clearSafe(16640);this._viewport.render({lightDirection:this._lightDirection,fbo:c,camera:k,disableSlice:a.disableSlice})}a=this._readbackScreenshot(e);if(h&&!this._rctx.contextAttributes.alpha)for(e=3;e<a.data.length;e+=4)a.data[e]=255;c&&c.dispose();this._rctx.bindFramebuffer(null);d&&this._drapedRenderer.forceUpdate&&
this._drapedRenderer.forceUpdate(b);return a};d.prototype._performScreenshots=function(){if(0!==this._screenshotQueue.length){for(var a=0,c=this._screenshotQueue;a<c.length;a++){var b=c[a],e=b.settings;if(this._gl){var f=this._ensureScreenshotEncodeCanvas(),g=this._renderScreenshot(e),e=w.encodeResult(g,e,f,{flipY:!0,premultipliedAlpha:!0});b.resolver(e)}else b.resolver.reject()}this._screenshotQueue=[]}};d.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=
document.createElement("canvas"));return this._screenshotEncodeCanvas};Object.defineProperty(d.prototype,"test",{get:function(){return{viewport:this._viewport}},enumerable:!0,configurable:!0});d.prototype.getGpuMemoryUsage=function(){return q({},this._viewport.getGpuMemoryUsage(),{draped:this._drapedRenderer?this._drapedRenderer.getGpuMemoryUsage():0})};return d}();var B={fbo:null,camera:null,lightDirection:e.vec3f64.create(),disableSlice:!1};return t})},"esri/views/3d/webgl-engine/lib/DrapedRenderer":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ../../webgl-engine/lib/intersectorUtils ./Camera ./DefaultVertexBufferLayouts ./glUtil3D ./GridLocalOriginFactory ./Renderer ../lighting/Lightsources ../materials/ColorMaterial ../materials/HUDMaterial ../materials/RibbonLineMaterial ../shaders/MiscPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x){t=function(){function e(c,b,e,f,d,k){var m=this;this._renderTargets={};this._clearColor=l.vec4f64.fromValues(0,0,0,0);this._uniqueIdx=0;this._localOrigins=new a;this._rctx=c;this._canvas=b;this._programRep=e;this._modelDirtySet=k;this._modelDirtySet.onMaterialChanged=function(a){return m.materialChanged(a)};this._renderer=new h(e,f,d,this._rctx,"draped");this._renderer.onHasHighlightsChanged=function(a){if(m.onHasHighlightsChanged)m.onHasHighlightsChanged(a)};
this._renderer.setLighting({lights:[new p.AmbientLight(g.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})}e.prototype.dispose=function(){for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._renderer.dispose();this._renderer=null};e.prototype.createRenderTarget=function(a){return this.createRenderTargetInternal(a,!0)};e.prototype.createHighlightRenderTarget=function(a){return this.createRenderTargetInternal(a,!1)};e.prototype.disposeRenderTarget=
function(a){var c=this._renderTargets[a];c&&c.dispose();delete this._renderTargets[a]};e.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};e.prototype.addRenderGeometries=function(a){var c=this;a.forEach(function(a){null==a.origin&&(a.origin=c._localOrigins.getOrigin(a.center));a.idx=c._uniqueIdx++});this._renderer.modify(a,[]);if(this.onContentChanged)this.onContentChanged()};e.prototype.removeRenderGeometries=function(a){this._renderer.modify([],
a);if(this.onContentChanged)this.onContentChanged()};e.prototype.updateRenderGeometries=function(a,c){a=a.map(function(a){return{renderGeometry:a,updateType:c}});this._renderer.modify([],[],a);if(this.onContentChanged)this.onContentChanged()};e.prototype.updateRenderOrder=function(a){if(0<a.size&&(this._renderer.modifyRenderOrder(a),this.onContentChanged))this.onContentChanged()};e.prototype.setBackgroundColor=function(a){this._clearColor=a;if(this.onContentChanged)this.onContentChanged()};e.prototype.updateHighlights=
function(a){this.updateRenderGeometries(a,16)};e.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!b.OVERLAY_DRAW_TEST_TEXTURE};e.prototype.processDirtyMaterials=function(){var a=this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify([],[],[],a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});e.prototype.draw=function(a,c){return this.drawPass(0,
a,c)};e.prototype.drawHighlights=function(a,c){return this.drawPass(4,a,c)};e.prototype.drawPass=function(a,c,e){A=e.pixelRatio*Math.abs(e.views[0].extent[2]-e.views[0].extent[0])/Math.abs(e.views[0].viewport[2]-e.views[0].viewport[0]);if(this.isEmpty()||4===a&&!this.hasHighlights)return!1;this.processDirtyMaterials();if(!e.views.some(function(a){return a.extent[0]!==a.extent[2]&&a.extent[1]!==a.extent[3]}))return!1;c=this._renderTargets[c];if(!c)return!1;var f=this._rctx,g=e.width,d=e.height;if(c.width!==
g||c.height!==d)c.resize(g,d),c.colorTexture.setSamplingMode(9729);var h=B.camera;B.fbo=c;h.near=1;h.far=1E4;h.pixelRatio=e.pixelRatio||1;f.bindFramebuffer(c);f.setClearColor.apply(f,this._clearColor);f.clearSafe(16384);for(var k=0;k<e.views.length;k++){var m=e.views[k];h.viewport=m.viewport;q.mat4.ortho(h.projectionMatrix,0,m.extent[2]-m.extent[0],0,m.extent[3]-m.extent[1],h.near,h.far);q.mat4.identity(h.viewMatrix);q.mat4.translate(h.viewMatrix,h.viewMatrix,[-m.extent[0],-m.extent[1],0]);h.setGLViewport(this._rctx);
b.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(g,d,C[e.index%C.length]);this._renderer.renderPass(a,B)}f.bindFramebuffer(null);f.setViewport(0,0,this._canvas.width,this._canvas.height);c.colorTexture.descriptor.hasMipmap&&c.colorTexture.generateMipmap();return!0};e.prototype._drawTestTexture=function(a,b,e){var f=this._rctx;if(!this._testPatternTexture){for(var g=new Uint8Array(a*b*4),d=0,h=0;h<b;h++)for(var p=0;p<a;p++){var l=Math.floor(p/10),n=Math.floor(h/10);2>l||2>n||10*l>a-20||10*n>b-20?
(g[d++]=255,g[d++]=255,g[d++]=255,g[d++]=255):(g[d++]=255,g[d++]=255,g[d++]=255,l&1&&n&1?g[d++]=p&1^h&1?0:255:g[d++]=l&1^n&1?0:128)}this._testPatternTexture=new m(f,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:b},g);this._testPatternProgram=this._programRep.getProgram(r.texOnly);this._testPatternPipelineState=w.makePipelineState({blending:w.separateBlendingParams(770,1,771,771),colorWrite:w.defaultColorWriteParams});this._quadVAO=c.createQuadVAO(f,k.Pos3Tex)}a=this._testPatternProgram;
f.bindProgram(a);f.setPipelineState(this._testPatternPipelineState);a.setUniform4f("color",e[0],e[1],e[2],1);a.setUniform1i("tex",0);f.bindTexture(this._testPatternTexture,0);f.bindVAO(this._quadVAO);f.drawArrays(5,0,x.vertexCount(this._quadVAO,"geometry"))};e.prototype.materialChanged=function(a){if(this.onContentChanged)this.onContentChanged()};e.prototype.createRenderTargetInternal=function(a,c){for(var b=a,e=0;this._renderTargets[b];)b=a+"_"+ ++e;this._renderTargets[b]=y.createWithAttachments(this._rctx,
{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:c,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0});return b};e.prototype.getGpuMemoryUsage=function(){var a=0,c;for(c in this._renderTargets)a+=x.getGpuMemoryUsage(this._renderTargets[c]);return a};e.prototype.intersect=function(a,c,b){var e=this,f=0;this._renderer.forEachRenderGeometry(function(g){if(!b||b(g)){if(g.material instanceof n||g.material instanceof v||g.material instanceof u){var d=
g.transformation[12],h=g.transformation[13];E[0]=c[0]-d;E[1]=c[1]-h;E[2]=1;I[0]=c[0]-d;I[1]=c[1]-h;I[2]=0;g.pixelRatio=A;g.material.intersect(g,null,g.getShaderTransformation(),a,E,I,function(c,b,d,h,k,m){e.addIntersectionResult(c,b,d,g.material.renderPriority,f,k,m,a,g.data.layerUid,g.data.graphicUid)},g.calculateShaderTransformation,!0)}f++}})};e.prototype.addIntersectionResult=function(a,c,b,e,g,d,h,k,m,p){var l={type:"external",metadata:{layerUid:m,graphicUid:p}};a=function(a){a.set(l,null,k.results.terrain.dist,
k.results.terrain.normal,k.results.terrain.transformation,e,null,null,b,g);a.intersector="DrapedRenderer"};(null==k.results.min.drapedLayerOrder||e>=k.results.min.drapedLayerOrder)&&(null==k.results.min.dist||k.results.terrain.dist<=k.results.min.dist)&&a(k.results.min);(null==k.results.max.drapedLayerOrder||e<k.results.max.drapedLayerOrder)&&(null==k.results.max.dist||k.results.terrain.dist>k.results.max.dist)&&a(k.results.max);k.enable.storeAll&&(c=new f.IntersectorResult(k.ray),a(c),k.results.all.push(c))};
return e}();var A,C=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],B={fbo:null,camera:new e,lightDirection:g.vec3f64.fromValues(0,0,1)},E=g.vec3f64.create(),I=g.vec3f64.create();return t})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/SpatialReference ../../support/projectionUtils ./Geometry ./GeometryData ./Layer ./localOrigin ./Object3D ./Util ../materials/RibbonLineMaterial ../parts/Model".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v){var r=0;t=function(){function b(){this.ROOT_ORIGIN_ID="rg_root_"+r++;this._origins=new Map;this._gridSize=42E5;if(q.isSome(b.testOrigin)){var a=b.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,h.fromValues(a[0],a[1],a[2],this.ROOT_ORIGIN_ID))}}b.prototype.getOrigin=function(a){var c=this._origins.get(this.ROOT_ORIGIN_ID);if(null==c){var b=h.fromValues(a[0]+Math.random()-.5,a[1]+Math.random()-.5,a[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);this._origins.set(this.ROOT_ORIGIN_ID,
b);return b}l.vec3.subtract(w,a,c.vec3);w[0]=Math.abs(w[0]);w[1]=Math.abs(w[1]);w[2]=Math.abs(w[2]);b=this._gridSize;if(w[0]<b&&w[1]<b&&w[2]<b)return c;var c=Math.round(a[0]/b),e=Math.round(a[1]/b);a=Math.round(a[2]/b);var f="rg_"+c+"/"+e+"/"+a,g=this._origins.get(f);g||(g=h.fromValues(c*b,e*b,a*b,f),this._origins.set(f,g));return g};b.prototype._drawOriginBox=function(b){var g=window.view,d=g._stage;if(null==this._object){this._material=new u({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial");
d.add(v.ContentType.MATERIAL,this._material);var h=new a("GridLocalOrigin",{isPickable:!1});d.add(v.ContentType.LAYER,h);this._object=new p({name:"GridLocalOrigin",idHint:"GridLocalOrigin",castShadow:!1});d.add(v.ContentType.OBJECT,this._object);h.addObject(this._object);d.addToViewContent([h.id])}for(var m=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=m.length,r=new Float32Array(3*l),h=new Uint32Array(2*(l-1)),x=.5*this._gridSize,w=0;w<l;w++)r[3*w+0]=b[0]+(m[w]&1?x:-x),r[3*w+1]=b[1]+(m[w]&2?x:-x),r[3*
w+2]=b[2]+(m[w]&4?x:-x),0<w&&(h[2*w+0]=w-1,h[2*w+1]=w);e.bufferToBuffer(r,f.WebMercator,0,r,g.spatialReference,0,l);g={};g[n.VertexAttrConstants.POSITION]={size:3,data:r};r={};r[n.VertexAttrConstants.POSITION]=h;h=new c(g,r,void 0,"line");h=new k(h,"GridLocalOriginBox");d.add(v.ContentType.GEOMETRY,h);this._object.addGeometry(h,this._material,y);console.log(this._origins.size,b)};return b}();var y=g.mat4f64.create(),w=b.vec3f64.create();(t||(t={})).testOrigin=null;return t})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),
function(t,d,q,g,l,b,f,e){return function(){function d(c,a,b){this.singleUse=!1;this._componentAABBs=this._boundingInfo=null;this._id=d.__idGen.gen(a);this._data=c;this._boundingInfo=b}Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});d.prototype.getIndices=function(c){return this.data.getIndices(c)};Object.defineProperty(d.prototype,"indexCount",
{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});d.prototype.getAttribute=function(c){return this.data.getAttribute(c)};Object.defineProperty(d.prototype,"componentCount",{get:function(){return g.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"componentOffsets",{get:function(){return this.data.componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexCount",{get:function(){return this.data.indexCount},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"boundingInfo",{get:function(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo},enumerable:!0,configurable:!0});d.prototype.invalidateBoundingInfo=function(){this._componentAABBs=this._boundingInfo=null};d.prototype.getComponentAABB=function(c,a){null==this._componentAABBs&&
(this._componentAABBs=this._computeComponentAABBs());for(var b=0;6>b;b++)a[b]=this._componentAABBs[6*c+b];return a};d.prototype._computeComponentAABBs=function(){for(var c=this.componentCount,a=new Float32Array(6*c),b=0;b<c;b++)this._calculateAABB(b,a,6*b);return a};d.prototype._calculateAABB=function(c,a,b){void 0===b&&(b=0);var f=this.data.getIndices(e.VertexAttrConstants.POSITION),g=this.data.getAttribute(e.VertexAttrConstants.POSITION),d=this.data.componentOffsets,h=d.length?d[c+1]:f.length,k=
Infinity,l=Infinity,w=Infinity,m=-Infinity,x=-Infinity,A=-Infinity,q=g.offsetIdx,B=g.strideIdx;for(c=d.length?d[c]:0;c<h;c++)var E=q+B*f[c],d=g.data[E],t=g.data[E+1],E=g.data[E+2],k=Math.min(k,d),l=Math.min(l,t),w=Math.min(w,E),m=Math.max(m,d),x=Math.max(x,t),A=Math.max(A,E);a[b]=k;a[b+1]=l;a[b+2]=w;a[b+3]=m;a[b+4]=x;a[b+5]=A};d.prototype._calculateBoundingInfo=function(){var c=this.data.getIndices(e.VertexAttrConstants.POSITION),a=this.data.getAttribute(e.VertexAttrConstants.POSITION),b="triangle"===
this.data.primitiveType?3:1;if(0===c.length)for(var c=new Uint32Array(b),g=0;g<b;++g)c[g]=g;g=c.length;f.assert(0===g%b);g=l.generateDefaultIndexArray(g/b);return new q(g,b,c,a)};d.__idGen=new b;return d}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Util".split(" "),function(t,d,q,g,l,b){t=function(){function f(e,d,c,a){b.assert(1<=e.length);b.assert(0===
c.length%d);b.assert(c.length>=e.length*d);b.assert(3===a.size||4===a.size);this.primitiveIndices=e;this.indices=c;this._position=a;this._numIndexPerPrimitive=d;var h=a.data,k=a.offsetIdx,n=a.strideIdx;a=0;var u=e.length,v=k+n*c[d*e[a]];f.tmpIndices.clear();f.tmpIndices.push(v);this.bbMin=l.vec3f64.fromValues(h[v],h[v+1],h[v+2]);for(this.bbMax=l.vec3f64.clone(this.bbMin);a<u;++a)for(var r=d*e[a],y=0;y<d;++y){v=k+n*c[r+y];f.tmpIndices.push(v);var w=h[v];this.bbMin[0]=Math.min(w,this.bbMin[0]);this.bbMax[0]=
Math.max(w,this.bbMax[0]);w=h[v+1];this.bbMin[1]=Math.min(w,this.bbMin[1]);this.bbMax[1]=Math.max(w,this.bbMax[1]);w=h[v+2];this.bbMin[2]=Math.min(w,this.bbMin[2]);this.bbMax[2]=Math.max(w,this.bbMax[2])}this.center=l.vec3f64.create();g.vec3.lerp(this.center,this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);e=this.bsRadius*this.bsRadius;for(a=0;a<f.tmpIndices.length;++a)v=f.tmpIndices.data[a],d=h[v]-this.center[0],
c=h[v+1]-this.center[1],v=h[v+2]-this.center[2],k=d*d+c*c+v*v,k<=e||(k=Math.sqrt(k),n=.5*(k-this.bsRadius),this.bsRadius+=n,e=this.bsRadius*this.bsRadius,k=n/k,this.center[0]+=d*k,this.center[1]+=c*k,this.center[2]+=v*k);f.tmpIndices.clear()}f.prototype.getCenter=function(){return this.center};f.prototype.getBSRadius=function(){return this.bsRadius};f.prototype.getBBMin=function(){return this.bbMin};f.prototype.getBBMax=function(){return this.bbMax};f.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};
f.prototype.getIndices=function(){return this.indices};f.prototype.getPosition=function(){return this._position};f.prototype.getChildren=function(){if(this.children)return this.children;if(1<g.vec3.squaredDistance(this.bbMin,this.bbMax)){for(var b=g.vec3.lerp(l.vec3f64.create(),this.bbMin,this.bbMax,.5),d=this.primitiveIndices.length,c=new Uint8Array(d),a=Array(8),h=0;8>h;++h)a[h]=0;for(var h=this._position,p=h.data,n=h.offsetIdx,u=h.strideIdx,h=0;h<d;++h){for(var v=0,r=this._numIndexPerPrimitive*
this.primitiveIndices[h],y=n+u*this.indices[r],w=p[y],m=p[y+1],x=p[y+2],A=1;A<this._numIndexPerPrimitive;++A){var y=n+u*this.indices[r+A],q=p[y],B=p[y+1],y=p[y+2];q<w&&(w=q);B<m&&(m=B);y<x&&(x=y)}w<b[0]&&(v|=1);m<b[1]&&(v|=2);x<b[2]&&(v|=4);c[h]=v;++a[v]}for(h=b=0;8>h;++h)0<a[h]&&++b;if(2>b)return;b=Array(8);for(h=0;8>h;++h)b[h]=0<a[h]?new Uint32Array(a[h]):void 0;for(h=0;8>h;++h)a[h]=0;for(h=0;h<d;++h)v=c[h],b[v][a[v]++]=this.primitiveIndices[h];this.children=Array(8);for(h=0;8>h;++h)void 0!==b[h]&&
(this.children[h]=new f(b[h],this._numIndexPerPrimitive,this.indices,this._position))}return this.children};return f}();(t||(t={})).tmpIndices=new q({deallocator:null});return t})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports ../../../../core/arrayUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./IdGen ./ModelContentType ./Octree".split(" "),function(t,d,q,g,l,b,f,e){return function(){function d(c,a,b){this._parentStages=[];this._children=
new Set;this.id=d._idGen.gen(c);this.apiLayerUid=b;this.name=c;a=a||{};this.group=a.group||"";this.isVisible=null!=a.isVisible?a.isVisible:!0;this.isPickable=null!=a.isPickable?a.isPickable:!0;this.isSliceable=!1;this.translation=a.translation?l.vec3f64.clone(a.translation):l.vec3f64.create();this._extent=[l.vec3f64.fromValues(0,0,0),l.vec3f64.fromValues(1E3,1E3,1E3)];this._extentDirty=!0}d.prototype.addParentStage=function(c){-1===this._parentStages.indexOf(c)&&this._parentStages.push(c)};d.prototype.removeParentStage=
function(c){c=this._parentStages.indexOf(c);-1<c&&this._parentStages.splice(c,1);this.invalidateSpatialQueryAccelerator()};d.prototype.getName=function(){return this.name};d.prototype.getGroup=function(){return this.group};d.prototype.getTranslation=function(){return this.translation};d.prototype.getObjectIds=function(){return q.keysOfSet(this._children,function(c){return c.id})};d.prototype.getObjects=function(){return q.keysOfSet(this._children)};d.prototype.getExtent=function(){this._updateExtent();
return this._extent};d.prototype.addObject=function(c){this._children.add(c);c.parentLayer=this;this.notifyDirty("layObjectAdded",c);this._invalidateExtent();this._octree&&this._octree.add(c)};d.prototype.hasObject=function(c){return this._children.has(c)};d.prototype.removeObject=function(c){return this._children.delete(c)?(c.parentLayer=null,this.notifyDirty("layObjectRemoved",c),this._invalidateExtent(),this._octree&&this._octree.remove(c),!0):!1};d.prototype.notifyObjectBBChanged=function(c,a){this._octree&&
this._octree.update(c,a)};d.prototype.getCenter=function(){this._updateExtent();var c=l.vec3f64.create();return g.vec3.lerp(c,this._extent[0],this._extent[1],.5)};d.prototype.getBSRadius=function(){this._updateExtent();return.5*g.vec3.distance(this._extent[0],this._extent[1])};d.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._children.size&&this._createOctree();return this._octree};d.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",
null)};d.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)};d.prototype.notifyDirty=function(c,a,b,e){b=b||f.LAYER;e=e||this;for(var g=0;g<this._parentStages.length;g++)this._parentStages[g].notifyDirty(b,e,c,a)};d.prototype._createOctree=function(){for(var c=this.getExtent(),a=0,b=0;3>b;b++)a=Math.max(a,c[1][b]-c[0][b]);b=l.vec3f64.create();g.vec3.lerp(b,c[0],c[1],.5);this._octree=new e(b,1.2*a,{getRadius:function(a){return a.getBSRadius()},
getCenter:function(a){return a.getCenter()}});this._octree.add(q.keysOfSet(this._children))};d.prototype._invalidateExtent=function(){this._extentDirty=!0};d.prototype._updateExtent=function(){var c=this;if(this._extentDirty)if(this._extentDirty=!1,0===this._children.size)this._extent=[[0,0,0],[0,0,0]];else{var a=null;this._children.forEach(function(b){var e=b.getBBMin();b=b.getBBMax();if(a)for(var f=0;3>f;++f)c._extent[0][f]=Math.min(c._extent[0][f],e[f]),c._extent[1][f]=Math.max(c._extent[1][f],
b[f]);else a=[l.vec3f64.clone(e),l.vec3f64.clone(b)]});this._extent=a}};d._idGen=new b;return d}()})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./Util".split(" "),function(t,d,q,g,l,b,f,e){function k(a,c,b){b=b||a;b[0]=a[0]+c;b[1]=a[1]+c;b[2]=a[2]+c;return b}function c(a,c,b){return!f.frustum.intersectsSphere(b.planes,
f.sphere.wrap(c,a))}function a(a,c,b){if(!F.length)for(var e=0;8>e;++e)F.push({index:0,distance:0});for(e=0;8>e;++e){var f=u[e];F.data[e].index=e;F.data[e].distance=p(a,c,f)}F.sort(function(a,c){return a.distance-c.distance});b.clear();for(e=0;8>e;++e)b.push(F.data[e].index)}function h(a,c){for(var b=Infinity,e=null,f=0;8>f;++f){var g=p(a,c,v[f]);g<b&&(b=g,e=v[f])}return e}function p(a,c,b){return c*(a[0]*b[0]+a[1]*b[1]+a[2]*b[2])}t=function(){function d(a,c,e,f){this._maximumObjectsPerNode=10;this._maximumDepth=
20;this._degenerateObjects=new Set;this._objectCount=0;this._objectToBoundingSphere=e;f&&(void 0!==f.maximumObjectsPerNode&&(this._maximumObjectsPerNode=f.maximumObjectsPerNode),void 0!==f.maximumDepth&&(this._maximumDepth=f.maximumDepth));isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||isNaN(c)?this._root=new n(null,b.vec3f64.fromValues(0,0,0),.5):this._root=new n(null,a,c/2)}Object.defineProperty(d.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"objectCount",
{get:function(){return this._objectCount},enumerable:!0,configurable:!0});d.prototype.destroy=function(){this._degenerateObjects.clear();this._root=null;n.clearPool();y=[null];C.prune();F.prune();K.prune()};d.prototype.add=function(a,c){a=this._objectOrObjectsArray(a);c=null==c?a.length:c;this._objectCount+=c;this._grow(a);for(var b=n.acquire(),e=0;e<c;e++){var f=a[e];b.init(this._root);this._isDegenerate(f)?this._degenerateObjects.add(f):this._add(f,b)}n.release(b)};d.prototype.remove=function(a,
c){a=this._objectOrObjectsArray(a);this._objectCount-=a.length;for(var b=n.acquire(),e=0;e<a.length;e++){var f=a[e],g=c||this._boundingSphereFromObject(f,B);this._isValidRadius(g.radius)?(b.init(this._root),this._remove(f,g,b)):this._degenerateObjects.delete(f)}n.release(b);this._shrink()};d.prototype.update=function(a,c){if(this._isValidRadius(c.radius)||!this._isDegenerate(a))this.remove(a,c),this.add(a)};d.prototype.forEachAlongRay=function(a,c,b){var e=this;this._forEachNode(this._root,function(f){if(!e._intersectsNode(a,
c,f))return!1;f=f.node;f.terminals.forEach(function(f){e._intersectsObject(a,c,f)&&b(f)});null!==f.residents&&f.residents.forEach(function(f){e._intersectsObject(a,c,f)&&b(f)});return!0})};d.prototype.forEach=function(a){this._forEachNode(this._root,function(c){c=c.node;c.terminals.forEach(a);null!==c.residents&&c.residents.forEach(a);return!0});this._degenerateObjects.forEach(a)};d.prototype.forEachDegenerateObject=function(a){this._degenerateObjects.forEach(a)};d.prototype.findClosest=function(a,
c,b,e,f){return this._findClosest(a,"front-to-back"===c?1:-1,b,e,f)};d.prototype.forEachInDepthRange=function(a,c,b,e,f,g,d,h){this._forEachInDepthRange(a,c,"front-to-back"===b?1:-1,e,f,g,d,h)};d.prototype.forEachNode=function(a){this._forEachNode(this._root,function(c){return a(c.node,c.center,2*c.halfSize)})};d.prototype._intersectsNode=function(a,c,b){k(b.center,2*-b.halfSize,x);k(b.center,2*b.halfSize,A);return e.rayBoxTest(a,c,x,A)};d.prototype._intersectsObject=function(a,c,b){var e=this._objectToBoundingSphere.getRadius(b);
return 0<e?f.sphere.intersectsRay(f.sphere.wrap(e,this._objectToBoundingSphere.getCenter(b)),f.ray.wrap(a,c)):!0};d.prototype._forEachNode=function(a,c){a=n.acquire().init(a);for(var b=[a];0!==b.length;){a=b.pop();if(c(a)&&!a.isLeaf())for(var e=0;e<a.node.children.length;e++)a.node.children[e]&&b.push(n.acquire().init(a).advance(e));n.release(a)}};d.prototype._forEachNodeDepthOrdered=function(c,b,e,f){void 0===f&&(f=1);c=n.acquire().init(c);var g=[c];for(a(e,f,K);0!==g.length;){c=g.pop();if(b(c)&&
!c.isLeaf())for(e=7;0<=e;--e)f=K.data[e],f>=c.node.children.length||c.node.children[f]&&g.push(n.acquire().init(c).advance(f));n.release(c)}};d.prototype._findClosest=function(a,b,e,f,g){var d=this,k=Infinity,n=Infinity,v=null,u=h(a,b),x=0,A=function(g){++x;if(!f||f(g)){var h=d._objectToBoundingSphere.getCenter(g),m=d._objectToBoundingSphere.getRadius(g);if(!e||!c(h,m,e)){var h=p(a,b,h),l=h-m;l<k&&(k=l,n=h+m,v=g)}}};this._forEachNodeDepthOrdered(this._root,function(f){if(null!=g&&x>=g||e&&c(f.center,
f.halfSize*r,e))return!1;l.vec3.scale(m,u,f.halfSize);l.vec3.add(m,m,f.center);if(p(a,b,m)>n)return!1;f=f.node;f.terminals.forEach(function(a){A(a)});null!==f.residents&&f.residents.forEach(function(a){A(a)});return!0},a,b);return v};d.prototype._forEachInDepthRange=function(a,b,e,f,g,d,k,n){var v=this,u=-Infinity,x=Infinity,A={setRange:function(a){1===e?(u=Math.max(u,a.near),x=Math.min(x,a.far)):(u=Math.max(u,-a.far),x=Math.min(x,-a.near))}};A.setRange(f);var w=p(b,e,a),y=h(b,e),q=h(b,-1*e),C=0,
B=function(a){++C;if(!k||k(a)){var f=v._objectToBoundingSphere.getCenter(a),h=v._objectToBoundingSphere.getRadius(a),m=p(b,e,f)-w;m-h>x||m+h<u||d&&c(f,h,d)||g(a,A)}};this._forEachNodeDepthOrdered(this._root,function(a){if(null!=n&&C>=n||d&&c(a.center,a.halfSize*r,d))return!1;l.vec3.scale(m,y,a.halfSize);l.vec3.add(m,m,a.center);if(p(b,e,m)-w>x)return!1;l.vec3.scale(m,q,a.halfSize);l.vec3.add(m,m,a.center);if(p(b,e,m)-w<u)return!1;a=a.node;a.terminals.forEach(function(a){B(a)});null!==a.residents&&
a.residents.forEach(function(a){B(a)});return!0},b,e)};d.prototype._objectOrObjectsArray=function(a){if(Array.isArray(a))return a;y[0]=a;return y};d.prototype._remove=function(a,c,b){C.clear();c=b.advanceTo(c,function(a,c){C.push(a.node);C.push(c)})?b.node.terminals:b.node.residents;c.removeUnordered(a);if(0===c.length)for(a=C.length-2;0<=a&&this._purge(C.data[a],C.data[a+1]);a-=2);};d.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;
for(var c=0;c<a.children.length;c++)if(a.children[c])return!1;return!0};d.prototype._purge=function(a,c){0<=c&&(a.children[c]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=new g({shrink:!0})),!0):!1};d.prototype._add=function(a,c){c.advanceTo(this._boundingSphereFromObject(a,B))?c.node.terminals.push(a):(c.node.residents.push(a),c.node.residents.length>this._maximumObjectsPerNode&&c.depth<this._maximumDepth&&this._split(c))};d.prototype._split=function(a){var c=a.node.residents;
a.node.residents=null;for(var b=0;b<c.length;b++){var e=n.acquire().init(a);this._add(c.data[b],e);n.release(e)}};d.prototype._grow=function(a){var c=this;if(0!==a.length&&(a=this._boundingSphereFromObjects(a,function(a,b){return c._boundingSphereFromObject(a,b)},E),this._isValidRadius(a.radius)&&!this._fitsInsideTree(a)))if(this._nodeIsEmpty(this._root.node))l.vec3.copy(this._root.center,a.center),this._root.halfSize=1.25*a.radius;else{var b=n.acquire();this._rootBoundsForRootAsSubNode(a,b);this._placingRootViolatesMaxDepth(b)?
this._rebuildTree(a,b):this._growRootAsSubNode(b);n.release(b)}};d.prototype._rebuildTree=function(a,c){var b=this;l.vec3.copy(I.center,c.center);I.radius=c.halfSize;a=this._boundingSphereFromObjects([a,I],function(a){return a},G);c=n.acquire().init(this._root);this._root.initFrom(null,a.center,1.25*a.radius);this._forEachNode(c,function(a){b.add(a.node.terminals.data,a.node.terminals.length);null!==a.node.residents&&b.add(a.node.residents.data,a.node.residents.length);return!0});n.release(c)};d.prototype._placingRootViolatesMaxDepth=
function(a){var c=0;this._forEachNode(this._root,function(a){c=Math.max(c,a.depth);return!0});return c+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};d.prototype._rootBoundsForRootAsSubNode=function(a,c){var b=a.radius,e=a.center;a=-Infinity;for(var f=this._root.center,g=this._root.halfSize,d=0;3>d;d++){var h=Math.max(0,Math.ceil((f[d]-g-(e[d]-b))/(2*g))),k=Math.max(0,Math.ceil((e[d]+b-(f[d]+g))/(2*g)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(h+k)*Math.LOG2E)));L[d].min=
h;L[d].max=k}for(d=0;3>d;d++)h=L[d].min,k=L[d].max,b=(a-(h+k))/2,h+=Math.ceil(b),k+=Math.floor(b),w[d]=f[d]-g-h*g*2+(k+h)*g;return c.initFrom(null,w,a*g,0)};d.prototype._growRootAsSubNode=function(a){var c=this._root.node;l.vec3.copy(E.center,this._root.center);E.radius=this._root.halfSize;this._root.init(a);a.advanceTo(E,null,!0);a.node.children=c.children;a.node.residents=c.residents;a.node.terminals=c.terminals};d.prototype._shrink=function(){for(;;){var a=this._findShrinkIndex();if(-1===a)break;
this._root.advance(a);this._root.depth=0}};d.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,c=this._root.node.children,b=0,e=0;e<c.length&&null==a;)b=e++,a=c[b];for(;e<c.length;)if(c[e++])return-1;return b};d.prototype._isDegenerate=function(a){a=this._objectToBoundingSphere.getRadius(a);return!this._isValidRadius(a)};d.prototype._isValidRadius=function(a){return!isNaN(a)&&-Infinity!==a&&Infinity!==a&&0<a};d.prototype._fitsInsideTree=
function(a){var c=this._root.center,b=this._root.halfSize,e=a.center;return a.radius<=b&&e[0]>=c[0]-b&&e[0]<=c[0]+b&&e[1]>=c[1]-b&&e[1]<=c[1]+b&&e[2]>=c[2]-b&&e[2]<=c[2]+b};d.prototype._boundingSphereFromObject=function(a,c){l.vec3.copy(c.center,this._objectToBoundingSphere.getCenter(a));c.radius=this._objectToBoundingSphere.getRadius(a);return c};d.prototype._boundingSphereFromObjects=function(a,c,b){if(1===a.length){var e=c(a[0],E);l.vec3.copy(b.center,e.center);b.radius=e.radius}else{x[0]=Infinity;
x[1]=Infinity;x[2]=Infinity;A[0]=-Infinity;A[1]=-Infinity;A[2]=-Infinity;for(var f=0;f<a.length;f++)if(e=c(a[f],E),this._isValidRadius(e.radius)){var g=x,d=e.center,h=e.radius;g[0]=Math.min(g[0],d[0]-h);g[1]=Math.min(g[1],d[1]-h);g[2]=Math.min(g[2],d[2]-h);g=A;d=e.center;e=e.radius;g[0]=Math.max(g[0],d[0]+e);g[1]=Math.max(g[1],d[1]+e);g[2]=Math.max(g[2],d[2]+e)}l.vec3.lerp(b.center,x,A,.5);b.radius=Math.max(A[0]-x[0],A[1]-x[1],A[2]-x[2])/2}return b};return d}();var n=function(){function a(a,c,e,f){void 0===
e&&(e=0);void 0===f&&(f=0);this.center=b.vec3f64.create();this.initFrom(a,c,e,0)}a.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};a.prototype.initFrom=function(c,b,e,f){void 0===c&&(c=null);void 0===e&&(e=this.halfSize);void 0===f&&(f=this.depth);this.node=c||a.createEmptyNode();b&&l.vec3.copy(this.center,b);this.halfSize=e;this.depth=f;return this};a.prototype.advance=function(c){var b=this.node.children[c];b||(b=a.createEmptyNode(),this.node.children[c]=b);
this.node=b;this.halfSize/=2;this.depth++;c=u[c];this.center[0]+=c[0]*this.halfSize;this.center[1]+=c[1]*this.halfSize;this.center[2]+=c[2]*this.halfSize;return this};a.prototype.advanceTo=function(a,c,b){for(void 0===b&&(b=!1);;){if(this.isTerminalFor(a))return c&&c(this,-1),!0;if(this.isLeaf()&&!b)return c&&c(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var e=this._childIndex(a);c&&c(this,e);this.advance(e)}};a.prototype.isLeaf=function(){return null!=this.node.residents};a.prototype.isTerminalFor=
function(a){return a.radius>this.halfSize/2};a.prototype._childIndex=function(a){a=a.center;for(var c=this.center,b=0,e=0;3>e;e++)c[e]<a[e]&&(b|=1<<e);return b};a.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new g({shrink:!0}),residents:new g({shrink:!0})}};a.acquire=function(){return a._pool.acquire()};a.release=function(c){a._pool.release(c)};a.clearPool=function(){a._pool.prune()};a._pool=new q(a);return a}(),u=[b.vec3f64.fromValues(-1,-1,-1),b.vec3f64.fromValues(1,
-1,-1),b.vec3f64.fromValues(-1,1,-1),b.vec3f64.fromValues(1,1,-1),b.vec3f64.fromValues(-1,-1,1),b.vec3f64.fromValues(1,-1,1),b.vec3f64.fromValues(-1,1,1),b.vec3f64.fromValues(1,1,1)],v=[b.vec3f64.fromValues(-1,-1,-1),b.vec3f64.fromValues(-1,-1,1),b.vec3f64.fromValues(-1,1,-1),b.vec3f64.fromValues(-1,1,1),b.vec3f64.fromValues(1,-1,-1),b.vec3f64.fromValues(1,-1,1),b.vec3f64.fromValues(1,1,-1),b.vec3f64.fromValues(1,1,1)],r=Math.sqrt(3),y=[null],w=b.vec3f64.create(),m=b.vec3f64.create(),x=b.vec3f64.create(),
A=b.vec3f64.create(),C=new g,B={center:b.vec3f64.create(),radius:0},E={center:b.vec3f64.create(),radius:0},I={center:b.vec3f64.create(),radius:0},G={center:b.vec3f64.create(),radius:0},L=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],F=new g,K=new g;return t})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/MaterialUtil ./renderers/InstancedRenderer ./renderers/MergedRenderer ../shaders/RibbonLinePrograms ../../../webgl/renderState".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w){var m=g.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");t=function(c){function e(a,b){b=c.call(this,b)||this;b.params=u.copyParameters(a,C);"miter"!==b.params.join&&(b.params.miterLimit=0);b.numVertsAtJoin="wall"===b.params.type?2:4;b.numVertsAtCap=2;b.canBeMerged="screen"===b.params.type&&null==b.params.stippleLength;return b}q(e,c);e.prototype.getColor=function(){return this.params.color};e.prototype.dispose=function(){};e.prototype.setParameterValues=
function(a){for(var c in a)n.assert("type"!==c,"RibbonLineMaterial: type cannot be changed after creation"),n.assert("stippleLength"!==c||null!=a[c]===(null!=this.params[c]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[c]=a[c];"miter"!==this.params.join&&(this.params.miterLimit=0);this.notifyDirty("matChanged")};e.prototype.getParameters=function(){return this.params};e.prototype.intersect=function(a,c,b,e,f,g,d,h,k){k?u.intersectDrapedRenderLineGeometry(a,
c,b,e,f,g,this.params.width,d):this.intersectLineGeometry(a,c,b,e,f,g,d)};e.prototype.intersectLineGeometry=function(c,e,g,d,h,p,l,r){if(d.enable.selectionMode&&!a.isAllHidden(e.componentVisibilities,c.componentOffsets))if(n.isTranslationMatrix(g)){e=c.data;c=e.getVertexAttr()[n.VertexAttrConstants.POSITION].data;e=(e=e.getVertexAttr()[n.VertexAttrConstants.SIZE])&&e.data[0];p=d.camera;r=U;b.vec2.copy(r,d.point);e=(e+this.params.width*p.pixelRatio)/2+4*p.pixelRatio;f.vec3.set(W[0],r[0]-e,r[1]+e,0);
f.vec3.set(W[1],r[0]+e,r[1]+e,0);f.vec3.set(W[2],r[0]+e,r[1]-e,0);f.vec3.set(W[3],r[0]-e,r[1]-e,0);for(var v=0;4>v;v++)p.unprojectPoint(W[v],Z[v]);k.plane.fromPoints(p.eye,Z[0],Z[1],fa);k.plane.fromPoints(p.eye,Z[1],Z[2],ga);k.plane.fromPoints(p.eye,Z[2],Z[3],ja);k.plane.fromPoints(p.eye,Z[3],Z[0],ia);h=Number.MAX_VALUE;for(v=0;v<c.length-5;v+=3)if(M[0]=c[v]+g[12],M[1]=c[v+1]+g[13],M[2]=c[v+2]+g[14],Q[0]=c[v+3]+g[12],Q[1]=c[v+4]+g[13],Q[2]=c[v+5]+g[14],!(0>k.plane.signedDistance(fa,M)&&0>k.plane.signedDistance(fa,
Q)||0>k.plane.signedDistance(ga,M)&&0>k.plane.signedDistance(ga,Q)||0>k.plane.signedDistance(ja,M)&&0>k.plane.signedDistance(ja,Q)||0>k.plane.signedDistance(ia,M)&&0>k.plane.signedDistance(ia,Q))){p.projectPoint(M,N);p.projectPoint(Q,V);if(0>N[2]&&0<V[2]){f.vec3.subtract(P,M,Q);var u=p.frustum,x=-k.plane.signedDistance(u.planes[4],M),u=x/f.vec3.dot(P,u.planes[4]);f.vec3.scale(P,P,u);f.vec3.add(M,M,P);p.projectPoint(M,N)}else if(0<N[2]&&0>V[2])f.vec3.subtract(P,Q,M),u=p.frustum,x=-k.plane.signedDistance(u.planes[4],
Q),u=x/f.vec3.dot(P,u.planes[4]),f.vec3.scale(P,P,u),f.vec3.add(Q,Q,P),p.projectPoint(Q,V);else if(0>N[2]&&0>V[2])continue;N[2]=0;V[2]=0;u=k.lineSegment.distance2(k.lineSegment.fromPoints(N,V,R),r);u<h&&(h=u,f.vec3.copy(X,M),f.vec3.copy(J,Q))}g=d.rayBeginPoint;d=d.rayEndPoint;h<e*e&&(c=Number.MAX_VALUE,k.lineSegment.closestLineSegmentPoint(k.lineSegment.fromPoints(X,J,R),k.lineSegment.fromPoints(g,d,T),O)&&(f.vec3.subtract(O,O,g),c=f.vec3.length(O),f.vec3.scale(O,O,1/c),c/=f.vec3.distance(g,d)),l(c,
O))}else m.error("intersection assumes a translation-only matrix")};e.prototype.createBufferWriter=function(){return"wall"===this.params.type?new G:new E(this.canBeMerged)};e.prototype.createRenderer=function(a,c){return this.canBeMerged?new r(a,c,this):new v(a,c,this)};e.prototype.getGLMaterials=function(){return{color:x,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:A}};e.prototype.getAllTextureIds=function(){return[]};return e}(p);var x=function(a){function c(c,b){c=a.call(this,c,b)||
this;c.updateParameters();return c}q(c,a);c.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram()};c.prototype.beginSlot=function(a){return a===(this.params.writeDepth?6:9)};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(y.colorPass,{screenScale:"screen"===a.type,wall:"wall"===a.type,stipple:null!=a.stippleLength,slice:a.slicePlaneEnabled});
this.pipelineState=w.makePipelineState({blending:w.separateBlendingParams(770,1,771,771),polygonOffset:a.polygonOffset&&L,depthTest:{func:513},depthWrite:1<=a.color[3]&&a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};c.prototype.bind=function(a,c){var b=this.program,e=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);b.setUniform4fv("eColor",e.color);b.setUniform1f("miterLimit",e.miterLimit);b.setUniform1f("nearPlane",c.nearFar[0]);b.setUniform1f("pixelRatio",
c.pixelRatio);b.setUniform1f("extLineWidth",e.width);"screen"===e.type&&b.setUniform2fv("screenSize",[c.viewport[2],c.viewport[3]]);null!=e.stippleLength&&b.setUniform1f("stippleLengthDoubleInv",e.stippleLength?1/(2*e.stippleLength):0)};c.prototype.release=function(a){};c.prototype.bindView=function(a,c){a=this.program;var b=this.params;u.bindView(c.origin,c.view,a);b.slicePlaneEnabled&&u.bindSlicePlane(c.origin,c.slicePlane,a)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",
c.transformation)};c.prototype.getDrawMode=function(){return 5};return c}(h),A=function(a){function c(c,b){c=a.call(this,c,b)||this;c.updateParameters();return c}q(c,a);c.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram()};c.prototype.beginSlot=function(a){return 4===a};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(y.highlightPass,
{screenScale:"screen"===a.type,wall:"wall"===a.type,stipple:null!=a.stippleLength,slice:a.slicePlaneEnabled});this.pipelineState=w.makePipelineState({polygonOffset:a.polygonOffset&&L,depthTest:{func:513},depthWrite:1<=a.color[3]&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};c.prototype.bind=function(a,c){var b=this.program,e=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);u.bindHighlightRendering(a,c,b);b.setUniform4fv("eColor",e.color);b.setUniform1f("miterLimit",
e.miterLimit);b.setUniform1f("nearPlane",c.nearFar[0]);b.setUniform1f("pixelRatio",c.pixelRatio);b.setUniform1f("extLineWidth",e.width);"screen"===e.type&&b.setUniform2fv("screenSize",[c.viewport[2],c.viewport[3]]);null!=e.stippleLength&&b.setUniform1f("stippleLengthDoubleInv",e.stippleLength?1/(2*e.stippleLength):0)};c.prototype.release=function(a){};c.prototype.bindView=function(a,c){a=this.program;var b=this.params;u.bindView(c.origin,c.view,a);b.slicePlaneEnabled&&u.bindSlicePlane(c.origin,c.slicePlane,
a)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(){return 5};return c}(h),C={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,writeDepth:!0,polygonOffset:!1,stippleLength:null,slicePlaneEnabled:!1},B=c.newLayout().vec3f(n.VertexAttrConstants.POSITION).vec2f(n.VertexAttrConstants.UV0).vec3f(n.VertexAttrConstants.AUXPOS1).vec3f(n.VertexAttrConstants.AUXPOS2).vec4f(n.VertexAttrConstants.COLOR).f32(n.VertexAttrConstants.SIZE),
E=function(){function a(a){this.canBeMerged=a;this.vertexBufferLayout=B;this.numVertsAtJoin=4;this.numVertsAtCap=2}a.prototype.allocate=function(a){return B.createBuffer(a)};a.prototype.elementCount=function(a){a=(a.indices[n.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;this.canBeMerged&&(a+=2);return a};a.prototype.write=function(a,c,b,e,f){b=c.vertexAttr[n.VertexAttrConstants.POSITION].data;var g=c.indices&&c.indices[n.VertexAttrConstants.POSITION];g&&g.length!==
2*(b.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");g=c.vertexAttr[n.VertexAttrConstants.COLOR]?c.vertexAttr[n.VertexAttrConstants.COLOR].data:F;c=c.vertexAttr[n.VertexAttrConstants.SIZE]?c.vertexAttr[n.VertexAttrConstants.SIZE].data:K;var d=b.length/3;a=a.transformation;e=e.position.typedBuffer;var h=0,k=this.vertexBufferLayout.stride/4,m=f*=k;this.canBeMerged&&(f+=k);var p=b[0],l=b[1],r=b[2];if(a)var v=p,u=l,x=r,p=a[0]*v+a[4]*u+a[8]*x+a[12],l=a[1]*v+a[5]*u+a[9]*x+a[13],
r=a[2]*v+a[6]*u+a[10]*x+a[14];var A=b[3],w=b[4],x=b[5];a&&(v=A,u=w,A=a[0]*v+a[4]*u+a[8]*x+a[12],w=a[1]*v+a[5]*u+a[9]*x+a[13],x=a[2]*v+a[6]*u+a[10]*x+a[14]);for(var y=p,q=l,C=r,B=0;B<d;B++)v=3*B,B<d-1&&(A=b[v+3],w=b[v+4],x=b[v+5],a&&(v=A,u=w,A=a[0]*v+a[4]*u+a[8]*x+a[12],w=a[1]*v+a[5]*u+a[9]*x+a[13],x=a[2]*v+a[6]*u+a[10]*x+a[14])),h+=Math.sqrt((y-p)*(y-p)+(q-l)*(q-l)+(C-r)*(C-r)),e[f++]=y,e[f++]=q,e[f++]=C,e[f++]=h,e[f++]=0===B?-1.2:-1,e[f++]=p,e[f++]=l,e[f++]=r,e[f++]=A,e[f++]=w,e[f++]=x,e[f++]=g[0],
e[f++]=g[1],e[f++]=g[2],e[f++]=g[3],e[f++]=c[0],e[f++]=y,e[f++]=q,e[f++]=C,e[f++]=h,e[f++]=0===B?1.2:1,e[f++]=p,e[f++]=l,e[f++]=r,e[f++]=A,e[f++]=w,e[f++]=x,e[f++]=g[0],e[f++]=g[1],e[f++]=g[2],e[f++]=g[3],e[f++]=c[0],0<B&&B<d-1&&(e[f++]=y,e[f++]=q,e[f++]=C,e[f++]=h,e[f++]=-1.2,e[f++]=p,e[f++]=l,e[f++]=r,e[f++]=A,e[f++]=w,e[f++]=x,e[f++]=g[0],e[f++]=g[1],e[f++]=g[2],e[f++]=g[3],e[f++]=c[0],e[f++]=y,e[f++]=q,e[f++]=C,e[f++]=h,e[f++]=1.2,e[f++]=p,e[f++]=l,e[f++]=r,e[f++]=A,e[f++]=w,e[f++]=x,e[f++]=g[0],
e[f++]=g[1],e[f++]=g[2],e[f++]=g[3],e[f++]=c[0]),p=y,l=q,r=C,y=A,q=w,C=x;if(this.canBeMerged){for(B=m;B<m+k;B++)e[B]=e[B+k];b=f-k;for(B=0;B<k;B++)e[f++]=e[b++]}};return a}(),I=c.newLayout().vec3f(n.VertexAttrConstants.POSITION).vec2f(n.VertexAttrConstants.UV0),G=function(){function a(){this.vertexBufferLayout=I;this.numVertsAtCap=this.numVertsAtJoin=2;this.tmpCurrent=e.vec3f64.create();this.tmpLast=e.vec3f64.create()}a.prototype.allocate=function(a){return B.createBuffer(a)};a.prototype.elementCount=
function(a){return(a.indices[n.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap};a.prototype.write=function(a,c,b,e,g){b=c.vertexAttr[n.VertexAttrConstants.POSITION].data;(c=c.indices&&c.indices[n.VertexAttrConstants.POSITION])&&c.length!==2*(b.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");c=b.length/3;a=a.transformation;var d=0,h=this.tmpCurrent,k=this.tmpLast;f.vec3.set(h,b[0],b[1],b[2]);for(var m=0;m<c;m++){var p=3*m;f.vec3.copy(k,
h);f.vec3.set(h,b[p],b[p+1],b[p+2]);a&&f.vec3.transformMat4(h,h,a);d+=f.vec3.squaredDistance(k,h);e.position.setVec(g,h);e.uv0.set(g,0,d);e.uv0.set(g,1,-1);++g;e.position.setVec(g,h);e.uv0.set(g,0,d);e.uv0.set(g,1,1);++g}};return a}(),L={factor:0,units:-4},F=[255,255,255,255],K=[0,0,0,0],M=e.vec3f64.create(),Q=e.vec3f64.create(),P=e.vec3f64.create(),O=e.vec3f64.create(),U=e.vec3f64.create(),N=l.createRenderScreenPointArray3(),V=l.createRenderScreenPointArray3(),X=e.vec3f64.create(),J=e.vec3f64.create(),
R=k.lineSegment.create(),T=k.lineSegment.create(),W=[l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3()],Z=[e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create()],fa=k.plane.create(),ga=k.plane.create(),ja=k.plane.create(),ia=k.plane.create();return t})},"esri/views/3d/webgl-engine/materials/renderers/InstancedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c){function a(a,c){var b=new Map,e=function(a,c){var e=a.origin.id,f=a.data.id,g=b.get(e);g||(g={origin:a.origin.vec3,deltaByGeometry:new Map},b.set(e,g));e=g.deltaByGeometry.get(f);e||(e={renderData:a.data,toAdd:[],toRemove:[]},g.deltaByGeometry.set(f,e));(c?e.toAdd:e.toRemove).push(a)};a.forEach(function(a){e(a,!0)});c.forEach(function(a){e(a,!1)});return b}function h(a,c,b){var e=c.elementCount(a),e=c.allocate(e);c.write({},a,null,e,0);b.setData(e.buffer)}return function(){function d(a,
c,b){this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=a;this._material=b;this._materialRep=c;this._glMaterials=f.acquireMaterials(this._material,this._materialRep);this._bufferWriter=b.createBufferWriter()}d.prototype.dispose=function(){f.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(d.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasHighlights",{get:function(){return 0<
this._highlightCount},enumerable:!0,configurable:!0});d.prototype.renderPriority=function(){return this._material.renderPriority};d.prototype.modify=function(a){this.updateGeometries(a.toUpdate);this.addAndRemoveGeometries(a.toAdd,a.toRemove);this.updateHighlightCount()};d.prototype.addAndRemoveGeometries=function(d,p){var n=this._rctx,r=this._bufferWriter,u=this._dataByOrigin;d=a(d,p);var w=r.vertexBufferLayout;d.forEach(function(a,d){var m=u.get(d);m||(m={origin:a.origin,highlightCount:0,dataByGeometry:new Map},
u.set(d,m));a.deltaByGeometry.forEach(function(a,d){var p=m.dataByGeometry.get(d);!p&&0<a.toAdd.length&&(p={vao:new c(n,l.Default3D,{geometry:g.glLayout(w)},{geometry:e.createVertex(n,35044)}),vertexCount:0,instances:new Map,highlightCount:0},h(a.renderData,r,p.vao.vertexBuffers.geometry),p.vertexCount=k.vertexCount(p.vao,"geometry"),m.dataByGeometry.set(d,p));var v=p.instances;a.toAdd.forEach(function(a){var c=q.mat4f64.create();f.calculateTransformRelToOrigin(a,c);var e=f.generateRenderGeometryVisibleIndexRanges(a),
g=f.generateRenderGeometryHighlightRanges(a),c=new b(a.name,0,p.vertexCount,e,g,c,a.instanceParameters,a.idx,a.data.id);v.set(a.uniqueName,c);m.highlightCount=null;p.highlightCount=null});a.toRemove.forEach(function(a){v.delete(a.uniqueName)});0===v.size&&(p.vao.dispose(),m.dataByGeometry.delete(d))});0===m.dataByGeometry.size&&u.delete(d)})};d.prototype.updateGeometries=function(a){var c=this._dataByOrigin,b=this._bufferWriter;a.forEach(function(a){var e=a.updateType;a=a.renderGeometry;var g=c.get(a.origin.id),
d=g&&g.dataByGeometry.get(a.data.id),k=d&&d.instances.get(a.uniqueName);k&&(e&1&&(k.displayedIndexRange=f.generateRenderGeometryVisibleIndexRanges(a)),e&17&&(k.highlightedIndexRanges=f.generateRenderGeometryHighlightRanges(a),g.highlightCount=null,d.highlightCount=null),e&2&&h(a.data,b,d.vao.vertexBuffers.geometry),e&4&&f.calculateTransformRelToOrigin(a,k.transformation,k.transformationNormal))})};d.prototype.updateHighlightCount=function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(c){if(null==
c.highlightCount){var b=0;c.dataByGeometry.forEach(function(a){if(null==a.highlightCount){var c=0;a.instances.forEach(function(a){a.highlightedIndexRanges&&++c});a.highlightCount=c}b+=a.highlightCount});c.highlightCount=b}a._highlightCount+=c.highlightCount})};d.prototype.render=function(a,c,b,e){var f=this,g=this._rctx,d=this._glMaterials.get(c.pass),h=4===c.pass;if(!d||null!=a&&!d.beginSlot(a)||h&&0===this._highlightCount)return!1;d.bind(g,b);var k=!1;this._dataByOrigin.forEach(function(a){h&&0===
a.highlightCount||(b.origin=a.origin,d.bindView(g,b),a.dataByGeometry.forEach(function(a){k=h?f.renderHighlightPass(d,a,e)||k:f.renderDefaultPass(d,a,e)||k}))});g.bindVAO(null);d.release(g,b);return k};d.prototype.renderDefaultPass=function(a,c,b){var e=this._rctx,g=a.getProgram(),d=a.getDrawMode(),h=c.vao,p=c.vertexCount;k.assertCompatibleVertexAttributeLocations(h,g);e.bindVAO(h);var l=!1;c.instances.forEach(function(c){var g=c.displayedIndexRange;g&&0===g.length||(a.bindInstance(e,c),g?f.drawArraysFaceRange(e,
g,0,d,b):f.drawArrays(e,d,0,p,b),l=!0)});return l};d.prototype.renderHighlightPass=function(a,c,b){var e=this._rctx,g=a.getProgram(),d=a.getDrawMode(),h=c.vao,p=c.vertexCount;if(0!==c.highlightCount){k.assertCompatibleVertexAttributeLocations(h,g);e.bindVAO(h);var l=!1;c.instances.forEach(function(c){var g=c.highlightedIndexRanges;if(g&&0!==g.length)for(a.bindInstance(e,c),c=0;c<g.length;c++){var h=g[c];f.drawArrays(e,d,h.range?h.range[0]:0,h.range?h.range[1]-h.range[0]+1:p,b);l=!0}});return l}};
return d}()})},"esri/views/3d/webgl-engine/shaders/RibbonLinePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=function(b){return l.glslifyDefineMap({WALL:b.wall,SCREENSCALE:b.screenScale,STIPPLE:b.stipple,SLICE:b.slice})};d.colorPass={name:"ribbon-line-color",shaders:function(f){return{vertexShader:b(f)+g.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),
fragmentShader:b(f)+g.resolveIncludes("materials/ribbonLine/colorPass.frag")}},attributes:q.Default3D};d.highlightPass={name:"ribbon-line-highlight",shaders:function(f){return{vertexShader:b(f)+g.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:b(f)+g.resolveIncludes("materials/ribbonLine/highlightPass.frag")}},attributes:q.Default3D}})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/maybe ../../../../core/TimeProfiler ../../../../core/libs/gl-matrix-2/vec2f64 ../../support/debugFlags ../lib/Util ./BoundingInfo ./depthRange ./depthRangeUtils ./FxaaRenderPass ./HighlightHelper ./OffscreenRenderingHelper ./RenderContext ./RenderPluginManager ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./Util ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../../../webgl/Profiling ../../../webgl/Texture".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E){function I(a,c){var b=new Map,e=null,f=null,g=function(a){if(a===e)return f;var c=b.get(a);c||(c={toAdd:[],toRemove:[],toUpdate:[]},b.set(a,c));e=a;return f=c};a.toAdd.forEach(function(a){1<=G(a.data)&&g(a.material).toAdd.push(a)});a.toRemove.forEach(function(a){1<=G(a.data)&&g(a.material).toRemove.push(a)});var d=0;a.toUpdate.forEach(function(a){1<=G(a.renderGeometry.data)&&(g(a.renderGeometry.material).toUpdate.push(a),d|=a.updateType)});
c&&(c.updateTypes=d);return b}function G(a){return!1===a.preinterleaved?m.getFirstObjectValue(a.indices).length:a.indexCount}function L(a,c){return a.isVisible()&&a.isVisibleInPass(c.pass)&&0!==(a.renderOccluded&c.renderOccludedMask)}t=function(){function d(c,b,e,f,g,k){var m=this;this._materialRenderers=new Map;this._orderedMaterialRenderers=[];this._hasHighlights=!1;this._lighting=new A.SceneLighting;this._content=new Map;this._isRendering=!1;this._needsRender=!0;this._fallbackDepthStencilTexture=
null;this._stats=new d.RenderStats;this._edgeView=null;this.renderOptions={antialiasing:"smaa"};this._programRep=c;this._materialRep=b;this._rctx=f;this._mode=g;this._stage=k;this._fxaaPass=new a(f);this._smaaPass=new y(f);this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null};this._offscreenRendering=new p(c,this._rctx);this._sliceHelper=new r;"scene"===this._mode&&
(this._shadowMap=new v(this._rctx),this._ssaoHelper=new w(c,this._rctx,function(){m._needsRender=!0}),this._highlightHelper=new h(c,this._rctx));this._renderPlugins=new u.RenderPluginManager({rctx:f,programRep:c,textureRep:e,materialRep:b});this._renderContext=new n(f,this._offscreenRendering,this._lighting.getOld(),this._shadowMap,this._ssaoHelper,this._sliceHelper)}d.prototype.dispose=function(){this._materialRenderers.forEach(function(a){a.dispose()});this._orderedMaterialRenderers=this._materialRenderers=
null;this._edgeView&&(this._edgeView.destroy(),this._edgeView=null);this._offscreenRendering.enabled=!1;this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null);this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose());this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose());this._highlightHelper&&(this._highlightHelper.enabled=!1);e.tmpIndices.prune();this._content.clear();this._content=null};Object.defineProperty(d.prototype,
"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0});d.prototype.ensureEdgeView=function(){var a=this;null==this._edgeView&&(this._edgeView=new x.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){return a._needsRender=!0}}),this._edgeView.initialize());return this._edgeView};Object.defineProperty(d.prototype,"edgeView",{get:function(){return this._edgeView},enumerable:!0,configurable:!0});
d.prototype.setLighting=function(a){this._lighting.set(a)};d.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._shadowMap.enabled&&(this._shadowMap.textureResolution=a.shadowMapResolution);void 0!==a.shadowMap&&(this._shadowMap.enabled=a.shadowMap);void 0!==a.shadowMapMaxCascades&&(this._shadowMap.maxCascades=a.shadowMapMaxCascades);this._highlightHelper.enabled=!0;void 0!==a.ssao&&(this._ssaoHelper.enabled=a.ssao);void 0!==a.ssaoAttenuation&&(this._ssaoHelper.attenuation=
a.ssaoAttenuation);void 0!==a.ssaoRadius&&(this._ssaoHelper.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&(this._ssaoHelper.samples=a.ssaoSamples);a.background&&(this._offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this.renderOptions.antialiasing=a.antialiasingEnabled?"smaa":"none");void 0!==a.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(a.defaultHighlightOptions);
void 0!==a.slicePlane&&(this._sliceHelper.plane=a.slicePlane);this._needsRender=!0};Object.defineProperty(d.prototype,"hasSlicePlane",{get:function(){return!!this._sliceHelper.plane},enumerable:!0,configurable:!0});d.prototype.getRenderParams=function(){var a={};this._shadowMap&&(a.shadowMap=this._shadowMap.enabled,a.shadowMapResolution=this._shadowMap.textureResolution,a.shadowMapMaxCascades=this._shadowMap.maxCascades);this._ssaoHelper&&this._ssaoHelper.isSupported&&(a.ssao=this._ssaoHelper.enabled,
a.ssaoAttenuation=this._ssaoHelper.attenuation,a.ssaoRadius=this._ssaoHelper.radius,a.ssaoFilterRadius=this._ssaoHelper.filterRadius,a.ssaoSamples=this._ssaoHelper.samples);return a};Object.defineProperty(d.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0});d.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderPlugins.resetNeedsRender()};d.prototype.needsRender=function(){return this._needsRender||this._renderPlugins.needsRender()};
d.prototype.getCombinedStats=function(){this._stats.VBOallocatedSize=0;this._stats.VBOoptimalSize=0;this._stats.VBOusedSize=0;this._stats.VBOallocatedSize*=.00390625;this._stats.VBOusedSize*=.00390625;this._stats.VBOoptimalSize*=.00390625;return this._stats};d.prototype.getFramebufferTexture=function(a){switch(a){case "color":return this._offscreenRendering.colorTexture;case "hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();
case "linearDepth":return this._offscreenRendering.linearDepthTexture;case "normals":return this._offscreenRendering.normalTexture;case "highlight":return this._offscreenRendering.highlightTexture}return null};Object.defineProperty(d.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0});d.prototype.isEmpty=function(){return 0===this._materialRenderers.size};d.prototype.modify=function(a,c,b,e){var d=this;void 0===b&&(b=[]);this._isRendering&&console.warn("Renderer.modify called while rendering");
for(var g=0;g<c.length;++g)this._content.delete(c[g].uniqueName);for(g=0;g<a.length;++g)this._content.set(a[g].uniqueName,a[g]);if(b)for(g=0;g<b.length;++g)f.assert(this._content.get(b[g].renderGeometry.uniqueName)===b[g].renderGeometry);if(a.length||c.length||b.length){var h=!1;I({toAdd:a,toRemove:c,toUpdate:b}).forEach(function(a,c){var b=d._materialRenderers.get(c);!b&&0<a.toAdd.length&&(b=c.createRenderer(d._rctx,d._materialRep),d._materialRenderers.set(c,b),d._orderedMaterialRenderers.push(b),
d.sortOrderedMaterialRenderers());b&&(b.modify(a),b.isEmpty&&(h=!0))});h&&this._materialRenderers.forEach(function(a,c){a.isEmpty&&(d._materialRenderers.delete(c),d._orderedMaterialRenderers.splice(d._orderedMaterialRenderers.indexOf(a),1),a.dispose())});var k=!1;this._materialRenderers.forEach(function(a){k=k||a.hasHighlights});if(k!==this._hasHighlights){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(k);this._hasHighlights=k}this._needsRender=!0}e&&(e.forEach(function(a){d._materialRep.updateMaterialParameters(a)}),
this._needsRender=!0)};d.prototype.modifyRenderOrder=function(a){"draped"===this._mode&&(this.sortOrderedMaterialRenderers(),this._needsRender=!0)};d.prototype.render=function(a){switch(this._mode){case "scene":this.renderScene(a);break;case "draped":this.renderDraped(a)}if(this.onPostRender)this.onPostRender()};d.prototype.renderPass=function(a,c){this.renderGeometryPass(a,c)};d.prototype.renderScene=function(a){var c=this;this._isRendering=!0;var b=this._rctx,e=this._offscreenRendering,f=this._ssaoHelper,
d=a.camera,g=a.fbo,h=this._sliceHelper.plane;a.disableSlice&&(this._sliceHelper.plane=null);this.prepareRender(d);this.renderShadowMap(a);e.enabled=!0;e.initializeFrame(d,g);this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth()?e.renderToTargets(function(){c.renderGeometryPass(1,a)},e.linearDepth,e.tmpDepth,[0,0,0,0],!0):e.disposeTarget(e.linearDepth);this._ssaoHelper.enabled?e.renderToTargets(function(){c.renderGeometryPass(2,a)},e.normal,e.tmpDepth,[0,0,0,0],!0):e.disposeTarget(e.normal);
this._ssaoHelper.enabled&&f.computeSSAO(d,e.linearDepthTexture,e.normalTexture);f.bindAll(this._programRep);this._stats.reset();this.updateGlobalUniforms(d.projectionMatrix);this._renderContext.pass=0;this._renderContext.camera=d;this._renderContext.options=this.renderOptions;e.bindTarget(e.mainColor,e.mainDepth);this._renderPlugins.render(0,this._renderContext);this.renderGeometrySlotsPt1(this._renderContext);this._edgeView&&this._edgeView.shouldRender()&&e.renderSeparateAndComposite(function(){return c._edgeView.render(c._bindParameters)},
void 0,"alpha");d=f=!1;f=this.renderHUDVisibility(this._renderContext);this.renderInternalSlot(17,this._renderContext);(d=this.renderTransparentTerrain(this._renderContext))&&f&&(e.compositeTransparentTerrainOntoHUDVisibility(),e.renderToTargets(function(){return c.renderHUD("occluded")},e.mainColor,e.tmpDepth,void 0,!0));d&&e.compositeTransparentTerrainOntoMain();e.renderToTargets(function(){c.renderInternalSlot(9,c._renderContext);c._renderPlugins.render(13,c._renderContext);c._renderPlugins.render(14,
c._renderContext)},e.mainColor,e.mainDepth);this.renderOccluded();f=this.renderOptions.antialiasing;"smaa"===f&&this._smaaPass.loadResources(function(){c._needsRender=!0});"smaa"===f&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:e.colorTexture},g)):"fxaa"===f&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:e.colorTexture},g)):(e.composite(),this._fxaaPass.disable(),this._smaaPass.disable());b.bindFramebuffer(g);this.renderHUD("notOccluded");
this.renderHighlights(a,g);this._sliceHelper.plane=h;this._isRendering=!1};d.prototype.renderDraped=function(a){this._stats.reset();this.renderGeometryPass(0,a)};d.prototype.prepareRender=function(a){this._renderPlugins.prepareRender(a)};d.prototype.renderShadowMap=function(a){var c=this._shadowMap,e=a.camera,f=a.fbo,d=a.lightDirection;if(c.enabled){b.ENABLE_PROFILE_DEPTH_RANGE&&g.begin("depthRange");var h=this.computeDepthRange(e);b.ENABLE_PROFILE_DEPTH_RANGE&&g.end("depthRange");c.prepare(e,d,h);
d=c.getCascades();for(h=0;h<d.length;++h){var k=d[h];k.camera.setGLViewport(this._rctx);a.camera=k.camera;this.renderGeometryPass(3,a)}a.camera=e;c.finish(f);e.setGLViewport(this._rctx)}c.bindAll(this._programRep)};d.prototype.computeDepthRange=function(a){var b=c.depthRangeFromScene(a,this._content,this._stage.getLayers());k.union(b,this.renderPlugins.queryDepthRange(a));b.near=Math.max(a.near,b.near);b.far=Math.min(a.far,b.far);return b};d.prototype.renderGeometryPass=function(a,c){this._isRendering=
!0;c=c.camera;this.updateGlobalUniforms(c.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=c;"draped"===this._mode?this.renderGeometryPassDraped(this._renderContext):this.renderGeometryPassScene(this._renderContext);this._isRendering=!1};d.prototype.renderGeometryPassDraped=function(a){var c=this,b=a.camera;this._bindParameters.view=b.viewMatrix;this._bindParameters.proj=b.projectionMatrix;this._bindParameters.viewInvTransp=b.viewInverseTransposeMatrix;F[0]=b.near;F[1]=b.far;
this._bindParameters.nearFar=F;this._bindParameters.lightingData=a.lightingData;this._bindParameters.viewport=b.fullViewport;this._bindParameters.pixelRatio=b.pixelRatio;this._bindParameters.slicePlane=a.sliceHelper&&a.sliceHelper.plane;this._bindParameters.highlightDepthTexture=this.getFallbackDepthTexture();this._orderedMaterialRenderers.forEach(function(b){b.render(null,a,c._bindParameters)})};d.prototype.renderGeometryPassScene=function(a){this.renderGeometrySlotsPt1(a);this.renderTransparentTerrain(a)};
d.prototype.renderGeometrySlotsPt1=function(a){this._renderPlugins.render(1,a);this.renderInternalSlot(2,a);this._renderPlugins.render(3,a);this.renderInternalSlot(4,a);this._renderPlugins.render(5,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._renderPlugins.render(12,this._renderContext);this.renderInternalSlot(6,a);this._renderPlugins.render(7,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep)};d.prototype.renderTransparentTerrain=function(a){return this._renderPlugins.render(8,
a)};d.prototype.renderHUDVisibility=function(a){var c=this,b=C.shouldRenderVisibilityDuringRenderPass(a.pass),e=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.enabled,f=!1;b&&e&&a.offscreenRenderingHelper.renderHUDVisibility(function(){f=c.renderInternalSlot(10,a)});return f};d.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this.renderInternalSlot(18,this._renderContext);this.renderInternalSlot(15,this._renderContext);this.renderInternalSlot(16,this._renderContext)};
d.prototype.renderHighlights=function(a,c){var b=this,e=this._highlightHelper;if(e&&e.enabled&&(this.hasHighlights||this._renderPlugins.needsHighlight())){var f=null;e.profilingCallback&&(f=B.startMeasurement(this._renderContext.rctx));var d=this._offscreenRendering,d=d.renderToTargets(function(){b.renderGeometryPass(4,a);b._rctx.clearSafe(256);b.renderHUD("both")},d.highlight,d.tmpDepth,[0,0,0,0],!0);e.render(a.camera,d,c);null!==f&&e.profilingCallback&&f.stop(function(a){e.profilingCallback&&e.profilingCallback(a)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};
d.prototype.renderOccluded=function(){var a=this;this._materialRenderers.forEach(function(a,c){c&&c.isVisible()&&1!==c.renderOccluded&&K.push(c)});if(0!==K.length){var c=this._offscreenRendering,b=this._renderContext,e=function(e,f){b.renderOccludedMask=f;c.renderToTargets(function(){a.renderInternalSlot(4,b,K);a.renderInternalSlot(6,b,K);a.renderInternalSlot(9,b,K)},c.tmpColor,c.tmpDepth,[0,0,0,0],!0);b.resetRenderOccludedMask();c.compositeOccludedOntoMain(e)};b.pass=0;e(.4,4);e(.5,2);e(1,8);K.length=
0}};d.prototype.renderInternalSlot=function(a,c,b){this._bindParameters.view=c.camera.viewMatrix;this._bindParameters.proj=c.camera.projectionMatrix;this._bindParameters.viewInvTransp=c.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=c.camera.aboveGround;this._bindParameters.fovY=c.camera.fovY;F[0]=c.camera.near;F[1]=c.camera.far;var e=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=F;this._bindParameters.lightingData=c.lightingData;this._bindParameters.viewport=
c.camera.fullViewport;this._bindParameters.shadowMap=c.shadowMap;this._bindParameters.shadowMappingEnabled=!!c.shadowMap&&c.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!c.ssaoHelper&&c.ssaoHelper.enabled;this._bindParameters.pixelRatio=c.camera.pixelRatio;this._bindParameters.slicePlane=c.sliceHelper&&c.sliceHelper.plane;this._bindParameters.hudVisibilityTexture=e?e.hudVisibilityTexture:null;this._bindParameters.highlightDepthTexture=e&&e.depthTexture||this.getFallbackDepthTexture();return this.renderInternalSlotMaterials(a,
c,b)};d.prototype.renderInternalSlotMaterials=function(a,c,b){var e=this,f=!1;q.isSome(b)?b.forEach(function(b){L(b,c)&&(f=e._materialRenderers.get(b).render(a,c,e._bindParameters)||f)}):this._materialRenderers.forEach(function(b,d){L(d,c)&&(f=b.render(a,c,e._bindParameters)||f)});return f};d.prototype.updateGlobalUniforms=function(a){for(var c=this._programRep.getProgramsUsingUniform("proj"),b=0;b<c.length;b++)c[b].setUniformMatrix4fv("proj",a);if(this._lighting){c=this._programRep.getProgramsUsingUniform("lightingMainDirection");
for(b=0;b<c.length;b++)this._lighting.setUniforms(c[b]);c=this._programRep.getProgramsUsingUniform("lightDirection");for(b=0;b<c.length;b++)this._lighting.setUniforms(c[b])}};d.prototype.sortOrderedMaterialRenderers=function(){"draped"===this._mode&&this._orderedMaterialRenderers.sort(function(a,c){return c.renderPriority()-a.renderPriority()})};d.prototype.getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new E(this._rctx,{target:3553,pixelFormat:6408,
dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};d.prototype.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}};d.prototype.forEachRenderGeometry=function(a){this._content.forEach(function(c,
b){a(c)})};return d}();(function(a){var c=function(){function a(){this.reset()}a.prototype.reset=function(){this.VBOusedSize=this.VBOoptimalSize=this.VBOallocatedSize=this.instancesDrawnAngle=this.drawCallsHighlight=this.drawCallsFragmented=this.drawCallsPreinterleaved=this.drawCallsMerged=this.drawCallsAngleInstanced=this.drawCallsInstanced=this.trianglesRendered=0};return a}();a.RenderStats=c})(t||(t={}));var F=l.vec2f64.create(),K=[];return t})},"esri/core/TimeProfiler":function(){define(["require",
"exports"],function(t,d){t=function(){function d(d,l){void 0===l&&(l=.9);this._alpha=.9;this._name=d;this._alpha=l;this.reset()}d.prototype.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(d.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"average",{get:function(){return 0<
this._count?this._sum/this._count:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});d.prototype.begin=function(){this._startTime=performance.now()};d.prototype.end=function(){var d=performance.now()-
this._startTime;this._count+=1;this._sum+=d;this._smooth=this._alpha*d+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,d);this._max=Math.max(this._max,d)};d.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return d}();(function(d){function g(e){e in b||(b[e]=new d(e));return b[e]}function l(b){console.log(g(b).toJSON())}var b={},f={};d.get=g;d.begin=function(b){g(b).begin()};d.end=function(b,d){void 0===
d&&(d=!0);g(b).end();var c=performance.now();!d||b in f&&!(c>=f[b]+1E3)||(l(b),f[b]=c)};d.log=l;d.logAll=function(){for(var e in b)l(e)}})(t||(t={}));return t})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(t,d){function q(d,b){return{near:d,far:b}}function g(d,b,f){d.near=b;d.far=f;return d}Object.defineProperty(d,"__esModule",{value:!0});d.create=q;d.empty=function(d){return d?g(d,Infinity,-Infinity):q(Infinity,-Infinity)};d.set=g;d.union=function(d,
b,f){void 0===f&&(f=d);f.near=Math.min(d.near,b.near);f.far=Math.max(d.far,b.far);return f}})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ./ComponentUtils ./depthRange ./Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n){function u(a,c){if(c.isVisible){var b=p.empty(),e=c.getObjects();c.getSpatialQueryAccelerator()?v(b,a,c.getSpatialQueryAccelerator()):r(b,a,e);return b}}function v(a,c,b){var e=c.eye,f=c.viewForward,d=c.frustum,g=function(a){return!a.areAllComponentsHidden()},h=b.objectCount;500>h?(p.set(E,c.near,Math.min(a.near,c.far)),b.forEachInDepthRange(e,f,"front-to-back",E,function(b,e){y(a,c,b);E.far=a.near;e.setRange(E)},d,g),p.set(E,Math.max(a.far,c.near),c.far),b.forEachInDepthRange(e,
f,"back-to-front",E,function(b,e){y(a,c,b);E.near=a.far;e.setRange(E)},d,g)):(h=Math.max(Math.min(h,500),Math.ceil(.1*h)),e=b.findClosest(f,"front-to-back",d,g,h),b=b.findClosest(f,"back-to-front",d,g,h),e&&b&&(m(a,c,e.getCenter(),e.getBSRadius()),m(a,c,b.getCenter(),b.getBSRadius())))}function r(a,c,b){I.clear();b.forEach(function(a){a.areAllComponentsHidden()||I.add(a)});I.empty||(I.sort(c),p.set(E,c.near,Math.min(a.near,c.far)),I.forEachInDepthRange(E,"front-to-back",function(b,e,f){e<a.near&&
y(a,c,b)}),p.set(E,Math.max(a.far,c.near),c.far),I.forEachInDepthRange(E,"back-to-front",function(c,b,e){a.far=Math.max(a.far,e)}))}function y(b,e,f){if(!f.areAllComponentsHidden()&&c.frustum.intersectsSphere(e.frustum.planes,c.sphere.wrap(f.getBSRadius(),f.getCenter()))){var d=f.objectTransformation,h=B;f.geometryRecords.forEach(function(c){g.mat4.multiply(h,d,c.getShaderTransformation());var f=a.maxScale(h);w(b,e,c.geometry.boundingInfo,h,f)})}}function w(a,e,f,d,g){var h=e.eye,k=e.viewForward;
b.vec3.transformMat4(C,f.center,d);h=k[0]*(C[0]-h[0])+k[1]*(C[1]-h[1])+k[2]*(C[2]-h[2]);k=f.bsRadius*g;if(!(h-k>a.near&&h+k<a.far)&&c.frustum.intersectsSphere(e.frustum.planes,c.sphere.wrap(k,C)))if(100<f.bsRadius&&f.getChildren())for(f=f.getChildren(),h=0;8>h;++h)f[h]&&w(a,e,f[h],d,g);else L.unionDepthRangeWithAABB(a,e.viewProjectionMatrix,d,f.bbMin,f.bbMax)}function m(a,c,b,e){var f=c.eye;c=c.viewForward;b=(b[0]-f[0])*c[0]+(b[1]-f[1])*c[1]+(b[2]-f[2])*c[2];a.near=Math.min(a.near,b-e);a.far=Math.max(a.far,
b+e)}Object.defineProperty(d,"__esModule",{value:!0});d.depthRangeFromScene=function(a,c,b){if(1E4>c.size)return G.compute(a,c);c=p.empty();for(var e in b){var f=b[e];f.isVisible&&p.union(c,u(a,f))}return c};d.depthRangeFromLayer=u;t=function(){function a(){this._items=new q({allocator:function(a){return a||{obj:null,distance:0,near:0,far:0}},deallocator:function(a){a.obj=null;a.distance=0;a.near=0;a.far=0;return a}})}Object.defineProperty(a.prototype,"length",{get:function(){return this._items.length},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._items.clear()};a.prototype.add=function(a){this._items.pushNew().obj=a};a.prototype.sort=function(a){var c=a.eye,b=a.viewForward;this._items.forEach(function(a){var e=a.obj,f=e.getCenter(),e=e.getBSRadius(),f=(f[0]-c[0])*b[0]+(f[1]-c[1])*b[1]+(f[2]-c[2])*b[2];a.distance=f;a.near=f-e;a.far=f+e});this._items.sort(function(a,
c){return a.distance-c.distance})};a.prototype.forEachInDepthRange=function(a,c,b){if("front-to-back"===c)for(c=0;c<this._items.length;++c){var e=this._items.data[c];e.far<a.near||e.near>a.far||b(e.obj,e.near,e.far)}else for(c=this._items.length-1;0<=c;--c)e=this._items.data[c],e.far<a.near||e.near>a.far||b(e.obj,e.near,e.far)};return a}();var x=function(){function e(){this.view=l.mat4f64.create();this.viewProj=l.mat4f64.create();this.frustum=c.frustum.create();this.geometries=[];this.near=[];this.far=
[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}e.prototype.compute=function(a,b){var e=this;this.reset();g.mat4.copy(this.view,a.viewMatrix);g.mat4.multiply(this.viewProj,a.projectionMatrix,this.view);c.frustum.copy(a.frustum,this.frustum);a=this.view;var f=a[2],d=a[6],k=a[10],m=a[14];a=this.range;var p=0;b.forEach(function(a){if(!h.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)&&a.castShadow){var c,b;a.hasShaderTransformation?
(c=a.getBoundingSphere(a.getShaderTransformation(),1,C),b=C):(c=a.bsRadius,b=a.center);b=f*b[0]+d*b[1]+k*b[2]+m;e.geometries[p]=a;e.near[p]=-(b+c);e.far[p]=-(b-c);++p}});if(0===this.geometries.length)return a;for(b=0;b<this.geometries.length;++b)this.near[b]>a.far&&(a.far=this.near[b]),2<this.near[b]&&this.far[b]<a.near&&(a.near=this.far[b]);var l=this.looseRange;l.near=Math.max(.5*a.near,2);l.far=2*a.far;var n=0,r=0;for(b=0;b<this.geometries.length;++b)this.near[b]<a.near&&(this.near[b]>=l.near?
a.near=this.near[b]:this.nearCandidates[n++]=b),this.far[b]>a.far&&(this.far[b]<=l.far?a.far=this.far[b]:this.farCandidates[r++]=b);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return a;this.nearCandidates.sort(function(a,c){return e.near[a]<e.near[c]?-1:e.near[a]>e.near[c]?1:0});this.farCandidates.sort(function(a,c){return e.far[a]<e.far[c]?1:e.far[a]>e.far[c]?-1:0});for(b=0;b<this.nearCandidates.length;++b)l=this.nearCandidates[b],this.near[l]<a.near&&(l=this.geometries[l],n=
l.boundingInfo,this.includeNearBoundingInfoRec(n,l.getShaderTransformation()));for(b=0;b<this.farCandidates.length;++b)l=this.farCandidates[b],this.far[l]>a.far&&(l=this.geometries[l],n=l.boundingInfo,this.includeFarBoundingInfoRec(n,l.getShaderTransformation()));return a};e.prototype.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};e.prototype.includeNearBoundingInfoRec=
function(c,e){var f=c.getBSRadius(),d=c.getCenter();b.vec3.transformMat4(C,d,e);var g=a.maxScale(e),d=C[0],h=C[1],k=C[2],f=f*g,g=this.frustum.planes;if(!(g[0][0]*d+g[0][1]*h+g[0][2]*k+g[0][3]>f||g[1][0]*d+g[1][1]*h+g[1][2]*k+g[1][3]>f||g[2][0]*d+g[2][1]*h+g[2][2]*k+g[2][3]>f||g[3][0]*d+g[3][1]*h+g[3][2]*k+g[3][3]>f||(d=this.view[2]*d+this.view[6]*h+this.view[10]*k+this.view[14],h=d+f,2>-(d-f)||-h>=this.range.near)))if(-h>this.looseRange.near)this.range.near=-h;else{if(100<f&&(f=c.getChildren(),void 0!==
f)){for(c=0;8>c;++c)void 0!==f[c]&&this.includeNearBoundingInfoRec(f[c],e);return}L.unionDepthRangeWithAABB(this.range,this.viewProj,e,c.getBBMin(),c.getBBMax())}};e.prototype.includeFarBoundingInfoRec=function(c,e){var f=c.getBSRadius(),d=c.getCenter();b.vec3.transformMat4(C,d,e);var g=a.maxScale(e),d=C[0],h=C[1],k=C[2],f=f*g,g=this.frustum.planes;if(!(g[0][0]*d+g[0][1]*h+g[0][2]*k+g[0][3]>f||g[1][0]*d+g[1][1]*h+g[1][2]*k+g[1][3]>f||g[2][0]*d+g[2][1]*h+g[2][2]*k+g[2][3]>f||g[3][0]*d+g[3][1]*h+g[3][2]*
k+g[3][3]>f||(d=this.view[2]*d+this.view[6]*h+this.view[10]*k+this.view[14]-f,-d<=this.range.far)))if(-d<this.looseRange.far)this.range.far=-d;else{if(100<f&&(f=c.getChildren(),void 0!==f)){for(c=0;8>c;++c)void 0!==f[c]&&this.includeFarBoundingInfoRec(f[c],e);return}L.unionDepthRangeWithAABB(this.range,this.viewProj,e,c.getBBMin(),c.getBBMax())}};return e}();d.DepthRangeFromRenderGeometries=x;d=function(){function a(){this.modelViewProj=l.mat4f64.create();this.clipPosition=[k.vec4f64.create(),k.vec4f64.create(),
k.vec4f64.create(),k.vec4f64.create(),k.vec4f64.create(),k.vec4f64.create(),k.vec4f64.create(),k.vec4f64.create()]}a.prototype.unionDepthRangeWithAABB=function(a,c,b,e,f){var d=this.modelViewProj;g.mat4.multiply(d,c,b);c=!1;for(b=0;8>b;++b){var h=this.clipPosition[b],k=0===b||3===b||4===b||7===b?e[0]:f[0],m=0===b||1===b||4===b||5===b?e[1]:f[1],p=4>b?e[2]:f[2];h[0]=d[0]*k+d[4]*m+d[8]*p+d[12];h[1]=d[1]*k+d[5]*m+d[9]*p+d[13];h[2]=d[2]*k+d[6]*m+d[10]*p+d[14];h[3]=d[3]*k+d[7]*m+d[11]*p+d[15]}for(b=0;12>
b;++b){e=this.clipTriangle(this.clipPosition[A[b][0]],this.clipPosition[A[b][1]],this.clipPosition[A[b][2]]);f=!0;for(d=0;d<e.length;++d)if(h=e[d][3],2<=h){f=!1;break}if(!f)for(c=!0,d=0;d<e.length;++d)h=e[d][3],h<a.near&&(a.near=h),h>a.far&&(a.far=h)}return c};a.prototype.inside=function(a,c){if(0===c)return a[0]>=-a[3];if(1===c)return a[1]>=-a[3];if(2===c)return a[0]<=a[3];if(3===c)return a[1]<=a[3];n.assert(!1)};a.prototype.intersect=function(a,c,b){var f=0;0===b?f=(-a[3]-a[0])/(c[0]-a[0]+c[3]-
a[3]):1===b?f=(-a[3]-a[1])/(c[1]-a[1]+c[3]-a[3]):2===b?f=(a[3]-a[0])/(c[0]-a[0]-c[3]+a[3]):3===b&&(f=(a[3]-a[1])/(c[1]-a[1]-c[3]+a[3]));return e.vec4.lerp(k.vec4f64.create(),a,c,f)};a.prototype.clipTriangle=function(a,c,b){a=[a,c,b];for(c=0;4>c;++c){b=a;a=[];for(var e=0;e<b.length;++e){var f=b[e],d=b[(e+1)%b.length];this.inside(d,c)?(this.inside(f,c)||a.push(this.intersect(f,d,c)),a.push(d)):this.inside(f,c)&&a.push(this.intersect(f,d,c))}}return a};return a}();var A=[[0,1,3],[2,3,1],[1,5,2],[6,2,
5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],C=f.vec3f64.create(),B=l.mat4f64.create(),E=p.empty(),I=new t,G=new x,L=new d})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define("require exports ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/VertexArrayObject".split(" "),function(t,d,q,g,l,b){return function(){function f(b){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",
count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=b}f.prototype.enable=function(){if(this.isEnabled)return!0;var e=this.rctx;this.program=new g(e,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);this.pipelineState=l.makePipelineState({colorWrite:l.defaultColorWriteParams});var f=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new b(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new q(e,34962,35044,f)});return this.isEnabled=!0};f.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};f.prototype.render=function(b,f){this.enable();var c=this.rctx;c.bindVAO(this.vao);
c.bindFramebuffer(f);var a=0,e=0;null!=f?(a=f.descriptor.width,e=f.descriptor.height):(a=c.gl.canvas.width,e=c.gl.canvas.height);c.bindProgram(this.program);c.setPipelineState(this.pipelineState);c.bindTexture(b.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/a,1/e);c.drawArrays(4,0,3)};return f}()})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/HighlightPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v){return function(){function d(c,b){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=b;this.viewportToRestore=l.vec4f64.create();this.defaultOptions={color:g.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};this.blurProgram=c.getProgram(a.blurPass,
{gaussianSamples:5});this.blurGridProgram=c.getProgram(a.blurPass,{gaussianSamples:5,gridOptimization:!0});this.applyProgram=c.getProgram(a.applyPass);this.applyGridProgram=c.getProgram(a.applyPass,{gridOptimization:!0});this.applyGridDebugProgram=c.getProgram(a.applyPass,{gridOptimization:!0,gridDebug:!0});this.downsampleProgram=c.getProgram(a.downsamplePass);this.preprocessPipelineState=n.makePipelineState({colorWrite:n.defaultColorWriteParams});this.applyPipelineState=n.makePipelineState({blending:n.separateBlendingParams(770,
1,771,771),colorWrite:n.defaultColorWriteParams})}Object.defineProperty(d.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"profilingCallback",{get:function(){return b.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});d.prototype.setDefaultOptions=function(a){this.defaultOptions=a};d.prototype.render=function(a,e,f){var d=
a.pixelRatio,g=!b.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,h=b.HIGHLIGHTS_VISUALIZE_BLOCKS,k=this._rctx;c.assert(this.enabled);q.vec4.copy(this.viewportToRestore,a.fullViewport);var m=Math.ceil(a.fullWidth/d);a=Math.ceil(a.fullHeight/d);this.blur0Fbo.resize(m,a);this.blur1Fbo.resize(m,a);k.bindVAO(this.quadVAO);k.setPipelineState(this.preprocessPipelineState);var p=null,l=d=p=null;if(g){var n=this._grid;this._gridUpdateResources(e,32);this._gridComputeMipmap();d=n.vao;l=4;p=this.blurGridProgram;k.bindProgram(p);
k.bindTexture(n.coverageMipmap[n.mipmapLevels].colorTexture,1);p.setUniform1i("coverageTex",1)}else d=this.quadVAO,l=5,p=this.blurProgram,k.bindProgram(p);k.bindVAO(d);k.bindFramebuffer(this.blur0Fbo);k.setViewport(0,0,m,a);k.setClearColor(0,0,0,0);k.clear(16384);p.setUniform1i("tex",0);k.bindTexture(e.colorTexture,0);p.setUniform2f("blurSize",1/m,0);k.drawArrays(l,0,u.vertexCount(d,"geometry"));k.bindFramebuffer(this.blur1Fbo);k.clear(16384);k.bindTexture(this.blur0Fbo.colorTexture,0);p.setUniform2f("blurSize",
0,1/a);k.drawArrays(l,0,u.vertexCount(d,"geometry"));k.bindFramebuffer(f);k.setPipelineState(this.applyPipelineState);k.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);g?(p=h?this.applyGridDebugProgram:this.applyGridProgram,k.bindProgram(p),p.setUniform1i("coverageTex",2),k.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(p=this.applyProgram,k.bindProgram(p));p.setUniform1i("tex",0);k.bindTexture(this.blur1Fbo.colorTexture,
0);p.setUniform1i("origin",1);k.bindTexture(e.colorTexture,1);p.setUniform4fv("color",this.defaultOptions.color);p.setUniform1f("outlineSize",8.6);p.setUniform1f("blurSize",.4);p.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);k.drawArrays(l,0,u.vertexCount(d,"geometry"));k.bindVAO(null)};d.prototype.enable=function(){if(!this.enabled){this.quadVAO=k.createQuadVAO(this._rctx);
var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},c={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=p.createWithAttachments(this._rctx,c,a);this.blur1Fbo=p.createWithAttachments(this._rctx,c,a)}};d.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};d.prototype._gridUpdateResources=function(a,c){var b=this._rctx,d=this._grid,
g=!1;null===d.coverageMipmap&&(d.coverageMipmap=[a],g=!0);if(d.viewportWidth!==a.width||d.viewportHeight!==a.height)g=!0,d.viewportWidth=a.width,d.viewportHeight=a.height;d.coverageMipmap[0]=a;d.cellPixelSize!==c&&(d.cellPixelSize=c,g=!0);if(g){for(c=1;c<d.coverageMipmap.length;c++)d.coverageMipmap[c].dispose();d.mipmapLevels=Math.ceil(Math.log(d.cellPixelSize)*Math.LOG2E);d.coverageMipmap.length=d.mipmapLevels+1;for(c=0;c<d.mipmapLevels;c++)g=d.coverageMipmap[c],g=p.createWithAttachments(b,{target:3553,
pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(g.width/2),height:Math.ceil(g.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(g.width/2),height:Math.ceil(g.height/2)}),d.coverageMipmap[c+1]=g}var g=Math.ceil(a.height/d.cellPixelSize),k=Math.ceil(a.width/d.cellPixelSize);if(!d.vao||d.verticalCellCount!==g||d.horizontalCellCount!==k){d.verticalCellCount=g;d.horizontalCellCount=k;a=g+1;c=k+1;for(var g=1/g,k=1/k,l=new Float32Array(24*a*c),n=0,r=0;r<a;r++)for(var u=
0;u<c;u++)l[n+0]=(u-.5)*k*2-1,l[n+1]=(r-.5)*g*2-1,l[n+2]=u*k,l[n+3]=r*g,l[n+4]=(u+.5)*k*2-1,l[n+5]=(r-.5)*g*2-1,l[n+6]=u*k,l[n+7]=r*g,l[n+8]=(u-.5)*k*2-1,l[n+9]=(r+.5)*g*2-1,l[n+10]=u*k,l[n+11]=r*g,l[n+12]=(u-.5)*k*2-1,l[n+13]=(r+.5)*g*2-1,l[n+14]=u*k,l[n+15]=r*g,l[n+16]=(u+.5)*k*2-1,l[n+17]=(r-.5)*g*2-1,l[n+18]=u*k,l[n+19]=r*g,l[n+20]=(u+.5)*k*2-1,l[n+21]=(r+.5)*g*2-1,l[n+22]=u*k,l[n+23]=r*g,n+=24;d.vao&&d.vao.dispose(!0);d.vao=new v(b,f.Default3D,{geometry:e.Pos2Tex},{geometry:h.createVertex(b,
35044,l)})}};d.prototype._gridComputeMipmap=function(){var a=this._rctx,c=this._grid,b=this.downsampleProgram;a.bindVAO(this.quadVAO);for(var e=0;e<c.mipmapLevels;e++){a.bindFramebuffer(c.coverageMipmap[e+1]);a.bindTexture(c.coverageMipmap[e].colorTexture,0);var f=c.coverageMipmap[e+1].width,d=c.coverageMipmap[e+1].height;a.bindProgram(b);b.setUniform1i("tex",0);b.setUniform2f("invFramebufferDim",1/f,1/d);a.setViewport(0,0,f,d);a.drawArrays(5,0,u.vertexCount(this.quadVAO,"geometry"))}};d.prototype.getGpuMemoryUsage=
function(){var a=u.getGpuMemoryUsage(this.blur0Fbo)+u.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(var c=0,b=this._grid.coverageMipmap;c<b.length;c++)a+=u.getGpuMemoryUsage(b[c]);return a};return d}()})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["require","exports","./factories/vec4f32"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.vec4f32=q})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["require","exports"],
function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.create=function(){return new Float32Array(4)};d.clone=function(d){var g=new Float32Array(4);g[0]=d[0];g[1]=d[1];g[2]=d[2];g[3]=d[3];return g};d.fromValues=function(d,g,l,b){var f=new Float32Array(4);f[0]=d;f[1]=g;f[2]=l;f[3]=b;return f};d.createView=function(d,g){return new Float32Array(d,g,4)}})},"esri/views/3d/webgl-engine/shaders/HighlightPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver",
"../../../webgl/programUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=function(b){return l.glslifyDefineMap({GRID_OPTIMIZATION:b.gridOptimization,GAUSSIAN_SAMPLES:b.gaussianSamples})},f=function(b){return l.glslifyDefineMap({GRID_OPTIMIZATION:b.gridOptimization,GRID_DEBUG:b.gridDebug})};d.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:g.resolveIncludes("renderer/highlight/downsample.vert"),fragmentShader:g.resolveIncludes("renderer/highlight/downsample.frag")},
attributes:q.Default3D};d.blurPass={name:"highlight-blur",shaders:function(e){return{vertexShader:b(e)+g.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:b(e)+g.resolveIncludes("renderer/highlight/blur.frag")}},attributes:q.Default3D};d.applyPass={name:"highlight-apply",shaders:function(b){return{vertexShader:f(b)+g.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:f(b)+g.resolveIncludes("renderer/highlight/apply.frag")}},attributes:q.Default3D}})},"esri/views/webgl/FramebufferObject":function(){define(["require",
"exports","../../core/has","./Renderbuffer","./Texture"],function(t,d,q,g,l){return function(){function b(f,e,d,c){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=f;this._desc={colorTarget:e.colorTarget,depthStencilTarget:e.depthStencilTarget,width:e.width,height:e.height,multisampled:e.multisampled};this._id=b._nextId++;d&&(f=void 0,d instanceof l?(this._colorAttachment=d,f=d.descriptor):(f=d,this._colorAttachment=
new l(this._context,f)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),b._validateTextureDimensions(f,this._desc));c instanceof g?(2===e.depthStencilTarget?this._stencilAttachment=c:1===e.depthStencilTarget||3===e.depthStencilTarget?this._depthAttachment=c:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),
b._validateBufferDimensions(c.descriptor,this._desc)):c&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),e=void 0,c instanceof l?(this._depthStencilTexture=c,e=this._depthStencilTexture.descriptor):(e=c,this._depthStencilTexture=new l(this._context,e)),b._validateTextureDimensions(e,this._desc))}b.create=function(f,e){return new b(f,e)};b.createWithAttachments=function(f,
e,d,c){return new b(f,d,e,c)};Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof l?this._colorAttachment:null},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"colorAttachment",{get:function(){return this._colorAttachment},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"depthStencilAttachment",{get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});b.prototype.dispose=function(){if(this._context){var b=this._context,e=b.getBoundFramebufferObject();this._disposeColorAttachment();this._disposeDepthStencilAttachments();this._glName&&(b.gl.deleteFramebuffer(this._glName),this._glName=null);b.bindFramebuffer(e);this._context=null}};b.prototype.attachColorTexture=
function(f){if(f){b._validateTextureDimensions(f.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var e=this._context.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,f.glName,0)}this._colorAttachment=f}};b.prototype.detachColorTexture=function(){var b=void 0;if(this._colorAttachment instanceof l){b=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var e=this._context.gl;this._context.gl.framebufferTexture2D(e.FRAMEBUFFER,
e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}this._colorAttachment=null}return b};b.prototype.attachDepthStencilTexture=function(f){if(f){var e=f.descriptor;34041!==e.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==e.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
b._validateTextureDimensions(e,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),e=this._context.gl,e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,f.glName,0));this._depthStencilTexture=f}};b.prototype.detachDepthStencilTexture=function(){var b=this._depthStencilTexture;if(b&&this._initialized){this._context.bindFramebuffer(this);var e=this._context.gl;
this._context.gl.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return b};b.prototype.attachDepthStencilBuffer=function(f){if(f){var e=f.descriptor;34041!==e.internalFormat&&33189!==e.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");b._validateBufferDimensions(e,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===e.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),
e=this._context.gl,e.framebufferRenderbuffer(e.FRAMEBUFFER,1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,f.glName));this._depthAttachment=f}};b.prototype.detachDepthStencilBuffer=function(){var b=this._context.gl,e=this._depthAttachment;e&&this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,1===this._desc.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,null));this._depthAttachment=
null;return e};b.prototype.copyToTexture=function(b,e,d,c,a,g,p){(0>b||0>e||0>a||0>g)&&console.error("Offsets cannot be negative!");(0>=d||0>=c)&&console.error("Copy width and height must be greater than zero!");var f=this._desc,h=p.descriptor;3553!==p.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(b+d>f.width||e+c>f.height||a+d>h.width||g+c>h.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");f=this._context;f.bindTexture(p);
f.bindFramebuffer(this);f.gl.copyTexSubImage2D(3553,0,a,g,b,e,d,c)};b.prototype.readPixels=function(b,e,d,c,a,g,p){(0>=d||0>=c)&&console.error("Copy width and height must be greater than zero!");p||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(b,e,d,c,a,g,p)};b.prototype.resize=function(f,e){var d=this._desc;if(d.width!==f||d.height!==e)if(this._initialized)d.width=f,d.height=e,this._colorAttachment instanceof l?(c=this._colorAttachment,
d=c.descriptor,d.width=f,d.height=e,this._colorAttachment.dispose(),this._colorAttachment=new l(this._context,d),b._validateTextureDimensions(c.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(d=this._depthStencilTexture.descriptor,d.width=f,d.height=e,this._depthStencilTexture.dispose(),this._depthStencilTexture=new l(this._context,d)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===
this&&this._context.bindFramebuffer(null),this._initialized=!1;else{d.width=f;d.height=e;if(this._colorAttachment instanceof l){var c=this._colorAttachment;c.resize(f,e)}this._depthStencilTexture&&this._depthStencilTexture.resize(f,e)}};b.prototype.initialize=function(){if(this._initialized)return!1;var b=this._context.gl;this._glName&&b.deleteFramebuffer(this._glName);var e=b.createFramebuffer(),d=this._desc;b.bindFramebuffer(b.FRAMEBUFFER,e);if(!this._colorAttachment)if(0===d.colorTarget)this._colorAttachment=
new l(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:d.width,height:d.height});else{var c=new g(this._context,{internalFormat:32854,width:d.width,height:d.height});b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,c.glName);this._colorAttachment=c}this._colorAttachment instanceof l&&b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this._colorAttachment.glName,0);switch(d.depthStencilTarget){case 1:case 3:this._depthAttachment||
(this._depthAttachment=new g(this._context,{internalFormat:1===d.depthStencilTarget?33189:34041,width:d.width,height:d.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,1===d.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new g(this._context,{internalFormat:36168,width:d.width,height:d.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,this._stencilAttachment.glName);
break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new l(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:d.width,height:d.height})),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,this._depthStencilTexture.glName,0)}b.checkFramebufferStatus(b.FRAMEBUFFER)!==
b.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=e;return this._initialized=!0};b.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof l){var b=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var e=this._context.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}b.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(b=this._colorAttachment,e=this._context.gl,this._initialized&&
(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(b));this._colorAttachment=null};b.prototype._disposeDepthStencilAttachments=function(){var b=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,1===this._desc.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,null)),this._depthAttachment.dispose(),
this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};b._validateBufferDimensions=
function(b,e){console.assert(0<=b.width&&0<=b.height);void 0!==e.width&&0<=e.width&&void 0!==e.height&&0<=e.height?e.width===b.width&&e.height===b.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(e.width=b.width,e.height=b.height)};b._validateTextureDimensions=function(b,e){console.assert(0<=b.width&&0<=b.height);3553!==b.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==e.width&&0<=e.width&&void 0!==e.height&&0<=e.height?e.width===b.width&&e.height===
b.height||console.error("Color attachment texture must match the framebuffer's!"):(e.width=b.width,e.height=b.height)};b._nextId=0;return b}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/has"],function(t,d,q){return function(){function d(g,b){this._context=g;this._desc=b;this._glName=null;this._id=-1;g=this._context.gl;this._id=++d._nextId;this._glName=g.createRenderbuffer();this._context.bindRenderbuffer(this);g.renderbufferStorage(g.RENDERBUFFER,b.internalFormat,
b.width,b.height)}Object.defineProperty(d.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});d.prototype.resize=function(d,b){var f=this._context.gl,e=this._desc;if(e.width!==d||e.height!==b)e.width=d,e.height=b,this._context.bindRenderbuffer(this),
f.renderbufferStorage(f.RENDERBUFFER,e.internalFormat,e.width,e.height)};d.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context=null};d._nextId=0;return d}()})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports ./glUtil3D ./RenderTargetHelper ./Util ../shaders/OffscreenPrograms ../../../webgl/renderState ../../../webgl/Util".split(" "),function(t,d,q,g,l,b,f,e){var k=[0,0,0,0],c=[0,
1,0,1];return function(){function a(a,c){this.dimensions={width:4,height:4};this._enabled=!1;this._background={type:"color",color:[0,0,0,1]};this._compositePipelineState=new Map;this._rctx=c;c=this.renderTargetHelper=new g.RenderTargetHelper(c);this.mainColor=c.registerColorTarget({name:"mainColor"});this.mainDepth=c.registerDepthTarget({name:"mainDepth"});this.linearDepth=c.registerColorTarget({name:"linearDepth"});this.normal=c.registerColorTarget({name:"normal"});this.highlight=c.registerColorTarget({name:"highlight",
dataType:32819});this.hudVisibility=c.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=c.registerColorTarget({name:"tmpColor"});this.tmpDepth=c.registerDepthTarget({name:"tmpDepth"});this._compositeProgram=a.getProgram(b.composite);this._compositePipelineState.set("none",f.makePipelineState({colorWrite:f.defaultColorWriteParams}));this._compositePipelineState.set("alpha",f.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),colorWrite:f.defaultColorWriteParams}));
this._compositePipelineState.set("premultiplied-alpha",f.makePipelineState({blending:f.simpleBlendingParams(1,771),colorWrite:f.defaultColorWriteParams}));this._compositeTransparentToHUDVisibilityProgram=a.getProgram(b.compositeTransparentToHUDVisibility);this._compositeTransparentToHUDVisibilityPipelineState=f.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});this._compositeOccludedProgram=a.getProgram(b.compositeOccluded);this._compositeOccludedPipelineState=f.makePipelineState({blending:f.simpleBlendingParams(1,
771),colorWrite:f.defaultColorWriteParams})}Object.defineProperty(a.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"background",{get:function(){return this._background},
set:function(a){this._background=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthTexture",{get:function(){return this.framebuffer.depthStencilTexture},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"highlightTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tmpColorTexture",{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!0,configurable:!0});a.prototype.initializeFrame=function(a,c){l.assert(this.enabled);var b=this._rctx;this.dimensions.width=a.fullWidth;this.dimensions.height=a.fullHeight;this.outputFramebuffer=
c;this.bindTarget(this.mainColor,this.mainDepth);b.setClearStencil(0);a=this._background.color;b.setClearColor(a[0]*a[3],a[1]*a[3],a[2]*a[3],a[3]);b.clearSafe(17664)};a.prototype.renderSeparateAndComposite=function(a,c,b){void 0===c&&(c=k);void 0===b&&(b="none");this.renderToTargets(a,this.tmpColor,this.mainDepth,c);this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,b)};a.prototype.renderHUDVisibility=function(a){this.renderToTargets(a,this.hudVisibility,this.mainDepth,c)};a.prototype.compositeTransparentTerrainOntoHUDVisibility=
function(){var a=this,c=this._rctx;this.renderToTargets(function(){var b=a._compositeTransparentToHUDVisibilityProgram;c.bindProgram(b);c.setPipelineState(a._compositeTransparentToHUDVisibilityPipelineState);b.setUniform1i("tex",1);c.bindTexture(a.getColorTexture(a.tmpColor),1);c.bindVAO(a.quadVAO);c.drawArrays(5,0,e.vertexCount(a.quadVAO,"geometry"))},this.hudVisibility,this.mainDepth)};a.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),
this.framebuffer,"premultiplied-alpha")};a.prototype.compositeOccludedOntoMain=function(a){var c=this._rctx,b=this._compositeOccludedProgram;this.bindFramebuffer();c.bindProgram(b);c.setPipelineState(this._compositeOccludedPipelineState);c.bindVAO(this.quadVAO);c.bindTexture(this.getColorTexture(this.tmpColor),0);b.setUniform1i("occludedColorMap",0);b.setUniform1f("opacity",a);c.drawArrays(5,0,e.vertexCount(this.quadVAO,"geometry"));c.bindVAO(null)};a.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};
a.prototype.renderDepthDetached=function(a){var c=this.bindTarget(this.mainColor);a(c);this.bindTarget(this.mainColor,this.mainDepth)};a.prototype.composite=function(a,c,b){void 0===a&&(a=this.framebuffer.colorTexture);void 0===c&&(c=this.outputFramebuffer);void 0===b&&(b="none");var f=this._rctx,d=this._compositeProgram;f.bindFramebuffer(c);f.bindProgram(d);f.setPipelineState(this._compositePipelineState.get(b));d.setUniform1i("tex",1);f.bindTexture(a,1);f.bindVAO(this.quadVAO);f.drawArrays(5,0,
e.vertexCount(this.quadVAO,"geometry"))};a.prototype.disposeTarget=function(a){this.renderTargetHelper.disposeTargetResource(a)};a.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=q.createQuadVAO(this._rctx))};a.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)};a.prototype.renderToTargets=function(a,c,b,e,f){var d=this._rctx;c=this.bindTarget(c,b);b=0;e&&(d.setClearColor(e[0],
e[1],e[2],Math.max(1E-13,e[3])),b|=16384);f&&(b|=256);d.clearSafe(b);a(c);d.gl.flush();this.bindTarget(this.mainColor,this.mainDepth);return c};a.prototype.bindTarget=function(a,c){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,c);this._rctx.bindFramebuffer(a);return a};a.prototype.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,this.dimensions)};a.prototype.getGpuMemoryUsage=function(){var a=0;this.renderTargetHelper&&(a+=this.renderTargetHelper.getGpuMemoryUsage());
return a};return a}()})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});var e={dataType:5121},k={};t=function(){function c(a){this.rctx=a;this.activeTargets=new Set;this.depthTextures=new Map;this.depthBuffers=new Map;this.colorTextures=
new Map;this.framebuffers=new Map;this.nextId=1;this.depthTextureSupported=a.capabilities.depthTexture}c.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(a){return a.dispose()});this.depthBuffers.clear();this.depthTextures.forEach(function(a){return a.dispose()});this.depthTextures.clear();this.colorTextures.forEach(function(a){return a.dispose()});this.colorTextures.clear()};c.prototype.disposeTargetResource=function(a){a=a.id;this.activeTargets.has(a)&&(this.activeTargets.delete(a),
this.depthTextures.has(a)&&(this.depthTextures.get(a).dispose(),this.depthTextures.delete(a)),this.depthBuffers.has(a)&&(this.depthBuffers.get(a).dispose(),this.depthBuffers.delete(a)),this.colorTextures.has(a)&&(this.colorTextures.get(a).dispose(),this.colorTextures.delete(a)))};c.prototype.getDepthTexture=function(a,c){if(this.depthTextureSupported){var e=this.depthTextures.get(a.id);!e||e.descriptor.width===c.width&&e.descriptor.height===c.height||(e.dispose(),e=void 0);e||(e=new b(this.rctx,{target:3553,
pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:c.width,height:c.height}),this.depthTextures.set(a.id,e),this.activeTargets.add(a.id));return e}};c.prototype.getDepthBuffer=function(a,c){if(!this.depthTextureSupported){var b=this.depthBuffers.get(a.id);b?b.descriptor.width===c.width&&b.descriptor.height===c.height||b.resize(c.width,c.height):(b=new l(this.rctx,q({internalFormat:34041},c)),this.depthBuffers.set(a.id,b),this.activeTargets.add(a.id));return b}};c.prototype.getColorTexture=
function(a,c){var e=this.colorTextures.get(a.id);!e||e.descriptor.width===c.width&&e.descriptor.height===c.height||(e.dispose(),e=void 0);e||(e=new b(this.rctx,{target:3553,pixelFormat:6408,dataType:a.dataType,samplingMode:9729,wrapMode:33071,width:c.width,height:c.height}),this.colorTextures.set(a.id,e),this.activeTargets.add(a.id));return e};c.prototype.getAllocatedColorTexture=function(a){return this.colorTextures.get(a.id)};c.prototype.registerDepthTarget=function(a){void 0===a&&(a={});var c=
this.nextId++;return q({id:c},k,a)};c.prototype.registerColorTarget=function(a){void 0===a&&(a={});var c=this.nextId++;return q({id:c},e,a)};c.prototype.getFramebuffer=function(a,c,b){var e=this.getKey(c,b),f=this.framebuffers.get(e);c=this.getColorTexture(c,a);if(this.depthTextureSupported){var d=b?this.getDepthTexture(b,a):void 0;if(!f)return f=b?g.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:4},d):g.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:0}),
this.framebuffers.set(e,f),f;if(b=f.width!==a.width||f.height!==a.height||f.colorTexture!==c||f.depthStencilTexture!==d)f.detachColorTexture(),f.detachDepthStencilTexture(),f.resize(a.width,a.height),f.attachColorTexture(c),f.attachDepthStencilTexture(d);return f}d=b?this.getDepthBuffer(b,a):void 0;if(!f)return f=g.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:b?3:0},d),this.framebuffers.set(e,f),f;if(b=f.width!==a.width||f.height!==a.height||f.colorTexture!==c)f.detachColorTexture(),
f.detachDepthStencilBuffer(),f.resize(a.width,a.height),f.attachColorTexture(c),f.attachDepthStencilBuffer(d);return f};c.prototype.getKey=function(a,c){return a.id+"_"+(c?c.id:"X")+"_"+a.name+(c?"_"+c.name:"")};c.prototype.getGpuMemoryUsage=function(){var a=0,c=new Set,b=function(b){c.has(b)||(c.add(b),a+=f.getGpuMemoryUsage(b))};this.depthTextures.forEach(b);this.colorTextures.forEach(b);this.depthBuffers.forEach(b);this.framebuffers.forEach(b);return a};return c}();d.RenderTargetHelper=t})},"esri/views/3d/webgl-engine/shaders/OffscreenPrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.composite={name:"offscreen-composite",shaders:{vertexShader:g.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:g.resolveIncludes("renderer/offscreen/composite.frag")},attributes:q.Default3D};d.compositeTransparentToHUDVisibility={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:g.resolveIncludes("renderer/offscreen/offscreen.vert"),
fragmentShader:g.resolveIncludes("renderer/offscreen/compositeTransparentToHUDVisibility.frag")},attributes:q.Default3D};d.compositeOccluded={name:"offscreen-composite-occluded",shaders:{vertexShader:g.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:g.resolveIncludes("renderer/offscreen/compositeOccluded.frag")},attributes:q.Default3D}})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports"],function(t,d){return function(){function d(d,l,b,f,e,
k){this.camera=null;this.slot=this.pass=0;this.options=null;this.renderOccludedMask=5;this.rctx=d;this.offscreenRenderingHelper=l;this.lightingData=b;this.shadowMap=f;this.ssaoHelper=e;this.sliceHelper=k}d.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=5};Object.defineProperty(d.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0});return d}()})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["require","exports",
"./depthRange"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(b){this.pluginContext=b;this.pluginsChanged=!1;this.renderPlugins=[];this.slots=[];for(b=0;19>b;++b)this.slots[b]=[]}d.prototype.add=function(b,f){this.renderPlugins.push(f);for(var e=0;e<b.length;++e)this.slots[b[e]].push(f);f.initializeRenderContext(this.pluginContext);this.pluginsChanged=!0};d.prototype.remove=function(b){this.renderPlugins=this.renderPlugins.filter(function(e){return e!==b});
for(var f=0;f<this.slots.length;++f)this.slots[f]=this.slots[f].filter(function(e){return e!==b});b.uninitializeRenderContext(this.pluginContext);this.pluginsChanged=!0};d.prototype.prepareRender=function(b){for(var f=0,e=this.renderPlugins;f<e.length;f++){var d=e[f];d.prepareRender&&d.prepareRender(b)}};d.prototype.render=function(b,f){f.slot=b;var e=!1,d=0;for(b=this.slots[b];d<b.length;d++){var c=b[d];c.render(f)&&(e=c.didRender=!0)}return e};d.prototype.queryDepthRange=function(b){var f=g;f.near=
Infinity;f.far=-Infinity;for(var e=0,d=this.renderPlugins;e<d.length;e++){var c=d[e];c.queryDepthRange&&(c=c.queryDepthRange(b))&&q.union(f,c,f)}return f};d.prototype.needsRender=function(){if(this.pluginsChanged)return!0;for(var b=0,f=this.renderPlugins;b<f.length;b++)if(f[b].needsRender)return!0;return!1};d.prototype.needsHighlight=function(){for(var b=0,f=this.renderPlugins;b<f.length;b++)if(f[b].needsHighlight)return!0;return!1};d.prototype.needsLinearDepth=function(){for(var b=0,f=this.renderPlugins;b<
f.length;b++)if(f[b].needsLinearDepth)return!0;return!1};d.prototype.resetNeedsRender=function(){this.pluginsChanged=!1;for(var b=0,f=this.renderPlugins;b<f.length;b++){var e=f[b];e.resetNeedsRender?e.resetNeedsRender():e.didRender&&(e.needsRender=!1,e.didRender=!1)}};return d}();d.RenderPluginManager=t;var g={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/mathUtils ./Camera ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y){function w(a,c){b.vec2.set(ka,a[c],a[c+3]);return ka}var m=function(){return function(){this.camera=new p;this.lightMat=l.mat4f64.create()}}();t=function(){function a(a){this.doShadowMapMipmapsWork=!1;this.textureRes=4096;this.numCascades=1;this.maxNumCascades=2;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.rctx=a;this.emptyTexture=n.createEmptyTexture(a);for(a=0;4>a;++a)this.cascades.push(new m)}a.prototype.dispose=function(){this.emptyTexture.dispose();
this.emptyTexture=null};Object.defineProperty(a.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(a){this.textureRes=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(a){this.maxNumCascades=h.clamp(Math.floor(a),1,4)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(a){a?this.enable():this.disable()},
enumerable:!0,configurable:!0});a.prototype.getDepthTexture=function(){return this.depthTexture};a.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)U[a]=this.cascades[a];U.length=this.numCascades;return U};a.prototype.prepare=function(a,f,d){u.assert(this.enabled);g.mat4.multiply(A,a.projectionMatrix,a.viewMatrix);var k=d.near,m=d.far;2>k&&(k=2);2>m&&(m=2);k>=m&&(k=2,m=4);this.numCascades=Math.min(1+Math.floor(u.logWithBase(m/k,4)),this.maxNumCascades);var l=Math.pow(m/k,1/this.numCascades);
for(d=0;d<this.numCascades+1;++d)this.cascadeDistances[d]=k*Math.pow(l,d);g.mat4.invert(C,A);g.mat4.lookAt(P,[0,0,0],[-f[0],-f[1],-f[2]],[0,1,0]);l=a.viewMatrix;a=a.projectionMatrix;for(d=0;d<this.numCascades;++d){var p=this.cascades[d],m=-this.cascadeDistances[d],k=-this.cascadeDistances[d+1],m=(a[10]*m+a[14])/Math.abs(a[11]*m+a[15]),k=(a[10]*k+a[14])/Math.abs(a[11]*k+a[15]);u.assert(m<k);for(var n=0;8>n;++n){c.vec4.set(B,0===n%4||3===n%4?-1:1,0===n%4||1===n%4?-1:1,4>n?m:k,1);c.vec4.transformMat4(E[n],
B,C);for(var r=0;3>r;++r)E[n][r]/=E[n][3]}e.vec3.negate(O,E[0]);g.mat4.translate(x,P,O);p.camera.viewMatrix=x;for(n=0;8>n;++n)e.vec3.transformMat4(E[n],E[n],p.camera.viewMatrix);e.vec3.copy(I,E[0]);e.vec3.copy(G,E[0]);for(n=1;8>n;++n)for(r=0;3>r;++r)I[r]=Math.min(I[r],E[n][r]),G[r]=Math.max(G[r],E[n][r]);I[2]-=200;G[2]+=200;p.camera.near=-G[2];p.camera.far=-I[2];k=1/E[0][3];m=1/E[4][3];u.assert(k<m);var r=k+Math.sqrt(k*m),n=Math.sin(h.acos(l[2]*f[0]+l[6]*f[1]+l[10]*f[2])),r=r/n,k=E,v=r,y=n,n=L,q=
F,t=K,V=M,r=Q;b.vec2.set(X,0,0);for(var N=0;4>N;++N)b.vec2.add(X,X,k[N]);b.vec2.scale(X,X,.25);b.vec2.set(J,0,0);for(N=4;8>N;++N)b.vec2.add(J,J,k[N]);b.vec2.scale(J,J,.25);b.vec2.lerp(R[0],k[4],k[5],.5);b.vec2.lerp(R[1],k[5],k[6],.5);b.vec2.lerp(R[2],k[6],k[7],.5);b.vec2.lerp(R[3],k[7],k[4],.5);for(var U=0,ha=b.vec2.squaredDistance(R[0],X),N=1;4>N;++N){var ma=b.vec2.squaredDistance(R[N],X);ma<ha&&(ha=ma,U=N)}b.vec2.subtract(T,R[U],k[U+4]);N=T[0];T[0]=-T[1];T[1]=N;b.vec2.subtract(W,J,X);b.vec2.lerp(T,
T,W,y);b.vec2.normalize(T,T);U=y=void 0;y=U=b.vec2.dot(b.vec2.subtract(Z,k[0],X),T);for(N=1;8>N;++N)ha=b.vec2.dot(b.vec2.subtract(Z,k[N],X),T),ha<y?y=ha:ha>U&&(U=ha);b.vec2.copy(n,X);b.vec2.scale(Z,T,y-v);b.vec2.add(n,n,Z);for(var ma=-1,aa=1,N=v=ha=0;8>N;++N){b.vec2.subtract(fa,k[N],n);b.vec2.normalize(fa,fa);var ka=T[0]*fa[1]-T[1]*fa[0];0<ka?ka>ma&&(ma=ka,ha=N):ka<aa&&(aa=ka,v=N)}u.verify(0<ma,"leftArea");u.verify(0>aa,"rightArea");b.vec2.scale(ga,T,y);b.vec2.add(ga,ga,X);b.vec2.scale(ja,T,U);b.vec2.add(ja,
ja,X);ia[0]=-T[1];ia[1]=T[0];q=u.rayRay2D(n,k[v],ja,b.vec2.add(Z,ja,ia),1,q);t=u.rayRay2D(n,k[ha],ja,Z,1,t);V=u.rayRay2D(n,k[ha],ga,b.vec2.add(Z,ga,ia),1,V);k=u.rayRay2D(n,k[v],ga,Z,1,r);u.verify(q,"rayRay");u.verify(t,"rayRay");u.verify(V,"rayRay");u.verify(k,"rayRay");t=L;k=F;n=M;V=Q;r=p.camera.projectionMatrix;b.vec2.subtract(da,n,V);b.vec2.scale(da,da,.5);Y[0]=da[0];Y[1]=da[1];Y[2]=0;Y[3]=da[1];Y[4]=-da[0];Y[5]=0;Y[6]=da[0]*da[0]+da[1]*da[1];Y[7]=da[0]*da[1]-da[1]*da[0];Y[8]=1;Y[6]=-b.vec2.dot(w(Y,
0),t);Y[7]=-b.vec2.dot(w(Y,1),t);t=b.vec2.dot(w(Y,0),n)+Y[6];q=b.vec2.dot(w(Y,1),n)+Y[7];N=b.vec2.dot(w(Y,0),V)+Y[6];V=b.vec2.dot(w(Y,1),V)+Y[7];t=-(t+N)/(q+V);Y[0]+=Y[1]*t;Y[3]+=Y[4]*t;Y[6]+=Y[7]*t;t=1/(b.vec2.dot(w(Y,0),n)+Y[6]);q=1/(b.vec2.dot(w(Y,1),n)+Y[7]);Y[0]*=t;Y[3]*=t;Y[6]*=t;Y[1]*=q;Y[4]*=q;Y[7]*=q;Y[2]=Y[1];Y[5]=Y[4];Y[8]=Y[7];Y[7]+=1;t=b.vec2.dot(w(Y,1),k)+Y[7];q=b.vec2.dot(w(Y,2),k)+Y[8];N=b.vec2.dot(w(Y,1),n)+Y[7];V=b.vec2.dot(w(Y,2),n)+Y[8];t=-.5*(t/q+N/V);Y[1]+=Y[2]*t;Y[4]+=Y[5]*
t;Y[7]+=Y[8]*t;t=b.vec2.dot(w(Y,1),k)+Y[7];q=b.vec2.dot(w(Y,2),k)+Y[8];N=-q/t;Y[1]*=N;Y[4]*=N;Y[7]*=N;r[0]=Y[0];r[1]=Y[1];r[2]=0;r[3]=Y[2];r[4]=Y[3];r[5]=Y[4];r[6]=0;r[7]=Y[5];r[8]=0;r[9]=0;r[10]=1;r[11]=0;r[12]=Y[6];r[13]=Y[7];r[14]=0;r[15]=Y[8];p.camera.projectionMatrix[10]=2/(I[2]-G[2]);p.camera.projectionMatrix[14]=-(I[2]+G[2])/(I[2]-G[2]);g.mat4.multiply(p.lightMat,p.camera.projectionMatrix,p.camera.viewMatrix);k=this.textureRes/2;p.camera.viewport[0]=0===d%2?0:k;p.camera.viewport[1]=0===Math.floor(d/
2)?0:k;p.camera.viewport[2]=k;p.camera.viewport[3]=k}this.lastOrigin=null;this.cascadeDistances[this.numCascades]=100*m;f=this.rctx;f.bindFramebuffer(this.fbo);f.bindTexture(null,7);f.setClearColor(1,1,1,1);f.clearSafe(16640)};a.prototype.finish=function(a){u.assert(this.enabled);this.rctx.bindFramebuffer(a);this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()};a.prototype.bind=function(a){var c=this.rctx,b=this.enabled;c.bindTexture(b?this.depthTexture:this.emptyTexture,7);c.bindProgram(a);
a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",b?.5/this.textureRes:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])};a.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var c=0;c<a.length;c++)this.bind(a[c])};a.prototype.bindView=function(a,c){if(this.enabled){var b=this.lastOrigin;if(!b||b[0]!==c[0]||b[1]!==c[1]||
b[2]!==c[2])for(this.lastOrigin=this.lastOrigin||k.vec3f64.create(),e.vec3.copy(this.lastOrigin,c),b=0;b<this.numCascades;++b){g.mat4.translate(N,this.cascades[b].lightMat,c);for(var f=0;16>f;++f)V[16*b+f]=N[f]}a.setUniformMatrix4fv("shadowMapMatrix",V)}};a.prototype.enable=function(){this.enabled||(this.depthTexture=new r(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureRes,height:this.textureRes}),this.fbo=v.createWithAttachments(this.rctx,
this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes}))};a.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.depthTexture=this.fbo=null)};a.prototype.getGpuMemoryUsage=function(){return y.getGpuMemoryUsage(this.fbo)};return a}();var x=l.mat4f64.create(),A=l.mat4f64.create(),C=l.mat4f64.create(),B=a.vec4f64.create(),E=[];for(d=0;8>d;++d)E.push(a.vec4f64.create());var I=k.vec3f64.create(),G=k.vec3f64.create(),L=f.vec2f64.create(),
F=f.vec2f64.create(),K=f.vec2f64.create(),M=f.vec2f64.create(),Q=f.vec2f64.create(),P=l.mat4f64.create(),O=k.vec3f64.create(),U=[],N=l.mat4f64.create(),V=new Float32Array(64),X=f.vec2f64.create(),J=f.vec2f64.create(),R=[f.vec2f64.create(),f.vec2f64.create(),f.vec2f64.create(),f.vec2f64.create()],T=f.vec2f64.create(),W=f.vec2f64.create(),Z=f.vec2f64.create(),fa=f.vec2f64.create(),ga=f.vec2f64.create(),ja=f.vec2f64.create(),ia=f.vec2f64.create(),ka=f.vec2f64.create(),da=f.vec2f64.create(),Y=q.mat3f64.create();
return t})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["require","exports","../../support/geometryUtils"],function(t,d,q){var g=q.boundedPlane.create();return function(){function d(){this._worldPlane=g}Object.defineProperty(d.prototype,"isEnabled",{get:function(){return this.plane!==g},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"plane",{get:function(){return this._worldPlane},set:function(b){this._worldPlane=b?b:g},enumerable:!0,configurable:!0});return d}()})},
"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(t,d,q,g,l,b,f,e,k){return function(){function c(a){this.isEnabled=this._isLoadingResources=!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,
stride:8,normalized:!1}];this.rctx=a}c.prototype.loadResources=function(a){var c=this;return this.data?!0:(this._isLoadingResources=!0,t(["./SmaaRenderPassData"],function(b){c.data=b;c._isLoadingResources=!1;a&&a()}),!1)};Object.defineProperty(c.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0});c.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var a=this.rctx;this.programEdgeDetect=new b(a,this.data.edgeDetectShader.vertex,
this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new b(a,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new b(a,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);this.pipelineState=f.makePipelineState({colorWrite:f.defaultColorWriteParams});var c=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new k(a,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},
{geometry:new g(a,34962,35044,c)});this.tmpFramebufferEdges=l.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=l.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407);this.textureSearch=
this.loadTextureFromBase64(this.data.searchTexure,9728,6409);return this.isEnabled=!0};c.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=
null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};c.prototype.render=function(a,c){this.enable();var b=this.rctx,e=0,f=0;null!=c?(e=c.descriptor.width,f=c.descriptor.height):(e=b.gl.canvas.width,f=b.gl.canvas.height);b.bindVAO(this.vao);b.setPipelineState(this.pipelineState);b.setViewport(0,0,e,f);this.tmpFramebufferEdges.resize(e,f);b.bindFramebuffer(this.tmpFramebufferEdges);b.setClearColor(0,0,0,1);b.clear(16384);b.bindProgram(this.programEdgeDetect);b.bindTexture(a.colorTexture,
0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/e,1/f,e,f);b.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(e,f);b.bindFramebuffer(this.tmpFramebufferBlend);b.setClearColor(0,0,1,1);b.clear(16384);b.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/e,1/f,e,f);b.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);b.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",
2);b.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);b.drawArrays(4,0,3);b.bindFramebuffer(c);b.setClearColor(0,1,0,1);b.clear(16384);b.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/e,1/f,e,f);b.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);b.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);b.drawArrays(4,0,3)};c.prototype.loadTextureFromBase64=
function(a,c,b){var f=new e(this.rctx,{pixelFormat:b,dataType:5121,wrapMode:33071,samplingMode:c},null);q.requestImage(a).then(function(a){f.resize(a.width,a.height);f.setData(a)});return f};return c}()})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../core/Logger ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/imageUtils ./glUtil3D ./Util ../shaders/SSAOPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u){var v=q.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");d=function(){function d(a,c,b){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=f.vec4f64.create();this._rctx=c;this._programRep=a;this._requestRender=b;this._emptyTexture=k.createEmptyTexture(c)}d.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=null};Object.defineProperty(d.prototype,"isSupported",{get:function(){var a=
this._rctx,c=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),a=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return!(c||a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a;this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0});d.prototype.computeSSAO=function(a,e,f){if(this._noiseTexture){c.assert(this.enabled);var d=this._rctx,
g=a.fullViewport,h=g[2],m=g[3],g=h/this._BLUR_F,p=m/this._BLUR_F;this._ssaoFBO.resize(h,m);this._blur0FBO.resize(g,p);this._blur1FBO.resize(g,p);g=1*h;p=1*m;d.bindFramebuffer(this._ssaoFBO);b.vec4.copy(this._viewportToRestore,a.fullViewport);d.setViewport(0,0,h,m);var n=this._ssaoProgram,v=this._blurProgram;n.setUniform2f("rnmScale",h/this._noiseTexture.descriptor.width,m/this._noiseTexture.descriptor.height);n.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:
32>=this._samples?this._data.random32:this._data.random64);d.bindProgram(n);d.setPipelineState(this._pipelineState);h=this._data.minDiscrepancy;n.setUniform1f("numSpiralTurns",this._samples<h.length?h[this._samples]:5779);h=y;m=r;c.inverseProjectionInfo(a.projectionMatrix,a.fullWidth,a.fullHeight,h,m);n.setUniform4fv("projInfo",h);n.setUniform2fv("zScale",m);n.setUniform2f("nearFar",a.near,a.far);h=1/a.computeRenderPixelSizeAtDist(1);n.setUniform1f("projScale",1*h);n.setUniform2f("screenDimensions",
g,p);var x=2*this._radius,m=l.vec3.distance(a.eye,a.center),x=20*a.computeRenderPixelSizeAtDist(m),x=Math.max(.1,x);n.setUniform1f("radius",x);n.setUniform1f("intensity",4*this._attenuation/Math.pow(x,6));n.setUniform1i("rnm",0);n.setUniform1i("normalMap",1);n.setUniform1i("depthMap",2);d.bindTexture(this._noiseTexture,0);d.bindTexture(f,1);d.bindTexture(e,2);e=k.createQuadVAO(this._rctx);d.bindVAO(e);d.drawArrays(5,0,u.vertexCount(e,"geometry"));d.bindTexture(this._ssaoFBO.colorTexture,0);d.setViewport(0,
0,g/this._BLUR_F,p/this._BLUR_F);d.bindFramebuffer(this._blur0FBO);v.setUniform2f("screenDimensions",g,p);v.setUniform1i("tex",0);v.setUniform1i("normalMap",1);v.setUniform1i("depthMap",2);v.setUniform2f("blurSize",0,1*this._BLUR_F/p);v.setUniform1i("radius",4);v.setUniform1f("g_BlurFalloff",.08);v.setUniform2f("nearFar",a.near,a.far);5E4<m&&(h=Math.max(0,h-(m-5E4)));v.setUniform1f("projScale",h);v.setUniform2f("zScale",1,0);d.drawArrays(5,0,u.vertexCount(e,"geometry"));v.setUniform2f("blurSize",
1*this._BLUR_F/g,0);d.bindFramebuffer(this._blur1FBO);d.bindTexture(this._blur0FBO.colorTexture,0);d.drawArrays(5,0,u.vertexCount(e,"geometry"));d.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};d.prototype.setUniforms=function(a){var c=this.enabled&&this._noiseTexture,b=this._rctx;b.bindTexture(c?this._blur1FBO.colorTexture:this._emptyTexture,6);b.setActiveTexture(0);a.setUniform1i("ssaoTex",6);c?a.setUniform4f("viewportPixelSz",
this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};d.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var c=0;c<a.length;c++)this.setUniforms(a[c])};d.prototype.selectPrograms=function(){this._ssaoProgram=this._programRep.getProgram(a.ssaoPass,{samples:8>=this._samples?8:16>=this._samples?16:32>=this._samples?32:64});this._blurProgram=this._programRep.getProgram(a.blurPass,
{radius:4});this._pipelineState=p.makePipelineState({colorWrite:p.defaultColorWriteParams})};d.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&a.initialize()})):v.warn("SSAO is not supported for this browser or hardware"))};d.prototype.loadResources=function(a){var c=this;this._data?a():t(["./SSAOHelperData"],function(b){c._data=b;a()})};d.prototype.initialize=function(){var a=this,c={target:3553,pixelFormat:6408,dataType:5121,
samplingMode:9729,wrapMode:33071,width:0,height:0},b={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=h.createWithAttachments(this._rctx,c,b);this._blur0FBO=h.createWithAttachments(this._rctx,c,b);this._blur1FBO=h.createWithAttachments(this._rctx,c,b);e.requestImage(this._data.noiseTexture).then(function(c){a._enabled&&(a._noiseTexture=new n(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:c.width,height:c.height},c),a._requestRender())});this.selectPrograms()};d.prototype.disable=
function(){this.enabled&&(this._enabled=!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};d.prototype.getGpuMemoryUsage=function(){return u.getGpuMemoryUsage(this._blur0FBO)+u.getGpuMemoryUsage(this._blur1FBO)+u.getGpuMemoryUsage(this._ssaoFBO)};
return d}();var r=g.vec2f64.create(),y=f.vec4f64.create();return d})},"esri/views/3d/webgl-engine/shaders/SSAOPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.ssaoPass={name:"ssao",shaders:function(d){return{vertexShader:g.resolveIncludes("util/quad.vert"),fragmentShader:"#define SAMPLES "+d.samples+"\n"+g.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:q.Default3D};
d.blurPass={name:"ssao-blur",shaders:function(d){return{vertexShader:g.resolveIncludes("util/quad.vert"),fragmentShader:"#define RADIUS "+d.radius+"\n"+g.resolveIncludes("renderer/ssao/blur.frag")}},attributes:q.Default3D}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../core/requireUtils ../../../../../core/typedArrayUtil ../../../../../core/workers ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/utils ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../PreinterleavedGeometryData ../TextureBackedBuffer/BufferManager ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../../../../webgl/BufferObject ../../../../webgl/renderState ../../../../webgl/VertexArrayObject module".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M,Q){Object.defineProperty(d,"__esModule",{value:!0});var P=function(){function d(a,c,b){this.rctx=a;this.programRepository=c;this.callbacks=b;this.profilingCallback=null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new m.LocalOriginManager(new y);this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new E;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=p.vec3f64.create();this.tmpCameraPosition=
p.vec3f64.create();this.componentColorManager=new A.BufferManager(this.rctx,2)}d.prototype.initialize=function(){var a=this;c.open(e.getAbsMid("./EdgeProcessingWorker",t,Q)).then(function(c){a.destroyed?c.close():a.workerThread=c});for(var b=C.VertexLayout.createBuffer(4),f=0;4>f;f++)b.sideness.set(f,0,0===f||3===f?0:1),b.sideness.set(f,1,0===f||1===f?0:1);this.verticesBufferObject=F.createVertex(this.rctx,35044,b.buffer);this.pipelineState=(b=this.rctx.capabilities.blendMinMax)?K.makePipelineState({blending:K.separateBlendingParams(1,
1,0,1,32774,b.MAX),depthTest:{func:515},colorWrite:K.defaultColorWriteParams}):K.makePipelineState({depthTest:{func:515},depthWrite:K.defaultDepthWriteParams,colorWrite:K.defaultColorWriteParams})};d.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)};d.prototype.getUsedMemory=function(){return this.gpuMemoryUsage};Object.defineProperty(d.prototype,
"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});d.prototype.shouldRender=function(){return 0<this.renderers.size};d.prototype.addObject=function(a,c,b,e,d){return g(this,void 0,void 0,function(){var g,h,k,m,p,n,r;return l(this,function(l){switch(l.label){case 0:if(this.hasObject(a))return[2];g=[];k={loaded:f.create(function(a){return h=a}),renderables:[]};this.perObjectData.set(a,k);if(d&&d.mergeGeometries&&1<a.geometries.length&&this.canMergeGeometries(a))g.push(this.addObjectMergedGeometries(a,
k,c,b));else for(m=0;m<a.geometries.length;m++)p=a.geometries[m],n=a.geometryRecords[m],r=n.material,r.supportsEdges&&(p.data instanceof x?g.push(this.addGeometryPreinterleaved(a,k,p,p.data,n,c,b,e)):g.push(this.addGeometryNonPreinterleaved(a,k,p,p.data,n,c[0],b,e)));return[4,f.all(g)];case 1:return l.sent(),this.callbacks.setNeedsRender(),h(),[2]}})})};d.prototype.hasObject=function(a){return this.perObjectData.has(a)};d.prototype.updateAllComponentOpacities=function(a,c){return g(this,void 0,void 0,
function(){var b,e;return l(this,function(f){switch(f.label){case 0:return[4,this.getObjectEntry(a)];case 1:return b=f.sent(),e=c instanceof Array?function(a){return c[a]}:function(a){return c},b.renderables.forEach(function(a){for(var c=a.components.meta.length,b=0;b<c;b++){var f=e(b),d=a.components.meta[b],g=d.index;d.material.opacity=f;a.components.buffer.textureBuffer.setDataElement(g,1,3,255*f)}a.allTransparent=L.determineAllTransparent(a.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};
d.prototype.updateAllComponentMaterials=function(a,c,b,e){void 0===e&&(e=!0);return g(this,void 0,void 0,function(){var f,d,g,h,k=this;return l(this,function(m){switch(m.label){case 0:return[4,this.getObjectEntry(a)];case 1:return f=m.sent(),d=b.slicePlaneEnabled||!1,g=L.determineRendererType(c),h=I.EdgeRenderer.getKey(g,d),f.renderables.forEach(function(a){if(h!==a.rendererKey){var b=k.renderers.get(a.rendererKey),f=k.acquireRenderer(g,d);b.removeRenderable(a);b.refCount.decrement();a.rendererKey=
h;f.addRenderable(a)}for(b=0;b<c.length;b++)a.components.meta[b].material=c[b];e&&k.updateComponentBuffer(a.components);a.allTransparent=L.determineAllTransparent(a.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};d.prototype.updateObjectVisibility=function(a,c){return g(this,void 0,void 0,function(){var b;return l(this,function(e){switch(e.label){case 0:return[4,this.getObjectEntry(a)];case 1:return b=e.sent(),b.renderables.forEach(function(a){a.visible=c}),this.callbacks.setNeedsRender(),
[2]}})})};d.prototype.removeObject=function(a){var c=this,b=this.perObjectData.get(a);b&&(this.perObjectData.delete(a),b.loaded.then(function(){b.renderables.forEach(function(a){c.removeRenderable(a)});c.callbacks.setNeedsRender()}))};d.prototype.getObjectEntry=function(a){return g(this,void 0,void 0,function(){var c;return l(this,function(b){switch(b.label){case 0:c=this.perObjectData.get(a);if(!c)throw"no object";return[4,c.loaded];case 1:return b.sent(),[2,c]}})})};d.prototype.removeAll=function(){var a=
this;this.perObjectData.forEach(function(c,b){a.removeObject(b)})};d.prototype.createSolidEdgeMaterial=function(a){return q({},O,a,{type:"solid"})};d.prototype.createSketchEdgeMaterial=function(a){return q({},U,a,{type:"sketch"})};d.prototype.render=function(a){var c=this;this.localOrigins.updateViewMatrices(a.view);this.renderers.forEach(function(a){0===a.refCount.value&&(c.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();
var b=a.view,e=0,f=0;this.renderers.forEach(function(a){a.forEachRenderable(function(a){e+=a.statistics.averageEdgeLength;f++})});var d={distanceFalloffFactor:e/f*40,minimumEdgeLength:L.estimateLengthAtDistance(a.viewport[3],a.fovY,1,3.5*a.pixelRatio)};this.rctx.setPipelineState(this.pipelineState);this.updateObjectCameraDistances(a);this.numberOfRenderedEdges=0;this.renderers.forEach(function(b){c.renderRegularEdges(b,a,d);c.renderSilhouetteEdges(b,a,d)});a.view=b};d.prototype.computeModelTransformWithLocalOrigin=
function(a,c,b){a.getCombinedStaticTransformation(c,b);c.origin?this.localOrigins.register(c.origin):(a=h.vec3.set(this.tmpModelPosition,b[12],b[13],b[14]),c.origin=this.localOrigins.aquire(a));w.applyToModelMatrix(c.origin.vec3,b);return b};d.prototype.updateComponentBuffer=function(a){var c=a.meta;a=a.buffer;for(var b=0;b<c.length;b++){var e=c[b].material,f=c[b].index,d=u.clamp(Math.round(e.size*I.LINE_WIDTH_FRACTION_FACTOR),0,255),g=u.clamp(e.extensionLength,-I.EXTENSION_LENGTH_OFFSET,255-I.EXTENSION_LENGTH_OFFSET)+
I.EXTENSION_LENGTH_OFFSET,h="solid"===e.type?0:1,k=255*e.opacity,e=e.color;a.textureBuffer.setData(f,0,255*e[0],255*e[1],255*e[2],255*e[3]);a.textureBuffer.setData(f,1,d,g,h,k)}};d.prototype.createComponentBuffers=function(a){for(var c=[],b=this.componentColorManager.getBuffer(a.length),e=0;e<a.length;e++){var f=a[e],d=b.aquireIndex();c.push({index:d,material:f})}a={meta:c,buffer:b};this.updateComponentBuffer(a);return a};d.prototype.extractEdges=function(a,c,b,e,f){return this.worker.process({data:c,
originalIndices:f,writerSettings:a,skipDeduplicate:b},e?null:this.workerThread)};d.prototype.createEdgeResources=function(a){var c={};if(0<a.regular.lodInfo.lengths.length){var b=new M(this.rctx,C.EdgeShaderAttributeLocations,{vertices:C.glVertexLayout,instances:B.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:F.createVertex(this.rctx,35044,a.regular.instancesData.buffer)});c.regular={vao:b,lod:a.regular.lodInfo}}0<a.silhouette.lodInfo.lengths.length&&(b=new M(this.rctx,
C.EdgeShaderAttributeLocations,{vertices:C.glVertexLayout,instances:B.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:F.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),c.silhouette={vao:b,lod:a.silhouette.lodInfo});return c};d.prototype.disposeEdgeResources=function(a){a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),a.silhouette.vao.dispose(!1),
a.silhouette.vao=null)};d.prototype.addGeometryNonPreinterleaved=function(c,b,e,f,d,h,k,m){return g(this,void 0,void 0,function(){var e,g,p,n;return l(this,function(l){e=f.getAttribute("position");g=this.computeModelTransformWithLocalOrigin(c,d,a.mat4f64.create());p=d.origin;n={position:e,indices:f.getIndices("position"),modelTransform:g,origin:p};return[2,this.addNonPreinterleaved(c,b,n,h,k,m)]})})};d.prototype.addNonPreinterleaved=function(a,c,b,e,f,d){void 0===d&&(d=!1);return g(this,void 0,void 0,
function(){var a,g,h,k,m,p,n,r,v,u,x,A,w,y,q;return l(this,function(l){switch(l.label){case 0:a=this.acquireRenderer(e.type,f.slicePlaneEnabled||!1);g=b.modelTransform;h=b.origin;k=b.indices;m=b.position;p=m.data.length/m.strideIdx;n=C.EdgeInputBufferLayout.createBuffer(p);for(r=0;r<p;r++)n.position.set(r,0,m.data[m.offsetIdx+r*m.strideIdx+0]),n.position.set(r,1,m.data[m.offsetIdx+r*m.strideIdx+1]),n.position.set(r,2,m.data[m.offsetIdx+r*m.strideIdx+2]);v=this.createComponentBuffers([e]);L.fillComponenBufferIndices(v.meta,
[0,n.componentIndex.count],n.componentIndex);return[4,this.extractEdges(a.writerSettings,n,!1,d,k)];case 1:return u=l.sent(),x=this.createEdgeResources(u),A=x.regular,w=x.silhouette,y=(A?A.vao.size:0)+(w?w.vao.size:0),q={regular:A,silhouette:w,transform:{modelMatrix:g,origin:h},statistics:{gpuMemoryUsage:y,averageEdgeLength:u.averageEdgeLength},components:v,visible:!0,allTransparent:L.determineAllTransparent(v.meta),distanceToCamera:0,rendererKey:a.key},c.renderables.push(q),a.addRenderable(q),this.gpuMemoryUsage+=
y,[2]}})})};d.prototype.addGeometryPreinterleaved=function(c,b,e,f,d,h,m,p){return g(this,void 0,void 0,function(){var e,g,n,u,x,A,w,y,q,B,E,J,t,z,R,F;return l(this,function(l){switch(l.label){case 0:e=f.getAttribute("position");if(!e||!k.isFloat32Array(e.data))return console.warn("Geometry has no float32 `position` attribute, skipping it."),[2];g=L.determineRendererType(h);n=this.acquireRenderer(g,m.slicePlaneEnabled||!1);u=this.computeModelTransformWithLocalOrigin(c,d,a.mat4f64.create());x=d.origin;
A=f.getIndices("position");w=new v.BufferViewVec3f(e.data.buffer,4*e.offsetIdx,4*e.strideIdx);y=C.EdgeInputBufferLayout.createBuffer(w.count);r.vec3.copy(y.position,w);q=this.createComponentBuffers(h);L.fillComponenBufferIndices(q.meta,f.componentOffsets,y.componentIndex,A);B=f.hasPositionData;return[4,this.extractEdges(n.writerSettings,y,B,p,A)];case 1:return E=l.sent(),J=this.createEdgeResources(E),t=J.regular,z=J.silhouette,R=(t?t.vao.size:0)+(z?z.vao.size:0),F={regular:t,silhouette:z,transform:{modelMatrix:u,
origin:x},statistics:{gpuMemoryUsage:R,averageEdgeLength:E.averageEdgeLength},components:q,visible:!c.isHidden(d),allTransparent:L.determineAllTransparent(q.meta),distanceToCamera:0,rendererKey:n.key},b.renderables.push(F),n.addRenderable(F),this.gpuMemoryUsage+=R,[2]}})})};d.prototype.canMergeGeometries=function(a){for(var c=null,e=null,f=0;f<a.geometries.length;f++){var d=a.geometryRecords[f];if(d.material.supportsEdges){if(a.geometries[f].data instanceof x)return!1;if(!c)c=d.transformation;else if(!b.equals(c,
d.transformation))return!1;if(!e&&d.origin)e=d;else if(e&&d.origin&&e.origin.id!==d.origin.id)return!1}}return!0};d.prototype.addObjectMergedGeometries=function(c,b,e,f){return g(this,void 0,void 0,function(){var d,g,h,m,p,n,r,v,u,x,A,w,y,q,C,B,E,z,J,t,R;return l(this,function(l){switch(l.label){case 0:d=new Map;g=0;m=h=null;for(p=0;p<c.geometries.length;p++)if(n=c.geometries[p],r=c.geometryRecords[p],v=r.material,v.supportsEdges&&(!m&&r.origin&&(m=r),u=n.data.getIndices("position"),g+=u?u.length:
0,u&&null==h||h===Uint16Array))h=k.isUint16Array(u)?Uint16Array:Uint32Array;x=g?new h(g):null;A=[];for(p=w=0;p<c.geometries.length;p++)if(n=c.geometries[p],y=c.geometryRecords[p],v=y.material,v.supportsEdges){q=n.data.getAttribute("position");u=n.data.getIndices("position");C=d.get(q.data);if(null==C){C=A.length/3;for(B=q.offsetIdx;B<q.data.length;B+=q.strideIdx)A.push(q.data[B+0]),A.push(q.data[B+1]),A.push(q.data[B+2]);d.set(q.data,C)}if(u)for(E=0;E<u.length;E++)x[w++]=C+u[E]}z=m||c.geometryRecords[0];
J=this.computeModelTransformWithLocalOrigin(c,z,a.mat4f64.create());t=z.origin;for(p=0;p<c.geometryRecords.length;p++)c.geometryRecords[p].origin=t;R={position:{data:A,offsetIdx:0,strideIdx:3},indices:x,modelTransform:J,origin:t};return[4,this.addNonPreinterleaved(c,b,R,e[0],f)];case 1:return l.sent(),[2]}})})};d.prototype.acquireRenderer=function(a,c){var b=I.EdgeRenderer.getKey(a,c),e=this.renderers.get(b);this.strokesTexture||(this.strokesTexture=G.generateStrokesTexture(this.rctx));e||(e=new I.EdgeRenderer(this.rctx,
this.programRepository,{type:a,slicePlaneEnabled:c,strokesTexture:this.strokesTexture}),this.renderers.set(b,e));e.refCount.increment();return e};d.prototype.removeRenderable=function(a){var c=this.renderers.get(a.rendererKey);c.removeRenderable(a);c.refCount.decrement();this.disposeEdgeResources(a);this.localOrigins.release(a.transform.origin);this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;for(var c=0,b=a.components.meta;c<b.length;c++)a.components.buffer.releaseIndex(b[c].index)};d.prototype.updateObjectCameraDistances=
function(a){var c=this;a=a.viewInvTransp;h.vec3.set(this.tmpCameraPosition,a[3],a[7],a[11]);this.perObjectData.forEach(function(a,b){var e=h.vec3.distance(b.getCenter(),c.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=e})})};d.prototype.renderRegularEdges=function(a,c,b){var e=this;a.bindRegularEdges(c,b);a.forEachRenderable(function(f){if(f.visible&&f.regular&&!f.allTransparent){var d=L.computeEdgeCount(f.regular.lod.lengths,f.distanceToCamera,b);c.view=e.localOrigins.getViewMatrix(f.transform.origin);
a.renderRegularEdges(f,c,d);e.numberOfRenderedEdges+=d}})};d.prototype.renderSilhouetteEdges=function(a,c,b){var e=this;a.bindSilhouetteEdges(c,b);a.forEachRenderable(function(f){if(f.visible&&f.silhouette&&!f.allTransparent){var d=L.computeEdgeCount(f.silhouette.lod.lengths,f.distanceToCamera,b);c.view=e.localOrigins.getViewMatrix(f.transform.origin);a.renderSilhouetteEdges(f,c,d);e.numberOfRenderedEdges+=d}})};return d}();d.EdgeView=P;var O={color:n.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,
opacity:1},U={color:n.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1}})},"esri/views/3d/support/buffer/utils":function(){define("require exports ./types ./utils/mat3 ./utils/mat4 ./utils/scalar ./utils/vec2 ./utils/vec3 ./utils/vec4".split(" "),function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,"__esModule",{value:!0});d.mat3=g;d.mat4=l;d.scalar=b;d.vec2=f;d.vec3=e;d.vec4=k;d.createBuffer=function(c,a){return new c(new ArrayBuffer(a*c.ElementCount*q.elementTypeSize(c.ElementType)))}})},
"esri/views/3d/support/buffer/utils/mat3":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.copy=function(d,g,l){var b=d.typedBuffer;d=d.typedBufferStride;var f=g.typedBuffer,e=g.typedBufferStride;g=l?l.count:g.count;var k=(l&&l.dstIndex?l.dstIndex:0)*d;l=(l&&l.srcIndex?l.srcIndex:0)*e;for(var c=0;c<g;++c){for(var a=0;9>a;++a)b[k+a]=f[l+a];k+=d;l+=e}}})},"esri/views/3d/support/buffer/utils/mat4":function(){define(["require","exports"],function(t,
d){Object.defineProperty(d,"__esModule",{value:!0});d.copy=function(d,g,l){var b=d.typedBuffer;d=d.typedBufferStride;var f=g.typedBuffer,e=g.typedBufferStride;g=l?l.count:g.count;var k=(l&&l.dstIndex?l.dstIndex:0)*d;l=(l&&l.srcIndex?l.srcIndex:0)*e;for(var c=0;c<g;++c){for(var a=0;16>a;++a)b[k+a]=f[l+a];k+=d;l+=e}}})},"esri/views/3d/support/buffer/utils/scalar":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.copy=function(d,g,l){var b=d.typedBuffer;
d=d.typedBufferStride;var f=g.typedBuffer,e=g.typedBufferStride;g=l?l.count:g.count;var k=(l&&l.dstIndex?l.dstIndex:0)*d;l=(l&&l.srcIndex?l.srcIndex:0)*e;for(var c=0;c<g;++c)b[k]=f[l],k+=d,l+=e};d.makeDense=function(d,g){var l=d.count;g||(g=new d.TypedArrayConstructor(l));for(var b=0;b<l;b++)g[b]=d.get(b);return g}})},"esri/views/3d/support/buffer/utils/vec2":function(){define(["require","exports","../types"],function(t,d,q){function g(d,b,f){var e=d.typedBuffer;d=d.typedBufferStride;var g=b.typedBuffer,
c=b.typedBufferStride;b=f?f.count:b.count;var a=(f&&f.dstIndex?f.dstIndex:0)*d;f=(f&&f.srcIndex?f.srcIndex:0)*c;for(var h=0;h<b;++h)e[a]=g[f],e[a+1]=g[f+1],a+=d,f+=c}Object.defineProperty(d,"__esModule",{value:!0});d.copy=g;d.normalizeIntegerBuffer=function(d,b,f){var e=d.typedBuffer,k=d.typedBufferStride,c=b.typedBuffer,a=b.typedBufferStride,h=f?f.count:b.count,l=(f&&f.dstIndex?f.dstIndex:0)*k,n=(f&&f.srcIndex?f.srcIndex:0)*a;if(q.isInteger(b.elementType))if(f=q.maximumValue(b.elementType),q.isSigned(b.elementType))for(b=
0;b<h;++b)e[l]=Math.max(c[n]/f,-1),e[l+1]=Math.max(c[n+1]/f,-1),l+=k,n+=a;else for(b=0;b<h;++b)e[l]=c[n]/f,e[l+1]=c[n+1]/f,l+=k,n+=a;else g(d,b,f);return d}})},"esri/views/3d/support/buffer/utils/vec3":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.copy=function(d,g,l){var b=d.typedBuffer;d=d.typedBufferStride;var f=g.typedBuffer,e=g.typedBufferStride;g=l?l.count:g.count;var k=(l&&l.dstIndex?l.dstIndex:0)*d;l=(l&&l.srcIndex?l.srcIndex:0)*e;
for(var c=0;c<g;++c)b[k]=f[l],b[k+1]=f[l+1],b[k+2]=f[l+2],k+=d,l+=e}})},"esri/views/3d/support/buffer/utils/vec4":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.copy=function(d,g,l){var b=d.typedBuffer;d=d.typedBufferStride;var f=g.typedBuffer,e=g.typedBufferStride;g=l?l.count:g.count;var k=(l&&l.dstIndex?l.dstIndex:0)*d;l=(l&&l.srcIndex?l.srcIndex:0)*e;for(var c=0;c<g;++c)b[k]=f[l],b[k+1]=f[l+1],b[k+2]=f[l+2],b[k+3]=f[l+3],k+=d,l+=e};d.fill=
function(d,g,l,b,f,e){var k=d.typedBuffer,c=d.typedBufferStride;d=e?e.count:d.count;e=(e&&e.dstIndex?e.dstIndex:0)*c;for(var a=0;a<d;++a)k[e]=g,k[e+1]=l,k[e+2]=b,k[e+3]=f,e+=c}})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.applyToModelMatrix=function(d,g){var l=-d[0],b=-d[1];d=-d[2];var f=g[3],e=g[7],k=g[11],c=g[15];g[0]+=f*l;g[1]+=f*b;g[2]+=f*d;g[4]+=e*l;g[5]+=e*b;g[6]+=e*d;g[8]+=k*l;
g[9]+=k*b;g[10]+=k*d;g[12]+=c*l;g[13]+=c*b;g[14]+=c*d};d.applyToViewMatrix=function(d,g){var l=d[0],b=d[1];d=d[2];g[12]+=l*g[0]+b*g[4]+d*g[8];g[13]+=l*g[1]+b*g[5]+d*g[9];g[14]+=l*g[2]+b*g[6]+d*g[10];g[14]+=l*g[3]+b*g[7]+d*g[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/mat4f64","./localOriginHelper"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});t=
function(){function b(b){this.factory=b;this.originData=new Map}b.prototype.aquire=function(b){return this.register(this.factory.getOrigin(b))};b.prototype.register=function(b){var e=this.originData.get(b.id);if(e)return e.refCount++,e.origin;this.originData.set(b.id,{refCount:1,viewMatrix:g.mat4f64.create(),origin:b});return b};b.prototype.release=function(b){var e=this.originData.get(b.id);e&&(e.refCount--,0===e.refCount&&this.originData.delete(b.id))};b.prototype.updateViewMatrices=function(b){this.originData.forEach(function(e){q.mat4.copy(e.viewMatrix,
b);l.applyToViewMatrix(e.origin.vec3,e.viewMatrix)})};b.prototype.getViewMatrix=function(b){return this.originData.get(b.id).viewMatrix};return b}();d.LocalOriginManager=t})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","../../../webgl/Util"],function(t,d,q,g,l){function b(b){switch(b){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;
case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+b);}return function(){function f(e,d,c,a,h){void 0===c&&(c=null);void 0===a&&(a=f.DefaultOffsets);void 0===h&&(h=f.DefaultIndices);this.preinterleaved=!0;this.primitiveType="triangle";this._positionData=null;var k=l.getStride(d)/4,k=e.length/k;(this._hasDefaultIndices=h===f.DefaultIndices)&&(h=g.generateDefaultIndexArray(k));for(var k={},n=0;n<d.length;n++){var u=d[n],v=new (b(u.type))(e.buffer),r=l.getBytesPerElement(u.type);
k[u.name]={data:v,size:u.count,offsetIdx:u.offset/r,strideIdx:u.stride/r}}c&&(this._positionData=c,k.position={data:c.data,size:3,offsetIdx:0,strideIdx:3});this._id=g.getNewId();this._vertexData=e;this._vertexAttributes=k;this._layout=d;this._indexData=h;this._componentOffsets=q.createOffsets(a);this._gpuMemoryUsage=e.byteLength+(this._hasDefaultIndices?0:h.byteLength);this._indexCount=h.length}Object.defineProperty(f.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"indexCount",{get:function(){return this._indexCount},enumerable:!0,configurable:!0});f.prototype.toRenderData=function(){var b={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,
indexCount:this._indexCount,vertexData:this._vertexData,layout:this._layout};this._indexData=this._vertexData=null;this._vertexAttributes={position:this._vertexAttributes.position};return b};f.prototype.getIndices=function(b){return"position"===b&&this._positionData?this._positionData.indices:this._indexData};f.prototype.getAttribute=function(b){return this._vertexAttributes[b]};f.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage};Object.defineProperty(f.prototype,"hasPositionData",
{get:function(){return!!this._positionData},enumerable:!0,configurable:!0});f.DefaultOffsets=new Uint32Array(0);f.DefaultIndices=new Uint32Array(0);return f}()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(d,b){void 0===b&&(b=1);this.rctx=d;this.fieldCount=b;this.buffers=[]}d.prototype.garbageCollect=function(){this.buffers=
this.buffers.filter(function(d){return 0===d.activeCount?(d.dispose(),!1):!0})};d.prototype.getBuffer=function(d){for(var b=0,f=this.buffers;b<f.length;b++){var e=f[b];if(e.availableCount>=d)return e}if(d>q.MAX_INDEX_COUNT)return null;d=new q.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(d);return d};d.prototype.updateTextures=function(){for(var d=0,b=this.buffers;d<b.length;d++)b[d].textureBuffer.updateTexture()};return d}();d.BufferManager=t})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require",
"exports","./SimpleIndexManager","./TextureBackedBuffer"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.MAX_INDEX_COUNT=65536;t=function(){function l(b,f){void 0===f&&(f=1);this.textureBuffer=new g.TextureBackedBuffer(b,f);this.indexManager=new q.SimpleIndexManager(d.MAX_INDEX_COUNT)}l.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(l.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},
enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});l.prototype.aquireIndex=function(){var b=this.indexManager.aquire();this.textureBuffer.resizeToFit(b);return b};l.prototype.releaseIndex=function(b){this.indexManager.release(b)};return l}();d.ManagedTextureBackedBuffer=t})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],
function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(d){this.maxCount=d;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(d.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});d.prototype.aquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();
if(this.availableCount)return this._nextIndex++};d.prototype.release=function(d){this.recycledIndices.push(d)};return d}();d.SimpleIndexManager=t})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(b,f){void 0===f&&(f=1);this.rctx=b;this.fieldCount=f;this.textureWidth=4096;this.dirty=
!0;this.texture=new g(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new q.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}d.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};d.prototype.setData=function(b,f,e,d,c,a){b=b*this.fieldCount+f;this.dirty=!0;this.data.set(b,0,e);this.data.set(b,1,d);this.data.set(b,2,c);this.data.set(b,3,a)};d.prototype.setDataElement=
function(b,f,e,d){b=b*this.fieldCount+f;this.dirty=!0;this.data.set(b,e,d)};d.prototype.resizeToFit=function(b){b*=this.fieldCount;b>=this.data.count&&(b=new q.BufferViewVec4u8(new ArrayBuffer(Math.ceil((b+1)/this.textureWidth)*this.textureWidth*4)),b.typedBuffer.set(this.data.typedBuffer),this.data=b)};d.prototype.updateTexture=function(){if(this.dirty){var b=this.texture.descriptor.width;this.data.count>b*this.texture.descriptor.height&&this.texture.resize(b,this.data.count/b);this.texture.setData(this.data.typedBuffer);
this.dirty=!1}};d.prototype.bind=function(b,f){this.rctx.bindTexture(this.texture,f.unit);b.setUniform1i(f.texName,f.unit);b.setUniform2f(f.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return d}();d.TextureBackedBuffer=t})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require","exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});
d.EdgeInputBufferLayout=g.newLayout().vec3f("position").u16("componentIndex").u16("_padding");d.VertexLayout=g.newLayout().vec2u8("sideness");d.glVertexLayout=q.glLayout(d.VertexLayout,{prefixA:!0});d.CommonInstancesLayout=g.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0});d.RegularEdgeInstancesLayout=d.CommonInstancesLayout.clone().vec3f("normal");
d.SilhouetteEdgeInstancesLayout=d.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");d.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/RandomLCG ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,"__esModule",{value:!0});var c=function(){function c(){}c.prototype.updateSettings=function(a){this.settings=a};c.prototype.write=function(c,b,e){var f=a;f[0]=e.position0[0];f[1]=e.position0[1];f[2]=e.position0[2];f[3]=e.position1[0];f[4]=e.position1[1];f[5]=e.position1[2];p[0]=5381;for(f=0;f<h.length;f++)p[0]=31*p[0]+h[f];n.seed=p[0];var f=n.getIntRange(0,255),d=n.getIntRange(0,this.settings.variants-1),g=n.getFloat(),g=-(1-Math.min(g/.7,1))+Math.max(0,
g-.7)/(1-.7),g=255*(Math.pow(Math.abs(g),1.2)*(0>g?-1:1)*.5+.5);c.position0.setVec(b,e.position0);c.position1.setVec(b,e.position1);c.componentIndex.set(b,e.componentIndex);c.variantOffset.set(b,f);c.variantStroke.set(b,d);c.variantExtension.set(b,g)};c.prototype.trim=function(a,c){return a.slice(0,c)};return c}();d.CommonBufferWriter=c;var a=new Float32Array(6),h=new Uint32Array(a.buffer),p=new Uint32Array(1),n=new l;t=function(){function a(){this.commonWriter=new c}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};
a.prototype.allocate=function(a){return k.RegularEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,c,e){this.commonWriter.write(a,c,e);b.vec3.add(u,e.faceNormal0,e.faceNormal1);b.vec3.normalize(u,u);a.normal.setVec(c,u)};a.prototype.trim=function(a,c){return this.commonWriter.trim(a,c)};a.Layout=k.RegularEdgeInstancesLayout;a.glLayout=e.glLayout(k.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();d.RegularEdgeBufferWriter=t;t=function(){function a(){this.commonWriter=
new c}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return k.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,c,b){this.commonWriter.write(a,c,b);a.normalA.setVec(c,b.faceNormal0);a.normalB.setVec(c,b.faceNormal1)};a.prototype.trim=function(a,c){return this.commonWriter.trim(a,c)};a.Layout=k.SilhouetteEdgeInstancesLayout;a.glLayout=e.glLayout(k.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();
d.SilhouetteEdgeBufferWriter=t;var u=f.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/typedArrayUtil ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(t,d,q,g,l,b,f,
e,k,c,a){return function(){function d(){this.regularWriter=new c.RegularEdgeBufferWriter;this.silhouetteWriter=new c.SilhouetteEdgeBufferWriter}d.prototype.process=function(a,c){return q(this,void 0,void 0,function(){var b,e,f;return g(this,function(d){switch(d.label){case 0:if(!c)return[3,2];b=[];e=this.packInput(a,b);this.wrappedWork;return[4,c.invoke("wrappedWork",e,{transferList:b})];case 1:return f=d.sent(),[2,this.unpackOutput(f)];case 2:return[2,this.work(a)]}})})};d.prototype.wrappedWork=
function(a){return q(this,void 0,void 0,function(){var c,b,e,f;return g(this,function(d){c=this.unpackInput(a);b=this.work(c);e=[];this.packInputTransferables(c,e);f=this.packOutput(b,e);return[2,{result:f,transferList:e}]})})};d.prototype.work=function(c){var b=this.extractEdgeInformation(c.data,c.skipDeduplicate,c.originalIndices);this.regularWriter.updateSettings(c.writerSettings);this.silhouetteWriter.updateSettings(c.writerSettings);return a.extractEdges(b,this.regularWriter,this.silhouetteWriter)};
d.prototype.packInputTransferables=function(a,c){c.push(a.data.buffer)};d.prototype.packInput=function(a,c){this.packInputTransferables(a,c);c={dataBuffer:a.data.buffer,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(c.originalIndicesBuffer=a.originalIndices.buffer,c.originalIndicesType=l.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return c};d.prototype.unpackInput=function(a){return{data:k.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===
a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};d.prototype.packOutput=function(a,c){c.push(a.regular.lodInfo.lengths.buffer);c.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:e.packInterleavedBuffer(a.regular.instancesData,c),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:e.packInterleavedBuffer(a.silhouette.instancesData,
c),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:a.averageEdgeLength}};d.prototype.unpackOutput=function(a){return{regular:{instancesData:e.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:e.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};d.prototype.extractEdgeInformation=function(a,
c,e){if(c&&e)return c=f.computeNeighbors(e,a.count),{faces:e,neighbors:c,vertices:a};a=b.default(a.buffer,a.stride/4,e);c=f.computeNeighbors(a.indices,a.uniqueCount);return{faces:a.indices,neighbors:c,vertices:k.EdgeInputBufferLayout.createView(a.buffer)}};return d}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.computeNeighbors=function(d,g){for(var l=d.length/3,b=new Uint32Array(g+1),f=new Uint32Array(g+
1),e=function(a,c){a<c?b[a+1]++:f[c+1]++},k=0;k<l;k++){var c=d[3*k],a=d[3*k+1],h=d[3*k+2];e(c,a);e(a,h);e(h,c)}for(k=a=c=0;k<g;k++)h=b[k+1],e=f[k+1],b[k+1]=c,f[k+1]=a,c+=h,a+=e;for(var p=new Uint32Array(6*l),n=b[g],e=function(a,c,e){if(a<c){var d=b[a+1]++;p[2*d]=c;p[2*d+1]=e}else d=f[c+1]++,p[2*n+2*d]=a,p[2*n+2*d+1]=e},k=0;k<l;k++)c=d[3*k],a=d[3*k+1],h=d[3*k+2],e(c,a,k),e(a,h,k),e(h,c,k);c=function(a,c){var b=2*a;a=c-a;for(c=1;c<a;c++){var e=p[b+2*c],f=p[b+2*c+1],d=c-1;for(d;0<=d&&p[b+2*d]>e;d--)p[b+
2*d+2]=p[b+2*d],p[b+2*d+3]=p[b+2*d+1];p[b+2*d+2]=e;p[b+2*d+3]=f}};for(k=0;k<g;k++)c(b[k],b[k+1]),c(n+f[k],n+f[k+1]);for(var u=new Int32Array(3*l),v=function(a,c){return a===d[3*c]?0:a===d[3*c+1]?1:a===d[3*c+2]?2:-1},l=function(a,c){a=v(a,c);u[3*c+a]=-1},c=function(a,c,b,e){a=v(a,c);u[3*c+a]=e;b=v(b,e);u[3*e+b]=c},k=0;k<g;k++){for(var a=b[k],h=b[k+1],e=f[k],r=f[k+1];a<h&&e<r;){var y=p[2*a],w=p[2*n+2*e];y===w?(c(k,p[2*a+1],w,p[2*n+2*e+1]),a++,e++):y<w?(l(k,p[2*a+1]),a++):(l(w,p[2*n+2*e+1]),e++)}for(;a<
h;)l(k,p[2*a+1]),a++;for(;e<r;)w=p[2*n+2*e],l(w,p[2*n+2*e+1]),e++}return u}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","./BufferView","./InterleavedLayout"],function(t,d,q,g,l){function b(b){var c=[];b.fields.forEach(function(a,b){var e=a.constructor;a=q({},a,{constructor:e.ElementType+"_"+e.ElementCount});c.push([b,a])});return{stride:b.stride,fields:c,fieldNames:b.fieldNames}}function f(b){var c=l.newLayout();c.stride=
b.stride;c.fieldNames=b.fieldNames;b.fields.forEach(function(a){return c.fields.set(a[0],q({},a[1],{constructor:e.get(a[1].constructor)}))});return c}Object.defineProperty(d,"__esModule",{value:!0});d.packInterleavedBuffer=function(e,c){c.push(e.buffer);return{buffer:e.buffer,layout:b(e.layout)}};d.unpackInterleavedBuffer=function(b){return f(b.layout).createView(b.buffer)};d.packLayout=b;d.unpackLayout=f;t=[g.BufferViewFloat,g.BufferViewVec2f,g.BufferViewVec3f,g.BufferViewVec4f,g.BufferViewMat3f,
g.BufferViewMat4f,g.BufferViewFloat64,g.BufferViewVec2f64,g.BufferViewVec3f64,g.BufferViewVec4f64,g.BufferViewMat3f64,g.BufferViewMat4f64,g.BufferViewUint8,g.BufferViewVec2u8,g.BufferViewVec3u8,g.BufferViewVec4u8,g.BufferViewUint16,g.BufferViewVec2u16,g.BufferViewVec3u16,g.BufferViewVec4u16,g.BufferViewUint32,g.BufferViewVec2u32,g.BufferViewVec3u32,g.BufferViewVec4u32,g.BufferViewInt8,g.BufferViewVec2i8,g.BufferViewVec3i8,g.BufferViewVec4i8,g.BufferViewInt16,g.BufferViewVec2i16,g.BufferViewVec3i16,
g.BufferViewVec4i16,g.BufferViewInt32,g.BufferViewVec2i32,g.BufferViewVec3i32,g.BufferViewVec4i32];var e=new Map;t.forEach(function(b){return e.set(b.ElementType+"_"+b.ElementCount,b)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils".split(" "),function(t,d,q,g,l,b,
f){function e(c,b){var e=f.acos(c.cosAngle),d=a.fwd,g=a.ortho;f.directionFromTo(d,c.position1,c.position0);c=0<l.vec3.dot(l.vec3.cross(g,c.faceNormal0,c.faceNormal1),d)?-1:1;return e*c>b}function k(a){var c=a.faces.length/3,b=a.faces;a=a.neighbors;for(var e=0,f=0;f<c;f++)var d=a[3*f+0],g=a[3*f+1],h=a[3*f+2],k=b[3*f+0],l=b[3*f+1],p=b[3*f+2],e=e+(-1===d||k<l?1:0),e=e+(-1===g||l<p?1:0),e=e+(-1===h||p<k?1:0);for(var e=new Int32Array(4*e),n=0,f=0;f<c;f++){d=a[3*f+0];g=a[3*f+1];h=a[3*f+2];k=b[3*f+0];l=
b[3*f+1];p=b[3*f+2];if(-1===d||k<l)e[n++]=k,e[n++]=l,e[n++]=f,e[n++]=d;if(-1===g||l<p)e[n++]=l,e[n++]=p,e[n++]=f,e[n++]=g;if(-1===h||p<k)e[n++]=p,e[n++]=k,e[n++]=f,e[n++]=h}return e}function c(a){var c=a.faces.length/3,b=a.vertices.position;a=a.faces;for(var e=h.v0,f=h.v1,d=h.v2,g=new Float32Array(3*c),k=0;k<c;k++){var p=a[3*k+1],n=a[3*k+2];b.getVec(a[3*k+0],e);b.getVec(p,f);b.getVec(n,d);l.vec3.subtract(f,f,e);l.vec3.subtract(d,d,e);l.vec3.cross(e,f,d);l.vec3.normalize(e,e);g[3*k+0]=e[0];g[3*k+1]=
e[1];g[3*k+2]=e[2]}return g}Object.defineProperty(d,"__esModule",{value:!0});d.extractEdges=function(b,d,h,r){void 0===r&&(r=p);var n=b.vertices.position,v=b.vertices.componentIndex,m=f.deg2rad(r.anglePlanar);r=f.deg2rad(r.angleSignificantEdge);var u=Math.cos(r),A=Math.cos(m),C=a.edge,B=C.position0,E=C.position1,t=C.faceNormal0,G=C.faceNormal1,L=c(b),F=k(b),K=F.length/4;b=d.allocate(K);r=0;var M=h.allocate(K),Q=0,P=0,O=0,U=q.range(0,K),N=new Float32Array(K);g.forEach(N,function(a,c,b){n.getVec(F[4*
c+0],B);n.getVec(F[4*c+1],E);b[c]=l.vec3.distance(B,E)});U.sort(function(a,c){return N[c]-N[a]});for(var V=[],X=[],J=0;J<K;J++){var R=U[J],T=N[R],W=F[4*R+0],Z=F[4*R+1],fa=F[4*R+2],R=F[4*R+3],ga=-1===R;n.getVec(W,B);n.getVec(Z,E);if(ga)l.vec3.set(t,L[3*fa+0],L[3*fa+1],L[3*fa+2]),l.vec3.copy(G,t),C.componentIndex=v.get(W),C.cosAngle=l.vec3.dot(t,G);else{l.vec3.set(t,L[3*fa+0],L[3*fa+1],L[3*fa+2]);l.vec3.set(G,L[3*R+0],L[3*R+1],L[3*R+2]);C.componentIndex=v.get(W);C.cosAngle=l.vec3.dot(t,G);if(C.cosAngle>
A)continue;-.9999>C.cosAngle&&l.vec3.copy(G,t)}P+=T;O++;ga||C.cosAngle<u?(d.write(b,r++,C),V.push(T)):e(C,m)&&(h.write(M,Q++,C),X.push(T))}v=new Float32Array(V.reverse());m=new Float32Array(X.reverse());return{regular:{instancesData:d.trim(b,r),lodInfo:{lengths:v}},silhouette:{instancesData:h.trim(M,Q),lodInfo:{lengths:m}},averageEdgeLength:P/O}};var a={edge:{position0:b.vec3f64.create(),position1:b.vec3f64.create(),faceNormal0:b.vec3f64.create(),faceNormal1:b.vec3f64.create(),componentIndex:0,cosAngle:0},
ortho:b.vec3f64.create(),fwd:b.vec3f64.create()},h={v0:b.vec3f64.create(),v1:b.vec3f64.create(),v2:b.vec3f64.create()},p={anglePlanar:4,angleSignificantEdge:35}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../support/mathUtils ../../materials/internal/MaterialUtil ../../shaders/EdgeRendererPrograms".split(" "),
function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,"__esModule",{value:!0});d.LINE_WIDTH_FRACTION_FACTOR=8;d.EXTENSION_LENGTH_OFFSET=128;var c={type:"uber",slicePlaneEnabled:!1,strokesTexture:null},a=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}();t=function(){function g(e,f,d){this.rctx=e;this.programRepository=
f;this.refCount=new a;this.renderables=new Set;this.depthBiasZ=-4E-4;this.depthBiasXY=.5;this.tmpViewToWorldNormalMatrix=b.mat3f64.create();this.settings=q({},c,d);this.key=g.getKey(this.settings.type,this.settings.slicePlaneEnabled);this.writerSettings={variants:this.settings.strokesTexture.variants};this.createPrograms()}g.prototype.dispose=function(){for(var a in this.programs){var c=this.programs[a];c&&(this.programRepository.decreaseRefCount(c),this.programs[a]=null)}};g.prototype.addRenderable=
function(a){this.renderables.add(a)};g.prototype.removeRenderable=function(a){this.renderables.delete(a)};g.prototype.forEachRenderable=function(a){this.renderables.forEach(a)};g.prototype.bindRegularEdges=function(a,c){this.bind(this.programs.regular,a,c)};g.prototype.bindSilhouetteEdges=function(a,c){this.bind(this.programs.silhouette,a,c)};g.prototype.bind=function(a,c,b){this.rctx.bindProgram(a);a.setUniformMatrix4fv("uProj",c.proj);a.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ);
a.setUniform2f("uPixelToNDC",2/c.viewport[2],2/c.viewport[3]);a.setUniform2f("uNDCToPixel",c.viewport[2]/2,c.viewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",b.distanceFalloffFactor);a.setUniform2f("uViewportDimInv",1/c.viewport[2],1/c.viewport[3]);a.setUniform1f("uPixelRatio",c.pixelRatio||1)};g.prototype.renderRegularEdges=function(a,c,b){this.render(this.programs.regular,a,a.regular.vao,c,b)};g.prototype.renderSilhouetteEdges=function(a,c,b){this.render(this.programs.silhouette,a,a.silhouette.vao,
c,b)};g.prototype.render=function(a,c,b,e,f){this.setUniforms(a,c,e);a=this.rctx;a.bindVAO(b);a.capabilities.instancing.drawArraysInstanced(6,0,4,f)};g.prototype.setUniforms=function(a,c,b){c.components.buffer.textureBuffer.bind(a,d.componentDataBindParameters);a.setUniformMatrix4fv("uView",b.view);a.setUniformMatrix4fv("uModel",c.transform.modelMatrix);var f=b.viewInvTransp,g=l.mat3.fromMat4(this.tmpViewToWorldNormalMatrix,f);a.setUniform3f("uCameraPosition",f[3],f[7],f[11]);a.setUniformMatrix3fv("uViewToWorldNormalMatrix",
g);"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(b.fovY/2)/(b.viewport[3]/2));a.setUniform3fv("uLocalOrigin",c.transform.origin.vec3);this.settings.slicePlaneEnabled&&e.bindSlicePlane(c.transform.origin.vec3,b.slicePlane,a)};g.prototype.setSketchUniforms=function(a){var c=this.settings.strokesTexture,b=c.texture;this.rctx.bindTexture(b,0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",
1/b.descriptor.width,1/b.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",f.log2(c.resolution));a.setUniform1f("uStrokesNormalizationScale",c.normalizationScale);a.setUniform1f("uStrokesAmplitude",c.amplitude);a.setUniform1f("uStrokeVariants",c.variants)};g.prototype.getOptions=function(a){return q({},a,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.type,slice:this.settings.slicePlaneEnabled})};g.prototype.createPrograms=function(){var a=this.programRepository.getProgram(k.program,
this.getOptions({silhouette:!1})),c=this.programRepository.getProgram(k.program,this.getOptions({silhouette:!0}));this.programRepository.increaseRefCount(a);this.programRepository.increaseRefCount(c);this.programs={regular:a,silhouette:c}};g.getKey=function(a,c){return"edges-t:"+a+":"+c};return g}();d.EdgeRenderer=t;d.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}})},"esri/views/3d/webgl-engine/shaders/EdgeRendererPrograms":function(){define(["require",
"exports","./sources/resolver","../../../webgl/programUtils"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});var l=function(b){return g.glslifyDefineMap({MODE:{value:b.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:b.silhouette,ANTIALIASING:b.antialiasing,SLICE:b.slice})};d.program={name:"edges",shaders:function(b){return{vertexShader:l(b)+q.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:l(b)+q.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},
attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../support/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(t,d,q,g,l,b){function f(c,a){if(!c)return null;var b=c.length/2,f=e*b,b=Array(b),d=0;a=1===a;for(var g=0;g<
c.length;g+=2){var l=(c[g]+c[g+1])/2;a?b[d++]=Math.min(f,1-(1-l)*k):b[d++]=Math.min(f,l*k)}return b}Object.defineProperty(d,"__esModule",{value:!0});d.generateStrokesTexture=function(c){for(var a=d.strokesDefinition.resolution,e=a/2,k=new Uint8Array(4*a*a),n=4*a*e,e=d.strokesDefinition.amplitude,u=2*e,v=4*a,r=g.log2(a)+1,y=d.strokesDefinition.strokes.length,w=(r-1)*y*v,m=0,x=d.strokesDefinition.strokes;m<x.length;m++){for(var A=x[m],q=A.distance,A=A.pressure,B=w,E=0;E<r;E++){0!==E&&(q=f(q,0),A=f(A,
1));for(var t=0;t<d.strokesDefinition.resolution;t++){var G=A?A[t%A.length]:1;l.packFloatRGBA((q?q[t%q.length]/u:0)+.5,k,B);l.packFloatRGBA(G,k,B+n);B+=4}B-=v*(y+1)}w+=v}c=new b(c,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:a,height:a,wrapMode:10497},k);return{resolution:a,texture:c,normalizationScale:u,amplitude:e,variants:y}};var e=.1,k=.5;d.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,
-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,
.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,
.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,
-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,
.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,
.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,
.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,
-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,
-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,
1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,
.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,
-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,
.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,
.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,
.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,
.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,
4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,
3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,
.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,
.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,
.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,
.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,
.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,
1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,
-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,
.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,
2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,
.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,
.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,
.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,
-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,
1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,
.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,
-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,
.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,
.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,
.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,
.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,
4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,
.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,
-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],
pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,
.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,
.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,
.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../../../core/maybe","../../../../../core/typedArrayUtil"],function(t,d,q,g,l){function b(b,e){var f=
q.binaryIndexOf(b,e,!0);return-1===f?e<b[0]?0:b.length:f}Object.defineProperty(d,"__esModule",{value:!0});d.determineRendererType=function(b){for(var e=null,f=0;f<b.length;f++){var c=b[f],a=c.type;if(0<c.size*c.color[3]*c.opacity)if(g.isNone(e))e=a;else if(e!==a)return"uber"}return g.isSome(e)?e:"solid"};d.determineAllTransparent=function(b){if(0===b.length)return!0;for(var e=0;e<b.length;e++){var f=b[e].material;if(0<f.size*f.color[3]*f.opacity)return!1}return!0};d.cloneIndices=function(b){if(Uint16Array.from)return l.isUint16Array(b)?
Uint16Array.from(b):Uint32Array.from(b);for(var e=l.isUint16Array(b)?new Uint16Array(b.length):new Uint32Array(b.length),f=0;f<b.length;f++)e[f]=b[f];return e};d.estimateLengthAtDistance=function(b,e,d,c){return c/b*d*2*Math.tan(.5*e)};d.findLowerBoundIndex=b;d.computeEdgeCount=function(f,e,d){return f.length-b(f,e*d.minimumEdgeLength)};d.fillComponenBufferIndices=function(b,e,d,c){for(var a=0;a<b.length;a++){var f=b[a].index,g=e[a],k=e[a+1];if(c)for(;g<k;g++)d.set(c[g],f);else for(;g<k;g++)d.set(g,
f)}}})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ./SphericalHarmonics".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});var f=g.vec3f64.create();t=function(){function e(){this._renderLighting={main:{intensity:g.vec3f64.create(),direction:g.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],
g:[0],b:[0]}}};this._shOrder=2;this._oldDirection=g.vec3f64.create();this._oldSpecular=l.vec4f64.create();this._oldDiffuse=l.vec4f64.create();this._oldAmbient=l.vec4f64.create()}e.prototype.setUniforms=function(b,c){void 0===c&&(c=!1);c||b.getDefine("GROUND_NORMAL_SHADING")?b.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):b.setUniform1f("lightingFixedFactor",0);b.setUniform1f("lightingGlobalFactor",this._info.globalFactor);b.setUniform3fv("lightingMainDirection",
this._renderLighting.main.direction);b.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);b.setUniform1f("ambientBoostFactor",.4);c=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?b.setUniform3f("lightingAmbientSH0",c.r[0],c.g[0],c.b[0]):1===this._shOrder?(b.setUniform4f("lightingAmbientSH_R",c.r[0],c.r[1],c.r[2],c.r[3]),b.setUniform4f("lightingAmbientSH_G",c.g[0],c.g[1],c.g[2],c.g[3]),b.setUniform4f("lightingAmbientSH_B",c.b[0],c.b[1],c.b[2],c.b[3])):2===this._shOrder&&
(b.setUniform3f("lightingAmbientSH0",c.r[0],c.g[0],c.b[0]),b.setUniform4f("lightingAmbientSH_R1",c.r[1],c.r[2],c.r[3],c.r[4]),b.setUniform4f("lightingAmbientSH_G1",c.g[1],c.g[2],c.g[3],c.g[4]),b.setUniform4f("lightingAmbientSH_B1",c.b[1],c.b[2],c.b[3],c.b[4]),b.setUniform4f("lightingAmbientSH_R2",c.r[5],c.r[6],c.r[7],c.r[8]),b.setUniform4f("lightingAmbientSH_G2",c.g[5],c.g[6],c.g[7],c.g[8]),b.setUniform4f("lightingAmbientSH_B2",c.b[5],c.b[6],c.b[7],c.b[8]));b.setUniform3fv("lightDirection",this._oldDirection)};
e.prototype.set=function(e){this._info=e;b.combineLights(e.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics);q.vec3.negate(this._oldDirection,this._renderLighting.main.direction);e=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*e;this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*e;this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*e;this._oldAmbient[3]=1;this._oldDiffuse[0]=
this._renderLighting.main.intensity[0]*e;this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*e;this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*e;this._oldDiffuse[3]=1;e=q.vec3.copy(f,this._oldDiffuse);q.vec3.scale(e,e,.4*this._info.globalFactor);q.vec3.add(this._oldAmbient,this._oldAmbient,e)};Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});e.prototype.getOld=function(){return{ambient:this._oldAmbient,
diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}};return e}();d.SceneLighting=t})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ../lib/LongVectorMath ./Lightsources".split(" "),function(t,d,q,g,l,b,f){function e(a){return(a+1)*(a+1)}function k(a){return l.clamp(Math.floor(Math.sqrt(a)-1),0,2)}function c(a,
c,b){var f=a[0],d=a[1];a=a[2];b=b||[];b.length=e(c);0<=c&&(b[0]=.28209479177);1<=c&&(b[1]=.4886025119*f,b[2]=.4886025119*a,b[3]=.4886025119*d);2<=c&&(b[4]=1.09254843059*f*d,b[5]=1.09254843059*d*a,b[6]=.31539156525*(3*a*a-1),b[7]=1.09254843059*f*a,b[8]=.54627421529*(f*f-d*d));return b}function a(a,c){a=e(a);c=c||{r:[],g:[],b:[]};c.r.length=c.g.length=c.b.length=a;for(var b=0;b<a;b++)c.r[b]=c.g[b]=c.b[b]=0;return c}function h(a,e){for(var f=k(e.r.length),d=0;d<a.length;d++){var g=a[d];q.vec3.negate(w,
g.direction);c(w,f,r);b.elementwiseProduct(r,m);b.scalarProduct(r,g.intensity[0],y);b.add(e.r,y);b.scalarProduct(r,g.intensity[1],y);b.add(e.g,y);b.scalarProduct(r,g.intensity[2],y);b.add(e.b,y)}return e}function p(a,b){c(w,0,r);for(var e=0;e<a.length;e++){var f=a[e];b.r[0]+=r[0]*m[0]*f.intensity[0]*4*Math.PI;b.g[0]+=r[0]*m[0]*f.intensity[1]*4*Math.PI;b.b[0]+=r[0]*m[0]*f.intensity[2]*4*Math.PI}return b}Object.defineProperty(d,"__esModule",{value:!0});d.numberOfCoefficients=e;d.numberOfCoefficientsInBand=
function(a){return 2*a+1};d.orderFromNumberOfCoefficients=k;d.computeCoefficients=c;d.initSHCoefficients=a;d.projectFillLights=h;d.projectAmbientLights=p;d.combineLights=function(c,e,d,g){a(e,g.sh);q.vec3.set(d.intensity,0,0,0);var k=!1,m=n,l=u;e=v;m.length=0;l.length=0;for(var r=e.length=0;r<c.length;r++){var x=c[r];x instanceof f.MainLight&&!k?(q.vec3.copy(d.direction,x.direction),d.intensity[0]=x.intensity[0],d.intensity[1]=x.intensity[1],d.intensity[2]=x.intensity[2],d.castShadows=x.castShadows,
k=!0):x instanceof f.MainLight||x instanceof f.FillLight?m.push(x):x instanceof f.AmbientLight?l.push(x):x instanceof f.SphericalHarmonicsLight&&e.push(x)}h(m,g.sh);p(l,g.sh);for(c=0;c<e.length;c++)x=e[c],b.add(g.sh.r,x.sh.r),b.add(g.sh.g,x.sh.g),b.add(g.sh.b,x.sh.b)};var n=[],u=[],v=[],r=[0],y=[0],w=g.vec3f64.create(),m=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(t,
d){Object.defineProperty(d,"__esModule",{value:!0});d.dotProduct=function(d,g){for(var l=0,b=0;b<d.length;b++)l+=d[b]*g[b];return l};d.elementwiseProduct=function(d,g,l){l=l||d;l.length=d.length;for(var b=0;b<d.length;b++)l[b]=d[b]*g[b];return l};d.scalarProduct=function(d,g,l){l=l||d;l.length=d.length;for(var b=0;b<d.length;b++)l[b]=d[b]*g;return l};d.add=function(d,g,l){l=l||d;l.length=d.length;for(var b=0;b<d.length;b++)l[b]=d[b]+g[b];return l}})},"esri/views/webgl/Profiling":function(){define(["require",
"exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.startMeasurement=function(d){return(d=d.capabilities.disjointTimerQuery)?new q(d):null};d.getTimestamp=function(d,l,b){void 0===b&&(b=50);var f=d.capabilities.disjointTimerQuery;if(!f||0>=f.timestampBits())return null;var e=f.createQuery();f.createTimestamp(e);var g=function(){var c=f.resultAvailable(e),a=f.disjoint();c&&!a?(c=f.getResult(e),l(c/1E6)):a?l():setTimeout(g,b)};g()};d.supportsTimestamps=function(d){d=d.capabilities.disjointTimerQuery;
if(!d)return!1;d=d.timestampBits();console.log({bits:d});return 0<d};var q=function(){function d(d){this.timer=d;this.query=d.createQuery();this.timer.beginTimeElapsed(this.query)}d.prototype.stop=function(d,b){void 0===b&&(b=50);this.cb=d;this.checkInterval=b;this.timer.endTimeElapsed();this.checkQueryResult()};d.prototype.checkQueryResult=function(){var d=this.timer.resultAvailable(this.query),b=this.timer.disjoint();d&&!b?(d=this.timer.getResult(this.query),this.cb(d/1E6)):b?this.cb():setTimeout(this.checkQueryResult.bind(this),
this.checkInterval)};return d}()})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/ColorPrograms ../../../webgl/renderState".split(" "),function(t,d,q,g,l,b,f,e,k,c,a,h){t=function(a){function b(c,b){b=a.call(this,b)||this;b.supportsEdges=!0;b.params=
k.copyParameters(c,u);return b}q(b,a);b.prototype.setParameterValues=function(a){var c=this.params,b;for(b in a)c[b]=a[b];this.notifyDirty("matChanged")};b.prototype.getParameters=function(){return this.params};b.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};b.prototype.getColor=function(){return this.params.color};b.prototype.setTransparent=function(a){this.params.transparent=a;this.notifyDirty("matChanged")};b.prototype.getTransparent=function(){return this.params.transparent};
b.prototype.intersect=function(a,c,b,e,f,d,g,h,m){k.intersectTriangleGeometry(a,c,b,e,f,d,g,m)};b.prototype.getGLMaterials=function(){return{color:p,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:n}};b.prototype.getAllTextureIds=function(){return[]};b.prototype.createBufferWriter=function(){return new r};b.prototype.createRenderer=function(a,b){return new c(a,b,this)};return b}(b);var p=function(c){function b(a,b,e){a=c.call(this,a,b)||this;a.updateParameters();return a}q(b,c);b.prototype.updateParameters=
function(){this.params=k.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.selectProgram=function(){var c=this.params;this.program=this.programRep.getProgram(a.colorPass,{vertexColors:c.vertexColors,slice:c.slicePlaneEnabled});this.pipelineState=h.makePipelineState({blending:c.transparent&&h.separateBlendingParams(770,1,771,771),polygonOffset:c.polygonOffset&&y,culling:w(c.cullFace),depthTest:c.testDepth&&{func:513},depthWrite:c.writeDepth&&h.defaultDepthWriteParams,
colorWrite:h.defaultColorWriteParams})};b.prototype.beginSlot=function(a){var c=4;this.params.transparent&&(c=this.params.writeDepth?6:9);return a===c};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,c){c=this.program;var b=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);c.setUniform4fv("eColor",b.color)};b.prototype.release=function(a){};b.prototype.bindView=function(a,c){a=this.program;var b=this.params;k.bindView(c.origin,c.view,a);b.slicePlaneEnabled&&
k.bindSlicePlane(c.origin,c.slicePlane,a)};b.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};b.prototype.getDrawMode=function(){return 4};return b}(l),n=function(c){function b(a,b,e){a=c.call(this,a,b)||this;a.updateParameters();return a}q(b,c);b.prototype.updateParameters=function(){this.params=k.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.selectProgram=function(){var c=this.params;this.program=this.programRep.getProgram(a.colorPass,
{vertexColors:c.vertexColors,slice:c.slicePlaneEnabled});this.pipelineState=h.makePipelineState({polygonOffset:c.polygonOffset&&y,culling:w(c.cullFace),depthTest:c.testDepth&&{func:513},depthWrite:c.writeDepth&&h.defaultDepthWriteParams,colorWrite:h.defaultColorWriteParams})};b.prototype.beginSlot=function(a){return 4===a};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,c){var b=this.program,e=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);k.bindHighlightRendering(a,
c,b);b.setUniform4fv("eColor",e.color)};b.prototype.release=function(a){};b.prototype.bindView=function(a,c){a=this.program;var b=this.params;k.bindView(c.origin,c.view,a);b.slicePlaneEnabled&&k.bindSlicePlane(c.origin,c.slicePlane,a)};b.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};b.prototype.getDrawMode=function(){return 4};return b}(l),u={color:[1,1,1,1],transparent:!1,writeDepth:!0,testDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,
cullFace:"none"},v=g.newLayout().vec3f(f.VertexAttrConstants.POSITION).vec4u8(f.VertexAttrConstants.COLOR),r=function(){function a(){this.vertexBufferLayout=v}a.prototype.allocate=function(a){return v.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[f.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,b,f,d){e.writeDefaultAttributes(c,b,v,a.transformation,a.invTranspTransformation,f,d)};return a}(),y={factor:1,units:1},w=function(a){return"none"!==a&&{face:"front"===
a?1028:1029,mode:2305}};return t})},"esri/views/3d/webgl-engine/shaders/ColorPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=function(b){return l.glslifyDefineMap({VERTEX_COLORS:b.vertexColors,SLICE:b.slice})};d.colorPass={name:"color-color",shaders:function(f){return{vertexShader:b(f)+g.resolveIncludes("materials/color/color.vert"),
fragmentShader:b(f)+g.resolveIncludes("materials/color/color.frag")}},attributes:q.Default3D}})},"esri/views/3d/webgl-engine/shaders/MiscPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.blendLayers={name:"blend-layers",shaders:{vertexShader:g.resolveIncludes("misc/blendLayers.vert"),fragmentShader:g.resolveIncludes("misc/blendLayers.frag")},attributes:q.Default3D};d.texOnly=
{name:"tex-only",shaders:{vertexShader:g.resolveIncludes("misc/texOnly.vert"),fragmentShader:g.resolveIncludes("misc/texOnly.frag")},attributes:q.Default3D}})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","../../../../core/compilerUtils","./Util"],function(t,d,q,g){var l=function(){function b(b){this.refCnt=0;this.glMaterial=b}b.prototype.incRefCnt=function(){++this.refCnt};b.prototype.decRefCnt=function(){--this.refCnt;g.assert(0<=this.refCnt)};b.prototype.getRefCnt=
function(){return this.refCnt};b.prototype.getGLMaterial=function(){return this.glMaterial};return b}();t=function(){function f(b,f){this._textureRep=b;this._programRep=f;this._id2glMaterialRef=new Map}f.prototype.aquire=function(b,f){var c=b.id+"_"+f,a=this._id2glMaterialRef.get(c);null==a?(b=(a=b.getGLMaterials()[f])?new a(b,this._programRep,this._textureRep):void 0,a=new l(b),this._id2glMaterialRef.set(c,a)):b=a.getGLMaterial();a.incRefCnt();b&&this.increaseProgramReferences(b);return b};f.prototype.release=
function(b,f){b=b+"_"+f;f=this._id2glMaterialRef.get(b);f.decRefCnt();if(0===f.getRefCnt()){if(f=f.getGLMaterial())this.decreaseProgramReferences(f),f.dispose();this._id2glMaterialRef.delete(b)}};f.prototype.updateMaterialParameters=function(e){for(var f=0,c=b;f<c.length;f++){var a=this._id2glMaterialRef.get(e+"_"+c[f]);a&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())}};f.prototype.updateParamsForMat=function(b){b.updateParameters&&(this.decreaseProgramReferences(b),b.updateParameters(),
this.increaseProgramReferences(b))};f.prototype.increaseProgramReferences=function(b){b=b.getPrograms();for(var e=this._programRep,c=0;c<b.length;c++)e.increaseRefCount(b[c])};f.prototype.decreaseProgramReferences=function(b){b=b.getPrograms();for(var e=this._programRep,c=0;c<b.length;c++)e.decreaseRefCount(b[c])};return f}();var b=q.tuple("color","depth","depthShadowMap","normal","highlight");return t})},"esri/views/3d/webgl-engine/lib/GLTextureRep":function(){define(["require","exports","../../../../core/Logger",
"./Util","../../../webgl/Texture"],function(t,d,q,g,l){var b=q.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep");t=function(){function f(b,f,c,a){this.NUM_PARALLEL=8;this._fallbackTextureTransparent=this._fallbackTexture=null;this.textures=b;this._programRepository=f;this.getViewportToRestore=c;this._rctx=a;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=a.capabilities.textureFilterAnisotropic)?a.parameters.maxMaxAnisotropy:
1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._needsRender=!0;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(b=0;b<this._fallbackTextureData.length;++b)this._fallbackTextureData[b]=255,this._fallbackTextureTransparentData[b]=0!==(b+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}f.prototype.resetNeedsRender=function(){this._needsRender=!1};
f.prototype.needsRender=function(){return this._needsRender};f.prototype.aquire=function(e,d,c){var a=this,h=this.id2textureRef[e];if(null==h){var k=this.textures[e];g.assert(void 0!==k);k.setUnloadFunc(this._unload.bind(this));d=!0===d;var l=this._createGLTextureDescription(k),h=new f.TextureRef(null);g.assert(null==this.id2textureRef[e]);this.id2textureRef[e]=h;if(k.initializeThroughRender)e=k.initializeThroughRender(this._rctx,l),h.setGLTexture(e),c&&c(h);else if(k.deferredLoading())this.getLoadingCount()<
this.NUM_PARALLEL?this._loadImage(e,l,c):this._queue.push([e,l,c]);else try{k.initializeThroughUpload(this._rctx,l,this._programRepository,this.getViewportToRestore(),function(b){h.setGLTexture(b);a._needsRender=!0;c&&c(h)})}catch(u){b.error("#aquire","Error loading texture: "+u.toString())}null==h.getGLTexture()&&h.setGLTexture(d?this.fallbackTextureTransparent:this.fallbackTexture);this._needsRender=!0}h.incRefCnt();return h};f.prototype.release=function(b){b=this.id2textureRef[b];void 0!==b&&(b.decRefCnt(),
g.assert(0<=b.getRefCnt()))};f.prototype.getLoadingCount=function(){return Object.keys(this.loading).length};f.prototype.getTexture=function(b){return this.textures[b]};f.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};f.prototype._unload=function(b){var e=this.id2textureRef[b];void 0!==e&&((e=e.getGLTexture())&&e.dispose(),delete this.id2textureRef[b]);this.next(b)};f.prototype._createGLTextureDescription=function(b){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&
b.params&&b.params.mipmap&&!b.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:b.params&&b.params.wrap}};f.prototype.next=function(b){if(b in this.loading){delete this.loading[b];var e=Object.keys(this.id2textureRef),c=Object.keys(this.loading);this.listeners.forEach(function(a){a(b,e,c)});this.processQueue()}};f.prototype._loadImage=function(b,f,c){var a=this;g.assert(null==this.loading[b]);this.loading[b]=!0;var e=this.textures[b];g.assert(void 0!==e);setTimeout(function(){var d=a.id2textureRef[b];
d&&d.getRefCnt()&&e.initializeThroughUpload(a._rctx,f,a._programRepository,a.getViewportToRestore(),function(e){a.next(b);a._needsRender=!0;d&&d.getRefCnt()&&(d.setGLTexture(e),c&&c(d))})},0)};f.prototype.processQueue=function(){for(var b=[],f=0;f<this._queue.length;++f){var c=this._queue[f][0],a=this.id2textureRef[c];void 0!==a&&(0===a.getRefCnt()?(a.getGLTexture().dispose(),delete this.id2textureRef[c]):b.push(this._queue[f]))}this._queue=b;b=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,
this._queue.length);for(f=0;f<b;++f)this._loadImage(this._queue[f][0],this._queue[f][1],this._queue[f][2]);this._queue.splice(0,b)};Object.defineProperty(f.prototype,"fallbackTexture",{get:function(){this._fallbackTexture||(this._fallbackTexture=new l(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));return this._fallbackTexture},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"fallbackTextureTransparent",{get:function(){this._fallbackTextureTransparent||(this._fallbackTextureTransparent=
new l(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData));return this._fallbackTextureTransparent},enumerable:!0,configurable:!0});return f}();(function(b){var e=function(){function b(c){this._glTexture=null;this._refCount=0;this._glTexture=c}b.prototype.incRefCnt=function(){++this._refCount};b.prototype.decRefCnt=function(){--this._refCount;g.assert(0<=this._refCount)};b.prototype.getRefCnt=function(){return this._refCount};b.prototype.setGLTexture=function(c){this._glTexture=
c};b.prototype.getGLTexture=function(){return this._glTexture};return b}();b.TextureRef=e})(t||(t={}));return t})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util","../../../webgl/programUtils"],function(t,d,q,g){return function(){function d(b,f){void 0===f&&(f="");this._rctx=b;this._shaderPrefix=f;this._programCacheByTemplate=new Map;this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],
viewportPixelSz:[],lightingMainDirection:[]}}d.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(b){b.programs.forEach(function(b){b.dispose()})});this._rctx=this._commonUniforms=this._programRefCount=this._programCacheByTemplate=null};d.prototype.getProgram=function(b,f){var e=this;this._programCacheByTemplate.has(b)||this.addProgramTemplate(b,function(f){return g.createProgram(e._rctx,b,f,e._shaderPrefix)});return this.getProgramTemplateInstance(b,f)};d.prototype.addProgramTemplate=
function(b,f){this._programCacheByTemplate.set(b,{constructor:f,programs:new Map})};d.prototype.getProgramTemplateInstance=function(b,f){if(b=this._programCacheByTemplate.get(b)){var e=f?JSON.stringify(f):"default";b.programs.has(e)||(f=b.constructor(f),b.programs.set(e,f));return b.programs.get(e)}return null};d.prototype.getProgramsUsingUniform=function(b){return this._commonUniforms[b]||[]};d.prototype.increaseRefCount=function(b){var f=b.id;this._programRefCount[f]?this._programRefCount[f]++:
(this._programRefCount[f]=1,this._findCommonUniforms(b))};d.prototype.decreaseRefCount=function(b){var f=b.id;1<this._programRefCount[f]?this._programRefCount[f]--:(this._forgetCommonUniforms(b),this._programRefCount[f]=0)};d.prototype._findCommonUniforms=function(b){for(var f in this._commonUniforms)b.hasUniform(f)&&(q.assert(-1===this._commonUniforms[f].indexOf(b),"common uniforms of program have already been determined"),this._commonUniforms[f].push(b))};d.prototype._forgetCommonUniforms=function(b){for(var f in this._commonUniforms){var e=
this._commonUniforms[f],d=e.indexOf(b);-1<d&&(e[d]=e[e.length-1],e.pop())}};return d}()})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});var l=null,b=[];d.enabled=!1;d.begin=function(){d.enabled&&(l=[])};d.trace=function(b){d.enabled&&null!=l&&l.push(b)};d.end=function(){if(d.enabled){var f=l;l=null;f&&(b.forEach(function(b){return b(f)}),
b.length=0);return f}};d.instrumentContext=function(b){return d.enabled?g.default(b)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),b):q.makeDebugContext(b,void 0,function(b,f){d.enabled&&l&&l.push("gl."+b+"("+q.glFunctionArgsToString(b,f)+")")}):b};d.request=function(f){b.push(f)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function t(a){if(null==k){k={};c={};for(var b in a)"number"==typeof a[b]&&(k[a[b]]=b,c[b]=a[b])}}function d(){if(null==
k)throw"WebGLDebugUtils.init(ctx) not called";}function q(a){d();var b=k[a];return void 0!==b?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function g(a,b,f,d){a=e[a];if(void 0!==a&&(a=a[b],void 0!==a&&a[f])){if("object"===typeof a[f]&&void 0!==a[f].enumBitwiseOr){b=a[f].enumBitwiseOr;f=0;a=[];for(var g=0;g<b.length;++g){var h=c[b[g]];0!==(d&h)&&(f|=h,a.push(q(h)))}return f===d?a.join(" | "):q(d)}return q(d)}return null===d?"null":void 0===d?"undefined":d.toString()}function l(a,b,c){a.__defineGetter__(c,
function(){return b[c]});a.__defineSetter__(c,function(a){b[c]=a})}function b(a,c,e,f){function d(a,b){return function(){e&&e(b,arguments);var d=a[b].apply(a,arguments),g=f.getError();0!=g&&(h[g]=!0,c(g,b,arguments));return d}}f=f||a;t(a);c=c||function(a,b,c){for(var e="",f=c.length,d=0;d<f;++d)e+=(0==d?"":", ")+g(b,f,d,c[d]);a="WebGL error "+q(a)+" in "+b+"("+e+")";window.console&&window.console.error?window.console.error(a):window.console&&window.console.log&&window.console.log(a)};var h={},k={},
p;for(p in a)if("function"==typeof a[p])if("getExtension"!=p)k[p]=d(a,p);else{var n=d(a,p);k[p]=function(){var d=n.apply(a,arguments);return b(d,c,e,f)}}else l(k,a,p);k.getError=function(){for(var b in h)if(h.hasOwnProperty(b)&&h[b])return h[b]=!1,b;return a.NO_ERROR};return k}function f(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);for(var e=0;e<b;++e)a.disableVertexAttribArray(e),a.vertexAttribPointer(e,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(e,0);a.deleteBuffer(c);
b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(e=0;e<b;++e)a.activeTexture(a.TEXTURE0+e),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);
a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,
a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var e={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},
getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,
2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,
1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,
2:!0}},blendEquationEXT:{1:{0:!0}}},k=null,c=null;return{init:t,mightBeEnum:function(a){d();return void 0!==k[a]},glEnumToString:q,glFunctionArgToString:g,glFunctionArgsToString:function(a,b){for(var c="",e=b.length,f=0;f<e;++f)c+=(0==f?"":", ")+g(a,e,f,b[f]);return c},makeDebugContext:b,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function c(){for(var a=Object.keys(F),b=0;b<a.length;++b)delete F[a]}function e(){++t;q||E==t&&
a.loseContext()}function d(a,b){var c=a[b];return function(){e();if(!q)return c.apply(a,arguments)}}function g(a){return{statusMessage:a,preventDefault:function(){G=!0}}}function k(a){for(var b in a)"function"==typeof a[b]?w[b]=d(a,b):l(w,a,b);w.getError=function(){e();if(!q)for(var a;a=y.getError();)F[a]=!0;for(a in F)if(F[a])return delete F[a],a;return w.NO_ERROR};var c="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(b=0;b<c.length;++b){var f=
c[b];w[f]=function(b){return function(){e();if(q)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=A;B.push(c);return c}}(a[f])}c="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");for(b=0;b<c.length;++b)f=
c[b],w[f]=function(b){return function(){e();return q?null:b.apply(a,arguments)}}(w[f]);c="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(b=0;b<c.length;++b)f=c[b],w[f]=function(b){return function(){e();return q?!1:b.apply(a,arguments)}}(w[f]);w.checkFramebufferStatus=function(b){return function(){e();return q?w.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(w.checkFramebufferStatus);w.getAttribLocation=function(b){return function(){e();return q?-1:b.apply(a,
arguments)}}(w.getAttribLocation);w.getVertexAttribOffset=function(b){return function(){e();return q?0:b.apply(a,arguments)}}(w.getVertexAttribOffset);w.isContextLost=function(){return q};return w}var y,w,m=[],x=[];w={};var A=1,q=!1,B=[],E=0,t=0,G=!1,L=0,F={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=y){if(y)throw"got different context";y=c;w=k(y)}return w}return c}}(a.getContext);(function(a){var c=a.addEventListener;a.addEventListener=
function(e,f,d){switch(e){case "webglcontextlost":m.push(b(f));break;case "webglcontextrestored":x.push(b(f));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!q){q=!0;E=0;for(++A;y.getError(););c();F[y.CONTEXT_LOST_WEBGL]=!0;var b=g("context lost"),e=m.slice();setTimeout(function(){for(var c=0;c<e.length;++c)e[c](b);0<=L&&setTimeout(function(){a.restoreContext()},L)},0)}};a.restoreContext=function(){q&&x.length&&setTimeout(function(){if(!G)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<B.length;++a){var b=B[a];b instanceof WebGLBuffer?y.deleteBuffer(b):b instanceof WebGLFramebuffer?y.deleteFramebuffer(b):b instanceof WebGLProgram?y.deleteProgram(b):b instanceof WebGLRenderbuffer?y.deleteRenderbuffer(b):b instanceof WebGLShader?y.deleteShader(b):b instanceof WebGLTexture&&y.deleteTexture(b)}f(y);q=!1;t=0;G=!1;for(var a=x.slice(),b=g("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(q)throw"You can not ask a lost contet to be lost";
E=t+a};a.getNumCalls=function(){return t};a.setRestoreTimeout=function(a){L=a};return a},resetToInitialState:f}})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.default=function(d){return window.WebGL2RenderingContext&&d instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/parts/Viewport":function(){define("require exports ../../../../core/has ../../../../core/now ../../../../core/libs/gl-matrix-2/vec3f64 ../lib/Camera ../lib/Renderer".split(" "),
function(t,d,q,g,l,b,f){var e={fbo:null,lightDirection:null,camera:null,disableSlice:!1};return function(){function d(c,a,e,d,g){this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,renderTimeTotal:0,renderTimeLast:0,frameCount:0};this._needsRender=!0;this._rctx=g;this._renderer=new f(a,e,d,g,"scene",c);this._camera=new b(l.vec3f64.fromValues(0,100,-100))}Object.defineProperty(d.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0});
d.prototype.getCombinedStats=function(){var b=this._rctx.gl,a={},e=this._renderer.getCombinedStats(),f;for(f in e)a[f]=e[f];a.renderGeometriesTotal=this._stats.renderGeometriesTotal;a.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==b.getUsedTextureMemory&&(a.textureMemory=b.getUsedTextureMemory());void 0!==b.getUsedRenderbufferMemory&&(a.renderbufferMemory=b.getUsedRenderbufferMemory());void 0!==b.getUsedVBOMemory&&(a.VBOMemory=b.getUsedVBOMemory());if(void 0!==b.getUsedTextureMemoryStats){var b=
b.getUsedTextureMemoryStats(),d;for(d in b)a["texMem type: "+d]=b[d]}return a};d.prototype.dispose=function(){this._renderer.dispose();this._renderer=null};d.prototype.setLighting=function(b){this._renderer.setLighting(b)};d.prototype.setRenderParams=function(b){this._renderer.setRenderParams(b)};d.prototype.getRenderParams=function(){return this._renderer.getRenderParams()};d.prototype.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};Object.defineProperty(d.prototype,"hasSlicePlane",
{get:function(){return this._renderer.hasSlicePlane},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"edgeView",{get:function(){return this._renderer.edgeView},enumerable:!0,configurable:!0});d.prototype.modify=function(b,a,e,f){this._renderer.modify(b,a,e,f)};d.prototype.setCamera=function(b){this._camera.copyFrom(b);this._needsRender=!0};d.prototype.getCamera=function(){return this._camera};Object.defineProperty(d.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},
enumerable:!0,configurable:!0});d.prototype.getFramebufferTexture=function(b){return this._renderer.getFramebufferTexture(b)};d.prototype.render=function(b){e.camera=b.camera||this._camera;e.fbo=b.fbo;e.lightDirection=b.lightDirection;e.disableSlice=b.disableSlice||!1;this._renderer.render(e)};d.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderer.resetNeedsRender()};d.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()};Object.defineProperty(d.prototype,
"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0});d.prototype.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};return d}()})},"esri/views/3d/webgl-engine/shaders/globalOptions":function(){define(["require","exports","../../../webgl/programUtils"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.glslifyGlobalOptions=function(d){return q.glslifyDefineMap({VIEWING_MODE:{value:d.viewingMode,options:{global:"VIEWING_MODE_GLOBAL",
local:"VIEWING_MODE_LOCAL"}}})}})},"esri/views/support/screenshotUtils":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils"],function(t,d,q,g){function l(a,b){var c=a||{},f=c.format,d=c.quality,h=c.rotation,c=c.disableSlice,l=b.padding||u,r;r=b.width-l.left-l.right;b=b.height-l.top-l.bottom;var v=l=0,q=r,t=b;if(a&&a.area){var l=Math.floor(a.area.x)||0,v=Math.floor(a.area.y)||0,G=null!=a.area.width?Math.floor(a.area.width):null,L=null!=a.area.height?
Math.floor(a.area.height):null,q=q-l,t=t-v;null!=G&&null!=L?(q=Math.min(q,G),t=Math.min(t,L)):null==G&&null!=L?(G=Math.min(q,G),t*=G/q,q=G):null!=G&&null==L&&(G=Math.min(t,L),q*=G/t,t=G)}l=k({x:l,y:v,width:q,height:t},a);v=Math.floor(Math.max(l.x,0));q=Math.floor(Math.max(l.y,0));r={x:v,y:q,width:Math.floor(Math.min(l.width,r-v)),height:Math.floor(Math.min(l.height,b-q))};b=r.width/r.height;l=l.width/l.height;l!==b&&(l>b?(b=Math.floor(r.width/l),r={x:r.x,y:Math.floor(r.y+(r.height-b)/2),width:r.width,
height:b}):(b=Math.floor(r.height*l),r={x:Math.floor(r.x+(r.width-b)/2),y:r.y,width:b,height:r.height}));b=e(a,r);a=b.width;b=b.height;a:switch(f){case "png":case "jpg":case "jpeg":break a;case null:case void 0:f=p;break a;default:g.neverReached(f),f=p}l=n[f];d=null!=d?d:l;return{format:f,quality:0>d?0:100<d?100:d,area:r,width:a,height:b,rotation:h,disableSlice:c||!1}}function b(a,b){return a.toDataURL(h[b.format],b.quality/100)}function f(a,b,e){e||(c||(c=document.createElement("canvas"),c.width=
1,c.height=1),e=c);return e.getContext("2d").createImageData(a,b)}function e(a,b){if(!a)return b;var c=a.width;a=a.height;if(null!=c&&null!=a)return{width:Math.floor(c),height:Math.floor(a)};if(null==c&&null==a)return b;b=b.width/b.height;return null==a?{width:Math.floor(c),height:Math.floor(c/b)}:{width:Math.floor(a*b),height:Math.floor(a)}}function k(a,b){if(!b||null==b.width||null==b.height)return a;b=b.width/b.height;var c=a.width/a.height;if(c===b)return a;if(c<b)return a.width=Math.floor(a.height*
b),a.height=a.height,a;a.width=a.width;a.height=Math.floor(a.width/b);return a}Object.defineProperty(d,"__esModule",{value:!0});d.completeUserSettings=l;d.toRenderSettings=function(a,b){var c=l(a,b),e=c.area,f=c.width/e.width,d=b.padding,g=d.left+d.right,h=d.top+d.bottom;return{framebufferWidth:Math.floor((b.width-g)*f+g),framebufferHeight:Math.floor((b.height-h)*f+h),region:{x:Math.floor(e.x*f)+d.left,y:Math.floor(e.y*f)+d.top,width:c.width,height:c.height},format:c.format,quality:c.quality,rotation:c.rotation,
pixelRatio:f,layers:a&&a.layers?a.layers:[],disableSlice:c.disableSlice}};d.encodeResult=function(a,c,e,f){if(f.premultipliedAlpha)for(var d=a.data,g=d.length,h=0;h<g;h+=4){var k=d[h+3];0<k&&(k/=255,d[h+0]/=k,d[h+1]/=k,d[h+2]/=k)}e.width=a.width;e.height=a.height;d=e.getContext("2d");d.putImageData(a,0,0);f.flipY&&(d.save(),d.globalCompositeOperation="copy",d.scale(1,-1),d.translate(0,-d.canvas.height),d.drawImage(d.canvas,0,0),d.restore());a=d.getImageData(0,0,a.width,a.height);c=b(e,c);e.width=
0;e.height=0;return{dataUrl:c,data:a}};d.toDataUrl=b;d.createEmptyImageData=function(b,c,e){if(!b||!c)throw Error("Cannot construct image data without dimensions");if(a)try{return new ImageData(b,c)}catch(w){a=!1}return f(b,c,e)};d.wrapImageData=function(b,c,e,d){if(!c||!e)throw Error("Cannot construct image data without dimensions");if(a)try{return new ImageData(b,c,e)}catch(m){a=!1}c=f(c,e,d);c.data.set(b,0);return c};d.resampleHermite=function(a,b,c,e,f,d,g,h){void 0===e&&(e=0);void 0===f&&(f=
0);void 0===d&&(d=a.width-e);void 0===g&&(g=a.height-f);void 0===h&&(h=!1);var k=a.data,m=b.width,l=b.height,p=b.data;d/=m;g/=l;var n=Math.ceil(d/2),r=Math.ceil(g/2);a=a.width;for(var v=0;v<l;v++)for(var u=0;u<m;u++){for(var x=4*(u+(h?l-v-1:v)*m),w=0,A=0,y=0,q=0,C=0,t=0,J=(v+.5)*g,R=Math.floor(v*g);R<(v+1)*g;R++)for(var T=Math.abs(J-(R+.5))/r,W=(u+.5)*d,T=T*T,Z=Math.floor(u*d);Z<(u+1)*d;Z++){var fa=Math.abs(W-(Z+.5))/n,fa=Math.sqrt(T+fa*fa);if(!(1<=fa)){var fa=2*fa*fa*fa-3*fa*fa+1,ga=4*(e+Z+(f+R)*
a),t=t+fa*k[ga+3],A=A+fa;!c&&255>k[ga+3]&&(fa=fa*k[ga+3]/255);y+=fa*k[ga];q+=fa*k[ga+1];C+=fa*k[ga+2];w+=fa}}p[x]=y/w;p[x+1]=q/w;p[x+2]=C/w;p[x+3]=t/A}return b};d.screenshotSuperSampleSettings=function(a,b){if(!b)return a;b=a.framebufferWidth;var c=a.framebufferHeight,e=a.region,f=Math.min(8,2048/Math.max(b,c));return 1.5>f?a:q({},a,{framebufferWidth:Math.round(b*f),framebufferHeight:Math.round(c*f),pixelRatio:a.pixelRatio*f,resample:{region:{x:Math.round(e.x*f),y:Math.round(e.y*f),width:Math.round(e.width*
f),height:Math.round(e.height*f)},width:b,height:c}})};var c=null,a=!0,h={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},p="jpg",n={png:100,jpg:98,jpeg:98},u={top:0,right:0,bottom:0,left:0}})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ./enums ./InstanceCounter ./renderState ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(t,d,q,g,l,b,f,e){return function(){function d(c,a){var d=this;this.gl=null;this._blendEnabled=!1;this._blendColorState=
{r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=
this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=
f.default(c)?"webgl2":"webgl";this.gl=c;c instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=e.loadCapabilities(c,a);c=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:c[0],y:c[1],width:c[2],height:c[3]};c=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),
maxMaxAnisotropy:c?this.gl.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)};this._stateTracker=new b.StateTracker({setBlending:function(a){a?(d.setBlendingEnabled(!0),d.setBlendEquationSeparate(a.opRgb,a.opAlpha),d.setBlendFunctionSeparate(a.srcRgb,a.dstRgb,a.srcAlpha,a.dstAlpha),a=a.color,d.setBlendColor(a.r,a.g,a.b,a.a)):d.setBlendingEnabled(!1)},setCulling:function(a){a?(d.setFaceCullingEnabled(!0),d.setCullFace(a.face),
d.setFrontFace(a.mode)):d.setFaceCullingEnabled(!1)},setPolygonOffset:function(a){a?(d.setPolygonOffsetFillEnabled(!0),d.setPolygonOffset(a.factor,a.units)):d.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(a){a?(d.setDepthTestEnabled(!0),d.setDepthFunction(a.func)):d.setDepthTestEnabled(!1)},setStencilTest:function(a){if(a){d.setStencilTestEnabled(!0);var b=a.function;d.setStencilFunction(b.func,b.ref,b.mask);a=a.operation;d.setStencilOp(a.fail,a.zFail,a.zPass)}else d.setStencilTestEnabled(!1)},
setDepthWrite:function(a){a?(d.setDepthWriteEnabled(!0),d.setDepthRange(a.zNear,a.zFar)):d.setDepthWriteEnabled(!1)},setColorWrite:function(a){a?d.setColorMask(a.r,a.g,a.b,a.a):d.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(a){a?d.setStencilWriteMask(a.mask):d.setStencilWriteMask(0)}});this.enforceState()}Object.defineProperty(d.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"parameters",
{get:function(){return this._parameters},enumerable:!0,configurable:!0});d.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};d.prototype.setPipelineState=function(b){this._stateTracker.setPipeline(b)};d.prototype.setBlendingEnabled=function(b){this._blendEnabled!==b&&(!0===b?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=b,this._stateTracker.invalidateBlending())};d.prototype.setBlendColor=
function(b,a,e,f){if(b!==this._blendColorState.r||a!==this._blendColorState.g||e!==this._blendColorState.b||f!==this._blendColorState.a)this.gl.blendColor(b,a,e,f),this._blendColorState.r=b,this._blendColorState.g=a,this._blendColorState.b=e,this._blendColorState.a=f,this._stateTracker.invalidateBlending()};d.prototype.setBlendFunction=function(b,a){if(b!==this._blendFunctionState.srcRGB||a!==this._blendFunctionState.dstRGB)this.gl.blendFunc(b,a),this._blendFunctionState.srcRGB=b,this._blendFunctionState.srcAlpha=
b,this._blendFunctionState.dstRGB=a,this._blendFunctionState.dstAlpha=a,this._stateTracker.invalidateBlending()};d.prototype.setBlendFunctionSeparate=function(b,a,e,f){if(this._blendFunctionState.srcRGB!==b||this._blendFunctionState.srcAlpha!==e||this._blendFunctionState.dstRGB!==a||this._blendFunctionState.dstAlpha!==f)this.gl.blendFuncSeparate(b,a,e,f),this._blendFunctionState.srcRGB=b,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=a,this._blendFunctionState.dstAlpha=f,this._stateTracker.invalidateBlending()};
d.prototype.setBlendEquation=function(b){this._blendEquationState.mode!==b&&(this.gl.blendEquation(b),this._blendEquationState.mode=b,this._blendEquationState.modeAlpha=b,this._stateTracker.invalidateBlending())};d.prototype.setBlendEquationSeparate=function(b,a){if(this._blendEquationState.mode!==b||this._blendEquationState.modeAlpha!==a)this.gl.blendEquationSeparate(b,a),this._blendEquationState.mode=b,this._blendEquationState.modeAlpha=a,this._stateTracker.invalidateBlending()};d.prototype.setColorMask=
function(b,a,e,f){if(this._colorMaskState.r!==b||this._colorMaskState.g!==a||this._colorMaskState.b!==e||this._colorMaskState.a!==f)this.gl.colorMask(b,a,e,f),this._colorMaskState.r=b,this._colorMaskState.g=a,this._colorMaskState.b=e,this._colorMaskState.a=f,this._stateTracker.invalidateColorWrite()};d.prototype.setClearColor=function(b,a,e,f){if(this._clearColor.r!==b||this._clearColor.g!==a||this._clearColor.b!==e||this._clearColor.a!==f)this.gl.clearColor(b,a,e,f),this._clearColor.r=b,this._clearColor.g=
a,this._clearColor.b=e,this._clearColor.a=f};d.prototype.setFaceCullingEnabled=function(b){this._polygonCullingEnabled!==b&&(!0===b?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=b,this._stateTracker.invalidateCulling())};d.prototype.setPolygonOffsetFillEnabled=function(b){this._polygonOffsetFillEnabled!==b&&(!0===b?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=b,this._stateTracker.invalidatePolygonOffset())};
d.prototype.setPolygonOffset=function(b,a){if(this._polygonOffset[0]!==b||this._polygonOffset[1]!==a)this._polygonOffset[0]=b,this._polygonOffset[1]=a,this.gl.polygonOffset(b,a),this._stateTracker.invalidatePolygonOffset()};d.prototype.setCullFace=function(b){this._cullFace!==b&&(this.gl.cullFace(b),this._cullFace=b,this._stateTracker.invalidateCulling())};d.prototype.setFrontFace=function(b){this._frontFace!==b&&(this.gl.frontFace(b),this._frontFace=b,this._stateTracker.invalidateCulling())};d.prototype.setScissorTestEnabled=
function(b){this._scissorTestEnabled!==b&&(!0===b?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=b)};d.prototype.setScissorRect=function(b,a,e,f){if(this._scissorRect.x!==b||this._scissorRect.y!==a||this._scissorRect.width!==e||this._scissorRect.height!==f)this.gl.scissor(b,a,e,f),this._scissorRect.x=b,this._scissorRect.y=a,this._scissorRect.width=e,this._scissorRect.height=f};d.prototype.setDepthTestEnabled=function(b){this._depthTestEnabled!==
b&&(!0===b?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=b,this._stateTracker.invalidateDepthTest())};d.prototype.setClearDepth=function(b){this._clearDepth!==b&&(this.gl.clearDepth(b),this._clearDepth=b)};d.prototype.setDepthFunction=function(b){this._depthFunction!==b&&(this.gl.depthFunc(b),this._depthFunction=b,this._stateTracker.invalidateDepthTest())};d.prototype.setDepthWriteEnabled=function(b){this._depthWriteEnabled!==b&&(this.gl.depthMask(b),
this._depthWriteEnabled=b,this._stateTracker.invalidateDepthWrite())};d.prototype.setDepthRange=function(b,a){if(this._depthRange.zNear!==b||this._depthRange.zFar!==a)this.gl.depthRange(b,a),this._depthRange.zNear=b,this._depthRange.zFar=a,this._stateTracker.invalidateDepthWrite()};d.prototype.setStencilTestEnabled=function(b){this._stencilTestEnabled!==b&&(!0===b?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=b,this._stateTracker.invalidateStencilTest())};
d.prototype.setClearStencil=function(b){b!==this._clearStencil&&(this.gl.clearStencil(b),this._clearStencil=b)};d.prototype.setStencilFunction=function(b,a,e){if(this._stencilFunction.func!==b||this._stencilFunction.ref!==a||this._stencilFunction.mask!==e)this.gl.stencilFunc(b,a,e),this._stencilFunction.face=1032,this._stencilFunction.func=b,this._stencilFunction.ref=a,this._stencilFunction.mask=e,this._stateTracker.invalidateStencilTest()};d.prototype.setStencilFunctionSeparate=function(b,a,e,f){if(this._stencilFunction.face!==
b||this._stencilFunction.func!==a||this._stencilFunction.ref!==e||this._stencilFunction.mask!==f)this.gl.stencilFuncSeparate(b,a,e,f),this._stencilFunction.face=b,this._stencilFunction.func=a,this._stencilFunction.ref=e,this._stencilFunction.mask=f,this._stateTracker.invalidateStencilTest()};d.prototype.setStencilWriteMask=function(b){this._stencilWriteMask!==b&&(this.gl.stencilMask(b),this._stencilWriteMask=b,this._stateTracker.invalidateStencilWrite())};d.prototype.setStencilOp=function(b,a,e){if(this._stencilOperation.fail!==
b||this._stencilOperation.zFail!==a||this._stencilOperation.zPass!==e)this.gl.stencilOp(b,a,e),this._stencilOperation.face=1032,this._stencilOperation.fail=b,this._stencilOperation.zFail=a,this._stencilOperation.zPass=e,this._stateTracker.invalidateStencilTest()};d.prototype.setStencilOpSeparate=function(b,a,e,f){if(this._stencilOperation.face!==b||this._stencilOperation.fail!==a||this._stencilOperation.zFail!==e||this._stencilOperation.zPass!==f)this.gl.stencilOpSeparate(b,a,e,f),this._stencilOperation.face=
b,this._stencilOperation.face=b,this._stencilOperation.fail=a,this._stencilOperation.zFail=e,this._stencilOperation.zPass=f,this._stateTracker.invalidateStencilTest()};d.prototype.setActiveTexture=function(b){var a=this._activeTextureUnit;0<=b&&b!==this._activeTextureUnit&&(this.gl.activeTexture(g.BASE_TEXTURE_UNIT+b),this._activeTextureUnit=b);return a};d.prototype.clear=function(b){b&&this.gl.clear(b)};d.prototype.clearSafe=function(b){b&&(b&16384&&this.setColorMask(!0,!0,!0,!0),b&256&&this.setDepthWriteEnabled(!0),
b&1024&&this.setStencilWriteMask(255),this.gl.clear(b))};d.prototype.drawArrays=function(b,a,e){this.gl.drawArrays(b,a,e)};d.prototype.drawElements=function(b,a,e,f){5123===e?this.gl.drawElements(b,a,e,f):5125===e&&this.gl.drawElements(b,a,e,f)};d.prototype.logIno=function(){};Object.defineProperty(d.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});d.prototype.setViewport=function(b,a,e,f){var c=this._viewport;if(c.x!==b||c.y!==a||c.width!==e||c.height!==
f)c.x=b,c.y=a,c.width=e,c.height=f,this.gl.viewport(b,a,e,f)};d.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};d.prototype.bindProgram=function(b){b?this._activeShaderProgram!==b&&(b.initialize(),this.gl.useProgram(b.glName),this._activeShaderProgram=b):(this.gl.useProgram(null),this._activeShaderProgram=null)};d.prototype.bindTexture=function(b,a){void 0===a&&(a=0);-1===d._MAX_TEXTURE_IMAGE_UNITS&&(d._MAX_TEXTURE_IMAGE_UNITS=
this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(a>=d._MAX_TEXTURE_IMAGE_UNITS||0>a)&&console.error("Input texture unit is out of range of available units!");var c=this._textureUnitMap[a];this.setActiveTexture(a);null==b||null==b.glName?(null!=c&&(this.gl.bindTexture(c.descriptor.target,null),c.setBoundToUnit(a,!1)),this._textureUnitMap[a]=null):c&&c.id===b.id?b.applyChanges():(this.gl.bindTexture(b.descriptor.target,b.glName),b.setBoundToUnit(a,!0),b.applyChanges(),this._textureUnitMap[a]=
b)};d.prototype.bindFramebuffer=function(b){b?this._activeFramebuffer!==b&&(b.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b.glName),this._activeFramebuffer=b):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};d.prototype.bindBuffer=function(b){b&&(34962===b.bufferType?this._activeVertexBuffer=d._bindBuffer(this.gl,b,b.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=d._bindBuffer(this.gl,b,b.bufferType,this._activeIndexBuffer))};d.prototype.bindRenderbuffer=
function(b){var a=this.gl;b||(a.bindRenderbuffer(a.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==b&&(a.bindRenderbuffer(a.RENDERBUFFER,b.glName),this._activeRenderbuffer=b)};d.prototype.unbindBuffer=function(b){34962===b?this._activeVertexBuffer=d._bindBuffer(this.gl,null,b,this._activeVertexBuffer):this._activeIndexBuffer=d._bindBuffer(this.gl,null,b,this._activeIndexBuffer)};d.prototype.bindVAO=function(b){b?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===
b.id||(b.bind(),this._activeVertexArrayObject=b):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};d.prototype.getBoundTexture=function(b){return this._textureUnitMap[b]};d.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};d.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};d.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);
this.unbindBuffer(34963);for(var b=0;b<this.parameters.maxTextureImageUnits;b++)this.bindTexture(null,b);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);
this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};d.prototype.enforceState=function(){var b=this.gl,a=this._capabilities.vao;a&&a.bindVertexArray(null);for(var e=0;e<this.parameters.maxVertexAttributes;e++)b.disableVertexAttribArray(e);
this._activeVertexBuffer?b.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):b.bindBuffer(34962,null);this._activeIndexBuffer?b.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):b.bindBuffer(34963,null);if(a&&this._activeVertexArrayObject){if(a=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(a)}b.bindFramebuffer(b.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:
null);b.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);b.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);b.bindRenderbuffer(b.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?b.enable(this.gl.BLEND):b.disable(this.gl.BLEND);b.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);b.blendFuncSeparate(this._blendFunctionState.srcRGB,
this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);b.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);b.clearDepth(this._clearDepth);b.clearStencil(this._clearStencil);b.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);b.cullFace(this._cullFace);b.depthFunc(this._depthFunction);b.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?
b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST);b.depthMask(this._depthWriteEnabled);b.frontFace(this._frontFace);b.lineWidth(1);!0===this._polygonCullingEnabled?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE);b.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?b.enable(b.POLYGON_OFFSET_FILL):b.disable(b.POLYGON_OFFSET_FILL);b.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?b.enable(b.SCISSOR_TEST):
b.disable(b.SCISSOR_TEST);b.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);b.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST);b.stencilMask(this._stencilWriteMask);for(a=0;a<this.parameters.maxTextureImageUnits;a++)b.activeTexture(g.BASE_TEXTURE_UNIT+a),b.bindTexture(3553,null),(e=this._textureUnitMap[a])&&
b.bindTexture(e.descriptor.target,e.glName);b.activeTexture(g.BASE_TEXTURE_UNIT+this._activeTextureUnit);b.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};d._bindBuffer=function(b,a,e,f){if(!a)return b.bindBuffer(e,null),null;if(f===a)return f;b.bindBuffer(e,a.glName);return a};d._MAX_TEXTURE_IMAGE_UNITS=-1;return d}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.BASE_TEXTURE_UNIT=
33984})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(t,d){return function(){function d(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}d.prototype.incrementCount=function(d){switch(d){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;
break;case 5:this._instanceCount.renderBufferCount++}};d.prototype.decrementCount=function(d){switch(d){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}};d.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._instanceCount.textureCount);
console.log("Buffers: "+this._instanceCount.bufferCount);console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+this._instanceCount.programCount);console.log("Framebuffers: "+this._instanceCount.framebufferCount);console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)};return d}()})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./VertexArrayObjects".split(" "),function(t,d,q,g,l,b){function f(b,
f,c,a,d){if(a&&l.default(b))return!0;if(f[c])return!1;for(f=0;f<d.length;f++)if(b.getExtension(d[f]))return!0;return!1}Object.defineProperty(d,"__esModule",{value:!0});d.loadCapabilities=function(e,d){d=d&&d.disabledExtensions||{};f(e,d,"standardDerivatives",!0,["OES_standard_derivatives"]);var c=g.load(e),a=b.load(e,d),h;h=d.compressedTextureS3TC?null:(h=e.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:h.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:h.COMPRESSED_RGBA_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT3:h.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:h.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null;var k;k=d.textureFilterAnisotropic?null:(k=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:k.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:k.TEXTURE_MAX_ANISOTROPY_EXT}:null;var n=q.load(e,d),u;l.default(e)?u={textureFloat:!0,textureFloatLinear:!d.textureFloatLinear&&
!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!d.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT}:e instanceof WebGLRenderingContext?(u=!d.textureHalfFloat&&e.getExtension("OES_texture_half_float"),u={textureFloat:!d.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!d.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!u,textureHalfFloatLinear:!d.textureHalfFloatLinear&&
!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:u?u.HALF_FLOAT_OES:void 0}):u=void 0;var v;if(l.default(e)){v=!d.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float");var r=!d.colorBufferFloat&&e.getExtension("EXT_color_buffer_float");v=v||r?{textureFloat:!!r,textureHalfFloat:!!v,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}else e instanceof WebGLRenderingContext?(v=!d.colorBufferFloat&&
e.getExtension("EXT_color_buffer_half_float"),r=!d.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),v=v||r?{textureFloat:!!r,textureHalfFloat:!!v,RGBA16F:v?v.RGBA16F_EXT:void 0,RGB16F:v?v.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null):v=void 0;r=l.default(e)?{MIN:e.MIN,MAX:e.MAX}:d.blendMinMax?null:(r=e.getExtension("EXT_blend_minmax"))?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null;return{instancing:c,vao:a,compressedTextureS3TC:h,textureFilterAnisotropic:k,disjointTimerQuery:n,textureFloat:u,
colorBufferFloat:v,blendMinMax:r,depthTexture:f(e,d,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:f(e,d,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),fragDepth:f(e,d,"fragDepth",!0,["EXT_frag_depth"])}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.load=function(d,l){if(l.disjointTimerQuery)return null;
var b=d.getExtension("EXT_disjoint_timer_query")||d.getExtension("EXT_disjoint_timer_query_webgl2");return b?q.default(d)?{createQuery:function(){return d.createQuery()},resultAvailable:function(b){return d.getQueryParameter(b,d.QUERY_RESULT_AVAILABLE)},getResult:function(b){return d.getQueryParameter(b,d.QUERY_RESULT)},disjoint:function(){return d.getParameter(b.GPU_DISJOINT_EXT)},beginTimeElapsed:function(f){return d.beginQuery(b.TIME_ELAPSED_EXT,f)},endTimeElapsed:function(){return d.endQuery(b.TIME_ELAPSED_EXT)},
createTimestamp:function(f){return b.queryCounterEXT(f,b.TIMESTAMP_EXT)},timestampBits:function(){return d.getQuery(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return b.createQueryEXT()},resultAvailable:function(f){return b.getQueryObjectEXT(f,b.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(f){return b.getQueryObjectEXT(f,b.QUERY_RESULT_EXT)},disjoint:function(){return d.getParameter(b.GPU_DISJOINT_EXT)},beginTimeElapsed:function(f){return b.beginQueryEXT(b.TIME_ELAPSED_EXT,
f)},endTimeElapsed:function(){return b.endQueryEXT(b.TIME_ELAPSED_EXT)},createTimestamp:function(f){return b.queryCounterEXT(f,b.TIMESTAMP_EXT)},timestampBits:function(){return b.getQueryEXT(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.load=function(d){return q.default(d)?{drawArraysInstanced:d.drawArraysInstanced.bind(d),
drawElementsInstanced:d.drawElementsInstanced.bind(d),vertexAttribDivisor:d.vertexAttribDivisor.bind(d)}:(d=d.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:d.drawArraysInstancedANGLE.bind(d),drawElementsInstanced:d.drawElementsInstancedANGLE.bind(d),vertexAttribDivisor:d.vertexAttribDivisorANGLE.bind(d)}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});
d.load=function(d,l){return q.default(d)?{createVertexArray:d.createVertexArray.bind(d),deleteVertexArray:d.deleteVertexArray.bind(d),bindVertexArray:d.bindVertexArray.bind(d)}:l.vao?null:(d=d.getExtension("OES_vertex_array_object")||d.getExtension("MOZ_OES_vertex_array_object")||d.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:d.createVertexArrayOES.bind(d),deleteVertexArray:d.deleteVertexArrayOES.bind(d),bindVertexArray:d.bindVertexArrayOES.bind(d)}:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/vec4f64 ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./symbolComplexity ../../support/PromiseLightweight".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n){function u(a,b){a=null!=a?b.attributes[a]:0;return null!=a&&isFinite(a)?a:0}Object.defineProperty(d,"__esModule",{value:!0});var v=new c,r=b.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");t=function(b){function d(a,e,f,d){var g=b.call(this)||this;g.complexity=null;g._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};g.symbol=a;g.symbolLayer=e;g._context=f;g._symbolLayerOrder=f.layerOrder;g._symbolLayerOrderDelta=f.layerOrderDelta;
g._elevationContext=new c;g._material=null;g.complexity=g.computeComplexity();g._geometryCreationWarningHandle=null;g._updateDrivenProperties(d);g._updateElevationContext();return g}q(d,b);d.prototype.getCachedSize=function(){return null};d.prototype._logWarning=function(a){r.warn(a)};d.prototype._logGeometryCreationWarnings=function(a,b,c,f){var d=this;if(null==this._geometryCreationWarningHandle){var g=a.geometryData&&a.geometryData.polygons;f+=" geometry failed to be created";var h=null;a.projectionSuccess?
!b.length||1===b.length&&!b[0].length?h=f+" (no "+c+" were defined)":Array.isArray(b)&&Array.isArray(b[0])?b.some(function(a){return 1===a.length})?h=f+" ("+c+" should contain at least 2 vertices)":g&&0===g.length&&"rings"===c&&(h=f+" (filled "+c+" should use clockwise winding - try reversing the order of vertices)"):h=f+" ("+c+" should be defined as a 2D array)":h=f+" (failed to project geometry to view spatial reference)";h&&(this._geometryCreationWarningHandle=e.schedule(function(){return d._onNextTick()}),
this._logWarning(h))}};d.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null};d.prototype._validateGeometry=function(a){return"point"!==a.type||f.isFinite(a.x)&&f.isFinite(a.y)?!0:(this._logWarning("point coordinate is not a valid number, graphic skipped"),!1)};d.prototype._defaultElevationInfoNoZ=function(){return y};d.prototype._defaultElevationInfoZ=function(){return w};d.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();var a=this._context.layer.elevationInfo;
a&&this._elevationContext.mixinApi(a);(a=this.symbolLayer&&this.symbolLayer.elevationInfo)&&this._elevationContext.mixinApi(a);this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext};d.prototype.getDefaultElevationInfo=function(a){return a.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};d.prototype.getGeometryElevationMode=function(a,b){void 0===b&&(b=this.getDefaultElevationInfo(a));return this._elevationContext.mode||b.mode};d.prototype.getGraphicElevationContext=
function(b){var c=b.geometry,e=this.getDefaultElevationInfo(c);v.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:e.unit);v.mode=this.getGeometryElevationMode(c,e);v.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:e.offset);v.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==v.mode||(v.mode="relative-to-ground",v.setOffsetMeters(0),v.featureExpressionInfoContext=
a.zeroContext);b=a.createFeature(b,this._context.layer);a.setContextFeature(v.featureExpressionInfoContext,b);return v};d.prototype.prepareSymbolLayerPatch=function(a){};d.prototype.updateGeometry=function(a,b){return!1};d.prototype._getDrapedZ=function(){return-2};d.prototype._updateDrivenProperties=function(a){var b={color:!1,opacity:!1,size:!1};a||(a=this._context.renderer)&&"visualVariables"in a&&a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":b.color=!0;if(a.stops)for(var c=
0;c<a.stops.length;c++){var e=a.stops[c].color;e&&(Array.isArray(e)&&3<e.length&&255!==e[3]||void 0!==e.a&&255!==e.a)&&(b.opacity=!0)}break;case "opacity":b.opacity=!0;break;case "size":b.size=!0}});this._drivenProperties=b};d.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};d.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?
1:a};d.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var b=this.symbolLayer&&this.symbolLayer.material;b&&!this._isPropertyDriven("opacity")&&b.color&&(a*=b.color.a);return a};d.prototype._getMaterialOpacityAndColor=function(){var a=this.symbolLayer&&this.symbolLayer.material,b=this._getMaterialOpacity(),a=!this._isPropertyDriven("color")&&a&&a.color?g.toUnitRGB(a.color):null;return h.mixinColorAndOpacity(a,b)};d.prototype._getVertexOpacityAndColor=function(a,b,c){var e=
this._isPropertyDriven("color")?a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;e=h.mixinColorAndOpacity(e,a);c&&(e[0]*=c,e[1]*=c,e[2]*=c,e[3]*=c);return b?new b(e):e};d.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"};d.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};d.prototype.updateSymbolLayerOrder=function(a,b){this._symbolLayerOrder=a;this._symbolLayerOrderDelta=b};d.prototype.computeComplexity=function(){return p.defaultSymbolLayerComplexity(this.symbol,
this.symbolLayer)};d.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a,c.add(this._material.id))};d.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)};d.prototype.globalPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged();case "elevationInfo":return a=this._elevationContext.mode,this._updateElevationContext(),
this.layerElevationInfoChanged(b,c,a);case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(b,c);case "pixelRatio":return this.pixelRatioChanged(b,c);default:return l.neverReachedSilent(a),!1}};d.prototype.updateGraphics3DGraphicElevationInfo=function(a,b,c){var e=this,f=!0;a.forEach(function(a){var d=b(a);d?(a=e.getGraphicElevationContext(a.graphic),d.needsElevationUpdates=c(a.mode),d.elevationContext.set(a)):f=!1});return f};d.prototype.applyRendererDiff=function(a,b){return!1};d.prototype.getFastUpdateAttrValues=
function(a){if(!this._fastUpdates.enabled)return null;var b=this._fastUpdates.visualVariables,c=b.size?u(b.size.field,a):0,e=b.color?u(b.color.field,a):0;a=b.opacity?u(b.opacity.field,a):0;return k.vec4f64.fromValues(c,e,a,0)};return d}(n.default);d.Graphics3DSymbolLayer=t;d.getAttributeValue=u;var y={mode:"on-the-ground",offset:0,unit:"meters"},w={mode:"absolute-height",offset:0,unit:"meters"};d.default=t})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/has ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(t,d,q,g,l,b,f,e,k){function c(a){for(var b=0,c=0,e={bytesPerFeature:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerCoordinate:0}},f=0;f<a.length;f++){var d=a[f];d&&(b+=d.primitivesPerFeature,c+=d.primitivesPerCoordinate,e.bytesPerFeature+=d.memory.bytesPerFeature,e.bytesPerCoordinate+=d.memory.bytesPerCoordinate,e.draped.bytesPerFeature+=d.memory.bytesPerFeature,e.draped.bytesPerCoordinate+=d.memory.bytesPerCoordinate)}return{primitivesPerFeature:b,primitivesPerCoordinate:c,memory:e}}
function a(a,c){var e=h(a,c);switch(c.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,memory:e};case "fill":return"mesh-3d"===a.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,memory:e}:c.outline&&0<c.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,memory:e}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,memory:e};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,memory:e};case "object":return c.resource&&c.resource.href?
{primitivesPerFeature:16,primitivesPerCoordinate:0,memory:e}:q({},p(c.resource&&c.resource.primitive||b.defaultPrimitive),{memory:e});case "path":return{primitivesPerFeature:-4,primitivesPerCoordinate:20,memory:e};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,memory:e};default:g.neverReached(c)}}function h(a,b){a="point-3d"===a.type;switch(b.type){case "extrude":return b.edges&&0<b.edges.size?d.memoryEstimators.EXTRUDE_EDGES:d.memoryEstimators.EXTRUDE;case "fill":return b.outline&&
0<b.outline.size?d.memoryEstimators.FILL_OUTLINE:d.memoryEstimators.FILL;case "line":return d.memoryEstimators.LINE;case "path":return d.memoryEstimators.PATH;case "object":return l("enable-feature:skallweit/lod-rendering")?a?d.memoryEstimators.OBJECT_POINT_LOD:d.memoryEstimators.OBJECT_POLYGON_LOD:a?d.memoryEstimators.OBJECT_POINT:d.memoryEstimators.OBJECT_POLYGON;case "icon":case "text":return a?d.memoryEstimators.ICON_POINT:d.memoryEstimators.ICON_POLYGON;default:g.neverReached(b)}}function p(a){var b=
n[a];if(b)return b;l("enable-feature:skallweit/lod-rendering")?(b=f.primitiveLodResources(a,null,null),b=k.geometriesFromLodLevelResources(b.levels[0]).reduce(function(a,b){return a+b.data.getIndices(e.VertexAttrConstants.POSITION).length/3},0)):b=f.primitiveGeometryData(a).getIndices(e.VertexAttrConstants.POSITION).length/3;b={primitivesPerFeature:b,primitivesPerCoordinate:0};return n[a]=b}Object.defineProperty(d,"__esModule",{value:!0});d.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,
memory:{bytesPerFeature:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerCoordinate:0}}};d.defaultSymbolComplexity=function(b){if("web-style"===b.type)return d.emptySymbolComplexity;var e=b.symbolLayers.toArray().map(function(c){return a(b,c)});return c(e)};d.totalSymbolComplexities=c;var n={};d.defaultSymbolLayerComplexity=a;d.defaultSymbolLayerMemoryComplexity=h;d.memoryEstimators={ICON_POINT:{bytesPerFeature:7478.781325779039,bytesPerCoordinate:0,draped:{bytesPerFeature:5712.082651558076,
bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9679.372971750396,bytesPerCoordinate:56.86422538239579,draped:{bytesPerFeature:7883.966873022898,bytesPerCoordinate:56.89697037586389}},OBJECT_POINT:{bytesPerFeature:5177.80657223796,bytesPerCoordinate:0,draped:{bytesPerFeature:5177.80657223796,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:7372.024890546556,bytesPerCoordinate:56.80425878144206,draped:{bytesPerFeature:7372.024890546556,bytesPerCoordinate:56.80425878144206}},OBJECT_POINT_LOD:{bytesPerFeature:1770.211558073654,
bytesPerCoordinate:0,draped:{bytesPerFeature:1770.211558073654,bytesPerCoordinate:0}},OBJECT_POLYGON_LOD:{bytesPerFeature:3958.8422890890743,bytesPerCoordinate:56.88697205558441,draped:{bytesPerFeature:3958.8422890890743,bytesPerCoordinate:56.88697205558441}},LINE:{bytesPerFeature:7586.045782417972,bytesPerCoordinate:112.02132538683836,draped:{bytesPerFeature:4775.97368572266,bytesPerCoordinate:111.85995483757563}},PATH:{bytesPerFeature:7563.020535856769,bytesPerCoordinate:119.1242257528872,draped:{bytesPerFeature:7563.020535856769,
bytesPerCoordinate:119.1242257528872}},FILL:{bytesPerFeature:8702.040510627665,bytesPerCoordinate:56.610361738134486,draped:{bytesPerFeature:5921.70744530372,bytesPerCoordinate:56.58839624148057}},FILL_OUTLINE:{bytesPerFeature:12168.362923563885,bytesPerCoordinate:56.265773613009564,draped:{bytesPerFeature:7929.090679733446,bytesPerCoordinate:56.17528027868163}},EXTRUDE:{bytesPerFeature:11409.738625531325,bytesPerCoordinate:56.99136098105536,draped:{bytesPerFeature:11409.738625531325,bytesPerCoordinate:56.99136098105536}},
EXTRUDE_EDGES:{bytesPerFeature:19399.52461450617,bytesPerCoordinate:52.052414603432105,draped:{bytesPerFeature:19399.52461450617,bytesPerCoordinate:52.052414603432105}}}})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});var f=g.fromValues(-.5,
-.5,-.5,.5,.5,.5),e=g.fromValues(-.5,-.5,0,.5,.5,1),k=g.fromValues(-.5,-.5,0,.5,.5,.5);d.isValidPrimitive=function(a){switch(a){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};d.primitiveBoundingBox=function(a){switch(a){case "sphere":case "cube":case "diamond":return f;case "cylinder":case "cone":case "inverted-cone":return e;case "tetrahedron":return k;default:q.neverReached(a)}};d.primitiveGeometryData=function(a){switch(a){case "sphere":return b.createPolySphereGeometry(.5,
2,!0);case "cube":return b.createBoxGeometry(1);case "cylinder":return b.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return b.cgToGIS(b.createConeGeometry(1,.5,15,!1));case "inverted-cone":return b.cgToGIS(b.createConeGeometry(1,.5,15,!0));case "tetrahedron":return b.cgToGIS(b.createTetrahedronGeometry(1));case "diamond":return b.cgToGIS(b.createDiamondGeometry(1));default:q.neverReached(a)}};d.primitiveLodResources=function(a,e,f){var d=function(a,c,d){void 0===d&&(d=!1);return{levels:a.map(function(a,
g){var h=c(a.tesselation);d&&b.cgToGIS(h);return{components:[{geometry:new l(h,f+("_lod"+g)),material:e}],faceCount:h.indexCount/3,minScreenSpaceRadius:a.minScreenSpaceRadius}})}};switch(a){case "sphere":return d([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],function(a){return b.createPolySphereGeometry(.5,a,!0)});case "cube":return d([{tesselation:0,
minScreenSpaceRadius:0}],function(a){return b.createBoxGeometry(1)});case "cone":return d(c,function(a){return b.createConeGeometry(1,.5,a,!1)},!0);case "inverted-cone":return d(c,function(a){return b.createConeGeometry(1,.5,a,!0)},!0);case "cylinder":return d(c,function(a){return b.createCylinderGeometry(1,.5,a,[0,0,1],[0,0,.5])});case "tetrahedron":return d([{tesselation:0,minScreenSpaceRadius:0}],function(a){return b.createTetrahedronGeometry(1)},!0);case "diamond":return d([{tesselation:0,minScreenSpaceRadius:0}],
function(a){return b.createDiamondGeometry(1)},!0);default:q.neverReached(a)}};var c=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require","exports","../../../../../core/arrayUtils"],function(t,d,q){function g(d){var b=[];d.components.forEach(function(f){b.push(f.geometry)});return q.unique(b)}Object.defineProperty(d,"__esModule",{value:!0});
d.materialsFromLodResources=function(d){var b=[];d.levels.forEach(function(f){f.components.forEach(function(e){b.push(e.material)})});return q.unique(b)};d.texturesFromLodResources=function(d){var b=[];d.levels.forEach(function(f){f.components.forEach(function(e){e.textures&&b.push.apply(b,e.textures)})});return q.unique(b)};d.geometriesFromLodLevelResources=g;d.geometriesFromLodResources=function(d){var b=[];d.levels.forEach(function(f){f.components.forEach(function(e){b.push(e.geometry)})});return q.unique(b)};
d.computeFaceCount=function(d){var b=0;g(d).forEach(function(f){b+=f.data.indexCount/3});return b}})},"esri/views/3d/support/PromiseLightweight":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(d){void 0===d&&(d=null);this._cancelCallback=d;this._callbacks=[];this._errbacks=[];this._iserr=this._isdone=this._iscancelled=!1;this.error=this.result=null}d.prototype.cancel=function(d){this._iscancelled||this._iserr||this._isdone||
(this._callbacks=[],this._errbacks=[],this._iscancelled=!0,this._cancelCallback&&this._cancelCallback(d))};d.prototype.then=function(d,l,b){void 0===b&&(b=null);this._iscancelled||(this._isdone?d.call(b,this.result):this._iserr&&l?l.call(b,this.result):(this._callbacks.push(b?d.bind(b):d),l&&this._errbacks.push(b?l.bind(b):l)))};d.prototype.resolve=function(d){void 0===d&&(d=null);if(!(this._iscancelled||this._iserr||this._isdone)){this.result=d;this._isdone=!0;for(var g=0,b=this._callbacks;g<b.length;g++)(0,b[g])(d);
this._callbacks=[];this._errbacks=[]}};d.prototype.reject=function(d){void 0===d&&(d=null);if(!(this._iscancelled||this._iserr||this._isdone)){this.error=d;this._iserr=!0;for(var g=0,b=this._errbacks;g<b.length;g++)(0,b[g])(d);this._callbacks=[];this._errbacks=[]}};d.prototype.isRejected=function(){return this._iserr};d.prototype.isFulfilled=function(){return this._isdone||this._iserr};d.prototype.isResolved=function(){return this._isdone};d.prototype.isCancelled=function(){return this._iscancelled};
return d}();d.PromiseLightweight=t;d.default=t})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/LineCalloutPrograms ../../../webgl/renderState".split(" "),function(t,d,q,g,l,b,f,e,k,c,a,h,p){function n(a,
b,c){3===c.length?a.setUniform4f(b,c[0],c[1],c[2],1):a.setUniform4fv(b,c)}t=function(b){function e(a,f){f=b.call(this,f)||this;f.params=c.copyParameters(a,v);f._uniqueMaterialIdentifier=e.uniqueMaterialIdentifier(f.params);return f}q(e,b);Object.defineProperty(e.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});e.prototype.dispose=function(){};e.prototype.getGLMaterials=function(){return{color:u,depthShadowMap:void 0,normal:void 0,
depth:void 0,highlight:void 0}};e.prototype.getAllTextureIds=function(){return[]};e.prototype.intersect=function(a,b,c,e,f,d,g,h){};e.prototype.createBufferWriter=function(){return new w};e.prototype.createRenderer=function(b,c){return new a(b,c,this)};e.prototype.setParameterValues=function(a){c.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=e.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};e.prototype.getParameters=function(){return this.params};e.uniqueMaterialIdentifier=
function(a){return JSON.stringify({screenOffset:a.screenOffset||[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};return e}(f);var u=function(a){function b(b,c,e){b=a.call(this,b,c)||this;b.isRenderSlot=!0;b.updateParameters();return b}q(b,a);b.prototype.updateParameters=function(){this.params=c.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getProgram(h.program,{occlTest:!!a.occlusionTest,
verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,depthHud:!1,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.depthProgram=this.programRep.getProgram(h.program,{occlTest:!!a.occlusionTest,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});
this.renderPipelineState=p.makePipelineState({blending:p.separateBlendingParams(1,770,771,771),depthTest:{func:513},colorWrite:p.defaultColorWriteParams});this.depthPipelineState=p.makePipelineState({depthTest:{func:513},depthWrite:p.defaultDepthWriteParams})};b.prototype.beginSlot=function(a){switch(a){case 17:return this.isRenderSlot=!0;case 18:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(b.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},
enumerable:!0,configurable:!0});b.prototype.getProgram=function(){return this.program};b.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]};b.prototype.getDrawMode=function(){return 4};b.prototype.bind=function(a,b){var e=b.cameraAboveGround?1:-1,f=this.program,d=this.params;a.bindProgram(f);f.setUniform1f("cameraGroundRelative",e);f.setUniform1f("polygonOffset",d.shaderPolygonOffset);f.setUniform4fv("viewport",b.viewport);f.setUniform1f("perDistancePixelRatio",Math.tan(b.fovY/
2)/(b.viewport[2]/2));f.setUniformMatrix4fv("viewNormal",b.viewInvTransp);f.setUniform1i("hudVisibilityTexture",0);a.bindTexture(b.hudVisibilityTexture,0);n(f,"color",d.color);e=b.pixelRatio||1;f.setUniform1f("pixelRatio",e);f.setUniform2f("screenOffset",d.screenOffset[0]*e,d.screenOffset[1]*e);this.bindBorder(a,b);c.bindVerticalOffset(d.verticalOffset,b,f);this.bindSizing(a,b);c.bindScreenSizePerspective(d.screenSizePerspective,f);this.isRenderSlot?a.setPipelineState(this.renderPipelineState):a.setPipelineState(this.depthPipelineState)};
b.prototype.bindView=function(a,b){a=this.program;var e=this.params;c.bindView(b.origin,b.view,a);c.bindCamPos(b.origin,b.viewInvTransp,a);e.slicePlaneEnabled&&c.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.release=function(a,b){};b.prototype.bindSizing=function(a,b){a=this.program;var c=this.params;a.setUniform2f("pixelToNDC",2/
b.viewport[2],2/b.viewport[3]);a.setUniform1f("lineSize",Math.ceil(c.size)*(b.pixelRatio||1))};b.prototype.bindBorder=function(a,b){a=this.program;var c=this.params;b=b.pixelRatio||1;null!==c.borderColor?(n(a,"borderColor",c.borderColor),a.setUniform1f("borderSize",b)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return b}(b),v={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,
depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},r=l.newLayout().vec3f(e.VertexAttrConstants.POSITION).vec3f(e.VertexAttrConstants.NORMAL).vec2f(e.VertexAttrConstants.UV0).vec4f(e.VertexAttrConstants.AUXPOS1),y=[g.vec2f32.fromValues(0,0),g.vec2f32.fromValues(1,0),g.vec2f32.fromValues(0,1),g.vec2f32.fromValues(1,0),g.vec2f32.fromValues(1,1),g.vec2f32.fromValues(0,1)],w=function(){function a(){this.vertexBufferLayout=r}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return 6*a.indices[e.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,f,d){k.writePosition(b.indices[e.VertexAttrConstants.POSITION],b.vertexAttr[e.VertexAttrConstants.POSITION].data,a.transformation,f.position,d,6);k.writeNormal(b.indices[e.VertexAttrConstants.NORMAL],b.vertexAttr[e.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,f.normal,d,6);k.writeBufferVec4(b.indices[e.VertexAttrConstants.AUXPOS1],b.vertexAttr[e.VertexAttrConstants.AUXPOS1].data,
f.auxpos1,d,6);for(a=0;a<y.length;++a)f.uv0.setVec(d+a,y[a])};return a}();return t})},"esri/core/libs/gl-matrix-2/vec2f32":function(){define(["require","exports","./factories/vec2f32"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.vec2f32=q})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.create=function(){return new Float32Array(2)};d.clone=function(d){var g=new Float32Array(2);
g[0]=d[0];g[1]=d[1];return g};d.fromValues=function(d,g){var l=new Float32Array(2);l[0]=d;l[1]=g;return l};d.createView=function(d,g){return new Float32Array(d,g,2)}})},"esri/views/3d/webgl-engine/shaders/LineCalloutPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=function(b){return l.glslifyDefineMap({OCCL_TEST:b.occlTest,VERTICAL_OFFSET:b.verticalOffset,
SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,DEPTH_HUD:b.depthHud,DEPTH_HUD_ALIGN_START:b.depthHudAlignStart,CENTER_OFFSET_UNITS_SCREEN:b.centerOffsetUnitsScreen,SLICE:b.slice})};d.program={name:"line-callout",shaders:function(f){return{vertexShader:b(f)+g.resolveIncludes("materials/lineCallout/lineCallout.vert"),fragmentShader:b(f)+g.resolveIncludes("materials/lineCallout/lineCallout.frag")}},attributes:q.Default3D}})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define("require exports ../../../../symbols ../../../../symbols/MeshSymbol3D ./Graphics3DSymbol ./Graphics3DWebStyleSymbol".split(" "),
function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});d.getGraphics3DSymbol=function(e){return e instanceof b?e.graphics3DSymbol:e instanceof l?e:null};d.getDefaultSymbol=function(b){if(!b||!b.geometry)return null;switch(b.geometry.type){case "mesh":return f}return null};var f=new g({symbolLayers:[new q.FillSymbol3DLayer]})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./symbolComplexity ../../support/PromiseLightweight".split(" "),
function(t,d,q,g,l,b,f,e){return function(e){function c(a,c,f){var d=e.call(this)||this;d._symbol=a;d.referenced=0;a=a.symbolLayers;f&&(a=f.concat(a));f=a.length;d.childGraphics3DSymbols=Array(a.length);d.childGraphics3DSymbolPromises=Array(a.length);for(var g=c.layerOrder,h=0,k=0,l=function(a,b){b&&(d.childGraphics3DSymbols[a]=b,k++);h--;!d.isRejected()&&1>h&&(0<k?d.resolve():d.reject())},p=0;p<f;p++){var m=a.getItemAt(p);!1!==m.enabled&&(c.layerOrder=g+(1-(1+p)/f),c.layerOrderDelta=1/f,m=b.make(d.symbol,
m,c,m._ignoreDrivers))&&(h++,d.childGraphics3DSymbolPromises[p]=m)}c.layerOrder=g;if(0===h)d.resolve();else{c=function(a){var b=x.childGraphics3DSymbolPromises[a];b&&b.then(function(){return l(a,b)},function(){return l(a,null)})};for(var x=this,p=0;p<f;p++)c(p)}return d}q(c,e);c.prototype.getSymbolLayerSize=function(a,b){var c=this;this.then(function(){var e=c.childGraphics3DSymbols[a];b(e?e.getCachedSize():null)},function(){return b(null)})};Object.defineProperty(c.prototype,"symbol",{get:function(){return this._symbol},
set:function(a){this._symbol=a;if(this.childGraphics3DSymbols)for(var b=0;b<a.symbolLayers.length;b++){var c=this.childGraphics3DSymbols[b];c&&(c.symbol=a,c.symbolLayer=a.symbolLayers.items[b])}},enumerable:!0,configurable:!0});c.prototype.createGraphics3DGraphic=function(a,b){for(var c=a.graphic,e=Array(this.childGraphics3DSymbols.length),f=0;f<this.childGraphics3DSymbols.length;f++){var d=this.childGraphics3DSymbols[f];d&&(e[f]=d.createGraphics3DGraphic(a))}return new g(c,b||this,e,a.layer)};Object.defineProperty(c.prototype,
"complexity",{get:function(){return f.totalSymbolComplexities(this.childGraphics3DSymbols.map(function(a){return a&&a.complexity}))},enumerable:!0,configurable:!0});c.prototype.globalPropertyChanged=function(a,b){for(var c=this.childGraphics3DSymbols.length,e=function(c){var e=f.childGraphics3DSymbols[c],d=function(a){a=a._graphics[c];return a instanceof l?a:null};if(e&&!e.globalPropertyChanged(a,b,d))return{value:!1}},f=this,d=0;d<c;d++){var g=e(d);if("object"===typeof g)return g.value}return!0};
c.prototype.applyRendererDiff=function(a,b){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(c,e,f){return c&&(!e||e.applyRendererDiff(a,b))},!0):!1};c.prototype.prepareSymbolPatch=function(a){if(!this.isRejected()&&"partial"===a.diff.type){var b=a.diff.diff;if(b.symbolLayers&&"partial"===b.symbolLayers.type){var c=b.symbolLayers.diff;(this.isResolved()?this.childGraphics3DSymbols:this.childGraphics3DSymbolPromises).forEach(function(b,e){var f;if(b){var d=c[e];if(d){var g={diff:d,
graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};b.prepareSymbolLayerPatch(g);(f=a.symbolStatePatches).push.apply(f,g.symbolLayerStatePatches);g.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push(function(a,b){var c=a._graphics[e];g.graphics3DGraphicPatches.forEach(function(a){return a(c,b)})})}}})}}};c.prototype.updateGeometry=function(a,b){for(var c=0;c<this.childGraphics3DSymbols.length;c++){var e=this.childGraphics3DSymbols[c];if(e&&!e.updateGeometry(a._graphics[c],b))return!1}return!0};
c.prototype.getFastUpdateStatus=function(){var a=0,b=0,c=0;this.childGraphics3DSymbolPromises.forEach(function(e){e&&!e.isFulfilled()?a++:e&&e.isFastUpdatesEnabled()?c++:e&&b++});return{loading:a,slow:b,fast:c}};c.prototype.setDrawOrder=function(a,b){for(var c=this.childGraphics3DSymbols.length,e=1/c,f=0;f<c;f++){var d=this.childGraphics3DSymbols[f];d&&d.setDrawOrder(a+(1-(1+f)/c),e,b)}};c.prototype.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");
else{this.isFulfilled()||this.reject();for(var a=0;a<this.childGraphics3DSymbolPromises.length;a++)this.childGraphics3DSymbolPromises[a]&&this.childGraphics3DSymbolPromises[a].destroy();this.childGraphics3DSymbols=this.childGraphics3DSymbolPromises=null}};Object.defineProperty(c.prototype,"destroyed",{get:function(){return null==this.childGraphics3DSymbols},enumerable:!0,configurable:!0});return c}(e.default)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){var p=new b(Array,function(a){return e.set(a,e.ZERO)},null,10,5),n=k.create();return function(){function b(b,c,e,f){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var d=Array(2),g=0;g<d.length;g++)d[g]=Array(4);this._visibilityFlags=d;this.extent=this._featureExpressionFeature=null;++c.referenced;this.graphics3DSymbol=c;this.graphic=b;this._graphics=e;this._featureExpressionFeature=a.createFeature(b,f)}b.prototype.initialize=function(a,
b){var c=this;this._layer=a;this._stage=b;this.forEachSymbolLayerGraphic(function(e){e.initialize(a,b);e.setVisibility(c.isVisible())})};b.prototype.destroy=function(){this.forEachSymbolLayerGraphic(function(a){return a.destroy()});this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};Object.defineProperty(b.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!0,configurable:!0});b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});
this._labelGraphics.length=0};b.prototype.addLabelGraphic=function(a,b,c){this._labelGraphics.push(a);a.initialize(b,c);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))};b.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){"draped"===b.type&&(a=!0)});return a};b.prototype.isVisible=function(a,b){void 0===a&&(a=0);for(var c=
0;c<=a;c++)for(var e=this._visibilityFlags[c],f=0;f<e.length;++f)if(!1===e[f]&&f!==b)return!1;return!0};b.prototype.hasVisibilityFlag=function(a,b){return null!=this._visibilityFlags[b][a]};b.prototype.setVisibilityFlag=function(a,b,c){var e=this.isVisible(c);this._visibilityFlags[c][a]=b;var f=this.isVisible(c);if(e===f)return!1;if(1===c)this.forEachLabelGraphic(function(a){return a.setVisibility(f)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(f)});var d=this.isVisible(1);
this.forEachLabelGraphic(function(a){return a.setVisibility(d)})}return!0};b.prototype.clearVisibilityFlag=function(a,b){void 0===b&&(b=0);return this.setVisibilityFlag(a,void 0,b)};b.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});return a};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=f.vec3f64.create());return this._graphics[0].getCenterObjectSpace(a)};b.prototype.computeExtent=function(a){if(!this.extent){this.extent=
k.create();var b=this.graphic.geometry,e=b.spatialReference;c.computeAABR(b,this.extent);if(!e.equals(a)&&!h.boundingRectToBoundingRect(this.extent,e,this.extent,a))return this.extent=null,!1}return!0};Object.defineProperty(b.prototype,"usedMemory",{get:function(){var a=this,b=0;this.forEachSymbolLayerGraphic(function(e){var f=e.graphics3DSymbolLayer.complexity;e="draped"===e.type?f.memory.draped:f.memory;b+=e.bytesPerFeature;e.bytesPerCoordinate&&(b+=c.numVertices(a.graphic.geometry)*e.bytesPerCoordinate)});
return b},enumerable:!0,configurable:!0});b.prototype.getProjectedBoundingBox=function(a,b,c,f){return g(this,void 0,void 0,function(){var d=this;return q(this,function(h){switch(h.label){case 0:return f||(f={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),f.boundingBox?e.empty(f.boundingBox):f.boundingBox=e.empty(),f.requiresDrapedElevation=!1,[4,l.forEach(this._graphics,function(h){return g(d,void 0,void 0,function(){var d,g,k;return q(this,function(m){switch(m.label){case 0:if(!h)return[2];
d="draped"===h.type?b:a;g=p.acquire();return[4,h.getProjectedBoundingBox(d,c,f.screenSpaceObjects,g)];case 1:return k=m.sent(),isFinite(k[2])&&isFinite(k[5])||(f.requiresDrapedElevation=!0),k&&e.expand(f.boundingBox,g),p.release(g),[2]}})})})];case 1:return h.sent(),e.allFinite(f.boundingBox)||k.allFinite(e.toRect(f.boundingBox,n))?[2,f]:[2,null]}})})};b.prototype.needsElevationUpdates=function(){for(var a=0,b=this._graphics;a<b.length;a++){var c=b[a];if(c&&("object3d"===c.type||"lod-instance"===
c.type)&&c.needsElevationUpdates)return!0}a=0;for(b=this._labelGraphics;a<b.length;a++)if((c=b[a])&&c.needsElevationUpdates)return!0;return!1};b.prototype.alignWithElevation=function(a,b){var c=this;this.forEachRenderedGraphic(function(e){"object3d"!==e.type&&"lod-instance"!==e.type||e.alignWithElevation(a,b,c._featureExpressionFeature)})};b.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(c){return c.addHighlight(a,b)})};b.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};
b.prototype.forEachGraphicList=function(a,b){a.forEach(function(a,c){return a&&b(a,c)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return b}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){Object.defineProperty(d,"__esModule",{value:!0});var h=q.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");d.make=function(a,b,c,e){var f=n[a.type]&&n[a.type][b.type]||p[b.type];return f?new f(a,b,c,e):(h.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var p={icon:l.default,object:e.default,line:b.default,path:k.default,fill:c.default,extrude:g.default,text:a.default};d.setSymbolClass=function(a,b){p[a]=b};var n={"mesh-3d":{fill:f.default}}})},
"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../layers/graphics/dehydratedFeatures ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/edgeUtils ../../support/projectionUtils ../../support/buffer/BufferView ../../support/buffer/math/vec3 ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G){function L(a,b,e,f,d,g,h,k,m,l,n,p,r,v){var u=e.length/3,x=0;n+=2*f.count;var w=f.index,q=f.count,y=m,A=n;c.vec3.copy(Q,r);var C=0<p?1:-1,w=3*w,B=y;r=3*B;for(var E=y+q,y=3*E,J=0;J<q;++J)v&&(Q[0]=a[w+0],Q[1]=a[w+1],Q[2]=a[w+2],c.vec3.normalize(Q,Q)),d[r+0]=a[w+0],d[r+1]=a[w+1],d[r+2]=a[w+2],g[r+0]=b[w+0],g[r+1]=b[w+1],g[r+2]=b[w+2],h[r+0]=-C*Q[0],h[r+1]=-C*Q[1],h[r+2]=-C*Q[2],k[B]=0,d[y+0]=a[w+0]+p*Q[0],d[y+1]=a[w+1]+p*Q[1],d[y+2]=a[w+
2]+p*Q[2],g[y+0]=b[w+0],g[y+1]=b[w+1],g[y+2]=b[w+2],h[y+0]=C*Q[0],h[y+1]=C*Q[1],h[y+2]=C*Q[2],k[E]=p,r+=3,y+=3,w+=3,B+=1,E+=1;w=0;r=3*A;y=3*(A+u);r=3*(A+u);y=3*A;a=P;b=O;0>p&&(a=O,b=P);for(J=0;J<u;++J)l[r+0]=e[w+a[0]],l[r+1]=e[w+a[1]],l[r+2]=e[w+a[2]],l[y+0]=e[w+b[0]]+q,l[y+1]=e[w+b[1]]+q,l[y+2]=e[w+b[2]]+q,r+=3,y+=3,w+=3;m+=2*f.count;n=n+2*u-(2*f.count+2*u);K(d,g,k,h,x,f.pathLengths[0],f.count,m,l,n,p);m+=4*f.pathLengths[0];n+=2*f.pathLengths[0];x+=f.pathLengths[0];for(e=1;e<f.pathLengths.length;++e)K(d,
g,k,h,x,f.pathLengths[e],f.count,m,l,n,p),m+=4*f.pathLengths[e],n+=2*f.pathLengths[e],x+=f.pathLengths[e]}function F(a,b,c,e,f,d,g){e[d]=e[g];g*=3;d*=3;a[d+0]=a[g+0];a[d+1]=a[g+1];a[d+2]=a[g+2];b[d+0]=b[g+0];b[d+1]=b[g+1];b[d+2]=b[g+2];c[d+0]=f[0];c[d+1]=f[1];c[d+2]=f[2]}function K(a,b,e,f,d,g,h,k,m,l,n){var p=d,r=d+1,v=d+h,u=d+h+1,x=k,w=k+1,y=k+2*g;k=k+2*g+1;0>n&&(p=d+h+1,u=d);l*=3;for(var q=0;q<g;++q){q===g-1&&(0<n?(r=d,u=d+h):(r=d,p=d+h));var A=a,C=p,B=r,E=v,t=V,C=3*C,B=3*B,E=3*E;c.vec3.set(X,
A[C++],A[C++],A[C++]);c.vec3.set(J,A[B++],A[B++],A[B++]);c.vec3.set(R,A[E++],A[E++],A[E++]);c.vec3.subtract(T,J,X);c.vec3.subtract(W,R,X);c.vec3.cross(t,W,T);c.vec3.normalize(t,t);F(a,b,f,e,V,x,p);F(a,b,f,e,V,w,r);F(a,b,f,e,V,y,v);F(a,b,f,e,V,k,u);m[l++]=x;m[l++]=y;m[l++]=k;m[l++]=x;m[l++]=k;m[l++]=w;p++;r++;v++;u++;x+=2;w+=2;y+=2;k+=2}}Object.defineProperty(d,"__esModule",{value:!0});var M=a.vec3f64.create(),Q=a.vec3f64.create(),P=[0,2,1],O=[0,1,2],U=p.makeDehydratedPoint(0,0,0,null),N={verticalDistanceToGround:0,
terrainElevation:0};t=function(d){function p(b,c,e,f){b=d.call(this,b,c,e,f)||this;b._edgeStageObjects=new Set;if(!b._isPropertyDriven("size")&&(c=r.validateSymbolLayerSize(b._getSymbolSize())))return b._logWarning(c),b.reject(),b;c=b._getStageIdHint();f=b._getMaterialOpacityAndColor();e=a.vec3f64.fromArray(f);f=f[3];e={diffuse:e,ambient:e,opacity:f,transparent:1>f||b._isPropertyDriven("opacity"),vertexColors:!0,slicePlaneEnabled:b._context.slicePlaneEnabled,castShadows:b.symbolLayer.castShadows};
b._material=new G(e,c+"_3dlinemat");b._context.stage.add(A.ModelContentType.MATERIAL,b._material);b.resolve();return b}q(p,d);p.prototype.destroy=function(){d.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&this._context.stage.remove(A.ModelContentType.MATERIAL,this._material.id)};p.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;var c=a.geometry;if("polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for extrude symbol: "+
c.type),null;if(!this._validateGeometry(c))return null;var e="graphic"+a.uid,f=this._getVertexOpacityAndColor(b,Float32Array,255),d=this.getGraphicElevationContext(a);return this._createAs3DShape(c,b,f,d,e,a.uid)};p.prototype.layerOpacityChanged=function(){var a=this._getMaterialOpacity(),b=1>a||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:a,transparent:b});if(0<this._edgeStageObjects.size){var c=this._context.stage.view.ensureEdgeView(),e=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){return c.updateAllComponentOpacities(a,
[e])})}return!0};p.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,u.needsElevationUpdates3D)};p.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});if(0<this._edgeStageObjects.size){var e=this._context.stage.view.ensureEdgeView();a=this._createEdgeMaterial(e);if(g.isSome(a)){var f=[a];this._edgeStageObjects.forEach(function(a){return e.updateAllComponentMaterials(a,
f,{slicePlaneEnabled:c._context.slicePlaneEnabled},!1)})}}return!0};p.prototype.pixelRatioChanged=function(a,b){return!0};p.prototype._getExtrusionSize=function(a){a=a.size&&this._isPropertyDriven("size")?u.getSingleSizeDriver(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};p.prototype._getSymbolSize=function(){return this.symbolLayer.size||1};p.prototype._createAs3DShape=function(d,p,v,y,q,A){var B=this,J="extent"===d.type?h.fromExtent(d):d;d=J.rings;var t=
[],R=[],F=[],G=Array(6),z=this._context.renderSpatialReference===w.SphericalECEFSpatialReference,K=this._getExtrusionSize(p),T=a.vec3f64.create();z||this._context.renderCoordsHelper.worldUpAtPosition(null,T);p=u.getGeometryVertexData3D(d,J.hasZ,J.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,y);this._logGeometryCreationWarnings(p,d,"rings","ExtrudeSymbol3DLayer");if(0===d.length||!d.some(function(a){return 0<a.length}))return null;
var O=r.computeCentroid(J);d=k.mat4f64.create();w.computeLinearTransformation(J.spatialReference,[O.x,O.y,0],d,this._context.renderSpatialReference);var Q=k.mat4f64.create();e.mat4.invert(Q,d);var P=f.mat3f64.create();b.mat3.normalFromMat4(P,Q);for(var W=p.geometryData.polygons,V=p.eleVertexData,X=p.vertexData,J=X.length/3,ja=new Float64Array(18*J),fa=new Float64Array(18*J),ha=new Float64Array(18*J),Y=new Float64Array(6*J),da=0,J=function(a){var b=W[a],c=b.count,e=b.index;if(ga._context.clippingExtent&&
(u.computeBoundingBox(V,e,c,G),u.boundingBoxClipped(G,ga._context.clippingExtent)))return"continue";var f=new Float64Array(V.buffer,3*e*ja.BYTES_PER_ELEMENT,3*c),d=b.holeIndices.map(function(a){return a-e}),f=l(f,d,3);if(0===f.length)return"continue";var d=new Uint32Array(6*c+2*f.length),g=6*c,h=3*ja.BYTES_PER_ELEMENT,h=new m.BufferViewVec3f64(ja.buffer,da*h,h,(da+g)*h),p=3*fa.BYTES_PER_ELEMENT,p=new m.BufferViewVec3f64(fa.buffer,da*p,p,(da+g)*p),n=new Float64Array(ha.buffer,3*da*ha.BYTES_PER_ELEMENT,
3*g),g=new Float64Array(Y.buffer,1*da*Y.BYTES_PER_ELEMENT,1*g);L(X,V,f,b,h.typedBuffer,n,p.typedBuffer,g,0,d,0,K,T,z);x.transformMat4(h,h,Q);x.transformMat3(p,p,P);da+=6*c;b=ga._createExtrudeGeometry(d,{positions:h.typedBuffer,elevation:n,normals:p.typedBuffer,heights:g},v);a=new C(b,q+"path"+a);a.singleUse=!0;t.push(a);R.push(ga._material);F.push(k.mat4f64.create())},ga=this,O=0;O<W.length;++O)J(O);if(0===t.length)return null;var ka=new E({geometries:t,materials:R,transformations:F,castShadow:!0,
metadata:{layerUid:this._context.layer.uid,graphicUid:A},idHint:q});ka.objectTransformation=d;var ia=function(a){var b=B._context.stage.view.ensureEdgeView();b.removeObject(a);B._edgeStageObjects.delete(a);var c=B._createEdgeMaterial(b);g.isSome(c)&&(B._edgeStageObjects.add(a),b.addObject(a,[c],{slicePlaneEnabled:B._context.slicePlaneEnabled},!B._context.isAsync))};ia(ka);A=new n(this,ka,t,null,null,function(a,b,f,d){a=a.stageObject;U.spatialReference=f.spatialReference;for(var g=a.getGeometryRecords(),
h=g.length,m="absolute-height"!==b.mode,l=0,p=a.objectTransformation,n=e.mat4.invert(k.mat4f64.create(),p),r=0;r<h;r++){var v=g[r].geometry;v.invalidateBoundingInfo();for(var x=v.data.getVertexAttr(),v=x[I.VertexAttrConstants.POSITION].data,w=x[I.VertexAttrConstants.SIZE].data,x=x.mapPos.data,y=v.length/3,q=0,A=0,C=!1,B=0,E=0;E<y;E++){U.x=x[A];U.y=x[A+1];U.z=x[A+2];Z[0]=v[q];Z[1]=v[q+1];Z[2]=v[q+2];var J=u.computeElevation(f,U,b,d,m?N:null);m&&(B+=N.terrainElevation);c.vec3.set(M,v[q+0],v[q+1],v[q+
2]);c.vec3.transformMat4(M,M,p);d.setAltitude(J+w[q/3],M);c.vec3.transformMat4(M,M,n);v[q]=M[0];v[q+1]=M[1];v[q+2]=M[2];J=.01/d.unitInMeters;if(Math.abs(Z[0]-v[q])>J||Math.abs(Z[1]-v[q+1])>J||Math.abs(Z[2]-v[q+2])>J)C=!0;A+=3;q+=3}C&&a.geometryVertexAttrsUpdated(r);l+=B/y}b=l/h;ia(ka);return b},y);A.alignedTerrainElevation=p.terrainElevation;A.needsElevationUpdates=u.needsElevationUpdates3D(y.mode);return A};p.prototype._createExtrudeGeometry=function(a,b,c){for(var e=a.length,f=new Uint32Array(e),
d=0;d<e;d++)f[d]=0;e={};d={};e[I.VertexAttrConstants.POSITION]=a;e[I.VertexAttrConstants.NORMAL]=a;e[I.VertexAttrConstants.COLOR]=f;d[I.VertexAttrConstants.POSITION]={size:3,data:b.positions};d[I.VertexAttrConstants.NORMAL]={size:3,data:b.normals};d[I.VertexAttrConstants.COLOR]={size:4,data:c};d[I.VertexAttrConstants.SIZE]={size:1,data:b.heights};b.elevation&&(d.mapPos={size:3,data:b.elevation},e.mapPos=a);return new B(d,e)};p.prototype._createEdgeMaterial=function(a){var b={opacity:this._getLayerOpacity()};
return y.createMaterial(a,this.symbolLayer,b)};return p}(v.default);d.Graphics3DExtrudeSymbolLayer=t;var V=a.vec3f64.create(),X=a.vec3f64.create(),J=a.vec3f64.create(),R=a.vec3f64.create(),T=a.vec3f64.create(),W=a.vec3f64.create(),Z=a.vec3f64.create();d.default=t})},"esri/views/3d/layers/support/edgeUtils":function(){define("require exports ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),function(t,
d,q,g,l,b,f){function e(e,c,a){if(l.isNone(c))return null;var d=f.vec4f64.fromArray(q.toUnitRGBA(c.color));a=a.opacity;switch(c.type){case "solid":return e.createSolidEdgeMaterial({color:d,size:b.pt2px(c.size),extensionLength:b.pt2px(c.extensionLength),opacity:a});case "sketch":return e.createSketchEdgeMaterial({color:d,size:b.pt2px(c.size),extensionLength:b.pt2px(c.extensionLength),opacity:a});default:g.neverReached(c)}}Object.defineProperty(d,"__esModule",{value:!0});d.createMaterial=function(b,
c,a){return e(b,c&&c.enabled&&c.edges||null,a)};d.createMaterialFromEdges=e})},"esri/views/3d/support/buffer/math/vec3":function(){define(["require","exports","./common"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.transformMat4=function(d,l,b){if(d.count!==l.count)q.logger.error("source and destination buffers need to have the same number of elements");else{var f=d.count,e=b[0],g=b[1],c=b[2],a=b[4],h=b[5],p=b[6],n=b[8],u=b[9],v=b[10],r=b[12],y=b[13];b=b[14];var w=d.typedBuffer;
d=d.typedBufferStride;var m=l.typedBuffer;l=l.typedBufferStride;for(var x=0;x<f;x++){var A=x*d,C=x*l,B=m[C],E=m[C+1],C=m[C+2];w[A]=e*B+a*E+n*C+r;w[A+1]=g*B+h*E+u*C+y;w[A+2]=c*B+p*E+v*C+b}}};d.transformMat3=function(d,l,b){if(d.count!==l.count)q.logger.error("source and destination buffers need to have the same number of elements");else{var f=d.count,e=b[0],g=b[1],c=b[2],a=b[3],h=b[4],p=b[5],n=b[6],u=b[7];b=b[8];var v=d.typedBuffer;d=d.typedBufferStride;var r=l.typedBuffer;l=l.typedBufferStride;for(var y=
0;y<f;y++){var w=y*d,m=y*l,x=r[m],A=r[m+1],m=r[m+2];v[w]=e*x+a*A+n*m;v[w+1]=g*x+h*A+u*m;v[w+2]=c*x+p*A+b*m}}};d.scale=function(d,l,b){var f=Math.min(d.count,l.count),e=d.typedBuffer;d=d.typedBufferStride;var g=l.typedBuffer;l=l.typedBufferStride;for(var c=0;c<f;c++){var a=c*d,h=c*l;e[a]=b*g[h];e[a+1]=b*g[h+1];e[a+2]=b*g[h+2]}}})},"esri/views/3d/support/buffer/math/common":function(){define(["require","exports","../../../../../core/Logger"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});
d.logger=q.getLogger("esri.views.3d.support.buffer.math")})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/buffer/InterleavedLayout ../lib/GLMaterialTexture ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/HardwareInstancedRenderer ./renderers/MergedRenderer ../shaders/DefaultPrograms ../../../webgl/renderState".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w){function m(a,b){var c=b.vvSizeEnabled;b.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor)):c&&a.setUniform3fv("vvSizeValue",b.vvSizeValue);c&&(a.setUniform3fv("vvSymbolAnchor",b.vvSymbolAnchor),a.setUniformMatrix3fv("vvSymbolRotationMatrix",b.vvSymbolRotationMatrix));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",
b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors))}var x=h.assert;t=function(a){function b(c,e){e=a.call(this,e)||this;e.supportsEdges=!0;e.params=u.copyParameters(c,G);e.vertexBufferLayout=b.getVertexBufferLayout(e.params);e.instanceBufferLayout=c.instanced?b.getInstanceBufferLayout(e.params):null;e.textureMode=e.vertexBufferLayout.hasField("uv0")?"Textured":"none";return e}q(b,a);b.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};b.prototype.isVisible=
function(){var b=this.params;if(!a.prototype.isVisible.call(this)||0===b.layerOpacity)return!1;var c=b.instanced,e=b.vertexColors,f=b.symbolColors,c=!!c&&-1<c.indexOf("color"),d=b.vvColorEnabled,g="replace"===b.colorMixMode,h=0<b.opacity,b=b.externalColor&&0<b.externalColor[3];return e&&(c||d||f)?g?!0:h:e?g?b:h:c||d||f?g?!0:h:g?b:h};b.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"instanced"===c&&x(a.instanced===b.instanced,"Can not change instanced attributes"),"textureId"===
c&&x(b.textureId,"Can only change texture of material that already has a texture"),"vertexColors"===c&&!0===a[c]&&a[c]!==b[c]&&x(b.vertexColors,"Can not enable vertex colors after DefaultMaterial creation"),b[c]=a[c];this.notifyDirty("matChanged")};b.prototype.getParameters=function(){return this.params};b.prototype.intersect=function(a,b,c,e,d,g,h,k){if(null!==this.params.verticalOffset){k=e.camera;f.vec3.set(N,c[12],c[13],c[14]);var m=f.vec3.subtract(V,N,k.eye),l=f.vec3.length(m),p=f.vec3.scale(m,
m,1/l),n=null,m=null;switch(e.viewingMode){case "global":m=f.vec3.normalize(O,N);break;case "local":m=f.vec3.copy(O,P)}this.params.screenSizePerspective&&(n=f.vec3.dot(m,p));k=u.verticalOffsetAtDistance(k,l,this.params.verticalOffset,n,this.params.screenSizePerspective);f.vec3.scale(m,m,k);f.vec3.transformMat3(U,m,e.transform.inverseRotation);d=f.vec3.subtract(M,d,U);g=f.vec3.subtract(Q,g,U)}u.intersectTriangleGeometry(a,b,c,e,d,g,h)};b.prototype.getGLMaterials=function(){return{color:A,depthShadowMap:B,
normal:E,depth:C,highlight:I}};b.prototype.getAllTextureIds=function(){var a=[];this.params.textureId&&a.push(this.params.textureId);this.params.normalTextureId&&a.push(this.params.normalTextureId);return[]};b.prototype.createRenderer=function(a,b){return this.params.instanced&&0<this.params.instanced.length?new v(a,b,this):new r(a,b,this)};b.prototype.createBufferWriter=function(){return new L(this.vertexBufferLayout,this.instanceBufferLayout)};b.getVertexBufferLayout=function(a){var b=k.newLayout().vec3f("position").vec3f("normal");
a.vertexTangents&&b.vec4f("aTangent");a.textureId&&b.vec2f("uv0");a.vertexColors&&b.vec4u8("color");a.symbolColors&&b.vec4u8("symbolColor");return b};b.getInstanceBufferLayout=function(a){var b=k.newLayout(),b=a.instancedDoublePrecision?b.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):b.mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(b=b.vec4f("instanceColor"));a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(b=b.vec4f("instanceFeatureAttribute"));
return b};return b}(a);var A=function(a){function b(b,c,e){var f=this,d=b.getParameters(),f=a.call(this,b,c,e,d.textureId,d.normalTextureId,d.textureInitTransparent)||this;f.params=u.copyParameters(d);c=f.params;f.slot=c.transparent?c.writeDepth?6:9:4;f.textureMode=b.textureMode;b=c.instanced;f.instanced=!!b;f.instancedColor=!!b&&-1<b.indexOf("color");f._createPrograms();f.selectPipeline();return f}q(b,a);b.prototype._createPrograms=function(){var a=this;this.programs=n.BindParametersMap.create(this.params,
function(b){return a._createProgram(b)})};b.prototype._createProgram=function(a){var b=this.params;return this.programRep.getProgram(y.colorPass,{treeRendering:!!b.treeRendering,textureMode:this.textureMode,normalTexture:!!b.normalTextureId,tangents:b.vertexTangents?"vertex":"none",vertexColors:b.vertexColors,symbolColors:b.symbolColors,flipV:b.flipV,doubleSided:b.doubleSided&&"normal"===b.doubleSidedType,windowOrderDoubleSided:b.doubleSided&&"winding-order"===b.doubleSidedType,instanced:!!this.instanced,
instancedDoublePrecision:b.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,verticalOffset:null!==b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,normals:b.normals,textureAlphaMode:b.textureAlphaMode,textureAlphaPremultiplied:!!b.textureAlphaPremultiplied,iosSafariFix:K})};b.prototype.selectPipeline=function(){var a=this.params;this.pipelineState=
w.makePipelineState({blending:a.transparent&&w.separateBlendingParams(770,1,771,771),culling:F(a),depthTest:{func:513},depthWrite:a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};b.prototype.getPrograms=function(){return n.BindParametersMap.programs(this.programs)};b.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());
this.slot=this.params.transparent?this.params.writeDepth?6:9:4;this.updateTexture(this.params.textureId);this._createPrograms();this.selectPipeline()};b.prototype.bind=function(a,b){var c=this.params,e=this.program=n.BindParametersMap.lookup(this.programs,b);a.bindProgram(e);a.setPipelineState(this.pipelineState);e.setUniform3fv("ambient",c.ambient);e.setUniform3fv("diffuse",c.diffuse);e.setUniform3fv("specular",c.specular);e.setUniform4fv("externalColor",c.externalColor);e.setUniform1i("colorMixMode",
u.colorMixModes[c.colorMixMode]);e.setUniform1f("opacity",c.opacity);e.setUniform1f("layerOpacity",c.layerOpacity);u.bindVerticalOffset(c.verticalOffset,b,e);u.bindScreenSizePerspective(c.screenSizePerspective,e);m(e,c);this.bindTexture(a,e);"none"!==this.textureMode&&this.bindTextureSize(a,e);"mask"!==c.textureAlphaMode&&"maskBlend"!==c.textureAlphaMode||e.setUniform1f("textureAlphaCutoff",c.textureAlphaCutoff)};b.prototype.release=function(a,b){};b.prototype.bindView=function(a,b){a=this.program=
n.BindParametersMap.lookup(this.programs,b);var c=this.params,f=c.instancedDoublePrecision?e.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;u.bindView(f,b.view,a);u.bindCamPos(f,b.viewInvTransp,a);c.instancedDoublePrecision&&u.bindViewOriginDouble(f,a);c.slicePlaneEnabled&&u.bindSlicePlane(f,b.slicePlane,a);b.shadowMappingEnabled&&b.shadowMap.bindView(a,f)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);
a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return 4};return b}(c),C=function(a){function b(b,c,e,f){void 0===f&&(f=!1);c=a.call(this,b,c,e,b.getParameters().textureId)||this;c.textureMode=b.textureMode;c.biased=f;c.updateParameters();return c}q(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(y.depthPass,
{textureMode:this.textureMode,normalTexture:!!a.normalTextureId,tangents:a.vertexTangents?"vertex":"none",flipV:a.flipV,instanced:!!a.instanced,instancedDoublePrecision:a.instancedDoublePrecision,shadowMap:this.biased,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,textureAlphaMode:a.textureAlphaMode,normals:a.normals,iosSafariFix:K});this.pipelineState=w.makePipelineState({culling:F(a),depthTest:{func:513},
depthWrite:a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?6:9:4};b.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,e=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);c.setUniform2fv("nearFar",
b.nearFar);u.bindVerticalOffset(e.verticalOffset,b,c);u.bindScreenSizePerspective(e.screenSizePerspective,c);m(c,e);"mask"!==e.textureAlphaMode&&"maskBlend"!==e.textureAlphaMode||c.setUniform1f("textureAlphaCutoff",e.textureAlphaCutoff);this.bindTexture(a,c)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,f=c.instancedDoublePrecision?e.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;u.bindView(f,b.view,a);
c.slicePlaneEnabled&&u.bindSlicePlane(f,b.slicePlane,a);c.screenSizePerspective&&u.bindCamPos(f,b.viewInvTransp,a);c.instancedDoublePrecision&&u.bindViewOriginDouble(f,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 4};return b}(c),B=function(a){function b(b,c,e){return a.call(this,b,c,e,!0)||this}q(b,a);return b}(C),E=function(a){function b(b,c,e){c=a.call(this,b,c,e,b.getParameters().textureId)||this;
c.params=u.copyParameters(b.getParameters());c.textureMode=b.textureMode;c.selectProgram();c.selectSlot();return c}q(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(y.normalPass,{textureMode:this.textureMode,normalTexture:!!a.normalTextureId,tangents:a.vertexTangents?"vertex":"none",flipV:a.flipV,instanced:!!a.instanced,instancedDoublePrecision:a.instancedDoublePrecision,
vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,textureAlphaMode:a.textureAlphaMode,normals:a.normals,iosSafariFix:K});this.pipelineState=w.makePipelineState({culling:F(a),depthTest:{func:513},depthWrite:a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?6:9:4};b.prototype.updateParameters=
function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,e=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);this.bindTexture(a,c);u.bindVerticalOffset(e.verticalOffset,b,c);u.bindScreenSizePerspective(e.screenSizePerspective,c);m(c,e);"mask"!==e.textureAlphaMode&&"maskBlend"!==e.textureAlphaMode||c.setUniform1f("textureAlphaCutoff",e.textureAlphaCutoff)};
b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,f=c.instancedDoublePrecision?e.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;u.bindView(f,b.view,a);a.setUniformMatrix4fv("viewNormal",b.viewInvTransp);c.slicePlaneEnabled&&u.bindSlicePlane(f,b.slicePlane,a);c.screenSizePerspective&&u.bindCamPos(f,b.viewInvTransp,a);c.instancedDoublePrecision&&u.bindViewOriginDouble(f,a)};b.prototype.bindInstance=function(a,
b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return 4};return b}(c),I=function(a){function b(b,c,e){c=a.call(this,b,c,e,b.getParameters().textureId)||this;c.textureMode=b.textureMode;c.updateParameters();return c}q(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;
this.program=this.programRep.getProgram(y.highlightPass,{textureMode:this.textureMode,normalTexture:!!a.normalTextureId,tangents:a.vertexTangents?"vertex":"none",flipV:a.flipV,instanced:!!a.instanced,instancedDoublePrecision:a.instancedDoublePrecision,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,textureAlphaMode:a.textureAlphaMode,normals:a.normals,iosSafariFix:K});this.pipelineState=w.makePipelineState({culling:F(a),
depthTest:{func:513},depthWrite:a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?6:9:4};b.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,e=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);
u.bindHighlightRendering(a,b,c);this.bindTexture(a,c);u.bindVerticalOffset(e.verticalOffset,b,c);u.bindScreenSizePerspective(e.screenSizePerspective,c);m(c,e);"mask"!==e.textureAlphaMode&&"maskBlend"!==e.textureAlphaMode||c.setUniform1f("textureAlphaCutoff",e.textureAlphaCutoff)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,f=c.instancedDoublePrecision?e.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;
u.bindView(f,b.view,a);c.slicePlaneEnabled&&u.bindSlicePlane(f,b.slicePlane,a);c.screenSizePerspective&&u.bindCamPos(f,b.viewInvTransp,a);c.instancedDoublePrecision&&u.bindViewOriginDouble(f,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return 4};return b}(c);(t||(t={})).COLOR_GAMMA=2.1;var G={textureId:void 0,textureInitTransparent:!1,normalTextureId:void 0,
vertexTangents:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,
1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:b.mat3f64.create(),transparent:!1,writeDepth:!0,textureAlphaMode:"blend",textureAlphaCutoff:.1,textureAlphaPremultiplied:!1},L=function(){function a(a,b){this.vertexBufferLayout=a;this.instanceBufferLayout=b}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=
function(a){return a.indices.position.length};a.prototype.write=function(a,b,c,e,f){p.writeDefaultAttributes(b,c,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,e,f)};return a}(),F=function(a){var b;b=a.slicePlaneEnabled?!1:a.cullFace?"none"!==a.cullFace:!a.transparent&&!a.doubleSided;return b&&{face:"front"===a.cullFace?1028:1029,mode:2305}},K=!!l("ios")&&!!l("safari"),M=e.vec3f64.create(),Q=e.vec3f64.create(),P=e.vec3f64.fromValues(0,0,1),O=e.vec3f64.create(),U=e.vec3f64.create(),
N=e.vec3f64.create(),V=e.vec3f64.create();return t})},"esri/views/3d/webgl-engine/materials/renderers/HardwareInstancedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/BufferView ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ../../lib/InstanceBufferData ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),function(t,d,q,g,l,b,f,e,k,c,a){function h(a,
b){var c=new Map,e=function(a,b){var e=a.origin.id,f=a.data.id,d=c.get(e);d||(d={origin:a.origin.vec3,deltaByGeometry:new Map},c.set(e,d));e=d.deltaByGeometry.get(f);e||(e={renderData:a.data,toAdd:[],toRemove:[]},d.deltaByGeometry.set(f,e));(b?e.toAdd:e.toRemove).push(a)};a.forEach(function(a){e(a,!0)});b.forEach(function(a){e(a,!1)});return c}function p(a,b,c){var e=b.elementCount(a),e=b.allocate(e);b.write({},a,null,e,0);c.setData(e.buffer)}var n=function(){function c(c,e,d,g,h){void 0===h&&(h=
0);this.data=new f(d,h);this.instanceBuffer=k.createVertex(c,35044);this.vao=new a(c,b.Default3D,{geometry:l.glLayout(e),instance:l.glLayout(d,{divisor:1})},{geometry:g,instance:this.instanceBuffer})}c.prototype.dispose=function(){this.vao.dispose(!1);this.instanceBuffer.dispose()};Object.defineProperty(c.prototype,"count",{get:function(){return this.data.getCount()},enumerable:!0,configurable:!0});c.prototype.has=function(a){return this.data.hasSlot(a.idx)};c.prototype.prepareAdd=function(a){this.data.prepareAllocate(a)};
c.prototype.add=function(a){var b=this.data.allocate(a.idx);this.writeInstance(a,b)};c.prototype.prepareRemove=function(a){this.data.prepareFree(a)};c.prototype.remove=function(a){this.data.free(a.idx)};c.prototype.updateTransform=function(a,b){void 0===b&&(b=!0);var c=this.data.getSlot(a.idx);null!=c&&(this.writeTransform(a,c),b&&this.uploadSlot(c))};c.prototype.uploadAll=function(){this.data.compact();this.instanceBuffer.setData(this.data.getBuffer().buffer)};c.prototype.uploadSlot=function(a){var b=
this.data,c=b.layout.stride;a*=c;this.instanceBuffer.setSubData(b.getBuffer().buffer,a,a,a+c)};c.prototype.instanceBufferView=function(){var a=this.data.getBuffer();this._buffer!==a&&(this._bufferView={transformation:a.getField("model",g.BufferViewMat4f),transformationNormal:a.getField("modelNormal",g.BufferViewMat4f),instanceColor:a.getField("instanceColor",g.BufferViewVec4f),instanceFeatureAttribute:a.getField("instanceFeatureAttribute",g.BufferViewVec4f)});return this._bufferView};c.prototype.writeTransform=
function(a,b){var c=this.instanceBufferView();e.calculateTransformRelToOrigin(a,u,v);c.transformation.setMat(b,u);c.transformationNormal.setMat(b,v)};c.prototype.writeInstance=function(a,b){var c=this.instanceBufferView();e.calculateTransformRelToOrigin(a,u,v);c.transformation.setMat(b,u);c.transformationNormal.setMat(b,v);c.instanceColor&&c.instanceColor.setVec(b,a.instanceParameters.color);c.instanceFeatureAttribute&&c.instanceFeatureAttribute.setVec(b,a.instanceParameters.featureAttribute)};return c}();
t=function(){function a(a,b,c){this._dataByOrigin=new Map;this._highlightCount=0;this._instanceDataToUploadCache=new Set;this._rctx=a;this._material=c;this._materialRep=b;this._glMaterials=e.acquireMaterials(this._material,this._materialRep);this._bufferWriter=c.createBufferWriter()}a.prototype.dispose=function(){e.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});a.prototype.renderPriority=function(){return this._material.renderPriority};a.prototype.modify=function(a){this.updateGeometries(a.toUpdate);this.addAndRemoveGeometries(a.toAdd,a.toRemove);this.updateHighlightCount()};a.prototype.addAndRemoveGeometries=function(a,b){var c=this._rctx,f=this._bufferWriter,d=this._dataByOrigin;a=h(a,b);var g=f.vertexBufferLayout,l=f.instanceBufferLayout;a.forEach(function(a,
b){var h=d.get(b);h||(h={origin:a.origin,highlightCount:0,dataByGeometry:new Map},d.set(b,h));a.deltaByGeometry.forEach(function(a,b){var d=h.dataByGeometry.get(b);!d&&0<a.toAdd.length&&(d=k.createVertex(c,35044),p(a.renderData,f,d),d={count:0,vertexBuffer:d,instanceData:new n(c,g,l,d,a.toAdd.length),highlightInstanceData:new n(c,g,l,d)},h.dataByGeometry.set(b,d));var m=d.instanceData,r=d.highlightInstanceData;m.prepareAdd(a.toAdd.length);a.toAdd.forEach(function(a){e.isRenderGeometryHidden(a)||(m.add(a),
e.doesRenderGeometryHaveHighlights(a)&&(r.add(a),h.highlightCount=null))});m.prepareRemove(a.toRemove.length);a.toRemove.forEach(function(a){m.remove(a);r.remove(a)});a.toAdd.length+a.toRemove.length&&(m.uploadAll(),r.uploadAll());d.count+=a.toAdd.length;d.count-=a.toRemove.length;0===d.count&&(d.instanceData.dispose(),d.highlightInstanceData.dispose(),d.vertexBuffer.dispose(),h.dataByGeometry.delete(b))});0===h.dataByGeometry.size&&d.delete(b)})};a.prototype.updateGeometries=function(a){var b=this._dataByOrigin,
c=this._bufferWriter;this._instanceDataToUploadCache.clear();var f=this._instanceDataToUploadCache;a.forEach(function(a){var d=a.updateType;a=a.renderGeometry;var g=b.get(a.origin.id),h=g&&g.dataByGeometry.get(a.data.id);if(h){var k=h.instanceData,m=h.highlightInstanceData,l=d&1;l&&(e.isRenderGeometryHidden(a)?(k.remove(a),f.add(k),m.has(a)&&(m.remove(a),f.add(m))):k.has(a)||(k.add(a),f.add(k),e.doesRenderGeometryHaveHighlights(a)&&!m.has(a)&&(m.add(a),f.add(m))));if(k=d&16)e.doesRenderGeometryHaveHighlights(a)?
m.has(a)||(m.add(a),f.add(m)):(m.remove(a),f.add(m)),g.highlightCount=null;d&2&&p(a.data,c,h.vertexBuffer);d&4&&(h.instanceData.updateTransform(a,!l),h.highlightInstanceData.updateTransform(a,!k))}});f.forEach(function(a){a.uploadAll()})};a.prototype.updateHighlightCount=function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(b){if(null==b.highlightCount){var c=0;b.dataByGeometry.forEach(function(a){c+=a.highlightInstanceData.count});b.highlightCount=c}a._highlightCount+=
b.highlightCount})};a.prototype.render=function(a,b,e,f){var d=this._rctx,g=d.capabilities.instancing,h=this._glMaterials.get(b.pass),k=4===b.pass;if(!h||null!=a&&!h.beginSlot(a)||k&&0===this._highlightCount)return!1;var m=h.getProgram(),l=h.getDrawMode();h.bind(d,e);var p=!1;this._dataByOrigin.forEach(function(a){k&&0===a.highlightCount||(e.origin=a.origin,h.bindView(d,e),a.dataByGeometry.forEach(function(a){var b=k?a.highlightInstanceData:a.instanceData;a=b.count;k&&0===a||(b=b.vao,c.assertCompatibleVertexAttributeLocations(b,
m),d.bindVAO(b),b=c.vertexCount(b,"geometry"),g.drawArraysInstanced(l,0,b,a),f&&(f.drawCallsInstanced++,4===l&&(f.triangles+=b/3*a)),p=!0)}))});d.bindVAO(null);h.release(d,e);return p};return a}();var u=q.mat4f64.create(),v=q.mat4f64.create();return t})},"esri/views/3d/webgl-engine/lib/InstanceBufferData":function(){define(["require","exports","../../../../core/mathUtils"],function(t,d,q){return function(){function d(d,b){void 0===b&&(b=0);this.count=this.capacity=0;this.emptySlots=[];this.emptySlotCount=
0;this.id2slot=new Map;this.slot2id=[];this.layout=d;this.resize(b)}d.prototype.prepareAllocate=function(d){d=this.count+d;d>this.capacity&&this.resize(d)};d.prototype.allocate=function(d){this.count>=this.capacity&&this.resize(this.count+1);var b=0<this.emptySlotCount?this.emptySlots[--this.emptySlotCount]:this.count;this.id2slot.set(d,b);this.slot2id[b]=d;this.count++;return b};d.prototype.prepareFree=function(d){this.emptySlots.length+=d};d.prototype.free=function(d){var b=this.id2slot.get(d);
null!=b&&(this.emptySlots.length<=this.emptySlotCount&&(this.emptySlots.length=this.emptySlotCount+1),this.emptySlots[this.emptySlotCount++]=b,this.id2slot.delete(d),this.slot2id[b]=null,this.count--)};d.prototype.getCount=function(){return this.count};d.prototype.getSlot=function(d){return this.id2slot.get(d)};d.prototype.hasSlot=function(d){return this.id2slot.has(d)};d.prototype.getBuffer=function(){return this.buffer};d.prototype.compact=function(){if(0<this.emptySlotCount){var d=this.emptySlots,
b=this.emptySlotCount,f=this.count+b;d.length=b;for(d.sort(function(a,b){return a-b});0<b;){if(d[b-1]!==f-1){var e=f-1,g=d[b-1];this.buffer.copyFrom(this.buffer,e,g,1);var c=this.slot2id[e];this.slot2id[e]=null;this.slot2id[g]=c;this.id2slot.set(c,g)}b--;f--}}this.emptySlotCount=0;this.emptySlots.length=0;this.resize(this.count)};d.prototype.resize=function(d){var b=this.capacity;d=Math.max(0,d);0<d&&(d=q.nextHighestPowerOfTwo(d));if(d>b){var f=this.layout.createBuffer(d);this.buffer&&f.copyFrom(this.buffer,
0,0,b);this.buffer=f}else d<b&&(f=this.layout.createBuffer(d),f.copyFrom(this.buffer,0,0,d),this.buffer=f);this.buffer||(this.buffer=this.layout.createBuffer(0));this.capacity=d;this.slot2id.length=d};return d}()})},"esri/views/3d/webgl-engine/shaders/DefaultPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=function(b){return l.glslifyDefineMap({TEXTURING:"none"!==
b.textureMode,TEXTURE_ATLAS:"AtlasTextured"===b.textureMode,VERTEXCOLORS:b.vertexColors,SYMBOLVERTEXCOLORS:b.symbolColors,FLIPV:b.flipV,DOUBLESIDED:b.doubleSided,WINDINGORDERDOUBLESIDED:b.windowOrderDoubleSided,INSTANCED:b.instanced,INSTANCED_DOUBLE_PRECISION:b.instancedDoublePrecision,INSTANCEDCOLOR:b.instancedColor,RECEIVE_SHADOWS:b.receiveShadows,RECEIVE_SSAO:b.receiveSSAO,VV_SIZE:b.vvSize,VV_COLOR:b.vvColor,VERTICAL_OFFSET:b.verticalOffset,SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,SLICE:b.slice,
GROUND_NORMAL_SHADING:b.groundNormalShading,NORMALS:{value:b.normals,options:{default:"NORMALS_DEFAULT",compressed:"NORMALS_COMPRESSED",screenDerivative:"NORMALS_SCREEN_DERIVATIVE"}},COMPONENTCOLORS:b.componentColor,TEXTURE_ALPHA_MODE_MASK:"mask"===b.textureAlphaMode,TEXTURE_ALPHA_MODE_MASK_BLEND:"maskBlend"===b.textureAlphaMode,TEXTURE_ALPHA_MODE_OPAQUE:"opaque"===b.textureAlphaMode,BIAS_SHADOWMAP:b.shadowMap,VERTEX_TANGENTS:"vertex"===b.tangents,TEXTURE_NORMALS:!!b.normalTexture,TEXTURE_COORDINATES:!!b.normalTexture||
"none"!==b.textureMode,TREE_RENDERING:b.treeRendering,IOS_SAFARI_FIX:b.iosSafariFix,TEXTURE_ALPHA_PREMULTIPLIED:!!b.textureAlphaPremultiplied})};d.colorPass={name:"default-color",shaders:function(f){return{vertexShader:b(f)+g.resolveIncludes("materials/defaultMaterial/colorPass.vert"),fragmentShader:b(f)+g.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:q.Default3D};d.depthPass={name:"default-depth",shaders:function(f){return{vertexShader:b(f)+g.resolveIncludes("materials/defaultMaterial/depthPass.vert"),
fragmentShader:b(f)+g.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},attributes:q.Default3D};d.normalPass={name:"default-normal",shaders:function(f){return{vertexShader:b(f)+g.resolveIncludes("materials/defaultMaterial/normalPass.vert"),fragmentShader:b(f)+g.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:q.Default3D};d.highlightPass={name:"default-highlight",shaders:function(f){return{vertexShader:b(f)+g.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),
fragmentShader:b(f)+g.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},attributes:q.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/errors/CancelError ../../../../Color ../../../../core/asyncUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M,Q,P,O,U,N,V,X){function J(a){return n.isSome(a)?"cross"===a||"x"===a:!1}Object.defineProperty(d,"__esModule",{value:!0});var R=y.mat4f64.create(),T=m.vec3f64.fromValues(0,0,1),W=[0,0,0,0],Z=m.vec3f64.fromValues(0,0,0),fa=m.vec3f64.fromValues(1,1,1),ga=[.25,.25,.75,.75],ja=[64,64];t=function(d){function x(a,b,c,e){a=d.call(this,a,b,c,e)||this;a._size=null;a._symbolTextureRatio=1;a._outlineSize=0;a._texture=null;a._drapedMaterial=
null;a._releaseTexture=null;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};if(!a._validate())return a;b=a._prepareMaterialParameters();c=a._getPrimitive();n.isSome(c)?a._prepareResourcesPrimitive(b,c):a._prepareResourcesHref(b);return a}g(x,d);x.prototype.getCachedSize=function(){return{size:this._getIconSize()}};x.prototype._validate=function(){if(this._isPropertyDriven("size"))return!0;var a=F.validateSymbolLayerSize(this._getIconSize());return a?(this._logWarning(a),this.reject(),
!1):!0};x.prototype._getIconSize=function(){var a=this.symbolLayer,a=Math.round(null!=a.size?v.pt2px(a.size):16);return this._isPropertyDriven("size")?Math.max(a,64):a};x.prototype._prepareMaterialParameters=function(){var a={anchorPos:this._getAnchorPos()},b=this.symbol;if(this._hasVisibleVerticalOffset(b)){var b=b.verticalOffset,c=b.minWorldLength,e=b.maxWorldLength;a.verticalOffset={screenLength:v.pt2px(b.screenLength),minWorldLength:c||0,maxWorldLength:null!=e?e:Infinity}}this._context.screenSizePerspectiveEnabled&&
(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);return a};x.prototype._prepareResourcesPrimitive=function(a,b){var e=this,f=this._getOutlineSize();if(J(b)&&0===f)this.reject();else{this._outlineSize=f;a.color=this._getFillColor();a.outlineColor=this._getOutlineColor();a.outlineSize=this._outlineSize;var d=this._context.sharedResources.textures.fromData(b,function(){var a;switch(b){case "circle":a=K.createCircle(128,64);break;case "square":a=K.createSquare(128,
64);break;case "kite":a=K.createKite(128,64);break;case "cross":a=K.createCross(128,64);break;case "x":a=K.createX(128,64);break;case "triangle":a=K.createTriangle(128,64);break;default:c.neverReached(b)}return new V(a,"sdf_"+b,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=d.texture;this._releaseTexture=function(){return e._context.sharedResources.textures.release(d.uid)};a.textureIsSignedDistanceField=!0;a.distanceFieldBoundingBox=ga;a.textureId=
this._texture.id;f=this._getIconSize();this._size=[f,f];this._symbolTextureRatio=2;this._createMaterialsAndAddToStage(a,this._context.stage);this.resolve()}};x.prototype._prepareResourcesHref=function(c){return b(this,void 0,void 0,function(){var b,e,d,g,m,p,n,v,x,w,q=this;return l(this,function(l){switch(l.label){case 0:b=C.getIconHref(this.symbol,this.symbolLayer);if(!h("esri-canvas-svg-support")&&r.isSVG(b))return e="IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)",this._logWarning(e),
this.reject(new a("SVG Not Supported",e)),[2];this._outlineSize=this._getOutlineSize();c.color=this._getFillColor();c.outlineColor=this._getOutlineColor();c.outlineSize=this._outlineSize;c.textureIsSignedDistanceField=!1;d=this._getIconSize();g=d*this._context.layerView.view.pixelRatio;return[4,k.result(u.when(this._context.sharedResources.textures.fromUrl(b,g)))];case 1:m=l.sent();if(!1===m.ok)return m.error instanceof f?this.reject():(e="IconSymbol3DLayer failed to load (Request for icon resource failed: "+
b+")",this._logWarning(e),this.reject(new a("Request Failed",e))),[2];p=m.value;n=p.uid;v=p.texture;if(this.isRejected())return this._context.sharedResources.textures.release(n),[2];this._releaseTexture=function(){return q._context.sharedResources.textures.release(n)};x=v.params;w=x.width/x.height;this._size=1<w?[d,Math.round(d/w)]:[Math.round(d*w),d];c.textureId=v.id;this._createMaterialsAndAddToStage(c,this._context.stage);this.resolve();return[2]}})})};x.prototype._getPrimitive=function(){return this.symbolLayer.resource&&
this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||A.defaultPrimitive};x.prototype._getOutlineSize=function(){var a=0,a=this.symbolLayer;if(a.outline&&null!=a.outline.size)return Math.max(v.pt2px(a.outline.size),0);a=this._getPrimitive();a=J(a)?1.5:0;return Math.max(a,0)};x.prototype._getOutlineColor=function(){var a=this._getLayerOpacity(),b=this.symbolLayer;if(b.outline&&null!=b.outline.color){var c=e.toUnitRGB(b.outline.color);return[c[0],c[1],c[2],
b.outline.color.a*a]}return[0,0,0,a]};x.prototype._getFillColor=function(){return J(this._getPrimitive())?W:this._getMaterialOpacityAndColor()};x.prototype._getAnchorPos=function(){var a=this.symbolLayer.anchor,b=this.symbolLayer.anchorPosition;return"relative"===a?w.vec2f64.fromValues((b.x||0)+.5,-(b.y||0)+.5):a in F.namedAnchorToHUDMaterialAnchorPos?F.namedAnchorToHUDMaterialAnchorPos[a]:F.namedAnchorToHUDMaterialAnchorPos.center};x.prototype._createMaterialsAndAddToStage=function(a,b){this._fastUpdates=
M.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&p.mixin(a,this._fastUpdates.materialParameters);var c=q({},a);c.verticalOffset=null;c.screenSizePerspective=null;c.occlusionTest=!1;c.slicePlaneEnabled=!1;c.shaderPolygonOffset=0;var e=this._getStageIdHint();this._drapedMaterial=new X(c,e+"_iconDraped");b.add(P.ModelContentType.MATERIAL,this._drapedMaterial);a.occlusionTest=!0;a.slicePlaneEnabled=this._context.slicePlaneEnabled;
this._material=new X(a,e+"_icon");b.add(P.ModelContentType.MATERIAL,this._material)};x.prototype.destroy=function(){d.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(P.ModelContentType.MATERIAL,this._material.id),this._material=null);this._drapedMaterial&&(this._context.stage.remove(P.ModelContentType.MATERIAL,this._drapedMaterial.id),this._drapedMaterial=null);this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)};x.prototype._getScaleFactor=
function(a){if(this._isPropertyDriven("size")&&a.size){for(var b=0;3>b;b++){var c=a.size[b];c&&"symbolValue"!==c&&"proportional"!==c&&(a.size[b]=v.pt2px(c))}b=this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"===a.size[0])return 1;if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}return 1};x.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo,c=a.graphic;if(!this._validateGeometry(c.geometry))return null;var e=G.placePointOnGeometry(c.geometry);
if(!e)return this._logWarning("unsupported geometry type for icon symbol: "+c.geometry.type),null;var f="graphic"+c.uid,d=this._getVertexOpacityAndColor(b),g=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(g=this._getScaleFactor(b));g*=this._symbolTextureRatio;b=[this._size[0]*g,this._size[1]*g];g=this.getGraphicElevationContext(c);return"on-the-ground"===g.mode?this._createAsOverlay(c,e,d,b,g,f,c.uid,a.layer.uid):this._createAs3DShape(c,e,d,b,g,f,c.uid)};x.prototype.layerOpacityChanged=
function(){var a=this._getFillColor();this._drapedMaterial.setParameterValues({color:a});this._material.setParameterValues({color:a});a=this._getOutlineColor();this._drapedMaterial.setParameterValues({outlineColor:a});this._material.setParameterValues({outlineColor:a});return!0};x.prototype.layerElevationInfoChanged=function(a,b,c){var e=this._elevationContext.mode;if("on-the-ground"===c&&"on-the-ground"===e)return!0;if(c!==e&&("on-the-ground"===c||"on-the-ground"===e))return!1;var f=G.needsElevationUpdates2D(e)||
"absolute-height"===e;return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return f})};x.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};x.prototype.pixelRatioChanged=function(a,b){return this._getPrimitive()?!0:!1};x.prototype.applyRendererDiff=function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(M.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._material.setParameterValues(this._fastUpdates.materialParameters),
this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};x.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._drapedMaterial&&(this._drapedMaterial.renderPriority=a,c.add(this._drapedMaterial.id))};x.prototype._defaultElevationInfoNoZ=function(){return ia};x.prototype._createAs3DShape=function(a,b,c,e,f,d,g){var h=this,k=this.getFastUpdateAttrValues(a);a=k?function(a){return M.evaluateModelTransform(h._fastUpdates.materialParameters,
k,a)}:null;c=U.createPointGeometry(T,null,c,e,ka,null,k);c=[new O(c,d)];d=G.createStageObjectForPoint(this._context,b,c,[this._material],null,null,f,d,this._context.layer.uid,g,!0,a);if(null===d)return null;var m=new I(this,d.object,c,null,null,B.perObjectElevationAligner,f);m.alignedTerrainElevation=d.terrainElevation;m.needsElevationUpdates=G.needsElevationUpdates2D(f.mode)||"absolute-height"===f.mode;m.getScreenSize=this._createScreenSizeGetter(e,a);m.calculateRelativeScreenBounds=function(a){return h._material.calculateRelativeScreenBounds(m.getScreenSize(),
1,a)};G.extendPointGraphicElevationContext(m,b,this._context.elevationProvider);return m};x.prototype._createAsOverlay=function(a,b,c,e,f,d,g,h){var k=this;this._drapedMaterial.renderPriority=this._symbolLayerOrder;f=m.vec3f64.create();Q.pointToVector(b,f,this._context.overlaySR);f[2]=this._getDrapedZ();if((b=this._context.clippingExtent)&&!G.pointInBox2D(f,b))return null;var l=this.getFastUpdateAttrValues(a);b=l?function(a){return M.evaluateModelTransform(k._fastUpdates.materialParameters,l,a)}:
null;c=U.createPointGeometry(T,f,c,e,null,null,l);g=new N(c);g.material=this._drapedMaterial;g.center=f;g.bsRadius=0;g.transformation=R;g.name=d;g.uniqueName=d+"#"+c.id;g.data.layerUid=h;g.data.graphicUid=a.uid;g.calculateShaderTransformation=b;var p=new E(this,[g],null);p.getScreenSize=this._createScreenSizeGetter(e,b);p.calculateRelativeScreenBounds=function(a){return k._drapedMaterial.calculateRelativeScreenBounds(p.getScreenSize(),1,a)};return p};x.prototype._createScreenSizeGetter=function(a,
b){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var e=a[0]/this._symbolTextureRatio,f=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=w.vec2f64.create());var d=b(R);a[0]=d[0]*e+c;a[1]=d[5]*f+c;return a}}var d=a[0]/this._symbolTextureRatio+c,g=a[1]/this._symbolTextureRatio+c;return function(a){void 0===a&&(a=w.vec2f64.create());a[0]=d;a[1]=g;return a}};x.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],b=
m.vec3f64.fromValues(a,a,a),c=v.px2pt(1),a=a*c,a=m.vec3f64.fromValues(a,a,a);return{modelSize:b,symbolSize:a,unitInMeters:c,transformation:{anchor:Z,scale:fa,rotation:Z}}};x.prototype._hasVisibleVerticalOffset=function(a){return this.symbol&&"point-3d"===this.symbol.type&&this.symbol.hasVisibleVerticalOffset()};x.PRIMITIVE_SIZE=ja;return x}(L.default);d.Graphics3DIconSymbolLayer=t;var ia={mode:"relative-to-ground",offset:0},ka=x.vec4f64.fromValues(0,0,0,1);d.default=t})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c){t=function(){function d(a,b,c){this.type="draped";this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.stage=null;this._visible=!1}d.prototype.cachedSymbolSize=function(){return this.graphics3DSymbolLayer.getCachedSize()};d.prototype.initialize=function(a,b){this.stage=b};d.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this.stage.getDrapedRenderer().addRenderGeometries(this.renderGeometries):
this.stage.getDrapedRenderer().removeRenderGeometries(this.renderGeometries),!0):!1};d.prototype.destroy=function(){this.stage&&this._visible&&this.stage.getDrapedRenderer().removeRenderGeometries(this.renderGeometries);this._visible=!1;this.stage=null};d.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};d.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=f.vec3f64.create());return b.vec3.set(a,0,0,0)};d.prototype.getBoundingBoxObjectSpace=
function(a){void 0===a&&(a=e.create());return e.empty(a)};d.prototype.addHighlight=function(a,b){var c=this;this.renderGeometries.forEach(function(e){var f=e.addHighlight(b);a.addRenderGeometry(e,f,c)});this._visible&&this.stage.getDrapedRenderer().updateHighlights(this.renderGeometries)};d.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};d.prototype.removeRenderGeometryHighlight=function(a,b){a.removeHighlight(b);this._visible&&this.stage.getDrapedRenderer().updateHighlights(this.renderGeometries)};
d.prototype.getProjectedBoundingBox=function(b,f,d,h){return l(this,void 0,void 0,function(){var k,m,l,n;return g(this,function(g){switch(g.label){case 0:e.empty(h);for(k=0;k<this.renderGeometries.length;k++)m=this.renderGeometries[k],this._getRenderGeometryProjectedBoundingRect(m,b,a,d),e.expand(h,a);if(!f)return[3,5];e.center(h,p);l=void 0;n=c.demResolutionForBoundingBox(h,f);g.label=1;case 1:return g.trys.push([1,3,,4]),[4,f.service.queryElevation(p[0],p[1],n)];case 2:return l=g.sent(),[3,4];case 3:return g.sent(),
l=null,[3,4];case 4:null!=l&&(h[2]=Math.min(h[2],l),h[5]=Math.max(h[5],l)),g.label=5;case 5:return[2,h]}})})};d.prototype._getRenderGeometryProjectedBoundingRect=function(a,b,c,f){if(this.boundingBox)e.set(h,this.boundingBox);else{var d=a.center;a=a.bsRadius;h[0]=d[0]-a;h[1]=d[1]-a;h[2]=d[2]-a;h[3]=d[0]+a;h[4]=d[1]+a;h[5]=d[2]+a}b(h,0,2);this.calculateRelativeScreenBounds&&f.push({location:e.center(h),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return e.toRect(h,c)};return d}();
var a=k.create(),h=e.create(),p=[0,0,0];return t})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["require","exports","../../webgl-engine/lib/Util"],function(t,d,q){function g(b,f,e){e&&(f/=Math.SQRT2);for(var d=new Uint8Array(4*b*b),c=0;c<b;c++)for(var a=0;a<b;a++){var g=a-.5*b+.25,l=-c+.5*b-.75,n=c*b+a;if(e)var u=(g+l)/Math.SQRT2,l=(l-g)/Math.SQRT2,g=u;g=Math.max(Math.abs(g),Math.abs(l))-.5*f;g=g/b+.5;q.packFloatRGBA(g,d,4*n)}return d}function l(b,f,e){e&&(f*=Math.SQRT2);f*=.5;
for(var d=new Uint8Array(4*b*b),c=0;c<b;c++)for(var a=0;a<b;a++){var g=a-.5*b,l=-c+.5*b-1,n=c*b+a;if(e)var u=(g+l)/Math.SQRT2,l=(l-g)/Math.SQRT2,g=u;u=void 0;g=Math.abs(g);l=Math.abs(l);u=g>l?g>f?Math.sqrt((g-f)*(g-f)+l*l):l:l>f?Math.sqrt(g*g+(l-f)*(l-f)):g;u=u/b+.5;q.packFloatRGBA(u,d,4*n)}return d}Object.defineProperty(d,"__esModule",{value:!0});d.createCircle=function(b,f){var e=new Uint8Array(4*b*b),d=b/2-.5;f/=2;for(var c=0;c<b;c++)for(var a=0;a<b;a++){var g=a+b*c,l=a-d,n=c-d,l=Math.sqrt(l*l+
n*n)-f,l=l/b+.5;q.packFloatRGBA(l,e,4*g)}return e};d.createSquare=function(b,f){return g(b,f,!1)};d.createKite=function(b,f){return g(b,f,!0)};d.createCross=function(b,f){return l(b,f,!1)};d.createX=function(b,f){return l(b,f,!0)};d.createTriangle=function(b,f){for(var e=new Uint8Array(4*b*b),d=Math.sqrt(1.25),c=(b-f)/2,a=0;a<b;a++)for(var g=0;g<b;g++){var l=(g-c)/f,n=(a-c+.75)/f;q.packFloatRGBA(Math.max(-(1*l+-.5*n)/d,(1*(l-1)+-.5*-n)/d,-n)*f/b+.5,e,4*(a*b+g))}return e}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){function h(a){return null!==a&&void 0!==a}function p(a){return"number"===typeof a}function n(a){return"string"===typeof a}function u(a,b){a&&a.push(b)}function v(a,b,e,f,d){var g=a.minSize,k=a.maxSize;if(a.expression)return u(d,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=f.symbolSize[e],b.minSize[e]=a,b.maxSize[e]=a,b.offset[e]=b.minSize[e],b.factor[e]=0,b.type[e]=1,!0;if(h(a.field)){if(h(a.stops)){if(2===a.stops.length&&
p(a.stops[0].size)&&p(a.stops[1].size))return r(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,b,e),b.type[e]=1,!0;u(d,"Could not convert size info: stops only supported with 2 elements");return!1}if(p(g)&&p(k)&&h(a.minDataValue)&&h(a.maxDataValue))return r(g,k,a.minDataValue,a.maxDataValue,b,e),b.type[e]=1,!0;if(null!=c.meterIn[a.valueUnit])return b.minSize[e]=-Infinity,b.maxSize[e]=Infinity,b.offset[e]=0,b.factor[e]=1/c.meterIn[a.valueUnit],b.type[e]=1,!0;if("unknown"===a.valueUnit)return u(d,
"Could not convert size info: proportional size not supported"),!1;u(d,"Could not convert size info: scale-dependent size not supported");return!1}if(!h(a.field)){if(a.stops&&a.stops[0]&&p(a.stops[0].size))return b.minSize[e]=a.stops[0].size,b.maxSize[e]=a.stops[0].size,b.offset[e]=b.minSize[e],b.factor[e]=0,b.type[e]=1,!0;if(p(g))return b.minSize[e]=g,b.maxSize[e]=g,b.offset[e]=g,b.factor[e]=0,b.type[e]=1,!0}u(d,"Could not convert size info: unsupported variant of sizeInfo");return!1}function r(a,
b,c,e,f,d){e=0<Math.abs(e-c)?(b-a)/(e-c):0;f.minSize[d]=0<e?a:b;f.maxSize[d]=0<e?b:a;f.offset[d]=a-c*e;f.factor[d]=e}function y(a,b,c,e){if(a.normalizationField||a.valueRepresentation)return u(e,"Could not convert size info: unsupported property"),null;var f=a.field;if(null!=f&&!n(f))return u(e,"Could not convert size info: field is not a string"),null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=
a.field;else if(a.field!==b.size.field)return u(e,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(f=v(a,b.size,0,c,e))?b:null;case "height":return(f=v(a,b.size,2,c,e))?b:null;case "depth":return(f=v(a,b.size,1,c,e))?b:null;case "width-and-depth":return(f=v(a,b.size,0,c,e))&&v(a,b.size,1,c,e),f?b:null;case null:case void 0:case "all":return(f=(f=(f=v(a,b.size,0,c,e))&&v(a,b.size,1,c,e))&&v(a,b.size,2,c,e))?b:null;default:return u(e,'Could not convert size info: unknown axis "'+
a.axis+'""'),null}}function w(a,b,c){for(var e=0;3>e;++e){var f=b.unitInMeters;1===a.type[e]&&(f*=b.modelSize[e],a.type[e]=2);a.minSize[e]/=f;a.maxSize[e]/=f;a.offset[e]/=f;a.factor[e]/=f}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return u(c,"No size axis contains a valid size or scale"),!1;for(e=0;3>e;++e)0===a.type[e]&&(a.minSize[e]=a.minSize[b],a.maxSize[e]=a.maxSize[b],a.offset[e]=a.offset[b],a.factor[e]=a.factor[b],a.type[e]=a.type[b]);return!0}function m(a,
b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function x(a,b,c){if(a.normalizationField)return u(c,"Could not convert color info: unsupported property"),null;if(n(a.field))if(a.stops){if(8<a.stops.length)return u(c,"Could not convert color info: too many color stops"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var e=c[Math.min(a,c.length-1)];b.color.values[a]=e.value;
m(b.color.colors,a,e.color)}}else return u(c,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length)for(c=a.stops&&0<=a.stops.length&&a.stops[0].color,b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=0;8>a;a++)b.color.values[a]=Infinity,m(b.color.colors,a,c);else return u(c,"Could not convert color info: no field and no colors/stops"),null;return b}function A(a,b,c){if(a.normalizationField)return u(c,
"Could not convert opacity info: unsupported property"),null;if(n(a.field))if(a.stops){if(8<a.stops.length)return u(c,"Could not convert opacity info: too many opacity stops"),null;b.opacity={field:a.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var e=c[Math.min(a,c.length-1)];b.opacity.values[a]=e.value;b.opacity.opacityValues[a]=e.opacity}}else return u(c,"Could not convert opacity info: missing stops or opacities"),null;else if(a.stops&&0<=a.stops.length)for(c=
a.stops&&0<=a.stops.length&&a.stops[0].opacity,b.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},a=0;8>a;a++)b.opacity.values[a]=Infinity,b.opacity.opacityValues[a]=c;else return u(c,"Could not convert opacity info: no field and no opacities/stops"),null;return b}function C(a,b,c,e){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=1}function B(a,b,c){if(!n(a.field))return u(c,"Could not convert rotation info: field is not a string"),
null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return u(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return C(a,b.rotation,0,c),b;case "roll":return C(a,b.rotation,1,c),b;case null:case void 0:case "heading":return C(a,b.rotation,2,c),b;default:return u(c,'Could not convert rotation info: unknown axis "'+a.axis+
'""'),null}}function E(a,b,c){if(!a)return null;var e=!b.supportedTypes||!!b.supportedTypes.size,f=!b.supportedTypes||!!b.supportedTypes.color,d=!b.supportedTypes||!!b.supportedTypes.rotation,g=!!b.supportedTypes&&!!b.supportedTypes.opacity,h=a.reduce(function(a,h){if(!a)return a;if(h.valueExpression)return u(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(h.type){case "size":return e?y(h,a,b,c):a;case "color":return f?x(h,a,c):a;case "opacity":return g?A(h,a,
c):a;case "rotation":return d?B(h,a,c):a;default:return q.neverReached(h),null}},{size:null,color:null,opacity:null,rotation:null});return 0<a.length&&h&&!h.size&&!h.color&&!h.opacity&&!h.rotation||h&&h.size&&!w(h.size,b,c)?null:h}function I(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function G(a,c){var e={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,
vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},d=a&&null!=a.size;a&&a.size?(e.vvSizeEnabled=!0,e.vvSizeMinSize=a.size.minSize,e.vvSizeMaxSize=a.size.maxSize,e.vvSizeOffset=a.size.offset,e.vvSizeFactor=a.size.factor):a&&d&&(e.vvSizeValue=c.transformation.scale);if(a&&d){e.vvSymbolAnchor=c.transformation.anchor;e.vvSymbolRotationMatrix=
l.mat3f64.create();b.mat4.identity(F);var h=c.transformation.rotation[2],d=c.transformation.rotation[0],k=c.transformation.rotation[1];c=F;void 0===c&&(c=f.mat4f64.create());h=h||0;d=d||0;k=k||0;0!==h&&b.mat4.rotateZ(c,c,-h/180*Math.PI);0!==d&&b.mat4.rotateX(c,c,d/180*Math.PI);0!==k&&b.mat4.rotateY(c,c,k/180*Math.PI);g.mat3.fromMat4(e.vvSymbolRotationMatrix,F)}a&&a.color&&(e.vvColorEnabled=!0,e.vvColorValues=a.color.values,e.vvColorColors=a.color.colors);a&&a.opacity&&(e.vvOpacityEnabled=!0,e.vvOpacityValues=
a.opacity.values,e.vvOpacityOpacities=a.opacity.opacityValues);return e}Object.defineProperty(d,"__esModule",{value:!0});d.convertVisualVariables=E;d.initFastSymbolUpdatesState=function(b,c){return!b||a.DISABLE_FAST_UPDATES?{enabled:!1}:(b=E(b.visualVariables,c))?{enabled:!0,visualVariables:b,materialParameters:G(b,c),requiresShaderTransformation:b&&null!=b.size}:{enabled:!1}};d.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var e=a.visualVariables;b=E(b.visualVariables,c);
if(!(b&&I(e.size,b.size,"size")&&I(e.color,b.color,"color")&&I(e.rotation,b.rotation,"rotation")))return!1;a.visualVariables=b;a.materialParameters=G(b,c);a.requiresShaderTransformation=b&&null!=b.size;return!0};d.getMaterialParams=G;var L;(function(a){var c=f.mat4f64.create(),d=k.vec3f64.create();a.evaluateModelTransform=function(a,e,f){if(!a.vvSizeEnabled)return f;b.mat4.copy(c,f);f=a.vvSymbolRotationMatrix;b.mat4.set(F,f[0],f[1],f[2],0,f[3],f[4],f[5],0,f[6],f[7],f[8],0,0,0,0,1);b.mat4.multiply(c,
c,F);for(f=0;3>f;++f){var g=a.vvSizeOffset[f]+e[0]*a.vvSizeFactor[f],h=a.vvSizeMinSize[f],k=a.vvSizeMaxSize[f];d[f]=g<h?h:g>k?k:g}b.mat4.scale(c,c,d);b.mat4.translate(c,c,a.vvSymbolAnchor);return c};a.evaluateModelTransformScale=function(a,b,c){if(!b.vvSizeEnabled)return e.vec3.set(a,1,1,1);for(var f=0;3>f;++f){var d=b.vvSizeOffset[f]+c[0]*b.vvSizeFactor[f],g=b.vvSizeMinSize[f],h=b.vvSizeMaxSize[f];a[f]=d<g?g:d>h?h:d}return a}})(L||(L={}));var F=f.mat4f64.create();d.evaluateModelTransform=L.evaluateModelTransform;
d.evaluateModelTransformScale=L.evaluateModelTransformScale})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/typedArrayUtil ../../support/imageUtils ../../support/mathUtils ./DDSUtil ./DefaultVertexBufferLayouts ./glUtil3D ./IdGen ./Util ../shaders/MiscPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w){var m=g.getLogger("esri.views.3d.webgl-engine.lib.Texture");t=function(){function d(a,b,c){this.data=a;this.id=d.idGen.gen(b);this.unloadFunc=void 0;this.params=c||{};this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.params.wrap=this.params.wrap||{s:10497,t:10497};this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1;this.estimatedTexMemRequired=
d.estimateTexMemRequired(this.data,this.params)}d.estimateTexMemRequired=function(a,c){return null==a?0:b.isArrayBuffer(a)||b.isUint8Array(a)?a.byteLength:a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement?(c.mipmap?4/3:1)*a.width*a.height*(c.components||4):(c.mipmap?4/3:1)*c.width*c.height*(c.components||4)||0};d.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired};d.prototype.dispose=function(){this.data=void 0};d.prototype.deferredLoading=
function(){return"string"===typeof this.data};d.prototype.getWidth=function(){return this.params.width};d.prototype.getHeight=function(){return this.params.height};d.prototype.initializeThroughUpload=function(a,c,e,f,g){var h=this.data;c.flipped=!this.params.noUnpackFlip;c.samplingMode=this.params.mipmap?9987:9729;c.hasMipmap=this.params.mipmap;c.wrapMode=this.params.wrap;c.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof h)this.loadTextureFromUri(a,h,c,e,f,g);else if(h instanceof
Image||h instanceof ImageData||h instanceof HTMLCanvasElement)this.loadTextureFromImageData(a,h,c,e,f,g);else{if(b.isArrayBuffer(h)&&this.params.encoding===d.DDS_ENCODING)c=k.createDDSTexture(a,c,h,this.params.mipmap);else if(b.isUint8Array(h)&&this.params.encoding===d.DDS_ENCODING)c=k.createDDSTexture(a,c,h.buffer,this.params.mipmap);else if(b.isUint8Array(h))p.assert(0<this.params.width&&0<this.params.height),c.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,c.width=
this.params.width,c.height=this.params.height,c=new r(a,c,h);else{if(null!==h)throw console.warn("Unsupported image data"),Error("Unsupported image data");c=new r(a,c,null)}a.bindTexture(c);g(c)}this.data=void 0};d.prototype.loadTextureFromImageData=function(a,b,c,f,d,g){this.params.width=b.width;this.params.height=b.height;c.pixelFormat=3===this.params.components?6407:6408;var h=33071===this.params.wrap.s&&33071===this.params.wrap.t;w.default(a.gl)||!this.params.mipmap&&h||e.isPowerOfTwo(b.width)&&
e.isPowerOfTwo(b.height)?(c.width=b.width,c.height=b.height,b=new r(a,c,b)):b=this.makePowerOfTwoTexture(a,b,c,f,d);a.bindTexture(b);g(b)};d.prototype.loadTextureFromUri=function(a,b,c,d,g,h){var k=this,l=!1!==this.params.mipmap;f.requestImage(b).then(function(b){p.assert(1<=b.width&&1<=b.height);c.samplingMode=l?9987:9729;c.hasMipmap=l;!l&&33071===c.wrapMode||e.isPowerOfTwo(b.width)&&e.isPowerOfTwo(b.height)?(c.width=b.width,c.height=b.height,b=new r(a,c,b)):b=k.makePowerOfTwoTexture(a,b,c,d,g);
a.bindTexture(b);h(b)}).catch(function(a){var c=200<b.length?b.slice(0,100)+"..."+b.slice(b.length-100):b;m.error("Failed to load image from uri",c,a);h(null)})};d.prototype.makePowerOfTwoTexture=function(a,b,c,e,f){var d=b.width,g=b.height,h=l.nextHighestPowerOfTwo(d),k=l.nextHighestPowerOfTwo(g);c.width=h;c.height=k;var m;switch(this.params.powerOfTwoResizeMode){case 2:c.textureCoordinateScaleFactor=[d/h,g/k];m=new r(a,c);m.updateData(0,0,0,d,g,b);break;case 1:case null:case void 0:m=this.stretchToPowerOfTwo(a,
b,c,e,f);break;default:q.neverReached(this.params.powerOfTwoResizeMode)}c.hasMipmap&&m.generateMipmap();return m};d.prototype.stretchToPowerOfTwo=function(b,e,f,d,g){var h=new r(b,f),k=u.createWithAttachments(b,h,{colorTarget:0,depthStencilTarget:0});e=new r(b,{target:3553,pixelFormat:f.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!f.flipped,maxAnisotropy:8,preMultiplyAlpha:f.preMultiplyAlpha},e);b.bindFramebuffer(k);void 0===g&&(g=b.getViewport(),g=[g.x,g.y,g.width,g.height]);
b.setViewport(0,0,f.width,f.height);f=d.getProgram(n.texOnly);b.bindProgram(f);f.setUniform4f("color",1,1,1,1);f.setUniform1i("tex",0);f=a.createQuadVAO(b,c.Pos3Tex);b.bindTexture(e,0);b.bindVAO(f);b.setPipelineState(x);b.drawArrays(5,0,y.vertexCount(f,"geometry"));b.bindFramebuffer(null);b.setViewport(g[0],g[1],g[2],g[3]);f.dispose(!0);e.dispose();b.bindFramebuffer(null);k.detachColorTexture();k.dispose();return h};d.prototype.setUnloadFunc=function(a){this.unloadFunc=a};d.prototype.unload=function(){void 0!==
this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};d.createEmpty=function(a){void 0===a&&(a="emptyTexture");return new d(new Uint8Array([0,0,0,0]),a,{width:1,height:1,wrap:{s:33071,t:33071}})};d.idGen=new h;d.DDS_ENCODING="image/vnd-ms.dds";return d}();var x=v.makePipelineState({colorWrite:v.defaultColorWriteParams});return t})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../webgl/Texture"],function(t,d,q){function g(b){return b.charCodeAt(0)+
(b.charCodeAt(1)<<8)+(b.charCodeAt(2)<<16)+(b.charCodeAt(3)<<24)}Object.defineProperty(d,"__esModule",{value:!0});var l=g("DXT1"),b=g("DXT3"),f=g("DXT5");d.createDDSTexture=function(e,d,c,a){var g=new Int32Array(c,0,31);if(542327876!==g[0])return console.error("Invalid magic number in DDS header"),null;if(!(g[20]&4))return console.error("Unsupported format, must contain a FourCC code"),null;var k=g[21],n;switch(k){case l:k=8;n=33776;break;case b:k=16;n=33778;break;case f:k=16;n=33779;break;default:return console.error("Unsupported FourCC code:",
String.fromCharCode(k&255,k>>8&255,k>>16&255,k>>24&255)),null}var u=1;g[2]&131072&&!1!==a&&(u=Math.max(1,g[7]));a=g[4];for(var v=g[3],r=g[1]+4,y,w,m=[],x=0;x<u;++x)w=Math.floor((a+3)/4)*Math.floor((v+3)/4)*k,y=new Uint8Array(c,r,w),m.push(y),r+=w,a=Math.max(1,a>>1),v=Math.max(1,v>>1);d.samplingMode=1<u?9987:9729;d.hasMipmap=1<u;d.width=g[4];d.height=g[3];d.internalFormat=n;d=new q(e,d,{type:"compressed",levels:m});e.bindTexture(d);return d}})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function n(a,b,c,e){a=d.call(this,a,b,c,e)||this;c=a._getStageIdHint();b=null!=b.size?g.pt2px(b.size):1;b={idHint:c,width:b,color:a._getMaterialOpacityAndColor(),slicePlaneEnabled:a._context.slicePlaneEnabled};if(!a._isPropertyDriven("size")&&(c=u.validateSymbolLayerSize(b.width)))return a._logWarning(c),a.reject(),a;if(0>=b.width)return a.reject(),a;a._isPropertyDriven("size")&&(b.width=
0);a._material=v.createRibbonMaterial(b);a._context.stage.add(r.ModelContentType.MATERIAL,a._material);a.resolve();return a}q(n,d);n.prototype.destroy=function(){d.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(r.ModelContentType.MATERIAL,this._material.id),this._material=null)};n.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;var c=a.geometry;if("polyline"!==c.type&&"polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for line symbol: "+
c.type),null;if(!this._validateGeometry(c))return null;var c="polygon"===c.type||"extent"===c.type?"rings":"paths",e="graphic"+a.uid,f=this._getVertexOpacityAndColor(b,Float32Array,255),d=0;b.size&&this._isPropertyDriven("size")&&(d=p.getSingleSizeDriver(b.size),d=g.pt2px(d));b=this.getGraphicElevationContext(a);return"on-the-ground"===b.mode?this._createAsOverlay(a,c,f,d,b,e,this._context.layer.uid):this._createAs3DShape(a,c,f,d,b,e,a.uid)};n.prototype.layerOpacityChanged=function(){var a=this._material.getColor(),
a={color:[a[0],a[1],a[2],this._getMaterialOpacity()]};this._material.setParameterValues(a);return!0};n.prototype.layerElevationInfoChanged=function(a,b,c){var e=this._elevationContext.mode;if(null==c||null==e)return!1;if("on-the-ground"===c&&"on-the-ground"===e)return!0;if(c!==e&&("on-the-ground"===c||"on-the-ground"===e))return!1;var f=p.needsElevationUpdates2D(e);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return f})};n.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};n.prototype.pixelRatioChanged=function(a,b){return!0};n.prototype._getOutlineGeometry=function(a,b){return b};n.prototype._getGeometry=function(a){a=a.geometry;"extent"===a.type&&(a=e.fromExtent(a));return a};n.prototype._createAs3DShape=function(a,e,d,g,k,m,n){var r=this._getGeometry(a),u=r[e],x=this._getOutlineGeometry(r,u);a=[];var q=[],A=[],C=f.vec3f64.create(),B=Array(6),r=p.getGeometryVertexData3D(x,r.hasZ,r.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,
this._context.renderCoordsHelper,k);this._logGeometryCreationWarnings(r,u,e,"LineSymbol3DLayer");if(0<x.length){for(var u=r.geometryData.outlines,x=r.eleVertexData,E=r.vertexData,t=0;t<u.length;++t){var J=u[t];if(!(1>=J.count)){var F=J.index,G=J.count;if(this._context.clippingExtent&&(p.computeBoundingBox(x,F,G,B),p.boundingBoxClipped(B,this._context.clippingExtent)))continue;p.chooseOrigin(E,F,G,C);p.subtractCoordinates(E,F,G,C);J=new Float64Array(x.buffer,3*F*x.BYTES_PER_ELEMENT,3*G);F=new Float64Array(E.buffer,
3*F*E.BYTES_PER_ELEMENT,3*G);F=v.createPolylineGeometry(F,J,"rings"===e,d,g);F=new y(F,m+"path"+t);F.singleUse=!0;a.push(F);q.push(this._material);F=b.mat4f64.create();l.mat4.translate(F,F,C);A.push(F)}}if(0<a.length)return e=new w({geometries:a,materials:q,transformations:A,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:n},idHint:m}),e=new h(this,e,a,null,null,c.perVertexElevationAligner,k),e.alignedTerrainElevation=r.terrainElevation,e.needsElevationUpdates=p.needsElevationUpdates2D(k.mode),
e}return null};n.prototype._createAsOverlay=function(c,e,d,g,h,n,r){var u=this._getGeometry(c);this._material.renderPriority=this._symbolLayerOrder;var x=u[e],w=this._getOutlineGeometry(u,x);h=[];var q=Array(6),y=k.empty(),A=f.vec3f64.create(),u=p.getGeometryVertexDataDraped(w,u.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(u,x,e,"LineSymbol3DLayer");if(0<w.length){x=u.vertexData;w=u.geometryData.outlines;for(u=0;u<w.length;++u){var C=w[u],B=C.index,C=C.count;p.computeBoundingBox(x,
B,C,q);if(!p.boundingBoxClipped(q,this._context.clippingExtent)){k.expand(y,q);p.chooseOrigin(x,B,C,A);p.subtractCoordinates(x,B,C,A);p.setZ(x,B,C,this._getDrapedZ());C=new Float64Array(x.buffer,3*B*x.BYTES_PER_ELEMENT,3*C);B=b.mat4f64.create();l.mat4.translate(B,B,A);var C=v.createPolylineGeometry(C,null,"rings"===e,d,g),E=new m(C);E.data.layerUid=r;E.data.graphicUid=c.uid;E.material=this._material;E.center=[.5*(q[0]+q[3]),.5*(q[1]+q[4]),0];E.bsRadius=.5*Math.sqrt((q[3]-q[0])*(q[3]-q[0])+(q[4]-q[1])*
(q[4]-q[1]));E.transformation=B;E.name=n;E.uniqueName=n+"#"+C.id;h.push(E)}}return new a(this,h,y)}return null};return n}(n.default);d.Graphics3DLineSymbolLayer=t;d.default=t})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),function(t,d,q,g,l,b){function f(b){var c=b.length;return b[0]===b[c-3]&&b[1]===
b[c-2]&&b[2]===b[c-1]}Object.defineProperty(d,"__esModule",{value:!0});var e=g.VertexAttrConstants;d.createRibbonMaterial=function(e){var c={width:e.width,color:e.color,miterLimit:e.miterLimit,polygonOffset:!0,join:"miter",slicePlaneEnabled:e.slicePlaneEnabled};"miter"===e.join||"bevel"===e.join?c.join=e.join:e.join&&console.warn("unsupported join type for line symbol: "+e.join);return new b(c,e.idHint+"_ribbonlinemat")};d.createNativeMaterial=function(b){return new l({color:b.color,slicePlaneEnabled:b.slicePlaneEnabled},
b.idHint+"_nativelinemat")};d.isClosed=f;d.createPolylineGeometry=function(b,c,a,d,g){var h,k,l;if(a=a&&!f(b)){a=new Float32Array(b.length+3);for(k=0;k<b.length;k++)a[k]=b[k];k=a.length;a[k-3]=b[0];a[k-2]=b[1];a[k-1]=b[2];h=b.length/3+1;k=new Uint32Array(2*(h-1));l=new Uint32Array(2*(h-1))}else h=b.length/3,k=new Uint32Array(2*(h-1)),l=new Uint32Array(2*(h-1)),a=b;b=new Float32Array(1);b[0]=g;for(var p=g=0,y=0;y<h-1;y++)k[g++]=y,k[g++]=y+1,l[p++]=0,l[p++]=0;g={};h={};g[e.POSITION]=k;g[e.COLOR]=l;
g[e.SIZE]=l;h[e.POSITION]={size:3,data:a,offsetIdx:0,strideIdx:3};h[e.COLOR]={size:4,data:d,offsetIdx:0,strideIdx:4};h[e.SIZE]={size:1,data:b,offsetIdx:0,strideIdx:1};c&&(g.mapPos=k,h.mapPos={size:3,data:c,offsetIdx:0,strideIdx:3});return new q(h,g,q.DefaultOffsets,"line")}})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/NativeLinePrograms ../../../webgl/renderState".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w){var m=g.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");t=function(c){function e(a,b){b=c.call(this,b)||this;b.params=v.copyParameters(a,C);return b}q(e,c);e.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)b[c]=a[c];this.notifyDirty("matChanged")};e.prototype.getParameters=function(){return this.params};e.prototype.getColor=function(){return this.params.color};e.prototype.intersect=function(a,b,c,e,f,d,g,
h,k){k?this.intersectLineGeometry(a,b,c,e,f,d,g):v.intersectDrapedRenderLineGeometry(a,b,c,e,f,d,1,g)};e.prototype.intersectLineGeometry=function(c,e,d,g,h,l,p,r){if(g.enable.selectionMode&&!a.isAllHidden(e.componentVisibilities,c.componentOffsets))if(n.isTranslationMatrix(d)){e=c.data.getVertexAttr().position.data;h=g.camera;l=N;b.vec2.copy(l,g.point);f.vec3.set(V[0],l[0]-2,l[1]+2,0);f.vec3.set(V[1],l[0]+2,l[1]+2,0);f.vec3.set(V[2],l[0]+2,l[1]-2,0);f.vec3.set(V[3],l[0]-2,l[1]-2,0);for(r=0;4>r;r++)h.unprojectPoint(V[r],
X[r]);k.plane.fromPoints(h.eye,X[0],X[1],J);k.plane.fromPoints(h.eye,X[1],X[2],R);k.plane.fromPoints(h.eye,X[2],X[3],T);k.plane.fromPoints(h.eye,X[3],X[0],W);c=Number.MAX_VALUE;for(r=0;r<e.length-5;r+=3)if(I[0]=e[r]+d[12],I[1]=e[r+1]+d[13],I[2]=e[r+2]+d[14],G[0]=e[r+3]+d[12],G[1]=e[r+4]+d[13],G[2]=e[r+5]+d[14],!(0>k.plane.signedDistance(J,I)&&0>k.plane.signedDistance(J,G)||0>k.plane.signedDistance(R,I)&&0>k.plane.signedDistance(R,G)||0>k.plane.signedDistance(T,I)&&0>k.plane.signedDistance(T,G)||0>
k.plane.signedDistance(W,I)&&0>k.plane.signedDistance(W,G))){h.projectPoint(I,K);h.projectPoint(G,M);if(0>K[2]&&0<M[2]){f.vec3.subtract(L,I,G);var v=h.frustum,u=-k.plane.signedDistance(v.planes[4],I),v=u/f.vec3.dot(L,v.planes[4]);f.vec3.scale(L,L,v);f.vec3.add(I,I,L);h.projectPoint(I,K)}else if(0<K[2]&&0>M[2])f.vec3.subtract(L,G,I),v=h.frustum,u=-k.plane.signedDistance(v.planes[4],G),v=u/f.vec3.dot(L,v.planes[4]),f.vec3.scale(L,L,v),f.vec3.add(G,G,L),h.projectPoint(G,M);else if(0>K[2]&&0>M[2])continue;
K[2]=0;M[2]=0;v=k.lineSegment.distance2(k.lineSegment.fromPoints(K,M,O),l);v<c&&(c=v,f.vec3.copy(Q,I),f.vec3.copy(P,G))}d=g.rayBeginPoint;g=g.rayEndPoint;4>c&&(c=Number.MAX_VALUE,k.lineSegment.closestLineSegmentPoint(k.lineSegment.fromPoints(Q,P,O),k.lineSegment.fromPoints(d,g,U),F)&&(f.vec3.subtract(F,F,d),c=f.vec3.length(F),f.vec3.scale(F,F,1/c),c/=f.vec3.distance(d,g)),p(c,F))}else m.error("intersection assumes a translation-only matrix")};e.prototype.createBufferWriter=function(){return new E(this.params)};
e.prototype.createRenderer=function(a,b){return new r(a,b,this)};e.prototype.getGLMaterials=function(){return{color:x,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:A}};e.prototype.getAllTextureIds=function(){return[]};return e}(p);var x=function(a){function b(b,c,e){b=a.call(this,b,c)||this;b.updateParameters();return b}q(b,a);b.prototype.updateParameters=function(){this.params=v.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.selectProgram=function(){var a=
this.params;this.program=this.programRep.getProgram(y.colorPass,{slice:a.slicePlaneEnabled,vertexColors:this.params.vertexColors});this.pipelineState=w.makePipelineState({blending:1>a.color[3]&&w.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};b.prototype.beginSlot=function(a){return 4===a};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);
a.setPipelineState(this.pipelineState);b.setUniform4fv("constantColor",c.color)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;v.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&v.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 1};return b}(h),A=function(a){function b(b,c,e){b=a.call(this,b,c)||this;b.updateParameters();
return b}q(b,a);b.prototype.updateParameters=function(){this.params=v.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.beginSlot=function(a){return 4===a};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(y.highlightPass,{slice:this.params.slicePlaneEnabled,vertexColors:this.params.vertexColors});this.pipelineState=w.makePipelineState({depthTest:{func:513},colorWrite:w.defaultColorWriteParams})};
b.prototype.bind=function(a,b){a.bindProgram(this.program);a.setPipelineState(this.pipelineState);v.bindHighlightRendering(a,b,this.program)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;v.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&v.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 1};return b}(h),C={color:[1,
1,1,1],vertexColors:!1,slicePlaneEnabled:!1},B=c.newLayout().vec3f(n.VertexAttrConstants.POSITION),E=function(){function a(a){this.vertexBufferLayout=c.newLayout().vec3f(n.VertexAttrConstants.POSITION);a.vertexColors&&(this.vertexBufferLayout=B.vec4u8(n.VertexAttrConstants.COLOR))}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[n.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,e,f){u.writeDefaultAttributes(b,
c,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,e,f)};return a}(),I=e.vec3f64.create(),G=e.vec3f64.create(),L=e.vec3f64.create(),F=e.vec3f64.create(),K=l.createRenderScreenPointArray3(),M=l.createRenderScreenPointArray3(),Q=e.vec3f64.create(),P=e.vec3f64.create(),O=k.lineSegment.create(),U=k.lineSegment.create(),N=e.vec3f64.create(),V=[l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3()],X=[e.vec3f64.create(),
e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create()],J=k.plane.create(),R=k.plane.create(),T=k.plane.create(),W=k.plane.create();return t})},"esri/views/3d/webgl-engine/shaders/NativeLinePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=function(b){return l.glslifyDefineMap({SLICE:b.slice,VERTEXCOLORS:b.vertexColors})};d.colorPass=
{name:"native-line-color",shaders:function(f){return{vertexShader:b(f)+g.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:b(f)+g.resolveIncludes("materials/nativeLine/colorPass.frag")}},attributes:q.Default3D};d.highlightPass={name:"native-line-highlight",shaders:function(f){return{vertexShader:b(f)+g.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:b(f)+g.resolveIncludes("materials/nativeLine/highlightPass.frag")}},attributes:q.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M,Q,P){Object.defineProperty(d,"__esModule",{value:!0});var O=M.VertexAttrConstants;t=function(d){function k(a,b,c,e){a=d.call(this,a,b,c,e)||this;a._edgeStageObjects=new Set;a._materials={};a._textures={};B.DRAW_MESH_GEOMETRY_NORMALS&&(a._debugVertexNormalMaterial=new P({color:[1,0,1,1]},"debugVertexNormal"),a._debugFaceNormalMaterial=new P({color:[0,1,1,1]},"debugFAceNormal"));a.resolve();return a}q(k,d);k.prototype.destroy=function(){d.prototype.destroy.call(this);
this.isFulfilled()||this.reject();for(var a in this._materials)this._context.stage.remove(I.ModelContentType.MATERIAL,this._materials[a].material.id);for(a in this._textures)this._context.stage.remove(I.ModelContentType.TEXTURE,this._textures[a].id);this._materials={};this._textures={}};k.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("mesh"!==b.geometry.type)return this._logWarning("unsupported geometry type for fill on mesh-3d symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;
var c="graphic"+b.uid,e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,e,c,b.uid)};k.prototype.layerOpacityChanged=function(){var a=this._getLayerOpacity(),b;for(b in this._materials){var c=this._materials[b];c.material.setParameterValues({layerOpacity:a});var e=c.material.getParameters();this._setMaterialTransparentParameter(e,c);c.material.setParameterValues({transparent:e.transparent})}if(0<this._edgeStageObjects.size){var f=this._context.stage.view.ensureEdgeView(),
d=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){return f.updateAllComponentOpacities(a,[d])})}return!0};k.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,m.needsElevationUpdates3D)};k.prototype.slicePlaneEnabledChanged=function(a,b){var c=this,e;for(e in this._materials)this._materials[e].material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});if(0<this._edgeStageObjects.size){var d=this._context.stage.view.ensureEdgeView();
a=this._createEdgeMaterial(d);if(f.isSome(a)){var g=[a];this._edgeStageObjects.forEach(function(a){return d.updateAllComponentMaterials(a,g,{slicePlaneEnabled:c._context.slicePlaneEnabled},!1)})}}return!0};k.prototype.pixelRatioChanged=function(a,b){return!0};k.prototype._requiresSymbolVertexColors=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};k.prototype._colorOrTextureUid=function(a){return a?a instanceof l?a.toHex():a.uid:"-"};k.prototype._materialProperties=
function(a,b,c){var e=this._requiresSymbolVertexColors(),f,d,g,h,k,m;b.material&&(d=b.material.color,f=this._colorOrTextureUid(b.material.color),g=b.material.colorTexture,h=this._colorOrTextureUid(b.material.colorTexture),k=b.material.normalTexture,m=this._colorOrTextureUid(b.material.normalTexture));b=!!a.vertexAttributes.color;a=!!a.vertexAttributes.tangent;return{hasSymbolVertexColors:e,hasVertexColors:b,hasVertexTangents:a,color:d,colorTexture:g,normalTexture:k,uid:"vc:"+b+",vt:"+a+",vct"+c+",svc:"+
e+",cmuid:"+f+",ctmuid:"+h+",ntmuid:"+m}};k.prototype._setInternalColorValueParameters=function(a,b){b.diffuse=g.toUnitRGB(a);b.opacity=a.a};k.prototype._getLoadableTextureResource=function(a){return a.data?a.data instanceof HTMLImageElement?a.data.complete?a.data:a.data.src:a.data:a.url};k.prototype._getInternalTextureId=function(a,b){var c=this._getLoadableTextureResource(a);if(c){var e=this._textures[a.uid];e||(e=new K(c,b+"_"+a.uid+"_tex",{mipmap:!0,wrap:this._castTextureWrap(a.wrap),noUnpackFlip:!0}),
this._textures[a.uid]=e,this._context.stage.add(I.ModelContentType.TEXTURE,e));return e.id}};k.prototype._castTextureWrap=function(a){void 0===a&&(a="repeat");return"string"===typeof a?(a=this._castTextureWrapIndividual(a),{s:a,t:a}):{s:this._castTextureWrapIndividual(a.horizontal),t:this._castTextureWrapIndividual(a.vertical)}};k.prototype._castTextureWrapIndividual=function(a){switch(a){case "clamp":return 33071;case "mirror":return 33648;default:return 10497}};k.prototype._setInternalMaterialParameters=
function(a,b,c){a.color&&this._setInternalColorValueParameters(a.color,c);a.colorTexture&&(c.textureId=this._getInternalTextureId(a.colorTexture,b));a.hasVertexTangents&&a.normalTexture&&(c.normalTextureId=this._getInternalTextureId(a.normalTexture,b))};k.prototype._setExternalMaterialParameters=function(a){if(this._isPropertyDriven("color"))a.externalColor=N;else{var b=this.symbolLayer.material?g.toUnitRGBA(this.symbolLayer.material.color):N;a.externalColor=b}if(b=this.symbolLayer.material&&this.symbolLayer.material.colorMixMode)a.colorMixMode=
b};k.prototype._hasTransparentVertexColors=function(a){a=a.vertexAttributes.color;if(!a)return!1;for(var b=3;b<a.length;b+=4)if(255!==a[b])return!0;return!1};k.prototype._getOrCreateMaterial=function(a,b){var c=b.material&&b.material.color,e=b.material&&b.material.colorTexture,c=this._hasTransparentVertexColors(a)||c&&1>c.a||e&&e.transparent;a=this._materialProperties(a,b,c);if(e=this._materials[a.uid])return e.material;var c={material:null,isComponentTransparent:c,alphaMode:b.material?b.material.alphaMode:
"opaque"},e=this._getStageIdHint(),f={specular:V,vertexColors:a.hasVertexColors,symbolColors:a.hasSymbolVertexColors,vertexTangents:a.hasVertexTangents,ambient:V,diffuse:U,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,textureInitTransparent:!0};b.material&&(f.doubleSided=b.material.doubleSided,f.cullFace=b.material.doubleSided?"none":"back",f.textureAlphaCutoff=b.material.alphaCutoff);
this._setInternalMaterialParameters(a,e,f);this._setExternalMaterialParameters(f);this._setMaterialTransparentParameter(f,c);b=new Q(f,e+"_"+a.uid+"_mat");c.material=b;this._materials[a.uid]=c;this._context.stage.add(I.ModelContentType.MATERIAL,b);return b};k.prototype._setMaterialTransparentParameter=function(a,b){var c=this._isPropertyDriven("opacity");a.transparent=c||b.isComponentTransparent||1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3];a.textureAlphaMode="auto"===b.alphaMode?
a.transparent?"maskBlend":"opaque":b.alphaMode};k.prototype._addDebugNormals=function(b,c,e,f){var d,g,k,m,l=c.length,n=b.spatialReference.isWGS84?20015077/180:1,p=.1*Math.max(b.extent.width*n,b.extent.height*n,b.extent.zmax-b.extent.zmin),r=[],v=[];b=[];for(var n=[],u=0;u<l;u++)for(var x=c[u],w=x.data.getAttribute(O.POSITION),q=x.data.getAttribute(O.NORMAL),y=x.data.getIndices(O.POSITION),x=x.data.getIndices(O.NORMAL),w=w.data,q=q.data,A=0;A<y.length;A++){for(var C=3*y[A],B=3*x[A],E=0;3>E;E++)r.push(w[C+
E]);for(E=0;3>E;E++)r.push(w[C+E]+q[B+E]*p);v.push(v.length);v.push(v.length);if(0===A%3){this._calculateFaceNormal(w,y,A,W);this._getFaceVertices(w,y,A,J,R,T);h.vec3.add(J,J,R);h.vec3.add(J,J,T);h.vec3.scale(J,J,1/3);for(E=0;3>E;E++)b.push(J[E]);for(E=0;3>E;E++)b.push(J[E]+W[E]*p);n.push(n.length);n.push(n.length)}}l=(d={},d[O.POSITION]={data:new Float64Array(r),size:3},d);d=(g={},g[O.POSITION]=new Uint32Array(v),g);g=new L(l,d,void 0,"line");g=new G(g,"debugVertexNormal");g.singleUse=!0;c.push(g);
e.push(this._debugVertexNormalMaterial);f.push(a.mat4f64.clone(f[0]));l=(k={},k[O.POSITION]={data:new Float64Array(b),size:3},k);d=(m={},m[O.POSITION]=new Uint32Array(n),m);g=new L(l,d,void 0,"line");g=new G(g,"debugFaceNormal");g.singleUse=!0;c.push(g);e.push(this._debugFaceNormalMaterial);f.push(a.mat4f64.clone(f[0]))};k.prototype._createAs3DShape=function(a,b,c,e,d){var g=this;a=a.geometry;if("mesh"!==a.type)return null;var h=this._createGeometryInfo(a,b,e);if(!h)return null;b=h.geometries;var k=
h.materials,l=h.transformations,h=h.objectTransformation;B.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,b,k,l);var n=new F({geometries:b,materials:k,transformations:l,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:d},idHint:e});n.objectTransformation=h;var p=function(a){var b=g._context.stage.view.ensureEdgeView();b.removeObject(a);g._edgeStageObjects.delete(a);var c=g._createEdgeMaterial(b);f.isSome(c)&&(g._edgeStageObjects.add(a),b.addObject(a,[c],{slicePlaneEnabled:g._context.slicePlaneEnabled},
!g._context.isAsync,{mergeGeometries:!0}))};p(n);e=function(a,b,c,e,f){a=y.perObjectElevationAligner(a,b,c,e,f);p(n);return a};d=new w(this,n,b,null,null,e,c);d.needsElevationUpdates=m.needsElevationUpdates3D(c.mode);c=a.extent.center.clone();c.z=0;d.elevationContext.centerPointInElevationSR=c;d.alignedTerrainElevation=e(d,d.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext);return d};k.prototype._createComponentNormals=function(a,
c,e,f){var d=e.shading||"flat";switch(d){case "source":return this._createComponentNormalsSource(a,c,e,f);case "flat":return this._createComponentNormalsFlat(a,e,f);case "smooth":return this._createComponentNormalsSmooth(a,e,f);default:b.neverReached(d)}};k.prototype._createComponentNormalsSource=function(a,b,c,e){if(!b)return this._createComponentNormalsFlat(a,c,e);var f=!1;if(!c.trustSourceNormals)for(c=0;c<e.length;c+=3){this._calculateFaceNormal(a,e,c,W);for(var d=0;3>d;d++){var g=3*e[c+d];J[0]=
b[g+0];J[1]=b[g+1];J[2]=b[g+2];0>h.vec3.dot(W,J)&&(b[g+0]=-b[g+0],b[g+1]=-b[g+1],b[g+2]=-b[g+2],f=!0)}}return{normals:b,indices:e,didFlipNormals:f}};k.prototype._createComponentNormalsFlat=function(a,b,c){b=new Float32Array(c.length);for(var e=new Uint32Array(3*c.length),f=0;f<c.length;f+=3)for(var d=this._calculateFaceNormal(a,c,f,W),g=0;3>g;g++)b[f+g]=d[g],e[f+g]=f/3;return{normals:b,indices:e,didFlipNormals:!1}};k.prototype._createComponentNormalsSmooth=function(a,b,c){b={};for(var e=0;e<c.length;e+=
3)for(var f=this._calculateFaceNormal(a,c,e,W),d=0;3>d;d++){var g=c[e+d],k=b[g];k||(k={normal:p.vec3f64.create(),count:0},b[g]=k);h.vec3.add(k.normal,k.normal,f);k.count++}a=new Float32Array(3*c.length);f=new Uint32Array(3*c.length);for(e=0;e<c.length;e++){g=c[e];k=b[g];1!==k.count&&(h.vec3.normalize(k.normal,k.normal),k.count=1);for(d=0;3>d;d++)a[3*e+d]=k.normal[d];f[e]=e}return{normals:a,indices:f,didFlipNormals:!1}};k.prototype._getFaceVertices=function(a,b,c,e,f,d){var g=3*b[c+0],h=3*b[c+1];b=
3*b[c+2];e[0]=a[g+0];e[1]=a[g+1];e[2]=a[g+2];f[0]=a[h+0];f[1]=a[h+1];f[2]=a[h+2];d[0]=a[b+0];d[1]=a[b+1];d[2]=a[b+2]};k.prototype._calculateFaceNormal=function(a,b,c,e){this._getFaceVertices(a,b,c,J,R,T);h.vec3.subtract(R,R,J);h.vec3.subtract(T,T,J);h.vec3.cross(J,R,T);h.vec3.normalize(e,J);return e};k.prototype._getOrCreateComponents=function(a){return a.components?a.components:ja};k.prototype._createPositionBuffer=function(a){var b=a.vertexAttributes.position,c=new Float64Array(b.length);m.reproject(a.vertexAttributes.position,
0,a.spatialReference,c,0,this._context.renderSpatialReference,b.length/3);return c};k.prototype._createNormalBuffer=function(a,b){var c=a.vertexAttributes.normal;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var e=a.vertexAttributes.position,f=new Float32Array(c.length);return r.projectNormalToECEF(c,e,b,a.spatialReference,f)};k.prototype._createTangentBuffer=function(a,b){var c=a.vertexAttributes.tangent;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;
var e=a.vertexAttributes.position,f=new Float32Array(c.length);return r.projectTangentToECEF(c,e,b,a.spatialReference,f)};k.prototype._createColorBuffer=function(a){return a.vertexAttributes.color};k.prototype._createSymbolColorBuffer=function(a){if(this._requiresSymbolVertexColors()){a=this._getVertexOpacityAndColor(a);var b=this.symbolLayer.material&&this.symbolLayer.material.colorMixMode||null,c=new Uint8Array(4);C.encodeSymbolColor(a,b,c);return c}return null};k.prototype._createColorIndices=
function(a,b){a=new Uint32Array(b.length);for(b=0;b<a.length;b++)a[b]=0;return a};k.prototype._createBuffers=function(a,b){var c=a.vertexAttributes&&a.vertexAttributes.position;if(!c)return this._logWarning("Mesh geometry must contain position vertex attributes"),null;var e=a.vertexAttributes.normal,f=a.vertexAttributes.uv,d=a.vertexAttributes.tangent;if(e&&e.length!==c.length)return this._logWarning("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;
if(d&&d.length/4!==c.length/3)return this._logWarning("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(f&&f.length/2!==c.length/3)return this._logWarning("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;c=this._createPositionBuffer(a);e=this._createColorBuffer(a);b=this._createSymbolColorBuffer(b);var d=this._createNormalBuffer(a,c),g=this._createTangentBuffer(a,c);a=this._transformCenterLocal(a,c,d);
return{positionBuffer:c,normalBuffer:d,tangentBuffer:g,uvBuffer:f,colorBuffer:e,symbolColorBuffer:b,objectTransformation:a}};k.prototype._transformCenterLocal=function(b,f,d){var g=b.extent.center,k=this._context.renderSpatialReference;X[0]=g.x;X[1]=g.y;X[2]=0;g=a.mat4f64.create();E.computeLinearTransformation(b.spatialReference,X,g,k);c.mat4.invert(Z,g);for(b=0;b<f.length;b+=3)J[0]=f[b+0],J[1]=f[b+1],J[2]=f[b+2],h.vec3.transformMat4(J,J,Z),f[b+0]=J[0],f[b+1]=J[1],f[b+2]=J[2];if(d)for(e.mat3.fromMat4(fa,
g),e.mat3.transpose(fa,fa),b=0;b<d.length;b+=3)J[0]=d[b+0],J[1]=d[b+1],J[2]=d[b+2],h.vec3.transformMat3(J,J,fa),d[b+0]=J[0],d[b+1]=J[1],d[b+2]=J[2];return g};k.prototype._validateFaces=function(a,b){a=a.vertexAttributes.position.length/3;if(b=b.faces){for(var c=-1,e=0;e<b.length;e++){var f=b[e];f>c&&(c=f)}if(a<=c)return this._logWarning("Vertex index "+c+" is out of bounds of the mesh position buffer"),!1}else if(0!==a%3)return this._logWarning("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),
!1;return!0};k.prototype._getOrCreateFaces=function(a,b){if(b.faces)return b.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(b=0;b<a.length;b++)a[b]=b;return a};k.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return!1;var c=this._context.elevationProvider.spatialReference,e=b.length/3;a.spatialReference.equals(c)||(b=new Float64Array(b.length),m.reproject(a.vertexAttributes.position,
0,a.spatialReference,b,0,c,e));m.computeBoundingBox(b,0,e,ga);return m.boundingBoxClipped(ga,this._context.clippingExtent)};k.prototype._createGeometryInfo=function(b,c,e){var f,d;if(!v.canProject(b,this._context.layerView.view.spatialReference))return this._logWarning("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(b))return null;var g=this._createBuffers(b,c);if(!g)return null;c=g.positionBuffer;for(var h=g.uvBuffer,k=g.colorBuffer,m=g.symbolColorBuffer,
l=g.normalBuffer,n=g.tangentBuffer,g=g.objectTransformation,p=[],r=[],u=[],x=!1,w=0,q=this._getOrCreateComponents(b);w<q.length;w++){var y=q[w];if(!this._validateFaces(b,y))return null;var A=this._getOrCreateFaces(b,y);if(0!==A.length){var C=this._createComponentNormals(c,l,y,A);C.didFlipNormals&&(x=!0);var B=(f={},f[O.POSITION]={size:3,data:c},f[O.NORMAL]={size:3,data:C.normals},f),C=(d={},d[O.POSITION]=A,d[O.NORMAL]=C.indices,d);k&&(B[O.COLOR]={size:4,data:k},C[O.COLOR]=A);m&&(B[O.SYMBOLCOLOR]=
{size:4,data:m},C[O.SYMBOLCOLOR]=this._createColorIndices(y,A));b.vertexAttributes.uv&&(B[O.UV0]={size:2,data:h},C[O.UV0]=A);b.vertexAttributes.tangent&&(B[O.TANGENT]={size:4,data:n},C[O.TANGENT]=A);A=new L(B,C);A=new G(A,e+"_mesh");A.singleUse=!0;p.push(A);r.push(a.mat4f64.create());u.push(this._getOrCreateMaterial(b,y))}}x&&this._logWarning("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:p,transformations:r,materials:u,objectTransformation:g}};k.prototype._createEdgeMaterial=function(a){var b={opacity:this._getLayerOpacity()};return A.createMaterial(a,this.symbolLayer,b)};return k}(x.default);d.Graphics3DMeshFillSymbolLayer=t;var U=[1,1,1],N=[1,1,1,1],V=[0,0,0],X=p.vec3f64.create(),J=p.vec3f64.create(),R=p.vec3f64.create(),T=p.vec3f64.create(),W=p.vec3f64.create(),Z=a.mat4f64.create(),fa=k.mat3f64.create(),ga=n.create(),ja=[new u];d.default=t})},"esri/geometry/support/MeshComponent":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ./MeshMaterial ./MeshVertexAttributes".split(" "),
function(t,d,q,g,l,b,f,e,k,c){var a=f.getLogger("esri.geometry.support.MeshComponent");return function(f){function d(a){a=f.call(this)||this;a.faces=null;a.material=null;a.shading="source";a.trustSourceNormals=!1;return a}q(d,f);h=d;d.prototype.castFaces=function(b){return c.castArray(b,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},a)};d.prototype.clone=function(){return new h({faces:b.clone(this.faces),shading:this.shading,material:b.clone(this.material),trustSourceNormals:this.trustSourceNormals})};
d.prototype.cloneWithSharedTextures=function(){return new h({faces:b.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithSharedTextures():null,trustSourceNormals:this.trustSourceNormals})};var h;g([e.property({json:{write:!0}})],d.prototype,"faces",void 0);g([e.cast("faces")],d.prototype,"castFaces",null);g([e.property({type:k.MeshMaterial,json:{write:!0}})],d.prototype,"material",void 0);g([e.property({type:String,json:{write:!0}})],d.prototype,"shading",void 0);
g([e.property({type:Boolean})],d.prototype,"trustSourceNormals",void 0);return d=h=g([e.subclass("esri.geometry.support.MeshComponent")],d)}(e.declared(l))})},"esri/geometry/support/MeshMaterial":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./ImageMeshColor ./MeshTexture ./ValueMeshColor".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){function n(){u.warn('Assigning ImageMeshColor to "MeshMaterial.color" is deprecated. Assigning to "MeshMaterial.colorTexture" instead.')}Object.defineProperty(d,"__esModule",{value:!0});var u=e.getLogger("esri.geometry.support.MeshMaterial");t=function(b){function e(a){a=b.call(this)||this;a.color=null;a.colorTexture=null;a.normalTexture=null;a.alphaMode="auto";a.alphaCutoff=.5;a.doubleSided=!0;return a}q(e,b);d=e;e.prototype.castColor=function(b){if(!b)return b;
if(Array.isArray(b))return new l(b);if(b instanceof l||b instanceof h)return b;if("string"===typeof b){if(v.test(b)||l.named[b])return new l(b);n();this.colorTexture=new h({url:b});return null}return b instanceof HTMLImageElement||b instanceof HTMLCanvasElement||b instanceof ImageData?(n(),this.colorTexture=new h({data:b}),null):b instanceof a?(n(),this.colorTexture=new h({url:b.url,data:b.data}),null):"image"===b.type?(n(),this.colorTexture=new h(b),null):b instanceof p?(u.warn('Assigning ValueMeshColor to "MeshMaterial.color" is deprecated. Automatically converting it to esri.Color.'),
new l(b.value)):c.ensureType(l,b)};e.prototype.castColorTexture=function(a){return a?"string"===typeof a?new h({url:a}):a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData?new h({data:a}):c.ensureType(h,a):a};e.prototype.readColorTexture=function(a,b,c){if(a)return new h(a)};e.prototype.castNormalTexture=function(a){return a?"string"===typeof a?new h({url:a}):a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData?new h({data:a}):c.ensureType(h,
a):a};e.prototype.readNormalTexture=function(a,b,c){if(a)return new h(a)};e.prototype.clone=function(){return new d({color:f.clone(this.color),colorTexture:f.clone(this.colorTexture),normalTexture:f.clone(this.normalTexture),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided})};e.prototype.cloneWithSharedTextures=function(){return new d({color:f.clone(this.color),colorTexture:this.colorTexture,normalTexture:this.normalTexture,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,
doubleSided:this.doubleSided})};var d;g([k.property({type:l,json:{write:!0}})],e.prototype,"color",void 0);g([k.cast("color")],e.prototype,"castColor",null);g([k.property({json:{write:!0}})],e.prototype,"colorTexture",void 0);g([k.cast("colorTexture")],e.prototype,"castColorTexture",null);g([k.reader("colorTexture")],e.prototype,"readColorTexture",null);g([k.property({json:{write:!0}})],e.prototype,"normalTexture",void 0);g([k.cast("normalTexture")],e.prototype,"castNormalTexture",null);g([k.reader("normalTexture")],
e.prototype,"readNormalTexture",null);g([k.property({json:{write:!0}})],e.prototype,"alphaMode",void 0);g([k.property({json:{write:!0}})],e.prototype,"alphaCutoff",void 0);g([k.property({json:{write:!0}})],e.prototype,"doubleSided",void 0);return e=d=g([k.subclass("esri.geometry.support.MeshMaterial")],e)}(k.declared(b));d.MeshMaterial=t;var v=/^\s*(#|rgba?\()/;d.default=t})},"esri/geometry/support/ImageMeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Identifiable ../../core/Logger ../../core/urlUtils ../../core/accessorSupport/decorators ./MeshColor ../../views/support/screenshotUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){var h=f.getLogger("esri.geometry.support.ImageMeshColor");return function(b){function c(a){a=b.call(this)||this;a.type="image";h.warn("esri/geometry/support/ImageMeshColor is deprecated since version 4.11. Use esri/geometry/support/MeshTexture instead.");return a}q(c,b);f=c;Object.defineProperty(c.prototype,"url",{get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!0,configurable:!0});c.prototype.writeData=function(a,b,c,f){a instanceof HTMLImageElement?a={type:"image-element",src:e.toJSON(a.src,f)}:a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a={type:"image-data",imageData:this.encodeImageData(a)};b[c]=a};c.prototype.readData=function(a,
b){switch(a.type){case "image-element":return b=new Image,b.src=a.src,b;case "canvas-element":return a=this.decodeImageData(a.imageData),b=document.createElement("canvas"),b.width=a.width,b.height=a.height,b.getContext("2d").putImageData(a,0,0),b;case "image-data":return this.decodeImageData(a.imageData);default:l.neverReached(a)}};Object.defineProperty(c.prototype,"transparent",{get:function(){var a=this.data,b=this.url;return a instanceof HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,
0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):b&&(a=b.substr(b.length-4,4).toLowerCase(),b=b.substr(0,15).toLocaleLowerCase(),".png"===a||"data:image/png;"===b)?!0:!1},set:function(a){null!=a?this._override("transparent",a):this._clearOverride("transparent")},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new f({url:this.url,data:this.data})};c.prototype.encodeImageData=function(a){for(var b="",c=0;c<a.data.length;c++)b+=String.fromCharCode(a.data[c]);
return{data:btoa(b),width:a.width,height:a.height}};c.prototype.decodeImageData=function(b){for(var c=atob(b.data),e=new Uint8ClampedArray(c.length),f=0;f<c.length;f++)e[f]=c.charCodeAt(f);return a.wrapImageData(e,b.width,b.height)};c.prototype.imageDataContainsTransparent=function(a){for(var b=3;b<a.data.length;b+=4)if(255!==a.data[b])return!0;return!1};var f;g([k.property()],c.prototype,"type",void 0);g([k.property({type:String,json:{write:e.write}})],c.prototype,"url",null);g([k.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),
k.property()],c.prototype,"data",null);g([k.writer("data")],c.prototype,"writeData",null);g([k.reader("data")],c.prototype,"readData",null);g([k.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],c.prototype,"transparent",null);return c=f=g([k.subclass("esri.geometry.support.ImageMeshColor")],c)}(k.declared(c.default,b.Identifiable))})},"esri/geometry/support/MeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(f){function e(b){return f.call(this)||this}q(e,f);e.prototype.clone=function(){throw Error("not implemented");};g([b.property({readOnly:!0,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0,enabled:!0}}})],e.prototype,"type",void 0);return e=g([b.subclass("esri.geometry.support.MeshColor")],e)}(b.declared(l));d.MeshColor=t;d.default=t})},"esri/geometry/support/MeshTexture":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Identifiable ../../core/JSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators ../../views/support/screenshotUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c){return function(a){function b(b){b=a.call(this)||this;b.wrap="repeat";return b}q(b,a);f=b;Object.defineProperty(b.prototype,"url",{get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!0,configurable:!0});b.prototype.writeData=
function(a,b,c,f){a instanceof HTMLImageElement?a={type:"image-element",src:e.toJSON(a.src,f)}:a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a={type:"image-data",imageData:this.encodeImageData(a)};b[c]=a};b.prototype.readData=function(a,b){switch(a.type){case "image-element":return b=new Image,b.src=a.src,b;case "canvas-element":return a=this.decodeImageData(a.imageData),b=document.createElement("canvas"),
b.width=a.width,b.height=a.height,b.getContext("2d").putImageData(a,0,0),b;case "image-data":return this.decodeImageData(a.imageData);default:l.neverReached(a)}};Object.defineProperty(b.prototype,"transparent",{get:function(){var a=this.data,b=this.url;return a instanceof HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):b&&(a=b.substr(b.length-4,4).toLowerCase(),b=b.substr(0,15).toLocaleLowerCase(),
".png"===a||"data:image/png;"===b)?!0:!1},set:function(a){null!=a?this._override("transparent",a):this._clearOverride("transparent")},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new f({url:this.url,data:this.data,wrap:this.cloneWrap()})};b.prototype.cloneWrap=function(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};b.prototype.encodeImageData=function(a){for(var b="",c=0;c<a.data.length;c++)b+=String.fromCharCode(a.data[c]);
return{data:btoa(b),width:a.width,height:a.height}};b.prototype.decodeImageData=function(a){for(var b=atob(a.data),e=new Uint8ClampedArray(b.length),f=0;f<b.length;f++)e[f]=b.charCodeAt(f);return c.wrapImageData(e,a.width,a.height)};b.prototype.imageDataContainsTransparent=function(a){for(var b=3;b<a.data.length;b+=4)if(255!==a.data[b])return!0;return!1};var f;g([k.property({type:String,json:{write:e.write}})],b.prototype,"url",null);g([k.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),
k.property()],b.prototype,"data",null);g([k.writer("data")],b.prototype,"writeData",null);g([k.reader("data")],b.prototype,"readData",null);g([k.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null);g([k.property({json:{write:!0}})],b.prototype,"wrap",void 0);return b=f=g([k.subclass("esri.geometry.support.MeshTexture")],b)}(k.declared(f,b.Identifiable))})},"esri/geometry/support/ValueMeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ./MeshColor".split(" "),
function(t,d,q,g,l,b,f,e,k){var c=f.getLogger("esri.geometry.support.ValueMeshColor");return function(a){function f(b){b=a.call(this)||this;b.type="value";b.value=null;c.warn("esri/geometry/support/ValueMeshColor is deprecated since version 4.11. Use esri/Color instead.");return b}q(f,a);d=f;f.prototype.clone=function(){return new d({value:b.clone(this.value)})};var d;g([e.property()],f.prototype,"type",void 0);g([e.property({type:l})],f.prototype,"value",void 0);return f=d=g([e.subclass("esri.geometry.support.ValueMeshColor")],
f)}(e.declared(k.default))})},"esri/geometry/support/MeshVertexAttributes":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),function(t,d,q,g,l,b,f,e){function k(a,b,c,e){var f=b.loggerTag;b=b.stride;return 0!==a.length%b?(e.error(f,"Invalid array length, expected a multiple of "+b),new c([])):a}function c(a,b,c,e,f){if(!a)return a;
if(a instanceof b)return k(a,e,b,f);for(var d=0;d<c.length;d++)if(a instanceof c[d])return k(new b(a),e,b,f);if(Array.isArray(a))return k(new b(a),e,b,f);c=c.map(function(a){return"'"+a.name+"'"});f.error("Failed to set property, expected one of "+c+", but got "+a.constructor.name);return new b([])}function a(a,b,c){for(var e=Array(a.length),f=0;f<a.length;f++)e[f]=a[f];b[c]=e}Object.defineProperty(d,"__esModule",{value:!0});var h=f.getLogger("esri.geometry.support.MeshVertexAttributes");t=function(f){function d(a){a=
f.call(this)||this;a.color=null;a.position=new Float64Array(0);a.uv=null;a.normal=null;a.tangent=null;return a}q(d,f);k=d;d.prototype.castColor=function(a){return c(a,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},h)};d.prototype.castPosition=function(a){a&&a instanceof Float32Array&&h.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return c(a,Float64Array,[Float32Array],
{loggerTag:".position\x3d",stride:3},h)};d.prototype.castUv=function(a){return c(a,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},h)};d.prototype.castNormal=function(a){return c(a,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},h)};d.prototype.castTangent=function(a){return c(a,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},h)};d.prototype.clone=function(){return new k({position:b.clone(this.position),uv:b.clone(this.uv),normal:b.clone(this.normal),tangent:b.clone(this.tangent)})};
var k;g([e.property({json:{write:a}})],d.prototype,"color",void 0);g([e.cast("color")],d.prototype,"castColor",null);g([e.property({nonNullable:!0,json:{write:a}})],d.prototype,"position",void 0);g([e.cast("position")],d.prototype,"castPosition",null);g([e.property({json:{write:a}})],d.prototype,"uv",void 0);g([e.cast("uv")],d.prototype,"castUv",null);g([e.property({json:{write:a}})],d.prototype,"normal",void 0);g([e.cast("normal")],d.prototype,"castNormal",null);g([e.property({json:{write:a}})],
d.prototype,"tangent",void 0);g([e.cast("tangent")],d.prototype,"castTangent",null);return d=k=g([e.subclass("esri.geometry.support.MeshVertexAttributes")],d)}(e.declared(l));d.MeshVertexAttributes=t;d.castArray=c;d.default=t})},"esri/geometry/support/meshUtils/projection":function(){define("require exports ../../../core/Logger ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../views/3d/support/projectionUtils ../../../views/3d/support/buffer/BufferView".split(" "),
function(t,d,q,g,l,b,f,e,k,c){function a(a,b,c,e,d,h){if(b){var m=c.count;if(d.isWGS84)for(d=0;d<m;d++)e.getVec(d,p),b.getVec(d,n),k.computeLinearTransformation(k.SphericalECEFSpatialReference,p,u,k.SphericalECEFSpatialReference),g.mat3.fromMat4(v,u),1===a&&g.mat3.transpose(v,v),f.vec3.transformMat3(n,n,v),h.setVec(d,n);else for(d=0;d<m;d++){e.getVec(d,p);b.getVec(d,n);k.computeLinearTransformation(k.SphericalECEFSpatialReference,p,u,k.SphericalECEFSpatialReference);g.mat3.fromMat4(v,u);var l=k.webMercator.y2lat(c.get(d,
1)),l=Math.cos(l);0===a&&(l=1/l);v[0]*=l;v[1]*=l;v[2]*=l;v[3]*=l;v[4]*=l;v[5]*=l;1===a&&g.mat3.transpose(v,v);f.vec3.transformMat3(n,n,v);f.vec3.normalize(n,n);h.setVec(d,n)}return h}}Object.defineProperty(d,"__esModule",{value:!0});var h=q.getLogger("esri.geometry.support.meshUtils.normalProjection");d.projectNormalToECEF=function(b,e,f,d,g){if(!d.isWebMercator&&!d.isWGS84)return h.error("Cannot convert PCS spatial reference buffer to ECEF"),g;a(0,new c.BufferViewVec3f(b.buffer,b.byteOffset),new c.BufferViewVec3f64(e.buffer,
e.byteOffset),new c.BufferViewVec3f64(f.buffer,f.byteOffset),d,new c.BufferViewVec3f(g.buffer,g.byteOffset));return g};d.projectNormalFromECEF=function(b,e,f,d,g){if(!d.isWebMercator&&!d.isWGS84)return h.error("Cannot convert to PCS spatial reference buffer from ECEF"),g;a(1,new c.BufferViewVec3f(b.buffer,b.byteOffset),new c.BufferViewVec3f64(e.buffer,e.byteOffset),new c.BufferViewVec3f64(f.buffer,f.byteOffset),d,new c.BufferViewVec3f(g.buffer,g.byteOffset));return g};d.projectToECEF=function(a,b,
c){k.bufferToBuffer(a,b,0,c,k.SphericalECEFSpatialReference,0,a.length/3);return c};d.projectFromECEF=function(a,b,c){k.bufferToBuffer(a,k.SphericalECEFSpatialReference,0,b,c,0,a.length/3);return b};d.transformBufferInPlace=function(a,b,c){void 0===c&&(c=!1);if(a)for(var e=0;e<a.length;e+=3){for(var d=0;3>d;d++)p[d]=a[e+d];f.vec3.transformMat4(p,p,b);c&&f.vec3.normalize(p,p);for(d=0;3>d;d++)a[e+d]=p[d]}};d.projectTangentToECEF=function(b,e,f,d,g){if(!d.isWebMercator&&!d.isWGS84)return h.error("Cannot convert PCS spatial reference buffer to ECEF"),
g;a(0,new c.BufferViewVec3f(b.buffer,b.byteOffset,16),new c.BufferViewVec3f64(e.buffer,e.byteOffset),new c.BufferViewVec3f64(f.buffer,f.byteOffset),d,new c.BufferViewVec3f(g.buffer,g.byteOffset,16));for(e=3;e<b.length;e+=4)g[e]=b[e];return g};d.projectTangentFromECEF=function(b,e,f,d,g){if(!d.isWebMercator&&!d.isWGS84)return h.error("Cannot convert to PCS spatial reference buffer from ECEF"),g;a(1,new c.BufferViewVec3f(b.buffer,b.byteOffset,16),new c.BufferViewVec3f64(e.buffer,e.byteOffset),new c.BufferViewVec3f64(f.buffer,
f.byteOffset),d,new c.BufferViewVec3f(g.buffer,g.byteOffset,16));for(e=3;e<b.length;e+=4)g[e]=b[e];return g};var p=e.vec3f64.create(),n=e.vec3f64.create(),u=b.mat4f64.create(),v=l.mat3f64.create()})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.encodeSymbolColor=function(b,e,d,c){void 0===c&&(c=0);null==b||"ignore"===e?(d[c+0]=255,d[c+1]=255,d[c+2]=255,d[c+3]=255):(d[c+0]=Math.floor(255*b[0]),
d[c+1]=Math.floor(255*b[1]),d[c+2]=Math.floor(255*b[2]),b=Math.floor(b[3]*q),d[c+3]=0===b?0:"tint"===e?b:"replace"===e?b+g:b+l)};d.decodeSymbolColor=function(b,e){void 0===e&&(e=0);var f=0,c="multiply",a=b[e+3];a>l?f=(a-l)/q:a>g?(f=(a-g)/q,c="replace"):0<a&&(f=a/q,c="tint");return{color:[b[e+0]/255,b[e+1]/255,b[e+2]/255,f],colorMixMode:c}};d.isOpaqueSymbolColor=function(f,e){void 0===e&&(e=0);f=f[e+3];return f===g||f===l||f===b};var q=85,g=q,l=2*q,b=3*q})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/errors/CancelError ../../../../Color ../../../../core/asyncUtils ../../../../core/lang ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ./ElevationAligners ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./objectResourceUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M){Object.defineProperty(d,"__esModule",{value:!0});t=function(c){function d(a,b,e,f){a=c.call(this,a,b,e,f)||this;a._optionalFields=[];a._instanceIndexToGraphicUid=new Map;e=a._getStageIdHint();if(!a._isPropertyDriven("size")&&(f=m.validateSymbolLayerSize(a.symbolLayer)))return a._logWarning(f),a.reject(),a;b.resource&&b.resource.href?a._prepareModelResources(b.resource.href,e):a._preparePrimitiveResources(b.resource?b.resource.primitive:
u.defaultPrimitive,e);return a}q(d,c);d.prototype.getCachedSize=function(){var a=this._symbolSize;return{width:a[0],depth:a[1],height:a[2]}};Object.defineProperty(d.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0});d.prototype._preparePrimitiveResources=function(a,b){if(C.isValidPrimitive(a)){var c=this.symbolLayer;this._resourceBoundingBox=n.create(C.primitiveBoundingBox(a));this._resourceSize=h.vec3f64.fromArray(n.size(this._resourceBoundingBox));
this._symbolSize=h.vec3f64.fromArray(m.computeSizeWithResourceSize(this._resourceSize,c));var d=this._getMaterialOpacity(),d={specular:[0,0,0],opacity:d,transparent:1>d||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:Q,diffuse:Q,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},g=this.symbol;if("point-3d"===g.type&&g.verticalOffset){var g=g.verticalOffset,k=g.minWorldLength,p=g.maxWorldLength;d.verticalOffset={screenLength:e.pt2px(g.screenLength),
minWorldLength:k||0,maxWorldLength:null!=p?p:Infinity};d.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?d.externalColor=P:(c=c.material?l.toUnitRGBA(c.material.color):P,d.externalColor=c);this._fastUpdates=E.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(f.mixin(d,this._fastUpdates.materialParameters),
d.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(d.instanced.push("color"),this._optionalFields.push("color"));c=new M(d,b+"_objectmat");this._lodResources=C.primitiveLodResources(a,c,b);this._originalOpacities=K.materialsFromLodResources(this._lodResources).map(function(){return 1});this._lodResources?(this.finalizeSymbolResources(),this.initializeLodRenderer(),this.complexity=this.computeComplexity(),this.resolve()):(this._logWarning("Unknown object symbol primitive: "+
a),this.reject())}else this._logWarning("Unknown object symbol primitive: "+a),this.reject()};d.prototype._prepareModelResources=function(a,c){var d=this,k=["transformation"];c={materialParamsMixin:{instanced:k,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},idHint:c,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=E.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?
(f.mixin(c.materialParamsMixin,this._fastUpdates.materialParameters),k.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(k.push("color"),this._optionalFields.push("color"));k=this.symbol;if("point-3d"===k.type&&k.verticalOffset){var k=k.verticalOffset,l=k.minWorldLength,p=k.maxWorldLength;c.materialParamsMixin.verticalOffset={screenLength:e.pt2px(k.screenLength),minWorldLength:l||0,maxWorldLength:null!=p?p:Infinity};c.materialParamsMixin.castShadows=
!1}this._symbolLoaderPromise=b.safeCast(A.fetch(a,c));this._symbolLoaderPromise.then(function(a){d._symbolLoaderPromise=null;if(!d.isRejected()){var b=x.makeLodResources(a.lods);x.fillEstimatedMinScreenSpaceRadius(b);b.levels.sort(function(a,b){return a.minScreenSpaceRadius-b.minScreenSpaceRadius});b.levels[0].minScreenSpaceRadius=Math.min(2,b.levels[0].minScreenSpaceRadius);d._lodResources=b;var c=d._context,e=d._getExternalColorParameters(d.symbolLayer.material),f=d._getMaterialOpacity(),g=d._isPropertyDriven("opacity"),
b=K.materialsFromLodResources(d._lodResources);d._originalOpacities=b.map(function(a){return a.getParameters().opacity||1});b.forEach(function(a){var b=a.getParameters();a.setParameterValues(e);var d=b.opacity*f;a.setParameterValues({opacity:d,transparent:1>d||g||b.transparent});c.screenSizePerspectiveEnabled&&a.setParameterValues({screenSizePerspective:c.sharedResources.screenSizePerspectiveSettings})});d._resourceBoundingBox=a.referenceBoundingBox;d._resourceSize=h.vec3f64.fromArray(n.size(d._resourceBoundingBox));
d._pivotOffset=h.vec3f64.fromArray(d._lodResources.levels[0].pivotOffset);d._symbolSize=h.vec3f64.fromArray(m.computeSizeWithResourceSize(d._resourceSize,d.symbolLayer));E.updateFastSymbolUpdatesState(d._fastUpdates,d._context.renderer,d._fastVisualVariableConvertOptions())&&b.forEach(function(a){return a.setParameterValues(d._fastUpdates.materialParameters)});d.finalizeSymbolResources();d.initializeLodRenderer();d.complexity=d.computeComplexity();d.resolve()}},function(a){d._symbolLoaderPromise=
null;if(!d.isFulfilled()){if(!(a instanceof g)){var b="ObjectSymbol3DLayer failed to load";a&&a.message&&(b+=" ("+a.message+")");d._logWarning(b)}d.reject()}})};d.prototype.finalizeSymbolResources=function(){var a=this._context.stage;this._materials=K.materialsFromLodResources(this._lodResources);this._materials.forEach(function(b){a.add(G.ModelContentType.MATERIAL,b)});this._textures=K.texturesFromLodResources(this._lodResources);this._textures.forEach(function(b){a.add(G.ModelContentType.TEXTURE,
b)});this._geometries=K.geometriesFromLodResources(this._lodResources);this._geometries.forEach(function(b){a.add(G.ModelContentType.GEOMETRY,b)})};d.prototype.initializeLodRenderer=function(){var a=this,b=this._context.stage;this._lodRenderer=new F.LodRenderer(this._lodResources,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:function(b){return a._instanceIndexToGraphicUid.get(b)}},this._fastUpdates.enabled?{applyTransform:function(b,c,e){b.getFeatureAttribute(c,X);k.mat4.copy(e,
E.evaluateModelTransform(a._fastUpdates.materialParameters,X,e))},scaleFactor:function(b,c,e){c.getFeatureAttribute(e,X);return E.evaluateModelTransformScale(b,a._fastUpdates.materialParameters,X)}}:null);this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;b.addRenderPlugin(this._lodRenderer.slots,this._lodRenderer)};d.prototype._getExternalColorParameters=function(a){var b={};this._isPropertyDriven("color")?b.externalColor=P:a&&a.color?b.externalColor=l.toUnitRGBA(a.color):(b.externalColor=
P,b.colorMixMode="ignore");return b};d.prototype.destroy=function(){c.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;this._lodRenderer&&(a.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy());this._materials&&this._materials.forEach(function(b){return a.remove(G.ModelContentType.MATERIAL,b.id)});this._textures&&this._textures.forEach(function(b){return a.remove(G.ModelContentType.TEXTURE,
b.id)});this._geometries&&this._geometries.forEach(function(b){return a.remove(G.ModelContentType.GEOMETRY,b.id)})};d.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var c=y.placePointOnGeometry(b.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+b.geometry.type),null;var e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,c,a.renderingInfo,e,b.uid)};d.prototype.notifyDestroyGraphicLayer=
function(a){this._instanceIndexToGraphicUid.delete(a.instanceIndex)};d.prototype.graphicLayerToGraphicId=function(a){return 0};d.prototype.layerOpacityChanged=function(){var a=this,b=this._isPropertyDriven("opacity");this._materials.forEach(function(c,e){e=a._getMaterialOpacity()*a._originalOpacities[e];c.setParameterValues({opacity:e,transparent:1>e||b})});return!0};d.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,y.needsElevationUpdates3D)};
d.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;this._materials.forEach(function(a){a.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});return!0};d.prototype.pixelRatioChanged=function(a,b){return!0};d.prototype.applyRendererDiff=function(a,b){var c=this,e;for(e in a.diff)switch(e){case "visualVariables":if(E.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._materials.forEach(function(a){return a.setParameterValues(c._fastUpdates.materialParameters)}),
this._lodRenderer.notifyShaderTransformationChanged();else return!1;break;default:return!1}return!0};d.prototype.computeComplexity=function(){if(!this._lodResources)return c.prototype.computeComplexity.call(this);var a=K.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(a,b){return a+b.data.getIndices(L.VertexAttrConstants.POSITION).length},0)/3,b=B.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer);return{primitivesPerFeature:a,primitivesPerCoordinate:0,
memory:b}};d.prototype._createAs3DShape=function(a,b,c,e,d){a=this.getFastUpdateAttrValues(a);var f=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?m.mixinColorAndOpacity(c.color,c.opacity):null,g=this._context.clippingExtent;I.pointToVector(b,U,this._context.elevationProvider.spatialReference);if(g&&!y.pointInBox2D(U,g))return null;var g=this._requiresTerrainElevation(e),h=this._computeGlobalTransform(b,e,V,g?J:null);c=this._computeLocalTransform(this.symbolLayer,c,N);var k=this._lodRenderer.instanceData,
l=k.addInstance();this._instanceIndexToGraphicUid.set(l,d);k.setLocalTransform(l,c,!1);k.setGlobalTransform(l,h);a&&k.setFeatureAttribute(l,a);f&&k.setColor(l,f);d=new r(this,l,v.perLodInstanceElevationAligner,e);g&&(d.alignedTerrainElevation=J.terrainElevation);d.needsElevationUpdates=y.needsElevationUpdates3D(e.mode);y.extendPointGraphicElevationContext(d,b,this._context.elevationProvider);return d};d.prototype._computeGlobalTransform=function(a,b,c,e){b=y.computeElevation(this._context.elevationProvider,
a,b,this._context.renderCoordsHelper,e);U[0]=a.x;U[1]=a.y;U[2]=b;I.computeLinearTransformation(a.spatialReference,U,c,this._context.renderSpatialReference);return c};d.prototype._computeLocalTransform=function(a,b,c){k.mat4.identity(c);this._applyObjectRotation(b,!1,c);this._applyObjectRotation(a,!0,c);this._applyObjectScale(b,c);this._applyAnchor(a,c);return c};d.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._isPropertyDriven("size")&&
a.size?a.size:this._symbolSize,a=m.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||k.mat4.scale(b,b,a))};d.prototype.prepareSymbolLayerPatch=function(a){if("partial"===a.diff.type){var b=a.diff.diff;this._preparePatchTransform(a,b);this._preparePatchColor(a,b)}};d.prototype.updateGeometry=function(a,b){var c=b&&y.placePointOnGeometry(b);if(!c)return!1;b=this.getGeometryElevationMode(b);if(a.elevationContext.mode!==
b)return!1;b=this._requiresTerrainElevation(a.elevationContext);this._computeGlobalTransform(c,a.elevationContext,V,b?J:null);b&&(a.alignedTerrainElevation=J.terrainElevation);this._lodRenderer.instanceData.setGlobalTransform(a.instanceIndex,V,!0);y.extendPointGraphicElevationContext(a,c,this._context.elevationProvider);return!0};d.prototype._preparePatchTransform=function(a,b){var c=this;if(b.heading||b.tilt||b.roll||b.width||b.height||b.depth||b.anchor||b.anchorPosition){var e=function(a,b,c){return(null!=
a&&"complete"===a.type?a.newValue:b)||c},d=e(b.heading,this.symbolLayer.heading,0),f=e(b.tilt,this.symbolLayer.tilt,0),g=e(b.roll,this.symbolLayer.roll,0),k=e(b.width,this.symbolLayer.width,void 0),l=e(b.height,this.symbolLayer.height,void 0),p=e(b.depth,this.symbolLayer.depth,void 0),n=e(b.anchor,this.symbolLayer.anchor,void 0),e=e(b.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete b.heading;delete b.tilt;delete b.roll;delete b.width;delete b.height;delete b.depth;delete b.anchor;delete b.anchorPosition;
var r={heading:d,tilt:f,roll:g,anchor:n,anchorPosition:e};this.isResolved()&&a.symbolLayerStatePatches.push(function(){c._symbolSize=h.vec3f64.fromArray(m.computeSizeWithResourceSize(c._resourceSize,{width:k,height:l,depth:p,isPrimitive:c.symbolLayer.isPrimitive}))});a.graphics3DGraphicPatches.push(function(a,b){b=c._computeLocalTransform(r,b,N);c._lodRenderer.instanceData.setLocalTransform(a.instanceIndex,b,!0)})}};d.prototype._preparePatchColor=function(a,b){var c=this;if(b.material&&"partial"===
b.material.type&&(b=b.material.diff,b.color&&"complete"===b.color.type)){var e=b.color.newValue,d=e?l.toUnitRGBA(e):P;delete b.color;a.graphics3DGraphicPatches.push(function(a,b){if(c._hasPerInstanceColor())c._lodRenderer.instanceData.setColor(a.instanceIndex,d);else for(a=0,b=c._materials;a<b.length;a++)b[a].setParameterValues({externalColor:d})})}};d.prototype._requiresTerrainElevation=function(a){return"absolute-height"!==a.mode};d.prototype._applyObjectRotation=function(a,b,c){if(!(this._fastUpdates.enabled&&
this._fastUpdates.requiresShaderTransformation&&b))return m.computeObjectRotation(a.heading,a.tilt,a.roll,c)};d.prototype._computeAnchor=function(b){var c=h.vec3f64.create();switch(b.anchor){case "center":a.vec3.copy(c,n.center(this._resourceBoundingBox));a.vec3.negate(c,c);break;case "top":var e=n.center(this._resourceBoundingBox);a.vec3.set(c,-e[0],-e[1],-this._resourceBoundingBox[5]);break;case "bottom":e=n.center(this._resourceBoundingBox);a.vec3.set(c,-e[0],-e[1],-this._resourceBoundingBox[2]);
break;case "relative":var e=n.center(this._resourceBoundingBox),d=n.size(this._resourceBoundingBox);b=(b=b.anchorPosition)?h.vec3f64.fromValues(b.x,b.y,b.z):O;a.vec3.multiply(c,d,b);a.vec3.add(c,c,e);a.vec3.negate(c,c);break;default:this._pivotOffset?a.vec3.negate(c,this._pivotOffset):a.vec3.copy(c,O)}return c};d.prototype._applyAnchor=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._computeAnchor(a))&&k.mat4.translate(b,b,a)};d.prototype._hasPerInstanceColor=
function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};d.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?h.vec3f64.fromArray(n.size(this._resourceBoundingBox)):Q,b=this._resourceBoundingBox?this._computeAnchor(this.symbolLayer):O,c=this._context.renderCoordsHelper.unitInMeters,e=m.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,c),d=h.vec3f64.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||
0);return{modelSize:a,symbolSize:this._symbolSize||Q,unitInMeters:c,transformation:{anchor:b,scale:e,rotation:d}}};return d}(w.default);d.Graphics3DObjectSymbolLayer=t;var Q=h.vec3f64.fromValues(1,1,1),P=p.vec4f64.fromValues(1,1,1,1),O=h.vec3f64.fromValues(0,0,0),U=h.vec3f64.create(),N=c.mat4f64.create(),V=c.mat4f64.create(),X=p.vec4f64.create(),J={verticalDistanceToGround:0,terrainElevation:0};d.default=t})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../webgl-engine/lib/HighlightUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){t=function(){function b(b,c,e,d){this.type="lod-instance";this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=b;this.instanceIndex=c;this.elevationAligner=e;this.elevationContext=new a(d)}b.prototype.initialize=function(a,b){};b.prototype.setVisibility=function(a){var b=this.lodRenderer.instanceData;return a!==b.getVisible(this.instanceIndex)?(b.setVisible(this.instanceIndex,a),!0):!1};b.prototype.destroy=function(){null!=this.instanceIndex&&
(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};b.prototype.alignWithElevation=function(a,b,e){this.elevationAligner&&(c.setContextFeature(this.elevationContext.featureExpressionInfoContext,e),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};b.prototype.getBSRadius=function(){var a=this.lodRenderer;return a.baseBoundingSphere.radius*a.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)};
b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=e.vec3f64.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,y);return f.vec3.transformMat4(a,this.lodRenderer.baseBoundingSphere.center,y)};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=k.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,y);var b=this.lodRenderer.baseBoundingBox;k.empty(a);for(var c=0;8>c;++c)f.vec3.set(u,0===(c&1)?b[0]:b[3],0===(c&2)?
b[1]:b[4],0===(c&4)?b[2]:b[5]),f.vec3.transformMat4(u,u,y),k.expandPointInPlace(a,u);return a};b.prototype.getProjectedBoundingBox=function(a,b,c,e){return l(this,void 0,void 0,function(){var d,m,l,p,x,q,w,A,C;return g(this,function(g){switch(g.label){case 0:d=this.getBoundingBoxObjectSpace(e);m=r;l=k.isPoint(d)?1:m.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,y);for(p=0;p<l;p++)x=m[p],u[0]=d[x[0]],u[1]=d[x[1]],u[2]=d[x[2]],f.vec3.transformMat4(u,u,y),n[3*p+0]=u[0],n[3*
p+1]=u[1],n[3*p+2]=u[2];if(!a(n,0,l))return[2,null];k.empty(d);q=null;this.calculateRelativeScreenBounds&&(q=this.calculateRelativeScreenBounds());for(p=0;p<3*l;p+=3){for(w=0;3>w;w++)d[w]=Math.min(d[w],n[p+w]),d[w+3]=Math.max(d[w+3],n[p+w]);q&&c.push({location:n.slice(p,p+3),screenSpaceBoundingRect:q})}if(!b)return[3,5];k.center(d,v);if("absolute-height"===this.elevationContext.mode)return[3,5];A=void 0;C=h.demResolutionForBoundingBox(d,b);g.label=1;case 1:return g.trys.push([1,3,,4]),[4,b.service.queryElevation(v[0],
v[1],C)];case 2:return A=g.sent(),[3,4];case 3:return g.sent(),A=null,[3,4];case 4:null!=A&&k.offset(d,0,0,-this.alignedTerrainElevation+A),g.label=5;case 5:return[2,d]}})})};b.prototype.addHighlight=function(a,b){var c=this;b=p.generateHighlightId();this.addHighlightId(b);a.addExternal(function(a){c.removeHighlightId(a)},b)};b.prototype.removeHighlight=function(a){this.highlights&&this.highlights.forEach(function(b){return a.remove(b)})};b.prototype.addHighlightId=function(a){this.highlights=this.highlights||
new Set;this.highlights.add(a);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};b.prototype.removeHighlightId=function(a){this.highlights&&(this.highlights.delete(a),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};Object.defineProperty(b.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0});return b}();var n=[0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=e.vec3f64.create(),v=e.vec3f64.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],y=b.mat4f64.create();return t})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../webgl-engine/lib/lodRendering/LodResources"],function(t,d,q,g,l){function b(b){var c=[];b.stageResources.geometries.forEach(function(a,e){c.push({material:b.stageResources.materials[e],
geometry:a,textures:b.stageResources.textures})});return{components:c,minScreenSpaceRadius:b.lodThreshold,pivotOffset:b.pivotOffset}}function f(b,c){void 0===c&&(c=e);b=l.computeFaceCount(b);return Math.sqrt(b/(c*Math.PI))}Object.defineProperty(d,"__esModule",{value:!0});d.makeLodLevelResources=b;d.makeLodResources=function(e){return{levels:e.map(function(c){return b(c)})}};d.estimateMinScreenSpaceRadius=f;d.fillEstimatedMinScreenSpaceRadius=function(b){b.levels.forEach(function(b){b.minScreenSpaceRadius||
(b.minScreenSpaceRadius=f(b))})};var e=.05})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/lang ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../glTF/DefaultLoadingContext ../../glTF/esriProvidedModelParameters ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../support/mathUtils ../../support/buffer/BufferView ../../support/buffer/math ../../support/buffer/utils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I){function G(a){var b=a.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return b?{fileType:"gltf",url:b[1],specifiedLodIndex:null!=b[4]?Number(b[4]):null}:a.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:a,specifiedLodIndex:null}:{fileType:"unknown",url:a,specifiedLodIndex:null}}function L(a,d,f){var g=a.model,h=c.mat4f64.create(),l=[],n=new Map,v=new Map;g.lods.forEach(function(a,c){if(void 0===f||c===f){var u=0,q={stageResources:{textures:[],
materials:[],geometries:[]},lodThreshold:e.isSome(a.lodThreshold)?a.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:p.empty()};l.push(q);a.parts.forEach(function(c){var f=c.material+(c.attributes.normal?"_normal":"")+(c.attributes.color?"_color":"")+(c.attributes.texCoord0?"_texCoord0":"")+(c.attributes.tangent?"_tangent":""),l=g.materials.get(c.material),w=e.isSome(c.attributes.texCoord0),y=e.isSome(c.attributes.normal);if(!n.has(f)){if(e.isSome(l.textureColor)&&w&&!v.has(l.textureColor)){var t=
g.textures.get(l.textureColor),J=b({},t.parameters,{preMultiplyAlpha:!0});v.set(l.textureColor,new E(t.data,l.textureColor,J))}e.isSome(l.textureNormal)&&w&&!v.has(l.textureNormal)&&(t=g.textures.get(l.textureNormal),J=b({},t.parameters,{preMultiplyAlpha:!0}),v.set(l.textureNormal,new E(t.data,l.textureNormal,J)));var G=I.COLOR_GAMMA,t=Math.pow(l.color[0],1/G),J=Math.pow(l.color[1],1/G),G=Math.pow(l.color[2],1/G);n.set(f,new I(b({transparent:"BLEND"===l.alphaMode,textureAlphaMode:F(l.alphaMode),textureAlphaCutoff:l.alphaCutoff,
diffuse:[t,J,G],ambient:[t,J,G],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",vertexColors:!!c.attributes.color,vertexTangents:!!c.attributes.tangent,normals:y?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:e.isSome(l.textureColor)&&w?v.get(l.textureColor).id:void 0,colorMixMode:l.colorMixMode,normalTextureId:e.isSome(l.textureNormal)&&w?v.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:!0},d),f))}a:{y=c.indices||c.attributes.position.count;
switch(c.primitiveType){case 4:t=r.trianglesToTriangles(y);break a;case 5:t=r.triangleStripToTriangles(y);break a;case 6:t=r.triangleFanToTriangles(y);break a}t=void 0}var J={},G={},y=c.attributes.position.count,R=A.createBuffer(m.BufferViewVec3f,y);x.vec3.transformMat4(R,c.attributes.position,c.transform);G.position={data:R.typedBuffer,size:R.elementCount};J.position=t;e.isSome(c.attributes.normal)&&(R=A.createBuffer(m.BufferViewVec3f,y),k.mat4.invert(h,c.transform),k.mat4.transpose(h,h),x.vec3.transformMat4(R,
c.attributes.normal,h),G.normal={data:R.typedBuffer,size:R.elementCount},J.normal=t);e.isSome(c.attributes.tangent)&&(R=A.createBuffer(m.BufferViewVec4f,y),k.mat4.invert(h,c.transform),k.mat4.transpose(h,h),x.vec4.transformMat4(R,c.attributes.tangent,h),G.aTangent={data:R.typedBuffer,size:R.elementCount},J.aTangent=t);e.isSome(c.attributes.texCoord0)&&(R=A.createBuffer(m.BufferViewVec2f,y),A.vec2.normalizeIntegerBuffer(R,c.attributes.texCoord0),G.uv0={data:R.typedBuffer,size:R.elementCount},J.uv0=
t);if(e.isSome(c.attributes.color)){R=A.createBuffer(m.BufferViewVec4u8,y);if(4===c.attributes.color.elementCount)c.attributes.color instanceof m.BufferViewVec4f?x.vec4.scale(R,c.attributes.color,255):c.attributes.color instanceof m.BufferViewVec4u8?A.vec4.copy(R,c.attributes.color):c.attributes.color instanceof m.BufferViewVec4u16&&x.vec4.scale(R,c.attributes.color,1/256);else{A.vec4.fill(R,255,255,255,255);var L=new m.BufferViewVec3u8(R.buffer,0,4);c.attributes.color instanceof m.BufferViewVec3f?
x.vec3.scale(L,c.attributes.color,255):c.attributes.color instanceof m.BufferViewVec3u8?A.vec3.copy(L,c.attributes.color):c.attributes.color instanceof m.BufferViewVec3u16&&x.vec3.scale(L,c.attributes.color,1/256)}G.color={data:R.typedBuffer,size:R.elementCount};J.color=t}c=new C(new B(G,J),"gltf_"+a.name+"_"+u++);q.stageResources.geometries.push(c);q.stageResources.materials.push(n.get(f));e.isSome(l.textureColor)&&w&&q.stageResources.textures.push(v.get(l.textureColor));e.isSome(l.textureNormal)&&
w&&q.stageResources.textures.push(v.get(l.textureNormal));q.numberOfVertices+=y;f=c.boundingInfo;p.expand(q.boundingBox,f.getBBMin());p.expand(q.boundingBox,f.getBBMax())})}});return l}function F(a){switch(a){case "BLEND":return"blend";case "MASK":return"mask";case "OPAQUE":return"opaque";default:return"blend"}}function K(a,b){void 0===a&&(a="");void 0===b&&(b="");var c=f.endsWith(a,"Imposter");a=a.split("__")[0];if(-1!==b.indexOf("/RealisticTrees/")&&(b=u.treeParamsTable[a]))return{crownCenter:b.center,
crownDimensions:b.radius,imposter:c}}function M(b){b.meta.isEsriSymbolResource&&b.model.lods.forEach(function(d){var f=K(d.name,b.meta.uri);f&&(b.customMeta.esriTreeRendering=!0,d.parts.forEach(function(b){var d=b.attributes.normal,g=b.attributes.position,l=g.count;if(!e.isNone(d)){for(var p=h.vec3f64.create(),n=h.vec3f64.create(),r=h.vec3f64.create(),v=A.createBuffer(m.BufferViewVec4u8,l),u=A.createBuffer(m.BufferViewVec3f,l),x=k.mat4.invert(c.mat4f64.create(),b.transform),q=a.vec3.transformMat4(h.vec3f64.create(),
f.crownCenter,x),x=a.vec3.transformMat4(h.vec3f64.create(),f.crownDimensions,x),y=0;y<l;y++){g.getVec(y,n);d.getVec(y,p);a.vec3.subtract(r,n,q);a.vec3.divide(r,r,x);var C=w.clamp(a.vec3.length(r),0,1),C=.6+.4*C*C;a.vec3.lerp(r,r,p,.2);u.setVec(y,r);v.set(y,0,255*C);v.set(y,1,255*C);v.set(y,2,255*C);v.set(y,3,255)}b.attributes.normal=u;b.attributes.color=v}}))})}function Q(a){var b=a.model.lods.length;a.meta.isEsriSymbolResource&&a.model.lods.forEach(function(a){if(!e.isSome(a.lodThreshold)){var c=
(a.name||"").split("__")[0],d=a.parts.reduce(function(a,b){return a+b.attributes.position.count},0);a.lodThreshold=P(c,d,b)}})}function P(a,b,c){void 0===a&&(a="");if(1===c)return null;if(a in u.lodThresholdLUT){c=u.lodThresholdLUT[a].vertexCounts;a=u.lodThresholdLUT[a].thresholds;var e=c.length;if(1>=e)return null;if(b<=c[0]){var d=(c[1]-c[0])/(a[1]-a[0]);b-=c[0];return Math.max(0,a[0]+b*d)}if(b>=c[e-1])return d=(c[e-1]-c[e-2])/(a[e-1]-a[e-2]),b-=c[e-1],a[e-1]+b*d;for(var f=1;f<c.length;++f){var g=
c[f-1],h=c[f],e=a[f-1],d=a[f];if(b<h)return b=(b-g)/(h-g),e*(1-b)+d*b}}return null}Object.defineProperty(d,"__esModule",{value:!0});d.fetch=function(a,c){void 0===c&&(c={});return l(this,void 0,void 0,function(){var e,d,f,h,k,m,l,p,r,u;return g(this,function(g){switch(g.label){case 0:return e=G(a),"wosr"!==e.fileType?[3,2]:[4,y.load(e.url,c)];case 1:return d=g.sent(),[2,{lods:[d],referenceBoundingBox:d.boundingBox}];case 2:return f=new n.DefaultLoadingContext(c.streamDataSupplier),[4,v.load(f,e.url,
c)];case 3:h=g.sent();M(h);Q(h);k=b({},c.materialParamsMixin,{treeRendering:h.customMeta.esriTreeRendering});if(null!=e.specifiedLodIndex)return m=L(h,k,e.specifiedLodIndex),l=m[0].boundingBox,0!==e.specifiedLodIndex&&(p=L(h,k,e.specifiedLodIndex),l=p[0].boundingBox),[2,{lods:m,referenceBoundingBox:l}];r=L(h,k);u=r[0].boundingBox;return[2,{lods:r,referenceBoundingBox:u}]}})})};d.parseUrl=G;d.gltfToEngineResources=L})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper dojo/errors/CancelError ../../../request ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(a){this.streamDataSupplier=a}d.prototype.loadJson=function(a){return q(this,void 0,void 0,function(){return g(this,function(b){return[2,this.load("json",a)]})})};d.prototype.loadBinary=function(a){return q(this,void 0,void 0,function(){return g(this,function(b){return c.isDataProtocol(a)?[2,c.dataToArrayBuffer(a)]:[2,this.load("binary",a)]})})};d.prototype.loadImage=function(a){return q(this,void 0,
void 0,function(){return g(this,function(b){return[2,this.load("image",a)]})})};d.prototype.load=function(c,d){return q(this,void 0,void 0,function(){var h,l,p=this;return g(this,function(g){switch(g.label){case 0:return this.streamDataSupplier?(h=this.streamDataSupplier.request(d,c),[2,k.create(function(a,c){h.then(function(b){a(b.data)},function(a){c(a instanceof b?a:new e("","Request for resource failed: "+a))})},function(){p.streamDataSupplier.cancelRequest(h)})]):[4,f(d,a[c])];case 1:return l=
g.sent(),[2,l.data]}})})};return d}();d.DefaultLoadingContext=t;var a={image:{responseType:"image"},binary:{responseType:"array-buffer"},json:void 0}})},"esri/views/3d/glTF/esriProvidedModelParameters":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.treeParamsTable={Alder_Buckthorn:{center:[0,0,2.5],radius:[2,2,3.5]},American_Chestnut:{center:[0,0,12],radius:[10,10,10]},American_Sycamore:{center:[0,0,16],radius:[6.3,6.3,11.5]},Apricot:{center:[0,
0,5],radius:[4.5,4.5,4]},Australian_Pine:{center:[0,0,8],radius:[3,3,11.5]},Baldcypress:{center:[0,0,11.5],radius:[4.2,4.2,16.5]},Balsam_Fir:{center:[0,0,2.9],radius:[3,3,9.7]},Basswood:{center:[0,0,19],radius:[9,9,11]},Bay_Laurel:{center:[0,0,1.4],radius:[.6,.6,2.7]},Black_Locust:{center:[0,0,15],radius:[9.5,9.5,9.5]},Blue_Gum_Eucalyptus:{center:[0,0,12],radius:[5,5,10]},Boxwood:{center:[0,0,.5],radius:[.3,.3,.5]},California_Bay:{center:[0,0,16],radius:[9,9,9.6]},California_Incense_Cedar:{center:[0,
0,6.6],radius:[3.8,3.8,14]},California_Redwood:{center:[0,0,55],radius:[6.5,6.5,19]},California_Walnut:{center:[0,0,5.3],radius:[5,5,4.5]},Common_Hawthorn:{center:[0,0,2.8],radius:[1.9,1.9,2.8]},Common_Whitebeam:{center:[0,0,4.5],radius:[2.5,2.5,3.5]},Conker_Tree:{center:[0,0,10],radius:[6,6,10]},Desert_Willow:{center:[0,0,3],radius:[2.4,2.4,2.8]},Douglas_Fir:{center:[0,0,40],radius:[4.5,4.5,22]},European_Beech:{center:[0,0,12],radius:[7.5,7.5,11.5]},European_Larch:{center:[0,0,9],radius:[3,3,9]},
Ficus:{center:[0,0,10],radius:[12,12,18.5]},Field_Elm:{center:[0,0,12.5],radius:[10,10,9.5]},Flannelbush:{center:[0,0,0],radius:[1.3,1.3,1.7]},Flowering_Dogwood:{center:[0,0,2.5],radius:[2.4,2.4,3]},Generic_Unknown:{center:[0,0,11.5],radius:[5,5,6.5]},Giant_Sequoia:{center:[0,0,35.5],radius:[11,11,26]},Japanese_Angelica_Tree:{center:[0,0,3.8],radius:[2.8,2.8,2]},Leyland_Cypress:{center:[0,0,2.8],radius:[1,1,4]},Lodgepole_Pine:{center:[0,0,23.25],radius:[4.7,4.7,19]},Mediterranean_Buckthorn:{center:[0,
0,1.5],radius:[1.2,1.2,2.5]},Mountain_Mahogany:{center:[0,0,2],radius:[1.3,1.3,1.5]},Northern_Red_Oak:{center:[0,0,11.5],radius:[7.2,7.2,9]},Norway_Maple:{center:[0,0,12.2],radius:[6,6,8.2]},Norway_Spruce:{center:[0,0,5],radius:[6.5,6.5,20]},Oval_Leaved_Privet:{center:[0,0,0],radius:[.45,.45,2.95]},Palo_Verde:{center:[0,0,4.25],radius:[4,4,2.75]},Paper_Birch:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Alder:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Hickory:{center:[0,0,9],radius:[4.5,4.5,7.5]},
Rhododendron_Azaleas:{center:[0,0,.55],radius:[.4,.4,.35]},Rose:{center:[0,0,.55],radius:[.45,.45,.55]},Ruffle_Palm:{center:[0,0,6.4],radius:[3,3,3]},Sassafras:{center:[0,0,8],radius:[3,3,7]},Scots_Pine:{center:[0,0,18],radius:[3,3,9]},Shadbush:{center:[0,0,1.5],radius:[1.5,1.5,1.5]},Southern_Magnolia:{center:[0,0,10.5],radius:[5.5,5.5,8]},Spanish_Broom:{center:[0,0,1.5],radius:[2.5,2.5,1.5]},Strawberry_Tree:{center:[0,0,4],radius:[2.8,2.8,3.3]},Sugar_Maple:{center:[0,0,8],radius:[4.5,4.5,7]},Sweetgum:{center:[0,
0,8],radius:[4,4,6.5]},Umbrella_Acacia:{center:[0,0,10.8],radius:[15,15,6.8]},Western_Juniper:{center:[0,0,3.2],radius:[2.5,2.5,7]},White_Ash:{center:[0,0,14.5],radius:[9.5,9.5,11]},White_Oak:{center:[0,0,15],radius:[14,14,14]},White_Poplar:{center:[0,0,10],radius:[4.3,4.3,8.2]},White_Willow:{center:[0,0,12],radius:[8.9,8.9,9]},Witch_Hazel:{center:[0,0,1.5],radius:[1.5,1.5,2]}};d.lodThresholdLUT={Alder_Buckthorn:{thresholds:[2,65.698,384.294],vertexCounts:[18,2034,8220]},Amazon_Sword_Plant:{thresholds:[2,
22.848,88.819,200.491],vertexCounts:[18,246,888,3246]},American_Chestnut:{thresholds:[2,27.57,59.244,360.286],vertexCounts:[18,444,1782,10332]},American_Sycamore:{thresholds:[2,60.765,228.586],vertexCounts:[18,1740,8562]},Apricot:{thresholds:[2,33.695,132.332],vertexCounts:[18,1776,10626]},Australian_Pine:{thresholds:[2,131.057],vertexCounts:[18,8094]},Baldcypress:{thresholds:[2,31.791,212.226],vertexCounts:[18,1638,10164]},Balsam_Fir:{thresholds:[2,64.674],vertexCounts:[18,10266]},Bamboo:{thresholds:[2,
22.347,90.113,213.818],vertexCounts:[18,216,978,7740]},Banana_Tree:{thresholds:[2,28.096,88.837,345.976],vertexCounts:[18,372,1986,10743]},Basswood:{thresholds:[2,59.387,199.555],vertexCounts:[18,1662,7998]},Bay_Laurel:{thresholds:[2,28.653,204.352],vertexCounts:[18,1728,10938]},Black_Locust:{thresholds:[2,28.546,88.164,229.447],vertexCounts:[18,384,1638,9768]},Blue_Gum_Eucalyptus:{thresholds:[2,56.98,201.358],vertexCounts:[18,1530,9762]},Boxwood:{thresholds:[2,28.768,62.215,191.034],vertexCounts:[18,
390,1824,9876]},Cabbage_Palm_Fern:{thresholds:[2,26.932,215.221],vertexCounts:[18,150,1314]},California_Bay:{thresholds:[2,30.627,204.223],vertexCounts:[18,1878,9054]},California_Incense_Cedar:{thresholds:[2,30.533,197.262],vertexCounts:[18,1644,11214]},California_Palm:{thresholds:[2,30.538,210.616],vertexCounts:[18,612,5760]},California_Redwood:{thresholds:[2,110.805],vertexCounts:[18,10260]},California_Walnut:{thresholds:[2,26.702,64.525,199.228],vertexCounts:[18,336,1962,10992]},Coconut_Palm:{thresholds:[2,
21.77,63.23,199.556],vertexCounts:[18,402,1884,9240]},Common_Hawthorn:{thresholds:[2,45.588,205.35],vertexCounts:[18,300,9492]},Common_Whitebeam:{thresholds:[2,56.42,186.382],vertexCounts:[18,2142,10524]},Conker_Tree:{thresholds:[2,25.977,58.524,195.139],vertexCounts:[18,318,1614,8886]},Date_Palm:{thresholds:[2,31.107,67.609,186.723],vertexCounts:[18,456,2154,9054]},Desert_Willow:{thresholds:[2,29.425,59.815,203.238],vertexCounts:[18,408,1686,9720]},Douglas_Fir:{thresholds:[2,69.576],vertexCounts:[18,
8544]},European_Beech:{thresholds:[2,29.854,201.521],vertexCounts:[18,420,7572]},European_Larch:{thresholds:[2,65.346],vertexCounts:[18,10314]},Ficus:{thresholds:[2,28.768,58.849,210.62],vertexCounts:[18,390,1632,7728]},Field_Elm:{thresholds:[2,34.435,192.436],vertexCounts:[18,1746,10950]},Flannelbush:{thresholds:[2,27.408,55.566,196.843],vertexCounts:[18,354,1455,8706]},Flowering_Dogwood:{thresholds:[2,28.768,194.687],vertexCounts:[18,390,8664]},Generic_Dead_Tree:{thresholds:[2,67.891],vertexCounts:[18,
2172]},Generic_Stump:{thresholds:[2,19.544,57.757,171.552],vertexCounts:[18,180,1572,2634]},Generic_Unknown:{thresholds:[2,32.379,221.987],vertexCounts:[18,1572,9006]},Giant_Sequoia:{thresholds:[2,30.664,204.84],vertexCounts:[18,2160,8232]},Hedgehog_Agave:{thresholds:[2,28.546,96.141,228.435],vertexCounts:[18,384,1980,11094]},Japanese_Angelica_Tree:{thresholds:[2,25.482,61.287,202.909],vertexCounts:[18,306,1770,7806]},Lacy_Tree_Philodendron:{thresholds:[2,28.768,62.974,231.634],vertexCounts:[18,390,
1752,10227]},Leyland_Cypress:{thresholds:[2,66.246],vertexCounts:[18,10182]},Lily_Of_The_Valley:{thresholds:[2,28.322,55.738,198.232],vertexCounts:[18,378,1464,4152]},Scots_Pine:{thresholds:[2,60.554],vertexCounts:[18,7524]},Mediterranean_Buckthorn:{thresholds:[2,31.82,211.856],vertexCounts:[18,2196,9030]},Mexican_Palmetto:{thresholds:[2,29.425,68.358,212.659],vertexCounts:[18,408,2202,10194]},Mountain_Mahogany:{thresholds:[2,31.199,198.614],vertexCounts:[18,1614,8094]},White_Oak:{thresholds:[2,15.204,
33.801,129.392],vertexCounts:[18,372,1674,9222]},Sugar_Maple:{thresholds:[2,28.322,59.495,216.901],vertexCounts:[18,378,1668,9462]},Norway_Spruce:{thresholds:[2,63.101],vertexCounts:[18,9630]},Orchid:{thresholds:[2,30.383,63.93,198.664],vertexCounts:[18,435,1926,8346]},Other:{thresholds:[2,30.504,194.487],vertexCounts:[18,1572,9006]},Oval_Leaved_Privet:{thresholds:[2,59.468],vertexCounts:[18,9162]},Palm_Lily:{thresholds:[2,57.977,200.406],vertexCounts:[18,1584,8112]},Palo_Verde:{thresholds:[2,65.31,
198.124],vertexCounts:[18,2010,7668]},Paper_Birch:{thresholds:[2,117.074],vertexCounts:[18,10578]},Parlour_Palm:{thresholds:[2,30.695,60.974,194.832],vertexCounts:[18,444,1752,8388]},Prickly_Pear_Cactus:{thresholds:[2,28.657,66.946,214.478],vertexCounts:[18,387,2112,11028]},Red_Alder:{thresholds:[2,30.518,192.513],vertexCounts:[18,1770,8274]},Red_Hickory:{thresholds:[2,31.604,192.085],vertexCounts:[18,1680,7908]},Rhododendron_Azaleas:{thresholds:[2,47.068,192.681],vertexCounts:[18,1044,8160]},Rose:{thresholds:[2,
66.085,212.061],vertexCounts:[18,2058,10968]},Ruffle_Palm:{thresholds:[2,64.994],vertexCounts:[18,9534]},Saguaro_Cactus:{thresholds:[2,34.779,56.703,197.566],vertexCounts:[18,570,1050,1992]},Sassafras:{thresholds:[2,110.697],vertexCounts:[18,10944]},Sea_Islands_Yucca:{thresholds:[2,61.287,219.899],vertexCounts:[18,1770,10176]},Shadbush:{thresholds:[2,26.702,64.03,201.856],vertexCounts:[18,336,1932,9030]},Snake_Plant:{thresholds:[2,23.803,68.265,193.203],vertexCounts:[18,267,2196,5280]},Southern_Magnolia:{thresholds:[2,
63.431,212.165],vertexCounts:[18,1896,8472]},Spanish_Broom:{thresholds:[2,29.854,192.889],vertexCounts:[18,420,7896]},Strawberry_Tree:{thresholds:[2,16.772,32.081,186.987],vertexCounts:[18,300,1560,8148]},Sunflower:{thresholds:[2,28.768,66.373,194.987],vertexCounts:[18,390,2076,7902]},Sweetgum:{thresholds:[2,31.436,201.223],vertexCounts:[18,1848,7674]},Umbrella_Acacia:{thresholds:[2,62.137],vertexCounts:[18,8880]},Western_Juniper:{thresholds:[2,62.683],vertexCounts:[18,9120]},White_Ash:{thresholds:[2,
33.326,192.138],vertexCounts:[18,2070,10542]},White_Poplar:{thresholds:[2,30.615,196.71],vertexCounts:[18,1530,9888]},White_Willow:{thresholds:[2,62.983],vertexCounts:[18,10422]},Witch_Hazel:{thresholds:[2,26.463,66.277,200.916],vertexCounts:[18,330,2070,10386]},ATM:{thresholds:[2,46.933],vertexCounts:[150,1038]},Bus_Stop_1:{thresholds:[2,42.67],vertexCounts:[150,858]},Bus_Stop_2:{thresholds:[2,46.112],vertexCounts:[138,1002]},Dumpster:{thresholds:[2,48.006],vertexCounts:[138,1086]},Newspaper_Vending_Machine:{thresholds:[2,
57.203],vertexCounts:[144,1542]},Overhanging_Sidewalk_Light_Off:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Sidewalk_Light_On:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Street_And_Sidewalk_Light_Off:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_And_Sidewalk_Light_On:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_Light_Off:{thresholds:[2,34.225],vertexCounts:[144,552]},Overhanging_Street_Light_On:{thresholds:[2,34.225],vertexCounts:[144,
552]},Park_Bench_1:{thresholds:[2,23.669],vertexCounts:[96,264]},Park_Bench_2:{thresholds:[2,44.71],vertexCounts:[144,942]},Park_Bench_3:{thresholds:[2,41.917],vertexCounts:[120,828]},Park_Bench_4:{thresholds:[2,69.923],vertexCounts:[144,2304]},Payphone:{thresholds:[2,58.524],vertexCounts:[156,1614]},Picnic_Table:{thresholds:[2,35.504],vertexCounts:[90,594]},Planter_Circular:{thresholds:[2,99.368],vertexCounts:[153,4653]},Planter_Square:{thresholds:[2,65.212],vertexCounts:[150,2004]},Planter_Tapered:{thresholds:[2,
89.669],vertexCounts:[141,3789]},Rock_1:{thresholds:[2,28.768,50.463],vertexCounts:[132,390,1200]},Rock_2:{thresholds:[2,43.556,73.127],vertexCounts:[150,894,2520]},Rock_3:{thresholds:[2,37.931,70.286],vertexCounts:[144,678,2328]},Rock_4:{thresholds:[2,41.613,70.738],vertexCounts:[150,816,2358]},Street_Light_Off:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Street_Light_On:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Traffic_Barrier_2:{thresholds:[2,42.819],vertexCounts:[132,
864]},Trash_Bin_1:{thresholds:[2,50.019],vertexCounts:[132,1179]},Trash_Bin_2:{thresholds:[2,36.038,63.028],vertexCounts:[108,612,1872]},Trash_Bin_3:{thresholds:[2,42.371,64.03],vertexCounts:[102,846,1932]},Trash_Can_1:{thresholds:[2,58.524,98.628],vertexCounts:[150,1614,4584]},Trash_Can_2:{thresholds:[2,53.166],vertexCounts:[84,1332]},US_Mailbox:{thresholds:[2,48.402],vertexCounts:[156,1104]},Ambulance:{thresholds:[2,67.121,343.733],vertexCounts:[294,3285,13758]},Audi_A6:{thresholds:[2,63.823,484.156],
vertexCounts:[300,4311,14280]},Backhoe:{thresholds:[2,60.173,391.986],vertexCounts:[453,5895,14679]},BMW_3Series:{thresholds:[2,68.886,417.563],vertexCounts:[294,4188,14727]},Bobcat:{thresholds:[2,61.105,269.127],vertexCounts:[438,4476,14952]},Bus:{thresholds:[2,63.803,402.682],vertexCounts:[300,4398,14988]},Crane:{thresholds:[2,65.969,386.67],vertexCounts:[438,4497,14487]},Dumptruck:{thresholds:[2,66.91,354.365],vertexCounts:[456,6294,14052]},Eurocopter_AS365:{thresholds:[2,227.817],vertexCounts:[432,
14733]},Eurocopter_AS365_Flying:{thresholds:[2,96.244,380.211],vertexCounts:[306,4365,10575]},Eurocopter_H125:{thresholds:[2,96.567,378.995],vertexCounts:[438,4440,14763]},Eurocopter_H125_Flying:{thresholds:[2,94.002,366.378],vertexCounts:[294,4164,13569]},Firetruck:{thresholds:[2,65.762,383.645],vertexCounts:[276,4482,14901]},Ford_Edge:{thresholds:[2,68.763,419.635],vertexCounts:[294,4368,14733]},Ford_Expedition:{thresholds:[2,62.994,388.251],vertexCounts:[276,4410,14868]},Ford_F150:{thresholds:[2,
60.495,394.682],vertexCounts:[300,4950,14988]},Ford_Fiesta:{thresholds:[2,64.994,355.46],vertexCounts:[282,4185,14223]},Ford_Focus_Hatchback:{thresholds:[2,62.072,387.932],vertexCounts:[300,4470,14925]},Ford_Fusion:{thresholds:[2,64.485,370.289],vertexCounts:[294,4500,14955]},Ford_Mustang:{thresholds:[2,64.812,351.721],vertexCounts:[288,4197,14574]},Ford_Taurus:{thresholds:[2,67.461,379.324],vertexCounts:[282,4404,15042]},Ford_Transit_Commercial_Van:{thresholds:[2,88.6,384.491],vertexCounts:[276,
4443,14721]},Ford_Transit_Connect:{thresholds:[2,67.006,336.74],vertexCounts:[258,4344,14328]},Mercedes_SClass:{thresholds:[2,66.188,349.491],vertexCounts:[300,4377,14721]},Motorboat:{thresholds:[2,67.436,364.325],vertexCounts:[315,4491,14958]},Motorcycle:{thresholds:[2,35.435,357.215],vertexCounts:[294,4806,14865]},Police_Car:{thresholds:[2,68.116,350.794],vertexCounts:[294,3987,14580]},Porsche_Boxter:{thresholds:[2,67.717,361.95],vertexCounts:[312,6225,14676]},Porsche_Carrera:{thresholds:[2,66.588,
392.685],vertexCounts:[306,4473,14571]},Sailboat:{thresholds:[2,97.329,383.075],vertexCounts:[294,4464,14937]},Sailboat_Sails_Up:{thresholds:[2,97.46,360.432],vertexCounts:[300,4476,14967]},Taxi:{thresholds:[2,64.415,381.491],vertexCounts:[300,4305,14721]},Taxi_Van:{thresholds:[2,64.614,364.475],vertexCounts:[288,4341,11949]},Tesla_P7:{thresholds:[2,58.155],vertexCounts:[300,16062]},Tower_Crane:{thresholds:[2,106.34,419.821],vertexCounts:[432,4488,14832]},Toyota_Prius:{thresholds:[2,66.448,357.251],
vertexCounts:[288,4266,14370]},Tram:{thresholds:[2,65.43,369.937],vertexCounts:[420,5610,19605]},Volkswagen_Jetta_Wagon:{thresholds:[2,65.925,354.416],vertexCounts:[294,4443,14466]},Traffic_Light_1:{thresholds:[2,75.315],vertexCounts:[135,2673]},Traffic_Light_3:{thresholds:[2,49.12],vertexCounts:[132,1137]},Traffic_Light_4:{thresholds:[2,70.962,115.735],vertexCounts:[96,2373,6312]}}})},"esri/views/3d/glTF/loader":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){function h(a,b){return q(this,void 0,void 0,function(){function c(d,f){return q(this,void 0,void 0,function(){var h,k,m,l,p,n,r,u,x;return g(this,function(g){switch(g.label){case 0:h=e.nodes[d];k=a.getNodeTransform(d);v.warnUnsupportedIf(null!=h.weights,"Morph targets are not supported.");if(null==h.mesh)return[3,4];m=e.meshes[h.mesh];l=0;p=m.primitives;g.label=1;case 1:if(!(l<p.length))return[3,4];n=p[l];return[4,b(n,k,f,m.name)];case 2:g.sent(),g.label=3;case 3:return l++,
[3,1];case 4:r=0,u=h.children||[],g.label=5;case 5:if(!(r<u.length))return[3,8];x=u[r];return[4,c(x,f)];case 6:g.sent(),g.label=7;case 7:return r++,[3,5];case 8:return[2]}})})}var e,d,h,k,m,l,p,n,r,u;return g(this,function(b){switch(b.label){case 0:e=a.json,d=e.scenes[e.scene||0],h=d.nodes,k=1<h.length,m=0,l=h,b.label=1;case 1:if(!(m<l.length))return[3,4];p=l[m];n=e.nodes[p];r=[c(p,0)];n.extensions&&n.extensions.MSFT_lod&&Array.isArray(n.extensions.MSFT_lod.ids)&&!k&&(u=n.extensions.MSFT_lod.ids,
r.push.apply(r,u.map(function(a,b){return c(a,b+1)})));return[4,f.all(r)];case 2:b.sent(),b.label=3;case 3:return m++,[3,1];case 4:return[2]}})})}function p(a,b,e){var d=function(b){var d=e+"_tex_"+(b&&b.id)+(b&&b.name?"_"+b.name:"");if(b&&!a.textures.has(d)){var f=c.makeTextureSource(b.data,{wrap:{s:n(b.wrapS),t:n(b.wrapT)},mipmap:r.some(function(a){return a===b.minFilter}),noUnpackFlip:!0});a.textures.set(d,f)}return d},f=e+"_mat_"+b.id+"_"+b.name;a.materials.has(f)||(b=c.makeMaterialParameters({color:[b.color[0],
b.color[1],b.color[2]],opacity:b.color[3],alphaMode:b.alphaMode,alphaCutoff:b.alphaCutoff,doubleSided:b.doubleSided,colorMixMode:b.ESRI_externalColorMixMode,textureColor:b.colorTexture?d(b.colorTexture):void 0,textureNormal:b.normalTexture?d(b.normalTexture):void 0}),a.materials.set(f,b));return f}function n(a){if(33071===a||33648===a||10497===a)return a;v.error("Unexpected TextureSampler WrapMode: "+a)}Object.defineProperty(d,"__esModule",{value:!0});var u=0;d.load=function(c,d,f){void 0===f&&(f=
{});return q(this,void 0,void 0,function(){var f,k,m,l,n=this;return g(this,function(r){switch(r.label){case 0:return[4,a.Resource.load(c,v,d)];case 1:return f=r.sent(),k="gltf_"+u++,m={lods:[],materials:new Map,textures:new Map},l=!(!f.json.asset.extras||"symbolResource"!==f.json.asset.extras.ESRI_type),[4,h(f,function(a,c,d,h){return q(n,void 0,void 0,function(){var l,n,r,u,x,q,w,A,C,B;return g(this,function(g){switch(g.label){case 0:l=a.mode||4;a:switch(l){case 4:case 5:case 6:n=l;break a;default:n=
null}return b.isNone(n)?(v.warnUnsupported("Unsupported primitive mode ("+y[l]+"). Skipping primitive."),[2]):[4,f.getMaterial(a)];case 1:return r=g.sent(),x={transform:e.mat4f64.clone(c)},q={},[4,f.getPositionData(a)];case 2:return x.attributes=(q.position=g.sent(),q.normal=null,q.texCoord0=null,q.color=null,q.tangent=null,q),[4,f.getIndexData(a)];case 3:u=(x.indices=g.sent(),x.primitiveType=n,x.material=p(m,r,k),x);if(!f.hasNormals(a))return[3,5];w=u.attributes;return[4,f.getNormalData(a)];case 4:w.normal=
g.sent(),g.label=5;case 5:if(!f.hasTangents(a))return[3,7];A=u.attributes;return[4,f.getTangentData(a)];case 6:A.tangent=g.sent(),g.label=7;case 7:if(!f.hasTextureCoordinates(a))return[3,9];C=u.attributes;return[4,f.getTextureCoordinates(a)];case 8:C.texCoord0=g.sent(),g.label=9;case 9:if(!f.hasVertexColors(a))return[3,11];B=u.attributes;return[4,f.getVertexColors(a)];case 10:B.color=g.sent(),g.label=11;case 11:return m.lods[d]=m.lods[d]||{parts:[],name:h,lodThreshold:null},m.lods[d].parts.push(u),
[2]}})})})];case 2:return r.sent(),[2,{model:m,meta:{isEsriSymbolResource:l,uri:f.uri},customMeta:{}}]}})})};var v=new k.DefaultErrorContext,r=[9987,9985],y="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ")})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["require","exports","../../../core/Logger"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});var g=q.getLogger("esri.views.3d.glTF");t=function(){function d(){}d.prototype.error=function(b){throw Error("[glTF loader]"+
b);};d.prototype.errorUnsupported=function(b){this.error("[Unsupported Feature] "+b)};d.prototype.errorUnsupportedIf=function(b,d){b&&this.error("[Unsupported Feature] "+d)};d.prototype.assert=function(b,d){b||this.error(d)};d.prototype.warn=function(b){g.warn(b)};d.prototype.warnUnsupported=function(b){this.warn("[Unsupported Feature] "+b)};d.prototype.warnUnsupportedIf=function(b,d){b&&this.warnUnsupported(d)};return d}();d.DefaultErrorContext=t})},"esri/views/3d/glTF/LoaderResult":function(){define(["require",
"exports","../../../core/tsSupport/assignHelper"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.makeMaterialParameters=function(d){void 0===d&&(d={});return q({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,colorMixMode:"multiply"},d)};d.makeTextureSource=function(d,l){void 0===l&&(l={});return{data:d,parameters:q({wrap:q({s:10497,t:10497},l.wrap),noUnpackFlip:!0,
mipmap:!1},l)}}})},"esri/views/3d/glTF/internal/Resource":function(){define("require exports ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ./BinaryStreamReader ./fillDefaults ./pathUtils ../../support/buffer/BufferView ../../support/buffer/utils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w){function m(a){switch(a.componentType){case 5120:return new y.BufferViewVec2i8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5121:return new y.BufferViewVec2u8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5122:return new y.BufferViewVec2i16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5123:return new y.BufferViewVec2u16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+
a.byteStride*a.entryCount);case 5125:return new y.BufferViewVec2u32(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5126:return new y.BufferViewVec2f(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);default:b.neverReached(a.componentType)}}function x(a){return q(this,void 0,void 0,function(){return g(this,function(b){return[2,e.create(function(b,c){var e=new Blob([a]),d=new FileReader;d.onload=function(){b(JSON.parse(d.result))};d.onerror=function(a){c(a)};
d.readAsText(e)})]})})}function A(a,b){return q(this,void 0,void 0,function(){return g(this,function(c){return[2,e.create(function(c,e){var d=new Blob([a],{type:b}),f=URL.createObjectURL(d),g=new Image;g.addEventListener("load",function(){URL.revokeObjectURL(f);c(g)});g.addEventListener("error",function(a){URL.revokeObjectURL(f);e(a)});g.src=f})]})})}Object.defineProperty(d,"__esModule",{value:!0});var C;t=function(){function b(a,b,c,e,d){this.context=a;this.errorContext=b;this.uri=c;this.json=e;
this.glbBuffer=d;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=r.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();b.errorUnsupportedIf(null==e.scenes,"Scenes must be defined.");b.errorUnsupportedIf(null==e.meshes,"Meshes must be defined");b.errorUnsupportedIf(null==e.nodes,"Nodes must be defined.");this.computeNodeParents()}b.load=function(a,c,e){return q(this,
void 0,void 0,function(){var d,h,k,m,l,p;return g(this,function(g){switch(g.label){case 0:return f.endsWith(e,".gltf")?[4,a.loadJson(e)]:[3,2];case 1:return d=g.sent(),[2,new b(a,c,e,d)];case 2:return f.endsWith(e,".glb")?[4,a.loadBinary(e)]:[3,5];case 3:return h=g.sent(),[4,b.parseGLB(c,h)];case 4:return k=g.sent(),[2,new b(a,c,e,k.json,k.binaryData)];case 5:return[4,a.loadBinary(e)];case 6:return m=g.sent(),l=new u.BinaryStreamReader(m),4<=l.remainingBytes()&&1179937895===l.readUint32()?[4,b.parseGLB(c,
m)]:[3,8];case 7:return k=g.sent(),[2,new b(a,c,e,k.json,k.binaryData)];case 8:return[4,a.loadJson(e)];case 9:return p=g.sent(),[2,new b(a,c,e,p)]}})})};b.parseGLB=function(a,b){return q(this,void 0,void 0,function(){var c,e,d,f,h,k,m,l,p;return g(this,function(g){switch(g.label){case 0:c=new u.BinaryStreamReader(b),a.assert(12<=c.remainingBytes(),"GLB binary data is insufficiently large."),e=c.readUint32(),d=c.readUint32(),f=c.readUint32(),a.assert(1179937895===e,"Magic first 4 bytes do not fit to expected GLB value."),
a.assert(b.byteLength>=f,"GLB binary data is smalller than header specifies."),a.errorUnsupportedIf(2!==d,"Only GLB container version 2 is supported."),h=0,g.label=1;case 1:if(!(8<=c.remainingBytes()))return[3,5];l=c.readUint32();p=c.readUint32();if(0!==h)return[3,3];a.assert(1313821514===p,"First GLB chunck must be JSON.");a.assert(0<=l,"No JSON data found.");return[4,x(c.readUint8Array(l))];case 2:return k=g.sent(),[3,4];case 3:1===h?(a.errorUnsupportedIf(5130562!==p,"Second GLB chunck expected to be BIN."),
m=c.readUint8Array(l)):a.warnUnsupported("More than 2 GLB chunks detected. Skipping."),g.label=4;case 4:return h+=1,[3,1];case 5:return k||a.error("No GLB JSON chunk detected."),[2,{json:k,binaryData:m}]}})})};b.prototype.getBuffer=function(a){return q(this,void 0,void 0,function(){var b,c,e,d;return g(this,function(f){switch(f.label){case 0:return b=this.json.buffers[a],c=this.errorContext,null==b.uri?(c.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):(e=this.bufferCache.get(a))?
[3,2]:[4,this.context.loadBinary(this.resolveUri(b.uri))];case 1:d=f.sent(),e=new Uint8Array(d),this.bufferCache.set(a,e),c.assert(e.byteLength===b.byteLength,"Buffer byte lengths should match."),f.label=2;case 2:return[2,e]}})})};b.prototype.getAccessor=function(a){return q(this,void 0,void 0,function(){var b,c,e,d,f,h,k,m;return g(this,function(g){switch(g.label){case 0:return b=this.json.accessors[a],c=this.errorContext,c.errorUnsupportedIf(null==b.bufferView,"An accessor bufferView is required."),
c.errorUnsupportedIf(b.type in["MAT2","MAT3","MAT4"],"AttributeType "+b.type+" is not supported"),e=this.json.bufferViews[b.bufferView],[4,this.getBuffer(e.buffer)];case 1:return d=g.sent(),f=G[b.type],h=L[b.componentType],k=f*h,m=e.byteStride||k,[2,{raw:d.buffer,byteStride:m,byteOffset:d.byteOffset+(e.byteOffset||0)+(b.byteOffset||0),entryCount:b.count,isDenselyPacked:m===k,componentCount:f,componentByteSize:h,componentType:b.componentType,min:b.min,max:b.max,normalized:!!b.normalized}]}})})};b.prototype.getIndexData=
function(a){return q(this,void 0,void 0,function(){var b;return g(this,function(c){switch(c.label){case 0:return null==a.indices?[2,null]:[4,this.getAccessor(a.indices)];case 1:b=c.sent();if(b.isDenselyPacked)switch(b.componentType){case 5121:return[2,new Uint8Array(b.raw,b.byteOffset,b.entryCount)];case 5123:return[2,new Uint16Array(b.raw,b.byteOffset,b.entryCount)];case 5125:return[2,new Uint32Array(b.raw,b.byteOffset,b.entryCount)]}else switch(b.componentType){case 5121:return[2,w.scalar.makeDense(this.wrapAccessor(y.BufferViewUint8,
b))];case 5123:return[2,w.scalar.makeDense(this.wrapAccessor(y.BufferViewUint16,b))];case 5125:return[2,w.scalar.makeDense(this.wrapAccessor(y.BufferViewUint32,b))]}return[2]}})})};b.prototype.getPositionData=function(a){return q(this,void 0,void 0,function(){var b,c;return g(this,function(e){switch(e.label){case 0:return b=this.errorContext,b.errorUnsupportedIf(null==a.attributes.POSITION,"POSITION vertex data is required."),[4,this.getAccessor(a.attributes.POSITION)];case 1:return c=e.sent(),b.errorUnsupportedIf(5126!==
c.componentType,"[POSITION attribute] Expected type FLOAT, found "+F[c.componentType]),b.errorUnsupportedIf(3!==c.componentCount,"POSITION attribute must have 3 components."),[2,this.wrapAccessor(y.BufferViewVec3f,c)]}})})};b.prototype.getNormalData=function(a){return q(this,void 0,void 0,function(){var b,c;return g(this,function(e){switch(e.label){case 0:return b=this.errorContext,b.errorUnsupportedIf(null==a.attributes.NORMAL,"NORMAL vertex data is required."),[4,this.getAccessor(a.attributes.NORMAL)];
case 1:return c=e.sent(),b.errorUnsupportedIf(5126!==c.componentType,"[NORMAL attribute] Expected type FLOAT, found "+F[c.componentType]),b.errorUnsupportedIf(3!==c.componentCount,"NORMAL attribute must have 3 components."),[2,this.wrapAccessor(y.BufferViewVec3f,c)]}})})};b.prototype.getTangentData=function(a){return q(this,void 0,void 0,function(){var b,c;return g(this,function(e){switch(e.label){case 0:return b=this.errorContext,b.errorUnsupportedIf(null==a.attributes.TANGENT,"TANGENT vertex data is required."),
[4,this.getAccessor(a.attributes.TANGENT)];case 1:return c=e.sent(),b.errorUnsupportedIf(5126!==c.componentType,"[TANGENT attribute] Expected type FLOAT, found "+F[c.componentType]),b.errorUnsupportedIf(4!==c.componentCount,"NORMAL attribute must have 4 components."),[2,new y.BufferViewVec4f(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount)]}})})};b.prototype.getTextureCoordinates=function(a){return q(this,void 0,void 0,function(){var b,c;return g(this,function(e){switch(e.label){case 0:return b=
this.errorContext,b.errorUnsupportedIf(null==a.attributes.TEXCOORD_0,"TEXCOORD_0 vertex data is required."),[4,this.getAccessor(a.attributes.TEXCOORD_0)];case 1:c=e.sent();b.errorUnsupportedIf(2!==c.componentCount,"TEXCOORD_0 attribute must have 2 components.");if(5126===c.componentType)return[2,this.wrapAccessor(y.BufferViewVec2f,c)];b.errorUnsupportedIf(!c.normalized,"[TEXCOORD_0 attribute] Integer ComponentTypes are only supported for a normalized accessor.");return[2,m(c)]}})})};b.prototype.hasNormals=
function(a){return!!a.attributes.NORMAL};b.prototype.hasVertexColors=function(a){return!!a.attributes.COLOR_0};b.prototype.hasTextureCoordinates=function(a){return!!a.attributes.TEXCOORD_0};b.prototype.hasTangents=function(a){return!!a.attributes.TANGENT};b.prototype.getVertexColors=function(a){return q(this,void 0,void 0,function(){var b,c;return g(this,function(e){switch(e.label){case 0:return b=this.errorContext,b.errorUnsupportedIf(null==a.attributes.COLOR_0,"COLOR_0 vertex data is required."),
[4,this.getAccessor(a.attributes.COLOR_0)];case 1:c=e.sent();b.errorUnsupportedIf(4!==c.componentCount&&3!==c.componentCount,"COLOR_0 attribute must have 3 or 4 components.");if(4===c.componentCount){if(5126===c.componentType)return[2,this.wrapAccessor(y.BufferViewVec4f,c)];if(5121===c.componentType)return[2,this.wrapAccessor(y.BufferViewVec4u8,c)];if(5123===c.componentType)return[2,this.wrapAccessor(y.BufferViewVec4u16,c)]}else if(3===c.componentCount){if(5126===c.componentType)return[2,this.wrapAccessor(y.BufferViewVec3f,
c)];if(5121===c.componentType)return[2,this.wrapAccessor(y.BufferViewVec3u8,c)];if(5123===c.componentType)return[2,this.wrapAccessor(y.BufferViewVec3u16,c)]}b.errorUnsupported("[COLOR_0 attribute] Unsupported component type: "+F[c.componentType]);return[2]}})})};b.prototype.getMaterial=function(a){return q(this,void 0,void 0,function(){var b,c,e,d,f,h,k,m;return g(this,function(g){switch(g.label){case 0:b=this.errorContext;if(c=this.materialCache.get(a.material))return[3,6];e=null!=a.material?v.material(this.json.materials[a.material]):
v.material();d=e.pbrMetallicRoughness;f=this.hasVertexColors(a);h=void 0;if(!d.baseColorTexture)return[3,2];b.errorUnsupportedIf(0!==(d.baseColorTexture.texCoord||0),"Only TEXCOORD_0 is supported");return[4,this.getTexture(d.baseColorTexture.index)];case 1:h=g.sent(),g.label=2;case 2:k=void 0;if(!e.normalTexture)return[3,5];if(0===(d.baseColorTexture.texCoord||0))return[3,3];b.warnUnsupported("Only TEXCOORD_0 is supported for normal map");return[3,5];case 3:return[4,this.getTexture(e.normalTexture.index)];
case 4:k=g.sent(),g.label=5;case 5:m=null!=a.material?a.material:-1,c={alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,color:d.baseColorFactor,doubleSided:!!e.doubleSided,colorTexture:h,normalTexture:k,name:e.name,id:m,vertexColors:f,ESRI_externalColorMixMode:e.extras.ESRI_externalColorMixMode},g.label=6;case 6:return[2,c]}})})};b.prototype.getTexture=function(a){return q(this,void 0,void 0,function(){var b,c,e,d,f,h,k,m;return g(this,function(g){switch(g.label){case 0:b=this.errorContext;c=this.json.textures[a];
e=v.textureSampler(null!=c.sampler?this.json.samplers[c.sampler]:{});b.errorUnsupportedIf(null==c.source,"source must be defined for a texture");d=this.json.images[c.source];if(f=this.textureCache.get(a))return[3,6];h=void 0;return d.uri?[4,this.context.loadImage(this.resolveUri(d.uri))]:[3,2];case 1:return h=g.sent(),[3,5];case 2:return b.errorUnsupportedIf(null==d.bufferView,"Image bufferView must be defined."),b.errorUnsupportedIf(null==d.mimeType,"Image mimeType must be defined."),k=this.json.bufferViews[d.bufferView],
[4,this.getBuffer(k.buffer)];case 3:return m=g.sent(),b.errorUnsupportedIf(null!=k.byteStride,"byteStride not supported for image buffer"),[4,A(new Uint8Array(m.buffer,m.byteOffset+(k.byteOffset||0),k.byteLength),d.mimeType)];case 4:h=g.sent(),g.label=5;case 5:f={data:h,wrapS:e.wrapS,wrapT:e.wrapT,minFilter:e.minFilter,name:d.name,id:a},this.textureCache.set(a,f),g.label=6;case 6:return[2,f]}})})};b.prototype.getNodeTransform=function(b){if(void 0===b)return E;var c=this.nodeTransformCache.get(b);
if(!c){var c=this.getNodeTransform(this.getNodeParent(b)),e=this.json.nodes[b];if(e.matrix)c=a.mat4.multiply(h.mat4f64.create(),c,e.matrix);else if(e.translation||e.rotation||e.scale)c=h.mat4f64.clone(c),e.translation&&a.mat4.translate(c,c,e.translation),e.rotation&&(I[3]=p.quat.getAxisAngle(I,e.rotation),a.mat4.rotate(c,c,I[3],I)),e.scale&&a.mat4.scale(c,c,e.scale);this.nodeTransformCache.set(b,c)}return c};b.prototype.wrapAccessor=function(a,b){return new a(b.raw,b.byteOffset,b.byteStride,b.byteOffset+
b.byteStride*(b.entryCount-1)+b.componentByteSize*b.componentCount)};b.prototype.resolveUri=function(a){return k.makeAbsolute(a,this.baseUri)};b.prototype.getNodeParent=function(a){return this.nodeParentMap.get(a)};b.prototype.checkVersionSupported=function(){c.Version.parse(this.json.asset.version,"glTF").validate(B)};b.prototype.checkRequiredExtensionsSupported=function(){var a=this.json,b=this.errorContext;a.extensionsRequired&&0!==a.extensionsRequired.length&&b.errorUnsupportedIf(!0,"Extensions: "+
a.extensionsRequired.join(", "))};b.prototype.computeNodeParents=function(){var a=this;this.json.nodes.forEach(function(b,c){b.children&&b.children.forEach(function(b){a.nodeParentMap.set(b,c)})})};return b}();d.Resource=t;var B=new c.Version(2,0,"glTF"),E=a.mat4.fromXRotation(h.mat4f64.create(),Math.PI/2),I=n.quatf64.create(),G={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},L=(C={},C[5120]=1,C[5121]=1,C[5122]=2,C[5123]=2,C[5126]=4,C[5125]=4,C),F={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",
5125:"UNSIGNED_INT",5126:"FLOAT"}})},"esri/core/Version":function(){define(["require","exports","./Error"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(d,b,f){void 0===f&&(f="");this.major=d;this.minor=b;this._context=f}d.prototype.lessThan=function(d,b){return this.major<d||d===this.major&&this.minor<b};d.prototype.since=function(d,b){return!this.lessThan(d,b)};d.prototype.validate=function(d){if(this.major!==d.major)throw new q((this._context&&this._context+
":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:d});};d.prototype.clone=function(){return new d(this.major,this.minor,this._context)};d.parse=function(g,b){void 0===b&&(b="");var f=g.split("."),e=f[0],f=f[1],k=/^\s*\d+\s*$/;if(!e||!e.match||!e.match(k))throw new q((b&&b+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:g});if(!f||!f.match||
!f.match(k))throw new q((b&&b+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:g});g=parseInt(e,10);e=parseInt(f,10);return new d(g,e,b)};return d}();d.Version=t})},"esri/core/libs/gl-matrix-2/quat":function(){define(["require","exports","./math/quat"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.quat=q})},"esri/core/libs/gl-matrix-2/math/quat":function(){define("require exports ../factories/mat3f64 ../factories/quatf64 ../factories/vec3f64 ./common ./vec3 ./vec4".split(" "),
function(t,d,q,g,l,b,f,e){function k(a,b,c){c*=.5;var e=Math.sin(c);a[0]=e*b[0];a[1]=e*b[1];a[2]=e*b[2];a[3]=Math.cos(c);return a}function c(a,b,c){var e=b[0],d=b[1],f=b[2];b=b[3];var g=c[0],h=c[1],k=c[2];c=c[3];a[0]=e*c+b*g+d*k-f*h;a[1]=d*c+b*h+f*g-e*k;a[2]=f*c+b*k+e*h-d*g;a[3]=b*c-e*g-d*h-f*k;return a}function a(a,c,e,d){var f=c[0],g=c[1],h=c[2];c=c[3];var k=e[0],m=e[1],l=e[2];e=e[3];var p,n,r;n=f*k+g*m+h*l+c*e;0>n&&(n=-n,k=-k,m=-m,l=-l,e=-e);1-n>b.EPSILON?(p=Math.acos(n),r=Math.sin(p),n=Math.sin((1-
d)*p)/r,d=Math.sin(d*p)/r):n=1-d;a[0]=n*f+d*k;a[1]=n*g+d*m;a[2]=n*h+d*l;a[3]=n*c+d*e;return a}function h(a,b){var c=b[0]+b[4]+b[8];if(0<c)c=Math.sqrt(c+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var e=0;b[4]>b[0]&&(e=1);b[8]>b[3*e+e]&&(e=2);var d=(e+1)%3,f=(e+2)%3,c=Math.sqrt(b[3*e+e]-b[3*d+d]-b[3*f+f]+1);a[e]=.5*c;c=.5/c;a[3]=(b[3*d+f]-b[3*f+d])*c;a[d]=(b[3*d+e]+b[3*e+d])*c;a[f]=(b[3*f+e]+b[3*e+f])*c}return a}Object.defineProperty(d,"__esModule",{value:!0});
d.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};d.setAxisAngle=k;d.getAxisAngle=function(a,c){var e=2*Math.acos(c[3]),d=Math.sin(e/2);d>b.EPSILON?(a[0]=c[0]/d,a[1]=c[1]/d,a[2]=c[2]/d):(a[0]=1,a[1]=0,a[2]=0);return e};d.multiply=c;d.rotateX=function(a,b,c){c*=.5;var e=b[0],d=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=e*c+b*g;a[1]=d*c+f*g;a[2]=f*c-d*g;a[3]=b*c-e*g;return a};d.rotateY=function(a,b,c){c*=.5;var e=b[0],d=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=
e*c-f*g;a[1]=d*c+b*g;a[2]=f*c+e*g;a[3]=b*c-d*g;return a};d.rotateZ=function(a,b,c){c*=.5;var e=b[0],d=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=e*c+d*g;a[1]=d*c-e*g;a[2]=f*c+b*g;a[3]=b*c-f*g;return a};d.calculateW=function(a,b){var c=b[0],e=b[1];b=b[2];a[0]=c;a[1]=e;a[2]=b;a[3]=Math.sqrt(Math.abs(1-c*c-e*e-b*b));return a};d.slerp=a;d.random=function(a){var c=b.RANDOM(),e=b.RANDOM(),d=b.RANDOM(),f=Math.sqrt(1-c),c=Math.sqrt(c);a[0]=f*Math.sin(2*Math.PI*e);a[1]=f*Math.cos(2*Math.PI*e);
a[2]=c*Math.sin(2*Math.PI*d);a[3]=c*Math.cos(2*Math.PI*d);return a};d.invert=function(a,b){var c=b[0],e=b[1],d=b[2];b=b[3];var f=c*c+e*e+d*d+b*b,f=f?1/f:0;a[0]=-c*f;a[1]=-e*f;a[2]=-d*f;a[3]=b*f;return a};d.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};d.fromMat3=h;d.fromEuler=function(a,b,c,e){var d=.5*Math.PI/180;b*=d;c*=d;e*=d;d=Math.sin(b);b=Math.cos(b);var f=Math.sin(c);c=Math.cos(c);var g=Math.sin(e);e=Math.cos(e);a[0]=d*c*e-b*f*g;a[1]=b*f*e+d*c*g;a[2]=b*c*g-d*
f*e;a[3]=b*c*e+d*f*g;return a};d.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};d.copy=e.copy;d.set=e.set;d.add=e.add;d.mul=c;d.scale=e.scale;d.dot=e.dot;d.lerp=e.lerp;d.length=e.length;d.len=d.length;d.squaredLength=e.squaredLength;d.sqrLen=d.squaredLength;d.normalize=e.normalize;d.exactEquals=e.exactEquals;d.equals=e.equals;d.rotationTo=function(a,b,c){var e=f.dot(b,c);if(-.999999>e)return f.cross(p,n,b),1E-6>f.len(p)&&f.cross(p,u,b),f.normalize(p,p),k(a,p,Math.PI),a;if(.999999<
e)return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a;f.cross(p,b,c);a[0]=p[0];a[1]=p[1];a[2]=p[2];a[3]=1+e;return d.normalize(a,a)};var p=l.create(),n=l.fromValues(1,0,0),u=l.fromValues(0,1,0);d.sqlerp=function(b,c,e,d,f,g){a(v,c,f,g);a(r,e,d,g);a(b,v,r,2*g*(1-g));return b};var v=g.create(),r=g.create();d.setAxes=function(a,b,c,e){var f=y;f[0]=c[0];f[3]=c[1];f[6]=c[2];f[1]=e[0];f[4]=e[1];f[7]=e[2];f[2]=-b[0];f[5]=-b[1];f[8]=-b[2];return d.normalize(a,h(a,f))};var y=q.create()})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["require",
"exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(d){this.data=d;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}d.prototype.readUint32=function(){var d=this.offset4;this.offset4+=1;return this.dataUint32[d]};d.prototype.readUint8Array=function(d){var g=4*this.offset4;this.offset4+=d/4;return new Uint8Array(this.data,g,d)};d.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4};
return d}();d.BinaryStreamReader=t})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});var g={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},l={pbrMetallicRoughness:g,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},b={ESRI_externalColorMixMode:"tint"};d.material=function(e){void 0===e&&(e={});var d=q({},g,e.pbrMetallicRoughness),
c=q({},b,e.extras);switch(c.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":break;default:c.ESRI_externalColorMixMode="tint"}return q({},l,e,{pbrMetallicRoughness:d,extras:c})};var f={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};d.textureSampler=function(b){return q({},f,b)}})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.splitURI=function(d){var g,l;d.replace(/^(.*\/)?([^/]*)$/,
function(b,d,e){g=d||"";l=e||"";return""});return{dirPart:g,filePart:l}}})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["require","exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(t,d,q,g){function l(b){return g.generateDefaultIndexArray(b)}Object.defineProperty(d,"__esModule",{value:!0});d.linearIndexArray=l;d.trianglesToTriangles=function(b){return"number"===typeof b?l(b):q.isUint16Array(b)||q.isUint8Array(b)?new Uint32Array(b):b};d.triangleStripToTriangles=
function(b){var d="number"===typeof b?b:b.length;if(3>d)return new Uint32Array(0);var d=d-2,e=new Uint32Array(3*d);if("number"===typeof b)for(var g=0,c=0;c<d;c+=1)0===c%2?(e[g++]=c,e[g++]=c+1):(e[g++]=c+1,e[g++]=c),e[g++]=c+2;else for(c=g=0;c<d;c+=1){if(0===c%2)var a=b[c],h=b[c+1],l=b[c+2];else a=b[c+1],h=b[c],l=b[c+2];e[g++]=a;e[g++]=h;e[g++]=l}return e};d.triangleFanToTriangles=function(b){var d="number"===typeof b?b:b.length;if(3>d)return new Uint32Array(0);var d=d-2,e=new Uint32Array(3*d);if("number"===
typeof b){for(var g=0,c=0;c<d;++c)e[g++]=0,e[g++]=c+1,e[g++]=c+2;return e}for(var a=b[0],h=b[1],c=g=0;c<d;++c){var l=b[c+2];e[g++]=a;e[g++]=h;h=e[g++]=l}return e}})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/errors/CancelError ../../../../request ../../../../core/Error ../../../../core/lang ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/Version ../../../../geometry/support/aaBoundingBox ../../support/imageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y){function w(c,e){if(e){var d=e.request(c,"json");return a.create(function(a,c){d.then(function(b){a(b.data)},function(a){c(a instanceof b?a:m(a.url))})},function(){e.cancelRequest(d)})}var g=f(c);return a.create(function(a,c){g.then(function(b){a(b.data)},function(a){c(a instanceof b?a:m(a))})},function(){g.cancel()})}function m(a){return new e("","Request for object resource failed: "+a)}function x(a,b){return l(this,void 0,void 0,function(){var c,e,d,
f,l,m,p,n,r,x,q,w,t,G,L,fa,ga,ja,ia,ka,da,Y,ha,ea,ma,aa,qa,na,sa,z,la,oa,ta,Ba,ya;return g(this,function(g){switch(g.label){case 0:return d=[],f=[],l=[],m=[],p=h.Version.parse(a.version||"1.0","wosr"),I.validate(p),n="meshsymbol_"+a.model.name,r=a.textureDefinitions,[4,C(n,r,b)];case 1:x=g.sent();for(q in x)m.push(x[q].engineTexObj);w=a.model.geometries;t=a.materialDefinitions;for(L=G=0;L<w.length;L++){var J=fa=w[L],F=J.params,R=F.topology;g=!0;F.vertexAttributes||(E.warn("Geometry must specify vertex attributes"),
g=!1);switch(F.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:R=F.faces;if(!R)E.warn("Indexed geometries must specify faces"),g=!1;else if(F.vertexAttributes){var T=void 0;for(T in F.vertexAttributes)(F=R[T])&&F.values?(null!=F.valueType&&"UInt32"!==F.valueType&&(E.warn("Unsupported indexed geometry indices type '"+F.valueType+"', only UInt32 is currently supported"),g=!1),null!=F.valuesPerElement&&1!==F.valuesPerElement&&(E.warn("Unsupported indexed geometry values per element '"+
F.valuesPerElement+"', only 1 is currently supported"),g=!1)):(E.warn("Indexed geometry does not specify face indices for '"+T+"' attribute"),g=!1)}break;default:E.warn("Unsupported topology '"+R+"'"),g=!1}J.params.material||(E.warn("Geometry requires material"),g=!1);J=J.params.vertexAttributes;F=void 0;for(F in J)J[F].values||(E.warn("Geometries with externally defined attributes are not yet supported"),g=!1);if(g){g=fa.params;c=g.material;e=g.texture;ga=fa.params.vertexAttributes;ja={};for(ia in ga)ka=
ga[ia],da=ka.values,ja[ia]={data:da,size:ka.valuesPerElement};Y={};if("PerAttributeArray"===fa.params.topology){g=ha=ja.position.data.length/ja.position.size;J=new Uint32Array(g);for(F=0;F<g;F++)J[F]=F;ea=J;for(ma in ja)Y[ma]=ea}else for(qa in aa=fa.params.faces,aa)Y[qa]=new Uint32Array(aa[qa].values);na=e?x[e]:null;sa=l[c]?l[c][e]:null;sa||(z=c.substring(c.lastIndexOf("/")+1),la=t[z].params,1===la.transparency&&(la.transparency=0),oa=na&&na.alphaChannelUsage,ta=0<la.transparency||"transparency"===
oa||"maskAndTransparency"===oa,Ba={ambient:la.diffuse,diffuse:la.diffuse,specular:[0,0,0],opacity:1-(la.transparency||0),transparent:ta,textureAlphaMode:na?B(na.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:na?na.engineTexObj.id:void 0,textureInitTransparent:!0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:la.externalColorMixMode||"tint",textureAlphaPremultiplied:!0},b&&b.materialParamsMixin&&k.mixin(Ba,b.materialParamsMixin),sa=new y(Ba,n),l[c]||(l[c]={}),l[c][e]=sa);f.push(sa);
ya=new u(new v(ja,Y),n);G+=Y.position?Y.position.length:0;d.push(ya)}}return[2,{stageResources:{textures:m,materials:f,geometries:d},pivotOffset:a.model.pivotOffset,boundingBox:A(d),numberOfVertices:G,lodThreshold:null}]}})})}function A(a){var b=p.empty();a.forEach(function(a){a=a.boundingInfo;p.expand(b,a.getBBMin());p.expand(b,a.getBBMax())});return b}function C(b,c,e){return l(this,void 0,void 0,function(){var d,f,h,k,l,m,p,v;return g(this,function(g){switch(g.label){case 0:d=[];f=function(f){var g=
c[f],h=g.images[0].data;if(!h)return E.warn("Externally referenced texture data is not yet supported"),"continue";var h=g.encoding+";base64,"+h,k="/textureDefinitions/"+f,l={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0};f=e&&e.disableTextures?a.resolve(null):n.requestImage(h);d.push(f.then(function(a){return{refId:k,engineTexObj:new r(a,b,l),alphaChannelUsage:"rgba"===g.channels?g.alphaChannelUsage||"transparency":"none"}}))};for(h in c)f(h);return[4,a.all(d)];case 1:k=g.sent();l={};
m=0;for(p=k;m<p.length;m++)v=p[m],l[v.refId]=v;return[2,l]}})})}function B(a){switch(a){case "mask":return"mask";case "maskAndTransparency":return"maskBlend";case "none":return"opaque";case "transparency":return"blend";default:return"blend"}}Object.defineProperty(d,"__esModule",{value:!0});var E=c.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");d.load=function(a,b){return l(this,void 0,void 0,function(){var c;return g(this,function(e){switch(e.label){case 0:return[4,w(a,b.streamDataSupplier)];
case 1:return c=e.sent(),[2,x(c,b)]}})})};d.createStageResources=x;var I=new h.Version(1,2,"wosr")})},"esri/views/3d/support/buffer/math":function(){define(["require","exports","./math/vec3","./math/vec4"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.vec3=q;d.vec4=g})},"esri/views/3d/support/buffer/math/vec4":function(){define(["require","exports","./common"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.transformMat4=function(d,l,b){if(d.count!==l.count)q.logger.error("source and destination buffers need to have the same number of elements");
else{var f=d.count,e=b[0],g=b[1],c=b[2],a=b[3],h=b[4],p=b[5],n=b[6],u=b[7],v=b[8],r=b[9],y=b[10],w=b[11],m=b[12],x=b[13],A=b[14];b=b[15];var C=d.typedBuffer;d=d.typedBufferStride;var B=l.typedBuffer;l=l.typedBufferStride;for(var t=0;t<f;t++){var I=t*d,G=t*l,L=B[G],F=B[G+1],K=B[G+2],G=B[G+3];C[I]=e*L+h*F+v*K+m*G;C[I+1]=g*L+p*F+r*K+x*G;C[I+2]=c*L+n*F+y*K+A*G;C[I+3]=a*L+u*F+w*K+b*G}}};d.transformMat3=function(d,l,b){if(d.count!==l.count)q.logger.error("source and destination buffers need to have the same number of elements");
else{var f=d.count,e=b[0],g=b[1],c=b[2],a=b[3],h=b[4],p=b[5],n=b[6],u=b[7];b=b[8];var v=d.typedBuffer;d=d.typedBufferStride;var r=l.typedBuffer;l=l.typedBufferStride;for(var y=0;y<f;y++){var w=y*d,m=y*l,x=r[m],A=r[m+1],C=r[m+2],m=r[m+3];v[w]=e*x+a*A+n*C;v[w+1]=g*x+h*A+u*C;v[w+2]=c*x+p*A+b*C;v[w+3]=m}}};d.scale=function(d,l,b){var f=Math.min(d.count,l.count),e=d.typedBuffer;d=d.typedBufferStride;var g=l.typedBuffer;l=l.typedBufferStride;for(var c=0;c<f;c++){var a=c*d,h=c*l;e[a]=b*g[h];e[a+1]=b*g[h+
1];e[a+2]=b*g[h+2];e[a+3]=b*g[h+3]}}})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../../../geometry/support/aaBoundingBox ../../../support/debugFlags ../../../support/buffer/glUtil ../Camera ../DefaultVertexAttributeLocations ../intersectorUtils ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ./utils ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C){function B(a,b,c,e){y.encodeDoubleVec3(a.modelOrigin,b,c.modelOriginHi,c.modelOriginLo,e);c.model.copyFrom(e,a.model,b);c.modelNormal.copyFrom(e,a.modelNormal,b);a.color&&c.color&&c.color.copyFrom(e,a.color,b);a.featureAttribute&&c.featureAttribute&&c.featureAttribute.copyFrom(e,a.featureAttribute,b)}Object.defineProperty(d,"__esModule",{value:!0});var E=A.assert,I=function(a){var b=a.baseBoundingSphere.radius;a=a.levels.map(function(a){return a.minScreenSpaceRadius});
return new v.LevelSelector(b,a)};d.setLevelSelectorFactory=function(a){I=a};var G=function(){function a(a,b){this.glMaterials={};var e=a.rctx,d=b.geometry;b=b.material;var f=d.data.toRenderData();this.materialRep=a.materialRep;b.setParameterValues({instancedDoublePrecision:!0});a=b.createBufferWriter();var g=a.vertexBufferLayout,k=a.elementCount(f),l=a.allocate(k);a.write({},f,void 0,l,0);this.geometry=d;this.material=b;this.glMaterials=y.acquireGLMaterials(b,this.materialRep);this.vertexBufferLayout=
g;this.vbo=x.createVertex(e,35044,l.buffer);this.vao=new C(e,h.Default3D,{geometry:c.glLayout(g)},{geometry:this.vbo});this.vertexCount=k}a.prototype.destroy=function(){y.releaseGLMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(a.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0});
a.prototype.intersect=function(a,b,c,e,d,f){var g=this.geometry.id,h=d.toString();this.material.intersect(this.geometry,null,a.transform.transform,a,c,e,function(c,e,k,l,m,n){if(0<=c&&(null==b||b(a.rayBeginPoint,a.rayEndPoint,c))){m={type:"external",metadata:{layerUid:f.layerUid,graphicUid:f.graphicUid(d)}};if(null==a.results.min.drapedLayerOrder||l>=a.results.min.drapedLayerOrder)if(null==a.results.min.dist||c<a.results.min.dist)a.results.min.set(m,h,c,e,a.transform.transform,l,null,g,k),a.results.min.intersector=
"LodRenderer";if(null==a.results.max.drapedLayerOrder||l>=a.results.max.drapedLayerOrder)if(null==a.results.max.dist||c>a.results.max.dist)a.results.max.set(m,h,c,e,a.transform.transform,l,null,g,k),a.results.min.intersector="LodRenderer";a.enable.storeAll&&(n=new p.IntersectorResult(a.results.min.ray),n.set(m,h,c,e,a.transform.transform,l,null,g,k),n.intersector="LodRenderer",a.results.all.push(n))}},null)};return a}();d.LodComponentData=G;var L=function(){function a(a,b){var c=this;this.components=
[];this.minScreenSpaceRadius=b.minScreenSpaceRadius;b.components.forEach(function(b){c.components.push(new G(a,b))})}a.prototype.destroy=function(){this.components.forEach(function(a){a.destroy()})};a.prototype.intersect=function(a,b,c,e,d,f){this.components.forEach(function(g){g.intersect(a,b,c,e,d,f)})};Object.defineProperty(a.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var a=e.empty();this.components.forEach(function(b){e.expand(a,b.boundingInfo.bbMin);e.expand(a,b.boundingInfo.bbMax)});
this._boundingBox=a}return this._boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var a=this.boundingBox,c=b.vec3f64.create();e.center(a,c);this._boundingSphere={center:c,radius:.5*e.diameter(a)}}return this._boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.components.reduce(function(a,b){return a+b.triangleCount},0)},enumerable:!0,configurable:!0});
return a}();d.LodLevelData=L;t=function(){function e(b,e,f,g){var h=this;this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlaneEnabled=!1;this._enableLevelSelection=!0;this._lastCamera=new a;this._updateCyclesWithStaticCamera=-1;this.didRender=this._needFullCycle=!1;this._symbol=b;this._optionalFields=e;this._metadata=f;this._instanceBufferLayout=w.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:e});this._glInstanceBufferLayout=
c.glLayout(this._instanceBufferLayout,{divisor:1});this._instanceData=new n.InstanceData(this._optionalFields,g);this._instanceData.on("instance-added",function(a){h.requestUpdateCycle()});this._instanceData.on("instance-removed",function(a){h.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",function(a){h.requestUpdateCycle()});this._instanceData.on("instance-visibility-changed",function(a){h.requestUpdateCycle(!0)});this._instanceData.on("instance-highlight-changed",function(a){h.requestUpdateCycle(!0)});
this._enableLevelSelection=1<this._symbol.levels.length;d.lodRenderers.push(this)}e.prototype.destroy=function(){d.lodRenderers.splice(d.lodRenderers.indexOf(this),1)};Object.defineProperty(e.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"baseBoundingBox",{get:function(){return this._levels[this._levels.length-1].boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-
1].boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-1].components[0].material},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled=a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"intersectionHandlerId",{get:function(){return this._metadata.layerUid},enumerable:!0,
configurable:!0});Object.defineProperty(e.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"memoryUsage",{get:function(){var a={cpu:0,gpu:0};this._renderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});this._highlightRenderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});return a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"renderStats",
{get:function(){var a=this,b=this._instanceData.size,c=[];this._levels.forEach(function(b,e){e=a._renderInstanceData[e].size+a._highlightRenderInstanceData[e].size;b=b.triangleCount;c.push({renderedInstances:e,renderedTriangles:e*b,trianglesPerInstance:b})});return{totalInstances:b,renderedInstances:c.reduce(function(a,b){return a+b.renderedInstances},0),renderedTriangles:c.reduce(function(a,b){return a+b.renderedTriangles},0),levels:c}},enumerable:!0,configurable:!0});e.prototype.initializeRenderContext=
function(a){var b=this,c=a.rctx;this._symbol.levels.forEach(function(e){b._levels.push(new L(a,e));b._renderInstanceData.push(new r.RenderInstanceData(c,b._instanceBufferLayout));b._highlightRenderInstanceData.push(new r.RenderInstanceData(c,b._instanceBufferLayout))});this._levelSelector=I(this)};e.prototype.uninitializeRenderContext=function(a){this.invalidateOctree();this._levels.forEach(function(a){a.destroy()});this._renderInstanceData.forEach(function(a){a.destroy()});this._highlightRenderInstanceData.forEach(function(a){a.destroy()})};
Object.defineProperty(e.prototype,"slots",{get:function(){return[5,7]},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(a,b){return a+b.size},0)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"needsRender",{get:function(){return this.needsUpdates()},enumerable:!0,configurable:!0});e.prototype.resetNeedsRender=function(){this.didRender&&(this.didRender=!1)};e.prototype.prepareRender=
function(a){this.runUpdates(a)};e.prototype.render=function(a){var b=a.rctx,c=5===a.slot?4:7===a.slot?6:null;if(c){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(a.pass))return!1;var e=a.camera,e={view:e.viewMatrix,proj:e.projectionMatrix,origin:[0,0,0],viewInvTransp:e.viewInverseTransposeMatrix,lightingData:a.lightingData,viewport:e.viewport,fovY:e.fovY,nearFar:[e.near,e.far],shadowMap:a.shadowMap,shadowMappingEnabled:!!a.shadowMap&&a.shadowMap.enabled,ssaoEnabled:!!a.ssaoHelper&&
a.ssaoHelper.enabled,pixelRatio:e.pixelRatio,slicePlane:a.sliceHelper&&a.sliceHelper.plane,cameraAboveGround:e.aboveGround,hudVisibilityTexture:a.offscreenRenderingHelper?a.offscreenRenderingHelper.hudVisibilityTexture:null};b.bindVAO();for(b=0;b<this._levels.length;++b)this.renderLevel(a,c,e,a.isHighlightPass?this._highlightRenderInstanceData[b]:this._renderInstanceData[b],b);return!0}};e.prototype.intersect=function(a,c,e,d,f){var g=this;if(this.baseMaterial.isVisible()){f=b.vec3f64.create();l.vec3.subtract(f,
d,e);var h=function(b){g._instanceData.getCombinedModelTransform(b,M);a.transform.set(M);l.vec3.transformMat4(Q,e,a.transform.inverse);l.vec3.transformMat4(P,d,a.transform.inverse);var f=g._instanceData.getState(b),h=g._instanceData.getLodLevel(b);E(f&n.StateFlags.ACTIVE,"invalid instance state");E(0<=h&&h<g._levels.length,"invaid lod level");g._levels[h].intersect(a,c,Q,P,b,g._metadata)};this.baseMaterial.getParameters().verticalOffset?this.octree.forEach(h):this.octree.forEachAlongRay(e,f,h)}};
e.prototype.queryDepthRange=function(a){return this.queryDepthRangeOctree(a)};e.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()};e.prototype.requestUpdateCycle=function(a){void 0===a&&(a=!1);this._updateCyclesWithStaticCamera=-1;a&&(this._needFullCycle=!0)};e.prototype.needsUpdates=function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera};e.prototype.runUpdates=function(a){if(!k.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var b=
a.equals(this._lastCamera);this._lastCamera.copyFrom(a);b||this.requestUpdateCycle()}b=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(a,b)}};Object.defineProperty(e.prototype,"octree",{get:function(){this._octree||(this._octree=this.buildOctree());return this._octree},enumerable:!0,configurable:!0});e.prototype.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};e.prototype.buildOctree=function(){for(var a=new u.InstanceOctree(this._instanceData,
this.baseBoundingSphere),b=this._instanceData,b=b.view?b.view.state:null,c=0;c<this._instanceData.capacity;++c)b.get(c)&n.StateFlags.ACTIVE&&a.addInstance(c);return a};e.prototype.queryDepthRangeOctree=function(a){var b=a.eye,c=a.viewForward,e=this.octree.findClosest(c,"front-to-back",a.frustum),d=this.octree.findClosest(c,"back-to-front",a.frustum);return null!=e&&null!=d?(this._instanceData.view.boundingSphere.getVec(e,K),l.vec3.subtract(K,K,b),e=l.vec3.dot(K,c)-K[3],this._instanceData.view.boundingSphere.getVec(d,
K),l.vec3.subtract(K,K,b),b=l.vec3.dot(K,c)+K[3],{near:Math.max(a.near,e),far:Math.min(a.far,b)}):{near:Infinity,far:-Infinity}};e.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._renderInstanceData.forEach(function(a){a.startUpdateCylce()});this._highlightRenderInstanceData.forEach(function(a){a.startUpdateCylce()})};e.prototype.updateInstances=function(a,b){var c=this._enableLevelSelection,e=this._levelSelector;e.updateCamera(a);this._renderInstanceData.forEach(function(a){a.beginUpdate()});
this._highlightRenderInstanceData.forEach(function(a){a.beginUpdate()});a=this._instanceData;var d=this._instanceData.view,f=a.capacity,g=this._instanceIndex;b=Math.min(a.size,b);for(var h=0;h<b;++h){0===g&&this.startUpdateCycle();var k=d.state.get(g),l=0;if(k&n.StateFlags.ALLOCATED){var m=d.lodLevel.get(g);k&n.StateFlags.ACTIVE&&this._renderInstanceData[m].freeTail();k&n.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail();if(k&n.StateFlags.REMOVE)a.freeInstance(g);else if(k&
n.StateFlags.VISIBLE){m=0;c&&(d.modelOrigin.getVec(g,F),m=e.selectLevel(F,a.getCombinedMedianScaleFactor(g)));l=k&~(n.StateFlags.ACTIVE|n.StateFlags.HIGHLIGHT_ACTIVE|n.StateFlags.TRANSFORM_CHANGED);if(0<=m){var p=this._renderInstanceData[m],r=p.allocateHead();B(d,g,p.view,r);l|=n.StateFlags.ACTIVE;k&n.StateFlags.HIGHLIGHT&&(p=this._highlightRenderInstanceData[m],r=p.allocateHead(),B(d,g,p.view,r),l|=n.StateFlags.HIGHLIGHT_ACTIVE)}d.state.set(g,l);d.lodLevel.set(g,m)}else l=k&~(n.StateFlags.ACTIVE|
n.StateFlags.HIGHLIGHT_ACTIVE|n.StateFlags.TRANSFORM_CHANGED),d.state.set(g,l);this._octree&&(m=!!(k&n.StateFlags.ACTIVE),l=!!(l&n.StateFlags.ACTIVE),!m&&l?this._octree.addInstance(g):m&&!l?this._octree.removeInstance(g):m&&l&&k&n.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(g),this._octree.addInstance(g)));g=(g+1)%f}else g=(g+1)%f,b++}this._instanceIndex=g;this._renderInstanceData.forEach(function(a){a.endUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.endUpdate()})};
e.prototype.renderLevel=function(a,b,c,e,d){var f=this;this._levels[d].components.forEach(function(g){f.renderComponent(a,b,c,e,g,d)})};e.prototype.renderComponent=function(a,b,c,e,d,f){var g=d.glMaterials[a.pass];if(g&&g.beginSlot(b)&&g.isVisible()&&g.isVisibleInPass(a.pass)&&0!==e.size){var l=a.rctx,p=l.capabilities.instancing,n=g.getDrawMode();c.origin=[0,0,0];g.bind(l,c);l.bindVAO(d.vao);b=g.getProgram();A.assertCompatibleVertexAttributeLocations(d.vao,b);a.isHighlightPass&&(l.bindTexture(a.offscreenRenderingHelper?
a.offscreenRenderingHelper.depthTexture:null,5),b.setUniform1i("depthTex",5),b.setUniform4f("highlightViewportPixelSz",0,0,1/c.viewport[2],1/c.viewport[3]));g.bindView(l,c);k.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===a.pass&&(b.setUniform4fv("externalColor",O[Math.min(f,O.length-1)]),b.setUniform1i("colorMixMode",m.colorMixModes.replace));a=e.capacity;f=e.headIndex;b=e.tailIndex;var r=e.firstIndex,v=this._glInstanceBufferLayout,u=function(a,b){A.bindVertexBufferLayout(l,h.Default3D,e.buffer,v,
a);p.drawArraysInstanced(n,0,d.vertexCount,b-a);A.unbindVertexBufferLayout(l,h.Default3D,e.buffer,v)};d.material.getParameters().transparent&&null!=r?f>b?(E(r>=b&&r<=f,"invalid firstIndex"),u(r,f),u(b,r)):f<b&&(r<=f?(E(0<=r&&r<=f,"invalid firstIndex"),u(r,f),u(b,a),u(0,r)):(E(r>=b&&r<=a,"invalid firstIndex"),u(r,a),u(0,f),u(b,r))):f>b?u(b,f):f<b&&(u(0,f),u(b,a));l.bindVAO(null);g.release(l,c)}};return e}();d.LodRenderer=t;d.lodRenderers=[];var F=b.vec3f64.create(),K=f.vec4f64.create(),M=g.mat4f64.create(),
Q=b.vec3f64.create(),P=b.vec3f64.create(),O=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/Evented ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../../../../webgl/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n){Object.defineProperty(d,"__esModule",{value:!0});var u=n.assert,v;(function(a){a[a.ALLOCATED=1]="ALLOCATED";a[a.ACTIVE=2]="ACTIVE";a[a.VISIBLE=4]="VISIBLE";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";a[a.REMOVE=32]="REMOVE";a[a.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(v=d.StateFlags||(d.StateFlags={}));var r=function(){return function(a){this.localTransform=a.getField("localTransform",h.BufferViewMat4f64);this.globalTransform=a.getField("globalTransform",
h.BufferViewMat4f64);this.modelOrigin=a.getField("modelOrigin",h.BufferViewVec3f64);this.model=a.getField("model",h.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",h.BufferViewMat3f);this.modelScaleFactors=a.getField("modelScaleFactors",h.BufferViewVec2f);this.boundingSphere=a.getField("boundingSphere",h.BufferViewVec4f64);this.color=a.getField("color",h.BufferViewVec4f);this.featureAttribute=a.getField("featureAttribute",h.BufferViewVec4f);this.state=a.getField("state",h.BufferViewUint8);
this.lodLevel=a.getField("lodLevel",h.BufferViewUint8)}}();d.View=r;t=function(c){function d(a,b){var e=c.call(this)||this;e._capacity=0;e._size=0;e._next=0;var d=p.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=a.indexOf("color")&&(d=d.vec4f("color"));0<=a.indexOf("featureAttribute")&&(d=d.vec4f("featureAttribute"));d=d.u8("state").u8("lodLevel").alignTo(8);e._layout=
d;e._shaderTransformation=b;return e}q(d,c);Object.defineProperty(d.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});d.prototype.addInstance=
function(){this._size+1>this._capacity&&this.grow();var a=this.findSlot();this._view.state.set(a,v.ALLOCATED);this._size++;this.emit("instance-added",{index:a});return a};d.prototype.removeInstance=function(a){var b=this._view.state;u(0<=a&&a<this._capacity&&b.get(a)&v.ALLOCATED,"invalid instance handle");this.getStateFlag(a,v.ACTIVE)?this.setStateFlags(a,v.REMOVE):this.freeInstance(a);this.emit("instance-removed",{index:a})};d.prototype.freeInstance=function(a){var b=this._view.state;u(0<=a&&a<this._capacity&&
b.get(a)&v.ALLOCATED,"invalid instance handle");b.set(a,0);this._size--};d.prototype.setLocalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.localTransform.setMat(a,b);c&&this.updateModelTransform(a)};d.prototype.getLocalTransform=function(a,b){this._view.localTransform.getMat(a,b)};d.prototype.setGlobalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.globalTransform.setMat(a,b);c&&this.updateModelTransform(a)};d.prototype.getGlobalTransform=function(a,b){this._view.globalTransform.getMat(a,
b)};d.prototype.updateModelTransform=function(c){var d=this._view,f=m,h=x;d.localTransform.getMat(c,A);d.globalTransform.getMat(c,C);var k=b.mat4.multiply(C,C,A);e.vec3.set(f,k[12],k[13],k[14]);d.modelOrigin.setVec(c,f);g.mat3.fromMat4(h,k);d.model.setMat(c,h);f=a.scaleFromMatrix(m,k);f.sort();d.modelScaleFactors.set(c,0,f[1]);d.modelScaleFactors.set(c,1,f[2]);g.mat3.invert(h,h);g.mat3.transpose(h,h);d.modelNormal.setMat(c,h);this.setStateFlags(c,v.TRANSFORM_CHANGED);this.emit("instance-transform-changed",
{index:c})};d.prototype.getModelTransform=function(a,b){var c=this._view;c.model.getMat(a,x);c.modelOrigin.getVec(a,m);b[0]=x[0];b[1]=x[1];b[2]=x[2];b[3]=0;b[4]=x[3];b[5]=x[4];b[6]=x[5];b[7]=0;b[8]=x[6];b[9]=x[7];b[10]=x[8];b[11]=0;b[12]=m[0];b[13]=m[1];b[14]=m[2];b[15]=1};d.prototype.applyShaderTransformation=function(a,b){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b)};d.prototype.getCombinedModelTransform=function(a,b){this.getModelTransform(a,b);this._shaderTransformation&&
this._shaderTransformation.applyTransform(this,a,b);return b};d.prototype.getCombinedLocalTransform=function(a,b){this._view.localTransform.getMat(a,b);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b);return b};d.prototype.getCombinedMaxScaleFactor=function(a){var b=this._view.modelScaleFactors.get(a,1);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(m,this,a),b*=Math.max(a[0],a[1],a[2]));return b};d.prototype.getCombinedMedianScaleFactor=function(a){var b=
this._view.modelScaleFactors.get(a,0);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(m,this,a),a.sort(),b*=a[1]);return b};d.prototype.getModel=function(a,b){this._view.model.getMat(a,b)};d.prototype.setFeatureAttribute=function(a,b){this._view.featureAttribute.setVec(a,b)};d.prototype.getFeatureAttribute=function(a,b){this._view.featureAttribute.getVec(a,b)};d.prototype.setColor=function(a,b){this._view.color.setVec(a,b)};d.prototype.getColor=function(a,b){this._view.color.getVec(a,
b)};d.prototype.setVisible=function(a,b){b!==this.getVisible(a)&&(this.setStateFlag(a,v.VISIBLE,b),this.emit("instance-visibility-changed",{index:a}))};d.prototype.getVisible=function(a){return this.getStateFlag(a,v.VISIBLE)};d.prototype.setHighlight=function(a,b){b!==this.getHighlight(a)&&(this.setStateFlag(a,v.HIGHLIGHT,b),this.emit("instance-highlight-changed",{index:a}))};d.prototype.getHighlight=function(a){return this.getStateFlag(a,v.HIGHLIGHT)};d.prototype.getState=function(a){return this._view.state.get(a)};
d.prototype.getLodLevel=function(a){return this._view.lodLevel.get(a)};d.prototype.countFlags=function(a){for(var b=0,c=0;c<this._capacity;++c)this.getState(c)&a&&++b;return b};d.prototype.setStateFlags=function(a,b){var c=this._view.state;b|=c.get(a);c.set(a,b)};d.prototype.clearStateFlags=function(a,b){var c=this._view.state;b=c.get(a)&~b;c.set(a,b)};d.prototype.setStateFlag=function(a,b,c){c?this.setStateFlags(a,b):this.clearStateFlags(a,b)};d.prototype.getStateFlag=function(a,b){return!!(this._view.state.get(a)&
b)};d.prototype.grow=function(){var a=Math.max(y,Math.floor(this._capacity*w)),b=this._layout.createBuffer(a);if(this._buffer){var c=new Uint8Array(this._buffer.buffer);(new Uint8Array(b.buffer)).set(c)}this._capacity=a;this._buffer=b;this._view=new r(this._buffer)};d.prototype.findSlot=function(){for(var a=this._view.state,b=this._next;a.get(b)&v.ALLOCATED;)b=(b+1)%this._capacity;this._next=(b+1)%this._capacity;return b};return d}(c.Evented);d.InstanceData=t;var y=1024,w=2,m=k.vec3f64.create(),x=
l.mat3f64.create(),A=f.mat4f64.create(),C=f.mat4f64.create()})},"esri/views/3d/support/Evented":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(){this._listeners={}}d.prototype.hasEventListener=function(d){return null!=this._listeners[d]&&0<this._listeners[d].size};d.prototype.on=function(d,l){var b=this;null==this._listeners[d]&&(this._listeners[d]=new Map);var f={};this._listeners[d].set(f,l);return{remove:function(){return b._listeners[d].delete(f)}}};
d.prototype.emit=function(d,l){null!=this._listeners[d]&&this._listeners[d].forEach(function(b){return b(l)})};return d}();d.Evented=t})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../Octree".split(" "),function(t,d,q,g,l,b,f,e){Object.defineProperty(d,
"__esModule",{value:!0});t=function(e){function c(a,c){var d=e.call(this,[0,0,0],1,{getCenter:function(a){var b=d._instanceData.view.boundingSphere,c=d._tmpCenter;c[0]=b.get(a,0);c[1]=b.get(a,1);c[2]=b.get(a,2);return c},getRadius:function(a){return d._instanceData.view.boundingSphere.get(a,3)}},{maximumDepth:25})||this;d._tmpCenter=b.vec3f64.create();d._tmpMat4=g.mat4f64.create();d._instanceData=a;d._boundingSphere=c;return d}q(c,e);c.prototype.addInstance=function(a){var b=this._instanceData.view.boundingSphere,
c=this._instanceData.getCombinedModelTransform(a,this._tmpMat4),e=l.vec3.transformMat4(this._tmpCenter,this._boundingSphere.center,c),c=this._boundingSphere.radius*f.maxScale(c);b.set(a,0,e[0]);b.set(a,1,e[1]);b.set(a,2,e[2]);b.set(a,3,c);this.add(a)};c.prototype.removeInstance=function(a){this.remove(a)};return c}(e);d.InstanceOctree=t})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require","exports","../Camera"],function(t,d,q){Object.defineProperty(d,"__esModule",
{value:!0});t=function(){function d(d,b){this.thresholdScale=1;this._camera=new q;this._worldSpaceRadius=d;this._thresholds=b.map(function(b){return b})}d.prototype.updateCamera=function(d){this._camera.copyFrom(d)};d.prototype.selectLevel=function(d,b){d=this._camera.computeScreenPixelSizeAt(d);b=this._worldSpaceRadius*b/d;d=this._thresholds;for(var f=-1,e=0;e<d.length;++e)b>=d[e]*this.thresholdScale&&(f=e);return f};return d}();d.LevelSelector=t})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require",
"exports","../../../support/buffer/BufferView","./BackedBufferObject","../../../../webgl/Util"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=l.assert,f=function(){return function(a){this.modelOriginHi=a.getField("modelOriginHi",q.BufferViewVec3f);this.modelOriginLo=a.getField("modelOriginLo",q.BufferViewVec3f);this.model=a.getField("model",q.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",q.BufferViewMat3f);this.color=a.getField("instanceColor",q.BufferViewVec4f);
this.featureAttribute=a.getField("instanceFeatureAttribute",q.BufferViewVec4f)}}();d.View=f;t=function(){function d(a,b){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=a;this._instanceBufferLayout=b;this._elementSize=b.stride;this._capacity=1}d.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(d.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){var a=this._headIndex,b=this._tailIndex;return a>=b?a-b:a+this._capacity-b},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0});d.prototype.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};d.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};d.prototype.beginUpdate=function(){b(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};d.prototype.endUpdate=function(){b(this._updating,
"not updating");this.size<c*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};d.prototype.allocateHead=function(){b(this._updating,"not updating");this.isFull&&this.grow();var a=this.headIndex;this._captureFirstIndex&&(this._firstIndex=a,this._captureFirstIndex=!1);this.incrementHead();b(this._headIndex!==this._tailIndex,"invalid pointers");return a};d.prototype.freeTail=function(){b(this._updating,
"not updating");b(0<this.size,"invalid size");var a=this._tailIndex===this._firstIndex;this.incrementTail();a&&(this._firstIndex=this._tailIndex)};d.prototype.grow=function(){this.resize(Math.max(e,Math.floor(this._capacity*k)))};d.prototype.shrink=function(){h&&this.resize(Math.max(e,Math.floor(this._capacity*a)))};d.prototype.resize=function(a){b(this._updating,"not updating");if(a!==this._capacity){var c=new g(this._rctx,34962,35044,this._elementSize,a);if(this._buffer){this._firstIndex&&(this._firstIndex=
(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var e=this.size,d=this.compactInstances(c);b(d===e,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=d;this._prevHeadIndex=0}this._resized=!0;this._capacity=a;this._buffer=c;this._view=new f(this._instanceBufferLayout.createView(this._buffer.array))}};d.prototype.compactInstances=function(a){var b=this._headIndex,c=this._tailIndex;return c<b?(this._buffer.copyRange(c,b,a),b-c):c>b?(this._buffer.copyRange(c,
this._capacity,a),0<b&&this._buffer.copyRange(0,b,a,this._capacity-c),b+(this._capacity-c)):0};d.prototype.incrementHead=function(a){void 0===a&&(a=1);this._headIndex=(this._headIndex+a)%this._capacity};d.prototype.incrementTail=function(a){void 0===a&&(a=1);this._tailIndex=(this._tailIndex+a)%this._capacity};d.prototype.transferRange=function(a,b){a<b?this._buffer.transferRange(a,b):a>b&&(0<b&&this._buffer.transferRange(0,b),this._buffer.transferRange(a,this._capacity))};return d}();d.RenderInstanceData=
t;var e=1024,k=2,c=.3,a=.5,h=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require","exports","../../../../webgl/BufferObject"],function(t,d,q){return function(){function d(d,b,f,e,g){this._elementSize=e;this._buffer=new q(d,b,f);this.resize(g)}d.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(d.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0});d.prototype.copyRange=
function(d,b,f,e){void 0===e&&(e=0);d=new Uint8Array(this.array,d*this.elementSize,(b-d)*this.elementSize);(new Uint8Array(f.array,e*this.elementSize)).set(d)};d.prototype.transferAll=function(){this._buffer.setData(this._array)};d.prototype.transferRange=function(d,b){d*=this._elementSize;this._buffer.setSubData(this._array,d,d,b*this._elementSize)};d.prototype.resize=function(d){var b=d*this._elementSize,f=new ArrayBuffer(b);this._array&&(d>=this._capacity?(new Uint8Array(f)).set(new Uint8Array(this._array)):
(new Uint8Array(f)).set((new Uint8Array(this._array)).subarray(0,d*this._elementSize)));this._array=f;this._buffer.setData(b);this._capacity=d};return d}()})},"esri/views/3d/webgl-engine/lib/lodRendering/utils":function(){define(["require","exports","../doublePrecisionUtils"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.acquireGLMaterials=function(b,d){var e={};e[0]=d.aquire(b,"color");e[3]=d.aquire(b,"depthShadowMap");e[2]=d.aquire(b,"normal");e[1]=d.aquire(b,"depth");e[4]=
d.aquire(b,"highlight");return e};d.releaseGLMaterials=function(b,d){d.release(b.id,"color");d.release(b.id,"depthShadowMap");d.release(b.id,"normal");d.release(b.id,"depth");d.release(b.id,"highlight")};d.encodeDoubleVec3=function(b,d,e,k,c){g[0]=b.get(d,0);g[1]=b.get(d,1);g[2]=b.get(d,2);q.encodeDoubleArray(g,l,3);e.set(c,0,l[0]);k.set(c,0,l[1]);e.set(c,1,l[2]);k.set(c,1,l[3]);e.set(c,2,l[4]);k.set(c,2,l[5])};var g=new Float64Array(3),l=new Float32Array(6)})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/lang ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x){function A(b,c,e,d){b=b.stageObject;var f=b.getMetadata().pathGeometries,g=b.getGeometryRecords(),h=g.length;C.spatialReference=e.spatialReference;for(var k="absolute-height"!==c.mode,l=0,m=0;m<h;m++){for(var p=g[m].geometry,n=f[p.id],r=0,v=0,u=n.builder.path.vertices;v<u.length;v++){var x=u[v];C.x=x.mapPos[0];C.y=x.mapPos[1];C.z=x.mapPos[2];x.elevation=a.computeElevation(e,C,c,d,k?B:null);k&&(r+=B.terrainElevation)}n.updateElevation(d);p.invalidateBoundingInfo();
b.geometryVertexAttrsUpdated(m);l+=r/n.builder.path.vertices.length}return l/h}Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function g(a,b,c,f){a=d.call(this,a,b,c,f)||this;if(!a._isPropertyDriven("size")&&(b=p.validateSymbolLayerSize(a._getSymbolSize())))return a._logWarning(b),a.reject(),a;a._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:a._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,
color:!0,opacity:!0,rotation:!1}};a._fastUpdates=a._context.renderer&&a._context.renderer.visualVariables&&0<a._context.renderer.visualVariables.length?n.initFastSymbolUpdatesState(a._context.renderer,a._vvConvertOptions):{enabled:!1};b=a._getStageIdHint();f=a._getMaterialOpacityAndColor();c=e.vec3f64.fromArray(f);f=f[3];c={diffuse:c,ambient:c,opacity:f,transparent:1>f||a._isPropertyDriven("opacity"),vertexColors:!1,slicePlaneEnabled:a._context.slicePlaneEnabled,castShadows:a.symbolLayer.castShadows};
a._fastUpdates.enabled?(l.mixin(c,a._fastUpdates.materialParameters,{size:a._getSize()}),a._material=new x(c,b+"_pathmat")):(c.vertexColors=a._isPropertyDriven("color")||a._isPropertyDriven("opacity"),a._material=new m(c,b+"_pathmat"));a._context.stage.add(v.ModelContentType.MATERIAL,a._material);a._profile=w.Profile.tube(E);b="tube";"profile"in a.symbolLayer&&(b=a.symbolLayer.profile);switch(b){default:a._profile=w.Profile.tube(E);break;case "strip":a._profile=w.Profile.strip();a._material.setParameterValues({cullFace:"none"});
break;case "fence":a._profile=w.Profile.fence();a._material.setParameterValues({cullFace:"none"});break;case "wall":a._profile=w.Profile.wall()}a._extruder=new w.SimpleExtruder;b="simple";"joint"in a.symbolLayer&&(b=a.symbolLayer.joint);switch(b){case "round":a._extruder=new w.RoundExtruder(4);break;case "bevel":a._extruder=new w.BevelExtruder;break;default:a._extruder=new w.SimpleExtruder}a.resolve();return a}q(g,d);g.prototype.destroy=function(){d.prototype.destroy.call(this);this.isFulfilled()||
this.reject();this._material&&(this._context.stage.remove(v.ModelContentType.MATERIAL,this._material.id),this._material=null)};g.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("polyline"!==b.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,e,c,b.uid)};g.prototype.layerOpacityChanged=
function(){var a=this._getMaterialOpacity(),b=1>a||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:a,transparent:b});return!0};g.prototype.layerElevationInfoChanged=function(b,c,e){var d=this;b.forEach(function(b){var e=c(b);e&&(b=d.getGraphicElevationContext(b.graphic),e.needsElevationUpdates=a.needsElevationUpdates3D(b.mode),e.elevationContext.set(b))});return!0};g.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};g.prototype.pixelRatioChanged=function(a,b){return!0};g.prototype.applyRendererDiff=function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(n.updateFastSymbolUpdatesState(this._fastUpdates,b,this._vvConvertOptions))a={},l.mixin(a,this._fastUpdates.materialParameters),this._material.setParameterValues(a);else return!1;break;default:return!1}return!0};g.prototype._getSymbolSize=function(){return this.symbolLayer.size||1};g.prototype._getSize=function(){return this._fastUpdates.enabled&&
this._fastUpdates.visualVariables.size?1:.5*this._getSymbolSize()/this._context.renderCoordsHelper.unitInMeters};g.prototype._createAs3DShape=function(d,g,k,l,m){var p={},n=d.geometry,v=n.paths,x=[],q=[],C=[],B=e.vec3f64.create(),t=this._context.renderSpatialReference===u.SphericalECEFSpatialReference,E=Array(6),n=a.getGeometryVertexData3D(v,n.hasZ,n.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,k);this._logGeometryCreationWarnings(n,
v,"paths","PathSymbol3DLayer");if(0<v.length){for(var v=n.geometryData.outlines,F=n.eleVertexData,G=n.vertexData,I=0;I<v.length;++I){var L=v[I],M=L.index,K=L.count;if(!(2>K)){if(this._context.clippingExtent&&(a.computeBoundingBox(F,M,K,E),a.boundingBoxClipped(E,this._context.clippingExtent)))continue;a.chooseOrigin(G,M,K,B);a.subtractCoordinates(G,M,K,B);L=f.mat4f64.create();b.mat4.translate(L,L,B);M=new w.Path(G,F,M,K,t,B);M=new w.Builder(M,this._profile,this._extruder);K=null;if(this._fastUpdates.enabled)var Q=
this._fastUpdates.visualVariables,K=Q.size?h.getAttributeValue(Q.size.field,d):0,da=Q.color?h.getAttributeValue(Q.color.field,d):0,Q=Q.opacity?h.getAttributeValue(Q.opacity.field,d):0,K=new w.FastUpdatePathGeometry(M,K,da,Q);else K=1,this._isPropertyDriven("size")?K=g.size[0]:this.symbolLayer.size&&(K=this.symbolLayer.size),K*=.5/this._context.renderCoordsHelper.unitInMeters,da=null,this._isPropertyDriven("color")&&(da=g.color),this._isPropertyDriven("opacity")&&null!=g.opacity&&(da=da?[da[0],da[1],
da[2],g.opacity]:[1,1,1,g.opacity]),K=new w.StaticPathGeometry(M,K,da);M=K.createGeometryData();M=new r(M,l+"path"+I);p[M.id]=K;M.singleUse=!0;x.push(M);q.push(this._material);C.push(L)}}d={layerUid:this._context.layer.uid,graphicUid:m,pathGeometries:p};if(0<x.length)return l=new y({geometries:x,materials:q,transformations:C,castShadow:!0,metadata:d,idHint:l}),x=new c(this,l,x,null,null,A,k),x.alignedTerrainElevation=n.terrainElevation,x.needsElevationUpdates=a.needsElevationUpdates3D(k.mode),x}return null};
return g}(h.Graphics3DSymbolLayer);d.Graphics3DPathSymbolLayer=t;var C=new k,B={verticalDistanceToGround:0,terrainElevation:0},E=10;d.default=t})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/mathUtils ./GeometryData ./GeometryUtil ./Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v){var r;(function(b){var d=function(){function a(a){this.pos=a;this.mapPos=c.vec3f32.create();this.vRight=c.vec3f32.create();this.vLeft=c.vec3f32.create();this.frame={forward:c.vec3f32.create(),up:c.vec3f32.create(),right:c.vec3f32.create()};this.rotationAxis=c.vec3f32.create();this.angle=0}a.prototype.profileSpaceToVertexSpace=function(a,b){a[0]=b[0]*this.frame.right[0]+b[1]*this.frame.up[0];a[1]=b[0]*this.frame.right[1]+b[1]*this.frame.up[1];a[2]=b[0]*this.frame.right[2]+
b[1]*this.frame.up[2]};return a}();b.PathVertex=d;var r=function(){function a(){this.vertices=[];this.vertexIndices=[];this.uvIndices=this.uvs=this.normalIndices=this.normals=null}a.prototype.addVertex=function(a){this.vertices.push(e.vec2f32.clone(a));return this.vertices.length-1};a.prototype.addNormal=function(a){this.normals||(this.normals=[],this.normalIndices=[]);this.normals.push(e.vec2f32.clone(a));return this.normals.length-1};a.prototype.addUV=function(a){this.uvs||(this.uvs=[],this.uvIndices=
[]);this.uvs.push(a);return this.uvs.length-1};a.prototype.addSegment=function(a,b,c,e,d,f){void 0===c&&(c=null);void 0===e&&(e=null);void 0===d&&(d=null);void 0===f&&(f=null);this.vertexIndices.push(a);this.vertexIndices.push(b);null!==c&&null!==e&&(this.normalIndices.push(c),this.normalIndices.push(e));null!==d&&null!==f&&(this.uvIndices.push(d),this.uvIndices.push(f))};Object.defineProperty(a.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0});
a.prototype.hasNormals=function(){return null!=this.normals};a.prototype.hasUV=function(){return null!=this.uvs};a.prototype.normalize=function(){for(var a=0,b=0,c=this.vertices;b<c.length;b++)var e=c[b],a=Math.max(a,f.vec2.length(e));a=1/a;b=0;for(c=this.vertices;b<c.length;b++)e=c[b],f.vec2.scale(e,e,a)};a.tube=function(b){void 0===b&&(b=20);for(var c=new a,d=0;d<b;++d){var f=2*d*Math.PI/b;c.addVertex(e.vec2f32.fromValues(1*Math.cos(f),1*Math.sin(f)));c.addUV(d/b)}c.addUV(1);for(d=0;d<b-1;++d)c.addSegment(d,
d+1,null,null,d,d+1);c.addSegment(b-1,0,null,null,b-1,b);return c};a.line=function(b,c){var d=new a,f=c[0]-b[0],g=c[1]-b[1];d.addVertex(b);d.addVertex(c);d.addNormal(e.vec2f32.fromValues(-g,f));d.addUV(0);d.addUV(1);d.addSegment(0,1,0,0,0,1);return d};a.point=function(b){var c=new a;c.addVertex(b);return c};a.wall=function(b,c){void 0===b&&(b=.2);void 0===c&&(c=1);var d=new a;d.addVertex(e.vec2f32.fromValues(.5*-b,0));d.addVertex(e.vec2f32.fromValues(.5*b,0));d.addVertex(e.vec2f32.fromValues(.5*b,
c));d.addVertex(e.vec2f32.fromValues(.5*-b,c));d.addNormal(e.vec2f32.fromValues(0,-1));d.addNormal(e.vec2f32.fromValues(1,0));d.addNormal(e.vec2f32.fromValues(0,1));d.addNormal(e.vec2f32.fromValues(-1,0));d.addUV(0);d.addUV(1);d.addSegment(0,1,0,0,0,1);d.addSegment(1,2,1,1,0,1);d.addSegment(2,3,2,2,0,1);d.addSegment(3,0,3,3,0,1);return d};a.strip=function(){return this.line(e.vec2f32.fromValues(-1,0),e.vec2f32.fromValues(1,0))};a.fence=function(){return this.line(e.vec2f32.fromValues(0,0),e.vec2f32.fromValues(0,
1))};return a}();b.Profile=r;r=function(){return function(b,e,f,g,l,m){this.vertices=[];this.offset=c.vec3f32.create();k.vec3.copy(this.offset,m);for(m=f;m<f+g;++m){var n=new d(c.vec3f32.fromValues(b[3*m+0],b[3*m+1],b[3*m+2]));k.vec3.set(n.mapPos,e[3*m+0],e[3*m+1],e[3*m+2]);this.vertices.push(n)}b=c.vec3f32.create();e=c.vec3f32.create();f=c.vec3f32.create();m=c.vec3f32.create();var n=c.vec3f32.create(),r=a.vec3f64.create(),v=c.vec3f32.create(),q=c.vec3f32.create(),y=c.vec3f32.create(),w=c.vec3f32.create(),
A,C,B=h.plane.create(),t=this.vertices[0];k.vec3.set(v,0,1,0);k.vec3.subtract(e,this.vertices[1].pos,t.pos);A=0;C=k.vec3.length(e);k.vec3.normalize(e,e);l?(k.vec3.add(r,t.pos,this.offset),k.vec3.normalize(f,r)):k.vec3.set(f,0,0,1);u.makeOrthoBasisDirUpFallback(e,f,v,v,n,f,.99619469809);k.vec3.copy(m,f);k.vec3.copy(w,n);k.vec3.copy(t.vRight,e);k.vec3.copy(t.vLeft,b);k.vec3.copy(t.frame.forward,e);k.vec3.copy(t.frame.up,f);k.vec3.copy(t.frame.right,n);t.vLeftLength=A;t.vRightLength=C;t.index=0;k.vec3.cross(t.rotationAxis,
t.vLeft,t.vRight);k.vec3.normalize(t.rotationAxis,t.rotationAxis);t.angle=0;for(l=1;l<g;++l)t=this.vertices[l],k.vec3.copy(b,e),A=C,l<g-1&&(k.vec3.subtract(e,this.vertices[l+1].pos,t.pos),C=k.vec3.length(e),k.vec3.normalize(e,e)),k.vec3.add(q,b,e),k.vec3.normalize(q,q),k.vec3.add(y,this.vertices[l-1].pos,m),h.plane.fromPositionAndNormal(this.vertices[l].pos,q,B),h.plane.intersectRay(B,h.ray.wrap(y,b),r)?(k.vec3.subtract(r,r,this.vertices[l].pos),k.vec3.normalize(f,r),k.vec3.cross(n,q,f),k.vec3.normalize(n,
n)):u.makeOrthoBasisDirUpFallback(q,m,w,v,n,f,.99619469809),k.vec3.copy(m,f),k.vec3.copy(w,n),k.vec3.copy(t.vRight,e),k.vec3.copy(t.vLeft,b),k.vec3.copy(t.frame.forward,q),k.vec3.copy(t.frame.up,f),k.vec3.copy(t.frame.right,n),t.vLeftLength=A,t.vRightLength=C,t.index=l,k.vec3.cross(t.rotationAxis,t.vLeft,t.vRight),k.vec3.normalize(t.rotationAxis,t.rotationAxis),k.vec3.negate(x,t.vLeft),t.angle=Math.PI-p.acos(k.vec3.dot(x,t.vRight))}}();b.Path=r;r=function(){return function(){}}();b.Extruder=r;r=function(){function a(){}
a.prototype.numVertices=function(a){return a.vertices.length};a.prototype.extrude=function(a,b,c){for(var e=0;e<b.vertices.length;++e){var d=b.vertices[e];d.profileSpaceToVertexSpace(y,a);c(d.pos,y,e)}};return a}();b.SimpleExtruder=r;r=function(){function a(a){void 0===a&&(a=1);this._segmentsPerRadian=a/Math.PI}a.prototype.getNumSegments=function(a){return Math.ceil(a*this._segmentsPerRadian)};a.prototype.numVertices=function(a){for(var b=2,c=1;c<a.vertices.length-1;++c)b+=this.getNumSegments(a.vertices[c].angle)+
1;return b};a.prototype.extrude=function(a,b,c){b.vertices[0].profileSpaceToVertexSpace(y,a);c(b.vertices[0].pos,y,0);k.vec3.copy(A,y);for(var e=1;e<b.vertices.length-1;++e){var d=b.vertices[e];d.profileSpaceToVertexSpace(y,a);var f=this.getNumSegments(d.angle);l.mat4.identity(E);l.mat4.rotate(E,E,.5*-d.angle,d.rotationAxis);k.vec3.transformMat4(C,y,E);if(0<=k.vec3.dot(C,d.vRight)){for(var g=0;g<f+1;++g)c(d.pos,y,e);k.vec3.copy(A,y)}else{l.mat4.identity(E);l.mat4.rotate(E,E,d.angle/f,d.rotationAxis);
c(d.pos,C,e);k.vec3.copy(B,C);for(g=0;g<f;++g)k.vec3.transformMat4(B,B,E),c(d.pos,B,e);k.vec3.copy(A,B)}}e=b.vertices.length-1;b.vertices[e].profileSpaceToVertexSpace(y,a);c(b.vertices[e].pos,y,e)};return a}();b.RoundExtruder=r;r=function(a){function b(){return a.call(this,1)||this}g(b,a);return b}(r);b.BevelExtruder=r;var q={generateUV:!1},r=function(){function a(a,b,c,e){void 0===e&&(e=q);this.options=e;this._capNormalsOffset=this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this._numExtrusionVertices=
this._extrusionNormalCount=this._extrusionVertexCount=0;this.profile=b;this.profile.normalize();this.path=a;this.extruder=c;this._numExtrusionVertices=c.numVertices(a);this.numVerticesTotal=b.vertices.length*this._numExtrusionVertices;this.profile.hasNormals()?this.numNormalsTotal=this.profile.normals.length*this._numExtrusionVertices:this.numNormalsTotal=this.numVerticesTotal;this.numNormalsTotal+=2;this.originData=new Float32Array(3*this.numVerticesTotal);this.directionData=new Float32Array(4*this.numVerticesTotal);
this.normalData=new Float32Array(3*this.numNormalsTotal);this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.buildGeometry();this.buildTopology()}a.prototype.emitVertex=function(a,b,c){this.originData[3*this._extrusionVertexCount+0]=a[0];this.originData[3*this._extrusionVertexCount+1]=a[1];this.originData[3*this._extrusionVertexCount+2]=a[2];this.directionData[4*
this._extrusionVertexCount+0]=b[0];this.directionData[4*this._extrusionVertexCount+1]=b[1];this.directionData[4*this._extrusionVertexCount+2]=b[2];this.directionData[4*this._extrusionVertexCount+3]=c/(this.path.vertices.length-1);this.pathVertexData[this._extrusionVertexCount]=c;++this._extrusionVertexCount};a.prototype.emitNormal=function(a,b,c){k.vec3.normalize(w,b);this.normalData[3*this._extrusionNormalCount+0]=w[0];this.normalData[3*this._extrusionNormalCount+1]=w[1];this.normalData[3*this._extrusionNormalCount+
2]=w[2];++this._extrusionNormalCount};a.prototype.buildGeometry=function(){for(var a=this.emitVertex.bind(this),b=this.emitNormal.bind(this),c=this._extrusionNormalCount=this._extrusionVertexCount=0;c<this.profile.vertices.length;++c)this.extruder.extrude(this.profile.vertices[c],this.path,a);if(this.profile.hasNormals())for(a=0;a<this.profile.normals.length;++a)this.extruder.extrude(this.profile.normals[a],this.path,b);else for(a=0;a<this._extrusionVertexCount;++a)k.vec3.set(w,this.directionData[4*
a+0],this.directionData[4*a+1],this.directionData[4*a+2]),k.vec3.normalize(w,w),this.normalData[3*this._extrusionNormalCount+0]=w[0],this.normalData[3*this._extrusionNormalCount+1]=w[1],this.normalData[3*this._extrusionNormalCount+2]=w[2],++this._extrusionNormalCount;this._capNormalsOffset=this._extrusionNormalCount;b=this.path.vertices[0];a=this.path.vertices[this.path.vertices.length-1];this.normalData[3*this._extrusionNormalCount+0]=-b.vRight[0];this.normalData[3*this._extrusionNormalCount+1]=
-b.vRight[1];this.normalData[3*this._extrusionNormalCount+2]=-b.vRight[2];++this._extrusionNormalCount;this.normalData[3*this._extrusionNormalCount+0]=a.vRight[0];this.normalData[3*this._extrusionNormalCount+1]=a.vRight[1];this.normalData[3*this._extrusionNormalCount+2]=a.vRight[2];++this._extrusionNormalCount;if(this.profile.hasUV()&&this.options.generateUV)for(a=0;a<this.profile.uvs.length;++a)this.uvData[2*a+0]=this.profile.uvs[a],this.uvData[2*a+1]=0};a.prototype.buildTopology=function(){var a=
this.profile.numSegments,b=this._numExtrusionVertices-1,c=a*b*6;2<this.profile.vertices.length&&(c+=6*(this.profile.vertices.length-2));this.vertexIndices=new Uint32Array(c);this.normalIndices=new Uint32Array(c);this.pathVertexIndices=new Uint32Array(c);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(c));for(var e=c=0;e<a;++e){var d=this.profile.vertexIndices[2*e],f=this.profile.vertexIndices[2*e+1],g=d,h=f,k=0,l=0;this.profile.hasNormals()&&(g=this.profile.normalIndices[2*
e],h=this.profile.normalIndices[2*e+1]);this.profile.hasUV()&&this.options.generateUV&&(k=this.profile.uvIndices[2*e],l=this.profile.uvIndices[2*e+1]);for(var m=0;m<b;++m){var p=d*this._numExtrusionVertices+m,n=d*this._numExtrusionVertices+m+1,r=f*this._numExtrusionVertices+m+1,v=f*this._numExtrusionVertices+m,u=g*this._numExtrusionVertices+m,x=g*this._numExtrusionVertices+m+1,q=h*this._numExtrusionVertices+m+1,y=h*this._numExtrusionVertices+m,w=k,A=k,C=l,B=l;this.vertexIndices[3*c+0]=p;this.vertexIndices[3*
c+1]=n;this.vertexIndices[3*c+2]=r;this.pathVertexIndices[3*c+0]=this.pathVertexData[p];this.pathVertexIndices[3*c+1]=this.pathVertexData[n];this.pathVertexIndices[3*c+2]=this.pathVertexData[r];this.normalIndices[3*c+0]=u;this.normalIndices[3*c+1]=x;this.normalIndices[3*c+2]=q;this.vertexIndices[3*c+3]=p;this.vertexIndices[3*c+4]=r;this.vertexIndices[3*c+5]=v;this.pathVertexIndices[3*c+3]=this.pathVertexData[p];this.pathVertexIndices[3*c+4]=this.pathVertexData[r];this.pathVertexIndices[3*c+5]=this.pathVertexData[v];
this.normalIndices[3*c+3]=u;this.normalIndices[3*c+4]=q;this.normalIndices[3*c+5]=y;this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices[3*c+0]=w,this.uvIndices[3*c+1]=A,this.uvIndices[3*c+2]=C,this.uvIndices[3*c+3]=w,this.uvIndices[3*c+4]=C,this.uvIndices[3*c+5]=B);c+=2}}if(2<this.profile.vertices.length)for(a=this.profile.vertices.length-2,d=0,b=d*this._numExtrusionVertices+0,d=(d+1)*this._numExtrusionVertices-1,m=0;m<a;++m)f=m+1,e=f*this._numExtrusionVertices+0,f=(f+1)*this._numExtrusionVertices-
1,h=m+2,g=h*this._numExtrusionVertices+0,h=(h+1)*this._numExtrusionVertices-1,this.vertexIndices[3*c+0]=b,this.vertexIndices[3*c+1]=e,this.vertexIndices[3*c+2]=g,this.normalIndices[3*c+0]=this._capNormalsOffset+0,this.normalIndices[3*c+1]=this._capNormalsOffset+0,this.normalIndices[3*c+2]=this._capNormalsOffset+0,this.pathVertexIndices[3*c+0]=this.pathVertexData[b],this.pathVertexIndices[3*c+1]=this.pathVertexData[e],this.pathVertexIndices[3*c+2]=this.pathVertexData[g],++c,this.vertexIndices[3*c+
0]=h,this.vertexIndices[3*c+1]=f,this.vertexIndices[3*c+2]=d,this.normalIndices[3*c+0]=this._capNormalsOffset+1,this.normalIndices[3*c+1]=this._capNormalsOffset+1,this.normalIndices[3*c+2]=this._capNormalsOffset+1,this.pathVertexIndices[3*c+0]=this.pathVertexData[h],this.pathVertexIndices[3*c+1]=this.pathVertexData[f],this.pathVertexIndices[3*c+2]=this.pathVertexData[d],++c};return a}();b.Builder=r;r=function(){function a(a){this.builder=a}a.prototype.updateElevation=function(a){for(var b=this.builder.path.offset,
c=this.builder.originData,e=0;e<this.builder.numVerticesTotal;++e){var d=this.builder.path.vertices[this.builder.pathVertexData[e]];m[0]=c[3*e+0]+b[0];m[1]=c[3*e+1]+b[1];m[2]=c[3*e+2]+b[2];a.setAltitude(d.elevation,m);c[3*e+0]=m[0]-b[0];c[3*e+1]=m[1]-b[1];c[3*e+2]=m[2]-b[2]}};return a}();b.PathGeometry=r;var t=function(a){function b(b,c,e){b=a.call(this,b)||this;b.size=c;b.vertexAttributePosition=null;b.vertexAttributeNormal=null;b.vertexAttributeColor=null;b.vertexAttributePosition=new Float32Array(3*
b.builder.numVerticesTotal);b.vertexAttributeNormal=b.builder.normalData;b._bakeVertexPositions();e&&(b.vertexAttributeColor=new Uint8Array(4),b.vertexAttributeColor[0]=255*e[0],b.vertexAttributeColor[1]=255*e[1],b.vertexAttributeColor[2]=255*e[2],b.vertexAttributeColor[3]=255*(3<e.length?e[3]:1));return b}g(b,a);b.prototype._bakeVertexPositions=function(){for(var a=0;a<this.builder.numVerticesTotal;++a)this.vertexAttributePosition[3*a+0]=this.builder.originData[3*a+0]+this.builder.directionData[4*
a+0]*this.size,this.vertexAttributePosition[3*a+1]=this.builder.originData[3*a+1]+this.builder.directionData[4*a+1]*this.size,this.vertexAttributePosition[3*a+2]=this.builder.originData[3*a+2]+this.builder.directionData[4*a+2]*this.size};b.prototype.createGeometryData=function(){var a={};a[v.VertexAttrConstants.POSITION]=this.builder.vertexIndices;a[v.VertexAttrConstants.NORMAL]=this.builder.normalIndices;this.vertexAttributeColor&&(a[v.VertexAttrConstants.COLOR]=new Uint32Array(a[v.VertexAttrConstants.POSITION].length));
var b={};b[v.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition};b[v.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal};this.vertexAttributeColor&&(b[v.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor});return new n(b,a,n.DefaultOffsets,"triangle")};b.prototype.updateElevation=function(b){a.prototype.updateElevation.call(this,b);this._bakeVertexPositions()};return b}(r);b.StaticPathGeometry=t;r=function(a){function b(b,c,e,d){b=a.call(this,b)||
this;b.vvData=null;b.vvData=new Float32Array(4*b.builder.path.vertices.length);for(var f=0;f<b.builder.path.vertices.length;++f)b.vvData[4*f+0]=c,b.vvData[4*f+1]=e,b.vvData[4*f+2]=d,b.vvData[4*f+3]=0;return b}g(b,a);b.prototype.createGeometryData=function(){var a={};a[v.VertexAttrConstants.POSITION]=this.builder.vertexIndices;a[v.VertexAttrConstants.AUXPOS1]=this.builder.vertexIndices;a[v.VertexAttrConstants.NORMAL]=this.builder.normalIndices;a[v.VertexAttrConstants.AUXPOS2]=this.builder.pathVertexIndices;
var b={};b[v.VertexAttrConstants.POSITION]={size:3,data:this.builder.originData};b[v.VertexAttrConstants.AUXPOS1]={size:4,data:this.builder.directionData};b[v.VertexAttrConstants.NORMAL]={size:3,data:this.builder.normalData};b[v.VertexAttrConstants.AUXPOS2]={size:4,data:this.vvData};this.builder.profile.hasUV()&&this.builder.options.generateUV&&(a[v.VertexAttrConstants.UV0]=this.builder.uvIndices,b[v.VertexAttrConstants.UV0]={size:2,data:this.builder.uvData});return new n(b,a,n.DefaultOffsets,"triangle")};
return b}(r);b.FastUpdatePathGeometry=r})(r||(r={}));var y=c.vec3f32.create(),w=c.vec3f32.create(),m=a.vec3f64.create(),x=c.vec3f32.create(),A=c.vec3f32.create(),C=c.vec3f32.create(),B=c.vec3f32.create(),E=b.mat4f32.create();return r})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/GLMaterialTexture ../lib/Material ../lib/Util ../lib/Util ./VisualVariableMaterialParameters ./internal/bufferWriters ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/PathPrograms ../../../webgl/renderState".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m){function x(a,b){b.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors));b.vvOpacityEnabled&&(a.setUniform1fv("vvOpacityValues",b.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",
b.vvOpacityOpacities))}var A=p.assert;t=function(a){function b(c,e){e=a.call(this,e)||this;e.supportsEdges=!0;e.params=r.copyParameters(c,L);e.vertexBufferLayout=b.getVertexBufferLayout(e.params);e.textureMode=c.textureId?c.atlasRegions?"AtlasTextured":"Textured":"none";return e}g(b,a);b.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};b.prototype.isVisible=function(){var b=this.params;if(!a.prototype.isVisible.call(this)||0===b.layerOpacity)return!1;var c=b.symbolColors,
e="replace"===b.colorMixMode,d=0<b.opacity,f=b.externalColor&&0<b.externalColor[3];return b.vvColorEnabled||c?e?!0:d:e?f:d};b.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"textureId"===c&&A(b.textureId,"Can only change texture of material that already has a texture"),"wireframe"===c&&A(b.wireframe,"wireframe flag affects drawmode (lines instead of triangles) and therefore can only be set during contruction"),"atlasRegions"===c&&A(a.atlasRegions===b.atlasRegions,"Can not change texture atlas mode."),
!a[c]||"vvSizeMinSize"!==c&&"vvSizeMaxSize"!==c&&"vvSizeOffset"!==c&&"vvSizeFactor"!==c?b[c]=a[c]:l.vec3.set(b[c],a[c][0],a[c][1],a[c][2]);this.notifyDirty("matChanged")};b.prototype.getParameters=function(){return this.params};b.prototype.computeVertexPosition=function(a,b,c,e){l.vec3.copy(e,b);if(this.params.vvSizeEnabled){l.vec3.copy(O,this.params.vvSizeFactor);l.vec3.scale(O,O,c);l.vec3.add(O,O,this.params.vvSizeOffset);b=O;c=this.params.vvSizeMinSize;var d=this.params.vvSizeMaxSize;b[0]=Math.min(Math.max(b[0],
c[0]),d[0]);b[1]=Math.min(Math.max(b[1],c[1]),d[1]);b[2]=Math.min(Math.max(b[2],c[2]),d[2]);l.vec3.multiply(e,e,O)}else l.vec3.scale(e,e,this.params.size);l.vec3.add(e,e,a)};b.prototype.intersectTriangles=function(a,b,c,e,d,f,g,h,k,m,p){var n=a[0],v=a[1];a=a[2];var u=b[0]-n,x=b[1]-v;for(b=b[2]-a;c<e;c++){var q=m?m[c]:c,y=g.offsetIdx+g.strideIdx*d[3*q],w=g.offsetIdx+g.strideIdx*d[3*q+1],A=g.offsetIdx+g.strideIdx*d[3*q+2],C=h.offsetIdx+h.strideIdx*d[3*q],B=h.offsetIdx+h.strideIdx*d[3*q+1],t=h.offsetIdx+
h.strideIdx*d[3*q+2],E=0;this.params.vvSizeEnabled&&(E=k.data[k.offsetIdx+k.strideIdx*f[3*q]]);l.vec3.set(U,g.data[y],g.data[y+1],g.data[y+2]);l.vec3.set(N,h.data[C],h.data[C+1],h.data[C+2]);this.computeVertexPosition(U,N,E,P);var J=P[0],C=P[1],y=P[2];l.vec3.set(U,g.data[w],g.data[w+1],g.data[w+2]);l.vec3.set(N,h.data[B],h.data[B+1],h.data[B+2]);this.computeVertexPosition(U,N,E,P);var F=P[0],B=P[1],w=P[2];l.vec3.set(U,g.data[A],g.data[A+1],g.data[A+2]);l.vec3.set(N,h.data[t],h.data[t+1],h.data[t+
2]);this.computeVertexPosition(U,N,E,P);var A=F-J,t=B-C,E=w-y,w=P[0]-J,B=P[1]-C,F=P[2]-y,G=x*F-B*b,R=b*w-F*u,I=u*B-w*x,L=A*G+t*R+E*I,J=n-J,T=v-C,K=a-y,y=T*E-t*K,C=K*A-E*J,O=J*t-A*T;if(L>Q){J=J*G+T*R+K*I;if(0>J||J>L)continue;G=u*y+x*C+b*O;if(0>G||J+G>L)continue}else if(L<-Q){J=J*G+T*R+K*I;if(0<J||J<L)continue;G=u*y+x*C+b*O;if(0<G||J+G<L)continue}else continue;y=(w*y+B*C+F*O)/L;0<=y&&(A=r.computeNormal(A,t,E,w,B,F,V),p(y,A,q))}};b.prototype.intersect=function(a,b,c,e,d,g,k,l){"triangle"===a.data.primitiveType&&
(b=0,b=this.params.vvSizeEnabled?Math.max(this.params.vvSizeMaxSize[0],Math.max(this.params.vvSizeMaxSize[1],this.params.vvSizeMaxSize[2])):this.params.size,b=f.fromValues(a.boundingInfo.bbMin[0]-b,a.boundingInfo.bbMin[1]-b,a.boundingInfo.bbMin[2]-b,a.boundingInfo.bbMax[0]+b,a.boundingInfo.bbMax[1]+b,a.boundingInfo.bbMax[2]+b),c=[g[0]-d[0],g[1]-d[1],g[2]-d[2]],l=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]),r.intersectAabbInvDir(b,d,[l/c[0],l/c[1],l/c[2]],e.tolerance)&&this.intersectTriangles(d,g,0,a.indexCount/
3,a.getIndices(h.VertexAttrConstants.POSITION),a.getIndices(h.VertexAttrConstants.AUXPOS2),a.getAttribute(h.VertexAttrConstants.POSITION),a.getAttribute(h.VertexAttrConstants.AUXPOS1),a.getAttribute(h.VertexAttrConstants.AUXPOS2),null,k))};b.prototype.createBufferWriter=function(){return new F(this.vertexBufferLayout)};b.prototype.createRenderer=function(a,b){return new y(a,b,this)};b.prototype.getGLMaterials=function(){return{color:C,depth:B,depthShadowMap:this.params.castShadows?E:null,normal:I,
highlight:G}};b.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]};b.getVertexBufferLayout=function(a){var b=k.newLayout().vec3f("position").vec3f("normal");b.vec4f(h.VertexAttrConstants.AUXPOS1);a.textureId&&(b=b.vec2f("uv0"),a.atlasRegions&&(b=b.vec4u16("region",{glNormalized:!0})));a.symbolColors&&(b=b.vec4u8("symbolColor"));if(a.vvColorEnabled||a.vvSizeEnabled||a.vvOpacityEnabled)b=b.vec4f(h.VertexAttrConstants.AUXPOS2);return b};return b}(a);var C=
function(a){function b(b,c,e){var d=this,f=b.getParameters(),d=a.call(this,b,c,e,f.textureId,void 0,f.textureInitTransparent)||this;d.params=r.copyParameters(f);d.slot=d.params.transparent?6:4;d.textureMode=b.textureMode;d._createPrograms();d.selectPipeline();return d}g(b,a);b.prototype._createPrograms=function(){var a=this;this.programs=v.BindParametersMap.create(this.params,function(b){return a._createProgram(b)})};b.prototype._createProgram=function(a){var b=this.params;return this.programRep.getProgram(w.colorPass,
{textureMode:this.textureMode,symbolColors:b.symbolColors,flipV:b.flipV,doubleSided:b.doubleSided&&"normal"===b.doubleSidedType,windowOrderDoubleSided:b.doubleSided&&"winding-order"===b.doubleSidedType,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,vvOpacity:b.vvOpacityEnabled,verticalOffset:null!==b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,compressedNormals:b.compressedNormals,transparencyDiscard:b.transparent,
wireframe:b.wireframe})};b.prototype.selectPipeline=function(){var a=this.params;this.pipelineState=m.makePipelineState({blending:a.transparent&&m.separateBlendingParams(770,1,771,771),culling:M(a),polygonOffset:a.polygonOffset&&K,depthTest:{func:513},depthWrite:m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams})};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};b.prototype.getPrograms=function(){return v.BindParametersMap.programs(this.programs)};
b.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.slot=this.params.transparent?6:4;this.updateTexture(this.params.textureId);this._createPrograms();this.selectPipeline()};b.prototype.bind=function(a,b){var c=this.params,e=this.program=v.BindParametersMap.lookup(this.programs,b);a.bindProgram(e);a.setPipelineState(this.pipelineState);e.setUniform1f("size",c.size);e.setUniform3fv("ambient",c.ambient);e.setUniform3fv("diffuse",c.diffuse);e.setUniform3fv("specular",
c.specular);e.setUniform4fv("externalColor",c.externalColor);e.setUniform1i("colorMixMode",r.colorMixModes[c.colorMixMode]);e.setUniform1f("opacity",c.opacity);e.setUniform1f("layerOpacity",c.layerOpacity);r.bindVerticalOffset(c.verticalOffset,b,e);r.bindScreenSizePerspective(c.screenSizePerspective,e);x(e,c);this.bindTexture(a,e);"none"!==this.textureMode&&this.bindTextureSize(a,e)};b.prototype.release=function(a,b){};b.prototype.bindView=function(a,b){a=this.program=v.BindParametersMap.lookup(this.programs,
b);var c=this.params,e=b.origin;r.bindView(e,b.view,a);r.bindCamPos(e,b.viewInvTransp,a);c.slicePlaneEnabled&&r.bindSlicePlane(e,b.slicePlane,a);b.shadowMappingEnabled&&b.shadowMap.bindView(a,e)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return b}(c),B=function(a){function b(b,c,e,d){void 0===d&&(d=!1);c=a.call(this,
b,c,e,b.getParameters().textureId)||this;c.textureMode=b.textureMode;c.biased=d;c.updateParameters();return c}g(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(w.depthPass,{textureMode:this.textureMode,flipV:a.flipV,shadowMap:this.biased,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,
slice:a.slicePlaneEnabled,transparencyDiscard:a.transparent});this.pipelineState=m.makePipelineState({culling:M(a),polygonOffset:a.polygonOffset&&K,depthTest:{func:513},depthWrite:m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?6:4};b.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};
b.prototype.bind=function(a,b){var c=this.program,e=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);c.setUniform1f("size",e.size);c.setUniform2fv("nearFar",b.nearFar);r.bindVerticalOffset(e.verticalOffset,b,c);r.bindScreenSizePerspective(e.screenSizePerspective,c);x(c,e);this.bindTexture(a,c)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,e=b.origin;r.bindView(e,b.view,a);c.slicePlaneEnabled&&r.bindSlicePlane(b.origin,b.slicePlane,
a);c.screenSizePerspective&&r.bindCamPos(e,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return b}(c),E=function(a){function b(b,c,e){return a.call(this,b,c,e,!0)||this}g(b,a);return b}(B),I=function(a){function b(b,c,e){c=a.call(this,b,c,e,b.getParameters().textureId)||this;c.textureMode=b.textureMode;c.updateParameters();return c}g(b,a);b.prototype.beginSlot=
function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(w.normalPass,{textureMode:this.textureMode,flipV:a.flipV,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,compressedNormals:a.compressedNormals,transparencyDiscard:a.transparent});this.pipelineState=m.makePipelineState({polygonOffset:a.polygonOffset&&
K,culling:M(a),depthTest:{func:513},depthWrite:m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?6:4};b.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,e=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);c.setUniform1f("size",
e.size);this.bindTexture(a,c);r.bindVerticalOffset(e.verticalOffset,b,c);r.bindScreenSizePerspective(e.screenSizePerspective,c);x(c,e)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,e=b.origin;r.bindView(e,b.view,a);a.setUniformMatrix4fv("viewNormal",b.viewInvTransp);c.slicePlaneEnabled&&r.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&r.bindCamPos(e,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){a=this.program;
a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return b}(c),G=function(a){function b(b,c,e){c=a.call(this,b,c,e,b.getParameters().textureId)||this;c.textureMode=b.textureMode;c.updateParameters();return c}g(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){var a=this.params;
this.program=this.programRep.getProgram(w.highlightPass,{textureMode:this.textureMode,flipV:a.flipV,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,transparencyDiscard:a.transparent});this.pipelineState=m.makePipelineState({polygonOffset:a.polygonOffset&&K,culling:M(a),depthTest:{func:513},depthWrite:m.defaultDepthWriteParams,colorWrite:m.defaultColorWriteParams})};b.prototype.selectSlot=function(){this.slot=
this.params.transparent?6:4};b.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,e=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);c.setUniform1f("size",e.size);this.bindTexture(a,c);r.bindVerticalOffset(e.verticalOffset,b,c);r.bindScreenSizePerspective(e.screenSizePerspective,c);x(c,e)};b.prototype.release=
function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,e=b.origin;r.bindView(e,b.view,a);c.slicePlaneEnabled&&r.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&r.bindCamPos(e,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return b}(c),L=q({size:1,wireframe:!1,
textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,symbolColors:!1,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,compressedNormals:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,transparent:!1,polygonOffset:!1,atlasRegions:!1},n.Default),F=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=
function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices.position.length};a.prototype.write=function(a,b,c,d,f){if(h.VertexAttrConstants.AUXPOS1 in b.vertexAttr){var g=b.vertexAttr[h.VertexAttrConstants.AUXPOS1],k=b.indices[h.VertexAttrConstants.AUXPOS1];A(4===g.size);var l=d.getField(h.VertexAttrConstants.AUXPOS1,e.BufferViewVec4f);if(l)u.writeBufferVec4(k,g.data,l,f);else throw Error("unable to aquire view for "+h.VertexAttrConstants.AUXPOS1);
}if(h.VertexAttrConstants.AUXPOS2 in b.vertexAttr)if(g=b.vertexAttr[h.VertexAttrConstants.AUXPOS2],k=b.indices[h.VertexAttrConstants.AUXPOS2],A(4===g.size),l=d.getField(h.VertexAttrConstants.AUXPOS2,e.BufferViewVec4f))u.writeBufferVec4(k,g.data,l,f);else throw Error("unable to aquire view for "+h.VertexAttrConstants.AUXPOS2);u.writeDefaultAttributes(b,c,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,d,f)};return a}(),K={factor:2,units:2},M=function(a){var b;b=a.slicePlaneEnabled?
!1:a.cullFace?"none"!==a.cullFace:!a.transparent&&!a.doubleSided;return b&&{face:"front"===a.cullFace?1028:1029,mode:2305}},Q=Math.pow(2,-52),P=b.vec3f64.create(),O=b.vec3f64.create(),U=b.vec3f64.create(),N=b.vec3f64.create(),V=b.vec3f64.create();return t})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4f64","../../../../core/libs/gl-matrix-2/vec3f32"],function(t,d,q,g){var l;(l||(l={})).Default=
{vvSizeEnabled:!1,vvSizeMinSize:g.vec3f32.fromValues(1,1,1),vvSizeMaxSize:g.vec3f32.fromValues(100,100,100),vvSizeOffset:g.vec3f32.fromValues(0,0,0),vvSizeFactor:g.vec3f32.fromValues(1,1,1),vvSizeValue:g.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:q.mat4f64.create()};
return l})},"esri/views/3d/webgl-engine/shaders/PathPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=function(b){return l.glslifyDefineMap({TEXTURING:"none"!==b.textureMode,TEXTURE_ATLAS:"AtlasTextured"===b.textureMode,SYMBOLVERTEXCOLORS:b.symbolColors,FLIPV:b.flipV,DOUBLESIDED:b.doubleSided,WINDINGORDERDOUBLESIDED:b.windowOrderDoubleSided,
RECEIVE_SHADOWS:b.receiveShadows,RECEIVE_SSAO:b.receiveSSAO,VV_SIZE:b.vvSize,VV_COLOR:b.vvColor,VV_OPACITY:b.vvOpacity,SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,SLICE:b.slice,COMPRESSED_NORMALS:b.compressedNormals,COMPONENTCOLORS:b.componentColor,TRANSPARENCY_DISCARD:b.transparencyDiscard,BIAS_SHADOWMAP:b.shadowMap,WIREFRAME:b.wireframe})};d.colorPass={name:"path-color",shaders:function(d){return{vertexShader:b(d)+g.resolveIncludes("materials/pathMaterial/colorPass.vert"),fragmentShader:b(d)+
g.resolveIncludes("materials/pathMaterial/colorPass.frag")}},attributes:q.Default3D};d.depthPass={name:"path-depth",shaders:function(d){return{vertexShader:b(d)+g.resolveIncludes("materials/pathMaterial/depthPass.vert"),fragmentShader:b(d)+g.resolveIncludes("materials/pathMaterial/depthPass.frag")}},attributes:q.Default3D};d.normalPass={name:"path-normal",shaders:function(d){return{vertexShader:b(d)+g.resolveIncludes("materials/pathMaterial/normalPass.vert"),fragmentShader:b(d)+g.resolveIncludes("materials/pathMaterial/normalPass.frag")}},
attributes:q.Default3D};d.highlightPass={name:"path-highlight",shaders:function(d){return{vertexShader:b(d)+g.resolveIncludes("materials/pathMaterial/highlightPass.vert"),fragmentShader:b(d)+g.resolveIncludes("materials/pathMaterial/highlightPass.frag")}},attributes:q.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/ColorMaterial".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function k(a,b,c,e){a=d.call(this,a,b,c,e)||this;a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};a._prepareFillResources();a._prepareOutlineResources();a.resolve();return a}q(k,d);k.prototype._prepareFillResources=function(){var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),b={color:b,transparent:1>b[3]||this._isPropertyDriven("opacity"),
polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new E(b,a+"_colormat");this._context.stage.add(w.ModelContentType.MATERIAL,this._material)};k.prototype._prepareOutlineResources=function(){var a=this.symbolLayer.outline;if(this._hasOutline=!!(a&&a.size&&0<a.size&&a.color))a={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:l.pt2px(a.size),slicePlaneEnabled:this._context.slicePlaneEnabled},this._outlineMaterial=1.5<=a.width?
y.createRibbonMaterial(a):y.createNativeMaterial(a),this._context.stage.add(w.ModelContentType.MATERIAL,this._outlineMaterial)};k.prototype.destroy=function(){d.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(w.ModelContentType.MATERIAL,this._material.id),this._material=null);this._outlineMaterial&&(this._context.stage.remove(w.ModelContentType.MATERIAL,this._outlineMaterial.id),this._outlineMaterial=null)};k.prototype.createGraphics3DGraphic=
function(a){var b=a.graphic,c=b.geometry.type;if("polyline"!==c&&"polygon"!==c&&"extent"!==c)return this._logWarning("unsupported geometry type for fill symbol: "+c),null;if(!this._validateGeometry(b.geometry))return null;c="graphic"+b.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var e=this.getGraphicElevationContext(b);return"on-the-ground"===e.mode?this._createAsOverlay(b,a,e,c):this._createAs3DShape(b,a,e,c,b.uid)};k.prototype.layerOpacityChanged=function(){var a=this._material.getColor(),
b=this._getMaterialOpacity();this._material.setColor([a[0],a[1],a[2],b]);this._material.setTransparent(1>b||this._isPropertyDriven("opacity"));this._outlineMaterial&&(a=this._outlineMaterial.getColor(),a={color:[a[0],a[1],a[2],this._getOutlineOpacity()]},this._outlineMaterial.setParameterValues(a));return!0};k.prototype.layerElevationInfoChanged=function(a,b,c){var e=this._elevationContext.mode;if(null==c||null==e)return!1;if("on-the-ground"===c&&"on-the-ground"===e)return!0;if(c!==e&&("on-the-ground"===
c||"on-the-ground"===e))return!1;var d=u.needsElevationUpdates2D(e);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return d})};k.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._outlineMaterial&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};k.prototype.pixelRatioChanged=function(a,b){return!0};k.prototype.setDrawOrder=function(a,b,
c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a+b/2,c.add(this._material.id));this._outlineMaterial&&(this._outlineMaterial.renderPriority=a,c.add(this._outlineMaterial.id))};k.prototype._createAs3DShape=function(a,b,c,e,d){var f=this._getPolyGeometry(a);a=f.rings;var g=this._getOutlineGeometry(f,a),f=u.getGeometryVertexData3D(g,f.hasZ,f.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,c);F.idHint=
e;F.color=b;F.data=f;var k;this._hasOutline&&(k=new f.vertexData.constructor(f.vertexData));F.outNum=0;F.outGeometries=[];F.outTransforms=[];F.outMaterials=[];this._createAs3DShapeFill(F);F.data.vertexData=k;this._createAs3DShapeOutline(F);this._logGeometryCreationWarnings(F.data,a,"rings","FillSymbol3DLayer");if(0===F.outNum)return null;b=new A({geometries:F.outGeometries,materials:F.outMaterials,transformations:F.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:d},
idHint:e});b=new n(this,b,F.outGeometries,null,null,h.perVertexElevationAligner,c);b.alignedTerrainElevation=f.terrainElevation;b.needsElevationUpdates=u.needsElevationUpdates2D(c.mode);return b};k.prototype._createAs3DShapeFill=function(a){for(var c=a.data.geometryData.polygons,d=a.data.eleVertexData,g=a.data.vertexData,h=function(h){var l=c[h];h=l.count;var p=l.index;if(k._context.clippingExtent&&(u.computeBoundingBox(d,p,h,I),u.boundingBoxClipped(I,k._context.clippingExtent)))return"continue";
var n=new Float64Array(d.buffer,3*p*d.BYTES_PER_ELEMENT,3*h),r=new Float64Array(g.buffer,3*p*g.BYTES_PER_ELEMENT,3*h),l=l.holeIndices.map(function(a){return a-p}),l=b(n,l,3);if(0===l.length)return"continue";u.chooseOrigin(g,p,h,G);u.subtractCoordinates(g,p,h,G);h=k._createFillGeometry(l,0,r,n,a.color);h=new m(h,a.idHint);h.singleUse=!0;n=e.mat4f64.create();f.mat4.translate(n,n,G);a.outGeometries.push(h);a.outMaterials.push(k._material);a.outTransforms.push(n);a.outNum++},k=this,l=0;l<c.length;++l)h(l)};
k.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var b=a.data.geometryData.outlines,c=a.data.eleVertexData,d=a.data.vertexData,g=0;g<b.length;++g){var h=b[g],k=h.index,l=h.count;if(this._context.clippingExtent&&(u.computeBoundingBox(c,k,l,I),u.boundingBoxClipped(I,this._context.clippingExtent)))continue;u.chooseOrigin(d,k,l,G);u.subtractCoordinates(d,k,l,G);h=new Float64Array(c.buffer,3*k*c.BYTES_PER_ELEMENT,3*l);k=new Float64Array(d.buffer,3*k*d.BYTES_PER_ELEMENT,3*l);k=y.createPolylineGeometry(k,
h,!1,L,0);k=new m(k,a.idHint+"outline"+g);k.singleUse=!0;h=e.mat4f64.create();f.mat4.translate(h,h,G);a.outGeometries.push(k);a.outMaterials.push(this._outlineMaterial);a.outTransforms.push(h);a.outNum++}};k.prototype._createAsOverlay=function(b,c,e,d){var f=this._getPolyGeometry(b);e=f.rings;var g=this._getOutlineGeometry(f,e);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);f=u.getGeometryVertexDataDraped(g,
f.spatialReference,this._context.overlaySR);F.idHint=d;F.color=c;F.data=f;var h;this._hasOutline&&(h=new f.vertexData.constructor(f.vertexData));F.outNum=0;F.outGeometries=[];F.outBoundingBox=a.empty();F.layerUid=this._context.layer.uid;F.graphicsUid=b.uid;this._createAsOverlayFill(F);F.data.vertexData=h;this._createAsOverlayOutline(F);this._logGeometryCreationWarnings(F.data,e,"rings","FillSymbol3DLayer");return 0<F.outNum?new p(this,F.outGeometries,F.outBoundingBox):null};k.prototype._createAsOverlayFill=
function(c){for(var d=c.data.vertexData,g=c.data.geometryData.polygons,h=function(h){var l=g[h];h=l.count;var m=l.index,p=new Float64Array(d.buffer,3*m*d.BYTES_PER_ELEMENT,3*h),l=l.holeIndices.map(function(a){return a-m}),p=b(p,l,3);if(0===p.length)return"continue";u.computeBoundingBox(d,m,h,I);if(u.boundingBoxClipped(I,k._context.clippingExtent))return"continue";a.expand(c.outBoundingBox,I);u.chooseOrigin(d,m,h,G);u.subtractCoordinates(d,m,h,G);u.setZ(d,m,h,k._getDrapedZ());h=e.mat4f64.create();
f.mat4.translate(h,h,G);p=k._createFillGeometry(p,m,d,null,c.color);l=new C(p);l.data.layerUid=c.layerUid;l.data.graphicUid=c.graphicsUid;l.material=k._material;var n=I;l.center=[.5*(n[0]+n[3]),.5*(n[1]+n[4]),0];l.bsRadius=.5*Math.sqrt((n[3]-n[0])*(n[3]-n[0])+(n[4]-n[1])*(n[4]-n[1]));l.transformation=h;l.name=c.idHint;l.uniqueName=c.idHint+"#"+p.id;c.outGeometries.push(l);c.outNum++},k=this,l=0;l<g.length;++l)h(l)};k.prototype._createAsOverlayOutline=function(b){if(this._hasOutline)for(var c=b.data.vertexData,
d=b.data.geometryData.outlines,g=0;g<d.length;++g){var h=d[g],k=h.index,h=h.count;u.computeBoundingBox(c,k,h,I);if(!u.boundingBoxClipped(I,this._context.clippingExtent)){a.expand(b.outBoundingBox,I);u.chooseOrigin(c,k,h,G);u.subtractCoordinates(c,k,h,G);u.setZ(c,k,h,this._getDrapedZ());h=new Float64Array(c.buffer,3*k*c.BYTES_PER_ELEMENT,3*h);k=e.mat4f64.create();f.mat4.translate(k,k,G);var h=y.createPolylineGeometry(h,null,!0,L,0),l=new C(h);l.data.layerUid=b.layerUid;l.data.graphicUid=b.graphicsUid;
l.material=this._outlineMaterial;var m=I;l.center=[.5*(m[0]+m[3]),.5*(m[1]+m[4]),0];l.bsRadius=.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]));l.transformation=k;l.name=b.idHint+"outline";l.uniqueName=b.idHint+"outline#"+h.id;b.outGeometries.push(l);b.outNum++}}};k.prototype._getOutlineGeometry=function(a,b){return b};k.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbolLayer.outline.color.a};k.prototype._getOutlineColor=function(){var a=this.symbolLayer.outline.color,
b=this._getOutlineOpacity();return r.mixinColorAndOpacity(g.toUnitRGB(a),b)};k.prototype._getPolyGeometry=function(a){a=a.geometry;return"extent"===a.type?c.fromExtent(a):a};k.prototype._createFillGeometry=function(a,b,c,e,d){for(var f=a.length,g=new Uint32Array(f),h=new Uint32Array(f),k=0;k<f;k++)g[k]=a[k]+b,h[k]=0;a={};b={};a[B.VertexAttrConstants.POSITION]=g;a[B.VertexAttrConstants.COLOR]=h;b[B.VertexAttrConstants.POSITION]={size:3,data:c};b[B.VertexAttrConstants.COLOR]={size:4,data:d};e&&(b.mapPos=
{size:3,data:e},a.mapPos=g);return new x(b,a)};return k}(v.default);d.Graphics3DPolygonFillSymbolLayer=t;var I=a.create(),G=k.vec3f64.create(),L=new Float32Array([255,255,255,255]),F={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};d.default=t})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r){function y(a,b,c){a&&a.forEach(function(a){var e=b(a);e&&c(e,a.graphic)})}Object.defineProperty(d,"__esModule",{value:!0});var w=[0,0,1];t=function(a){function d(b,c,e,d){b=a.call(this,b,c,e,d)||this;b._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};if(!b._isPropertyDriven("size")&&(c=h.validateSymbolLayerSize(b.symbolLayer.size)))return b._logWarning(c),b.reject(),b;b._createTextRenderParameters();b.resolve();return b}q(d,a);d.prototype._createTextRenderParameters=
function(){this._textRenderParameters=u.default.fromSymbol(this.symbolLayer,this._context.layerView.view.pixelRatio)};d.prototype.destroy=function(){a.prototype.destroy.call(this);this.isFulfilled()||this.reject()};d.prototype.createGraphics3DGraphic=function(a){a=a.graphic;var b=c.placePointOnGeometry(a.geometry);if(!b)return this._logWarning("unsupported geometry type for text symbol: "+a.geometry.type),null;var e=this.symbolLayer.text;if(!e)return null;var d=f.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?
this.symbol:null;return this._createAs3DShape(a,b,e,d)};d.prototype.createLabel=function(a,b,e,d){a=a.graphic;var f=c.placePointOnGeometry(a.geometry);if(!f)return this._logWarning("unsupported geometry type for label: "+a.geometry.type),null;var g=b.text;return g?this._createAs3DShape(a,f,g,b,b,e,d):null};d.prototype.getGraphicElevationContext=function(b,c){void 0===c&&(c=0);b=a.prototype.getGraphicElevationContext.call(this,b);b.addOffsetRenderUnits(c);return b};d.prototype.layerOpacityChanged=
function(){this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};d.prototype.layerElevationInfoChanged=function(a,b){var c=this;y(a,b,function(a,b){c.updateGraphicElevationContext(b,a)});return!0};d.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;y(a,b,function(a){var b=0;for(a=a.stageObject.geometryRecords;b<a.length;b++)a[b].material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});return!0};d.prototype.pixelRatioChanged=
function(a,b){return!1};d.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=c.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};d.prototype._defaultElevationInfoNoZ=function(){return m};d.prototype._createAs3DShape=function(a,d,f,m,u,q,y){void 0===u&&(u=x);var A=this.getGraphicElevationContext(a,u.elevationOffset),C=this._context.layer.id+"_label_"+a.uid,B="polyline"===
a.geometry.type,t=a.uid;a=this._context.stage.view.renderingContext;var E=h.namedAnchorToHUDMaterialAnchorPos[u.anchor in h.namedAnchorToHUDMaterialAnchorPos?u.anchor:"center"];a=g.isNone(y)?new v(a,f,this._textRenderParameters,C):null;E={occlusionTest:!0,screenOffset:u.screenOffset,anchorPos:E,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:u.centerOffsetUnits,debugDrawBorder:u.debugDrawBorder,drawInSecondSlot:!0};g.isSome(a)&&(E.textureId=a.id,E.texCoordScale=a.texcoordScale);g.isSome(y)&&(E.textureId=
y.textureId);if(g.isSome(m)&&g.isSome(m.verticalOffset)){m=m.verticalOffset;var F=m.minWorldLength,G=m.maxWorldLength;E.verticalOffset={screenLength:l.pt2px(m.screenLength),minWorldLength:F||0,maxWorldLength:null!=G?G:Infinity}}this._context.screenSizePerspectiveEnabled&&(m=this._context.sharedResources,F=m.screenSizePerspectiveSettings,E.screenSizePerspective=m.screenSizePerspectiveSettingsLabels.overridePadding(this._textRenderParameters.haloSize),E.screenSizePerspectiveAlignment=F);B&&(E.shaderPolygonOffset=
1E-4);E.slicePlaneEnabled=this._context.slicePlaneEnabled;B=null;m=JSON.stringify(E);g.isSome(q)?(B=q.getMaterial(m),null==B&&(B=new r(E,C),q.addMaterial(m,B))):B=new r(E,C);B=[B];y=n.createPointGeometry(w,u.translation,void 0,g.isSome(a)?[a.displayWidth,a.displayHeight]:[0,0],u.centerOffset,g.isSome(y)?[0,0]:null);y=[new p(y,C)];C=c.createStageObjectForPoint(this._context,d,y,B,null,null,A,C,this._context.layer.uid,t,!0);if(null===C)return null;t=e.perObjectElevationAligner;q=new k(this,C.object,
y,g.isNone(q)?B:null,g.isSome(a)?[a]:null,t,A);q.alignedTerrainElevation=C.terrainElevation;q.needsElevationUpdates=c.needsElevationUpdates2D(A.mode)||"absolute-height"===A.mode;var A=g.isSome(a)?a:u,I=A.displayWidth,J=A.displayHeight;q.getScreenSize=function(a){void 0===a&&(a=b.vec2f64.create());a[0]=I;a[1]=J;return a};q.metadata={labelText:f,elevationOffset:u.elevationOffset};c.extendPointGraphicElevationContext(q,d,this._context.elevationProvider);return q};return d}(a.default);d.Graphics3DTextSymbolLayer=
t;var m={mode:"relative-to-ground",offset:0},x={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};d.default=t})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define(["require","exports","../../../../Color","../../../../core/screenUtils"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function b(b){this.definition=
b;this.key=JSON.stringify(b);this.haloSize=Math.round(b.halo.size);this.fillStyle=this.colorToRGBA(b.color);this.haloStyle=this.colorToRGB(b.halo.color)}b.prototype.colorToRGB=function(b){return"rgb("+b.slice(0,3).map(function(b){return Math.floor(255*b)}).toString()+")"};b.prototype.colorToRGBA=function(b){return"rgba("+b.slice(0,3).map(function(b){return Math.floor(255*b)}).toString()+","+b[3]+")"};b.fromSymbol=function(d,e){void 0===e&&(e=1);var f=d.material?q.toUnitRGBA(d.material.color):l,c=
d.halo&&d.halo.color&&0<d.halo.size,a=null!=d.size?g.pt2px(d.size):12,h={family:d.font&&d.font.family?d.font.family:"sans-serif",weight:d.font&&d.font.weight?d.font.weight:"normal",style:d.font&&d.font.style?d.font.style:"normal"};d={size:c?g.pt2px(d.halo.size):0,color:c?q.toUnitRGBA(d.halo.color):l};return new b({size:a,color:f,font:h,halo:d,pixelRatio:e})};return b}();d.TextRenderParameters=t;var l=[1,1,1,1];d.default=t})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ../../../../core/mathUtils ./TextRenderer ./Texture ../../../webgl/Texture ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(t,d,q,g,l,b,f){var e={canvas:null};return function(){function d(b,a,e,d){this._idHint=d;this._requiresPowerOfTwo=!f.default(b.gl);this._renderer=new g.default(a,e)}Object.defineProperty(d.prototype,"id",{get:function(){null==this._id&&(this._id=l.idGen.gen(this._idHint));return this._id},enumerable:!0,configurable:!0});d.prototype.deferredLoading=function(){return!1};d.prototype.getWidth=function(){return this._renderer.renderedWidth};d.prototype.getHeight=function(){return this._renderer.renderedHeight};
Object.defineProperty(d.prototype,"textureWidth",{get:function(){var b=this.getWidth();return this._requiresPowerOfTwo?q.nextHighestPowerOfTwo(b):b},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"textureHeight",{get:function(){var b=this.getHeight();return this._requiresPowerOfTwo?q.nextHighestPowerOfTwo(b):b},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"displayWidth",{get:function(){return this._renderer.displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"displayHeight",{get:function(){return this._renderer.displayHeight},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"texcoordScale",{get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]},enumerable:!0,configurable:!0});d.prototype.initializeThroughRender=function(c,a){var d=g.getTextHelperCanvas(e,this.textureWidth,this.textureHeight),f=d.getContext("2d");f.save();a.samplingMode=9987;a.wrapMode=33071;a.flipped=!0;
a.preMultiplyAlpha=!0;a.hasMipmap=!0;this._renderer.render(f,0,this.textureHeight-this._renderer.renderedHeight);c=new b(c,a,d);f.restore();return c};d.prototype.setUnloadFunc=function(b){this._unloadFunc=b};d.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)};return d}()})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["require","exports","../../../../core/maybe","./TextRenderParameters"],function(t,d,q,g){function l(b,a,e){b.canvas||
(b.canvas=document.createElement("canvas"));b.canvas.width=a;b.canvas.height=e;return b.canvas}Object.defineProperty(d,"__esModule",{value:!0});t=function(){function c(a,b,c){void 0===c&&(c=2048);this.text=a;this.maxSize=c;this._displayWidth=this._renderPixelRatio=null;this.parameters=b instanceof g.default?b:new g.default(b);this.key=this.parameters.key+"--"+a;this.textLines=a.split(/\r?\n/);this.lineHeight=this.computeLineHeight()}Object.defineProperty(c.prototype,"displayWidth",{get:function(){q.isNone(this._displayWidth)&&
(this._displayWidth=this.computeTextWidth());return this._displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"displayHeight",{get:function(){return this.lineHeight*this.textLines.length},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedWidth",{get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedHeight",{get:function(){return Math.round(this.displayHeight*
this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedLineHeight",{get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedFontSize",{get:function(){return this.parameters.definition.size*this.renderPixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedHaloSize",{get:function(){return this.parameters.haloSize*this.renderPixelRatio},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderPixelRatio",{get:function(){if(q.isNone(this._renderPixelRatio)){var a=this.parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(a,Math.min(this.maxSize/(this.displayWidth*a),this.maxSize/(this.displayHeight*a))):a}return this._renderPixelRatio},enumerable:!0,configurable:!0});c.prototype.render=function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=0);var e=this.renderedLineHeight,d=this.renderedHaloSize,
f=a.textAlign,g=this.renderedWidth,f=("center"===f?.5*g:"right"===f?g:0)+d;a.save();0<d&&this.renderHalo(a,f,d,b,c);this.setFontProperties(a,this.renderedFontSize);c+=d;b+=f;d=0;for(f=this.textLines;d<f.length;d++)g=f[d],a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",a.fillText(g,b,c),a.globalCompositeOperation="source-over",a.fillStyle=this.parameters.fillStyle,a.fillText(g,b,c),c+=e;a.restore()};c.prototype.renderHalo=function(a,b,c,d,f){var g=this.renderedWidth,h=this.renderedHeight,
p=l(e,Math.max(g,k),Math.max(h,k)),n=p.getContext("2d");n.clearRect(0,0,g,h);this.setFontProperties(n,this.renderedFontSize);n.fillStyle=this.parameters.haloStyle;n.strokeStyle=this.parameters.haloStyle;var m=3>this.renderedHaloSize;n.lineJoin=m?"miter":"round";m?this.renderHaloEmulated(n,b,c):this.renderHaloNative(n,b,c);a.globalAlpha=this.parameters.definition.halo.color[3];a.drawImage(p,0,0,g,h,d,f,g,h);a.globalAlpha=1};c.prototype.renderHaloEmulated=function(a,c,e){for(var d=this.renderedLineHeight,
f=this.renderedHaloSize,g=0,h=this.textLines;g<h.length;g++){for(var k=h[g],l=0,m=b;l<m.length;l++){var p=m[l];a.fillText(k,c+f*p[0],e+f*p[1])}e+=d}};c.prototype.renderHaloNative=function(a,b,c){for(var e=this.renderedLineHeight,d=this.renderedHaloSize,f=0,g=this.textLines;f<g.length;f++){for(var h=g[f],k=2*d,l=0;5>l;l++)a.lineWidth=(.6+.1*l)*k,a.strokeText(h,b,c);c+=e}};c.prototype.setFontProperties=function(a,b){var c=this.parameters.definition.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family+
", sans-serif";a.textAlign="left";a.textBaseline="top"};c.prototype.computeTextWidth=function(){var a=l(e,k,k).getContext("2d");this.setFontProperties(a,this.parameters.definition.size);for(var b=0,c=0,d=this.textLines;c<d.length;c++)b=Math.max(b,a.measureText(d[c]).width);c=this.parameters.definition.font;if("italic"===c.style||"oblique"===c.style||"string"===typeof c.weight&&("bold"===c.weight||"bolder"===c.weight)||"number"===typeof c.weight&&600<c.weight)b+=.3*a.measureText("A").width;b+=2*this.parameters.haloSize;
return Math.round(b)};c.prototype.computeLineHeight=function(){return Math.floor(1.275*this.parameters.definition.size+2*this.parameters.haloSize)};return c}();d.TextRenderer=t;for(var b=[],f=0;360>f;f+=22.5)b.push([Math.cos(Math.PI*f/180),Math.sin(Math.PI*f/180)]);d.getTextHelperCanvas=l;var e={canvas:null},k=512;d.default=t})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./symbolComplexity","../../support/PromiseLightweight"],
function(t,d,q,g,l){return function(b){function d(e,d){var c=b.call(this)||this;c.symbol=e;c.graphics3DSymbol=null;c.referenced=0;e.fetchSymbol().then(function(a){if(c.isRejected())throw Error();a.id=c.symbol.id;c.graphics3DSymbol=d(a)}).then(function(){if(c.isRejected())throw Error();c.graphics3DSymbol.then(function(){c.isRejected()||c.resolve()},function(a){c.isRejected()||c.reject(a)})}).catch(function(a){c.isRejected()||c.reject(a)});return c}q(d,b);d.prototype.getSymbolLayerSize=function(b,d){d(null)};
d.prototype.createGraphics3DGraphic=function(b){return this.graphics3DSymbol.createGraphics3DGraphic(b,this)};Object.defineProperty(d.prototype,"complexity",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.complexity:g.emptySymbolComplexity},enumerable:!0,configurable:!0});d.prototype.globalPropertyChanged=function(b,d){return this.graphics3DSymbol.globalPropertyChanged(b,d)};d.prototype.applyRendererDiff=function(b,d){return this.graphics3DSymbol.applyRendererDiff(b,d)};d.prototype.prepareSymbolPatch=
function(b){this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(b)};d.prototype.updateGeometry=function(b,d){return this.graphics3DSymbol?this.graphics3DSymbol.updateGeometry(b,d):!1};d.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};d.prototype.setDrawOrder=function(b,d){this.graphics3DSymbol&&this.graphics3DSymbol.setDrawOrder(b,d)};d.prototype.destroy=function(){this.isFulfilled()||this.reject();
this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0};Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!0,configurable:!0});return d}(l.default)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){function p(b){return a.getGraphics3DSymbol(b.graphics3DGraphic.graphics3DSymbol).symbol.symbolLayers.getItemAt(0)}function n(a){var b=a.graphics3DGraphic.graphic.geometry.type;switch(b){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return"extrude"===p(a).type?x["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return x["above-center"];
case "mesh":return x["above-center"];default:q.neverReached(b)}}function u(a,b){null==m&&(w.log(a,b),m=l.schedule(function(){m.remove();m=null}))}function v(a,b,c){c=c.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace(I);c=e.vec3f64.fromValues(c[3]-c[0],c[4]-c[1],c[5]-c[2]);a.centerOffset[0]=1.1*Math.sqrt(c[0]*c[0]+c[1]*c[1])/2*b.normalizedOffset[0];var d=a.translation[2],g=c[2]/2*b.normalizedOffset[1];a.translation[2]=g*(1.1-1);a.elevationOffset=d+g;c=f.vec3.length(c);a.centerOffset[2]=1.1*
c/2*b.normalizedOffset[2]}function r(b){var c=b.labelClass.labelPlacement,e=b.labelSymbol,d=b.graphics3DGraphic,f=a.getGraphics3DSymbol(d.graphics3DSymbol).symbol;b=x[c]||n(b);if("point-3d"===f.type&&f.supportsCallout()&&f.hasVisibleVerticalOffset()&&!d.isDraped())return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:y(f.verticalOffset),anchor:null,normalizedOffset:null};if(e&&e.hasVisibleVerticalOffset()&&("point-3d"!==f.type||!f.supportsCallout()||!f.verticalOffset||d.isDraped())){a:switch(b.placement){case "above-center":d=
!0;break a;default:d=!1}return d?{placement:"above-center",verticalOffset:y(e.verticalOffset),anchor:"bottom",normalizedOffset:[0,b.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(u("error","Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+c+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function y(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,
maxWorldLength:a.maxWorldLength}}Object.defineProperty(d,"__esModule",{value:!0});var w=g.getLogger("esri.views.3d.layers.graphics.labelPlacement"),m=null;d.get=function(a){var d=r(a);if(!d)return null;var f;if(d.anchor)f=d;else{var g=a.labelClass.labelPlacement,l=x[g];f=l||n(a);g&&!l&&u("warn","the requested label placement '"+g+"' is not currently supported in SceneView");g=a.graphics3DGraphic.graphic.geometry.type;switch(g){case "polyline":case "polygon":case "extent":case "multipoint":a.labelClass.labelPlacement&&
(u("warn","the requested label placement '"+f.placement+"' is currently unsupported for '"+g+"' geometries in SceneView"),f=n(a));break;case "point":case "mesh":break;default:q.neverReached(g)}}g=!!d.hasLabelVerticalOffset;d={anchor:f.anchor,verticalOffset:d.verticalOffset,screenOffset:b.vec2f64.create(),centerOffset:k.vec4f64.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:e.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:g};switch(a.graphics3DGraphic.graphic.geometry.type){case "point":g=
a.graphics3DGraphic;l=p(a);g.getCenterObjectSpace(d.translation);switch(l.type){case "icon":case "text":l=a.graphics3DGraphic;g=l._graphics[0].getScreenSize();l.isDraped()?d.hasLabelVerticalOffset||"center"===d.anchor||(x[a.labelClass.labelPlacement]&&u("warn","the requested placement '"+f.placement+"' is currently unsupported for draped graphics"),d.anchor="center"):(l=void 0,void 0===l&&(l=E),a=a.graphics3DGraphic._graphics[0].stageObject.getGeometryRecords()[0].material,a instanceof h?(a=a.getParameters().anchorPos,
l[0]=2*(a[0]-.5),l[1]=2*(a[1]-.5)):(l[0]=0,l[1]=0),a=l,B[0]=g[0]/2*(f.normalizedOffset[0]-a[0]),B[1]=g[1]/2*(f.normalizedOffset[1]-a[1]),d.screenOffset[0]=B[0],d.hasLabelVerticalOffset?(d.centerOffset[1]=B[1],d.centerOffsetUnits="screen"):d.screenOffset[1]=B[1]);break;case "object":v(d,f,a)}break;case "polygon":switch(p(a).type){case "extrude":a.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace(I),c.center(I,d.translation),d.translation[2]=c.height(I)/2,v(d,f,a)}break;case "mesh":v(d,f,a)}return d};
var x={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},
"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},A={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],
"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};t=function(a){var b=x[a];A[a].forEach(function(a){x[a]=b})};for(var C in A)t(C);Object.freeze&&(Object.freeze(x),Object.keys(x).forEach(function(a){Object.freeze(x[a]);Object.freeze(x[a].normalizedOffset)}));var B=[0,0],E=[0,0],I=c.create()})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require",
"exports","./ModelContentType"],function(t,d,q){return function(){function d(d){this.materials={};this.stage=d}d.prototype.getMaterial=function(d){return this.materials[d]};d.prototype.addMaterial=function(d,b){this.materials[d]=b;this.stage.add(q.MATERIAL,b)};d.prototype.dispose=function(){for(var d in this.materials)this.stage.remove(q.MATERIAL,this.materials[d].id);this.materials={}};return d}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ../../../../core/iteratorUtils ../../../../core/mathUtils ./ModelContentType ./Texture ../../../webgl/Texture".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function a(a,c){this.dirty=!1;this.elementsToAdd=new Map;this.elementsToRemove=new Map;this.elementsToRender=new Map;this.elements=new Map;this.stageObjects=new Map;this.id=b.idGen.gen(a);this.stage=c._stage;this.scheduler=c.resourceController.scheduler;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");this.stage.add(l.TEXTURE,this);a=this.computeAtlasResolution(c.width,c.height);this.createAtlasRegion(a);
this.update2DCanvasSize()}a.prototype.setUnloadFunc=function(a){this.unloadFunc=a};a.prototype.unload=function(){null!=this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=null)};a.prototype.deferredLoading=function(){return!1};a.prototype.getWidth=function(){return this.atlas.size.width};a.prototype.getHeight=function(){return this.atlas.size.height};a.prototype.initializeThroughRender=function(a,b){var c=this;b.wrapMode=33071;b.samplingMode=9987;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=
!0;this.glTexture=new f(a,b,this.canvas);this.frameWorker=this.scheduler.registerTask(12,function(a){return c.run(c.makeRunContext(a))},function(){return c.dirty});return this.glTexture};a.prototype.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAdd=this.elements=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.glTexture&&(this.glTexture=null,this.stage.remove(l.TEXTURE,this.id))};a.prototype.create2DCanvas=function(){var a=document.createElement("canvas");
a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",(512).toString());return a};a.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};a.prototype.createAtlasRegion=function(a){void 0===a&&(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};a.prototype.computeAtlasResolution=
function(a,b){a=Math.max(a,b);a=g.nextHighestPowerOfTwo(a+256);return a=Math.min(a,4096)};a.prototype.resizeAtlas=function(a,b){b=b||a;var c=this.atlas;c.size.width=a;c.size.height=b;this.glTexture&&this.glTexture.resize(a,b);this.update2DCanvasSize()};a.prototype.resetAtlasCursor=function(){var a=this.atlas;a.cursor.x=e;a.cursor.y=e+k;a.lineHeight=0};a.prototype.getAtlasUsage=function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};a.prototype.getExpectedAtlasUsage=
function(){var a=this.elementsToRemove.size,b=this.elementsToAdd.size,c=this.elements.size;return this.getAtlasUsage()/c*(c+b-a)};a.prototype.addAtlasElement=function(a,b,c,e){var d=this.atlas,f=a.textRenderer,g=f.renderedWidth,h=f.renderedHeight,k=f.displayWidth,f=f.displayHeight;a.placement.offset.x=d.cursor.x;a.placement.offset.y=d.cursor.y;a.placement.size.width=g;a.placement.size.height=h;a.placement.size.displayWidth=k;a.placement.size.displayHeight=f;a.placement.uvMinMax=[a.placement.offset.x/
d.size.width,1-(a.placement.offset.y+h)/d.size.height,(a.placement.offset.x+g)/d.size.width,1-a.placement.offset.y/d.size.height];d.cursor.x+=c;d.lineHeight=Math.max(d.lineHeight,e);this.elements.set(b,a)};a.prototype.removeAtlasElement=function(a){if(a&&this.elements.has(a.textId)){var b=a.placement.offset,c=a.placement.size;this.ctx.clearRect(b.x,b.y,c.width,c.height);this.elements.delete(a.textId)}};a.prototype.ensureStageObjects=function(a){var b=this.stageObjects.get(a);b||(b=new Set,this.stageObjects.set(a,
b));return b};a.prototype.addStageObject=function(a,b){this.ensureStageObjects(a).add(b)};a.prototype.removeStageObject=function(a,b){(a=this.stageObjects.get(a))&&a.delete(b)&&(b.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),b.geometryVertexAttrsUpdated(0))};a.prototype.processAdditionRequest=function(a,b){var c=this.atlas,d=a.textId,f=a.textRenderer.renderedWidth+e,g=a.textRenderer.renderedHeight+e+k;b=b.repackingEnabled;if(c.cursor.x+f<c.size.width&&c.cursor.y+g<c.size.height)this.addAtlasElement(a,
d,f,g),this.elementsToRender.set(d,a),this.elementsToAdd.delete(d);else if(c.cursor.y+g+c.lineHeight<c.size.height)c.cursor.x=e,c.cursor.y+=c.lineHeight,c.lineHeight=0,this.addAtlasElement(a,d,f,g),this.elementsToRender.set(d,a),this.elementsToAdd.delete(d);else{a=this.getExpectedAtlasUsage();(d=.85<a&&4096>c.size.width)&&this.resizeAtlas(2*c.size.width,2*c.size.height);if(!b||!d&&.95<a&&4096===c.size.width)return this.processRemovals(),0;this.repack();return 1}return 0};a.prototype.processRemovals=
function(){var a=this;this.elementsToRemove.forEach(function(b,c){var e=a.stageObjects.get(c);e&&0!==e.size||a.removeAtlasElement(b);e&&0===e.size&&a.stageObjects.delete(c)});this.elementsToRemove.clear()};a.prototype.repack=function(){var a=this;this.processRemovals();this.elements.forEach(function(b,c){b.rendered=!1;a.elementsToAdd.set(c,b)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};a.prototype.processRenderingRequest=function(a){this.ctx.clearRect(a.placement.offset.x,
a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textRenderer.render(this.ctx,a.placement.offset.x,a.placement.offset.y);var b=this.stageObjects.get(a.textId);b&&b.forEach(function(b){b.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(a.placement.uvMinMax);b.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.displayWidth,a.placement.size.displayHeight]);b.geometryVertexAttrsUpdated(0)});a.rendered=!0};a.prototype.run=function(b){var c=
this;if(this.dirty&&this.glTexture){var e=b.budget,d=!1;q.everyMap(this.elementsToAdd,function(a,e){return(a=c.elements.get(e))&&a.rendered?((a=c.stageObjects.get(e))&&a.forEach(function(a){var b=a.geometries[0].data.vertexAttributes,d=c.elements.get(e);b.uv0.data=new Float32Array(d.placement.uvMinMax);b.size.data=new Float32Array([d.placement.size.displayWidth,d.placement.size.displayHeight]);a.geometryVertexAttrsUpdated(0)}),c.elementsToAdd.delete(e),!0):1===c.processAdditionRequest(c.elementsToAdd.get(e),
b)?(d=!0,!1):!0});if(d)b.budget=null,b.repackingEnabled=!1,this.run(b);else{var f=!1;q.everyMap(this.elementsToRender,function(a,b){c.processRenderingRequest(a);c.elementsToRender.delete(b);f=!0;return e&&(e.madeProgress(),e.done)?!1:!0});f&&this.glTexture.setData(this.canvas);this.dirty=0<this.elementsToRender.size;!this.dirty&&a.test.orderedRepackingEnabled&&this.repackOrdered()}}};a.prototype.makeRunContext=function(a){void 0===a&&(a=null);c.budget=a;c.repackingEnabled=!0;return c};a.prototype.addTextTexture=
function(a,b){var c=a.key;this.elementsToAdd.has(c)||this.elementsToAdd.set(c,{textId:c,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:a,rendered:!1});this.addStageObject(c,b);this.elementsToRemove.delete(c);this.setDirty()};a.prototype.removeTextTexture=function(a,b){a=a.key;this.elementsToRemove.set(a,this.elements.get(a));this.removeStageObject(a,b)};Object.defineProperty(a.prototype,"textureId",{get:function(){return this.id},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"isDirty",{get:function(){return this.dirty},enumerable:!0,configurable:!0});a.prototype.setDirty=function(){this.dirty=!0};Object.defineProperty(a.prototype,"test",{get:function(){return{elements:this.elements,stageObjects:this.stageObjects,elementsToRemove:this.elementsToRemove,atlas:this.atlas,resizeAtlas:this.resizeAtlas.bind(this)}},enumerable:!0,configurable:!0});a.prototype.repackOrdered=function(){if(0!==this.elements.size){var a=[];this.elements.forEach(function(b,
c){return a.push({element:b,key:c})});for(var b=!0,c=0;c<a.length-1;c++)if(0<a[c].key.localeCompare(a[c+1].key)){b=!1;break}if(!b){a.sort(function(a,b){return a.key.localeCompare(b.key)});this.elements.clear();for(b=0;b<a.length;b++)c=a[b],this.elements.set(c.key,c.element);this.repack();this.setDirty()}}};a.test={orderedRepackingEnabled:!1};return a}();d.TextTextureAtlas=t;var e=2,k=2,c={budget:null,repackingEnabled:!0};d.default=t})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/debugFlags ../../support/projectionUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v){Object.defineProperty(d,"__esModule",{value:!0});var r=e.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");t=function(e){function d(a){a=e.call(this,a)||this;a.tiles=new b;a.tileSize=512;a.disableThrottling=!1;a.idToTile=new Map;a.handles=new f;a.clients=new Set;a._dirty=!1;return a}q(d,e);Object.defineProperty(d.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))r.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.setDirty())}},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||!this.tilingScheme)return null;
var a=h.create();v.extentToBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),a||this.setDirty())},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"updating",{get:function(){return this.throttledUpdate.hasPendingUpdates()||this._dirty},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"changeId",{get:function(){var a=this._get("changeId")||0;return!this.hasClients||this.suspended?a:a+1},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this.throttledUpdate=k.throttle(this.setDirty,function(){return a.notifyChange("updating")},u.TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING?
100:1E3,this);var b=this.disableThrottling?function(){return a.setDirty}:this.throttledUpdate;this.handles.add(this.watch(["tilingScheme","tileSize"],function(){return a.tileMeasurements=null},!0));this.handles.add(c.init(this,"changeId",b));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(2,function(){return a.update()},function(){return a.needsUpdate()}))};d.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.handles&&(this.handles.destroy(),
this.handles=null)};d.prototype.addClient=function(){var a=this,b=y++;this.clients.add(b);1===this.clients.size&&this.setDirty();return{remove:function(){return a.removeClient(b)}}};d.prototype.removeClient=function(a){this.clients.delete(a);this.hasClients||this.setDirty()};Object.defineProperty(d.prototype,"hasClients",{get:function(){return 0<this.clients.size},enumerable:!0,configurable:!0});d.prototype.setDirty=function(){this.suspended?this.notifyChange("updating"):(this._dirty=!0,this._frameWorker||
this.update())};d.prototype.needsUpdate=function(){return this._dirty&&!this.suspended};d.prototype.update=function(){this._dirty=!1;if(this.tilingScheme&&this.hasClients){this.tileMeasurements||(this.tileMeasurements=new n.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:m}));var a=this.cameraOnSurface.location;this.tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:
a,a.z);this.updateTiles(this.subdivideTilesForView(this.getRootTiles()));this.tileMeasurements.end()}else this.tiles.removeAll(),this.idToTile.clear();this.notifyChange("updating")};d.prototype.getRootTiles=function(){var a=this;return this.rootTileIds.map(function(b){return new p.FeatureTileDescriptor3D(b[0],b[1],b[2],a.tilingScheme)})};d.prototype.purgeHorizonTiles=function(a){a.sort(function(a,b){a=a.measures.screen.rect;b=b.measures.screen.rect;return a[1]+a[3]-(b[1]+b[3])});h.empty(w);for(var b=
0;b<a.length;b++)if(h.expand(w,a[b].measures.screen.rect),h.height(w)>m)return a.slice(b);return[]};d.prototype.subdivideTilesForView=function(a){a=a.slice();for(var b=[];0<a.length;){var c=a.pop();if(!this.filterExtentRect||h.intersects(this.filterExtentRect,c.extent))this.tileMeasurements.updateTile(c),0!==c.measures.visibility&&(c.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(c.lij[0]+1),a.push.apply(a,c.getChildren())):b.push(c))}return this.purgeHorizonTiles(b)};d.prototype.updateTiles=
function(a){for(var b=this,c=0,e=this.tiles.items;c<e.length;c++)e[c].used=!1;a=a.filter(function(a){var c=b.idToTile.get(a.id);c?(c.copyMeasurementsFrom(a),c.used=!0):b.idToTile.set(a.id,a);return!c});c=this.tiles.items.filter(function(a){return a.used?!1:(b.idToTile.delete(a.id),!0)});this.tiles.removeMany(c);this.tiles.addMany(a);this.sortTiles()};d.prototype.sortTiles=function(){this.tiles.sort(function(a,b){return a.measures.visibility!==b.measures.visibility?2===a.measures.visibility?-1:1:a.measures.distance-
b.measures.distance});this.tiles.forEach(function(a,b){return a.loadPriority=b})};g([a.property({constructOnly:!0})],d.prototype,"scheduler",void 0);g([a.property({constructOnly:!0})],d.prototype,"renderCoordsHelper",void 0);g([a.property({constructOnly:!0})],d.prototype,"tilingSchemeOwner",void 0);g([a.property({constructOnly:!0})],d.prototype,"cameraOnSurface",void 0);g([a.property({constructOnly:!0})],d.prototype,"focus",void 0);g([a.property({constructOnly:!0})],d.prototype,"viewState",void 0);
g([a.property()],d.prototype,"tiles",void 0);g([a.property()],d.prototype,"tileSize",void 0);g([a.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],d.prototype,"tilingScheme",null);g([a.property()],d.prototype,"filterExtent",null);g([a.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],d.prototype,"filterExtentRect",null);g([a.property({readOnly:!0,dependsOn:["filterExtentRect"]})],d.prototype,"rootTileIds",null);g([a.property({value:!1})],d.prototype,"suspended",
null);g([a.property()],d.prototype,"updating",null);g([a.property({readOnly:!0,dependsOn:["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"]})],d.prototype,"changeId",null);g([a.property({constructOnly:!0})],d.prototype,"disableThrottling",void 0);return d=g([a.subclass()],d)}(a.declared(l));d.FeatureTileTree3D=t;var y=0,w=h.create(),m=10;d.default=t})},"esri/core/throttle":function(){define(["require","exports"],function(t,d){function q(d,l,b,f){var e=
null,g=1E3;"number"===typeof l?(g=l,f=b):(e=l,g=b);var c=0,a,h=function(){c=0;d.apply(f,a)};l=function(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];e&&e.apply(f,b);a=b;g?c||(c=setTimeout(h,g)):h()};l.remove=function(){c&&(clearTimeout(c),c=0)};l.forceUpdate=function(){c&&(clearTimeout(c),h())};l.hasPendingUpdates=function(){return!!c};return l}Object.defineProperty(d,"__esModule",{value:!0});d.throttle=q;d.default=q})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require",
"exports","../../../../geometry/support/aaBoundingRect"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(d,b,f,e){void 0===e&&(e=null);this.lij=[0,0,0];this.extent=q.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screen:{rect:q.create()},distance:0,shouldSplit:!1};this.used=!1;e&&this.acquire(d,b,f,e)}d.prototype.acquire=function(g,b,f,e){this.tilingScheme=e;this.id=d.id(g,b,f);this.lij[0]=g;this.lij[1]=b;this.lij[2]=f;e.getExtent(g,
b,f,this.extent);this.resolution=e.resolutionAtLevel(g)};d.prototype.release=function(){this.tilingScheme=null};d.prototype.getChildren=function(g){var b=this.lij[0]+1,f=2*this.lij[1],e=2*this.lij[2];if(!g)return[new d(b,f,e,this.tilingScheme),new d(b,f+1,e,this.tilingScheme),new d(b,f,e+1,this.tilingScheme),new d(b,f+1,e+1,this.tilingScheme)];g[0].acquire(b,f,e,this.tilingScheme);g[1].acquire(b,f+1,e,this.tilingScheme);g[2].acquire(b,f,e+1,this.tilingScheme);g[3].acquire(b,f+1,e+1,this.tilingScheme);
return g};d.prototype.copyMeasurementsFrom=function(d){this.measures.visibility=d.measures.visibility;this.measures.shouldSplit=d.measures.shouldSplit;this.measures.distance=d.measures.distance;q.set(d.measures.screen.rect,this.measures.screen.rect)};d.id=function(d,b,f){return d+"/"+b+"/"+f};return d}();d.FeatureTileDescriptor3D=t;d.default=t})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../support/geometryUtils".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(a){this.pointOfInterestInMap=[0,0];this.screenRect=b.create();this.tileSize=a.tileSize;this.maxVerticalScreenSize=a.maxVerticalScreenSize;this.renderCoordsHelper=a.renderCoordsHelper;this.tilingScheme=a.tilingScheme;this.visibility=new f.FeatureTileVisibility3D({renderCoordsHelper:a.renderCoordsHelper})}d.prototype.begin=function(a,c,e){this.camera=a;this.z=e;this.pointOfInterestInMap[0]=c.x;this.pointOfInterestInMap[1]=
c.y;b.fromValues(0,0,a.fullWidth,a.fullHeight,this.screenRect);this.visibility.begin(a,e)};d.prototype.end=function(){this.visibility.end()};d.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};d.prototype.updateDistanceMeasure=function(a){a.measures.distance=b.distance(a.extent,this.pointOfInterestInMap)};d.prototype.updateScreenMeasure=function(c){var e=a,d=1<<e,f=c.measures.screen.rect;
b.empty(f);for(var g=0,h=c.lij[0]+e,k=c.lij[1]<<e,e=c.lij[2]<<e,l=this.tileSizeWithBias(c),l=l*l,m=!1,n=0;n<d;n++){for(var p=0;p<d&&!(m=this.computeScreenArea(c,h,k+n,e+p,f),g+=m.area,m=g>l&&b.height(f)>this.maxVerticalScreenSize);p++);if(m)break}c.measures.shouldSplit=g>l};d.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*h:this.tileSize};d.prototype.computeScreenArea=function(a,d,f,g,h){var l=p.points;this.projectToScreen(d,f,g,1===a.measures.visibility,l);
b.empty(k);for(a=0;4>a;a++)b.expandPointInPlace(k,l[a]);b.expand(h,k);b.intersection(k,this.screenRect,c);p.screenOverlap=b.area(c)/b.area(k);p.area=e.triangle.areaPoints2d(l[0],l[1],l[2])+e.triangle.areaPoints2d(l[0],l[2],l[3]);return p};d.prototype.projectToScreen=function(a,b,c,e,d){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,b,c,n);this.toRenderCoords(n,0,3,v[0]);this.toRenderCoords(n,2,3,v[1]);this.toRenderCoords(n,2,1,v[2]);this.toRenderCoords(n,0,1,v[3]);e&&(this.projectToPlane(v,
this.camera.frustum.planes[4]),this.projectToPlane(v,this.camera.frustum.planes[3]),this.projectToPlane(v,this.camera.frustum.planes[2]));for(a=0;4>a;a++)this.camera.projectPoint(v[a],y),this.camera.renderToScreen(y,d[a])};d.prototype.projectToPlane=function(a,b){for(var c=0;4>c;c++)r[c]=e.plane.signedDistance(b,a[c]);c=Math.max(r[0],r[1],r[2],r[3]);if(0<c)for(b=g.vec3.scale(u,b,-c),c=0;4>c;c++)g.vec3.add(a[c],a[c],b)};d.prototype.toRenderCoords=function(a,b,c,e){u[0]=a[b];u[1]=a[c];u[2]=this.z;this.renderCoordsHelper.toRenderCoords(u,
this.tilingScheme.spatialReference,e);return e};return d}();d.FeatureTileMeasurements3D=t;var k=b.create(),c=b.create(),a=2,h=5,p={points:[q.createScreenPointArray(),q.createScreenPointArray(),q.createScreenPointArray(),q.createScreenPointArray()],area:0,screenOverlap:0},n=b.create(),u=l.vec3f64.create(),v=[l.vec3f64.create(),l.vec3f64.create(),l.vec3f64.create(),l.vec3f64.create()],r=[0,0,0,0],y=q.createRenderScreenPointArray3();d.default=t})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils ../../support/mathUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function b(a){this.surfaceElevation=0;this.cache=new Map;a=a.renderCoordsHelper;this.frustum=new f.Frustum({renderCoordsHelper:a});this.extendedFrustum=new f.Frustum({renderCoordsHelper:a});this.intersector=new e.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}b.prototype.begin=function(a,b){this.surfaceElevation=b;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>b;this.frustum.update(a);
this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,b)};b.prototype.end=function(){this.cache.clear()};b.prototype.calculate=function(b){if(this.allTilesInvisible)return 0;var c="global"===this.renderCoordsHelper.type&&b.lij[0]>=a&&b.lij[0]<h,e=this.getOrCalculateSingleTileVisibility(b,!c);return 0!==e&&c?this.calculateAggregatedChildrenVisibility(b):e};b.prototype.shortenFrustumFarPlane=function(a){for(var b=a.mutablePoints,c=0,e=f.Frustum.nearFarLineIndices;c<e.length;c++){var d=
e[c],h=d[1],d=b[d[0]];g.vec3.subtract(u,b[h],d);g.vec3.scale(u,u,n);g.vec3.add(b[h],d,u)}a.updatePoints(b)};b.prototype.calculateAggregatedChildrenVisibility=function(a){var b=0,c=this.cache.get(a.id);if(null!=c)return c;c=v.acquire();a.getChildren(c);for(var e=0;e<c.length;e++){var d=this.calculate(c[e]);if(0!==d&&(b=d,2===d))break}v.release(c);this.cache.set(a.id,b);return b};b.prototype.getOrCalculateSingleTileVisibility=function(a,b){var c=this.cache.get(a.id);if(null!=c)return c;c=this.calculateSingleTileVisibility(a);
b&&this.cache.set(a.id,c);return c};b.prototype.calculateSingleTileVisibility=function(a){if(!this.aboveGround&&"global"===this.renderCoordsHelper.type&&a.lij[0]<p){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};b.prototype.calculateSingleTileVisibilitySided=function(a,b){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,b);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?
this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};b.prototype.updateExtendedFrustum=function(a,b){var e=this.renderCoordsHelper;this.extendedFrustum.update(a);this.shortenFrustumFarPlane(this.extendedFrustum);var d=this.renderCoordsHelper.worldUpAtPosition(a.eye,u);this.aboveGround||g.vec3.negate(d,d);d=c.acos(-g.vec3.dot(d,a.viewForward));this.allTilesInvisible=d>(Math.PI+a.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=d>a.fovY/2)){a=this.extendedFrustumParameters(b);b=this.extendedFrustum.mutablePoints;
for(d=0;4>d;d++){var f=a.pointIndices[d],h=b[f],l=e.getAltitude(h);if(a.needsAltitudeAdjustment(l)){this.renderCoordsHelper.worldUpAtPosition(h,u);switch(f){case 4:case 7:case 0:case 3:k.plane.projectVector(this.extendedFrustum.planes[0],u,u);break;case 5:case 6:case 1:case 2:k.plane.projectVector(this.extendedFrustum.planes[1],u,u)}g.vec3.scale(u,u,a.direction);this.renderCoordsHelper.intersectInfiniteManifold(k.ray.wrap(h,u),a.zWithMargin,h)}}this.extendedFrustum.updatePoints(b);0>g.vec3.dot(this.extendedFrustum.planes[4],
this.frustum.planes[4])&&(e=this.extendedFrustum.mutablePoints,this.aboveGround?(a=[e[1],e[0]],e[0]=a[0],e[1]=a[1]):(a=[e[2],e[3]],e[3]=a[0],e[2]=a[1]),this.extendedFrustum.updatePoints(e))}};b.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};b.prototype.extendedFrustumParametersAboveSurface=function(a,b){var c=a-b;return{zWithMargin:c,pointIndices:f.Frustum.planePointIndices.bottom,
direction:-1,needsAltitudeAdjustment:function(a){return a>c}}};b.prototype.extendedFrustumParametersBelowSurface=function(a,b){var c=a+b;return{zWithMargin:c,pointIndices:f.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<c}}};return b}();d.FeatureTileVisibility3D=t;var a=2,h=6,p=12,n=.95,u=l.vec3f64.create(),v=new q(Array,function(a){4!==a.length&&(a[0]=new b.FeatureTileDescriptor3D,a[1]=new b.FeatureTileDescriptor3D,a[2]=new b.FeatureTileDescriptor3D,a[3]=new b.FeatureTileDescriptor3D)},
function(a){a[0].release();a[1].release();a[2].release();a[3].release()});d.default=t})},"esri/views/3d/state/Frustum":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/mathUtils ../support/geometryUtils/frustum".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(e){this.frustum=b.create();this.lines=Array(12);this.origin=g.vec3f64.create();this.direction=g.vec3f64.create();
this._altitude=null;this.renderCoordsHelper=e?e.renderCoordsHelper:null;for(e=0;12>e;e++)this.lines[e]={origin:null,direction:g.vec3f64.create(),endpoint:null}}Object.defineProperty(d.prototype,"planes",{get:function(){return this.frustum.planes},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"points",{get:function(){return this.frustum.points},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"mutablePoints",{get:function(){return this.frustum.points},enumerable:!0,
configurable:!0});d.prototype.update=function(e){b.fromMatrix(e.viewMatrix,e.projectionMatrix,this.frustum);q.vec3.copy(this.origin,e.eye);q.vec3.copy(this.direction,e.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};d.prototype.updatePoints=function(e){for(var d=0;d<this.frustum.points.length;d++)q.vec3.copy(this.frustum.points[d],e[d]);b.recomputePlanes(this.frustum);this.updateLines()};Object.defineProperty(d.prototype,"altitude",{get:function(){return this._altitude},
enumerable:!0,configurable:!0});d.prototype.intersectsSphere=function(e){return b.intersectsSphere(this.frustum.planes,e)};d.prototype.intersectsRay=function(e){return b.intersectsRay(this.frustum.planes,e)};d.prototype.intersectsLineSegment=function(e,d){return b.intersectsLineSegment(this.frustum.planes,e,d)};d.prototype.intersectsPoint=function(e){return b.intersectsPoint(this.frustum.planes,e)};d.prototype.updateLines=function(){for(var b=this.frustum.points,d=0;4>d;d++){var c=d,a=d+4;this.updateLine(this.lines[d],
b[c],b[a]);this.updateLine(this.lines[d+4],b[c],3===d?b[0]:b[c+1]);this.updateLine(this.lines[d+8],b[a],3===d?b[4]:b[a+1])}};d.prototype.updateLine=function(b,d,c){b.origin=d;b.endpoint=c;l.directionFromTo(b.direction,d,c)};d.planePointIndices=b.planePointIndices;d.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return d}();d.Frustum=t;d.default=t})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../core/compilerUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n){Object.defineProperty(d,"__esModule",{value:!0});t=.5*Math.PI;var u=t/Math.PI*180,v=t*c.earthRadius,r=.9*c.earthRadius;c=function(){function c(b){this.renderCoordsHelper=b.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:f.vec3f64.create(),direction:f.vec3f64.create()};for(b=0;4>b;b++)this.extent[b]={origin:f.vec3f64.create(),direction:f.vec3f64.create(),cap:{next:null,direction:f.vec3f64.create()}},this.planes[b]=
a.plane.create();this.planes[4]=a.plane.create();this.planes[5]=a.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}c.prototype.update=function(c,e,d,f){void 0===f&&(f=!0);var g=this.extent;this.toRenderBoundingExtent(c,e,d);b.vec3.add(this.center.origin,g[0].origin,g[2].origin);b.vec3.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);f||b.vec3.scale(this.center.direction,this.center.direction,-1);for(d=0;4>
d;d++){var h=g[d];this.renderCoordsHelper.worldUpAtPosition(h.origin,h.direction);var k=g[3===d?0:d+1];h.cap.next=k.origin;p.directionFromTo(h.cap.direction,h.origin,k.origin);a.plane.fromVectorsAndPoint(h.direction,h.cap.direction,h.origin,this.planes[d]);f||b.vec3.scale(h.direction,h.direction,-1)}a.plane.fromVectorsAndPoint(g[0].cap.direction,g[1].cap.direction,g[0].origin,this.planes[4]);f?a.plane.negate(this.planes[4],this.planes[5]):(a.plane.copy(this.planes[4],this.planes[5]),a.plane.negate(this.planes[4],
this.planes[4]));this.maxSpan=Math.max(Math.abs(c[0]-c[2]),Math.abs(c[1]-c[3]));this.maxSpanSpatialReference=e};c.prototype.isVisibleInFrustum=function(b,c){void 0===c&&(c=!1);if(null==b)return!1;if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isWGS84?u:v))return!0;if(b.altitude>=r)return this.isVisibleInFrustumGlobal(b)}if(0===this.maxSpan){var e=this.extent[0];return!c&&b.intersectsRay(a.ray.wrap(e.origin,e.direction))?!0:!1}for(var d=0;d<this.extent.length;d++)if(e=
this.extent[d],!c&&b.intersectsRay(a.ray.wrap(e.origin,e.direction))||b.intersectsLineSegment(a.lineSegment.fromPoints(e.origin,e.cap.next,C),e.cap.direction))return!0;c=c?this.planes:this.planesWithoutFar;for(d=0;d<b.lines.length;d++)if(e=b.lines[d],h.frustumLineSegment(c,e.origin,e.endpoint,e.direction))return!0;return!1};c.prototype.toRenderBoundingExtentGlobal=function(a,c,d){k.center(a,w);w[2]=d;n.computeLinearTransformation(c,w,m,this.renderCoordsHelper.spatialReference);g.mat4.invert(x,m);
e.empty(A);for(var f=0,h=y;f<h.length;f++)for(var l=h[f],r=l.x0,v=l.x1,u=l.y0,l=l.y1,q=0;5>q;q++){var C=q/4;w[0]=p.lerp(a[r],a[v],C);w[1]=p.lerp(a[u],a[l],C);w[2]=d;n.vectorToVector(w,c,w,this.renderCoordsHelper.spatialReference);b.vec3.transformMat4(w,w,x);e.expandPointInPlace(A,w)}b.vec3.set(this.extent[0].origin,A[0],A[1],A[2]);b.vec3.set(this.extent[1].origin,A[3],A[1],A[2]);b.vec3.set(this.extent[2].origin,A[3],A[4],A[2]);b.vec3.set(this.extent[3].origin,A[0],A[4],A[2]);for(q=0;4>q;++q)b.vec3.transformMat4(this.extent[q].origin,
this.extent[q].origin,m)};c.prototype.toRenderBoundingExtentLocal=function(a,c,e){b.vec3.set(this.extent[0].origin,a[0],a[1],e);b.vec3.set(this.extent[1].origin,a[2],a[1],e);b.vec3.set(this.extent[2].origin,a[2],a[3],e);b.vec3.set(this.extent[3].origin,a[0],a[3],e)};c.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,b,c);break;case "local":this.toRenderBoundingExtentLocal(a,b,c);break;default:q.neverReached(this.renderCoordsHelper.type)}};
c.prototype.isVisibleInFrustumGlobal=function(a){if(0>b.vec3.dot(this.center.direction,a.direction))return!0;for(var c=0;4>c;c++)if(0>b.vec3.dot(this.extent[c].direction,a.direction))return!0;return!1};return c}();d.FrustumExtentIntersection=c;var y=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],w=f.vec3f64.create(),m=l.mat4f64.create(),x=l.mat4f64.create(),A=e.create(),C=a.lineSegment.create();d.default=c})},"esri/views/3d/layers/support/FeatureTileTree3DDebugger":function(){define("require exports ../../../../Graphic ../../../../core/Handles ../../../../core/watchUtils ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../support/mathUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c){Object.defineProperty(d,"__esModule",{value:!0});var a=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];t=function(){function d(c){var d=this;this.view=c;this.graphics=[];this.handles=new g;this._enabled=!0;this.symbols=a.map(function(a){return new e(new b({material:{color:[a[0],a[1],
a[2],.6]},outline:{color:"black",size:1}}))});this.handles.add([c.featureTiles.addClient(),l.on(c.featureTiles,"tiles","change",function(){return d.update()},function(){return d.update()})])}Object.defineProperty(d.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});d.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.view&&(this.clear(),this.view=null)};d.prototype.update=
function(){var a=this;this.clear();if(this._enabled){var b=this.view.featureTiles,e=b.tilingScheme,d=b.tiles.toArray().sort(function(a,b){return a.loadPriority-b.loadPriority});d.forEach(function(b,g){var h=b.lij,l=h[0],n=h[1],p=h[2],r=e.getExtentGeometry(l,n,p),h=new q({geometry:r,symbol:a.symbols[l%a.symbols.length]}),v=g/(d.length-1);g=c.lerp(0,200,v);var v=c.lerp(20,6,v),u=b.loadPriority>=d.length;b=new q({geometry:r.center,symbol:new f({verticalOffset:{screenLength:40/.75},callout:{type:"line",
color:"white",border:{color:"black"}},symbolLayers:[new k({text:l+"/"+n+"/"+p+" ("+b.loadPriority+")",halo:{color:"white",size:1/.75},material:{color:[g,u?0:g,u?0:g]},size:v/.75})]})});a.graphics.push(h,b);a.view.graphics.addMany([h,b])})}};d.prototype.clear=function(){this.view.graphics.removeMany(this.graphics);this.graphics=[]};return d}();d.FeatureTileTree3DDebugger=t;d.default=t})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3f64 ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/Evented ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function l(a){a=d.call(this,a)||this;a.propertiesPool=new n.default({camera:u},a);a.lastSeenCameraProjectionValues=new u;a.events=new p.Evented;a.updateQueue=[];a.processingUpdates=!1;return a}q(l,d);l.prototype.destroy=function(){this.cameraController=null;this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};l.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),
mode:a.viewingMode,spatialReference:a.spatialReference,constraints:new k.default({mode:a.viewingMode})}};Object.defineProperty(l.prototype,"animation",{get:function(){return this.cameraController instanceof c.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==v&&v.copyFrom(a);v.markViewDirty();v.computeUp(this.mode);r.camera=v;this.events.emit("before-camera-change",
r);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,v)&&(this.lastSeenCameraProjectionValues.copyFrom(v),y.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",y));a&&a.equals(v)||this._set("camera",this.propertiesPool.get("camera").copyFrom(v))},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"isLocal",
{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"interacting",{get:function(){return!!this.cameraController&&this.cameraController.isInteractive},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(b){var c=this;this.stopActiveCameraController()?(b&&(b.watch("state",function(e){if(e===a.State.Finished||e===a.State.Stopped)c._set("cameraController",
null),c.updateCamera(function(a){return b.onControllerEnd(a)})},!0),b.onControllerStart(this.camera)),this._set("cameraController",b)):b&&(b.state=a.State.Rejected)},enumerable:!0,configurable:!0});l.prototype.switchCameraController=function(b){this.cameraController=b;return b.state!==a.State.Rejected};l.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};l.prototype.cameraChanged=function(){this.updateCamera(function(){})};
l.prototype.updateCamera=function(a){this.updateQueue.push(a);this.processUpdateQueue()};l.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();v.copyFrom(this._get("camera"));a(v);this.camera=v;this.processingUpdates=!1;this.processUpdateQueue()}};l.prototype.createInitialCamera=function(a){return"global"===a?new u(f.vec3f64.fromValues(4*h.earthRadius,0,0),f.vec3f64.fromValues(h.earthRadius,0,0),
f.vec3f64.fromValues(0,0,1)):new u(f.vec3f64.fromValues(0,0,100),f.vec3f64.fromValues(0,0,0),f.vec3f64.fromValues(0,1,0))};l.prototype.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};g([b.property({readOnly:!0,type:e,
dependsOn:["cameraController"]})],l.prototype,"animation",null);g([b.property({type:u})],l.prototype,"camera",null);g([b.property({constructOnly:!0})],l.prototype,"constraints",void 0);g([b.property({readOnly:!0})],l.prototype,"events",void 0);g([b.property({readOnly:!0,dependsOn:["isLocal"]})],l.prototype,"isGlobal",null);g([b.property({readOnly:!0,dependsOn:["mode"]})],l.prototype,"isLocal",null);g([b.property({constructOnly:!0})],l.prototype,"mode",void 0);g([b.property({constructOnly:!0})],l.prototype,
"spatialReference",void 0);g([b.property({readOnly:!0,dependsOn:["cameraController"]})],l.prototype,"interacting",null);g([b.property()],l.prototype,"cameraController",null);return l=g([b.subclass()],l)}(b.declared(l));d.ViewState=t;var v=new u,r={camera:null},y={camera:null};d.default=t})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});
t=function(){function d(b,d){var e=this;this.owner=d;this.properties={};this.afterDispatchHandle=null;for(var f in b)d=new q.ReentrantObjectPool(b[f],null,null,2,2),this.properties[f]={pool:d,acquired:[]};this.afterDispatchHandle=g.afterDispatch(function(){return e.release()})}d.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(var b in this.properties){for(var d=this.properties[b],e=0,k=d.acquired;e<k.length;e++){var c=k[e];
g.isValueInUse(c)||d.pool.release(c)}d.pool.destroy();d.pool=null;d.acquired=null}this.owner=this.properties=null};d.prototype.get=function(b){var d=this.owner._get(b);b=this.properties[b];var e=b.pool.acquire();for(b.acquired.push(e);e===d;)b.acquired.push(e),e=b.pool.acquire();return e};d.prototype.release=function(){for(var b in this.properties){for(var d=this.properties[b],e=0,k=0,c=d.acquired;k<c.length;k++){var a=c[k];g.isValueInUse(a)?d.acquired[e++]=a:d.pool.release(a)}d.acquired.length=e}};
return d}();d.PropertiesPool=t;d.default=t})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M,Q,P){Object.defineProperty(d,"__esModule",{value:!0});var O=a.getLogger("esri.views.3d.state.ViewStateManager");t=function(a){function e(b){b=a.call(this)||this;b.propertiesPool=new K.default({frustum:I.default},b);b.handles=new c;b.cameraSetByUser=!1;b.internalSetOrder=[];b.immediateGoToPromise=null;b.animatedGoToPromise=null;b.ready=!1;b.updateDevicePixelRatio=null;return b}g(e,a);Object.defineProperty(e.prototype,"camera",{get:function(){return this.ready?
F.internalToExternal(this.view,this.view.state.camera):this._get("camera")},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(F.externalToInternal(this.view,a),{applyConstraints:!1})||O.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",a)||(a?
this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.forceUpdate():O.error("#center\x3d","Invalid center",a):O.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):O.error("#center\x3d","Center may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"extent",
{get:function(){return this.ready?F.toExtent(this.view,null,null,null,X):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||O.error("#extent\x3d","Invalid extent",a):O.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):O.error("#extent\x3d","Extent may not be null or undefined"))},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");
var a=this.view.pointsOfInterest.centerOnContent;return F.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||O.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera,b=a.padding,c=a.pixelRatio,a=this._get("padding"),e=b[0]/
c,d=b[1]/c,f=b[2]/c,b=b[3]/c;return null!=a&&a.top===e&&a.right===d&&a.bottom===f&&a.left===b?a:{top:e,right:d,bottom:f,left:b}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(this.paddingToArray(a,this.view.state.camera.pixelRatio,R),this.view.state.updateCamera(function(a){return a.padding=R}))},enumerable:!0,configurable:!0});e.prototype.paddingToArray=function(a,b,c){a?y.vec4.set(c,a.top||0,a.right||0,a.bottom||0,a.left||0):y.vec4.set(c,0,0,0,0);for(a=0;4>a;a++)c[a]=Math.round(c[a]*
b)};Object.defineProperty(e.prototype,"screenCenter",{get:function(){var a=this.padding;return u.createScreenPoint((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"viewpoint",{get:function(){return this.ready?M.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),
{applyConstraints:!a.camera})||O.error("#viewpoint\x3d","Invalid viewpoint",a);else{var b=a.camera?a.camera.position:a.targetGeometry,b=b&&b.spatialReference;O.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(b?b.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else O.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"zoom",{get:function(){return this.ready?F.scaleToZoom(this.view,
this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||O.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});e.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch("state.camera",function(b){return a.cameraChangedSync(b)},!0),v.on(this.view,"state.events","before-camera-change",function(b){return a.beforeCameraChangeHandle(b.camera)})]);v.once(this.view,"state.camera",
function(b){return a.updateCameraElevation(b)});this.handles.add(n.addFrameTask({prepare:function(){return a.prepareFrame()}}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(T);a.cancelImmediateGoTo()}));this.handles.add(v.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};e.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),
this.propertiesPool=null)};e.prototype.init=function(){var a=this;this.constraintsManager=new E.default({view:this.view});this.prepareFrame();var b=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(var c=0;c<b.length;c++){var e=b[c];this.set(e.name,e.value)}this.cameraSetByUser||((b=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(b)?this.setInitialView(b):"local"===this.view.state.mode&&this.handles.add(v.whenOnce(this.view.basemapTerrain,
"ready",function(){a.handles.remove(T);a.setInitialView(a.view.groundExtent)}),T))};e.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(T),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};e.prototype.goTo=function(a,b){b=q({animate:!0},b);return b.animate?
this.goToAnimated(a,b):this.goToImmediate(a,b)};e.prototype.debugSetCameraOnContent=function(){this.setStateCamera(B.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};e.prototype.step=function(a){var b=this.view.state,c=b&&this.view.state.cameraController;c&&(b.updateCamera(function(b){c.stepController(a,b)}),c.steppingFinished&&c.finishController())};e.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToPromise;a&&(this.immediateGoToPromise=null,a.cancel())};e.prototype.cancelAnimatedGoTo=
function(){var a=this.animatedGoToPromise;a&&(this.animatedGoToPromise=null,a.cancel())};e.prototype.getInitialProperties=function(){for(var a=this,b=new Set,c=[],e=0,d=N;e<d.length;e++){var f=d[e],g=f.propertyName,f=f.overrides,h=b.has(g),k=this._isOverridden(g);!h&&k&&c.push({name:g,value:this._get(g)});this._clearOverride(g);(h||k)&&f.forEach(function(a){return b.add(a)})}return c.sort(function(b,c){b=a.internalSetOrder.indexOf(b.name);c=a.internalSetOrder.indexOf(c.name);return b<c?-1:b>c?1:0})};
e.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser)if(a instanceof b)this.setStateCamera(F.externalToInternal(this.view,a),{applyConstraints:!1});else if(a instanceof f)if(a.targetGeometry instanceof m){var c=F.fromExtent(this.view,a.targetGeometry,0,.5,F.OrientationMode.LOCKED);this.setStateCamera(F.externalToInternal(this.view,c),{applyConstraints:!0})}else c={applyConstraints:!a.camera},a=this.viewpointToCamera(a),this.setStateCamera(a,c);else c=F.fromExtent(this.view,a,0,.5,F.OrientationMode.LOCKED),
this.setStateCamera(F.externalToInternal(this.view,c),{applyConstraints:!0})};e.prototype.updatePropertyBeforeReady=function(a,b){if(!this.ready){this._override(a,b);var c=this.internalSetOrder.indexOf(a);-1!==c&&(this.internalSetOrder=this.internalSetOrder.splice(c,1));b&&(this.internalSetOrder.push(a),-1!==U.indexOf(a)&&this._override("hasInitialView",!0));return!0}return!1};e.prototype.isCompatible=function(a){return a?a instanceof f?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):
a instanceof b?this.isCompatible(a.position):a.spatialReference&&A.canProject(a.spatialReference,this.view.spatialReference):!1};e.prototype.getPreservingHeadingTilt=function(a){void 0===a&&(a=V);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};e.prototype.centerPointAtDistanceToCamera=function(a,b,c){void 0===c&&(c=J);var e=this.getPreservingHeadingTilt();return(a=F.getObserverForPointAtDistance(this.view,e.heading,e.tilt,a,b,F.OrientationMode.ADJUST))?
(c.copyFrom(this.view.state.camera),c.eye=a.eye,c.center=a.center,c.up=a.up,c):null};e.prototype.centerToCamera=function(a){var b=this.view.pointsOfInterest.centerOnContent;b.forceUpdate();return this.centerPointAtDistanceToCamera(a,b.distance)};e.prototype.extentToCamera=function(a){var b=this.getPreservingHeadingTilt();a=F.fromExtent(this.view,a,b.heading,b.tilt,F.OrientationMode.ADJUST,X);return F.externalToInternal(this.view,a)};e.prototype.scaleToCamera=function(a){if(null==a)return null;var b=
this.view.pointsOfInterest.centerOnContent;b.forceUpdate();var c=b.renderLocation;a=F.scaleToDistance(this.view,a,b.location.latitude);return this.centerPointAtDistanceToCamera(c,a)};e.prototype.zoomToCamera=function(a){return this.scaleToCamera(F.zoomToScale(this.view,a))};e.prototype.viewpointToCamera=function(a){return(a=M.toCamera(this.view,a))?F.externalToInternal(this.view,a):null};e.prototype.setStateCamera=function(a,b){var c=this;if(!a||!this.view.state.stopActiveCameraController())return!1;
this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(e){e.copyFrom(a);b.applyConstraints&&C.applyAll(c.view,e)});b.applyConstraints||(this.view.state.cameraController=new L.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};e.prototype.prepareFrame=function(){var a=this.view,b=a.container,c=a.canvas;if(b&&c){h.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var a=this.view.pixelRatio,e=Math.round(b.clientWidth*a),
b=Math.round(b.clientHeight*a);0!==e&&0!==b&&(c.width=e,c.height=b,this.view.state&&(c=this.view.state.camera,c.fullWidth!==e||c.fullHeight!==b||c.pixelRatio!==a))&&(J.copyFrom(c),J.pixelRatio!==a&&(this.paddingToArray(this.padding,a,R),J.padding=R),J.fullWidth=e,J.fullHeight=b,J.pixelRatio=a,this.view.state.camera=J)}};e.prototype.beforeCameraChangeHandle=function(a){this.updateCameraElevation(a)};e.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};e.prototype.updateCameraElevation=
function(a){var b=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,c=this.view.renderCoordsHelper.getAltitude(a.eye),b=b?B.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=c-b};e.prototype.createGoToCamera=function(a){var c=this;return v.whenOnce(this,"ready",null,!0).then(function(){return M.create(c.view,a)}).then(function(e){var d=!!(a instanceof f&&a.camera||a instanceof b),g=e.camera;if(!c.isCompatible(g))throw e=(e=g.position)&&e.spatialReference,new k("goto:incompatible-spatialreference",
"Resulting camera has an incompatible spatial reference (camera: "+(e?e.wkid:"none")+", view: "+c.view.spatialReference.wkid+")",{camera:g});g=F.externalToInternal(c.view,g);if(!g)throw new k("goto:invalid-camera","Resulting camera is invalid");return{viewpoint:e,camera:g,isFullySpecified:d}})};e.prototype.cancellableGoTo=function(a){var b=this,c;return p.create(function(b,e){c={resolve:b,reject:e};a.asyncResult=c},function(){b.view.state.cameraController===a&&a.active&&a.asyncResult===c&&a.stopController()})};
e.prototype.goToImmediate=function(a,b){var c=this;this.cancelAnimatedGoTo();this.cancelImmediateGoTo();var e=this.createGoToCamera(a).then(function(a){c.immediateGoToPromise===e&&(c.immediateGoToPromise=null);c.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified})}).catch(function(a){c.immediateGoToPromise===e&&(c.immediateGoToPromise=null);a instanceof k&&a.message&&O.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));throw a;});return this.immediateGoToPromise=
e};e.prototype.goToAnimatedBeforeReady=function(a,b){var c=this;this.cancelAnimatedGoTo();var e=v.whenOnce(this.view,"ready").then(function(){if(e===c.animatedGoToPromise)return c.animatedGoToPromise=null,c.goToAnimated(a,b);throw new k("view:goto-cancelled","Cancelled");});return this.animatedGoToPromise=e};e.prototype.goToAnimated=function(a,b){var c=this;this.cancelAnimatedGoTo();if(!this.ready)return this.goToAnimatedBeforeReady(a,b);var e=this.view.state.cameraController,d;e instanceof G.PointToPointAnimationController&&
(e.updateStateFromViewAnimation(),e.active&&(d=e));null==d&&(d=new G.PointToPointAnimationController(this.view.state,this.view.sceneIntersectionHelper));var f=d.viewAnimation;a=this.createGoToCamera(a);var g=a.then(function(a){return a.viewpoint});f.update(g);if(d!==e&&!this.view.state.switchCameraController(d))return f.stop(),O.error("#goTo()","Cannot start an animation while interacting"),p.reject(new k("view:goto-cannot-interrupt","Cannot start an animation while interacting"));var h=f.target,
l=function(){return c.view.state.cameraController===d&&d.viewAnimation.target===h&&d.active};a.then(function(a){var e=a.viewpoint,g=a.camera;a=a.isFullySpecified;if(l()){d.viewAnimation.update(e);h=d.viewAnimation.target;var k;a?(k=new L.SurfaceCollisionCorrectionController({view:c.view,desiredCamera:g}),C.applySurfaceCollision(c.view,g,1)):C.applyAll(c.view,g);d.begin(g,c.internalAnimateOptions(b));return f.when().then(function(){var a=c.view.state.cameraController;k&&(a&&a.active?a instanceof G.PointToPointAnimationController&&
a.viewAnimation.target===h&&(c.view.state.cameraController=k):d.viewAnimation.target===h&&(c.view.state.cameraController=k))})}}).catch(function(a){a instanceof k&&a.message&&O.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));if(l())throw c.view.state.cameraController.stopController(),a;});return this.cancellableGoTo(d)};e.prototype.internalAnimateOptions=function(a){var b={};a&&(null!=a.speedFactor&&(b.speedFactor=a.speedFactor),null!=a.duration&&
(b.duration=a.duration/1E3),null!=a.maxDuration&&(b.maxDuration=a.maxDuration/1E3),null!=a.easing&&(b.easing="string"===typeof a.easing?P.named[a.easing]:a.easing));return b};l([r.property({type:b,dependsOn:["view.state.camera","ready"]})],e.prototype,"camera",null);l([r.property({type:x,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],e.prototype,"center",null);l([r.property({type:m,dependsOn:["view.state.camera","ready"]})],e.prototype,"extent",null);l([r.property({readOnly:!0,
dependsOn:["view.state.camera","ready"]})],e.prototype,"frustum",null);l([r.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],e.prototype,"hasInitialView",null);l([r.property({readOnly:!0,type:Boolean})],e.prototype,"ready",void 0);l([r.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],type:Number})],e.prototype,"scale",null);l([r.property({dependsOn:["view.state.camera","ready"]})],e.prototype,"padding",null);l([r.property({readOnly:!0,
dependsOn:["view.width","view.height","padding"]})],e.prototype,"screenCenter",null);l([r.property({constructOnly:!0})],e.prototype,"view",void 0);l([r.property({type:f,dependsOn:["camera","ready"]})],e.prototype,"viewpoint",null);l([r.property({type:Number,dependsOn:["scale"]})],e.prototype,"zoom",null);l([r.property({constructOnly:!0})],e.prototype,"updateDevicePixelRatio",void 0);return e=l([r.subclass("esri.views.3d.state.ViewStateManager")],e)}(r.declared(e));d.ViewStateManager=t;var U="camera viewpoint extent scale center zoom".split(" "),
N=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"center",overrides:[]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],V={heading:0,tilt:0},X=new b,J=new Q,R=w.vec4f64.create(),T="pending-initial-view";d.default=t})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint ../support/mathUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function l(c){var e=d.call(this)||this;e.handles=new b;e.nearFarHeuristic=a.createNearFarHeuristic(c.view.state.mode,c.view.basemapTerrain,c.view.renderCoordsHelper.spatialReference);return e}q(l,d);l.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),this.view.watch("constraints.clipDistance.mode",
function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(b){return a.cameraUpdateNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)]);this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)]);this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},!0),this.view.watch("constraints.tilt.mode",
function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)]);this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a.updateCollision()},!0));this.view.state.isLocal&&this.handles.add(f.init(this.view,"dataExtent",function(b){return a.updateLocalSurfaceDistance(b)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();this.updateTilt();this.updateCollision();
this._set("surfaceCollisionConstraint",new h.default({view:this.view}))};l.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};l.prototype.handleClipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a.cameraUpdateNearFarManual(c,
b);return!0})};l.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};l.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a.cameraUpdateNearFar(b);return!0})};l.prototype.cameraUpdateNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this.cameraUpdateNearFarManual(a,b):this.cameraUpdateNearFarAuto(a,b)};l.prototype.cameraUpdateNearFarAuto=function(a,b){this.nearFarHeuristic.compute(a.eye,
a.center,this.view.dataExtent,c.surfaceElevationBelowEye(this.view,a),a);b&&b.autoUpdate(a.near,a.far)};l.prototype.cameraUpdateNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};l.prototype.updateCollision=function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,b=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===a.type:b,b=this.view.state.constraints.collision;a!==b.enabled&&((b.enabled=a)&&this.reapplyConstraints(8),
(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this.updateTiltAuto(a))};l.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};l.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};l.prototype.handleTiltModeChanged=function(){this.updateTilt()};l.prototype.handleTiltMaxChanged=function(){var a=
this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};l.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto(a);this.reapplyConstraints()};l.prototype.updateTiltManual=function(a){var b=this.view.state.constraints;b.tilt=b.createConstantMaxTilt(p.deg2rad(a.max))};l.prototype.updateTiltAuto=function(a){a=this.view.state.constraints;
a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};l.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(p.rad2deg(b)))}};l.prototype.updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);0>=b||(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&
(a.constraints.distance=b))};l.prototype.reapplyConstraints=function(a){var b=this;void 0===a&&(a=15);this.view.state.updateCamera(function(c){return k.applyAll(b.view,c,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})})};g([e.property({constructOnly:!0})],l.prototype,"view",void 0);g([e.property({readOnly:!0})],l.prototype,"surfaceCollisionConstraint",void 0);return l=g([e.subclass("esri.views.3d.state.ConstraintsManager")],
l)}(e.declared(l));d.ConstraintsManager=t;d.default=t})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../core/unitUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils ../support/mathUtils".split(" "),function(t,d,q,g,l,b,f){function e(a,b,c,e){c=h/c;a/b>c?(e.far=a,e.near=e.far/b):(e.near=c,e.far=e.near*b);return e}Object.defineProperty(d,"__esModule",{value:!0});d.createNearFarHeuristic=function(a,b,e){return"global"===
a?new c:new k(b,e)};var k=function(){function c(a,b){this.elevationProvider=a;this.unitInMeters=q.getMetersPerUnitForSR(b)}c.prototype.compute=function(c,d,h,k,l){l||(l={near:0,far:0});var m=b.earthRadius,r=c[2]*this.unitInMeters,q=r;k=r-k;var x=this.elevationProvider?this.elevationProvider.getElevationBounds():null;x&&(r=0<=k?q-this.unitInMeters*x[0]:this.unitInMeters*x[1]-q);q=Math.max(h.xmax-h.xmin,h.ymax-h.ymin,4*Math.max(h.xmax-h.xmin,h.ymax-h.ymin));g.vec3.subtract(v,d,c);u[0]=0<v[0]?h.xmax:
h.xmin;u[1]=0<v[1]?h.ymax:h.ymin;u[2]=0<v[2]?q/2:-q/2;g.vec3.subtract(u,u,c);g.vec3.normalize(v,v);c=1.1*g.vec3.dot(u,v)*this.unitInMeters;m=Math.sqrt(r*(r+2*m));h=Math.max(h.xmax-h.xmin,h.ymax-h.ymin);d=h*n*this.unitInMeters;r=f.clamp((r-d)/(h*p*this.unitInMeters-d),0,1);r=f.lerp(m,c,r*r*r);r*=Math.max(Math.log(Math.abs(k)),1);r=Math.min(r,Math.max(34064E4,q));r/=this.unitInMeters;return e(r,a,this.unitInMeters,l)};return c}(),c=function(){function a(){}a.prototype.compute=function(a,c,d,h,k){k||
(k={near:0,far:0});c=b.earthRadius;a=g.vec3.length(a)-c;a=Math.max(Math.abs(a-h),Math.abs(a));h=Math.sqrt(a*(a+2*(c+Math.min(0,h))));a=f.clamp(2E4-(Math.log(a)-7.983)/9.011*19E3,1E3,2E4);return e(1.2*h,a,1,k)};return a}(),a=2E4,h=2,p=.001,n=1E-4,u=l.vec3f64.create(),v=l.vec3f64.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,"__esModule",{value:!0});t=function(c){function a(a){a=c.call(this)||this;a.handles=new b;return a}q(a,c);a.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};a.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};a.prototype.handleElevationChangeEvent=function(a){if(this.view.state.cameraController)return!1;
k.eyeWithinExtent(this.view,this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};a.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){e.applySurfaceCollision(a.view,b,1)})};g([f.property({constructOnly:!0})],a.prototype,"view",void 0);return a=g([f.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a)}(f.declared(l));d.SurfaceCollisionConstraint=t;d.default=t})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});t=function(e){function d(b){var a=e.call(this)||this;a.handles=new g;a.view=b.view;a.desiredCamera=b.desiredCamera.copy();return a}q(d,e);Object.defineProperty(d.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0});d.prototype.onControllerStart=function(b){var a=
this;e.prototype.onControllerStart.call(this,b);this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}));this.applyCorrection()};d.prototype.onControllerEnd=function(b){this.handles.removeAll();this.view=null;e.prototype.onControllerEnd.call(this,b)};d.prototype.handleElevationChangeEvent=function(c){b.eyeWithinExtent(this.view,this.desiredCamera,c.extent,c.spatialReference)&&this.applyCorrection()};d.prototype.applyCorrection=function(){var b=
this;this.view.state.updateCamera(function(a){a.copyViewFrom(b.desiredCamera);l.applySurfaceCollision(b.view,a,1)||b.constraintEnabled||(b.state=f.State.Stopped)})};return d}(f.CameraController);d.SurfaceCollisionCorrectionController=t})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./geometryUtils ./mathUtils ./projectionUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A){function C(a){return 360-x.cyclicalDeg.normalize(a)}function B(a){return x.cyclicalDeg.normalize(360-a)}function E(a,b){a&&(null==b?a.reject():a.resolve(b));return b}function I(a,b,c,e){if(!b)return E(e);var d=a.spatialReference||g.SpatialReference.WGS84;if(b.camera){a=b.get("camera.position.spatialReference");if(!r.canProject(a,d))return E(e);b=b.camera.clone();a.equals(d)||(b.position=r.project(b.position,d));return E(e,b)}var f=b.get("targetGeometry.spatialReference");
if(f&&!r.canProject(f,d))return E(e);d=w.internalToExternal(a,a.state.camera);f=w.OrientationMode.ADJUST;null!=b.rotation&&(d.heading=C(b.rotation),f=w.OrientationMode.LOCKED);null!=c&&(d.tilt=c);if("point"===b.targetGeometry.type){c=b.targetGeometry;var h=void 0,k=b.targetGeometry.clone(),h=null!=b.scale?w.scaleToDistance(a,b.scale,c.latitude):a.state.camera.distance;return w.fromCenterDistance(a,k,h,d,f,e)}return w.fromExtent(a,b.targetGeometry.extent,d.heading,d.tilt,f,e)}function G(a,b){return null==
b.scale&&null!=b.zoom?w.zoomToScale(a,b.zoom):b.scale}function L(a,b){var c=!1;null!=b.heading?(a.heading=b.heading,c=!0):null!=b.rotation&&(a.heading=C(b.rotation),c=!0);null!=b.tilt&&(a.tilt=b.tilt,c=!0);null!=b.fov&&(a.fov=b.fov);return c}function F(a,b,c){var e=a.spatialReference||g.SpatialReference.WGS84;b=b||w.externalToInternal(a,c.camera);c.targetGeometry=A.vectorToPoint(b.center,a.renderSpatialReference,e);c.scale=w.computeScale(a,b);c.rotation=B(c.camera.heading);return c}function K(a,b,
c){if(b){if(!r.canProject(b.spatialReference,a.spatialReference))throw new e("viewpointutils:incompatible-spatialreference","Spatial reference ("+(b.spatialReference?b.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:b});var d=[];if(!b.hasZ&&a.basemapTerrain){var g=void 0;switch(b.type){case "point":g=b;break;case "multipoint":case "polyline":case "mesh":g=b.extent.center;break;case "extent":g=b.center;break;case "polygon":g=b.centroid;break;
default:f.neverReached(b)}g&&r.canProject(g,a.basemapTerrain.spatialReference)?W[2]=a.basemapTerrain.getElevation(g)||0:W[2]=0}(0,ea[b.type])(b,function(a){d.push(a[0],a[1],a[2])},W);var h=d.length/3;if(0!==h&&(g=Array(d.length),A.bufferToBuffer(d,b.spatialReference,0,g,a.spatialReference,0,h)))for(b.hasZ&&(c.hasZ=!0),a=0;a<g.length;a+=3)b.hasZ?(W[0]=g[a+0],W[1]=g[a+1],W[2]=g[a+2]):(W[0]=g[a+0],W[1]=g[a+1]),u.expand(c.boundingBox,W)}}function M(a,b,c,e){return a.whenViewForGraphic(b).then(function(a){if(a&&
a.whenGraphicBounds)return a.whenGraphicBounds(b,{minDemResolution:c})}).then(function(a){var b=a.boundingBox;u.expand(e.boundingBox,b);a.screenSpaceObjects&&a.screenSpaceObjects.forEach(function(a){e.screenSpaceObjects.push(a)});isFinite(b[2])&&(e.hasZ=!0)}).catch(function(){K(a,b.geometry,e)})}function Q(a,b,c,e){if(Array.isArray(b)&&2===b.length){var d=b[0],f=b[1];if("number"===typeof d&&"number"===typeof f)return ha.x=d,ha.y=f,ha.z=void 0,ha.spatialReference=g.SpatialReference.WGS84,K(a,ha,e),
k.resolve()}if(b&&"function"===typeof b.map)return k.eachAlways(b.map(function(b){return Q(a,b,c,e)}));if(b instanceof g.BaseGeometry)try{K(a,b,e)}catch(la){return k.reject(la)}else if(b instanceof l)return M(a,b,c,e);return k.resolve()}function P(a,b,c,e){if(b.camera)return k.resolve(O(a,c,b.camera,e));e.scale=b.scale;e.rotation=b.rotation;e.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;e.camera=null;null!=c.heading?e.rotation=B(c.heading):null!=c.rotation&&(e.rotation=c.rotation);
b=G(a,c);null!=b&&(e.scale=b);b=k.createResolver();I(a,e,c.tilt,b);return b.promise.then(function(a){e.camera=a;return e})}function O(a,b,c,e){e.camera=c.clone();e.camera.fov=a.camera.fov;b=a.spatialReference;c=e.camera.position.spatialReference;if(!r.canProject(c,b))return null;c.equals(b)||(e.camera.position=r.project(e.camera.position,b));return F(a,null,e)}function U(a,b,c,e,d){var f=a.renderSpatialReference;A.pointToVector(c.position,ka,f);A.pointToVector(b,da,f);d.targetGeometry=new g.Point(b);
d.camera.position=new g.Point(c.position);p.vec3.subtract(ia,da,ka);w.directionToHeadingTilt(a,ka,ia,e.up,d.camera);d.scale=w.distanceToScale(a,p.vec3.distance(ka,da),d.targetGeometry.latitude);d.rotation=B(d.camera.heading);return d}function N(a,b,c,e){if(!c)return k.reject();e.targetGeometry=c.clone();var d=y.cameraOnContentAlongViewDirection(a);if(b.position)return k.resolve(U(a,e.targetGeometry,b,d,e));if(b.zoomFactor){var f=d.distance/b.zoomFactor,g=p.vec3.scale(W,d.viewForward,-f);p.vec3.add(d.eye,
d.center,g);d.markViewDirty();e.scale=w.distanceToScale(a,f,c.latitude)}w.internalToExternal(a,d,e.camera);f=L(e.camera,b)?w.OrientationMode.LOCKED:w.OrientationMode.ADJUST;return b.zoomFactor?k.resolve(e):(e.scale=G(a,b),null==e.scale&&(A.pointToVector(c,W,a.renderSpatialReference),m.frustum.intersectsPoint(d.frustum.planes,W)?e.scale=w.distanceToScale(a,p.vec3.distance(d.eye,W),c.latitude):e.scale=w.computeScale(a,d)),b=k.createResolver(),w.fromCenterScale(a,e.targetGeometry,e.scale,e.camera,f,
b),b.promise.then(function(a){e.camera=a;return e}))}function V(a,b,c,e){e.targetGeometry=c.clone();var d=y.cameraOnContentAlongViewDirection(a);w.internalToExternal(a,d,e.camera);b=L(e.camera,b)?w.OrientationMode.LOCKED:w.OrientationMode.ADJUST;d=k.createResolver();w.fromExtent(a,c,e.camera.heading,e.camera.tilt,b,d);return d.promise.then(function(a){e.camera=a;return e})}function X(a,b,e,d,f){var g=0;e.hasZ?g=e.z:a.basemapTerrain&&(g=a.basemapTerrain.getElevation(e));p.vec3.set(W,e.x,e.y,g);A.computeLinearTransformation(a.spatialReference,
W,Z,a.renderSpatialReference);c.mat3.fromMat4(fa,Z);c.mat3.transpose(fa,fa);u.empty(ga);e=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var h=0;h<e.length;h++){var k=e[h],l=d[k[2]];isFinite(l)||(l=g);p.vec3.set(W,d[k[0]],d[k[1]],l);A.vectorToVector(W,a.spatialReference,W,a.renderSpatialReference);u.expand(ga,p.vec3.transformMat3(W,W,fa))}a=u.width(ga);d=u.height(ga);g=u.depth(ga);e=1/Math.tan(b.fovY/2);return Math.max(.5*Math.sqrt(a*a+g*g)*Math.max(e,1/Math.tan(b.fovX/2))+
.5*d,.5*d*e+.5*Math.max(a,g))/f}function J(a,b,c,e,d,f){f.targetGeometry=c.clone();var g=y.cameraOnContentAlongViewDirection(a);c=X(a,g,c,e,d);w.internalToExternal(a,g,f.camera);b=L(f.camera,b)?w.OrientationMode.LOCKED:w.OrientationMode.ADJUST;f.scale=w.distanceToScale(a,c,f.targetGeometry.latitude);g=k.createResolver();w.fromCenterScale(a,f.targetGeometry,f.scale,f.camera,b,g);return g.promise.then(function(a){f.camera=a;return f})}function R(a,b){if(!b||!a.spatialReference)return null;a={target:null};
if("declaredClass"in b||Array.isArray(b))a.target=b;else{for(var c in b)a[c]=b[c];b.center&&!a.target&&(a.target=b.center)}return a}function T(a){a&&(a.rotation=B(a.camera.heading));return a}Object.defineProperty(d,"__esModule",{value:!0});d.DEFAULT_FRAME_COVERAGE=.66;d.rotationToHeading=C;d.headingToRotation=B;d.toCamera=I;d.fromInternalCamera=function(a,c,e){e||(e=new b({camera:new q}));w.internalToExternal(a,c,e.camera);return F(a,c,e)};d.fromCamera=function(a,c,e){e||(e=new b);e.camera=c.clone();
return F(a,null,e)};d.create=function(a,c){var f=R(a,c);if(!f)return k.reject(new e("viewpointutils-create:no-target","Missing target for creating viewpoint"));var h=new b({camera:new q({fov:a.camera.fov})});if(f.target instanceof b)return P(a,f.target,f,h).then(function(a){return T(a)});if(f.target instanceof q)return k.resolve(T(O(a,f,f.target,h)));var l=null!=f.scale||null!=f.zoom;if(f.target instanceof g.Extent)return c=f.target.xmin===f.target.xmax||f.target.ymin===f.target.ymax,l||c?N(a,f,f.target.center,
h).then(function(a){return T(a)}):V(a,f,f.target,h).then(function(a){return T(a)});var m={boundingBox:u.empty(),hasZ:!1,screenSpaceObjects:[]};c=l?w.scaleToResolution(a,G(a,f)):void 0;return Q(a,f.target,c,m).then(function(){if(isFinite(m.boundingBox[0])){u.center(m.boundingBox,W);ha.x=W[0];ha.y=W[1];ha.z=W[2];ha.spatialReference=a.spatialReference;var b=void 0;isFinite(ha.z)&&m.hasZ?b=u.isPoint(m.boundingBox):(ha.z=void 0,b=v.isPoint(u.toRect(m.boundingBox,ja)));if(l||b)return N(a,f,ha,h);var b=
m.screenSpaceObjects,c=d.DEFAULT_FRAME_COVERAGE;if(b.length){for(var e=Number.NEGATIVE_INFINITY,k=0;k<b.length;k++)var n=b[k].screenSpaceBoundingRect,e=Math.max(e,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]));b=c-e/Math.min(a.width,a.height)*2}else b=c;return J(a,f,ha,m.boundingBox,b,h)}if(f.position)return b=y.cameraOnContentAlongViewDirection(a),p.vec3.copy(ia,b.viewForward),w.directionToHeadingTilt(a,b.eye,ia,b.up,Y),h.camera.position=new g.Point(f.position),h.camera.heading=null!=
f.heading?f.heading:Y.heading,h.camera.tilt=null!=f.tilt?f.tilt:Y.tilt,F(a,null,h);b=y.cameraOnContentAlongViewDirection(a);b=A.vectorToPoint(b.center,a.renderSpatialReference,ha,a.spatialReference);return N(a,f,b,h)}).then(function(a){return T(a)})};var W=n.vec3f64.create(),Z=h.mat4f64.create(),fa=a.mat3f64.create(),ga=u.create(),ja=v.create(),ia=n.vec3f64.create(),ka=n.vec3f64.create(),da=n.vec3f64.create(),Y={heading:0,tilt:0},ha=new g.Point,ea={point:function(a,b,c){c[0]=a.x;c[1]=a.y;a.hasZ&&
(c[2]=a.z);b(c)},polygon:function(a,b,c){for(var e=a.hasZ,d=0;d<a.rings.length;d++)for(var f=a.rings[d],g=0;g<f.length;g++)c[0]=f[g][0],c[1]=f[g][1],e&&(c[2]=f[g][2]),b(c)},polyline:function(a,b,c){for(var e=a.hasZ,d=0;d<a.paths.length;d++)for(var f=a.paths[d],g=0;g<f.length;g++)c[0]=f[g][0],c[1]=f[g][1],e&&(c[2]=f[g][2]),b(c)},multipoint:function(a,b,c){var e=a.points;a=a.hasZ;for(var d=0;d<e.length;d++)c[0]=e[d][0],c[1]=e[d][1],a&&(c[2]=e[d][2]),b(c)},extent:function(a,b,c){a.hasZ?(b(p.vec3.set(c,
a.xmin,a.ymin,a.zmin)),b(p.vec3.set(c,a.xmax,a.ymin,a.zmin)),b(p.vec3.set(c,a.xmin,a.ymax,a.zmin)),b(p.vec3.set(c,a.xmax,a.ymax,a.zmin)),b(p.vec3.set(c,a.xmin,a.ymin,a.zmax)),b(p.vec3.set(c,a.xmax,a.ymin,a.zmax)),b(p.vec3.set(c,a.xmin,a.ymax,a.zmax)),b(p.vec3.set(c,a.xmax,a.ymax,a.zmax))):(b(p.vec3.set(c,a.xmin,a.ymin,c[2])),b(p.vec3.set(c,a.xmax,a.ymin,c[2])),b(p.vec3.set(c,a.xmin,a.ymax,c[2])),b(p.vec3.set(c,a.xmax,a.ymax,c[2])))},mesh:function(a,b,c){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var e=
0;e<a.length;e+=3)b(p.vec3.set(c,a[e+0],a[e+1],a[e+2]))}}})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("require exports ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../support/geometryUtils ../../support/stack ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),function(t,d,q,g,l,b,f,e,k){function c(a,b,c){for(var e=0;e<a.length;e++){var d=a[e];b&&!b(d)||c.push(d)}return c}Object.defineProperty(d,
"__esModule",{value:!0});t=function(){function d(a,c,d){this.viewingMode=a;this.layerProvider=c;this.view=d;this.tmpIntersector=new e(this.viewingMode);this.tmpRay=b.ray.create();this.externalIntersectionHandlers=new Set;this.intersectionTolerance=e.DEFAULT_TOLERANCE;this.validateHUDIntersector=new e(this.viewingMode);this.validateHUDIntersector.enable.hud=!1}d.prototype.intersectScreen=function(a,b,c,e){return this.intersectRay(this.getPickRay(a,this.tmpRay),b,c,e)};d.prototype.intersectScreenFreePointFallback=
function(a,b,c,e){return this.intersectRayFreePointFallback(this.getPickRay(a,this.tmpRay),b,c,e)};d.prototype.intersectRay=function(a,b,c,e){e=this.computeIntersection(a,c,!1,e||this.tmpIntersector);b=e?(a=e.results.min)?a.getIntersectionPoint(b):!1:!1;return b};d.prototype.intersectRayFreePointFallback=function(a,b,c,e){return this.intersectRay(a,b,c,e)||this.intersectRayFreePointLocal(a,b)};d.prototype.intersectIntersectorScreen=function(a,b,c,e,d){void 0===e&&(e=!1);void 0===d&&(d=!1);return this.computeIntersection(this.getPickRay(a,
this.tmpRay),c,e,b,d)};d.prototype.intersectToolIntersectorScreen=function(a,b,c){a=this.getPickRay(a,this.tmpRay);var e=this.computeIntersection(a,c,!0,b),d=e.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.isOpaque()||d.hasIntersectionPoint&&"TerrainRenderer"!==d.intersector||(e=this.computeIntersection(a,c,!1,b));return e};d.prototype.setTolerance=function(a){void 0===a&&(a=e.DEFAULT_TOLERANCE);this.intersectionTolerance=a};d.prototype.addIntersectionHandler=function(a){this.externalIntersectionHandlers.add(a)};
d.prototype.removeIntersectionHandler=function(a){this.externalIntersectionHandlers.delete(a)};d.prototype.getPickRay=function(a,c){void 0===c&&(c=b.ray.create());return b.ray.fromScreen(this.view.state.camera,a,c)};d.prototype.intersectRayFreePointLocal=function(a,b){if("local"!==this.viewingMode)return!1;var c=this.view.dataExtent,e=Math.max(c.xmax-c.xmin,c.ymax-c.ymin,8*Math.max(c.xmax-c.xmin,c.ymax-c.ymin));if(0===e)return l.vec3.add(b,a.origin,l.vec3.normalize(f.sv3d.get(),a.direction)),!0;var d=
this.view.state.camera,g=Math.max(0,c.xmin-d.eye[0],d.eye[0]-c.xmax),c=Math.max(0,c.ymin-d.eye[1],d.eye[1]-c.ymax),d=e/Math.max(1,Math.pow(Math.max(0,Math.log(e/(Math.abs(d.relativeElevation)+Number.MIN_VALUE))),2)),d=Math.max(d,Math.min(Math.sqrt(g*g+c*c),e)),e=l.vec3.scale(f.sv3d.get(),a.direction,d/l.vec3.length(a.direction));l.vec3.add(b,a.origin,e);return!0};d.prototype.computeIntersection=function(b,c,d,h,r){var n=this,p=this.view.state.camera,m=g.castRenderScreenPointArray3(f.sv3d.get());p.projectPoint(b.origin,
m);var u=this.prepareFilters(c,a);h=h||new e(this.viewingMode);h.enable.storeAll=c&&c.allEnabled;h.enable.storeTerrainResults=u.filterLayerUid(k.TERRAIN_ID);h.enable.selectOpaqueTerrainOnly=!c||!("include"in c||"exclude"in c);var v=b.origin,q=l.vec3.add(f.sv3d.get(),b.origin,b.direction);h.intersect(u.layers,v,q,m,p,this.intersectionTolerance,d,null);var t=(b=this.view.slicePlane)?k.sliceFilterPredicate(b):null;h.intersect(u.sliceableLayers,v,q,m,p,this.intersectionTolerance,d,t,!1);var E=c&&c.terrainLocationFeedbackEnabled||
r;this.externalIntersectionHandlers.forEach(function(a){if(a.intersectionHandlerId===k.TERRAIN_ID){if(!E&&!u.filterLayerUid(k.TERRAIN_ID))return}else if(!u.filterLayerUid(a.intersectionHandlerId))return;a.intersect(h,a.slicePlaneEnabled?t:null,v,q,m)});c=f.sv3d.get();r&&h.results.terrain.getIntersectionPoint(c)&&(r=this.view._stage.getDrapedRenderer(),b=f.sv3d.get(),this.view.renderCoordsHelper.fromRenderCoords(c,b,this.view.spatialReference),b[2]=this.view.basemapTerrain.getElevation(c)||0,r.intersect(h,
b,u.filterRenderGeometry));h.sortResults();r=h.results.hud;if(r.hasIntersectionPoint){var I=g.castRenderScreenPointArray3(f.sv3d.get()),G=f.sv3d.get(),L=f.sv3d.get();this.unprojectHUDResultRay(r.center,I,G,L);c=l.vec3.distance(r.center,G)/l.vec3.distance(G,L)*.99;this.validateHUDIntersector.intersect(u.layers,G,L,I,p,this.intersectionTolerance,d,null);this.validateHUDIntersector.intersect(u.sliceableLayers,G,L,I,p,this.intersectionTolerance,d,t,!1);this.externalIntersectionHandlers.forEach(function(a){u.filterLayerUid(a.intersectionHandlerId)&&
a.intersect(n.validateHUDIntersector,a.slicePlaneEnabled?t:null,G,L,I)});d=this.validateHUDIntersector.results.min;if(null==d.dist||c<=d.dist)h.results.min.copyFrom(r),h.results.all.splice(0,0,r)}return h};d.prototype.prepareFilters=function(a,b){var e=[],d=[];this.layerProvider.forEachLayer(function(a){a.isPickable&&(a.isSliceable?d:e).push(a)});b.include=a&&a.include;b.exclude=a&&a.exclude;b.layers.length=0;b.sliceableLayers.length=0;c(e,b.filterLayer,b.layers);c(d,b.filterLayer,b.sliceableLayers);
return b};d.prototype.unprojectHUDResultRay=function(a,b,c,e){var d=this.view.state.camera;d.projectPoint(a,b);a=g.castRenderScreenPointArray3(f.sv3d.get());a[0]=b[0];a[1]=b[1];a[2]=0;d.unprojectPoint(a,c);a[2]=1;d.unprojectPoint(a,e)};return d}();d.SceneIntersectionHelper=t;var a={include:null,exclude:null,layers:[],sliceableLayers:[],filterLayer:function(b){return a.filterLayerUid(b.apiLayerUid)},filterLayerUid:function(b){var c=a.include,e=a.exclude;return q.isNone(b)?null==c&&null==e:(null==c||
c.has(b))&&(null==e||!e.has(b))},filterRenderGeometry:function(b){return a.filterLayerUid(b.data.layerUid)}}})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery ./Evented".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){return function(b){function d(a){a=b.call(this)||this;a.providers={im:[],ground:[],scene:[]};a.handles=new Map;return a}q(d,b);d.prototype.getElevation=function(a,b){var c=-Infinity,e=!0;"scene"===b&&(c=this._updateElevation(c,this.providers.im,a,b),isFinite(c)&&(e=!1));e&&(c=this._updateElevation(c,this.providers.ground,a,b));"scene"===b&&(c=this._updateElevation(c,this.providers.scene,a,b));return isFinite(c)?c:null};d.prototype._updateElevation=function(a,b,c,
e){for(var d=0;d<b.length;d++){var f=b[d].getElevation(c,e);null!=f&&(a=Math.max(f,a))}return a};d.prototype.queryElevation=function(b,d,f){var g=this;void 0===d&&(d=0);this._elevationService||(this._elevationService=new a.ElevationQuery(this.view.spatialReference,function(){return g.view.map&&g.view.map.ground},{maximumAutoTileRequests:4}));var h=e.createResolver();(c.isPoint(b)?this._elevationService.queryElevation(b.x,b.y,d):this._elevationService.queryElevation(b[0],b[1],d)).then(function(a){"scene"===
f&&(a=g._updateElevation(a,g.providers.scene,b,f));h.resolve(isFinite(a)?a:null)}).catch(function(){return h.resolve(g.getElevation(b))});return h.promise};d.prototype.register=function(a,b){var c=this;this.handles.set(b,b.on("elevation-change",function(a){return c.emit("elevation-change",a)}));this.providers[a].push(b)};d.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var e=c[b],
d=this.providers[e].indexOf(a);-1<d&&this.providers[e].splice(d,1)}};g([k.property({constructOnly:!0})],d.prototype,"view",void 0);g([k.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],d.prototype,"spatialReference",void 0);return d=g([k.subclass("esri.views.3d.support.CombinedElevationProvider")],d)}(k.declared(f,h.Evented))})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function e(c,a){this.spatialReference=c;this.view=a;this.point=new b.Point;this.point.spatialReference=c}e.prototype.getElevation=function(b,a,e){this.point.x=b;this.point.y=a;return this.view.elevationProvider.getElevation(this.point,e)};e.prototype.queryElevation=function(b,a,e,d){return g(this,void 0,void 0,function(){return q(this,function(c){this.point.x=b;this.point.y=a;return[2,this.view.elevationProvider.queryElevation(this.point,
e,d)]})})};return e}();d.ViewElevationProvider=t;t=function(){function d(b,a,e){this.spatialReference=b;this._getElevationQueryProvider=a;this._queries=[];this._isScheduled=!1;this._queryOptions=l({},e,{ignoreInvisibleLayers:!0})}d.prototype.queryElevation=function(b,a,e){void 0===e&&(e=0);return g(this,void 0,void 0,function(){var c=this;return q(this,function(d){return[2,f.create(function(d,f){c._queries.push({x:b,y:a,minDemResolution:e,result:{resolve:d,reject:f}});c._scheduleDoQuery()})]})})};
d.prototype._scheduleDoQuery=function(){var b=this;this._isScheduled||(e.schedule(function(){return b._doQuery()}),this._isScheduled=!0)};d.prototype._doQuery=function(){return g(this,void 0,void 0,function(){var c,a,e,d,f,g,k,r,y;return q(this,function(h){switch(h.label){case 0:this._isScheduled=!1;c=this._queries;this._queries=[];a=c.map(function(a){return[a.x,a.y]});e=c.reduce(function(a,b){return Math.min(a,b.minDemResolution)},Infinity);d=new b.Multipoint({points:a,spatialReference:this.spatialReference});
f=this._getElevationQueryProvider();if(!f)return c.forEach(function(a,b){return a.result.reject()}),[2];k=l({},this._queryOptions,{minDemResolution:e});h.label=1;case 1:return h.trys.push([1,3,,4]),[4,f.queryElevation(d,k)];case 2:return g=h.sent(),[3,4];case 3:return r=h.sent(),c.forEach(function(a){return a.result.reject(r)}),[2];case 4:return y=g.geometry.points,c.forEach(function(a,b){return a.result.resolve(y[b][2])}),[2]}})})};return d}();d.ElevationQuery=t})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require",
"exports","../../../core/has"],function(t,d,q){function g(){var d=!!q("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4},sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5},antialiasingEnabled:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},
medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:d},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,memoryLimit:d?400:500,additionalCacheMemory:d?0:100,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5},sceneService:{"3dObject":{lodFactor:1},
point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,memoryLimit:d?600:1E3,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:d?null:4096,maximumPixelRatio:d?1:null}}}t=function(){function d(){}d.isValidProfile=function(b){return b in d.profiles};d.getDefaultProfile=function(){return q("trident")||q("esri-iPhone")?"low":"medium"};d.apply=function(b,f){b=d.profiles[b];
f.graphics3D.maxTotalNumberOfFeatures=b.graphics3D.maxTotalNumberOfFeatures;f.graphics3D.maxTotalNumberOfPrimitives=b.graphics3D.maxTotalNumberOfPrimitives;f.sceneService["3dObject"].lodFactor=b.sceneService["3dObject"].lodFactor;f.sceneService.point.lodFactor=b.sceneService.point.lodFactor;f.sceneService.integratedMesh.lodFactor=b.sceneService.integratedMesh.lodFactor;f.sceneService.pointCloud.lodFactor=b.sceneService.pointCloud.lodFactor;f.sceneService.uncompressedTextureDownsamplingEnabled=b.sceneService.uncompressedTextureDownsamplingEnabled;
f.tiledSurface.lodBias=b.tiledSurface.lodBias;f.tiledSurface.angledSplitBias=b.tiledSurface.angledSplitBias;f.antialiasingEnabled=b.antialiasingEnabled;f.memoryLimit=b.memoryLimit;f.additionalCacheMemory=b.additionalCacheMemory;f.frameRate=b.frameRate;f.maximumRenderResolution=b.maximumRenderResolution;f.maximumPixelRatio=b.maximumPixelRatio};d.debug={reset:function(){var b=g(),f;for(f in b)d.profiles[f]=b[f]}};return d}();(t||(t={})).profiles=g();return t})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4f32".split(" "),
function(t,d,q,g,l,b,f,e){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.color=new l([0,255,255]);a.haloOpacity=1;a.fillOpacity=.25;return a}q(c,b);c.toEngineOptions=function(a){var b=l.toUnitRGBA(a.color);return{color:e.vec4f32.fromValues(b[0],b[1],b[2],b[3]),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};g([f.property({type:l})],c.prototype,"color",void 0);g([f.property()],c.prototype,
"haloOpacity",void 0);g([f.property()],c.prototype,"fillOpacity",void 0);return c=g([f.subclass()],c)}(f.declared(b))})},"esri/views/3d/support/index":function(){define(["require","exports","./ResourceController","./MemoryController"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.newResourceController=q.newResourceController;d.newMemoryController=g.newMemoryController;t=d.ClientType||(d.ClientType={});t.TERRAIN="terrain";t.SCENE="scene";t.SYMBOLOGY="symbology"})},"esri/views/3d/support/ResourceController":function(){define("require exports ../../../core/Handles ../../../core/now ../../../core/scheduling ./index ./MemoryController ./StreamDataLoader ./StreamDataSupplier ../../support/Scheduler".split(" "),
function(t,d,q,g,l,b,f,e,k,c){Object.defineProperty(d,"__esModule",{value:!0});d.newResourceController=function(b,c){void 0===c&&(c=g);return new a.ResourceController(b,c)};var a;(function(a){function d(a){var c={},d;for(d in b.ClientType)c[b.ClientType[d]]=0;c[b.ClientType.TERRAIN]=15;c[b.ClientType.SCENE]=20;c[b.ClientType.SYMBOLOGY]=5;return new e.default(c,a)}var h=function(){function a(a,b){void 0===b&&(b=g);var e=this;this._view=a;this._streamDataLoader=this._memoryController=this._scheduler=
null;this._lastTargetChangeTime=0;this._handles=new q;this._frameTask=null;this._lastTargetChangeTime=b();this._scheduler=c.newScheduler(b);this._memoryController=f.newMemoryController(this._view);this._streamDataLoader=d(this._scheduler);this._handles.add(this._view.watch("state.camera",function(){return e._cameraChangedHandler()},!0));this._frameTask=l.addFrameTask({update:function(a){return e.frame(a)}})}a.prototype.destroy=function(){this._handles.remove();this._frameTask&&(this._frameTask.remove(),
this._frameTask=null);this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null);this._memoryController.destroy();this._scheduler=this._memoryController=null};Object.defineProperty(a.prototype,"updating",{get:function(){return this._memoryController.updating},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"scheduler",{get:function(){return this._scheduler},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"memoryController",{get:function(){return this._memoryController},
enumerable:!0,configurable:!0});a.prototype.getStreamDataSupplier=function(a,b){return new k.StreamDataSupplier(a,this._streamDataLoader,b)};a.prototype.frame=function(a){this._view.suspended||(this._view.stateManager&&this._view.stateManager.step(a.deltaTime/1E3),this._scheduler.state=this.state,this._scheduler.updateBudget(a)?(this._memoryController.update(),this._scheduler.frame(a)):this._memoryController.updating&&this._memoryController.update())};a.prototype._cameraChangedHandler=function(){this._lastTargetChangeTime=
this._scheduler.now;this._scheduler.state=this.state;this.memoryController.notifyViewChanged()};Object.defineProperty(a.prototype,"state",{get:function(){return this._scheduler.now-this._lastTargetChangeTime>u?2:this._view.animation?0:1},enumerable:!0,configurable:!0});return a}();a.ResourceController=h;var u=300})(a||(a={}))})},"esri/views/3d/support/MemoryController":function(){define("require exports ../../../core/Logger ../../../core/MemCache ../layers/support/MemoryManagedLayerView ./Evented".split(" "),
function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});var f=q.getLogger("esri.views.3d.support.MemoryController");d.newMemoryController=function(b){return new e(b)};var e=function(){function e(c){this._view=c;this.events=new b.Evented;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new g.Storage;this._updating=!1}e.prototype.destroy=
function(){this.events=null};e.prototype.getMemCache=function(b,a){return new g(b,this._cacheStorage,a)};Object.defineProperty(e.prototype,"maxMemory",{set:function(b){null!=b&&0<b&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<b&&this._updateQuality(1),this._maxMemory=b)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"additionalCacheMemory",{set:function(b){null!=b&&0<=b&&(this._additionalCacheMemory=b)},enumerable:!0,configurable:!0});e.prototype.disableMemCache=
function(){this._additionalCacheMemory=-4096};Object.defineProperty(e.prototype,"memoryFactor",{get:function(){return this._quality},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"updating",{get:function(){return this._updating},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"usedMemory",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});e.prototype.notifyViewChanged=function(){this._stableQuality=0};e.prototype.update=function(){this._updateMemory();
if(!(0>=this._memoryPredicted)||this._updating){var b=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(b){if(.1>=this._quality)return;if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=
this._memoryUsed)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,b=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,b=this._updateQuality(this._quality+.1*(.75-this._memoryUsed+.1))):1>this._quality&&(this._canFastRecover=!0));this.updating!==b&&(this._updating=b,this.events.emit("updating-changed",
this.updating))}};e.prototype._updateQuality=function(b){b=Math.min(Math.max(b,.1),1);if(b===this._quality)return!1;this._quality=b;this.events.emit("quality-changed",this._quality);return!0};e.prototype._layersUpdating=function(){var b=this._view.basemapTerrain&&this._view.basemapTerrain.hasPendingUpdates();this._view.allLayerViews.forEach(function(a){return b=b||a.updating});return!!b};e.prototype._updateMemory=function(){var b=this,a=0,e=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&
(a+=this._view.basemapTerrain.getUsedMemory());var d=this._view._stage&&this._view._stage.view&&this._view._stage.view.edgeView;d&&(a+=d.getUsedMemory());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(c){if(l.isMemoryManagedLayerView(c)){var d=c.ignoresMemoryFactor()?b._quality:1;a+=c.getUsedMemory()*d;e+=c.getUnloadedMemory()*d}});var g=null==this._warnMemoryUsage||Math.round(10*a)!==Math.round(10*this._warnMemoryUsage),d=1048576*this._maxMemory;if(a>d&&g){this._warnMemoryUsage=
a;var g=function(a){return(a/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},k=Math.round(100*this._quality);f.warn("Memory Limit exceeded! Limit: "+g(d)+" Current: "+g(a)+" Projected: "+g(a+e)+" Quality: "+k+"%")}this._memoryUsed=a/d;this._memoryPredicted=(a+e)/d;this._cacheStorage.maxSize=Math.max(0,d-a+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};Object.defineProperty(e.prototype,"test",{get:function(){return{cacheStorage:this._cacheStorage}},
enumerable:!0,configurable:!0});return e}()})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.isMemoryManagedLayerView=function(d){return"function"===typeof d.getUsedMemory}})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports dojo/errors/CancelError ../../../request ../../../core/arrayUtils ../../../core/lang ../../../core/now ./AsyncQuotaRoundRobinQueue ./PromiseLightweight ../webgl-engine/lib/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c){Object.defineProperty(d,"__esModule",{value:!0});d.ClientPromise=k.default;t=function(){function a(a,b){var c=this;this.tasks=new Map;this.clientPromiseToTask=new Map;this.doneQueue=[];this.loadQueue=new e(this.startLoading.bind(this),this.doneLoadingCallback,this,a);b&&(this.taskHandle=b.registerTask(1,function(a){return c.update(a)},function(){return 0<c.doneQueue.length}))}a.prototype.destroy=function(){var a=this;this.taskHandle&&(this.taskHandle.remove(),this.taskHandle=
null);this.tasks.forEach(function(b){var c=0;for(b=b.clientPromises;c<b.length;c++)a.cancel(b[c])});this.loadQueue.clear();this.clientPromiseToTask=this.tasks=this.doneQueue=this.loadQueue=null};a.prototype.request=function(a,b,c,e){var f=this;void 0===e&&(e=a);var g=new d.ClientPromise(function(){f.cancel(g)});this.createOrUpdateTask(a,b,c,e,g);return g};a.prototype.createTask=function(a,b,c,e,d){a={url:a,docType:b,clientType:c,key:e,result:null,status:1,clientPromises:[],downloadObj:null,_cancelledInQueue:!1,
startTime:0,duration:0,size:0};this.updateTask(a,d);this.tasks.set(e,a);this.loadQueue.push(a)};a.prototype.cancel=function(a){var b=this.clientPromiseToTask.get(a);b&&(a.reject(new q),l.removeUnordered(b.clientPromises,a),this.clientPromiseToTask.delete(a),0===b.clientPromises.length&&(2===b.status&&(this.loadQueue.workerCancelled(b),b.status=4,b.downloadObj.cancel(),b.downloadObj=null),b.status=4,this.tasks.delete(b.key)))};a.prototype.hasPendingDownloads=function(){return 0<this.tasks.size};a.prototype.taskKey=
function(a,b,c){return a+":"+b+":"+c};a.prototype.updateTask=function(a,b){this.clientPromiseToTask.set(b,a);a.clientPromises.push(b)};a.prototype.createOrUpdateTask=function(a,b,c,e,d){e=this.taskKey(e,b,c);var f=this.tasks.get(e);f?this.updateTask(f,d):this.createTask(a,b,c,e,d)};a.prototype.doneLoadingCallback=function(a,b){c.assert(2===a.status);this.taskHandle?(a.status=3,this.doneQueue.push({task:a,err:b})):this.doneLoading(a,b)};a.prototype.update=function(a){for(;!a.done&&0<this.doneQueue.length;){var b=
this.doneQueue.shift();3!==b.task.status&&(b.err=b.err||new q);this.doneLoading(b.task,b.err);a.madeProgress()}};a.prototype.doneLoading=function(a,c){for(var e=a.result instanceof HTMLImageElement?0:a.clientPromises.length,d=0,f=a.clientPromises;d<f.length;d++){var g=f[d];this.clientPromiseToTask.delete(g);if(c)g.isRejected()||g.reject({url:a.url,error:c});else{--e;var h=0>=e?a.result:b.clone(a.result);g.resolve({url:a.url,data:h})}}this.tasks.delete(a.key)};a.prototype.startLoading=function(a,b){if(4===
a.status)return!1;a.status=2;var c,e;switch(a.docType){case "binary":e="array-buffer";c=0;break;case "image":e="image";break;default:e="json"}a.startTime=f();a.downloadObj=g(a.url,{responseType:e,timeout:c});a.downloadObj.then(function(c){a.duration=f()-a.startTime;a.size="binary"===a.docType?c.data.byteLength:0;a.result=c.data;b(a)},function(c){a.downloadObj.isCanceled()||b(a,c)});return!0};Object.defineProperty(a.prototype,"test",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0});
return a}();d.StreamDataLoader=t;d.default=t})},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["require","exports","../../../core/arrayUtils","../webgl-engine/lib/Util"],function(t,d,q,g){return function(){function d(b,d,e,g){this.workerFunc=b;this.robin=0;this.type2id={};this.tasks=[];this.typeNumWorkers=[];this.typeWorkerQuota=[];this.typeStatistics=[];this.numTypes=this.maxTotalNumWorkers=this.totalNumWorkers=0;for(var c in g)this.type2id[c]=this.tasks.length,this.tasks.push([]),
this.typeNumWorkers.push(0),this.typeStatistics.push({requests:0,size:0,duration:0,speed:0}),this.typeWorkerQuota.push(g[c]),this.maxTotalNumWorkers+=g[c];this.numTypes=this.tasks.length;var a=this;this.taskCallback=function(b){b._cancelledInQueue||(d.apply(e,arguments),a.taskFinished(b))}}d.prototype.setWorkerQuota=function(b){g.assert(q.equals(Object.keys(this.typeWorkerAllocation),Object.keys(b)));this.typeWorkerAllocation=b;this.maxTotalNumWorkers=0;for(var d in b)this.typeWorkerQuota[this.type2id[d]]=
b[d],this.maxTotalNumWorkers+=b[d]};d.prototype.push=function(b){var d=this.type2id[b.clientType];this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[d]++,this.totalNumWorkers++,this.workerFunc(b,this.taskCallback)):this.tasks[d].push(b)};d.prototype._getStatsForType=function(b){b=this.type2id[b];return{quota:this.typeWorkerQuota[b],workers:this.typeNumWorkers[b],queueSize:this.tasks[b].length,requestStats:this.typeStatistics[b]}};d.prototype.removeTasks=function(b,d){for(var e=[],f=
0,c=this.tasks[this.type2id[d]];f<c.length;f++){var a=c[f];-1===b.indexOf(a)&&e.push(a)}this.tasks[this.type2id[d]]=e};d.prototype.workerCancelled=function(b){this.taskFinished(b);b._cancelledInQueue=!0};d.prototype.clear=function(){for(var b=0;b<this.tasks.length;b++)this.tasks[b]=[]};d.prototype.taskFinished=function(b){var d=this.type2id[b.clientType];this.typeNumWorkers[d]--;this.totalNumWorkers--;this.typeStatistics[d].requests++;this.typeStatistics[d].size+=b.size||0;this.typeStatistics[d].duration+=
b.duration||0;this.typeStatistics[d].speed=0<this.typeStatistics[d].duration?this.typeStatistics[d].size/this.typeStatistics[d].duration:0;g.assert(0<=this.typeNumWorkers[d]);this.next()};d.prototype.next=function(){var b=this.robin,d=!1;do this.typeNumWorkers[b]<this.typeWorkerQuota[b]&&this.processQueue(b)&&(d=!0),b=(b+1)%this.numTypes;while(!d&&b!==this.robin);if(!d){do this.processQueue(b)&&(d=!0),b=(b+1)%this.numTypes;while(!d&&b!==this.robin)}this.robin=b};d.prototype.processQueue=function(b){for(;0<
this.tasks[b].length;)if(this.workerFunc(this.tasks[b].shift(),this.taskCallback))return this.typeNumWorkers[b]++,this.totalNumWorkers++,!0;return!1};Object.defineProperty(d.prototype,"test",{get:function(){var b=this;return{set workerFunc(d){b.workerFunc=d}}},enumerable:!0,configurable:!0});return d}()})},"esri/views/3d/support/StreamDataSupplier":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(d,l,b){this._clientType=
d;this._loader=l;this._activeRequests=null;b&&b.trackRequests&&(this._activeRequests=new Map)}d.prototype.request=function(d,l,b){var f=this;void 0===b&&(b=d);if(this._activeRequests&&this._activeRequests.has(d))return null;d=this._loader.request(d,l,this._clientType,b);this._activeRequests&&(this._activeRequests.set(b,d),l=function(){return f._activeRequests.delete(b)},d.then(l,l));return d};d.prototype.cancelRequest=function(d){this._loader.cancel(d)};d.prototype.cancelAll=function(){var d=this;
this._activeRequests&&(this._activeRequests.forEach(function(g){return d._loader.cancel(g)}),this._activeRequests.clear())};d.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()};return d}();d.StreamDataSupplier=t;d.default=t})},"esri/views/support/Scheduler":function(){define(["require","exports","../../core/maybe","../../core/PooledArray"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.newScheduler=function(b){return new l.Scheduler(b)};d.newBudget=
function(b){return new l.Budget(b)};var l;(function(b){var d=function(){function d(c){this._now=c;this._budget=null;this._state=1;this._tasks=new g;this._runQueue=new g;this._idleStateCallbacks=new g;this._forceTask=this._idleUpdatesStartFired=!1;this._safetyBudget=0;this._budget=new b.Budget(c);var a=this;this._test={state:void 0,idleBudget:100,get budget(){return a._budget.budget},elapsed:0}}d.prototype.registerTask=function(b,a,e){var c=this,d={update:a,needsUpdate:e,priority:b,schedule:b};this._tasks.push(d);
return{remove:function(){return c._removeTask(d)},set priority(a){d.priority=a;0!==d.schedule&&(d.schedule=a)}}};d.prototype.registerIdleStateCallbacks=function(b,a){var c=this,e={idleBegin:b,idleEnd:a};this._idleStateCallbacks.push(e);2===this.state&&this._idleUpdatesStartFired&&e.idleBegin();var d=this;return{remove:function(){return c._removeIdleStateCallbacks(e)},set idleBegin(a){d._idleUpdatesStartFired&&(e.idleEnd(),2===d._state&&a());e.idleBegin=a},set idleEnd(a){e.idleEnd=a}}};Object.defineProperty(d.prototype,
"now",{get:function(){return this._now()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"state",{get:function(){return q.isNone(this._test.state)?this._state:this._test.state},set:function(b){this._state!==b&&(this._state=b,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forEach(function(a){return a.idleEnd()})))},enumerable:!0,configurable:!0});d.prototype.updateBudget=function(b){var a=2===this.state,c=b.frameDuration;switch(this.state){case 2:c=
100;break;case 1:c=Math.max(33,b.frameDuration);break;case 0:c=b.frameDuration}this._safetyBudget=a?0:c>2.5*b.tickTime?b.tickTime:5;c-=b.elapsedFrameTime+this._safetyBudget;this._test.elapsed=0;if(!a&&0>c&&!this._forceTask)return this._forceTask=!0,!1;c=Math.max(c,5);this._budget.reset(c,a);return this._schedule()};d.prototype.frame=function(b){this._forceTask=!1;switch(this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forEach(function(a){return a.idleBegin()}));
this._idleFrame();break;case 1:this._movingFrame();break;default:this._run()}this._test.elapsed=this._budget.elapsed};d.prototype._removeIdleStateCallbacks=function(b){this._idleUpdatesStartFired&&b.idleEnd();this._idleStateCallbacks.removeUnordered(b)};d.prototype._removeTask=function(b){this._tasks.removeUnordered(b);this._runQueue.removeUnordered(b)};d.prototype._idleFrame=function(){this._run()};d.prototype._movingFrame=function(){this._run()};d.prototype._schedule=function(){var b=this;this._runQueue.forEach(function(a){a.needsUpdate()||
(e.push(a),a.schedule=a.priority)});this._runQueue.removeUnorderedMany(e.data,e.length);e.clear();for(var a=function(){var a=!1;d._tasks.forEach(function(c){if(c.needsUpdate())switch(a=!0,c.schedule){case 0:break;case 1:c.schedule=0;b._runQueue.push(c);break;default:--c.schedule}});if(!a)return{value:!1}},d=this;0===this._runQueue.length;){var f=a();if("object"===typeof f)return f.value}return!0};d.prototype._run=function(){for(;0<this._runQueue.length;){var b=this._runQueue.pop();this._budget.resetProgress();
b.update(this._budget);b.schedule=b.priority;if(0>=this._budget.remaining)break}};Object.defineProperty(d.prototype,"test",{get:function(){return this._test},enumerable:!0,configurable:!0});return d}();b.Scheduler=d;var e=new g,d=function(){function b(b){this.now=b;this._budget=this._begin=0;this._didWork=this._idle=!1}b.prototype.run=function(b){if(this.done)return!1;!0===b()&&(this._didWork=!0);return!0};Object.defineProperty(b.prototype,"done",{get:function(){return this._didWork&&this.elapsed>=
this._budget},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"budget",{get:function(){return this._budget},enumerable:!0,configurable:!0});b.prototype.madeProgress=function(){this._didWork=!0};Object.defineProperty(b.prototype,"idleFrame",{get:function(){return this._idle},enumerable:!0,configurable:!0});b.prototype.reset=function(b,a){this._begin=this.now();this._budget=b;this._idle=a;this._didWork=!1};Object.defineProperty(b.prototype,"remaining",{get:function(){return Math.max(this._budget-
this.elapsed,0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"elapsed",{get:function(){return this.now()-this._begin},enumerable:!0,configurable:!0});b.prototype.resetProgress=function(){this._didWork=!1};Object.defineProperty(b.prototype,"hasProgressed",{get:function(){return this._didWork},enumerable:!0,configurable:!0});return b}();b.Budget=d})(l||(l={}))})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/promiseUtils ../../../core/unitUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(c,a,e){void 0===e&&(e=null);var d=this;this.spatialReference=a;this.unitInMeters=b.getMetersPerUnitForSR(this.spatialReference);(this.geometryService=e)||f.create(c&&c.get("portalItem")).then(function(a){d.geometryService=a}).catch(function(){})}d.prototype.toGeographic=function(b){var a=this,c=!0;if(!this.geometryService)return l.reject(new g("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config"));
Array.isArray(b[0])&&"number"!==typeof b[0]||(b=[b],c=!1);b=b.map(function(b){return b instanceof q.Point?b:new q.Point(b,a.spatialReference)});b=new e({geometries:b,outSpatialReference:q.SpatialReference.WGS84});return this.geometryService.project(b).then(function(a){a=a.map(function(a){if("point"===a.type)return[a.x,a.y]});return c?a:a[0]})};d.prototype.canProject=function(){return!!this.geometryService};return d}();d.MapCoordsHelper=t;d.default=t})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b){var f=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.minTotalNumberOfFeatures=2E3;b.maxTotalNumberOfFeatures=5E4;b.maxTotalNumberOfPrimitives=17E5;return b}q(c,a);g([b.property()],c.prototype,"minTotalNumberOfFeatures",void 0);g([b.property()],c.prototype,"maxTotalNumberOfFeatures",void 0);g([b.property()],c.prototype,"maxTotalNumberOfPrimitives",void 0);return c=g([b.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],c)}(b.declared(l)),
e=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.lodFactor=1;return b}q(c,a);g([b.property()],c.prototype,"lodFactor",void 0);return c=g([b.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],c)}(b.declared(l)),k=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b["3dObject"]=new e;b.point=new e;b.integratedMesh=new e;b.pointCloud=new e;b.uncompressedTextureDownsamplingEnabled=!1;return b}q(c,a);g([b.property({type:e})],c.prototype,"3dObject",
void 0);g([b.property({type:e})],c.prototype,"point",void 0);g([b.property({type:e})],c.prototype,"integratedMesh",void 0);g([b.property({type:e})],c.prototype,"pointCloud",void 0);g([b.property()],c.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return c=g([b.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],c)}(b.declared(l)),c=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.lodBias=0;b.angledSplitBias=1;return b}q(c,a);g([b.property()],
c.prototype,"lodBias",void 0);g([b.property()],c.prototype,"angledSplitBias",void 0);return c=g([b.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],c)}(b.declared(l));return function(a){function e(){var b=null!==a&&a.apply(this,arguments)||this;b.graphics3D=new f;b.sceneService=new k;b.tiledSurface=new c;b.antialiasingEnabled=!0;return b}q(e,a);g([b.property({type:f})],e.prototype,"graphics3D",void 0);g([b.property({type:k})],e.prototype,"sceneService",void 0);g([b.property({type:c})],
e.prototype,"tiledSurface",void 0);g([b.property()],e.prototype,"antialiasingEnabled",void 0);g([b.property()],e.prototype,"memoryLimit",void 0);g([b.property()],e.prototype,"additionalCacheMemory",void 0);g([b.property()],e.prototype,"frameRate",void 0);g([b.property()],e.prototype,"maximumRenderResolution",void 0);g([b.property()],e.prototype,"maximumPixelRatio",void 0);return e=g([b.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],e)}(b.declared(l))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/compilerUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../geometry/SpatialReference ../../../layers/graphics/dehydratedFeatures ./earthUtils ./geometryUtils ./projectionUtils ./stack ./geometryUtils/coordinateSystem".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(a,b,c,e){this.type=a;this.spatialReference=b;this.unitInMeters=c;this.coordinateSystem=e;this.tmpCoordinateSystem=n.create(e)}Object.defineProperty(d.prototype,"extent",{set:function(a){a&&n.setExtent(this.coordinateSystem,a,this.coordinateSystem)},enumerable:!0,configurable:!0});d.prototype.getAltitude=function(a){return n.altitudeAt(this.coordinateSystem,a)};d.prototype.setAltitude=function(a,
b){n.setAltitudeAt(this.coordinateSystem,b,a,b)};d.prototype.setAltitudeOfTransformation=function(a,b){n.setAltitudeOfTransformation(this.coordinateSystem,b,a,b)};d.prototype.worldUpAtPosition=function(a,b){return n.normalAt(this.coordinateSystem,a,b)};d.prototype.worldBasisAtPosition=function(a,b,c){return n.axisAt(this.coordinateSystem,a,b,c)};d.prototype.basisMatrixAtPosition=function(a,c){var e=this.worldBasisAtPosition(a,0,p.sv3d.get()),d=this.worldBasisAtPosition(a,1,p.sv3d.get());a=this.worldBasisAtPosition(a,
2,p.sv3d.get());b.mat4.set(c,e[0],e[1],e[2],0,d[0],d[1],d[2],0,a[0],a[1],a[2],0,0,0,0,1);return c};d.prototype.intersectManifoldClosestSilhouette=function(a,b,c){n.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);n.intersectRayClosestSilhouette(this.tmpCoordinateSystem,a,c);return c};d.prototype.intersectManifold=function(a,b,c){n.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);b=p.sv3d.get();return n.intersectRay(this.tmpCoordinateSystem,a,b)?(f.vec3.copy(c,b),!0):!1};d.prototype.intersectInfiniteManifold=
function(b,c,e){if("global"===this.type)return this.intersectManifold(b,c,e);n.elevate(this.coordinateSystem,c,this.tmpCoordinateSystem);c=this.tmpCoordinateSystem.value;var d=p.sv3d.get();return a.plane.intersectRay(c.plane,b,d)?(f.vec3.copy(e,d),!0):!1};d.prototype.toRenderCoords=function(a,b,c){return k.isPoint(a)?h.pointToVector(a,b,this.spatialReference):h.vectorToVector(a,b,c,this.spatialReference)};d.prototype.fromRenderCoords=function(a,b,c){return k.isPoint(b)?h.vectorToPoint(a,this.spatialReference,
b,c):b instanceof e?h.vectorToPoint(a,this.spatialReference,b):h.vectorToVector(a,this.spatialReference,b,c)};d.createGlobal=function(b){void 0===b&&(b=h.SphericalECEFSpatialReference);var e=n.fromValues(a.sphere,a.sphere.fromValues(c.earthRadius,[0,0,0]));return new d("global",b,1,e)};d.createLocal=function(b){var c=n.fromValues(a.boundedPlane,a.boundedPlane.fromValues([0,0,0],[u,0,0],[0,u,0])),e=l.getMetersPerUnitForSR(b);return new d("local",b,e,c)};d.createMode=function(a,b){switch(a){case "local":return d.createLocal(b);
case "global":return d.createGlobal();default:g.neverReached(a)}};return d}();d.RenderCoordsHelper=t;var u=Math.pow(2,50)})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./index ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(c){this.streamDataSupplier=this.textures=null;this.graphicsOwners=
[];this.screenSizePerspectiveHandles=null;var a=l.ClientType.SYMBOLOGY;this.viewState=c.viewState;this.stage=c.stage;this.pointsOfInterest=c.pointsOfInterest;this.resourceController=c.resourceController;this.streamDataSupplier=this.resourceController.getStreamDataSupplier(a);this.textures=new b.default(this.streamDataSupplier,c.stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});this.screenSizePerspectiveSettings=f.getSettings(c.viewingMode);this.screenSizePerspectiveSettingsLabels=f.getLabelSettings(c.viewingMode)}
d.prototype.destroy=function(){this.streamDataSupplier=null;this.textures.destroy();this.streamDataSupplier=this.textures=null};d.prototype.addGraphicsOwner=function(b){var a=this;if(!b)return{remove:function(){}};this.graphicsOwners.push(b);var c="layer"in b?b.watch("layer.screenSizePerspectiveEnabled",function(){return a.updateScreenSizePerspectiveEnabled()}):null;this.updateScreenSizePerspectiveEnabled();return{remove:function(){c&&(c.remove(),q.removeUnordered(a.graphicsOwners,b),a.updateScreenSizePerspectiveEnabled())}}};
d.prototype.updateScreenSizePerspectiveEnabled=function(){var b=this,a=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});a&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new g,a=function(){return b.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",a,!0),this.viewState.events.on("camera-projection-changed",a)]),this.updateScreenSizePerspectiveSettings()):
!a&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};d.prototype.updateScreenSizePerspectiveSettings=function(){e.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;e.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(e);this.screenSizePerspectiveSettingsLabels.update(e);this.stage.setNeedsRender()};return d}();d.SharedSymbolResources=t;var e={distance:0,fovY:0};d.default=t})},"esri/views/3d/support/TextureCollection":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/promiseUtils ../../../core/scheduling ../../../core/urlUtils ../webgl-engine/Stage ../webgl-engine/lib/Texture".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(b,a,e){this._streamDataSupplier=b;this._stage=a;this._textureOptions=e;this._textureRequests=new Map}d.prototype.destroy=function(){var b=this;this._textureRequests.forEach(function(a,c){return b.releaseNow(c)});this._textureRequests=null};d.prototype.fromUrl=function(b,a){var c=this,e=this.makeUid(b,a),d=this._textureRequests.get(e);if(d)return d.referenceCount++,d.textureAsync;var f=this._streamDataSupplier.request(b,
"image",e),d={referenceCount:1,texture:null,textureAsync:null};this._textureRequests.set(e,d);d.textureAsync=g.create(function(b,g){f.then(function(f){f=c.createTexture(f.url,f.data,a);d.texture=f;c.addToStage(f);b({uid:e,texture:f})},function(){return g()})},function(){f.cancel()});return d.textureAsync};d.prototype.fromData=function(b,a){b=this.makeUid(b);var c=this._textureRequests.get(b);c||(c={referenceCount:0,texture:a(),textureAsync:null},this.addToStage(c.texture),this._textureRequests.set(b,
c));c.referenceCount++;return{uid:b,texture:c.texture}};d.prototype.release=function(b){var a=this._textureRequests.get(b);a?(1>a.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+b),a.referenceCount--,1>a.referenceCount&&this.scheduleRelease(b)):console.warn("TextureCollection: texture doesn't exist: '"+b+"'")};d.prototype.scheduleRelease=function(b){var a=this;l.schedule(function(){return a.releaseNow(b)})};d.prototype.releaseNow=function(b){if(this._textureRequests){var a=
this._textureRequests.get(b);!a||0<a.referenceCount||(a.texture?this.removeFromStage(a.texture):a.textureAsync.cancel(),this._textureRequests.delete(b))}};d.prototype.createTexture=function(c,a,d){b.isSVG(c)&&(d||0===a.width&&0===a.height)&&(c=a.width?a.height/a.width:1,d=d||64,1<c?(a.width=Math.round(d/c),a.height=d):(a.width=d,a.height=Math.round(d*c)));d=q({},this._textureOptions,{width:a.width,height:a.height,powerOfTwoResizeMode:2});return new e(a,"symbol",d)};d.prototype.addToStage=function(b){this._stage.add(f.ModelContentType.TEXTURE,
b)};d.prototype.removeFromStage=function(b){this._stage.remove(f.ModelContentType.TEXTURE,b.id)};d.prototype.makeUid=function(b,a){return null!=a?b+"."+a+"px":b};return d}();d.TextureCollection=t;d.default=t})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper @dojo/framework/shim/Set ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../PropertiesPool ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x){Object.defineProperty(d,"__esModule",{value:!0});var A=Array;t=function(b){function d(e){e=b.call(this,e)||this;e.handles=new f;e.surfaceAltitudeAtCenter=0;e.surfaceAltitudeAtCenterDirty=!0;e.surfaceAltitudeAtCenterWithContent=0;e.surfaceAltitudeAtCenterWithContentDirty=!0;e.propertiesPool=new h.default({pointOfView:a,renderPointOfView:A},e);e.updateSurfaceAltitudeFrequentInterval=B;e.updateSurfaceAltitudeInfrequentInterval=E;e.renderPointOfView=
c.vec3f64.create();return e}q(d,b);d.prototype.initialize=function(){var a=this,b=this.view,c=b.state,e=b.basemapTerrain,d=b.renderCoordsHelper,b=b.map,f=this.view.resourceController.scheduler;this.surfaceIntersector=new m(c.mode);this.surfaceIntersector.enable.backfacesTerrain=c.isGlobal?!1:!0;this.surfaceIntersector.enable.invisibleTerrain=!1;this.contentIntersector=new m(c.mode);this.contentIntersectorOptions={exclude:new l.Set([x.TERRAIN_ID])};var g=this.estimateSurfaceAltitudeAtCenter.bind(this);
this._set("centerOnSurfaceInfrequent",new n.default({state:c,scheduler:f,surface:e,renderCoordsHelper:d,estimateSurfaceAltitudeAtCenter:g,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval}));this._set("centerOnSurfaceFrequent",new n.default({state:c,scheduler:f,surface:e,renderCoordsHelper:d,estimateSurfaceAltitudeAtCenter:g,altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("centerOnContent",new n.default({state:c,scheduler:f,surface:e,renderCoordsHelper:d,
estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this),altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("cameraOnSurface",new p.default({state:c,scheduler:f,surface:e,renderCoordsHelper:d,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval,map:b}));this._set("surfaceGeometryUpdates",new w.default({state:c,surface:e,renderCoordsHelper:d,centerOnSurfaceInstances:[this.centerOnSurfaceFrequent,this.centerOnContent,
this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new u.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:d}));this._set("surfaceOrigin",new y.default({view:this.view}));this._set("focus",new r.default({state:c,surface:e,renderCoordsHelper:d,centerOnSurface:this.centerOnSurfaceFrequent}));this.handles.add(c.watch("camera",function(b){return a.cameraChanged(b)},!0));this.handles.add(this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}));
this.handles.add(e.watch("extent",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(this.contentGeometryUpdates.events.on("request-update",function(){return a.updateCenterOnContent()}));this.cameraChanged(this.view.state.camera);this.forceUpdate()};d.prototype.destroy=function(){v.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(d.prototype,"pointOfView",
{get:function(){var a=this.propertiesPool.get("pointOfView");this.view.renderCoordsHelper.fromRenderCoords(this.renderPointOfView,a,this.view.state.spatialReference);return a},enumerable:!0,configurable:!0});d.prototype.forceUpdate=function(){this.surfaceGeometryUpdates.forceUpdate();this.centerOnSurfaceInfrequent.forceUpdate();this.centerOnSurfaceFrequent.forceUpdate();this.cameraOnSurface.forceUpdate();this.centerOnContent.forceUpdate();this.focus.forceUpdate()};d.prototype.hasPendingUpdates=function(){return this.surfaceGeometryUpdates.hasPendingUpdates()||
this.centerOnContent.hasPendingUpdates()||this.centerOnSurfaceInfrequent.hasPendingUpdates()||this.cameraOnSurface.hasPendingUpdates()||this.centerOnSurfaceFrequent.hasPendingUpdates()||this.focus.hasPendingUpdates()};d.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;this.view.sceneIntersectionHelper.intersectRay(this.view.state.camera.ray,
C,this.contentIntersectorOptions,this.contentIntersector)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(C):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};d.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var a=this.view.state.camera;
this.surfaceIntersector.intersect(null,a.eye,a.center,null,a,null,!1);this.view.basemapTerrain.intersect(this.surfaceIntersector,null,a.eye,a.center);this.surfaceIntersector.results.min.getIntersectionPoint(C)&&(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(C));return this.surfaceAltitudeAtCenter};d.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest(a);a=a.eye;this.renderPointOfView[0]===a[0]&&this.renderPointOfView[1]===a[1]&&this.renderPointOfView[2]===
a[2]||this._set("renderPointOfView",k.vec3.copy(this.propertiesPool.get("renderPointOfView"),a))};d.prototype.updateCenterPointsOfInterest=function(a){void 0===a&&(a=this.view.state.camera);this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.update(a);this.centerOnSurfaceInfrequent.update(a);this.cameraOnSurface.update(a);this.centerOnContent.update(a);this.focus.update(a)};d.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=
!0;this.centerOnContent.update(this.view.state.camera)};g([e.property({constructOnly:!0})],d.prototype,"updateSurfaceAltitudeFrequentInterval",void 0);g([e.property({constructOnly:!0})],d.prototype,"updateSurfaceAltitudeInfrequentInterval",void 0);g([e.property({readOnly:!0})],d.prototype,"centerOnContent",void 0);g([e.property({readOnly:!0})],d.prototype,"centerOnSurfaceFrequent",void 0);g([e.property({readOnly:!0})],d.prototype,"centerOnSurfaceInfrequent",void 0);g([e.property({readOnly:!0})],d.prototype,
"cameraOnSurface",void 0);g([e.property({readOnly:!0})],d.prototype,"focus",void 0);g([e.property({readOnly:!0})],d.prototype,"surfaceOrigin",void 0);g([e.property({readOnly:!0})],d.prototype,"contentGeometryUpdates",void 0);g([e.property({readOnly:!0,dependsOn:["renderPointOfView"]})],d.prototype,"pointOfView",null);g([e.property({readOnly:!0})],d.prototype,"renderPointOfView",void 0);g([e.property({readOnly:!0})],d.prototype,"surfaceGeometryUpdates",void 0);g([e.property({constructOnly:!0})],d.prototype,
"view",void 0);return d=g([e.subclass("esri.views.3d.support.PointsOfInterest")],d)}(e.declared(b));d.PointsOfInterest=t;var C=c.vec3f64.create(),B=200,E=3E3;d.default=t})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../PropertiesPool ./PointOfInterest".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){Object.defineProperty(d,"__esModule",{value:!0});var h=Array;t=function(a){function d(b){b=a.call(this,b)||this;b._dirtyTimeStamp=0;b.propertiesPool=new c.default({location:k,renderLocation:h},b);b.estimatedSurfaceAltitude=0;b.pendingElevationQuery=null;b.renderLocation=e.vec3f64.create();return b}q(d,a);d.prototype.initialize=function(){var a=this;null!=this.scheduler&&this.handles.add(this.scheduler.registerTask(1,function(){return a.measureSurfaceAltitude()},function(){return a.needsUpdate()}));
this.measureSurfaceAltitude();if(this.map){var b=function(){return a._setDirty()};this.handles.add([l.on(this.map,"ground.layers","change",b,b,b)])}};d.prototype.destroy=function(){this.cancelPendingRequest();this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(d.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});
d.prototype.update=function(a){this._setDirty();this.updateCameraOnSurface()};d.prototype.forceUpdate=function(){this.measureSurfaceAltitude();this.updateCameraOnSurface()};d.prototype.hasPendingUpdates=function(){return 0<this._dirtyTimeStamp};d.prototype._setDirty=function(){this._dirtyTimeStamp=this._dirtyTimeStamp||this.scheduler.now};d.prototype.needsUpdate=function(){return!this.pendingElevationQuery&&0<this._dirtyTimeStamp&&this.scheduler.now-this._dirtyTimeStamp>=this.altitudeEstimationInterval};
d.prototype.cancelPendingRequest=function(){var a=this.pendingElevationQuery;a&&(this.pendingElevationQuery=null,a.cancel())};d.prototype.measureSurfaceAltitude=function(){var a=this;this.cancelPendingRequest();this._dirtyTimeStamp=0;if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,n,this.state.spatialReference);var b=this.map.ground.queryElevation(n).then(function(b){return a.updateSurfaceAltitude(b.geometry.z)}).catch(function(b){b&&"cancel"===b.dojoType||
a.updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a.pendingElevationQuery===b&&(a.pendingElevationQuery=null)});b.isFulfilled()||(this.pendingElevationQuery=b)}else this.updateSurfaceAltitude(0)};d.prototype.updateSurfaceAltitude=function(a){this.estimatedSurfaceAltitude!==a&&(this.estimatedSurfaceAltitude=a,this.updateCameraOnSurface())};d.prototype.updateCameraOnSurface=function(){f.vec3.copy(p,this.state.camera.eye);this.renderCoordsHelper.setAltitude(this.estimatedSurfaceAltitude,
p);var a=this._get("renderLocation");f.vec3.equals(a,p)||this._set("renderLocation",f.vec3.copy(this.propertiesPool.get("renderLocation"),p))};g([b.property({constructOnly:!0})],d.prototype,"scheduler",void 0);g([b.property({constructOnly:!0})],d.prototype,"altitudeEstimationInterval",void 0);g([b.property({readOnly:!0,dependsOn:["renderLocation"]})],d.prototype,"location",null);g([b.property({constructOnly:!0})],d.prototype,"map",void 0);g([b.property({readOnly:!0})],d.prototype,"renderLocation",
void 0);return d=g([b.subclass("esri.views.3d.support.CameraOnSurface")],d)}(b.declared(a.PointOfInterest));d.CameraOnSurface=t;var p=e.vec3f64.create(),n=new k;d.default=t})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),function(t,d,q,g,l,
b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function c(a){a=d.call(this)||this;a.handles=new b;return a}q(c,d);c.prototype.destroy=function(){e.default(this,"handles")};g([f.property({constructOnly:!0})],c.prototype,"renderCoordsHelper",void 0);g([f.property({constructOnly:!0})],c.prototype,"surface",void 0);g([f.property({constructOnly:!0})],c.prototype,"state",void 0);return c=g([f.subclass("esri.views.3d.support.PointOfInterest")],c)}(f.declared(l));d.PointOfInterest=
t;d.default=t})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(t,d,q){function g(d){for(var b=[],f=1;f<arguments.length;f++)b[f-1]=arguments[f];if(d instanceof q&&d.destroyed)try{throw Error("instance is already destroyed");}catch(c){console.warn(c.stack)}else for(f=0;f<b.length;f++){var e=b[f];if(!(e in d))throw Error("Property '"+e+"' does not exist and cannot be disposed");var g=d[e];g&&("function"===typeof g.destroy?
g.destroy():"function"===typeof g.dispose?g.dispose():"function"===typeof g.remove&&g.remove());d instanceof q&&e in d.__accessor__.metadatas?d._set(e,null):d[e]=null}}Object.defineProperty(d,"__esModule",{value:!0});d.disposeMembers=g;d.default=g})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../debugFlags ../earthUtils ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){Object.defineProperty(d,"__esModule",{value:!0});var n=Array;t=function(d){function p(a){a=d.call(this,a)||this;a.propertiesPool=new h.default({location:e,renderLocation:n},a);a._dirtyTimeStamp=0;a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=f.vec3f64.create();return a}q(p,d);r=p;p.prototype.initialize=function(){var a=this;this._frameWorker=this.scheduler.registerTask(1,function(){return a.measureSurfaceAltitude()},function(){return a.needsUpdate()});
this.measureSurfaceAltitude()};p.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(p.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});p.prototype.update=function(a){this._setDirty();this.updateCenterOnSurface()};
p.prototype.forceUpdate=function(){this.measureSurfaceAltitude();this.updateCenterOnSurface()};p.prototype.hasPendingUpdates=function(){return 0<this._dirtyTimeStamp};Object.defineProperty(p.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});p.prototype._setDirty=function(){this._dirtyTimeStamp=this._dirtyTimeStamp||this.scheduler.now};p.prototype.needsUpdate=function(){return 0<this._dirtyTimeStamp&&this.scheduler.now-this._dirtyTimeStamp>=
this.altitudeEstimationInterval};p.prototype.measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this.updateCenterOnSurface();this._dirtyTimeStamp=0};p.prototype.updateCenterOnSurface=function(){var a=u,c=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,a),e=this.currentSurfaceAltitude!==this.latestSurfaceAltitude;!c&&e&&(c=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);
e=v;c&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,e)&&(b.vec3.copy(a,e),this.currentSurfaceAltitude=this.latestSurfaceAltitude);c?(c=b.vec3.distance(this.state.camera.eye,a),c!==this._get("distance")&&this._set("distance",c)):(c=this.state.camera,b.vec3.scale(a,c.viewForward,this._get("distance")),b.vec3.add(a,a,c.eye));c=this._get("renderLocation");c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]||this._set("renderLocation",b.vec3.copy(this.propertiesPool.get("renderLocation"),a))};p.prototype.calculateSurfaceIntersection=
function(e,d){var f=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(f.ray,e,d))return!1;if(this.state.isGlobal){e=c.earthRadius+e;var g=b.vec3.squaredLength(f.eye),h=g<e*e,k=b.vec3.distance(f.eye,d);h&&k>c.earthRadius/4&&(b.vec3.scale(d,f.viewForward,e-Math.sqrt(g)),b.vec3.add(d,d,f.eye))}else if(f=this.surface.ready&&this.surface.extent)d[0]=a.clamp(d[0],f[0],f[2]),d[1]=a.clamp(d[1],f[1],f[3]);return!0};p.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,c){if(this.latestSurfaceAltitude===
this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,c)){var e=this.state.camera.eye;a=b.vec3.distance(e,a);c=b.vec3.distance(e,c);if(k.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS||Math.abs(c-a)/a>r.RELATIVE_ALTITUDE_CHANGE_THRESHOLD)return!0}return!1};var r;p.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;g([l.property({constructOnly:!0})],p.prototype,"scheduler",void 0);g([l.property({constructOnly:!0})],p.prototype,"altitudeEstimationInterval",void 0);
g([l.property({readOnly:!0})],p.prototype,"distance",void 0);g([l.property({constructOnly:!0})],p.prototype,"estimateSurfaceAltitudeAtCenter",void 0);g([l.property({readOnly:!0,dependsOn:["renderLocation"]})],p.prototype,"location",null);g([l.property({readOnly:!0})],p.prototype,"renderLocation",void 0);return p=r=g([l.subclass("esri.views.3d.support.CenterOnSurface")],p)}(l.declared(p.PointOfInterest));d.CenterOnSurface=t;var u=f.vec3f64.create(),v=f.vec3f64.create();d.default=t})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require",
"exports","../../../../core/Handles","../Evented"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function b(b){this.handles=new q;this.events=new g.Evented;this.contentLayerViews=b.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",this.layerViewsChanged.bind(this)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),
this.handles=null)};b.prototype.layerViewsChanged=function(b){var e=this;b.added.forEach(function(b){"esri.views.3d.layers.SceneLayerView3D"===b.declaredClass&&e.handles.add(b.on("visible-geometry-changed",e.contentChanged.bind(e)),b.uid)});b.removed.forEach(function(b){return e.handles.remove(b.uid)})};b.prototype.contentChanged=function(){this.events.emit("request-update",l)};return b}();d.ContentGeometryUpdates=t;var l={};d.default=t})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../geometryUtils ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){Object.defineProperty(d,"__esModule",{value:!0});var n=Array;t=function(e){function d(a){a=e.call(this,a)||this;a.propertiesPool=new h.default({locationOnSurface:k,renderLocationOnSurface:n},a);a.centerOnSurface=null;return a}q(d,e);d.prototype.destroy=function(){this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(d.prototype,"locationOnSurface",{get:function(){var a=this.propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,
a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderLocationOnSurface",{get:function(){var b=this.centerOnSurface.renderLocation,c=this.renderCoordsHelper,e=this.calculateScreenHorizontalEdgeOnSurface(y);f.vec3.subtract(u,b,this.state.camera.eye);f.vec3.normalize(u,u);c.worldUpAtPosition(b,v);var d=Math.abs(Math.acos(f.vec3.dot(v,u))-.5*Math.PI),c=this.propertiesPool.get("renderLocationOnSurface"),d=1-a.clamp(d/(.5*Math.PI),0,1);f.vec3.lerp(c,
b,e,d*d*d);return c},enumerable:!0,configurable:!0});d.prototype.update=function(a){};d.prototype.forceUpdate=function(){};d.prototype.hasPendingUpdates=function(){return this.centerOnSurface.hasPendingUpdates()};d.prototype.calculateScreenHorizontalEdgeOnSurface=function(a){var b=this.state.camera,e=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),d=this.renderCoordsHelper.getAltitude(b.eye)>=e,g=b.getRenderCenter(l.createRenderScreenPointArray3());g[1]=d?b.padding[2]:b.fullHeight-
b.padding[0];b.unprojectPoint(g,r);f.vec3.subtract(r,r,b.eye);d=f.vec3.normalize(r,r);if(this.renderCoordsHelper.intersectManifold(c.ray.wrap(b.eye,d),e,a))return a;f.vec3.copy(a,b.eye);this.renderCoordsHelper.setAltitude(e,a);return a};g([b.property({constructOnly:!0})],d.prototype,"centerOnSurface",void 0);g([b.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],d.prototype,"locationOnSurface",null);g([b.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],d.prototype,
"renderLocationOnSurface",null);return d=g([b.subclass("esri.views.3d.support.CenterOnSurface")],d)}(b.declared(p.PointOfInterest));d.Focus=t;var u=e.vec3f64.create(),v=e.vec3f64.create(),r=e.vec3f64.create(),y=e.vec3f64.create();d.default=t})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function h(a){a=d.call(this,a)||this;a.location=null;a._updatePromise=null;a._handles=new b;return a}q(h,d);Object.defineProperty(h.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=k.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference",
"surfaceView.extent"],function(){return a._update()}),f.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};h.prototype.destroy=function(){this._handles.destroy()};h.prototype._update=function(){var b=this;this._updatePromise&&(this._updatePromise.cancel("cancel"),this._updatePromise=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var e=a.center(this.surfaceView.extent),e=new c({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});
this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updatePromise=this.surface.queryElevation(e,{noDataValue:0}).then(function(a){b._updatePromise=null;b._set("location",a.geometry)}).catch(function(a){"cancel"===a||a&&("cancel"===a.dojoType||"AbortError"===a.name||"elevation-query:invalid-layer"===a.name)||console.error("StableSurfaceCenter failed to update: ",a)})):this._set("location",e)}else this._set("location",null)};g([e.property({constructOnly:!0})],h.prototype,"view",
void 0);g([e.property({readOnly:!0,aliasOf:"view.map.ground"})],h.prototype,"surface",void 0);g([e.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],h.prototype,"surfaceView",void 0);g([e.property({readOnly:!0})],h.prototype,"location",void 0);g([e.property({readOnly:!0,dependsOn:["location"]})],h.prototype,"renderLocation",null);return h=g([e.subclass("esri.views.3d.terrain.StableSurfaceCenter")],h)}(e.declared(l));d.StableSurfaceCenter=t;d.default=t})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/Handles ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../debugFlags ../Evented".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(a){var c=this;this.handles=new q;this.tileGeometryUpdateExtent=b.empty();this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new e.Evented;this.centerOnSurfaceInstances=a.centerOnSurfaceInstances;this.renderCoordsHelper=a.renderCoordsHelper;this.state=a.state;this.handles.add(a.surface.on("elevation-change",function(a){return c.tileGeometryChangeHandler(a)}))}
d.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};d.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",k),this.hasPendingTileGeometryChanges=!1)};d.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")};d.prototype.tileGeometryChangeHandler=function(a){var c=this;this.tileGeometryUpdateSpatialReference=
a.spatialReference;b.expand(this.tileGeometryUpdateExtent,a.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(g.schedule(function(){return c.updateCenterOnGeometryUpdate()}),"tile-geometry-update")};d.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&(f.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.hasPendingTileGeometryChanges=
!0:this.events.emit("request-update",k));b.empty(this.tileGeometryUpdateExtent)};d.prototype.furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaceInstances[0],b=1;b<this.centerOnSurfaceInstances.length;b++){var c=this.centerOnSurfaceInstances[b];c.distance>a.distance&&(a=c)}return a};d.prototype.centerIntersectsExtent=function(e,d){var f=this.state.camera.eye,g=h,k=this.furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(f,c,d);this.renderCoordsHelper.fromRenderCoords(k.renderLocation,
a,d);c[0]<a[0]?(g[0]=c[0],g[2]=a[0]):(g[0]=a[0],g[2]=c[0]);c[1]<a[1]?(g[1]=c[1],g[3]=a[1]):(g[1]=a[1],g[3]=c[1]);return b.intersects(g,e)};return d}();d.SurfaceGeometryUpdates=t;var k={},c=l.vec3f64.create(),a=l.vec3f64.create(),h=b.empty();d.default=t})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Handles ../../../core/Logger ../../../core/ObjectPool ../../../core/PooledArray ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../../layers/support/LercWorker ../support/Evented ../support/geometryUtils ../support/index ../support/mathUtils ../support/projectionUtils ../support/PromiseLightweight ./ElevationData ./ElevationTileAgent ./MapTileAgent ./OverlayManager ./PlanarTile ./SphericalTile ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./TileGeometryFactory ./TilemapOnlyTile ./tileUtils ./tileUtils ./UpsampleInfo ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture ../../webgl/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M,Q,P,O,U,N,V,X,J,R,T,W,Z,fa,ga,ja){function ia(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function ka(a){return a&&("cancel"===a||"cancel"===a.dojoType||"AbortError"===a.name)}function da(a,b){var c=!1;b=b||a;var e=0;for(a=a.children;e<a.length;e++){var d=a[e];if(d){for(var f in d.layerInfo)for(var g in d.layerInfo[f]){var h=d.layerInfo[f][g].upsampleFromTile;if(h&&h.tile===b)return!0}c=c||da(d,b)}}return c}var Y=c.getLogger("esri.views.3d.terrain.TerrainSurface");
t=function(b){function c(c,e){e=b.call(this)||this;e.defaultTileBackground=N.DEFAULT_TILE_BACKGROUND;e.hideSkirtsDistanceFromExtentMargin=ha;e.hideSkirtsMinimumCameraTilt=ea;e.hideSkirtsMaximumCameraTilt=ma;e._clippingExtent=null;e._dataExtent=null;e._elevationBounds=[0,0];e._rootExtent=m.create();e._iteratorPool=new a(W.IteratorPreorder);e._postorderIterator=new W.IteratorPostorder;e.visible=!1;e.suspended=!1;e._pendingUpdates=!1;e._lvPendingUpdates=!1;e._updateNextFrame=0;e._vectorTileLayerRequests=
0;e._memoryUsed=0;e._overlayOpacity=1;e._eyePosRenderSR=y.vec3f64.create();e._eyePosSurfaceSR=y.vec3f64.create();e._splitLimits=[0,0,0,0,0,0];e._frustum=C.frustum.create();e._viewProjectionMatrix=v.mat4f64.create();e.tilemapStats={tilemapRequestsSent:0,tilemapRequestsPending:0,tilemapRequestErrors:0,fullTilemaps:0,emptyTilemaps:0,tilesRequested:0,tileRequestsSent:0,tileRequestErrors:0,tilesNotPresent:0};e._layerViews=[[],[]];e._layerIndexByLayerViewId=[{},{}];e._basemapLayerViewHandles={};e._handles=
new k;e._lowPrioUpdates=new h;e._topLevelTilemapOnlyTiles=Array(N.TILEMAP_SIZE_EXP+1);e._upsampleInfoPool=new a(Z);e._getElevationData={spatialReference:null,rootTiles:null};e.loaded=!1;e.maxTextureScaleRaster=1.2;e.maxTextureScaleVector=1.8;e.rootTiles=null;e.backgroundImage=N.DEFAULT_TILE_BACKGROUND;e.backgroundColor=null;e._lercWorker=x.acquireInstance(c.resourceController.scheduler);for(c=0;c<e._topLevelTilemapOnlyTiles.length;c++)e._topLevelTilemapOnlyTiles[c]=new R([c-N.TILEMAP_SIZE_EXP,0,0],
e._upsampleInfoPool);return e}q(c,b);c.prototype.normalizeCtorArgs=function(a,b){this._view=a;this._stage=a._stage;this._set("manifold",b);return{}};c.prototype.initialize=function(){var b=this;this._tilePool="planar"===this.manifold?new a(Q):new a(P);this._memCache=this._view.resourceController.memoryController.getMemCache("esri.views.3d.terrain",function(a){return b._renderer.releaseTileGeometry(a.renderData)});this._renderer=new V(this.manifold,this._memCache);this._renderer.loaded=this._setLoaded.bind(this);
this._renderer.install(this._view._stage);p.init(this,"_background",function(){b._renderer.updateTileBackground(b._background)});this._handles.add(this._view.watch("pointsOfInterest",function(a){b._renderer.pointsOfInterest=a}));this._set("overlayManager",new M({terrainSurface:this,view:this._view}));this._handles.add(this.watch("overlayManager.hasHighlights",this._handleHasHighlights.bind(this)),"overlayManager");var c={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};
this.extentHelper="spherical"===this.manifold?new O.SurfaceExtentHelperGlobal(c):new O.SurfaceExtentHelperLocal(c);this._handles.add(p.init(this.extentHelper,"stencilEnabledExtents",function(a){b._renderer.setStencilEnabledLayerExtents(a)}),"extentHelper");c=this._view.defaultsFromMap?new e({root:this._view.map,rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;c=new U({layers:c,extentHelper:this.extentHelper,
manifold:this.manifold,viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",c);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",this._updateTilingSchemeAndExtent.bind(this),!0),this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._streamDataSupplier=this._view.resourceController.getStreamDataSupplier(B.ClientType.TERRAIN);this._handles.add(this._view.resourceController.scheduler.registerTask(1,
function(a){return b._frame(a)},function(){return b.ready}));this._viewChangeUpdate=this._viewChangeUpdate.bind(this);this._view.resourceController.memoryController.events.on("quality-changed",function(){return b._viewChangeUpdate()});this._handles.add([this._view.on("resize",this._viewChangeUpdate),this._view.watch("state.camera",this._viewChangeUpdate,!0),this._view.watch("qualitySettings.tiledSurface.lodBias",this._viewChangeUpdate),this._view.watch("clippingArea",this._clippingChanged.bind(this))],
"view");this._handles.add(this._view.allLayerViews.on("change",this._handleLayerViewChanges.bind(this)),"allLayerViews");this._handleLayerViewChanges({added:this._view.allLayerViews.toArray(),removed:[],moved:[],target:this._view.allLayerViews});this._updateClippingExtent();this.notifyChange("extent")};c.prototype.destroy=function(){this._handles.destroy();x.releaseInstance(this._lercWorker);this._lercWorker=null;this._removeAllTiles();this._memCache.destroy();this._memCache=null;this.tilingSchemeLogic.destroy();
this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;for(var a in this._basemapLayerViewHandles)this._unregisterTiledLayerView(a);this._streamDataSupplier=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._tilePool.destroy();this._tilePool=null;F.Pool.prune(0);K.Pool.prune(0);this._renderer.destroy(this._stage);this._renderer=null;this._iteratorPool.destroy();this._streamDataSupplier=this._stage=this._view=this._iteratorPool=
null;this._upsampleInfoPool.destroy();this._upsampleInfoPool=null};Object.defineProperty(c.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"frustum",{get:function(){return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"upsampleInfoPool",{get:function(){return this._upsampleInfoPool},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"cullBackFaces",{set:function(a){this._renderer.cullBackFaces=
a;this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"baseOpacity",{set:function(a){this._renderer.opaque=1<=a;this._set("baseOpacity",a);this._updateTileTextures(!0)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"maxTextureScale",{get:function(){for(var a=!1,b=!1,c=0,e=this._layerViews[N.LayerClass.MAP];c<
e.length;c++){var d=e[c].layer;d.visible&&0!==d.opacity&&("vector-tile"===d.type?a=!0:b=!0)}return a&&!b?this.maxTextureScaleVector:this.maxTextureScaleRaster},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"skirtScale",
{set:function(a){this._renderer.skirtScale=a;this._set("skirtScale",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"spatialReference",{get:function(){var a=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_background",{get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"slicePlaneEnabled",{set:function(a){this._renderer.slicePlaneEnabled=a;this._set("slicePlaneEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOverground=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);this._set("wireframe",a)},enumerable:!0,configurable:!0});c.prototype.setVisibility=
function(a){a!==this.visible&&(this.visible=a,this._renderer.setVisibility(a),this.setUpdatesDisabled(!a),a&&this._viewChangeUpdate())};c.prototype.isVisible=function(){return this.visible&&this.ready};c.prototype.isOpaque=function(){return this._renderer.isOpaque()};c.prototype.setUpdatesDisabled=function(a){(this.suspended=a)||this._viewChangeUpdate()};c.prototype.intersect=function(a,b,c,e){this._renderer.intersect(a,b,c,e,null)};c.prototype.getElevation=function(a){var b=this._getElevationData.rootTiles;
if(!b||!b.length||0===b[0].layerInfo[N.LayerClass.ELEVATION].length)return null;var c=qa;if(Array.isArray(a))c=a;else if("point"===a.type&&!I.pointToVector(a,c,this._getElevationData.spatialReference))return Y.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(var e=0;e<b.length;e++)if(a=b[e],T.isPosWithinTile(a,c)){for(;a&&!a.renderData;)b=0,c[0]>.5*(a.extent[0]+a.extent[2])&&(b+=1),c[1]<.5*(a.extent[1]+a.extent[3])&&(b+=2),a=a.children[b];
if(b=(b=a.renderData)&&b.geometryState?b.geometryState.samplerData:null)return J.elevationSampler(c[0],c[1],b);break}return null};c.prototype.getElevationBounds=function(){return this._elevationBounds};c.prototype.getScale=function(a){if(this.tilingScheme){if(!I.pointToVector(a,qa,this.spatialReference))return Y.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;if(this.rootTiles)for(var b=0;b<this.rootTiles.length;b++)if(a=this.rootTiles[b],
T.isPosWithinTile(a,qa)){for(;a.children[0];)b=0,qa[0]>a.children[0].extent[2]&&(b+=1),qa[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.lij[0])}}return 1E100};c.prototype.queryVisibleScaleRange=function(a,b,c,e){b=b?this.tilingScheme.levelAtScale(b):0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var d=this._getLodBias();this._renderer.queryVisibleLevelRange(a,b+d,c+d,e)};c.prototype._setLoaded=function(){this.loaded||this._set("loaded",!0)};c.prototype._updateTilingSchemeAndExtent=
function(){var a=this.tilingSchemeLogic.extent,b=a&&!m.equals(a,this._dataExtent);b&&(this._dataExtent?m.set(this._dataExtent,a):this._dataExtent=m.create(a));var a=this.tilingSchemeLogic.tilingScheme,c=a!==this.tilingScheme;c&&(X.weakAssert(!!a,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",a),this._updateClippingExtent(),a&&(this._updateTiledLayers(),this._renderer.setTileSize(a.pixelSize[0]),this.overlayManager.setSpatialReference(a.spatialReference,
"spherical"===this.manifold)));(b||c)&&this._updateRootTiles()};c.prototype._acquireTile=function(a,b,c,e){var d=this._tilePool.acquire();sa[0]=a;sa[1]=b;sa[2]=c;d.init(sa,e,this);return d};c.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,c=this.tilingScheme;if(b&&c){var e=na,d=c.rootTilesInExtent(b,e,Infinity),g=function(b){b=a._acquireTile(0,b[1],b[2],null);b.shouldSplit(a._splitLimits,a._eyePosRenderSR)===N.TileUpdate.SPLIT&&b.setPendingUpdate(N.TileUpdate.SPLIT);
a._loadTile(b);return b};if(this.rootTiles){if(d.length>N.MAX_ROOT_TILES){Y.warn(N.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),h=f.difference(b,d,ia);if(0<h.removed.length||0<h.added.length){var k=this.rootTiles.filter(function(b){return-1<f.findIndex(h.removed,ia.bind(null,b.lij))?(a._purgeTile(b),!1):!0});h.added.forEach(function(a){return k.push(g(a))});this._setRootTiles(k)}}else d.length>N.MAX_ROOT_TILES&&(Y.warn(N.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),
d=c.rootTilesInExtent(b,e,N.MAX_ROOT_TILES)),this._setRootTiles(d.map(function(a){return g(a)}));f.equals(e,this._rootExtent)||(this._rootExtent=m.create(e),this._hasFixedExtent()||this.notifyChange("extent"));this.setVisibility(!0);this._viewChangeUpdate();this.overlayManager.setOverlayPlacementDirty();this.notifyChange("ready")}};c.prototype._setRootTiles=function(a){this._set("rootTiles",a);this._getElevationData.rootTiles=a;this._renderer.setRootTiles(this.rootTiles)};c.prototype._viewChangeUpdate=
function(){this._stage&&!this.suspended&&this.tilingScheme&&this.visible&&(this._updateViewDependentParameters(),this._updateSkirts(),this._updateOverlayOpacity(this._eyePosSurfaceSR[2]),this._updateTiles())};c.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.resetPendingUpdate(N.TileUpdate.GEOMETRY)&&this._updateTileGeometry(a)};c.prototype._updateTiles=function(a){void 0===a&&(a=this.rootTiles);if(a){var b=this._iteratorPool.acquire();b.reset(a);var c=
this._splitLimits,e;T.hasVisibleSiblings(a)?(a=this._elevationBounds[0],e=this._elevationBounds[1]):(a=Infinity,e=-Infinity);for(;!b.done;){var d=b.next();this._updateClippingStatus(d);d.updateVisibility();if(d.visible){d.updateScreenDepth(this._viewProjectionMatrix);d.renderData&&(a=Math.min(d.elevationBounds[0],a),e=Math.max(d.elevationBounds[1],e));var f=d.shouldSplit(c,this._eyePosRenderSR);if(f===N.TileUpdate.SPLIT){d.resetPendingUpdate(N.TileUpdate.MERGE);d.isLeaf&&(d.setPendingUpdate(N.TileUpdate.SPLIT),
b.skipSubtree());this._pendingUpdates=this._pendingUpdates||d.hasPendingUpdates;continue}d.resetPendingUpdate(N.TileUpdate.SPLIT)&&d.updateAgentSuspension();f===N.TileUpdate.VSPLITMERGE&&d.updateAgents(N.LayerClass.ELEVATION)}b.skipSubtree();if(!d.renderData){d.setPendingUpdate(N.TileUpdate.MERGE);d.resetPendingUpdate(N.TileUpdate.SPLIT);f=this._iteratorPool.acquire();for(f.resetOne(d);!f.done;){var g=f.next();this._updateClippingStatus(g);g.updateVisibility();g.visible&&g.updateScreenDepth(this._viewProjectionMatrix)}this._iteratorPool.release(f)}this._pendingUpdates=
this._pendingUpdates||d.hasPendingUpdates}this._iteratorPool.release(b);isFinite(a)&&isFinite(e)&&(this._elevationBounds[0]!==a||this._elevationBounds[1]!==e)&&(this._elevationBounds[0]=a,this._elevationBounds[1]=e,this.emit("elevation-bounds-change",null))}};c.prototype._updateViewDependentParameters=function(){var a=this._view.state.camera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*a.fovY),e=this.tilingScheme.pixelSize,d=Math.pow(2,-this._getLodBias())*a.pixelRatio;this._splitLimits[0]=b;this._splitLimits[1]=
e[0]/a.width*this.maxTextureScale*d;this._splitLimits[2]=c;this._splitLimits[3]=e[1]/a.height*this.maxTextureScale*d;this._splitLimits[4]=this.tilingScheme.getMaxLod();this._splitLimits[5]=this._view.qualitySettings.tiledSurface.angledSplitBias;C.frustum.copy(a.frustum,this._frustum);u.mat4.multiply(this._viewProjectionMatrix,a.projectionMatrix,a.viewMatrix);r.vec3.copy(this._eyePosRenderSR,a.eye);I.vectorToVector(this._eyePosRenderSR,this._view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};
c.prototype._updateSkirts=function(){X.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this._view.state.camera.near)};c.prototype._setLayerViewsUpdating=function(){for(var a=0;a<N.LayerClass.COUNT;a++)for(var b=this._layerViews[a],c=0;c<b.length;c++)b[c].updatingChanged(this._pendingUpdates)};c.prototype._updateTileGeometry=function(a){a.updateVisibility();this._renderer.updateTileGeometry(a);this._elevationUpdate(a);this._memoryUsed=0};c.prototype._elevationUpdate=function(a){z.spatialReference=
this.spatialReference;z.tile=a;z.extent=a.extent;this.emit("elevation-change",z);m.containsPoint(a.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};c.prototype._frame=function(a){var b=this;this._frameTraversal(a);a.run(function(){T.sortTiles(b._renderer.renderOrder,b._lowPrioUpdates);return!1});this._processElevation(a)&&this._processTextures(a)&&!this._streamDataSupplier.hasPendingDownloads()&&0===this._vectorTileLayerRequests||(this._pendingUpdates=!0);!a.done&&this.isVisible()&&this.overlayManager&&
this.overlayManager.overlaysNeedUpdate()&&(this.overlayManager.updateOverlays(),this._updateOverlayOpacity(this._eyePosSurfaceSR[2]));this._lowPrioUpdates.clear();this._pendingUpdates===this._lvPendingUpdates||!this._pendingUpdates&&20!==++this._updateNextFrame||(this._setLayerViewsUpdating(),this._lvPendingUpdates=this._pendingUpdates,this._updateNextFrame=0)};c.prototype._frameTraversal=function(a){if(!this.suspended&&this._pendingUpdates){this._lowPrioUpdates.clear();this._pendingUpdates=!1;var b=
this._renderer.resourceCounter,c=b.numTileTexturesComposited,e=this._iteratorPool.acquire();e.reset(this.rootTiles);for(var d=0,f=[];!e.done&&!a.done&&b.numTileTexturesComposited-c<aa;){var g=e.next(),d=d+g.memoryUsed;g.resetPendingUpdate(N.TileUpdate.MERGE)?(this._mergeTile(g),a.madeProgress(),e.skipSubtree()):g.resetPendingUpdate(N.TileUpdate.SPLIT)?(this._splitTile(g)&&(this._pendingUpdates=!0,f.push(g)),a.madeProgress(),e.skipSubtree()):g.hasPendingUpdates&&this._lowPrioUpdates.push(g);this._pendingUpdates=
this._pendingUpdates||g.hasPendingUpdates;e.done&&(e.reset(f),f.length=0)}e.done?this._memoryUsed=d:this._pendingUpdates=!0;this._iteratorPool.release(e)}};c.prototype._processElevation=function(a){for(var b=this,c=function(c){var d=e._lowPrioUpdates.data[c];if(!a.run(function(){if(d.resetPendingUpdate(N.TileUpdate.GEOMETRY))return b._updateTileGeometry(d),!0}))return{value:!1}},e=this,d=0;d<this._lowPrioUpdates.length;++d){var f=c(d);if("object"===typeof f)return f.value}return!0};c.prototype._processTextures=
function(a){for(var b=this,c=function(c){var d=e._lowPrioUpdates.data[c];if(!a.run(function(){return d.resetPendingUpdate(N.TileUpdate.TEXTURE)?(b._renderer.updateTileTexture(d),b._memoryUsed=0,!0):!1}))return{value:!1}},e=this,d=0;d<this._lowPrioUpdates.length;++d){var f=c(d);if("object"===typeof f)return f.value}return!0};c.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=m.create(),b=null;I.extentToBoundingRect(this._view.clippingArea,a,this.spatialReference)&&
(b=a);if(f.equals(b,this._clippingExtent))return!1;this._memCache.clear();this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");this._updateTileOverlayParams();this.overlayManager.setOverlayPlacementDirty();return!0};c.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};c.prototype._getLodBias=function(){return this._view.qualitySettings.tiledSurface.lodBias-(1-this._view.resourceController.memoryController.memoryFactor)*N.MAX_MEMORY_LOD_BIAS};
c.prototype._getLodBiasCorrectedScale=function(a){var b=this.tilingScheme.levels;a=E.clamp(a-this._getLodBias(),0,b.length-1);var c=a-Math.floor(a);return b[Math.floor(a)].scale*(1-c)+b[Math.ceil(a)].scale*c};c.prototype._cancelTilemapRequests=function(a){for(var b=0;b<N.LayerClass.COUNT;b++){var c=a.layerInfo[b];if(c)for(var e=0;e<c.length;e++){var d=c[e];d.tilemapRequest&&(d.tilemapRequest.cancel(),d.tilemapRequest=null)}}};c.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){return a._purgeTile(b)}),
this._setRootTiles(null),this.notifyChange("ready"));for(var b=0;b<this._topLevelTilemapOnlyTiles.length;b++)this._cancelTilemapRequests(this._topLevelTilemapOnlyTiles[b]);this.setVisibility(!1)};c.prototype._purgeChildTiles=function(a){for(var b in a.children){var c=a.children[b];null!=c&&(a.children[b]=null,this._purgeTile(c))}};c.prototype._purgeTile=function(a){this._purgeChildTiles(a);a.unload(this._renderer);this._cancelTilemapRequests(a);a.dispose();this._tilePool.release(a)};c.prototype._splitTile=
function(a){var b=a.lij[0]+1,c=2*a.lij[1],e=2*a.lij[2];a.children[0]=this._createTile(b,c,e,a);a.children[1]=this._createTile(b,c,e+1,a);a.children[2]=this._createTile(b,c+1,e,a);a.children[3]=this._createTile(b,c+1,e+1,a);a.unload(this._renderer);la.spatialReference=this.spatialReference;la.extent=a.extent;la.scale=this._getLodBiasCorrectedScale(b);this.emit("scale-change",la);return a.children[0].hasPendingUpdate(N.TileUpdate.SPLIT)||a.children[1].hasPendingUpdate(N.TileUpdate.SPLIT)||a.children[2].hasPendingUpdate(N.TileUpdate.SPLIT)||
a.children[3].hasPendingUpdate(N.TileUpdate.SPLIT)};c.prototype._createTile=function(a,b,c,e){X.weakAssert(!!e,"_createTile sanity check");a=this._acquireTile(a,b,c,e);a.updateClippingStatus(this._clippingExtent);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),a.shouldSplit(this._splitLimits,this._eyePosRenderSR)===N.TileUpdate.SPLIT&&a.setPendingUpdate(N.TileUpdate.SPLIT));this._loadTile(a);return a};c.prototype._mergeTile=function(a){X.weakAssert(!a.renderData,"_mergeTile sanity check");
X.weakAssert(!a.hasPendingUpdate(N.TileUpdate.SPLIT),"_mergeTile sanity check");this._loadTile(a);this._purgeChildTiles(a);la.spatialReference=this.spatialReference;la.extent=a.extent;la.scale=this._getLodBiasCorrectedScale(a.lij[0]);this.emit("scale-change",la)};c.prototype._loadTile=function(a){a.load(this._renderer);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,a.renderData,this._overlayOpacity);this._elevationUpdate(a)};c.prototype._handleHasHighlights=
function(a){this._renderer.setNeedsHighlight(a)};c.prototype._elevationDataUpdated=function(a,b){var c=a.layerInfo[N.LayerClass.ELEVATION][b],e=[a],d=a.lij[0],f=this._iteratorPool.acquire();for(f.reset(e);!f.done;){var g=f.next();g.findElevationBoundsForLayer(b,d);g.computeElevationBounds()}this._iteratorPool.release(f);a.dataArrived(b,N.LayerClass.ELEVATION,c.data);this._updateTiles(e)};c.prototype._handleLayerViewChanges=function(a){var b=this,c=!1;a.added.forEach(function(a){var e=a.layer;X.isTiledLayerView(a)?
(b._registerTiledLayer(a),e.loaded&&(c=!0)):a.supportsDraping&&b.overlayManager&&b.overlayManager.registerLayerView(a)});a.removed.forEach(function(a){X.isTiledLayerView(a)?(c=!0,b._unregisterTiledLayerView(a.uid)):a.supportsDraping&&b.overlayManager&&b.overlayManager.unregisterLayerView(a)});(c=c||0<a.moved.filter(X.isTiledLayerView).length)&&this._updateTiledLayers()};c.prototype._registerTiledLayer=function(a){var b=this,c=[];c.push(a.watch("visible",function(){return b._updateTiledLayers()}));
c.push(a.watch("fullOpacity",function(){return b._updateTileTextures()}));a.on("data-changed",function(){var c=X.isElevationLayerView(a)?N.LayerClass.ELEVATION:N.LayerClass.MAP,e=b._layerIndexByLayerViewId[c][a.uid];null!=e&&b._invalidateLayerData(e,c)});this._basemapLayerViewHandles[a.uid]=c};c.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles[a];if(b){for(var c=0;c<b.length;c++)b[c].remove();delete this._basemapLayerViewHandles[a]}};c.prototype._updateTiledLayers=
function(){var a=this;if(this.tilingScheme){var b=this._view.allLayerViews,c=[[],[]],e=null,d=m.empty();b.forEach(function(b){var f=b.layer;if(f&&b.visible&&X.isTiledLayerView(b)){var g=b.fullExtent;g?a.tilingScheme.compatibleWith(b.tileInfo)?(m.expand(d,g),X.isElevationLayerView(b)?c[N.LayerClass.ELEVATION].push(b):(Infinity!==b.maxDataLevel&&(null===e||b.maxDataLevel>e)&&(e=b.maxDataLevel),c[N.LayerClass.MAP].push(b))):Y.warn("Terrain: tiling scheme of layer "+f.id+" is incompatible with other tiled layers, will not be drawn"):
Y.warn("Terrain: Map or elevation layer does not have fullExtent: "+f.id)}},this);for(var b=function(a){var b=f._layerViews[a],e=c[a];e.reverse();var d=e.length,g=b.length!==d,h=Array(d),k=Array(b.length);f._layerIndexByLayerViewId[a]={};for(var l=0;l<d;l++){f._layerIndexByLayerViewId[a][e[l].uid]=l;var m=b.indexOf(e[l]);h[l]=m;l!==m&&(g=!0);-1<m&&(k[m]=l)}if(g){f._topLevelTilemapOnlyTiles.forEach(function(b){return b.modifyLayers(k,h,a)});b=f._postorderIterator;for(b.reset(f.rootTiles);!b.done;)b.next().modifyLayers(k,
h,a);f._layerViews[a]=e;a===N.LayerClass.ELEVATION&&f._memCache.clear();for(b.reset(f.rootTiles);!b.done;)e=b.next(),e.restartAgents(a),a===N.LayerClass.ELEVATION&&e.computeElevationBounds();f._updateTiles()}},f=this,g=0;g<N.LayerClass.COUNT;g++)b(g);this.tilingScheme.levels.length-1<e&&(this.tilingScheme.ensureMaxLod(e),this._viewChangeUpdate())}};c.prototype._hasFixedExtent=function(){return!!this._clippingExtent};c.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};c.prototype.numLayers=
function(a){return this._layerViews[a].length};c.prototype._updateTileTextures=function(a){void 0===a&&(a=!1);a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)a.next().updateTexture();this._iteratorPool.release(a)};c.prototype._invalidateLayerData=function(a,b){var c=this._iteratorPool.acquire();for(c.reset(this.rootTiles);!c.done;)c.next().removeLayerAgent(a,b);for(c.reset(this.rootTiles);!c.done;)c.next().invalidateLayerData(a,b);this._iteratorPool.release(c);b===N.LayerClass.ELEVATION&&
this._memCache.clear()};c.prototype.setPendingUpdates=function(){this._pendingUpdates=!0};c.prototype.requestTileData=function(a,b,c){var e=this;this.tilemapStats.tilesRequested++;var d=this.layerViewByIndex(b,c),f=d.layer;if(f.tilemapCache&&!X.isVectorTileLayerView(d)){var g=this.getTilemapTile(a),h=g.layerInfo[c][b];if(h.tilemap){if(!g.hasDataAvailable(a,b,c))return this.tilemapStats.tilesNotPresent++,this._dispatchDataEvent(a,"dataMissing",c,d,{notInTilemap:!0}),b=new G.default,b.reject(),b}else{h.tilemapRequest||
(h.tilemapRequest=this.requestTilemap(g,b,c,d,f));var k,l=new G.default(function(){return k&&k.cancel()});h.tilemapRequest.catch(function(){}).then(function(){h.tilemapRequest=null;if(!l.isCancelled()){var b=e._layerIndexByLayerViewId[c][d.uid];null!=b&&(g.hasDataAvailable(a,b,c)?(k=e._requestTileData(a,b,c,d),k.then(function(){return l.resolve()})):(e.tilemapStats.tilesNotPresent++,e._dispatchDataEvent(a,"dataMissing",c,d,{notInTilemap:!0}),l.reject()))}});return l}}return this._requestTileData(a,
b,c,d)};c.prototype._requestTileData=function(a,b,c,e){this.tilemapStats.tileRequestsSent++;return c===N.LayerClass.ELEVATION?this._requestElevationTileData(a,b,c,e):this._requestMapTileData(a,b,c,e)};c.prototype._requestElevationTileData=function(a,b,c,e){var d=this;if(X.isElevationLayerView(e)){var f=function(f){var g=d._layerIndexByLayerViewId[c][e.uid];null==g?Y.warn("TerrainSurface: received data from unknown layer %d %s",c,a.lij.toString()):(g=a.layerInfo[c][g],d._memoryUsed=0,g.data=L.create(a.lij,
a.extent,f),d._elevationDataUpdated(a,b),d._pendingUpdates=!0)},g=function(b){ka(b)||(d.tilemapStats.tileRequestErrors++,d._dispatchDataEvent(a,"dataMissing",c,e,b))};if(X.useFetchTileForLayer(e.layer))return e.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],N.ELEVATION_NODATA_VALUE).then(function(a){return f(a)},g);var h=e.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),h=this._streamDataSupplier.request(h,"binary");h.then(function(a){return d._lercWorker.decode(a.data,N.noDataValueOpt).then(function(a){return f({values:a.pixelData,
width:a.width,height:a.height,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue})},g)},g);return h}X.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};c.prototype._requestMapTileData=function(a,b,c,e){var d=this,f=function(b){return d._dispatchDataEvent(a,"dataArrived",c,e,b)};b=function(b){ka(b)||(d._dispatchDataEvent(a,"dataMissing",c,e,b),d.tilemapStats.tileRequestErrors++)};if(X.isVectorTileLayerView(e)){var g=e.tileHandler,h=e.schemaHelper.getLevelRowColumn(a.lij);
++this._vectorTileLayerRequests;return g.getVectorTile(h[0],h[1],h[2],0).then(f).catch(b).then(function(){--d._vectorTileLayerRequests})}if(X.useFetchTileForLayer(e.layer)&&X.isTileLayerView(e))return e.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2]).then(f).catch(b);g=e.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);null!=e.refreshInterval&&e.refreshTimestamp&&(g+=(-1<g.indexOf("?")?"\x26":"?")+"_ts\x3d"+e.refreshTimestamp);g=this._streamDataSupplier.request(g,"image");g.then(function(a){return f(a.data)},b);
return g};c.prototype.requestTilemap=function(a,b,c,e,d){var f=this,g=a.lij[0]+N.TILEMAP_SIZE_EXP,h=a.lij[1]<<N.TILEMAP_SIZE_EXP,k=a.lij[2]<<N.TILEMAP_SIZE_EXP;this.tilemapStats.tilemapRequestsSent++;this.tilemapStats.tilemapRequestsPending++;return d.tilemapCache.fetchTilemap(g,h,k,{timeout:6E3}).then(function(d){f.tilemapStats.tilemapRequestsPending--;b=f._layerIndexByLayerViewId[c][e.uid];null!=b&&(a.layerInfo[c][b].tilemap=d)}).catch(function(a){f.tilemapStats.tilemapRequestsPending--;f.tilemapStats.tilemapRequestErrors++})};
c.prototype.getTilemapTile=function(a){var b=a.lij[0];return b>N.TILEMAP_SIZE_EXP?T.getTileNLevelsUp(a,N.TILEMAP_SIZE_EXP):this._topLevelTilemapOnlyTiles[b]};c.prototype._dispatchDataEvent=function(a,b,c,e,d){e=this._layerIndexByLayerViewId[c][e.uid];if(null!=e)a[b](e,c,d);else Y.warn("TerrainSurface: received data from unknown layer")};c.prototype._updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();b.renderData&&
this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(b,b.renderData,this._overlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};c.prototype._updateOverlayOpacity=function(a){if(this.overlayManager&&(a=this.overlayManager.updateOpacity(a),!isNaN(a))){if(a!==this._overlayOpacity){var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.renderData&&(c.renderData.overlayOpacity=a)}this._iteratorPool.release(b)}this._overlayOpacity=
a;this._renderer.setNeedsRender()}};c.prototype.getStats=function(){var a={numNodes:0,numLeaves:0,numVisible:0,numVisiblePerLevel:[]},b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var c=b.next();a.numNodes++;c.renderData&&(a.numLeaves++,c.visible&&(a.numVisible++,c=c.lij[0],a.numVisiblePerLevel[c]=null==a.numVisiblePerLevel[c]?1:a.numVisiblePerLevel[c]+1))}this._iteratorPool.release(b);return a};c.prototype.getUsedMemory=function(){if(!this.tilingScheme)return 0;if(0<this._memoryUsed)return this._memoryUsed;
var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();this._memoryUsed+=b.memoryUsed}this._iteratorPool.release(a);return this._memoryUsed};c.prototype.getMemoryUsage=function(){if(!this.tilingScheme)return{};var a=0,b=0,c=0,e=0,d=0,f=0,g=this._iteratorPool.acquire();g.reset(this.rootTiles);for(var h=this.tilingScheme.pixelSize,h=h[0]*h[1]*4;!g.done;){for(var k=g.next(),l=da(k),m=0,n=k.layerInfo[N.LayerClass.MAP];m<n.length;m++){var p=n[m],p=p.data,r=0,u=0;p instanceof
ga?r+=ja.getGpuMemoryUsage(p):p instanceof HTMLImageElement?u+=h:p instanceof fa&&(f+=p.getGpuMemoryUsage(),c+=p.getCpuMemoryUsage());k.renderData||l?(a+=u,e+=r):(b+=u,d+=r)}l=0;for(m=k.layerInfo[N.LayerClass.ELEVATION];l<m.length;l++)p=m[l],p=p.data,a+=p?h:0;k.renderData&&(p=k.renderData.textureDescriptor,e+=p?ja.getGpuMemoryUsage(p):0,k=k.renderData.estimatedGeometryMemoryUsage,f+=k,c+=k)}this._iteratorPool.release(g);return{cpuVisibleImageData:a,cpuInvisibleImageData:b,cpuGeometryData:c,gpuVisibleImageData:e,
gpuInvisibleImageData:d,gpuGeometryData:f}};c.prototype.hasPendingUpdates=function(){if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)return!0;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)if(a.next().hasPendingUpdates)return this._iteratorPool.release(a),!0;this._iteratorPool.release(a);return!1};c.prototype.getTile=function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return this.rootTiles.forEach(function(a){if(a.lij[1]===
b[1]&&a.lij[2]===b[2])return a}),null;var c=Math.pow(2,b[0]),e=Math.floor(b[1]/c),d=Math.floor(b[2]/c),f;this.rootTiles.some(function(a){return a.lij[1]===e&&a.lij[2]===d?(f=a,!0):!1});if(f){for(c=1<<b[0]-1;f.lij[0]<b[0];){var g=b[1]&c?2:0;0<(b[2]&c)&&g++;if(!f.children[g])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+T.tile2str(f)),null;f=f.children[g];c>>=1}X.weakAssert(f.lij[0]===b[0]&&f.lij[1]===b[1]&&f.lij[2]===b[2],"not the right tile?");return f}return null};c.prototype.setBorders=
function(a){this._renderer.drawBorders=a};c.prototype.setDisableRendering=function(a){this._renderer.disableRendering=a};Object.defineProperty(c.prototype,"test",{get:function(){var a=this;return{renderer:this._renderer,lercWorker:this._lercWorker,mergeTile:function(b){return a._mergeTile(b)},updateTiles:function(b){return a._updateTiles(b)}}},enumerable:!0,configurable:!0});g([n.property({value:!1})],c.prototype,"cullBackFaces",null);g([n.property({readOnly:!0})],c.prototype,"extent",null);g([n.property({readOnly:!0})],
c.prototype,"loaded",void 0);g([n.property({value:1})],c.prototype,"baseOpacity",null);g([n.property({readOnly:!0})],c.prototype,"overlayManager",void 0);g([n.property({readOnly:!0})],c.prototype,"manifold",void 0);g([n.property()],c.prototype,"maxTextureScaleRaster",void 0);g([n.property()],c.prototype,"maxTextureScaleVector",void 0);g([n.property({readOnly:!0})],c.prototype,"ready",null);g([n.property({value:1})],c.prototype,"renderOrder",null);g([n.property({readOnly:!0})],c.prototype,"rootTiles",
void 0);g([n.property({value:!0})],c.prototype,"skirtScale",null);g([n.property({readOnly:!0,dependsOn:["tilingScheme.spatialReference"]})],c.prototype,"spatialReference",null);g([n.property({})],c.prototype,"backgroundImage",void 0);g([n.property({type:l})],c.prototype,"backgroundColor",void 0);g([n.property({dependsOn:["backgroundColor","backgroundImage"]})],c.prototype,"_background",null);g([n.property({value:!1})],c.prototype,"slicePlaneEnabled",null);g([n.property({readOnly:!0})],c.prototype,
"tilingScheme",void 0);g([n.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],c.prototype,"tilingSchemeLocked",void 0);g([n.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],c.prototype,"tilingSchemeDone",void 0);g([n.property({readOnly:!0})],c.prototype,"tilingSchemeLogic",void 0);g([n.property({value:!0})],c.prototype,"velvetOverground",null);g([n.property({value:!1})],c.prototype,"wireframe",null);return c=g([n.subclass("esri.views.3d.terrain.TerrainSurface")],
c)}(n.declared(b,A.Evented));var ha=1.2,ea=80/180*Math.PI,ma=110/180*Math.PI,aa=12,qa=w.vec4f64.create(),na=m.create(),sa=[0,0,0],z={spatialReference:null,tile:null,extent:null},la={spatialReference:null,extent:null,scale:0};return t})},"esri/layers/support/LercWorker":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/promiseUtils ../../core/requireUtils ../../core/workers module".split(" "),function(t,d,q,g,l,b,f){function e(){return g.create(function(a){t(["./rasterFormats/LercCodec"],
a)})}Object.defineProperty(d,"__esModule",{value:!0});var k=function(){function a(){}a.prototype._decode=function(a){return e().then(function(b){b=b.decode;b=b(a.buffer,a.options);return{result:b,transferList:[b.pixelData.buffer]}})};return a}(),c=function(a){function c(c){var e=a.call(this)||this;e.scheduler=c;e._thread=void 0;b.open(l.getAbsMid("./LercWorker",t,f),{strategy:"dedicated",scheduler:c}).then(function(a){void 0===e._thread?e._thread=a:a.close()});return e}q(c,a);c.prototype.destroy=
function(){this._thread&&this._thread.close();this._thread=null};c.prototype.decode=function(a,b){return a&&0!==a.byteLength?this._thread?this._thread.invoke("_decode",{buffer:a,options:b},{transferList:[a]}):e().then(function(c){c=c.decode;return c(a,b)}):g.resolve(null)};return c}(k),a=new Map;d.acquireInstance=function(b){var e=a.get(b);e||(e={instance:new c(b),ref:0},a.set(b,e));++e.ref;return e.instance};d.releaseInstance=function(b){if(null!=b){b=b.scheduler;var c=a.get(b);c&&0>=--c.ref&&(c.instance.destroy(),
a.delete(b))}};d.default=function(){return new k}})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../support/mathUtils","./TerrainConst"],function(t,d,q,g){return function(){function d(b,d,e,g){this.samplerData=null;this.level=b;this.i=d;this.j=e;this.extent=g}d.prototype.computeMinMaxValue=function(b,d,e,k){var c=Infinity,a=-Infinity;b-=this.level;var f=Math.pow(2,b);if(Math.floor(d/f)===this.i&&Math.floor(e/f)===this.j&&0<b){var l=this.samplerData.width,n=this.samplerData.pixelData,
u=.5*g.ELEVATION_NODATA_VALUE;b=(l-1)/f;e=(e-this.j*f)*b;var v=(d-this.i*f)*b;if(1>b){var r=Math.floor(e),y=Math.floor(v),w=r+y*l;d=n[w];var f=n[w+1],m=n[w+l],w=n[w+l+1];if(d+f+m+w<u)return c=e-r,u=v-y,a=q.bilerp(d,f,m,w,c,u),l=q.bilerp(d,f,m,w,c+b,u),n=q.bilerp(d,f,m,w,c,u+b),b=q.bilerp(d,f,m,w,c+b,u+b),k[0]=Math.min(a,l,n,b),k[1]=Math.max(a,l,n,b),k;e=r;v=y;b=1}else e=Math.floor(e),v=Math.floor(v),b=Math.ceil(b);for(d=e;d<=e+b;d++)for(f=v;f<=v+b;f++)w=d+f*l,m=n[w],m<u?(c=Math.min(c,m),a=Math.max(a,
m)):(c=0<c?0:c,a=0>a?0:a)}k[0]=c;k[1]=a;return k};d.create=function(b,f,e){b=new d(b[0],b[1],b[2],f);f=e.noDataValue;var g=e.minValue,c=e.maxValue;if(null==g||null==c){for(var a=e.values,g=Infinity,c=-Infinity,h=!0,l=0;l<a.length;l++){var n=a[l];n!==f&&(g=n<g?n:g,c=n>c?n:c,h=!1)}h&&(c=g=0)}c=-3E38<c?c:0;b.samplerData={pixelData:e.values,width:e.width,height:e.height,minValue:g,maxValue:c,noDataValue:f,safeWidth:.99999999*(e.width-1),dx:(e.width-1)/(b.extent[2]-b.extent[0]),dy:(e.width-1)/(b.extent[3]-
b.extent[1]),x0:b.extent[0],y1:b.extent[3]};b.bounds=[g,c];return b};return d}()})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgent".split(" "),function(t,d,q,g,l,b){return function(b){function e(){var e=null!==b&&b.apply(this,arguments)||this;e._scaleRangeEnabled=!1;return e}q(e,b);e.prototype._desiredMinLevelDelta=function(){return l.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-
this.tile.lij[0])};e.Pool=new g(e);return e}(b)})},"esri/views/3d/terrain/TileAgent":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./TerrainConst","./tileUtils"],function(t,d,q,g,l){var b=Error("Abstract method called on TileAgent");t=function(){function b(){}b.prototype.init=function(b,d,c,a){this.tile=b;this._layerIdx=d;this._layerClass=c;this._suspended=a;this._tileLayerInfo=b.getLayerInfo(d,c);this._dataRequested=null;b=this._findAncestorWithData();this._setUpsampleTile(b)};
b.prototype.startLoading=function(){return this._requestNext()};b.prototype.dispose=function(){this._dataRequested&&(this._dataRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._dataRequested=null);this._tileLayerInfo=this.tile=null};b.prototype.setSuspension=function(b){b!==this._suspended&&((this._suspended=b)?this._dataRequested&&(this._dataRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._dataRequested=null):this._tileLayerInfo.data||this.update())};
b.prototype.update=function(){var b=this._findAncestorWithData();this._setUpsampleTile(b);return this._requestNext()};b.prototype.dataArrived=function(b){this._setUpsampleTile(b);this._dataRequested=null;b===this.tile?this.tile.updateRenderData(this._layerClass):this._requestNext()};b.prototype.dataMissing=function(b){this._dataRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};b.prototype._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};
b.prototype._requestNext=function(){if(this._suspended)return!0;var b=this._findNextDownload();if(this._dataRequested){if(b===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._dataRequested=null}b?b.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._dataRequested=b):this._agentDone();return!!this._dataRequested};b.prototype._findNextDownload=function(){for(var b=this._layerIdx,d=this._layerClass,c=this.tile.surface.layerViewByIndex(b,
d),a=c.layer,f=c.minDataLevel,c=c.maxDataLevel,p=this._desiredMinLevelDelta(),n=g.START_LOADING_LEVEL_DELTA+p,u=this._scaleRangeEnabled?l.fallsWithinLayer:function(){return!0},v,r=this.tile,q=0,w=this._tileLayerInfo.upsampleFromTile,w=w?w.tile.lij[0]:-1,m=this.tile.surface,x=m.tilemapStats,A=m.getTilemapTile(r),C=!1;r&&u(r,a,!1)&&r.lij[0]>=f;){var t=r.lij[0],E=r.layerInfo[d][b];if(E.data&&q>=p){t>w&&this._setUpsampleTile(r);E.dataInvalidated&&(v=r);break}if(A&&!A.hasDataAvailable(r,b,d))C=!0;else if(t<=
c&&!E.data&&!E.dataMissing){if(!v||0===t%g.LOADING_LEVEL_MODULO||this.tile.lij[0]-v.lij[0]<p)v=r;if(q>=n)break}(r=r.parent)&&A&&(A=A.parent||m.getTilemapTile(r));q++}v&&this.tile.lij[0]-v.lij[0]<p&&this._tileLayerInfo.upsampleFromTile&&(v=null);!v&&C&&x.tilesNotPresent++;return v};b.prototype._findAncestorWithData=function(){for(var b=this.tile.vlevel,d=this._desiredMinLevelDelta(),c,a=this.tile;a;a=a.parent)if(a.hasLayerData(this._layerIdx,this._layerClass)){if(b-a.lij[0]>=d)return a;c=a}return c};
b.prototype._setUpsampleTile=function(b){this._tileLayerInfo.setUpsampleInfo(this.tile,b);this.tile.updateRenderData(this._layerClass)};return b}();d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}q(e,d);e.prototype._desiredMinLevelDelta=function(){throw b;};return e}(t);(t||(t={})).DONE=new d;return t})},"esri/views/3d/terrain/tileUtils":function(){define("require exports ../../../core/PooledArray ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(t,d,q,g,l,b){function f(a){return a[0]+"/"+a[1]+"/"+a[2]}function e(a,b){b(a);for(var c=0;4>c;c++){var d=a.children[c];d&&e(d,b)}}function k(a,b){for(var c=0;4>c;c++){var e=a.children[c];e&&k(e,b)}b(a)}function c(a,b,c){a=a.screenDepth;b=b.screenDepth;return a<b?-c:a>b?c:0}Object.defineProperty(d,"__esModule",{value:!0});t=function(){function a(){this.q=new q;this._last=null;this.done=!0}a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null;this.done=!1};a.prototype.reset=
function(a){this.q.clear();a&&this.q.pushArray(a);this._last=null;this.done=0===this.q.length};a.prototype.skipSubtree=function(){this._last=null;0===this.q.length&&(this.done=!0)};a.prototype.next=function(){if(this.done)return null;if(this._last){var a=this._last.children;if(a[0])for(var b=3;0<=b;b--){var c=a[b];c&&this.q.push(c)}}this._last=this.q.pop();0!==this.q.length||this._last.children[0]||(this.done=!0);return this._last};return a}();d.IteratorPreorder=t;t=function(){function a(){this.q=
new q;this.done=!0}a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a)for(var b=this.q.data[a],c=0;4>c;c++){var e=b.children[c];e&&this.q.push(e)}this.done=0===this.q.length};a.prototype.next=function(){var a=this.q.pop();this.done=0===this.q.length;return a};return a}();d.IteratorPostorder=t;d.lij2str=f;d.tile2str=function(a){return f(a.lij)};d.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)e(a[c],b);else e(a,b)};
d.traverseTilesPostorder=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)k(a[c],b);else k(a,b)};d.findParentByLIJ=function(a,b){for(;a;a=a.parent)if(a.hasLij(b))return a;return null};d.fallsWithinLayer=function(a,b,c){if(!b)return!1;var e=b.fullExtent,d=a.extent;if(c){if(d[0]<e.xmin||d[1]<e.ymin||d[2]>e.xmax||d[3]>e.ymax)return!1}else if(e.xmin>d[2]||e.ymin>d[3]||e.xmax<d[0]||e.ymax<d[1])return!1;a=a.surface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale||
0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};d.isPosWithinTile=function(a,b){a=a.extent;return b[0]>=a[0]&&b[1]>=a[1]&&b[0]<=a[2]&&b[1]<=a[3]};d.getTileNLevelsUp=function(a,b){for(;b--;)a=a.parent;return a};d.nextTileInAncestry=function(a,b){var c=a.lij[0]-b.lij[0]-1,e=a.lij[2]>>c,d=0;a.lij[1]>>c&1&&(d+=2);e&1&&(d+=1);return b.children[d]};d.sortTiles=function(a,b){b.sort(function(b,e){return c(b,e,a)})};d.compareTiles=c;d.computeUpsampleInfo=function(a,b,c){for(var e=1,d=0,f=0;a!==b;)if(e*=.5,d*=
.5,f*=.5,a.lij[2]&1&&(d+=.5),0===(a.lij[1]&1)&&(f+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of upsampleTile");c.init(b,d,f,e)};d.hasVisibleSiblings=function(a){for(var b=0;b<a.length;b++){var c=a[b],e=c.parent;if(e)for(var d=0;4>d;d++){var f=e.children[d];if(f&&f!==c&&f.visible)return!0}}return!1};var a=Math.pow(2,-52),h=l.vec3f64.create(),p=l.vec3f64.create();d.intersectSkirts=function(c,e,d,f,k,l,m,q,A){var n=l.data,r=l.offsetIdx;l=l.strideIdx;var u=c[0],v=c[1];c=c[2];var x=
e[0]-u,w=e[1]-v;for(e=e[2]-c;d<f;d++){var y=m?m[d]:d,t=r+l*k[3*y],M=r+l*k[3*y+1],Q=r+l*k[3*y+2],P=n[t],O=n[t+1],U=n[t+2];2<=n[t+3]&&(g.vec3.set(h,P,O,U),q(h),P+=h[0],O+=h[1],U+=h[2]);var N=n[M],t=n[M+1],V=n[M+2];2<=n[M+3]&&(g.vec3.set(h,N,t,V),q(h),N+=h[0],t+=h[1],V+=h[2]);var M=n[Q],X=n[Q+1],J=n[Q+2];2<=n[Q+3]&&(g.vec3.set(h,M,X,J),q(h),M+=h[0],X+=h[1],J+=h[2]);var Q=N-P,t=t-O,V=V-U,M=M-P,X=X-O,J=J-U,R=w*J-X*e,T=e*M-J*x,W=x*X-M*w,N=Q*R+t*T+V*W,P=u-P,Z=v-O,fa=c-U,U=Z*V-t*fa,O=fa*Q-V*P,ga=P*t-Q*Z;
if(N>a){P=P*R+Z*T+fa*W;if(0>P||P>N)continue;R=x*U+w*O+e*ga;if(0>R||P+R>N)continue}else if(N<-a){P=P*R+Z*T+fa*W;if(0<P||P<N)continue;R=x*U+w*O+e*ga;if(0<R||P+R<N)continue}else continue;U=(M*U+X*O+J*ga)/N;0<=U&&(Q=b.computeNormal(Q,t,V,M,X,J,p),A(U,Q,y))}}})},"esri/views/3d/terrain/MapTileAgent":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/ObjectPool","./TileAgent"],function(t,d,q,g,l){return function(b){function d(){var e=b.call(this)||this;e._scaleRangeEnabled=
!0;return e}q(d,b);d.prototype._desiredMinLevelDelta=function(){return 0};d.Pool=new g(d);return d}(l)})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../symbols/SimpleMarkerSymbol ../state/utils/viewUtils ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/mathUtils ../support/projectionUtils ../support/stack ../webgl-engine/lib/Intersector ../webgl-engine/lib/localOrigin".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M){var Q=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],P=k.getLogger("esri.views.3d.OverlayManager"),O,U=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new f;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._connectedLayers={};a._scale=0;a._placementDirty=!1;a._drawTexturesDirty=!1;a._isSpherical=
!1;a._latestOriginId=0;a._maxResolution=e("esri-mobile")?2048:4096;a.opacity=0;return a}q(d,b);Object.defineProperty(d.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.getDrapedRenderer();this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._renderer.onContentChanged=function(){return a.setDrawTexturesDirty()};
this._renderer.forceUpdate=function(b){a.updateOverlays(b);a._preRender()};this.groundIntersector=new K(this.view.viewingMode);this.groundIntersector.enable.backfacesTerrain=!0;this.groundIntersector.enable.invisibleTerrain=!0;this.groundIntersector.enable.hud=!1;this._handles.add(this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],function(){return a.setOverlayPlacementDirty()}));this._handles.add(this.view.on("resize",function(){return a.setOverlayPlacementDirty()}));
this._handles.add(h.addFrameTask({preRender:function(){return a._preRender()}}))};d.prototype.destroy=function(){for(var a in this._connectedLayers)this.unregisterLayerView(this._connectedLayers[a].layerView);this._disposeOverlays();this._handles&&(this._handles.destroy(),this._handles=null)};d.prototype.onHasHighlightsChanged=function(){this.setOverlayPlacementDirty();this.notifyChange("hasHighlights")};d.prototype.hasOverlays=function(){return!!this._overlays};d.prototype.setSpatialReference=function(a,
b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=b)?a.isWebMercator?new G.Cyclical(-2.0037508342788905E7,2.0037508342788905E7):new G.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=null)};d.prototype.registerLayerView=function(a){var b=this,c=a.layer.uid;if(this._connectedLayers[c])P.warn("[OverlayManager#registerLayerView]: Layer "+c+" is already connected");
else{var e=a.on("draped-data-change",function(){return b.setOverlayPlacementDirty()});this._connectedLayers[c]={eventHandles:[e],layerView:a};a.setDrapingExtent&&this._overlays&&[this._overlays.inner,this._overlays.outer].forEach(function(c,e){a.setDrapingExtent(e,c.extent,b._overlaySR,c.resolution,c.renderLocalOrigin,c.pixelRatio)});this.setOverlayPlacementDirty();this._setLayerViewOverlayUpdating(a,!0)}};d.prototype.unregisterLayerView=function(a){for(var b in this._connectedLayers){var c=this._connectedLayers[b];
if(c.layerView===a){if(c.eventHandles)for(var e=0;e<c.eventHandles.length;e++)c.eventHandles[e].remove();delete this._connectedLayers[b];this.setOverlayPlacementDirty();a.destroyed||(a.overlayUpdating=!1)}}};d.prototype.setOverlayPlacementDirty=function(){this._placementDirty||(this._setOverlayUpdating(!0),this._placementDirty=!0)};d.prototype._setLayerViewOverlayUpdating=function(a,b){if(!b||!a.suspended&&a.hasDraped)a.overlayUpdating=b};d.prototype._setOverlayUpdating=function(b){for(var c in this._connectedLayers)this._setLayerViewOverlayUpdating(this._connectedLayers[c].layerView,
b);c=this.view.graphicsView;a.isSome(c)&&(c.overlayUpdating=b)};d.prototype.updateOverlays=function(a){void 0===a&&(a=this.view.state.camera);if(this._overlaySR){var b;b=c.nextHighestPowerOfTwo(Math.max(a.fullWidth,a.fullHeight)+256);var e=Math.min(b,this._maxResolution);this._computeOverlayExtents(a,b,T);this._overlays||this._initOverlays();this._updateOverlay(this._overlays.inner,0,T.inner,e,1);this._updateOverlay(this._overlays.outer,1,T.outer,e,x.width(T.inner)/x.width(T.outer));this.opacity=
1;this.terrainSurface._updateTileOverlayParams();this._placementDirty=!1;this.setDrawTexturesDirty()}};d.prototype._updateOverlay=function(a,b,c,e,d){var f;a:{f=a.extent;for(var g=B.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS?0:U.EXTENTS_DIFFER_THRESHOLD*Math.max(c[2]-c[0],c[3]-c[1],f[2]-f[0],f[3]-f[1]),h=0;4>h;h++)if(Math.abs(f[h]-c[h])>g){f=!0;break a}f=!1}if(f||e!==a.resolution||a.pixelRatio!==d){x.set(a.extent,c);a.resolution=e;a.pixelRatio=d;d=x.center(a.extent);a.renderLocalOrigin=M.fromValues(d[0],
d[1],0,"OV_"+this._latestOriginId++);for(var k in this._connectedLayers)d=this._connectedLayers[k].layerView,d.setDrapingExtent&&d.setDrapingExtent(b,c,this._overlaySR,e,a.renderLocalOrigin,a.pixelRatio)}};d.prototype.overlaysNeedUpdate=function(){return this._placementDirty&&!!this._overlaySR};d.prototype.updateOpacity=function(a){var b=1;if(this._overlays){var c=this._scale;3.5*a<c&&(b=Math.sqrt(G.clamp((a-c/10)/(c/3.5-c/10),0,1)))}return b};d.prototype.setOverlayParamsOfTile=function(a,b,c){var e=
this._overlays.inner,d=this._overlays.outer;a=x.intersection(a.extent,a.surface.extent,W);this._rectInsideRect(a,e.extent)?(this._setTileOverlayData(a,e,b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1])):this._rectanglesOverlap(a,e.extent)?(this._setTileOverlayData(a,e,b.overlays[0]),this._setTileOverlayData(a,d,b.overlays[1])):(this._rectanglesOverlap(a,d.extent)?this._setTileOverlayData(a,d,b.overlays[0]):this._invalidateTileOverlayData(b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1]));
b.overlayOpacity=void 0!==c?c:1};d.prototype.overlayPixelSizeInMapUnits=function(a){var b;this._overlays&&(b=this._pointIsInExtent(a,this._overlays.inner.extent)?this._overlays.inner:this._overlays.outer);return b?(b.extent[2]-b.extent[0])/b.resolution:0};d.prototype._setTileOverlayData=function(a,b,c){var e=b.extent;c.texScale[0]=(a[2]-a[0])/(e[2]-e[0]);c.texScale[1]=(a[3]-a[1])/(e[3]-e[1]);var d=a[0];if(this._longitudeCyclical){var d=this._longitudeCyclical.minimalMonotonic(e[0],d),f=this._longitudeCyclical.minimalMonotonic(e[0],
a[2]);d>f&&(d=f-(a[2]-a[0]))}c.texOffset[0]=(d-e[0])/(e[2]-e[0]);c.texOffset[1]=(a[1]-e[1])/(e[3]-e[1]);c.renderTargetId=b.valid?b.renderTargetId:null;c.highlightRenderTargetId=b.highlightValid?b.highlightRenderTargetId:null};d.prototype._invalidateTileOverlayData=function(a){a.renderTargetId=null;a.highlightRenderTargetId=null};Object.defineProperty(d.prototype,"test",{get:function(){return{overlays:this._overlays}},enumerable:!0,configurable:!0});d.prototype._createEmptyOverlay=function(a){var b=
this._renderer.createRenderTarget("overlay"+a);a=this._renderer.createHighlightRenderTarget("overlayHighlight"+a);return{extent:x.create(),resolution:0,renderTargetId:b,valid:!1,highlightRenderTargetId:a,highlightValid:!1,renderLocalOrigin:M.fromValues(0,0,0,"O"),pixelRatio:1}};d.prototype._initOverlays=function(){this._overlays={inner:this._createEmptyOverlay(0),outer:this._createEmptyOverlay(1)}};d.prototype._disposeOverlays=function(){this._overlays&&(this._renderer.disposeRenderTarget(this._overlays.inner.renderTargetId),
this._renderer.disposeRenderTarget(this._overlays.inner.highlightRenderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.renderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.highlightRenderTargetId),this._overlays=null)};d.prototype._preRender=function(){this._drawTexturesDirty&&(this._drawOverlays(),this._drawTexturesDirty=!1)};d.prototype.setDrawTexturesDirty=function(){this._overlays?this._drawTexturesDirty||(this._drawTexturesDirty=!0,this._setOverlayUpdating(!0)):
this.setOverlayPlacementDirty()};d.prototype._intersectGroundFromView=function(a,b,c,e){var d=p.createRenderScreenPointArray3(b*a.fullWidth,c*a.fullHeight,1),d=a.unprojectPoint(d,F.sv3d.get());b=p.createRenderScreenPointArray3(b*a.fullWidth,c*a.fullHeight,0);b=a.unprojectPoint(b,F.sv3d.get());this.groundIntersector.intersect([],b,d,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundIntersector,null,b,d);return this.groundIntersector.results.min.getIntersectionPoint(e)};d.prototype._findHorizonBasedPointOfInterest=
function(a,b,c){var e=.5;if("global"===this.view.viewingMode){e=r.vec3f64.clone(a.eye);v.vec3.normalize(e,e);v.vec3.negate(e,e);b=v.vec3.length(b);b=Math.asin(b/v.vec3.length(a.eye));var d=Math.acos(v.vec3.dot(a.viewForward,e)),e=G.clamp((b-(d-.5*a.fovY))/a.fovY,0,1);b=G.clamp((-b-(d-.5*a.fovY))/a.fovY,0,1);e=1===e&&0===b?.5:b+.55*(e-b)}else e=w.vec4f64.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0),e=y.vec4.transformMat4(e,e,a.projectionMatrix)[1],e=G.clamp(.5+.5*e,0,1),e=1===
e||0===e?.5:0<a.eye[2]?.55*e:1-.55*(1-e);return this._intersectGroundFromView(a,.5,e,c)?!0:!1};d.prototype._computeOverlayExtents=function(a,b,c){var e=this.terrainSurface.extent,d=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,f=r.vec3f64.create();this._findHorizonBasedPointOfInterest(a,d,f)||v.vec3.copy(f,d);this._scale=this.view.renderCoordsHelper.getAltitude(a.eye);var g=v.vec3.distance(a.eye,f),d=C.viewAngle(this.view.renderCoordsHelper,d,a.eye),d=Math.PI/2-Math.abs(d-Math.PI/
2);if(E.OVERLAY_SHOW_CENTER){var h=new A({color:[255,0,0],outline:{color:[255,255,255],width:2}}),k=new m;L.vectorToPoint(f,this._renderSR,k,this._overlaySR);h=new l({geometry:k,symbol:h});void 0!==O&&this.view.graphics.remove(O);this.view.graphics.add(h);O=h}this._overlaySREqualsRenderSR||L.vectorToVector(f,this._renderSR,f,this._overlaySR);b=b*a.perRenderPixelRatio*g/2;k=!1;g=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(b/=Math.cos(L.webMercator.y2lat(f[1])),g=this.terrainSurface.extent[3],
g*=.999):(k=!0,b/=I.metersPerDegree,g=90),b>=g&&(b=g,f[1]=0,this._overlaySR.isWebMercator&&(f[0]=0)));h=1;k&&(h=1/Math.max(.2,Math.cos(Math.abs(G.deg2rad(f[1])))),180<b*h&&(h=180/b));var p=b*h,k=c.inner;k[0]=f[0]-p;k[1]=f[1]-b;k[2]=f[0]+p;k[3]=f[1]+b;this._isSpherical&&this._shiftExtentToFitBounds(k,Infinity,g);c=c.outer;x.set(c,k);6*p>e[2]-e[0]?x.set(c,e):d<=.25*Math.PI?(c[0]-=p,c[1]-=b,c[2]+=p,c[3]+=b):(L.vectorToVector(a.eye,this._renderSR,R,this._overlaySR),u.vec2.subtract(J,f,R),a=-Math.atan2(J[1],
J[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),y.vec4.scale(J,Q[Math.floor(a/(.25*Math.PI))],2*b),J[0]*=h,J[2]*=h,y.vec4.add(c,c,J));this._isSpherical&&(c[0]=this._longitudeCyclical.clamp(c[0]),c[2]=this._longitudeCyclical.clamp(c[2]),c[1]=Math.max(c[1],-g),c[3]=Math.min(c[3],g));!this._isSpherical&&e&&(a=x.intersection(k,e,W),e=x.intersection(c,e,Z),x.contains(a,e)&&(c[2]=c[0],c[3]=c[1]))};d.prototype._drawOverlays=function(){var a=!this._overlays.inner.valid||!this._overlays.outer.valid;this._drawOverlay(this._overlays.inner,
0);this._drawOverlay(this._overlays.outer,1);a&&this.terrainSurface._updateTileOverlayParams();this._setOverlayUpdating(!1);this._stage.setNeedsRender()};d.prototype._drawOverlay=function(a,b){var c=this._renderer,e=a.extent,d=a.resolution,f=a.pixelRatio,g=this._longitudeCyclical?e[2]>this._longitudeCyclical.max:!1,h=this._longitudeCyclical?e[0]<this._longitudeCyclical.min:!1;if(g||h){N.views=X;var h=void 0,h=g?this._longitudeCyclical.max-e[0]:this._longitudeCyclical.min-e[0],h=Math.round(h/(e[2]-
e[0])*d),k=N.views[0];y.vec4.set(k.viewport,0,0,h,d);y.vec4.set(k.extent,e[0],e[1],this._longitudeCyclical.max,e[3]);g||(k.extent[0]+=this._longitudeCyclical.range);k=N.views[1];y.vec4.set(k.viewport,h,0,d-h,d);y.vec4.set(k.extent,this._longitudeCyclical.min,e[1],e[2],e[3]);g&&(k.extent[2]-=this._longitudeCyclical.range)}else N.views=V,x.set(N.views[0].extent,e),y.vec4.set(N.views[0].viewport,0,0,d,d);N.width=d;N.height=d;N.pixelRatio=f*this.view.state.camera.pixelRatio;N.index=b;a.valid=c.draw(a.renderTargetId,
N);a.highlightValid=c.drawHighlights(a.highlightRenderTargetId,N)};d.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):x.intersects(a,b)};d.prototype._rectInsideRect=function(a,b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],
a[2])&&a[1]>b[1]&&a[3]<b[3]:x.contains(b,a)};d.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};d.prototype._shiftExtentToFitBounds=function(a,b,c){var e=0,d=0;a[0]<-b?e=a[0]+b:a[2]>b&&(e=b-a[2]);a[1]<-c?d=a[1]+c:a[3]>c&&(d=c-a[3]);x.offset(a,e,d)};d.EXTENTS_DIFFER_THRESHOLD=1E-5;g([n.property()],d.prototype,"view",void 0);g([n.property()],d.prototype,
"terrainSurface",void 0);g([n.property({type:Boolean})],d.prototype,"hasHighlights",null);return d=g([n.subclass("esri.views.3d.terrain.OverlayManager")],d)}(n.declared(b)),N={width:0,height:0,pixelRatio:0,views:null,index:0},V=[{viewport:x.create(),extent:x.create()}],X=[V[0],{viewport:x.create(),extent:x.create()}],J=w.vec4f64.create(),R=r.vec3f64.create(),T={inner:x.create(),outer:x.create()},W=x.create(),Z=x.create();return U})},"esri/views/3d/terrain/PlanarTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../support/geometryUtils ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),
function(t,d,q,g,l,b,f,e,k){t=function(a){function e(b,d,f){var g=a.call(this,e.NumSubdivisionsAtLevel)||this;g.tileUp=c;void 0!==b&&g.init(b,d,f);return g}q(e,a);e.prototype.init=function(b,c,e){a.prototype.init.call(this,b,c,e);this.edgeLen=this.extent[2]-this.extent[0];this.edgeLen2=this.edgeLen*this.edgeLen;this.curvatureHeight=0;this.centerAtSeaLevel[0]=f.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=f.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};
e.prototype.updateRadiusAndCenter=function(){a.prototype.updateRadiusAndCenter.call(this);var b=(this.extent[2]-this.extent[0])*Math.SQRT1_2,c=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this.radius=Math.sqrt(b*b+c*c)};e.prototype._isVisible=function(){return this.intersectsClippingArea&&b.frustum.intersectsAABB(this.surface.frustum.planes,l.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))};e.prototype.createGeometry=function(a,
b,c){k.createPlanarGlobeTile(a,this.extent,b,c,this.renderData);this.updateMemoryUsed()};e.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];return e}(e);var c=g.vec3f64.fromValues(0,0,1);return t})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../support/mathUtils ./ElevationTileAgent ./MapTileAgent ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture ../../webgl/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x){function A(a){a.dispose();a instanceof h?h.Pool.release(a):a instanceof p&&p.Pool.release(a)}var C=u.weakAssert,B=f.vec3f64.create(),E=f.vec3f64.create(),I=k.vec4f64.create(),G=f.vec3f64.create();return function(){function d(a){this._numSubdivisionAtLevel=a;this.lij=[0,0,0];this._dirty=!0;this.extent=c.create();this._elevationBounds=l.vec2f64.create();this.children=[null,null,null,null];this.layerInfo=Array(n.LayerClass.COUNT);this.extentWGS84Rad=
c.create();this.centerAtSeaLevel=f.vec3f64.create();this.center=f.vec3f64.create();this.tileUp=G;this.intersectsClippingArea=this._isWithinClippingArea=!0;this.clippingArea=null;this._memoryUsed=this.radius=this.edgeLen2=this.edgeLen=this.renderOrder=this.screenDepth=this._maxTesselation=0}Object.defineProperty(d.prototype,"memoryUsed",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maxTesselation",{get:function(){return this._maxTesselation},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numSubdivisionsAtLevel",{get:function(){return this._numSubdivisionAtLevel},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isWithinClippingArea",{get:function(){return this._isWithinClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"surface",{get:function(){return this._surface},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"visible",{get:function(){if(this._dirty){var a=this._isVisible();a!==this._visible&&(this._visible=a,this.updateAgentSuspension(),this._visible=a);this._dirty=!1}return this._visible},enumerable:!0,configurable:!0});d.prototype.init=function(a,b,c){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];c.tilingScheme.getExtent(a[0],
a[1],a[2],this.extent,this.extentWGS84Rad);this.intersectsClippingArea=this._isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen2=this.edgeLen=0;this.vlevel=a?a[0]:0;b&&b._elevationBounds?g.vec2.copy(this.elevationBounds,b.elevationBounds):g.vec2.set(this.elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;this._visible=!1;this._dirty=!0;this._parent=b;this._surface=c;for(a=0;4>a;a++)this.children[a]=null;for(a=0;a<n.LayerClass.COUNT;a++){b=c.numLayers(a);
var e=this.layerInfo[a];this.layerInfo[a]?e.length=b:(e=Array(b),this.layerInfo[a]=e);for(var d=0;d<b;d++)e[d]=r.TilePerLayerInfo.makeEmptyLayerInfo(a,this._surface.upsampleInfoPool,e[d]),a===n.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(d,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(c.tilingScheme.pixelSize[0],n.MAX_TILE_TESSELATION)};d.prototype.dispose=function(){C(!this.renderData,"tile.renderData was not unloaded");this._parent&&C(-1===this._parent.children.indexOf(this),
"still linked");for(var a=0;a<n.LayerClass.COUNT;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++)c[b].dispose();this._surface=this._parent=null;this._memoryUsed=0};d.prototype.updateMemoryUsed=function(){for(var a=this._surface.tilingScheme.pixelSize,a=a[0]*a[1]*4,b=this._memoryUsed=0,c=this.layerInfo[n.LayerClass.MAP];b<c.length;b++){var e=c[b],e=e.data;e instanceof m?this._memoryUsed+=x.getGpuMemoryUsage(e):e instanceof HTMLImageElement?this._memoryUsed+=a:e instanceof w&&(this._memoryUsed+=
e.getGpuMemoryUsage()+e.getCpuMemoryUsage())}b=0;for(c=this.layerInfo[n.LayerClass.ELEVATION];b<c.length;b++)e=c[b],this._memoryUsed+=e.data?a:0;this.renderData&&(this._memoryUsed+=this.renderData.estimatedGeometryMemoryUsage,a=this.renderData.textureDescriptor)&&(this._memoryUsed+=x.getGpuMemoryUsage(a))};d.prototype.updateScreenDepth=function(a){b.vec3.copy(I,this.center);I[3]=1;e.vec4.transformMat4(I,I,a);this.screenDepth=I[2]/I[3]};d.prototype.shouldSplit=function(c,e){var d=this.lij[0];b.vec3.subtract(B,
this.center,e);var f=b.vec3.squaredLength(B),g=c[4];if(f<this.edgeLen2&&d<g)return n.TileUpdate.SPLIT;var h=c[1],f=2*Math.sqrt(f),k=this.edgeLen/(c[0]*f);return k<h?this.vlevel!==this.lij[0]?(this.vlevel=this.lij[0],n.TileUpdate.VSPLITMERGE):n.TileUpdate.NONE:d>=g?(c=d+Math.ceil(-a.log2(h/k)),c!==this.vlevel?(this.vlevel=c,n.TileUpdate.VSPLITMERGE):n.TileUpdate.NONE):6<d&&(b.vec3.scale(E,this.tileUp,b.vec3.dot(this.tileUp,B)),b.vec3.subtract(E,E,B),d=b.vec3.squaredLength(E),d>this.radius*this.radius&&
(b.vec3.scale(E,E,this.radius/Math.sqrt(d)),b.vec3.add(E,E,this.center),b.vec3.subtract(E,e,E),e=this._elevationBounds[1]-this._elevationBounds[0],Math.min(1,(Math.abs(b.vec3.dot(E,this.tileUp))+.5*e+this.curvatureHeight)/b.vec3.length(E))*(this.edgeLen/(c[2]*f))<.1/c[5]*c[3]))?n.TileUpdate.NONE:n.TileUpdate.SPLIT};d.prototype.getWGS84Extent=function(){var b=this.extentWGS84Rad;return c.fromValues(a.rad2deg(b[0]),a.rad2deg(b[1]),a.rad2deg(b[2]),a.rad2deg(b[3]))};d.prototype.load=function(a){for(var b=
null==this.renderData&&a.loadCachedElevationData(this),c=0;c<n.LayerClass.COUNT;c++)if(this.layerInfo[c])if(c===n.LayerClass.ELEVATION&&b)for(var e=0,d=this.layerInfo[c];e<d.length;e++)d[e].loadingAgent=v.DONE;else this._createOrUpdateAgents(0,c);a.loadTile(this)};d.prototype.unload=function(a){a.unloadTile(this,this.elevationDone);for(a=0;a<n.LayerClass.COUNT;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var e=c[b];e.loadingAgent&&e.loadingAgent!==v.DONE&&(A(e.loadingAgent),e.loadingAgent=
null);e.pendingUpdates=0}this._pendingUpdates&=~n.TileUpdate.GEOMETRY;this._pendingUpdates&=~n.TileUpdate.TEXTURE};d.prototype.updateClippingStatus=function(a){if(q.equals(a,this.clippingArea))return!1;var b=this.intersectsClippingArea,c=this._isWithinClippingArea;a?(this.intersectsClippingArea=this.intersectsExtent(a),this._isWithinClippingArea=this.isWithinExtent(a)):this._isWithinClippingArea=this.intersectsClippingArea=!0;this.clippingArea=a;this._dirty=!0;a=c&&this._isWithinClippingArea;b=!c&&
!b&&!this._isWithinClippingArea&&!this.intersectsClippingArea;!this.renderData||a||b||this.setPendingUpdate(n.TileUpdate.GEOMETRY);return!0};d.prototype.updateVisibility=function(){this._dirty=!0};d.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};d.prototype.hasLayerData=function(a,b){return(a=this.layerInfo[b][a])&&a.data&&!a.dataInvalidated};d.prototype.hasDataAvailable=function(a,b,c){return(b=this.layerInfo[c][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],a.lij[2]):
!0};Object.defineProperty(d.prototype,"hasPendingUpdates",{get:function(){return 0!==this._pendingUpdates},enumerable:!0,configurable:!0});d.prototype.isSuspended=function(a){return this.hasPendingUpdate(n.TileUpdate.SPLIT)?!0:a===n.LayerClass.ELEVATION?!1:!this.visible};Object.defineProperty(d.prototype,"elevationDone",{get:function(){if(this.hasPendingUpdate(n.TileUpdate.GEOMETRY))return!1;for(var a=0,b=this.layerInfo[n.LayerClass.ELEVATION];a<b.length;a++){var c=b[a];if(c.loadingAgent!==v.DONE||
!c.upsampleFromTile)return!1}return!0},enumerable:!0,configurable:!0});d.prototype.hasPendingUpdate=function(a){return(this._pendingUpdates&a)===a};d.prototype.setPendingUpdate=function(a){this._pendingUpdates|=a;this._surface.setPendingUpdates()};d.prototype.resetPendingUpdate=function(a){return this.hasPendingUpdate(a)?(this._pendingUpdates&=~a,!0):!1};d.prototype.requestLayerData=function(a,b,c){n.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),
b,a,c.tile.lij.toString());var e=this.layerInfo[b][a];if(-1<e.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),!0;e.waitingAgents.push(c);if(e.data&&!e.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),setTimeout(c.dataArrived.bind(c,this),0),!0;if(e.requestPromise)return!0;
var d=this._surface.requestTileData(this,a,b);if(!d||d.isFulfilled())return!1;a=function(){e.requestPromise===d&&(e.requestPromise=null)};e.requestPromise=d;d.then(a,a);return!0};d.prototype.descendants=function(a){a||(a=[]);for(var b=0;4>b;b++){var c=this.children[b];c&&(c.descendants(a),a.unshift(this.children[b]))}return a};Object.defineProperty(d.prototype,"isLeaf",{get:function(){return!this.children[0]&&!this.children[1]&&!this.children[2]&&!this.children[3]},enumerable:!0,configurable:!0});
d.prototype.hasLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};d.prototype.findByLij=function(a){if(this.hasLij(a))return this;for(var b=0;4>b;b++){var c=this.children[b];if(c&&(c=c.findByLij(a)))return c}return null};d.prototype.unrequestLayerData=function(a,b,c){n.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var e=this.layerInfo[b][a],d=e.waitingAgents;c=null!=q.removeUnordered(d,c);
C(c,"agent has not requested this piece of map data");1>d.length&&((d=e.requestPromise)&&!d.isFulfilled()&&(d.cancel(),e.requestPromise=null),n.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),b,a),this.updateMemoryUsed())};d.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0;this.updateMemoryUsed()};d.prototype.dataMissing=
function(a,b,c){c.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),b,a);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing(this);a.waitingAgents.length=0;this.updateMemoryUsed()};d.prototype.updateRenderData=function(a){switch(a){case n.LayerClass.MAP:return this.updateTexture();case n.LayerClass.ELEVATION:return this.updateGeometry()}};d.prototype.updateTexture=function(){this.renderData&&(this._pendingUpdates|=n.TileUpdate.TEXTURE,
this._surface.setPendingUpdates())};d.prototype.updateGeometry=function(){this.setPendingUpdate(n.TileUpdate.GEOMETRY);for(var a=0,b=this.layerInfo[n.LayerClass.ELEVATION];a<b.length;a++)b[a].pendingUpdates|=n.TileUpdate.GEOMETRY;this._surface.setPendingUpdates()};d.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};d.prototype.computeElevationBounds=function(){g.vec2.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);for(var a=
!1,b=0,c=this.layerInfo[n.LayerClass.ELEVATION];b<c.length;b++){var e=c[b];e.elevationBounds&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],e.elevationBounds[0]),this._elevationBounds[1]=Math.max(this._elevationBounds[1],e.elevationBounds[1]),a=!0)}a||g.vec2.set(this._elevationBounds,0,0);this.updateRadiusAndCenter()};d.prototype.updateRadiusAndCenter=function(){b.vec3.scale(E,this.tileUp,.5*(this._elevationBounds[0]+this._elevationBounds[1]));b.vec3.add(this.center,this.centerAtSeaLevel,
E)};d.prototype.findElevationBoundsForLayer=function(a,c){var e=this.layerInfo[n.LayerClass.ELEVATION][a];if(!e.elevationBounds||e.elevationBounds[2]<c)if(c=this._surface.layerViewByIndex(a,n.LayerClass.ELEVATION),y.fallsWithinLayer(this,c.layer,!1)){c=!1;if(e.data){var d=e.data;g.vec2.copy(I,d.bounds);I[2]=this.lij[0];c=!0}else{for(var f=0,h=void 0,d=void 0,k=this._parent;k&&(!d||f<n.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(f=this.vlevel-k.lij[0],h=d||h,d=k.layerInfo[n.LayerClass.ELEVATION][a].data,
!d&&h&&f>=n.ELEVATION_DESIRED_RESOLUTION_LEVEL);k=k._parent);if(d=d||h)d.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],I),Infinity!==I[0]&&(I[2]=d.level,c=!0)}c&&(e.elevationBounds?b.vec3.copy(e.elevationBounds,I):e.elevationBounds=[I[0],I[1],I[2]])}};d.prototype.modifyLayers=function(a,b,c){for(var e=this.layerInfo[c],d=0;d<e.length;d++){var f=e[d];f.loadingAgent&&f.loadingAgent!==v.DONE&&(A(f.loadingAgent),f.loadingAgent=null);f.waitingAgents.length=0}if(c===n.LayerClass.MAP)for(d=0;d<
e.length;++d)void 0===a[d]&&e[d].dispose();a=b.length;f=Array(a);for(d=0;d<a;d++){var g=b[d];f[d]=-1<g?e[g]:r.TilePerLayerInfo.makeEmptyLayerInfo(c,this._surface.upsampleInfoPool)}this.layerInfo[c]=f;this.updateMemoryUsed()};d.prototype.restartAgents=function(a){this.renderData&&(this._createOrUpdateAgents(0,a),this.updateRenderData(a))};d.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var e=b[c];e.loadingAgent===v.DONE&&(e.loadingAgent=null)}this._createOrUpdateAgents(0,
a)}};d.prototype.updateAgentSuspension=function(){for(var a=0;a<n.LayerClass.COUNT;a++)for(var b=this.isSuspended(a),c=0,e=this.layerInfo[a];c<e.length;c++){var d=e[c];d.loadingAgent&&d.loadingAgent!==v.DONE&&(d.loadingAgent.setSuspension(b),d.loadingAgent===v.DONE&&this.updateRenderData(a))}};d.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==v.DONE&&a.loadingAgent.dispose();a.loadingAgent=null};d.prototype.agentDone=function(a,b){var c=this.layerInfo[b][a];
c.loadingAgent=v.DONE;c.data||c.upsampleFromTile||this._createOrUpdateAgents(a+1,b)};d.prototype._createOrUpdateAgents=function(a,b){for(var c=this.isSuspended(b),e=this.layerInfo[b];a<e.length;++a){var d=e[a],f=!1,g=this._surface.layerViewByIndex(a,b);if(d.loadingAgent)d.loadingAgent!==v.DONE&&d.loadingAgent.setSuspension(c),d.loadingAgent!==v.DONE&&(f=d.loadingAgent.update());else if(y.fallsWithinLayer(this,g.layer,!1)){var f=d,k=a,l=b,m=c,r=l===n.LayerClass.ELEVATION?h.Pool.acquire():p.Pool.acquire();
r.init(this,k,l,m);f.loadingAgent=r;(f=d.loadingAgent.startLoading())?d.loadingAgent===v.DONE&&this.setPendingUpdate(n.TileUpdate.GEOMETRY):(A(d.loadingAgent),d.loadingAgent=v.DONE)}d.loadingAgent===v.DONE&&this.updateRenderData(b);if(f&&g.isOpaque)break}};d.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};d.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};return d}()})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../../support/basemapDefinitions ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),
function(t,d,q,g,l,b,f,e){function k(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function c(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function a(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function h(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function p(){v={};for(var a in b)b[a].baseMapLayers.forEach(function(a){v[a.url]=19});v["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=
20}function n(a,b,c,e){return u["local"===e||"planar"===e?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,c)}Object.defineProperty(d,"__esModule",{value:!0});var u={planar:f,spherical:e};d.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};d.autoUpdateSkirtsVisibility=function(a,b,c){var e=u[a.manifold],d,f=e.isInsideExtent(a,b);f?d=a.getElevation(b):(d=a.getElevationBounds(),d=.5*(d[0]+d[1]));d=b[2]-d;c=.9*Math.abs(d)<c?0:0>d?-1:1;f||(e.isInsideExtent(a,b,a.hideSkirtsDistanceFromExtentMargin)?
(b=e.tiltToExtentEdge(a,b),b>a.hideSkirtsMinimumCameraTilt&&b<a.hideSkirtsMaximumCameraTilt&&(c=0)):c=0);a.skirtScale=c};d.isTiledLayer=function(a){return a&&"base-tile"===a.type||"tile"===a.type||"elevation"===a.type||"base-elevation"===a.type||"open-street-map"===a.type||"web-tile"===a.type||"wmts"===a.type||"vector-tile"===a.type};d.isVectorTileLayer=function(a){return a&&a.isInstanceOf(l)};d.isTileLayerView=k;d.isVectorTileLayerView=c;d.isWMTSLayerView=a;d.isElevationLayerView=h;d.isTiledLayerView=
function(b){return b&&(k(b)||h(b)||c(b)||a(b))};d.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===g.prototype.fetchTile||a.fetchTile===q.prototype.fetchTile)};var v=null;d.getKnownTiledServiceLevelCap=function(a){v||p();a=a&&a.replace(/https?:/,"");return a in v?v[a]:Infinity};d.prepareKnownTiledServiceLevelCaps=p;d.checkIfTileInfoSupportedForView=n;d.getTiledLayerInfo=function(a,b,c){var e,d;if("wmts"===a.type){if(a=a.activeLayer){var f=a.tileMatrixSet;if(f)e=f.tileInfo,d=f.fullExtent;
else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==n(a.tileInfo,a.fullExtent,b,c)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else e="vector-tile"===a.type?a.compatibleTileInfo256:a.tileInfo,d=a.fullExtent;return e&&d&&null==n(e,d,b,c)?{tileInfo:e,fullExtent:d}:{tileInfo:null,fullExtent:null}}})},"esri/layers/ElevationLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/io-query dojo/_base/kernel ../request ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/HeightModelInfo ./Layer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./support/commonProperties ./support/LercWorker".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y){return function(d){function m(a){a=d.call(this)||this;a.copyright=null;a.heightModelInfo=null;a.path=null;a.opacity=1;a.operationalLayerType="ArcGISTiledElevationServiceLayer";a.type="elevation";a.url=null;a.version=null;a._lercWorker=y.acquireInstance();return a}g(m,d);m.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?q({url:a},b):a};m.prototype.destroy=function(){y.releaseInstance(this._lercWorker);this._lercWorker=null};Object.defineProperty(m.prototype,
"minScale",{get:function(){},set:function(a){this.constructed&&f.deprecated(this.declaredClass+".minScale support has been removed.","","4.5")},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"maxScale",{get:function(){},set:function(a){this.constructed&&f.deprecated(this.declaredClass+".maxScale support has been removed.","","4.5")},enumerable:!0,configurable:!0});m.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=9.3);return a};m.prototype.load=function(){var a=this;
this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(a){for(var b=0;b<a.typeKeywords.length;b++)if("elevation 3d layer"===a.typeKeywords[b].toLowerCase())return!0;throw new k("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});}}).then(function(){return a._fetchImageService()},function(){return a._fetchImageService()}));
return this.when()};m.prototype.fetchTile=function(a,b,c,d){var f=this;void 0===d&&(d=0);return this.load().then(function(){return f._fetchTileAvailability(a,b,c)}).then(function(){return e(f.getTileUrl(a,b,c),{responseType:"array-buffer"})}).then(function(a){return f._lercWorker.decode(a.data,{noDataValue:d,returnFileInfo:!0})}).then(function(a){return{values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}})};
m.prototype.getTileUrl=function(a,c,e){var d=b.objectToQuery(q({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null}));return this.parsedUrl.path+"/tile/"+a+"/"+c+"/"+e+(d?"?"+d:"")};m.prototype.queryElevation=function(a,b){var c=this;return this._importElevationQuery().then(function(e){return(new e.ElevationQuery).query(c,a,b)})};m.prototype.createElevationSampler=function(a,b){var c=this;return this._importElevationQuery().then(function(e){return(new e.ElevationQuery).createSampler(c,
a,b)})};m.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return c.reject(new k("elevation-layer:view-not-supported","ElevationLayer is only supported in 3D"));case "3d":return c.create(function(a){return t(["../views/3d/layers/ElevationLayerView3D"],a)})}};m.prototype._fetchTileAvailability=function(a,b,e){return this.tilemapCache?this.tilemapCache.fetchAvailability(a,b,e):c.resolve("unknown")};m.prototype._fetchImageService=function(){var a=this;return c.resolve().then(function(){if(a.resourceInfo)return a.resourceInfo;
var b={query:q({f:"json"},a.parsedUrl.query),responseType:"json"};return e(a.parsedUrl.path,b)}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));a.read(b.data,{origin:"service",url:a.parsedUrl})})};m.prototype._importElevationQuery=function(){return c.create(function(a){t(["./support/ElevationQuery"],a)})};l([a.property({json:{read:{source:"copyrightText"}}})],m.prototype,"copyright",void 0);l([a.property({readOnly:!0,type:h})],m.prototype,"heightModelInfo",void 0);l([a.property({type:String,
json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],m.prototype,"path",void 0);l([a.property({type:["show","hide"]})],m.prototype,"listMode",void 0);l([a.property({json:{read:!1,write:!1}})],m.prototype,"minScale",null);l([a.property({json:{read:!1,write:!1}})],m.prototype,"maxScale",null);l([a.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],m.prototype,"opacity",void 0);l([a.property({type:["ArcGISTiledElevationServiceLayer"]})],m.prototype,"operationalLayerType",
void 0);l([a.property()],m.prototype,"resourceInfo",void 0);l([a.property({json:{read:!1},value:"elevation",readOnly:!0})],m.prototype,"type",void 0);l([a.property(r.url)],m.prototype,"url",void 0);l([a.property()],m.prototype,"version",void 0);l([a.reader("version",["currentVersion"])],m.prototype,"readVersion",null);return m=l([a.subclass("esri.layers.ElevationLayer")],m)}(a.declared(p,n,u,v))})},"esri/layers/mixins/ArcGISCachedService":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/accessorSupport/decorators ./ArcGISService ../support/TileInfo ../support/TilemapCache".split(" "),
function(t,d,q,g,l,b,f,e,k,c){return function(a){function e(){var b=null!==a&&a.apply(this,arguments)||this;b.copyright=null;b.minScale=0;b.maxScale=0;b.spatialReference=null;b.tileInfo=null;b.tilemapCache=null;return b}g(e,a);e.prototype.readMinScale=function(a,b){return null!=b.minLOD&&null!=b.maxLOD?a:0};e.prototype.readMaxScale=function(a,b){return null!=b.minLOD&&null!=b.maxLOD?a:0};Object.defineProperty(e.prototype,"supportsBlankTile",{get:function(){return 10.2<=this.version},enumerable:!0,
configurable:!0});e.prototype.readTileInfo=function(a,b){if(!a)return null;var c=b.minScale,e=b.maxScale,d=b.minLOD,f=b.maxLOD;if(null!=d&&null!=f)a.lods=a.lods.filter(function(a){a=a.level;return null!=a&&a>=d&&a<=f});else if(0!==c&&0!==e){var g=c?Math.round(1E4*c)/1E4:Infinity,h=e?Math.round(1E4*e)/1E4:-Infinity;a.lods=a.lods.filter(function(a){a=Math.round(1E4*a.scale)/1E4;return a<=g&&a>=h})}return k.fromJSON(a)};e.prototype.readTilemapCache=function(a,b){return b.capabilities&&-1<b.capabilities.indexOf("Tilemap")?
new c({layer:this}):null};l([f.property({json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0);l([f.property()],e.prototype,"minScale",void 0);l([f.reader("service","minScale")],e.prototype,"readMinScale",null);l([f.property()],e.prototype,"maxScale",void 0);l([f.reader("service","maxScale")],e.prototype,"readMaxScale",null);l([f.property({type:b.SpatialReference})],e.prototype,"spatialReference",void 0);l([f.property({readOnly:!0,dependsOn:["version"]})],e.prototype,"supportsBlankTile",
null);l([f.property({type:k})],e.prototype,"tileInfo",void 0);l([f.reader("service","tileInfo",["tileInfo","minScale","maxScale"])],e.prototype,"readTileInfo",null);l([f.property()],e.prototype,"tilemapCache",void 0);l([f.reader("service","tilemapCache",["capabilities"])],e.prototype,"readTilemapCache",null);l([f.property()],e.prototype,"version",void 0);return e=l([f.subclass("esri.layers.mixins.ArcGISCachedService")],e)}(f.declared(e))})},"esri/layers/support/TilemapCache":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/io-query ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r){var y=a.getLogger("esri.layers.support.TilemapCache");return function(a){function e(b){b=a.call(this)||this;b._handles=new c;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2097152;b.request=f;return b}g(e,a);d=e;e.prototype.initialize=function(){var a=this;this._tilemapCache=new h(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],function(){return a._initializeTilemapDefinition()}),
u.init(this,"layer.tileInfo.lods",function(b){return a._initializeAvailableLevels(b)},!0)]);this._initializeTilemapDefinition()};e.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};e.prototype.castLevels=function(a){return 2>=a?(y.error("Minimum levels for Tilemap is 3, but got ",a),3):a};Object.defineProperty(e.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0});e.prototype.getTilemap=function(a,b,c){return this._tilemapFromCache(a,
b,c,this._tmpTilemapDefinition)};e.prototype.fetchTilemap=function(a,b,c,e){var d=this;if(!this._availableLevels[a])return n.reject(new k("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"));var f=this._tmpTilemapDefinition;if(a=this._tilemapFromCache(a,b,c,f))return n.resolve(a);var g=r.tilemapDefinitionId(f),h=this._pendingTilemapRequests[g];h||(h=r.Tilemap.fromDefinition(f,e).then(function(a){d._tilemapCache.put(g,a,a.byteSize);delete d._pendingTilemapRequests[g];return a}).catch(function(a){delete d._pendingTilemapRequests[g];
return n.reject(a)}),this._pendingTilemapRequests[g]=h);return n.create(function(a,b){h.then(a,b)})};e.prototype.getAvailability=function(a,b,c){return this._availableLevels[a]?(a=this.getTilemap(a,b,c))?a.getAvailability(b,c):"unknown":"unavailable"};e.prototype.getAvailabilityUpsample=function(a,b,c,e){e.level=a;e.row=b;e.col=c;a=this.layer.tileInfo;for(a.updateTileInfo(e);;)if(b=this.getAvailability(e.level,e.row,e.col),"unavailable"===b){if(!a.upsampleTile(e))return"unavailable"}else return b};
e.prototype.fetchAvailability=function(a,b,c,e){return this._availableLevels[a]?this.fetchTilemap(a,b,c,e).catch(function(a){return a}).then(function(e){return e instanceof r.Tilemap?(e=e.getAvailability(b,c),"unavailable"===e?n.reject(new k("tile-map:tile-unavailable","Tile is not available",{level:a,row:b,col:c})):e):e&&"cancel"===e.dojoType?n.reject(e):"unknown"}):n.reject(new k("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"))};e.prototype.fetchAvailabilityUpsample=
function(a,b,c,e,f){var g=this;e.level=a;e.row=b;e.col=c;var h=this.layer.tileInfo;h.updateTileInfo(e);var k=this.fetchAvailability(a,b,c,f).catch(function(a){return a&&"cancel"===a.dojoType?n.reject(a):h.upsampleTile(e)?g.fetchAvailabilityUpsample(e.level,e.row,e.col,e):n.reject(a)});if(k.isFulfilled())return k;var l={id:e.id,level:a,row:b,col:c};a=function(a){var b=m.fetchAvailability(l.level,l.row,l.col,f);d._prefetches.push(b);a=function(){return d._prefetches.removeUnordered(b)};k.then(function(){return b.cancel()},
function(){return b.cancel()});b.then(a,a)};var m=this;for(b=0;d._prefetches.length<d._maxPrefetch&&h.upsampleTile(l);++b)a(b);return k};e.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var a=this.layer.parsedUrl,c=a.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:a.path,query:c?b.objectToQuery(c):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};e.prototype._tilemapFromCache=
function(a,b,c,e){a=this._getTilemapDefinition(a,b,c,e);a=r.tilemapDefinitionId(a);return this._tilemapCache.get(a)};e.prototype._getTilemapDefinition=function(a,b,c,e){e.level=a;e.row=b-b%this.size;e.col=c-c%this.size;return e};e.prototype._initializeAvailableLevels=function(a){var b=this;this._availableLevels={};a&&a.forEach(function(a){return b._availableLevels[a.level]=!0})};var d;e._maxPrefetch=4;e._prefetches=new p({initialSize:d._maxPrefetch});l([v.property({constructOnly:!0,type:Number})],
e.prototype,"levels",void 0);l([v.cast("levels")],e.prototype,"castLevels",null);l([v.property({readOnly:!0,dependsOn:["levels"],type:Number})],e.prototype,"size",null);l([v.property({constructOnly:!0,type:Number})],e.prototype,"cacheByteSize",void 0);l([v.property({constructOnly:!0})],e.prototype,"layer",void 0);l([v.property({constructOnly:!0})],e.prototype,"request",void 0);return e=d=l([v.subclass("esri.layers.support.TilemapCache")],e)}(v.declared(e))})},"esri/core/LRUCache":function(){define(["require",
"exports","./MemCache"],function(t,d,q){return function(){function d(d,b){this._storage=new q.Storage;this._storage.maxSize=d;b&&this._storage.registerRemoveFunc("",b)}d.prototype.put=function(d,b,f){this._storage.put(d,b,f)};d.prototype.pop=function(d){return this._storage.pop(d)};d.prototype.get=function(d){return this._storage.get(d)};d.prototype.clear=function(){this._storage.clearAll()};d.prototype.destroy=function(){this._storage.clearAll()};return d}()})},"esri/layers/support/Tilemap":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/Error ../../core/lang ../../core/promiseUtils".split(" "),
function(t,d,q,g,l,b,f){function e(b){var c;"vector-tile"===b.service.type?c=b.service.url+"/tilemap/"+b.level+"/"+b.row+"/"+b.col+"/"+b.width+"/"+b.height:(c=b.service.tileServers,c=(c&&c.length?c[b.row%c.length]:b.service.url)+"/tilemap/"+b.level+"/"+b.row+"/"+b.col+"/"+b.width+"/"+b.height);(b=b.service.query)&&(c=c+"?"+b);return c}Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(){this.location={left:0,top:0,width:0,height:0};this.byteSize=40}d.prototype.getAvailability=
function(b,a){if(this._isAllAvailable)return"available";if(this._isAllUnvailable)return"unavailable";b=(b-this.location.top)*this.location.width+(a-this.location.left);a=b>>3;var c=this._tileAvailabilityBitSet;return 0>a||a>c.length?"unknown":c[a]&1<<b%8?"available":"unavailable"};d.prototype._updateFromData=function(b){for(var a=!0,c=!0,e=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),d=0,f=0;f<b.length;f++){var g=f%8;b[f]?(c=!1,e[d]|=1<<g):a=!1;7===g&&++d}this._isAllUnvailable=
c;this._isAllAvailable=a;this._isAllAvailable||this._isAllUnvailable||(this._tileAvailabilityBitSet=e,this.byteSize+=e.length)};d.fromDefinition=function(b,a){var c=b.service.request||g,k=b.row,n=b.col,u=b.width,v=b.height,r={query:{f:"json"}};a=a?q({},r,a):r;return c(e(b),a).then(function(a){return a.data}).catch(function(a){if(a&&a.details&&422===a.details.httpStatus){a=[];for(var b=0,c=u*v;b<c;b++)a[b]=0;return{location:{top:k,left:n,width:u,height:v},valid:!0,data:a}}return f.reject(a)}).then(function(a){if(a.location&&
(a.location.top!==k||a.location.left!==n||a.location.width!==u||a.location.height!==v))throw new l("tilemap:location-mismatch","Tilemap response for different location than requested",{response:a,definition:{top:k,left:n,width:u,height:v}});return d.fromJSON(a)})};d.fromJSON=function(c){d.validateJSON(c);var a=new d;a.location=Object.freeze(b.clone(c.location));a._updateFromData(c.data);return Object.freeze(a)};d.validateJSON=function(b){if(!b||!b.location)throw new l("tilemap:missing-location","Location missing from tilemap response");
if(!1===b.valid)throw new l("tilemap:invalid","Tilemap response was marked as invalid");if(!b.data)throw new l("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(b.data))throw new l("tilemap:data-mismatch","Data must be an array of numbers");if(b.data.length!==b.location.width*b.location.height)throw new l("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return d}();d.Tilemap=t;d.tilemapDefinitionId=function(b){return b.level+"/"+
b.row+"/"+b.col+"/"+b.width+"/"+b.height};d.tilemapDefinitionUrl=e;d.default=t})},"esri/layers/TileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/io-query ../geometry ../request ../core/Error ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayers ./support/arcgisLayerUrl ./support/commonProperties".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C){var B="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");return function(d){function m(a,b){a=d.call(this)||
this;a.listMode="show";a.resampling=!0;a.spatialReference=null;a.path=null;a.sublayers=null;a.type="tile";a.url=null;return a}g(m,d);m.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?q({url:a},b):a};m.prototype.load=function(){var a=this;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service","Map Service"]}).then(function(){return a._fetchService()},function(){return a._fetchService()}));return this.when()};Object.defineProperty(m.prototype,"attributionDataUrl",
{get:function(){return this._getDefaultAttribution(this._getMapName(this.parsedUrl.path.toLowerCase()))},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"operationalLayerType",{get:function(){if(this.capabilities)return this.capabilities.operations.supportsExportMap?"ArcGISTiledMapServiceLayer":"ArcGISTiledImageServiceLayer";var a=this.url||this.portalItem&&this.portalItem.url;return a&&/\/ImageServer(\/|\/?$)/i.test(a)?"ArcGISTiledImageServiceLayer":"ArcGISTiledMapServiceLayer"},
enumerable:!0,configurable:!0});m.prototype.readSpatialReference=function(a,b){return(a=a||b.tileInfo&&b.tileInfo.spatialReference)&&f.SpatialReference.fromJSON(a)};Object.defineProperty(m.prototype,"tileServers",{get:function(){return this._getDefaultTileServers(this.parsedUrl.path)},enumerable:!0,configurable:!0});m.prototype.castTileServers=function(b){return Array.isArray(b)?b.map(function(b){return a.urlToObject(b).path}):null};m.prototype.fetchTile=function(a,b,c,d){a=this.getTileUrl(a,b,c);
b={responseType:"image"};d&&d.timestamp&&(b.query={_ts:d.timestamp});return e(a,b).then(function(a){return a.data})};m.prototype.getTileUrl=function(a,c,e){var d=b.objectToQuery(q({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null})),f=this.tileServers;return(f&&f.length?f[c%f.length]:this.parsedUrl.path)+"/tile/"+a+"/"+c+"/"+e+(d?"?"+d:"")};m.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return c.create(function(a){return t(["../views/2d/layers/TileLayerView2D"],
a)});case "3d":return c.create(function(a){return t(["../views/3d/layers/TileLayerView3D"],a)})}};m.prototype._fetchService=function(){var a=this;return c.create(function(b,c){if(a.resourceInfo)b({data:a.resourceInfo});else{if(!a.parsedUrl)return c(new k("tile-layer:undefined-url","layer's url is not defined"));e(a.parsedUrl.path,{query:q({f:"json"},a.parsedUrl.query),responseType:"json"}).then(b,c)}}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));a.read(b.data,{origin:"service",
url:a.parsedUrl});if(10.1===a.version&&!A.isHostedAgolService(a.url))return x.fetchServerVersion(a.url).then(function(b){a.read({currentVersion:b})}).catch(function(){})})};m.prototype._getMapName=function(a){return(a=a.match(/^(?:https?:)?\/\/(server|services)\.arcgisonline\.com\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&a[2]};m.prototype._getDefaultAttribution=function(b){if(b){var c;b=b.toLowerCase();for(var e=0,d=B.length;e<d;e++)if(c=B[e],-1<c.toLowerCase().indexOf(b))return a.makeAbsolute("//static.arcgis.com/attribution/"+
c)}};m.prototype._getDefaultTileServers=function(a){var b=-1!==a.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),c=-1!==a.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return b||c?[a,a.replace(b?/server\.arcgisonline/i:/services\.arcgisonline/i,b?"services.arcgisonline":"server.arcgisonline")]:[]};l([h.property({readOnly:!0,dependsOn:["parsedUrl"]})],m.prototype,"attributionDataUrl",null);l([h.property({type:["show","hide","hide-children"]})],m.prototype,"listMode",void 0);l([h.property({readOnly:!0})],
m.prototype,"operationalLayerType",null);l([h.property()],m.prototype,"popupTemplates",void 0);l([h.property({type:Boolean})],m.prototype,"resampling",void 0);l([h.property()],m.prototype,"resourceInfo",void 0);l([h.property({type:f.SpatialReference})],m.prototype,"spatialReference",void 0);l([h.reader("spatialReference",["spatialReference","tileInfo"])],m.prototype,"readSpatialReference",null);l([h.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],m.prototype,"path",
void 0);l([h.property({readOnly:!0})],m.prototype,"sublayers",void 0);l([h.property({dependsOn:["parsedUrl"]})],m.prototype,"tileServers",null);l([h.cast("tileServers")],m.prototype,"castTileServers",null);l([h.property({readOnly:!0,json:{read:!1}})],m.prototype,"type",void 0);l([h.property(C.url)],m.prototype,"url",void 0);return m=l([h.subclass("esri.layers.TileLayer")],m)}(h.declared(p,m.default,u,n,w,v,r,y))})},"esri/layers/mixins/SublayersOwner":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v){function r(a,b,c){var e=[],d={};a.forEach(function(a){var f=new u;f.read(a,b);c&&(-1===c.indexOf(f.id)?f.visible=!1:f.visible=!0);d[f.id]=f;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=d[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(f)):e.unshift(f)});return e}function y(a,b){var e=b.get(a.id);e?(c.mixin(a.__accessor__.store._values,e.__accessor__.store._values),e.__accessor__.overridden&&(a.__accessor__.overridden=c.mixin(a.__accessor__.overridden||
{},e.__accessor__.overridden)),e.sublayers&&(a.sublayers=e.sublayers.map(function(a){return y(a,b)}))):a.sublayers&&a.sublayers.forEach(function(a){return y(a,b)});return a}Object.defineProperty(d,"__esModule",{value:!0});var w=a.getLogger("esri.layers.TileLayer");t=function(a){function b(){var b=a.call(this)||this;b.allSublayers=new e({root:b,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});b.watch("sublayers",function(a,c){return b._handleSublayersChange(a,
c)},!0);return b}g(b,a);b.prototype.readServiceSublayers=function(a,b,c){return r(b.layers,c)};b.prototype.readSublayersFromItemOrWebMap=function(a,b,c){return!b.layers&&b.visibleLayers?b.visibleLayers.map(function(a){return{id:a}}):r(b.layers,c,b.visibleLayers)};b.prototype.readSublayers=function(a,b,c){a=r(b.layers,c);this._updateSublayersForOrigin(n.OriginId.PORTAL_ITEM,a);this._updateSublayersForOrigin(n.OriginId.WEB_MAP,a);this._updateSublayersForOrigin(n.OriginId.WEB_SCENE,a);return a};b.prototype.writeSublayers=
function(a,b,c,e){a=a.flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray().reverse();var d=this.serviceSublayers.flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray().reduce(function(a,b){a.set(b.id,b);return a},new Map),f=!1,g=!0;this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers?(f=v.isExportDynamic(a,this.serviceSublayers,this),g=!f&&v.sameStructureAsService(a,this.serviceSublayers)):
g=v.sameStructureAsService(a,this.serviceSublayers);b.layers=[];a.forEach(function(a){var c=d.get(a.id),c=q({writeAsDynamic:f,writeOverridesOnly:g,serviceSublayer:c},e);a=a.write({},c);(!g||g&&1<Object.keys(a).length)&&b.layers.push(a)});b.visibleLayers=a.filter(function(a){return a.visible}).map(function(a){return a.id})};b.prototype.findSublayerById=function(a){return this.allSublayers.find(function(b){return b.id===a})};b.prototype.createServiceSublayers=function(){return this.serviceSublayers.map(function(a){return a.clone()})};
b.prototype._updateSublayersForOrigin=function(a,b){var c=this.__accessor__.store;if(c.has("sublayers",a)){var e=c.get("sublayers",a).flatten(function(a){return a.sublayers});if(e.every(function(a){return!a.__accessor__.store._values.hasOwnProperty("minScale")})){var d=e.reduce(function(a,b){a.set(b.id,b);return a},new Map);b=b.map(function(a){return y(a.clone(),d)});c.set("sublayers",new (f.ofType(u))(b),a)}}};b.prototype._handleSublayersChange=function(a,b){var c=this;b&&(b.forEach(function(a){a.parent=
null;a.layer=null}),this._sublayersHandles.forEach(function(a){return a.remove()}),this._sublayersHandles=null);a&&(a.forEach(function(a){a.parent=c;a.layer=c}),this._sublayersHandles=[a.on("after-add",function(a){a=a.item;a.parent=c;a.layer=c}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})],"tile"===this.type&&this._sublayersHandles.push(a.on("before-changes",function(a){w.error(new k("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",
{layer:c}));a.preventDefault()})))};l([h.property({readOnly:!0})],b.prototype,"allSublayers",void 0);l([h.property({readOnly:!0,type:f.ofType(u)})],b.prototype,"serviceSublayers",void 0);l([h.reader("service","serviceSublayers",["layers"])],b.prototype,"readServiceSublayers",null);l([h.property({value:null,type:f.ofType(u),json:{type:[Number],write:{target:"subLayerIds",allowNull:!0}}})],b.prototype,"sublayers",void 0);l([h.reader(["web-map","web-scene","portal-item"],"sublayers",["layers","visibleLayers"])],
b.prototype,"readSublayersFromItemOrWebMap",null);l([h.reader("service","sublayers",["layers"])],b.prototype,"readSublayers",null);l([h.writer(["web-map","web-scene","portal-item"],"sublayers",{layers:{type:[u]},visibleLayers:{type:[p.Integer]}})],b.prototype,"writeSublayers",null);return b=l([h.subclass("esri.layers.mixins.SublayersOwner")],b)}(h.declared(b));d.default=t})},"esri/layers/support/Sublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper dojo/io-query ../../PopupTemplate ../../renderers ../../symbols ../../core/Collection ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/accessorSupport/write ./commonProperties ./LabelClass ./layerSourceUtils ../../renderers/support/jsonUtils ../../tasks/support/Query".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E){var I=v.getLogger("esri.layers.support.Sublayer"),G=0;return function(d){function n(){var a=null!==d&&d.apply(this,arguments)||this;a._sublayersHandles=null;return a}q(n,d);v=n;Object.defineProperty(n.prototype,"definitionExpression",{get:function(){return this._get("definitionExpression")},set:function(a){this._setAndNotifyLayer("definitionExpression",a)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"id",{get:function(){var a=
this._get("id");return null==a?G++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id"):this._set("id",a))},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"labelingInfo",{get:function(){return this._get("labelingInfo")},set:function(a){this._setAndNotifyLayer("labelingInfo",a)},enumerable:!0,configurable:!0});n.prototype.writeLabelingInfo=function(a,b,c,e){(!e||e.writeAsDynamic)&&a&&a.length&&(b.layerDefinition=
{drawingInfo:{labelingInfo:a.map(function(a){return a.write({},e)})}})};Object.defineProperty(n.prototype,"labelsVisible",{get:function(){return this._get("labelsVisible")},set:function(a){this._setAndNotifyLayer("labelsVisible",a)},enumerable:!0,configurable:!0});n.prototype.writeLabelsVisible=function(a,b,c,e){if(!e||e.writeAsDynamic)b.showLabels=a};Object.defineProperty(n.prototype,"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(b){return b.layer=a})},
enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"legendEnabled",{get:function(){return this._get("legendEnabled")},set:function(a){this._set("legendEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"listMode",{get:function(){return this._get("listMode")},set:function(a){this._set("listMode",a)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"minScale",{get:function(){return this._get("minScale")},set:function(a){this._setAndNotifyLayer("minScale",
a)},enumerable:!0,configurable:!0});n.prototype.readMinScale=function(a,b){return b.minScale||b.layerDefinition&&b.layerDefinition.minScale||0};n.prototype.writeMinScale=function(a,b,c,e){if(e&&e.writeOverridesOnly&&(c=e&&e.serviceSublayer)&&c.minScale===a&&c.maxScale===this.maxScale)return;b.minScale=a};Object.defineProperty(n.prototype,"maxScale",{get:function(){return this._get("maxScale")},set:function(a){this._setAndNotifyLayer("maxScale",a)},enumerable:!0,configurable:!0});n.prototype.readMaxScale=
function(a,b){return b.maxScale||b.layerDefinition&&b.layerDefinition.maxScale||0};n.prototype.writeMaxScale=function(a,b,c,e){if(e&&e.writeOverridesOnly&&(c=e&&e.serviceSublayer)&&c.maxScale===a&&c.minScale===this.minScale)return;b.maxScale=a};Object.defineProperty(n.prototype,"opacity",{get:function(){return this._get("opacity")},set:function(a){this._setAndNotifyLayer("opacity",a)},enumerable:!0,configurable:!0});n.prototype.readOpacity=function(a,b){a=b.layerDefinition;return 1-.01*(null!=a.transparency?
a.transparency:a.drawingInfo.transparency)};n.prototype.writeOpacity=function(a,b,c,e){if(!e||e.writeAsDynamic)b.layerDefinition={drawingInfo:{transparency:100-100*a}}};n.prototype.writeParent=function(a,b,c,e){e&&e.writeOverridesOnly||(b.parentLayerId=this.parent&&this.parent!==this.layer?this.parent.id:-1)};Object.defineProperty(n.prototype,"popupEnabled",{get:function(){return this._get("popupEnabled")},set:function(a){this._set("popupEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,
"popupTemplate",{get:function(){return this._get("popupTemplate")},set:function(a){this._set("popupTemplate",a)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"renderer",{get:function(){return this._get("renderer")},set:function(b){if(b)for(var c=0,e=b.getSymbols();c<e.length;c++)if(a.isSymbol3D(e[c])){I.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",b)},enumerable:!0,configurable:!0});n.prototype.readRenderer=function(a,b,c){if(a=b.layerDefinition.drawingInfo.renderer||
void 0)(a=B.read(a,b,c)||void 0)||I.error("Failed to create renderer",{rendererDefinition:b.drawingInfo.renderer,layer:this,context:c});return a};n.prototype.writeRenderer=function(a,b,c,e){if(!e||e.writeAsDynamic)b.layerDefinition={drawingInfo:{renderer:a.toJSON()}}};Object.defineProperty(n.prototype,"source",{get:function(){return this._get("source")||{mapLayerId:this.id,type:C.MAPLAYER}},set:function(a){this._setAndNotifyLayer("source",a)},enumerable:!0,configurable:!0});n.prototype.writeSource=
function(a,b,c,e){e&&!e.writeAsDynamic&&e.writeOverridesOnly||(b.layerDefinition={source:C.sourceToJSON(a)})};Object.defineProperty(n.prototype,"sublayers",{set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)},enumerable:!0,configurable:!0});n.prototype.castSublayers=function(a){return w.default(h.ofType(v),a)};n.prototype.writeSublayers=function(a,b,c,e){e&&e.writeOverridesOnly||(b[c]=this.get("sublayers.length")?this.sublayers.map(function(a){return a.id}).toArray().reverse():
null)};Object.defineProperty(n.prototype,"title",{get:function(){return this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});n.prototype.writeTitle=function(a,b,c,e){if(e&&e.writeOverridesOnly&&(e=e&&e.serviceSublayer)&&e.title===a)return;b[c]=a};Object.defineProperty(n.prototype,"url",{get:function(){var a=this.layer,b=this.source;if(!a)return null;if(C.isMapLayerSource(b))return a.parsedUrl.path+"/"+b.mapLayerId;b={layer:JSON.stringify({source:C.sourceToJSON(this.source)})};
return a.parsedUrl.path+"/dynamicLayer?"+e.objectToQuery(b)},set:function(a){a?this._override("url",a):this._clearOverride("url")},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"visible",{get:function(){return this._get("visible")},set:function(a){this._setAndNotifyLayer("visible",a)},enumerable:!0,configurable:!0});n.prototype.writeVisible=function(a,b,c,e){if(e&&e.writeOverridesOnly&&(e=e&&e.serviceSublayer)&&e.visible===a)return;b[c]=a};n.prototype.clone=function(){var a=new v;
this.hasOwnProperty("definitionExpression")&&(a.definitionExpression=this.definitionExpression);this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("labelingInfo")&&(a.labelingInfo=u.clone(this.labelingInfo));this.hasOwnProperty("labelsVisible")&&(a.labelsVisible=this.labelsVisible);this.hasOwnProperty("legendEnabled")&&(a.legendEnabled=this.legendEnabled);this.hasOwnProperty("visible")&&(a.visible=this.visible);this.hasOwnProperty("layer")&&(a.layer=this.layer);this.hasOwnProperty("minScale")&&
(a.minScale=this.minScale);this.hasOwnProperty("maxScale")&&(a.maxScale=this.maxScale);this.hasOwnProperty("opacity")&&(a.opacity=this.opacity);this.hasOwnProperty("parent")&&(a.parent=this.parent);this.hasOwnProperty("popupEnabled")&&(a.popupEnabled=this.popupEnabled);this.hasOwnProperty("popupTemplate")&&(a.popupTemplate=this.popupTemplate?this.popupTemplate.clone():this.popupTemplate);this.hasOwnProperty("renderer")&&(a.renderer=this.renderer?this.renderer.clone():this.renderer);this.hasOwnProperty("source")&&
(a.source=u.clone(this.source));this.hasOwnProperty("sublayers")&&(a.sublayers=this.sublayers?this.sublayers.clone():this.sublayers);this.hasOwnProperty("title")&&(a.title=this.title);return a};n.prototype.createQuery=function(){return new E({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};n.prototype.createFeatureLayer=function(){return f(this,void 0,void 0,function(){var a,c,e,d,f;return b(this,function(b){switch(b.label){case 0:if(this.hasOwnProperty("sublayers"))return[2,null];
a=this.layer&&this.layer.parsedUrl;c=this.source;e=null;a&&(e=C.isMapLayerSource(c)?a.path+"/"+c.mapLayerId:a.path+"/dynamicLayer");return[4,r.create(function(a){return t(["../FeatureLayer"],a)})];case 1:return d=b.sent(),f=new d({url:e}),this.hasOwnProperty("definitionExpression")&&(f.definitionExpression=this.definitionExpression),this.hasOwnProperty("labelingInfo")&&(f.labelingInfo=u.clone(this.labelingInfo)),this.hasOwnProperty("labelsVisible")&&(f.labelsVisible=this.labelsVisible),this.hasOwnProperty("legendEnabled")&&
(f.legendEnabled=this.legendEnabled),this.hasOwnProperty("visible")&&(f.visible=this.visible),this.hasOwnProperty("minScale")&&(f.minScale=this.minScale),this.hasOwnProperty("maxScale")&&(f.maxScale=this.maxScale),this.hasOwnProperty("opacity")&&(f.opacity=this.opacity),this.hasOwnProperty("popupTemplate")&&(f.popupTemplate=this.popupTemplate?this.popupTemplate.clone():this.popupTemplate),this.hasOwnProperty("renderer")&&(f.renderer=this.renderer?this.renderer.clone():this.renderer),this.hasOwnProperty("source")&&
C.isDataLayerSource(this.source)&&(f.dynamicDataSource=u.clone(this.source)),this.hasOwnProperty("title")&&(f.title=this.title),[2,f]}})})};n.prototype.queryFeatures=function(a){var b=this;void 0===a&&(a=this.createQuery());return r.all([r.create(function(a){return t(["../../tasks/operations/query"],a)}),r.create(function(a){return t(["../../tasks/support/FeatureSet"],a)})]).then(function(c){var e=c[0].executeQuery,d=c[1];return e(b.url,a).then(function(a){return d.fromJSON(a.data)})}).then(function(a){a&&
a.features&&a.features.forEach(function(a){a.sourceLayer=b});return a})};n.prototype.toExportImageJSON=function(){var a={id:this.id,source:C.sourceToJSON(this.source)};this.definitionExpression&&(a.definitionExpression=this.definitionExpression);if(this.renderer||this.labelingInfo||null!=this.opacity||null!=this.labelsVisible){var b=a.drawingInfo={};this.renderer&&(b.renderer=this.renderer.toJSON());null!=this.labelsVisible&&(b.showLabels=this.labelsVisible);!1!==this.labelsVisible&&this.labelingInfo&&
(b.labelingInfo=this.labelingInfo.map(function(a){return a.write({},{origin:"service"})}),b.showLabels=!0);null!=this.opacity&&(b.transparency=100-100*this.opacity)}return a};n.prototype._setAndNotifyLayer=function(a,b){var c=this.layer,e=this._get(a),d;switch(a){case "definitionExpression":d="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":d="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":d=
"supportsDynamicLayers"}d&&!1===this.get("layer.capabilities.exportMap."+d)?this._logLockedError(a):(this._set(a,b),e!==b&&c&&c.emit&&c.emit("sublayer-update",{propertyName:a}))};n.prototype._handleSublayersChange=function(a,b){var c=this;b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this._sublayersHandles.forEach(function(a){return a.remove()}),this._sublayersHandles=null);a&&(a.forEach(function(a){a.parent=c;a.layer=c.layer}),this._sublayersHandles=[a.on("after-add",function(a){a=a.item;
a.parent=c;a.layer=c.layer}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null}),a.on("before-changes",function(a){var b=c.get("layer.capabilities.exportMap.supportsSublayersChanges");null==b||b||(I.error(new p("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:c})),a.preventDefault())})])};n.prototype._logLockedError=function(a){I.error(new p("sublayer:locked","Property '"+a+"' can't be changed on Sublayer from the layer '"+
this.layer.id+"'",{sublayer:this,layer:this.layer}))};var v;g([y.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],n.prototype,"definitionExpression",null);g([y.property({type:Number,json:{write:{ignoreOrigin:!0}}})],n.prototype,"id",null);g([y.property({value:null,type:[A],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],n.prototype,
"labelingInfo",null);g([y.writer("labelingInfo")],n.prototype,"writeLabelingInfo",null);g([y.property({type:Boolean,json:{read:{source:"showLabels"},write:{target:"showLabels"}}})],n.prototype,"labelsVisible",null);g([y.writer("labelsVisible")],n.prototype,"writeLabelsVisible",null);g([y.property({value:null})],n.prototype,"layer",null);g([y.property(x.legendEnabled)],n.prototype,"legendEnabled",null);g([y.property({type:["show","hide","hide-children"],value:"show",json:{write:!0}})],n.prototype,
"listMode",null);g([y.property({type:Number,value:0,json:{write:{overridePolicy:function(a,b,c){if(m.willPropertyWrite(this,"maxScale",{},c))return{ignoreOrigin:!0}}}}})],n.prototype,"minScale",null);g([y.reader("portal-item","minScale",["minScale","layerDefinition.minScale"])],n.prototype,"readMinScale",null);g([y.writer("minScale")],n.prototype,"writeMinScale",null);g([y.property({type:Number,value:0,json:{write:{overridePolicy:function(a,b,c){if(m.willPropertyWrite(this,"minScale",{},c))return{ignoreOrigin:!0}}}}})],
n.prototype,"maxScale",null);g([y.reader("portal-item","maxScale",["maxScale","layerDefinition.maxScale"])],n.prototype,"readMaxScale",null);g([y.writer("maxScale")],n.prototype,"writeMaxScale",null);g([y.property({type:Number,json:{write:{target:"layerDefinition.drawingInfo.transparency"}}})],n.prototype,"opacity",null);g([y.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],n.prototype,"readOpacity",null);g([y.writer("opacity")],n.prototype,"writeOpacity",
null);g([y.property({json:{type:Number,write:{target:"parentLayerId",allowNull:!0}}})],n.prototype,"parent",void 0);g([y.writer("parent")],n.prototype,"writeParent",null);g([y.property(x.popupEnabled)],n.prototype,"popupEnabled",null);g([y.property({value:null,type:k,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],n.prototype,"popupTemplate",null);g([y.property({types:c.rendererTypes,value:null,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],n.prototype,"renderer",null);
g([y.reader("renderer",["layerDefinition.drawingInfo.renderer"])],n.prototype,"readRenderer",null);g([y.writer("renderer")],n.prototype,"writeRenderer",null);g([y.property({cast:C.castSource,json:{read:{source:"layerDefinition.source",reader:C.sourceFromJSON},write:{target:"layerDefinition.source"}}})],n.prototype,"source",null);g([y.writer("source")],n.prototype,"writeSource",null);g([y.property({value:null,json:{type:[w.Integer],write:{target:"subLayerIds",allowNull:!0}}})],n.prototype,"sublayers",
null);g([y.cast("sublayers")],n.prototype,"castSublayers",null);g([y.writer("sublayers")],n.prototype,"writeSublayers",null);g([y.property({type:String,value:null,json:{read:{source:"name"},write:{target:"name",allowNull:!0,ignoreOrigin:!0}}})],n.prototype,"title",null);g([y.writer("title")],n.prototype,"writeTitle",null);g([y.property({type:String,dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:function(){return{enabled:this._isOverridden("url")}}}}})],
n.prototype,"url",null);g([y.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility"}}})],n.prototype,"visible",null);g([y.writer("visible")],n.prototype,"writeVisible",null);g([l(0,y.cast(E))],n.prototype,"queryFeatures",null);return n=v=g([y.subclass("esri.layers.support.Sublayer")],n)}(y.declared(n))})},"esri/layers/support/sublayerUtils":function(){define(["require","exports","./layerSourceUtils"],function(t,d,q){function g(d,b){function f(a){var b=
a.sublayers;e.unshift(a.id);b&&b.forEach(f)}if(!d||!d.length)return!0;var e=[];b.forEach(f);if(d.length>e.length)return!1;b=0;for(var g=e.length,c=0;c<d.length;c++){for(var a=d[c].id;b<g&&e[b]!==a;)b++;if(b>=g)return!1}return!0}Object.defineProperty(d,"__esModule",{value:!0});d.isExportDynamic=function(d,b,f){return d.some(function(b){var e=b.source;return!(!e||e.type===q.MAPLAYER&&e.mapLayerId===b.id&&(!e.gdbVersion||e.gdbVersion===f.gdbVersion))||null!=b.renderer||null!=b.labelingInfo||b.hasOwnProperty("opacity")&&
null!=b.opacity||b.hasOwnProperty("labelsVisible")&&null!=b.labelsVisible})?!0:!g(d,b)};d.sameStructureAsService=function(d,b){return b.flatten(function(b){return(b=b.sublayers)&&b.toArray().reverse()}).toArray().reverse().every(function(b,e){return(e=d[e])&&b.id===e.id&&(null==b.sublayers&&null==e.sublayers||null!=b.sublayers&&null!=e.sublayers&&b.sublayers.map(function(b){return b.id}).join(",")===e.sublayers.map(function(b){return b.id}).join(","))})}})},"esri/layers/support/arcgisLayers":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/Error ../../core/promiseUtils ./arcgisLayerUrl ./arcgisLayerUrl ./lazyLayerLoader".split(" "),
function(t,d,q,g,l,b,f,e,k){function c(a,b){return a.sublayerIds.map(function(c){return new a.Constructor(q({},b,{layerId:c,sublayerTitleMode:"service-name"}))})}function a(a){var c=e.parse(a);if(!c)return b.reject(new l("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:a}));var d=c.serverType,f=c.sublayer,g={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(d){case "MapServer":d=null!=f?"FeatureLayer":p(a).then(function(a){return a?
"TileLayer":"MapImageLayer"});break;case "ImageServer":d=n(a).then(function(a){var b=a.tileInfo&&a.tileInfo.format;return a.tileInfo?b&&"LERC"===b.toUpperCase()&&a.cacheType&&"elevation"===a.cacheType.toLowerCase()?"ElevationLayer":"TileLayer":"ImageryLayer"});break;case "SceneServer":d=n(c.url.path).then(function(a){var b={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};return a&&Array.isArray(a.layers)&&
0<a.layers.length&&(a=a.layers[0].layerType,null!=b[a])?b[a]:"SceneLayer"});break;default:d=g[d]}var m={FeatureLayer:!0,SceneLayer:!0},u={parsedUrl:c,Constructor:null,sublayerIds:null},q;return b.when(d).then(function(b){q=b;if(m[b]&&null==f)return h(a).then(function(a){1!==a.length&&(u.sublayerIds=a)})}).then(function(){return(0,k.layerLookupMap[q])()}).then(function(a){u.Constructor=a;return u})}function h(a){return n(a).then(function(a){return a&&Array.isArray(a.layers)?a.layers.map(function(a){return a.id}).reverse():
[]})}function p(a){return n(a).then(function(a){return a.tileInfo})}function n(a){return g(a,{responseType:"json",query:{f:"json"}}).then(function(a){return a.data})}Object.defineProperty(d,"__esModule",{value:!0});d.fromUrl=function(e){return a(e.url).then(function(a){var d=q({},e.properties,{url:e.url});return a.sublayerIds?b.create(function(a){return t(["../GroupLayer"],a)}).then(function(e){var f=new e({title:a.parsedUrl.title});c(a,d).forEach(function(a){return f.add(a)});return b.resolve(f)}):
b.resolve(new a.Constructor(d))})};d.fetchServerVersion=function(a){if(!f.test(a))return b.reject();a=a.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return g(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data&&a.data.currentVersion?a.data.currentVersion:b.reject()})}})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../core/global ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/SpriteSource ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/vectorTiles/SchemaHelper ../views/vectorTiles/style/StyleRepository".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G){return function(d){function k(a,b){a=d.call(this)||this;a._spriteSourceMap=new Map;a.currentStyleInfo=null;a.style=null;a.operationalLayerType="VectorTileLayer";a.type="vector-tile";a.url=null;return a}g(k,d);k.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?q({url:a},b):a};k.prototype.load=function(){var a=this,c=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1}).then(function(){if(a.portalItem&&
a.portalItem.id){var c=a.portalItem.itemUrl+"/resources/styles/root.json";return b(c,{query:{f:"json"}}).then(function(b){b.data&&a.read({url:c},E.createForItem(a.portalItem))})}}).then(function(){return a.loadStyle()},function(){return a.loadStyle()});this.addResolvingPromise(c);return this.when()};Object.defineProperty(k.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&h.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):null},enumerable:!0,
configurable:!0});Object.defineProperty(k.prototype,"capabilities",{get:function(){var a=this._getPrimarySource();return a?a.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"fullExtent",{get:function(){var a=this._getPrimarySource();return a?a.fullExtent:null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"parsedUrl",{get:function(){return this.serviceUrl?a.urlToObject(this.serviceUrl):
null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,
configurable:!0});k.prototype.writeStyleUrl=function(a,b){a&&h.isProtocolRelative(a)&&(a="https:"+a);b.styleUrl=a};Object.defineProperty(k.prototype,"tileIndexType",{get:function(){var a=this._getPrimarySource();return a?a.type:""},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"tileIndexUrl",{get:function(){var a=this._getPrimarySource();return a?a.tileMapURL:""},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"tileInfo",{get:function(){var a=this._getPrimarySource();
return a?a.tileInfo:null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"tilemapCache",{get:function(){var a=this._getPrimarySource();return a?a.capabilities.operations.supportsTileMap?a.tilemapCache:null:null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"tileServers",{get:function(){var a=this._getPrimarySource();return a?a.tileServers:[]},enumerable:!0,configurable:!0});k.prototype.readVersion=function(a,b){return b.version?parseFloat(b.version):parseFloat(b.currentVersion)};
k.prototype.readCompatibleTileInfo256=function(a,b){return A.fromJSON(I.create256x256CompatibleTileInfo(b.tileInfo))};k.prototype.readCompatibleTileInfo512=function(a,b){return A.fromJSON(I.create512x512CompatibleTileInfo(b.tileInfo))};k.prototype.loadSpriteSource=function(a){void 0===a&&(a=1);if(!this._spriteSourceMap.has(a)){var b=new x.default(this.styleRepository.sprite,a);this._spriteSourceMap.set(a,b.load())}var e=this._spriteSourceMap.get(a);return c.create(function(a,b){e.then(a,b)})};k.prototype.loadStyle=
function(a){var b=this;a=a||this.style||this.url;if(this._loadingPromise&&"string"===typeof a&&this.url===a)return this._loadingPromise;var c=this._loadingPromise;this._loadingPromise=this._getSourceAndStyle(a).then(function(){b.loadSpriteSource(e.devicePixelRatio||1)});c&&!c.isFulfilled()&&c.cancel();return this._loadingPromise};k.prototype.getStyleLayerId=function(a){return this.styleRepository.getStyleLayerId(a)};k.prototype.getPaintProperties=function(a){return this.styleRepository.getPaintProperties(a)};
k.prototype.setPaintProperties=function(a,b){a=this.styleRepository.setPaintProperties(a,b);this.emit("paint-change",{layer:a,paint:b})};k.prototype.getLayoutProperties=function(a){return this.styleRepository.getLayoutProperties(a)};k.prototype.setLayoutProperties=function(a,b){a=this.styleRepository.setLayoutProperties(a,b);this.emit("layout-change",{layer:a,layout:b})};k.prototype.getTileUrl=function(a,b,c){var e=this.tileServers[b%this.tileServers.length];return e=e.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,
b.toString()).replace(/\{x\}/gi,c.toString())};k.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?(b.messages&&b.messages.push(new f("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};k.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return c.create(function(a){return t(["../views/2d/layers/VectorTileLayerView2D"],a)});case "3d":return c.create(function(a){return t(["../views/3d/layers/VectorTileLayerView3D"],
a)})}};k.prototype._getSourceAndStyle=function(a){var b=this;return a?B.loadMetadata(a).then(function(c){b._set("currentStyleInfo",{serviceUrl:c.serviceUrl,styleUrl:c.styleUrl,spriteUrl:c.spriteUrl,glyphsUrl:c.glyphsUrl,style:c.style,layerDefinition:c.layerDefinition});"string"===typeof a?(b.url=a,b.style=null):(b.url=null,b.style=a);b._set("sourceNameToSource",c.sourceNameToSource);b._set("primarySourceName",c.primarySourceName);b._set("styleRepository",new G(c.style,c));b.read(c.layerDefinition,
{origin:"service"})}):c.reject(Error("invalid style!"))};k.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);if(b&&(a=b[3]&&b[3].toLowerCase()))for(var b=b[2]||"",c=0,e="OpenStreetMap_v2 OpenStreetMap_Export_v2 OpenStreetMap_FTS_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84".split(" ");c<
e.length;c++){var d=e[c];if(-1<d.toLowerCase().indexOf(a))return h.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+d)}};k.prototype._getPrimarySource=function(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?this.sourceNameToSource[this.primarySourceName]:null};l([p.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],k.prototype,"attributionDataUrl",null);l([p.property({type:["show","hide"]})],k.prototype,"listMode",void 0);l([p.property({json:{read:!1},
readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],k.prototype,"capabilities",null);l([p.property({readOnly:!0})],k.prototype,"currentStyleInfo",void 0);l([p.property({json:{read:!1},readOnly:!0,type:n,dependsOn:["sourceNameToSource","primarySourceName"]})],k.prototype,"fullExtent",null);l([p.property()],k.prototype,"style",void 0);l([p.property({type:["VectorTileLayer"]})],k.prototype,"operationalLayerType",void 0);l([p.property({readOnly:!0,dependsOn:["serviceUrl"]})],k.prototype,
"parsedUrl",null);l([p.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],k.prototype,"serviceUrl",null);l([p.property({type:u,dependsOn:["tileInfo"],readOnly:!0})],k.prototype,"spatialReference",null);l([p.property({readOnly:!0})],k.prototype,"styleRepository",void 0);l([p.property({readOnly:!0})],k.prototype,"sourceNameToSource",void 0);l([p.property({readOnly:!0})],k.prototype,"primarySourceName",void 0);l([p.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},
origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],k.prototype,"styleUrl",null);l([p.writer(["portal-item","web-document"],"styleUrl")],k.prototype,"writeStyleUrl",null);l([p.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],k.prototype,"tileIndexType",null);l([p.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],k.prototype,"tileIndexUrl",null);l([p.property({json:{read:!1},readOnly:!0,type:A,dependsOn:["sourceNameToSource",
"primarySourceName"]})],k.prototype,"tileInfo",null);l([p.property({json:{read:!1},readOnly:!0,type:C,dependsOn:["sourceNameToSource","primarySourceName"]})],k.prototype,"tilemapCache",null);l([p.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],k.prototype,"tileServers",null);l([p.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],k.prototype,"type",void 0);l([p.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},
write:!1,read:!1}})],k.prototype,"url",void 0);l([p.property({readOnly:!0})],k.prototype,"version",void 0);l([p.reader("version",["version","currentVersion"])],k.prototype,"readVersion",null);l([p.property({readOnly:!0})],k.prototype,"compatibleTileInfo256",void 0);l([p.reader("compatibleTileInfo256",["tileInfo"])],k.prototype,"readCompatibleTileInfo256",null);l([p.property({readOnly:!0})],k.prototype,"compatibleTileInfo512",void 0);l([p.reader("compatibleTileInfo512",["tileInfo"])],k.prototype,"readCompatibleTileInfo512",
null);return k=l([p.subclass("esri.layers.VectorTileLayer")],k)}(p.declared(v,y,w,m,k,r))})},"esri/layers/support/SpriteSource":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/promiseUtils".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(b,d){this.baseURL=b;this.devicePixelRatio=d;this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;
this.loadStatus="not-loaded"}Object.defineProperty(d.prototype,"spriteNames",{get:function(){var b=[],d;for(d in this._spritesData)b.push(d);b.sort();return b},enumerable:!0,configurable:!0});d.prototype.getSpriteInfo=function(b){return this._spritesData[b]};d.prototype.load=function(){var e=this;this.loadStatus="loading";return this.baseURL?this._loadSprites().then(function(){e.loadStatus="loaded";return e}).catch(function(b){e.loadStatus="failed";return e}):b.resolve(this)};d.prototype._loadSprites=
function(){var e=this;this._isRetina=1.15<this.devicePixelRatio?!0:!1;var d=this.baseURL,c=this._isRetina?"@2x":"",a=""+d+c+".png";return b.all([l(d+c+".json",{responseType:"json"}),l(a,{responseType:"image"})]).then(function(a){var c=a[0];a=a[1];var d=Object.keys(c.data);if(!d||0===d.length||1===d.length&&"_ssl"===d[0]||!a||!a.data)return e._spritesData=e.image=null,e.width=e.height=0,b.resolve(null);e._spritesData=c.data;c=a.data;e.width=c.width;e.height=c.height;a=document.createElement("canvas");
d=a.getContext("2d");a.width=c.width;a.height=c.height;d.drawImage(c,0,0,c.width,c.height);c=d.getImageData(0,0,c.width,c.height);c=new Uint8Array(c.data);for(d=0;d<c.length;d+=4)a=c[d+3]/255,c[d]*=a,c[d+1]*=a,c[d+2]*=a;e.image=c})};return d}();d.default=t})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports ../../core/tsSupport/assignHelper ../../config ../../request ../../core/promiseUtils ../../core/urlUtils ../../views/vectorTiles/style/VectorTileSource".split(" "),
function(t,d,q,g,l,b,f,e){function k(a){a&&(a=f.getOrigin(a),n&&-1===n.indexOf(a)&&n.push(a))}function c(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var b=void 0,c=0;c<a.length;++c)f.isProtocolRelative(a[c])?b&&(b=b.split("://")[0]+":"+a[c].trim()):b=f.isAbsolute(a[c])?a[c]:f.join(b,a[c]);return b}function a(a,c,e,d){var g,m,n;"string"===typeof e?(e=f.normalize(e),k(e),g=f.urlToObject(e),g=l(g.path,{query:{f:"json"},responseType:"json"}),n=m=e):(g=b.resolve({data:e}),m=e.jsonUrl||
null,n=d);return g.then(function(e){var d=e.data;e.ssl&&(m&&(m=m.replace(/^http:/i,"https:")),n&&(n=n.replace(/^http:/i,"https:")));return d.sources?(a.styleUrl=m||null,h(a,d,n)):d.sources?b.reject("You must specify the URL or the JSON for a service or for a style."):a.sourceUrl?p(a,d,n,!1,c):(a.sourceUrl=m||null,p(a,d,n,!0,c))})}function h(e,d,g){var h=g?f.removeFile(g):f.appBaseUrl;e.styleBase=h;e.style=d;e.styleUrl&&k(e.styleUrl);if(!e.source){var l=[];g=null;if(d.sources.esri){var m=d.sources.esri;
m.url?g=a(e,"esri",c(h,m.url)):l.push(a(e,"esri",m,h))}null===g&&(g=b.resolve());return g.then(function(){for(var f=0,g=Object.keys(d.sources);f<g.length;f++){var k=g[f];"esri"!==k&&"vector"===d.sources[k].type&&(d.sources[k].url?l.push(a(e,k,c(h,d.sources[k].url))):l.push(a(e,k,d.sources[k],h)))}return b.eachAlways(l).then(function(){})})}return b.resolve()}function p(d,g,h,l,n){h=h?f.removeTrailingSlash(h)+"/":f.appBaseUrl;var m;if(g.hasOwnProperty("tileInfo"))m=g;else{m={xmin:-2.0037507067161843E7,
ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}};for(var p=(m.xmax-m.xmin)/512,r=[],q=g.hasOwnProperty("minzoom")?parseFloat(g.minzoom):0,u=g.hasOwnProperty("maxzoom")?parseFloat(g.maxzoom):16;q<u;q++){var v=p/Math.pow(2,q);r.push({level:q,scale:Math.floor(3779.527559055118*v),resolution:v})}p=0;for(u=g.tiles;p<u.length;p++)k(c(h,u[p]));m={capabilities:"TilesOnly",initialExtent:m,fullExtent:m,minScale:r[0].scale,maxScale:r[r.length-1].scale,
tiles:g.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:r,spatialReference:{wkid:102100}}}}r=new e(n,h,m);if(!l&&d.primarySourceName in d.sourceNameToSource){p=d.sourceNameToSource[d.primarySourceName];if(!p.isCompatibleWith(r))return b.resolve();p.fullExtent.union(r.fullExtent);p.tileInfo.lods.length<r.tileInfo.lods.length&&(p.tileInfo=r.tileInfo)}l?(d.sourceBase=h,d.source=g,d.validatedSource=m,d.primarySourceName=n,d.sourceUrl&&k(d.sourceUrl)):
k(h);d.sourceNameToSource[n]=r;return d.style?b.resolve():null==g.defaultStyles?b.reject():"string"===typeof g.defaultStyles?a(d,"",c(h,g.defaultStyles,"root.json")):a(d,"",g.defaultStyles,c(h,"root.json"))}Object.defineProperty(d,"__esModule",{value:!0});var n=g.defaults&&g.defaults.io.corsEnabledServers;d.loadMetadata=function(b){var e={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:""},d="string"===
typeof b?[b,null]:[null,b.jsonUrl],g=d[0],d=d[1],h=g?f.urlToObject(g):null;return a(e,"esri",b,d).then(function(){var a={layerDefinition:e.validatedSource,url:g,parsedUrl:h,serviceUrl:e.sourceUrl,style:e.style,styleUrl:e.styleUrl,spriteUrl:e.style.sprite&&c(e.styleBase,e.style.sprite),glyphsUrl:e.style.glyphs&&c(e.styleBase,e.style.glyphs),sourceNameToSource:e.sourceNameToSource,primarySourceName:e.primarySourceName};k(a.spriteUrl);k(a.glyphsUrl);return a})}})},"esri/views/vectorTiles/style/VectorTileSource":function(){define("require exports ../../../core/lang ../../../core/promiseUtils ../../../core/urlUtils ../../../geometry/Extent ../../../layers/support/TileInfo ../../../layers/support/TilemapCache ../TileIndex".split(" "),
function(t,d,q,g,l,b,f,e,k){return function(){function c(a,c,d){this.tileMapURL="";this.fullExtent=this.tileIndex=this.capabilities=this.tileInfo=this.parsedUrl=this.tilemapCache=null;this.name=a;if(this.sourceUrl=c)this.parsedUrl=l.urlToObject(this.sourceUrl);a=q.clone(d);var f=a.tiles;c&&f.forEach(function(a,b){l.isAbsolute(a)||(f[b]=l.join(c,a))});this.tileServers=f;d.tileMap&&(this.tileMapURL=l.join(c,d.tileMap));var g=d.capabilities&&d.capabilities.split(",").map(function(a){return a.toLowerCase().trim()}),
h=!!d.exportTilesAllowed,g=!!g&&-1!==g.indexOf("tilemap"),p=h&&d.hasOwnProperty("maxExportTilesCount")?d.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:h,supportsTileMap:g},exportTiles:h?{maxExportTilesCount:+p}:null};this.tileInfo=this.readTileInfo(a.tileInfo,a);g&&(this.type="vector-tile",this.tilemapCache=new e({layer:this}),this.tileIndex=new k(this.tilemapCache));this.fullExtent=b.fromJSON(d.fullExtent)}c.prototype.getRefKey=function(a){return this.tileIndex?this.tileIndex.dataKey(a):
g.resolve(a)};c.prototype.getSourceTileUrl=function(a,b,c){var e=this.tileServers[b%this.tileServers.length];return e=e.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};c.prototype.isCompatibleWith=function(a){var b=this.tileInfo;a=a.tileInfo;if(!b.spatialReference.equals(a.spatialReference)||!b.origin.equals(a.origin)||Math.round(b.dpi)!==Math.round(a.dpi))return!1;b=b.lods;a=a.lods;for(var c=Math.min(b.length,a.length),e=0;e<c;e++){var d=b[e],f=a[e];
if(d.level!==f.level||Math.round(d.scale)!==Math.round(f.scale))return!1}return!0};c.prototype.readTileInfo=function(a,b){var c=b.minScale?Math.round(1E4*b.minScale)/1E4:Infinity,e=b.maxScale?Math.round(1E4*b.maxScale)/1E4:-Infinity;return a?(a.lods=a.lods.filter(function(a){a=Math.round(1E4*a.scale)/1E4;return a<=c&&a>=e}),f.fromJSON(a)):null};return c}()})},"esri/views/vectorTiles/TileIndex":function(){define(["require","exports","../../core/promiseUtils","../../layers/support/TilemapCache","../2d/tiling/TileKey"],
function(t,d,q,g,l){return function(){function b(b){if(b instanceof g)this._tilemapCache=b;else if(b&&"index"in b)this._tilemap=b.index;else throw Error("Invalid tilemap!");}b.prototype.dataKey=function(b){if(this._tilemapCache){var e=b.level,d=b.row,c=b.col,a=new l(b);return this._tilemapCache.fetchAvailabilityUpsample(e,d,c,a).then(function(){return a}).catch(function(b){if(b&&"cancel"===b.dojoType)throw b;a.level=e;a.row=d;a.col=c;return a})}return this._getIndexedDataKey(b)};b.prototype.forEach=
function(b,e,d,c,a){this._callback=a;this._maxLevel=e+b;this._forEach(this._tilemap,e,d,c)};b.prototype._forEach=function(b,e,d,c){0!==b&&(this._callback(e,d,c),e!==this._maxLevel&&"object"===typeof b&&(this._forEach(b[0],e+1,2*d,2*c),this._forEach(b[1],e+1,2*d,2*c+1),this._forEach(b[2],e+1,2*d+1,2*c),this._forEach(b[3],e+1,2*d+1,2*c+1)))};b.prototype._getIndexedDataKey=function(b){var e=[b];if(0>b.level||0>b.row||0>b.col||0<b.row>>b.level||0<b.col>>b.level)return q.resolve(null);for(;0!==b.level;)b=
new l(b.level-1,b.row>>1,b.col>>1,b.world),e.push(b);b=this._tilemap;var d=e.pop(),c,a;if(1===b)return q.resolve(d);for(;e.length;)if(c=e.pop(),a=(c.col&1)+((c.row&1)<<1),b){if(0===b[a]){d=null;break}if(1===b[a]){d=c;break}d=c;b=b[a]}return q.resolve(d)};return b}()})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(t,d,q){return function(){function d(d,b,f,e){this.set(d,b,f,e)}d.from=function(g,b,f,e){return d.pool.acquire(g,b,f,e)};d.getId=
function(d,b,f,e){return"object"===typeof d?d.level+"/"+d.row+"/"+d.col+"/"+d.world:d+"/"+b+"/"+f+"/"+e};Object.defineProperty(d.prototype,"key",{get:function(){return this},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"id",{get:function(){return this.toString()},enumerable:!0,configurable:!0});d.prototype.equals=function(d){return this.level===d.level&&this.row===d.row&&this.col===d.col&&this.world===d.world};d.prototype.release=function(){this.world=this.col=this.row=this.level=
0};d.prototype.set=function(d,b,f,e){null==d?this.world=this.col=this.row=this.level=0:"object"===typeof d?(this.level=d.level||0,this.row=d.row||0,this.col=d.col||0,this.world=d.world||0):"string"===typeof d?(d=d.split("/"),b=d[1],f=d[2],e=d[3],this.level=parseFloat(d[0]),this.row=parseFloat(b),this.col=parseFloat(f),this.world=parseFloat(e)):(this.level=+d,this.row=+b,this.col=+f,this.world=+e||0);return this};d.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+"/"+this.world};
d.prototype.getChildKeys=function(){var g=this.level+1,b=this.row<<1,f=this.col<<1,e=this.world;return[d.pool.acquire(g,b,f,e),d.pool.acquire(g,b,f+1,e),d.pool.acquire(g,b+1,f,e),d.pool.acquire(g,b+1,f+1,e)]};d.prototype.compareRowMajor=function(d){return this.row<d.row?-1:this.row>d.row?1:this.col<d.col?-1:this.col>d.col?1:0};d.sort=function(g){return g.map(function(b){return d.from(b)}).sort(function(b,d){return b.compareRowMajor(d)}).map(function(b){return b.id})};d.pool=new q(d,!0,null,25,50);
return d}()})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.createForItem=function(d){return{origin:"portal-item",url:q.urlToObject(d.itemUrl),portal:d.portal||g.getDefault()}}})},"esri/views/vectorTiles/SchemaHelper":function(){define(["require","exports"],function(t,d){return function(){function d(d,l){this.lockedSchemaPixelSize=d;this.isWGS84=l}d.prototype.getLevelRowColumn=
function(d){return this.isWGS84?[d[0],d[1]>>1,d[2]>>1]:256===this.lockedSchemaPixelSize&&0<d[0]?[d[0]-1,d[1]>>1,d[2]>>1]:d};d.prototype.adjustLevel=function(d){return this.isWGS84?d:256===this.lockedSchemaPixelSize?0<d?d-1:0:d};d.prototype.getShift=function(d,l){var b=0,f=0;if(256===this.lockedSchemaPixelSize||this.isWGS84)d[2]%2&&(b=2*l),d[1]%2&&(f=2*l);return[b,f]};d.prototype.getScale=function(d){if(this.isWGS84){if(512===this.lockedSchemaPixelSize)return 2}else if(256===this.lockedSchemaPixelSize&&
0===d)return.5;return 1};d.create256x256CompatibleTileInfo=function(d){if(!d)return null;if(256===d.rows&&256===d.cols)return d;for(var g=4326===d.spatialReference.wkid,b=[],f=d.lods.length,e=0;e<f;e++){var k=d.lods[e];b.push({level:k.level,scale:k.scale,resolution:g?k.resolution:2*k.resolution})}return{rows:256,cols:256,dpi:d.dpi,format:d.format,compressionQuality:d.compressionQuality,origin:d.origin,spatialReference:d.spatialReference,lods:b}};d.create512x512CompatibleTileInfo=function(d){if(!d||
256===d.rows||256===d.cols)return null;for(var g=[],b=d.lods.length,f=0;f<b;f++){var e=d.lods[f];g.push({level:e.level,scale:e.scale,resolution:.5*e.resolution})}return{rows:512,cols:512,dpi:d.dpi,format:d.format,compressionQuality:d.compressionQuality,origin:d.origin,spatialReference:d.spatialReference,lods:g}};return d}()})},"esri/views/vectorTiles/style/StyleRepository":function(){define(["require","exports","../../../core/has","./StyleLayer"],function(t,d,q,g){return function(){function d(b,f){this._layerByName=
{};this.styleJSON=b;this.version=parseFloat(b.version);this.sprite=f?f.spriteUrl:b.sprite;this.glyphs=f?f.glyphsUrl:b.glyphs;if(this.layers=(b.layers||[]).map(d._create))for(b=void 0,f=0;f<this.layers.length;f++)b=this.layers[f],this._layerByName[b.id.toLowerCase()]=b;this._identifyRefLayers()}d.prototype.getStyleLayerId=function(b){return b>=this.layers.length?null:this.layers[b].id};d.prototype.getLayoutProperties=function(b){return(b=this._layerByName[b.toLowerCase()])?b.layout:null};d.prototype.getPaintProperties=
function(b){return(b=this._layerByName[b.toLowerCase()])?b.paint:null};d.prototype.setPaintProperties=function(b,f){b=this._layerByName[b.toLowerCase()];if(!b)return"";var e=this.layers.indexOf(b);this.styleJSON.layers[e].paint=f;f=d._recreateLayer({id:b.id,type:b.typeName,source:b.source,sourceLayer:b["source-layer"],minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:b.layout,paint:f},b);this.layers[e]=f;this._layerByName[b.id.toLowerCase()]=f;return b.id};d.prototype.setLayoutProperties=
function(b,f){b=this._layerByName[b.toLowerCase()];if(!b)return"";var e=this.layers.indexOf(b);this.styleJSON.layers[e].layout=f;f=d._recreateLayer({id:b.id,type:b.typeName,source:b.source,sourceLayer:b["source-layer"],minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:f,paint:b.paint},b);this.layers[e]=f;this._layerByName[b.id.toLowerCase()]=f;return b.id};d.prototype._identifyRefLayers=function(){for(var b=[],d=[],e=0,g=0,c=this.layers;g<c.length;g++){var a=c[g];if(1===a.type){var h=a,l=
a.sourceLayer,l=l+("|"+JSON.stringify(a.layout&&a.layout.visibility)),l=l+("|"+JSON.stringify(a.minzoom)),l=l+("|"+JSON.stringify(a.maxzoom)),l=l+("|"+JSON.stringify(a.filter));if(h.hasDataDrivenFill||h.hasDataDrivenOutline)l+="|"+JSON.stringify(e);b.push({key:l,layer:a})}2===a.type&&(h=a,l=a.sourceLayer,l+="|"+JSON.stringify(a.layout&&a.layout.visibility),l+="|"+JSON.stringify(a.minzoom),l+="|"+JSON.stringify(a.maxzoom),l+="|"+JSON.stringify(a.filter),l+="|"+JSON.stringify(a.layout&&a.layout["line-cap"]),
l+="|"+JSON.stringify(a.layout&&a.layout["line-join"]),h.hasDataDrivenLine&&(l+="|"+JSON.stringify(e)),d.push({key:l,layer:a}));++e}this._assignRefLayers(b);this._assignRefLayers(d)};d.prototype._assignRefLayers=function(b){b.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var d,e,g=b.length,c=0;c<g;c++){var a=b[c];if(a.key===d)a.layer.refLayerId=e;else if(d=a.key,e=a.layer.id,1===a.layer.type&&!a.layer.getPaintProperty("fill-outline-color"))for(var h=c+1;h<g;h++){var l=b[h];if(l.key===
d){if(l.layer.getPaintProperty("fill-outline-color")){b[c]=l;b[h]=a;e=l.layer.id;break}}else break}}};d._create=function(b,d,e){d=1-1/(e.length+1)*(1+d);switch(b.type){case "background":return new g.BackgroundStyleLayer(0,b,d);case "fill":return new g.FillStyleLayer(1,b,d);case "line":return new g.LineStyleLayer(2,b,d);case "symbol":return new g.SymbolStyleLayer(3,b,d);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new g.CircleStyleLayer(4,b,d)}throw Error("Unknown vector tile layer");
};d._recreateLayer=function(b,d){switch(b.type){case "background":return new g.BackgroundStyleLayer(0,b,d.z);case "fill":return new g.FillStyleLayer(1,b,d.z);case "line":return new g.LineStyleLayer(2,b,d.z);case "symbol":return new g.SymbolStyleLayer(3,b,d.z);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new g.CircleStyleLayer(4,b,d.z)}};return d}()})},"esri/views/vectorTiles/style/StyleLayer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Filter ./StyleDefinition ./StyleProperty".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(d,c,a){this.type=d;this.typeName=c.type;this.id=c.id;this.source=c.source;this.sourceLayer=c["source-layer"];this.minzoom=c.minzoom;this.maxzoom=c.maxzoom;this.filter=c.filter;this.layout=c.layout;this.paint=c.paint;this.z=a;switch(d){case 0:this._layoutDefinition=b.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=b.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=
b.StyleDefinition.fillLayoutDefinition;this._paintDefinition=b.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=b.StyleDefinition.lineLayoutDefinition;this._paintDefinition=b.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=b.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=b.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=b.StyleDefinition.circleLayoutDefinition,this._paintDefinition=b.StyleDefinition.circlePaintDefinition}this._layoutProperties=
this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}d.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=l.createFilter(this.filter)};d.prototype.getLayoutProperty=function(b){var c=this._layoutProperties;if(c)return c[b]};d.prototype.getPaintProperty=function(b){var c=this._paintProperties;if(c)return c[b]};d.prototype.getLayoutValue=function(b,c,a){var d,e=this._layoutProperties;e&&(e=e[b])&&(d=e.getValue(c,
a));b=this._layoutDefinition[b];void 0===d&&(d=b["default"]);"enum"===b.type&&(d=b.values.indexOf(d));return d};d.prototype.getPaintValue=function(b,c,a){var d,e=this._paintProperties;e&&(e=e[b])&&(d=e.getValue(c,a));b=this._paintDefinition[b];void 0===d&&(d=b["default"]);"enum"===b.type&&(d=b.values.indexOf(d));return d};d.prototype._parseLayout=function(b){var c={},a;for(a in b){var d=this._layoutDefinition[a];d&&(c[a]=new f(a,d,b[a]))}return c};d.prototype._parsePaint=function(b){var c={},a;for(a in b){var d=
this._paintDefinition[a];d&&(c[a]=new f(a,d,b[a]))}return c};return d}();d.StyleLayer=t;g=function(b){function d(c,a,d){return b.call(this,c,a,d)||this}q(d,b);return d}(t);d.BackgroundStyleLayer=g;g=function(b){function d(c,a,d){c=b.call(this,c,a,d)||this;a=c.getPaintProperty("fill-color");c.hasDataDrivenColor=a?a.isDataDriven:!1;a=c.getPaintProperty("fill-opacity");c.hasDataDrivenOpacity=a?a.isDataDriven:!1;c.hasDataDrivenFill=c.hasDataDrivenColor||c.hasDataDrivenOpacity;a=c.getPaintProperty("fill-outline-color");
c.outlineUsesFillColor=!a;c.hasDataDrivenOutlineColor=a?a.isDataDriven:!1;c.hasDataDrivenOutline=(a?c.hasDataDrivenOutlineColor:c.hasDataDrivenColor)||c.hasDataDrivenOpacity;return c}q(d,b);return d}(t);d.FillStyleLayer=g;g=function(b){function d(c,a,d){c=b.call(this,c,a,d)||this;a=c.getPaintProperty("line-color");c.hasDataDrivenColor=a?a.isDataDriven:!1;a=c.getPaintProperty("line-opacity");c.hasDataDrivenOpacity=a?a.isDataDriven:!1;a=c.getPaintProperty("line-width");c.hasDataDrivenWidth=a?a.isDataDriven:
!1;c.hasDataDrivenLine=c.hasDataDrivenColor||c.hasDataDrivenOpacity||c.hasDataDrivenWidth;return c}q(d,b);return d}(t);d.LineStyleLayer=g;g=function(b){function d(c,a,d){c=b.call(this,c,a,d)||this;a=c.getPaintProperty("icon-color");c.hasDataDrivenIconColor=a?a.isDataDriven:!1;a=c.getPaintProperty("icon-opacity");c.hasDataDrivenIconOpacity=a?a.isDataDriven:!1;a=c.getLayoutProperty("icon-size");c.hasDataDrivenIconSize=a?a.isDataDriven:!1;c.hasDataDrivenIcon=c.hasDataDrivenIconColor||c.hasDataDrivenIconOpacity||
c.hasDataDrivenIconSize;a=c.getPaintProperty("text-color");c.hasDataDrivenTextColor=a?a.isDataDriven:!1;a=c.getPaintProperty("text-opacity");c.hasDataDrivenTextOpacity=a?a.isDataDriven:!1;a=c.getLayoutProperty("text-size");c.hasDataDrivenTextSize=a?a.isDataDriven:!1;c.hasDataDrivenText=c.hasDataDrivenTextColor||c.hasDataDrivenTextOpacity||c.hasDataDrivenTextSize;return c}q(d,b);return d}(t);d.SymbolStyleLayer=g;t=function(b){function d(c,a,d){c=b.call(this,c,a,d)||this;a=c.getPaintProperty("circle-radius");
c.hasDataDrivenRadius=a?a.isDataDriven:!1;a=c.getPaintProperty("circle-color");c.hasDataDrivenColor=a?a.isDataDriven:!1;a=c.getPaintProperty("circle-opacity");c.hasDataDrivenOpacity=a?a.isDataDriven:!1;a=c.getPaintProperty("circle-stroke-width");c.hasDataDrivenStrokeWidth=a?a.isDataDriven:!1;a=c.getPaintProperty("circle-stroke-color");c.hasDataDrivenStrokeColor=a?a.isDataDriven:!1;a=c.getPaintProperty("circle-stroke-opacity");c.hasDataDrivenStrokeOpacity=a?a.isDataDriven:!1;a=c.getPaintProperty("circle-blur");
c.hasDataDrivenBlur=a?a.isDataDriven:!1;return c}q(d,b);return d}(t);d.CircleStyleLayer=t;t=function(){return function(b,d,c){this.cap=b.getLayoutValue("line-cap",d,c);this.join=b.getLayoutValue("line-join",d,c);this.miterLimit=b.getLayoutValue("line-miter-limit",d,c);this.roundLimit=b.getLayoutValue("line-round-limit",d,c)}}();d.LineLayout=t;t=function(){return function(b,d,c,a){this.allowOverlap=b.getLayoutValue("icon-allow-overlap",d,a);this.ignorePlacement=b.getLayoutValue("icon-ignore-placement",
d,a);this.optional=b.getLayoutValue("icon-optional",d,a);this.rotationAlignment=b.getLayoutValue("icon-rotation-alignment",d,a);this.size=b.getLayoutValue("icon-size",d,a);this.rotate=b.getLayoutValue("icon-rotate",d,a);this.padding=b.getLayoutValue("icon-padding",d,a);this.keepUpright=b.getLayoutValue("icon-keep-upright",d,a);this.offset=b.getLayoutValue("icon-offset",d,a);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();d.IconLayout=t;t=function(){return function(b,d,c,a){this.allowOverlap=
b.getLayoutValue("text-allow-overlap",d,a);this.ignorePlacement=b.getLayoutValue("text-ignore-placement",d,a);this.optional=b.getLayoutValue("text-optional",d,a);this.rotationAlignment=b.getLayoutValue("text-rotation-alignment",d,a);this.fontArray=b.getLayoutValue("text-font",d,a);this.maxWidth=b.getLayoutValue("text-max-width",d,a);this.lineHeight=b.getLayoutValue("text-line-height",d,a);this.letterSpacing=b.getLayoutValue("text-letter-spacing",d,a);this.justify=b.getLayoutValue("text-justify",d,
a);this.anchor=b.getLayoutValue("text-anchor",d,a);this.maxAngle=b.getLayoutValue("text-max-angle",d,a);this.size=b.getLayoutValue("text-size",d,a);this.rotate=b.getLayoutValue("text-rotate",d,a);this.padding=b.getLayoutValue("text-padding",d,a);this.keepUpright=b.getLayoutValue("text-keep-upright",d,a);this.transform=b.getLayoutValue("text-transform",d,a);this.offset=b.getLayoutValue("text-offset",d,a);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();d.TextLayout=t})},"esri/views/vectorTiles/style/Filter":function(){define(["require",
"exports"],function(t,d){return function(){function d(g,l,b){this._op=g;"$type"===l?(this._val=b instanceof Array?b.map(function(b){return d._types.indexOf(b)}):d._types.indexOf(b),this._op+=11):(this._key=l,this._val=b)}d.prototype.filter=function(d){switch(this._op){case 0:return this._val;case 1:return d.values[this._key]===this._val;case 2:return d.values[this._key]!==this._val;case 3:return d.values[this._key]<this._val;case 4:return d.values[this._key]>this._val;case 5:return d.values[this._key]<=
this._val;case 6:return d.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(d.values[this._key]);case 8:return-1===this._val.indexOf(d.values[this._key]);case 9:for(var g=0,b=this._val;g<b.length;g++){var f=b[g];if(f.filter(d))return!0}return!1;case 10:g=0;for(b=this._val;g<b.length;g++)if(f=b[g],!f.filter(d))return!1;return!0;case 11:g=0;for(b=this._val;g<b.length;g++)if(f=b[g],f.filter(d))return!1;return!0;case 12:return d.type===this._val;case 13:return d.type!==this._val;case 14:return d.type<
this._val;case 15:return d.type>this._val;case 16:return d.type>=this._val;case 17:return d.type<=this._val;case 18:return-1!==this._val.indexOf(d.type);case 19:return-1===this._val.indexOf(d.type);case 20:return void 0!==d.values[this._key];case 21:return void 0===d.values[this._key]}};d.createFilter=function(g){if(!g)return new d(0,void 0,!0);var l=g[0];if(1>=g.length)return new d(0,void 0,"any"!==l);switch(l){case "\x3d\x3d":return new d(1,g[1],g[2]);case "!\x3d":return new d(2,g[1],g[2]);case "\x3e":return new d(4,
g[1],g[2]);case "\x3c":return new d(3,g[1],g[2]);case "\x3e\x3d":return new d(6,g[1],g[2]);case "\x3c\x3d":return new d(5,g[1],g[2]);case "in":return new d(7,g[1],g.slice(2));case "!in":return new d(8,g[1],g.slice(2));case "any":return new d(9,void 0,g.slice(1).map(d.createFilter.bind(this)));case "all":return new d(10,void 0,g.slice(1).map(d.createFilter.bind(this)));case "none":return new d(11,void 0,g.slice(1).map(d.createFilter.bind(this)));case "has":return new d(20,g[1],void 0);case "!has":return new d(21,
g[1],void 0);default:throw Error("invalid operator: "+l);}};d._types=["Unknown","Point","LineString","Polygon"];return d}()})},"esri/views/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(){}d.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};d.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};d.lineLayoutDefinition=
{visibility:{type:"enum",values:["visible","none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};d.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",
minimum:1,default:250},"symbol-avoid-edges":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",default:!1},"icon-optional":{type:"boolean",default:!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"icon-rotate":{type:"number",default:0},"icon-padding":{type:"number",minimum:0,default:2},"icon-keep-upright":{type:"boolean",
default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,default:16},"text-max-width":{type:"number",minimum:0,default:10},"text-line-height":{type:"number",default:1.2},"text-letter-spacing":{type:"number",default:0},"text-justify":{type:"enum",
values:["left","center","right"],default:"center"},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"text-max-angle":{type:"number",minimum:0,default:45},"text-rotate":{type:"number",default:0},"text-padding":{type:"number",minimum:0,default:2},"text-keep-upright":{type:"boolean",default:!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-offset":{type:"array",value:"number",
length:2,default:[0,0]},"text-allow-overlap":{type:"boolean",default:!1},"text-ignore-placement":{type:"boolean",default:!1},"text-optional":{type:"boolean",default:!1}};d.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};d.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-color":{type:"color",default:[0,0,0,1]},"background-pattern":{type:"string"}};d.fillPaintDefinition={"fill-opacity":{type:"number",
minimum:0,maximum:1,default:1},"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"fill-pattern":{type:"string"}};d.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-color":{type:"color",default:[0,0,0,1]},"line-translate":{type:"array",
value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-blur":{type:"number",minimum:0,default:0},"line-dasharray":{type:"array",value:"number",default:[]},"line-pattern":{type:"string"}};d.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-color":{type:"color",
default:[0,0,0,1]},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",
minimum:0,default:0},"text-halo-blur":{type:"number",minimum:0,default:0},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};d.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",
minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};d.circlePaintDefinition={"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-color":{type:"color",default:[0,0,0,1]},"circle-blur":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",
values:["map","viewport"],default:"map"},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1}};return d}();d.StyleDefinition=t})},"esri/views/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../Color","../GeometryUtils"],function(t,d,q,g){return function(){function d(b,f,e){this.isDataDriven=!1;switch(f.type){case "number":b=!0;break;case "color":b=
!0;e=d._parseColor(e);break;case "array":b="number"===f.value;break;default:b=!1}null==e&&(e=f.default);b&&"interval"===e.type&&(b=!1);var g=e&&e.stops&&0<e.stops.length;if(g)for(var c=0,a=e.stops;c<a.length;c++){var h=a[c];h[1]=this._validate(h[1],f)}if(this.isDataDriven=e?!!e.property:!1)if(void 0!==e.default&&(e.default=this._validate(e.default,f)),g)switch(e.type){case "identity":this.getValue=this._buildIdentity(e,f);break;case "categorical":this.getValue=this._buildCategorical(e,f);break;default:this.getValue=
b?this._buildInterpolate(e,f):this._buildInterval(e,f)}else this.getValue=this._buildIdentity(e,f);else g?this.getValue=b?this._buildZoomInterpolate(e):this._buildZoomInterval(e):(e=this._validate(e,f),this.getValue=this._buildSimple(e))}d.prototype._validate=function(b,d){if("number"===d.type){if(b<d.minimum)return d.minimum;if(b>d.maximum)return d.maximum}return b};d.prototype._buildSimple=function(b){return function(){return b}};d.prototype._buildIdentity=function(b,f){var e=this;return function(g,
c){var a;c&&(a=c.values[b.property],"color"===f.type&&(a=d._parseColor(a)));void 0===a&&(a=b.default);return void 0!==a?e._validate(a,f):f.default}};d.prototype._buildCategorical=function(b,d){var e=this;return function(f,c){var a;c&&(a=c.values[b.property]);a=e._categorical(a,b.stops);return void 0!==a?a:void 0!==b.default?b.default:d.default}};d.prototype._buildInterval=function(b,d){var e=this;return function(f,c){var a;c&&(a=c.values[b.property]);return"number"===typeof a?e._interval(a,b.stops):
void 0!==b.default?b.default:d.default}};d.prototype._buildInterpolate=function(b,d){var e=this;return function(f,c){var a;c&&(a=c.values[b.property]);return"number"===typeof a?e._interpolate(a,b.stops,b.base||1):void 0!==b.default?b.default:d.default}};d.prototype._buildZoomInterpolate=function(b){var d=this;return function(e){return d._interpolate(e,b.stops,b.base||1)}};d.prototype._buildZoomInterval=function(b){var d=this;return function(e){return d._interval(e,b.stops)}};d.prototype._categorical=
function(b,d){for(var e=d.length,f=0;f<e;f++)if(d[f][0]===b)return d[f][1]};d.prototype._interval=function(b,d){for(var e=d.length,f=0,c=0;c<e;c++)if(d[c][0]<=b)f=c;else break;return d[f][1]};d.prototype._interpolate=function(b,d,e){for(var f,c,a=d.length,h=0;h<a;h++){var l=d[h];if(l[0]<=b)f=l;else{c=l;break}}if(f&&c){h=c[0]-f[0];b-=f[0];e=1===e?b/h:(Math.pow(e,b)-1)/(Math.pow(e,h)-1);if(Array.isArray(f[1])){f=f[1];c=c[1];b=[];for(h=0;h<f.length;h++)b.push(g.interpolate(f[h],c[h],e));return b}return g.interpolate(f[1],
c[1],e)}if(f)return f[1];if(c)return c[1]};d._isEmpty=function(b){for(var d in b)if(b.hasOwnProperty(d))return!1;return!0};d._parseColor=function(b){if(Array.isArray(b))return b;if("string"===typeof b){if(b=new q(b),!this._isEmpty(b))return q.toUnitRGBA(b)}else return b&&b.default&&(b.default=d._parseColor(b.default)),b&&b.stops&&(b.stops=b.stops.map(function(b){return[b[0],d._parseColor(b[1])]})),b};return d}()})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(t,
d){function q(d,b){d%=b;return 0<=d?d:d+b}Object.defineProperty(d,"__esModule",{value:!0});d.C_INFINITY=Number.POSITIVE_INFINITY;d.C_PI=Math.PI;d.C_2PI=2*d.C_PI;d.C_PI_BY_2=d.C_PI/2;d.C_RAD_TO_256=128/d.C_PI;d.C_256_TO_RAD=d.C_PI/128;d.C_DEG_TO_256=256/360;d.C_DEG_TO_RAD=d.C_PI/180;d.C_SQRT2=1.414213562;d.C_SQRT2_INV=1/d.C_SQRT2;var g=1/Math.LN2;d.positiveMod=q;d.radToByte=function(g){return q(g*d.C_RAD_TO_256,256)};d.degToByte=function(g){return q(g*d.C_DEG_TO_256,256)};d.log2=function(d){return Math.log(d)*
g};d.sqr=function(d){return d*d};d.clamp=function(d,b,f){return Math.min(Math.max(d,b),f)};d.interpolate=function(d,b,f){return d*(1-f)+b*f};d.between=function(d,b,f){return d>=b&&d<=f||d>=f&&d<=b}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),function(t,d,q,g,l,b,f,e){function k(b,d,e,f){g.vec3.copy(c,
e);c[f]=d[f];f=g.vec3.subtract(c,c,d);var h=g.vec3.subtract(a,b,d),h=g.vec3.dot(h,f),k=g.vec3.dot(f,f);d=0>=h?d:k<=h?e:g.vec3.add(c,d,g.vec3.scale(f,f,h/k));b=g.vec3.subtract(c,b,d);return Math.PI/2-Math.atan(b[2]/Math.sqrt(b[0]*b[0]+b[1]*b[1]))}Object.defineProperty(d,"__esModule",{value:!0});var c=l.vec3f64.create(),a=l.vec3f64.create(),h=l.vec3f64.create(),p=l.vec3f64.create();d.isInsideExtent=function(a,c,d){void 0===d&&(d=0);a=a.extent;return 0===d?b.containsPoint(a,c):b.containsPointWithMargin(a,
c,d*Math.min(a[2]-a[0],a[3]-a[1]))};d.tiltOnEdge=k;d.tiltToExtentEdge=function(a,b){var c=a.getElevationBounds();a=a.extent;c=.5*(c[0]+c[1]);h[0]=a[0];h[1]=a[1];h[2]=c;p[0]=a[2];p[1]=a[3];p[2]=c;a=c=Infinity;b[0]<h[0]?c=k(b,h,p,0):b[0]>p[0]&&(c=k(b,p,h,0));b[1]<h[1]?a=k(b,h,p,1):b[1]>p[1]&&(a=k(b,p,h,1));return Math.min(c,a)};d.checkIfTileInfoSupportedForViewSR=function(a,c,d){if(a.spatialReference.isGeographic)return new q("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");
var g=e.checkUnsupported(a);if(g)return g;var h=a.lods,g=h[0].resolution*Math.pow(2,h[0].level),k=[g*a.size[0],g*a.size[1]],l=[a.origin.x,a.origin.y];c=b.fromExtent(c);var n=b.create();e.computeRowColExtent(c,k,l,n);k=(n[2]-n[0])*(n[3]-n[1]);k>f.MAX_ROOT_TILES?(h=h[0].scale*Math.pow(2,h[0].level),g=Math.max((c[3]-c[1])/a.size[1],(c[2]-c[0])/a.size[0])*h/g,c=Math.floor(Math.log(g)/Math.log(10)),g=Math.ceil(g/Math.pow(10,c))*Math.pow(10,c),g=new q("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+
Math.floor(h).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+g.toLocaleString()+".",{level0Scale:h,suggestedLevel0Scale:g,requiredNumRootTiles:k,allowedNumRootTiles:f.MAX_ROOT_TILES})):g=null;return g?g:d&&!a.spatialReference.equals(d)?new q("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","../../../core/Error",
"./TilingScheme"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.isInsideExtent=function(d,b,f){void 0===f&&(f=0);return!0};d.tiltToExtentEdge=function(d,b){return 0};d.checkIfTileInfoSupportedForViewSR=function(d,b,f){b=d.lods.length-1;if(d.spatialReference.isWebMercator){if(!g.makeWebMercatorAuxiliarySphere(b).compatibleWith(d))return new q("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(d.spatialReference.isWGS84){if(!g.makeWGS84WithTileSize(d.size[1],
b).compatibleWith(d))return new q("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme")}else return new q("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(f&&!d.spatialReference.equals(f))return new q("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define(["require",
"exports","./TerrainConst","./TileAgent","./tileUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function b(b,d){this._pool=d;this.waitingAgents=[];this.requestPromise=this.loadingAgent=this._upsampleFromTile=this.tilemapRequest=this.tilemap=this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(b)}b.prototype.init=function(b){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.tilemapRequest=this.tilemap=
null;this._unsetUpsampleInfo();this.requestPromise=this.loadingAgent=null;this.pendingUpdates=0;b===q.LayerClass.ELEVATION&&(this.elevationBounds=null)};b.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};b.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==g.DONE&&(this.loadingAgent.dispose(),this.loadingAgent=null);this.requestPromise&&(this.requestPromise.cancel(),this.requestPromise=null);this.tilemap=
null;this.tilemapRequest&&(this.tilemapRequest.cancel(),this.tilemapRequest=null);this._unsetUpsampleInfo();this.pendingUpdates=0;this.disposeData()};b.prototype.disposeData=function(){this.data&&this.data.hasOwnProperty("dispose")&&this.data.dispose();this.data=null};Object.defineProperty(b.prototype,"upsampleFromTile",{get:function(){return this._upsampleFromTile},enumerable:!0,configurable:!0});b.prototype._unsetUpsampleInfo=function(){this._upsampleFromTile&&(this._pool.release(this._upsampleFromTile),
this._upsampleFromTile=null)};b.prototype.setUpsampleInfo=function(b,d){if(b===d||null==d)this._unsetUpsampleInfo();else{if(null==this._upsampleFromTile)this._upsampleFromTile=this._pool.acquire();else if(this._upsampleFromTile.tile===d)return;l.computeUpsampleInfo(b,d,this._upsampleFromTile)}};b.makeEmptyLayerInfo=function(d,e,g){return g?(g.init(d),g):new b(d,e)};return b}();d.TilePerLayerInfo=t})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/ObjectPool ../../core/libs/gl-matrix-2/mat4f32 ../../core/libs/gl-matrix-2/vec2f32 ../../geometry/support/spatialReferenceUtils ../2d/engine/DisplayObject ../2d/tiling/TileKey ./RenderBucket ../webgl/BufferObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){var h="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ");return function(d){function e(){for(var a,c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];e=d.call(this)||this;e._renderBuckets=[];e._vectorTileData=
null;e._symbolUpdateData=null;e.coords=[0,0];e.bounds=[0,0,0,0];e.tileTransform={transform:l.mat4f32.create(),displayCoord:b.vec2f32.create()};e.stencilData={mask:0,reference:0};0<c.length&&(a=e.acquire).call.apply(a,[e].concat(c));return e}q(e,d);e.prototype.reset=function(){k.pool.release(this.key);this.key=null;this.coords[0]=0;this.coords[1]=0;this.bounds[0]=0;this.bounds[1]=0;this.bounds[2]=0;this.height=this.width=this.bounds[3]=0;this.resolution=null;this.rotation=0;this.id=this.client=this.styleLayers=
this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this.stage=this._symbolUpdateData=null};e.prototype.acquire=function(a,b,c,d){this.key=a;var e=b.lodAt(a.level),e=null!==e?e.resolution:0,g=b.size[0]*e,h=b.origin,k=a.col*g,l=a.row*g,n=b.spatialReference,p=0;n&&(n._isWrappable?n._isWrappable():n.isWrappable)&&(n=f.getInfo(n),p=n.valid[1]-n.valid[0]);k=h.x+k+a.world*
p;h=h.y-l;this.coords[0]=k;this.coords[1]=h;this.bounds[0]=k;this.bounds[1]=h;this.bounds[2]=k+g;this.bounds[3]=h-g;this.widthInPixels=b.size[1];this.coordRange=4096;this.resolution=e;this.rotation=d;this.styleLayers=c;this.id=a.id};e.prototype.setData=function(a,b){this._vectorTileData=a;this.client=b};e.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};e.prototype.updateTileData=function(a){this._vectorTileData=a;this.stage.requestRender()};e.prototype.dispose=
function(){for(var a="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" "),
b=0;b<a.length;++b){var c=a[b];this[c]&&(this[c].dispose(),this[c]=null)}this._renderBuckets.length=0};e.prototype.getCpuMemoryUsage=function(){return null!=this._vectorTileData&&this._vectorTileData.bufferData?this._vectorTileData.bufferData.reduce(function(a,b){return a+b.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength:0};e.prototype.getGpuMemoryUsage=function(){var a=this,b=h.reduce(function(b,c){return a[c]?b+a[c].size:b},0);this.texture&&
(b+=this.texture.descriptor.width*this.texture.descriptor.height*4);return b};e.prototype.attachWithContext=function(a){this.stage={context:a};this.attached=this.attach()};e.prototype._commitChanges=function(){this._vectorTileData&&(this.dispose(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null)};e.prototype._createRenderBuckets=function(){for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,d=0;d<b;){var e=a[d];switch(a[d+1]){case 0:var f=new c.BackgroundRenderBucket;
f.layerID=e;this._renderBuckets.push(f);d+=2;break;case 1:f=new c.FillRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];f.outlineElementStart=a[d+4];f.outlineElementCount=a[d+5];this._renderBuckets.push(f);d+=6;break;case 2:f=new c.LineRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];this._renderBuckets.push(f);d+=4;break;case 3:f=new c.SymbolRenderBucket;f.layerID=e;f.isSDF=0!==a[d+2];var g=d+3,e=a[g];g++;if(0<e)for(var h=void 0,
k=void 0,l=void 0,n=0;n<e;n++)h=a[g],k=a[g+1],l=a[g+2],f.markerPerPageElementsMap.set(h,[k,l]),g+=3;var p=a[g];g++;if(0<p)for(l=k=h=void 0,n=0;n<p;n++)h=a[g],k=a[g+1],l=a[g+2],f.glyphPerPageElementsMap.set(h,[k,l]),g+=3;this._renderBuckets.push(f);d+=5+3*e+3*p;break;case 4:f=new c.CircleRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];this._renderBuckets.push(f);d+=4;break;default:console.error("Bad bucket type!"),d+=2}}};e._createBufferToObject=function(){var b=
[];b[1]={create:a.createVertex,var:"fillVertexBuffer"};b[2]={create:a.createVertex,var:"fillDDVertexBuffer"};b[3]={create:a.createIndex,var:"fillIndexBuffer"};b[4]={create:a.createVertex,var:"outlineVertexBuffer"};b[5]={create:a.createVertex,var:"outlineDDVertexBuffer"};b[6]={create:a.createIndex,var:"outlineIndexBuffer"};b[7]={create:a.createVertex,var:"lineVertexBuffer"};b[8]={create:a.createVertex,var:"lineDDVertexBuffer"};b[9]={create:a.createIndex,var:"lineIndexBuffer"};b[10]={create:a.createVertex,
var:"iconVertexBuffer"};b[11]={create:a.createVertex,var:"iconDDVertexBuffer"};b[12]={create:a.createIndex,var:"iconIndexBuffer"};b[13]={create:a.createVertex,var:"textVertexBuffer"};b[14]={create:a.createVertex,var:"textDDVertexBuffer"};b[15]={create:a.createIndex,var:"textIndexBuffer"};b[16]={create:a.createVertex,var:"circleVertexBuffer"};b[17]={create:a.createIndex,var:"circleIndexBuffer"};return b};e.prototype._createBufferObjects=function(){for(var a=this.stage.context,b=new Uint32Array(this._vectorTileData.bufferDataInfo),
c=b.length,d=0,f=0;f<c;f+=2,d++){var g=b[f];if(!(0>=b[f+1]||0===this._vectorTileData.bufferData[d].byteLength)){var h=e.bufferToObject[g];h?this[h.var]?this[h.var].setData(this._vectorTileData.bufferData[d]):this[h.var]=h.create(a,35044,this._vectorTileData.bufferData[d]):console.error("Bad buffer type "+g)}}};e.prototype.detach=function(){this.isReady&&this.client.invoke("destructTileData",this.id);this.dispose();d.prototype.detach.call(this)};e.prototype.doRender=function(a){if(this.visible&&this.isReady){var b=
this.stage.context,c=a.renderer;if(b&&c){this._commitChanges();var d=a.drawphase;this._symbolUpdateData&&(this._updateSymbolData(a,this._symbolUpdateData),this._symbolUpdateData=null);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var e=this.styleLayers,f,g=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==g){var h=this._renderBuckets.length;if(0===d)for(var k=h-1;0<=k;k--){var l=this._renderBuckets[k];f=e.layers[l.layerID];if(!l||!f)break;1!==l.type&&0!==l.type||!l.hasData()||
c.renderBucket(b,l,a.displayLevel,a.requiredLevel,d,this,f,g)}else for(k=0;k<h;k++){l=this._renderBuckets[k];f=e.layers[l.layerID];if(!l||!f)break;l.hasData()&&c.renderBucket(b,l,a.displayLevel,a.requiredLevel,d,this,f,g)}}}}};e.prototype._updateSymbolData=function(b,d){if(!d||!d.bucketDataInfo)return!0;b=new Uint32Array(d.bucketDataInfo);var e=b.length;if(0===e)return!0;if(!this.isReady)return this.requestRender(),!1;for(var f=this.stage.context,g=new Uint32Array(d.bufferDataInfo),h=g.length,k=0,
l=0;l<h;l+=2,k++)switch(g[l]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=a.createVertex(f,35044,d.bufferData[k]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=a.createVertex(f,35044,d.bufferData[k]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=a.createIndex(f,35044,d.bufferData[k]);
break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=a.createVertex(f,35044,d.bufferData[k]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=a.createVertex(f,35044,d.bufferData[k]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=a.createIndex(f,35044,d.bufferData[k])}d=[];for(f=0;f<this._renderBuckets.length;f++)this._renderBuckets[f]instanceof
c.SymbolRenderBucket||d.push(this._renderBuckets[f]);this._renderBuckets=d;for(f=0;f<e;){h=b[f];g=new c.SymbolRenderBucket;g.layerID=h;g.isSDF=0!==b[f+2];this.styleLayers.layers.length>g.layerID&&this.styleLayers.layers[g.layerID].type===g.type&&d.push(g);var n=f+3,h=b[n];n++;if(0<h)for(var p=l=k=void 0,q=0;q<h;q++)k=b[n],l=b[n+1],p=b[n+2],g.markerPerPageElementsMap.set(k,[l,p]),n+=3;var v=b[n];n++;if(0<v)for(p=l=k=void 0,q=0;q<v;q++)k=b[n],l=b[n+1],p=b[n+2],g.glyphPerPageElementsMap.set(k,[l,p]),
n+=3;f+=5+3*h+3*v}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};e.pool=new g(e);e.bufferToObject=e._createBufferToObject();return e}(e.DisplayObject)})},
"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/Evented"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function b(){var b=null!==d&&d.apply(this,arguments)||this;b._renderRequestedCalled=!1;b._attached=!1;b._isReady=!1;b._opacity=1;b.renderRequested=!1;b._visible=!0;return b}q(b,d);Object.defineProperty(b.prototype,"attached",{get:function(){return this._attached},set:function(b){this._attached!==
b&&((this._attached=b)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isReady",{get:function(){return this._attached&&this._isReady},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opacity",{get:function(){return this._opacity},set:function(b){this._opacity!==b&&(this._opacity=b,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"visible",{get:function(){return this._visible},set:function(b){this._visible!==b&&(this._visible=b,this.requestRender())},enumerable:!0,configurable:!0});b.prototype.attach=function(){this.ready();return!0};b.prototype.detach=function(){};b.prototype.processRender=function(b){this.visible&&this.attached&&(this._renderRequestedCalled=!1,this.doRender(b),this._renderRequestedCalled||(this.renderRequested=!1),this.hasEventListener("post-render")&&this.emit("post-render"))};b.prototype.requestRender=
function(){var b=this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&this.parent.requestChildRender(this);b!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};b.prototype.dispose=function(){};b.prototype.ready=function(){this._isReady=!0;this.emit("isReady")};return b}(g);d.DisplayObject=t})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],
function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(){return function(d){this.type=d}}();d.RenderBucket=t;g=function(d){function b(){var b=d.call(this,2)||this;b.triangleElementStart=0;b.triangleElementCount=0;return b}q(b,d);b.prototype.hasData=function(){return 0<this.triangleElementCount};return b}(t);d.LineRenderBucket=g;g=function(d){function b(){var b=d.call(this,1)||this;b.triangleElementStart=0;b.triangleElementCount=0;b.outlineElementStart=0;b.outlineElementCount=
0;return b}q(b,d);b.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};return b}(t);d.FillRenderBucket=g;g=function(d){function b(){var b=d.call(this,3)||this;b.markerPerPageElementsMap=new Map;b.glyphPerPageElementsMap=new Map;b.isSDF=!1;return b}q(b,d);b.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};return b}(t);d.SymbolRenderBucket=g;g=function(d){function b(){var b=d.call(this,4)||this;b.triangleElementStart=
0;b.triangleElementCount=0;return b}q(b,d);b.prototype.hasData=function(){return 0<this.triangleElementCount};return b}(t);d.CircleRenderBucket=g;t=function(d){function b(){return d.call(this,0)||this}q(b,d);b.prototype.hasData=function(){return!0};return b}(t);d.BackgroundRenderBucket=t})},"esri/views/3d/terrain/TileGeometryFactory":function(){define("require exports ../../../core/libs/gl-matrix-2/vec4 ../../../geometry/support/aaBoundingBox ../support/ArrayPool ../support/earthUtils ../support/mathUtils ./TerrainConst".split(" "),
function(t,d,q,g,l,b,f,e){function k(a,b,c){for(var d=0;d<c.length;d++){var g=c[d];if(g){var h=g.safeWidth,k=g.width,l=g.pixelData,m=f.clamp(g.dy*(g.y1-b),0,h),g=f.clamp(g.dx*(a-g.x0),0,h),h=Math.floor(m),n=Math.floor(g),p=h*k+n,r=p+k,q=l[p],k=l[r],p=l[p+1],l=l[r+1];if(q+k+p+l<.5*e.ELEVATION_NODATA_VALUE)return m-=h,g-=n,a=q+(p-q)*g,a+(k+(l-k)*g-a)*m}}return null}function c(a,b,c,d){var e=0<(c&2),f=b+(d?1024:0)+(e?2048:0),g=u.get(f);if(!g){var g=b-1,h=b-1,k=b*b,l=2*g+2*h,m=g*h*6,n=6*l,r=6*(2*g+h-
1);d&&(m*=2,n*=2,r*=2);for(var l=65536<k+l?new Uint32Array(m+n):new Uint16Array(m+n),q=0,v=0,x=m,w,y,A,t,C=0,T=0;T<=h;T++){e&&(C=0===T?r:T===h?-r:0);for(var x=x+C,W=0;W<=g;W++)A=p(W,T,g,h),-1<A&&(t=0===T&&W!==g?1:W===g&&T!==h?g+1:T===h&&0!==W?-1:0===W&&0!==T?-(g+1):0,0!==t&&(w=q,y=k+A,A=k+(0===W&&1===T?0:A+1),t=q+t,d?(l[x+0]=w,l[x+1]=y,l[x+2]=y,l[x+3]=A,l[x+4]=A,l[x+5]=w,l[x+6]=A,l[x+7]=t,l[x+8]=t,l[x+9]=w,l[x+10]=w,l[x+11]=A,x+=12):(l[x+0]=w,l[x+1]=y,l[x+2]=A,l[x+3]=A,l[x+4]=t,l[x+5]=w,x+=6))),++q,
W<g&&T<h&&(w=T*(g+1)+W,y=w+1,A=y+(g+1),t=A-1,d?(l[v+0]=w,l[v+1]=y,l[v+2]=y,l[v+3]=A,l[v+4]=A,l[v+5]=w,l[v+6]=A,l[v+7]=t,l[v+8]=t,l[v+9]=w,l[v+10]=w,l[v+11]=A,v+=12):(l[v+0]=w,l[v+1]=y,l[v+2]=A,l[v+3]=A,l[v+4]=t,l[v+5]=w,v+=6));x-=C}g={values:l,numSurfaceIndices:m,numSkirtIndices:n};u.set(f,g)}a.indices=g.values;a.numSurfaceIndices=g.numSurfaceIndices;a.numSkirtIndices=g.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function a(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&
(d[3]=a);b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function h(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function p(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(d,"__esModule",{value:!0});var n=new l.ArrayPool(Float32Array);d.clearCaches=function(){n.clear();u.clear()};d.releaseGeometry=function(a){n.put(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};d.elevationSampler=k;d.createSphericalGlobeTile=function(d,
l,u,t,B,E,I,G){var m=u[0],x=u[1],A=u[2];u=u[3];var C=.1*b.earthRadius*(u-x),Q=d.numVertsPerRow-1,P=d.numVertsPerRow-1,O=d.numVertsPerRow*d.numVertsPerRow,U=n.get((O+(2*Q+2*P))*e.GEOMETRY_VERTEX_STRIDE),N=G.geometryInfo.boundingBox;g.empty(N);var V=l[2]-l[0],X=l[3]-l[1],J=A-m,A=B[0],R=B[1];B=B[2];for(var T=0;T<=Q;T++){var W=T/Q,Z=m+W*J;v[T]=Math.sin(Z);r[T]=Math.cos(Z);y[T]=W;w[T]=l[0]+W*V}m=t&&!!(E&1);V=t&&!!(E&2);for(Z=J=0;Z<=P;Z++){var fa=Z/P,T=f.lerp(x,u,fa),ga=Math.cos(T),ja=Math.sin(T),ia=void 0;
t?(ia=b.earthRadius/2*Math.log((1+ja)/(1-ja)),fa=(ia-l[1])/X):ia=180*T/Math.PI;for(T=0;T<=Q;T++){var W=y[T],ka=v[T],da=r[T],Y=b.earthRadius;d.samplerData&&(Y+=k(w[T],ia,d.samplerData)||0);da=da*ga*Y-A;ka=ka*ga*Y-R;Y=ja*Y-B;a(da,ka,Y,N);var ha=e.GEOMETRY_VERTEX_STRIDE*J;U[ha+0]=da;U[ha+1]=ka;U[ha+2]=Y;U[ha+3]=W;U[ha+4]=fa;ha=p(T,Z,Q,P);if(-1<ha){var ha=e.GEOMETRY_VERTEX_STRIDE*(O+ha),ea=m&&0===Z?-1:V&&Z===P?1:0,da=0===ea?da:-A,ka=0===ea?ka:-R,Y=0===ea?Y:b.earthRadius*ea-B;U[ha+0]=da;U[ha+1]=ka;U[ha+
2]=Y;U[ha+3]=0===ea?h(W,fa):W;U[ha+4]=0===ea?C:fa;0!==ea&&a(da,ka,Y,N)}++J}}G.geometryInfo.numVertsPerRow=d.numVertsPerRow;G.geometryInfo.vertexAttributes=U;G.geometryInfo.skirtLength=C;q.vec4.set(G.geometryInfo.uvOffsetAndScale,0,0,1,1);c(G.geometryInfo,d.numVertsPerRow,t?E:0,I)};d.createPlanarGlobeTile=function(b,d,f,l,r){var m=d[0],v=d[1],u=d[2]-m,x=d[3]-v,w=b.clippingArea,y=w?Math.max(0,(w[0]-d[0])/u):0,A=w?Math.max(0,(w[1]-d[1])/x):0,t=w?Math.min(1,(w[2]-d[0])/u):1;d=w?Math.min(1,(w[3]-d[1])/
x):1;var C=t>y?1/(t-y):1,B=d>A?1/(d-A):1,U=-y*C,N=-A*B,V=.1*u,X=b.numVertsPerRow-1,J=b.numVertsPerRow-1,R=b.numVertsPerRow*b.numVertsPerRow,T=n.get((R+(2*X+2*J))*e.GEOMETRY_VERTEX_STRIDE),W=r.geometryInfo.boundingBox;g.empty(W);for(var Z=0,fa=0;fa<=J;fa++){var ga=fa/J,ja=N+ga*B,ga=v+ga*x;w&&(ga<w[1]?(ga=w[1],ja=0):ga>w[3]&&(ga=w[3],ja=1));for(var ia=0;ia<=X;ia++){var ka=ia/X,da=U+ka*C,ka=m+ka*u;w&&(ka<w[0]?(ka=w[0],da=0):ka>w[2]&&(ka=w[2],da=1));var Y=b.samplerData?k(ka,ga,b.samplerData)||0:0,ka=
ka-f[0],ha=ga-f[1],Y=Y-f[2];a(ka,ha,Y,W);T[e.GEOMETRY_VERTEX_STRIDE*Z]=ka;T[e.GEOMETRY_VERTEX_STRIDE*Z+1]=ha;T[e.GEOMETRY_VERTEX_STRIDE*Z+2]=Y;T[e.GEOMETRY_VERTEX_STRIDE*Z+3]=da;T[e.GEOMETRY_VERTEX_STRIDE*Z+4]=ja;var ea=p(ia,fa,X,X);-1<ea&&(ea=e.GEOMETRY_VERTEX_STRIDE*(R+ea),T[ea]=ka,T[ea+1]=ha,T[ea+2]=Y,T[ea+3]=h(da,ja),T[ea+4]=V);++Z}}r.geometryInfo.numVertsPerRow=b.numVertsPerRow;r.geometryInfo.vertexAttributes=T;r.geometryInfo.skirtLength=V;q.vec4.set(r.geometryInfo.uvOffsetAndScale,y,A,t-y,d-
A);c(r.geometryInfo,b.numVertsPerRow,0,l)};var u=new Map,v=Array(e.MAX_TILE_TESSELATION+1),r=Array(e.MAX_TILE_TESSELATION+1),y=Array(e.MAX_TILE_TESSELATION+1),w=Array(e.MAX_TILE_TESSELATION+1)})},"esri/views/3d/support/ArrayPool":function(){define(["require","exports","../../../core/PooledArray"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(d){this.arrayConstructor=d;this._pool=new Map}d.prototype.get=function(d){var b=this._pool.get(d);if(!b||0===b.length)try{return new this.arrayConstructor(d)}catch(e){var b=
window.performance&&window.performance.memory,f="";b&&(f="\n  totalJSHeapSize: "+b.totalJSHeapSize+", usedJSHeapSize: "+b.usedJSHeapSize+", jsHeapSizeLimit: "+b.jsHeapSizeLimit);console.log("Array allocation of size "+d+" failed: "+e+f);throw e;}return b.pop()};d.prototype.put=function(d){var b=this._pool.get(d.length);b||(b=new q({shrink:!0}),this._pool.set(d.length,b));b.push(d)};d.prototype.clear=function(){this._pool.clear()};return d}();d.ArrayPool=t})},"esri/views/3d/terrain/SphericalTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils ../support/geometryUtils ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),
function(t,d,q,g,l,b,f,e,k,c){function a(a,c,d,e){d=b.earthRadius+d;var f=Math.cos(a);e[0]=Math.cos(c)*f*d;e[1]=Math.sin(c)*f*d;e[2]=Math.sin(a)*d}return function(d){function h(a,b,c){var e=d.call(this,h.NumSubdivisionsAtLevel)||this;e.obb=Array(8);e.isWebMercator=!1;e.tileUp=l.vec3f64.create();for(var f=0;8>f;f++)e.obb[f]=l.vec3f64.create();void 0!==a&&e.init(a,b,c);return e}q(h,d);h.prototype.init=function(c,f,h){d.prototype.init.call(this,c,f,h);this.isWebMercator=h.tilingScheme.spatialReference.isWebMercator;
f=this.extentWGS84Rad[0];h=this.extentWGS84Rad[1];var k=this.extentWGS84Rad[2],l=this.extentWGS84Rad[3];c=c[0];var n=e.lerp(h,l,.5),m=e.lerp(f,k,.5);this.edgeLen=(k-f)*Math.cos(0===c?0:Math.min(Math.abs(h),Math.abs(l)))*b.earthRadius;this.edgeLen2=this.edgeLen*this.edgeLen;this.curvatureHeight=b.earthRadius-Math.sqrt(b.earthRadius*b.earthRadius-this.edgeLen2/4);a(n,m,0,this.centerAtSeaLevel);g.vec3.copy(this.tileUp,this.centerAtSeaLevel);g.vec3.normalize(this.tileUp,this.tileUp);this._updateOBB();
this.updateRadiusAndCenter()};h.prototype.updateRadiusAndCenter=function(){if(0===this.lij[0])g.vec3.set(this.center,0,0,0),this.radius=b.earthRadius+this.elevationBounds[1];else{d.prototype.updateRadiusAndCenter.call(this);var a=Math.max(g.vec3.squaredDistance(this.center,this.obb[0]),g.vec3.squaredDistance(this.center,this.obb[1]));this.radius=Math.sqrt(a)}};h.prototype._isVisible=function(){if(!this.intersectsClippingArea)return!1;var a=this.surface.frustum.planes;if(10>this.lij[0])return f.frustum.intersectsSphere(a,
f.sphere.wrap(this.radius,this.center));for(var b=this.obb,c=0;6>c;c++){for(var d=void 0,d=0;8>d&&!f.plane.isPointOutside(a[c],b[d]);d++);if(8===d)return!1}return!0};h.prototype.computeElevationBounds=function(){d.prototype.computeElevationBounds.call(this);this._updateOBB()};h.prototype.createGeometry=function(a,b,d){var e=this._isPole(this.lij[1],this.lij[0]);c.createSphericalGlobeTile(a,this.extent,this.extentWGS84Rad,this.isWebMercator,b,e,d,this.renderData);this.updateMemoryUsed()};h.prototype._updateOBB=
function(){for(var c=this.extentWGS84Rad,d=this.obb,e=0;2>e;e++){var f=this.elevationBounds[e],h=4*e;a(c[1],c[0],f,d[h++]);a(c[3],c[0],f,d[h++]);a(c[3],c[2],f,d[h++]);a(c[1],c[2],f,d[h++])}this.isWebMercator&&(c=this._isPole(this.lij[1],this.lij[0]),2===c?(g.vec3.set(d[1],0,0,b.earthRadius),g.vec3.set(d[2],0,0,b.earthRadius),g.vec3.set(d[5],0,0,b.earthRadius),g.vec3.set(d[6],0,0,b.earthRadius)):1===c&&(g.vec3.set(d[0],0,0,-b.earthRadius),g.vec3.set(d[3],0,0,-b.earthRadius),g.vec3.set(d[4],0,0,-b.earthRadius),
g.vec3.set(d[7],0,0,-b.earthRadius)))};h.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};h.NumSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];return h}(k)})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ./TerrainConst ./terrainUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){function h(a,b){a&&!a.spatialReference.equals(b)&&(a=k.canProject(a.spatialReference,b)?k.project(a,b):null);return a}Object.defineProperty(d,"__esModule",{value:!0});t=function(a){function c(c){c=a.call(this,c)||this;c._changeListeners=new b;return c}q(c,a);c.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};c.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(c.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});c.prototype._computeStencilEnabledExtents=function(a,b){var c=[],d=0;for(a=a.items;d<a.length;d++){var f=a[d].layer;"IntegratedMeshLayer"===f.operationalLayerType&&null!=b&&(f=h(f.fullExtent,b),null!=f&&c.push(e.fromExtent(f)))}return c};
g([f.property({readOnly:!0})],c.prototype,"layerViewsExtent",null);g([f.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],c.prototype,"tiledLayersExtent",null);g([f.property({readOnly:!0,dependsOn:["spatialReference"]})],c.prototype,"stencilEnabledExtents",null);g([f.property()],c.prototype,"spatialReference",null);g([f.property()],c.prototype,"tilingScheme",null);g([f.property()],c.prototype,"defaultTiledLayersExtent",void 0);g([f.property({constructOnly:!0})],c.prototype,"layers",
void 0);g([f.property({constructOnly:!0})],c.prototype,"layerViews",void 0);return c=g([f.subclass()],c)}(f.declared(l));l=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}q(b,a);b.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};b.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};b.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?c.WEBMERCATOR_WORLD_EXTENT:c.GEOGRAPHIC_WORLD_EXTENT};g([f.property({dependsOn:["spatialReference"]})],
b.prototype,"layerViewsExtent",void 0);return b=g([f.subclass()],b)}(f.declared(t));d.SurfaceExtentHelperGlobal=l;t=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}q(c,b);c.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};c.prototype._computeLayerViewsExtent=function(){var a=e.empty(),b=this.spatialReference;
this.layerViews.forEach(function(c){c.isResolved()&&(c=c.fullExtentInLocalViewSpatialReference||c.layer.fullExtent,(c=h(c,b))&&e.expand(a,c))});var c=e.allFinite(a)?a:null,d=this._get("layerViewsExtent");return e.equals(c,d)?d:c};c.prototype._computeTiledLayersExtent=function(){var b=this.tilingScheme;if(!b)return null;var c=this.spatialReference,d=e.empty();this.layers.forEach(function(f){if(f.loaded&&a.isTiledLayer(f)){var g=a.getTiledLayerInfo(f,c,"local");f=g.tileInfo;g=g.fullExtent;f&&b.compatibleWith(f)&&
g&&g.spatialReference.equals(c)&&e.expand(d,g)}});this.defaultTiledLayersExtent&&e.expand(d,this.defaultTiledLayersExtent);var f=e.allFinite(d)?d:null,g=this._get("tiledLayersExtent");return e.equals(f,g)?g:f};return c=g([f.subclass()],c)}(f.declared(t));d.SurfaceExtentHelperLocal=t})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./terrainUtils ./TilingScheme".split(" "),
function(t,d,q,g,l,b,f,e,k){return function(c){function a(a){a=c.call(this,a)||this;a._changeHandles=new b;return a}q(a,c);a.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};a.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};a.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b=this.layers.find(function(b){return e.isTiledLayer(b)?b.isFulfilled()?b.isRejected()?!1:!!e.getTiledLayerInfo(b,a.viewSpatialReference,a.manifold).tileInfo:!0:!1});if(b)if(b.isResolved()){var c=e.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,c=new k(c),b=e.getKnownTiledServiceLevelCap(b.url);Infinity>b&&c.capMaxLod(b);this._set("tilingSchemeDone",
!0);this._lockTilingScheme(c)}else this._updateWhen(b);else this._set("tilingSchemeDone",!0)}};a.prototype._updateWhen=function(a){var b=this,c=a.when().catch(function(a){return a}).then(function(){c===b._waitTask&&b._update()});this._waitTask=c};a.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var c=a.levels.length-1;a=a.spatialReference.isWebMercator?k.makeWebMercatorAuxiliarySphere(c):k.makeWGS84WithTileSize(a.pixelSize[0],c)}this.tilingSchemeLocked=!0;this.tilingScheme=
a;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};a.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};a.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold)this.tilingScheme=this.extentHelper.spatialReference.isWebMercator?k.WebMercatorAuxiliarySphere:k.makeWGS84WithTileSize(256),
this.extent=this.extentHelper.layerViewsExtent;else{var a=this.extentHelper.layerViewsExtent;a&&(this.tilingScheme=k.fromExtent(a,this.extentHelper.spatialReference),this.extent=a)}};g([f.property()],a.prototype,"tilingScheme",void 0);g([f.property()],a.prototype,"extent",void 0);g([f.property({value:!1})],a.prototype,"tilingSchemeLocked",void 0);g([f.property({readOnly:!0,value:!1})],a.prototype,"tilingSchemeDone",void 0);g([f.property({constructOnly:!0})],a.prototype,"viewSpatialReference",void 0);
g([f.property({constructOnly:!0})],a.prototype,"layers",void 0);g([f.property({constructOnly:!0})],a.prototype,"extentHelper",void 0);g([f.property({constructOnly:!0})],a.prototype,"manifold",void 0);return a=g([f.subclass()],a)}(f.declared(l))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../Color ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/imageUtils ./ResourceCounter ./TerrainConst ./TileGeometryFactory ./TileRenderData ./TileRenderer ./tileUtils ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/tracer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainRendererPrograms ../../webgl/renderState ../../webgl/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M,Q){var P=L.assert,O=c.mat4f64.create(),U=p.vec3f64.create(),N=a.vec2f64.create(),V=v.create(),X=u.vec4f64.create(),J=u.vec4f64.create(),R=u.vec4f64.create(),T=function(){return function(){this.extent=u.vec4f64.create();this.maxLevel=this.minLevel=0;this.callback=null}}();t=function(){function a(a,b){this._memCache=b;this.tileSize=256;this.initialized=!1;this.rctx=null;this.renderDataPool=new f(x.TileRenderData);this.perOriginTileData=
new e({allocator:function(a){return a||{root:null,origin:null,tiles:new e}},deallocator:function(a){a.root=null;a.origin=null;a.tiles.clear();return a}});this.perOriginTileDataDirty=!0;this.perOriginTileDataMap=new Map;this.tileIterator=new C.IteratorPreorder;this._highestVisibleLODTile=null;this.visible=!0;this.debugScreenSizePerspective=!1;this.wireframe=F.copyParameters(W);this._opaque=!0;this._skirtScale=1;this._cullBackFaces=this._disableRendering=this._drawBorders=!1;this._renderOrder=w.RenderOrder.FRONT_TO_BACK;
this._velvetOverground=!0;this._slicePlaneEnabled=this._hasOverlays=!1;this.castShadows=!0;this.receiveShadows=!1;this.backgroundPromise=this.tileRenderer=this.emptyTex=null;this.tileBackgroundInitialized=!1;this.stencilEnabledLayerExtents=[];this.numOriginsRendered=this.numTilesCulled=this.numTilesRendered=this.numTrianglesRendered=0;this.resourceCounter=new y;this.loaded=this.clippingExtent=null;this._loaded=!1;this.needsRender=!0;this.needsHighlight=this.didRender=!1;this.visibleScaleRangeQueries=
new e({initialSize:10});this.visibleScaleRangeQueriesInvPtr=0;this.visibleScaleRangeQueryQueue=new e({initialSize:30});this.visibleScaleRangeQueryPool=new f(T,!1);this.manifold=a}a.prototype.destroy=function(a){this.uninstall(a);this.backgroundPromise&&(this.backgroundPromise.cancel(),this.backgroundPromise=null);m.clearCaches()};a.prototype.install=function(a){a.addRenderPlugin([3,8],this);this.drapedRenderer=a.getDrapedRenderer()};a.prototype.uninstall=function(a){a.removeRenderPlugin(this)};Object.defineProperty(a.prototype,
"disableRendering",{set:function(a){this._disableRendering=!!a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"opaque",{set:function(a){this._opaque=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"skirtScale",{set:function(a){this._skirtScale=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"drawBorders",{set:function(a){this._drawBorders!==a&&(this._drawBorders=a,this._updatePrograms())},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"cullBackFaces",{set:function(a){this._cullBackFaces=a;this._updatePrograms();this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderOrder",{get:function(){return this._renderOrder},set:function(a){this._renderOrder=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"velvetOverground",{set:function(a){this._velvetOverground!==a&&(this._velvetOverground=
a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"intersectionHandlerId",{get:function(){return E.TERRAIN_ID},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=a,this._updatePrograms())},enumerable:!0,configurable:!0});a.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};a.prototype.setNeedsHighlight=
function(a){this.needsHighlight=a;this.setNeedsRender()};a.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};a.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};a.prototype.loadCachedElevationData=function(a){P(null===a.renderData);var b=C.tile2str(a);if(b=this._memCache.pop(b)){a.renderData=b.renderData;a.renderData.tile=a;a.renderData.localOrigin=this._getLocalOriginOfTile(a);
for(var c in b.upsampleLIJs){var d=C.findParentByLIJ(a,b.upsampleLIJs[c]);a.layerInfo[w.LayerClass.ELEVATION][c].setUpsampleInfo(a,d)}}return null!=b};a.prototype.loadTile=function(a){a.renderData||(a.renderData=this.renderDataPool.acquire(),a.renderData.init(a),a.renderData.localOrigin=this._getLocalOriginOfTile(a),this.updateTileGeometry(a));this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};a.prototype.queryVisibleLevelRange=function(a,b,c,d){var e=this.visibleScaleRangeQueryPool.acquire();
n.vec4.copy(e.extent,a);e.minLevel=b?b:-Number.MAX_VALUE;e.maxLevel=null!=c?c:Number.MAX_VALUE;e.callback=d;this.visibleScaleRangeQueryQueue.push(e);this.setNeedsRender()};a.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};a.prototype.updateTileGeometry=function(a){for(var b=0,c=a.layerInfo[w.LayerClass.ELEVATION];b<c.length;b++)c[b].pendingUpdates&=~w.TileUpdate.GEOMETRY;a.renderData.updateGeometry(this.rctx,"debug"===
this.wireframe.mode)&&this.setNeedsRender()};a.prototype.unloadTile=function(a,b){if(a.renderData){a.renderData.releaseTexture();if(b){b={renderData:a.renderData,upsampleLIJs:[]};for(var c=0,d=a.layerInfo[w.LayerClass.ELEVATION];c<d.length;c++){var e=d[c].upsampleFromTile.tile.lij;b.upsampleLIJs.push([e[0],e[1],e[2]])}this._memCache.put(C.tile2str(a),b,a.renderData.estimatedGeometryMemoryUsage)}else this.releaseTileGeometry(a.renderData);a.renderData=null;a.updateMemoryUsed()}};a.prototype._getLocalOriginOfTile=
function(a){var b=Math.max(0,7*Math.floor((a.lij[0]-3)/7));if("spherical"===this.manifold&&0===b)return U;for(;a.parent&&a.lij[0]>b;)a=a.parent;return a.centerAtSeaLevel};a.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};a.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}};a.prototype.getWireframeEnabled=function(){return"shader"===
this.wireframe.mode};a.prototype.setDebugScreenSizePerspective=function(a){a!==this.debugScreenSizePerspective&&(this.debugScreenSizePerspective=a,this._updatePrograms())};a.prototype.setWireframe=function(a){var b=this;if(!1===a||!0===a)a={mode:a?"shader":"none"};var c=this.wireframe;if(void 0!==a.mode&&c.mode!==a.mode){var d="debug"===c.mode,e="debug"===a.mode;c.mode=a.mode;this._updatePrograms();d!==e&&this.rootTiles&&(C.traverseTilesPreorder(this.rootTiles,function(a){a.renderData&&a.renderData.updateGeometry(b.rctx,
e)}),this.setNeedsRender())}for(var f in a)c.hasOwnProperty(f)&&(c[f]=a[f]),this.setNeedsRender();c.resolution&&(c.resolution=Math.min(c.resolution,this.tileSize),c.resolution=1<<Math.round(Math.log(c.resolution)/Math.LN2))};a.prototype.setNeedsRender=function(){this.needsRender=!0;this.didRender=!1;this.perOriginTileDataDirty=!0};a.prototype.resetNeedsRender=function(){this.didRender&&(this.needsRender=0!==this.visibleScaleRangeQueryQueue.length,this.didRender=!1)};a.prototype.isOpaqueExcludingSlice=
function(){var a=this.wireframe,a="shader"===a.mode&&(1>a.wireOpacity||1>a.surfaceOpacity);return this._opaque&&!a};a.prototype.isOpaque=function(){return this.isOpaqueExcludingSlice()&&!this._slicePlaneEnabled};a.prototype.updateTileBackground=function(a){this.backgroundPromise&&this.backgroundPromise.cancel();this.backgroundPromise="string"===typeof a?r.requestImage(a).catch(function(){return null}):null!=a?k.resolve(l.toUnitRGBA(a)):k.resolve(null);this._renderTileBackground()};a.prototype.initializeRenderContext=
function(a){var b=this,c=this.rctx=a.rctx;a=this.programRep=a.programRep;var d=function(a){k.when(a).then(function(){b.initialized=!0;b.setNeedsRender()}).catch(d)};d(this._renderTileBackground());this._updatePrograms();this.tileRenderer=new A(c,this.tileSize,a,this.resourceCounter,function(){return b.setNeedsRender()});this._renderTileBackground();this.emptyTex=B.createEmptyTexture(c)};a.prototype.uninitializeRenderContext=function(a){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);
this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};a.prototype.render=function(a){var b=a.rctx;if(!this.initialized||this._disableRendering||!this.visible||!this.rootTiles||!this.tileBackgroundInitialized)return!1;var c=this.isOpaque()?3:8;if(a.slot!==c)return!1;G.trace("# BEGIN RENDER TERRAIN");var c=a.pass,d=1===a.lightingData.helper.globalFactor;0===c?this._renderMaterialPass(a,this._updatePerOriginTileData()):3===c&&this.castShadows&&d?this._renderDepthPass(a,this.programs.depthShadowMap,
this._updatePerOriginTileData()):1===c?this._renderDepthPass(a,this.programs.depth,this._updatePerOriginTileData()):2===c?this._renderNormalPass(a,this._updatePerOriginTileData()):4===c&&this.needsHighlight&&(this._renderHighlightPass(a,this._updatePerOriginTileData()),b.clearSafe(256));G.trace("# END RENDER TERRAIN");return!0};a.prototype.intersect=function(a,c,d,e,f){if(this.rootTiles&&(!a.enable.selectOpaqueTerrainOnly||!a.enable.selectionMode||this.isOpaqueExcludingSlice())){var g=fa,k=ga;h.vec3.subtract(g,
e,d);h.vec3.set(k,1/g[0],1/g[1],1/g[2]);var l=a.results.min,m=a.results.max,n=a.results.terrain,p=null,r=this.clippingExtent,q=this.tileIterator;q.reset(this.rootTiles);f=function(){var f=q.next();if(null===f.renderData)return"continue";if(a.enable.invisibleTerrain){if(!f.visible&&r&&!f.intersectsExtent(r))return"continue"}else if(!f.visible)return"continue";var x=f.renderData.geometryInfo,y=-u._skirtScale*x.skirtLength;if(0!==y){var A=f.tileUp;v.offset(x.boundingBox,y*A[0],y*A[1],y*A[2],V);v.expandWithBuffer(V,
x.boundingBox,0,2)}var A=0===y?x.boundingBox:V,t=f.renderData.localOrigin;h.vec3.subtract(ja,d,t);if(!F.intersectAabbInvDir(A,ja,k,a.tolerance))return"continue";var z=function(a,b,c,d){a.set(void 0,C.tile2str(b),c,d,O,void 0);a.intersector=ka;a.target=da},A=function(k,r,q){0<=k&&(a.enable.backfacesTerrain||0>h.vec3.dot(r,g))&&(a.enable.invisibleTerrain||!a.enable.selectionMode||null==c||c(d,e,k))&&((null==n.dist||k<n.dist)&&z(n,f,k,r),a.enable.storeTerrainResults&&(a.enable.storeAll&&(b.isNone(p)?
(p=new E.IntersectorResult(a.ray),z(p,f,k,r),a.results.all.push(p)):k<p.dist&&z(p,f,k,r)),(null==l.dist||k<l.dist)&&z(l,f,k,r),(null==m.dist||k>m.dist)&&z(m,f,k,r)))},B=ia;h.vec3.subtract(B,e,t);var t=x.indices,J={data:x.vertexAttributes,size:3,offsetIdx:0,strideIdx:w.GEOMETRY_VERTEX_STRIDE},x=x.numWithoutSkirtIndices/3;F.intersectTriangles(ja,B,0,x,t,J,null,A);0!==y&&C.intersectSkirts(ja,B,x,t.length/3,t,J,null,"spherical"===u.manifold?function(a){return h.vec3.scale(a,a,y/h.vec3.length(a))}:function(a){return h.vec3.set(a,
0,0,y)},A)};for(var u=this;!q.done;)f()}};a.prototype._renderTileBackground=function(){var a=this;if(this.rctx&&this.backgroundPromise&&this.tileRenderer)return this.backgroundPromise.then(function(b){a.tileRenderer&&(a.tileBackgroundInitialized=!0,a.tileRenderer.setBackground(b),a.rootTiles&&C.traverseTilesPreorder(a.rootTiles,function(b){return a.tileRenderer.updateTileTexture(b)}))})};a.prototype._updatePrograms=function(){var a="shader"===this.wireframe.mode,b=this.programRep;this.programs={color:b.getProgram(K.colorPass,
{mode:a||this._drawBorders?"wireframe":"normal",overlay:this._hasOverlays,atmosphere:"spherical"===this.manifold&&this._velvetOverground,wireframeTexture:a,tileBorders:this._drawBorders,receiveShadows:this.receiveShadows,screenSizePerspective:this.debugScreenSizePerspective,slice:this._slicePlaneEnabled}),normal:b.getProgram(K.normalPass,{alphaZero:!0}),depth:b.getProgram(K.depthPass,{shadowMap:!1}),depthShadowMap:b.getProgram(K.depthPass,{shadowMap:!0}),highlight:b.getProgram(K.highlightPass,{})};
this.defaultPipelineState=M.makePipelineState({culling:this._cullBackFaces&&M.backFaceCullingParams,depthTest:{func:513},depthWrite:M.defaultDepthWriteParams,colorWrite:M.defaultColorWriteParams});this.stencilPipelineState=M.makePipelineState(g({},this.defaultPipelineState,{stencilTest:{function:{func:517,ref:1,mask:255},operation:{fail:7680,zFail:7680,zPass:7680}}}));this.setNeedsRender()};a.prototype._renderMaterialPass=function(a,b){var c=this,d=a.shadowMap&&a.shadowMap.enabled,e=a.rctx;this.receiveShadows!==
d&&(this.receiveShadows=d,this._updatePrograms());d=!this.drapedRenderer.isEmpty();d!==this._hasOverlays&&(this._hasOverlays=d,this._updatePrograms());var d=a.camera,f=this.wireframe,g=this.programs.color;e.bindProgram(g);if("shader"===f.mode||this._drawBorders)g.setUniform1f("wireframe.width",this.wireframe.width),g.setUniform1f("wireframe.falloff",Math.min(f.width,f.falloff)),g.setUniform1f("wireframe.wireOpacity",f.wireOpacity),g.setUniform1f("wireframe.surfaceOpacity",f.surfaceOpacity),g.setUniform4fv("wireframe.color",
f.color);a.shadowMap&&a.shadowMap.bind(g);a.ssaoHelper&&a.ssaoHelper.setUniforms(g);g.setUniform1i("tex",0);g.setUniform1i("overlay0Tex",1);g.setUniform1i("overlay1Tex",2);g.setUniformMatrix4fv("viewNormal",d.viewInverseTransposeMatrix);g.setUniformMatrix4fv("proj",d.projectionMatrix);a.lightingData.helper.setUniforms(g,!0);e=d.viewMatrix;h.vec3.set(Z,e[12],e[13],e[14]);h.vec3.normalize(Z,Z);g.setUniform3fv("viewDirection",Z);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=
0;this._prepareScaleRangeQueries();this.isOpaque()?this._renderTiles(a,g,b):a.offscreenRenderingHelper.renderToTargets(function(){return c._renderTiles(a,g,b)},a.offscreenRenderingHelper.tmpColor,a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries();0<this.numTilesRendered&&!this._loaded&&(this._loaded=!0,this.loaded&&this.loaded())};a.prototype._renderDepthPass=function(a,b,c){var d=a.camera;a.rctx.bindProgram(b);b.setUniformMatrix4fv("model",O);b.setUniformMatrix4fv("viewNormal",
d.viewInverseTransposeMatrix);N[0]=d.near;N[1]=d.far;b.setUniform2fv("nearFar",N);this._renderTilesAuxiliary(a,b,c,!1)};a.prototype._renderNormalPass=function(a,b){var c=a.camera,d=this.programs.normal;a.rctx.bindProgram(d);d.setUniformMatrix4fv("viewNormal",c.viewInverseTransposeMatrix);this._renderTilesAuxiliary(a,d,b,!1)};a.prototype._renderHighlightPass=function(a,b){var c=a.rctx,d=this.programs.highlight;c.bindProgram(d);var e=a.offscreenRenderingHelper;c.bindTexture(e.depthTexture,3);d.setUniform1i("depthTex",
3);d.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height);this._renderTilesAuxiliary(a,d,b,!0)};a.prototype._updatePerOriginTileData=function(){var a=this,b=this.perOriginTileData;if(!this.perOriginTileDataDirty)return b;this._highestVisibleLODTile=null;b.clear();this._renderCollectOrigins(b);if(this._renderOrder!==w.RenderOrder.NONE){for(var c=0;c<b.length;c++)C.sortTiles(this._renderOrder,b.data[c].tiles);b.sort(function(b,c){var d=a._renderOrder;b=0===b.tiles.length?-d:0===c.tiles.length?
d:C.compareTiles(b.tiles.data[0],c.tiles.data[0],d);return b})}this.perOriginTileDataDirty=!1;return b};a.prototype._renderCollectOrigins=function(a){var b=this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],f=a.pushNew();f.root=e;f.origin=c?U:e.centerAtSeaLevel;f.tiles.clear();this._renderCollectOriginsForRoot(a,f)}};a.prototype._renderCollectOriginsForRoot=function(a,b){var c=this.tileIterator;c.resetOne(b.root);var d=this.perOriginTileDataMap;d.clear();
for(d.set(b.origin,b);!c.done;){b=c.next();var e=b.renderData;if(e&&!b.visible)this.numTilesCulled++,c.skipSubtree();else{if(0===b.lij[0]%7){var f=a.pushNew();f.root=b;f.origin=b.centerAtSeaLevel;d.set(b.centerAtSeaLevel,f);f.tiles.clear()}if(e){(e=d.get(b.renderData.localOrigin))&&e.tiles.push(b);if(!this._highestVisibleLODTile||b.vlevel>this._highestVisibleLODTile.vlevel)this._highestVisibleLODTile=b;c.skipSubtree()}}}};a.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=
0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};a.prototype._tileIntersectsStencilEnabledLayer=function(a){for(var b=this.stencilEnabledLayerExtents,c=0;c<b.length;c++)if(a.intersectsExtent(b[c]))return!0;return!1};a.prototype._renderTilesAuxiliary=
function(a,b,c,d){var e=a.rctx,f=a.camera;a=f.viewMatrix;e.setPipelineState(this.defaultPipelineState);var g=0<this.stencilEnabledLayerExtents.length;b.setUniformMatrix4fv("proj",f.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);d&&(b.setUniform1i("overlay0Tex",1),b.setUniform1i("overlay1Tex",2));for(f=0;f<c.length;f++){var h=c.data[f];b.setUniform3fv("origin",h.origin);F.bindView(h.origin,a,b);for(var k=0;k<h.tiles.length;k++){var l=h.tiles.data[k],m=l.renderData;d&&(this._bindOverlayTextures(b,
m.overlays,!0),b.setUniform1f("overlayOpacity",m.overlayOpacity));g&&e.setPipelineState(this._tileIntersectsStencilEnabledLayer(l)?this.stencilPipelineState:this.defaultPipelineState);e.bindVAO(m.vao);Q.assertCompatibleVertexAttributeLocations(m.vao,b);e.drawElements(4,0===this._skirtScale?m.geometryInfo.numWithoutSkirtIndices:m.vao.indexBuffer.size,m.vao.indexBuffer.indexType,0)}}e.bindVAO(null)};a.prototype._renderTiles=function(a,b,c){var d=a.rctx,e=a.camera,f=e.viewMatrix;d.setPipelineState(this.defaultPipelineState);
if(this.debugScreenSizePerspective&&this.pointsOfInterest){var g=I.getSettings("spherical"===this.manifold?"global":"local");g.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:e.fovY});F.bindScreenSizePerspective(g,b,"screenSizePerspective")}e=0<this.stencilEnabledLayerExtents.length;b.setUniform1f("skirtScale",this._skirtScale);for(g=0;g<c.length;g++){var h=c.data[g],k=h.tiles;if(0!==k.length){b.setUniform3fv("origin",h.origin);F.bindView(h.origin,f,b);var l=a.sliceHelper&&
a.sliceHelper.plane;l&&F.bindSlicePlane(h.origin,l,b);a.shadowMap&&a.shadowMap.bindView(b,h.origin);this.numOriginsRendered++;var h="debug"===this.wireframe.mode?1:4,m=this._highestVisibleLODTile,p=l=void 0;m?(l=m.vlevel,p=this.tileSize/this.wireframe.resolution):(l=16,p=this.tileSize/64);for(m=0;m<k.length;m++){var r=k.data[m],q=r.renderData;e&&d.setPipelineState(this._tileIntersectsStencilEnabledLayer(r)?this.stencilPipelineState:this.defaultPipelineState);G.trace("# RENDER TILE "+C.tile2str(r)+
", screenDepth:"+r.screenDepth);var v=q.geometryInfo.uvOffsetAndScale,u=q.texOffsetAndScale;n.vec4.set(R,v[0]*u[2]+u[0],v[1]*u[3]+u[1],v[2]*u[2],v[3]*u[3]);b.setUniform4fv("texOffsetAndScale",R);d.bindTexture(q.textureReference,0);b.setUniform1f("opacity",q.opacity);this._bindOverlayTextures(b,q.overlays,!1);b.setUniform1f("overlayOpacity",q.overlayOpacity);("shader"===this.wireframe.mode||this._drawBorders)&&b.setUniform1f("wireframe.subdivision",p*(1<<l-r.vlevel));v=0===this._skirtScale?q.geometryInfo.numWithoutSkirtIndices:
q.vao.indexBuffer.size;d.bindVAO(q.vao);Q.assertCompatibleVertexAttributeLocations(q.vao,b);d.drawElements(h,v,q.vao.indexBuffer.indexType,0);r.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=v/3;this._scaleQueriesForTile(r)}}}d.bindVAO(null)};a.prototype._bindOverlayTextures=function(a,b,c){for(var d=0;2>d;d++){var e=2*d,f=b[d],g=c?f.highlightRenderTargetId:f.renderTargetId;g?(g=this.drapedRenderer.getRenderTargetTexture(g),X[e]=f.texOffset[0],X[e+1]=f.texOffset[1],
J[e]=f.texScale[0],J[e+1]=f.texScale[1],this.rctx.bindTexture(g,1+d)):(X[e]=0,X[e+1]=0,J[e]=0,J[e+1]=0,this.rctx.bindTexture(this.emptyTex,1+d))}a.setUniform4fv("overlayTexOffset",X);a.setUniform4fv("overlayTexScale",J)};a.prototype.releaseTileGeometry=function(a){a.releaseGeometry()&&this.setNeedsRender();this.renderDataPool.release(a)};a.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&0<b.length;){var c=
b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};a.prototype._processScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};return a}();var W={mode:"none",width:1.5,falloff:1.5,wireOpacity:1,surfaceOpacity:0,color:[1,1,1,0],resolution:64},Z=p.vec3f64.create(),fa=p.vec3f64.create(),ga=p.vec3f64.create(),ja=p.vec3f64.create(),
ia=p.vec3f64.create(),ka="TerrainRenderer",da={type:"external"};return t})},"esri/views/3d/terrain/ResourceCounter":function(){define(["require","exports"],function(t,d){return function(){function d(){this._numTileTexturesComposited=0}Object.defineProperty(d.prototype,"numTileTexturesComposited",{get:function(){return this._numTileTexturesComposited},enumerable:!0,configurable:!0});d.prototype.incrementNumTileTexturesComposited=function(){this._numTileTexturesComposited++};d.prototype.resetNumTileTexturesComposited=
function(){this._numTileTexturesComposited=0};return d}()})},"esri/views/3d/terrain/TileRenderData":function(){define("require exports ../../../core/arrayUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/mathUtils ./TerrainConst ./TileGeometryFactory ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(){this.overlayTexOffset=l.vec2f64.create();this.texOffsetAndScale=f.vec4f64.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:e.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:f.vec4f64.create()}}d.prototype.init=function(a){this.tile=a;a=this.geometryInfo;a.indices=null;a.vertexAttributes=
null;e.empty(a.boundingBox);a.numSurfaceIndices=0;a.numSkirtIndices=0;a.numWithoutSkirtIndices=0;a.numVertsPerRow=0;this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1};this.textureReference=this._texture=this._vao=null;b.vec4.set(this.texOffsetAndScale,0,0,1,1);this.opacity=1;if(this.overlays){a=0;for(var c=this.overlays;a<c.length;a++){var d=c[a];d.renderTargetId=null;d.highlightRenderTargetId=null;g.vec2.set(d.texScale,1,1);g.vec2.set(d.texOffset,0,0)}}else for(this.overlays=
[null,null],a=0;2>a;a++)this.overlays[a]={renderTargetId:null,highlightRenderTargetId:null,texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};d.prototype.updateGeometry=function(a,b){if(!this._updateGeometryState(b))return!1;this._releaseGeometry();this._createGeometry(a,b);return!0};d.prototype.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0):!1};d.prototype.ensureTexture=
function(a,b){this._texture&&this._texture.descriptor.width!==b&&this.releaseTexture();this._texture||(this._texture=a(b),this.tile.updateMemoryUsed());return this._texture};d.prototype.releaseTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null);this.textureReference=null};d.prototype._updateGeometryState=function(a){var b=this._getElevationInfo(),d=this.tile.lij[0],e=8>d?this.tile.numSubdivisionsAtLevel[d]+1:2;b.samplerData&&(e=this.tile.maxTesselation,e=k.clamp((e>>Math.max(d-
b.maxTileLevel,c.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-d)))+1,2,e+1));d=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)d=null;var f=this.geometryState,g=!1;f.numVertsPerRow!==e&&(f.numVertsPerRow=e,g=!0);b.changed&&(f.samplerData=b.samplerData,g=!0);q.equals(f.clippingArea,d)||(f.clippingArea=d,g=!0);f.wireframe!==a&&(f.wireframe=a,g=!0);return g};d.prototype._createGeometry=function(a,b){this.tile.createGeometry(this.geometryState,this.localOrigin,
b);b=this.geometryInfo.indices;var c=a.gl;this._vao=new v(a,p.Default3D,{geometry:n.Pos3Tex},{geometry:u.createVertex(a,c.STATIC_DRAW,this.geometryInfo.vertexAttributes)},u.createIndex(a,c.STATIC_DRAW,b))};d.prototype._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;a.releaseGeometry(this.geometryInfo);return!0};Object.defineProperty(d.prototype,"vao",{get:function(){return this._vao},enumerable:!0,configurable:!0});d.prototype._getElevationInfo=function(){for(var a=
this.geometryState.samplerData,b=this.tile.layerInfo[c.LayerClass.ELEVATION],d=b.length,e=Array(d),f=0,g=0,k=!1,l=0;l<d;l++){var n=b[l];if(n.upsampleFromTile){var n=n.upsampleFromTile.tile,p=n.layerInfo[c.LayerClass.ELEVATION][l].data,p=p.samplerData;a&&a[f]===p||(k=!0);e[f++]=p;g=Math.max(g,n.lij[0])}else n.data&&(p=this.tile.surface.layerViewByIndex(l,c.LayerClass.ELEVATION),h.fallsWithinLayer(this.tile,p.layer,!1)&&(p=n.data,a&&a[f]===p.samplerData||(k=!0),e[f++]=p.samplerData,g=this.tile.lij[0]))}a&&
a.length!==f&&(k=!0);0<f?e.length=f:e=null;return{changed:k,samplerData:e,maxTileLevel:g}};Object.defineProperty(d.prototype,"estimatedGeometryMemoryUsage",{get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"textureDescriptor",{get:function(){return this._texture?this._texture.descriptor:null},enumerable:!0,configurable:!0});return d}();d.TileRenderData=t})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec4 ./TerrainConst ./terrainUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/shaders/MiscPrograms ../../vectorTiles/tileRendererHelper3D ../../vectorTiles/VectorTileDisplayObject ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/renderState ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w){var m=Array(20),x=[0,0],A={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIdx:0};return function(){function d(b,d,f,g,h){this._blackTex=this._backgroundTex=null;this.tileSize=256;this._context=b;this.tileSize=d;this._resourceCounter=g;this._setNeedsRender=h;b.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,b.parameters.maxMaxAnisotropy));d=new Float32Array(20);d[0]=-1;d[1]=-1;d[2]=0;d[3]=0;d[4]=0;d[5]=
1;d[6]=-1;d[7]=0;d[8]=1;d[9]=0;d[10]=-1;d[11]=1;d[12]=0;d[13]=0;d[14]=1;d[15]=1;d[16]=1;d[17]=0;d[18]=1;d[19]=1;this._vaoQuad=new w(b,e.Default3D,{geometry:k.Pos3Tex},{geometry:n.createVertex(b,35044,d)});this._blendLayersProgram=f.getProgram(a.blendLayers);this._blendLayersPipelineState=v.makePipelineState({blending:v.simpleBlendingParams(1,771),colorWrite:v.defaultColorWriteParams});this._applyOpacityPipelineState=v.makePipelineState({blending:v.simpleBlendingParams(0,770),colorWrite:v.defaultColorWriteParams});
this._blackTex=c.createColorTexture(this._context,[0,0,0,1])}d.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vtFBO&&(this._vtFBO.dispose(),this._vtFBO=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);this._backgroundTex&&(this._backgroundTex.dispose(),this._backgroundTex=null);this._blackTex&&(this._blackTex.dispose(),this._blackTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),this._blendLayersProgram=null);this._context=
null};d.prototype.updateTileTexture=function(a){for(var c=b.LayerClass.MAP,d=a.layerInfo[c],e=0;e<d.length;e++)d[e].pendingUpdates&=~b.TileUpdate.TEXTURE;if(a.renderData){var e=a.renderData,g=a.surface,h=g.baseOpacity,k=0,n=this.tileSize,p=!1,r,v=d.length;for(r=0;r<d.length&&!p;r++){var u=g.layerViewByIndex(r,c),x=u.fullOpacity;m[r]=x;this._isBaseLayer(u.layer)&&v>=d.length&&(v=r);if(0!==x){var w=this._getTileRenderInfo(a,r,A);w&&(f.isVectorTileLayerView(u)&&(n=Math.max(n,this.tileSize*u.view.pixelRatio)),
k++,u.isOpaque&&1===h&&1===x&&(p=!0))}}w=n;n=q.nextHighestPowerOfTwo(w);c=n*n;d=w*w;c===d?n=w:(w=n/2,n=c-d<d-w*w?n:w);c=n/this.tileSize;--r;0===k&&this._backgroundTex?(e.opacity=h,e.textureReference=this._backgroundTex,l.vec4.set(e.texOffsetAndScale,0,0,1,1)):1===k&&p?(e.opacity=h,w=this._getTileRenderInfo(a,r,A),this._dataToTexture(this._context,w,n,c)&&(e.textureReference=w.sourceLayerInfo.data,l.vec4.set(e.texOffsetAndScale,w.offset[0],w.offset[1],w.scale,w.scale))):(this._composeMapLayers(a,r,
v,p,m,n,c),l.vec4.set(e.texOffsetAndScale,0,0,1,1));this._setNeedsRender()}};d.prototype.setBackground=function(a){this._backgroundTex=a instanceof HTMLImageElement?this._buildTexture(a):c.createColorTexture(this._context,a||[0,0,0,0])};d.prototype._buildTexture=function(a){var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},d=this._context,e;if("number"===typeof a)b.width=b.height=a,e=new r(d,b);else try{e=
new r(d,b,a)}catch(L){e=c.createEmptyTexture(d),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}d.bindTexture(e);e.generateMipmap();return e};d.prototype._bindFBO=function(a,b,c,d){a&&a.width===b&&a.height===c||(a&&a.dispose(),a=u.create(this._context,{colorTarget:0,depthStencilTarget:d?1:0,width:b,height:c}));this._context.bindFramebuffer(a);return a};d.prototype._drawRasterData=function(a,b,c,d){void 0===d&&(d=1);var e=this._context,f=this._blendLayersProgram,
g=this._vaoQuad;e.bindProgram(f);e.bindVAO(g);y.assertCompatibleVertexAttributeLocations(g,f);e.bindTexture(a,0);f.setUniform1i("tex",0);f.setUniform1f("scale",b);f.setUniform2f("offset",c[0],c[1]);f.setUniform1f("opacity",d);e.drawArrays(5,0,y.vertexCount(g,"geometry"))};d.prototype._composeMapLayers=function(a,b,c,d,e,f,g){var h=this,k=a.renderData.ensureTexture(function(a){return h._buildTexture(a)},f),l=this._context;this._fbo=this._bindFBO(this._fbo,k.descriptor.width,k.descriptor.height,!1);
l.setViewport(0,0,f,f);l.setClearColor(0,0,0,0);l.setClearDepth(1);l.clearSafe(16384);!d&&this._backgroundTex&&(l.setPipelineState(this._blendLayersPipelineState),this._drawRasterData(this._backgroundTex,1,x));d=a.surface.baseOpacity;for(var m=!1;0<=b;b--){var n=this._getTileRenderInfo(a,b,A);n&&(b<c&&1>d&&!m&&(l.setPipelineState(this._applyOpacityPipelineState),this._drawRasterData(this._blackTex,1,x,d),m=!0),0!==e[b]&&this._dataToTexture(l,n,f,g)&&(l.setPipelineState(this._blendLayersPipelineState),
this._drawRasterData(n.sourceLayerInfo.data,n.scale,n.offset,e[b])))}l.bindTexture(k);l.gl.copyTexImage2D(l.gl.TEXTURE_2D,0,k.descriptor.pixelFormat,0,0,k.descriptor.width,k.descriptor.height,0);k.generateMipmap();l.bindFramebuffer(null);this._resourceCounter.incrementNumTileTexturesComposited();a.renderData.opacity=m?1:d;a.renderData.textureReference=k};d.prototype._dataToTexture=function(a,b,c,d){b&&b.sourceLayerInfo&&b.sourceLayerInfo.data instanceof p&&(this._vectorDataToTexture(a,b,c,d),b.tile.updateMemoryUsed());
a=b&&b.sourceLayerInfo&&b.sourceLayerInfo.data;if(a instanceof HTMLImageElement||a instanceof HTMLCanvasElement)this._rasterDataToTexture(b),b.tile.updateMemoryUsed();return b&&b.sourceLayerInfo&&b.sourceLayerInfo.data instanceof r};d.prototype._rasterDataToTexture=function(a){a=a.sourceLayerInfo;a.data=this._buildTexture(a.data)};d.prototype._vectorDataToTexture=function(a,c,d,e){var f=c.tile.surface.layerViewByIndex(c.layerIdx,b.LayerClass.MAP);this._vtFBO=this._bindFBO(this._vtFBO,d,d,!0);a.setClearColor(1,
1,1,0);a.clearSafe(16640);var g=c.sourceLayerInfo,k=g.data;h.renderVectorTile(this._context,c.sourceLod,k,f.renderer,f.schemaHelper,this.tileSize,this.tileSize,e);k.dispose();g.data=this._buildTexture(d);a.bindTexture(g.data);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,0,g.data.descriptor.pixelFormat,0,0,d,d,0);g.data.generateMipmap();a.bindFramebuffer(this._fbo)};d.prototype._getTileRenderInfo=function(a,c,d){var e=a.layerInfo[b.LayerClass.MAP][c];d.layerIdx=c;if(e.data)return g.vec2.set(d.offset,0,0),d.tile=
a,d.scale=1,d.sourceLod=a.lij,d.sourceLayerInfo=e,d;if(!e.upsampleFromTile)return null;a=e.upsampleFromTile;c=a.tile.layerInfo[b.LayerClass.MAP][c];d.tile=a.tile;g.vec2.copy(d.offset,a.offset);d.scale=a.scale;d.sourceLod=a.tile.lij;d.sourceLayerInfo=c;return d};d.prototype._isBaseLayer=function(a){return a.parent&&"esri.Basemap"===a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};return d}()})},"esri/views/vectorTiles/tileRendererHelper3D":function(){define("require exports ../../geometry ../../Viewpoint ../../core/has ../../core/libs/gl-matrix-2/mat4 ../2d/ViewState ../webgl/renderState".split(" "),
function(t,d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});d.renderVectorTile=function(d,e,f,g,q,r,y,w){if(r!==y)throw Error("It is expected that tiles are square!");var h=q.adjustLevel(e[0]);w={context:d,drawPhase:0,state:k,stationary:!0,pixelRatio:w,displayLevel:h,requiredLevel:h,drawphase:0,renderer:g,layerOpacity:1,globalOpacity:1};g.initializeProgramCache(d);h=q.getScale(e[0]);q=q.getShift(e,h);var n=q[1];f.tileTransform.displayCoord[0]=-1-q[0];f.tileTransform.displayCoord[1]=
1+n;q=f.tileTransform.transform;b.mat4.identity(q);h=.25*h/r;q[0]=h;q[5]=-h;w.state.size=[r,y];g.setStateParams(w.state,w.pixelRatio,e[0]);f.attachWithContext(d);d.setPipelineState(c);f.processRender(w);d.setPipelineState(a);w.drawphase=1;f.processRender(w);w.drawphase=2;f.processRender(w);l("esri-vector-tiles-debug")&&g.renderTileInfo(d,f)};var k=new f({viewpoint:new g({targetGeometry:new q.Point(0,0),scale:1,rotation:0}),size:[256,256]}),c=e.makePipelineState({depthTest:{func:515},depthWrite:e.defaultDepthWriteParams,
colorWrite:e.defaultColorWriteParams}),a=e.makePipelineState({blending:e.simpleBlendingParams(1,771),depthTest:{func:515},colorWrite:e.defaultColorWriteParams})})},"esri/views/2d/ViewState":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df32 ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f32 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w){var m=[0,0];return function(d){function f(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=d.apply(this,b)||this;b._viewpoint2D={center:r.vec2f64.create(),rotation:0,scale:0,spatialReference:null};b.center=[0,0];b.extent=new l.Extent;b.id=0;b.inverseTransform=h.mat2df64.create();b.resolution=0;b.rotation=0;b.scale=0;b.transform=h.mat2df64.create();b.transformNoRotation=h.mat2df64.create();b.displayMat3=n.mat3f32.create();b.displayViewMat3=
n.mat3f32.create();b.viewMat3=n.mat3f32.create();b.viewMat2d=a.mat2df32.create();b.worldScreenWidth=0;b.size=[0,0];return b}q(f,d);x=f;Object.defineProperty(f.prototype,"pixelRatio",{set:function(a){this._set("pixelRatio",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"size",{set:function(a){this._set("size",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewpoint",{set:function(a){if(a){var b=this._viewpoint2D,c=a.targetGeometry;
b.center[0]=c.x;b.center[1]=c.y;b.rotation=a.rotation;b.scale=a.scale;b.spatialReference=c.spatialReference}this._update()},enumerable:!0,configurable:!0});f.prototype.copy=function(a){var b=this.size,c=this.viewpoint;c&&b?(this.viewpoint=w.copy(c,a.viewpoint),this._set("size",u.vec2.copy(b,a.size))):(this.viewpoint=a.viewpoint.clone(),this._set("size",[a.size[0],a.size[1]]));this._set("pixelRatio",a.pixelRatio);return this};f.prototype.clone=function(){return new x({size:this.size,viewpoint:this.viewpoint.clone(),
pixelRatio:this.pixelRatio})};f.prototype.toMap=function(a,b,c){if(y.isVec2(b))return u.vec2.transformMat2d(a,b,this.inverseTransform);m[0]=b;m[1]=c;return u.vec2.transformMat2d(a,m,this.inverseTransform)};f.prototype.toScreen=function(a,b,c){if(y.isVec2(b))return u.vec2.transformMat2d(a,b,this.transform);m[0]=b;m[1]=c;return u.vec2.transformMat2d(a,m,this.transform)};f.prototype.toScreenNoRotation=function(a,b,c){if(y.isVec2(b))return u.vec2.transformMat2d(a,b,this.transformNoRotation);m[0]=b;m[1]=
c;return u.vec2.transformMat2d(a,m,this.transformNoRotation)};f.prototype.pixelSizeAt=function(a){return w.pixelSizeAt(a,this.viewpoint,this.size)};f.prototype.getScreenTransform=function(a,b){var c=this._viewpoint2D.center,d=this._get("pixelRatio")||1,e=this._get("size");w.getMatrix(a,c,e,b,0,d);return a};f.prototype._update=function(){var a=this._viewpoint2D,d=a.center,e=a.spatialReference,f=a.scale,g=a.rotation,a=this._get("pixelRatio")||1,h=this._get("size");this._set("id",this.id+1);var m=new b({targetGeometry:new l.Point(d[0],
d[1],e),scale:f,rotation:g});this._set("viewpoint",m);if(h&&e&&f)return this.resolution=w.getResolution(m),this.rotation=g,this.scale=f,this.spatialReference=e,u.vec2.copy(this.center,d),p.mat3.set(this.displayMat3,0!==h[0]?2/h[0]:0,0,0,0,0!==h[1]?-2/h[1]:0,0,-1,1,1),f=p.mat3.identity(this.viewMat3),d=v.vec2f32.fromValues(h[0]/2,h[1]/2),e=v.vec2f32.fromValues(-h[0]/2,-h[1]/2),g=k.common.toRadian(g),p.mat3.translate(f,f,d),p.mat3.rotate(f,f,g),p.mat3.translate(f,f,e),p.mat3.multiply(this.displayViewMat3,
this.displayMat3,f),f=c.mat2d.identity(this.viewMat2d),c.mat2d.translate(f,f,d),c.mat2d.rotate(f,f,g),c.mat2d.translate(f,f,e),w.getExtent(this.extent,m,h),w.getTransform(this.transform,m,h,a),c.mat2d.invert(this.inverseTransform,this.transform),w.getTransformNoRotation(this.transformNoRotation,m,h,a),this.worldScreenWidth=w.getWorldScreenWidth(this.spatialReference,this.resolution),this};var x;g([e.property({readOnly:!0})],f.prototype,"id",void 0);g([e.property({value:1,json:{write:!0}})],f.prototype,
"pixelRatio",null);g([e.property({json:{write:!0}})],f.prototype,"size",null);g([e.property({type:b,json:{write:!0}})],f.prototype,"viewpoint",null);return f=x=g([e.subclass("esri.views.2d.ViewState")],f)}(e.declared(f))})},"esri/core/libs/gl-matrix-2/common":function(){define(["require","exports","./math/common"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.common=q})},"esri/core/libs/gl-matrix-2/mat2d":function(){define(["require","exports","./math/mat2d"],function(t,d,q){Object.defineProperty(d,
"__esModule",{value:!0});d.mat2d=q})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["require","exports","./common"],function(t,d,q){function g(b,d,e){var f=d[0],c=d[1],a=d[2],g=d[3],l=d[4];d=d[5];var n=e[0],q=e[1],v=e[2],r=e[3],y=e[4];e=e[5];b[0]=f*n+a*q;b[1]=c*n+g*q;b[2]=f*v+a*r;b[3]=c*v+g*r;b[4]=f*y+a*e+l;b[5]=c*y+g*e+d;return b}function l(b,d,e){b[0]=d[0]-e[0];b[1]=d[1]-e[1];b[2]=d[2]-e[2];b[3]=d[3]-e[3];b[4]=d[4]-e[4];b[5]=d[5]-e[5];return b}Object.defineProperty(d,"__esModule",{value:!0});
d.copy=function(b,d){b[0]=d[0];b[1]=d[1];b[2]=d[2];b[3]=d[3];b[4]=d[4];b[5]=d[5];return b};d.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b};d.set=function(b,d,e,g,c,a,h){b[0]=d;b[1]=e;b[2]=g;b[3]=c;b[4]=a;b[5]=h;return b};d.invert=function(b,d){var e=d[0],f=d[1],c=d[2],a=d[3],g=d[4];d=d[5];var l=e*a-f*c;if(!l)return null;l=1/l;b[0]=a*l;b[1]=-f*l;b[2]=-c*l;b[3]=e*l;b[4]=(c*d-a*g)*l;b[5]=(f*g-e*d)*l;return b};d.determinant=function(b){return b[0]*b[3]-b[1]*b[2]};d.multiply=
g;d.rotate=function(b,d,e){var f=d[0],c=d[1],a=d[2],g=d[3],l=d[4];d=d[5];var n=Math.sin(e);e=Math.cos(e);b[0]=f*e+a*n;b[1]=c*e+g*n;b[2]=f*-n+a*e;b[3]=c*-n+g*e;b[4]=l;b[5]=d;return b};d.scale=function(b,d,e){var f=d[1],c=d[2],a=d[3],g=d[4],l=d[5],n=e[0];e=e[1];b[0]=d[0]*n;b[1]=f*n;b[2]=c*e;b[3]=a*e;b[4]=g;b[5]=l;return b};d.translate=function(b,d,e){var f=d[0],c=d[1],a=d[2],g=d[3],l=d[4];d=d[5];var n=e[0];e=e[1];b[0]=f;b[1]=c;b[2]=a;b[3]=g;b[4]=f*n+a*e+l;b[5]=c*n+g*e+d;return b};d.fromRotation=function(b,
d){var e=Math.sin(d);d=Math.cos(d);b[0]=d;b[1]=e;b[2]=-e;b[3]=d;b[4]=0;b[5]=0;return b};d.fromScaling=function(b,d){b[0]=d[0];b[1]=0;b[2]=0;b[3]=d[1];b[4]=0;b[5]=0;return b};d.fromTranslation=function(b,d){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=d[0];b[5]=d[1];return b};d.str=function(b){return"mat2d("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+")"};d.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+1)};d.add=
function(b,d,e){b[0]=d[0]+e[0];b[1]=d[1]+e[1];b[2]=d[2]+e[2];b[3]=d[3]+e[3];b[4]=d[4]+e[4];b[5]=d[5]+e[5];return b};d.subtract=l;d.multiplyScalar=function(b,d,e){b[0]=d[0]*e;b[1]=d[1]*e;b[2]=d[2]*e;b[3]=d[3]*e;b[4]=d[4]*e;b[5]=d[5]*e;return b};d.multiplyScalarAndAdd=function(b,d,e,g){b[0]=d[0]+e[0]*g;b[1]=d[1]+e[1]*g;b[2]=d[2]+e[2]*g;b[3]=d[3]+e[3]*g;b[4]=d[4]+e[4]*g;b[5]=d[5]+e[5]*g;return b};d.exactEquals=function(b,d){return b[0]===d[0]&&b[1]===d[1]&&b[2]===d[2]&&b[3]===d[3]&&b[4]===d[4]&&b[5]===
d[5]};d.equals=function(b,d){var e=b[0],f=b[1],c=b[2],a=b[3],g=b[4];b=b[5];var l=d[0],n=d[1],u=d[2],v=d[3],r=d[4];d=d[5];return Math.abs(e-l)<=q.EPSILON*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(f-n)<=q.EPSILON*Math.max(1,Math.abs(f),Math.abs(n))&&Math.abs(c-u)<=q.EPSILON*Math.max(1,Math.abs(c),Math.abs(u))&&Math.abs(a-v)<=q.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(g-r)<=q.EPSILON*Math.max(1,Math.abs(g),Math.abs(r))&&Math.abs(b-d)<=q.EPSILON*Math.max(1,Math.abs(b),Math.abs(d))};d.mul=
g;d.sub=l})},"esri/core/libs/gl-matrix-2/mat2df32":function(){define(["require","exports","./factories/mat2df32"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.mat2df32=q})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.create=function(){var d=new Float32Array(6);d[0]=1;d[3]=1;return d};d.clone=function(d){var g=new Float32Array(6);g[0]=d[0];g[1]=d[1];g[2]=d[2];g[3]=d[3];
g[4]=d[4];g[5]=d[5];return g};d.fromValues=function(d,g,l,b,f,e){var k=new Float32Array(6);k[0]=d;k[1]=g;k[2]=l;k[3]=b;k[4]=f;k[5]=e;return k};d.createView=function(d,g){return new Float32Array(d,g,6)}})},"esri/core/libs/gl-matrix-2/mat2df64":function(){define(["require","exports","./factories/mat2df64"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.mat2df64=q})},"esri/core/libs/gl-matrix-2/factories/mat2df64":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,
"__esModule",{value:!0});d.create=function(){return[1,0,0,1,0,0]};d.clone=function(d){return[d[0],d[1],d[2],d[3],d[4],d[5]]};d.fromValues=function(d,g,l,b,f,e){return[d,g,l,b,f,e]};d.createView=function(d,g){return new Float64Array(d,g,6)}})},"esri/core/libs/gl-matrix-2/mat3f32":function(){define(["require","exports","./factories/mat3f32"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.mat3f32=q})},"esri/core/libs/gl-matrix-2/factories/mat3f32":function(){define(["require","exports"],
function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.create=function(){var d=new Float32Array(9);d[0]=1;d[4]=1;d[8]=1;return d};d.clone=function(d){var g=new Float32Array(9);g[0]=d[0];g[1]=d[1];g[2]=d[2];g[3]=d[3];g[4]=d[4];g[5]=d[5];g[6]=d[6];g[7]=d[7];g[8]=d[8];return g};d.fromValues=function(d,g,l,b,f,e,k,c,a){var h=new Float32Array(9);h[0]=d;h[1]=g;h[2]=l;h[3]=b;h[4]=f;h[5]=e;h[6]=k;h[7]=c;h[8]=a;return h};d.createView=function(d,g){return new Float32Array(d,g,9)}})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["require",
"exports"],function(t,d){function q(d){return d instanceof Float32Array&&2<=d.length}function g(d){return Array.isArray(d)&&2<=d.length}Object.defineProperty(d,"__esModule",{value:!0});d.isVec2f32=q;d.isVec2f64=g;d.isVec2=function(d){return q(d)||g(d)}})},"esri/views/2d/viewpointUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Viewpoint ../../core/asyncUtils ../../core/promiseUtils ../../core/unitUtils ../../core/wgs84Constants ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/webMercatorUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x){function A(a,b,d,e){return e&&d&&!e.equals(d)&&m.canProject(e,d)&&e.isWebMercator?(e.isWebMercator?(d=b[1],89.99999<d?d=89.99999:-89.99999>d&&(d=-89.99999),d=Math.sin(c.common.toRadian(d)),a=p.vec2.set(a,c.common.toRadian(b[0])*V,.5*V*Math.log((1+d)/(1-d)))):(d=c.common.toDegree(b[0]/V),a=p.vec2.set(a,d-360*Math.floor((d+180)/360),c.common.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*b[1]/V))))),a):p.vec2.copy(a,b)}function C(a){return a.wkid?a:a.spatialReference||
y.WGS84}function B(a,b){return b.type?p.vec2.set(a,b.x,b.y):p.vec2.copy(a,b)}function E(a,b){return Math.max(a.width/b[0],a.height/b[1])*U(a.spatialReference)}function I(a,b,c,d){return g(this,void 0,void 0,function(){var e,g,h,k,l,n,p,x,w,y,A,t,C,B,J,z,E,R,T,G,F,L,V,O,X,W,N,U;return q(this,function(q){switch(q.label){case 0:if(!a||Array.isArray(a)&&!a.length)return[2,null];if(!Array.isArray(a)||!a.length||"object"!==typeof a[0])return[3,7];g=a.every(function(a){return"attributes"in a});h=a.some(function(a){return!a.geometry});
k=a;if(!(g&&h&&b&&b.allLayerViews))return[3,2];l=new Map;n=0;for(p=a;n<p.length;n++)x=p[n],w=x.layer,y=l.get(w)||[],A=x.attributes[w.objectIdField],null!=A&&y.push(A),l.set(w,y);t=[];l.forEach(function(a,c){var d=b.allLayerViews.find(function(a){return a.layer.id===c.id});if("queryFeatures"in d){var e=c.createQuery();e.objectIds=a;e.returnGeometry=!0;t.push(d.queryFeatures(e))}});return[4,f.all(t)];case 1:C=q.sent();B=[];J=0;for(z=C;J<z.length;J++)if((E=z[J])&&E.features&&E.features.length)for(R=
0,T=E.features;R<T.length;R++)x=T[R],x.geometry&&B.push(x.geometry);k=B;q.label=2;case 2:G=0,F=k,q.label=3;case 3:if(!(G<F.length))return[3,6];L=F[G];return[4,I(L,b,c,d)];case 4:d=q.sent(),q.label=5;case 5:return G++,[3,3];case 6:return[2,d];case 7:if(!Array.isArray(a)||2!==a.length||"number"!==typeof a[0]||"number"!==typeof a[1])return[3,8];e=new r(a);return[3,12];case 8:if(!(a instanceof v))return[3,9];e=a;return[3,12];case 9:if(!("geometry"in a))return[3,12];if(!a.geometry)return[3,10];e=a.geometry;
return[3,12];case 10:if(!a.layer)return[3,12];V=a.layer;O=b.allLayerViews.find(function(a){return a.layer.id===V.id});if(!("queryFeatures"in O))return[3,12];X=V.createQuery();X.objectIds=[a.attributes[V.objectIdField]];X.returnGeometry=!0;return[4,O.queryFeatures(X)];case 11:e=(W=q.sent())&&W.features&&W.features[0]&&W.features[0].geometry,q.label=12;case 12:if(!e)return[2,null];N="point"===e.type?new u({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference}):e.extent;if(!N)return[2,
null];U=m.canProject(N,c);if(!N.spatialReference.equals(c)&&U)N=m.project(N,c);else if(!U)return[2,null];d=d?d.union(N):N.clone();return[2,d]}})})}function G(a){if(a&&(!Array.isArray(a)||"number"!==typeof a[0])&&("object"===typeof a||Array.isArray(a)&&"object"===typeof a[0])){if("layer"in a&&a.layer&&a.layer.minScale&&a.layer.maxScale){var b=a.layer;return{min:b.minScale,max:b.maxScale}}if(Array.isArray(a)&&a.length&&a.every(function(a){return"layer"in a})){for(var c=0,d=0,e=0;e<a.length;e++)(b=a[e].layer)&&
b.minScale&&b.maxScale&&(c=b.minScale<c?b.minScale:c,d=b.maxScale>d?b.maxScale:d);return c&&d?{min:c,max:d}:null}}}function L(a,b){return g(this,void 0,void 0,function(){var c,d,e,f,g,h,k,p,v,w,y,t,J,R,F,L;return q(this,function(q){switch(q.label){case 0:if(!a)return[2,new l({targetGeometry:new r,scale:0,rotation:0})];c=b.spatialReference;d=b.size;e=b.viewpoint;f=b.constraints;g=null;"esri.Viewpoint"===a.declaredClass?g=a:a.viewpoint?g=a.viewpoint:a.target&&"esri.Viewpoint"===a.target.declaredClass&&
(g=a.target);h=null;if(!g||!g.targetGeometry)return[3,1];h=g.targetGeometry;return[3,10];case 1:if(!(a instanceof u))return[3,2];h=a;return[3,10];case 2:return a||a&&(a.hasOwnProperty("center")||a.hasOwnProperty("extent")||a.hasOwnProperty("target"))?[4,I(a.center,b,c)]:[3,10];case 3:return(v=q.sent())?[3,5]:[4,I(a.extent,b,c)];case 4:v=q.sent(),q.label=5;case 5:return(p=v)?[3,7]:[4,I(a.target,b,c)];case 6:p=q.sent(),q.label=7;case 7:return(k=p)?[3,9]:[4,I(a,b,c)];case 8:k=q.sent(),q.label=9;case 9:h=
k,q.label=10;case 10:!h&&e&&e.targetGeometry?h=e.targetGeometry:!h&&b.extent&&(h=b.extent);w=C(h);c||(c=C(b.spatialReference||b.extent||h));if(!x.canProject(h,c)&&w&&!w.equals(c))return[2,null];y=B(n.vec2f64.create(),h.center?h.center:h);t=new r(A(y,y,w,c),c);J=null;J=g&&g.targetGeometry&&"point"===g.targetGeometry.type?g.scale:a.hasOwnProperty("scale")&&a.scale?a.scale:a.hasOwnProperty("zoom")&&-1!==a.zoom&&f&&f.effectiveLODs?f.zoomToScale(a.zoom):Array.isArray(h)||"point"===h.type||"extent"===h.type&&
0===h.width&&0===h.height?b.extent&&m.canProject(b.extent,c)?E(m.project(b.extent,c),d):b.extent?E(b.extent,d):e.scale:m.canProject(h.extent,c)?E(m.project(h.extent,c),d):E(h.extent,d);if(R=G(a))R.min&&R.min>J?J=R.min:R.max&&R.max<J&&(J=R.max);F=0;g?F=g.rotation:a.hasOwnProperty("rotation")?F=a.rotation:e&&(F=e.rotation);L=new l({targetGeometry:t,scale:J,rotation:F});f&&(L=f.fit(L),f.rotationEnabled||(L.rotation=F));return[2,L]}})})}function F(a,b){var c=a.targetGeometry,d=b.targetGeometry;c.x=d.x;
c.y=d.y;c.spatialReference=d.spatialReference;a.scale=b.scale;a.rotation=b.rotation;return a}function K(a,b,c){return c?p.vec2.set(a,.5*(b[0]-c.right+c.left),.5*(b[1]-c.bottom+c.top)):p.vec2.scale(a,b,.5)}function M(b,c,e,f){d.getTransform(b,c,e,f);return a.mat2d.invert(b,b)}function Q(a,b,c){var d=O(b);b=Math.abs(Math.cos(d));d=Math.abs(Math.sin(d));return p.vec2.set(a,Math.round(c[1]*d+c[0]*b),Math.round(c[1]*b+c[0]*d))}function P(a){var b=a.scale;a=a.targetGeometry.spatialReference;a=w.isValid(a)?
1/(39.37*e.getMetersPerUnitForSR(a)*96):1;return b*a}function O(a){return c.common.toRadian(a.rotation)||0}function U(a){return w.isValid(a)?39.37*e.getMetersPerUnitForSR(a)*96:1}function N(a){return a.isWrappable?(a=w.getInfo(a),a.valid[1]-a.valid[0]):0}Object.defineProperty(d,"__esModule",{value:!0});var V=k.wgs84Radius,X=180/Math.PI;d.extentToScale=E;d.create=L;d.copy=F;d.getAnchor=K;d.getExtent=function(){var a=n.vec2f64.create();return function(b,c,d){var e=c.targetGeometry;B(a,e);c=.5*P(c);
b.xmin=a[0]-c*d[0];b.ymin=a[1]-c*d[1];b.xmax=a[0]+c*d[0];b.ymax=a[1]+c*d[1];b.spatialReference=e.spatialReference;return b}}();d.setExtent=function(a,b,c,e,f){d.centerAt(a,b,c.center);a.scale=E(c,e);f&&f.constraints&&f.constraints.constrain(a);return a};d.getOuterExtent=function(){var a=n.vec2f64.create(),b=n.vec2f64.create();return function(c,d,e){B(a,d.targetGeometry);Q(b,d,e);e=.5*P(d);c.set({xmin:a[0]-e*b[0],ymin:a[1]-e*b[1],xmax:a[0]+e*b[0],ymax:a[1]+e*b[1],spatialReference:d.targetGeometry.spatialReference});
return c}}();d.getOuterSize=Q;d.getPaddingScreenTranslation=function(){var a=n.vec2f64.create();return function(b,c,d){return p.vec2.sub(b,p.vec2.scale(b,c,.5),K(a,c,d))}}();d.getPaddingMapTranslation=function(){var b=h.mat2df64.create(),c=n.vec2f64.create();return function(e,f,g,h){var k=P(f);f=O(f);p.vec2.set(c,k,k);a.mat2d.fromScaling(b,c);a.mat2d.rotate(b,b,f);a.mat2d.translate(b,b,d.getPaddingScreenTranslation(c,g,h));a.mat2d.translate(b,b,[0,h.top-h.bottom]);return p.vec2.set(e,b[4],b[5])}}();
d.getResolution=P;d.getResolutionToScaleFactor=U;d.getMatrix=function(){var b=n.vec2f64.create(),c=n.vec2f64.create(),d=n.vec2f64.create();return function(e,f,g,h,k,l){p.vec2.negate(b,f);p.vec2.scale(c,g,.5*l);p.vec2.set(d,1/h*l,-1/h*l);a.mat2d.identity(e);a.mat2d.translate(e,e,c);k&&a.mat2d.rotate(e,e,k);a.mat2d.scale(e,e,d);a.mat2d.translate(e,e,b);return e}}();d.getTransform=function(){var a=n.vec2f64.create();return function(b,c,e,f){var g=P(c),h=O(c);B(a,c.targetGeometry);return d.getMatrix(b,
a,e,g,h,f)}}();d.getTransformNoRotation=function(){var a=n.vec2f64.create();return function(b,c,e,f){var g=P(c);B(a,c.targetGeometry);return d.getMatrix(b,a,e,g,0,f)}}();d.getWorldWidth=N;d.getWorldScreenWidth=function(a,b){return Math.round(N(a)/b)};d.createAsync=function(a,c){return b.safeCast(L(a,c))};d.angleBetween=function(){var a=n.vec2f64.create(),b=n.vec2f64.create(),c=[0,0,0];return function(d,e,f){p.vec2.subtract(a,d,e);p.vec2.normalize(a,a);p.vec2.subtract(b,d,f);p.vec2.normalize(b,b);
p.vec2.cross(c,a,b);d=Math.acos(p.vec2.dot(a,b)/(p.vec2.length(a)*p.vec2.length(b)))*X;0>c[2]&&(d=-d);isNaN(d)&&(d=0);return d}}();d.addPadding=function(){var a=n.vec2f64.create();return function(b,c,e,f){var g=b.targetGeometry;F(b,c);d.getPaddingMapTranslation(a,c,e,f);g.x+=a[0];g.y+=a[1];return b}}();d.removePadding=function(){var a=n.vec2f64.create();return function(b,c,e,f){var g=b.targetGeometry;F(b,c);d.getPaddingMapTranslation(a,c,e,f);g.x-=a[0];g.y-=a[1];return b}}();d.centerAt=function(){var a=
n.vec2f64.create();return function(b,c,d){F(b,c);c=b.targetGeometry;var e=C(d),f=C(c);B(a,d);A(a,a,e,f);c.x=a[0];c.y=a[1];return b}}();d.pixelSizeAt=function(a,b,c){return P(b)};d.resize=function(){var a=n.vec2f64.create();return function(b,c,e,f,g){g||(g="center");p.vec2.sub(a,e,f);p.vec2.scale(a,a,.5);e=a[0];f=a[1];switch(g){case "center":p.vec2.set(a,0,0);break;case "left":p.vec2.set(a,-e,0);break;case "top":p.vec2.set(a,0,f);break;case "right":p.vec2.set(a,e,0);break;case "bottom":p.vec2.set(a,
0,-f);break;case "top-left":p.vec2.set(a,-e,f);break;case "bottom-left":p.vec2.set(a,-e,-f);break;case "top-right":p.vec2.set(a,e,f);break;case "bottom-right":p.vec2.set(a,e,-f)}d.translateBy(b,c,a);return b}}();d.rotateBy=function(a,b,c){F(a,b);a.rotation+=c;return a};d.rotateTo=function(a,b,c){F(a,b);a.rotation=c;return a};d.scaleBy=function(){var a=n.vec2f64.create();return function(b,c,e,f,g){F(b,c);isNaN(e)||0===e||(d.toMap(a,f,c,g),b.scale=c.scale*e,d.toScreen(a,a,b,g),d.translateBy(b,b,p.vec2.set(a,
a[0]-f[0],f[1]-a[1])));return b}}();d.scaleTo=function(a,b,c){F(a,b);a.scale=c;return a};d.scaleAndRotateBy=function(){var a=n.vec2f64.create();return function(b,c,e,f,g,h){F(b,c);isNaN(e)||0===e||(d.toMap(a,g,c,h),b.scale=c.scale*e,b.rotation+=f,d.toScreen(a,a,b,h),d.translateBy(b,b,p.vec2.set(a,a[0]-g[0],g[1]-a[1])));return b}}();d.padAndScaleAndRotateBy=function(){var a=n.vec2f64.create(),b=n.vec2f64.create();return function(c,e,f,g,h,k,l){d.getPaddingScreenTranslation(b,k,l);p.vec2.add(a,h,b);
return g?d.scaleAndRotateBy(c,e,f,g,a,k):d.scaleBy(c,e,f,a,k)}}();d.toMap=function(){var a=h.mat2df64.create();return function(b,c,d,e){return p.vec2.transformMat2d(b,c,M(a,d,e,1))}}();d.toScreen=function(){var a=h.mat2df64.create();return function(b,c,e,f){return p.vec2.transformMat2d(b,c,d.getTransform(a,e,f,1))}}();d.translateBy=function(){var b=n.vec2f64.create(),c=h.mat2df64.create();return function(d,e,f){F(d,e);var g=P(e),h=d.targetGeometry;a.mat2d.fromRotation(c,O(e));a.mat2d.scale(c,c,n.vec2f64.fromValues(g,
g));p.vec2.transformMat2d(b,f,c);h.x+=b[0];h.y+=b[1];return d}}()})},"esri/views/3d/webgl-engine/shaders/TerrainRendererPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b=function(b){return l.glslifyDefineMap({OVERLAY:b.overlay,ATMOSPHERE:b.atmosphere,WIREFRAME_TEXTURE:b.wireframeTexture,TILE_BORDERS:b.tileBorders,RECEIVE_SHADOWS:b.receiveShadows,
SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,ALPHA_ZERO:b.alphaZero,BIAS_SHADOWMAP:b.shadowMap,SLICE:b.slice})};d.colorPass={name:"terrain-color",shaders:function(d){return{vertexShader:b(d)+g.resolveIncludes("terrainRenderer/colorPass.vert"),fragmentShader:b(d)+g.resolveIncludes("terrainRenderer/colorPass.frag")}},attributes:q.Default3D};d.normalPass={name:"terrain-normal",shaders:function(d){return{vertexShader:b(d)+g.resolveIncludes("terrainRenderer/normalPass.vert"),fragmentShader:b(d)+g.resolveIncludes("terrainRenderer/normalPass.frag")}},
attributes:q.Default3D};d.depthPass={name:"terrain-depth",shaders:function(d){return{vertexShader:b(d)+g.resolveIncludes("terrainRenderer/depthPass.vert"),fragmentShader:b(d)+g.resolveIncludes("terrainRenderer/depthPass.frag")}},attributes:q.Default3D};d.highlightPass={name:"terrain-highlight",shaders:function(d){return{vertexShader:b(d)+g.resolveIncludes("terrainRenderer/highlightPass.vert"),fragmentShader:b(d)+g.resolveIncludes("terrainRenderer/highlightPass.frag")}},attributes:q.Default3D}})},
"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TerrainConst","./TilePerLayerInfo"],function(t,d,q,g){return function(){function d(b,d){this.lij=b;this._pool=d;this.layerInfo=Array(q.LayerClass.COUNT);this.parent=null}d.prototype.hasDataAvailable=function(b,d,e){return(d=this.layerInfo[e][d].tilemap)?"unavailable"!==d.getAvailability(b.lij[1],b.lij[2]):!0};d.prototype.modifyLayers=function(b,d,e){b=this.layerInfo[e];for(var f=d.length,c=Array(f),a=0;a<f;a++){var h=
d[a];c[a]=-1<h?b[h]:g.TilePerLayerInfo.makeEmptyLayerInfo(e,this._pool)}this.layerInfo[e]=c};return d}()})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64"],function(t,d,q){return function(){function d(){this.offset=q.vec2f64.create();this.scale=0;this.tile=null}d.prototype.init=function(d,b,f,e){this.tile=d;this.offset[0]=b;this.offset[1]=f;this.scale=e};d.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=
this.offset[1]=0};return d}()})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error","../../core/has"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b={supportsMajorWebPerformanceCaveat:!1};d.check=function(d){d=q({},b,d);return l("esri-webgl")?!d.supportsMajorWebPerformanceCaveat&&l("esri-webgl-major-performance-caveat")?new g("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):
l("esri-webgl-high-precision-fragment")?l("esri-webgl-vertex-shader-samplers")?l("esri-webgl-element-index-uint")?l("esri-webgl-standard-derivatives")?l("esri-webgl-instanced-arrays")?null:new g("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new g("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new g("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):
new g("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new g("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new g("webgl:required","WebGL is required but not supported.")}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),
function(t,d,q,g,l,b){return function(b){function d(d){d=b.call(this)||this;d.components=["attribution","zoom","navigation-toggle","compass"];return d}q(d,b);g([l.property()],d.prototype,"components",void 0);return d=g([l.subclass("esri.views.ui.3d.DefaultUI3D")],d)}(l.declared(b))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){return function(d){function e(a){a=d.call(this)||this;a._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"};a.components=[];return a}q(e,d);e.prototype.initialize=function(){this._handles.add([l.init(this,"components",this._componentsWatcher.bind(this)),l.init(this,"view",this._updateViewAwareWidgets.bind(this))])};e.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),
a.destroy()})};e.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b.find(c))&&c.widget)&&void 0!==c.view&&c.set("view",a)})};e.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};e.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};e.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),
b._defaultPositionLookup[a])})};e.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new f({id:a,node:b})};e.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};e.prototype._createAttribution=function(){return new k({view:this.view})};e.prototype._createCompass=function(){return new c({view:this.view})};
e.prototype._createNavigationToggle=function(){return new a({view:this.view})};e.prototype._createZoom=function(){return new h({view:this.view})};g([b.property()],e.prototype,"components",void 0);return e=g([b.subclass("esri.views.ui.DefaultUI")],e)}(b.declared(e))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom dojo/dom-class ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b,f,e){return function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;a.widget=null;return a}q(c,d);c.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(c.prototype,"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"node",{set:function(a){var c=this._get("node");a!==c&&(a&&b.add(a,"esri-component"),
c&&b.remove(c,"esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});c.prototype.castNode=function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),l.byId(a);a&&"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};g([e.property()],c.prototype,"id",null);g([e.property()],c.prototype,"node",null);g([e.cast("node")],c.prototype,"castNode",null);
g([e.property({readOnly:!0})],c.prototype,"widget",void 0);return c=g([e.subclass("esri.views.ui.Component")],c)}(e.declared(f))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-class dojo/dom-construct dojo/dom-style ../../core/Accessor ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ../../widgets/support/widgetUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v){function r(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(u)||!("component"in a||"index"in a||"position"in a)?null:a}var y={left:0,top:0,bottom:0,right:0},w={bottom:30,top:15,right:15,left:15};return function(a){function d(b){b=a.call(this)||this;b._cornerNameToContainerLookup={};b._positionNameToContainerLookup={};b._components=[];b._handles=new h;b._componentToKey=new Map;b.view=null;b._initContainers();return b}g(d,a);d.prototype.initialize=
function(){this._handles.add([p.init(this,"view.padding, container",this._applyViewPadding.bind(this)),p.init(this,"padding",this._applyUIPadding.bind(this))])};d.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy();this._componentToKey.clear();this._componentToKey=null};Object.defineProperty(d.prototype,"container",{set:function(a){var b=this._get("container");a!==b&&(a&&(a.classList.add("esri-ui"),this._attachContainers(a)),
b&&(b.classList.remove("esri-ui"),e.set(b,{top:"",bottom:"",left:"",right:""}),c.empty(b)),this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",a):this._clearOverride("padding")},
enumerable:!0,configurable:!0});d.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:q({},w,a)};Object.defineProperty(d.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});d.prototype.add=function(a,b){var c=this,d,e;if(Array.isArray(a))a.forEach(function(a){return c.add(a,b)});else{var f=r(a);f&&(d=f.index,b=f.position,a=f.component,
e=f.key);b&&"object"===typeof b&&(d=b.index,e=b.key,b=b.position);!a||b&&!this._isValidPosition(b)||(a&&a.isInstanceOf&&a.isInstanceOf(u)||(a=new u({node:a})),this._place({component:a,position:b,index:d}),this._components.push(a),e&&this._componentToKey.set(a,e))}};d.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this.find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),d.node.parentNode&&
d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};d.prototype.empty=function(a){var c=this;if(Array.isArray(a))return a.map(function(a){return c.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!b.contains(a,"esri-ui-corner")}).map(function(a){return c.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this)};d.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,e=r(a)||r(b);e&&(d=e.index,b=e.position,a=e.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};d.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(u)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};d.prototype._getViewPadding=function(){return this.get("view.padding")||
y};d.prototype._attachContainers=function(a){a.appendChild(this._manualContainer);a.appendChild(this._innerContainer)};d.prototype._initContainers=function(){var a=f.create("div",{className:"esri-ui-inner-container esri-ui-corner-container"}),b=f.create("div",{className:"esri-ui-inner-container esri-ui-manual-container"}),c=f.create("div",{className:"esri-ui-top-left esri-ui-corner"},a),d=f.create("div",{className:"esri-ui-top-right esri-ui-corner"},a),e=f.create("div",{className:"esri-ui-bottom-left esri-ui-corner"},
a),g=f.create("div",{className:"esri-ui-bottom-right esri-ui-corner"},a);this._innerContainer=a;this._manualContainer=b;a=v.isRTL();this._cornerNameToContainerLookup={"top-left":c,"top-right":d,"bottom-left":e,"bottom-right":g,"top-leading":a?d:c,"top-trailing":a?c:d,"bottom-leading":a?g:e,"bottom-trailing":a?e:g};this._positionNameToContainerLookup=q({manual:b},this._cornerNameToContainerLookup)};d.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};d.prototype._place=
function(a){var b=a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];var d;-1<c?(d=Array.prototype.slice.call(a.children),0===c?this._placeComponent(b,a,"first"):c>=d.length?this._placeComponent(b,a,"last"):this._placeComponent(b,d[c],"before")):this._placeComponent(b,a,"last")};d.prototype._placeComponent=function(a,b,c){var d=a.widget;d&&!d._started&&"function"===typeof d.postMixInProperties&&"function"===typeof d.buildRendering&&"function"===typeof d.postCreate&&
"function"===typeof d.startup&&a.widget.startup();f.place(a.node,b,c)};d.prototype._applyViewPadding=function(){var a=this.container;a&&e.set(a,this._toPxPosition(this._getViewPadding()))};d.prototype._applyUIPadding=function(){this._innerContainer&&e.set(this._innerContainer,this._toPxPosition(this.padding))};d.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};d.prototype._toPxUnit=function(a){return 0===
a?0:a+"px"};d.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=d===a)&&(b=d);return c});return b};d.prototype._findById=function(a){var b=null,c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});return b};d.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};l([n.property()],d.prototype,"container",null);l([n.property({dependsOn:["view.height"]})],d.prototype,"height",null);
l([n.property({value:w})],d.prototype,"padding",null);l([n.cast("padding")],d.prototype,"castPadding",null);l([n.property()],d.prototype,"view",void 0);l([n.property({dependsOn:["view.width"]})],d.prototype,"width",null);return d=l([n.subclass("esri.views.ui.UI")],d)}(n.declared(k,a))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),
function(t,d,q,g,l,b,f,e,k,c){return function(a){function d(b){b=a.call(this)||this;b._isOpen=!1;b._attributionTextOverflowed=!1;b._prevSourceNodeHeight=0;b.iconClass="esri-icon-description";b.itemDelimiter=" | ";b.label=l.widgetLabel;b.view=null;b.viewModel=new k;return b}q(d,a);d.prototype.postInitialize=function(){var a=this;this.own(b.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(d.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,
b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0});d.prototype.render=function(){var a,b=(a={},a["esri-attribution--open"]=this._isOpen,a);return c.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",b),onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),c.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",c.tsx("a",{target:"_blank",href:"http://www.esri.com/",class:this.classes("esri-attribution__link",
"esri-widget__anchor")},"Esri")))};d.prototype._renderSourcesNode=function(){var a,b=this._isOpen,d=this._isInteractive(),e=d?0:-1,f=this.attributionText,g=d?"button":void 0,b=(a={},a["esri-attribution__sources--open"]=b,a["esri-interactive"]=d,a);return c.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",b),innerHTML:f,role:g,tabIndex:e})};d.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=
a.clientWidth};d.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};d.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};d.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};
g([f.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),c.renderable()],d.prototype,"attributionText",null);g([f.property()],d.prototype,"iconClass",void 0);g([f.property(),c.renderable()],d.prototype,"itemDelimiter",void 0);g([f.property()],d.prototype,"label",void 0);g([f.aliasOf("viewModel.view")],d.prototype,"view",void 0);g([f.property({type:k}),c.renderable(["state","view.size"])],d.prototype,"viewModel",void 0);g([c.accessibleHandler()],d.prototype,"_toggleState",
null);return d=g([f.subclass("esri.widgets.Attribution")],d)}(f.declared(e))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/Accessor ../../core/arrayUtils ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),function(t,d,q,g,l,
b,f,e,k,c,a,h,p){return function(b){function d(a){a=b.call(this,a)||this;a._handles=new k;a._pendingAttributionItemsByLayerId={};a._attributionDataByLayerId={};a.items=new e;a.view=null;a._updateAttributionItems=a._updateAttributionItems.bind(a);return a}q(d,b);d.prototype.initialize=function(){this._handles.add(c.init(this,"view",this._viewWatcher))};d.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?
"ready":"disabled"},enumerable:!0,configurable:!0});d.prototype._viewWatcher=function(a){var b=this,d=this._handles;d&&d.remove();a&&(d.add([a.allLayerViews.on("change",function(a){b._addLayerViews(a.added);0<a.removed.length&&(a.removed.forEach(function(a){d.remove(a.uid)}),b._updateAttributionItems())}),c.init(a,"stationary",this._updateAttributionItems)]),this._addLayerViews(a.allLayerViews))};d.prototype._addLayerViews=function(a){var b=this;a.forEach(function(a){b._handles.has(a.uid)||b._handles.add(c.init(a,
"suspended",b._updateAttributionItems),a.uid)})};d.prototype._updateAttributionItems=function(){var a=this,b=[];this._getActiveLayerViews().forEach(function(c){var d=c.layer;if(d&&"function"===typeof d.originOf&&"user"===d.originOf("copyright"))a._addIfUnique(b,{layer:d,text:d.copyright});else if(c=d.get("portalItem.accessInformation"))a._addIfUnique(b,{layer:d,text:c});else if(d.hasAttributionData){var e=a._attributionDataByLayerId;if(e[d.uid])a._addIfUnique(b,{layer:d,text:a._getDynamicAttribution(e[d.uid],
a.view,d)});else{var f=a._pendingAttributionItemsByLayerId;a._inProgress(f[d.uid])||(f[d.uid]=d.fetchAttributionData().then(function(b){b=a._createContributionIndex(b,a._isBingLayer(d));delete f[d.uid];e[d.uid]=b;a._updateAttributionItems()}))}}else a._addIfUnique(b,{layer:d,text:d.copyright})});this._itemsChanged(this.items,b)&&(this.items.removeAll(),this.items.addMany(b))};d.prototype._itemsChanged=function(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})};d.prototype._inProgress=
function(a){return a&&!a.isFulfilled()};d.prototype._getActiveLayerViews=function(){return this.get("view.allLayerViews").filter(function(a){return!a.suspended&&a.get("layer.attributionVisible")})};d.prototype._addIfUnique=function(a,b){var c=b.layer,d=b.text;d&&c&&(f.find(a,function(a){return a.layer===c&&a.text===d})||a.push({text:d,layer:c}))};d.prototype._isBingLayer=function(a){return"bing-maps"===a.type};d.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;
for(var d=0;d<a.length;d++){var e=a[d],f=e.coverageAreas;if(!f)return;for(var g=0;g<f.length;g++)for(var h=f[g],k=h.bbox,n=h.zoomMin-(b&&h.zoomMin?1:0),r=h.zoomMax-(b&&h.zoomMax?1:0),h={extent:p.geographicToWebMercator({xmin:k[1],ymin:k[0],xmax:k[3],ymax:k[2],spatialReference:l.SpatialReference.WGS84}),attribution:e.attribution||"",score:null!=h.score?h.score:100,id:d};n<=r;n++)c[n]=c[n]||[],c[n].push(h)}c.maxKey=Math.max.apply(null,Object.keys(c));return c};d.prototype._getDynamicAttribution=function(a,
b,c){var d=b.extent;c=c.tileInfo.scaleToZoom(b.scale);c=Math.min(a.maxKey,Math.round(c));if(!d||null==c||-1>=c)return"";a=a[c];var e=p.project(d.center.clone().normalize(),b.spatialReference),f={};return a.filter(function(a){var b=!f[a.id]&&e&&h.extentContainsPoint(a.extent,e);b&&(f[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", ")};g([a.property({readOnly:!0,type:e})],d.prototype,"items",void 0);g([a.property({dependsOn:["view.ready"],
readOnly:!0})],d.prototype,"state",null);g([a.property()],d.prototype,"view",void 0);return d=g([a.subclass("esri.widgets.Attribution.AttributionViewModel")],d)}(a.declared(b))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),function(t,d,q,g,l,b,f,e,k){return function(c){function a(a){a=
c.call(this)||this;a.goToOverride=null;a.iconClass="esri-icon-locate-circled";a.label=l.widgetLabel;a.view=null;a.viewModel=new e;return a}q(a,c);a.prototype.reset=function(){};a.prototype.render=function(){var a,b,c=this.viewModel,d=c.orientation,c=c.state,e="disabled"===c,f="compass"===("rotation"===c?"rotation":"compass"),c=e?-1:0,e=(a={},a["esri-disabled"]=e,a["esri-interactive"]=!e,a);a=(b={},b["esri-icon-compass"]=f,b["esri-icon-dial"]=!f,b);return k.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",
e),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:c,"aria-label":l.reset,title:l.reset},k.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(d)}),k.tsx("span",{class:"esri-icon-font-fallback-text"},l.reset))};a.prototype._reset=function(){this.viewModel.reset()};a.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}};g([b.aliasOf("viewModel.goToOverride")],a.prototype,"goToOverride",void 0);g([b.property()],
a.prototype,"iconClass",void 0);g([b.property()],a.prototype,"label",void 0);g([b.aliasOf("viewModel.view")],a.prototype,"view",void 0);g([b.property({type:e}),k.renderable(["viewModel.orientation","viewModel.state"])],a.prototype,"viewModel",void 0);g([b.aliasOf("viewModel.reset")],a.prototype,"reset",null);g([k.accessibleHandler()],a.prototype,"_reset",null);return a=g([b.subclass("esri.widgets.Compass")],a)}(b.declared(f))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),
function(t,d,q,g,l,b,f,e,k){return function(c){function a(a){a=c.call(this,a)||this;a._handles=new b;a.orientation={x:0,y:0,z:0};a.view=null;a._updateForCamera=a._updateForCamera.bind(a);a._updateForRotation=a._updateForRotation.bind(a);a._updateRotationWatcher=a._updateRotationWatcher.bind(a);return a}q(a,c);a.prototype.initialize=function(){this._handles.add(f.init(this,"view",this._updateRotationWatcher))};a.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(a.prototype,
"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return a&&(a.isWebMercator||a.isWGS84)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});a.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};a.prototype._updateForRotation=function(a){void 0!==
a&&null!==a&&(this.orientation={z:a})};a.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};a.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(f.init(this,"view.rotation",this._updateForRotation)):this._handles.add(f.init(this,"view.camera",this._updateForCamera)))};g([e.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],a.prototype,"canShowNorth",null);
g([e.property()],a.prototype,"orientation",void 0);g([e.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],a.prototype,"state",null);g([e.property()],a.prototype,"view",void 0);g([e.property()],a.prototype,"reset",null);return a=g([e.subclass("esri.widgets.CompassViewModel")],a)}(e.declared(l,k))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),
function(t,d,q,g,l,b,f,e,k){return function(c){function a(a){a=c.call(this)||this;a.iconClass="esri-icon-pan2";a.label=l.widgetLabel;a.view=null;a.viewModel=new e;return a}q(a,c);Object.defineProperty(a.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});a.prototype.toggle=function(){};a.prototype.render=function(){var a,b,c,d="disabled"===this.get("viewModel.state"),e="pan"===this.get("viewModel.navigationMode"),f=(a={},a["esri-disabled"]=
d,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,a);a=(b={},b["esri-navigation-toggle__button--active"]=e,b);b=(c={},c["esri-navigation-toggle__button--active"]=!e,c);c=d?-1:0;return k.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",f),onclick:this._toggle,onkeydown:this._toggle,tabIndex:c,"aria-label":l.toggle,title:l.toggle},k.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",
a)},k.tsx("span",{class:"esri-icon-pan"})),k.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--rotate",b)},k.tsx("span",{class:"esri-icon-rotate"})))};a.prototype._toggle=function(){this.toggle()};g([b.property()],a.prototype,"iconClass",void 0);g([b.property()],a.prototype,"label",void 0);g([b.property({value:"vertical"}),k.renderable()],a.prototype,"layout",null);g([b.aliasOf("viewModel.view"),k.renderable()],a.prototype,"view",void 0);
g([b.property({type:e}),k.renderable(["viewModel.state","viewModel.navigationMode"])],a.prototype,"viewModel",void 0);g([b.aliasOf("viewModel.toggle")],a.prototype,"toggle",null);g([k.accessibleHandler()],a.prototype,"_toggle",null);return a=g([b.subclass("esri.widgets.NavigationToggle")],a)}(b.declared(f))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b,f,e){return function(d){function c(a){a=d.call(this,a)||this;a._handles=new b;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}q(c,d);c.prototype.initialize=function(){this._handles.add(f.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};c.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(c.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":
"disabled"},enumerable:!0,configurable:!0});c.prototype.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};c.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};g([e.property({dependsOn:["view.ready"],readOnly:!0})],c.prototype,"state",null);g([e.property()],c.prototype,"navigationMode",void 0);g([e.property()],c.prototype,"view",void 0);
g([e.property()],c.prototype,"toggle",null);return c=g([e.subclass("esri.widgets.NavigationToggleViewModel")],c)}(e.declared(l))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(t,d,q,g,l,b,f,e,k,c){return function(a){function d(b){b=a.call(this)||this;b.iconClass="esri-icon-zoom-in-magnifying-glass";
b.label=l.widgetLabel;b.view=null;b.viewModel=new k;return b}q(d,a);d.prototype.postInitialize=function(){this._zoomInButton=new e({action:this.zoomIn,iconClass:"esri-icon-plus",title:l.zoomIn});this._zoomOutButton=new e({action:this.zoomOut,iconClass:"esri-icon-minus",title:l.zoomOut})};Object.defineProperty(d.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});d.prototype.render=function(){var a,b=this.viewModel,d=(a={},a["esri-zoom--horizontal"]=
"horizontal"===this.layout,a);this._zoomInButton.enabled="ready"===b.state&&b.canZoomIn;this._zoomOutButton.enabled="ready"===b.state&&b.canZoomOut;return c.tsx("div",{class:this.classes("esri-zoom esri-widget",d)},this._zoomInButton.render(),this._zoomOutButton.render())};d.prototype.zoomIn=function(){};d.prototype.zoomOut=function(){};g([b.property()],d.prototype,"iconClass",void 0);g([b.property()],d.prototype,"label",void 0);g([b.property({value:"vertical"}),c.renderable()],d.prototype,"layout",
null);g([b.aliasOf("viewModel.view"),c.renderable()],d.prototype,"view",void 0);g([b.property({type:k}),c.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],d.prototype,"viewModel",void 0);g([b.aliasOf("viewModel.zoomIn")],d.prototype,"zoomIn",null);g([b.aliasOf("viewModel.zoomOut")],d.prototype,"zoomOut",null);return d=g([b.subclass("esri.widgets.Zoom")],d)}(b.declared(f))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(t,d,q,g,l,b,f){return function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c.enabled=!0;c.iconClass="";c.title="";return c}q(d,b);d.prototype.render=function(){var b,a,d=this.enabled?0:-1,e=(b={},b["esri-disabled"]=!this.enabled,b["esri-interactive"]=this.enabled,b);b=(a={},a[this.iconClass]=!!this.iconClass,a);return f.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",e),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:d,
title:this.title},f.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",b)}),f.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};d.prototype._triggerAction=function(){this.action.call(this)};g([l.property()],d.prototype,"action",void 0);g([l.property(),f.renderable()],d.prototype,"enabled",void 0);g([l.property(),f.renderable()],d.prototype,"iconClass",void 0);g([l.property(),f.renderable()],d.prototype,"title",void 0);g([f.accessibleHandler()],d.prototype,
"_triggerAction",null);return d=g([l.subclass("esri.widgets.IconButton")],d)}(l.declared(b))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(t,d,q,g,l,b,f,e){return function(d){function c(a){a=d.call(this,a)||this;a.canZoomIn=null;a.canZoomOut=null;a.zoomIn=a.zoomIn.bind(a);a.zoomOut=
a.zoomOut.bind(a);return a}q(c,d);c.prototype.destroy=function(){this.view=null};Object.defineProperty(c.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new f({view:a}):"3d"===a.type&&(this._zoomConditions=new e):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});c.prototype.zoomIn=function(){this.canZoomIn&&
this._zoomToFactor(.5)};c.prototype.zoomOut=function(){this.canZoomOut&&this._zoomToFactor(2)};c.prototype._zoomToFactor=function(a){if("ready"===this.state){var b=this.view;"3d"===this.view.type?b.goTo({zoomFactor:1/a}):b.goTo({scale:this.get("view.scale")*a})}};g([b.property()],c.prototype,"_zoomConditions",void 0);g([b.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],c.prototype,"canZoomIn",void 0);g([b.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],c.prototype,"canZoomOut",
void 0);g([b.property({dependsOn:["view.ready"],readOnly:!0})],c.prototype,"state",null);g([b.property()],c.prototype,"view",null);g([b.property()],c.prototype,"zoomIn",null);g([b.property()],c.prototype,"zoomOut",null);return c=g([b.subclass("esri.widgets.Zoom.ZoomViewModel")],c)}(b.declared(l))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b){return function(d){function e(){return null!==d&&d.apply(this,arguments)||this}q(e,d);Object.defineProperty(e.prototype,"canZoomIn",{get:function(){var b=this.get("view.animation.target.scale")||this.get("view.scale"),c=this.get("view.constraints.effectiveMaxScale");return 0===c||b>c},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"canZoomOut",{get:function(){var b=this.get("view.animation.target.scale")||this.get("view.scale"),c=this.get("view.constraints.effectiveMinScale");
return 0===c||b<c},enumerable:!0,configurable:!0});g([b.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],e.prototype,"canZoomIn",null);g([b.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],e.prototype,"canZoomOut",null);g([b.property()],e.prototype,"view",void 0);return e=g([b.subclass("esri.widgets.Zoom.ZoomConditions2D")],e)}(b.declared(l))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b){return function(d){function e(){var b=null!==d&&d.apply(this,arguments)||this;b.canZoomIn=!0;b.canZoomOut=!0;return b}q(e,d);g([b.property({readOnly:!0})],e.prototype,"canZoomIn",void 0);g([b.property({readOnly:!0})],e.prototype,"canZoomOut",void 0);return e=g([b.subclass("esri.widgets.Zoom.ZoomConditions3D")],e)}(b.declared(l))})},"esri/layers/graphics/controllers/SnapshotController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Accessor ../../../core/Error ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/unitUtils ../../../core/accessorSupport/decorators ../../../geometry/support/scaleUtils ../../support/GraphicsManager ../../../views/3d/layers/graphics/Graphics3DVerticalScale".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r){var y=c.getLogger("esri.layers.graphics.controllers.SnapshotController");return function(a){function b(b){b=a.call(this)||this;b.type="snapshot";b._gManager=null;b._verticalScale=null;b._handles=new k;b._source=null;b._started=!1;b._pendingQueries=new Map;b.extent=null;b.hasAllFeatures=!1;b.hasFeatures=!1;b.layer=null;b.layerView=null;b.maxPageSize=null;b.defaultReturnZ=void 0;b.defaultReturnM=void 0;b.pageSize=null;b.paginationEnabled=!1;return b}q(b,a);
b.prototype.initialize=function(){var a=this,b=this.layer.when(function(){return a._verifyCapabilities()}).then(function(){return a._init()});this.addResolvingPromise(b)};b.prototype.destroy=function(){this.cancelQuery();this._gManager&&(this._gManager.destroy(),this._gManager=null);this._handles.destroy();this._pendingQueries=this._handles=null};Object.defineProperty(b.prototype,"updating",{get:function(){return!!(this._pendingQueries&&0<this._pendingQueries.size)},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"graphics",{set:function(a){var b=this._get("graphics");b!==a&&(this._handles.remove("graphics"),a&&(this._collectionChanged({added:a.toArray(),removed:b&&b.toArray()}),this._handles.add(a.on("change",this._collectionChanged.bind(this)),"graphics")),this._set("graphics",a))},enumerable:!0,configurable:!0});b.prototype.cancelQuery=function(){var a=this;this._pendingQueries&&(this._pendingQueries.forEach(function(b,c){b.isFulfilled()||b.cancel(Error(a._cancelErrorMsg))}),
this._pendingQueries.clear(),this.notifyChange("updating"))};b.prototype.refresh=function(){this.isResolved()&&this._started&&this._queryFeatures()};b.prototype.startup=function(){this._started||(this._started=!0,this._resolutionParams=this._getResolutionParams(),this._queryFeatures())};b.prototype.update=function(){this.startup()};b.prototype._init=function(){var a=this.layer;this.paginationEnabled=!!a.get("capabilities.query.supportsPagination");this._source=a.source;var b=a.maxRecordCount||4E3;
this.pageSize=null==this.maxPageSize?b:Math.min(b,this.maxPageSize);this._gManager=new v({graphics:this.graphics,objectIdField:a.objectIdField});this._verticalScale=new r({sourceSpatialReference:a.spatialReference,destSpatialReference:this.layerView.view.spatialReference});this._setupStateWatchers()};b.prototype._getResolutionParams=function(){var a=this.layer,b=a.get("capabilities.query.supportsQuantization"),c;if("polyline"===a.geometryType||"polygon"===a.geometryType){var d=p.getMetersPerUnit(this.layerView.view.spatialReference);
null!=d&&(c=this._featureResolution.scale,d=this._featureResolution.value/d,c=a.maxScale?a.maxScale:a.minScale?Math.min(c,a.minScale):Math.min(c,u.getScale(this.layerView.view,a.fullExtent)),c*=d/this._featureResolution.scale)}return c?{maxAllowableOffset:b?null:c,quantizationParameters:b?{mode:"view",originPosition:"upperLeft",tolerance:c,extent:a.fullExtent}:null}:null};b.prototype._setupStateWatchers=function(){var a=this;this._handles.add([this.watch("extent",this.refresh.bind(this)),this.layerView.watch("availableFields",
function(b,c){b&&c?-1===c.indexOf("*")&&(b.sort(),c.sort(),JSON.stringify(b)!==JSON.stringify(c)&&a.refresh()):a.refresh()}),this.layer.watch("definitionExpression, historicMoment",this.refresh.bind(this)),this.layer.on("edits",this._editsHandler.bind(this))])};b.prototype._createQueryParams=function(){var a=this.layer,b=this.layerView,c=a.createQuery();c.outSpatialReference=b.view.spatialReference;c.geometry=this.extent;c.outFields=b.availableFields;(a=a.capabilities&&a.capabilities.data)&&a.supportsZ&&
null==c.returnZ&&null!=this.defaultReturnZ&&(c.returnZ=this.defaultReturnZ);a&&a.supportsM&&null==c.returnM&&null!=this.defaultReturnM&&(c.returnM=this.defaultReturnM);c.set(this._resolutionParams);this.paginationEnabled&&(c.start=0,c.num=this.pageSize);return c};b.prototype._queryFeatures=function(){this.cancelQuery();this.hasAllFeatures=this.hasFeatures=!1;this._gManager.beginPagedUpdate();this.emit("query-start");this._executeQuery(this._createQueryParams())};b.prototype._executeQuery=function(a){var b=
this,c=this._source.queryFeatures(a).then(function(a){return a.unquantize()}),d=this._gManager.createIntentToAdd();this._querySetup(d,c);c.then(this._processFeatureSet.bind(this,a,d)).catch(function(a){return b._queryError(d,a)}).then(function(){return b._queryTeardown(d)},function(){return b._queryTeardown(d)})};b.prototype._processFeatureSet=function(a,b,c){var d=c.exceededTransferLimit,e=c.features,f=this._maxFeatures[this.layer.geometryType]||0,g=e?e.length:0,h=this._gManager.numGraphics+g,k=
h>=f;k&&(y.warn('Feature limit exceeded on layer "',this.layer.title,'". Not all features are shown.'),(f=h-f)&&e.splice(g-f,f));a=d&&this.paginationEnabled&&!k?this._queryNextPage(a):!1;this._verticalScale.adjust(e);e&&this._gManager.addPage(e,b);this.hasFeatures=!0;a||(this._gManager.endPagedUpdate(),this.hasAllFeatures=!d,this.emit("query-end",{success:!0}));return c};b.prototype._queryNextPage=function(a){a.start+=this.pageSize;this._executeQuery(a);return!0};b.prototype._queryError=function(a,
b){b&&"cancel"===b.dojoType&&!this.hasFeatures?this._gManager.revertPagedUpdate():this._gManager.endPagedUpdate();this.emit("query-end",{success:!1});if(b&&"cancel"===b.dojoType)return h.reject(b);a=new f("snapshotcontroller:tile-request-failed","Failed to query for features",{error:b});y.error(a);return h.reject(a)};b.prototype._querySetup=function(a,b){this._pendingQueries.set(a,b);this.notifyChange("updating")};b.prototype._queryTeardown=function(a){this._gManager.removeIntent(a);this._pendingQueries.delete(a);
this.notifyChange("updating")};b.prototype._processRefetch=function(a,b){(b=b.features)&&this._gManager.add(b,a)};b.prototype._refetchError=function(a,b){};b.prototype._verifyCapabilities=function(){if(!this.layer.get("capabilities.operations.supportsQuery"))throw new f("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:this.layer});};b.prototype._collectionChanged=function(a){var b=a.added;if(b)for(var c=0;c<b.length;c++)b[c].layer=
this.layer,b[c].sourceLayer=this.layer;if(b=a.removed)for(c=0;c<b.length;c++)b[c].layer=null,b[c].sourceLayer=null};b.prototype._editsHandler=function(a){var b=this,c=function(a){return a.objectId},d=a.deletedFeatures.map(c);this._gManager.delete(d);a=a.addedFeatures.concat(a.updatedFeatures).map(c);if(a.length){c=this._createQueryParams();c.objectIds=a;var c=this._source.queryFeatures(c),e=this._gManager.createIntentToAdd(a);this._querySetup(e,c);c.then(this._processRefetch.bind(this,e)).catch(this._refetchError.bind(this,
e)).then(function(){return b._queryTeardown(e)},function(){return b._queryTeardown(e)})}};g([n.shared("SnapshotController: query cancelled")],b.prototype,"_cancelErrorMsg",void 0);g([n.property({readOnly:!0})],b.prototype,"type",void 0);g([n.shared({value:.25,scale:945})],b.prototype,"_featureResolution",void 0);g([n.shared({point:16E3,multipoint:8E3,polyline:4E3,polygon:4E3,multipatch:4E3})],b.prototype,"_maxFeatures",void 0);g([n.property()],b.prototype,"_pendingQueries",void 0);g([n.property({dependsOn:["_pendingQueries"]})],
b.prototype,"updating",null);g([n.property()],b.prototype,"graphics",null);g([n.property()],b.prototype,"extent",void 0);g([n.property()],b.prototype,"hasAllFeatures",void 0);g([n.property()],b.prototype,"hasFeatures",void 0);g([n.property()],b.prototype,"layer",void 0);g([n.property()],b.prototype,"layerView",void 0);g([n.property()],b.prototype,"maxPageSize",void 0);g([n.property()],b.prototype,"defaultReturnZ",void 0);g([n.property()],b.prototype,"defaultReturnM",void 0);g([n.property()],b.prototype,
"pageSize",void 0);g([n.property()],b.prototype,"paginationEnabled",void 0);return b=g([n.subclass("esri.layers.graphics.controllers.SnapshotController")],b)}(n.declared(b,a,e))})},"esri/layers/support/GraphicsManager":function(){define(["../../core/Accessor"],function(t){var d=0;return t.createSubclass({constructor:function(){this._deletedGraphicsIndex=new Set;this._intentsIndex=new Map},destroy:function(){this.removeAll();this._intentsIndex=this._deletedGraphicsIndex=null},properties:{graphics:null,
indexById:{value:null,dependsOn:["graphics","objectIdField"],get:function(){return this._createIndexById(this.graphics&&this.graphics.toArray(),this.objectIdField)}},numGraphics:{value:0,dependsOn:["indexById"],get:function(){return this.indexById?this.indexById.size:0}},objectIdField:null,updating:{value:!1,dependsOn:["_intentsIndex"],get:function(){return!!(this._intentsIndex&&0<this._intentsIndex.size)}},_intentsIndex:{value:null}},_oldIndex:null,_deletedGraphicsIndex:null,beginPagedUpdate:function(){this._oldIndex=
this.indexById;this.indexById=null;this.notifyChange("numGraphics")},addPage:function(d,g){this.add(d,g)},revertPagedUpdate:function(){var d=this._removeLeftOnly(this.indexById,this._oldIndex);this.indexById=this._oldIndex;this._oldIndex=null;this.graphics.removeMany(d);this.notifyChange("numGraphics")},endPagedUpdate:function(){var d=this._removeLeftOnly(this._oldIndex,this.indexById);this._oldIndex=null;this.graphics.removeMany(d);this.notifyChange("numGraphics")},findGraphic:function(d){return(d=
this.indexById&&this.indexById.get(d))&&d.graphic},removeAll:function(){this.indexById=this._oldIndex=null;this.graphics.removeAll();this.notifyChange("numGraphics")},add:function(d,g){if(d&&d.length){for(var l=this.objectIdField,b=this.indexById=this.indexById||new Map,f=this._oldIndex,e=this._createIndexById(d,l),e=this._extractObjectIds(e),b=this._extractObjectIds(b),f=this._extractObjectIds(f),b=b.concat(f),k=[],c=b.length,f=0;f<c;f++){var a=b[f];-1<e.indexOf(a)&&k.push(a)}k.length&&this._remove(k,
!1);g=this.findIntent(g);e=new Map;b=d.length;for(f=0;f<b;f++)(k=d[f])&&k.attributes&&e.set(k.attributes[l],g);d.length&&this._add(d,e)}},remove:function(d){this._remove(d,!1)},delete:function(d){this._remove(d,!0)},isDeleted:function(d){return this._deletedGraphicsIndex.has(d)},createIntentToAdd:function(q){q&&this._intentsIndex.forEach(function(d,b){q.forEach(function(b){d.ignoredIds.add(b)})},this);var g=d++;this._intentsIndex.set(g,{ignoredIds:new Set});this.notifyChange("updating");return g},
findIntent:function(d){return this._intentsIndex.get(d)},removeIntent:function(d){this._intentsIndex.delete(d);this.notifyChange("updating")},update:function(d,g){if(d&&d.length){var l=this.objectIdField,b=this.indexById=this.indexById||new Map,f=this._oldIndex;d=this._createIndexById(d,l);for(var l=this._extractObjectIds(d),e=this._extractObjectIds(b),k=this._extractObjectIds(f),e=e.concat(k),k=[],c=e.length,a=0;a<c;a++){var h=e[a];if(-1===l.indexOf(h))k.push(h);else{var p=b.get(h)||f.get(h),p=p&&
p.graphic&&p.graphic._ts,n=d.get(h);(n&&n.graphic&&n.graphic._ts)>p&&k.push(h)}}b=[];f=l.length;for(a=0;a<f;a++)h=l[a],(-1===e.indexOf(h)||-1<k.indexOf(h))&&b.push(h);k.length&&this._remove(k,!1);b.length&&this._add(this._extractGraphics(b,d),g)}},_createIndexById:function(d,g){var l;if(d&&d.length&&g){var b,f,e;l=new Map;for(b=0;f=d[b];b++)e=f.attributes&&f.attributes[g],null!=e&&l.set(e,{graphic:f,refCount:1})}return l},_add:function(d,g){var l=this.objectIdField;d.forEach(function(b){var d=g.get(b.attributes&&
b.attributes[l]);this._addToIndex(b,this.indexById,d)},this);this.graphics.addMany(d);this.notifyChange("numGraphics")},_addToIndex:function(d,g,l){var b=d.attributes&&d.attributes[this.objectIdField];g&&null!=b&&(g.has(b)?l&&l.ignoredIds.has(b)||(l=g.get(b),g.set(b,{graphic:d,refCount:l.refCount+1})):this.isDeleted(b)||g.set(b,{graphic:d,refCount:1}))},_remove:function(d,g){d=d||[];d="object"===typeof d[0]?d.map(function(b){return b.attributes&&b.attributes[this.objectIdField]}.bind(this)):d;var l=
this._extractGraphics(d,this._oldIndex),b=this._extractGraphics(d,this.indexById);d.forEach(function(b){g&&this._deletedGraphicsIndex.add(b);this._removeFromIndex(b,this._oldIndex,g);this._removeFromIndex(b,this.indexById,g)}.bind(this));this.graphics.removeMany(l.concat(b));this.notifyChange("numGraphics")},_removeFromIndex:function(d,g,l){if(g&&g.has(d))if(l)g.delete(d);else{l=g.get(d);var b=l.refCount-1;0===b?g.delete(d):l.refCount=b}},_removeLeftOnly:function(d,g){var l=[];d&&d.forEach(function(b,
f){var e=b.graphic;!e||g&&g.has(f)||(--b.refCount,0===b.refCount&&d.delete(f),l.push(e))});return l},_extractGraphics:function(d,g){return d&&g?d.map(function(d){return(d=g.get(d))&&d.graphic}):[]},_extractObjectIds:function(d){var g=[];d&&d.forEach(function(d,b){g.push(b)});return g}})})},"esri/views/3d/layers/graphics/Graphics3DVerticalScale":function(){define(["require","exports","../../../../core/unitUtils"],function(t,d,q){return function(){function d(d){this.sourceSpatialReference=d.sourceSpatialReference;
this.destSpatialReference=d.destSpatialReference}d.prototype.adjust=function(d){var b=this._getVerticalUnitScale();1!==b&&this._scaleVerticalUnits(d,b)};d.prototype._getVerticalUnitScale=function(){if(this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)){var d=q.getMetersPerVerticalUnitForSR(this.sourceSpatialReference),b=q.getMetersPerVerticalUnitForSR(this.destSpatialReference);return d/b}return 1};d.prototype._vertexListsScaleZ=function(d,b){for(var f=0;f<
d.length;++f)for(var e=d[f],g=0;g<e.length;++g)e[g][2]*=b};d.prototype._scaleVerticalUnits=function(d,b){for(var f=0;f<d.length;++f){var e=d[f].geometry;e&&e.hasZ&&(this._geometryIsPoint(e)?null!==e.z&&(e.z*=b):this._geometryIsPolyline(e)?this._vertexListsScaleZ(e.paths,b):this._geometryIsPolygon(e)&&this._vertexListsScaleZ(e.rings,b))}};d.prototype._geometryIsPoint=function(d){return"point"===d.type};d.prototype._geometryIsPolygon=function(d){return"polygon"===d.type};d.prototype._geometryIsPolyline=
function(d){return"polyline"===d.type};return d}()})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../PopupTemplate ../renderers ../request ../core/Error ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/Field ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../support/popupUtils ../tasks/support/Query".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M,Q,P){function O(a,b,c){a&&((a=K.read(a,b,c)||void 0)||N.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var U=["3DObject","Point"],N=c.getLogger("esri.layers.SceneLayer"),V={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
X={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(c){function d(a,b){a=c.call(this)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=[];a.definitionExpression=null;a.path=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=
!0;return a}g(d,c);d.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?q({url:a},b):a};d.prototype.getField=function(a){return E.getField(this.fields,a)};Object.defineProperty(d.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"geometryType",{get:function(){return X[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"renderer",{set:function(a){E.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});d.prototype.readCachedDrawingInfo=function(a,b){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};Object.defineProperty(d.prototype,"defaultPopupTemplate",{get:function(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null},enumerable:!0,configurable:!0});d.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===
b.type&&(a=b.name);return!!a});return a||void 0};d.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&V[a])return V[a];N.error("Unknown or missing profile",{profile:a,layer:this});return"mesh-pyramids"};d.prototype.load=function(){var b=this,c=this.loadFromPortal({supportedTypes:["Scene Service"]}).then(function(){return b._fetchService()},function(){return b._fetchService()}).then(function(){return a.all([b._verifyRootNodeAndUpdateExtent(),b._setAssociatedFeatureLayer()])}).then(function(){return b._validateElevationInfo()}).then(function(){return b._applyAssociatedLayerOverrides()}).then(function(){return b._populateFieldUsageInfo()}).then(function(){return M.loadStyleRenderer(b,
{origin:"service"})}).then(function(){return E.fixRendererFields(b.renderer,b.fields)});this.addResolvingPromise(c);return this.when()};d.prototype.createLayerView=function(b){var c=this;return(null==this.profile||"mesh-pyramids"===this.profile?a.create(function(a){return t(["../views/3d/layers/SceneLayerView3D"],a)}):a.create(function(a){return t(["../views/3d/layers/SceneLayerGraphicsView3D"],a)})).then(function(a){return new a({view:b,layer:c})})};d.prototype.createQuery=function(){var a=new P;
"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};d.prototype.queryExtent=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryExtent(a||b.createQuery())})};d.prototype.queryFeatureCount=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatureCount(a||b.createQuery())})};d.prototype.queryFeatures=function(a){var b=this;
return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features)for(var c=0,d=a.features;c<d.length;c++){var e=d[c];e.layer=b;e.sourceLayer=b}return a})};d.prototype.queryObjectIds=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryObjectIds(a||b.createQuery())})};d.prototype.getFieldUsageInfo=function(a){var b={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,
supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||b:(N.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),b)};d.prototype.createPopupTemplate=function(a){return Q.createPopupTemplate(this,a)};d.prototype._getAssociatedLayerForQuery=function(){var b=this;if(!this.loaded)return this.load().then(function(){return b._getAssociatedLayerForQuery()});var c=this.associatedLayer;return null!=c?a.resolve(c):a.reject(new k("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))};
d.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};d.prototype.queryCachedStatistics=function(b){if(!this.hasCachedStatistics(b))return a.reject(new k("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var c=0,d=this.statisticsInfo;c<d.length;c++){var f=d[c];if(f.name===b)return b=h.join(this.parsedUrl.path,f.href),e(b,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};
d.prototype._validateLayer=function(a){if(a.layerType&&-1===U.indexOf(a.layerType))throw new k("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new k("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new k("layer:service-version-too-new","Service version is too new.",
{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,c=!1,d=!1;if(null==a)d=c=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":c=!0;d=b;break;case "vertex-reference-frame":c=!0;d=!b;break;default:c=!1}if(!c)throw new k("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!d)throw new k("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");
};d.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||d,supportsLayerQuery:d}},b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};d.prototype._applyAssociatedLayerOverrides=
function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var a=0,b=this.associatedLayer.fields;a<b.length;a++){var c=b[a];this.getField(c.name)||this.fields.push(c.clone())}a=["popupTemplate","popupEnabled"];b=v.getProperties(this);for(c=0;c<a.length;c++){var d=a[c];this._buddyIsMoreImportant(d)&&(b.setDefaultOrigin(this.associatedLayer.originOf(d)),b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}}};d.prototype._setAssociatedFeatureLayer=function(){var a=this;return this._fetchAssociatedFeatureLayer().then(function(b){a.associatedLayer=
b})};d.prototype._fetchAssociatedFeatureLayer=function(){var b=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?a.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchAssociatedFeatureLayerFromRelatedItems(this.portalItem):this._fetchAssociatedFeatureLayerFromUrl()).then(function(a){return a.load()}).catch(function(a){p.whenValidOnce(b,["popupTemplate","popupEnabled"],function(){return b.popupEnabled&&null!=b.popupTemplate}).then(function(){return function(){var a=
"this SceneLayer: "+b.title;null==b.attributeStorageInfo?N.warn("Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on "+a):N.info("Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on "+a)}});return null})};d.prototype._fetchAssociatedFeatureLayerFromRelatedItems=function(b){var c=this;return b.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"}).then(function(b){return(b=b.filter(function(a){return"Feature Service"===
a.type})[0])?c._fetchAssociatedFeatureLayerFromPortalItem(new F({id:b.id,portal:b.portal})):a.reject()}).catch(function(){return c._fetchAssociatedFeatureLayerFromUrl()})};d.prototype._fetchAssociatedFeatureLayerFromPortalItem=function(b){var c=this;return b.load().then(function(a){return c._findMatchingAssociatedSublayerUrl(a.url)}).then(function(c){return a.resolve(new r({url:c,portalItem:b}))})};d.prototype._fetchAssociatedFeatureLayerFromUrl=function(){return this._findMatchingAssociatedSublayerUrl().then(function(b){return a.resolve(new r({url:b}))})};
d.prototype._findMatchingAssociatedSublayerUrl=function(b){var c=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!c)return a.reject();null==b&&(b=c[1]+"/FeatureServer");var d=b.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");b={query:{f:"json"},responseType:"json"};var f=c[1]+"/SceneServer",g=parseInt(c[2],10),c=e(f,b).catch(function(a){return{data:{layers:null}}});b=e(d,b);return a.all([b,c]).then(function(a){var b=a[0];a=a[1];a=a.data&&a.data.layers;b=b.data&&b.data.layers;
if(!Array.isArray(b))throw Error("expected layers array");if(Array.isArray(a))for(var c=0;c<Math.min(a.length,b.length);c++){if(a[c].id===g)return d+"/"+b[c].id}else if(g<b.length)return d+"/"+b[g].id;throw Error("could not find matching associated sublayer");})};d.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=u.nameToId(this.originOf(a));a=u.nameToId(this.associatedLayer.originOf(a));return null!=a&&a<=u.OriginId.SERVICE?null==b||b<u.OriginId.SERVICE:null!=a&&
a<=u.OriginId.PORTAL_ITEM?null==b||b<u.OriginId.PORTAL_ITEM:!1};d.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&N.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&N.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};l([n.shared("esri.layers.SceneLayer")],d.prototype,"declaredClass",
void 0);l([n.property({types:{key:"type",base:A.default,typeMap:{selection:C.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],d.prototype,"featureReduction",void 0);l([n.property({type:[L.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],d.prototype,"rangeInfos",void 0);l([n.property({json:{read:!1}})],d.prototype,"associatedLayer",
void 0);l([n.property({type:["show","hide"]})],d.prototype,"listMode",void 0);l([n.property({type:["ArcGISSceneServiceLayer"]})],d.prototype,"operationalLayerType",void 0);l([n.property({json:{read:!1},readOnly:!0})],d.prototype,"type",void 0);l([n.property({type:[B]})],d.prototype,"fields",void 0);l([n.property({readOnly:!0})],d.prototype,"attributeStorageInfo",void 0);l([n.property({readOnly:!0})],d.prototype,"statisticsInfo",void 0);l([n.property({type:String,json:{origins:{service:{read:!1,write:!1}},
read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],d.prototype,"definitionExpression",void 0);l([n.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],d.prototype,"path",void 0);l([n.property(m.elevationInfo)],d.prototype,"elevationInfo",null);l([n.property({type:String,dependsOn:["profile"]})],d.prototype,"geometryType",null);l([n.property(m.labelsVisible)],d.prototype,"labelsVisible",void 0);l([n.property({type:[I],
json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:G.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:G.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],d.prototype,"labelingInfo",void 0);l([n.property(m.legendEnabled)],d.prototype,"legendEnabled",void 0);l([n.property({types:f.rendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:O}}},read:{source:"layerDefinition.drawingInfo.renderer",
reader:O},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],d.prototype,"renderer",null);l([n.property({json:{read:!1}})],d.prototype,"cachedDrawingInfo",void 0);l([n.reader("service","cachedDrawingInfo")],d.prototype,"readCachedDrawingInfo",null);l([n.property(m.popupEnabled)],d.prototype,"popupEnabled",void 0);l([n.property({type:b,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],d.prototype,"popupTemplate",void 0);l([n.property({readOnly:!0,json:{read:!1},dependsOn:["fields",
"title","attributeStorageInfo","associatedLayer"]})],d.prototype,"defaultPopupTemplate",null);l([n.property({type:String,json:{read:!1}})],d.prototype,"objectIdField",void 0);l([n.reader("service","objectIdField",["objectIdField","fields"])],d.prototype,"readObjectIdField",null);l([n.property({json:{read:!1}})],d.prototype,"objectIdFilter",void 0);l([n.property({type:String,json:{read:!1}})],d.prototype,"profile",void 0);l([n.reader("service","profile",["store.profile"])],d.prototype,"readProfile",
null);l([n.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],d.prototype,"normalReferenceFrame",void 0);l([n.property(x.screenSizePerspectiveEnabled)],d.prototype,"screenSizePerspectiveEnabled",void 0);return d=l([n.subclass()],d)}(n.declared(y,w))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/Error ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../Layer ./ArcGISService ./OperationalLayer ./PortalLayer ../support/arcgisLayerUrl ../support/commonProperties".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m){var x=f.getLogger("esri.layers.mixins.SceneService");return function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}q(e,d);e.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};
e.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return n.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new n(a):null};e.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent||!Array.isArray(a.extent)||a.extent.some(function(a){return-1E38>a})?null:new h({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],
spatialReference:b})};e.prototype.readVersion=function(a,b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};e.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a};e.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return w.titleFromUrlAndName(this.url,
b.name);b=b.name||w.parse(this.url).title;"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return w.cleanTitle(b)};e.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(e.prototype,"url",{set:function(a){a=w.sanitizeUrlWithLayerId(this,a,x);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});e.prototype.writeUrl=function(a,b,c,d){w.writeUrlWithLayerId(this,a,"layers",b,d)};Object.defineProperty(e.prototype,
"parsedUrl",{get:function(){var a=this._get("url");if(!a)return null;a=c.urlToObject(a);null!=this.layerId&&w.match.test(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});e.prototype.readRootNode=function(a,b){return b.store.rootNode};e.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(b){return a._updateExtentFromRootNode(b)})};e.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&
!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};e.prototype._fetchRootNode=function(){if(!this.rootNode)return k.resolve();var a=c.join(this.parsedUrl.path,this.rootNode);return l(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).catch(function(c){throw new b("sceneservice:root-node-missing","Root node missing.",{error:c,url:a});})};e.prototype._fetchService=function(){var a=
this;return(null==this.layerId&&/SceneServer\/*$/i.test(this.url)?this._fetchFirstLayerId().then(function(b){null!=b&&(a.layerId=b)}):k.resolve()).then(function(){return a._fetchServiceLayer()})};e.prototype._fetchFirstLayerId=function(){return l(this.url,{query:{f:"json"},responseType:"json"}).then(function(a){if(a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length)return a.data.layers[0].id})};e.prototype._fetchServiceLayer=function(){var a=this;return l(this.parsedUrl.path,{query:{f:"json"},
responseType:"json"}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));b=b.data;a.read(b,{origin:"service",url:a.parsedUrl});a._validateLayer(b)})};e.prototype._validateLayer=function(a){};g([a.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],e.prototype,"properties",void 0);g([a.property({type:n})],e.prototype,"spatialReference",void 0);g([a.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readSpatialReference",
null);g([a.property({type:h})],e.prototype,"fullExtent",void 0);g([a.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readFullExtent",null);g([a.property({readOnly:!0,type:p})],e.prototype,"heightModelInfo",void 0);g([a.property({readOnly:!0})],e.prototype,"version",void 0);g([a.reader("version",["store.version"])],e.prototype,"readVersion",null);g([a.property({type:String,json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",
void 0);g([a.property({type:String,json:{read:!1}})],e.prototype,"sublayerTitleMode",void 0);g([a.property({type:String})],e.prototype,"title",void 0);g([a.reader("portal-item","title")],e.prototype,"readTitlePortalItem",null);g([a.reader("service","title",["name"])],e.prototype,"readTitleService",null);g([a.property({type:Number})],e.prototype,"layerId",void 0);g([a.reader("service","layerId",["id"])],e.prototype,"readLayerId",null);g([a.property(m.url)],e.prototype,"url",null);g([a.writer("url")],
e.prototype,"writeUrl",null);g([a.property({dependsOn:["layerId"]})],e.prototype,"parsedUrl",null);g([a.property()],e.prototype,"store",void 0);g([a.property({type:String})],e.prototype,"rootNode",void 0);g([a.reader("rootNode",["store.rootNode"])],e.prototype,"readRootNode",null);return e=g([a.subclass("esri.layers.mixins.SceneService")],e)}(a.declared(u,v,e,r,y))})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function e(){var b=null!==d&&d.apply(this,arguments)||this;b.name=null;b.field=null;b.currentRangeExtent=null;b.fullRangeExtent=null;b.type="rangeInfo";return b}q(e,d);g([b.property({type:String,json:{read:!0,write:!0}})],e.prototype,"name",void 0);g([b.property({type:String,json:{read:!0,write:!0}})],e.prototype,"field",void 0);g([b.property({type:[Number],json:{read:!0,write:!0}})],e.prototype,"currentRangeExtent",
void 0);g([b.property({type:[Number],json:{read:!0,write:!0}})],e.prototype,"fullRangeExtent",void 0);g([b.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],e.prototype,"type",void 0);return e=g([b.subclass("esri.layers.support.RangeInfo")],e)}(b.declared(l));d.RangeInfo=t;d.default=t})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./TiledLayerView3D ./support/tiledLayerUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c){return function(a){function d(){return null!==a&&a.apply(this,arguments)||this}q(d,a);d.prototype.initialize=function(){var a=this,d=this.get("view.map.ground.layers"),e=this.get("view.map.allLayers"),e=e&&e.includes(this.layer),d=d&&d.includes(this.layer);e&&!d&&(d=new l("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(b.reject(d)));(d=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent))?
this.addResolvingPromise(b.reject(d)):(d=f.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){c.throwIfError(a._getTileInfoCompatibilityError(a.tileInfo,a.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(d));this.addResolvingPromise(c.checkArcGISServiceVersionCompatibility(this.layer));this._updateMinMaxDataLevel()};g([e.property({aliasOf:"layer.fullExtent"})],d.prototype,"fullExtent",void 0);g([e.property()],d.prototype,"layer",void 0);g([e.property({aliasOf:"layer.tileInfo"})],
d.prototype,"tileInfo",void 0);return d=g([e.subclass("esri.views.3d.layers.ElevationLayerView3D")],d)}(e.declared(k))})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/accessorSupport/decorators ./LayerView3D ./support/layerViewUpdatingProperties ../terrain/terrainUtils".split(" "),function(t,d,q,g,l,b,f,e,k){return function(c){function a(){var a=null!==
c&&c.apply(this,arguments)||this;a.minDataLevel=0;a.maxDataLevel=Infinity;a._isUpdating=!1;return a}q(a,c);Object.defineProperty(a.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isOpaque",{get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0});a.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};a.prototype.updatingChanged=function(a){this._isUpdating=
a;this.notifyChange("updating")};a.prototype.isUpdating=function(){return this._isUpdating};a.prototype._getTileInfoSupportError=function(a,b){if(a=k.checkIfTileInfoSupportedForView(a,b,this.view.spatialReference,this.view.basemapTerrain.manifold)){b={layer:this.layer,error:a};var c=void 0;switch(a.name){case "tilingscheme:local-gcs-not-supported":c=new l("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",b);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":c=
new l("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",b);break;default:c=new l("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",b)}return c}return null};a.prototype._getTileInfoCompatibilityError=function(a,b){return b.compatibleWith(a)?null:new l("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};
a.prototype._updateMinMaxDataLevel=function(){var a,b=Infinity,c=0;this.tileInfo.lods.forEach(function(a){b=Math.min(a.level,b);c=Math.max(a.level,c)});a=[b,c];this.minDataLevel=a[0];this.maxDataLevel=a[1]};g([b.property({readOnly:!0})],a.prototype,"imageFormatIsOpaque",null);g([b.property(e.updatingPercentage)],a.prototype,"updatingPercentage",void 0);g([b.property(e.updatingPercentageValue)],a.prototype,"updatingPercentageValue",void 0);g([b.property()],a.prototype,"fullExtent",void 0);g([b.property({readOnly:!0,
dependsOn:["fullOpacity","imageFormatIsOpaque"]})],a.prototype,"isOpaque",null);g([b.property()],a.prototype,"layer",void 0);g([b.property()],a.prototype,"minDataLevel",void 0);g([b.property()],a.prototype,"maxDataLevel",void 0);g([b.property()],a.prototype,"tileInfo",void 0);return a=g([b.subclass("esri.views.3d.layers.TiledLayerView3D")],a)}(b.declared(f))})},"esri/views/3d/layers/LayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/heightModelInfoUtils ../../layers/LayerView".split(" "),
function(t,d,q,g,l,b,f,e,k){return function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.slicePlaneEnabled=!1;a.supportsHeightUnitConversion=!1;return a}q(a,c);a.prototype.postscript=function(a){this.inherited(arguments);e.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};a.prototype._validateHeightModelInfo=function(){var a=this;return l.create(function(c,d){b.whenFalseOnce(a.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var b=
e.rejectLayerError(a.layer,a.view.heightModelInfo,a.supportsHeightUnitConversion);b?d(b):c()})})};g([f.property()],a.prototype,"view",void 0);g([f.property()],a.prototype,"slicePlaneEnabled",void 0);return a=g([f.subclass("esri.views.3d.layers.LayerView3D")],a)}(f.declared(k))})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.updatingPercentageValue={value:100,readOnly:!0};d.updatingPercentage=
{dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports dojo/request/xhr ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(t,d,q,g,l,b){function f(b){var d=null,c=b.search(/\/rest\/services\//i);0<c&&(d=b.substring(0,c+6));return d}Object.defineProperty(d,"__esModule",
{value:!0});d.checkArcGISServiceVersionCompatibility=function(d){if(!b.isHostedAgolService(d.url)){if(10.22>d.version)return d=new g("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+d.version,{minVersion:10.22,detectedVersion:d.version}),l.reject(d);if(10.22===d.version&&!b.isHostedSecuredProxyService(d.url,d.get("portalItem.id"))){d=f(d.url);var e=new g("tiledlayerview3d:service-missing-cors-patch","Tiled Map Layers from 10.2.2 servers are only supported if all server updates have been applied.");
return q(d+"self?f\x3djson",{headers:{"X-Requested-With":null},timeout:1E4,handleAs:"json"}).then(function(b){if(!b||b.error)throw e;}).catch(function(){throw e;})}return l.resolve()}};d.throwIfError=function(b){if(b)throw b;}})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/compilerUtils ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/controllers/FeatureTileController3D ../../../layers/graphics/controllers/support/controllerUtils ./FeatureLikeLayerView3D ./support/layerViewUpdatingProperties ../support/EventedSet ../../layers/FeatureLayerView".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r){return function(d){function n(a){a=d.call(this)||this;a._controllerTotal=0;a._graphicsCoreTotal=0;a.suspendResumeExtentMode="data";return a}q(n,d);Object.defineProperty(n.prototype,"updatingPercentageValue",{get:function(){var a=0,b=0;this.controller&&this.controller.updating&&(a+=this.controller.updatingRemaining,b=this.controller.updatingTotal);var c=0;this.graphics3d&&this.graphics3d.graphicsCore&&(a+=this.graphics3d.graphicsCore.updatingRemaining,c=
this.graphics3d.graphicsCore.updatingTotal);0===b&&0===c?this._graphicsCoreTotal=this._controllerTotal=0:(this._controllerTotal=Math.max(b,this._controllerTotal),this._graphicsCoreTotal=Math.max(c,this._graphicsCoreTotal));return(b=this._controllerTotal+this._graphicsCoreTotal)?(b-a)/b*100:100},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):
!1},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"asyncGraphicsUpdates",{get:function(){if(this.controller)switch(this.controller.mode){case "snapshot":return 5E3<this.controller.serviceDataCount;case "tiles":break;default:e.neverReached(this.controller.mode)}return!0},enumerable:!0,configurable:!0});n.prototype.fetchPopupFeatures=function(a,c){return f(this,void 0,void 0,function(){var a;return b(this,function(b){return(a=this.validateFetchPopupFeatures(c))?[2,k.reject(a)]:[2,
this.fetchClientPopupFeatures(c)]})})};n.prototype.setVisibility=function(a,b){this.graphics3d.graphicsCore.setObjectIdVisibility(a,b)};n.prototype.createController=function(){return f(this,void 0,void 0,function(){var a,d=this;return b(this,function(b){a=new h({layerView:this,graphics:new v.EventedSet,extent:this.clippingExtent});this.handles.add(c.init(a,"serviceDataExtent",function(a){d.graphics3d&&(d.graphics3d.dataExtent=a)}));this.handles.add(c.init(this,"suspended",function(b){b?a.suspend():
a.resume()},!0));this.handles.add(c.init(this.graphics3d.graphicsCore,"displayFeatureLimit",function(){return d.updateDisplayFeatureLimit(a)}));this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",function(){return d.updateDisplayFeatureLimit()}));return[2,a]})})};n.prototype.doRefresh=function(){!this.suspended&&p.isRefreshable(this.controller)&&this.controller.refresh()};n.prototype.getStats=function(){var a=this.inherited(arguments);if(this.controller&&a.features){var b=
this.controller.debug;a.features+="/"+b.storedFeatures+"/"+b.totalFeatures;a.totalVertices=b.totalVertices}b=(b=this.controller&&this.controller.displayFeatureLimit)&&b.maximumSymbolComplexity;a.numTiles=this.controller?this.controller.tileDescriptors.length:0;a.partial=this.maximumNumberOfFeaturesExceeded;a.mode=this.controller?this.controller.mode:"n/a";a.symbolComplexity=b?"f:"+b.primitivesPerFeature+",v:"+b.primitivesPerCoordinate:"n/a";var c=this.graphics3d&&this.graphics3d.graphicsCore,b=c?
c.unprocessedMemoryEstimate:0,c=this.controller?this.controller.expectedFeatureDiff*c.usedMemoryPerGraphic:0;a.memory="u:"+(this.getUsedMemory()/1024/1024).toFixed(1)+", pc:"+(""+(b/1024/1024).toFixed(1))+", pf:"+(""+(c/1024/1024).toFixed(1))+" MB";return a};n.prototype.getUsedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return(a?a.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)};n.prototype.getUnloadedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;
return(a?a.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*a.usedMemoryPerGraphic:0)};n.prototype.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride};n.prototype.updateDisplayFeatureLimit=function(a){void 0===a&&(a=this.controller);if(a&&this.graphics3d&&this.graphics3d.graphicsCore){var b=this.graphics3d.graphicsCore.displayFeatureLimit,c=this.view.resourceController.memoryController.memoryFactor;a.displayFeatureLimit=
1===c?b:l({},b,{maximumNumberOfFeatures:Math.ceil(b.maximumNumberOfFeatures*c),maximumTotalNumberOfFeatures:Math.ceil(b.maximumTotalNumberOfFeatures*c),minimumTotalNumberOfFeatures:Math.ceil(b.minimumTotalNumberOfFeatures*c)})}};g([a.property()],n.prototype,"layer",void 0);g([a.property()],n.prototype,"controller",void 0);g([a.property({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],
n.prototype,"updatingPercentageValue",null);g([a.property({aliasOf:"controller.maximumNumberOfFeatures",set:null,get:null})],n.prototype,"maximumNumberOfFeatures",void 0);g([a.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],n.prototype,"maximumNumberOfFeaturesExceeded",null);g([a.property(u.updatingPercentage)],n.prototype,"updatingPercentage",void 0);g([a.property({readOnly:!0,dependsOn:["controller.mode"]})],n.prototype,"asyncGraphicsUpdates",null);g([a.property()],
n.prototype,"suspendResumeExtentMode",void 0);return n=g([a.subclass("esri.views.3d.layers.FeatureLayerView3D")],n)}(a.declared(n,r))})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Accessor ../../../core/Collection ../../../core/compilerUtils ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../support/arcgisLayerUrl ../../../portal/support/geometryServiceUtils ../../../tasks/support/StatisticDefinition ../../../views/3d/layers/graphics/Graphics3DVerticalScale ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C){var B=h.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");t=function(b){function d(a){a=b.call(this)||this;a.type="feature-tile-3d";a.serviceDataExtent=null;a.serviceDataCount=h.constants.NO_SERVICE_DATA_COUNT;a.vertexLimitExceeded=!1;a.displayFeatureLimit=null;a.suspended=!1;a.tileFetcher=null;a.handles=new c;a.fetchDataInfoPromise=null;return a}q(d,b);h=d;Object.defineProperty(d.prototype,"extent",{set:function(a){if(a&&
!a.spatialReference.equals(this.layerView.view.spatialReference))B.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var b=this._get("extent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("extent",a))}},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||this.fetchDataInfoPromise)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updatingTotal",
{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maximumNumberOfFeatures",
{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(a){a!==this.maximumNumberOfFeatures&&(null==a?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",a))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"mode",{get:function(){if(this.serviceDataCount===
h.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var a=this.layerView,b=a.layer,a=(a=(a=a.view)&&a.featureTiles)&&a.tilingScheme;return b&&b.minScale&&this.serviceDataExtent&&a&&(b=this.approximateExtentSizeAtScale(b.minScale,a),(this.serviceDataExtent.width/b+this.serviceDataExtent.height/b)/2>h.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"maxTotalSnapshotVertices",{get:function(){var a=this._get("maxTotalSnapshotVertices")||0;return Math.max(a,"snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0)},enumerable:!0,configurable:!0});d.prototype.approximateExtentSizeAtScale=function(a,b){var c=this.layerView.view,d=b.levels[0];return(d.tileSize[0]/(d.scale/a)+d.tileSize[1]/(d.scale/a))/2*Math.ceil((c.width/b.pixelSize[0]+c.height/b.pixelSize[1])/2)};Object.defineProperty(d.prototype,
"tileDescriptors",{get:function(){return"snapshot"===this.mode?new f([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new f},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise}},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this.handles.add(this.watch("vertexLimitInfo",function(){return a.updateVertexLimitExceeded()}));
var b=n.resolve().then(function(){return a.verifyCapabilities()}).then(function(){return a.fetchServiceDataInfo()}).then(function(){return a.initializeTileFetcher()});this.addResolvingPromise(b)};d.prototype.verifyCapabilities=function(){var a=this.layerView.layer;if(!a.get("capabilities.operations.supportsQuery"))throw new k("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:a});};d.prototype.destroy=function(){this.cancelFetchServiceDataInfo();
this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null);this.handles&&(this.handles.destroy(),this.handles=null)};d.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())};d.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())};d.prototype.refresh=function(){var a=this,b=function(){a.tileFetcher&&a.tileFetcher.filtersChanged()};this.fetchServiceDataInfo().then(b,b)};d.prototype.initializeTileFetcher=
function(){var a=this,b=this.layerView.view;this.handles.add(u.whenOnce(b.featureTiles,"tilingScheme",function(){a.handles.add(b.featureTiles.addClient());var c=a.layerView,d=a.tileDescriptors,e=c.layer,f=new m({sourceSpatialReference:e.spatialReference,destSpatialReference:b.spatialReference});a.tileFetcher=new x.FeatureTileFetcher3D({layerView:c,filterExtent:a.filteredDataExtent,tilingScheme:b.featureTiles.tilingScheme,tileDescriptors:d,features:a.graphics,verticalScale:f,viewingMode:b.viewingMode});
a.suspended?a.tileFetcher.suspend():a.tileFetcher.resume();a.handles.add([e.watch("definitionExpression",function(){return a.definitionExpressionChanged()}),c.watch("availableFields",function(b,c){return a.attributesChanged(c,b)}),e.on("apply-edits",function(b){return a.applyEdits(b)}),a.watch("filteredDataExtent",function(b){return a.tileFetcher.filterExtent=b},!0),a.watch("tileDescriptors",function(b){return a.tileFetcher.tileDescriptors=b},!0),u.init(a,"maximumNumberOfFeatures",function(b){a.tileFetcher.maximumNumberOfFeatures=
b;a.tileFetcher.useTileCount=a.serviceDataCount>b},!0),u.init(a,"serviceDataCount",function(b){return a.tileFetcher.useTileCount=b>a.maximumNumberOfFeatures},!0),u.init(C,"FEATURE_TILE_FETCH_SHOW_TILES",function(c){c&&a.tileFetcher&&!a.tileFetcher.debugger?(a.tileFetcher.debugger=new A.FeatureTileFetcher3DDebugger(a.tileFetcher,b.featureTiles.tilingScheme.toTileInfo(),b),a.tileFetcher.debugger.update()):!c&&a.tileFetcher&&a.tileFetcher.debugger&&(a.tileFetcher.debugger.destroy(),a.tileFetcher.debugger=
null)})]);a.supportsExceedsLimitQuery||a.watch("maxTotalSnapshotVertices",function(){return a.updateVertexLimitExceeded()})}))};d.prototype.definitionExpressionChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refresh()};d.prototype.applyEdits=function(a){var b=this;this.tileFetcher.applyEdits(a).then(function(a){a&&(a.deletedFeatures.length||a.updatedFeatures.length||a.addedFeatures.length)&&b.updateServiceDataExtent()})};d.prototype.attributesChanged=
function(a,b){if(!a||-1===a.indexOf("*"))if(a&&b){for(var c=new Set,d=0;d<a.length;d++){var e=a[d];c.add(e)}for(a=0;a<b.length;a++)if(e=b[a],!c.has(e)){this.refresh();break}}else this.refresh()};d.prototype.createVertexLimitExceededQuery=function(a){var b=this.layerView.layer.createQuery();b.outStatistics=[new w({statisticType:"exceedslimit",maxVertexCount:a,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];return b};d.prototype.createDataInfoQuery=function(){var a=this.layerView.layer,
b=a.createQuery();b.outSpatialReference=this.layerView.view.spatialReference;a.capabilities.query.supportsResultType&&(b.resultType="tile");return b};d.prototype.fullExtentIsAccurate=function(){var a=this.layerView.layer;if(a.definitionExpression)return!1;switch(a.type){case "feature":case "stream":return r.isHostedAgolService(a.url);case "csv":case "geojson":return!0;default:e.neverReached(a)}};d.prototype.updateServiceDataExtent=function(){var b=this,c=this.layerView,d=c.layer,e=d.capabilities.query.supportsExtent,
f=a.clone(c.fullExtentInLocalViewSpatialReference),g=d.fullExtent,k=this.fullExtentIsAccurate(),l=this.serviceDataCount,m=null;!(e&&l<=h.constants.MAX_FEATURE_COUNT_FOR_EXTENT)||f&&k?f?this._set("serviceDataExtent",f):g?m=y.projectGeometry(g,c.view.spatialReference,"portalItem"in d?d.portalItem:null).then(function(a){b._set("serviceDataExtent",a)}):this._set("serviceDataExtent",null):(c=this.createDataInfoQuery(),m=d.queryExtent(c,{timeout:h.constants.QUERY_EXTENT_TIMEOUT}).then(function(a){b._set("serviceDataExtent",
a.extent)}));m&&(m=m.catch(function(a){a&&"cancel"===a.dojoType||b._set("serviceDataExtent",f)}));return m};d.prototype.updateServiceDataCount=function(){var a=this;return this.layerView.layer.queryFeatureCount(this.createDataInfoQuery(),{timeout:h.constants.QUERY_STATISTICS_TIMEOUT}).then(function(b){a._set("serviceDataCount",b)}).catch(function(b){if(b&&"cancel"===b.dojoType)throw b;a._set("serviceDataCount",h.constants.NO_SERVICE_DATA_COUNT)})};Object.defineProperty(d.prototype,"vertexLimitInfo",
{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var a=this.displayFeatureLimit,b=a.maximumSymbolComplexity,a=a.maximumTotalNumberOfPrimitives,c=b.primitivesPerCoordinate,b=b.primitivesPerFeature,d=this._get("vertexLimitInfo");return d&&d.maximumTotalNumberOfPrimitives===a&&d.primitivesPerCoordinate===c&&d.primitivesPerFeature===b?d:{primitivesPerCoordinate:c,primitivesPerFeature:b,maximumTotalNumberOfPrimitives:a}},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"supportsExceedsLimitQuery",{get:function(){var a=this.layerView.layer;return a.capabilities&&a.capabilities.operations&&a.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var a=this.layerView.layer.geometryType;switch(a){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;
default:return e.neverReached(a),0}},enumerable:!0,configurable:!0});d.prototype.updateVertexLimitExceeded=function(a){var b=this,c=this.layerView.layer,d=this.supportsExceedsLimitQuery;if(!(this.vertexLimitInfo&&0>=this.vertexLimitInfo.primitivesPerFeature))return this._set("vertexLimitExceeded",!1),n.resolve();var e=this.vertexLimitInfo,f=e.primitivesPerFeature,g=e.primitivesPerCoordinate,k=e.maximumTotalNumberOfPrimitives;return n.when(0!==f?a:null).then(function(){var a=b.serviceDataCount,e,l=
a!==h.constants.NO_SERVICE_DATA_COUNT;e=l?Math.ceil((k-a*f)/(g||1)):Math.ceil(k/(g||1));if(l&&b.minimumNumberOfVerticesForGeometry*a>e)b._set("vertexLimitExceeded",!0);else{if(d)return c.queryFeatures(b.createVertexLimitExceededQuery(e),{timeout:h.constants.QUERY_STATISTICS_TIMEOUT}).then(function(a){(a=a.features[0])&&a.attributes?b._set("vertexLimitExceeded",!!a.attributes.exceedslimit):b._set("vertexLimitExceeded",!1)}).catch(function(a){if(a&&"cancel"===a.dojoType)throw a;b._set("vertexLimitExceeded",
!1)});b._set("vertexLimitExceeded",b.maxTotalSnapshotVertices>e)}})};d.prototype.fetchServiceDataInfo=function(){var a=this;this.cancelFetchServiceDataInfo();var b=n.eachAlways([this.updateServiceDataCount(),this.updateVertexLimitExceeded()]),c=b.then(function(){return a.updateServiceDataExtent()}).catch(function(a){a&&"AbortError"===a.name||B.error("#fetchServiceDataInfo()",a)}).then(function(){c===a.fetchDataInfoPromise&&(a.fetchDataInfoPromise=null)});c.isFulfilled()||(this.fetchDataInfoPromise=
c);return b.catch(function(){})};d.prototype.cancelFetchServiceDataInfo=function(){var a=this.fetchDataInfoPromise;a&&(this.fetchDataInfoPromise=null,a.cancel())};Object.defineProperty(d.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0});var h;g([v.property({readOnly:!0})],d.prototype,
"type",void 0);g([v.property({constructOnly:!0})],d.prototype,"graphics",void 0);g([v.property({constructOnly:!0})],d.prototype,"layerView",void 0);g([v.property()],d.prototype,"extent",null);g([v.property({dependsOn:["tileFetcher.updating","fetchDataInfoPromise"]})],d.prototype,"updating",null);g([v.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],d.prototype,"updatingTotal",null);g([v.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],d.prototype,"updatingRemaining",
null);g([v.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],d.prototype,"expectedFeatureDiff",null);g([v.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],d.prototype,"memoryForUnusedFeatures",null);g([v.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],d.prototype,"maximumNumberOfFeaturesExceeded",null);g([v.property({readOnly:!0})],d.prototype,"serviceDataExtent",void 0);g([v.property({readOnly:!0})],d.prototype,"serviceDataCount",void 0);g([v.property({readOnly:!0})],
d.prototype,"vertexLimitExceeded",void 0);g([v.property({readOnly:!0,dependsOn:["extent"]})],d.prototype,"filteredDataExtent",null);g([v.property()],d.prototype,"displayFeatureLimit",void 0);g([v.property({type:Number,dependsOn:["displayFeatureLimit"]})],d.prototype,"maximumNumberOfFeatures",null);g([v.property({readOnly:!0,dependsOn:"serviceDataCount displayFeatureLimit maximumNumberOfFeatures vertexLimitExceeded serviceDataExtent layerView.layer.minScale layerView.view.featureTiles.tilingScheme".split(" ")})],
d.prototype,"mode",null);g([v.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],d.prototype,"maxTotalSnapshotVertices",null);g([v.property({readOnly:!0,dependsOn:["mode"]})],d.prototype,"tileDescriptors",null);g([v.property()],d.prototype,"tileFetcher",void 0);g([v.property()],d.prototype,"fetchDataInfoPromise",void 0);g([v.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],d.prototype,"vertexLimitInfo",null);return d=h=g([v.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],
d)}(v.declared(b,p));(function(a){(function(a){a.NO_SERVICE_DATA_COUNT=Infinity;a.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;a.reset=function(){a.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;a.QUERY_STATISTICS_TIMEOUT=12E3;a.QUERY_EXTENT_TIMEOUT=1E4}})(a.constants||(a.constants={}))})(t||(t={}));t.constants.reset();return t})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/now ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/QuantizationParameters ../../../../tasks/support/Query ./featureReference ./FeatureTile ./featureTileQuery3D ../../../../views/support/QueueProcessor".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B){function E(a,b){return null!=a.objectId?a.objectId:a.attributes[b]}function I(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];d.features&&0<d.features.length&&d.alive&&(b=Math.max(b,d.descriptor.lij[0]))}return b}Object.defineProperty(d,"__esModule",{value:!0});var G=x.SingleFeatureReference,L=x.MultiFeatureReference,F=a.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");t=function(a){function d(b){b=a.call(this,b)||this;b.useTileCount=
!1;b.updating=!1;b.updatingTotal=0;b.updatingRemaining=0;b.expectedFeatureDiff=0;b.maximumNumberOfFeaturesExceeded=!1;b.maximumNumberOfFeaturesExceededThrottle=1E3;b.maximumNumberOfFeaturesExceededNext=0;b._fullRatio=1;b._farRatio=1;b.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};b.handles=new c;b._dirty=!1;b.idToFeatureTile=new Map;b.displayingFeatureReferences=new Map;b.numDisplayingFeatureReferences=0;b.suspended=!0;b.pendingEdits=null;return b}q(d,a);Object.defineProperty(d.prototype,
"maximumNumberOfFeatures",{set:function(a){a=a||Infinity;var b=this._get("maximumNumberOfFeatures");a===b||1>a||(this._set("maximumNumberOfFeatures",a),this.maximumFeaturesUpdated(b,a))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"memoryForUnusedFeatures",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=b.estimatedUnusedSize});return a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"totalVertices",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=
b.numVertices});return a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"totalFeatures",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=b.numFeatures});return a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"filterExtent",{set:function(a){if(a&&this.tilingScheme&&!a.spatialReference.equals(this.tilingScheme.spatialReference))F.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var b=
this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.reclip(a,b))}},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this.capabilities=this.calculateCapabilities();this.fetchQueue=this.createFetchQueue();var b=this.layerView.layer;this.handles.add(u.on(this,"tileDescriptors","change",function(){return a.setDirty()},function(){return a.setDirty()}));this.handles.add(b.watch("hasService",function(){return a._initMemCache()}));
u.init(b,"hasService",function(){return a._initMemCache()});this.objectIdField=b.objectIdField;this.FeatureReferenceClass=this.capabilities.supportsMultipleResolutions?L:G;this.featureTileQuery=C.createFeatureTileQuery3D(b);b=this.layerView.view.resourceController.scheduler;this.handles.add([b.registerTask(2,function(b){return a.update(b)},function(){return a._dirty||0<a.maximumNumberOfFeaturesExceededNext}),b.registerIdleStateCallbacks(function(){return a.unpause()},function(){return a.pause()})]);
this.setDirty()};d.prototype.destroy=function(){var a=this;this.handles&&(this.handles.destroy(),this.handles=null);this.forEachFeatureTile(function(b){a.cancelFetchTile(b);a.removeTile(b)});this.idToFeatureTile.clear();this.displayingFeatureReferences.clear();this.fetchQueue.destroy();this.featureTileQuery=this.fetchQueue=null;this.pendingEdits&&(this.pendingEdits.edits.cancel(P),this.pendingEdits=null);this._memCache&&this._memCache.destroy();this._memCache=null};Object.defineProperty(d.prototype,
"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!0,configurable:!0});d.prototype.filtersChanged=function(){var a=this;this.fetchQueue.clear();this._memCache&&this._memCache.clear();this.forEachFeatureTile(function(b){a.resetFetchTile(b);a.queueFetchTile(b)});this.setDirty()};d.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())};d.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())};d.prototype.pause=
function(){this.paused&&(this.fetchQueue.pause(),this.fetchQueue.reset(),this.updated())};d.prototype.unpause=function(){this.paused||(this.setDirty(),this.fetchQueue.resume(),this.updated())};d.prototype.getFeatureTileById=function(a){return this.idToFeatureTile.get(a)||null};d.prototype.forEachFeatureTile=function(a){this.idToFeatureTile.forEach(a)};d.prototype.applyEdits=function(a){var b=this;this.pendingEdits||(this.pendingEdits={edits:p.resolve(),count:0},this.pause());this.pendingEdits.count++;
var c=this.pendingEdits.edits.then(function(){return a.result.catch(function(a){if(a===P)throw a;return null}).then(function(a){return a?(b.applyEditsDeleteFeatures(a.deletedFeatures),k.safeCast(b.applyEditsAddUpdateFeatures(a.addedFeatures,a.updatedFeatures).then(function(){return a}))):a}).then(function(a){0===--b.pendingEdits.count&&(b.pendingEdits=null,b._memCache&&b._memCache.clear(),b.unpause());return a})});return this.pendingEdits.edits=c};d.prototype.applyEditsDeleteFeatures=function(a){var b=
this;if(0!==a.length){var c=new Set;a.forEach(function(a){return c.add(a.objectId)});this.forEachFeatureTile(function(a){if(a.features){var d=a.features.filter(function(a){return!c.has(E(a,b.objectIdField))});d.length!==a.features.length&&(a.setFeatures(d,0),b.invalidateCounts())}})}};d.prototype.applyEditsAddUpdateFeatures=function(a,c){return b(this,void 0,void 0,function(){var b,d,e,g=this;return f(this,function(f){switch(f.label){case 0:b=[];d=new Set;a.forEach(function(a){return b.push(a.objectId)});
c.forEach(function(a){b.push(a.objectId);d.add(a.objectId)});if(0===b.length)return[2];e=[];this.forEachFeatureTile(function(a){(a=k.safeCast(g.applyEditsAddUpdateTile(a,b,d)))&&e.push(a)});return[4,p.eachAlways(e)];case 1:return f.sent(),[2]}})})};d.prototype.applyEditsAddUpdateTile=function(a,c,d){return b(this,void 0,void 0,function(){var b,e,g,h,k,l,m,n=this;return f(this,function(f){switch(f.label){case 0:if(!a.features)return[2];b=this.createQuery(a);b.resultType=void 0;b.objectIds=c;return[4,
this.queryFeatures(b)];case 1:e=f.sent();g=null;0<d.size&&(h=a.features.filter(function(a){return!d.has(E(a,n.objectIdField))}),h.length!==a.features.length&&(g=h));if(0<e.features.length)for(g||(g=a.features.slice()),this.verticalScale.adjust(e.features),k=0,l=e.features;k<l.length;k++)m=l[k],g.push(m);g&&(a.setFeatures(g,0),this.invalidateCounts());return[2]}})})};d.prototype.queryFeatures=function(a){return this.featureTileQuery.queryFeaturesDehydrated(a,{timeout:O})};d.prototype.calculateCapabilities=
function(){var a=this.layerView.layer,b=!!(a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsPagination),c=!!(a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsResultType),d=!!(a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsQuantization),e=!!(a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsQuantizationEditMode),f=!!(a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsMaxRecordCountFactor),a=!!(a.capabilities&&
a.capabilities.query&&a.capabilities.query.supportsFormatPBF);return{supportsMultipleResolutions:this.calculateSupportsMultipleResolutions(),supportsPagination:b,supportsResultType:c,supportsQuantization:d,supportsQuantizationEditMode:e,supportsMaxRecordCountFactor:f,supportsFormatPBF:a}};d.prototype.calculateSupportsMultipleResolutions=function(){var a=this.layerView.layer;switch(a.geometryType){case "polyline":return!0;case "polygon":return a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsQuantization;
default:return!1}};d.prototype.createFetchQueue=function(){var a=this;return new B({concurrency:6,priority:2,scheduler:this.layerView.view.resourceController.scheduler,peeker:function(b){return a.highestPriorityTile(b)},process:function(b){return k.safeCast(a.fetchTile(b))}})};d.prototype.highestPriorityTile=function(a){return a.reduce(function(a,b){return a&&a.descriptor.loadPriority<=b.descriptor.loadPriority?a:b},null)};d.prototype._initMemCache=function(){var a=this.layerView.layer;"hasService"in
a&&a.hasService?this._memCache||(this._memCache=this.layerView.view.resourceController.memoryController.getMemCache(a.uid)):this._memCache&&(this._memCache.destroy(),this._memCache=null)};d.prototype.setDirty=function(){this._dirty=!0;this.forEachFeatureTile(function(a){a.featureLimit=0});this.updated()};d.prototype.update=function(a){var b=this;this.maximumNumberOfFeaturesExceededNext&&h()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded();if(this._dirty&&this.constructed){this._dirty=
!1;var c=this.getListOfTiles();this.markTilesNotAlive(c);this.addTiles(c);this.filterExtentTiles(c);this.removeTiles(c);var d=this.sortTiles(c);a.run(function(){return b.displayTiles(d,a)})&&a.run(function(){return b.queueFetchTiles(d,a)})||this.setDirty();this.updated()}};d.prototype.markTilesNotAlive=function(a){for(var b=0;b<a.length;b++)a[b].alive=!1};d.prototype.addTiles=function(a){var b=this;this.suspended||this.tileDescriptors.forEach(function(c){var d=b.getFeatureTileById(c.id);d?d.alive=
!0:a.push(b.addTile(c))})};d.prototype.filterExtentTiles=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.alive&&(c.filtered=!c.intersects(this.filterExtent),c.filtered&&this.clearTile(c))}};d.prototype.removeTiles=function(a){for(var b=a.length-1;0<=b;b--){var c=a[b];c.alive||(this.removeTile(c),b!==a.length-1&&(a[b]=a[a.length-1]),a.pop())}};d.prototype.sortTiles=function(a){a.sort(function(a,b){return a.descriptor.loadPriority-b.descriptor.loadPriority});return a};d.prototype.displayTiles=
function(a,b){for(var c=this,d=this.updateRatio(a),e=function(a){if(!b.run(function(){var b=1>c._fullRatio?d(a)*c._farRatio:1;a.reduceFeatures(b,c.objectIdField)&&c.setDirty();return c.showTile(a)}))return f.setDirty(),"break"},f=this,g=0;g<a.length&&"break"!==e(a[g]);g++);return!0};d.prototype.queueFetchTiles=function(a,b){for(var c=this,d=function(a){if(!b.run(function(){return c.queueFetchTile(a)}))return e.setDirty(),{value:!0}},e=this,f=0;f<a.length;f++){var g=d(a[f]);if("object"===typeof g)return g.value}return!0};
d.prototype.reclip=function(a,b){var c=this;this.constructed&&(this.forEachFeatureTile(function(d){d.displayingFeatures&&0!==d.displayingFeatures.length&&(d.intersection(b,M),d.intersection(a,Q),r.equals(M,Q)||c.hideTileFeatures(d))}),this.forEachFeatureTile(function(a){return c.showTile(a)}),this.updated())};d.prototype.updated=function(){var a=this,b=this._dirty||0<this.fetchQueue.length;this._set("updating",b);if(b){var c=b=0,d=0,e=0,f=0,g=0,k=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;
this.forEachFeatureTile(function(b){++d;if(b.isFetching&&b.hasPreciseFeatureCount){var h=a.maximumFeaturesForTile(b)*(1-b.emptyFeatureRatio);g+=h-(b.displayingFeatures?b.displayingFeatures.length*k:0)}b.needsFetching?++f:0<b.numFeatures&&(++e,c+=b.numFeatures)});var l=f+=this.fetchQueue?this.fetchQueue.length:0;c?(l=f*c/e,b=c+l):b=d;g=Math.min(this.maximumNumberOfFeatures-this.features.length,g);this._set("updatingTotal",b);this._set("updatingRemaining",l);this._set("expectedFeatureDiff",g)}else this._set("updatingTotal",
0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update();this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||h()+this.maximumNumberOfFeaturesExceededThrottle)};d.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var a=!1;this.forEachFeatureTile(function(b){a=a||b.perTileMaximumNumberOfFeaturesExceeded});this.maximumNumberOfFeaturesExceededNext=0;this._set("maximumNumberOfFeaturesExceeded",
a)}};d.prototype.updateRatio=function(a){for(var b=I(a),c=function(a){return 1/(1<<b-a.descriptor.lij[0])},d=0,e=0,f=0;f<a.length;f++)var g=a[f],h=g.numFeatures,d=d+h,e=e+h*c(g);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/d);this._farRatio=this.maximumNumberOfFeatures/e;this.scheduleUpdated();return c};d.prototype.maximumFeaturesUpdated=function(a,b){var c=this;a!==b&&(b>a&&this.forEachFeatureTile(function(a){if(a.featuresMissing){var b=c.maximumFeaturesForTile(a);a.features&&(a.features.length>=
b||5===a.fetchStatus)||(c.cancelFetchTile(a),c.resetFetchTile(a))}}),this.setDirty())};d.prototype.addTile=function(a){a=new A(a);this.idToFeatureTile.set(a.id,a);this.resetFetchTile(a);this.referenceDisplayingFeaturesFromRelatedTiles(a);return a};d.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(a){var b=this,c=a.descriptor.resolution;this.forEachFeatureTile(function(d){if(d.displayingFeatures&&b.tilesAreRelated(a,d)){a.displayingFeatures=a.displayingFeatures||[];var e=0;for(d=d.displayingFeatures;e<
d.length;e++){var f=d[e];a.displayingFeatures.push(f);f=b.displayingFeatureReferences.get(E(f,b.objectIdField));f.ref(c,f.feature);b.numDisplayingFeatureReferences++}}});a.featureLimit=a.displayingFeatures?a.displayingFeatures.length:0};d.prototype.tilesAreRelated=function(a,b){if(a===b)return!1;a=a.descriptor.lij;var c=b.descriptor.lij;if(!a||!c)return!0;var d=a[0]<c[0];b=d?a:c;a=d?c:a;c=a[0]-b[0];if(0===c)return!1;c=1<<c;return Math.floor(a[1]/c)===b[1]&&Math.floor(a[2]/c)===b[2]};d.prototype.removeTile=
function(a){this.clearTile(a);this.idToFeatureTile.delete(a.id)};d.prototype.resetFetchTile=function(a){a.intersects(this.filterExtent)?(a.fetchStatus=0,a.filtered=!1):(a.needsFetching&&(a.fetchStatus=4),a.filtered=!0)};d.prototype.cancelFetchTile=function(a){var b=a.fetchRequest;b&&(a.fetchRequest=null,a.fetchStatus=0,b.cancel())};d.prototype.fetchTile=function(a){return b(this,void 0,void 0,function(){var b,c,d,e,g,h,k,l,n,p,r;return f(this,function(f){switch(f.label){case 0:if(!this.needsNumFeatures(a))return[3,
4];f.label=1;case 1:return f.trys.push([1,3,,4]),b=a,[4,this.fetchCount(a)];case 2:return b.numFeatures=f.sent(),this.updateRatio(this.getListOfTiles()),[3,4];case 3:return(c=f.sent())&&"cancel"===c.dojoType?[2]:[3,4];case 4:d=this.maximumFeaturesForTile(a);e=Math.ceil(d/this.maxRecordCount);if("dummy-tile-full-extent"===a.id||!this.capabilities.supportsMaxRecordCountFactor||a.numFeatures<=d&&e>m.MAX_MAX_RECORD_COUNT_FACTOR)return[2,this.fetchPagedTile(a)];g=this.createQuery(a);g.maxRecordCountFactor=
Math.ceil(d/this.maxRecordCount);a.isRefetching&&a.features&&0<a.features.length&&(h=Math.ceil(a.features.length/(1-a.emptyFeatureRatio)/this.maxRecordCount),g.maxRecordCountFactor=Math.max(h+1,g.maxRecordCountFactor));return[4,this.queryFeatures(g)];case 5:return k=f.sent(),l=k.features,p=(n=k.exceededTransferLimit)?g.maxRecordCountFactor>=m.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,a.featuresMissing=l.length<a.numFeatures||n,r=this._removeEmptyFeatures(l),this.verticalScale.adjust(l),a.setFeatures(l,r),
this.invalidateCounts(),[2,p]}})})};d.prototype.fetchCount=function(a){return b(this,void 0,void 0,function(){return f(this,function(b){return[2,this.layerView.layer.queryFeatureCount(this.createQuery(a))]})})};d.prototype.fetchPagedTile=function(a){return b(this,void 0,void 0,function(){var b,c,d,e,g,h,k,l,m,n;return f(this,function(f){switch(f.label){case 0:e=c=b=0,g=this.maximumFeaturesForTile(a)-e,f.label=1;case 1:return h=this.createQuery(a),k=this.setPagingParameters(h,b,g),[4,this.queryFeatures(h)];
case 2:return l=f.sent(),m=l.features,n=l.exceededTransferLimit,b+=h.num,e+=m.length,c+=this._removeEmptyFeatures(m),this.verticalScale.adjust(m),a.featuresMissing=b<a.numFeatures||n,d=d?d.concat(m):m,a.setFeatures(d,c),this.invalidateCounts(),this.setDirty(),g=this.maximumFeaturesForTile(a)-e,!k||!n||0>=g?[2,n?4:5]:[3,1];case 3:return[2]}})})};d.prototype.createQuery=function(a){var b=this.layerView.layer.createQuery();b.outFields=this.layerView.availableFields;var c=this.layerView.layer.capabilities&&
this.layerView.layer.capabilities.data;c&&c.supportsZ&&null==b.returnZ&&(b.returnZ=!0);c=this.tilingScheme.spatialReference;b.outSpatialReference=c;var d=a.descriptor.extent;d&&(b.geometry=r.toExtent(d,c));this.setResolutionParams(b,a);this.capabilities.supportsResultType&&(b.resultType="tile");return b};d.prototype.setPagingParameters=function(a,b,c){if(!this.capabilities.supportsPagination)return!1;a.start=b;0<c&&this.capabilities.supportsMaxRecordCountFactor?(a.maxRecordCountFactor=Math.ceil(c/
this.maxRecordCount),a.num=Math.min(a.maxRecordCountFactor*this.maxRecordCount,c)):a.num=Math.min(this.maxRecordCount);return!0};d.prototype.getEffectiveTileResolution=function(a){if(null==a.descriptor.resolution)return null;var b="global"===this.viewingMode?this.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(a.descriptor.resolution,b)*N};d.prototype.setResolutionParams=function(a,b){if(this.capabilities.supportsMultipleResolutions){var c=this.layerView.layer;"point"!==c.geometryType&&
(b=this.getEffectiveTileResolution(b),null!=b&&(this.capabilities.supportsQuantization?a.quantizationParameters=new w.default({mode:"view",originPosition:"upper-left",tolerance:b,extent:c.fullExtent}):"polyline"===c.geometryType&&(a.maxAllowableOffset=b)))}};d.prototype._removeEmptyFeatures=function(a){for(var b=a.length,c=0;c<a.length;)y.hasVertices(a[c].geometry)?++c:(a[c]=a[a.length-1],--a.length);return b-a.length};d.prototype.needsNumFeatures=function(a){return this.useTileCount&&!a.hasPreciseFeatureCount&&
"dummy-tile-full-extent"!==a.id};Object.defineProperty(d.prototype,"maxRecordCount",{get:function(){var a=this.layerView.layer;if("tileMaxRecordCount"in a){if(this.capabilities.supportsResultType)return a.tileMaxRecordCount;if(a.maxRecordCount)return a.maxRecordCount}return K},enumerable:!0,configurable:!0});d.prototype.queueFetchTile=function(a){var b=this;if(!a.needsFetching)return!1;var c=this._memCache&&this._memCache.pop(a.id);if(c)return a.loadCache(c),this.setDirty(),this.scheduleUpdated(),
!0;a.fetchStatus=a.needsRefetching?3:2;var d=!1,e=this.fetchQueue.push(a).then(function(b){a.fetchRequest=null;a.fetchStatus=b}).catch(function(c){a.fetchRequest===e&&(a.fetchRequest=null,a.fetchStatus=4);c&&"cancel"===c.dojoType?d=!0:(a.setFeatures([],0),b.invalidateCounts(),a.featuresMissing=!1,F.error("#fetchTile()",b.layerView.layer,c&&c.message?c.message:c))}).then(function(){d||b.setDirty();b.scheduleUpdated()});e.isFulfilled()||(a.fetchRequest=e);return!0};d.prototype.scheduleUpdated=function(){var a=
this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(n.schedule(function(){a.handles.remove("scheduleUpdated");a.updated()}),"scheduleUpdated")};d.prototype.showTile=function(a){if(a.displayingFeatures&&!a.needsDisplayUpdate)return!1;if(0===a.featureLimit||!a.features){var b=a.displayingFeatures&&0<a.displayingFeatures.length;this.hideTileFeatures(a);a.displayingFeatures=[];return b}for(var b=a.descriptor.resolution,c=this.changes.updates,d=this.changes.adds,e=0;e<a.featureLimit;++e){var f=
a.features[e],g=E(f,this.objectIdField),h=this.displayingFeatureReferences.get(g);h?(f=h.ref(b,f),f.oldVersion!==f.newVersion&&(c.removes.push(f.oldVersion),c.adds.push(f.newVersion))):(this.displayingFeatureReferences.set(g,new this.FeatureReferenceClass(b,f)),d.push(f));this.numDisplayingFeatureReferences++}this.hideTileFeatures(a);this.applyChanges();a.displayingFeatures=a.features.slice(0,a.featureLimit);return!0};d.prototype.hideTile=function(a){this.cancelFetchTile(a);this.hideTileFeatures(a)};
d.prototype.hideTileFeatures=function(a){if(a.displayingFeatures){for(var b=this.changes.updates,c=this.changes.removes,d=0,e=a.displayingFeatures;d<e.length;d++){var f=E(e[d],this.objectIdField),g=this.displayingFeatureReferences.get(f);g&&((g=g.unref(a.descriptor.resolution),this.numDisplayingFeatureReferences--,g)?g.oldVersion!==g.newVersion&&(null==g.newVersion?(this.displayingFeatureReferences.delete(f),c.push(g.oldVersion)):(b.adds.push(g.newVersion),b.removes.push(g.oldVersion))):console.error("Hiding unreferenced feature"))}this.applyChanges();
a.displayingFeatures=null}};d.prototype.applyChanges=function(){var a=this.changes.updates;0<a.removes.length&&(this.features.removeMany(a.removes),a.removes.length=0);0<a.adds.length&&(this.features.addMany(a.adds),a.adds.length=0);for(var a=this.changes.adds,b=this.changes.removes,c=Math.min(a.length,b.length),d=0;d<c;){var e=Math.min(d+U,c);this.features.addMany(a.slice(d,e));this.features.removeMany(b.slice(d,e));d=e}a.length>c&&this.features.addMany(0===d?a:a.slice(d));b.length>c&&this.features.removeMany(0===
d?b:b.slice(d));a.length=0;b.length=0};d.prototype.clearTile=function(a){this.hideTile(a);a.features&&this._memCache&&this._memCache.put(a.id,a.cacheItem,16+a.estimatedSize);a.setFeatures(null,0);this.invalidateCounts()};d.prototype.invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};d.prototype.getListOfTiles=function(){var a=Array(this.idToFeatureTile.size),b=0;this.forEachFeatureTile(function(c){return a[b++]=
c});return a};Object.defineProperty(d.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce(function(a,b){return a+(b.features?b.features.length:0)},0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"test",{get:function(){var a=this;return{update:function(b){a.fetchQueue.test.update(b);a.update(b)}}},enumerable:!0,configurable:!0});d.prototype.maximumFeaturesForTile=function(a){var b=a.hasPreciseFeatureCount?a.numFeatures:this.maximumNumberOfFeatures;return Math.min(Math.ceil(b*
(1>this._fullRatio?this._farRatio:1)/(1-a.emptyFeatureRatio)),b)};g([v.property({constructOnly:!0})],d.prototype,"features",void 0);g([v.property()],d.prototype,"tileDescriptors",void 0);g([v.property({constructOnly:!0})],d.prototype,"tilingScheme",void 0);g([v.property({value:Infinity})],d.prototype,"maximumNumberOfFeatures",null);g([v.property()],d.prototype,"useTileCount",void 0);g([v.property({constructOnly:!0})],d.prototype,"layerView",void 0);g([v.property({readOnly:!0})],d.prototype,"updating",
void 0);g([v.property({readOnly:!0})],d.prototype,"updatingTotal",void 0);g([v.property({readOnly:!0})],d.prototype,"updatingRemaining",void 0);g([v.property({readOnly:!0})],d.prototype,"expectedFeatureDiff",void 0);g([v.property({readOnly:!0})],d.prototype,"memoryForUnusedFeatures",null);g([v.property({readOnly:!0})],d.prototype,"maximumNumberOfFeaturesExceeded",void 0);g([v.property({constructOnly:!0})],d.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);g([v.property({readOnly:!0})],
d.prototype,"totalVertices",null);g([v.property({readOnly:!0})],d.prototype,"totalFeatures",null);g([v.property()],d.prototype,"filterExtent",null);g([v.property({constructOnly:!0})],d.prototype,"verticalScale",void 0);g([v.property({constructOnly:!0})],d.prototype,"viewingMode",void 0);return d=g([v.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],d)}(v.declared(e));d.FeatureTileFetcher3D=t;d.getFeatureId=E;var K=2E3,M=r.create(),Q=r.create(),P={},O=6E5,U=200,N=1/3;d.default=t})},"esri/views/3d/layers/support/featureReference":function(){define(["require",
"exports","../../../../layers/graphics/dehydratedFeatures"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(b,d){this.highestResolutionVersion=null;this.versions=[];this.markedTile=null;this.ref(b,d)}Object.defineProperty(d.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,
configurable:!0});d.prototype.ref=function(b,d){var e=this.feature;g.oldVersion=e;this.feature&&(d.uid=this.feature.uid);for(var f=0,c=this.versions;f<c.length;f++){var a=c[f];if(a.resolution===b){a.refCount++;if((b=this.highestResolutionVersion===a&&!q.equals(d,a.feature))||this.highestResolutionVersion!==a)a.feature=d;g.newVersion=b?d:e;return g}}a={feature:d,resolution:b,refCount:1};this.versions.push(a);!this.highestResolutionVersion||b<this.highestResolutionVersion.resolution?(g.newVersion=d,
this.highestResolutionVersion=a):g.newVersion=e;return g};d.prototype.unref=function(b){for(var d=0;d<this.versions.length;d++){var e=this.versions[d];if(e.resolution===b)return e.refCount--,g.oldVersion=this.feature,0===e.refCount&&(this.versions[d]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===e&&(this.recalculateHighestResolutionVersion(),g.oldVersion=e.feature)),g.newVersion=this.feature,g}return null};Object.defineProperty(d.prototype,"feature",
{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0});d.prototype.recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{for(var b=this.versions[0],d=1;d<this.versions.length;d++){var e=this.versions[d];e.resolution<b.resolution&&(b=e)}this.highestResolutionVersion=b}};return d}();d.MultiFeatureReference=t;t=function(){function d(b,d){this._feature=d;this.refCount=
1;this.markedTile=null}Object.defineProperty(d.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0});d.prototype.ref=function(b,d){++this.refCount;g.oldVersion=this._feature;this.feature&&(d.uid=this.feature.uid);q.equals(this._feature,d)||(this._feature=d);g.newVersion=this._feature;return g};d.prototype.unref=function(b){g.oldVersion=
this._feature;if(0<this.refCount&&(this.refCount--,!this.isReferenced))return g.newVersion=null,g;g.newVersion=this._feature;return g};Object.defineProperty(d.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0});return d}();d.SingleFeatureReference=t;var g={oldVersion:null,newVersion:null}})},"esri/views/3d/layers/support/FeatureTile":function(){define("require exports ../../../../core/arrayUtils ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ./FeatureTileFetcher3D".split(" "),
function(t,d,q,g,l,b){t=function(){function d(b){this.descriptor=b;this.fetchRequest=null;this.fetchStatus=0;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=d.UNKNOWN_COUNT;this._emptyFeatureRatio=0;this._estimatedUnusedSize=this._estimatedSize=-1;this.displayingFeatures=null;this.alive=!0;this.filtered=!1}Object.defineProperty(d.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||
this.features&&this.featureLimit!==this.features.length)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"featureLimit",{get:function(){return this._featureLimit},set:function(b){this._featureLimit!==b&&(this._featureLimit=b,this._estimatedUnusedSize=this._estimatedSize=-1)},enumerable:!0,configurable:!0});d.prototype.setFeatures=function(b,c){this._features=b;this._shuffled=
!1;this._estimatedUnusedSize=this._estimatedSize=-1;b&&0<b.length?(this._emptyFeatureRatio=c/(b.length+c),this._numVertices=b.reduce(function(a,b){return a+l.numVertices(b.geometry)},0)):this._numVertices=this._emptyFeatureRatio=0};Object.defineProperty(d.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numFeatures",{get:function(){return this._numFeatures!==d.UNKNOWN_COUNT?this._numFeatures:this._features?
this._features.length:0},set:function(b){this._numFeatures=b},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures!==d.UNKNOWN_COUNT},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"estimatedSize",{get:function(){if(0>this._estimatedSize&&(this._estimatedUnusedSize=this._estimatedSize=0,this._features))for(var b=0;b<this._features.length;++b){var c=l.estimateSize(this._features[b]);this._estimatedSize+=c;b>=this.featureLimit&&(this._estimatedUnusedSize+=c)}return this._estimatedSize},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"estimatedUnusedSize",{get:function(){if(0>this._estimatedUnusedSize&&(this._estimatedUnusedSize=0,this._features))for(var b=this.featureLimit;b<
this._features.length;++b)this._estimatedUnusedSize+=l.estimateSize(this._features[b]);return this._estimatedUnusedSize},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"needsFetching",{get:function(){return 0===
this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"needsDisplayUpdate",{get:function(){var b;if(b=!!this._features){a:{b=this._features;var c=this.displayingFeatures,a=this.featureLimit;
if(!c||!b||a!==c.length||a>b.length)b=!1;else{for(var d=0;d<a;++d)if(b[d]!==c[d]){b=!1;break a}b=!0}}b=!b}return b},enumerable:!0,configurable:!0});d.prototype.intersects=function(b){if(!b||!this.descriptor.extent)return!0;g.fromExtent(b,f);return g.intersects(this.descriptor.extent,f)};d.prototype.intersection=function(b,c){if(!b&&!this.descriptor.extent)return g.set(c,g.POSITIVE_INFINITY),c;b?(g.fromExtent(b,c),this.descriptor.extent&&g.intersection(c,this.descriptor.extent,c)):g.set(c,this.descriptor.extent);
return c};d.prototype._shuffle=function(d){this._features.sort(function(c,a){return b.getFeatureId(c,d)-b.getFeatureId(a,d)});q.shuffle(this._features,16438);this._shuffled=!0;this._estimatedUnusedSize=-1};d.prototype.reduceFeatures=function(b,c){if(0>=b)return!1;var a=!1;this._features?(this.featureLimit=Math.ceil(this.numFeatures*b),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&0<this._features.length&&(this.fetchStatus=1,a=!0)),!this._shuffled&&
1>b&&this._shuffle(c)):this.featureLimit=0;return a};Object.defineProperty(d.prototype,"cacheItem",{get:function(){return{features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},enumerable:!0,configurable:!0});d.prototype.loadCache=function(b){this.fetchRequest=null;this._features=b.features;this._numFeatures=b.numFeatures;this._emptyFeatureRatio=b.emptyFeatureRatio;this.fetchStatus=b.fetchStatus;
this.featuresMissing=b.featuresMissing;this._estimatedUnusedSize=this._estimatedSize=-1};return d}();(t||(t={})).UNKNOWN_COUNT=-1;var f=g.create();return t})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/operations/query".split(" "),function(t,
d,q,g,l,b,f,e){Object.defineProperty(d,"__esModule",{value:!0});var k=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}q(c,a);Object.defineProperty(c.prototype,"queryFeaturesDehydrated",{get:function(){var a=this,b=this.layer.capabilities;if((b=b&&b.query)&&b.supportsFormatPBF){var c={type:"dehydrated",applyTransform:!0,useWorker:!0,maxStringAttributeLength:1024};return function(b,d){return e.executeQueryPBF(a.layer.parsedUrl,b,c,d).then(function(a){return a.data})}}return function(b,
c){return e.executeQuery(a.layer.parsedUrl,b,c).then(function(a){return f.fromFeatureSetJSON(a.data)})}},enumerable:!0,configurable:!0});g([b.property({constructOnly:!0})],c.prototype,"layer",void 0);g([b.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],c.prototype,"queryFeaturesDehydrated",null);return c=g([b.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],c)}(b.declared(l)),c=function(a){function c(){return null!==a&&a.apply(this,
arguments)||this}q(c,a);c.prototype.queryFeaturesDehydrated=function(a,b){var c=this;return this.source.queryFeaturesJSON(a).then(f.fromFeatureSetJSON,function(b){if(b&&"query-features-json:unsupported"===b.name)return c.source.queryFeatures(a);throw b;})};g([b.property({constructOnly:!0})],c.prototype,"layer",void 0);g([b.aliasOf("layer.source")],c.prototype,"source",void 0);return c=g([b.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],c)}(b.declared(l));d.createFeatureTileQuery3D=
function(a){switch(a.source.type){case "feature-layer":return new k({layer:a});case "memory":case "csv":case "geojson":return new c({layer:a});case "stream-layer":throw Error("Tile based queries unsupported for stream sources");}}})},"esri/views/support/QueueProcessor":function(){define("require exports ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/scheduling".split(" "),function(t,d,q,g,l,b){return function(){function d(b){var d=this;this._apiPromises=new Map;this._processingItems=
new Map;this._isPaused=!1;this._task=this._schedule=null;this._pendingProcessing=0;this.concurrency=1;this.ordered=!1;b.concurrency&&(this.concurrency=b.concurrency);b.ordered&&(this.ordered=!0,this._itemsToProcess=[]);this._queue=new l({peeker:b.peeker});this.process=b.process;var c=b.scheduler;b.priority&&c&&(this._task=c.registerTask(b.priority,function(a){return d.update(a)},function(){return d.needsUpdate()}))}d.prototype.destroy=function(){this.clear();this._schedule&&(this._schedule.remove(),
this._schedule=null);this._task&&(this._task.remove(),this._task=null)};Object.defineProperty(d.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length+this._pendingProcessing},enumerable:!0,configurable:!0});d.prototype.clear=function(){this._queue.clear();var b=[];this._processingItems.forEach(function(d){return b.push(d.resultPromise)});this._processingItems.clear();b.forEach(function(b){return b.cancel()});b.length=0;this._apiPromises.forEach(function(d){return b.push(d)});
this._apiPromises.clear();b.forEach(function(b){return b.cancel()});this._cancelNext()};d.prototype.find=function(b,d){var c=this,a=void 0;this._apiPromises.forEach(function(e,f){b.call(d,f)&&(a=c._apiPromises.get(f).promise)});return a};d.prototype.get=function(b){return(b=this._apiPromises.get(b))&&b.promise||void 0};d.prototype.isOngoing=function(b){return this._processingItems.has(b)};d.prototype.has=function(b){return this._apiPromises.has(b)};d.prototype.pause=function(){this._isPaused||(this._isPaused=
!0,this._cancelNext())};d.prototype.push=function(b){var d=this;if(this._apiPromises.has(b))return this._apiPromises.get(b).promise;var c=g.createDeferred(function(a){var c=d._processingItems.get(b);c?c.resultPromise.cancel(a):(d._remove(b),d._scheduleNext())});this._add(b,c);this._scheduleNext();return c.promise};d.prototype.reset=function(){var b=[];this._processingItems.forEach(function(a){return b.push(a)});this._processingItems.clear();for(var d=0;d<b.length;d++){var c=b[d];c.resultPromise.isFulfilled()?
this._processReset(c):(c.isReset=!0,c.resultPromise.cancel())}};d.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())};d.prototype.needsUpdate=function(){return!this._isPaused&&0<this._queue.length&&this._processingItems.size<this.concurrency};d.prototype.update=function(b){for(;!b.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),b.madeProgress()};d.prototype._scheduleNext=function(){var d=this;this._task||this._isPaused||
this._schedule||(this._schedule=b.schedule(function(){d._schedule=null;d._next()}))};d.prototype._next=function(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())};d.prototype._cancelNext=function(){this._schedule&&(this._schedule.remove(),this._schedule=null)};d.prototype._processResult=function(b,d){this._remove(b.item);this._scheduleNext();b.dfd.resolve(d)};d.prototype._processError=function(b,d){b.isReset?this._processReset(b):(this._remove(b.item),
this._scheduleNext(),b.dfd.reject(d))};d.prototype._processReset=function(b){this._remove(b.item);this._add(b.item,b.dfd);this._scheduleNext()};d.prototype._processOrdered=function(b,d){var c=this;if(b.isReset)this._processReset(b);else{b.result=d;var a=!1;this._processingItems.forEach(function(b){a||(b.result?c._itemsToProcess.push(b):a=!0)});b=0;for(d=this._itemsToProcess;b<d.length;b++){var e=d[b];!1===e.result.ok?this._processError(e,e.result.error):this._processResult(e,e.result.value)}this._itemsToProcess.length=
0}};d.prototype._process=function(b){var d=this;if(!q.isNone(b)){var c=this._apiPromises.get(b);this._pendingProcessing++;var a=this.process(b);this._pendingProcessing--;if(a&&"function"===typeof a.then){var e={item:b,resultPromise:a,result:null,dfd:c,isReset:!1};this._processingItems.set(b,e);this.ordered?a.then(function(a){return d._processOrdered(e,{ok:!0,value:a})},function(a){return d._processOrdered(e,{ok:!1,error:a})}):a.then(function(a){return d._processResult(e,a)},function(a){return d._processError(e,
a)})}else c.resolve(a),this._remove(b)}};d.prototype._add=function(b,d){this._apiPromises.set(b,d);this._queue.push(b)};d.prototype._remove=function(b){this._queue.remove(b);this._apiPromises.delete(b);this._processingItems.delete(b)};Object.defineProperty(d.prototype,"test",{get:function(){var b=this;return{update:function(d){return b.update(d)}}},enumerable:!0,configurable:!0});return d}()})},"esri/core/Queue":function(){define(["require","exports"],function(t,d){return function(){function d(d){this._items=
[];this._itemSet=new Set;this._peeker=function(d){return d[0]};this._length=0;d&&d.peeker&&(this._peeker=d.peeker)}Object.defineProperty(d.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0});d.prototype.clear=function(){this._itemSet.clear();this._length=this._items.length=0};d.prototype.peek=function(){if(0!==this._length)return this._peeker(this._items)};d.prototype.push=function(d){this.contains(d)||this._add(d)};d.prototype.contains=function(d){return 0<this._length&&
this._itemSet.has(d)};d.prototype.pop=function(){if(0!==this._length){var d=this.peek();this._remove(d);return d}};d.prototype.remove=function(d){this.contains(d)&&this._remove(d)};d.prototype._add=function(d){this._items.push(d);this._itemSet.add(d);this._length++};d.prototype._remove=function(d){this._itemSet.delete(d);this._items.splice(this._items.indexOf(d),1);this._length--};return d}()})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("require exports ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),
function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,"__esModule",{value:!0});var c=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];t=function(){function a(a,b,d){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=a;this.view=d;this.tilingScheme=
new k(b);this.loadedSymbols=c.map(function(a){return new f(new l({material:{color:[a[0],a[1],a[2],.6]},outline:{color:"black",size:1}}))});this.loadingSymbols=[new f(new l({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new f(new l({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new f(new l({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}a.prototype.destroy=function(){this.enabled=!1};Object.defineProperty(a.prototype,
"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});a.prototype.update=function(){var a=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(a){return a.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(a){return!a.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(a){return!a.isFetching},symbols:this.pendingSymbols}),
this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))};a.prototype.showDataExtent=function(a){this.dataExtentGraphic&&
(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);a&&(a=g.fromExtent(a),this.dataExtentGraphic=new q({geometry:a,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};a.prototype.synchronizeMaps=function(a,c){var d=this,f=[];a.forEach(function(a,b){var e=d.tileFetcher.getFeatureTileById(b);e&&c.filter(e)||(d.view.graphics.removeMany(a),f.push(b))});f.forEach(function(b){return a.delete(b)});this.tileFetcher.forEachFeatureTile(function(f){if(c.filter(f)&&
!a.has(f.id)){var g=f.descriptor.lij,h=g[0],k=g[1],l=g[2];d.tilingScheme.ensureMaxLod(h);var n=d.tilingScheme.getExtentGeometry(h,k,l),g=new q({geometry:n,symbol:c.symbols[h%c.symbols.length]}),h=new q({geometry:n.center,symbol:new b({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new e({text:h+"/"+k+"/"+l,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})}),h=[g,h];a.set(f.id,h);d.view.graphics.addMany(h)}})};return a}();
d.FeatureTileFetcher3DDebugger=t;d.default=t})},"esri/layers/graphics/controllers/support/controllerUtils":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.isRefreshable=function(d){return d&&d.refresh}})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/asyncUtils ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/QueryEngine ../../../renderers/support/renderingInfoUtils ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./support/projectExtentUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r){return function(d){function u(a){a=d.call(this)||this;a.controller=null;a.asyncGraphicsUpdates=!1;a.suspendResumeExtentMode="computed";a.slicePlaneEnabled=!1;a.supportsDraping=!0;a.overlayUpdating=!1;a.fullExtentInLocalViewSpatialReference=null;a.suspendResumeExtent=null;a._queryEngine=null;a._controllerCreated=!1;a.clippingExtent=null;a.supportsHeightUnitConversion=!0;a.pendingController=null;return a}q(u,d);u.prototype.initialize=function(){var a=this;
this.layer.isTable?this.addResolvingPromise(k.reject(new e("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer}))):(this._set("graphics3d",new v({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,asyncGraphicsUpdates:this.asyncGraphicsUpdates,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(b){return a.updateClippingExtent(b)}})),
this.handles.add([this.watch("asyncGraphicsUpdates",function(b){a.graphics3d.graphicsCore.asyncUpdates=b}),this.watch("suspendResumeExtentMode",function(b){a.graphics3d.suspendResumeExtentMode=b})]),this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this.addResolvingPromise(this.graphics3d.setup().then(function(){return a.validateGeometryType()}).then(function(){return r.toViewIfLocal(a)}).then(function(b){return a.fullExtentInLocalViewSpatialReference=b}).then(function(){return a.initializeController()})),
this.notifyChange("updating"))};u.prototype.destroy=function(){this.destroyPendingController();this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this.loadedGraphics=null;this._queryEngine&&this._queryEngine.destroy();this._queryEngine=null};u.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};Object.defineProperty(u.prototype,
"drawingOrder",{set:function(a){this.graphics3d.graphicsCore.setDrawingOrder(a);this._set("drawingOrder",a)},enumerable:!0,configurable:!0});u.prototype.getRenderingInfo=function(a,b){(a=n.getRenderingInfo(a,{renderer:b}))&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};u.prototype.getGraphicFromGraphicUid=function(a){var b=this,c=null;this.loadedGraphics&&this.loadedGraphics.forEach(function(d){d.uid===a&&(c=h.hydrateGraphic(d,b.layer))});return c};Object.defineProperty(u.prototype,
"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,
configurable:!0});u.prototype.whenGraphicBounds=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(a,b):null};u.prototype.whenSymbolLayerSize=function(a,b){return this.graphics3d?f.safeCast(this.graphics3d.graphicsCore.whenSymbolLayerSize(a,b)):null};u.prototype.queryFeatures=function(a){return this._queryEngine?this._queryEngine.queryFeatures(a):this._rejectQuery()};u.prototype.queryObjectIds=function(a){return this._queryEngine?this._queryEngine.queryObjectIds(a):
this._rejectQuery()};u.prototype.queryFeatureCount=function(a){return this._queryEngine?this._queryEngine.queryFeatureCount(a):this._rejectQuery()};u.prototype.queryExtent=function(a){return this._queryEngine?this._queryEngine.queryExtent(a):this._rejectQuery()};u.prototype.highlight=function(a,b){void 0===b&&(b={});return this.graphics3d.highlight(a,b,this.layer.objectIdField)};u.prototype.getStats=function(){var a=this.graphics3d.graphicsCore.getStats();a.features=this.loadedGraphics.length;a.updating=
this.updating;a.elevationUpdating=this.graphics3d.elevationAlignment.updating;a.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended;a.visibilityScale=!this.graphics3d.scaleVisibility.suspended;return a};u.prototype.canResume=function(){return!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended?!1:!0};u.prototype.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating||
!this.view.basemapTerrain||!this.view.basemapTerrain.ready||this.graphics3d.updating};u.prototype.initializeController=function(){return b(this,void 0,void 0,function(){var a;return l(this,function(b){switch(b.label){case 0:return[4,this.createController()];case 1:return this.pendingController=a=b.sent(),[4,a.when()];case 2:return b.sent(),this.setControllerWhenInitialized(a),[2]}})})};u.prototype.setControllerWhenInitialized=function(a){return b(this,void 0,void 0,function(){return l(this,function(b){switch(b.label){case 0:return b.trys.push([0,
2,,3]),[4,this.when()];case 1:return b.sent(),[3,3];case 2:return b.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,c.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return b.sent(),this.pendingController=null,this.controller=a,this.loadedGraphics=a.graphics,this._queryEngine=new p({layer:this.layer,features:this.loadedGraphics,objectIdField:this.layer.objectIdField,dataSpatialReference:this.view.spatialReference}),
this.notifyChange("updating"),[2]}})})};u.prototype.updateClippingExtent=function(a){this.clippingExtent=a;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=a,!0}};u.prototype.validateGeometryType=function(){var a=this.layer;switch(a.geometryType){case "multipatch":case "multipoint":return k.reject(new e("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:a.geometryType}))}};
u.prototype._rejectQuery=function(){return k.reject(new e("featurelayerview3d:query","Not ready to execute query"))};g([a.property()],u.prototype,"loadedGraphics",void 0);g([a.property({dependsOn:["graphics3d.suspended"]})],u.prototype,"suspended",void 0);g([a.property({dependsOn:["graphics3d.updating","controller.updating","overlayUpdating"]})],u.prototype,"updating",void 0);g([a.property()],u.prototype,"controller",void 0);g([a.property()],u.prototype,"graphics3d",void 0);g([a.property({readOnly:!0})],
u.prototype,"asyncGraphicsUpdates",void 0);g([a.property({readOnly:!0})],u.prototype,"suspendResumeExtentMode",void 0);g([a.property({type:Boolean})],u.prototype,"slicePlaneEnabled",void 0);g([a.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],u.prototype,"hasDraped",void 0);g([a.property({readOnly:!0,type:Boolean})],u.prototype,"supportsDraping",void 0);g([a.property({type:Boolean})],u.prototype,"overlayUpdating",void 0);g([a.property()],u.prototype,"drawingOrder",null);return u=g([a.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],
u)}(a.declared(u))})},"esri/layers/graphics/QueryEngine":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/Accessor ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ./dehydratedFeatures ../../tasks/support/FeatureSet".split(" "),function(t,d,q,g,l,b,f,e,k,c,a,h){t=function(b){function d(a){a=b.call(this)||this;a.features=null;a.layer=null;a.objectIdField=
null;a.dataSpatialReference=null;return a}q(d,b);d.prototype.queryFeatures=function(b){var c=this;return this._queryFeatures(b).then(function(b){b=b.map(function(b){return a.hydrateGraphic(b,c.layer)});return new h({features:b,fields:c.layer?c.layer.fields.slice():null,geometryType:c.layer?c.layer.geometryType:null,spatialReference:c.dataSpatialReference?c.dataSpatialReference.clone():null})})};d.prototype.queryObjectIds=function(a){var b=this;return this.objectIdField?this.queryFeatures(a).then(function(a){return b._getObjectIds(a.features)}):
this._rejectQuery("Unsupported query")};d.prototype.queryFeatureCount=function(a){return this.features&&!a?e.resolve(this.features.length):this._queryFeatures(a).then(function(a){return a.length})};d.prototype.queryExtent=function(a){var b=this;return this.queryFeatures(a).then(function(a){return{count:a.features.length,extent:b._getExtent(a.features)}})};d.prototype._queryFeatures=function(a){if(this.features){if(a){if(this._isSupportedQuery(a)){var b=this._createFilters(a);return b.length?this._executeQuery(a,
b):this._rejectQuery("Invalid query")}return this._rejectQuery("Unsupported query")}return this._returnAllFeatures()}return this._rejectQuery("Engine not initialized")};d.prototype._returnAllFeatures=function(){return e.resolve(this.features.toArray())};d.prototype._executeQuery=function(a,b){var c=this,d=[];this.features.forEach(function(e){b.every(function(b){return b.call(c,e,a)})&&d.push(e)});return e.resolve(d)};d.prototype._isSupportedQuery=function(a){var b=!0;if(null!=a.distance||null!=a.geometryPrecision||
a.groupByFieldsForStatistics&&a.groupByFieldsForStatistics.length||null!=a.maxAllowableOffset||a.multipatchOption||null!=a.num||a.orderByFields&&a.orderByFields.length||a.outFields&&a.outFields.length||a.outSpatialReference||a.outStatistics&&a.outStatistics.length||a.pixelSize||a.quantizationParameters||a.relationParameter||a.returnDistinctValues||null!=a.start||a.text||a.timeExtent||a.where||a.objectIds&&a.objectIds.length&&!this.objectIdField)b=!1;return b};d.prototype._createFilters=function(a){var b=
[];a.objectIds&&a.objectIds.length&&b.push(this._createObjectIdFilter());a.geometry&&"extent"===a.geometry.type&&"intersects"===a.spatialRelationship&&b.push(this._createExtentFilter());return b};d.prototype._createExtentFilter=function(){return function(b,d){b=b.geometry;if(!b)return!1;c.fromExtent(d.geometry,p);a.computeAABR(b,n);return c.intersects(p,n)}};d.prototype._createObjectIdFilter=function(){var a=this;return function(b,c){b=b.attributes;return-1<c.objectIds.indexOf(b&&b[a.objectIdField])}};
d.prototype._rejectQuery=function(a){return e.reject(new f(this.declaredClass,a))};d.prototype._getObjectIds=function(a){var b=this.objectIdField,c=[];a.forEach(function(a){a=(a=a.attributes)&&a[b];null!=a&&c.push(a)});return c};d.prototype._getExtent=function(b){if(0===b.length)return null;c.empty(p);for(var d=0;d<b.length;d++)a.computeAABR(b[d].geometry,n),c.expand(p,n,p);return new l.Extent({xmin:p[0],ymin:p[1],xmax:p[2],ymax:p[3],spatialReference:b[0].geometry.spatialReference})};g([k.property()],
d.prototype,"features",void 0);g([k.property({constructOnly:!0})],d.prototype,"layer",void 0);g([k.property()],d.prototype,"objectIdField",void 0);g([k.property()],d.prototype,"dataSpatialReference",void 0);return d=g([k.subclass("esri.layers.graphics.QueryEngine")],d)}(k.declared(b));var p=c.create(),n=c.create();return t})},"esri/renderers/support/renderingInfoUtils":function(){define(["require","exports"],function(t,d){function q(d,b){if(!d||d.symbol)return null;b=b.renderer;return d&&b&&b.getObservationRenderer?
b.getObservationRenderer(d):b}function g(d,b){if(d.symbol)return d.symbol;var f=q(d,b);return f&&f.getSymbol(d,b)}Object.defineProperty(d,"__esModule",{value:!0});d.getRenderer=q;d.getSymbol=g;d.getRenderingInfo=function(d,b){var f=q(d,b),e=g(d,b);if(!e)return null;e={renderer:f,symbol:e};if(!(f&&"visualVariables"in f&&f.visualVariables))return e;var k=["proportional","proportional","proportional"],c=0;for(d=f.getVisualVariableValues(d,b);c<d.length;c++){f=d[c];b=f.variable;var a=f.value;"color"===
b.type?e.color=a.toRgba():"size"===b.type?"outline"===b.target?e.outlineSize=a:(f=b.axis,b=b.useSymbolValue?"symbolValue":a,"width"===f?k[0]=b:"depth"===f?k[1]=b:"height"===f?k[2]=b:k[0]="width-and-depth"===f?k[1]=b:k[1]=k[2]=b):"opacity"===b.type?e.opacity=a:"rotation"===b.type&&"tilt"===b.axis?e.tilt=a:"rotation"===b.type&&"roll"===b.axis?e.roll=a:"rotation"===b.type&&(e.heading=a)}if(isFinite(k[0])||isFinite(k[1])||isFinite(k[2]))e.size=k;return e}})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../Graphic ../../../../core/Accessor ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/diffUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DHighlights ./Graphics3DScaleVisibility ./Graphics3DSpatialIndex ./graphicUtils ../support/attributeUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B){var E={remove:function(){},pause:function(){},resume:function(){}};return function(b){function d(a){a=b.call(this)||this;a._handles=new e;a.highlights=new m;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}q(d,b);Object.defineProperty(d.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating)},enumerable:!0,configurable:!0});d.prototype.normalizeCtorArgs=function(a){var b=a.queryGraphicUIDsInExtent||!a.scaleVisibilityEnabled&&!a.elevationAlignmentEnabled?null:new A({spatialReference:a.owner.view.spatialReference}),c=a.frustumVisibilityEnabled?new w:null,d=a.scaleVisibilityEnabled?new x:null,e=a.filterVisibilityEnabled&&
"multipatch"!==a.layer.geometryType?new y.Graphics3DFilterVisibility({geometryType:a.layer.geometryType}):null,f=a.elevationAlignmentEnabled?new r:null,g=function(a,c,d){return b.queryGraphicUIDsInExtent(a,c,d)};return{graphicsCore:new v({owner:a.owner,layer:a.layer,asyncUpdates:a.asyncGraphicsUpdates,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1}),frustumVisibility:c,scaleVisibility:d,filterVisibility:e,elevationAlignment:f,spatialIndex:b,updateClippingExtent:a.updateClippingExtent,
suspendResumeExtentMode:a.suspendResumeExtentMode,dataExtent:a.dataExtent,queryGraphicUIDsInExtent:a.queryGraphicUIDsInExtent||g}};d.prototype.initialize=function(){var a=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()}));this.filterVisibility&&this._handles.add(this.owner.watch("filter",function(){return a.filterVisibility.filterChanged()}));this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",
function(b,c){p.diff(b,c)&&a.graphicsCore.elevationInfoChange()}));this._handles.add(this.layer.watch("labelsVisible",function(){return a.graphicsCore.updateVisibilityInfo()}));this._handles.add(this.layer.watch("labelingInfo",function(b,c){p.diff(b,c)&&a.graphicsCore.updateLabelingInfo()}))};d.prototype.setup=function(){var a=this;this.frustumVisibility&&this.frustumVisibility.setup(this.owner);var b=this.owner,c=this.owner.view.basemapTerrain;this.scaleVisibility&&this.scaleVisibility.setup(b,this.layer,
this.queryGraphicUIDsInExtent,this.graphicsCore,c);this.filterVisibility&&this.filterVisibility.setup(b,this.graphicsCore);this.elevationAlignment&&this.elevationAlignment.setup(b,this.queryGraphicUIDsInExtent,this.graphicsCore,b.view.elevationProvider);this.highlights&&this.highlights.setup(this.graphicsCore);this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility,this.spatialIndex));this._set("deconfliction",b.view.deconflictor.addGraphicsOwner(this.graphicsCore));
this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,spatialIndex:this.spatialIndex,deconfliction:this.deconfliction,labeling:this.labeling,highlights:this.highlights});this._handles.add([this.layer.watch("renderer",function(b){return a.graphicsCore.rendererChange(b)}),b.watch("fullOpacity",function(){return a.graphicsCore.opacityChange()})]);this.setupSuspendResumeExtent();this.updateClippingExtent&&(this._handles.add(b.view.watch("clippingArea",
function(){return a._updateClippingExtent()})),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();return this.graphicsCore.labelsEnabled?this.graphicsCore.updateLabelingInfo():k.resolve()};d.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var a=0,b="frustumVisibility scaleVisibility filterVisibility elevationAlignment highlights graphicsCore spatialIndex".split(" ");a<b.length;a++){var c=b[a],d=this[c];d&&(d.destroy(),this._set(c,null))}this._set("layer",
null);this._set("owner",null)};d.prototype.highlight=function(a,b,c){var d=this;if(a instanceof n){b=this.highlights.acquireSet(b,c);var e=b.set,f=b.handle;this.owner.queryObjectIds(a).then(function(a){return d.highlights.setObjectIds(e,a)});return f}if("number"===typeof a||a instanceof l)return this.highlight([a],b,c);"toArray"in a&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof l)if(f=a,c&&f[0].attributes&&null!==B.attributeLookup(f[0].attributes,c))a=f.map(function(a){return B.attributeLookup(a.attributes,
c)});else return a=f.map(function(a){return a.uid}),f=this.highlights.acquireSet(b,null),b=f.set,f=f.handle,this.highlights.setUids(b,a),f;if("number"===typeof a[0])return f=this.highlights.acquireSet(b,c),b=f.set,f=f.handle,this.highlights.setObjectIds(b,a),f}return E};d.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};d.prototype.setupSuspendResumeExtent=
function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(c.init(this,"suspendResumeExtentMode",function(){a._handles.remove("suspendResumeExtentMode");switch(a.suspendResumeExtentMode){case "computed":a._handles.add(c.init(a.graphicsCore,"computedExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;case "data":a._handles.add(c.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;
default:f.neverReached(a.suspendResumeExtentMode)}}))};d.prototype.updateSuspendResumeExtent=function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};d.prototype.extentToSuspendResumeRect=function(a,b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!h.canProject(a,c))return;a=h.project(a,c)}return C.enlargeExtent(a,b,u.SUSPEND_RESUME_EXTENT_OPTIMISM)};d.prototype.suspendResumeExtentChanged=
function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);this.scaleVisibility&&this.scaleVisibility.setExtent(a)};g([a.property({aliasOf:"graphicsCore.layer"})],d.prototype,"layer",void 0);g([a.property({aliasOf:"graphicsCore.owner"})],d.prototype,"owner",void 0);g([a.property({constructOnly:!0})],d.prototype,"updateClippingExtent",void 0);g([a.property({constructOnly:!0})],d.prototype,"queryGraphicUIDsInExtent",void 0);g([a.property({constructOnly:!0})],d.prototype,"graphicsCore",
void 0);g([a.property({constructOnly:!0})],d.prototype,"spatialIndex",void 0);g([a.property({constructOnly:!0})],d.prototype,"scaleVisibility",void 0);g([a.property({constructOnly:!0})],d.prototype,"filterVisibility",void 0);g([a.property({constructOnly:!0})],d.prototype,"elevationAlignment",void 0);g([a.property({constructOnly:!0})],d.prototype,"frustumVisibility",void 0);g([a.property({readOnly:!0})],d.prototype,"deconfliction",void 0);g([a.property({readOnly:!0})],d.prototype,"labeling",void 0);
g([a.property({readOnly:!0})],d.prototype,"highlights",void 0);g([a.property()],d.prototype,"suspendResumeExtentMode",void 0);g([a.property()],d.prototype,"dataExtent",void 0);g([a.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],d.prototype,"suspended",null);g([a.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating"]})],d.prototype,"updating",null);return d=g([a.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],
d)}(a.declared(b))})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.defaultIconElevationOffset=1;d.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry ../../../../renderers ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/now ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/diffUtils ../../../../renderers/support/rendererConversion ../../../../support/arcadeUtils ../../../../symbols/support/symbolConversion ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DGraphic ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./graphicUtils ./symbolComplexity ../../support/projectionUtils ../../support/PropertiesPool ../../webgl-engine/Stage ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/Layer".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M,Q,P,O,U,N,V,X,J,R,T,W,Z,fa,ga,ja){var ia=new f.Point,ka=E.vec3f64.create(),da=I.create(),Y=v.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");t=function(c){function d(a){a=c.call(this)||this;a.propertiesPool=new Z.PropertiesPool({computedExtent:f.Extent},a);a.computedExtent=null;a.currentRenderer=null;a.rendererHasGeometryOperations=!1;a.symbolCreationContext=new V.Graphics3DSymbolCreationContext;a.graphics=new Map;a.stageLayer=
null;a.stage=null;a.graphicsDrapedUids=new Set;a.graphicsBySymbol=new Map;a.symbolConversionCache=new Map;a.symbols=new Map;a.graphicsWithoutSymbol={};a.graphicsWaitingForSymbol=new Set;a.lastFastUpdate=null;a.handles=new n;a.viewSR=null;a.elevationAlignment=null;a.scaleVisibility=null;a.filterVisibility=null;a.spatialIndex=null;a.deconfliction=null;a.labeling=null;a.highlights=null;a.viewElevationProvider=null;a.sharedSymbolResourcesOwnerHandle=null;a.whenGraphics3DGraphicRequests={};a.pendingUpdates=
new Map;a.pendingAdds=0;a.pendingRemoves=0;a.pendingUpdatesPool=new x({allocator:function(a){return a||{add:null,remove:null}},deallocator:function(a){a.add=null;a.remove=null;return a}});a.symbolWarningLogged=!1;a.geometryWarningLogged=!1;a.objectIdInvisibleSet=new Set;a._whenSymbolRemoved=new x;a.asyncUpdates=!1;a.elevationFeatureExpressionEnabled=!0;a.owner=null;a.layer=null;a.hasDraped=!1;a.graphicSymbolSupported=!0;a._usedMemory=0;a.numberOfGraphics=0;a._visible=void 0;a._startCreateGraphics=
!1;a.maxPendingUpdates=0;return a}q(d,c);m=d;Object.defineProperty(d.prototype,"updating",{get:function(){return!!(0<this.graphicsWaitingForSymbol.size||this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"displayFeatureLimit",{get:function(){var a=this.owner&&this.owner.view&&this.owner.view.qualitySettings,b=a?a.graphics3D.minTotalNumberOfFeatures:0,c=a?a.graphics3D.maxTotalNumberOfFeatures:0,a=a?a.graphics3D.maxTotalNumberOfPrimitives:0,d=this.maxSymbolComplexity,e=Math.max(b,Math.min(c,Math.ceil(a/Math.max(1,
d?d.primitivesPerFeature:1)))),f=this._get("displayFeatureLimit");return f&&f.minimumTotalNumberOfFeatures===b&&f.maximumTotalNumberOfFeatures===c&&f.maximumTotalNumberOfPrimitives===a&&f.maximumSymbolComplexity===d&&f.maximumNumberOfFeatures===e?f:{minimumTotalNumberOfFeatures:b,maximumTotalNumberOfFeatures:c,maximumTotalNumberOfPrimitives:a,maximumSymbolComplexity:d,maximumNumberOfFeatures:e}},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maxSymbolComplexity",{get:function(){for(var a=
null,b=0,c=this.getSymbolComplexities();b<c.length;b++){var d=c[b];a?0===a.primitivesPerCoordinate&&d.primitivesPerFeature>a.primitivesPerFeature?a=d:0!==a.primitivesPerCoordinate&&d.primitivesPerCoordinate>a.primitivesPerCoordinate&&(a=d):a=d}b=this._get("maxSymbolComplexity");return!a||b&&b.primitivesPerFeature===a.primitivesPerFeature&&b.primitivesPerCoordinate===a.primitivesPerCoordinate?b:a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"usedMemory",{get:function(){return this._usedMemory},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0});d.prototype.getSymbolComplexities=
function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()};d.prototype.getConvertedSymbol=function(a){if("web-style"===a.type)return a.clone();var b=this.symbolConversionCache.get(a.id);if(void 0!==b)return b;var b=P.to3D(a,!0,!1,this.hasLabelingContext(a)),c=b.symbol||null;c||b.error&&Y.error(b.error.message);this.symbolConversionCache.set(a.id,c);return c};d.prototype.getSymbolComplexitiesUsedOrRenderer=function(a){a=a.getSymbols();
if(!a||!a.length)return[];for(var b=[],c=0;c<a.length;c++){var d=a[c],e=this.symbols.get(d.id);e?b.push(e.complexity):(d=this.getConvertedSymbol(d))&&b.push(T.defaultSymbolComplexity(d))}return b};d.prototype.getSymbolComplexitiesUsed=function(){var a=[];this.symbols.forEach(function(b){b&&a.push(b.complexity)});return a};d.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference};d.prototype.setup=function(a){var b=this;this._set("elevationAlignment",a.elevationAlignment);this._set("scaleVisibility",
a.scaleVisibility);this._set("filterVisibility",a.filterVisibility);this._set("spatialIndex",a.spatialIndex);this._set("deconfliction",a.deconfliction);this._set("labeling",a.labeling);this._set("highlights",a.highlights);var c=this.owner.view;this.viewElevationProvider=new O.ViewElevationProvider(this.viewSR,c);this.initializeStage(c,this.layer.uid);this.symbolCreationContext.sharedResources=c.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=c.sharedSymbolResources.addGraphicsOwner(this.owner);
this.symbolCreationContext.renderer=this.currentRenderer;this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataSupplier=c.sharedSymbolResources.streamDataSupplier;this.symbolCreationContext.renderSpatialReference=c.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=c.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=this.owner;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=
new ga;this.symbolCreationContext.elevationProvider=c.elevationProvider;this.symbolCreationContext.isAsync=this.asyncUpdates;a=U.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=U.createContext(a,this.viewSR,Y);this.symbolCreationContext.screenSizePerspectiveEnabled=c.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;
this.handles.add(this.owner.watch("suspended",function(){return b.updateLayerVisibility()}));this.handles.add([this.owner.watch("layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",function(){var a=c.screenSizePerspectiveEnabled&&b.layer.screenSizePerspectiveEnabled;a!==b.symbolCreationContext.screenSizePerspectiveEnabled&&(b.symbolCreationContext.screenSizePerspectiveEnabled=a,b.recreateAllGraphics())}),this.owner.watch("slicePlaneEnabled",
function(a){return b.slicePlaneEnabledChange(!!a)}),this.owner.view.watch("pixelRatio",function(a){return b.pixelRatioChange(a)}),C.when(c.basemapTerrain,"tilingScheme",function(a){a.spatialReference.equals(b.symbolCreationContext.overlaySR)||(b.symbolCreationContext.overlaySR=c.basemapTerrain.spatialReference);b.handles.has("loaded-graphics")?b.recreateAllGraphics():b.handles.add(C.on(b.owner,"loadedGraphics","change",function(a){return b.graphicsCollectionChanged(a)},function(){return b.recreateAllGraphics()}),
"loaded-graphics")}),c.resourceController.scheduler.registerTask(3,function(a){return b.update(a)},function(){return b.needsUpdate()})]);this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",function(){return b.deconfliction.featureReductionChange()}));this.rendererChange(this.layer.renderer);this.notifyChange("maxSymbolComplexity")};d.prototype.destroy=function(){this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);
this.clear();this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(fa.ModelContentType.LAYER,this.stageLayer.id),this.stage=this.stageLayer=null);this.handles.destroy();this.viewSR=this.handles=null;this._set("owner",null);for(var a in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[a].reject(new p("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),
this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null);this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear()};d.prototype.clear=function(){this.graphics.forEach(function(a){return a.destroy()});this.spatialIndex&&this.spatialIndex.clear();this.graphics.clear();this._usedMemory=this.numberOfGraphics=0;this.updateLayerVisibility();this.symbols.forEach(function(a){a&&a.destroy()});this.symbols.clear();
this.graphicsBySymbol.clear();this.graphicsWithoutSymbol={};this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=this.pendingAdds=this.maxPendingUpdates=0;this._set("hasDraped",!1);this.notifyChange("updating");this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};d.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new ja(b,{isPickable:!this.owner.suspended},b);this.stage.add(fa.ModelContentType.LAYER,
this.stageLayer);this.stage.addToViewContent([this.stageLayer.id])};d.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var b=new Set;this.symbols.forEach(function(c){c&&c.setDrawOrder(a,b)});0<b.size&&this.stage.getDrapedRenderer().updateRenderOrder(b)};d.prototype.updateLayerVisibility=function(){var a=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*aa,a=!this.owner.suspended&&!a;a!==this._visible&&((this._visible=a)?(this.stageLayer.isPickable=
!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())};d.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};Object.defineProperty(d.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,configurable:!0});d.prototype.getGraphics3DGraphicById=function(a){return this.graphics.get(a)};d.prototype._getGraphicObjectID=
function(a,b){void 0===b&&(b=this.owner.layer&&this.owner.layer.objectIdField);return null!=a.objectId?a.objectId:b&&a.attributes[b]};Object.defineProperty(d.prototype,"graphics3DGraphicsByObjectID",{get:function(){var a=this,b=this.owner.layer&&this.owner.layer.objectIdField;if(!b)return null;var c=new Map;this.graphics.forEach(function(d){if(d){var e=a._getGraphicObjectID(d.graphic,b);y.isSome(e)&&c.set(e,d)}});return c},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"labelsEnabled",
{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0});d.prototype.updateLabelingInfo=function(a){var b=this.deconfliction&&this.deconfliction.labelingInfoChange(a);a=this.labeling&&this.labeling.labelingInfoChange(a);return A.all([b,a]).then()};d.prototype.updateVisibilityInfo=function(){this.deconfliction&&this.deconfliction.labelingInfoChange();this.labeling&&this.labeling.visibilityInfoChange()};Object.defineProperty(d.prototype,"symbolUpdateType",
{get:function(){var a=this;if(0<this.pendingUpdates.size)return"unknown";var b=0,c=0;return u.everyMap(this.symbols,function(d,e){if(d){d=d.getFastUpdateStatus();if(0<d.loading)return!1;a.graphicsBySymbol.has(e)&&(c+=d.fast,b+=d.slow)}})?0<=c&&0===b?"fast":0<=b&&0===c?"slow":"mixed":"unknown"},enumerable:!0,configurable:!0});d.prototype.needsUpdate=function(){return 0<this.pendingUpdates.size?!0:!!this.lastFastUpdate&&500<w()-this.lastFastUpdate};d.prototype.update=function(a){var b=this.needsUpdate();
this._applyPendingUpdates(a);!a.done&&this.lastFastUpdate&&(this.lastFastUpdate=null);b!==this.needsUpdate()&&this.notifyChange("updating")};d.prototype.setObjectIdVisibility=function(a,b){b?this.objectIdInvisibleSet.delete(a):this.objectIdInvisibleSet.add(a);a=this._findGraphics3DGraphicByObjectId(a);y.isSome(a)&&this._updateUserVisibility(a)};d.prototype._findGraphics3DGraphicByObjectId=function(a){var b=this,c;u.everyMap(this.graphics,function(d){return b._getGraphicObjectID(d.graphic)===a?(c=
d,!1):!0});return c};d.prototype._updateUserVisibility=function(a){if(y.isNone(a))return!1;var b=a.graphic,c=this._getGraphicObjectID(b),b=b.visible&&!this.owner.suspended&&(y.isNone(c)||!this.objectIdInvisibleSet.has(c));return a.setVisibilityFlag(0,b,0)};d.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics.get(a.uid);if(b)return A.resolve(b);if(b=this.whenGraphics3DGraphicRequests[a.uid])return b.promise;b=A.createDeferred();this.whenGraphics3DGraphicRequests[a.uid]=b;return b.promise};
d.prototype.boundsForGraphics3DGraphic=function(a,c){return b(this,void 0,void 0,function(){var b,d,e,f,g,h,k,m,n,p;return l(this,function(l){switch(l.label){case 0:return b=this.owner.view.spatialReference,d=this.owner.view.renderSpatialReference,e=this.owner.view.basemapTerrain.spatialReference,f=function(a,c,e){return W.bufferToBuffer(a,d,c,a,b,c,e)},g=function(a,c,d){return W.bufferToBuffer(a,e,c,a,b,c,d)},h=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:c&&c.useViewElevation,
minDemResolution:c&&c.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,a.getProjectedBoundingBox(f,g,h)];case 1:k=l.sent();if(!k)return[2,null];m=k.boundingBox;k.requiresDrapedElevation&&(n=this.symbolCreationContext.elevationProvider)&&(I.center(m,ka),ia.x=ka[0],ia.y=ka[1],ia.z=void 0,ia.spatialReference=b,p=n.getElevation(ia)||0,m[2]=Math.min(m[2],p),m[5]=Math.max(m[5],p));return[2,{boundingBox:m,screenSpaceObjects:k.screenSpaceObjects}]}})})};d.prototype.whenGraphicBounds=
function(a,b){var c=this;return C.whenOnce(this.owner,"loadedGraphics").then(function(){var b=c.owner.layer&&c.owner.layer.objectIdField,d=c.owner.loadedGraphics.find(function(c){return c===a?!0:b&&c.attributes&&a.attributes&&c.attributes[b]===a.attributes[b]});if(d)return c.whenGraphics3DGraphic(d);throw new p("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return c.boundsForGraphics3DGraphic(a,b)})};d.prototype.whenSymbolLayerSize=function(a,c){return b(this,
void 0,void 0,function(){var b,d,e;return l(this,function(f){b=this.symbols.get(a.id);if(null==b)throw new p("internal:symbol-not-part-of-view","Symbol is not part of this view");d=a.symbolLayers.indexOf(c);if(-1===d)throw new p("internal:missing-symbol-layer","Symbol layer is not in symbol");e=A.createResolver();b.getSymbolLayerSize(d,function(a){null==a?e.reject(new p("internal:missing-size","Symbol layer has no valid size")):e(a)});return[2,e.promise]})})};d.prototype.graphicsCollectionChanged=
function(a){this._startCreateGraphics&&(this.add(a.added),this.remove(a.removed))};d.prototype.graphicUpdateHandler=function(a){var b=a.graphic.uid,c=this.graphics.get(b),b=this.graphicsWithoutSymbol[b];if(c||b)switch(a.property){case "visible":this.graphicUpdateVisibleHandler(c,a);break;case "geometry":this.graphicUpdateGeometryHandler(c,a);break;case "symbol":this.graphicUpdateSymbolHandler(c,a);break;case "attributes":break;default:h.neverReached(a)}};d.prototype.graphicUpdateGeometryHandler=function(a,
b){var c=b.graphic.geometry;if(c)if(y.isNone(a)){if((a=b.graphic.symbol&&b.graphic.symbol.id)&&(a=this.symbols.get(a))&&!a.isFulfilled())return;this.recreateGraphic(b.graphic)}else a.graphics3DSymbol.updateGeometry(a,b.newValue)||this.recreateGraphic(a.graphic),this.expandComputedExtent(c);else this.recreateGraphic(b.graphic)};d.prototype.graphicUpdateSymbolHandler=function(a,b){var c=b.graphic,d=y.isSome(a)?a.graphics3DSymbol:b.oldValue&&this.symbols.get(b.oldValue.id);if(d){var e=d.symbol;b=this.getConvertedSymbol(b.newValue);
if(b.type!==e.type||"web-style"===b.type||"web-style"===e.type)this.recreateGraphic(c);else{var f=this.graphicsBySymbol.get(e.id);if(f&&1!==f.size)this.recreateGraphic(c);else if(f=K.diff(e,b),y.isNone(f))this.updateSymbolMapping(e.id,b);else if(f={diff:f,graphics3DGraphicPatches:[],symbolStatePatches:[]},d.prepareSymbolPatch(f),K.isEmpty(f.diff)){for(var g=0,h=f.symbolStatePatches;g<h.length;g++)d=h[g],d();c=this._getRenderingInfo(c);if(y.isSome(a))for(g=0,f=f.graphics3DGraphicPatches;g<f.length;g++)d=
f[g],d(a,c);this.updateSymbolMapping(e.id,b)}else this.recreateGraphic(c)}}else this.recreateGraphic(c)};d.prototype.graphicUpdateVisibleHandler=function(a,b){(a=this._updateUserVisibility(a))&&this.labeling&&(this.lastFastUpdate=w(),this.owner.view.labeler.setDirty());a&&this.owner.view.deconflictor.setDirty()};d.prototype.recreateGraphic=function(a){a=[a];this.remove(a);this.add(a)};d.prototype._beginGraphicUpdate=function(a){this.graphicsWaitingForSymbol.add(a.uid);1===this.graphicsWaitingForSymbol.size&&
this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)};d.prototype._endGraphicUpdate=function(a){a&&(this.graphicsWaitingForSymbol.delete(a.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))};d.prototype.expandComputedExtent=function(a){var b=a.spatialReference;F.computeAABB(a,da);a=this.viewSR;var c=m.tmpVec;
!b.equals(a)&&W.xyzToVector(da[0],da[1],0,b,c,a)&&(da[0]=c[0],da[1]=c[1],W.xyzToVector(da[3],da[4],0,b,c,a),da[3]=c[0],da[4]=c[1]);if(r.isFinite(da[0])&&r.isFinite(da[3])&&r.isFinite(da[1])&&r.isFinite(da[4])){var b=this.computedExtent,c=null,d=r.isFinite(da[2])&&r.isFinite(da[5]),e=d&&(!b||null==b.zmin||da[2]<b.zmin),d=d&&(!b||null==b.zmax||da[5]>b.zmax);if(b){if(da[0]<b.xmin||da[1]<b.ymin||da[3]>b.xmax||da[4]>b.ymax||e||d)c=this.propertiesPool.get("computedExtent"),c.xmin=Math.min(da[0],b.xmin),
c.ymin=Math.min(da[1],b.ymin),c.xmax=Math.max(da[3],b.xmax),c.ymax=Math.max(da[4],b.ymax),c.spatialReference=a}else c=this.propertiesPool.get("computedExtent"),c.xmin=da[0],c.ymin=da[1],c.xmax=da[3],c.ymax=da[4],c.spatialReference=a;c&&(e&&(c.zmin=da[2]),d&&(c.zmax=da[5]),this._set("computedExtent",c))}};d.prototype.updateHasDraped=function(){this._set("hasDraped",0<this.graphicsDrapedUids.size)};d.prototype.elevationInfoChange=function(){var a=this,b=U.extractExpressionInfo(this.layer.elevationInfo,
this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=U.createContext(b,this.viewSR,Y);this.labeling&&this.labeling.elevationInfoChange();this.forEachGraphics3DSymbol(function(b,c,d){b.globalPropertyChanged("elevationInfo",c)?c.forEach(function(a){var b=a.graphic;a=a._labelGraphics;for(var c=0;c<a.length;c++){var d=a[c];d.graphics3DSymbolLayer.updateGraphicElevationContext(b,d)}}):a._recreateSymbol(d)});this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()};
d.prototype.clearSymbolsAndGraphics=function(){this.clear();this.filterVisibility&&this.filterVisibility.clear();this.labeling&&this.labeling.reset();this.deconfliction&&this.deconfliction.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()};d.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};d.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),
this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};d.prototype._recreateSymbol=function(a){var b=this,c=[];this.graphicsBySymbol.get(a).forEach(function(a,
d){var e=a.usedMemory;b._conditionalRemove(a,d);b.spatialIndex&&b.spatialIndex.remove(a);c.push(a.graphic);a.destroy();b.removeGraphics3DGraphic(d,e);b.updateLayerVisibility()});this.graphicsBySymbol.set(a,new Map);var d=this.symbols.get(a);d&&d.destroy();this.symbols.delete(a);this.updateHasDraped();this.add(c)};d.prototype._conditionalRemove=function(a,b){a.isDraped()&&this.graphicsDrapedUids.delete(b);this.highlights&&this.highlights.removeGraphic(a);this.labeling&&this.labeling.removeGraphic(a);
this.deconfliction&&this.deconfliction.removeGraphic(a)};d.prototype.add=function(a){a&&0!==a.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this.asyncUpdates?this._addDelayed(a):this._addImmediate(a),this.notifyChange("updating")):Y.error("#add()","Cannot add graphics before terrain surface has been initialized"))};d.prototype._addImmediate=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;ha.clear();for(var c=0;c<a.length;c++)this._startAddGraphic(a[c],
ha);ha.forEach(function(a){return b._finishAddGraphics(a)});ha.clear();this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty();this._cleanupSymbols()};d.prototype._addDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?(e.add||this.pendingAdds++,e.add=c):(e=this.pendingUpdatesPool.pushNew(),e.add=c,this.pendingAdds++,this.pendingUpdates.set(d,e))}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);
this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};d.prototype.remove=function(a){this.asyncUpdates?this._removeDelayed(a):this._removeImmediate(a);this.notifyChange("updating")};d.prototype._removeImmediate=function(a){for(var b=0;b<a.length;b++)this._removeGraphic(a[b]);this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty()};d.prototype._removeDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add&&
(e.remove?e.add=null:this.pendingUpdates.delete(d),this.pendingAdds--):(e=this.pendingUpdatesPool.pushNew(),e.remove=c,this.pendingUpdates.set(d,e),this.pendingRemoves++)}0===this.pendingUpdates.size&&this._finishPendingUpdates();this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};d.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();this.maxPendingUpdates=0;this._cleanupSymbols();
(this.pendingAdds||this.pendingRemoves)&&Y.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};d.prototype._applyPendingUpdates=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;var c=a.idleFrame?1E3:100,d=0;ha.clear();u.everyMap(this.pendingUpdates,function(e,f){e.remove&&(b.pendingRemoves--,b._removeGraphic(e.remove));e.add&&(b.pendingAdds--,b._startAddGraphic(e.add,ha)&&d++);b.pendingUpdates.delete(f);d>c&&(ha.forEach(function(a){return b._finishAddGraphics(a)}),
ha.clear(),d=0);a.madeProgress();if(a.done)return!1});ha.forEach(function(a){return b._finishAddGraphics(a)});ha.clear();0===this.pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.updateHasDraped()};d.prototype._startAddGraphic=function(a,b){this.graphicsWithoutSymbol[a.uid]=a;var c=this._getRenderingInfo(a,Y);if(!c)return!1;var d=this.getOrCreateGraphics3DSymbol(c.symbol,c.renderer);if(!d)return!1;this.expandComputedExtent(a.geometry);
this._beginGraphicUpdate(a);a={graphic:a,renderingInfo:c,layer:this.layer};var c=d.symbol.id,e=b.get(c);e?e.graphics.push(a):(e=ma.acquire(),e.clear(),e.push(a),b.set(c,{asyncSymbol:d,graphics:e}));return!0};d.prototype._finishAddGraphics=function(a){var b=this,c=!1,d=function(b){b===a.asyncSymbol.symbol.id&&(c=!0)};this._whenSymbolRemoved.push(d);a.asyncSymbol.then(function(){b._whenSymbolRemoved.removeUnordered(d);ea.clear();for(var e=0;e<a.graphics.length;e++){var f=a.graphics.data[e],g=f.graphic;
c||a.asyncSymbol.destroyed||b.graphicSymbolSupported&&g.symbol&&g.symbol.id!==a.asyncSymbol.symbol.id||(b.graphicsWaitingForSymbol.has(g.uid)&&(f=b.createGraphics3DGraphic(a.asyncSymbol,f),b.spatialIndex&&f&&ea.push(f)),b._endGraphicUpdate(g));--a.asyncSymbol.referenced}0<ea.length&&(b.spatialIndex.addMany(ea.data,ea.length),ea.clear());a.graphics.clear();ma.release(a.graphics);b.labeling&&(b.lastFastUpdate=w(),b.owner.view.labeler.setDirty())},function(){b._whenSymbolRemoved.removeUnordered(d);if(!c&&
!a.asyncSymbol.destroyed)for(var e=0;e<a.graphics.length;e++)b._endGraphicUpdate(a.graphics.data[e].graphic);a.graphics.clear();ma.release(a.graphics)})};d.prototype._removeGraphic=function(a){a=a.uid;var b=this.graphics.get(a);if(b){var c=b.usedMemory;this._conditionalRemove(b,a);this.spatialIndex&&this.spatialIndex.remove(b);this.graphicsBySymbol.get(b.graphics3DSymbol.symbol.id).delete(a);delete this.graphicsWithoutSymbol[a];this.removeGraphics3DGraphic(a,c);b.destroy()}else delete this.graphicsWithoutSymbol[a],
this.graphicsWaitingForSymbol.delete(a)};d.prototype.hasLabelingContext=function(a){if(a instanceof k.LabelSymbol3D||a instanceof k.TextSymbol){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};d.prototype.hasValidSymbolCreationContext=function(a){return a instanceof k.LabelSymbol3D&&!this.hasLabelingContext(a)?(Y.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),
!1):!0};d.prototype._getRenderingInfo=function(a,b){if(!a.geometry)return b&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&a.symbol)return b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;a=this.rendererHasGeometryOperations?F.hydrateGraphic(a,this.layer):
a;a=this.owner.getRenderingInfo(a,this.currentRenderer);return a&&a.symbol?a:(b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null)};d.prototype.createGraphics3DSymbol=function(a,b){var c=this;if(!this.hasValidSymbolCreationContext(a))return null;a=this.getConvertedSymbol(a);if(!a)return null;var d;b&&"backgroundFillSymbol"in b&&b.backgroundFillSymbol&&(b=P.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&"web-style"!==
b.symbol.type&&(d=b.symbol.symbolLayers));d=X.make(a,this.symbolCreationContext,d);d.then(function(){return c.notifyChange("maxSymbolComplexity")});return d};d.prototype.getOrCreateGraphics3DSymbol=function(a,b){var c=this,d=this.symbols.get(a.id);void 0===d&&(d=a instanceof k.WebStyleSymbol?new J(a,function(a){return c.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols.set(a.id,d));d&&++d.referenced;return d};d.prototype.addGraphics3DGraphic=function(a){this._usedMemory+=
a.usedMemory;this.graphics.set(a.graphic.uid,a);this.numberOfGraphics++;this.updateLayerVisibility()};d.prototype.removeGraphics3DGraphic=function(a,b){this._usedMemory-=b;this.graphics.delete(a);this.numberOfGraphics--;this.updateLayerVisibility()};d.prototype.createGraphics3DGraphic=function(a,b){var c=b.graphic;delete this.graphicsWithoutSymbol[c.uid];if(!this.symbols.has(a.symbol.id))this.add([c]);else if(!this.graphics.has(c.uid)){b=a.createGraphics3DGraphic(b);a=a.symbol.id;this.addGraphics3DGraphic(b);
this.graphicsBySymbol.has(a)||this.graphicsBySymbol.set(a,new Map);this.graphicsBySymbol.get(a).set(c.uid,b);b.initialize(this.stageLayer,this.stage);b.isDraped()&&(this.graphicsDrapedUids.add(c.uid),this._set("hasDraped",!0));b.centroid=null;"point"!==c.geometry.type&&b instanceof N&&(b.centroid=R.computeCentroid(c.geometry,this.viewSR));this._updateUserVisibility(b);this.deconfliction&&this.deconfliction.addGraphic(b);this.labeling&&this.labeling.addGraphic(b);this.scaleVisibility&&this.scaleVisibility.updateVisibility(b);
this.filterVisibility&&this.filterVisibility.updateVisibility(b);this.highlights&&this.highlights.addGraphic(b);this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,b);if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],a.resolve(b);return b}};d.prototype.rendererChange=function(a){var b=this;a!==this.currentRenderer&&(this.validateRenderer(a),Q.hasGeometryOperations(a)?Q.enableGeometryOperations().then(function(){b.layer.renderer===a&&b.currentRendererChange(a,
!0)}):this.currentRendererChange(a,!1))};d.prototype.currentRendererChange=function(a,b){this.currentRenderer=a;this.rendererHasGeometryOperations=b;b=this.symbolCreationContext.renderer;if(a!==b){this.symbolConversionCache.clear();var c=K.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;y.isNone(c)||("complete"===c.type?this.recreateAllGraphics():"partial"===c.type&&(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),
this.notifyChange("maxSymbolComplexity"))}};d.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};d.prototype.applySymbolSetDiff=function(a,b,c,d){var e=this;a=a||[];b=b||[];var f=[];d=function(b){var d=g.graphicsBySymbol.get(b.id);d&&d.forEach(function(g,h){var k=g.graphic,l=e.layer instanceof L?e.layer:null;if(b!==
c.defaultSymbol||c.getSymbol(F.hydrateGraphic(k,l))!==c.defaultSymbol)l=g.usedMemory,a.length||c.defaultSymbol?f.push(k):e.graphicsWithoutSymbol[h]=k,k=e.graphics.get(h),e._conditionalRemove(k,h),g.destroy(),d.delete(h),e.removeGraphics3DGraphic(h,l),e.updateLayerVisibility()});g._whenSymbolRemoved.forEach(function(a){return a(b.id)})};for(var g=this,h=0;h<b.length;h++)d(b[h]);if(a.length||f.length){for(var k in this.graphicsWithoutSymbol)f.push(this.graphicsWithoutSymbol[k]);this.graphicsWithoutSymbol=
{};this.add(f)}this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty()};d.prototype.applyUniqueValueRendererDiff=function(a,b,c){var d=a.diff.defaultSymbol,e=a.diff.uniqueValueInfos;if(d||e){var f=e?e.added.map(function(a){return a.symbol}):[],g=e?e.removed.map(function(a){return a.symbol}):[];if(e)for(var h=0;h<e.changed.length;h++)f.push(e.changed[h].newValue.symbol),g.push(e.changed[h].oldValue.symbol);d?(c.defaultSymbol&&g.push(c.defaultSymbol),b.defaultSymbol&&f.push(b.defaultSymbol)):
c.defaultSymbol&&f.length&&g.push(b.defaultSymbol);this.applySymbolSetDiff(f,g,b,c);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};d.prototype.calculateUnchangedSymbolMapping=function(a,b,c){if(b instanceof e.UniqueValueRenderer&&c instanceof e.UniqueValueRenderer&&(y.isNone(a)||"partial"===a.type)){var d=a&&a.diff;a=d&&d.defaultSymbol;var d=d&&d.uniqueValueInfos,f=void 0,f=d?d.unchanged.map(function(a){return{oldId:a.oldValue.symbol.id,newId:a.newValue.symbol.id}}):
c.uniqueValueInfos.map(function(a,c){return{oldId:a.symbol.id,newId:b.uniqueValueInfos[c].symbol.id}});!a&&c.defaultSymbol&&f.push({oldId:c.defaultSymbol.id,newId:b.defaultSymbol.id});return f}return[]};d.prototype.updateSymbolMapping=function(a,b){var c="string"===typeof b?b:b.id;b="string"===typeof b?null:b;if(a&&a!==c){var d=this.graphicsBySymbol.get(a);this.graphicsBySymbol.delete(a);void 0!==d&&this.graphicsBySymbol.set(c,d);d=this.symbols.get(a);this.symbols.delete(a);void 0!==d&&(this.symbols.set(c,
d),b?d.symbol=b:d.symbol.id=c)}};d.prototype.updateUnchangedSymbolMappings=function(a,b,c){var d=0;for(a=this.calculateUnchangedSymbolMapping(a,b,c);d<a.length;d++)b=a[d],this.updateSymbolMapping(b.oldId,b.newId)};d.prototype.applyRendererDiff=function(a,b,c){var d=this;return this.diffHasSymbolChange(a)?!1:b instanceof e.UniqueValueRenderer&&c instanceof e.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(a,b,c)&&0===Object.keys(a.diff).length?!0:u.everyMap(this.graphicsBySymbol,function(c,
e){if((c=d.symbols.get(e))&&!c.applyRendererDiff(a,b))return!1})};d.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(a){return a.globalPropertyChanged("opacity")});this.updateStageLayerVisibility()};d.prototype.slicePlaneEnabledChange=function(a){a!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=a,this.stageLayer.isSliceable=a,this.forEachGraphics3DSymbol(function(a,b){return a.globalPropertyChanged("slicePlaneEnabled",b)}),this.deconfliction&&
this.deconfliction.slicePlaneEnabledChange(),this.labeling&&this.labeling.slicePlaneEnabledChange())};d.prototype.pixelRatioChange=function(a){var b=this;this.forEachGraphics3DSymbol(function(a,c,d){a.globalPropertyChanged("pixelRatio",c)||b._recreateSymbol(d)})};d.prototype.setClippingExtent=function(b,c){var d=this.symbolCreationContext.clippingExtent,e=G.create();W.extentToBoundingRect(b,e,c)?this.symbolCreationContext.clippingExtent=[e[0],e[1],-Infinity,e[2],e[3],Infinity]:this.symbolCreationContext.clippingExtent=
null;return!a.equals(this.symbolCreationContext.clippingExtent,d)};d.prototype.notifyVisibilityChanged=function(){this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};d.prototype.forEachGraphics3DGraphic=function(a){var b=this;if(this.owner.loadedGraphics){var c=!1;this.owner.loadedGraphics.forEach(function(d){var e=b.getGraphics3DGraphicById(d.uid);e&&a(e,d)&&(c=!0)});c&&this.notifyVisibilityChanged()}};d.prototype.forEachGraphics3DSymbol=function(a){var b=this;this.graphicsBySymbol.forEach(function(c,
d){var e=b.symbols.get(d);e&&a(e,c,d)})};d.prototype.updateAllGraphicsVisibility=function(){var a=this;this.filterVisibility&&(this.filterVisibility.dirty=!0);this.forEachGraphics3DGraphic(function(b){var c=a._updateUserVisibility(b);b=a.scaleVisibility&&a.scaleVisibility.updateVisibility(b);return c||b})};d.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(0,!1,0)})};d.prototype.validateRenderer=function(a){(a=M.validateTo3D(a))&&Y.warn("Renderer for layer '"+
(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};d.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=w(),this.labeling.reset());this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};d.prototype._cleanupSymbols=function(){var a=this;if(!(0<this.graphicsWaitingForSymbol.size)){var b=!1;this.symbols.forEach(function(c,d){if(c&&!(0<
c.referenced)){var e=a.graphicsBySymbol.get(d);e&&0!==e.size||(a.graphicsBySymbol.delete(d),a.symbols.delete(d),c&&c.destroy(),b=!0)}});b&&this.notifyChange("maxSymbolComplexity")}};d.prototype.snapshotInternals=function(){var b=this;return{graphics:a.keysOfMap(this.graphics).sort(),symbols:a.keysOfMap(this.symbols).sort(),graphicsBySymbol:a.keysOfMap(this.graphicsBySymbol).sort().map(function(c){return{symbolId:c,graphics:a.keysOfMap(b.graphicsBySymbol.get(c)).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),
graphicsDrapedUids:a.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}};Object.defineProperty(d.prototype,"test",{get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility}},enumerable:!0,configurable:!0});d.prototype.getStats=function(){return{coreVisible:this.graphics.size,coreMissing:Object.keys(this.graphicsWithoutSymbol).length,corePending:this.pendingUpdates.size}};var m;d.tmpVec=E.vec3f64.create();g([B.property({readOnly:!0})],d.prototype,
"computedExtent",void 0);g([B.property()],d.prototype,"currentRenderer",void 0);g([B.property()],d.prototype,"rendererHasGeometryOperations",void 0);g([B.property({readOnly:!0})],d.prototype,"elevationAlignment",void 0);g([B.property({readOnly:!0})],d.prototype,"scaleVisibility",void 0);g([B.property({readOnly:!0})],d.prototype,"filterVisibility",void 0);g([B.property({readOnly:!0})],d.prototype,"spatialIndex",void 0);g([B.property({readOnly:!0})],d.prototype,"deconfliction",void 0);g([B.property({readOnly:!0})],
d.prototype,"labeling",void 0);g([B.property({readOnly:!0})],d.prototype,"highlights",void 0);g([B.property()],d.prototype,"asyncUpdates",void 0);g([B.property({constructOnly:!0})],d.prototype,"elevationFeatureExpressionEnabled",void 0);g([B.property({constructOnly:!0})],d.prototype,"owner",void 0);g([B.property({constructOnly:!0})],d.prototype,"layer",void 0);g([B.property({readOnly:!0})],d.prototype,"hasDraped",void 0);g([B.property({readOnly:!0})],d.prototype,"symbolsUpdating",void 0);g([B.property({constructOnly:!0})],
d.prototype,"graphicSymbolSupported",void 0);g([B.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating","filterVisibility.updating"]})],d.prototype,"updating",null);g([B.property({readOnly:!0})],d.prototype,"updatingRemaining",null);g([B.property({readOnly:!0})],d.prototype,"updatingTotal",null);g([B.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures",
"maxSymbolComplexity"]})],d.prototype,"displayFeatureLimit",null);g([B.property({readOnly:!0})],d.prototype,"maxSymbolComplexity",null);return d=m=g([B.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],d)}(B.declared(c));var ha=new Map,ea=new x,ma=new m(x);(function(){return function(){this.remove=this.add=null}})();var aa=10;return t})},"esri/renderers/support/rendererConversion":function(){define(["require","exports","../../core/Error","../../symbols/support/symbolConversion"],function(t,
d,q,g){function l(b,d){if(!d)return null;d=Array.isArray(d)?d:[d];if(0<d.length){var c=d.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});c.sort();var a=[];c.forEach(function(b,d){0!==d&&b===c[d-1]||a.push(b)});return new q("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+a.join(", ")+") which are not supported in 3D",{renderer:b,symbolErrors:d})}return null}function b(b){var d=b.uniqueValueInfos.map(function(a){return g.to3D(a.symbol).error}).filter(function(a){return!!a}),
c=g.to3D(b.defaultSymbol);c.error&&d.unshift(c.error);return l(b,d)}function f(b){var d=b.classBreakInfos.map(function(a){return g.to3D(a.symbol).error}).filter(function(a){return!!a}),c=g.to3D(b.defaultSymbol);c.error&&d.unshift(c.error);return l(b,d)}Object.defineProperty(d,"__esModule",{value:!0});d.validateTo3D=function(d){return d?"simple"===d.type?l(d,g.to3D(d.symbol).error):"unique-value"===d.type?b(d):"class-breaks"===d.type?f(d):new q("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+
(d.type||d.declaredClass)+"'",{renderer:d}):null}})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});t=function(){return function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.renderSpatialReference=this.clippingExtent=this.layerOrderDelta=this.layerOrder=this.stage=this.renderer=this.elevationProvider=
this.streamDataSupplier=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.slicePlaneEnabled=!1}}();d.Graphics3DSymbolCreationContext=t})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require","exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.make=function(d,b,f){var e;switch(d.type){case "point-3d":e=q;break;default:e=g}return new e(d,b,f)}})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","./Graphics3DCalloutSymbolLayerFactory","./Graphics3DSymbol"],function(t,d,q,g,l){return function(b){function d(d,f,c){d=b.call(this,d,f,c)||this;d.calloutSymbolLayer=null;d.symbol.hasVisibleCallout()&&(d.calloutSymbolLayer=g.make(d.symbol,f));return d}q(d,b);d.prototype.destroy=function(){b.prototype.destroy.call(this)};d.prototype.createGraphics3DGraphic=function(d,f,c){f=b.prototype.createGraphics3DGraphic.call(this,d,c);this.calloutSymbolLayer&&
(d=this.createCalloutGraphic(d))&&f.addAuxiliaryGraphic(d);return f};d.prototype.globalPropertyChanged=function(d,f){var c=this;return b.prototype.globalPropertyChanged.call(this,d,f)?this.calloutSymbolLayer?this.calloutSymbolLayer.globalPropertyChanged(d,f,function(a){var b=0;for(a=a._auxiliaryGraphics;b<a.length;b++){var d=a[b];if(d.graphics3DSymbolLayer===c.calloutSymbolLayer)return d}}):!0:!1};d.prototype.createCalloutGraphic=function(b){var d=b.renderingInfo;b.renderingInfo={renderer:d.renderer,
symbol:d.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(b)};return d}(l)})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect".split(" "),
function(t,d,q,g,l,b,f,e,k){var c=function(){function a(){this.extents=new f({allocator:function(a){return a||k.create()}});this.tempExtent=k.create();this.dirty=!1}Object.defineProperty(a.prototype,"length",{get:function(){return this.extents.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.extents.clear()};a.prototype.add=function(a){this.contains(a)||(this.removeContained(a),k.set(this.extents.pushNew(),a),this.dirty=!0)};a.prototype.pop=function(){this.dirty&&(this.mergeTight(),
this.dirty=!1);return this.extents.pop()};a.prototype.mergeTight=function(){for(var a=this.extents,b=this.tempExtent,c=!1;!c;)for(var c=!0,d=0;d<a.length;++d){for(var e=d,f=a.data[e],g=k.area(f),l=!1,m=a.length-1;m>e;--m){var q=a.data[m],t=k.area(q);k.expand(f,q,b);q=g+t;.05>(k.area(b)-q)/q&&(k.set(f,b),g=k.area(f),a.swapElements(m,a.length-1),a.pop(),l=!0)}if(l){c=!1;break}}};a.prototype.contains=function(a){return this.extents.some(function(b){return k.contains(b,a)})};a.prototype.removeContained=
function(a){for(var b=this.extents.length-1;0<=b;--b)k.contains(a,this.extents.data[b])&&this.extents.removeUnorderedIndex(b)};return a}();return function(a){function d(){var d=a.call(this)||this;d.dirtyExtents=new c;d.globalDirty=!1;d.dirtyGraphicsQueue=new f({deallocator:null});d.handles=new b;d.updateElevation=!1;d.layerView=null;d.graphicsCore=null;return d}q(d,a);Object.defineProperty(d.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0});d.prototype.setup=
function(a,b,c,d){var e=this;this.layerView=a;this.queryGraphicUIDsInExtent=b;this.graphicsCore=c;this.elevationProvider=d;a=this.layerView.view.resourceController.scheduler;this.handles.add([d.on("elevation-change",function(a){return e.elevationUpdateHandler(a)}),this.layerView.watch("suspended",function(){return e.suspendedChange()}),a.registerTask(12,function(a){return e.update(a)},function(){return e.needsUpdate()})])};d.prototype.destroy=function(){this.dirtyGraphicsQueue=null;this.handles.destroy();
this.queryGraphicUIDsInExtent=this.graphicsCore=this.layerView=this.handles=null};d.prototype.clear=function(){this.dirtyGraphicsQueue.clear();this.notifyChange("updating")};d.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))};d.prototype.elevationInfoChange=function(){this.globalDirty=!0;this.notifyChange("updating")};d.prototype.needsUpdate=function(){return 0<
this.dirtyGraphicsQueue.length||0<this.dirtyExtents.length||this.globalDirty};d.prototype.update=function(a){this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,a.madeProgress());for(;this.needsUpdate()&&!a.done;)this._updateDirtyGraphics(a),this._updateDirtyExtents(a);this.layerView.view.deconflictor.setDirty();this.notifyChange("updating")};d.prototype._updateDirtyGraphics=function(a){for(var b=this.layerView.view,c=this.graphicsCore.stageLayer.id,d=this.layerView.labeling;0<
this.dirtyGraphicsQueue.length&&!a.done;){for(var e=Math.min(this.dirtyGraphicsQueue.length,100);e--&&!a.done;){var f=this.dirtyGraphicsQueue.pop();(f=this.graphicsCore.getGraphics3DGraphicById(f))&&f.alignWithElevation(this.elevationProvider,b.renderCoordsHelper);a.madeProgress()}b._stage.processDirtyLayer(c);d&&d.processStageDirty()}};d.prototype._updateDirtyExtents=function(a){for(var b=this;0<this.dirtyExtents.length&&100>this.dirtyGraphicsQueue.length&&!a.done;){var c=this.dirtyExtents.pop();
this.queryGraphicUIDsInExtent(c,this.spatialReference,function(a){var c=b.graphicsCore.getGraphics3DGraphicById(a);c&&c.needsElevationUpdates()&&b.dirtyGraphicsQueue.push(a)});a.madeProgress()}};d.prototype.markAllGraphicsElevationDirty=function(){var a=this;this.dirtyExtents.clear();this.dirtyGraphicsQueue.clear();this.graphicsCore.graphics3DGraphics.forEach(function(b,c){return a.dirtyGraphicsQueue.push(c)})};d.prototype.elevationUpdateHandler=function(a){var b=a.extent;this.layerView.suspended?
this.updateElevation||(a=this.graphicsCore.computedExtent)&&b[2]>a.xmin&&b[0]<a.xmax&&b[3]>a.ymin&&b[1]<a.ymax&&(this.updateElevation=!0):(-Infinity===b[0]?this.globalDirty=!0:this.dirtyExtents.add(b),this.spatialReference=a.spatialReference,this.notifyChange("updating"))};g([e.property({readOnly:!0})],d.prototype,"updating",null);return d=g([e.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],d)}(e.declared(l))})},"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Polygon ../../../../geometry/support/jsonUtils ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/data/FeatureStore ../../../../layers/graphics/data/QueryEngine".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v){Object.defineProperty(d,"__esModule",{value:!0});var r=e.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");t=function(b){function d(a){a=b.call(this)||this;a._dirty=!1;a._querying=!1;a._handles=new f;return a}q(d,b);Object.defineProperty(d.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"featureGeometryType",{get:function(){switch(this.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.geometryType;
case "mesh":case "extent":return"polygon"}},enumerable:!0,configurable:!0});d.prototype.setup=function(a,b){var c=this;this._layerView=a;this._core=b;this._objectIdField=a.layer.objectIdField;a.layer.timeInfo&&(this._timeInfo=a.layer.timeInfo.toJSON());this._scheduler=this._layerView.view.resourceController.scheduler;this._handles.add(this._scheduler.registerTask(4,function(a){return c._update(a)},function(){return c._needsUpdate()}));this._handles.add(k.on(b.owner,"loadedGraphics","change",function(a){return c._graphicsChanged(a)},
function(){return c.dirty=!0}))};d.prototype.destroy=function(){this._handles.destroy();this._handles=null;this.clear();this._core=this._layerView=null};d.prototype.clear=function(){this._queryEngine&&(this._queryEngine.destroy(),this._store=this._queryResult=this._queryEngine=null,this._querying=!1,this._core.forEachGraphics3DGraphic(function(a){return a.clearVisibilityFlag(2)}));this.dirty=!1;this.notifyChange("updating")};d.prototype._graphicsChanged=function(a){if(this._queryEngine){if(a.removed&&
0<a.removed.length){for(var b=Array(a.removed.length),c=0;c<a.removed.length;++c)b[c]=a.removed[c].uid;this._store.removeManyById(b)}if(a.added&&0<a.added.length){b=Array(a.added.length);for(c=0;c<a.added.length;++c)b[c]=this._convertToOptimizedFeature(a.added[c]);this._store.addMany(b);this.dirty=!0}}else this.dirty=!0};d.prototype.updateVisibility=function(a){this._queryEngine&&(a.hasVisibilityFlag(2,0)||a.setVisibilityFlag(2,!1,0),this.dirty=!0)};d.prototype.filterChanged=function(){this.dirty=
!0};Object.defineProperty(d.prototype,"active",{get:function(){return this._layerView.filter&&0<this._core.owner.loadedGraphics.length},enumerable:!0,configurable:!0});d.prototype._ensureQueryEngine=function(a){var b=this;if(!this.active)return this.clear(),!1;if(this._queryEngine)return!0;var c=this._core.owner.loadedGraphics,d=l.featureGeometryTypeKebabDictionary.toJSON(this.featureGeometryType),e,f=Array(c.length),g=0;c.forEach(function(a){f[++g]=b._convertToOptimizedFeature(a);e=e||a.geometry.spatialReference});
this._store=new u.default({geometryType:d,hasM:!1,hasZ:!1});this._store.addMany(f);this._queryEngine=new v.default({hasZ:!1,hasM:!1,geometryType:d,fields:[],timeInfo:this._timeInfo,spatialReference:e,objectIdField:this._objectIdField,featureStore:this._store,scheduler:this._scheduler,priority:4});a.madeProgress();return!0};d.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult};d.prototype._update=function(a){var b=this;if(this._ensureQueryEngine(a)){if(this._dirty&&
!this._querying&&!a.done){this._querying=!0;this.dirty=!1;var c=this._layerView.filter?this._layerView.filter.toJSON():{};this._queryEngine.executeQueryForIdSet(c).then(function(a){b._queryResult=a;b._querying=!1}).catch(function(a){r.warn("FeatureFilter query failed: "+a);b._queryResult=new Set;b._core.forEachGraphics3DGraphic(function(a){b._queryResult.add(b._getFeatureId(a.graphic));return!1});b._querying=!1});a.madeProgress()}this._queryResult&&!a.done&&(this._core.forEachGraphics3DGraphic(function(c){if(a.done)return!1;
var d=b._queryResult.has(b._getFeatureId(c.graphic));return c.setVisibilityFlag(2,d,0)?(a.madeProgress(),!0):!1}),a.done||(this._queryResult=null));this.notifyChange("updating")}else this.dirty=!1};d.prototype._convertToOptimizedFeature=function(b){var c=b.geometry;return"mesh"===c.type||"extent"===c.type?(c=a.fromExtent("mesh"===c.type?c.extent:c),c.hasZ=!1,c.hasM=!1,new n.default(p.convertFromGeometry(c),b.attributes,null,this._getFeatureId(b))):p.convertFromFeature(b,h.getJsonType(b.geometry),
!1,!1,this._objectIdField)};d.prototype._getFeatureId=function(a){return null==a.objectId?a.attributes[this._objectIdField]:a.objectId};Object.defineProperty(d.prototype,"dirty",{set:function(a){this._dirty!==a&&(this._dirty=a,this.notifyChange("updating"))},enumerable:!0,configurable:!0});g([c.property({readOnly:!0})],d.prototype,"updating",null);g([c.property({constructOnly:!0})],d.prototype,"geometryType",void 0);g([c.property({readOnly:!0,dependsOn:["geometryType"]})],d.prototype,"featureGeometryType",
null);return d=g([c.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],d)}(c.declared(b));d.Graphics3DFilterVisibility=t})},"esri/layers/graphics/data/FeatureStore":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/Map ../../../core/Error ../../../core/has ../../../core/Logger ../../../core/libs/rbush/rbush ../../../geometry/support/aaBoundingRect ../featureConversionUtils".split(" "),function(t,
d,q,g,l,b,f,e,k,c,a){Object.defineProperty(d,"__esModule",{value:!0});var h=[],p=e.getLogger("esri.layers.graphics.data.FeatureStore"),n={minX:0,minY:0,maxX:0,maxY:0};t=function(){function d(a){this._featuresById=new l.default;this._boundsByFeature=new l.default;this._featuresByBounds=new l.default;this._index=k(9,f("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:["[0]","[1]","[2]","[3]"]);this._geometryInfo=a}Object.defineProperty(d.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var a=
c.create(c.NEGATIVE_INFINITY);this._boundsByFeature.forEach(function(b){b&&(a[0]=Math.min(b[0],a[0]),a[1]=Math.min(b[1],a[1]),a[2]=Math.max(b[2],a[2]),a[3]=Math.max(b[3],a[3]))});return a},enumerable:!0,configurable:!0});d.prototype.setEngine=function(a){this._engine=a};d.prototype.add=function(a){this._add(a,h);this._index.load(h);this._clearCache();h.length=0};d.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this._add(a[b],h);this._index.load(h);this._clearCache();h.length=0};d.prototype.clear=
function(){this._featuresById.clear();this._boundsByFeature.clear();this._featuresByBounds.clear();this._index.clear();this._clearCache()};d.prototype.removeManyById=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=this._featuresById.get(c);if(d){var e=this._boundsByFeature.get(d);e&&(this._index.remove(e),this._featuresByBounds.delete(e));this._boundsByFeature.delete(d)}this._featuresById.delete(c)}this._clearCache()};d.prototype.forEachBounds=function(a,b){for(var c=0;c<a.length;c++){var d=
a[c],e=this._boundsByFeature.get(d);e&&b(e,d)}};d.prototype.getFeature=function(a){return this._featuresById.get(a)};d.prototype.has=function(a){return this._featuresById.has(a)};d.prototype.forEach=function(a){this._featuresById.forEach(function(b){return a(b)})};d.prototype.forEachInBounds=function(a,b){var c=0,d=this._index;n.minX=a[0];n.minY=a[1];n.maxX=a[2];n.maxY=a[3];for(a=d.search(n);c<a.length;c++)b(this._featuresByBounds.get(a[c]))};d.prototype.transferIds=function(a,b){for(var c=[],d=0;d<
b.length;d++){var e=this._featuresById.get(b[d]);e&&(this._remove(e),c.push(e))}a.addMany(c);this._clearCache()};d.prototype.transferIdRange=function(a,b,c){for(var d=[];b<c;b++){var e=this._featuresById.get(b);e&&(this._remove(e),d.push(e))}a.addMany(d);this._clearCache()};d.prototype.transferIf=function(a,b){var c=this,d=[];this._featuresById.forEach(function(a,e){b(a)&&(c._remove(a),d.push(a))});a.addMany(d);this._clearCache()};d.prototype.transferAll=function(a){var b=this,c=[];this._featuresById.forEach(function(a,
d){b._remove(a);c.push(a)});a.addMany(c);this._clearCache()};d.prototype._clearCache=function(){this._engine&&this._engine.clearCache()};d.prototype._add=function(d,e){if(d){var f=d.objectId;if(null==f)p.error(new b("featurestore:invalid-feature","feature id is missing",{feature:d}));else{var g=this._featuresById.get(f),h;g&&(h=this._boundsByFeature.get(g))&&(this._index.remove(h),this._boundsByFeature.delete(g),this._featuresByBounds.delete(h));d.geometry?(h=a.getBoundsOptimizedGeometry(h||c.create(),
d.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(d,h),this._featuresByBounds.set(h,d),this._featuresById.set(f,d),e.push(h)):(this._boundsByFeature.set(d,null),this._featuresById.set(f,d))}}};d.prototype._remove=function(a){var b;if(a){if(b=this._boundsByFeature.get(a))this._index.remove(b),this._boundsByFeature.delete(a),this._featuresByBounds.delete(b);this._featuresById.delete(a.objectId)}};return d}();d.default=t})},"esri/core/libs/rbush/rbush":function(){define(["../quickselect/quickselect"],
function(t){function d(a,b){if(!(this instanceof d))return new d(a,b);this._maxEntries=Math.max(4,a||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));b&&("function"===typeof b?this.toBBox=b:this._initFormat(b));this.clear()}function q(a,b){g(a,0,a.children.length,b,a)}function g(a,b,c,d,e){e||(e=h(null));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;e.maxY=-Infinity;for(var f;b<c;b++)f=a.children[b],l(e,a.leaf?d(f):f);return e}function l(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=
Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function b(a,b){return a.minX-b.minX}function f(a,b){return a.minY-b.minY}function e(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function k(a){return a.maxX-a.minX+(a.maxY-a.minY)}function c(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function a(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function h(a){return{children:a,height:1,leaf:!0,minX:Infinity,
minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function p(a,b,c,d,e){for(var f=[b,c],g;f.length;)c=f.pop(),b=f.pop(),c-b<=d||(g=b+Math.ceil((c-b)/d/2)*d,t(a,g,b,c,e),f.push(b,g,g,c))}d.prototype={all:function(){return this._all(this.data,[])},search:function(b){var d=this.data,e=[],f=this.toBBox;if(!a(b,d))return e;for(var g=[],h,k,l,n;d;){h=0;for(k=d.children.length;h<k;h++)l=d.children[h],n=d.leaf?f(l):l,a(b,n)&&(d.leaf?e.push(l):c(b,n)?this._all(l,e):g.push(l));d=g.pop()}return e},collides:function(b){var d=
this.data,e=this.toBBox;if(!a(b,d))return!1;for(var f=[],g,h,k,l;d;){g=0;for(h=d.children.length;g<h;g++)if(k=d.children[g],l=d.leaf?e(k):k,a(b,l)){if(d.leaf||c(b,l))return!0;f.push(k)}d=f.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,c=a.length;b<c;b++)this.insert(a[b]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(b=this.data,
this.data=a,a=b),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this},insert:function(a){a&&this._insert(a,this.data.height-1);return this},clear:function(){this.data=h([]);return this},remove:function(a,b){if(!a)return this;for(var d=this.data,e=this.toBBox(a),f=[],g=[],h,k,l,n;d||f.length;){d||(d=f.pop(),k=f[f.length-1],h=g.pop(),n=!0);if(d.leaf){a:{l=a;var p=d.children,q=b;if(q){for(var u=0;u<p.length;u++)if(q(l,p[u])){l=u;break a}l=-1}else l=p.indexOf(l)}if(-1!==l){d.children.splice(l,
1);f.push(d);this._condense(f);break}}n||d.leaf||!c(d,e)?k?(h++,d=k.children[h],n=!1):d=null:(f.push(d),g.push(h),h=0,k=d,d=d.children[0])}return this},toBBox:function(a){return a},compareMinX:b,compareMinY:f,toJSON:function(){return this.data},fromJSON:function(a){this.data=a;return this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,d){var e=c-b+1,f=this._maxEntries,g;if(e<=f)return g=h(a.slice(b,c+1)),q(g,
this.toBBox),g;d||(d=Math.ceil(Math.log(e)/Math.log(f)),f=Math.ceil(e/Math.pow(f,d-1)));g=h([]);g.leaf=!1;g.height=d;var e=Math.ceil(e/f),f=e*Math.ceil(Math.sqrt(f)),k,l,n;for(p(a,b,c,f,this.compareMinX);b<=c;b+=f)for(l=Math.min(b+f-1,c),p(a,b,l,e,this.compareMinY),k=b;k<=l;k+=e)n=Math.min(k+e-1,l),g.children.push(this._build(a,k,n,d-1));q(g,this.toBBox);return g},_chooseSubtree:function(a,b,c,d){for(var f,g,h,k,l,n,p,r;;){d.push(b);if(b.leaf||d.length-1===c)break;p=r=Infinity;f=0;for(g=b.children.length;f<
g;f++)h=b.children[f],l=e(h),n=(Math.max(h.maxX,a.maxX)-Math.min(h.minX,a.minX))*(Math.max(h.maxY,a.maxY)-Math.min(h.minY,a.minY))-l,n<r?(r=n,p=l<p?l:p,k=h):n===r&&l<p&&(p=l,k=h);b=k||b.children[0]}return b},_insert:function(a,b,c){var d=this.toBBox;c=c?a:d(a);var d=[],e=this._chooseSubtree(c,this.data,b,d);e.children.push(a);for(l(e,c);0<=b;)if(d[b].children.length>this._maxEntries)this._split(d,b),b--;else break;this._adjustParentBBoxes(c,d,b)},_split:function(a,b){var c=a[b],d=c.children.length,
e=this._minEntries;this._chooseSplitAxis(c,e,d);d=this._chooseSplitIndex(c,e,d);d=h(c.children.splice(d,c.children.length-d));d.height=c.height;d.leaf=c.leaf;q(c,this.toBBox);q(d,this.toBBox);b?a[b-1].children.push(d):this._splitRoot(c,d)},_splitRoot:function(a,b){this.data=h([a,b]);this.data.height=a.height+1;this.data.leaf=!1;q(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var d,f,h,k,l,n,p;l=n=Infinity;for(d=b;d<=c-b;d++)f=g(a,0,d,this.toBBox),h=g(a,d,c,this.toBBox),k=Math.max(0,Math.min(f.maxX,
h.maxX)-Math.max(f.minX,h.minX))*Math.max(0,Math.min(f.maxY,h.maxY)-Math.max(f.minY,h.minY)),f=e(f)+e(h),k<l?(l=k,p=d,n=f<n?f:n):k===l&&f<n&&(n=f,p=d);return p},_chooseSplitAxis:function(a,c,d){var e=a.leaf?this.compareMinX:b,g=a.leaf?this.compareMinY:f,h=this._allDistMargin(a,c,d,e);c=this._allDistMargin(a,c,d,g);h<c&&a.children.sort(e)},_allDistMargin:function(a,b,c,d){a.children.sort(d);d=this.toBBox;var e=g(a,0,b,d),f=g(a,c-b,c,d),h=k(e)+k(f),n,p;for(n=b;n<c-b;n++)p=a.children[n],l(e,a.leaf?d(p):
p),h+=k(e);for(n=c-b-1;n>=b;n--)p=a.children[n],l(f,a.leaf?d(p):p),h+=k(f);return h},_adjustParentBBoxes:function(a,b,c){for(;0<=c;c--)l(b[c],a)},_condense:function(a){for(var b=a.length-1,c;0<=b;b--)0===a[b].children.length?0<b?(c=a[b-1].children,c.splice(c.indexOf(a[b]),1)):this.clear():q(a[b],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+
a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")}};return d})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function t(g,l,b,f,e){for(;f>b;){if(600<f-b){var k=f-b+1,c=l-b+1,a=Math.log(k),h=.5*Math.exp(2*a/3),a=.5*Math.sqrt(a*h*(k-h)/k)*(0>c-k/2?-1:1);t(g,l,Math.max(b,Math.floor(l-c*h/k+a)),Math.min(f,Math.floor(l+(k-c)*h/k+a)),e)}k=g[l];c=b;h=f;d(g,b,l);for(0<e(g[f],k)&&d(g,b,f);c<h;){d(g,c,h);c++;for(h--;0>e(g[c],k);)c++;for(;0<e(g[h],k);)h--}0===e(g[b],k)?
d(g,b,h):(h++,d(g,h,f));h<=l&&(b=h+1);l<=h&&(f=h-1)}}function d(d,l,b){var f=d[l];d[l]=d[b];d[b]=f}function q(d,l){return d<l?-1:d>l?1:0}return function(d,l,b,f,e){t(d,l,b||0,f||d.length-1,e||q)}})},"esri/layers/graphics/data/QueryEngine":function(){define("require exports ../../../core/tsSupport/assignHelper @dojo/framework/shim/array @dojo/framework/shim/Map @dojo/framework/shim/Set ../../../core/asyncUtils ../../../core/Error ../../../core/lang ../../../core/Logger ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/PromiseQueue".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E){function I(a,b,c,d,e,f,g,h,k){k||(k=G);g&&!f?d.forEachInBounds(e,function(d){if(!b.has(d.objectId)){var e=B.getCentroid(c,d,h),f=d.attributes;e&&(b.add(d.objectId),a.push(new F(f,null,e,k(d))))}}):f&&!g?d.forEachInBounds(e,function(d){if(!b.has(d.objectId)){var e=d.attributes,f=B.getGeometry(c,d,0,h);f&&(b.add(d.objectId),a.push(new F(e,f,null,k(d))))}}):d.forEachInBounds(e,function(d){if(!b.has(d.objectId)){var e=d.attributes,f=B.getGeometry(c,
d,0,h),g=B.getCentroid(c,d,h);f&&g&&(b.add(d.objectId),a.push(new F(e,f,g,k(d))))}})}Object.defineProperty(d,"__esModule",{value:!0});var G=function(a){return 1},L=c.getLogger("esri.layers.graphics.data.QueryEngine"),F=function(){return function(a,b,c,d){this.attributes=a;this.geometry=b;this.centroid=c;this.filterFlags=d}}(),K=new b.default,M=new a.Storage(2E6),Q=0;t=function(){function c(b){var c=this;this.capabilities={query:m.queryCapabilities};this.fieldsMap=new l.default;this.geometryType=b.geometryType;
this.hasM=b.hasM;this.hasZ=b.hasZ;this.objectIdField=b.objectIdField;this.spatialReference=b.spatialReference;this.definitionExpression=b.definitionExpression;this.cacheSpatialQueries=b.cacheSpatialQueries||!1;this.gdbVersion=b.gdbVersion;this.historicMoment=b.historicMoment;this.featureStore=b.featureStore;this.featureStore.setEngine(this);this.timeInfo=b.timeInfo;this.cacheSpatialQueries&&(this._geometryQueryCache=new a(Q++ +"$$",M));b.fields.forEach(function(a){c.fieldsMap.set(a.name.trim(),a);
c.fieldsMap.set(a.name.trim().toLowerCase(),a)});b.scheduler&&b.priority&&(this._frameQueue=new E.PromiseQueue,this._frameTask=b.scheduler.registerTask(b.priority,function(a){return c._update(a)},function(){return 0<c._frameQueue.length}))}c.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this.fieldsMap.clear()};Object.defineProperty(c.prototype,
"fullExtent",{get:function(){var a=this.featureStore.fullBounds;return a?{xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:B.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"timeExtent",{get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:this._timeExtent=C.getTimeExtent(this.timeInfo,this.featureStore):null},enumerable:!0,configurable:!0});c.prototype.clearCache=function(){this._geometryQueryCache&&
this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};c.prototype.executeQuery=function(a){var b=this;void 0===a&&(a={});var c=k.clone(a);return f.safeCast(B.normalizeQuery(c,this.definitionExpression,this.spatialReference)).then(function(a){return b._schedule(a)}).then(function(a){return b._checkQuerySupport(a)}).then(function(a){return b._reschedule(a)}).then(function(a){return b._executeGeometryQuery(a)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeObjectIdsQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeTimeQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeAttributesQuery(c)}).catch(function(a){if(a===
B.QUERY_ENGINE_EMPTY_RESULT)return new x.default([],null,b);throw a;}).then(function(a){return a.createQueryResponse(c)})};c.prototype.executeQueryForCount=function(a){var b=this;void 0===a&&(a={});var c=k.clone(a);c.returnGeometry=!1;c.returnCentroid=!1;c.outSR=null;return f.safeCast(B.normalizeQuery(c,this.definitionExpression,this.spatialReference)).then(function(a){return b._schedule(a)}).then(function(a){return b._checkQuerySupport(a)}).then(function(a){return b._reschedule(a)}).then(function(a){return b._executeGeometryQuery(a)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeObjectIdsQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeTimeQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeAttributesQuery(c)}).then(function(a){return a.size}).catch(function(a){if(a===
B.QUERY_ENGINE_EMPTY_RESULT)return 0;throw a;})};c.prototype.executeQueryForExtent=function(a){var b=this;void 0===a&&(a={});var c=k.clone(a),d=c.outSR;return f.safeCast(B.normalizeQuery(c,this.definitionExpression,this.spatialReference)).then(function(a){return b._schedule(a)}).then(function(a){return b._checkQuerySupport(a)}).then(function(){c.returnGeometry=!0;c.returnCentroid=!1;c.outSR=null;return c}).then(function(a){return b._reschedule(a)}).then(function(a){return b._executeGeometryQuery(a)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeObjectIdsQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeTimeQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeAttributesQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){var c=
a.size;if(!c)return{count:c,extent:null};var e={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:B.cleanFromGeometryEngine(b.spatialReference)};b.featureStore.forEachBounds(a.items,function(a){e.xmin=Math.min(a[0],e.xmin);e.ymin=Math.min(a[1],e.ymin);e.xmax=Math.max(a[2],e.xmax);e.ymax=Math.max(a[3],e.ymax)});a=w.project(e,a.spatialReference,d);a.spatialReference=B.cleanFromGeometryEngine(d||b.spatialReference);
if(0===a.xmax-a.xmin){var f=p.getMetersPerUnitForSR(a.spatialReference);a.xmin-=f;a.xmax+=f}0===a.ymax-a.ymin&&(f=p.getMetersPerUnitForSR(a.spatialReference),a.ymin-=f,a.ymax+=f);return{count:c,extent:a}}).catch(function(a){if(a===B.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw a;})};c.prototype.executeQueryForIds=function(a){void 0===a&&(a={});return this.executeQueryForIdSet(a).then(function(a){return g.from(a)})};c.prototype.executeQueryForIdSet=function(a){var c=this;void 0===a&&
(a={});var d=k.clone(a);d.returnGeometry=!1;d.returnCentroid=!1;d.outSR=null;return f.safeCast(B.normalizeQuery(d,this.definitionExpression,this.spatialReference)).then(function(a){return c._schedule(a)}).then(function(a){return c._executeGeometryQuery(a)}).then(function(a){return c._reschedule(a)}).then(function(a){return a.executeObjectIdsQuery(d)}).then(function(a){return c._reschedule(a)}).then(function(a){return a.executeTimeQuery(d)}).then(function(a){return c._reschedule(a)}).then(function(a){return a.executeAttributesQuery(d)}).then(function(a){return c._reschedule(a)}).then(function(a){a=
a.items;for(var c=new b.default,d=0;d<a.length;d++)c.add(a[d].objectId);return c}).catch(function(a){if(a===B.QUERY_ENGINE_EMPTY_RESULT)return new b.default;throw a;})};c.prototype.executeTileQuery=function(a,c,d){var e=this;void 0===d&&(d=null);var f=c.returnGeometry,g=c.returnCentroid,h=c.pixelBuffer;c=new b.default;var k=[],h=h*a.resolution,l=n.pad(a.bounds,h,n.create());I(k,c,this,this.featureStore,l,f,g,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]},
d);if("esriGeometryPoint"===this.geometryType||g){var m=r.getInfo(this.spatialReference);if(m){var p=m.valid,m=p[0],p=p[1];if(l[0]<m){var q=n.fromValues(p-h,l[1],p,l[3]);I(k,c,this,this.featureStore,q,f,g,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[p,a.bounds[3]]},d)}l[2]>p&&(h=n.fromValues(m,l[1],m+h,l[3]),I(k,c,this,this.featureStore,h,f,g,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[m-p+a.bounds[0],a.bounds[3]]},d))}}k.sort(function(a,b){return a.attributes[e.objectIdField]-
b.attributes[e.objectIdField]});return{features:k,objectIds:c}};c.prototype.executeTileQueryForIds=function(a,b){a=n.pad(a.bounds,b.pixelBuffer*a.resolution,n.create());var c=[];this.featureStore.forEachInBounds(a,function(a){return c.push(a.objectId)});return c};c.prototype.executeQueryForLatestObservations=function(a){var b=this;if(this.timeInfo)return this.executeQuery(a).then(function(a){return b._filterLatest(a,b.timeInfo)});L.error(new e("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))};
c.prototype._schedule=function(a){return this._frameQueue?this._frameQueue.push(a).then(function(a){return a}):h.resolve(a)};c.prototype._reschedule=function(a){return this._frameQueue?this._frameQueue.push(a).then(function(a){return a}):h.resolve(a)};c.prototype._update=function(a){for(this._budget=a;!a.done&&this._frameQueue.process();)a.madeProgress();this._budget=null};c.prototype._filterLatest=function(a,b){var c=b.trackIdField,d=b.startTimeField;b=b.endTimeField||d;for(var d=new l.default,e=
[],f=0,g=a.features;f<g.length;f++){var h=g[f],k=h.attributes[c],m=h.attributes[b];(!d.has(k)||d.get(k).attributes[b]<m)&&d.set(k,h)}d.forEach(function(a){return e.push(a)});return q({},a,{features:e})};c.prototype._getAll=function(){if(!this._allItems){var a=[];this.featureStore.forEach(function(b){return a.push(b)});this._allItems=new x.default(a,null,this)}return this._allItems};c.prototype._executeGeometryQuery=function(a){var c=this,d=a.geometry,e=a.outSR,f=a.spatialRel,g=r.isValid(e)&&!r.equals(this.spatialReference,
e),k=this.cacheSpatialQueries?g?JSON.stringify({geometry:d,spatialRelationship:f,outSpatialReference:e}):JSON.stringify({geometry:d,spatialRelationship:f}):null;if(k){var l=this._geometryQueryCache.get(k);if(void 0!==l)return h.resolve(l)}var m=function(b){if(g&&(a.returnGeometry||a.returnCentroid))return b.project(e).then(function(a){k&&c._geometryQueryCache.put(k,a,a.size||1);return a});k&&c._geometryQueryCache.put(k,b,b.size||1);return b};if(!d)return h.resolve(this._getAll()).then(function(a){return m(a)});
if("esriSpatialRelDisjoint"===f){l=this._searchFeatures(this._getQueryBBoxes(d));if(!l.length)return h.resolve(this._getAll()).then(function(a){return m(a)});var n,p;return this._reschedule(l).then(function(a){return new b.default(a)}).then(function(a){return c._reschedule(a)}).then(function(a){var b=0;n=Array(a.size);c.featureStore.forEach(function(a){return n[b++]=a});p=a}).then(function(){return c._reschedule()}).then(function(){return A.getSpatialQueryOperator(f,d,c)}).then(function(a){return c._runSpatialFilter(n,
function(b){return!p.has(b)||a(b.geometry)}).then(function(a){return new x.default(a,d,c)}).then(function(a){return m(a)})})}var q=this._searchFeatures(this._getQueryBBoxes(d));return q.length?this._canExecuteSoloPass(d,a)?h.resolve(new x.default(q,d,this)).then(function(a){return m(a)}):A.getSpatialQueryOperator(f,d,this).then(function(a){return c._runSpatialFilter(q,function(b){return a(b.geometry)})}).then(function(a){return new x.default(a,d,c)}).then(function(a){return m(a)}):(l=new x.default([],
d,this),k&&this._geometryQueryCache.put(k,l,l.size||1),h.resolve(l))};c.prototype._runSpatialFilter=function(a,b){var c=this;if(!b)return h.resolve(a);if(!this._budget)return h.resolve(a.filter(function(a){return b(a)}));var d=0,e=[],f=function(){for(;d<a.length;){var g=a[d];b(g)&&e.push(g);if(c._budget.done)return c._reschedule().then(function(){return f()});++d}return h.resolve()};return this._reschedule().then(function(){return f()}).then(function(){return e})};c.prototype._canExecuteSoloPass=
function(a,b){var c=this.geometryType;b=b.spatialRel;return A.canQueryWithRBush(a)&&("esriSpatialRelEnvelopeIntersects"===b||"esriGeometryPoint"===c&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b||"esriSpatialRelWithin"===b))};c.prototype._getQueryBBoxes=function(a){if(A.canQueryWithRBush(a)){if(v.isExtent(a))return[n.fromValues(a.xmin,a.ymin,a.xmax,a.ymax)];if(v.isPolygon(a))return a.rings.map(function(a){return n.fromValues(a[0][0],a[0][1],a[2][0],a[2][1])})}return[u.getBoundsXY(n.create(),
a)]};c.prototype._searchFeatures=function(a){for(var b=0;b<a.length;b++)this.featureStore.forEachInBounds(a[b],function(a){K.add(a)});var c=Array(K.size),d=0;K.forEach(function(a){return c[d++]=a});K.clear();return c};c.prototype._checkQuerySupport=function(a){return 0>a.distance||null!=a.geometryPrecision||a.multipatchOption||a.pixelSize||a.relationParam||a.text?h.reject(new e("feature-store:unsupported-query","Unsupported query options",{query:a})):h.all([this._checkAttributesQuerySupport(a),this._checkStatisticsQuerySupport(a),
A.checkSpatialQuerySupport(a,this.geometryType,this.spatialReference),w.checkProjectionSupport(this.spatialReference,a.outSR)]).then(function(){return a})};c.prototype._checkAttributesQuerySupport=function(a){var b=a.outFields,c=a.orderByFields,d=a.returnDistinctValues;c&&0<c.length&&(c=c.map(function(a){return-1<a.indexOf(" ASC")?a.split(" ASC")[0]:-1<a.indexOf(" DESC")?a.split(" DESC")[0]:a}),y.validateFields(this.fieldsMap,c,"orderByFields contains missing fields"));if(b&&0<b.length)y.validateFields(this.fieldsMap,
b,"outFields contains missing fields");else if(d)throw new e("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:a});y.validateWhere(this.fieldsMap,a.where)};c.prototype._checkStatisticsQuerySupport=function(a){var b=a.outStatistics,c=a.groupByFieldsForStatistics,d=a.having,f=c&&c.length,g=b&&b.length;if(d){if(!f||!g)return h.reject(new e("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:a}));
y.validateHaving(this.fieldsMap,d,b)}if(g&&!b.some(function(a){return"exceedslimit"===a.statisticType}))for(d=b.map(function(a){return a.onStatisticField}),y.validateFields(this.fieldsMap,d,"onStatisticFields contains missing fields"),f&&y.validateFields(this.fieldsMap,c,"groupByFieldsForStatistics contains missing fields"),c=0;c<b.length;c++){var d=b[c],g=d.onStatisticField,k=d.statisticType;if("exceedslimit"===k)return h.reject(new e("feature-store:unsupported-query","statistic type exceedslimit is not supported",
{definition:d,query:a}));if((!f||"count"!==k)&&g&&y.hasInvalidFieldType(g,this.fieldsMap))return h.reject(new e("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:d,query:a}))}};return c}();d.default=t})},"esri/layers/graphics/data/attributeSupport":function(){define("require exports @dojo/framework/shim/Set ../../../core/Error ../../../core/ItemCache ../../../core/sql/WhereClause".split(" "),function(t,d,q,g,l,b){function f(a){if(!a)return null;var c=d.invalidClauseCache.get(a);
if(void 0!==c)return c;c=d.whereClausesCache.get(a);if(void 0!==c)return c;c=b.create(a);d.whereClausesCache.put(a,c);return c}function e(a,b,c,d){void 0===d&&(d=!0);for(var h=[],l=0;l<b.length;l++){var n=b[l];if("*"!==n&&!a.has(n))if(d){var p=k(n);try{var q=f(p);if(!q.isStandardized())throw new g("feature-store:unsupported-query","expression is not standard",{clause:q});e(a,q.getFields(),"expression contains missing fields")}catch(m){if((p=m&&m.details)&&p.clause)throw m;p&&p.missingFields?Array.prototype.push.apply(h,
p.missingFields):h.push(n)}}else h.push(n)}if(h.length)throw new g("feature-store:unsupported-query",c,{missingFields:h});}function k(a){return a.split(" as ")[0]}Object.defineProperty(d,"__esModule",{value:!0});d.invalidClauseCache=new l(500);d.whereClausesCache=new l(50);var c=new q.default("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));d.validateWhere=function(a,c){if(!c)return!0;var f;try{f=
b.create(c),d.whereClausesCache.put(c,f)}catch(n){throw d.invalidClauseCache.put(c,null),new g("feature-store:unsupported-query","invalid SQL expression",{where:c});}if(!f.isStandardized())throw new g("feature-store:unsupported-query","where clause is not standard",{where:c});c=f.getFields();e(a,c,"where clause contains missing fields");return!0};d.validateHaving=function(a,c,f){if(!c)return!0;var h;try{h=b.create(c),d.whereClausesCache.put(c,h)}catch(v){throw d.invalidClauseCache.put(c,null),new g("feature-store:unsupported-query",
"invalid SQL expression",{having:c});}if(!h.isAggregate())throw new g("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:c});var k=h.getFields();e(a,k,"having contains missing fields");if(!h.getExpressions().every(function(b){var c=b.aggregateType;b=b.field;var d=a.has(b)&&a.get(b).name;return f.some(function(b){var e=b.statisticType;b=b.onStatisticField.toLowerCase().trim();return(a.has(b)&&a.get(b).name)===d&&e.toLowerCase().trim()===c})}))throw new g("feature-store:unsupported-query",
"expressions in having should also exist in outStatistics",{having:c});return!0};d.getWhereClause=f;d.validateFields=e;d.getExpressionFromFieldName=k;d.getAliasFromFieldName=function(a){return a.split(" as ")[1]};d.hasInvalidFieldType=function(a,b){var d=!1;-1!==f(a).getFields().indexOf(a)&&(a=b.get(a),d=!c.has(a.type));return d}})},"esri/core/sql/WhereClause":function(){define("require exports @dojo/framework/shim/array @dojo/framework/shim/Map ../../moment ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),
function(t,d,q,g,l,b,f,e){function k(a){return Array.isArray(a)?a:[a]}function c(a){return null!==a?!0!==a:null}function a(a,b){if(null==a)return null;for(var c=!1,d=0;d<b.length;d++){var e=b[d];if(null==e)c=null;else if(a===e){c=!0;break}}return c}function h(a,b,c){if(null==a)return null;for(var d="",e=0,f=0;f<b.length;f++){var g=b.charAt(f);switch(e){case 0:g===c?e=1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):"%"===g?d+".*":"_"===g?d+".":d+g;break;case 1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?
d+("\\"+g):d+g,e=0}}return(new RegExp("^"+d+"$")).test(a)}function p(a){return a instanceof Date?a.valueOf():a}function n(a,b,c){if(null==b||null==c)return null;b=p(b);c=p(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function u(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d],f=e.toLowerCase();void 0===c[f]&&(b.push(e),c[f]=1)}return b}return function(){function d(){this._hasAggregateFunctions=
this._hasStandardizedFunctions=this.parameters=this.parseTree=null}d.create=function(a){var c=new d;c.parseTree=e.WhereGrammar.parse(a);var g=!0,h=!0;c.visitAll(c.parseTree,function(a){if("function"===a.type){var c=a.name;a=a.args.value.length;g&&(g=f.isStandardized(c,a));h&&(h=b.isAggregate(c,a))}});c._hasStandardizedFunctions=g;c._hasAggregateFunctions=h;return c};d.prototype.isStandardized=function(){return this._hasStandardizedFunctions};d.prototype.isAggregate=function(){return this._hasAggregateFunctions};
d.prototype.setVariablesDictionary=function(a){this.parameters=a};d.prototype.testFeature=function(a){return!!this.evaluateNode(this.parseTree,a)};d.prototype.testSet=function(a){var b=this,c=new g.default;this.visitAll(this.parseTree,function(a){"column_ref"!==a.type||c.has(a.column)||c.set(a.column,a)});for(var d={},e=function(a){c.forEach(function(c,e){c=b.featureValue(a,e,c);d[e]?d[e].push(c):d[e]=[c]})},f=0;f<a.length;f++)e(a[f]);return!!this.evaluateNode(this.parseTree,{attributes:d})};d.prototype.calculateValue=
function(a){return this.evaluateNode(this.parseTree,a)};d.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&a.push(b.name.toLowerCase())});return u(a)};d.prototype.getExpressions=function(){var a=new g.default;this.visitAll(this.parseTree,function(b){if("function"===b.type){var c=b.name.toLowerCase();b=b.args.value[0];if("column_ref"===b.type){b=b.column;var d=c+"-"+b;a.has(d)||a.set(d,{aggregateType:c,field:b})}}});return q.from(a.values())};
d.prototype.getFields=function(){var a=[];this.visitAll(this.parseTree,function(b){"column_ref"===b.type&&a.push(b.column)});return u(a)};d.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return u(a)};d.prototype.featureValue=function(a,b,c){a=a&&"object"===typeof a.attributes?a.attributes:a;var d=a[b];if(void 0!==d)return d;for(var e in a)if(b.toLowerCase()===e.toLowerCase())return c.column=e,a[e];return null};
d.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,d=a.clauses;c<d.length;c++){var e=d[c];this.visitAll(e,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)e=a[c],this.visitAll(e,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);
this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};d.prototype.evaluateNode=function(d,e){switch(d.type){case "case_expression":if("simple"===d.format)for(var g=p(this.evaluateNode(d.operand,e)),m=0;m<d.clauses.length;m++){if(g===p(this.evaluateNode(d.clauses[m].operand,e)))return this.evaluateNode(d.clauses[m].value,e)}else for(m=0;m<d.clauses.length;m++)if(!0===this.evaluateNode(d.clauses[m].operand,e))return this.evaluateNode(d.clauses[m].value,e);return null!==d.else?this.evaluateNode(d.else,
e):null;case "param":return this.parameters[d.value.toLowerCase()];case "expr_list":g=[];m=0;for(d=d.value;m<d.length;m++){var r=d[m];g.push(this.evaluateNode(r,e))}return g;case "unary_expr":return c(this.evaluateNode(d.expr,e));case "binary_expr":switch(d.operator){case "AND":return g=this.evaluateNode(d.left,e),e=this.evaluateNode(d.right,e),null!=g&&null!=e?!0===g&&!0===e:!1===g||!1===e?!1:null;case "OR":return g=this.evaluateNode(d.left,e),e=this.evaluateNode(d.right,e),null!=g&&null!=e?!0===
g||!0===e:!0===g||!0===e?!0:null;case "IS":if("null"!==d.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(d.left,e);case "ISNOT":if("null"!==d.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(d.left,e);case "IN":return g=k(this.evaluateNode(d.right,e)),a(this.evaluateNode(d.left,e),g);case "NOT IN":return g=k(this.evaluateNode(d.right,e)),c(a(this.evaluateNode(d.left,e),g));case "BETWEEN":return g=this.evaluateNode(d.left,e),e=this.evaluateNode(d.right,
e),null==g||null==e[0]||null==e[1]?null:g>=e[0]&&g<=e[1];case "NOTBETWEEN":return g=this.evaluateNode(d.left,e),e=this.evaluateNode(d.right,e),null==g||null==e[0]||null==e[1]?null:g<e[0]||g>e[1];case "LIKE":return h(this.evaluateNode(d.left,e),this.evaluateNode(d.right,e),d.escape);case "NOT LIKE":return c(h(this.evaluateNode(d.left,e),this.evaluateNode(d.right,e),d.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return n(d.operator,this.evaluateNode(d.left,
e),this.evaluateNode(d.right,e));case "*":return this.evaluateNode(d.left,e)*this.evaluateNode(d.right,e);case "-":return this.evaluateNode(d.left,e)-this.evaluateNode(d.right,e);case "+":return this.evaluateNode(d.left,e)+this.evaluateNode(d.right,e);case "/":return this.evaluateNode(d.left,e)/this.evaluateNode(d.right,e)}throw Error("Not Supported Operator "+d.operator);case "null":case "bool":case "string":case "number":return d.value;case "date":return l(d.value,["YYYY-M-D"]).toDate();case "timestamp":return l(d.value,
["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate();case "column_ref":return"CURRENT_DATE"===d.column.toUpperCase()?(r=new Date,r.setHours(0,0,0,0),r):"CURRENT_TIMESTAMP"===d.column.toUpperCase()?new Date:this.featureValue(e,d.column,d);case "function":return e=this.evaluateNode(d.args,e),this.isAggregate()?b.aggregateFunction(d.name,e):f.evaluateFunction(d.name,e)}throw Error("Unsupported sql syntax "+d.type);};return d}()})},"esri/core/sql/AggregateFunctions":function(){define(["require",
"exports"],function(t,d){function q(b){for(var d=0,e=0;e<b.length;e++)d+=b[e];return d/b.length}function g(b){for(var d=q(b),e=b.length,g=0,c=0;c<b.length;c++)g+=Math.pow(b[c]-d,2);return 1<e?g/(e-1):0}Object.defineProperty(d,"__esModule",{value:!0});d.aggregateFunction=function(b,d){var e=l[b.toLowerCase()];if(null==e)throw Error("Function Not Recognised");if(d.length<e.minParams||d.length>e.maxParams)throw Error("Invalid Parameter count for call to "+b.toUpperCase());return e.evaluate(d)};d.isAggregate=
function(b,d){b=l[b.toLowerCase()];return null!=b&&d>=b.minParams&&d<=b.maxParams};var l={min:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.min.apply(Math,b[0])}},max:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.max.apply(Math,b[0])}},avg:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:q(b[0])}},sum:{minParams:1,maxParams:1,evaluate:function(b){if(null==b[0])b=null;else{b=b[0];for(var d=0,e=0;e<b.length;e++)d+=b[e];b=d}return b}},
stddev:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.sqrt(g(b[0]))}},count:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:b[0].length}},var:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:g(b[0])}}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","dojo/regexp"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.evaluateFunction=function(d,b){var f=g[d.toLowerCase()];if(null==f)throw Error("Function Not Recognised");
if(b.length<f.minParams||b.length>f.maxParams)throw Error("Invalid Parameter count for call to "+d.toUpperCase());return f.evaluate(b)};d.isStandardized=function(d,b){d=g[d.toLowerCase()];return null!=d&&b>=d.minParams&&b<=d.maxParams};var g={extract:{minParams:2,maxParams:2,evaluate:function(d){var b=d[0];d=d[1];if(null==d)return null;if(d instanceof Date)switch(b.toUpperCase()){case "SECOND":return d.getSeconds();case "MINUTE":return d.getMinutes();case "HOUR":return d.getHours();case "DAY":return d.getDate();
case "MONTH":return d.getMonth()+1;case "YEAR":return d.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(d){if(2===d.length){var b=d[0],f=d[1];return null==b||null==f?null:b.toString().substring(f-1)}if(3===d.length)return b=d[0],f=d[1],d=d[2],null==b||null==f||null==d?null:0>=d?"":b.toString().substring(f-1,f+d-1)}},position:{minParams:2,maxParams:2,evaluate:function(d){var b=d[0];d=d[1];return null==b||null==d?null:d.indexOf(b)+
1}},trim:{minParams:2,maxParams:3,evaluate:function(d){var b=3===d.length,f=b?d[1]:" ",b=b?d[2]:d[1];if(null==f||null==b)return null;f="("+q.escapeString(f)+")";switch(d[0]){case "BOTH":return b.replace(new RegExp("^"+f+"*|"+f+"*$","g"),"");case "LEADING":return b.replace(new RegExp("^"+f+"*","g"),"");case "TRAILING":return b.replace(new RegExp(f+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:Math.abs(d[0])}},
ceiling:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:Math.ceil(d[0])}},floor:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:Math.floor(d[0])}},log:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:Math.log(d[0])}},log10:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:Math.log(d[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:Math.sin(d[0])}},cos:{minParams:1,maxParams:1,
evaluate:function(d){return null==d[0]?null:Math.cos(d[0])}},tan:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:Math.tan(d[0])}},asin:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:Math.asin(d[0])}},acos:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:Math.acos(d[0])}},atan:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:Math.atan(d[0])}},sign:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:
0<d[0]?1:0>d[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(d){return null==d[0]||null==d[1]?null:Math.pow(d[0],d[1])}},mod:{minParams:2,maxParams:2,evaluate:function(d){return null==d[0]||null==d[1]?null:d[0]%d[1]}},round:{minParams:1,maxParams:2,evaluate:function(d){var b=d[0];d=2===d.length?Math.pow(10,d[1]):1;return null==b?null:Math.round(b*d)/d}},truncate:{minParams:1,maxParams:2,evaluate:function(d){return null==d[0]?null:1===d.length?parseInt(d[0].toFixed(0),10):parseFloat(d[0].toFixed(d[1]))}},
char_length:{minParams:1,maxParams:1,evaluate:function(d){return"string"===typeof d[0]||d[0]instanceof String?d[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(d){for(var b="",f=0;f<d.length;f++){if(null==d[f])return null;b+=d[f].toString()}return b}},lower:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:d[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(d){return null==d[0]?null:d[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require",
"exports","./sql92grammar"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(){}d.parse=function(d){return q.parse(d)};return d}();d.WhereGrammar=t})},"esri/core/sql/sql92grammar":function(){define([],function(){function t(d,q,g,l){this.message=d;this.expected=q;this.found=g;this.location=l;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}(function(d,q){function g(){this.constructor=d}g.prototype=q.prototype;
d.prototype=new g})(t,Error);t.buildMessage=function(d,q){function g(b){return b.charCodeAt(0).toString(16).toUpperCase()}function l(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+g(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+g(b)})}function b(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,
"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+g(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+g(b)})}var f={literal:function(b){return'"'+l(b.text)+'"'},"class":function(d){var e="",c;for(c=0;c<d.parts.length;c++)e+=d.parts[c]instanceof Array?b(d.parts[c][0])+"-"+b(d.parts[c][1]):b(d.parts[c]);return"["+(d.inverted?"^":"")+e+"]"},any:function(b){return"any character"},end:function(b){return"end of input"},other:function(b){return b.description}};
return"Expected "+function(b){var d=Array(b.length),c;for(c=0;c<b.length;c++){var a=c,e;e=b[c];e=f[e.type](e);d[a]=e}d.sort();if(0<d.length){for(b=c=1;c<d.length;c++)d[c-1]!==d[c]&&(d[b]=d[c],b++);d.length=b}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}(d)+" but "+(q?'"'+l(q)+'"':"end of input")+" found."};return{SyntaxError:t,parse:function(d,q){function g(a,b){return{type:"literal",text:a,ignoreCase:b}}function l(a,
b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function b(a){var b=ub[a],c;if(!b){for(c=a-1;!ub[c];)c--;b=ub[c];for(b={line:b.line,column:b.column};c<a;)10===d.charCodeAt(c)?(b.line++,b.column=1):b.column++,c++;ub[a]=b}return b}function f(a,c){var d=b(a),e=b(c);return{start:{offset:a,line:d.line,column:d.column},end:{offset:c,line:e.line,column:e.column}}}function e(a){D<Ca||(D>Ca&&(Ca=D,ob=[]),ob.push(a))}function k(){var b,c,d;b=D;c=aa();c!==z?(c=a(),c!==z?(d=aa(),d!==z?b=c:(D=b,b=z)):
(D=b,b=z)):(D=b,b=z);return b}function c(){var b,c,d,e,f,g,h,k;b=D;c=a();if(c!==z){d=[];e=D;f=aa();f!==z?(g=ha(),g!==z?(h=aa(),h!==z?(k=a(),k!==z?e=f=[f,g,h,k]:(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z);for(;e!==z;)d.push(e),e=D,f=aa(),f!==z?(g=ha(),g!==z?(h=aa(),h!==z?(k=a(),k!==z?e=f=[f,g,h,k]:(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z);if(d!==z){b={type:"expr_list"};c=[c];for(e=0;e<d.length;e++)c.push(d[e][3]);b.value=c}else D=b,b=z}else D=b,b=z;return b}function a(){var a,b,c,d,e,f,g,k;a=D;b=h();
if(b!==z){c=[];d=D;e=aa();e!==z?(f=Z(),f!==z?(g=aa(),g!==z?(k=h(),k!==z?d=e=[e,f,g,k]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);for(;d!==z;)c.push(d),d=D,e=aa(),e!==z?(f=Z(),f!==z?(g=aa(),g!==z?(k=h(),k!==z?d=e=[e,f,g,k]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);c!==z?a=b=sa(b,c):(D=a,a=z)}else D=a,a=z;return a}function h(){var a,b,c,d,e,f,g,h;a=D;b=p();if(b!==z){c=[];d=D;e=aa();e!==z?(f=W(),f!==z?(g=aa(),g!==z?(h=p(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);for(;d!==z;)c.push(d),
d=D,e=aa(),e!==z?(f=W(),f!==z?(g=aa(),g!==z?(h=p(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);c!==z?a=b=sa(b,c):(D=a,a=z)}else D=a,a=z;return a}function p(){var a,b,f,g,h;a=D;b=T();b===z&&(b=D,33===d.charCodeAt(D)?(f=ta,D++):(f=z,0===ba&&e(Ba)),f!==z?(g=D,ba++,61===d.charCodeAt(D)?(h=ya,D++):(h=z,0===ba&&e(Sa)),ba--,h===z?g=void 0:(D=g,g=z),g!==z?b=f=[f,g]:(D=b,b=z)):(D=b,b=z));b!==z?(f=aa(),f!==z?(g=p(),g!==z?a=b={type:"unary_expr",operator:"NOT",expr:g}:(D=a,a=z)):(D=a,a=z)):
(D=a,a=z);if(a===z)if(a=D,b=r(),b!==z)if(f=aa(),f!==z){var k,l,m;f=[];g=D;h=aa();h!==z?(k=n(),k!==z?(l=aa(),l!==z?(m=r(),m!==z?g=h=[h,k,l,m]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);if(g!==z)for(;g!==z;)f.push(g),g=D,h=aa(),h!==z?(k=n(),k!==z?(l=aa(),l!==z?(m=r(),m!==z?g=h=[h,k,l,m]:(D=g,g=z)):(D=g,g=z)):(D=g,g=z)):(D=g,g=z);else f=z;f!==z&&(f={type:"arithmetic",tail:f});f===z&&(f=D,g=v(),g!==z?(h=aa(),h!==z?(h=ea(),h!==z?(h=aa(),h!==z?(h=c(),h!==z?(k=aa(),k!==z?(k=ma(),k!==z?f=g={op:g,right:h}:
(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z),f===z&&(f=D,g=v(),g!==z?(h=aa(),h!==z?(h=ea(),h!==z?(h=aa(),h!==z?(h=ma(),h!==z?f=g={op:g,right:{type:"expr_list",value:[]}}:(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z),f===z&&(f=D,g=v(),g!==z?(h=aa(),h!==z?(h=I(),h!==z?f=g={op:g,right:h}:(D=f,f=z)):(D=f,f=z)):(D=f,f=z))),f===z&&(f=D,h=T(),h!==z?(g=aa(),g!==z?(g=fa(),g!==z?(k=aa(),k!==z?(k=r(),k!==z?(l=aa(),l!==z?(l=W(),l!==z?(h=aa(),h!==z?(h=r(),h!==z?f=h={op:"NOT"+
g,right:{type:"expr_list",value:[k,h]}}:(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z),f===z&&(f=D,h=fa(),h!==z?(g=aa(),g!==z?(g=r(),g!==z?(k=aa(),k!==z?(k=W(),k!==z?(l=aa(),l!==z?(l=r(),l!==z?f=h={op:h,right:{type:"expr_list",value:[g,l]}}:(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)),f===z&&(f=D,g=J(),g!==z?(h=aa(),h!==z?(h=T(),h!==z?(h=aa(),h!==z?(h=r(),h!==z?f=g={op:g+"NOT",right:h}:(D=f,f=z)):(D=f,f=z)):(D=f,f=
z)):(D=f,f=z)):(D=f,f=z),f===z&&(f=D,g=J(),g!==z?(h=aa(),h!==z?(h=r(),h!==z?f=g={op:g,right:h}:(D=f,f=z)):(D=f,f=z)):(D=f,f=z)),f===z&&(f=D,g=u(),g!==z?(h=aa(),h!==z?(h=L(),h!==z?(k=aa(),k!==z?(k=D,d.substr(D,6).toLowerCase()===mc?(l=d.substr(D,6),D+=6):(l=z,0===ba&&e(Ub)),l!==z?(l=D,ba++,m=B(),ba--,m===z?l=void 0:(D=l,l=z),l!==z?k="ESCAPE":(D=k,k=z)):(D=k,k=z),k!==z?(k=aa(),k!==z?(k=F(),k!==z?f=g={op:g,right:h,escape:k.value}:(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,
f=z),f===z&&(f=D,g=u(),g!==z?(h=aa(),h!==z?(h=L(),h!==z?f=g={op:g,right:h,escape:""}:(D=f,f=z)):(D=f,f=z)):(D=f,f=z))))));f===z&&(f=null);f!==z?(a=b,b=f,""==b||void 0==b||null==b?b=a:(f=null,b=f="arithmetic"==b.type?sa(a,b.tail):na(b.op,a,b.right,b.escape)),a=b):(D=a,a=z)}else D=a,a=z;else D=a,a=z;return a}function n(){var a;d.substr(D,2)===Pa?(a=Pa,D+=2):(a=z,0===ba&&e(Wa));a===z&&(62===d.charCodeAt(D)?(a=fb,D++):(a=z,0===ba&&e(Ga)),a===z&&(d.substr(D,2)===kb?(a=kb,D+=2):(a=z,0===ba&&e(vb)),a===
z&&(d.substr(D,2)===Qa?(a=Qa,D+=2):(a=z,0===ba&&e(gb)),a===z&&(60===d.charCodeAt(D)?(a=ua,D++):(a=z,0===ba&&e(Ia)),a===z&&(61===d.charCodeAt(D)?(a=ya,D++):(a=z,0===ba&&e(Sa)),a===z&&(d.substr(D,2)===wa?(a=wa,D+=2):(a=z,0===ba&&e(Ka))))))));return a}function u(){var a,b,c,d;a=a=D;b=T();b!==z?(c=aa(),c!==z?(d=R(),d!==z?a=b=[b,c,d]:(D=a,a=z)):(D=a,a=z)):(D=a,a=z);a!==z&&(a=a[0]+" "+a[2]);a===z&&(a=R());return a}function v(){var a,b,c,d;a=a=D;b=T();b!==z?(c=aa(),c!==z?(d=X(),d!==z?a=b=[b,c,d]:(D=a,a=
z)):(D=a,a=z)):(D=a,a=z);a!==z&&(a=a[0]+" "+a[2]);a===z&&(a=X());return a}function r(){var a,b,c,d,e,f,g,h;a=D;b=w();if(b!==z){c=[];d=D;e=aa();e!==z?(f=y(),f!==z?(g=aa(),g!==z?(h=w(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);for(;d!==z;)c.push(d),d=D,e=aa(),e!==z?(f=y(),f!==z?(g=aa(),g!==z?(h=w(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);c!==z?a=b=sa(b,c):(D=a,a=z)}else D=a,a=z;return a}function y(){var a;43===d.charCodeAt(D)?(a=Ua,D++):(a=z,0===ba&&e(Da));
a===z&&(45===d.charCodeAt(D)?(a=lb,D++):(a=z,0===ba&&e(mb)));return a}function w(){var a,b,c,d,e,f,g,h;a=D;b=x();if(b!==z){c=[];d=D;e=aa();e!==z?(f=m(),f!==z?(g=aa(),g!==z?(h=x(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);for(;d!==z;)c.push(d),d=D,e=aa(),e!==z?(f=m(),f!==z?(g=aa(),g!==z?(h=x(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);c!==z?a=b=sa(b,c):(D=a,a=z)}else D=a,a=z;return a}function m(){var a;42===d.charCodeAt(D)?(a=Hb,D++):(a=z,0===ba&&e(nb));a===
z&&(47===d.charCodeAt(D)?(a=zb,D++):(a=z,0===ba&&e(Ib)));return a}function x(){var b,f,g,h,k,l,m;m=F();if(m===z){var n,p,r,q;n=D;var u,v,x,t;u=D;v=P();v!==z?(x=O(),x!==z?(t=U(),t!==z?u=v=parseFloat(v+x+t):(D=u,u=z)):(D=u,u=z)):(D=u,u=z);u===z&&(u=D,v=P(),v!==z?(x=O(),x!==z?u=v=parseFloat(v+x):(D=u,u=z)):(D=u,u=z),u===z&&(u=D,v=P(),v!==z?(x=U(),x!==z?u=v=parseFloat(v+x):(D=u,u=z)):(D=u,u=z),u===z&&(u=D,v=P(),v!==z&&(v=parseFloat(v)),u=v)));p=u;p!==z?(r=D,ba++,q=C(),ba--,q===z?r=void 0:(D=r,r=z),r!==
z?n=p={type:"number",value:p}:(D=n,n=z)):(D=n,n=z);m=n;if(m===z){var w,y;w=D;var J,V,mb,N;J=D;d.substr(D,4).toLowerCase()===Lc?(V=d.substr(D,4),D+=4):(V=z,0===ba&&e(Mc));V!==z?(mb=D,ba++,N=B(),ba--,N===z?mb=void 0:(D=mb,mb=z),mb!==z?J=V=[V,mb]:(D=J,J=z)):(D=J,J=z);y=J;y!==z&&(y={type:"bool",value:!0});w=y;if(w===z){w=D;var R,Y,lb,T;R=D;d.substr(D,5).toLowerCase()===H?(Y=d.substr(D,5),D+=5):(Y=z,0===ba&&e(ra));Y!==z?(lb=D,ba++,T=B(),ba--,T===z?lb=void 0:(D=lb,lb=z),lb!==z?R=Y=[Y,lb]:(D=R,R=z)):(D=
R,R=z);y=R;y!==z&&(y={type:"bool",value:!1});w=y}m=w;if(m===z){var Hb,W,Da,nb,da;W=D;d.substr(D,4).toLowerCase()===Nb?(Da=d.substr(D,4),D+=4):(Da=z,0===ba&&e(td));Da!==z?(nb=D,ba++,da=B(),ba--,da===z?nb=void 0:(D=nb,nb=z),nb!==z?W=Da=[Da,nb]:(D=W,W=z)):(D=W,W=z);Hb=W;Hb!==z&&(Hb={type:"null",value:null});m=Hb;if(m===z){var ha,Z,fa,zb;ha=D;var Ub,Ib,lc,ca;Ub=D;d.substr(D,4).toLowerCase()===ie?(Ib=d.substr(D,4),D+=4):(Ib=z,0===ba&&e(je));Ib!==z?(lc=D,ba++,ca=B(),ba--,ca===z?lc=void 0:(D=lc,lc=z),lc!==
z?Ub=Ib="DATE":(D=Ub,Ub=z)):(D=Ub,Ub=z);Z=Ub;Z!==z?(fa=aa(),fa!==z?(zb=L(),zb!==z?ha=Z={type:"date",value:zb.value}:(D=ha,ha=z)):(D=ha,ha=z)):(D=ha,ha=z);m=ha;if(m===z){var Ua,na,Lb,qa;Ua=D;var sa,Jb,la,bd;sa=D;d.substr(D,9).toLowerCase()===ke?(Jb=d.substr(D,9),D+=9):(Jb=z,0===ba&&e(le));Jb!==z?(la=D,ba++,bd=B(),ba--,bd===z?la=void 0:(D=la,la=z),la!==z?sa=Jb="TIMESTAMP":(D=sa,sa=z)):(D=sa,sa=z);na=sa;na!==z?(Lb=aa(),Lb!==z?(qa=L(),qa!==z?Ua=na={type:"timestamp",value:qa.value}:(D=Ua,Ua=z)):(D=Ua,
Ua=z)):(D=Ua,Ua=z);m=Ua}}}}}b=m;if(b===z){var oa,wb,ta,Tb,Mb,Ba,ya,Yc,Sa,xa,Ca,Pa;oa=D;var hb,Ab,Ya,Fa;hb=D;d.substr(D,7).toLowerCase()===me?(Ab=d.substr(D,7),D+=7):(Ab=z,0===ba&&e(ne));Ab!==z?(Ya=D,ba++,Fa=B(),ba--,Fa===z?Ya=void 0:(D=Ya,Ya=z),Ya!==z?hb=Ab="EXTRACT":(D=hb,hb=z)):(D=hb,hb=z);wb=hb;if(wb!==z)if(ta=aa(),ta!==z)if(Tb=ea(),Tb!==z)if(Mb=aa(),Mb!==z){var Xa,Ra,tb,Fb,Xb;Ra=D;d.substr(D,4).toLowerCase()===oe?(tb=d.substr(D,4),D+=4):(tb=z,0===ba&&e(pe));tb!==z?(Fb=D,ba++,Xb=B(),ba--,Xb===
z?Fb=void 0:(D=Fb,Fb=z),Fb!==z?Ra=tb="YEAR":(D=Ra,Ra=z)):(D=Ra,Ra=z);Xa=Ra;if(Xa===z){var Yb,wc,ua,db;Yb=D;d.substr(D,5).toLowerCase()===qe?(wc=d.substr(D,5),D+=5):(wc=z,0===ba&&e(re));wc!==z?(ua=D,ba++,db=B(),ba--,db===z?ua=void 0:(D=ua,ua=z),ua!==z?Yb=wc="MONTH":(D=Yb,Yb=z)):(D=Yb,Yb=z);Xa=Yb;if(Xa===z){var Ha,Oa,La,Wa;Ha=D;d.substr(D,3).toLowerCase()===se?(Oa=d.substr(D,3),D+=3):(Oa=z,0===ba&&e(te));Oa!==z?(La=D,ba++,Wa=B(),ba--,Wa===z?La=void 0:(D=La,La=z),La!==z?Ha=Oa="DAY":(D=Ha,Ha=z)):(D=Ha,
Ha=z);Xa=Ha;if(Xa===z){var Qa,fb,Ka,Ia;Qa=D;d.substr(D,4).toLowerCase()===ue?(fb=d.substr(D,4),D+=4):(fb=z,0===ba&&e(ve));fb!==z?(Ka=D,ba++,Ia=B(),ba--,Ia===z?Ka=void 0:(D=Ka,Ka=z),Ka!==z?Qa=fb="HOUR":(D=Qa,Qa=z)):(D=Qa,Qa=z);Xa=Qa;if(Xa===z){var Na,gb,Ta,ad;Na=D;d.substr(D,6).toLowerCase()===S?(gb=d.substr(D,6),D+=6):(gb=z,0===ba&&e(Aa));gb!==z?(Ta=D,ba++,ad=B(),ba--,ad===z?Ta=void 0:(D=Ta,Ta=z),Ta!==z?Na=gb="MINUTE":(D=Na,Na=z)):(D=Na,Na=z);Xa=Na;if(Xa===z){var Ga,vb,wa,sb;Ga=D;d.substr(D,6).toLowerCase()===
we?(vb=d.substr(D,6),D+=6):(vb=z,0===ba&&e(za));vb!==z?(wa=D,ba++,sb=B(),ba--,sb===z?wa=void 0:(D=wa,wa=z),wa!==z?Ga=vb="SECOND":(D=Ga,Ga=z)):(D=Ga,Ga=z);Xa=Ga}}}}}Ba=Xa;Ba!==z?(ya=aa(),ya!==z?(Yc=ga(),Yc!==z?(Sa=aa(),Sa!==z?(xa=a(),xa!==z?(Ca=aa(),Ca!==z?(Pa=ma(),Pa!==z?oa=wb={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:Ba},xa]}}:(D=oa,oa=z)):(D=oa,oa=z)):(D=oa,oa=z)):(D=oa,oa=z)):(D=oa,oa=z)):(D=oa,oa=z)):(D=oa,oa=z)}else D=oa,oa=z;else D=oa,oa=z;else D=oa,
oa=z;else D=oa,oa=z;b=oa;if(b===z){var Ja,qb,gd,hd,kb,Va,Sb,Rb,cc,ub,kc,pb,ob,Ec,Fc,Wb;Ja=D;var Zb,Gb,jc,Qb;Zb=D;d.substr(D,9).toLowerCase()===xe?(Gb=d.substr(D,9),D+=9):(Gb=z,0===ba&&e(ye));Gb!==z?(jc=D,ba++,Qb=B(),ba--,Qb===z?jc=void 0:(D=jc,jc=z),jc!==z?Zb=Gb="SUBSTRING":(D=Zb,Zb=z)):(D=Zb,Zb=z);qb=Zb;if(qb!==z)if(gd=aa(),gd!==z)if(hd=ea(),hd!==z)if(kb=aa(),kb!==z)if(Va=a(),Va!==z)if(Sb=aa(),Sb!==z)if(Rb=ga(),Rb!==z)if(cc=aa(),cc!==z)if(ub=a(),ub!==z)if(kc=aa(),kc!==z){pb=D;var gc,Kb,xb,yb;gc=
D;d.substr(D,3).toLowerCase()===ze?(Kb=d.substr(D,3),D+=3):(Kb=z,0===ba&&e(Ae));Kb!==z?(xb=D,ba++,yb=B(),ba--,yb===z?xb=void 0:(D=xb,xb=z),xb!==z?gc=Kb="FOR":(D=gc,gc=z)):(D=gc,gc=z);ob=gc;ob!==z?(Ec=aa(),Ec!==z?(Fc=a(),Fc!==z?(Wb=aa(),Wb!==z?pb=ob=[ob,Ec,Fc,Wb]:(D=pb,pb=z)):(D=pb,pb=z)):(D=pb,pb=z)):(D=pb,pb=z);pb===z&&(pb=null);pb!==z?(ob=ma(),ob!==z?Ja=qb={type:"function",name:"substring",args:{type:"expr_list",value:pb?[Va,ub,pb[2]]:[Va,ub]}}:(D=Ja,Ja=z)):(D=Ja,Ja=z)}else D=Ja,Ja=z;else D=Ja,
Ja=z;else D=Ja,Ja=z;else D=Ja,Ja=z;else D=Ja,Ja=z;else D=Ja,Ja=z;else D=Ja,Ja=z;else D=Ja,Ja=z;else D=Ja,Ja=z;else D=Ja,Ja=z;b=Ja;if(b===z){var pa,rb,vc,xc,sc,Bb,tc,nc,eb,uc,ed,Hc,Zc,$c;pa=D;rb=ja();rb!==z?(vc=aa(),vc!==z?(xc=ea(),xc!==z?(sc=aa(),sc!==z?(Bb=G(),Bb===z&&(Bb=null),Bb!==z?(tc=aa(),tc!==z?(nc=a(),nc!==z?(eb=aa(),eb!==z?(uc=ga(),uc!==z?(ed=aa(),ed!==z?(Hc=a(),Hc!==z?(Zc=aa(),Zc!==z?($c=ma(),$c!==z?pa=rb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==
Bb?"BOTH":Bb},nc,Hc]}}:(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z);pa===z&&(pa=D,rb=ja(),rb!==z?(vc=aa(),vc!==z?(xc=ea(),xc!==z?(sc=aa(),sc!==z?(Bb=G(),Bb===z&&(Bb=null),Bb!==z?(tc=aa(),tc!==z?(nc=a(),nc!==z?(eb=aa(),eb!==z?(uc=ma(),uc!==z?pa=rb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Bb?"BOTH":Bb},nc]}}:(D=pa,pa=z)):(D=pa,pa=z)):
(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z)):(D=pa,pa=z));b=pa;if(b===z){var Ma,dc,cd,dd,fd,Gc,jd,kd,mc,Ic,id,Vd;Ma=D;var hc,Qc,yc,Wd;hc=D;d.substr(D,8).toLowerCase()===Be?(Qc=d.substr(D,8),D+=8):(Qc=z,0===ba&&e(Ce));Qc!==z?(yc=D,ba++,Wd=B(),ba--,Wd===z?yc=void 0:(D=yc,yc=z),yc!==z?hc=Qc="POSITION":(D=hc,hc=z)):(D=hc,hc=z);dc=hc;dc!==z?(cd=aa(),cd!==z?(dd=ea(),dd!==z?(fd=aa(),fd!==z?(Gc=a(),Gc!==z?(jd=aa(),jd!==z?(kd=X(),kd!==z?(mc=aa(),mc!==z?(Ic=a(),Ic!==z?(id=aa(),
id!==z?(Vd=ma(),Vd!==z?Ma=dc={type:"function",name:"position",args:{type:"expr_list",value:[Gc,Ic]}}:(D=Ma,Ma=z)):(D=Ma,Ma=z)):(D=Ma,Ma=z)):(D=Ma,Ma=z)):(D=Ma,Ma=z)):(D=Ma,Ma=z)):(D=Ma,Ma=z)):(D=Ma,Ma=z)):(D=Ma,Ma=z)):(D=Ma,Ma=z)):(D=Ma,Ma=z);b=Ma;if(b===z){var jb,Rc,Xd,Yd,Zd,oc,$d,ae;jb=D;var Cb,zc,Ac,Ob;Cb=D;Cb=zc=A();if(Cb===z)if(Cb=D,96===d.charCodeAt(D)?(zc=be,D++):(zc=z,0===ba&&e(ce)),zc!==z){Ac=[];Pb.test(d.charAt(D))?(Ob=d.charAt(D),D++):(Ob=z,0===ba&&e(de));if(Ob!==z)for(;Ob!==z;)Ac.push(Ob),
Pb.test(d.charAt(D))?(Ob=d.charAt(D),D++):(Ob=z,0===ba&&e(de));else Ac=z;Ac!==z?(96===d.charCodeAt(D)?(Ob=be,D++):(Ob=z,0===ba&&e(ce)),Ob!==z?Cb=zc=Ac.join(""):(D=Cb,Cb=z)):(D=Cb,Cb=z)}else D=Cb,Cb=z;Rc=Cb;Rc!==z?(Xd=aa(),Xd!==z?(Yd=ea(),Yd!==z?(Zd=aa(),Zd!==z?(oc=c(),oc===z&&(oc=null),oc!==z?($d=aa(),$d!==z?(ae=ma(),ae!==z?jb=Rc={type:"function",name:Rc,args:oc?oc:{type:"expr_list",value:[]}}:(D=jb,jb=z)):(D=jb,jb=z)):(D=jb,jb=z)):(D=jb,jb=z)):(D=jb,jb=z)):(D=jb,jb=z)):(D=jb,jb=z);b=jb;if(b===z){var Sc,
va,pc,Tc,qc,Uc,ac,Db,Bc,ee,fe;va=D;pc=ia();if(pc!==z)if(Tc=aa(),Tc!==z)if(qc=a(),qc!==z)if(Uc=aa(),Uc!==z){ac=[];for(Db=M();Db!==z;)ac.push(Db),Db=M();ac!==z?(Db=aa(),Db!==z?(Bc=ka(),Bc!==z?va=pc={type:"case_expression",format:"simple",operand:qc,clauses:ac,else:null}:(D=va,va=z)):(D=va,va=z)):(D=va,va=z)}else D=va,va=z;else D=va,va=z;else D=va,va=z;else D=va,va=z;if(va===z)if(va=D,pc=ia(),pc!==z)if(Tc=aa(),Tc!==z)if(qc=a(),qc!==z)if(Uc=aa(),Uc!==z){ac=[];for(Db=M();Db!==z;)ac.push(Db),Db=M();ac!==
z?(Db=aa(),Db!==z?(Bc=Q(),Bc!==z?(ee=aa(),ee!==z?(fe=ka(),fe!==z?va=pc={type:"case_expression",format:"simple",operand:qc,clauses:ac,else:Bc.value}:(D=va,va=z)):(D=va,va=z)):(D=va,va=z)):(D=va,va=z)):(D=va,va=z)}else D=va,va=z;else D=va,va=z;else D=va,va=z;else D=va,va=z;Sc=va;if(Sc===z){var Ea,rc,Vc,bc,Eb,Cc,ge,he;Ea=D;rc=ia();if(rc!==z)if(Vc=aa(),Vc!==z){bc=[];for(Eb=K();Eb!==z;)bc.push(Eb),Eb=K();bc!==z?(Eb=aa(),Eb!==z?(Cc=ka(),Cc!==z?Ea=rc={type:"case_expression",format:"searched",clauses:bc,
else:null}:(D=Ea,Ea=z)):(D=Ea,Ea=z)):(D=Ea,Ea=z)}else D=Ea,Ea=z;else D=Ea,Ea=z;if(Ea===z)if(Ea=D,rc=ia(),rc!==z)if(Vc=aa(),Vc!==z){bc=[];for(Eb=K();Eb!==z;)bc.push(Eb),Eb=K();bc!==z?(Eb=aa(),Eb!==z?(Cc=Q(),Cc!==z?(ge=aa(),ge!==z?(he=ka(),he!==z?Ea=rc={type:"case_expression",format:"searched",clauses:bc,else:Cc.value}:(D=Ea,Ea=z)):(D=Ea,Ea=z)):(D=Ea,Ea=z)):(D=Ea,Ea=z)):(D=Ea,Ea=z)}else D=Ea,Ea=z;else D=Ea,Ea=z;Sc=Ea}b=Sc;if(b===z){var Dc,ic,Cd,Wc,Xc;ic=D;Cd=C();if(Cd!==z){Wc=[];for(Xc=E();Xc!==z;)Wc.push(Xc),
Xc=E();Wc!==z?ic=Cd+=Wc.join(""):(D=ic,ic=z)}else D=ic,ic=z;Dc=ic;Dc!==z&&(Dc={type:"column_ref",table:"",column:Dc});b=Dc;b===z&&(b=I(),b===z&&(b=D,f=ea(),f!==z?(g=aa(),g!==z?(h=a(),h!==z?(k=aa(),k!==z?(l=ma(),l!==z?(h.paren=!0,b=f=h):(D=b,b=z)):(D=b,b=z)):(D=b,b=z)):(D=b,b=z)):(D=b,b=z)))}}}}}}}return b}function A(){var a,b,c,d;a=D;b=C();if(b!==z){c=[];for(d=B();d!==z;)c.push(d),d=B();c!==z?a=b+=c.join(""):(D=a,a=z)}else D=a,a=z;return a}function C(){var a;Lb.test(d.charAt(D))?(a=d.charAt(D),D++):
(a=z,0===ba&&e(Jb));return a}function B(){var a;wb.test(d.charAt(D))?(a=d.charAt(D),D++):(a=z,0===ba&&e(Tb));return a}function E(){var a;Mb.test(d.charAt(D))?(a=d.charAt(D),D++):(a=z,0===ba&&e(hb));return a}function I(){var a,b,c;a=D;64===d.charCodeAt(D)?(b=Ab,D++):(b=z,0===ba&&e(Xa));b!==z?(c=A(),c!==z?a=b=[b,c]:(D=a,a=z)):(D=a,a=z);a!==z&&(a={type:"param",value:a[1]});return a}function G(){var a,b,c;a=D;d.substr(D,7).toLowerCase()===Yc?(b=d.substr(D,7),D+=7):(b=z,0===ba&&e(jc));b!==z?(b=D,ba++,
c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="LEADING":(D=a,a=z)):(D=a,a=z);a===z&&(a=D,d.substr(D,8).toLowerCase()===sc?(b=d.substr(D,8),D+=8):(b=z,0===ba&&e(Zc)),b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="TRAILING":(D=a,a=z)):(D=a,a=z),a===z&&(a=D,d.substr(D,4).toLowerCase()===tc?(b=d.substr(D,4),D+=4):(b=z,0===ba&&e($c)),b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="BOTH":(D=a,a=z)):(D=a,a=z)));return a}function L(){var a;a=F();a===z&&(a=I());return a}function F(){var a,
b,c;a=D;39===d.charCodeAt(D)?(b=Ya,D++):(b=z,0===ba&&e(sb));b===z&&(d.substr(D,2)===tb?(b=tb,D+=2):(b=z,0===ba&&e(Qb)));if(b!==z){b=[];c=D;d.substr(D,2)===Rb?(c=Rb,D+=2):(c=z,0===ba&&e(Wb));c!==z&&(c="'");c===z&&(qb.test(d.charAt(D))?(c=d.charAt(D),D++):(c=z,0===ba&&e(Sb)));for(;c!==z;)b.push(c),c=D,d.substr(D,2)===Rb?(c=Rb,D+=2):(c=z,0===ba&&e(Wb)),c!==z&&(c="'"),c===z&&(qb.test(d.charAt(D))?(c=d.charAt(D),D++):(c=z,0===ba&&e(Sb)));b!==z?(39===d.charCodeAt(D)?(c=Ya,D++):(c=z,0===ba&&e(sb)),c!==z?
a=b={type:"string",value:b.join("")}:(D=a,a=z)):(D=a,a=z)}else D=a,a=z;return a}function K(){var b,c,d;b=D;c=da();c!==z?(c=aa(),c!==z?(c=a(),c!==z?(d=aa(),d!==z?(d=Y(),d!==z?(d=aa(),d!==z?(d=a(),d!==z?b=c={type:"when_clause",operand:c,value:d}:(D=b,b=z)):(D=b,b=z)):(D=b,b=z)):(D=b,b=z)):(D=b,b=z)):(D=b,b=z)):(D=b,b=z);return b}function M(){var b,c,d;b=D;c=da();c!==z?(c=aa(),c!==z?(c=a(),c!==z?(d=aa(),d!==z?(d=Y(),d!==z?(d=aa(),d!==z?(d=a(),d!==z?b=c={type:"when_clause",operand:c,value:d}:(D=b,b=z)):
(D=b,b=z)):(D=b,b=z)):(D=b,b=z)):(D=b,b=z)):(D=b,b=z)):(D=b,b=z);return b}function Q(){var b,c;b=D;var f,g;c=D;d.substr(D,4).toLowerCase()===Ta?(f=d.substr(D,4),D+=4):(f=z,0===ba&&e(ad));f!==z?(f=D,ba++,g=B(),ba--,g===z?f=void 0:(D=f,f=z),f!==z?c="ELSE":(D=c,c=z)):(D=c,c=z);c!==z?(c=aa(),c!==z?(c=a(),c!==z?b={type:"else_clause",value:c}:(D=b,b=z)):(D=b,b=z)):(D=b,b=z);return b}function P(){var a,b,c;a=N();a===z&&(a=D,45===d.charCodeAt(D)?(b=lb,D++):(b=z,0===ba&&e(mb)),b===z&&(43===d.charCodeAt(D)?
(b=Ua,D++):(b=z,0===ba&&e(Da))),b!==z?(c=N(),c!==z?a=b=b[0]+c:(D=a,a=z)):(D=a,a=z));return a}function O(){var a,b;a=D;46===d.charCodeAt(D)?(b=Ra,D++):(b=z,0===ba&&e(db));b!==z?(b=N(),b===z&&(b=null),b!==z?a="."+(null!=b?b:""):(D=a,a=z)):(D=a,a=z);return a}function U(){var a,b,c;b=a=D;cc.test(d.charAt(D))?(c=d.charAt(D),D++):(c=z,0===ba&&e(Kb));c!==z?(Fb.test(d.charAt(D))?(c=d.charAt(D),D++):(c=z,0===ba&&e(xb)),c===z&&(c=null),c!==z?b="e"+(null===c?"":c):(D=b,b=z)):(D=b,b=z);b!==z?(c=N(),c!==z?a=b+
c:(D=a,a=z)):(D=a,a=z);return a}function N(){var a,b;a=[];b=V();if(b!==z)for(;b!==z;)a.push(b),b=V();else a=z;a!==z&&(a=a.join(""));return a}function V(){var a;Xb.test(d.charAt(D))?(a=d.charAt(D),D++):(a=z,0===ba&&e(kc));return a}function X(){var a,b,c;a=D;d.substr(D,2).toLowerCase()===yb?(b=d.substr(D,2),D+=2):(b=z,0===ba&&e(Va));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="IN":(D=a,a=z)):(D=a,a=z);return a}function J(){var a,b,c;a=D;d.substr(D,2).toLowerCase()===eb?(b=d.substr(D,
2),D+=2):(b=z,0===ba&&e(ca));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="IS":(D=a,a=z)):(D=a,a=z);return a}function R(){var a,b,c;a=D;d.substr(D,4).toLowerCase()===rb?(b=d.substr(D,4),D+=4):(b=z,0===ba&&e(dc));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="LIKE":(D=a,a=z)):(D=a,a=z);return a}function T(){var a,b,c;a=D;d.substr(D,3).toLowerCase()===lc?(b=d.substr(D,3),D+=3):(b=z,0===ba&&e(bd));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="NOT":(D=a,a=z)):
(D=a,a=z);return a}function W(){var a,b,c;a=D;d.substr(D,3).toLowerCase()===Ec?(b=d.substr(D,3),D+=3):(b=z,0===ba&&e(cd));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="AND":(D=a,a=z)):(D=a,a=z);return a}function Z(){var a,b,c;a=D;d.substr(D,2).toLowerCase()===uc?(b=d.substr(D,2),D+=2):(b=z,0===ba&&e(dd));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="OR":(D=a,a=z)):(D=a,a=z);return a}function fa(){var a,b,c;a=D;d.substr(D,7).toLowerCase()===ed?(b=d.substr(D,7),D+=7):(b=
z,0===ba&&e(fd));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="BETWEEN":(D=a,a=z)):(D=a,a=z);return a}function ga(){var a,b,c;a=D;d.substr(D,4).toLowerCase()===Yb?(b=d.substr(D,4),D+=4):(b=z,0===ba&&e(vc));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="FROM":(D=a,a=z)):(D=a,a=z);return a}function ja(){var a,b,c;a=D;d.substr(D,4).toLowerCase()===wc?(b=d.substr(D,4),D+=4):(b=z,0===ba&&e(xc));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="TRIM":(D=a,a=z)):(D=
a,a=z);return a}function ia(){var a,b,c;a=D;d.substr(D,4).toLowerCase()===xa?(b=d.substr(D,4),D+=4):(b=z,0===ba&&e(Fa));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="CASE":(D=a,a=z)):(D=a,a=z);return a}function ka(){var a,b,c;a=D;d.substr(D,3).toLowerCase()===Na?(b=d.substr(D,3),D+=3):(b=z,0===ba&&e(Ha));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="END":(D=a,a=z)):(D=a,a=z);return a}function da(){var a,b,c;a=D;d.substr(D,4).toLowerCase()===gd?(b=d.substr(D,4),D+=4):
(b=z,0===ba&&e(Oa));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="WHEN":(D=a,a=z)):(D=a,a=z);return a}function Y(){var a,b,c;a=D;d.substr(D,4).toLowerCase()===hd?(b=d.substr(D,4),D+=4):(b=z,0===ba&&e(La));b!==z?(b=D,ba++,c=B(),ba--,c===z?b=void 0:(D=b,b=z),b!==z?a="THEN":(D=a,a=z)):(D=a,a=z);return a}function ha(){var a;44===d.charCodeAt(D)?(a=Zb,D++):(a=z,0===ba&&e(Fc));return a}function ea(){var a;40===d.charCodeAt(D)?(a=Gc,D++):(a=z,0===ba&&e(Hc));return a}function ma(){var a;41===
d.charCodeAt(D)?(a=Ic,D++):(a=z,0===ba&&e(id));return a}function aa(){var a,b;a=[];for(b=qa();b!==z;)a.push(b),b=qa();return a}function qa(){var a;jd.test(d.charAt(D))?(a=d.charAt(D),D++):(a=z,0===ba&&e(kd));return a}function na(a,b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function sa(a,b){for(var c=0;c<b.length;c++)a=na(b[c][1],a,b[c][3]);return a}q=void 0!==q?q:{};var z={},la={start:k},oa=k,ta="!",Ba=g("!",!1),ya="\x3d",Sa=g("\x3d",!1),Pa="\x3e\x3d",
Wa=g("\x3e\x3d",!1),fb="\x3e",Ga=g("\x3e",!1),kb="\x3c\x3d",vb=g("\x3c\x3d",!1),Qa="\x3c\x3e",gb=g("\x3c\x3e",!1),ua="\x3c",Ia=g("\x3c",!1),wa="!\x3d",Ka=g("!\x3d",!1),Ua="+",Da=g("+",!1),lb="-",mb=g("-",!1),Hb="*",nb=g("*",!1),zb="/",Ib=g("/",!1),Lb=/^[A-Za-z_\x80-\uFFFF]/,Jb=l([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),wb=/^[A-Za-z0-9_]/,Tb=l([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Mb=/^[A-Za-z0-9_.\x80-\uFFFF]/,hb=l([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),
Ab="@",Xa=g("@",!1),Ya="'",sb=g("'",!1),tb="N'",Qb=g("N'",!1),Rb="''",Wb=g("''",!1),qb=/^[^']/,Sb=l(["'"],!0,!1),Ra=".",db=g(".",!1),Xb=/^[0-9]/,kc=l([["0","9"]],!1,!1),cc=/^[eE]/,Kb=l(["e","E"],!1,!1),Fb=/^[+\-]/,xb=l(["+","-"],!1,!1),Nb="null",td=g("NULL",!0),Lc="true",Mc=g("TRUE",!0),H="false",ra=g("FALSE",!0),yb="in",Va=g("IN",!0),eb="is",ca=g("IS",!0),rb="like",dc=g("LIKE",!0),mc="escape",Ub=g("ESCAPE",!0),lc="not",bd=g("NOT",!0),Ec="and",cd=g("AND",!0),uc="or",dd=g("OR",!0),ed="between",fd=
g("BETWEEN",!0),Yb="from",vc=g("FROM",!0),ze="for",Ae=g("FOR",!0),xe="substring",ye=g("SUBSTRING",!0),me="extract",ne=g("EXTRACT",!0),wc="trim",xc=g("TRIM",!0),Be="position",Ce=g("POSITION",!0),ke="timestamp",le=g("TIMESTAMP",!0),ie="date",je=g("DATE",!0),Yc="leading",jc=g("LEADING",!0),sc="trailing",Zc=g("TRAILING",!0),tc="both",$c=g("BOTH",!0),oe="year",pe=g("YEAR",!0),qe="month",re=g("MONTH",!0),se="day",te=g("DAY",!0),ue="hour",ve=g("HOUR",!0),S="minute",Aa=g("MINUTE",!0),we="second",za=g("SECOND",
!0),xa="case",Fa=g("CASE",!0),Na="end",Ha=g("END",!0),gd="when",Oa=g("WHEN",!0),hd="then",La=g("THEN",!0),Ta="else",ad=g("ELSE",!0),Zb=",",Fc=g(",",!1),Gc="(",Hc=g("(",!1),Ic=")",id=g(")",!1),jd=/^[ \t\n\r]/,kd=l([" ","\t","\n","\r"],!1,!1),be="`",ce=g("`",!1),Pb=/^[^`]/,de=l(["`"],!0,!1),D=0,ub=[{line:1,column:1}],Ca=0,ob=[],ba=0,Gb;if("startRule"in q){if(!(q.startRule in la))throw Error("Can't start parsing from rule \""+q.startRule+'".');oa=la[q.startRule]}Gb=oa();if(Gb!==z&&D===d.length)return Gb;
Gb!==z&&D<d.length&&e({type:"end"});throw function(a,b,c){return new t(t.buildMessage(a,b),a,b,c)}(ob,Ca<d.length?d.charAt(Ca):null,Ca<d.length?f(Ca,Ca+1):f(Ca,Ca));}}})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(t,d,q,g,l,b,f){function e(a,b){var d;if(!b)return null;if("x"in
b){var e={x:0,y:0};a=a(b.x,b.y,h);e.x=a[0];e.y=a[1];null!=b.z&&(e.z=b.z);null!=b.m&&(e.m=b.m);return e}if("xmin"in b)return e={xmin:0,ymin:0,xmax:0,ymax:0},d=a(b.xmin,b.ymin,h),e.xmin=d[0],e.ymin=d[1],a=a(b.xmax,b.ymax,h),e.xmax=a[0],e.ymax=a[1],b.hasZ&&(e.zmin=b.zmin,e.zmax=b.zmax,e.hasZ=!0),b.hasM&&(e.mmin=b.mmin,e.mmax=b.mmax,e.hasM=!0),e;if("rings"in b)return{rings:k(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:k(b.paths,a),hasM:b.hasM,hasZ:b.hasZ};if("points"in b)return{points:c(b.points,
a),hasM:b.hasM,hasZ:b.hasZ}}function k(a,b){for(var d=[],e=0;e<a.length;e++)d.push(c(a[e],b));return d}function c(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=b(e[0],e[1],[0,0]);c.push(f);2<e.length&&f.push(e[2]);3<e.length&&f.push(e[3])}return c}function a(a,c){return!b.isValid(a)||!b.isValid(c)||b.equals(a,c)||f.canProject(a,c)?!1:!0}Object.defineProperty(d,"__esModule",{value:!0});var h=[0,0];d.checkProjectionSupport=function(b,c){if(!c)return g.resolve();if(Array.isArray(b)){for(var d=0;d<
b.length;d++){var e=b[d];if(a(e.geometry&&e.geometry.spatialReference,c))return l.isSupported()?l.load():g.reject(new q("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,outSpatialReference:c}))}return g.resolve()}return a(b,c)?l.isSupported()?l.load():g.reject(new q("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,outSpatialReference:c})):g.resolve()};var p=e.bind(null,f.lngLatToXY),n=e.bind(null,f.xyToLngLat);d.project=function(a,
c,d){d||(d=c,c=a.spatialReference);return b.isValid(c)&&b.isValid(d)&&!b.equals(c,d)?f.canProject(c,d)?b.isWebMercator(d)?p(a):n(a):l.projectMany([a],c,d,null,!0)[0]:a};var u=new (function(){function a(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a,c,d){var e=this;a&&a.length&&c&&d&&!b.equals(c,d)||g.resolve(a);var f={geometries:a,inSpatialReference:c,outSpatialReference:d,resolve:null};this._jobs.push(f);return g.create(function(a){f.resolve=a;
null===e._timer&&(e._timer=setTimeout(e._process,10))},function(){var a=e._jobs.indexOf(f);-1<a&&e._jobs.splice(a,1)})};a.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var c=a.geometries,d=a.inSpatialReference,e=a.outSpatialReference,a=a.resolve;f.canProject(d,e)?b.isWebMercator(e)?a(c.map(p)):a(c.map(n)):a(l.projectMany(c,d,e,null,!0));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return a}());d.projectMany=function(a,b,c){return u.push(a,b,c)}})},
"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),function(t,d,q,g,l,b){function f(c,d,f,g,q){void 0===g&&(g=null);void 0===q&&(q=!1);if(null===g){var h=b.cacheKey(d,f);void 0!==a[h]?g=a[h]:(g=e(d,f,null),null===g&&(g=new b),a[h]=g)}return k._project(c,d,f instanceof l||!1===q?f:new l(f),g,q)}function e(a,c,d){void 0===d&&(d=null);a=k._getTransformation(a,c,d);return null!==a?b.fromGE(a):null}Object.defineProperty(d,
"__esModule",{value:!0});var k=null;d.isLoaded=function(){return!!k&&g.isLoaded()};d.isSupported=function(){return g.isSupported()};var c=null;d.load=function(){return c?c:c=q.create(function(a,b){var c=g.load();t(["./geometryEngine"],function(d){k=d;c.then(function(){k._enableProjection(g);a()},function(a){b(a)})})})};d.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:f(a,a[0].spatialReference,b,c):f([a],a.spatialReference,b,c)[0]};var a={};d.projectMany=f;d.getTransformation=
e;d.getTransformations=function(a,c,d){void 0===d&&(d=null);a=k._getTransformationBySuitability(a,c,d);if(null!==a){c=[];for(d=0;d<a.length;d++)c.push(b.fromGE(a[d]));return c}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(t,d,q,g,l){function b(a){function b(a,b,c){a[b]=c(a[b])}d._pe=a;h.init();p.init();n.init();u.init();v.init();d.PeGCSExtent=function(a){function b(){return null!==a&&a.apply(this,
arguments)||this}q(b,a);b.prototype.destroy=function(){d._pe.destroy(this)};return b}(d._pe.PeGCSExtent);for(var e=0,f=[d._pe.PeDatum,d._pe.PeGeogcs,d._pe.PeGeogtran,d._pe.PeObject,d._pe.PeParameter,d._pe.PePrimem,d._pe.PeProjcs,d._pe.PeSpheroid,d._pe.PeUnit];e<f.length;e++)a=f[e],b(a.prototype,"getName",function(a){return function(){return a.call(this,Array(h.PE_NAME_MAX))}});e=0;for(f=[d._pe.PeGeogtran,d._pe.PeProjcs];e<f.length;e++)a=f[e],b(a.prototype,"getParameters",function(a){return function(){for(var b=
Array(h.PE_PARM_MAX),c=a.call(this),e=0;e<b.length;e++){var f=d._pe.getValue(c,"*");b[e]=f?d._pe.wrapPointer(f,d._pe.PeParameter):null;c+=Int32Array.BYTES_PER_ELEMENT}return b}});b(d._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var d=[],e=a.call(this);c(d,b,e);return d}});b(d._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(a){var b=d._pe._pe_getPeGTlistExtendedGTsSize();return function(){var c=null,e=a.call(this);if(!d._pe.compare(e,
d._pe.NULL)){var c=[e],f=this.getSteps();if(1<f)for(var e=d._pe.getPointer(e),g=1;g<f;g++)c.push(d._pe.wrapPointer(e+b*g,d._pe.PeGTlistExtendedGTs))}return c}});var g=d._pe._pe_getPeHorizonSize();a=function(a){return function(){var b=this._cache;b||(this._cache=b=new Map);if(b.has(a))return b.get(a);var c=null,e=a.call(this);if(!d._pe.compare(e,d._pe.NULL)){var c=[e],f=e.getNump();if(1<f)for(var e=d._pe.getPointer(e),h=1;h<f;h++)c.push(d._pe.wrapPointer(e+g*h,d._pe.PeHorizon))}b.set(a,c);return c}};
b(d._pe.PeProjcs.prototype,"horizonGcsGenerate",a);b(d._pe.PeProjcs.prototype,"horizonPcsGenerate",a);d._pe.PeObject.prototype.toString=function(a){void 0===a&&(a=h.PE_STR_OPTS_NONE);d._pe.ensureCache.prepare();var b=d._pe.getPointer(this),c=d._pe.ensureInt8(Array(h.PE_BUFFER_MAX));return d._pe.Pointer_stringify(d._pe._pe_object_to_string_ext(b,a,c))}}function f(a){if(a){var b=d._pe.getClass(a);b&&(b=d._pe.getCache(b))&&(a=d._pe.getPointer(a))&&delete b[a]}}function e(a,b){var c=[];b=Array(b);for(var e=
0;e<a;e++)c.push(d._pe.ensureInt8(b));return c}function k(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):b=a;return b}function c(a,b,c,e){void 0===e&&(e=!1);if(e)for(e=0;e<2*b;e++)a[e]=d._pe.getValue(c+e*Float64Array.BYTES_PER_ELEMENT,"double");else{var f=0===a.length;for(e=0;e<b;e++)f&&(a[e]=Array(2)),a[e][0]=d._pe.getValue(c,"double"),a[e][1]=d._pe.getValue(c+Float64Array.BYTES_PER_ELEMENT,"double"),c+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(d,"__esModule",
{value:!0});var a;d._pe=null;d.isLoaded=function(){return!!d._pe};d.isSupported=function(){return!!g("esri-wasm")};d.load=function(){return a?a:a=l.create(function(a,c){t(["./support/pe-wasm"],function(d){d({locateFile:function(a){return t.toUrl("./support/"+a)},onAbort:function(a){c(Error(a))}}).then(function(c){b(c);a()})})})};(function(a){function b(a,b,e){d._pe.ensureCache.prepare();var f=k(e),g=e===f,f=d._pe.ensureFloat64(f);(a=d._pe._pe_geog_to_proj(d._pe.getPointer(a),b,f))&&c(e,b,f,g);return a}
function e(a,b,c){return f(a,b,c,0)}function f(a,b,e,f){d._pe.ensureCache.prepare();var g=k(e),h=e===g,g=d._pe.ensureFloat64(g);(a=d._pe._pe_proj_to_geog_center(d._pe.getPointer(a),b,g,f))&&c(e,b,g,h);return a}a.geogToProj=b;a.projGeog=function(a,c,d,f){switch(f){case h.PE_TRANSFORM_P_TO_G:return e(a,c,d);case h.PE_TRANSFORM_G_TO_P:return b(a,c,d)}return 0};a.projToGeog=e;a.projToGeogCenter=f})(d.PeCSTransformations||(d.PeCSTransformations={}));var h;(function(a){a.init=function(){a.PE_BUFFER_MAX=
d._pe.PeDefs.prototype.PE_BUFFER_MAX;a.PE_NAME_MAX=d._pe.PeDefs.prototype.PE_NAME_MAX;a.PE_MGRS_MAX=d._pe.PeDefs.prototype.PE_MGRS_MAX;a.PE_USNG_MAX=d._pe.PeDefs.prototype.PE_USNG_MAX;a.PE_DD_MAX=d._pe.PeDefs.prototype.PE_DD_MAX;a.PE_DDM_MAX=d._pe.PeDefs.prototype.PE_DDM_MAX;a.PE_DMS_MAX=d._pe.PeDefs.prototype.PE_DMS_MAX;a.PE_UTM_MAX=d._pe.PeDefs.prototype.PE_UTM_MAX;a.PE_PARM_MAX=d._pe.PeDefs.prototype.PE_PARM_MAX;a.PE_TYPE_NONE=d._pe.PeDefs.prototype.PE_TYPE_NONE;a.PE_TYPE_GEOGCS=d._pe.PeDefs.prototype.PE_TYPE_GEOGCS;
a.PE_TYPE_PROJCS=d._pe.PeDefs.prototype.PE_TYPE_PROJCS;a.PE_TYPE_GEOGTRAN=d._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;a.PE_TYPE_COORDSYS=d._pe.PeDefs.prototype.PE_TYPE_COORDSYS;a.PE_TYPE_UNIT=d._pe.PeDefs.prototype.PE_TYPE_UNIT;a.PE_STR_OPTS_NONE=d._pe.PeDefs.prototype.PE_STR_OPTS_NONE;a.PE_STR_AUTH_NONE=d._pe.PeDefs.prototype.PE_STR_AUTH_NONE;a.PE_STR_AUTH_TOP=d._pe.PeDefs.prototype.PE_STR_AUTH_TOP;a.PE_STR_NAME_CANON=d._pe.PeDefs.prototype.PE_STR_NAME_CANON;a.PE_PARM_X0=d._pe.PeDefs.prototype.PE_PARM_X0;
a.PE_PARM_ND=d._pe.PeDefs.prototype.PE_PARM_ND;a.PE_TRANSFORM_1_TO_2=d._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;a.PE_TRANSFORM_2_TO_1=d._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;a.PE_TRANSFORM_P_TO_G=d._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;a.PE_TRANSFORM_G_TO_P=d._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;a.PE_HORIZON_RECT=d._pe.PeDefs.prototype.PE_HORIZON_RECT;a.PE_HORIZON_POLY=d._pe.PeDefs.prototype.PE_HORIZON_POLY;a.PE_HORIZON_LINE=d._pe.PeDefs.prototype.PE_HORIZON_LINE;a.PE_HORIZON_DELTA=d._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(h=
d.PeDefs||(d.PeDefs={}));(function(a){function b(a,b){var f=null,g=e[a];g||(g={},e[a]=g);g.hasOwnProperty(String(b))?f=g[b]:(a=d._pe.PeFactory.prototype.factoryByType(a,b),d._pe.compare(a,d._pe.NULL)||(f=a,g[b]=f));return f=c(f)}function c(a){if(a){var b=a.getType();switch(b){case h.PE_TYPE_GEOGCS:a=d._pe.castObject(a,d._pe.PeGeogcs);break;case h.PE_TYPE_PROJCS:a=d._pe.castObject(a,d._pe.PeProjcs);break;case h.PE_TYPE_GEOGTRAN:a=d._pe.castObject(a,d._pe.PeGeogtran);break;default:b&h.PE_TYPE_UNIT&&
(a=d._pe.castObject(a,d._pe.PeUnit))}}return a}var e={},f={};a.initialize=function(){d._pe.PeFactory.prototype.initialize(null)};a.coordsys=function(a){return b(h.PE_TYPE_COORDSYS,a)};a.factoryByType=b;a.fromString=function(a,b){var e=null,g=f[a];g||(g={},f[a]=g);g.hasOwnProperty(b)?e=g[b]:(a=d._pe.PeFactory.prototype.fromString(a,b),d._pe.compare(a,d._pe.NULL)||(e=a,g[b]=e));return e=c(e)};a.geogcs=function(a){return b(h.PE_TYPE_GEOGCS,a)};a.geogtran=function(a){return b(h.PE_TYPE_GEOGTRAN,a)};a.getCode=
function(a){return d._pe.PeFactory.prototype.getCode(a)};a.projcs=function(a){return b(h.PE_TYPE_PROJCS,a)};a.unit=function(a){return b(h.PE_TYPE_UNIT,a)}})(d.PeFactory||(d.PeFactory={}));d.PeGCSExtent=null;var p;(function(a){var b;a.init=function(){a.PE_GTLIST_OPTS_COMMON=d._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;b=d._pe._pe_getPeGTlistExtendedEntrySize()};a.getGTlist=function(a,c,e,f,g,h){var k=null,l=new d._pe.PeInteger(h);try{var m=d._pe.PeGTlistExtended.prototype.getGTlist(a,c,e,
f,g,l);if(h=l.val)if(k=[m],1<h){var n=d._pe.getPointer(m);for(a=1;a<h;a++)k.push(d._pe.wrapPointer(n+b*a,d._pe.PeGTlistExtendedEntry))}}finally{d._pe.destroy(l)}return k}})(p=d.PeGTlistExtended||(d.PeGTlistExtended={}));(function(a){a.destroy=function(a){if(a&&a.length){for(var b=0;b<a.length;b++){var c=a[b];f(c);c.getEntries().forEach(function(a){f(a);a=a.getGeogtran();f(a);a.getParameters().forEach(f);[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){f(a);var b=a.getDatum();f(b);f(b.getSpheroid());
f(a.getPrimem());f(a.getUnit())})})}d._pe.PeGTlistExtendedEntry.prototype.Delete(a[0])}}})(d.PeGTlistExtendedEntry||(d.PeGTlistExtendedEntry={}));(function(a){a.geogToGeog=function(a,b,e,f,g){d._pe.ensureCache.prepare();var h=k(e),l=e===h,h=d._pe.ensureFloat64(h),m=0;f&&(m=d._pe.ensureFloat64(f));(a=d._pe._pe_geog_to_geog(d._pe.getPointer(a),b,h,m,g))&&c(e,b,h,l);return a}})(d.PeGTTransformations||(d.PeGTTransformations={}));(function(a){function b(a,b,c,f,g,l){d._pe.ensureCache.prepare();var m,n;
switch(a){case "dd":m=d._pe._pe_geog_to_dd;n=h.PE_DD_MAX;break;case "ddm":m=d._pe._pe_geog_to_ddm;n=h.PE_DDM_MAX;break;case "dms":m=d._pe._pe_geog_to_dms,n=h.PE_DMS_MAX}a=0;b&&(a=d._pe.getPointer(b));b=k(f);b=d._pe.ensureFloat64(b);n=e(c,n);f=d._pe.ensureInt32(n);if(g=m(a,c,b,g,f))for(m=0;m<c;m++)l[m]=d._pe.Pointer_stringify(n[m]);return g}function f(a,b,e,f,g){d._pe.ensureCache.prepare();var h;switch(a){case "dd":h=d._pe._pe_dd_to_geog;break;case "ddm":h=d._pe._pe_ddm_to_geog;break;case "dms":h=
d._pe._pe_dms_to_geog}a=0;b&&(a=d._pe.getPointer(b));b=f.map(function(a){return d._pe.ensureString(a)});f=d._pe.ensureInt32(b);b=d._pe.ensureFloat64(Array(2*e));(h=h(a,e,f,b))&&c(g,e,b);return h}a.geog_to_dms=function(a,c,d,e,f){return b("dms",a,c,d,e,f)};a.dms_to_geog=function(a,b,c,d){return f("dms",a,b,c,d)};a.geog_to_ddm=function(a,c,d,e,f){return b("ddm",a,c,d,e,f)};a.ddm_to_geog=function(a,b,c,d){return f("ddm",a,b,c,d)};a.geog_to_dd=function(a,c,d,e,f){return b("dd",a,c,d,e,f)};a.dd_to_geog=
function(a,b,c,d){return f("dd",a,b,c,d)}})(d.PeNotationDms||(d.PeNotationDms={}));var n;(function(a){a.init=function(){a.PE_MGRS_STYLE_NEW=d._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;a.PE_MGRS_STYLE_OLD=d._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;a.PE_MGRS_STYLE_AUTO=d._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;a.PE_MGRS_180_ZONE_1_PLUS=d._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;a.PE_MGRS_ADD_SPACES=d._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};a.geog_to_mgrs_extended=
function(a,b,c,f,g,l,n){d._pe.ensureCache.prepare();var m=0;a&&(m=d._pe.getPointer(a));a=k(c);c=d._pe.ensureFloat64(a);a=e(b,h.PE_MGRS_MAX);var p=d._pe.ensureInt32(a);if(f=d._pe._pe_geog_to_mgrs_extended(m,b,c,f,g,l,p))for(g=0;g<b;g++)n[g]=d._pe.Pointer_stringify(a[g]);return f};a.mgrs_to_geog_extended=function(a,b,e,f,g){d._pe.ensureCache.prepare();var h=0;a&&(h=d._pe.getPointer(a));a=e.map(function(a){return d._pe.ensureString(a)});e=d._pe.ensureInt32(a);a=d._pe.ensureFloat64(Array(2*b));(f=d._pe._pe_mgrs_to_geog_extended(h,
b,e,f,a))&&c(g,b,a);return f}})(n=d.PeNotationMgrs||(d.PeNotationMgrs={}));(function(a){a.geog_to_usng=function(a,b,c,f,g,l,n){d._pe.ensureCache.prepare();var m=0;a&&(m=d._pe.getPointer(a));a=k(c);c=d._pe.ensureFloat64(a);a=e(b,h.PE_MGRS_MAX);var p=d._pe.ensureInt32(a);if(f=d._pe._pe_geog_to_usng(m,b,c,f,g,l,p))for(g=0;g<b;g++)n[g]=d._pe.Pointer_stringify(a[g]);return f};a.usng_to_geog=function(a,b,e,f){d._pe.ensureCache.prepare();var g=0;a&&(g=d._pe.getPointer(a));a=e.map(function(a){return d._pe.ensureString(a)});
e=d._pe.ensureInt32(a);a=d._pe.ensureFloat64(Array(2*b));(g=d._pe._pe_usng_to_geog(g,b,e,a))&&c(f,b,a);return g}})(d.PeNotationUsng||(d.PeNotationUsng={}));var u;(function(a){a.init=function(){a.PE_UTM_OPTS_NONE=d._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;a.PE_UTM_OPTS_ADD_SPACES=d._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;a.PE_UTM_OPTS_NS=d._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};a.geog_to_utm=function(a,b,c,f,g){d._pe.ensureCache.prepare();var l=0;a&&(l=d._pe.getPointer(a));a=k(c);
c=d._pe.ensureFloat64(a);a=e(b,h.PE_UTM_MAX);var m=d._pe.ensureInt32(a);if(f=d._pe._pe_geog_to_utm(l,b,c,f,m))for(l=0;l<b;l++)g[l]=d._pe.Pointer_stringify(a[l]);return f};a.utm_to_geog=function(a,b,e,f,g){d._pe.ensureCache.prepare();var h=0;a&&(h=d._pe.getPointer(a));a=e.map(function(a){return d._pe.ensureString(a)});e=d._pe.ensureInt32(a);a=d._pe.ensureFloat64(Array(2*b));(f=d._pe._pe_utm_to_geog(h,b,e,f,a))&&c(g,b,a);return f}})(u=d.PeNotationUtm||(d.PeNotationUtm={}));var v;(function(a){var b=
new Map;a.init=function(){a.PE_PCSINFO_OPTION_NONE=d._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;a.PE_PCSINFO_OPTION_DOMAIN=d._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;a.PE_POLE_OUTSIDE_BOUNDARY=d._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;a.PE_POLE_POINT=d._pe.PePCSInfo.prototype.PE_POLE_POINT};a.generate=function(c,e){void 0===e&&(e=a.PE_PCSINFO_OPTION_DOMAIN);var f,g;b.has(c)&&(g=b.get(c),g[e]&&(f=g[e]));f||(f=d._pe.PePCSInfo.prototype.generate(c,e),g||(g=[],b.set(c,g)),g[e]=f);
return f}})(v=d.PePCSInfo||(d.PePCSInfo={}));(function(a){a.version_string=function(){return d._pe.PeVersion.prototype.version_string()}})(d.PeVersion||(d.PeVersion={}));d._init=b})},"esri/geometry/support/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(t,d,q){return function(){function d(d){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(d&&d.steps){var b=0;for(d=d.steps;b<d.length;b++){var f=d[b];f instanceof
q?this.steps.push(f):this.steps.push(new q({wkid:f.wkid,wkt:f.wkt,isInverse:f.isInverse}))}}}d.cacheKey=function(d,b){return[void 0!==d.wkid&&null!==d.wkid?d.wkid.toString():"-1",void 0!==d.wkt&&null!==d.wkt?d.wkt.toString():"",void 0!==b.wkid&&null!==b.wkid?b.wkid.toString():"-1",void 0!==b.wkt&&null!==b.wkt?b.wkt.toString():""].join()};d.fromGE=function(g){var b=new d,f="",e=0;for(g=g.steps;e<g.length;e++){var k=q.fromGE(g[e]);b.steps.push(k);f+=k.uid.toString()+","}b._cached_projection={};b._gtlistentry=
null;b._chain=f;return b};d.prototype.getInverse=function(){var g=new d;g.steps=[];for(var b=this.steps.length-1;0<=b;b--)g.steps.push(this.steps[b].getInverse());return g};d.prototype.getGTListEntry=function(){for(var d="",b=0,f=this.steps;b<f.length;b++)d+=f[b].uid.toString()+",";d!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=d);return this._gtlistentry};d.prototype.assignCachedGe=function(g,b,f){this._cached_projection[d.cacheKey(g,b)]=f};d.prototype.getCachedGeTransformation=
function(g,b){for(var f="",e=0,k=this.steps;e<k.length;e++)f+=k[e].uid.toString()+",";f!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=f);g=this._cached_projection[d.cacheKey(g,b)];return void 0===g?null:g};return d}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(t,d){var q=0;return function(){function d(d){void 0===d&&(d=null);this.uid=q++;d?(this._wkt=void 0!==d.wkt?d.wkt:null,this._wkid=void 0!==d.wkid?d.wkid:
-1,this._isInverse=void 0!==d.isInverse?!0===d.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}d.fromGE=function(g){var b=new d;b._wkt=g.wkt;b._wkid=g.wkid;b._isInverse=g.isInverse;return b};Object.defineProperty(d.prototype,"wkt",{get:function(){return this._wkt},set:function(d){this._wkt=d;this.uid=q++},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"wkid",{get:function(){return this._wkid},set:function(d){this._wkid=d;this.uid=q++},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"isInverse",{get:function(){return this._isInverse},set:function(d){this._isInverse=d;this.uid=q++},enumerable:!0,configurable:!0});d.prototype.getInverse=function(){var g=new d;g._wkt=this.wkt;g._wkid=this._wkid;g._isInverse=!this.isInverse;return g};return d}()})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,
supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/tsSupport/assignHelper @dojo/framework/shim/Set ../../../core/maybe ../../../core/promiseUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(a,b,c){this.items=a;this.queryGeometry=b;this.definitionExpression=c.definitionExpression;this.geometryType=c.geometryType;this.hasM=c.hasM;this.hasZ=c.hasZ;this.objectIdField=c.objectIdField;this.spatialReference=c.spatialReference;this.fieldsMap=c.fieldsMap;this.timeInfo=c.timeInfo}Object.defineProperty(d.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0});
d.prototype.createQueryResponse=function(a){var b;b=a.outStatistics?a.outStatistics.some(function(a){return"exceedslimit"===a.statisticType})?this._createExceedsLimitQueryResponse(a):this._createStatisticsQueryResponse(a):this._createFeatureQueryResponse(a);a.returnQueryGeometry&&(e.isValid(a.outSR)&&!e.equals(this.queryGeometry.spatialReference,a.outSR)?b.queryGeometry=n.cleanFromGeometryEngine(q({spatialReference:a.outSR},h.project(this.queryGeometry,this.queryGeometry.spatialReference,a.outSR))):
b.queryGeometry=n.cleanFromGeometryEngine(q({spatialReference:a.outSR},this.queryGeometry)));return b};d.prototype.executeAttributesQuery=function(c){var e=a.getWhereClause(c.where);if(!e)return b.resolve(this);if(e.isStandardized()){for(var f=0,g=[],h=0,k=this.items;h<k.length;h++){var l=k[h];e.testFeature(l.attributes)&&(g[f++]=l)}e=new d(g,this.queryGeometry,this);e.definitionExpression=c.where;return b.resolve(e)}return b.reject(new TypeError("Where clause is not standardized"))};d.prototype.executeObjectIdsQuery=
function(a){if(!a.objectIds||!a.objectIds.length)return b.resolve(this);var c=new g.default(a.objectIds);return b.resolve(new d(this.items.filter(function(a){return c.has(a.objectId)}),this.queryGeometry,this))};d.prototype.executeTimeQuery=function(a){a=p.getTimeOperator(this.timeInfo,a.timeExtent);if(!l.isSome(a))return b.resolve(this);a=this.items.filter(a);return b.resolve(new d(a,this.queryGeometry,this))};d.prototype.project=function(a){var c=this;return!a||e.equals(this.spatialReference,a)?
b.resolve(this):h.projectMany(this.items.map(function(a){return n.getGeometry(c,a)}),this.spatialReference,a).then(function(b){for(var e=[],f=0;f<c.items.length;f++)e[f]={attributes:c.items[f].attributes,geometry:b[f]};b=[];k.convertFromFeatures(b,e,c.geometryType,c.hasZ,c.hasM,c.objectIdField);return new d(b,c.queryGeometry,{definitionExpression:c.definitionExpression,geometryType:c.geometryType,hasM:c.hasM,hasZ:c.hasZ,objectIdField:c.objectIdField,spatialReference:a,fieldsMap:c.fieldsMap,timeInfo:c.timeInfo})})};
d.prototype._createFeatureQueryResponse=function(a){var b=this,c=this.items,d=this.geometryType,e=this.hasM,g=this.hasZ,h=this.objectIdField,k=this.spatialReference,l=a.outFields,p=a.outSR,q=a.quantizationParameters,u=a.resultRecordCount,v=a.resultOffset,t=!1;null!=u&&null!=v&&(u=v+u,t=c.length>u,c=c.slice(v,Math.min(c.length,u)));return{exceededTransferLimit:t,features:this._createFeatures(a,c),fields:l&&l.map(function(a){return b.fieldsMap.get(a)}),geometryType:d,hasM:e,hasZ:g,objectIdFieldName:h,
spatialReference:n.cleanFromGeometryEngine(p?p:k),transform:q&&f.toQuantizationTransform(q)||null}};d.prototype._createFeatures=function(a,b){var d=new c.default(a,this.fieldsMap),e=a.quantizationParameters,g=a.returnGeometry,h=a.returnCentroid,k=a.maxAllowableOffset,l=a.orderByFields;a=[];var p=0;if(b.length&&l&&l.length){var l=l[0].split(" "),q=l[0],r="DESC"===l[1];b.sort(function(a,b){a=d.getFieldValue(a,q);b=d.getFieldValue(b,q);if("number"===typeof a&&"number"===typeof b)return r?b-a:a-b;if("string"===
typeof a&&"string"===typeof b)return a=a.toUpperCase(),b=b.toUpperCase(),(r?a>b:a<b)?-1:(r?a<b:a>b)?1:0})}if(g||h)if(e=f.toQuantizationTransform(e),g&&!h)for(h=0;h<b.length;h++)g=b[h],a[p++]={attributes:d.getAttributes(g),geometry:n.getGeometry(this,g,k,e)};else if(!g&&h)for(k=0;k<b.length;k++)g=b[k],a[p++]={attributes:d.getAttributes(g),centroid:n.getCentroid(this,g,e)};else for(h=0;h<b.length;h++)g=b[h],a[p++]={attributes:d.getAttributes(g),centroid:n.getCentroid(this,g,e),geometry:n.getGeometry(this,
g,k,e)};else for(k=0;k<b.length;k++)g=b[k],(g=d.getAttributes(g))&&(a[p++]={attributes:g});return a};d.prototype._createExceedsLimitQueryResponse=function(a){var b=!1,c=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,e=0;for(a=a.outStatistics;e<a.length;e++){var f=a[e];if("exceedslimit"===f.statisticType){c=null!=f.maxPointCount?f.maxPointCount:Number.POSITIVE_INFINITY;d=null!=f.maxRecordCount?f.maxRecordCount:Number.POSITIVE_INFINITY;b=null!=f.maxVertexCount?f.maxVertexCount:
Number.POSITIVE_INFINITY;break}}"esriGeometryPoint"===this.geometryType?b=this.items.length>c:this.items.length>d?b=!0:(c=this.hasZ?this.hasM?4:3:this.hasM?3:2,b=this.items.reduce(function(a,b){return a+(b.geometry&&b.geometry.coords.length||0)},0)/c>b);return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(b)}}]}};d.prototype._createStatisticsQueryResponse=function(a){var b=
new c.default(a,this.fieldsMap),d=[],e=[],f=a.groupByFieldsForStatistics,g=a.having,h=f&&f.length,f=h&&f[0],k={},l={},n={},p={attributes:{}},q=0;for(a=a.outStatistics;q<a.length;q++){var u=a[q],v=u.outStatisticFieldName,t=u.statisticType,M="exceedslimit"!==u.statisticType?u.onStatisticField:void 0,Q="1"===M;if(h&&(M===f||Q)&&"count"===u.statisticType){k[M]||(k[M]=this._calculateUniqueValues(b,Q?f:M));var t=k[M],P;for(P in t){var O=t[P],U=O.count,u=O.data,N=O.items,O=l[u]||{attributes:{}};if(!g||b.validateItems(N,
g))O.attributes[v]=U,O.attributes[Q?"EXPR_1":M]=u,l[u]=O}e.push({name:v,alias:v,type:"esriFieldTypeString"})}else{if(h)for(P in Q=this._calculateUniqueValues(b,f),Q){if(O=Q[P],u=O.data,N=O.items,!g||b.validateItems(N,g))O=l[u]||{attributes:{}},N=this._calculateStatistics(N,b,M),U="var"===t?"variance":t,O.attributes[v]=N[U],O.attributes[f]=u,l[u]=O}else n[M]||(n[M]=this._calculateStatistics(this.items,b,M)),N=n[M],U="var"===t?"variance":t,p.attributes[v]=N[U];e.push({name:v,alias:v,type:"esriFieldTypeDouble"})}}if(h)for(var V in l)d.push(l[V]);
else d.push(p);return{fields:e,features:d}};d.prototype._calculateStatistics=function(a,b,c){for(var d=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,f=null,g=null,h=null,k=null,l=[],n=0;n<a.length;n++){var p=b.getFieldValue(a[n],c);null==p||isNaN(p)||(f+=p,d=Math.min(d,p),e=Math.max(e,p),l.push(p))}if(a=l.length){g=f/a;for(k=h=0;k<l.length;k++)p=l[k],h+=Math.pow(p-g,2);k=1<a?h/(a-1):0;h=Math.sqrt(k)}else e=d=null;return{avg:g,count:a,max:e,min:d,stddev:h,sum:f,variance:k}};d.prototype._calculateUniqueValues=
function(a,b){for(var c={},d=0,e=this.items;d<e.length;d++){var f=e[d],g=a.getFieldValue(f,b);if(null==g||"string"===typeof g&&""===g.trim())g=null;null==c[g]?c[g]={count:1,data:g,items:[f]}:(c[g].count++,c[g].items.push(f))}return c};return d}();d.default=t})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["require","exports","@dojo/framework/shim/Map","./attributeSupport"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(b,d){this._fieldDataCache=
new q.default;this._returnDistinctMap=new q.default;this.returnDistinctValues=b.returnDistinctValues;this.fieldsMap=d;if((b=b.outFields)&&-1===b.indexOf("*")){this.outFields=b;for(var e=d=0;e<b.length;e++){var f=b[e],c=g.getExpressionFromFieldName(f),a=this.fieldsMap.has(c),c=a?null:g.getWhereClause(c),a=a?this.fieldsMap.get(f).name:g.getAliasFromFieldName(f)||"FIELD_EXP_"+d++;this._fieldDataCache.set(f,{alias:a,clause:c})}}}d.prototype.getAttributes=function(b){b=b.attributes;b=this._processAttributesForOutFields(b);
return b=this._processAttributesForDistinctValues(b)};d.prototype.getFieldValue=function(b,d){b=b.attributes;var e=this.fieldsMap.has(d),f=e?this.fieldsMap.get(d).name:d,c=null;this._fieldDataCache.has(f)?c=this._fieldDataCache.get(f).clause:e||(c=g.getWhereClause(d),this._fieldDataCache.set(f,{alias:f,clause:c}));return e?b[f]:c.calculateValue(b)};d.prototype.validateItem=function(b,d){this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:g.getWhereClause(d)});return this._fieldDataCache.get(d).clause.testFeature(b.attributes)};
d.prototype.validateItems=function(b,d){var e=this;this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:g.getWhereClause(d)});b=b.map(function(b){return e.getAttributes(b)});return this._fieldDataCache.get(d).clause.testSet(b)};d.prototype._processAttributesForOutFields=function(b){var d=this.outFields;if(!b||!d||!d.length)return b;for(var e={},g=0;g<d.length;g++){var c=this._fieldDataCache.get(d[g]),a=c.alias,c=c.clause;e[a]=c?c.calculateValue(b):b[a]}return e};d.prototype._processAttributesForDistinctValues=
function(b){if(!b||!this.returnDistinctValues)return b;var d=this.outFields,e=[];if(d)for(var g=0;g<d.length;g++){var c=this._fieldDataCache.get(d[g]).alias;e.push(b[c])}else for(c in b)e.push(b[c]);d=(d||["*"]).join(",")+"\x3d"+e.join(",");e=this._returnDistinctMap.get(d)||0;this._returnDistinctMap.set(d,++e);return 1<e?null:b};return d}();d.default=t})},"esri/layers/graphics/data/timeSupport":function(){define(["require","exports"],function(t,d){function q(d,b,f,e){if(null!=f&&null!=e&&f===e)return function(e){return f>=
e.attributes[d]&&f<=e.attributes[b]};if(null!=f&&null!=e)return function(g){return!(g.attributes[d]>e||g.attributes[b]<f)};if(null!=f)return function(d){return!(d.attributes[b]<f)};if(null!=e)return function(b){return!(b.attributes[d]>e)}}function g(d,b,f){if(null!=b&&null!=f&&b===f)return function(e){return e.attributes[d]===b};if(null!=b&&null!=f)return function(e){return e.attributes[d]>=b&&e.attributes[d]<=f};if(null!=b)return function(e){return e.attributes[d]>=b};if(null!=f)return function(b){return b.attributes[d]<=
f}}Object.defineProperty(d,"__esModule",{value:!0});d.getTimeExtent=function(d,b){if(!d)return null;var f=d.startTimeField,e=d.endTimeField,g=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(f&&e)b.forEach(function(a){var b=a.attributes;a=b[f];b=b[e];null==a||isNaN(a)||(g=Math.min(g,a));null==b||isNaN(b)||(c=Math.max(c,b))});else{var a=f||e;b.forEach(function(b){b=b.attributes[a];null==b||isNaN(b)||(g=Math.min(g,b),c=Math.max(c,b))})}return{start:g,end:c}};d.getTimeOperator=function(d,b){if(!b||
!d)return null;var f=d.startTimeField;d=d.endTimeField;if(!f&&!d)return null;var e=b.start;b=b.end;return null==e&&null==b?null:f&&d?q(f,d,e,b):g(f||d,e,b)}})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/kebabDictionary ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v){function r(a,b,f){return g(this,void 0,void 0,function(){var g,h,l,m,n;return q(this,function(p){switch(p.label){case 0:if(!a)return[2,null];g=a.where;a.where=g=g&&g.trim();if(!g||/^1 *= *1$/.test(g)||b&&b===g)a.where=null;return a.geometry?[4,y(a)]:[2,a];case 1:return h=p.sent(),a.distance=0,a.units=null,"esriSpatialRelEnvelopeIntersects"===a.spatialRel&&(l=a.geometry.spatialReference,h=e.getGeometryExtent(h),h.spatialReference=l),a.geometry=h,[4,u.checkProjectionSupport(h.spatialReference,
f)];case 2:return p.sent(),[4,c.normalizeCentralMeridian(k.fromJSON(h))];case 3:return m=p.sent(),[4,u.project(m[0].toJSON(),m[0].spatialReference,f)];case 4:n=p.sent();if(!n)throw d.QUERY_ENGINE_EMPTY_RESULT;n.spatialReference=f;a.geometry=n;return[2,a]}})})}function y(c){var d=c.geometry,e=c.distance,g=c.units;if(null==e)return b.resolve(d);c=d.spatialReference;var h=g&&w.fromJSON(g)||f.getUnitString(c),g=null,g=c&&(a.isGeographic(c)||a.isWebMercator(c))?b.resolve(d):u.checkProjectionSupport(c,
a.WGS84).then(function(){return u.project(d,a.WGS84)});return g.then(function(a){return v.getGeodesicBufferOperator().then(function(b){return b(a,e,h).toJSON()})})}Object.defineProperty(d,"__esModule",{value:!0});var w=new l.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});d.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var m=new n.default,
x=new n.default,A={esriGeometryPoint:p.convertToPoint,esriGeometryPolyline:p.convertToPolyline,esriGeometryPolygon:p.convertToPolygon,esriGeometryMultipoint:p.convertToMultipoint};d.getCentroid=function(a,b,c){if("esriGeometryPolygon"!==a.geometryType||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=h.getCentroidOptimizedGeometry(new n.default,b.geometry,a.hasZ,a.hasM));return c?(b=p.quantizeOptimizedGeometry(x,b.centroid,a.hasZ,a.hasM,"esriGeometryPoint",c),p.convertToPoint(b,a.hasZ,
a.hasM)):p.convertToPoint(b.centroid,a.hasZ,a.hasM)};d.getGeometry=function(a,b,c,d){b="coords"in b?b:b.geometry;return b?c?(c=p.generalizeOptimizedGeometry(m,b,a.hasZ,a.hasM,a.geometryType,c),d&&(c=p.quantizeOptimizedGeometry(x,c,a.hasZ,a.hasM,a.geometryType,d)),A[a.geometryType](c,a.hasZ,a.hasM)):d?(c=p.quantizeOptimizedGeometry(x,b,a.hasZ,a.hasM,a.geometryType,d),A[a.geometryType](c,a.hasZ,a.hasM)):A[a.geometryType](b,a.hasZ,a.hasM):null};d.normalizeQuery=function(a,b,c){return g(this,void 0,void 0,
function(){var d,e,f,g,h;return q(this,function(k){d=a.outFields;e=a.orderByFields;f=a.groupByFieldsForStatistics;g=a.outStatistics;if(d)for(h=0;h<d.length;h++)d[h]=d[h].trim();if(e)for(h=0;h<e.length;h++)e[h]=e[h].trim();if(f)for(h=0;h<f.length;h++)f[h]=f[h].trim();if(g)for(h=0;h<g.length;h++)g[h].onStatisticField&&(g[h].onStatisticField=g[h].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,r(a,b,c)]})})};d.normalizeFilter=function(a,b,c){return g(this,
void 0,void 0,function(){return q(this,function(d){return[2,r(a,b,c)]})})};d.cleanFromGeometryEngine=function(a){return a&&C in a?JSON.parse(JSON.stringify(a,B)):a};var C="_geVersion",B=function(a,b){return a!==C?b:void 0}})},"esri/layers/graphics/centroid":function(){define(["require","exports","./utils"],function(t,d,q){function g(b,d,e,g,c,a){a=q.getStride(c,a);var f=e,k=e+a,l=0,u=0,v=e=0,r=0,t=0;for(--g;t<g;t++,f+=a,k+=a){var w=d[f],m=d[f+1],x=d[f+2],A=d[k],C=d[k+1],B=d[k+2],E=w*C-A*m,v=v+E,l=
l+(w+A)*E,u=u+(m+C)*E;c&&(E=w*B-A*x,e+=(x+B)*E,r+=E);w<b[0]&&(b[0]=w);w>b[1]&&(b[1]=w);m<b[2]&&(b[2]=m);m>b[3]&&(b[3]=m);c&&(x<b[4]&&(b[4]=x),x>b[5]&&(b[5]=x))}0<v&&(v*=-1);0<r&&(r*=-1);if(!v)return null;b=[l,u,.5*v];c&&(b[3]=e,b[4]=.5*r);return b}function l(b,d,e,g,c){c=q.getStride(g,c);for(var a=d,f=d+c,k=0,l=0,u=0,v=0,r=0,t=e-1;r<t;r++,a+=c,f+=c){var w=b[a],m=b[a+1],x=b[a+2],A=b[f],C=b[f+1],B=b[f+2],E;if(g){E=A-w;var I=C-m,G=B-x;E=Math.sqrt(E*E+I*I+G*G)}else E=A-w,I=C-m,E=Math.sqrt(E*E+I*I);E&&
(k+=E,g?(w=[w+.5*(A-w),m+.5*(C-m),x+.5*(B-x)],l+=E*w[0],u+=E*w[1],v+=E*w[2]):(w=[w+.5*(A-w),m+.5*(C-m)],l+=E*w[0],u+=E*w[1]))}return 0<k?g?[l/k,u/k,v/k]:[l/k,u/k]:0<e?g?[b[d],b[d+1],b[d+2]]:[b[d],b[d+1]]:null}Object.defineProperty(d,"__esModule",{value:!0});d.getCentroidOptimizedGeometry=function(b,d,e,k){if(!d||!d.lengths.length)return null;b.lengths.length&&(b.lengths.length=0);b.coords.length&&(b.coords.length=0);for(var c=b.coords,a=[],f=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,
Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],p=d.lengths,n=d.coords,u=q.getStride(e,k),v=0,r=0;r<p.length;r++){var t=p[r],w=g(f,n,v,t,e,k);w&&a.push(w);v+=t*u}a.sort(function(a,b){var c=a[2]-b[2];0===c&&e&&(c=a[4]-b[4]);return c});a.length&&(u=6*a[0][2],c[0]=a[0][0]/u,c[1]=a[0][1]/u,e&&(u=6*a[0][4],c[2]=0!==u?a[0][3]/u:0),c[0]<f[0]||c[0]>f[1]||c[1]<f[2]||c[1]>f[3]||
e&&(c[2]<f[4]||c[2]>f[5]))&&(c.length=0);if(!c.length)if(d=d.lengths[0]?l(n,0,p[0],e,k):null)c[0]=d[0],c[1]=d[1],e&&2<d.length&&(c[2]=d[2]);else return null;return b};d.lineCentroid=l})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){function n(){return g.create(function(a){return t(["../../../geometry/geometryEngine"],a)})}Object.defineProperty(d,"__esModule",{value:!0});var u={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},
v={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},r={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},y={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};
d.importGeometryEngine=n;d.getGeodesicBufferOperator=function(){return n().then(function(a){return a.geodesicBuffer})};d.getSpatialQueryOperator=function(d,e,h){if(f.isPolygon(e)&&"esriGeometryPoint"===h.geometryType&&("esriSpatialRelIntersects"===d||"esriSpatialRelContains"===d)){var m=c.convertFromPolygon(new a.default,e,!1,!1);return g.resolve(function(a){return k.polygonContainsPoint(m,!1,!1,a)})}if(f.isPolygon(e)&&"esriGeometryMultipoint"===h.geometryType){var q=c.convertFromPolygon(new a.default,
e,!1,!1);if("esriSpatialRelContains"===d)return g.resolve(function(a){return k.polygonContainsMultipoint(q,!1,!1,a,h.hasZ,h.hasM)})}if(f.isExtent(e)&&"esriGeometryPoint"===h.geometryType&&("esriSpatialRelIntersects"===d||"esriSpatialRelContains"===d))return g.resolve(function(a){return l.extentContainsPoint(e,p.getGeometry(h,a))});if(f.isExtent(e)&&"esriGeometryMultipoint"===h.geometryType&&"esriSpatialRelContains"===d)return g.resolve(function(a){return l.extentContainsMultipoint(e,p.getGeometry(h,
a))});if(f.isExtent(e)&&"esriSpatialRelIntersects"===d){var r=b.getExtentIntersector(h.geometryType);return g.resolve(function(a){return r(e,p.getGeometry(h,a))})}return n().then(function(a){var b=a[u[d]].bind(null,e);return function(a){return b(p.getGeometry(h,a))}})};d.checkSpatialQuerySupport=function(a,b,c){var d=a.spatialRel,k=a.geometry;return k?!0!==v[d]?g.reject(new q("feature-store:unsupported-query","Unsupported query spatial relationship",{query:a})):e.isValid(k.spatialReference)&&e.isValid(c)?
!0!==r[f.getJsonType(k)]?g.reject(new q("feature-store:unsupported-query","Unsupported query geometry type",{query:a})):!0!==y[b]?g.reject(new q("feature-store:unsupported-query","Unsupported layer geometry type",{query:a})):a.outSR?h.checkProjectionSupport(a.geometry&&a.geometry.spatialReference,a.outSR):g.resolve():g.resolve():g.resolve()};d.canQueryWithRBush=function(a){if(f.isExtent(a))return!0;if(f.isPolygon(a)){var b=0;for(a=a.rings;b<a.length;b++){var c=a[b];if(5!==c.length||c[0][0]!==c[1][0]||
c[0][0]!==c[4][0]||c[2][0]!==c[3][0]||c[0][1]!==c[3][1]||c[0][1]!==c[4][1]||c[1][1]!==c[2][1])return!1}return!0}return!1}})},"esri/layers/graphics/contains":function(){define(["require","exports","./utils"],function(t,d,q){function g(d,b,f,e,g){if(!d)return!1;b=q.getStride(b,f);f=d.coords;var c=!1,a=0,h=0;for(d=d.lengths;h<d.length;h++){for(var k=d[h],l=a,u=a,v=a+k*b;u<v;u+=b){l=u+b;l===v&&(l=a);var r=f[u],t=f[u+1],w=f[l],l=f[l+1];(t<g&&l>=g||l<g&&t>=g)&&r+(g-t)/(l-t)*(w-r)<e&&(c=!c)}a+=k*b}return c}
Object.defineProperty(d,"__esModule",{value:!0});d.polygonContainsPoint=function(d,b,f,e){return g(d,b,f,e.coords[0],e.coords[1])};d.polygonContainsMultipoint=function(d,b,f,e,k,c){k=q.getStride(k,c);c=e.coords;e=e.lengths;if(!e)return!1;for(var a=0,h=0;a<e.length;a++,h+=k)if(!g(d,b,f,c[h],c[h+1]))return!1;return!0};d.polygonContainsCoords=g})},"esri/layers/support/PromiseQueue":function(){define(["require","exports","dojo/errors/CancelError","../../core/promiseUtils"],function(t,d,q,g){Object.defineProperty(d,
"__esModule",{value:!0});t=function(){function d(){this._deferreds=[];this._values=[]}d.prototype.push=function(b){var d=this;return g.create(function(e,f){d._deferreds.push({resolve:e,reject:f});d._values.push(b)})};d.prototype.unshift=function(b){var d=this;return g.create(function(e,f){d._deferreds.unshift({resolve:e,reject:f});d._values.unshift(b)})};Object.defineProperty(d.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,configurable:!0});d.prototype.process=function(){if(0===
this.length)return!1;this._deferreds.shift().resolve(this._values.shift());return!0};d.prototype.cancelAll=function(){for(var b=new q,d=0,e=this._deferreds;d<e.length;d++)e[d].reject(b);this._deferreds.length=0;this._values.length=0};return d}();d.PromiseQueue=t})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../support/earthUtils ../../support/FrustumExtentIntersection".split(" "),
function(t,d,q,g,l,b,f,e,k,c){var a=-.3*k.earthRadius;return function(d){function h(){var a=d.call(this)||this;a.suspended=!0;a._frustumVisibilityDirty=!0;a.extent=null;a.extentIntersectionDirty=!0;a._isVisibleBelowSurface=!1;a.handles=new b;a.layerView=null;return a}q(h,d);Object.defineProperty(h.prototype,"frustumVisibilityDirty",{get:function(){return this._frustumVisibilityDirty},set:function(a){a!==this._frustumVisibilityDirty&&(this._frustumVisibilityDirty=a,this.notifyChange("updating"))},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return this.frustumVisibilityDirty},enumerable:!0,configurable:!0});h.prototype.setup=function(a){var b=this;this.layerView=a;this.extentIntersection=new c.FrustumExtentIntersection({renderCoordsHelper:a.view.renderCoordsHelper});a=a.view;var d=a.basemapTerrain,e=a.resourceController.scheduler;this.handles.add([a.on("resize",function(){return b.viewChange()}),a.state.watch("camera",function(){return b.viewChange()},
!0),e.registerTask(6,function(){return b.update()},function(){return b.needsUpdate()}),d.on("elevation-bounds-change",function(){return b.elevationBoundsChange()})]);"local"===a.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(f.init(d,["opacity","wireframe"],function(){return b.isVisibleBelowSurface=!d.isOpaque()}))};h.prototype.destroy=function(){this.extentIntersection=this.extent=this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};h.prototype.setExtent=function(a){this.extent=
a;this.frustumVisibilityDirty=this.extentIntersectionDirty=!0};h.prototype.viewChange=function(){this.frustumVisibilityDirty=!0};h.prototype.elevationBoundsChange=function(){this.extentIntersectionDirty=this.frustumVisibilityDirty=!0};Object.defineProperty(h.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this.extentIntersectionDirty=this.frustumVisibilityDirty=!0},enumerable:!0,configurable:!0});h.prototype.needsUpdate=function(){return this.frustumVisibilityDirty};
h.prototype.update=function(){this.updateSuspendFrustumVisible();this.frustumVisibilityDirty=!1};h.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var b=this.layerView.view,c;if(this._isVisibleBelowSurface)c=a;else{c=b.basemapTerrain.getElevationBounds();var d=c[0];c=d-Math.max(1,(c[1]-d)*(1.2-1))}this.extentIntersection.update(this.extent,b.spatialReference,c)}};h.prototype.updateSuspendFrustumVisible=function(){this.extent?(this.updateExtentIntersection(),
this._set("suspended",!this.extentIntersection.isVisibleInFrustum(this.layerView.view.frustum))):this._set("suspended",!1)};g([e.property({readOnly:!0})],h.prototype,"suspended",void 0);g([e.property({readOnly:!0})],h.prototype,"updating",null);return h=g([e.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],h)}(e.declared(l))})},"esri/views/3d/layers/graphics/Graphics3DHighlights":function(){define(["require","exports","./Graphics3DHighlightSet"],function(t,d,q){return function(){function d(){this.graphicsCore=
null;this.highlights=[]}d.prototype.destroy=function(){this.highlights.forEach(function(d){return d.highlightSet.removeAll()});this.highlights=null};d.prototype.setup=function(d){this.graphicsCore=d};d.prototype.acquireSet=function(d,b){var f=this,e=new q(d,b);this.highlights.push(e);return{set:e,handle:{remove:function(){return f.releaseSet(e)},pause:function(){e.highlightSet.removeAll();e.paused=!0},resume:function(){e.paused=!1;f.initializeSet(e)}}}};d.prototype.releaseSet=function(d){d.highlightSet.removeAll();
d=this.highlights?this.highlights.indexOf(d):-1;-1!==d&&this.highlights.splice(d,1)};d.prototype.setUids=function(d,b){for(var f=this.graphicsCore.graphics3DGraphics,e=0;e<b.length;e++){var g=b[e];d.ids.add(g);(g=f.get(g))&&g.addHighlight(d.highlightSet,d.options)}};d.prototype.setObjectIds=function(d,b){b.forEach(function(b){return d.ids.add(b)});this.initializeSet(d)};d.prototype.addGraphic=function(d){this.highlights.forEach(function(b){!b.paused&&b.hasGraphic(d)&&d.addHighlight(b.highlightSet,
b.options)})};d.prototype.removeGraphic=function(d){this.highlights.forEach(function(b){b.hasGraphic(d)&&d.removeHighlight(b.highlightSet)})};d.prototype.allGraphicsDeleted=function(){this.highlights.forEach(function(d){return d.highlightSet.removeAll()})};d.prototype.initializeSet=function(d){var b=this.graphicsCore.graphics3DGraphics;d.objectIdField?b.forEach(function(b){b&&d.hasGraphic(b)&&b.addHighlight(d.highlightSet,d.options)}):d.ids.forEach(function(f){(f=b.get(f))&&f.addHighlight(d.highlightSet,
d.options)})};return d}()})},"esri/views/3d/layers/graphics/Graphics3DHighlightSet":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(t,d,q){return function(){function d(d,b){this.highlightSet=new q;this.ids=new Set;this.paused=!1;this.options=d;this.objectIdField=b}d.prototype.hasGraphic=function(d){return this.objectIdField?this.ids.has(d.graphic.attributes[this.objectIdField]):this.ids.has(d.graphic.uid)};return d}()})},"esri/views/3d/webgl-engine/lib/HighlightSet":function(){define(["require",
"exports"],function(t,d){return function(){function d(){this.items=[]}d.prototype.addObject=function(d,l){this.items.push({type:"object",highlightId:l,object:d})};d.prototype.addRenderGeometry=function(d,l,b){this.items.push({type:"renderGeometry",highlightId:l,renderGeometry:d,owner:b})};d.prototype.addExternal=function(d,l){this.items.push({type:"external",highlightId:l,remove:d})};d.prototype.remove=function(d){for(var g=this.items.length-1;0<=g;--g){var b=this.items[g];b.highlightId===d&&(this.removeHighlight(b),
this.items.splice(g,1))}};d.prototype.removeObject=function(d){for(var g=this.items.length-1;0<=g;--g){var b=this.items[g];"object"===b.type&&b.object===d&&(this.removeHighlight(b),this.items.splice(g,1))}};d.prototype.removeRenderGeometry=function(d){for(var g=this.items.length-1;0<=g;--g){var b=this.items[g];"renderGeometry"===b.type&&b.renderGeometry===d&&(this.removeHighlight(b),this.items.splice(g,1))}};d.prototype.removeAll=function(){var d=this;this.items.forEach(function(g){d.removeHighlight(g)});
this.items=[]};d.prototype.removeHighlight=function(d){switch(d.type){case "object":d.object.removeHighlights(d.highlightId);break;case "renderGeometry":d.owner.removeRenderGeometryHighlight(d.renderGeometry,d.highlightId);break;case "external":d.remove(d.highlightId)}};return d}()})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b,f){function e(b,c){return null!==b&&0<b&&8E7>b||50<c}return function(d){function c(){var a=d.call(this)||this;a._scaleRangeActive=!1;a._layerScaleRangeVisibilityDirty=!0;a.layerScaleRangeVisibilityQuery=!1;a.scaleChangeEventHandle=null;a.handles=new b;a.layerView=null;a.layer=null;a.queryGraphicUIDsInExtent=null;a.extent=null;a.graphicsCore=null;a.basemapTerrain=null;a.suspended=!1;return a}q(c,d);Object.defineProperty(c.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},
set:function(a){this._layerScaleRangeVisibilityDirty!==a&&(this._layerScaleRangeVisibilityDirty=a,this.notifyChange("updating"))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0});c.prototype.setup=function(a,b,c,d,e){var f=this;this.layerView=a;this.layer=b;this.queryGraphicUIDsInExtent=c;this.graphicsCore=d;this.basemapTerrain=e;this.updateScaleRangeActive();
this.handles.add(this.layerView.view.resourceController.scheduler.registerTask(6,function(){return f.update()},function(){return f.needsUpdate()}))};c.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);this.handles.destroy();this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=this.handles=null};c.prototype.needsUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty};
c.prototype.setExtent=function(a){this.extent=a;this.layerScaleRangeVisibilityDirty=!0};c.prototype.update=function(){this.updateSuspendScaleVisible();this.layerScaleRangeVisibilityDirty=!1};c.prototype.scaleRangeActive=function(){return this._scaleRangeActive};c.prototype.updateScaleRangeActive=function(){var a=this,b=this.layer,c=e(b.minScale,b.maxScale);b.labelingInfo&&!c&&(c=b.labelingInfo.some(function(a){return a&&e(a.minScale,a.maxScale)}));b=this._scaleRangeActive!==c;(this._scaleRangeActive=
c)&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",function(b){return a.scaleUpdateHandler(b)}):!c&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);return b};c.prototype.updateSuspendScaleVisibleFinish=function(a){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!a)};c.prototype.updateSuspendScaleVisible=function(){var a=this,b=this.layerView.view.basemapTerrain;this.extent&&
b&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,b.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(b){return a.updateSuspendScaleVisibleFinish(b)})):this.updateSuspendScaleVisibleFinish(!0)};c.prototype.visibleAtScale=function(a,b,c){return null==a?!0:a>c&&(!b||a<b)};c.prototype.visibleAtLayerScale=function(a){return this.visibleAtScale(a,this.layer.minScale,this.layer.maxScale)};c.prototype.visibleAtLabelScale=
function(a,b){return this.visibleAtScale(a,b.minScale,b.maxScale)};c.prototype.graphicScale=function(a){var b;a.centroid?b=a.centroid:"point"===a.graphic.geometry.type&&(b=a.graphic.geometry);return b?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(b):1:null};c.prototype.graphicVisible=function(a){a=this.graphicScale(a);return this.visibleAtLayerScale(a)};c.prototype.updateVisibility=function(a){if(this._scaleRangeActive){var b=this.graphicVisible(a);return a.setVisibilityFlag(1,
b,0)}return!1};c.prototype.updateGraphicLabelScaleVisibility=function(a){if(!this._scaleRangeActive||!a._labelGraphics||0===a._labelGraphics.length)return!1;var b=this.graphicScale(a);if(a=this.updateLabelScaleVisibility(a,b))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return a};c.prototype.updateLabelScaleVisibility=function(a,b){if(!a._labelGraphics||0===a._labelGraphics.length)return!1;var c=a._labelGraphics[0]._labelClass;return c&&null!=c.minScale&&null!=
c.maxScale&&(b=this.visibleAtLabelScale(b,c),a.setVisibilityFlag(1,b,1))?!0:!1};c.prototype.scaleUpdateHandler=function(a){var b=this;if(!this.layerView.suspended){var c=a.extent,d=a.scale,e=this.visibleAtLayerScale(d),f=!1;this.queryGraphicUIDsInExtent(c,a.spatialReference,function(a){if(a=b.graphicsCore.getGraphics3DGraphicById(a)){var g=a.centroid;g&&(c[0]>g.x||c[1]>g.y||c[2]<g.x||c[3]<g.y)||(g=!1,a.setVisibilityFlag(1,e,0)&&(g=!0),b.updateLabelScaleVisibility(a,d)&&(g=!0),g&&(f=!0))}});f&&(this.layerView.view.deconflictor.setDirty(),
this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=!0};c.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(a){return a.clearVisibilityFlag(1)}));this.layerScaleRangeVisibilityDirty=!0};g([f.property({readOnly:!0})],c.prototype,"suspended",void 0);g([f.property({readOnly:!0})],c.prototype,"updating",null);return c=g([f.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],
c)}(f.declared(l))})},"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/has ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../core/libs/rbush/PooledRBush".split(" "),function(t,d,q,g,l,b,f,e,k){t=function(d){function f(a){a=d.call(this)||this;a.index=new k.default(9,b("csp-restrictions")?function(a){return{minX:a.extent[0],
minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);a.spatialReference=null;return a}q(f,d);f.prototype.destroy=function(){this.index.destroy();this.index=null;c.prune()};f.prototype.queryGraphicUIDsInExtent=function(b,c,d){c.equals(this.spatialReference)&&(a.minX=b[0],a.minY=b[1],a.maxX=b[2],a.maxY=b[3],this.index.search(a,function(a){return d(a.graphic.uid)}))};f.prototype.add=function(a){!a.addedToSpatialIndex&&a.computeExtent(this.spatialReference)&&
(this.index.insert(a),a.addedToSpatialIndex=!0)};f.prototype.addMany=function(a,b){void 0===b&&(b=a.length);c.clear();for(var d=0;d<b;d++){var e=a[d];!e.addedToSpatialIndex&&e.computeExtent(this.spatialReference)&&(c.push(e),e.addedToSpatialIndex=!0)}this.index.load(c.data,c.length)};f.prototype.remove=function(a){a.addedToSpatialIndex&&(a.addedToSpatialIndex=!1,this.index.remove(a))};f.prototype.clear=function(){this.index.clear()};g([e.property({constructOnly:!0})],f.prototype,"spatialReference",
void 0);return f=g([e.subclass("esri.views.3d.layers.graphics.Graphics3DSpatialIndex")],f)}(e.declared(l));var c=new f,a={minX:0,minY:0,maxX:0,maxY:0};return t})},"esri/core/libs/rbush/PooledRBush":function(){define(["require","exports","../../PooledArray","../quickselect/quickselect"],function(t,d,q,g){function l(a,c){b(a,0,a.children.length,c,a)}function b(a,b,c,d,e){e||(e=n(null,!0));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;e.maxY=-Infinity;for(var g=void 0;b<c;b++)g=a.children[b],f(e,
a.leaf?d(g):g);return e}function f(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function e(a,b){return a.minX-b.minX}function k(a,b){return a.minY-b.minY}function c(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function a(a){return a.maxX-a.minX+(a.maxY-a.minY)}function h(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function p(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&
b.maxY>=a.minY}function n(a,b){return{children:a,height:1,leaf:b,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function u(a,b,c,d,e){for(var f=[b,c];f.length;)if(c=f.pop(),b=f.pop(),!(c-b<=d)){var h=b+Math.ceil((c-b)/d/2)*d;g(a,h,b,c,e);f.push(b,h,h,c)}}Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(a,b){void 0===a&&(a=9);this.compareMinX=e;this.compareMinY=k;this.toBBox=function(a){return a};this._maxEntries=Math.max(4,a||9);this._minEntries=Math.max(2,Math.ceil(.4*
this._maxEntries));b&&("function"===typeof b?this.toBBox=b:this._initFormat(b));this.clear()}d.prototype.destroy=function(){this.clear();v.prune();r.prune();y.prune();w.prune()};d.prototype.all=function(a){this._all(this.data,a)};d.prototype.search=function(a,b){var c=this.data,d=this.toBBox;if(p(a,c))for(v.clear();c;){for(var e=0,f=c.children.length;e<f;e++){var g=c.children[e],k=c.leaf?d(g):g;p(a,k)&&(c.leaf?b(g):h(a,k)?this._all(g,b):v.push(g))}c=v.pop()}};d.prototype.collides=function(a){var b=
this.data,c=this.toBBox;if(!p(a,b))return!1;for(v.clear();b;){for(var d=0,e=b.children.length;d<e;d++){var f=b.children[d],g=b.leaf?c(f):f;if(p(a,g)){if(b.leaf||h(a,g))return!0;v.push(f)}}b=v.pop()}return!1};d.prototype.load=function(a,b){void 0===b&&(b=a.length);if(!b)return this;if(b<this._minEntries){for(var c=0;c<b;c++)this.insert(a[c]);return this}a=this._build(a.slice(0,b),0,b-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&
(c=this.data,this.data=a,a=c),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this};d.prototype.insert=function(a){a&&this._insert(a,this.data.height-1);return this};d.prototype.clear=function(){this.data=n([],!0);return this};d.prototype.remove=function(a,b){if(!a)return this;var c=this.data,d,e,f,g,k=this.toBBox(a);y.clear();for(w.clear();c||y.length;){c||(c=y.pop(),d=y.data[y.length-1],e=w.pop(),f=!0);if(c.leaf){a:{g=a;var l=c.children,m=b;if(m){for(var p=0;p<l.length;p++)if(m(g,
l[p])){g=p;break a}g=-1}else g=l.indexOf(g)}if(-1!==g){c.children.splice(g,1);y.push(c);this._condense(y);break}}f||c.leaf||!h(c,k)?d?(e++,c=d.children[e],f=!1):c=null:(y.push(c),w.push(e),e=0,d=c,c=c.children[0])}return this};d.prototype.toJSON=function(){return this.data};d.prototype.fromJSON=function(a){this.data=a;return this};d.prototype._all=function(a,b){for(r.clear();a;){if(!0===a.leaf){var c=0;for(a=a.children;c<a.length;c++)b(a[c])}else r.pushArray(a.children);a=r.pop()}};d.prototype._build=
function(a,b,c,d){var e=c-b+1,f=this._maxEntries,g;if(e<=f)return g=n(a.slice(b,c+1),!0),l(g,this.toBBox),g;d||(d=Math.ceil(Math.log(e)/Math.log(f)),f=Math.ceil(e/Math.pow(f,d-1)));g=n([],!1);g.height=d;e=Math.ceil(e/f);f=e*Math.ceil(Math.sqrt(f));for(u(a,b,c,f,this.compareMinX);b<=c;b+=f){var h=Math.min(b+f-1,c);u(a,b,h,e,this.compareMinY);for(var k=b;k<=h;k+=e)g.children.push(this._build(a,k,Math.min(k+e-1,h),d-1))}l(g,this.toBBox);return g};d.prototype._chooseSubtree=function(a,b,d,e){for(;;){e.push(b);
if(!0===b.leaf||e.length-1===d)break;for(var f=Infinity,g=Infinity,h=void 0,k=0,l=b.children.length;k<l;k++){var m=b.children[k],p=c(m),n=(Math.max(m.maxX,a.maxX)-Math.min(m.minX,a.minX))*(Math.max(m.maxY,a.maxY)-Math.min(m.minY,a.minY))-p;n<g?(g=n,f=p<f?p:f,h=m):n===g&&p<f&&(f=p,h=m)}b=h||b.children[0]}return b};d.prototype._insert=function(a,b,c){var d=this.toBBox;c=c?a:d(a);y.clear();d=this._chooseSubtree(c,this.data,b,y);d.children.push(a);for(f(d,c);0<=b;)if(y.data[b].children.length>this._maxEntries)this._split(y,
b),b--;else break;this._adjustParentBBoxes(c,y,b)};d.prototype._split=function(a,b){var c=a.data[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);d=this._chooseSplitIndex(c,e,d);d=n(c.children.splice(d,c.children.length-d),c.leaf);d.height=c.height;l(c,this.toBBox);l(d,this.toBBox);b?a.data[b-1].children.push(d):this._splitRoot(c,d)};d.prototype._splitRoot=function(a,b){this.data=n([a,b],!1);this.data.height=a.height+1;l(this.data,this.toBBox)};d.prototype._chooseSplitIndex=
function(a,d,e){var f,g,h;f=g=Infinity;for(var k=d;k<=e-d;k++){var l=b(a,0,k,this.toBBox),m=b(a,k,e,this.toBBox),p;p=Math.max(0,Math.min(l.maxX,m.maxX)-Math.max(l.minX,m.minX))*Math.max(0,Math.min(l.maxY,m.maxY)-Math.max(l.minY,m.minY));l=c(l)+c(m);p<f?(f=p,h=k,g=l<g?l:g):p===f&&l<g&&(g=l,h=k)}return h};d.prototype._chooseSplitAxis=function(a,b,c){var d=a.leaf?this.compareMinX:e,f=a.leaf?this.compareMinY:k,g=this._allDistMargin(a,b,c,d);b=this._allDistMargin(a,b,c,f);g<b&&a.children.sort(d)};d.prototype._allDistMargin=
function(c,d,e,g){c.children.sort(g);g=this.toBBox;for(var h=b(c,0,d,g),k=b(c,e-d,e,g),l=a(h)+a(k),m=d;m<e-d;m++){var p=c.children[m];f(h,c.leaf?g(p):p);l+=a(h)}for(m=e-d-1;m>=d;m--)p=c.children[m],f(k,c.leaf?g(p):p),l+=a(k);return l};d.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)f(b.data[c],a)};d.prototype._condense=function(a){for(var b=a.length-1,c=void 0;0<=b;b--)0===a.data[b].children.length?0<b?(c=a.data[b-1].children,c.splice(c.indexOf(a.data[b]),1)):this.clear():l(a.data[b],
this.toBBox)};d.prototype._initFormat=function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")};return d}();d.PooledRBush=t;var v=new q,r=new q,y=new q,w=new q({deallocator:null});d.default=t})},"esri/views/3d/layers/support/attributeUtils":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,
"__esModule",{value:!0});d.attributeLookup=function(d,g){g=g.toLowerCase();for(var l=0,b=Object.keys(d);l<b.length;l++){var f=b[l];if(f.toLowerCase()===g)return d[f]}return null}})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["require","exports","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});d.toViewIfLocal=function(b){var d=
b.view.spatialReference,e=b.layer.fullExtent,k=e&&e.spatialReference;return k?k.equals(d)?q.resolve(e.clone()):g.canProject(k,d)?q.resolve(g.project(e,d)):b.view.state.isLocal?l.projectGeometry(e,d,b.layer.portalItem).then(function(c){if(!b.destroyed&&c)return c}).catch(function(){return null}):q.resolve(null):q.resolve(null)}})},"esri/views/3d/support/EventedSet":function(){define("require exports ../../../core/tsSupport/extendsHelper @dojo/framework/shim/array @dojo/framework/shim/Set ./Evented".split(" "),
function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function d(){var d=null!==b&&b.apply(this,arguments)||this;d._set=new l.default;return d}q(d,b);d.prototype.clear=function(){if(0<this._set.size){var b=this.toArray();this._set.clear();this.emit("change",{added:[],removed:b})}};Object.defineProperty(d.prototype,"length",{get:function(){return this._set.size},enumerable:!0,configurable:!0});d.prototype.addMany=function(b){if(0!==b.length){for(var c=0;c<b.length;c++)this._set.add(b[c]);
this.emit("change",{added:b,removed:[]})}};d.prototype.removeMany=function(b){for(var c=[],a=0;a<b.length;a++){var d=b[a];this._set.delete(d)&&c.push(d)}0<c.length&&this.emit("change",{added:[],removed:c})};d.prototype.toArray=function(){return g.from(this._set)};d.prototype.find=function(b){for(var c=this._set.entries(),a=c.next();!a.done;a=c.next())if(b(a.value[0]))return a.value[0]};d.prototype.forEach=function(b){this._set.forEach(function(c){return b(c)})};return d}(b.Evented);d.EventedSet=t})},
"esri/views/layers/FeatureLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper @dojo/framework/shim/array @dojo/framework/shim/Set ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/support/fieldUtils ../../support/arcadeUtils ./RefreshableLayerView ./support/FeatureEffect ./support/FeatureFilter ./support/popupUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x){var A=a.getLogger("esri.views.layers.FeatureLayerView");return function(a){function d(b){b=a.call(this,b)||this;b.effect=null;b.filter=null;b.layer=null;b.requiredFields=null;b.view=null;return b}q(d,a);d.prototype.initialize=function(){var a=this;n.init(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","filter","effect"],function(){return a._updateRequiredFields()})};Object.defineProperty(d.prototype,"availableFields",
{get:function(){var a=this.layer,b=this.layer.fields,c=this.requiredFields;return"outFields"in a&&a.outFields?v.fixFields(b,v.unpackFieldNames(b,a.outFields).concat(c)):v.fixFields(b,c)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(a){A.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maximumNumberOfFeaturesExceeded",
{get:function(){return!1},enumerable:!0,configurable:!0});d.prototype.highlight=function(a,b){void 0===b&&(b={});return this.inherited(arguments)};d.prototype.queryFeatures=function(a){return this.inherited(arguments)};d.prototype.queryObjectIds=function(a){return this.inherited(arguments)};d.prototype.queryFeatureCount=function(a){return this.inherited(arguments)};d.prototype.queryExtent=function(a){return this.inherited(arguments)};d.prototype._updateRequiredFields=function(){return f(this,void 0,
void 0,function(){var a,c,d,f,g,h,l,m,n,q,r,u,t;return b(this,function(b){switch(b.label){case 0:if(!this.layer||!this.view)return[2];a="3d"===this.view.type;c=this;f=d=c.layer;g=f.fields;h=f.objectIdField;l=f.renderer;m=new k.default;return[4,p.eachAlways([l?l.collectRequiredFields(m,g):null,v.collectLabelingFields(m,d),a?v.collectElevationFields(m,d):null,this.filter?v.collectFilterFields(m,d,this.filter):null,this.effect?v.collectFilterFields(m,d,this.effect.filter):null])];case 1:n=b.sent();q=
0;for(r=n;q<r.length;q++)u=r[q],u.error&&A.error(u.error);v.collectField(m,g,h);t=e.from(m).sort();this._set("requiredFields",t);return[2]}})})};d.prototype.validateFetchPopupFeatures=function(a){var b=this.layer;if(!this.layer.popupEnabled)return new c("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:b});if(!x.getFetchPopupTemplate(this.layer,a))return new c("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:b})};d.prototype.fetchClientPopupFeatures=
function(a){return f(this,void 0,void 0,function(){var c,d,e,f,g,k,l,m,n,q,u;return b(this,function(b){switch(b.label){case 0:c=h.isSome(a)?a.clientGraphics:null;if(!c||0===c.length)return[2,p.resolve([])];d=[];e=[];f=this.layer;g=x.getFetchPopupTemplate(f,a);if(!h.isSome(g))return[2,p.resolve([])];k=r.hasGeometryOperations(g);return[4,this.createPopupQuery(a)];case 1:l=b.sent();m=v.unpackFieldNames(f.fields,l.outFields);n=0;for(q=c;n<q.length;n++)u=q[n],k||!v.featureHasFields(m,u)?e.push(u):d.push(u);
if(0===e.length)return[2,p.resolve(d)];l.objectIds=e.map(function(a){return a.attributes[f.objectIdField]});return[2,f.queryFeatures(l).then(function(a){return d.concat(a.features)}).catch(function(){return e})]}})})};d.prototype.createPopupQuery=function(a){return f(this,void 0,void 0,function(){var c,d,e;return b(this,function(b){switch(b.label){case 0:return c=this.layer,d=c.createQuery(),d.returnGeometry=!0,d.returnZ=!0,d.returnM=!0,e=d,[4,x.getRequiredFields(this.layer,x.getFetchPopupTemplate(this.layer,
a))];case 1:return e.outFields=b.sent(),d.outSpatialReference=this.view.spatialReference,[2,d]}})})};g([u.property({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],d.prototype,"availableFields",null);g([u.property({type:w})],d.prototype,"effect",void 0);g([u.property({type:m})],d.prototype,"filter",void 0);g([u.property()],d.prototype,"layer",void 0);g([u.property({type:Number})],d.prototype,"maximumNumberOfFeatures",null);g([u.property({readOnly:!0,type:Boolean})],d.prototype,"maximumNumberOfFeaturesExceeded",
null);g([u.property({readOnly:!0})],d.prototype,"requiredFields",void 0);g([u.property()],d.prototype,"view",void 0);return d=g([u.subclass("esri.views.layers.FeatureLayerView")],d)}(u.declared(y))})},"esri/views/layers/RefreshableLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(t,d,q,g,l,b){return function(d){function e(){var b=null!==d&&d.apply(this,
arguments)||this;b.refreshTimestamp=null;return b}q(e,d);e.prototype.refresh=function(b){void 0===b&&(b=Date.now());this._set("refreshTimestamp",b);this.doRefresh&&this.doRefresh()};g([b.property()],e.prototype,"layer",void 0);g([b.aliasOf("layer.refreshInterval")],e.prototype,"refreshInterval",void 0);g([b.property({readOnly:!0})],e.prototype,"refreshTimestamp",void 0);return e=g([b.subclass("esri.layers.mixins.RefreshableLayerView")],e)}(b.declared(l))})},"esri/views/layers/support/FeatureEffect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ./FeatureFilter ./ParsedFeatureEffect ./Transition".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){var h=b.getLogger("esri.views.layers.support.FeatureEffect");return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.filter=null;a.includedEffect=null;a.excludedEffect=null;a.excludedLabelsVisible=!1;return a}g(d,b);l=d;Object.defineProperty(d.prototype,"insideEffect",{get:function(){h.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");return this.includedEffect},set:function(a){h.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");
this.includedEffect=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"outsideEffect",{get:function(){h.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");return this.excludedEffect},set:function(a){h.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");this.excludedEffect=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"parsedIncludedEffect",{get:function(){return f.isSome(this.includedEffect)?
"string"===typeof this.includedEffect?c.fromString(this.includedEffect):new a({from:c.fromString(this.includedEffect.from),to:c.fromString(this.includedEffect.to),duration:this.includedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"parsedExcludedEffect",{get:function(){return f.isSome(this.excludedEffect)?"string"===typeof this.excludedEffect?c.fromString(this.excludedEffect):new a({from:c.fromString(this.excludedEffect.from),to:c.fromString(this.excludedEffect.to),
duration:this.excludedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderingHash",{get:function(){return this.excludedLabelsVisible+"-"+this.includedEffect+"-"+this.excludedEffect},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"done",{get:function(){return(!f.isSome(this.parsedIncludedEffect)||this.parsedIncludedEffect.done)&&(!f.isSome(this.parsedExcludedEffect)||this.parsedExcludedEffect.done)},enumerable:!0,configurable:!0});d.prototype.clone=
function(){return new l({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};var l;q([e.property({type:k})],d.prototype,"filter",void 0);q([e.property({type:String})],d.prototype,"includedEffect",void 0);q([e.property({type:String})],d.prototype,"excludedEffect",void 0);q([e.property({type:Boolean})],d.prototype,"excludedLabelsVisible",void 0);q([e.property({dependsOn:["includedEffect"]})],
d.prototype,"parsedIncludedEffect",null);q([e.property({dependsOn:["excludedEffect"]})],d.prototype,"parsedExcludedEffect",null);q([e.property({dependsOn:["includedEffect","excludedEffect"]})],d.prototype,"renderingHash",null);return d=l=q([e.subclass("esri.views.layers.support.FeatureEffect")],d)}(e.declared(l))})},"esri/views/layers/support/FeatureFilter":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper @dojo/framework/shim/array @dojo/framework/shim/Set ../../../geometry ../../../TimeExtent ../../../core/JSONSupport ../../../core/kebabDictionary ../../../core/lang ../../../core/accessorSupport/decorators ../../../geometry/support/jsonUtils ../../../tasks/support/Query".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u){var v=new a.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),r=new a.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(a){function c(b){b=a.call(this,b)||this;b.where=null;b.geometry=null;b.spatialRelationship="intersects";b.hiddenIds=new f.default;b.distance=void 0;b.objectIds=null;b.units=null;b.timeExtent=null;b.enabled=!1;return b}g(c,a);d=c;c.prototype.writeWhere=function(a,b,c){b.where=a||"1\x3d1"};c.prototype.enable=function(){this._set("enabled",!0)};
c.prototype.createQuery=function(a){void 0===a&&(a={});var b=this.where,c=this.spatialRelationship,d=this.timeExtent,e=this.objectIds;return new u(l({geometry:h.clone(this.geometry),objectIds:h.clone(e),spatialRelationship:c,timeExtent:h.clone(d),where:b},a))};c.prototype.clone=function(){var a=this.where,b=this.geometry,c=this.spatialRelationship,e=this.hiddenIds,g=this.timeExtent,k=this.objectIds,l=new f.default;e.forEach(function(a){return l.add(a)});return new d({geometry:h.clone(b),hiddenIds:l,
objectIds:h.clone(k),spatialRelationship:c,timeExtent:h.clone(g),where:a})};var d;q([p.property({type:String})],c.prototype,"where",void 0);q([p.writer("where")],c.prototype,"writeWhere",null);q([p.property({types:e.geometryTypes,json:{read:n.fromJSON,write:!0}})],c.prototype,"geometry",void 0);q([p.property({type:String,json:{read:{source:"spatialRel",reader:v.read},write:{target:"spatialRel",writer:v.write}}})],c.prototype,"spatialRelationship",void 0);q([p.property({json:{write:function(a,c,d){return c[d]=
b.from(a)},read:function(a,b){return new f.default(a)}}})],c.prototype,"hiddenIds",void 0);q([p.property({type:Number,json:{write:{overridePolicy:function(a){return{enabled:0<a}}}}})],c.prototype,"distance",void 0);q([p.property({type:[Number],json:{write:!0}})],c.prototype,"objectIds",void 0);q([p.property({type:String,json:{read:r.read,write:{writer:r.write,overridePolicy:function(a){return{enabled:a&&0<this.distance}}}}})],c.prototype,"units",void 0);q([p.property({type:k,json:{write:!0}})],c.prototype,
"timeExtent",void 0);q([p.property({readOnly:!0})],c.prototype,"enabled",void 0);return c=d=q([p.subclass("esri.views.layers.support.FeatureFilter")],c)}(p.declared(c))})},"esri/views/layers/support/ParsedFeatureEffect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/JSONSupport ../../../core/Logger ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f32 ./cssFilterParser".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){var p=e.getLogger("esri.views.layers.support.ParsedFeatureEffect"),n={grayscale:function(b){b=1-b.amount;b=a.mat4f32.fromValues(.2126+.7874*b,.7152-.7152*b,.0722-.0722*b,0,.2126-.2126*b,.7152+.2848*b,.0722-.0722*b,0,.2126-.2126*b,.7152-.7152*b,.0722+.9278*b,0,0,0,0,1);return c.mat4.transpose(b,b)},sepia:function(b){b=1-b.amount;b=a.mat4f32.fromValues(.393+.607*b,.769-.769*b,.189-.189*b,0,.349-.349*b,.686+.314*b,.168-.168*b,0,.272-.272*b,.534-.534*b,.131+.869*b,0,
0,0,0,1);return c.mat4.transpose(b,b)},saturate:function(b){b=b.amount;b=a.mat4f32.fromValues(.213+.787*b,.715-.715*b,.072-.072*b,0,.213-.213*b,.715+.285*b,.072-.072*b,0,.213-.213*b,.715-.715*b,.072+.928*b,0,0,0,0,1);return c.mat4.transpose(b,b)},"hue-rotate":function(b){var d=Math.sin(b.angle*Math.PI/180);b=Math.cos(b.angle*Math.PI/180);d=a.mat4f32.fromValues(.213+.787*b-.213*d,.715-.715*b-.715*d,.072-.072*b+.928*d,0,.213-.213*b+.143*d,.715+.285*b+.14*d,.072-.072*b-.283*d,0,.213-.213*b-.787*d,.715-
.715*b+.715*d,.072+.928*b+.072*d,0,0,0,0,1);return c.mat4.transpose(d,d)},invert:function(b){b=b.amount;b=a.mat4f32.fromValues(-b,0,0,1,0,-b,0,1,0,0,-b,1,0,0,0,1);return c.mat4.transpose(b,b)},opacity:function(b){b=b.amount;b=a.mat4f32.fromValues(b,0,0,0,0,b,0,0,0,0,b,0,0,0,0,b);return c.mat4.transpose(b,b)},brightness:function(b){b=b.amount;b=a.mat4f32.fromValues(b,0,0,0,0,b,0,0,0,0,b,0,0,0,0,1);return c.mat4.transpose(b,b)},contrast:function(b){b=b.amount;b=a.mat4f32.fromValues(b,0,0,.5-.5*b,0,
b,0,.5-.5*b,0,0,b,.5-.5*b,0,0,0,1);return c.mat4.transpose(b,b)}};return function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;a.customTransforms=null;a.done=!0;return a}g(e,d);f=e;e.fromString=function(a){var c;try{c=h.parse(a)}catch(m){p.error(new b("invalid-type","Encountered an error when parsing css",m))}return new f({transforms:c})};e.prototype.getColorMatrix=function(){var b=this;return(this.transforms||[]).map(function(a){return l({},a)}).reverse().reduce(function(a,d){return c.mat4.multiply(a,
a,b._getFactory(d)(d))},a.mat4f32.create())};e.prototype.clone=function(){return new f({transforms:this.transforms&&this.transforms.map(function(a){return l({},a)}),customTransforms:this.customTransforms&&this.customTransforms.map(function(a){return l({},a)})})};e.prototype._getFactory=function(b){var d=n[b.type];if(!d){if(this.customTransforms)for(var d=function(d){if(d.type===b.type){d=a.mat4f32.fromValues.apply(a.mat4f32,d.matrix);var e=c.mat4.transpose(d,d);return{value:function(a){return e}}}},
e=0,f=this.customTransforms;e<f.length;e++){var g=d(f[e]);if("object"===typeof g)return g.value}p.error("invalid-type","No effect "+b.type+" exists");return function(b){return a.mat4f32.create()}}return d};var f;q([k.property()],e.prototype,"transforms",void 0);q([k.property()],e.prototype,"customTransforms",void 0);return e=f=q([k.subclass("esri.views.layers.support.ParsedFeatureEffect")],e)}(k.declared(f))})},"esri/views/layers/support/cssFilterParser":function(){define([],function(){function t(d,
q,g,l){this.message=d;this.expected=q;this.found=g;this.location=l;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}(function(d,q){function g(){this.constructor=d}g.prototype=q.prototype;d.prototype=new g})(t,Error);t.buildMessage=function(d,q){function g(b){return b.charCodeAt(0).toString(16).toUpperCase()}function l(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,
"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+g(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+g(b)})}function b(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+g(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+g(b)})}var f={literal:function(b){return'"'+l(b.text)+'"'},"class":function(d){var e=
"",c;for(c=0;c<d.parts.length;c++)e+=d.parts[c]instanceof Array?b(d.parts[c][0])+"-"+b(d.parts[c][1]):b(d.parts[c]);return"["+(d.inverted?"^":"")+e+"]"},any:function(b){return"any character"},end:function(b){return"end of input"},other:function(b){return b.description}};return"Expected "+function(b){var d=Array(b.length),c;for(c=0;c<b.length;c++){var a=c,e;e=b[c];e=f[e.type](e);d[a]=e}d.sort();if(0<d.length){for(b=c=1;c<d.length;c++)d[c-1]!==d[c]&&(d[b]=d[c],b++);d.length=b}switch(d.length){case 1:return d[0];
case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}(d)+" but "+(q?'"'+l(q)+'"':"end of input")+" found."};return{SyntaxError:t,parse:function(d,q){function g(a,b){return{type:"literal",text:a,ignoreCase:b}}function l(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function b(a){return{type:"other",description:a}}function f(a){var b=yb[a],c;if(!b){for(c=a-1;!yb[c];)c--;b=yb[c];for(b={line:b.line,column:b.column};c<a;)10===d.charCodeAt(c)?(b.line++,
b.column=1):b.column++,c++;yb[a]=b}return b}function e(a,b){var c=f(a),d=f(b);return{start:{offset:a,line:c.line,column:c.column},end:{offset:b,line:d.line,column:d.column}}}function k(a){H<Va||(H>Va&&(Va=H,eb=[]),eb.push(a))}function c(){var b,c;ca++;b=H;c=w();c!==m?(d.substr(H,4)===B?(c=B,H+=4):(c=m,0===ca&&k(E)),c!==m?(c=w(),c!==m?(ra=b,b=null):(H=b,b=m)):(H=b,b=m)):(H=b,b=m);ca--;b===m&&(c=m,0===ca&&k(C));if(b===m)if(b=[],c=a(),c!==m)for(;c!==m;)b.push(c),c=a();else b=m;return b}function a(){var a,
b,c,f,g,l,q,r,x;ca++;b=H;c=w();c!==m?(d.substr(H,5)===G?(f=G,H+=5):(f=m,0===ca&&k(L)),f!==m?(g=w(),g!==m?(l=v(),l!==m?(q=w(),q!==m?(41===d.charCodeAt(H)?(r=F,H++):(r=m,0===ca&&k(K)),r!==m?(x=w(),x!==m?(ra=b,b=c={type:"blur",radius:l}):(H=b,b=m)):(H=b,b=m)):(H=b,b=m)):(H=b,b=m)):(H=b,b=m)):(H=b,b=m)):(H=b,b=m);ca--;b===m&&(c=m,0===ca&&k(I));a=b;if(a===m){var A,z,C,B,E,mb,lb,Hb;ca++;A=H;z=w();z!==m?(d.substr(H,11)===Q?(C=Q,H+=11):(C=m,0===ca&&k(P)),C!==m?(B=w(),B!==m?(E=h(),E!==m?(mb=w(),mb!==m?(41===
d.charCodeAt(H)?(lb=F,H++):(lb=m,0===ca&&k(K)),lb!==m?(Hb=w(),Hb!==m?(ra=A,A=z={type:"brightness",amount:E}):(H=A,A=m)):(H=A,A=m)):(H=A,A=m)):(H=A,A=m)):(H=A,A=m)):(H=A,A=m)):(H=A,A=m);ca--;A===m&&(z=m,0===ca&&k(M));a=A;if(a===m){var Da,nb,zb,Ib,Ua,Lb,oa,Jb;ca++;Da=H;nb=w();nb!==m?(d.substr(H,9)===U?(zb=U,H+=9):(zb=m,0===ca&&k(N)),zb!==m?(Ib=w(),Ib!==m?(Ua=h(),Ua!==m?(Lb=w(),Lb!==m?(41===d.charCodeAt(H)?(oa=F,H++):(oa=m,0===ca&&k(K)),oa!==m?(Jb=w(),Jb!==m?(ra=Da,Da=nb={type:"contrast",amount:Ua}):
(H=Da,Da=m)):(H=Da,Da=m)):(H=Da,Da=m)):(H=Da,Da=m)):(H=Da,Da=m)):(H=Da,Da=m)):(H=Da,Da=m);ca--;Da===m&&(nb=m,0===ca&&k(O));a=Da;if(a===m){var la,wb,ta,Tb,Mb,Ba,ya,Xa,hb,Sa,Ya,Ab,tb,Fb;ca++;la=H;wb=w();if(wb!==m)if(d.substr(H,12)===X?(ta=X,H+=12):(ta=m,0===ca&&k(J)),ta!==m)if(Tb=w(),Tb!==m)if(Mb=v(),Mb!==m)if(Ba=w(),Ba!==m)if(ya=v(),ya!==m)if(Xa=w(),Xa!==m)if(hb=v(),hb===m&&(hb=null),hb!==m)if(Sa=w(),Sa!==m){var S,Aa,ua,za,xa,Fa,Na,Ha,Ka,Oa,Ga,La,Ta,wa,Ia,sb,Va,kb;S=H;35===d.charCodeAt(H)?(Aa=Rb,H++):
(Aa=m,0===ca&&k(Wb));if(Aa!==m)if(ua=H,za=y(),za!==m?(xa=y(),xa!==m?ua=za=[za,xa]:(H=ua,ua=m)):(H=ua,ua=m),ua!==m)if(za=H,xa=y(),xa!==m?(Fa=y(),Fa!==m?za=xa=[xa,Fa]:(H=za,za=m)):(H=za,za=m),za!==m)if(xa=H,Fa=y(),Fa!==m?(Na=y(),Na!==m?xa=Fa=[Fa,Na]:(H=xa,xa=m)):(H=xa,xa=m),xa!==m){ra=S;var cc=za,rb=xa;S=Aa=[parseInt(ua.join(""),16),parseInt(cc.join(""),16),parseInt(rb.join(""),16)]}else H=S,S=m;else H=S,S=m;else H=S,S=m;else H=S,S=m;if(S===m){S=H;35===d.charCodeAt(H)?(Aa=Rb,H++):(Aa=m,0===ca&&k(Wb));
if(Aa!==m)if(ua=y(),ua!==m)if(za=y(),za!==m)if(xa=y(),xa!==m){ra=S;var xb=za,Kb=xa;S=Aa=[parseInt([ua,ua].join(""),16),parseInt([xb,xb].join(""),16),parseInt([Kb,Kb].join(""),16)]}else H=S,S=m;else H=S,S=m;else H=S,S=m;else H=S,S=m;if(S===m&&(S=H,d.substr(H,5)===qb?(Aa=qb,H+=5):(Aa=m,0===ca&&k(Sb)),Aa!==m?(ua=w(),ua!==m?(za=n(),za!==m?(xa=w(),xa!==m?(44===d.charCodeAt(H)?(Fa=Ra,H++):(Fa=m,0===ca&&k(db)),Fa!==m?(Na=w(),Na!==m?(Ha=n(),Ha!==m?(Ka=w(),Ka!==m?(44===d.charCodeAt(H)?(Oa=Ra,H++):(Oa=m,0===
ca&&k(db)),Oa!==m?(Ga=w(),Ga!==m?(La=n(),La!==m?(Ta=w(),Ta!==m?(44===d.charCodeAt(H)?(wa=Ra,H++):(wa=m,0===ca&&k(db)),wa!==m?(Ia=w(),Ia!==m?(sb=h(),sb!==m?(Va=w(),Va!==m?(41===d.charCodeAt(H)?(kb=F,H++):(kb=m,0===ca&&k(K)),kb!==m?(ra=S,S=Aa=[255*za,255*Ha,255*La,sb]):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m),S===m&&(S=H,d.substr(H,5)===qb?(Aa=qb,H+=5):(Aa=
m,0===ca&&k(Sb)),Aa!==m?(ua=w(),ua!==m?(za=p(),za!==m?(xa=w(),xa!==m?(44===d.charCodeAt(H)?(Fa=Ra,H++):(Fa=m,0===ca&&k(db)),Fa!==m?(Na=w(),Na!==m?(Ha=p(),Ha!==m?(Ka=w(),Ka!==m?(44===d.charCodeAt(H)?(Oa=Ra,H++):(Oa=m,0===ca&&k(db)),Oa!==m?(Ga=w(),Ga!==m?(La=p(),La!==m?(44===d.charCodeAt(H)?(Ta=Ra,H++):(Ta=m,0===ca&&k(db)),Ta!==m?(wa=w(),wa!==m?(Ia=h(),Ia!==m?(41===d.charCodeAt(H)?(sb=F,H++):(sb=m,0===ca&&k(K)),sb!==m?(ra=S,S=Aa=[za,Ha,La,Ia]):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):
(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m),S===m&&(S=H,d.substr(H,5)===qb?(Aa=qb,H+=5):(Aa=m,0===ca&&k(Sb)),Aa!==m?(ua=w(),ua!==m?(za=n(),za!==m?(xa=w(),xa!==m?(44===d.charCodeAt(H)?(Fa=Ra,H++):(Fa=m,0===ca&&k(db)),Fa!==m?(Na=w(),Na!==m?(Ha=n(),Ha!==m?(Ka=w(),Ka!==m?(44===d.charCodeAt(H)?(Oa=Ra,H++):(Oa=m,0===ca&&k(db)),Oa!==m?(Ga=w(),Ga!==m?(La=n(),La!==m?(Ta=w(),Ta!==m?(41===d.charCodeAt(H)?(wa=F,H++):(wa=m,0===ca&&k(K)),wa!==m?(ra=
S,S=Aa=[255*za,255*Ha,255*La,1]):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m),S===m&&(S=H,d.substr(H,5)===qb?(Aa=qb,H+=5):(Aa=m,0===ca&&k(Sb)),Aa!==m?(ua=w(),ua!==m?(za=p(),za!==m?(xa=w(),xa!==m?(44===d.charCodeAt(H)?(Fa=Ra,H++):(Fa=m,0===ca&&k(db)),Fa!==m?(Na=w(),Na!==m?(Ha=p(),Ha!==m?(Ka=w(),Ka!==m?(44===d.charCodeAt(H)?(Oa=Ra,H++):(Oa=m,0===ca&&k(db)),Oa!==m?(Ga=w(),Ga!==m?(La=p(),La!==m?(41===d.charCodeAt(H)?
(Ta=F,H++):(Ta=m,0===ca&&k(K)),Ta!==m?(ra=S,S=Aa=[za,Ha,La,1]):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m),S===m&&(S=H,d.substr(H,4)===Xb?(Aa=Xb,H+=4):(Aa=m,0===ca&&k(kc)),Aa!==m?(ua=w(),ua!==m?(za=n(),za!==m?(xa=w(),xa!==m?(44===d.charCodeAt(H)?(Fa=Ra,H++):(Fa=m,0===ca&&k(db)),Fa!==m?(Na=w(),Na!==m?(Ha=n(),Ha!==m?(Ka=w(),Ka!==m?(44===d.charCodeAt(H)?(Oa=Ra,H++):(Oa=m,0===ca&&k(db)),Oa!==m?(Ga=w(),Ga!==m?(La=n(),
La!==m?(Ta=w(),Ta!==m?(41===d.charCodeAt(H)?(wa=F,H++):(wa=m,0===ca&&k(K)),wa!==m?(ra=S,S=Aa=[255*za,255*Ha,255*La,1]):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m),S===m&&(S=H,d.substr(H,4)===Xb?(Aa=Xb,H+=4):(Aa=m,0===ca&&k(kc)),Aa!==m?(ua=w(),ua!==m?(za=p(),za!==m?(xa=w(),xa!==m?(44===d.charCodeAt(H)?(Fa=Ra,H++):(Fa=m,0===ca&&k(db)),Fa!==m?(Na=w(),Na!==m?(Ha=p(),Ha!==m?(Ka=w(),Ka!==m?(44===d.charCodeAt(H)?
(Oa=Ra,H++):(Oa=m,0===ca&&k(db)),Oa!==m?(Ga=w(),Ga!==m?(La=p(),La!==m?(Ta=w(),Ta!==m?(41===d.charCodeAt(H)?(wa=F,H++):(wa=m,0===ca&&k(K)),wa!==m?(ra=S,S=Aa=[za,Ha,La,1]):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m)):(H=S,S=m),S===m))))))){var Nb,eb,Pb;ca++;Nb=H;eb=[];Lc.test(d.charAt(H))?(Pb=d.charAt(H),H++):(Pb=m,0===ca&&k(Mc));if(Pb!==m)for(;Pb!==m;)eb.push(Pb),Lc.test(d.charAt(H))?(Pb=d.charAt(H),H++):(Pb=m,0===
ca&&k(Mc));else eb=m;if(eb!==m){ra=Nb;var Qb=d.substring(ra,H);if(!mc.has(Qb)){var D='unknown color "'+Qb+'"',ub=void 0,ub=void 0!==ub?ub:e(ra,H);throw new t(D,null,null,ub);}eb=dc[Qb].concat(1)}Nb=eb;ca--;Nb===m&&(eb=m,0===ca&&k(td));S=Nb}}Ya=S;Ya===m&&(Ya=null);Ya!==m?(Ab=w(),Ab!==m?(41===d.charCodeAt(H)?(tb=F,H++):(tb=m,0===ca&&k(K)),tb!==m?(Fb=w(),Fb!==m?(ra=la,la=wb={type:"drop-shadow",offsetX:Mb,offsetY:ya,blurRadius:hb,color:Ya}):(H=la,la=m)):(H=la,la=m)):(H=la,la=m)):(H=la,la=m)}else H=la,
la=m;else H=la,la=m;else H=la,la=m;else H=la,la=m;else H=la,la=m;else H=la,la=m;else H=la,la=m;else H=la,la=m;else H=la,la=m;ca--;la===m&&(wb=m,0===ca&&k(V));a=la;if(a===m){var Ca,ob,ba,Gb,yb,Dd,ld,Ed;ca++;Ca=H;ob=w();ob!==m?(d.substr(H,10)===T?(ba=T,H+=10):(ba=m,0===ca&&k(W)),ba!==m?(Gb=w(),Gb!==m?(yb=h(),yb!==m?(Dd=w(),Dd!==m?(41===d.charCodeAt(H)?(ld=F,H++):(ld=m,0===ca&&k(K)),ld!==m?(Ed=w(),Ed!==m?(ra=Ca,Ca=ob={type:"grayscale",amount:yb}):(H=Ca,Ca=m)):(H=Ca,Ca=m)):(H=Ca,Ca=m)):(H=Ca,Ca=m)):(H=
Ca,Ca=m)):(H=Ca,Ca=m)):(H=Ca,Ca=m);ca--;Ca===m&&(ob=m,0===ca&&k(R));a=Ca;if(a===m){var Za,Jc,md,Fd,nd,Gd,od,Hd;ca++;Za=H;Jc=w();if(Jc!==m)if(d.substr(H,11)===fa?(md=fa,H+=11):(md=m,0===ca&&k(ga)),md!==m)if(Fd=w(),Fd!==m){var ib,$b,ec;ca++;ib=H;var Vb,fc,Id;ca++;Vb=H;Wa.test(d.charAt(H))?(fc=d.charAt(H),H++):(fc=m,0===ca&&k(fb));fc===m&&(fc=null);fc!==m?(Id=p(),Id!==m?(ra=Vb,Vb=fc=parseFloat(d.substring(ra,H))):(H=Vb,Vb=m)):(H=Vb,Vb=m);ca--;Vb===m&&(fc=m,0===ca&&k(Pa));$b=Vb;$b!==m?(ec=u(),ec!==m?
(ra=ib,ib=$b*=ec):(H=ib,ib=m)):(H=ib,ib=m);ib===m&&(ib=H,48===d.charCodeAt(H)?($b=Qa,H++):($b=m,0===ca&&k(gb)),$b!==m?(ec=u(),ec===m&&(ec=null),ec!==m?(ra=ib,ib=$b=0):(H=ib,ib=m)):(H=ib,ib=m));ca--;ib===m&&($b=m,0===ca&&k(vb));nd=ib;nd!==m?(Gd=w(),Gd!==m?(41===d.charCodeAt(H)?(od=F,H++):(od=m,0===ca&&k(K)),od!==m?(Hd=w(),Hd!==m?(ra=Za,Za=Jc={type:"hue-rotate",angle:nd}):(H=Za,Za=m)):(H=Za,Za=m)):(H=Za,Za=m)):(H=Za,Za=m)}else H=Za,Za=m;else H=Za,Za=m;else H=Za,Za=m;ca--;Za===m&&(Jc=m,0===ca&&k(Z));
a=Za;if(a===m){var $a,Kc,pd,Jd,qd,Kd,rd,Ld;ca++;$a=H;Kc=w();Kc!==m?(d.substr(H,7)===ia?(pd=ia,H+=7):(pd=m,0===ca&&k(ka)),pd!==m?(Jd=w(),Jd!==m?(qd=h(),qd!==m?(Kd=w(),Kd!==m?(41===d.charCodeAt(H)?(rd=F,H++):(rd=m,0===ca&&k(K)),rd!==m?(Ld=w(),Ld!==m?(ra=$a,$a=Kc={type:"invert",amount:qd}):(H=$a,$a=m)):(H=$a,$a=m)):(H=$a,$a=m)):(H=$a,$a=m)):(H=$a,$a=m)):(H=$a,$a=m)):(H=$a,$a=m);ca--;$a===m&&(Kc=m,0===ca&&k(ja));a=$a;if(a===m){var ab,Nc,sd,Md,ud,Nd,vd,Od;ca++;ab=H;Nc=w();Nc!==m?(d.substr(H,8)===Y?(sd=
Y,H+=8):(sd=m,0===ca&&k(ha)),sd!==m?(Md=w(),Md!==m?(ud=h(),ud!==m?(Nd=w(),Nd!==m?(41===d.charCodeAt(H)?(vd=F,H++):(vd=m,0===ca&&k(K)),vd!==m?(Od=w(),Od!==m?(ra=ab,ab=Nc={type:"opacity",amount:ud}):(H=ab,ab=m)):(H=ab,ab=m)):(H=ab,ab=m)):(H=ab,ab=m)):(H=ab,ab=m)):(H=ab,ab=m)):(H=ab,ab=m);ca--;ab===m&&(Nc=m,0===ca&&k(da));a=ab;if(a===m){var bb,Oc,wd,Pd,xd,Qd,yd,Rd;ca++;bb=H;Oc=w();Oc!==m?(d.substr(H,9)===ma?(wd=ma,H+=9):(wd=m,0===ca&&k(aa)),wd!==m?(Pd=w(),Pd!==m?(xd=h(),xd!==m?(Qd=w(),Qd!==m?(41===d.charCodeAt(H)?
(yd=F,H++):(yd=m,0===ca&&k(K)),yd!==m?(Rd=w(),Rd!==m?(ra=bb,bb=Oc={type:"saturate",amount:xd}):(H=bb,bb=m)):(H=bb,bb=m)):(H=bb,bb=m)):(H=bb,bb=m)):(H=bb,bb=m)):(H=bb,bb=m)):(H=bb,bb=m);ca--;bb===m&&(Oc=m,0===ca&&k(ea));a=bb;if(a===m){var cb,Pc,zd,Sd,Ad,Td,Bd,Ud;ca++;cb=H;Pc=w();Pc!==m?(d.substr(H,6)===na?(zd=na,H+=6):(zd=m,0===ca&&k(sa)),zd!==m?(Sd=w(),Sd!==m?(Ad=h(),Ad!==m?(Td=w(),Td!==m?(41===d.charCodeAt(H)?(Bd=F,H++):(Bd=m,0===ca&&k(K)),Bd!==m?(Ud=w(),Ud!==m?(ra=cb,cb=Pc={type:"sepia",amount:Ad}):
(H=cb,cb=m)):(H=cb,cb=m)):(H=cb,cb=m)):(H=cb,cb=m)):(H=cb,cb=m)):(H=cb,cb=m)):(H=cb,cb=m);ca--;cb===m&&(Pc=m,0===ca&&k(qa));a=cb}}}}}}}}}return a}function h(){var a;ca++;a=n();a===m&&(a=p());ca--;a===m&&0===ca&&k(z);return a}function p(){var a,b,c;ca++;a=H;b=[];oa.test(d.charAt(H))?(c=d.charAt(H),H++):(c=m,0===ca&&k(ta));if(c!==m)for(;c!==m;)b.push(c),oa.test(d.charAt(H))?(c=d.charAt(H),H++):(c=m,0===ca&&k(ta));else b=m;if(b!==m)if(46===d.charCodeAt(H)?(c=ya,H++):(c=m,0===ca&&k(Sa)),c!==m){b=[];oa.test(d.charAt(H))?
(c=d.charAt(H),H++):(c=m,0===ca&&k(ta));if(c!==m)for(;c!==m;)b.push(c),oa.test(d.charAt(H))?(c=d.charAt(H),H++):(c=m,0===ca&&k(ta));else b=m;b!==m?(ra=a,a=b=parseFloat(d.substring(ra,H))):(H=a,a=m)}else H=a,a=m;else H=a,a=m;if(a===m){ca++;a=H;b=[];oa.test(d.charAt(H))?(c=d.charAt(H),H++):(c=m,0===ca&&k(ta));if(c!==m)for(;c!==m;)b.push(c),oa.test(d.charAt(H))?(c=d.charAt(H),H++):(c=m,0===ca&&k(ta));else b=m;b!==m&&(ra=a,b=parseInt(d.substring(ra,H),10));a=b;ca--;a===m&&(b=m,0===ca&&k(la))}ca--;a===
m&&(b=m,0===ca&&k(Ba));return a}function n(){var a,b,c;a=H;b=p();b!==m?(37===d.charCodeAt(H)?(c=Ga,H++):(c=m,0===ca&&k(kb)),c!==m?(ra=a,a=b/100):(H=a,a=m)):(H=a,a=m);return a}function u(){var a,b;ca++;a=H;d.substr(H,3)===Ia?(b=Ia,H+=3):(b=m,0===ca&&k(wa));b!==m&&(ra=a,b=1);a=b;a===m&&(a=H,d.substr(H,4)===Ka?(b=Ka,H+=4):(b=m,0===ca&&k(Ua)),b!==m&&(ra=a,b=.9),a=b,a===m&&(a=H,d.substr(H,3)===Da?(b=Da,H+=3):(b=m,0===ca&&k(lb)),b!==m&&(ra=a,b=180/Math.PI),a=b,a===m&&(a=H,d.substr(H,4)===mb?(b=mb,H+=4):
(b=m,0===ca&&k(Hb)),b!==m&&(ra=a,b=1/360),a=b)));ca--;a===m&&(b=m,0===ca&&k(ua));return a}function v(){var a,b,c;ca++;a=H;b=p();b!==m?(c=r(),c!==m?(ra=a,a=b*c):(H=a,a=m)):(H=a,a=m);a===m&&(a=H,48===d.charCodeAt(H)?(b=Qa,H++):(b=m,0===ca&&k(gb)),b!==m?(c=r(),c===m&&(c=null),c!==m?(ra=a,a=0):(H=a,a=m)):(H=a,a=m));ca--;a===m&&(b=m,0===ca&&k(nb));return a}function r(){var a,b;a=H;d.substr(H,2)===zb?(b=zb,H+=2):(b=m,0===ca&&k(Ib));b!==m&&(ra=a,b=1);a=b;a===m&&(a=H,d.substr(H,2)===Lb?(b=Lb,H+=2):(b=m,0===
ca&&k(Jb)),b!==m&&(ra=a,b=96/2.54),a=b,a===m&&(a=H,d.substr(H,2)===wb?(b=wb,H+=2):(b=m,0===ca&&k(Tb)),b!==m&&(ra=a,b=96/2.54/10),a=b,a===m&&(a=H,81===d.charCodeAt(H)?(b=Mb,H++):(b=m,0===ca&&k(hb)),b!==m&&(ra=a,b=96/2.54/40),a=b,a===m&&(a=H,d.substr(H,2)===Ab?(b=Ab,H+=2):(b=m,0===ca&&k(Xa)),b!==m&&(ra=a,b=96),a=b,a===m&&(a=H,d.substr(H,2)===Ya?(b=Ya,H+=2):(b=m,0===ca&&k(sb)),b!==m&&(ra=a,b=16),a=b,a===m&&(a=H,d.substr(H,2)===tb?(b=tb,H+=2):(b=m,0===ca&&k(Qb)),b!==m&&(ra=a,b=96/73),a=b))))));return a}
function y(){var a;cc.test(d.charAt(H))?(a=d.charAt(H),H++):(a=m,0===ca&&k(Kb));return a}function w(){var a,b;ca++;a=[];xb.test(d.charAt(H))?(b=d.charAt(H),H++):(b=m,0===ca&&k(Nb));for(;b!==m;)a.push(b),xb.test(d.charAt(H))?(b=d.charAt(H),H++):(b=m,0===ca&&k(Nb));ca--;a===m&&(b=m,0===ca&&k(Fb));return a}q=void 0!==q?q:{};var m={},x={start:c},A=c,C=b("none"),B="none",E=g("none",!1),I=b("blur()"),G="blur(",L=g("blur(",!1),F=")",K=g(")",!1),M=b("brightness()"),Q="brightness(",P=g("brightness(",!1),O=
b("contrast()"),U="contrast(",N=g("contrast(",!1),V=b("drop-shadow()"),X="drop-shadow(",J=g("drop-shadow(",!1),R=b("grayscale()"),T="grayscale(",W=g("grayscale(",!1),Z=b("hue-rotate()"),fa="hue-rotate(",ga=g("hue-rotate(",!1),ja=b("invert()"),ia="invert(",ka=g("invert(",!1),da=b("opacity()"),Y="opacity(",ha=g("opacity(",!1),ea=b("saturate()"),ma="saturate(",aa=g("saturate(",!1),qa=b("sepia()"),na="sepia(",sa=g("sepia(",!1),z=b("\x3cnumber-percentage\x3e"),la=b("\x3cinteger\x3e"),oa=/^[0-9]/,ta=l([["0",
"9"]],!1,!1),Ba=b("\x3cnumber\x3e"),ya=".",Sa=g(".",!1),Pa=b("\x3csignedNumber\x3e"),Wa=/^[+\-]/,fb=l(["+","-"],!1,!1),Ga="%",kb=g("%",!1),vb=b("\x3cangle\x3e"),Qa="0",gb=g("0",!1),ua=b("\x3cunit\x3e"),Ia="deg",wa=g("deg",!1),Ka="grad",Ua=g("grad",!1),Da="rad",lb=g("rad",!1),mb="turn",Hb=g("turn",!1),nb=b("\x3clength\x3e"),zb="px",Ib=g("px",!1),Lb="cm",Jb=g("cm",!1),wb="mm",Tb=g("mm",!1),Mb="Q",hb=g("Q",!1),Ab="in",Xa=g("in",!1),Ya="pc",sb=g("pc",!1),tb="pt",Qb=g("pt",!1),Rb="#",Wb=g("#",!1),qb="rgba(",
Sb=g("rgba(",!1),Ra=",",db=g(",",!1),Xb="rgb(",kc=g("rgb(",!1),cc=/^[0-9a-fA-F]/,Kb=l([["0","9"],["a","f"],["A","F"]],!1,!1),Fb=b("whitespace"),xb=/^[ \t\n\r]/,Nb=l([" ","\t","\n","\r"],!1,!1),td=b("\x3cnamed-color\x3e"),Lc=/^[a-z]/,Mc=l([["a","z"]],!1,!1),H=0,ra=0,yb=[{line:1,column:1}],Va=0,eb=[],ca=0,rb;if("startRule"in q){if(!(q.startRule in x))throw Error("Can't start parsing from rule \""+q.startRule+'".');A=x[q.startRule]}var dc={transparent:[0,0,0,0],black:[0,0,0],silver:[192,192,192],gray:[128,
128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,
255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,
79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],
khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,
255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,
165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rebeccapurple:[102,51,153],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,
206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]},mc=new Set(Object.keys(dc));rb=A();if(rb!==m&&H===d.length)return rb;rb!==m&&H<d.length&&k({type:"end"});throw function(a,b,c){return new t(t.buildMessage(a,b),a,b,c)}(eb,Va<d.length?
d.charAt(Va):null,Va<d.length?e(Va,Va+1):e(Va,Va));}}})},"esri/views/layers/support/Transition":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4".split(" "),function(t,d,q,g,l,b,f){return function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;a.from=null;a.to=null;a.duration=4E3;a.repeat=!0;a.done=!1;return a}g(e,
d);c=e;e.prototype.getColorMatrix=function(){this.done=!1;if(null==this._lastTime)this._currentStep=0,this._lastTime=Date.now();else{var a=this._lastTime,b=Date.now();this._currentStep+=b-a;2147483647<=this._currentStep&&(this._currentStep=0);this._lastTime=b}var a=this._currentStep%this.duration/(this.duration/2),a=1>=a?a:2-a,b=this.from.getColorMatrix(),c=this.to.getColorMatrix();f.mat4.multiplyScalar(b,b,1-a);f.mat4.multiplyScalar(c,c,a);!this.repeat&&this._currentStep>=this.duration&&(this.done=
!0);return f.mat4.add(b,b,c)};e.prototype.clone=function(){var a=new c({from:this.from.clone(),to:this.to.clone(),duration:this.duration});a._lastTime=this._lastTime;a._currentStep=this._currentStep;return a};var c;q([b.property()],e.prototype,"from",void 0);q([b.property()],e.prototype,"to",void 0);q([b.property({type:Number})],e.prototype,"duration",void 0);q([b.property({type:Boolean})],e.prototype,"repeat",void 0);return e=c=q([b.subclass("esri.views.layers.support.Transition")],e)}(b.declared(l))})},
"esri/views/layers/support/popupUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});d.getRequiredFields=function(d,k){void 0===k&&(k=d.popupTemplate);return g(this,void 0,void 0,function(){var c,a,e,g,n,u,v,r,t,w,m;return q(this,function(h){switch(h.label){case 0:return b.isSome(k)?
[4,k.getRequiredFields(d.fields)]:[2,[]];case 1:c=h.sent();a=k.lastEditInfoEnabled;e=d.objectIdField;g=d.typeIdField;if(l.includes(c,"*"))return[2,["*"]];u=f.fixFields;v=[d.fields];t=(r=c).concat;w=[[g]];return(m=a)?[4,f.getFeatureEditFields(d)]:[3,3];case 2:m=h.sent(),h.label=3;case 3:return(n=u.apply(void 0,v.concat([t.apply(r,w.concat([m||null]))])))&&e&&f.hasField(d.fields,e)&&-1===n.indexOf(e)&&n.push(e),[2,n]}})})};d.getFetchPopupTemplate=function(d,f){return d.popupTemplate?d.popupTemplate:
b.isSome(f)&&f.defaultPopupTemplateEnabled&&b.isSome(d.defaultPopupTemplate)?d.defaultPopupTemplate:null}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/arrayUtils ../../../core/arrayUtils ../../../core/Logger ../../../core/promiseUtils ../../../core/screenUtils ../../../core/unitUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../geometry/support/aaBoundingBox ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorker ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointRenderer ./support/layerViewUpdatingProperties ../support/geometryUtils ../support/orientedBoundingBox ../support/projectionUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F){var K=e.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),M=G.plane.create();return function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;a.maximumPointCount=4E6;a.slicePlaneEnabled=!1;a._renderer=null;a._rendererAdded=!1;a._renderedNodes=new Set;a._updateViewNeeded=!0;a._lodFactor=1;a._worker=new m.PointCloudWorker;a._maxLoggedBoxWarnings=5;a._pageMultiplier=1;a._indexQueue=[];a._workQueue=[];a._idleQueue=
new r.PromiseQueue;a._indexPagesLoading=new Map;a._loadingNodes=new Map;a._layerIsVisible=!1;a._totalWork=0;a._index=null;a._loadingInitNodePage=!1;a._nodeIdArray=[];return a}q(e,d);Object.defineProperty(e.prototype,"pointScale",{get:function(){var a=B.getSplatSizeAlgorithm(this.layer.renderer);return a&&null!=a.scaleFactor?a.scaleFactor:1},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"useRealWorldSymbolSizes",{get:function(){var a=B.getFixedSizeAlgorithm(this.layer.renderer);
return a&&null!=a.useRealWorldSymbolSizes?a.useRealWorldSymbolSizes:!1},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"pointSize",{get:function(){var a=B.getFixedSizeAlgorithm(this.layer.renderer);return a&&null!=a.size?a.size:0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"inverseDensity",{get:function(){return this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_clippingBox",{get:function(){var a=
v.create();return F.extentToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?a:null},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_elevationOffset",{get:function(){var b=this.layer.elevationInfo;if(b&&"absolute-height"===b.mode){var c=a.getMetersPerVerticalUnitForSR(this.layer.spatialReference),d=y.getMetersPerUnit(b.unit);return(b.offset||0)*d/c}return 0},enumerable:!0,configurable:!0});e.prototype.initialize=function(){var a=this;x.checkPointCloudLayerValid(this.layer);
x.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._initRenderer();var b=this._initNodePages(),c=this.view.resourceController.memoryController;this._memCache=c.getMemCache(this.layer.uid);this.handles.add(h.init(this,"_clippingBox",function(){return a._setUpdateViewNeeded()}));this.handles.add(h.init(this,"_elevationOffset",function(){return a._elevationOffsetChanged()}));this.handles.add(h.init(this.layer,"renderer",function(){return a._rendererChanged()}));this.handles.add(h.init(this.layer,
"filters",function(){return a._filterChanged()}));this.handles.add(h.init(this,"clippingArea",function(){a._setUpdateViewNeeded()}));this.handles.add(this.view.state.watch("camera",function(){return a._setUpdateViewNeeded()}));c.events.on("quality-changed",function(){return a._setUpdateViewNeeded()});this.addResolvingPromise(b);var d=this.view.resourceController.scheduler;this.when(function(){a.handles.add([d.registerTask(2,function(b){return a._process(b)},function(){return a._needsUpdate()}),d.registerIdleStateCallbacks(function(){return a._idleBegin()},
function(){return a._idleEnd()}),h.init(a,"suspended",function(b){b?a._clearNodeState():a._setUpdateViewNeeded()})])})};e.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};e.prototype.destroy=function(){this._cancelNodeLoading();this._worker.destroy();this._worker=null;this._destroyRenderer();this._memCache.destroy();this._memCache=null};e.prototype._initRenderer=function(){var a=this;this._renderer=new E;this._renderer.layerUid=this.layer.uid;this.handles.add(h.init(this,
"_clippingBox",function(b){return a._renderer.clippingBox=b}));this.handles.add(h.init(this,"suspended",function(b){return a._setPointsVisible(!b)}));this.handles.add(h.init(this,"pointScale",function(b){return a._renderer.scaleFactor=b}));this._renderer.minSizePx=Math.sqrt(2);this.handles.add(h.init(this,"useRealWorldSymbolSizes",function(b){return a._renderer.useRealWorldSymbolSizes=b}));this.handles.add(h.init(this,"pointSize",function(b){var d=c.pt2px(b);a._renderer.size=b;a._renderer.sizePx=
d}));this.handles.add(h.init(this,"slicePlaneEnabled",function(b){return a._renderer.slicePlaneEnabled=b}));this.handles.add(h.init(this,["inverseDensity","maximumPointCount"],function(){return a._setUpdateViewNeeded()}));this.handles.add(h.init(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(b){a._lodFactor=b;a._setUpdateViewNeeded()}))};e.prototype._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};e.prototype._setPointsVisible=function(a){a&&
!this._rendererAdded?(this.view._stage.addRenderPlugin([5],this._renderer),this._rendererAdded=!0):!a&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};e.prototype._rendererChanged=function(){this._clearNodeState();this._memCache.clear();this._renderer.useFixedSizes=B.rendererUsesFixedSizes(this.layer.renderer);this._setUpdateViewNeeded()};e.prototype._filterChanged=function(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()};
e.prototype._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};e.prototype.displayNodes=function(a){this._workQueue=A.nodeDiff(b.keysOfSet(this._renderedNodes),a,this._index);A.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index);A.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<a.length||this._loadingInitNodePage;this.notifyChange("suspended")};
e.prototype.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};e.prototype._cancelNodeLoading=function(){var a=[];this._loadingNodes.forEach(function(b){return a.push(b)});this._loadingNodes.clear();for(var b=0;b<a.length;b++)a[b].cancel();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};e.prototype._updateQueues=function(){var a=this,b=new Set;this._workQueue.forEach(function(a){a.load.forEach(function(a){b.add(a)})});
var c=[],d=new Map;this._loadingNodes.forEach(function(a,e){b.has(e)?d.set(e,a):c.push(a)});this._loadingNodes=d;for(var e=0;e<c.length;e++)c[e].cancel();this._workQueue=this._workQueue.filter(function(b){var c=0;for(b=b.load;c<b.length;c++)if(a._loadingNodes.has(b[c]))return!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};e.prototype._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(function(a){return a.cancel()});this._indexPagesLoading.clear();
this._totalWork=this._computeWork();this._updateLoading()};e.prototype._clearNodeState=function(){var a=this;this._renderedNodes.forEach(function(b){return a._removeFromRenderer(b)});this._cancelNodeLoading()};e.prototype._idleBegin=function(){this._setUpdateViewNeeded()};e.prototype._idleEnd=function(){this._setUpdateViewNeeded()};e.prototype._needsUpdate=function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||0<this._idleQueue.length};
e.prototype._process=function(a){var b=this;if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,a=this._isRootNodeVisible(),a!==this._layerIsVisible&&(this._layerIsVisible=a,this.notifyChange("suspended")));else{for(a.run(function(){return b._updateWorkQueues()});0<this._indexQueue.length&&a.run(function(){return b._processIndexQueue()}););for(this._processWorkQueue(a);0<this._idleQueue.length&&a.run(function(){return b._idleQueue.process()}););}};e.prototype._processIndexQueue=function(){var a=
this,b=this._indexQueue.shift();this._indexPagesLoading.set(b,this._loadNodePage(b));this._indexPagesLoading.get(b).then(function(c){a._index.addPage(b,c,a._elevationOffset);a._setUpdateViewNeeded()}).then(function(){a._indexPagesLoading.delete(b)},function(){a._indexPagesLoading.delete(b)});return!0};e.prototype._processWorkQueue=function(a){for(;!a.done;){var b=this._scheduleWorkEntry();if(!b)break;this._processWorkEntry(b);a.madeProgress()}};e.prototype._scheduleWorkEntry=function(){var a=this;
if(8<=this._loadingNodes.size)return null;for(var b=0;b<this._workQueue.length;++b){var c=this._workQueue[b];if(!f.find(c.remove,function(b){return!a._renderedNodes.has(b)})){for(;0<b;--b)this._workQueue[b]=this._workQueue[b-1];this._workQueue.shift();return c}}return null};e.prototype._processWorkEntry=function(a){var b=this;if(0===a.load.length)for(var c=0;c<a.remove.length;c++)this._removeFromRenderer(a.remove[c]);else k.all(a.load.map(function(a){var c=b._memCache.pop(a.toString());c?b._loadingNodes.set(a,
k.resolve(c)):b._loadingNodes.has(a)||b._loadingNodes.set(a,b.loadNode(a));return b._loadingNodes.get(a)})).then(function(c){for(var d=0;d<a.load.length;d++)if(c[d]){var e=b._setupRendererData(a.load[d],c[d]);b._addToRenderer(e)}for(d=0;d<a.remove.length;d++)b._removeFromRenderer(a.remove[d])}).catch(function(){}).then(function(){for(var c=0;c<a.load.length;c++)b._loadingNodes.delete(a.load[c]);b._updateLoading()}),this._updateLoading()};e.prototype._computeWork=function(){for(var a=0,b=0;b<this._workQueue.length;b++)a+=
this._workQueue[b].load.length;a+=this._loadingNodes.size;a+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;a+=this._loadingInitNodePage?100:0;return a+=this._updateViewNeeded?100:0};Object.defineProperty(e.prototype,"updatingPercentageValue",{get:function(){var a=this._computeWork();return 100*Math.min(this._totalWork,a)/this._totalWork},enumerable:!0,configurable:!0});e.prototype._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingPercentageValue")};
e.prototype.canResume=function(){return this.inherited(arguments)&&this._layerIsVisible};e.prototype.isUpdating=function(){return 0<this._computeWork()};e.prototype._initNodePages=function(){var a=this,b=this.layer.store.index;this._index=new C(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,b.nodesPerPage||b.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");
this._updateLoading();this._pageMultiplier=null!=b.nodesPerPage?1:b.nodePerIndexBlock;return this._loadNodePage(0).then(function(b){a._index.addPage(0,b,a._elevationOffset);a._loadingInitNodePage=!1;a._setUpdateViewNeeded()})};e.prototype._loadNodePage=function(a){var b=this;return this._requestJSON(this.baseUrl+"/nodepages/"+a*this._pageMultiplier).then(function(c){return c.data.nodes.map(function(c,d){return{resourceId:null!=c.resourceId?c.resourceId:a*b._index.pageSize+d,obb:c.obb,firstChild:c.firstChild,
childCount:c.childCount,vertexCount:null!=c.vertexCount?c.vertexCount:c.pointCount,lodThreshold:null!=c.lodThreshold?c.lodThreshold:c.effectiveArea}})})};e.prototype._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;for(var a=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),b=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),e=Math.sqrt(d/(.75*b));d>b;)a*=e,c=this._computeNodesForMinimumDensity(a),
d=this._computePointCount(c),e=Math.sqrt(2);this.displayNodes(c);this._updateViewNeeded=!1;this._updateLoading();return!0};e.prototype._computePointCount=function(a){for(var b=0,c=0;c<a.length;c++){var d=this._index.getNode(a[c]);d&&(b+=d.vertexCount)}return b};e.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};e.prototype._isRootNodeVisible=function(){var a=!1;this._traverseVisible({frustumPlanes:this.view.state.camera.frustum.planes,clippingBox:this._clippingBox},
{predicate:function(b,c,d){a=d;return!1},pageMiss:function(a,b){}});return a};e.prototype._computeNodesForMinimumDensity=function(a){var b=this,c=this.view.state.camera,d=c.frustum,e=this._clippingBox,f=c.viewForward,g=n.vec3.dot(f,c.eye),h=G.plane.fromNormalAndOffset(f,-g,M),k=c.perScreenPixelRatio/2,l=a*a,m=this._nodeIdArray;m.length=0;this._traverseVisible({frustumPlanes:d.planes,clippingBox:e},{predicate:function(a,c,d){if(!d)return!1;if(0===c.childCount)return m.push(a),!1;d=b._index.getRenderObb(a);
return b._computeAveragePixelArea(d,c.lodThreshold,c.vertexCount,h,k)<=l?(m.push(a),!1):!0},pageMiss:function(a,c){m.push(a);0>b._indexQueue.indexOf(c)&&b._indexQueue.push(c)}});return m};e.prototype._computeAveragePixelArea=function(a,b,c,d,e){a=Math.max(1E-7,L.minimumDistancePlane(a,d));return b/(a*a)/(4*e*e)/c};e.prototype.loadNode=function(a){var b=this,c=this._index.getNode(a),d=B.getRendererInfo(this.layer),e=B.getFilterInfo(this.layer),f=c.resourceId,g=[],h=function(a){a=b.loadAttribute(f,
a);g.push(a);return a};return this._idleQueue.push().then(function(){var a=b.loadGeometry(f);g.push(a);var c=h(d.primaryAttribute),l=h(d.modulationAttribute),m=e.map(function(a){return h(a.attributeInfo)});return k.all([a,c,l,k.all(m)])}).then(function(c){var f=c[0],g=c[1],h=c[2],k=c[3];c=[f];g&&c.push(g);h&&c.push(h);for(var l=0;l<k.length;l++)c.push(k[l]);f={geometryBuffer:f,primaryAttribute:g,modulationAttribute:h,filterAttributes:k,schema:b.layer.store.defaultGeometrySchema,rendererInfo:d,filterInfo:e,
obb:b._index.getRenderObb(a),elevationOffset:b._elevationOffset,inSR:b.layer.spatialReference.toJSON(),outSR:b.view.renderCoordsHelper.spatialReference.toJSON()};return b._worker.transform(f,c)}).catch(function(a){if(null==a||"CancelError"!==a.name&&"AbortError"!==a.name)K.error(a);else for(var b=0;b<g.length;b++)g[b].cancel();return k.reject(a)})};e.prototype.loadGeometry=function(a){return this._requestBinary(this.baseUrl+"/nodes/"+a+"/geometries/0").then(function(a){return a.data})};e.prototype.loadAttribute=
function(a,b){return b&&b.storageInfo?this._requestBinary(this.baseUrl+"/nodes/"+a+"/attributes/"+b.storageInfo.key).then(function(a){return a.data}):k.resolve(null)};e.prototype._requestJSON=function(a){return l(a,{query:{f:"json"},responseType:"json"})};e.prototype._requestBinary=function(a){return l(a,{responseType:"array-buffer"})};e.prototype._removeFromRenderer=function(a){if(this._renderedNodes.has(a)){var b=this._renderer.removeNode(a);this._renderedNodes.delete(a);this._memCache.put(b.id.toString(),
b,5*b.coordinates.length+128)}};e.prototype._addToRenderer=function(a){this._renderedNodes.has(a.id)||(this._renderedNodes.add(a.id),this._renderer.addNode(a))};e.prototype._setupRendererData=function(a,b){var c=this._index.getNode(a),d=Math.sqrt(c.lodThreshold/c.vertexCount),e=this._index.getRenderObb(a);if(E.isInstanceOfNode(b))return b.splatSize=d,b.obb=e,b.origin=u.vec3f32.clone(b.obb.center),b;if(b.obb.halfSize[0]>e.halfSize[0]||b.obb.halfSize[1]>e.halfSize[1]||b.obb.halfSize[2]>e.halfSize[2])0<
this._maxLoggedBoxWarnings&&(K.warn("Node "+a+" reported bounding box too small. got "+("["+e.halfSize.join(", ")+"]")+" but points cover "+("["+b.obb.halfSize.join(", ")+"]")),0===--this._maxLoggedBoxWarnings&&K.warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(a,b.obb);return{id:a,coordinates:b.points,origin:u.vec3f32.clone(e.center),rgb:b.rgb,splatSize:d,obb:e,isLeaf:0===c.childCount}};e.prototype.getUsedMemory=function(){var a=this;return b.keysOfSet(this._renderedNodes).reduce(function(b,
c){return b+15*a._index.getNode(c).vertexCount+128},0)};e.prototype.getUnloadedMemory=function(){var a=this,c=this._renderedNodes.size;if(4>c)return 0;for(var d=b.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount}),e=this._loadingNodes.size,f=0;f<this._workQueue.length;f++)e+=this._workQueue[f].load.length,e-=this._workQueue[f].remove.length;return 0>e?0:e*d/c*15+128*e};e.prototype.ignoresMemoryFactor=function(){return!1};e.prototype.getStats=function(){var a=
this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":b.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount},0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}};g([p.property()],e.prototype,"layer",void 0);g([p.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],e.prototype,"baseUrl",void 0);g([p.property({readOnly:!0,dependsOn:["layer.renderer"]})],
e.prototype,"pointScale",null);g([p.property({readOnly:!0,dependsOn:["layer.renderer"]})],e.prototype,"useRealWorldSymbolSizes",null);g([p.property({readOnly:!0,dependsOn:["layer.renderer"]})],e.prototype,"pointSize",null);g([p.property({readOnly:!0,dependsOn:["layer.renderer"]})],e.prototype,"inverseDensity",null);g([p.property()],e.prototype,"maximumPointCount",void 0);g([p.property({readOnly:!0,dependsOn:["view.clippingArea"]})],e.prototype,"_clippingBox",null);g([p.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],
e.prototype,"_elevationOffset",null);g([p.property({type:Boolean})],e.prototype,"slicePlaneEnabled",void 0);g([p.property(I.updatingPercentage)],e.prototype,"updatingPercentage",void 0);g([p.property({readOnly:!0})],e.prototype,"updatingPercentageValue",null);return e=g([p.subclass("esri.views.3d.layers.PointCloudLayerView3D")],e)}(p.declared(w))})},"esri/views/3d/layers/PointCloudWorker":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/promiseUtils ../../../core/requireUtils ../../../core/workers ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../geometry/SpatialReference ./i3s/I3SBinaryReader ./i3s/LEPCC ./i3s/PointCloudRendererUtil ../support/projectionUtils module".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v){Object.defineProperty(d,"__esModule",{value:!0});var r=function(){function b(){}b.prototype._process=function(a){a=this._transform(a);return g.resolve({result:a,transferList:[a.points.buffer,a.rgb.buffer]})};b.prototype._transform=function(b){var c=this.readGeometry(b.schema,b.geometryBuffer),d=c.length/3,e=n.evaluateRenderer(b.rendererInfo,b.primaryAttribute,b.modulationAttribute,c,d);b.filterInfo&&0<b.filterInfo.length&&(d=n.filterInPlace(c,e,b.filterInfo,
b.filterAttributes));3*d<e.length&&(e=new Uint8Array(e.buffer.slice(0,3*d)));this._applyElevationOffsetInPlace(c,d,b.elevationOffset);c=this._transformCoordinates(c,d,b.obb,a.fromJSON(b.inSR),a.fromJSON(b.outSR));return{obb:b.obb,points:c,rgb:e}};b.prototype.readGeometry=function(a,b){if(null==a.encoding||""===a.encoding){a=h.createGeometryDataIndex(b,a,!1);b=h.createTypedView(b,a.vertexAttributes.position);var c=a.header.fields;a=[c.offsetX,c.offsetY,c.offsetZ];for(var c=[c.scaleX,c.scaleY,c.scaleZ],
d=b.length/3,e=new Float64Array(3*d),f=0;f<d;f++)e[3*f]=b[3*f]*c[0]+a[0],e[3*f+1]=b[3*f+1]*c[1]+a[1],e[3*f+2]=b[3*f+2]*c[2]+a[2];return e}if("lepcc-xyz"===a.encoding)return p.decodeXYZ(b).result};b.prototype._transformCoordinates=function(a,b,d,e,g){if(!u.bufferToBuffer(a,e,0,a,g,0,b))throw Error("Can't reproject");e=c.vec3f32.fromValues(d.center[0],d.center[1],d.center[2]);g=c.vec3f32.create();var h=c.vec3f32.create();f.quat.conjugate(y,d.quaternion);for(var l=new Float32Array(3*b),m=0;m<b;m++)g[0]=
a[3*m]-e[0],g[1]=a[3*m+1]-e[1],g[2]=a[3*m+2]-e[2],k.vec3.transformQuat(h,g,y),d.halfSize[0]=Math.max(d.halfSize[0],Math.abs(h[0])),d.halfSize[1]=Math.max(d.halfSize[1],Math.abs(h[1])),d.halfSize[2]=Math.max(d.halfSize[2],Math.abs(h[2])),l[3*m]=g[0],l[3*m+1]=g[1],l[3*m+2]=g[2];return l};b.prototype._applyElevationOffsetInPlace=function(a,b,c){if(0!==c)for(var d=0;d<b;d++)a[3*d+2]+=c};return b}(),y=e.quatf32.create();e=function(a){function c(){var c=a.call(this)||this;c._thread=void 0;b.open(l.getAbsMid("./PointCloudWorker",
t,v)).then(function(a){void 0===c._thread?c._thread=a:a.close()});return c}q(c,a);c.prototype.destroy=function(){this._thread&&this._thread.close();this._thread=null};c.prototype.transform=function(a,b){return this._thread?this._thread.invoke("_process",a,{transferList:b}):g.resolve(this._transform(a))};return c}(r);d.PointCloudWorker=e;d.default=function(){return new r}})},"esri/core/libs/gl-matrix-2/quatf32":function(){define(["require","exports","./factories/quatf32"],function(t,d,q){Object.defineProperty(d,
"__esModule",{value:!0});d.quatf32=q})},"esri/core/libs/gl-matrix-2/factories/quatf32":function(){define(["require","exports"],function(t,d){Object.defineProperty(d,"__esModule",{value:!0});d.create=function(){var d=new Float32Array(4);d[3]=1;return d};d.clone=function(d){var g=new Float32Array(4);g[0]=d[0];g[1]=d[1];g[2]=d[2];g[3]=d[3];return g};d.fromValues=function(d,g,l,b){var f=new Float32Array(4);f[0]=d;f[1]=g;f[2]=l;f[3]=b;return f};d.createView=function(d,g){return new Float32Array(d,g,4)}})},
"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("require exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC".split(" "),function(t,d,q,g,l,b){function f(a,b,c){for(var d="",e=0;e<c;){var f=a[b+e];if(128>f)d+=String.fromCharCode(f),e++;else if(192<=f&&224>f){if(e+1>=c)throw new q("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var g=a[b+e+1],f=(f&31)<<6|g&63,d=d+String.fromCharCode(f),e=e+2}else if(224<=f&&240>f){if(e+2>=
c)throw new q("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");var g=a[b+e+1],h=a[b+e+2],f=(f&15)<<12|(g&63)<<6|h&63,d=d+String.fromCharCode(f),e=e+3}else if(240<=f&&248>f){if(e+3>=c)throw new q("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");g=a[b+e+1];h=a[b+e+2];f=(f&7)<<18|(g&63)<<12|(h&63)<<6|a[b+e+3]&63;d=65536<=f?d+String.fromCharCode((f-65536>>10)+55296,(f&1023)+56320):d+String.fromCharCode(f);e+=4}else throw new q("utf8-decode-error",
"UTF-8 Decode failed. Invalid multi byte sequence.");}return d}function e(a,b){for(var c={byteOffset:0,byteCount:0,fields:Object.create(null)},e=0,f=0;f<b.length;f++){var g=b[f],h=g.valueType||g.type;c.fields[g.property]=(0,d.valueType2ArrayBufferReader[h])(a,e);e+=d.valueType2TypedArrayClassMap[h].BYTES_PER_ELEMENT}c.byteCount=e;return c}function k(a,b,c){var d=[],e,g=0,h;for(h=0;h<a;h+=1){e=b[h];if(0<e){if(d.push(f(c,g,e-1)),0!==c[g+e-1])throw new q("string-array-error","Invalid string array: missing null termination.");
}else d.push(null);g+=e}return d}function c(a,b){return new d.valueType2TypedArrayClassMap[b.valueType](a,b.byteOffset,b.count*b.valuesPerElement)}function a(a,b){return new Uint8Array(a,b.byteOffset,b.byteCount)}function h(a,b,c){a=null!=b.header?e(a,b.header):{byteOffset:0,byteCount:0,fields:{count:c}};c={header:a,byteOffset:a.byteCount,byteCount:0,entries:Object.create(null)};for(var d=a.byteCount,f=0;f<b.ordering.length;f++){var h=b.ordering[f],k=g.clone(b[h]);k.count=a.fields.count;if("String"===
k.valueType){if(k.byteOffset=d,k.byteCount=a.fields[h+"ByteCount"],"UTF-8"!==k.encoding)throw new q("unsupported-encoding","Unsupported String encoding.",{encoding:k.encoding});}else if(n(k.valueType)){var l=u(k.valueType),d=d+(0!==d%l?l-d%l:0);k.byteOffset=d;k.byteCount=l*k.valuesPerElement*k.count}else throw new q("unsupported-value-type","Unsupported binary valueType",{valueType:k.valueType});d+=k.byteCount;c.entries[h]=k}c.byteCount=d-c.byteOffset;return c}function p(a,b,c){b!==a&&v.error("Invalid "+
c+" buffer size\n expected: "+a+", actual: "+b+")");if(b<a)throw new q("buffer-too-small","Binary buffer is too small",{expectedSize:a,actualSize:b});}function n(a){return d.valueType2TypedArrayClassMap.hasOwnProperty(a)}function u(a){return n(a)&&d.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT}Object.defineProperty(d,"__esModule",{value:!0});var v=l.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");d.readHeader=e;d.readStringArray=k;d.createTypedView=c;d.createRawView=a;d.createAttributeDataIndex=
h;d.createGeometryDataIndex=function(a,b,c){var d=e(a,b&&b.header),f=d.byteCount,h={header:d,byteOffset:d.byteCount,byteCount:0,vertexAttributes:g.clone(b.vertexAttributes)},k=h.vertexAttributes;c||null==k.region||delete k.region;var d=d.fields,l=null!=d.vertexCount?d.vertexCount:d.count;for(c=0;c<b.ordering.length;c++){var n=b.ordering[c];null!=k[n]&&(k[n].byteOffset=f,k[n].count=l,f+=u(k[n].valueType)*k[n].valuesPerElement*l)}k=d.faceCount;if(b.faces&&k)for(h.faces=g.clone(b.faces),l=h.faces,c=
0;c<b.ordering.length;c++)n=b.ordering[c],null!=l[n]&&(l[n].byteOffset=f,l[n].count=k,f+=u(l[n].valueType)*l[n].valuesPerElement*k);d=d.featureCount;if(b.featureAttributes&&b.featureAttributeOrder&&d)for(h.featureAttributes=g.clone(b.featureAttributes),k=h.featureAttributes,c=0;c<b.featureAttributeOrder.length;c++)l=b.featureAttributeOrder[c],k[l].byteOffset=f,k[l].count=d,n=u(k[l].valueType),"UInt64"===k[l].valueType&&(n=8),f+=n*k[l].valuesPerElement*d;p(f,a.byteLength,"geometry");h.byteCount=f-
h.byteOffset;return h};d.readBinaryAttribute=function(d,e,f){if("lepcc-rgb"===d.encoding)return b.decodeRGB(e);if("lepcc-intensity"===d.encoding)return b.decodeIntensity(e);if(null!=d.encoding&&""!==d.encoding)throw new q("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");d["attributeByteCounts "]&&!d.attributeByteCounts&&(v.warn("Warning: Trailing space in 'attributeByteCounts '."),d.attributeByteCounts=d["attributeByteCounts "]);"ObjectIds"===d.ordering[0]&&d.hasOwnProperty("objectIds")&&
(v.warn("Warning: Case error in objectIds"),d.ordering[0]="objectIds");f=h(e,d,f);p(f.byteOffset+f.byteCount,e.byteLength,"attribute");if(d=f.entries.attributeValues||f.entries.objectIds){if("String"===d.valueType){f=f.entries.attributeByteCounts;var g=c(e,f);e=a(e,d);return k(f.count,g,e)}return c(e,d)}throw new q("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};d.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,
Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array};d.valueType2ArrayBufferReader={Float32:function(a,b){return(new DataView(a,0)).getFloat32(b,!0)},Float64:function(a,b){return(new DataView(a,0)).getFloat64(b,!0)},UInt8:function(a,b){return(new DataView(a,0)).getUint8(b)},Int8:function(a,b){return(new DataView(a,0)).getInt8(b)},UInt16:function(a,b){return(new DataView(a,0)).getUint16(b,!0)},Int16:function(a,b){return(new DataView(a,0)).getInt16(b,!0)},UInt32:function(a,b){return(new DataView(a,
0)).getUint32(b,!0)},Int32:function(a,b){return(new DataView(a,0)).getInt32(b,!0)}};d.isValueType=n;d.getBytesPerValue=u})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports","../../../../core/Error"],function(t,d,q){function g(b,d,c){return{identifier:String.fromCharCode.apply(null,new Uint8Array(b,c+f.identifierOffset,f.identifierLength)),version:d.getUint16(c+f.versionOffset,!0),checksum:d.getUint32(c+f.checksumOffset,!0)}}function l(d,f,c){var a=[];f=b(d,f,a);for(var e=[],
g=0;g<a.length;g++){e.length=0;f=b(d,f,e);for(var k=0;k<e.length;k++)c.push(e[k]+a[g])}return f}function b(b,d,c){var a=new DataView(b,d),e=a.getUint8(0),f=e&31,g=!!(e&32),k=(e&192)>>6,e=0;if(0===k)e=a.getUint32(1,!0),d+=5;else if(1===k)e=a.getUint16(1,!0),d+=3;else if(2===k)e=a.getUint8(1),d+=2;else throw new q("lepcc-decode-error","Bad count type");if(g)throw new q("lepcc-decode-error","LUT not implemented");b=new Uint8Array(b,d,Math.ceil(e*f/8));for(var k=g=a=0,l=-1>>>32-f,r=0;r<e;r++){for(;g<
f;)a|=b[k]<<g,g+=8,k+=1;c[r]=a&l;a>>>=f;g-=f;32<g+f&&(a|=b[k-1]>>8-g)}return d+k}Object.defineProperty(d,"__esModule",{value:!0});var f={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};d.decodeXYZ=function(b){var d,c,a,e,p,n,u,v,r,t,w,m,x=new DataView(b,0),A=0;e=g(b,x,A);a=e.identifier;e=e.version;A+=f.byteCount;if("LEPCC     "!==a)throw new q("lepcc-decode-error","Bad identifier");if(1<e)throw new q("lepcc-decode-error","Unknown version");var C=A;d=x.getUint32(C+
0,!0);c=x.getUint32(C+4,!0);a=x.getFloat64(C+8,!0);e=x.getFloat64(C+16,!0);p=x.getFloat64(C+24,!0);n=x.getFloat64(C+32,!0);u=x.getFloat64(C+40,!0);v=x.getFloat64(C+48,!0);r=x.getFloat64(C+56,!0);t=x.getFloat64(C+64,!0);w=x.getFloat64(C+72,!0);m=x.getUint32(C+80,!0);x.getUint32(C+84,!0);A+=88;if(c*Math.pow(2,32)+d!==b.byteLength)throw new q("lepcc-decode-error","Bad size");x=new Float64Array(3*m);d=[];c=[];m=[];C=[];A=l(b,A,d);A=l(b,A,c);A=l(b,A,m);A=l(b,A,C);if(A!==b.byteLength)throw new q("lepcc-decode-error",
"Bad length");for(var B=A=b=0;B<d.length;B++)for(var A=A+d[B],E=0,I=0;I<c[B];I++){var E=E+m[b],G=C[b];x[3*b]=Math.min(n,a+2*r*E);x[3*b+1]=Math.min(u,e+2*t*A);x[3*b+2]=Math.min(v,p+2*w*G);b++}return{errorX:r,errorY:t,errorZ:w,result:x}};d.decodeRGB=function(b){var d,c,a,e,l,n,u=new DataView(b,0),v=0;e=g(b,u,v);a=e.identifier;e=e.version;v+=f.byteCount;if("ClusterRGB"!==a)throw new q("lepcc-decode-error","Bad identifier");if(1<e)throw new q("lepcc-decode-error","Unknown version");n=v;d=u.getUint32(n+
0,!0);c=u.getUint32(n+4,!0);a=u.getUint32(n+8,!0);e=u.getUint16(n+12,!0);l=u.getUint8(n+14);n=u.getUint8(n+15);v+=16;if(c*Math.pow(2,32)+d!==b.byteLength)throw new q("lepcc-decode-error","Bad size");if((2===l||1===l)&&0===n){if(3*e+a+v!==b.byteLength||256<e)throw new q("lepcc-decode-error","Bad count");u=new Uint8Array(b,v,3*e);e=new Uint8Array(b,v+3*e,a);v=new Uint8Array(3*a);for(b=0;b<a;b++)d=e[b],v[3*b]=u[3*d],v[3*b+1]=u[3*d+1],v[3*b+2]=u[3*d+2];return v}if(0===l&&0===n){if(3*a+v!==b.byteLength||
0!==e)throw new q("lepcc-decode-error","Bad count");return(new Uint8Array(b,v)).slice()}if(2>=l&&1===n){if(v+3!==b.byteLength||1!==e)throw new q("lepcc-decode-error","Bad count");e=u.getUint8(v);d=u.getUint8(v+1);u=u.getUint8(v+2);v=new Uint8Array(3*a);for(b=0;b<a;b++)v[3*b]=e,v[3*b+1]=d,v[3*b+2]=u;return v}throw new q("lepcc-decode-error","Bad method "+l+","+n);};d.decodeIntensity=function(d){var e,c,a,h,l,n=new DataView(d,0),u=0;h=g(d,n,u);a=h.identifier;h=h.version;u+=f.byteCount;if("Intensity "!==
a)throw new q("lepcc-decode-error","Bad identifier");if(1<h)throw new q("lepcc-decode-error","Unknown version");var v=u;e=n.getUint32(v+0,!0);c=n.getUint32(v+4,!0);a=n.getUint32(v+8,!0);h=n.getUint16(v+12,!0);l=n.getUint8(v+14);n.getUint8(v+15);u+=16;if(c*Math.pow(2,32)+e!==d.byteLength)throw new q("lepcc-decode-error","Bad size");n=new Uint16Array(a);if(8===l){if(a+u!==d.byteLength)throw new q("lepcc-decode-error","Bad size");l=new Uint8Array(d,u,a)}else if(16===l){if(2*a+u!==d.byteLength)throw new q("lepcc-decode-error",
"Bad size");l=new Uint16Array(d,u,a)}else if(l=[],b(d,u,l)!==d.byteLength)throw new q("lepcc-decode-error","Bad size");for(d=0;d<a;d++)n[d]=l[d]*h;return n}})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define("require exports ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader".split(" "),function(t,d,q,g,l,b){function f(a){var b=0,c=0;for(a=a?a:[];c<a.length;c++)b|=
1<<a[c];return b}function e(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b&&null!=d.attributeValues&&"UInt8"===d.attributeValues.valueType&&3===d.attributeValues.valuesPerElement)return{storageInfo:d,useElevation:!1}}return null}function k(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b)return a="embedded-elevation"===d.encoding,{storageInfo:a?null:d,useElevation:a}}return"elevation"===b.toLowerCase()?{storageInfo:null,useElevation:!0}:null}function c(a,c,d,e){if(a&&a.useElevation){a=
new Float64Array(e);for(c=0;c<e;c++)a[c]=d[3*c+2];return a}return a&&c?b.readBinaryAttribute(a.storageInfo,c,e):null}function a(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===a?function(a){return(a&240)>>4}:"absolute-value"===a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%10}:null}Object.defineProperty(d,"__esModule",{value:!0});d.getRendererInfo=function(a){var b=a.renderer,c=b&&b.type,d=b&&a.renderer.toJSON()||null,f=null,
g=!1;"point-cloud-unique-value"===c?f=k(a.attributeStorageInfo,b.field):"point-cloud-stretch"===c?f=k(a.attributeStorageInfo,b.field):"point-cloud-class-breaks"===c?f=k(a.attributeStorageInfo,b.field):(f="point-cloud-rgb"===c?e(a.attributeStorageInfo,b.field):e(a.attributeStorageInfo,"RGB"),g=null!=f);c=null;b&&b.colorModulation&&(c=k(a.attributeStorageInfo,b.colorModulation.field));return{rendererJSON:d,isRGBRenderer:g,primaryAttribute:f,modulationAttribute:c}};d.getFilterInfo=function(a){var b=
a.filters;return b?b.map(function(b){return{filterJSON:b.toJSON(),attributeInfo:k(a.attributeStorageInfo,b.field)}}):[]};d.evaluateRenderer=function(b,d,e,f,k){var h=b.rendererJSON,n=b.isRGBRenderer,p=b.modulationAttribute;b=c(b.primaryAttribute,d,f,k);e=c(p,e,f,k);p=f=null;if(b&&n)f=b;else if(b&&"pointCloudUniqueValueRenderer"===h.type){var p=l.fromJSON(h),m=p.colorUniqueValueInfos;f=new Uint8Array(3*k);n=a(p.fieldTransformType);for(h=0;h<k;h++){d=n?n(b[h]):b[h];d+="";for(var u=0;u<m.length;u++)if(0<=
m[u].values.indexOf(d)){f[3*h]=m[u].color.r;f[3*h+1]=m[u].color.g;f[3*h+2]=m[u].color.b;break}}}else if(b&&"pointCloudStretchRenderer"===h.type)for(p=g.fromJSON(h),m=p.stops,f=new Uint8Array(3*k),n=a(p.fieldTransformType),h=0;h<k;h++)if(d=n?n(b[h]):b[h],u=m.length-1,d<m[0].value)f[3*h]=m[0].color.r,f[3*h+1]=m[0].color.g,f[3*h+2]=m[0].color.b;else if(d>=m[u].value)f[3*h]=m[u].color.r,f[3*h+1]=m[u].color.g,f[3*h+2]=m[u].color.b;else for(u=1;u<m.length;u++){if(d<m[u].value){d=(d-m[u-1].value)/(m[u].value-
m[u-1].value);f[3*h]=m[u].color.r*d+m[u-1].color.r*(1-d);f[3*h+1]=m[u].color.g*d+m[u-1].color.g*(1-d);f[3*h+2]=m[u].color.b*d+m[u-1].color.b*(1-d);break}}else if(b&&"pointCloudClassBreaksRenderer"===h.type)for(p=q.fromJSON(h),m=p.colorClassBreakInfos,f=new Uint8Array(3*k),n=a(p.fieldTransformType),h=0;h<k;h++)for(d=n?n(b[h]):b[h],u=0;u<m.length;u++){if(d>=m[u].minValue&&d<=m[u].maxValue){f[3*h]=m[u].color.r;f[3*h+1]=m[u].color.g;f[3*h+2]=m[u].color.b;break}}else for(f=new Uint8Array(3*k),h=0;h<f.length;h++)f[h]=
255;if(e&&p&&p.colorModulation)for(b=p.colorModulation.minValue,p=p.colorModulation.maxValue,h=0;h<k;h++)d=e[h],n=d>=p?1:d<=b?.3:.3+.7*(d-b)/(p-b),f[3*h]*=n,f[3*h+1]*=n,f[3*h+2]*=n;return f};d.filterInPlace=function(a,b,d,e){var g=a.length/3;e=e.map(function(b,e){return c(d[e].attributeInfo,b,a,g)});for(var h=0,k=0;k<g;k++){for(var l=!0,m=0;m<d.length&&l;m++){var n=d[m].filterJSON,p=e[m][k];switch(n.type){case "pointCloudValueFilter":var q="exclude"===n.mode;-1!==n.values.indexOf(p)===q&&(l=!1);break;
case "pointCloudBitfieldFilter":q=f(n.requiredSetBits);n=f(n.requiredClearBits);if((p&q)!==q||0!==(p&n))l=!1;break;case "pointCloudReturnFilter":for(var u=p&15,t=p>>>4&15,p=1<t,q=1===u,u=u===t,t=!1,I=0,n=n.includedReturns;I<n.length;I++){var G=n[I];if("last"===G&&u||"firstOfMany"===G&&q&&p||"lastOfMany"===G&&u&&p||"single"===G&&!p){t=!0;break}}t||(l=!1)}}l&&(a[3*h]=a[3*k],a[3*h+1]=a[3*k+1],a[3*h+2]=a[3*k+2],b[3*h]=b[3*k],b[3*h+1]=b[3*k+1],b[3*h+2]=b[3*k+2],h++)}return h};d.getSplatSizeAlgorithm=function(a){return(a=
a&&a.pointSizeAlgorithm)&&"splat"===a.type?a:null};d.getFixedSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"fixed-size"===a.type?a:null};d.rendererUsesFixedSizes=function(a){return(a=a&&a.pointSizeAlgorithm)&&a.type?"fixed-size"===a.type:!1}})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(t,d,q,g,l,b,f,e,k,c){return function(a){function d(b){b=a.call(this)||this;b.type="point-cloud-class-breaks";b.field=null;b.legendOptions=null;b.fieldTransformType=null;b.colorClassBreakInfos=null;return b}g(d,a);p=d;d.prototype.clone=function(){return new p(q({},this.cloneProperties(),{field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:b.clone(this.colorClassBreakInfos),legendOptions:b.clone(this.legendOptions)}))};var p;l([f.enumeration.serializable()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
d.prototype,"type",void 0);l([f.property({json:{write:!0},type:String})],d.prototype,"field",void 0);l([f.property({type:k.default,json:{write:!0}})],d.prototype,"legendOptions",void 0);l([f.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);l([f.property({type:[c.default],json:{write:!0}})],d.prototype,"colorClassBreakInfos",
void 0);return d=p=l([f.subclass("esri.renderers.PointCloudClassBreaksRenderer")],d)}(f.declared(e))})},"esri/renderers/PointCloudRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/kebabDictionary ../core/lang ../core/accessorSupport/decorators ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmJSONUtils ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(t,d,q,
g,l,b,f,e,k,c,a){var h=b.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});t=function(b){function d(a){a=b.call(this)||this;a.type=void 0;a.pointSizeAlgorithm=null;a.colorModulation=null;a.pointsPerInch=10;return a}q(d,b);d.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};d.prototype.cloneProperties=
function(){return{pointSizeAlgorithm:f.clone(this.pointSizeAlgorithm),colorModulation:f.clone(this.colorModulation),pointsPerInch:f.clone(this.pointsPerInch)}};g([e.property({type:h.apiValues,readOnly:!0,nonNullable:!0,json:{type:h.jsonValues,read:!1,write:h.write}})],d.prototype,"type",void 0);g([e.property({types:a.pointSizeAlgorithmTypes,json:{read:c.read,write:!0}})],d.prototype,"pointSizeAlgorithm",void 0);g([e.property({type:k.default,json:{write:!0}})],d.prototype,"colorModulation",void 0);
g([e.property({json:{write:!0},nonNullable:!0,type:Number})],d.prototype,"pointsPerInch",void 0);return d=g([e.subclass("esri.renderers.PointCloudRenderer")],d)}(e.declared(l));(t||(t={})).fieldTransformTypeKebabDict=new b.KebabDictionary({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return t})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function e(){var b=null!==d&&d.apply(this,arguments)||this;b.field=null;b.minValue=0;b.maxValue=255;return b}q(e,d);f=e;e.prototype.clone=function(){return new f({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};var f;g([b.property({type:String,json:{write:!0}})],e.prototype,"field",void 0);g([b.property({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minValue",void 0);g([b.property({type:Number,
nonNullable:!0,json:{write:!0}})],e.prototype,"maxValue",void 0);return e=f=g([b.subclass("esri.renderers.support.pointCloud.ColorModulation")],e)}(b.declared(l));d.ColorModulation=t;d.default=t})},"esri/renderers/support/pointCloud/pointSizeAlgorithmJSONUtils":function(){define(["require","exports","../../../core/Warning","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});var b={pointCloudFixedSizeAlgorithm:g.default,
pointCloudSplatAlgorithm:l.default};d.read=function(d,e,g){if(e=d?b[d.type]||null:null)return e=new e,e.read(d,g),e;g&&g.messages&&d&&g.messages.push(new q("pointsizealgorithm:unsupported","Point size algorithms of type '"+(d.type||"unknown")+"' are not supported",{definition:d,context:g}));return null};d.fromJSON=function(d){var e=d?b[d.type]||null:null;return e?e.fromJSON(d):null}})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),
function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c.type="fixed-size";c.size=0;c.useRealWorldSymbolSizes=null;return c}q(d,b);f=d;d.prototype.clone=function(){return new f({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};var f;g([l.enumeration.serializable()({pointCloudFixedSizeAlgorithm:"fixed-size"})],d.prototype,"type",void 0);g([l.property({type:Number,nonNullable:!0,json:{write:!0}})],
d.prototype,"size",void 0);g([l.property({type:Boolean,json:{write:!0}})],d.prototype,"useRealWorldSymbolSizes",void 0);return d=f=g([l.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],d)}(l.declared(b.default));d.PointSizeFixedSizeAlgorithm=t;d.default=t})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/kebabDictionary ../../../core/accessorSupport/decorators".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});d.typeKebabDictionary=new b.default({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});t=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}q(e,b);g([f.property({type:d.typeKebabDictionary.apiValues,readOnly:!0,nonNullable:!0,json:{type:d.typeKebabDictionary.jsonValues,read:!1,write:d.typeKebabDictionary.write}})],e.prototype,"type",void 0);return e=g([f.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
e)}(f.declared(l));d.PointSizeAlgorithm=t;d.default=t})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),function(t,d,q,g,l,b){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c.type="splat";c.scaleFactor=1;return c}q(d,b);
f=d;d.prototype.clone=function(){return new f({scaleFactor:this.scaleFactor})};var f;g([l.enumeration.serializable()({pointCloudSplatAlgorithm:"splat"})],d.prototype,"type",void 0);g([l.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],d.prototype,"scaleFactor",void 0);return d=f=g([l.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],d)}(l.declared(b.default));d.PointSizeSplatAlgorithm=t;d.default=t})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["require",
"exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});d.pointSizeAlgorithmTypes={key:"type",base:q.default,typeMap:{"fixed-size":g.default,splat:l.default}}})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.description=null;a.label=null;a.minValue=0;a.maxValue=0;a.color=null;return a}q(a,b);c=a;a.prototype.clone=function(){return new c({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:f.clone(this.color)})};var c;g([e.property({type:String,json:{write:!0}})],a.prototype,"description",void 0);g([e.property({type:String,
json:{write:!0}})],a.prototype,"label",void 0);g([e.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],a.prototype,"minValue",void 0);g([e.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],a.prototype,"maxValue",void 0);g([e.property({type:l,json:{type:[k.Integer],write:!0}})],a.prototype,"color",void 0);return a=c=g([e.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],a)}(e.declared(b));d.ColorClassBreakInfo=
t;d.default=t})},"esri/renderers/PointCloudStretchRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/StopInfo".split(" "),function(t,d,q,g,l,b,f,e,k,c){return function(a){function d(b){b=a.call(this)||this;b.type="point-cloud-stretch";b.field=null;b.legendOptions=null;b.fieldTransformType=
null;b.stops=null;return b}g(d,a);p=d;d.prototype.clone=function(){return new p(q({},this.cloneProperties(),{field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),stops:b.clone(this.stops),legendOptions:b.clone(this.legendOptions)}))};var p;l([f.enumeration.serializable()({pointCloudStretchRenderer:"point-cloud-stretch"})],d.prototype,"type",void 0);l([f.property({json:{write:!0},type:String})],d.prototype,"field",void 0);l([f.property({type:k.default,json:{write:!0}})],d.prototype,
"legendOptions",void 0);l([f.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);l([f.property({type:[c.default],json:{write:!0}})],d.prototype,"stops",void 0);return d=p=l([f.subclass("esri.renderers.PointCloudStretchRenderer")],d)}(f.declared(e))})},"esri/renderers/support/pointCloud/StopInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.label=null;a.value=0;a.color=null;return a}q(a,b);c=a;a.prototype.clone=function(){return new c({label:this.label,value:this.value,color:f.clone(this.color)})};var c;g([e.property({type:String,json:{write:!0}})],a.prototype,"label",void 0);g([e.property({type:Number,nonNullable:!0,json:{write:!0}})],a.prototype,"value",void 0);g([e.property({type:l,
json:{type:[k.Integer],write:!0}})],a.prototype,"color",void 0);return a=c=g([e.subclass("esri.renderers.support.pointCloud.StopInfo")],a)}(e.declared(b));d.StopInfo=t;d.default=t})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(t,d,q,g,l,b,f,e,k,c){return function(a){function d(b){b=a.call(this)||this;b.type="point-cloud-unique-value";b.field=null;b.fieldTransformType=null;b.colorUniqueValueInfos=null;b.legendOptions=null;return b}g(d,a);p=d;d.prototype.clone=function(){return new p(q({},this.cloneProperties(),{field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),colorUniqueValueInfos:b.clone(this.colorUniqueValueInfos),legendOptions:b.clone(this.legendOptions)}))};var p;l([f.enumeration.serializable()({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],
d.prototype,"type",void 0);l([f.property({json:{write:!0},type:String})],d.prototype,"field",void 0);l([f.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);l([f.property({type:[c.default],json:{write:!0}})],d.prototype,"colorUniqueValueInfos",void 0);l([f.property({type:k.default,json:{write:!0}})],d.prototype,"legendOptions",
void 0);return d=p=l([f.subclass("esri.renderers.PointCloudUniqueValueRenderer")],d)}(f.declared(e))})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(t,d,q,g,l,b,f,e,k){Object.defineProperty(d,"__esModule",{value:!0});
t=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.description=null;a.label=null;a.values=null;a.color=null;return a}q(a,b);c=a;a.prototype.clone=function(){return new c({description:this.description,label:this.label,values:f.clone(this.values),color:f.clone(this.color)})};var c;g([e.property({type:String,json:{write:!0}})],a.prototype,"description",void 0);g([e.property({type:String,json:{write:!0}})],a.prototype,"label",void 0);g([e.property({type:[String],json:{write:!0}})],
a.prototype,"values",void 0);g([e.property({type:l,json:{type:[k.Integer],write:!0}})],a.prototype,"color",void 0);return a=c=g([e.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],a)}(e.declared(b));d.ColorUniqueValueInfo=t;d.default=t})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("require exports ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/webMercatorUtils ../../../../tasks/QueryTask ../../../../tasks/support/Query ./I3SBinaryReader ../../support/projectionUtils ../../support/stack".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y){function w(a){return a&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10)}function m(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=0;if(c<a[0])var g=a[0]-c,f=f+g*g;d<a[1]&&(g=a[1]-d,f+=g*g);e<a[2]&&(g=a[2]-e,f+=g*g);c>a[3]&&(g=c-a[3],f+=g*g);d>a[4]&&(g=d-a[4],f+=g*g);e>a[5]&&(g=e-a[5],f+=g*g);if(f>b*b)return 0;if(0<f)return 1;f=Infinity;c-a[0]<f&&(f=c-a[0]);d-a[1]<f&&(f=d-a[1]);e-a[2]<f&&(f=e-a[2]);a[3]-c<f&&(f=a[3]-c);a[4]-d<f&&(f=a[4]-d);a[5]-e<f&&
(f=a[5]-e);return f>b?2:1}function x(a,b,c){var d=[],e=c&&c.missingFields;c=c&&c.originalFields;for(var f=0;f<a.length;f++){for(var g=a[f],h=g.toLowerCase(),k=!1,l=0,m=b;l<m.length;l++){var n=m[l];if(h===n.name.toLowerCase()){d.push(n.name);k=!0;c&&c.push(g);break}}!k&&e&&e.push(g)}return d}function A(a,b){return a.filter(function(a){return a.toLowerCase()!==b.toLowerCase()}).concat([b])}function C(a,b,c,d){b.sort(function(a,b){return a.attributes[c]-b.attributes[c]});var e=b.map(function(a){return a.attributes[c]}),
f=[],g=x(d,a.fields,{originalFields:f});return E(a,e,g).then(function(a){for(var c=0;c<b.length;c++){var d=b[c],e=a[c];d.attributes={};for(var h=0;h<f.length;h++)d.attributes[f[h]]=e[g[h]]}return b})}function B(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e in b.attributes||c.push(e)}return c}function E(a,c,d){if(null!=a.maxRecordCount&&c.length>a.maxRecordCount){var e=L(c,a.maxRecordCount);return b.all(e.map(function(b){return E(a,b,d)})).then(F)}e=new u({objectIds:c,outFields:d,orderByFields:[a.objectIdField]});
return(new n(a.parsedUrl.path)).execute(e).then(function(a){return a&&a.features&&a.features.length===c.length?a.features.map(function(a){return a.attributes}):b.reject(new l("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function I(a,c,d,f,g){for(var h=[],k=0;k<c.attributeData.length;k++){var m=c.attributeData[k],n=a[k];n&&-1!==f.indexOf(n.name)&&(m=e.makeAbsolute(m.href,c.baseUrl),h.push({url:m,storageInfo:n}))}return b.eachAlways(h.map(function(a){return q(a.url,
{responseType:"array-buffer"}).then(function(b){return v.readBinaryAttribute(a.storageInfo,b.data)})})).then(function(a){var c=[];if(!g.ignoreUnavailableFields&&a.some(function(a){return null==a.value})){for(var c=[],e=0;e<a.length;e++)null==a[e].value&&c.push({name:h[e].storageInfo.name,error:a[e].error});return b.reject(new l("scenelayer:attribute-request-failed","Request for scene layer attributes failed",{failedAttributes:c}))}for(var f=0;f<d.length;f++){for(var k=d[f],m={},e=0;e<a.length;e++)null!=
a[e].value&&(m[h[e].storageInfo.name]=G(a[e].value,k));c.push(m)}return c})}function G(a,b){b=a[b];return f.isInt16Array(a)?b===N?null:b:f.isInt32Array(a)?b===V?null:b:b!==b?null:b}function L(a,b){var c=a.length;b=Math.ceil(c/b);for(var d=[],e=0;e<b;e++)d.push(a.slice(Math.floor(c*e/b),Math.floor(c*(e+1)/b)));return d}function F(a){for(var b=[],c=0;c<a.length;c++)b=b.concat(a[c]);return b}function K(b){var c=new a(w(b.store.indexCRS||b.store.geographicCRS));return c.equals(b.spatialReference)?b.spatialReference:
c}function M(b){var c=new a(w(b.store.vertexCRS||b.store.projectedCRS));return c.equals(b.spatialReference)?b.spatialReference:c}function Q(a,b,c){if(!p.canProject(a,b))throw new l("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===c&&a.isGeographic)throw new l("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{});}function P(a,b,c){var d=
K(a);a=M(a);Q(d,b,c);Q(a,b,c)}Object.defineProperty(d,"__esModule",{value:!0});d.DDS_ENCODING_STRING="image/vnd-ms.dds";d.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"];d.extractWkid=w;d.getAppropriateTextureEncoding=function(a,b){if(Array.isArray(a)){if(b&&(b=a.indexOf(d.DDS_ENCODING_STRING),-1<b))return b;for(b=0;b<a.length;b++)if(-1<d.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(a[b]))return b;throw Error("Could not find appropriate texture encoding (among "+a.toString()+
")");}return-1};d.findIntersectingNodes=function(a,b,c,d,e,f){e.traverse(c,function(c){var e=c.mbs;b!==d&&(e=U,r.mbsToMbs(c.mbs,d,e,b));if(0!==m(a,e))return f(c),!0})};d.filterInPlace=function(a,b,c){for(var d=0,e=0,f=0;f<b.length&&d<a.length;f++)a[d]===b[f]&&(c(f)&&(a[e]=a[d],e++),d++);a.length=e};var O=h.create();d.getClipAABB=function(a,b){var c=k.mat4.copy(y.sm4d.get(),b.objectTransformation);b=b.getGeometryRecords()[0].getShaderTransformation();k.mat4.multiply(c,c,b);if(0===c[1]&&0===c[2]&&0===
c[3]&&0===c[4]&&0===c[6]&&0===c[7]&&0===c[8]&&0===c[9]&&0===c[11]&&1===c[15])return O[0]=(a[0]-c[12])/c[0],O[1]=(a[1]-c[13])/c[5],O[2]=(a[2]-c[14])/c[10],O[3]=(a[3]-c[12])/c[0],O[4]=(a[4]-c[13])/c[5],O[5]=(a[5]-c[14])/c[10],O};var U=c.vec4f64.create();d.intersectBoundingBoxWithMbs=m;d.findFieldsCaseInsensitive=x;d.whenGraphicAttributes=function(a,c,d,e,f,h){var k=!0===(h&&h.populateObjectId),m=h.ignoreUnavailableFields?void 0:[],n=1===e.length&&"*"===e[0];!n&&k&&(e=A(e,d));e=n?e:x(e,a.fields,{missingFields:m});
if(m&&0!==m.length)return b.reject(new l("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:m}));if(0===c.length)return b.resolve(c);var m=a.associatedLayer,p=a.attributeStorageInfo,q=n?a.fields.map(function(a){return a.name}):e;if(m)return C(m,c,d,q);var r=B(q,c[0]);return 0===r.length?b.resolve(c):p?(a=f(c))?b.all(a.map(function(a){return I(p,a.node,a.indices,r,h).then(function(b){for(var c=0;c<a.graphics.length;c++){for(var d=0,e=q;d<e.length;d++){var f=
e[d];f in b[c]||(b[c][f]=a.graphics[c].attributes[f])}a.graphics[c].attributes=b[c]}return a.graphics})})).then(g.flatten):b.reject(new l("scenelayer:features-not-loaded","Tried to query attributes for unloaded features")):b.reject(new l("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var N=-Math.pow(2,15),V=-Math.pow(2,31);d.getCachedAttributeValue=G;d.convertFlatRangesToOffsets=function(a,b,c){void 0===c&&(c=2);b=null!=b?b:a.length/c;for(var d=
new Uint32Array(b+1),e=0;e<b;e++){var f=a[e*c];d[e]=3*f;var g=(e-1)*c+1;if(0<=g&&f-1!==a[g])throw new l("Face ranges are not continuous");}d[d.length-1]=3*(a[(b-1)*c+1]+1);return d};d.getIndexCrs=K;d.getVertexCrs=M;d.getCacheKeySuffix=function(a,b){return b===r.SphericalECEFSpatialReference?"@ECEF":a.equals(b)?"":null!=b.wkid?"@"+b.wkid:null};d.checkSpatialReference=Q;d.checkSpatialReferences=P;d.checkSceneLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,
b=!!(null!=a.geometryType&&"triangles"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||null==a.vertexAttributes||null==a.vertexAttributes.position));if(b)throw new l("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{});};d.checkSceneLayerCompatibleWithView=function(a,b){P(a,b.spatialReference,b.viewingMode)};d.checkPointCloudLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,
b=!!(null==a.geometryType||"points"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||null!=a.encoding&&""!==a.encoding&&"lepcc-xyz"!==a.encoding||null==a.vertexAttributes||null==a.vertexAttributes.position));if(b)throw new l("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};d.checkPointCloudLayerCompatibleWithView=function(a,b){Q(a.spatialReference,b.spatialReference,b.viewingMode)};d.rendererNeedsTextures=function(a){if(null==
a||"simple"!==a.type&&"class-breaks"!==a.type&&"unique-value"!==a.type||("unique-value"===a.type||"class-breaks"===a.type)&&null==a.defaultSymbol)return!0;a=a.getSymbols();if(0===a.length)return!0;for(var b=0;b<a.length;b++){var c=a[b];if("mesh-3d"!==c.type||0===c.symbolLayers.length)return!0;for(var d=0,c=c.symbolLayers.items;d<c.length;d++){var e=c[d];if("fill"!==e.type||null==e.material||"replace"!==e.material.colorMixMode)return!0}}return!1};var X=function(){return function(){this.material=this.edges=
null;this.castShadows=!0}}();d.SymbolInfo=X;d.getSymbolInfo=function(a){var b=new X,c=!1,d=!1,e=0;for(a=a.symbolLayers.items;e<a.length;e++){var f=a[e];if("fill"===f.type&&f.enabled){var g=f.material,h=f.edges;g&&!c&&(c=g.color,b.material={color:c?[c.r/255,c.g/255,c.b/255]:null,alpha:c?c.a:null,colorMixMode:g.colorMixMode},b.castShadows=f.castShadows,c=!0);h&&!d&&(b.edges=f.edges,d=!0)}}return b}})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3"],
function(t,d,q){function g(b,a,d){for(;0<b;){var c=a.indexOf(b);if(0<=c)return c;b=d.getParentId(b)}return a.indexOf(b)}function l(b,a){for(var c=[b.remove[0]],d=[];1===c.length;)for(var e=c.pop(),f=d.length=0;f<b.load.length;f++){for(var g=b.load[f],k=a.getParentId(g);k!==e;)g=k,k=a.getParentId(g);k=c.indexOf(g);0>k&&(k=c.length,c.push(g),d.push([]));d[k].push(b.load[f])}a=[];a.push({remove:b.remove,load:c});for(f=0;f<c.length;f++)1<d[f].length?a.push({remove:[c[f]],load:d[f]}):c[f]=d[f][0];return a}
Object.defineProperty(d,"__esModule",{value:!0});d.nodeDiff=function(c,a,d){for(var h=0;h<a.length;h++)e[h]=!1,k[h]=null;for(h=0;h<c.length;h++)b[h]=!1,f[h]=null;for(h=0;h<a.length;h++){var l=g(a[h],c,d);0<=l&&(e[h]=!0,null!=f[l]?f[l].push(a[h]):f[l]=[a[h]])}for(h=0;h<c.length;h++)l=g(c[h],a,d),0<=l&&(b[h]=!0,null!=k[l]?k[l].push(c[h]):k[l]=[c[h]]);d=[];for(h=0;h<c.length;h++)null!=f[h]||b[h]||d.push({load:[],remove:[c[h]]});for(h=0;h<a.length;h++)null!=k[h]||e[h]||d.push({load:[a[h]],remove:[]});
for(h=0;h<a.length;h++)null!=k[h]&&(1<k[h].length||k[h][0]!==a[h])&&d.push({load:[a[h]],remove:k[h]});for(h=0;h<c.length;h++)null!=f[h]&&(1<f[h].length||f[h][0]!==c[h])&&d.push({load:f[h],remove:[c[h]]});return d};var b=[!1],f=[null],e=[!1],k=[null];d.sortFrontToBack=function(b,a,d){return b.sort(function(b,c){if(0===b.load.length&&0===c.load.length)return 0;if(0===b.load.length)return-1;if(0===c.load.length)return 1;if(0===b.remove.length&&0===c.remove.length)return b=d.getRenderCenter(b.load[0]),
c=d.getRenderCenter(c.load[0]),q.vec3.dot(b,a)-q.vec3.dot(c,a);if(0===b.remove.length)return-1;if(0===c.remove.length)return 1;if(1===b.load.length&&1===c.load.length)return b=d.getRenderCenter(b.load[0]),c=d.getRenderCenter(c.load[0]),q.vec3.dot(b,a)-q.vec3.dot(c,a);if(1===b.load.length)return-1;if(1===c.load.length)return 1;b=d.getRenderCenter(b.remove[0]);c=d.getRenderCenter(c.remove[0]);return q.vec3.dot(b,a)-q.vec3.dot(c,a)})};d.splitWorkEntries=function(b,a,d){for(var c=0;c<b.length;++c){var e=
b[c];if(e.load.length>a&&1===e.remove.length){e=l(e,d);b[c]=e[0];for(var f=1;f<e.length;f++)b.push(e[f])}}};d.splitWorkEntry=l})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c){var a=f.vec3f64.create();t=function(){function d(a,b,c){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=a;this._renderSR=b;this.pageSize=c}d.prototype.addPage=function(d,e,f){for(void 0===f&&(f=0);this._pages.length<d;)this._pages.push(null);for(var l=this._nodeSR,n=this._renderSR,m=new k.ObbArray(e.length),q=0;q<e.length;q++){var r=e[q].obb,u=m.obbs[q];k.set(r,u);b.vec3.set(a,r.center[0],r.center[1],r.center[2]+f);l.isGeographic||n!==c.SphericalECEFSpatialReference||
(c.computeLinearTransformation(l,a,h,n),r=2*Math.sqrt(1+h[0]+h[5]+h[10]),p[0]=(h[9]-h[6])/r,p[1]=(h[2]-h[8])/r,p[2]=(h[4]-h[1])/r,p[3]=.25*r,g.quat.conjugate(p,p),g.quat.multiply(u.quaternion,p,u.quaternion));c.bufferToBuffer(a,l,0,u.center,n,0,1)}this._pages[d]={nodes:e,renderObbs:m.obbs,parents:new Uint32Array(this.pageSize)};d=this._pages;e=this.pageSize;for(l=[0];l.length;)for(n=l.pop(),f=d[n/e|0].nodes[n%e],m=0;m<f.childCount;m++)q=f.firstChild+m,null!=d[q/e|0]&&(d[q/e|0].parents[q%e]=n,l.push(q))};
d.prototype.hasPage=function(a){return!!this._pages[a]};d.prototype.getNode=function(a){var b=this.pageSize;return this._pages[a/b|0].nodes[a%b]};d.prototype.getRenderObb=function(a){var b=this.pageSize;return this._pages[a/b|0].renderObbs[a%b]};d.prototype.getRenderCenter=function(a){return this.getRenderObb(a).center};d.prototype.setRenderObb=function(a,b){var c=this.pageSize;k.set(b,this._pages[a/c|0].renderObbs[a%c])};d.prototype.getParentId=function(a){var b=this.pageSize;return this._pages[a/
b|0].parents[a%b]};d.prototype.hasNodes=function(a,b){b=(a+b-1)/this.pageSize|0;for(a=a/this.pageSize|0;a<=b;a++)if(null==this._pages[a])return!1;return!0};d.prototype.createVisibilityTraverse=function(){var a=this,b=[],c=[],d=e.create();return function(f,g){if(a.hasNodes(0,1))for(b.length=0,b.push(0),c.length=0,c.push(0);0<b.length;){var h=b.pop(),l=c.pop(),m=a.getNode(h),n=a.getRenderObb(h),p=!0;if(null!=f.clippingBox){var q=1<<f.frustumPlanes.length;if(0===(l&q)){var r=k.toAaBoundingBox(n,d);e.contains(f.clippingBox,
r)?l|=q:e.intersects(f.clippingBox,r)||(p=!1)}}for(r=0;r<f.frustumPlanes.length&&p;r++)if(q=1<<r,0===(l&q)){var u=k.intersectPlane(n,f.frustumPlanes[r]);0<u?p=!1:0>u&&(l|=q)}if(g.predicate(h,m,p)){n=m.firstChild;m=m.childCount;r=!1;p=(n+m-1)/a.pageSize|0;for(q=n/a.pageSize|0;q<=p;q++)if(!a.hasPage(q)){g.pageMiss(h,q);r=!0;break}if(!r)for(r=0;r<m;r++)b.push(n+r),c.push(l)}}}};return d}();var h=q.mat4f64.create(),p=l.quatf32.create();return t})},"esri/views/3d/support/orientedBoundingBox":function(){define("require exports ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ./dito ./geometryUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){function p(a,c,d){return{center:k.vec3f64.clone(a),halfSize:e.vec3f32.clone(c),quaternion:b.quatf32.clone(d)}}function n(a,b){var c=h.plane.signedDistance(b,a.center);a=u(a,b);return c>a?1:c<-a?-1:0}function u(a,b){l.quat.conjugate(v,a.quaternion);f.vec3.transformQuat(r,b,v);a=a.halfSize;return Math.abs(r[0]*a[0])+Math.abs(r[1]*a[1])+Math.abs(r[2]*a[2])}Object.defineProperty(d,"__esModule",{value:!0});var v=b.quatf32.create(),r=e.vec3f32.create(),y=e.vec3f32.create(),
w=g.mat3f32.create();t=function(){return function(a){this.buffer=new ArrayBuffer(56*a);this.obbs=Array(a);for(var c=0;c<a;c++)this.obbs[c]={center:k.vec3f64.createView(this.buffer,56*c+0),halfSize:e.vec3f32.createView(this.buffer,56*c+24),quaternion:b.quatf32.createView(this.buffer,56*c+36)}}}();d.ObbArray=t;d.create=p;d.clone=function(a){return p(a.center,a.halfSize,a.quaternion)};d.set=function(a,b){f.vec3.copy(b.center,a.center);f.vec3.copy(b.halfSize,a.halfSize);l.quat.copy(b.quaternion,a.quaternion)};
d.compute=function(b,c){c||(c=p([0,0,0],[-1,-1,-1],[0,0,0,1]));a.computeOBB(b,c);return c};d.intersectPlane=n;d.toAaBoundingBox=function(a,b){b||(b=c.create());var d=q.mat3.fromQuat(w,a.quaternion),e=a.halfSize[0]*Math.abs(d[0])+a.halfSize[1]*Math.abs(d[3])+a.halfSize[2]*Math.abs(d[6]),f=a.halfSize[0]*Math.abs(d[1])+a.halfSize[1]*Math.abs(d[4])+a.halfSize[2]*Math.abs(d[7]),d=a.halfSize[0]*Math.abs(d[2])+a.halfSize[1]*Math.abs(d[5])+a.halfSize[2]*Math.abs(d[8]);b[0]=a.center[0]-e;b[1]=a.center[1]-
f;b[2]=a.center[2]-d;b[3]=a.center[0]+e;b[4]=a.center[1]+f;b[5]=a.center[2]+d;return b};d.minimumDistancePlane=function(a,b){var c=h.plane.signedDistance(b,a.center);a=u(a,b);return c-a};d.maximumDistancePlane=function(a,b){var c=h.plane.signedDistance(b,a.center);a=u(a,b);return c+a};d.isVisible=function(a,b){return 0>=n(a,b.planes[0])&&0>=n(a,b.planes[1])&&0>=n(a,b.planes[2])&&0>=n(a,b.planes[3])&&0>=n(a,b.planes[4])&&0>=n(a,b.planes[5])};d.intersectLine=function(a,b,c,d){void 0===d&&(d=0);l.quat.conjugate(v,
a.quaternion);f.vec3.subtract(r,b,a.center);b=f.vec3.transformQuat(r,r,v);c=f.vec3.transformQuat(y,c,v);for(var e=-Infinity,g=Infinity,h=0;3>h;h++)if(1E-6<Math.abs(c[h]))var k=(d+a.halfSize[h]-b[h])/c[h],m=(-d-a.halfSize[h]-b[h])/c[h],e=Math.max(e,Math.min(k,m)),g=Math.min(g,Math.max(k,m));else if(b[h]>a.halfSize[h]+d||b[h]<-a.halfSize[h]-d)return!1;return e<=g}})},"esri/views/3d/support/dito":function(){define(["require","exports"],function(t,d){function q(a,b,c,d,f,k){if(!(1E-6>b[0]*b[0]+b[1]*b[1]+
b[2]*b[2]))for(p(L,c,b),p(F,d,b),p(K,f,b),g(a,b,G),Q[1]=G[0],M[1]=G[1],P[1]=M[1]-Q[1],c=[c,d,f],d=[L,F,K],f=0;3>f;++f){g(a,c[f],G);Q[0]=G[0];M[0]=G[1];g(a,d[f],G);Q[2]=G[0];M[2]=G[1];P[0]=M[0]-Q[0];P[2]=M[2]-Q[2];var l=e(P);l<k.quality&&(h(k.b0,c[f]),h(k.b1,b),h(k.b2,d[f]),k.quality=l)}}function g(a,b,c){var d=a.data,e=a.offsetIdx;a=a.strideIdx;c[0]=Number.POSITIVE_INFINITY;for(c[1]=Number.NEGATIVE_INFINITY;e<d.length;e+=a){var f=d[e]*b[0]+d[e+1]*b[1]+d[e+2]*b[2];c[0]=Math.min(c[0],f);c[1]=Math.max(c[1],
f)}}function l(b,c,d){h(d.center,b);a(d.halfSize,c,.5);d.quaternion[0]=0;d.quaternion[1]=0;d.quaternion[2]=0;d.quaternion[3]=1}function b(a,b,c,d,e,f){g(a,b,G);e[0]=G[0];f[0]=G[1];g(a,c,G);e[1]=G[0];f[1]=G[1];g(a,d,G);e[2]=G[0];f[2]=G[1]}function f(b,c,d,e,f,g,h){W[0]=b[0];W[1]=b[1];W[2]=b[2];W[3]=c[0];W[4]=c[1];W[5]=c[2];W[6]=d[0];W[7]=d[1];W[8]=d[2];var l=h.quaternion,m=W,n=m[0]+m[4]+m[8];if(0<n)n=Math.sqrt(n+1),l[3]=.5*n,n=.5/n,l[0]=(m[5]-m[7])*n,l[1]=(m[6]-m[2])*n,l[2]=(m[1]-m[3])*n;else{var p=
0;m[4]>m[0]&&(p=1);m[8]>m[3*p+p]&&(p=2);var q=(p+1)%3,r=(p+2)%3,n=Math.sqrt(m[3*p+p]-m[3*q+q]-m[3*r+r]+1);l[p]=.5*n;n=.5/n;l[3]=(m[3*q+r]-m[3*r+q])*n;l[q]=(m[3*q+p]+m[3*p+q])*n;l[r]=(m[3*r+p]+m[3*p+r])*n}k(Z,e,f);a(Z,Z,.5);a(h.center,b,Z[0]);a(T,c,Z[1]);k(h.center,h.center,T);a(T,d,Z[2]);k(h.center,h.center,T);a(h.halfSize,g,.5)}function e(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}function k(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2]}function c(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-
c[2]}function a(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}function h(a,b,c){void 0===c&&(c=0);a[0]=b[c+0];a[1]=b[c+1];a[2]=b[c+2]}function p(a,b,c){var d=b[0],e=b[1];b=b[2];var f=c[0],g=c[1];c=c[2];a[0]=e*c-b*g;a[1]=b*f-d*c;a[2]=d*g-e*f}function n(a,b){var c=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c)}function u(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}Object.defineProperty(d,"__esModule",{value:!0});var v=[0,0,0],r=[0,0,0];d.computeOBB=
function(d,g){var t=d.data.length/d.strideIdx;if(!(0>=t)){var F=new fa(d);k(v,F.minProj,F.maxProj);a(v,v,.5);c(r,F.maxProj,F.minProj);var K=e(r),L=new ga;L.quality=K;14>t&&(d={data:new Float64Array(F.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var M=[0,0,0],Q=[0,0,0],P=[0,0,0],t=[0,0,0],T=[0,0,0],W=[0,0,0],Z=[0,0,0],z;z=d;for(var ja=u(F.maxVert[0],F.minVert[0]),ia=0,ta=1;7>ta;++ta){var Ba=u(F.maxVert[ta],F.minVert[ta]);Ba>ja&&(ja=Ba,ia=ta)}h(M,F.minVert[ia]);h(Q,F.maxVert[ia]);if(1E-6>u(M,Q))z=
1;else{c(t,M,Q);n(t,t);F=z.data;ja=z.strideIdx;ia=Number.NEGATIVE_INFINITY;ta=0;for(Ba=z.offsetIdx;Ba<F.length;Ba+=ja){I[0]=F[Ba]-M[0];I[1]=F[Ba+1]-M[1];I[2]=F[Ba+2]-M[2];var ya=t[0]*I[0]+t[1]*I[1]+t[2]*I[2],ya=I[0]*I[0]+I[1]*I[1]+I[2]*I[2]-ya*ya/(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);ya>ia&&(ia=ya,ta=Ba)}h(P,F,ta);1E-6>ia?z=2:(c(T,Q,P),n(T,T),c(W,P,M),n(W,W),p(Z,T,t),n(Z,Z),q(z,Z,t,T,W,L),z=0)}switch(z){case 1:l(v,r,g);return;case 2:K=d;h(U,t);Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?
U[0]=0:Math.abs(t[1])>Math.abs(t[2])?U[1]=0:U[2]=0;1E-6>U[0]*U[0]+U[1]*U[1]+U[2]*U[2]&&(U[0]=U[1]=U[2]=1);p(N,t,U);n(N,N);p(V,t,N);n(V,V);b(K,t,N,V,X,J);c(R,J,X);f(t,N,V,X,J,R,g);return}z=d;F=y;ja=w;ia=G;ta=z.data;ya=z.offsetIdx;Ba=z.strideIdx;h(ja,ta,ya);h(F,ja);ia[0]=O[0]*Z[0]+O[1]*Z[1]+O[2]*Z[2];ia[1]=ia[0];for(ya+=Ba;ya<ta.length;ya+=Ba){var Sa=ta[ya]*Z[0]+ta[ya+1]*Z[1]+ta[ya+2]*Z[2];Sa<ia[0]&&(ia[0]=Sa,h(ja,ta,ya));Sa>ia[1]&&(ia[1]=Sa,h(F,ta,ya))}Z=M[0]*Z[0]+M[1]*Z[1]+M[2]*Z[2];G[1]-1E-6<=Z&&
(F[0]=void 0);G[0]+1E-6>=Z&&(ja[0]=void 0);void 0!==y[0]&&(c(m,y,M),n(m,m),c(x,y,Q),n(x,x),c(A,y,P),n(A,A),p(C,x,t),n(C,C),p(B,A,T),n(B,B),p(E,m,W),n(E,E),q(z,C,t,x,m,L),q(z,B,T,A,x,L),q(z,E,W,m,A,L));void 0!==w[0]&&(c(m,w,M),n(m,m),c(x,w,Q),n(x,x),c(A,w,P),n(A,A),p(C,x,t),n(C,C),p(B,A,T),n(B,B),p(E,m,W),n(E,E),q(z,C,t,x,m,L),q(z,B,T,A,x,L),q(z,E,W,m,A,L));b(d,L.b0,L.b1,L.b2,X,J);d=[0,0,0];c(d,J,X);L.quality=e(d);L.quality<K?f(L.b0,L.b1,L.b2,X,J,d,g):l(v,r,g)}};var y=[0,0,0],w=[0,0,0],m=[0,0,0],x=
[0,0,0],A=[0,0,0],C=[0,0,0],B=[0,0,0],E=[0,0,0],I=[0,0,0],G=[0,0],L=[0,0,0],F=[0,0,0],K=[0,0,0],M=[0,0,0],Q=[0,0,0],P=[0,0,0],O=[0,0,0],U=[0,0,0],N=[0,0,0],V=[0,0,0],X=[0,0,0],J=[0,0,0],R=[0,0,0],T=[0,0,0],W=[1,0,0,0,1,0,0,0,1],Z=[0,0,0],fa=function(){return function(a){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,b,7);for(var b=b+56,c=0;7>c;++c)this.minVert[c]=new Float64Array(this.buffer,
b,3),b+=24;for(c=0;7>c;++c)this.maxVert[c]=new Float64Array(this.buffer,b,3),b+=24;for(c=0;7>c;++c)this.minProj[c]=Number.POSITIVE_INFINITY,this.maxProj[c]=Number.NEGATIVE_INFINITY;for(var b=Array(7),d=Array(7),e=a.data,f=a.strideIdx,c=a.offsetIdx;c<e.length;c+=f)a=e[c],a<this.minProj[0]&&(this.minProj[0]=a,b[0]=c),a>this.maxProj[0]&&(this.maxProj[0]=a,d[0]=c),a=e[c+1],a<this.minProj[1]&&(this.minProj[1]=a,b[1]=c),a>this.maxProj[1]&&(this.maxProj[1]=a,d[1]=c),a=e[c+2],a<this.minProj[2]&&(this.minProj[2]=
a,b[2]=c),a>this.maxProj[2]&&(this.maxProj[2]=a,d[2]=c),a=e[c]+e[c+1]+e[c+2],a<this.minProj[3]&&(this.minProj[3]=a,b[3]=c),a>this.maxProj[3]&&(this.maxProj[3]=a,d[3]=c),a=e[c]+e[c+1]-e[c+2],a<this.minProj[4]&&(this.minProj[4]=a,b[4]=c),a>this.maxProj[4]&&(this.maxProj[4]=a,d[4]=c),a=e[c]-e[c+1]+e[c+2],a<this.minProj[5]&&(this.minProj[5]=a,b[5]=c),a>this.maxProj[5]&&(this.maxProj[5]=a,d[5]=c),a=e[c]-e[c+1]-e[c+2],a<this.minProj[6]&&(this.minProj[6]=a,b[6]=c),a>this.maxProj[6]&&(this.maxProj[6]=a,d[6]=
c);for(c=0;7>c;++c)a=b[c],h(this.minVert[c],e,a),a=d[c],h(this.maxVert[c],e,a)}}(),ga=function(){return function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0}}()})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../geometry/support/aaBoundingBox ../../support/geometryUtils ../../support/geometryUtils ../../support/orientedBoundingBox ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/lib/ProgramRepository ../../webgl-engine/materials/internal/MaterialUtil ../../webgl-engine/shaders/PointRendererPrograms ../../../webgl/BufferObject ../../../webgl/renderState ../../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m){function x(a,b,c,d,e){if(c.drawScreenSpace)return c.fixedSize*b*d;e=(e?256:64)*b*d;return c.drawFixedSize?Math.min(c.fixedSize/2,e):0<c.screenMinSize?Math.min(Math.max(c.screenMinSize*b*d,a/2),e):Math.min(a/2,e)}function A(a,b,c){null==c&&(c=e.vec3f64.create());c[0]=a.origin[0]+a.coordinates[3*b];c[1]=a.origin[1]+a.coordinates[3*b+1];c[2]=a.origin[2]+a.coordinates[3*b+2];return c}var C=l.mat4f64.create(),B={positions:[{name:"aPosition",count:3,type:5126,
offset:0,stride:12,normalized:!1}],colors:[{name:"aColor",count:3,type:5121,offset:0,stride:3,normalized:!0}]};t=function(){function d(){this.didRender=!1;this.needsRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=c.create(c.POSITIVE_INFINITY);this._programRep=null;this._needsPrograms=!0;this._programScreenDepth=this._programWorldDepth=this._programScreen=this._programWorld=
null;this.tempMatrix4=g.mat4f32.create();this.tempVec3=f.vec3f32.create();this.nodes=[]}d.prototype.initializeRenderContext=function(a){this._programRep=new u(a.rctx);this._needsPrograms=this.needsRender=!0};d.prototype.uninitializeRenderContext=function(a){this._programRep.dispose();this._programScreenDepth=this._programWorldDepth=this._programScreen=this._programWorld=this._programRep=null};d.prototype.intersect=function(d,f,g,l,m){var q=e.vec3f64.create(),r=e.vec3f64.create(),u=e.vec3f64.create(),
t=e.vec3f64.create(),v=h.plane.create(),w=d.camera.perScreenPixelRatio/2,y=d.camera.near,B=this._getSizeParams();b.vec3.subtract(r,l,g);var E=1/b.vec3.length(r);b.vec3.scale(r,r,E);b.vec3.negate(u,r);k.vec4.set(v,r[0],r[1],r[2],-b.vec3.dot(r,g));var F={},G={};m=[];var I=c.create(),K=c.create(this._clipBox);c.offset(K,-g[0],-g[1],-g[2],K);for(var L=0,ga=this.nodes;L<ga.length;L++){var ja=ga[L],ia=ja.splatSize*this._scaleFactor,ka=p.minimumDistancePlane(ja.obb,v),da=p.maximumDistancePlane(ja.obb,v),
ka=ka-(B.drawScreenSpace?0:x(ia,ka+y,B,w,ja.isLeaf)),da=da-(B.drawScreenSpace?0:x(ia,da+y,B,w,ja.isLeaf)),ka=null!=F.dist&&null!=G.dist&&F.dist<ka*E&&G.dist>da*E;if(!(0>da||ka)&&(da=x(ia,da+y,B,w,ja.isLeaf),p.intersectLine(ja.obb,g,r,da))){da*=da;p.toAaBoundingBox(ja.obb,I);c.offset(I,-g[0],-g[1],-g[2],I);ka=!c.contains(K,I);b.vec3.subtract(t,ja.origin,g);for(var Y=ja.coordinates.length/3,ha=0;ha<Y;ha++)if(q[0]=t[0]+ja.coordinates[3*ha],q[1]=t[1]+ja.coordinates[3*ha+1],q[2]=t[2]+ja.coordinates[3*
ha+2],!ka||c.containsPoint(K,q)){var ea=b.vec3.dot(q,r),ma=b.vec3.squaredLength(q)-ea*ea;if(!(ma>da)){var aa=ea+y,qa=B.drawScreenSpace?0:x(ia,aa,B,w,ja.isLeaf);if(!(0>ea-qa||(aa-=qa,aa=x(ia,aa,B,w,ja.isLeaf),ma>aa*aa))){ma=this.layerUid+"/"+ja.id+"/"+ha;qa=(ea-qa)*E;if(null==F.dist||qa<F.dist)if(ea=F,null==f||f(g,l,qa))ea.point=A(ja,ha,ea.point),ea.dist=qa,ea.normal=u,ea.pointId=ma,ea.layerUid=this.layerUid;if(null==G.dist||qa>G.dist)if(ea=G,null==f||f(g,l,qa))ea.point=A(ja,ha,ea.point),ea.dist=qa,
ea.normal=u,ea.pointId=ma,ea.layerUid=this.layerUid;(null==f||f(g,l,qa))&&d.enable.storeAll&&(ea={},ea.point=A(ja,ha,ea.point),ea.dist=qa,ea.normal=u,ea.pointId=ma,ea.layerUid=this.layerUid,m.push(ea))}}}}}null!=F.dist&&(q=d.results.min,null==q.dist||F.dist<q.dist)&&(f={type:"external",point:F.point,metadata:{pointId:F.pointId,layerUid:F.layerUid}},q.set(f,F.pointId,F.dist,F.normal,C,void 0),q.intersector="PointRenderer");null!=G.dist&&(F=d.results.max,null==F.dist||G.dist>F.dist)&&(f={type:"external",
point:G.point,metadata:{pointId:G.pointId,layerUid:G.layerUid}},F.set(f,G.pointId,G.dist,G.normal,C,void 0),F.intersector="PointRenderer");if(d.enable.storeAll)for(g=a.ray.fromPoints(g,l),l=0;l<m.length;l++)ea=m[l],f={type:"external",point:ea.point,metadata:{pointId:ea.pointId,layerUid:ea.layerUid}},G=new n.IntersectorResult(g),G.set(f,ea.pointId,ea.dist,ea.normal,C,void 0),G.intersector="PointRenderer",d.results.all.push(G)};d.prototype.render=function(a){if(0!==a.pass&&1!==a.pass)return!1;for(var d=
1===a.pass,e=a.rctx,f=0,g=this.nodes;f<g.length;f++){var h=g[f];null==h.vao&&this._initNode(a,h)}this._selectPrograms();f=this._getSizeParams();g=d?f.drawScreenSpace?this._programScreenDepth:this._programWorldDepth:f.drawScreenSpace?this._programScreen:this._programWorld;if(null==g||0===this.nodes.length)return!0;var k=this._clipBox,l=!c.equals(k,c.POSITIVE_INFINITY,function(a,b){return a===b});l||(b.vec3.set(this.tempVec3,-Infinity,-Infinity,-Infinity),g.setUniform3fv("uClipMin",this.tempVec3),b.vec3.set(this.tempVec3,
Infinity,Infinity,Infinity),g.setUniform3fv("uClipMax",this.tempVec3));e.bindProgram(g);e.setPipelineState(this._pipelineState);g.setUniformMatrix4fv("uProjectionMatrix",a.camera.projectionMatrix);d&&g.setUniform2f("nearFar",a.camera.near,a.camera.far);d=a.camera.pixelRatio;f.drawFixedSize&&g.setUniform2f("uPointScale",f.fixedSize*d,a.camera.fullHeight);for(var m=this._slicePlaneEnabled?a.sliceHelper&&a.sliceHelper.plane:null,n=0,p=this.nodes;n<p.length;n++){h=p[n];g.setUniform2f("uScreenMinMaxSize",
f.screenMinSize*d,(h.isLeaf?256:64)*d);f.drawFixedSize||g.setUniform2f("uPointScale",h.splatSize*this._scaleFactor*d,a.camera.fullHeight/d);var r=h.origin;l&&(b.vec3.set(this.tempVec3,k[0]-r[0],k[1]-r[1],k[2]-r[2]),g.setUniform3fv("uClipMin",this.tempVec3),b.vec3.set(this.tempVec3,k[3]-r[0],k[4]-r[1],k[5]-r[2]),g.setUniform3fv("uClipMax",this.tempVec3));q.mat4.identity(this.tempMatrix4);q.mat4.translate(this.tempMatrix4,this.tempMatrix4,r);q.mat4.multiply(this.tempMatrix4,a.camera.viewMatrix,this.tempMatrix4);
g.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4);m&&v.bindSlicePlane(r,m,g);e.bindVAO(h.vao);e.drawArrays(0,0,h.coordinates.length/3)}return!0};Object.defineProperty(d.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(a){this._useFixedSizes!==a&&(this._useFixedSizes=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(a){this._scaleFactor!==a&&(this._scaleFactor=
a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(a){this._minSizePx!==a&&(this._minSizePx=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(a){this._useRealWorldSymbolSizes!==a&&(this._useRealWorldSymbolSizes=a,this._requestRender())},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"size",{get:function(){return this._size},set:function(a){this._size!==a&&(this._size=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"sizePx",{get:function(){return this._sizePx},set:function(a){this._sizePx!==a&&(this._sizePx=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"clippingBox",{set:function(a){c.set(this._clipBox,a||c.POSITIVE_INFINITY)},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=a,this._requestRender(),this._needsPrograms=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"intersectionHandlerId",{get:function(){return this.layerUid},enumerable:!0,configurable:!0});d.prototype.addNode=function(a){this.nodes.push(a);this._requestRender()};d.prototype.removeNode=function(a){var b=null;
this.nodes=this.nodes.filter(function(c){return c.id===a?(b=c,c.vao&&(c.vao.dispose(!0),c.vao=null),!1):!0});this._requestRender();return b};d.prototype.removeAll=function(){this.nodes.forEach(function(a){a.vao&&(a.vao.dispose(!0),a.vao=null)});this.nodes=[];this._requestRender()};d.prototype._initNode=function(a,b){a=a.rctx;b.vao=new m(a,r.program.attributes,B,{positions:y.createVertex(a,35044,b.coordinates),colors:y.createVertex(a,35044,b.rgb)})};d.prototype._requestRender=function(){this.didRender=
!1;this.needsRender=!0};d.prototype._getSizeParams=function(){var a=this._useFixedSizes,b=a&&!this._useRealWorldSymbolSizes,c=b?this._sizePx:this._size,d=this._minSizePx;a&&(d=0);return{drawScreenSpace:b,drawFixedSize:a,fixedSize:c,screenMinSize:d}};d.prototype._selectPrograms=function(){this._needsPrograms&&(this._needsPrograms=!1,this._programWorld=this._programRep.getProgram(r.program,{slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreen=this._programRep.getProgram(r.program,{drawScreenSize:!0,
slicePlaneEnabled:this._slicePlaneEnabled}),this._programWorldDepth=this._programRep.getProgram(r.program,{depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreenDepth=this._programRep.getProgram(r.program,{drawScreenSize:!0,depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._pipelineState=w.makePipelineState({depthTest:{func:513},depthWrite:w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams}))};return d}();(function(a){a.isInstanceOfNode=function(a){return a.hasOwnProperty("splatSize")}})(t||
(t={}));return t})},"esri/views/3d/webgl-engine/shaders/PointRendererPrograms":function(){define(["require","exports","./sources/resolver","../../../webgl/programUtils"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});var l=function(b){return g.glslifyDefineMap({DEPTH_PASS:b.depthPass,DRAW_SCREEN_SIZE:b.drawScreenSize,SLICE:b.slicePlaneEnabled})};d.program={name:"point-renderer",shaders:function(b){return{vertexShader:l(b)+q.resolveIncludes("pointRenderer/pointRenderer.vert"),fragmentShader:l(b)+
q.resolveIncludes("pointRenderer/pointRenderer.frag")}},attributes:{aPosition:0,aColor:1}}})},"esri/views/3d/layers/SceneLayerView3D":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array @dojo/framework/shim/Set ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingBox ../../../layers/support/fieldUtils ../../../tasks/support/Query ./I3SMeshView3D ./LayerView3D ./i3s/I3SGeometryUtil ./i3s/I3SQueryEngine ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/projectionUtils ../../layers/support/FeatureFilter".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G){var L=h.getLogger("esri.views.3d.layers.SceneLayerView3D"),F=[0,0,0,0];return function(d){function h(){var a=null!==d&&d.apply(this,arguments)||this;a._queryEngine=null;a.lodFactor=1;a.progressiveLoadFactor=1;a._elevationContext="scene";a._isIntegratedMesh=!1;return a}g(h,d);Object.defineProperty(h.prototype,"filter",{set:function(a){if(a){var b=["contains","intersects","disjoint"];a.where||a.distance||a.units||a.timeExtent||-1===b.indexOf(a.spatialRelationship)?
(L.warn("Unsupported filter: only geometry filters and spatialRelationships "+b.join(", ")+" are supported"),this._set("filter",null)):this._set("filter",a)}else this._set("filter",null)},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this.handles.add([p.init(this,["layer.renderer","definitionExpressionFields"],function(){return a._updateRequiredFields()}),p.init(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)}),p.init(this.layer,"renderer",function(b){return a._rendererChange(b)}),
this.watch(["parsedDefinitionExpression","layer.objectIdFilter","filter"],function(){return a._filterChange()})])};h.prototype.destroy=function(){};h.prototype._updateRequiredFields=function(){return f(this,void 0,void 0,function(){var a,c,d,f,g,h;return b(this,function(b){switch(b.label){case 0:return a=this,c=a.layer,d=c.fields,f=c.renderer,g=a.definitionExpressionFields,h=new k.default,f?[4,f.collectRequiredFields(h,d)]:[3,2];case 1:b.sent(),b.label=2;case 2:return v.collectFields(h,d,g),this._set("requiredFields",
e.from(h).sort()),[2]}})})};h.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&L.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};h.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)};h.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)};h.prototype.queryFeatures=function(a){return this._ensureQueryEngine().queryFeatures(a)};h.prototype.queryObjectIds=
function(a){return this._ensureQueryEngine().queryObjectIds(a)};h.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};h.prototype._createQueryEngine=function(){var a=this,b={id:0,index:0,meta:null,bbCorners:new Float64Array(24)};return new x(this.layer,{forAll:function(c,d){a._forAllFeatures(function(d,e,f){b.id=d;b.index=e;b.meta=f;a._boundingBoxCornerPoints(e,f.engineObject,b.bbCorners);c(b)},d)},createGraphic:function(b){return a._createGraphic(b.index,
b.meta)},requestFields:function(b,c,d){return A.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),d,function(c){var d=a._getGraphicIndices(b,c);return[{node:b,indices:d,graphics:c}]},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){return a._createExtentBuilder()}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})};h.prototype._createExtentBuilder=function(){var a=this.view.renderSpatialReference,b=this.view.spatialReference,c=u.empty(),d=new Float64Array(24);return{add:function(e){I.bufferToBuffer(e.bbCorners,
a,0,d,b,0,8)&&u.expandWithBuffer(c,d,0,8)},getExtent:function(){return u.toExtent(c,b)}}};h.prototype.highlight=function(a,b){void 0===b&&(b={});var c=this._highlights;if(a instanceof r){var d=c.acquireSet(b),e=d.set,d=d.handle;this.queryObjectIds(a).then(function(a){return c.setFeatureIds(e,a)});return d}return this.inherited(arguments)};h.prototype._createLayerGraphic=function(a){a=new c(null,null,a);a.layer=this.layer;a.sourceLayer=this.layer;return a};h.prototype.canResume=function(){return this.inherited(arguments)&&
(!this._controller||this._controller.rootNodeVisible)};h.prototype.isUpdating=function(){return!(!this._controller||!this._controller.updating)};h.prototype.getFilters=function(){var a=this,b=this.inherited(arguments);if(this.layer.objectIdFilter){var c=new Float64Array(this.layer.objectIdFilter.ids),d="include"===this.layer.objectIdFilter.method;c.sort();b.push(function(b){return a._objectIdFilter(c,d,b)})}this.addSqlFilter(b,this.parsedDefinitionExpression,this.definitionExpressionFields,this.logError);
this.filter&&this.filter.geometry&&b.push(function(b,c){return a._maskFilter(b,c)});return b};h.prototype._maskFilter=function(a,b){var c=this.filter.geometry;I.mbsToMbs(b.node.mbs,this._controller.crsIndex,F,c.spatialReference||this.view.spatialReference);var d=m.acquireMaskFilterContext(this.filter.spatialRelationship,this.view,c,b.engineObject),c=m.intersectMaskWithMbs(d,F);switch(m.getIntersectRelation(d,c)){case 1:a.length=0;return;case 0:return}b.engineObject.getGeometryRecords()[0].geometry.componentCount===
b.featureIds.length&&A.filterInPlace(a,b.featureIds,function(a){return m.filterMask(a,d)})};h.prototype._filterChange=function(){var a=this;this.filter&&this.filter.geometry?m.loadGeometryEngine().then(function(){return a._applyFilters(!0)}):this.inherited(arguments)};h.prototype._objectIdFilter=function(b,c,d){for(var e=0,f=0;e<d.length;)0<=a.binaryIndexOf(b,d[e])===c&&(d[f]=d[e],f++),e++;d.length=f};l([n.property()],h.prototype,"layer",void 0);l([n.property({dependsOn:["_controller.updating"]})],
h.prototype,"updating",void 0);l([n.property({dependsOn:["_controller.rootNodeVisible"]})],h.prototype,"suspended",void 0);l([n.property(B.updatingPercentage)],h.prototype,"updatingPercentage",void 0);l([n.property({type:G})],h.prototype,"filter",null);l([n.property({type:[String],readOnly:!0})],h.prototype,"requiredFields",void 0);l([n.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],h.prototype,"lodFactor",void 0);l([n.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],
h.prototype,"updatingPercentageValue",void 0);return h=l([n.subclass("esri.views.3d.layers.SceneLayerView3D")],h)}(n.declared(w,y.I3SMeshView3D,E.PopupSceneLayerView,C.DefinitionExpressionSceneLayerView))})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper dojo/errors/CancelError ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/Evented ../../../core/HandleOwner ../../../core/has ../../../core/iteratorUtils ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/requireUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../layers/graphics/controllers/I3SOnDemandController ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SElevationProvider ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/edgeUtils ./support/layerViewUpdatingProperties ./support/symbolColorUtils ../support/mathUtils ../support/orientedBoundingBox ../support/projectionUtils ../support/buffer/glUtil ../webgl-engine/Stage ../webgl-engine/lib/Geometry ../webgl-engine/lib/Layer ../webgl-engine/lib/Object3D ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/TextureBackedBuffer/BufferManager ../webgl-engine/materials/component/index module".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M,Q,P,O,U,N,V,X,J,R,T,W,Z,fa,ga,ja,ia,ka,da,Y,ha,ea,ma,aa,qa,na,sa,z,la,oa,ta){function Ba(a){return E.isArrayBuffer(a.data)}function ya(a,b){for(var c=1024,d=0;d<a.length;d++)var e=a[d],c=c+(e.interleavedVertexData.byteLength+(e.indices?e.indices.byteLength:0)),c=c+(e.positionData.data.byteLength+e.positionData.indices.byteLength);for(a=0;a<b.length;a++)d=b[a],E.isArrayBuffer(d.data)&&(c+=d.data.byteLength);return c}function Sa(a,
b){return 104857600<b.byteSize?(Wa.warn("Node is too big to store in IndexedDB cache: "+a.baseUrl+" ("+b.byteSize+" bytes)"),!1):!0}Object.defineProperty(d,"__esModule",{value:!0});var Pa=ea.ModelContentType,Wa=w.getLogger("esri.views.3d.layers.SceneLayerView3D"),fb=[1,1,1,1],Ga=[.8,.8,.8],kb=function(){return function(){}}();n=function(d){function k(){var a=null!==d&&d.apply(this,arguments)||this;a._layerUid="";a._highlights=new J(a);a._elevationProvider=null;a._worker=new V;a._workerThread=null;
a._nodeId2Meta=new Map;a._addTasks=new Map;a._rendererVersion=0;a._rendererFields=null;a._colorVariable=null;a._opacityVariable=null;a._symbolInfos=new Map;a._idbCache=new Z.IDBCache("esri-scenelayer-cache","geometries",11);a._cancelCount=0;a._hasColors=!1;a._hasTextures=!1;a._hasData=!1;a.slicePlaneEnabled=!1;a._cacheKeySuffix=null;a._tmpAttributeOnlyGraphic=new c(null,null,{});return a}g(k,d);Object.defineProperty(k.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||
this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"rendererNeedsTextures",{get:function(){return W.rendererNeedsTextures(this._currentRenderer)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"elevationOffset",{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=I.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=N.getMetersPerUnit(a.unit);return(a.offset||
0)*c/b}return 0},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"useCompressedTextures",{get:function(){var a=this.layer.version,a=!v("trident")||1<a.major||1===a.major&&3<a.minor;return this.view._stage.has("s3tc")&&a},enumerable:!0,configurable:!0});
Object.defineProperty(k.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"_atlasBiasCompensationEnabled",{get:function(){return this.view&&this.view._stage&&!this.view._stage.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0});
Object.defineProperty(k.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0});k.prototype.initialize=function(){var a=this;L.open(C.getAbsMid("./SceneLayerWorker",t,ta)).then(function(b){a.destroyed?b.close():a._workerThread=b});W.checkSceneLayerValid(this.layer);W.checkSceneLayerCompatibleWithView(this.layer,this.view);this._layerUid=this.layer.uid;this._controller=new O({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=
this.gpuMemoryEstimate=0;this._stage=this.view._stage;if(this._isIntegratedMesh||!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var b=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(b&&b.faceRange&&b.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.view.ensureEdgeView());
this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid,function(b){return a._deleteNodeStageData(b)});this._addThisLayerToStage();this._elevationProvider=new R({layerView:this,stageLayer:this._stageLayer});this.handles.add([G.init(this.view,"clippingArea",function(){return a._clippingAreaChanged()}),G.watch(this,"fullOpacity",function(b){return a._opacityChange(b)}),G.watch(this,"slicePlaneEnabled",function(b){return a._slicePlaneEnabledChange(b)}),G.watch(this,"elevationOffset",
function(b,c){return a._reloadAll(c)}),G.init(this,"filter",function(){return a._filterChange()}),G.watch(this,["rendererNeedsTextures","uncompressedTextureDownsamplingEnabled"],function(){a._reloadAll();a._memCache.clear()}),G.init(this,"suspended",function(b){return a._suspendedChange(b)})],"sceneLayerHandles");v("disable-feature:single-idb-cache")&&(this._idbCache=new Z.IDBCache("esri-scenelayer-cache-v11","geometries",11));this._idbCache.init().catch(function(a){Wa.warn("Failed to initialize IndexedDB cache: "+
a)});this._cacheKeySuffix=W.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference);this._componentColorManager=this._hasSymbolColors?new la.BufferManager(this._stage.view.renderingContext):null};k.prototype.destroy=function(){this.handles.remove("sceneLayerHandles");this._workerThread&&(this._workerThread.close(),this._workerThread=null);this._removeAllNodeDataFromStage();this._memCache.destroy();this._memCache=null;this._removeThisLayerFromStage();this._stage=null;this._idbCache&&
(this._idbCache.destroy(),this._idbCache=null);null!=this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2Meta=null;this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};k.prototype.memEstimateTextureAdded=function(a){a=a.getEstimatedTexMemRequired();this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a;return a};
k.prototype.memEstimateTextureRemoved=function(a){a=a.getEstimatedTexMemRequired();this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a};k.prototype.memEstimateGeometryAdded=function(a){a=a.estimateGpuMemoryUsage();this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=a;return a};k.prototype.memEstimateGeometryRemoved=function(a){a=a.estimateGpuMemoryUsage();this.gpuMemoryEstimate-=a;this.geoMemoryEstimate-=a};k.prototype.isNodeLoaded=function(a){return this._nodeId2Meta.has(a.id)};k.prototype.getUsedMemory=
function(){var a=0;this._nodeId2Meta.forEach(function(b){return a+=b.node.memory});return a};k.prototype.getUnloadedMemory=function(){return this._controller?this._controller.unloadedMemoryEstimate:0};k.prototype.ignoresMemoryFactor=function(){return!1};k.prototype._suspendedChange=function(a){a?(this._removeAllNodeDataFromStage(),this.view.elevationProvider.unregister(this._elevationProvider)):this.view.elevationProvider.register(this._elevationContext,this._elevationProvider)};k.prototype.getStats=
function(){var a={index:0,nodes:this._nodeId2Meta.size.toString(),"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB"};this._controller&&(this._cachingEnabled()&&(a.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a};k.prototype._addThisLayerToStage=function(){for(var a=this._stage,
b=new Uint8Array(256),c=0;c<b.length;c++)b[c]=255;b=""+this.layer.uid;this._stageLayer=b=new aa(b,{},b);a.add(Pa.LAYER,b);this._stage.addToViewContent([b.id])};k.prototype._removeThisLayerFromStage=function(){if(null!=this._stageLayer){var a=this._stage;this._removeAllNodeDataFromStage();z.verify(0===this._nodeId2Meta.size);a.remove(Pa.LAYER,this._stageLayer.id);this._stageLayer=void 0;this.gpuMemoryEstimate=0}};k.prototype.getLoadedAttributes=function(a){if((a=this._nodeId2Meta.get(a.id))&&a.attributeInfo)return a.attributeInfo.loadedAttributes};
k.prototype.getAttributeData=function(a){if((a=this._nodeId2Meta.get(a.id))&&a.attributeInfo)return a.attributeInfo.attributeData};k.prototype.setAttributeData=function(a,b){if(a=this._nodeId2Meta.get(a.id))a.attributeInfo=b,a.cachedRendererVersion=this._getInvalidRendererVersion(),a.filteredIds=null,this._updateEngineObject(a)};k.prototype.getLoadedNodeIDs=function(){return a.keysOfMap(this._nodeId2Meta)};k.prototype._calcEngineMaterialTransparencyParams=function(a,b,c){if(this._isIntegratedMesh)return{forceTransparency:!1};
var d=this.fullOpacity,e=1-ka.clamp(z.fallbackIfUndefined(b.transparency,0),0,1);a=1>e||1>d||a&&y.endsWith(a.channels,"a")||!0===b.useVertexColorAlpha||c;return{baseColorOpacity:e,layerOpacity:d,forceTransparency:!!a}};k.prototype._calcEngineMaterialDoubleSidedParams=function(a){return null!=a.doubleSided?a.doubleSided:!0};k.prototype._calcEngineMaterialCullFaceParams=function(a){return a.cullFace?a.cullFace:null!=a.doubleSided?a.doubleSided?"none":"back":"none"};k.prototype._getMaterialParameters=
function(a,b,c){var d=b.params,e=z.fallbackIfUndefined(d.diffuse,Ga);"standard"!==b.type&&Wa.warn("Unknown material type '"+b.type+"', must be 'standard'");b=this._isIntegratedMesh;a=this._calcEngineMaterialTransparencyParams(a,d);return q({baseColor:e,baseColorTexture:c,doubleSidedShading:this._calcEngineMaterialDoubleSidedParams(d),cullFace:this._calcEngineMaterialCullFaceParams(d),writeStencil:b,receiveSSAO:!b,normals:b?"ground":"vertex"},a)};k.prototype._getGeometryParameters=function(a,b){return{textureCoordinates:null!=
a,textureCoordinateRegions:b.params.vertexRegions,colors:this._hasVertexColors,componentData:this._hasSymbolColors,normals:this._isIntegratedMesh?"none":"compressed"}};k.prototype._createTexture=function(a,b,c,d,e){if(null==b)return null;a:{for(var f=0;f<d.length;f++){var g=d[f];if(g.i3sTexId===c){d=g.data;break a}}d=null}if(null==d)return null;var h=null==b?null:this._getI3STexEncoding(b),f="none"!==b.wrap[0]||"none"!==b.wrap[1],g="rgba"===b.channels,k=!0,l;h===W.DDS_ENCODING_STRING?l=sa.DDS_ENCODING:
(k=d,k=ka.isPowerOfTwo(k.width)&&ka.isPowerOfTwo(k.height));e=((b=e||!0===b.atlas)?this._enableAtlasMipMaps:this._enableMipMaps)&&k;c=new sa(d,c,{mipmap:e,wrap:b||!f?{s:33071,t:33071}:{s:10497,t:10497},disableAnisotropy:b&&e&&this._disableAtlasAnisotropy,encoding:l,noUnpackFlip:!0,components:g?4:3});this._stage.add(Pa.TEXTURE,c);a.memory+=this.memEstimateTextureAdded(c);return c};k.prototype._createEngineMaterial=function(a,b,c,d,e,f){var g=d.params.vertexRegions;a=null!=b?this._createTexture(a,b,
c,f,g):null;c=this._getMaterialParameters(b,d,a&&a.id);f=this._getGeometryParameters(b,d);e=oa.ComponentMaterial.create(c,f,e);e.metadata={i3sTex:b,i3sMatParams:d.params,engineTex:a};return e};k.prototype._getI3STexEncoding=function(a){var b=W.getAppropriateTextureEncoding(a.encoding,this.useCompressedTextures);return-1<b?a.encoding[b]:a.encoding};k.prototype._getVertexBufferLayout=function(a,b){var c=a.params.materialID,d=b.materialDefinitions[c];z.assert(void 0!==d,"geometry wants unknown material "+
c);a=a.params.textureID||"none";var e;"none"!==a&&(null!=b.textureDefinitions&&null!=b.textureDefinitions[a]||Wa.warn("textureDefinitions missing in shared resource"),e=b.textureDefinitions[a]);return ha.glLayout(oa.ComponentMaterial.vertexBufferLayout(this._getGeometryParameters(e,d)))};k.prototype._createEngineMat=function(a,b,c,d){var e=b.params.materialID,f=c.materialDefinitions[e];z.assert(void 0!==f,"geometry wants unknown material "+e);b=b.params.textureID||"none";var g;"none"!==b&&(null!=
c.textureDefinitions&&null!=c.textureDefinitions[b]||Wa.warn("textureDefinitions missing in shared resource"),g=c.textureDefinitions[b]);return this._createEngineMaterial(a,g,b,f,e,d)};k.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};k.prototype._findGraphicNodeAndIndex=function(a){var b=fa.attributeLookup(a.attributes,this._getObjectIdField()),c=null;r.everyMap(this._nodeId2Meta,function(a,d){d=a.featureIds.indexOf(b);if(-1===d)return!0;c={node:a.node,index:d};
return!1});return c};k.prototype._getGraphicIndices=function(a,b){a=this._nodeId2Meta.get(a.id);if(!a)return[];for(var c=[],d=this._getObjectIdField(),e=0;e<b.length;e++){var f=fa.attributeLookup(b[e].attributes,d),f=a.featureIds.indexOf(f);-1!==f&&c.push(f)}return c};k.prototype.whenGraphicBounds=function(a){a=this._findGraphicNodeAndIndex(a);if(!a)return A.reject();var b=this._nodeId2Meta.get(a.node.id).engineObject;a=this._boundingBoxCornerPoints(a.index,b,new Float64Array(24));if(Y.bufferToBuffer(a,
this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))return b=P.empty(),P.expandWithBuffer(b,a,0,8),A.resolve({boundingBox:b,screenSpaceObjects:[]})};k.prototype.whenGraphicAttributes=function(a,b){var c=this;return W.whenGraphicAttributes(this.layer,a,this._getObjectIdField(),b,function(a){for(var b=new Map,d=[],e=0;e<a.length;e++){var f=a[e],g=c._findGraphicNodeAndIndex(f),h=b.get(g.node);h||(h={node:g.node,indices:[],graphics:[]},d.push(h));h.indices.push(g.index);h.graphics.push(f)}return d},
{ignoreUnavailableFields:!0,populateObjectId:!0})};k.prototype.getGraphicFromStageObject=function(a,b){if(this._isIntegratedMesh)return null;var c=this._getMetadata(a);a=a.getComponentFromTriangleNr(0,b);return null!=a&&null!=c.featureIds&&a<c.featureIds.length?this._createGraphic(a,c):null};k.prototype.hasStageObject=function(a){var b=a.getMetadata();return(b=this._nodeId2Meta.get(b.i3sNode))&&b.engineObject===a};k.prototype._getMetadata=function(a){a=a.getMetadata();return this._nodeId2Meta.get(a.i3sNode)};
k.prototype._getCacheKey=function(a){return a.baseUrl+this._cacheKeySuffix};k.prototype._getMemCacheKey=function(a,b){void 0===b&&(b=this.elevationOffset);return a+"#"+b};k.prototype._cachingEnabled=function(){return!this._controller.disableIDBCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix};k.prototype.additionalCancelNodeLoadingHandler=function(){this._cancelCount=(this._cancelCount|0)+1|0};k.prototype._handleCancelled=function(a){if(0<((this._cancelCount|0)+(-a|0)|0))throw new e;};
k.prototype.loadCachedGPUData=function(a){return this._memCache.pop(this._getMemCacheKey(a.id))};k.prototype.loadCachedNodeData=function(a,b){var c=this,d=this._cancelCount;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(a)).then(function(e){if(null==e)return null;c._handleCancelled(d);if(e.nodeVersion!==a.version)return c._idbCache.remove(c._getCacheKey(a)),null;a.obb||(a.obb=da.clone(e.nodeObb),c._controller.updateVisibility(a.id));var f=function(a){if(null==a.data)return!0;var b=
c._getI3STexEncoding(e.sharedResource.textureDefinitions[a.i3sTexId]);return a.encoding!==b};return c.rendererNeedsTextures&&e.textureData.some(f)?b(e.allGeometryData,e.sharedResource).then(function(b){e.textureData=b;e.byteSize=ya(e.transformedGeometries,e.textureData);b.every(Ba)&&Sa(a,e)&&c._idbCache.put(c._getCacheKey(a),e).catch(function(b){b&&"indexedb:not-initialized"===b.name||Wa.warn("Failed to update node with textures in IndexedDB cache: "+a.id+": "+b)});c._handleCancelled(d);return e}):
e}):A.resolve(null)};k.prototype.addNodeData=function(a,b){var c=this;return this._addData(a,b.attributeDataInfo,function(){return c._transformBundle(a,b).then(function(b){return c._controller.reschedule(a.id,b)}).then(function(d){a.obb||(a.obb=d.obb,c._controller.updateVisibility(a.id));d={allGeometryData:b.allGeometryData,transformedGeometries:d.transformedGeometries,textureData:b.textureData,sharedResource:b.sharedResource,nodeVersion:a.version,nodeObb:a.obb,byteSize:c._cachingEnabled()?ya(d.transformedGeometries,
b.textureData):0};if(Sa(a,d)&&0<d.byteSize){var e=d.textureData.map(function(a){return Ba(a)?a:{i3sTexId:a.i3sTexId,encoding:a.encoding,data:null}});c._idbCache.put(c._getCacheKey(a),q({},d,{textureData:e})).catch(function(b){return Wa.warn("Failed to store node in IndexedDB cache: "+a.id+": "+b)})}return c._addCachedNodeData(a,d)})})};k.prototype._transformBundle=function(a,b){for(var c=this,d=[],e=[b.geometryBuffer],f=0,g=b.allGeometryData;f<g.length;f++)for(var h=0,k=g[f].geometries;h<k.length;h++)d.push(this._getVertexBufferLayout(k[h],
b.sharedResource));b={geometryBuffer:b.geometryBuffer,geometryData:b.allGeometryData,layouts:d,mbs:a.mbs,obb:a.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",b,{transferList:e}):
this._controller.reschedule(a.id,b).then(function(a){return c._worker.transform(a)})};k.prototype.addCachedGPUData=function(a,b){if(this._controller.isGeometryVisible(a)){this._nodeId2Meta.set(a.id,b);b.engineObject.setHidden(b.engineObject.geometryRecords[0],!1);a=0;for(var c=b.engineObject.getGeometryRecords();a<c.length;a++)c[a].material.updateParameters({slicePlaneEnabled:this.slicePlaneEnabled});this._updateEngineObject(b);this._highlights.objectCreated(b.engineObject)}else this._memCache.put(this._getMemCacheKey(a.id),
b,a.memory)};k.prototype.addCachedNodeData=function(a,b,c){var d=this;return this._addData(a,c,function(){return d._addCachedNodeData(a,b)})};k.prototype._addCachedNodeData=function(a,b){var c=this;if(this.suspended||!this._controller.isGeometryVisible(a))return A.resolve();var d=b.allGeometryData,e=b.transformedGeometries,f=b.textureData;b=b.sharedResource;if(0===d.length)return A.resolve();1!==d.length&&console.warn("Node with",d.length,"geometries is unsupported");if(!this.rendererNeedsTextures)for(var g=
0;g<f.length;g++)f[g].data=null;var h={};h[Pa.OBJECT]={};h[Pa.GEOMETRY]={};h[Pa.MATERIAL]={};var g=0,k=!1;a.memory=0;var l=d[0],d=l.componentOffsets,m=l.geometries,l=l.featureIds,n=null,p=null;if(this._hasSymbolColors)for(var n=this._componentColorManager.getBuffer(l.length),p=new Uint16Array(l.length),q=0;q<l.length;q++)p[q]=n.aquireIndex();for(var q=a.id+"|"+l[0],r=[],u=[],t=[],v=[],w=this.view,x,y=0;y<m.length;y++){var z=m[y],C=this._createEngineMat(a,z,b,f),B=e[g++];x=B.corMatrices.globalTrafo;
k=k||B.hasColors;B=new na(new Float32Array(B.interleavedVertexData),B.layout,B.positionData,d||na.DefaultOffsets,B.indices||na.DefaultIndices);this._hasSymbolColors&&this._setComponentIndices(B,p);var z=null!=z.transformation?K.mat4f64.clone(z.transformation):vb,E=r.length,B=new ma(B,q+(0<E?"_"+E:"")),E=w.renderSpatialReference;r.push(B);t.push(z);v.push(C);z=T.createOrigin(a.mbs,this.elevationOffset,this._controller.crsIndex,E);u.push(z);a.memory+=this.memEstimateGeometryAdded(B.data);h[Pa.MATERIAL][C.id]=
C;h[Pa.GEOMETRY][B.id]=B}var F=new qa({idHint:a.id,name:q,geometries:r,materials:v,transformations:t,origins:u,castShadow:!0,metadata:{i3sNode:a.id,layerUid:this._layerUid}});F.objectTransformation=x;h[Pa.OBJECT][F.id]=F;var G=this._addTasks.get(a.id),V=new kb;V.node=a;V.engineObject=F;V.featureIds=l;V.componentColorBuffer=n;V.componentIndices=p;V.cachedRendererVersion=this._getInvalidRendererVersion();V.cachedSymbolInfos=[];V.attributeInfo=G.attributeInfo;!this._hasTextures&&null!=a.textureData&&
0<a.textureData.length&&(this._hasTextures=!0);this._hasColors||(this._hasColors=k);this._hasData=!0;this.notifyChange("hasTexturesOrVertexColors");var I=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(V).then(function(){var b=c._stageLayer,d=c._stage,e=h[Pa.OBJECT],f;for(f in e)e.hasOwnProperty(f)&&b.addObject(e[f]);for(var g in h)if(h.hasOwnProperty(g)){var b=h[g],k;for(k in b)b.hasOwnProperty(k)&&null==d.get(g,k)&&d.add(g,b[k])}c._nodeId2Meta.set(a.id,V);if(c.suspended)c._removeNodeStageData(a.id);
else for(V.attributeInfo=G.attributeInfo,V.cachedRendererVersion===c._rendererVersion&&I===c.slicePlaneEnabled||c._addOrUpdateEdgeRendering(V),c._setObjectSymbology(V),c._applyFiltersToNode(V)&&c._updateEdgeRendering(V),c.visibleGeometryChanged(F),c._highlights.objectCreated(F),d=0,g=V.engineObject.getGeometryRecords();d<g.length;d++)g[d].material.updateParameters({slicePlaneEnabled:c.slicePlaneEnabled})})};k.prototype._addData=function(a,b,c){var d=this,e=this._addTasks.get(a.id);e?e.attributeInfo=
b:(e=q({},A.createResolver(),{attributeInfo:b}),this._addTasks.set(a.id,e),c().then(e.resolve,e.reject).then(function(){return d._addTasks.delete(a.id)}));return e.promise};k.prototype._clippingAreaChanged=function(){var a=P.create();Y.extentToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?this._clippingArea=a:this._clippingArea=null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};k.prototype._filterChange=function(){this._applyFilters(!1)};
k.prototype._applyFilters=function(a){var b=this;this._filters=this.getFilters();a?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(function(a){b._applyFiltersToNode(a)&&(b._addOrUpdateEdgeRendering(a),b.visibleGeometryChanged(a.engineObject))})};k.prototype.getFilters=function(){var a=this,b=[];this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,c,a._clippingArea)});return b};k.prototype.addSqlFilter=function(a,b,c,d){var e=this;b&&c&&a.push(function(a,
f){return e._sqlFilter(a,f,b,c,d)})};k.prototype._sqlFilter=function(a,b,c,d,e){var f={},g=this._createLayerGraphic(f),h=this.layer.objectIdField,k=b.featureIds,l=b.attributeInfo.attributeData;d.every(function(a){return null!=l[a]||a===h})&&W.filterInPlace(a,k,function(a){f[h]=k[a];for(var b=0;b<d.length;b++){var m=d[b];m!==h&&(f[m]=W.getCachedAttributeValue(l[m],a))}try{return c.testFeature(g)}catch(Ya){return e(Ya),!1}})};k.prototype._boundingboxFilter=function(a,b,c){Y.mbsToMbs(b.node.mbs,this._controller.crsIndex,
Ka,this.view.renderSpatialReference);var d=null!=c?W.intersectBoundingBoxWithMbs(c,Ka):2;if(2!==d)if(0===d)a.length=0;else{var e=b.engineObject.getGeometryRecords()[0].geometry;if(e.componentCount===b.featureIds.length){var f=W.getClipAABB(c,b.engineObject);W.filterInPlace(a,b.featureIds,function(a){return P.intersects(f,e.getComponentAABB(a,ua))})}}};k.prototype._addOrUpdateEdgeRendering=function(a,b){void 0===b&&(b=!0);if(!this._edgeView)return A.resolve();var c=a.engineObject,d=this._edgeView.hasObject(c),
e=this._extractObjectEdgeMaterials(a);a=e.perFeatureEdgeMaterials;var f={slicePlaneEnabled:this.slicePlaneEnabled};if(e.hasEdges)if(e=!c.isHidden(c.geometryRecords[0]),d)this._edgeView.updateAllComponentMaterials(c,a,f,b),this._edgeView.updateObjectVisibility(c,e);else{if(e)return h.safeCast(this._edgeView.addObject(c,a,f,!1))}else d&&this._edgeView.removeObject(c);return A.resolve()};k.prototype._removeEdgeRendering=function(a){this._edgeView&&this._edgeView.hasObject(a.engineObject)&&this._edgeView.removeObject(a.engineObject)};
k.prototype._applyFiltersToNode=function(a){var b=a.engineObject,c=b.areAllComponentsVisible();b.unhideAllComponents();if(0===this._filters.length)return!c;var d=a.featureIds;if(null==a.filteredIds||a.appliedFilters!==this._filters)a.filteredIds=this._computeFilteredIds(a),a.appliedFilters=this._filters;a=a.filteredIds;if(a===d)return!c;for(var c=b.getGeometryRecords()[0],e=0,f=0;f<d.length;f++){var g=d[f];e>=a.length||a[e]!==g?b.setComponentVisibility(c,f,!1):e++}return!0};k.prototype._computeFilteredIds=
function(a){for(var b=a.featureIds.slice(),c=0,d=this._filters;c<d.length;c++)(0,d[c])(b,a);return b.length===a.featureIds.length?a.featureIds:b};k.prototype._removeAllNodeDataFromStage=function(a){var b=this;void 0===a&&(a=this.elevationOffset);this._nodeId2Meta.forEach(function(c,d){return b._removeNodeStageData(d,a)})};k.prototype.removeNodeData=function(a,b){for(;0<a.length&&!b.done;){var c=a.pop();this._removeNodeStageData(c.id);b.madeProgress()}};k.prototype._removeNodeStageData=function(a,
b){void 0===b&&(b=this.elevationOffset);var c=this._nodeId2Meta.get(a);if(c){var d=c.engineObject;d.setHidden(d.geometryRecords[0],!0);this.visibleGeometryChanged(d);this._removeEdgeRendering(c);this._nodeId2Meta.delete(a);this._highlights.objectDeleted(d);this._memCache.put(this._getMemCacheKey(a,b),c,c.node.memory)}};k.prototype._deleteNodeStageData=function(a){var b=this._stage,c=this._stageLayer,d=a.engineObject;this._edgeView&&this._edgeView.removeObject(d);c.removeObject(d);for(var c=0,e=d.getGeometryRecords();c<
e.length;c++){var f=e[c];this.memEstimateGeometryRemoved(f.geometry.data);b.remove(Pa.GEOMETRY,f.geometry.id);this._removeMaterial(f.material,b)}if(a.componentIndices){for(c=0;c<a.componentIndices.length;c++)a.componentColorBuffer.releaseIndex(a.componentIndices[c]);this._componentColorManager.garbageCollect()}b.remove(Pa.OBJECT,d.id)};k.prototype._removeMaterial=function(a,b){b.remove(Pa.MATERIAL,a.id);if(a=a.metadata.engineTex)this.memEstimateTextureRemoved(a),b.remove(Pa.TEXTURE,a.id)};k.prototype.setPolygonOffset=
function(a,b){var c=this._nodeId2Meta.get(a.id);if(c)for(a=0,c=c.engineObject.getGeometryRecords();a<c.length;a++)c[a].material.updateParameters({polygonOffsetEnabled:b})};k.prototype._getInvalidRendererVersion=function(){return(this._rendererVersion|0)+-1|0};k.prototype._rendererChange=function(a){return f(this,void 0,void 0,function(){var c,d,e,f,g,h,k,l;return b(this,function(b){switch(b.label){case 0:this._currentRenderer=a;this.notifyChange("rendererNeedsTextures");this._rendererVersion=(this._rendererVersion|
0)+1|0;this._opacityVariable=this._colorVariable=this._rendererFields=null;if(!a)return[3,2];c=this;d=W.findFieldsCaseInsensitive;return[4,a.getRequiredFields(this.layer.fields)];case 1:c._rendererFields=d.apply(void 0,[b.sent(),this.layer.fields]),b.label=2;case 2:if(a&&"visualVariables"in a&&a.visualVariables)for(e=0,f=a.visualVariables;e<f.length;e++)g=f[e],"color"===g.type?this._colorVariable=g:"opacity"===g.type?this._opacityVariable=g:Wa.warn("Unsupported visual variable type for 3D Object Scene Services: "+
g.type);if(a)for(h=0,k=a.getSymbols();h<k.length;h++)l=k[h],"mesh-3d"!==l.type&&Wa.error("Symbols of type '"+l.type+"' are not supported for 3D Object Scene Services.");this._controller&&this._controller.requestUpdate();return[2]}})})};k.prototype._getSymbolInfos=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedSymbolInfos};k.prototype._getSymbolColors=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&
this._updateCachedRendererData(a);return a.cachedSymbolColors};k.prototype._updateCachedRendererData=function(a){a.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var b=a.featureIds?a.featureIds.length:1,c={},d=this._tmpAttributeOnlyGraphic;d.attributes=c;var e=this._currentRenderer,f=a.attributeInfo.attributeData,g=null!=a.featureIds?this.layer.objectIdField:null,h=null!=f?this._rendererFields:null;null==a.cachedSymbolColors&&(a.cachedSymbolColors=new Uint8Array(4*a.featureIds.length));
for(var k=a.cachedSymbolColors,l=!0,m=0;m<b;m++){null!=g&&(c[g]=a.featureIds[m]);if(null!=h)for(var n=0,p=h;n<p.length;n++){var q=p[n];f[q]&&(c[q]=W.getCachedAttributeValue(f[q],m))}p=e&&e.getSymbol(d);n=null;p instanceof U&&(this._symbolInfos.has(p.id)||this._symbolInfos.set(p.id,W.getSymbolInfo(p)),n=this._symbolInfos.get(p.id));a.cachedSymbolInfos[m]=n;var r=q=null,u=!0,p=!0;e&&"visualVariables"in e&&(this._colorVariable&&(u=e.getColor(d,{colorInfo:this._colorVariable,color:wa}))&&(q=Ia,q[0]=u.r/
255,q[1]=u.g/255,q[2]=u.b/255,this._opacityVariable||null===u.a||(r=u.a)),this._opacityVariable&&(r=e.getOpacity(d,{opacityInfo:this._opacityVariable})));n&&n.material?(u=n.material,q=null==q||null==r?X.overrideColor(q,r,u.color,u.alpha,fb,Ia):X.overrideColor(q,r,null,null,fb,Ia),ia.encodeSymbolColor(q,u.colorMixMode,k,4*m),u=n.castShadows):(ia.encodeSymbolColor(null,null,k,4*m),u=!0);if(0<m&&l){for(n=4*(m-1);n<4*m;n++)k[n]!==k[n+4]&&(l=!1);u!==p&&(l=!1)}p=u}a.uniformSymbolColor=l}};k.prototype._extractObjectEdgeMaterials=
function(a){var b=[],c=a.engineObject,d=a.featureIds?a.featureIds.length:1,e={opacity:this.fullOpacity},f=this._edgeView.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),g=!1,h=null,k=null;a=this._getSymbolInfos(a);for(var l=0;l<d;l++){var n=a[l];c.getComponentVisibility(c.getGeometryRecords()[0],l)&&n?(k!==n&&(k=n,(h=ga.createMaterialFromEdges(this._edgeView,n.edges,e))&&(g=!0)),b.push(m.isSome(h)?h:f)):b.push(f)}return{hasEdges:g,perFeatureEdgeMaterials:b}};k.prototype._setObjectSymbology=function(a){if(this._hasSymbolColors){var b=
a.featureIds?a.featureIds.length:1,c=this._getSymbolColors(a);if(a.uniformSymbolColor){var d=ia.decodeSymbolColor(c,0),e=d.color,d=d.colorMixMode,c=!0;a.cachedSymbolInfos[0]&&(c=a.cachedSymbolInfos[0].castShadows);for(var f=0,g=a.engineObject.getGeometryRecords();f<g.length;f++)b=g[f],b=b.material,b.updateParameters({componentData:{castShadows:c,externalColor:e,externalColorMixMode:d}});this._updateObjectOpacity(a.engineObject,1>e[3])}else{e=a.componentColorBuffer.textureBuffer;d=!0;for(f=0;f<b;f++){var g=
4*f,h=a.componentIndices[f],k=1;a.cachedSymbolInfos[f]&&(k=!0===a.cachedSymbolInfos[f].castShadows?1:0);e.setData(h,0,c[g],c[g+1],c[g+2]&254|k,c[g+3]);d=d&&ia.isOpaqueSymbolColor(c,g)}c=0;for(f=a.engineObject.getGeometryRecords();c<f.length;c++)b=f[c],b=b.material,b.updateParameters({componentData:e});this._updateObjectOpacity(a.engineObject,!d);this._stage.setNeedsRender()}}};k.prototype._setComponentIndices=function(a,b){for(var c=a.getAttribute(z.VertexAttrConstants.COMPONENTINDEX),d=c.data,e=
c.offsetIdx,c=c.strideIdx,f=a.getIndices(z.VertexAttrConstants.COMPONENTINDEX),g=0;g<b.length;g++)for(var h=a.componentOffsets[g+1],k=a.componentOffsets[g];k<h;k++)d[e+f[k]*c]=b[g]};k.prototype._reloadAll=function(a){void 0===a&&(a=this.elevationOffset);this._removeAllNodeDataFromStage(a);null!=this._controller&&this._controller.restartNodeLoading()};k.prototype._opacityChange=function(a){var b=this;this._nodeId2Meta.forEach(function(a){b._updateObjectOpacity(a.engineObject);b._updateEdgeRendering(a)})};
k.prototype._updateObjectOpacity=function(a,b){var c=0;for(a=a.getGeometryRecords();c<a.length;c++){var d=a[c].material,e=d.metadata;void 0!==b&&(e.symbolIsTransparent=b);e=this._calcEngineMaterialTransparencyParams(e.i3sTex,e.i3sMatParams,e.symbolIsTransparent);d.updateParameters(e)}};k.prototype._updateEngineObject=function(a){this._setObjectSymbology(a);this._applyFiltersToNode(a);this._addOrUpdateEdgeRendering(a);this.visibleGeometryChanged(a.engineObject)};k.prototype._slicePlaneEnabledChange=
function(a){var b=this,c={slicePlaneEnabled:a};this._stageLayer.isSliceable=a;this._nodeId2Meta.forEach(function(a){for(var d=0,e=a.engineObject.getGeometryRecords();d<e.length;d++)e[d].material.updateParameters(c);b._updateEdgeRendering(a,!1)})};k.prototype._updateEdgeRendering=function(a,b){void 0===b&&(b=!0);this._edgeView&&this._edgeView.hasObject(a.engineObject)&&this._addOrUpdateEdgeRendering(a,b)};k.prototype._forAllFeatures=function(a,b,c){var d=this;this._nodeId2Meta.forEach(function(e,f){d._forAllFeaturesOfNode(e,
a,c);b&&b(e.node)})};k.prototype._forAllFeaturesOfNode=function(a,b,c){for(var d=a.featureIds,e=a.engineObject.getGeometryRecords()[0],f=0;f<d.length;f++)(c||a.engineObject.getComponentVisibility(e,f))&&b(d[f],f,a,e)};k.prototype._createGraphic=function(a,b){var c={};null!=b.featureIds&&(c[this._getObjectIdField()]=b.featureIds[a]);b=b.attributeInfo.attributeData;if(null!=b)for(var d=0,e=Object.keys(b);d<e.length;d++){var f=e[d];c[f]=W.getCachedAttributeValue(b[f],a)}return this._createLayerGraphic(c)};
k.prototype._boundingBoxCornerPoints=function(a,b,c){a=b.geometries[0].getComponentAABB(a,gb);for(var d=0;8>d;++d)Qa[0]=d&1?a[0]:a[3],Qa[1]=d&2?a[1]:a[4],Qa[2]=d&4?a[2]:a[5],M.vec3.transformMat4(Qa,Qa,b.objectTransformation),c[3*d]=Qa[0],c[3*d+1]=Qa[1],c[3*d+2]=Qa[2];return c};k.prototype.highlight=function(a,b){var d=this;void 0===b&&(b={});var e=this._highlights;"number"===typeof a?a=[a]:a instanceof c?a=[a]:a instanceof p&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof c){a=
a.map(function(a){return fa.attributeLookup(a.attributes,d._getObjectIdField())});var f=e.acquireSet(b);b=f.set;f=f.handle;e.setFeatureIds(b,a);return f}if("number"===typeof a[0])return f=e.acquireSet(b),b=f.set,f=f.handle,e.setFeatureIds(b,a),f}return Ua};k.prototype.visibleGeometryChanged=function(a){var b=this;a?this._elevationProvider.objectChanged(a):this._elevationProvider.layerChanged();null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=B.schedule(function(){b.emit("visible-geometry-changed");
b._visibleGeometryChangedSchedulerHandle=null}))};k.prototype.test=function(){return{controller:this._controller}};l([F.property()],k.prototype,"view",void 0);l([F.property()],k.prototype,"layer",void 0);l([F.property()],k.prototype,"_controller",void 0);l([F.property({dependsOn:["_controller.updating"]})],k.prototype,"updating",void 0);l([F.property({dependsOn:["_controller.rootNodeVisible"]})],k.prototype,"suspended",void 0);l([F.property(ja.updatingPercentage)],k.prototype,"updatingPercentage",
void 0);l([F.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],k.prototype,"updatingPercentageValue",void 0);l([F.property({readOnly:!0})],k.prototype,"hasTexturesOrVertexColors",null);l([F.property({readOnly:!0})],k.prototype,"rendererNeedsTextures",null);l([F.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],k.prototype,"elevationOffset",null);l([F.property({type:Boolean})],k.prototype,"slicePlaneEnabled",void 0);l([F.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled",
"useCompressedTextures"]})],k.prototype,"uncompressedTextureDownsamplingEnabled",null);l([F.property({dependsOn:["layer.version"]})],k.prototype,"useCompressedTextures",null);return k=l([F.subclass("esri.views.3d.layers.I3SMeshView3D")],k)}(F.declared(u,n,x));d.I3SMeshView3D=n;var vb=K.mat4f64.create(),Qa=Q.vec3f64.create(),gb=P.create(),ua=P.create(),Ia=[0,0,0,0],wa=new k([0,0,0,0]),Ka=[0,0,0,0],Ua={remove:function(){},pause:function(){},resume:function(){}}})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/errors/CancelError ../../../core/Accessor ../../../core/arrayUtils ../../../core/Evented ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../support/PromiseQueue ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/support/index ../../../views/3d/support/projectionUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L){function F(a,b){return a.length===b.length&&a.every(function(a){return 0<=K(b,a.name)})}function K(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b)return c;return-1}function M(a){return null!=a&&null!=a.loadedAttributes&&null!=a.attributeData}var Q=a.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");t=function(a){function b(b){b=a.call(this)||this;b.screenSizeFactor=0;b.featureTarget=
5E4;b.fixedFeatureTarget=!1;b.updating=!0;b.updatingPercentage=0;b.leafsReached=!1;b.uncompressedTextureDownsamplingEnabled=!1;b._featureLOD=1;b._stableFeatureLOD=!1;b._isIdle=!1;b._cameraDirty=!0;b._invisibleDirty=!1;b._downloadingNodes=new Set;b._loadingNodes=new Set;b._updatingNodes=new Map;b._progressMaxNumNodes=1;b._poi=y.vec3f64.create();b._requiredAttributesDirty=!0;b._updatesDisabled=!1;b.disableIDBCache=!1;b.disableMemCache=!1;b._restartNodeLoading=!1;b._fields=null;b._attributeStorageInfo=
null;b._handles=new k;b._idleQueue=new m.PromiseQueue;b._errorCount=0;return b}q(b,a);Object.defineProperty(b.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isGraphics3D",{get:function(){return"points"===this.layer.profile},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.getStreamDataSupplier(G.ClientType.SCENE,
{trackRequests:!0})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"crsVertex",{get:function(){return E.getVertexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"crsIndex",{get:function(){return E.getIndexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rootNodeVisible",{get:function(){var a=this._rootNodeId&&this.getNode(this._rootNodeId);return a&&this._viewportQueries?(this._updateViewData(),this._viewportQueries.isNodeVisible(a)):
!0},enumerable:!0,configurable:!0});b.prototype.initialize=function(){var a=this;this._lodHandling=new C(this.layerView,function(){return a.updatingChanged()});var b=this.layerView.layer;this.layer=b;this._defaultGeometrySchema=b.store.defaultGeometrySchema;this._rootNodeUrl=b.store.rootNode;var d=this._rootNodeUrl.split("/");this._rootNodeId=d[d.length-1];this.disableIDBCache=c("disable-feature:idb-cache");"fields"in b&&(this._fields=b.fields,this._attributeStorageInfo=b.attributeStorageInfo);b=
n.all([this.layer.when(),this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){var b=a.layerView.view;a.setClippingArea(b.clippingArea);a._centerOnSurface=b.pointsOfInterest.centerOnSurfaceFrequent;var c=a.layerView.view.resourceController;a._handles.add([a._centerOnSurface.watch("renderLocation",function(){return a._pointOfInterestChanged()}),c.memoryController.events.on("quality-changed",function(){return a._setCameraDirty()}),u.init(a.layerView,"suspended",
function(b){var d=b?function(){return a._updateViewData()}:function(){return a._updateIdleState(!0)};b=b?function(){}:function(){return a._updateIdleState(!1)};a._idleStateCallbacks?(a.restartNodeLoading(),a._idleStateCallbacks.idleBegin=d,a._idleStateCallbacks.idleEnd=b):a._idleStateCallbacks=c.scheduler.registerIdleStateCallbacks(d,b)}),x.addTask(a.layerView.view.resourceController.scheduler,function(b,c){a._frame(b,c);return a._index?a._index.getPriority():-Infinity}),a.watch("uncompressedTextureDownsamplingEnabled",
function(){return a.restartNodeLoading()}),a.watch(["featureTarget","fixedFeatureTarget"],function(){a._setCameraDirty();a._stableFeatureLOD=!1}),b.state.watch("camera",function(){return a._setCameraDirty()}),a.layer.watch("elevationInfo",function(){return a._elevationInfoChanged()}),a.layerView.watch("lodFactor",function(){return a._setCameraDirty()}),a.layerView.watch("requiredFields",function(){return a._requiredFieldsChange()})]);a._viewportQueries=new I(a.crsIndex,b.renderCoordsHelper,b.state.camera,
a._clippingArea,b.elevationProvider,a.layer.elevationInfo,{progressiveLoadFactor:a._getProgressiveLoadFactor(a.layer),screenspaceErrorBias:a.lod,angleDependentLoD:.5>a.lod});a._index=new A.I3SIndex(a.getBaseUrl(),a._rootNodeUrl,a._rootNodeId,a.streamDataSupplier,a._viewportQueries,Q,function(b){return a.layerView.isNodeLoaded(b)},function(b){return a._shouldLoadNode(b)},function(b){return a._enableFromGPUCache(b)},function(b){return a._needsUpdate(b)})}});this.addResolvingPromise(b);this.when(function(){return a._startNodeLoading()})};
b.prototype.destroy=function(){this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;P.prune()};b.prototype._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.requiredFields)return[];var a=this._attributeStorageInfo,b=this._fields,c=this.layer.objectIdField;return this.layerView.requiredFields.map(function(c){var d=K(a,c);c=K(b,c);return 0<=d&&0<=c?
{index:d,name:b[c].name,field:b[c],attributeStorageInfo:a[d]}:null}).filter(function(a){return null!=a&&a.name!==c})};b.prototype._requiredFieldsChange=function(){F(this._requiredAttributes,this._getRequiredAttributes())||this.requestUpdate()};b.prototype.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};b.prototype.setClippingArea=function(a){var b=w.create();L.extentToBoundingBox(a,b,this.layerView.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=
null};b.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.setPointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=O.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate())))};b.prototype._calculatePointOfInterest=function(a){var b=this._centerOnSurface.renderLocation,c=y.vec3f64.create();r.vec3.subtract(c,b,this.camPos);var d=this.layerView.view.renderCoordsHelper,
e=y.vec3f64.create();d.worldUpAtPosition(b,e);c=r.vec3.angle(e,c)-.5*Math.PI;r.vec3.lerp(a,this.camPos,b,Math.max(0,Math.min(1,c/(.5*Math.PI))));return a};b.prototype.updateClippingArea=function(a){this.setClippingArea(a);this._cameraDirty=!0;this._viewportQueries&&this._viewportQueries.updateExtent(this._clippingArea)};b.prototype._setCameraDirty=function(){this._cameraDirty=!0;this.notifyChange("rootNodeVisible");this.updatingChanged()};b.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path};
b.prototype.getNode=function(a){return this._index?this._index.getNode(a):null};b.prototype.updateElevationChanged=function(a,b,c){c.clear();var d=this.getNode(this._rootNodeId);null!=d&&E.findIntersectingNodes(a,b,d,this.crsIndex,this._index,function(a){return c.push(a)});for(a=0;a<c.length;a++)b=c.data[a],this._viewportQueries.invalidateCache(b.id),b.id===this._rootNodeId&&this.notifyChange("rootNodeVisible");c.length&&this.restartNodeLoading()};b.prototype._elevationInfoChanged=function(){this._viewportQueries.updateElevationInfo(this.layer.elevationInfo);
this._setCameraDirty()};b.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this.updatingChanged()};b.prototype.schedule=function(a,b){var c=this;return this._idleQueue.push(b).then(function(b){if(!c._loadingNodes.has(a)&&!c._updatingNodes.has(a))throw new l;return b})};b.prototype.reschedule=function(a,b){var c=this;return this._idleQueue.unshift(b).then(function(b){if(!c._loadingNodes.has(a)&&!c._updatingNodes.has(a))throw new l;return b})};Object.defineProperty(b.prototype,"unloadedMemoryEstimate",
{get:function(){return!this._index||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor},enumerable:!0,configurable:!0});b.prototype._frame=function(a,b){this.layerView.suspended?this._updateView(a):(this._viewportQueries&&this._viewportQueries.setCameraIdle(!this._cameraDirty),this.layerView.visible&&this._processLogError(a,b))};b.prototype._processLogError=function(a,b){try{this._process(a,b)}catch(J){50>this._errorCount?Q.error("Error during processing: "+J):50===
this._errorCount&&Q.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};b.prototype._process=function(a,b){var c=this;this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading());if(null!=this._nodeLoader&&null!=this._index){this._updateView(a);a.run(function(){return c._processIndex(b,a)});this._updateFeatureLOD();for(a.run(function(){return c._processNodes(a,b)});!a.done&&this._idleQueue.process();)a.madeProgress();a.run(function(){return c._prefetchIndex(b)});
b.numIndexLoading+=this._index.getIndexLoading();b.numNodesLoading+=this._downloadingNodes.size;this.updatingChanged();this._lodHandling.lodGlobalHandling(a)}};b.prototype._processIndex=function(a,b){a=Math.min(10-a.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,a));this._index.update(f.keysOfSet(this._loadingNodes),b);b=this._index.getFeatureEstimate().leafsReached;this._index.isLoading()||b===this._get("leafsReached")||this._set("leafsReached",b);return this._index.load(a)};
b.prototype._prefetchIndex=function(a){if(0<this._loadingNodes.size||0<this._index.updates.add.length)return!1;a=Math.min(10-a.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,a));return this._index.prefetch(a)};b.prototype._updateFeatureLOD=function(){if(this.isGraphics3D){var a=!this._index.isLoading(),b=this.featureTarget*this.baseLOD,c=this._index.getFeatureEstimate();c.estimate=c.estimate||b/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;
this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(a&&c.estimate<b){if(c.leafsReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(b/c.estimate,1.001));a=this.lod;b=this._index.checkFeatureTarget(b,a);b!==a&&(this._featureLOD=b/this.baseLOD,this._stableFeatureLOD=!0)}else if(c.estimate>1.2*b||a&&c.estimate>b){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(c.estimate/b-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,
Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.requestUpdate()}};b.prototype._processNodes=function(a,b){var c=(this._isIdle?100:2)-this._loadingNodes.size,d=this._index.updates;d.cancel.forEach(this._cancelNodeIdLoading,this);for(d.cancel=[];0<d.update.length&&!a.done;)this._updateLoadedNode(d.update.pop()),a.madeProgress();for(;0<d.add.length&&!a.done&&0<c;){--c;if(d.add.back().notInCache&&!this._hasNodeLoadToken(b))break;var e=d.add.pop();
this._loadNode(e);a.madeProgress()}return a.hasProgressed};b.prototype._cancelNodeLoading=function(){var a=this;this._loadingNodes.clear();this._downloadingNodes.clear();this._updatingNodes.forEach(function(b,c){return a._updatingNodes.get(c).cancel()});this._updatingNodes.clear()};b.prototype._cancelNodeIdLoading=function(a){this._loadingNodes.delete(a);this._downloadingNodes.delete(a)};b.prototype._getAvailableLoadTokens=function(a,b){var c=b.numIndexLoading+this._index.getIndexLoading();return Math.floor((12-
1*c-2*(b.numNodesLoading+this._loadingNodes.size))/a)};b.prototype._hasNodeLoadToken=function(a){var b=this._isIdle&&!this._index.isLoading()?5:2;return a.numNodesLoading+this._loadingNodes.size>=b?!1:0<this._getAvailableLoadTokens(2,a)};b.prototype.updatingChanged=function(){var a=(this._index?this._index.getIndexMissing():0)+3*(this._index?this._index.updates.add.length:0)+2*this._loadingNodes.size,b=!(!(0<a||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length||
this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&this._isIdle);0===a&&(this._progressMaxNumNodes=1);this._progressMaxNumNodes=Math.max(a,this._progressMaxNumNodes);b!==this._get("updating")&&this._set("updating",b);a=100*a/this._progressMaxNumNodes;a!==this._get("updatingPercentage")&&this._set("updatingPercentage",a)};b.prototype._updateView=function(a){this._updateViewData();this._invisibleDirty&&this._removeInvisibleNodes(a)&&(this._invisibleDirty=!1)};b.prototype._updateViewData=
function(){if(this._cameraDirty&&this._index){var a=this.layerView.view,b=a.state.camera;this.camPos=y.vec3f64.clone(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/(b.perScreenPixelRatio/2);this._poi=this._calculatePointOfInterest(this._poi);this._viewportQueries.updateCamera(b);this._viewportQueries.setPointOfInterest(this._poi);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.progressiveLoadPenalty=O.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();
this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};b.prototype._getProgressiveLoadFactor=function(a){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};Object.defineProperty(b.prototype,"lod",{get:function(){return this._featureLOD*this.baseLOD},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"baseLOD",{get:function(){var a=this.layerView.lodFactor,b=this.layerView.view.resourceController.memoryController.memoryFactor;
return this.fixedFeatureTarget?1:(0<a?a:1)*b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"lodDropFactor",{get:function(){return this.fixedFeatureTarget?1:2*Math.min(this.layerView.view.resourceController.memoryController.memoryFactor,.5)},enumerable:!0,configurable:!0});b.prototype.isGeometryVisible=function(a){return this._viewportQueries.isGeometryVisible(a)};b.prototype.updateVisibility=function(a){return this._viewportQueries.updateNode(a)};b.prototype._shouldLoadNode=function(a){return!this._lodHandling.shouldLoadNode(a)||
this._shouldDropNode(a)?!1:a.obb?this._viewportQueries.isGeometryVisible(a):!0};b.prototype._shouldDropNode=function(a){var b=this.lodDropFactor;return 1>b&&this._lodHandling.childrenEmpty(a)&&this._viewportQueries.calcCameraDistance(a)>this._viewportQueries.maxDistance*b};b.prototype._startNodeLoading=function(){var a=this;this._restartNodeLoading=!1;if(!this._updatesDisabled&&null!=this.streamDataSupplier){this._updateViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),
this._requiredAttributesDirty=!1);var b=B.TextureFormat.Normal;this.layerView.useCompressedTextures?b=B.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(b=B.TextureFormat.Downsampled);var c=this._defaultGeometrySchema;this._nodeLoader=new B(this.streamDataSupplier,Q,c,this._requiredAttributes,{textureFormat:b,loadTextureData:this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==c||null==c.ordering});b=this.layerView.view.renderSpatialReference;b=this.crsIndex.equals(b)||
this.crsIndex.isWGS84&&b.equals(L.SphericalECEFSpatialReference);this._index.ignoreServiceOBB=!b;this._index.requestUpdate();this._lodHandling.startNodeLoading(function(b){return a._viewportQueries.isNodeVisible(b)},function(b){return a._viewportQueries.isGeometryVisible(b)},function(b){return a._index.nodeTraversalState(b)},function(b,c){return a._removeNodes(b,c)},this._index,this._rootNodeId,{maxLodLevel:this._viewportQueries.maxLodLevel});this.updatingChanged()}};b.prototype.isNodeLoading=function(){return null!=
this._nodeLoader&&null!=this._index};b.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this._nodeLoader.cancelAll(),this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._cancelNodeLoading(),this._nodeLoader=null,this.layerView.additionalCancelNodeLoadingHandler&&this.layerView.additionalCancelNodeLoadingHandler(),this.updatingChanged())};b.prototype._removeInvisibleNodes=function(a){var b=this.layerView.getLoadedNodeIDs();P.clear();for(var c=0;c<b.length;c++){var d=this.getNode(b[c]);
if(!this._viewportQueries.isGeometryVisible(d)||this._shouldDropNode(d))this._lodHandling.setLodGlobalDirty(),P.push(d)}this._removeNodes(P,a);if(0===P.length)return!0;P.clear();return!1};b.prototype._removeNodes=function(a,b){0<a.length&&this._index.requestUpdate();this.layerView.removeNodeData(a,b)};b.prototype._needsUpdate=function(a){if(null==a.featureData||0===a.featureData.length||this._updatingNodes.has(a.id))return!1;a=this.layerView.getLoadedAttributes(a);return null!=a&&a!==this._requiredAttributes};
b.prototype._updateLoadedNode=function(a){var b=this,c=this.layerView.getLoadedAttributes(a),c=F(c,this._requiredAttributes)?n.resolve(this.layerView.getAttributeData(a)):this._nodeLoader.loadAttributes(a,this._requiredAttributes);this._updatingNodes.set(a.id,c);c.then(function(c){return b.schedule(a.id).then(function(){return b.layerView.setAttributeData(a,{loadedAttributes:b._requiredAttributes,attributeData:c})})}).catch(function(c){c instanceof l||b.layerView.setAttributeData(a,{loadedAttributes:b._requiredAttributes,
attributeData:{}})}).catch(function(){}).then(function(){b._updatingNodes.delete(a.id);b.updatingChanged()});this.updatingChanged()};b.prototype._loadNode=function(a){var b=this;this._loadingNodes.add(a.id);this.updatingChanged();this._loadAndAddBundle(a).catch(function(a){return a}).then(function(){b._loadingNodes.delete(a.id);b.updatingChanged()})};b.prototype._loadAndAddBundle=function(a){var b=this;1!==a.featureData.length&&Q.warn("Node ${node.id} has ${node.featureData.length} bundles. Only the first bundle will be loaded.");
return a.notInCache?this._loadUncached(a):this._loadCached(a).then(function(c){c||(a.notInCache=!0,b._index.updates.add.push(a))}).catch(function(b){b instanceof l||(a.notInCache=!0)})};b.prototype._enableFromGPUCache=function(a){if(this.disableMemCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var b=this.layerView.loadCachedGPUData(a);if(!b||!M(b.attributeInfo)||!F(b.attributeInfo.loadedAttributes,this._requiredAttributes))return!1;this.layerView.addCachedGPUData(a,
b);this._nodeAdded(a);return!0};b.prototype._nodeAdded=function(a){this._index.requestUpdate();this._lodHandling.lodSwapBundleLoaded(a)};b.prototype._loadCached=function(a){var b=this;if(this._enableFromGPUCache(a))return n.resolve(!0);var c=this.layerView;return!this.disableIDBCache&&c.loadCachedNodeData&&c.addCachedNodeData?this.schedule(a.id).then(function(){return c.loadCachedNodeData(a,function(a,c){return b._nodeLoader.loadTextures(a,c)})}).then(function(d){if(null==d)return!1;var e=b._requiredAttributes;
return M(d)&&F(d.loadedAttributes,e)?b.reschedule(a.id).then(function(){return c.addCachedNodeData(a,d,d)}).then(function(){b._nodeAdded(a);return!0}):b.reschedule(a.id).then(function(){return b._nodeLoader.loadAttributes(a,e)}).then(function(c){return b.reschedule(a.id,{loadedAttributes:e,attributeData:c})}).then(function(b){return c.addCachedNodeData(a,d,b)}).then(function(){b._nodeAdded(a);return!0})}):n.resolve(!1)};b.prototype._loadUncached=function(a){var b=this;this._downloadingNodes.add(a.id);
return this._nodeLoader.loadBundleData(a,0).then(function(c){b._downloadingNodes.delete(a.id);return b.schedule(a.id,c)}).then(function(c){return b.layerView.addNodeData(a,c)}).then(function(){b._nodeAdded(a);a.notInCache=!1}).catch(function(c){c instanceof l||(Q.error("Failed to load node '"+a.id+"' bundle 0: "+c),a.failed=!0,b._index.requestUpdate())})};b.prototype._updateIdleState=function(a){a!==this._isIdle&&(this._isIdle=a,this._viewportQueries&&this._viewportQueries.setCameraIdle(a),this.updatingChanged(),
a&&this._index&&this._index.resetFailedNodes())};b.prototype.updateStats=function(a){a.index=this._index?this._index.size:0;this.isGraphics3D&&(a.detail=this._featureLOD,a.target=this.featureTarget*this.baseLOD);this._index&&this._index.updateStats(a)};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{set disableIDBCache(b){a.disableIDBCache=b},set ignoreServiceOBB(b){a._index.ignoreServiceOBB=b}}},enumerable:!0,configurable:!0});g([v.property({readOnly:!0})],b.prototype,
"isMeshPyramid",null);g([v.property({readOnly:!0})],b.prototype,"isGraphics3D",null);g([v.property({readOnly:!0})],b.prototype,"streamDataSupplier",null);g([v.property({readOnly:!0})],b.prototype,"crsVertex",null);g([v.property({readOnly:!0})],b.prototype,"crsIndex",null);g([v.property()],b.prototype,"camPos",void 0);g([v.property()],b.prototype,"screenSizeFactor",void 0);g([v.property()],b.prototype,"featureTarget",void 0);g([v.property()],b.prototype,"fixedFeatureTarget",void 0);g([v.property()],
b.prototype,"layerView",void 0);g([v.property()],b.prototype,"layer",void 0);g([v.property({readOnly:!0})],b.prototype,"updating",void 0);g([v.property({readOnly:!0})],b.prototype,"updatingPercentage",void 0);g([v.property({readOnly:!0})],b.prototype,"leafsReached",void 0);g([v.property({readOnly:!0})],b.prototype,"rootNodeVisible",null);g([v.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled?"})],b.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return b=g([v.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],
b)}(v.declared(b,p,e));var P=new h,O={factorIM:.2,factor3dObject:.05,distancePenalty:10};return t})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["require","exports","../../../../core/arrayUtils"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});var g=function(){function b(b){var d=this;this.referenceCount=0;this.callbacks=[];this.runIndex=0;this.handle=b.registerTask(2,function(b){return d.update(b)},function(){return!0})}b.prototype.destroy=function(){this.handle&&
(this.handle.remove(),this.handle=null)};b.prototype.update=function(b){this.sort();for(var d=this.callbacks,f={numIndexLoading:0,numNodesLoading:0},c=0;c<d.length&&!b.done;++c)d[c].priority=d[c](b,f),this.runIndex=c};b.prototype.sort=function(){for(var b=this.callbacks,d=b.length,g=this.runIndex;0<g;g--){for(var c=b[g-1],a=g;a<b.length&&c.priority<=b[a].priority&&(a!==d||c.priority<b[a].priority);)b[a-1]=b[a],a++;b[a-1]=c;d=a-1}this.runIndex=0};b.prototype.add=function(b){this.sort();b.priority=
Infinity;this.callbacks.unshift(b)};b.prototype.remove=function(b){q.removeUnordered(this.callbacks,b);this.runIndex=this.callbacks.length;this.sort()};return b}(),l=new Map;d.addTask=function(b,d){var e=l.get(b);null==e&&(e=new g(b),l.set(b,e));e.add(d);return{remove:function(){null!=e&&(e.remove(d),0<e.callbacks.length||(l.delete(b),e.destroy()),e=null)}}}})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("require exports ../../../../core/tsSupport/assignHelper dojo/errors/CancelError ../../../../core/PooledArray ../../../../core/urlUtils ../../support/orientedBoundingBox".split(" "),
function(t,d,q,g,l,b,f){Object.defineProperty(d,"__esModule",{value:!0});var e="version level sharedResource attributeData geometryData textureData lodSelection".split(" ");t=function(){function d(a,d,e,f,g,h,k,m,q,t){var n=this;this.rootId=e;this.streamDataSupplier=f;this.viewportQueries=g;this.logger=h;this._isLoaded=k;this._isSelected=m;this._enable=q;this._needsUpdate=t;this._dirty=!0;this.nodeIndex={};this._loadingNodes=new Set;this._failedNodes=new Set;this._indexMissing=1;this._maxUnloadedPrio=
Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState={};this._version=0;this._featureEstimate={estimate:0,leafsReached:!1};this._unloadedMemoryEstimate=0;this._missing=new l;this._prefetch=new l;this._updates=new c;this.ignoreServiceOBB=!1;this.progressiveLoadPenalty=0;this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1;this.rootUrl=b.makeAbsolute(d,a);this.traverseVisible(function(a,b){return n.nodeTraversalState(b)})}d.prototype.getNode=
function(a){return this.nodeIndex[a]};Object.defineProperty(d.prototype,"size",{get:function(){return Object.keys(this.nodeIndex).length},enumerable:!0,configurable:!0});d.prototype.destroy=function(){k.prune()};d.prototype.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;++this._version};d.prototype.update=function(b,c){var d=this;if(this._dirty){this._indexMissing=0;this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();k.clear();
this._updates.reset(b);var e=!0,f=new a,g=new a,h=new Map;this.traverseVisible(function(a,l,n){d._updateNodeFeatureEstimate(l,g);if(l){if(0===d._missing.length&&l.children)for(a=0,n=l.children;a<n.length;a++){var m=n[a];d.nodeIndex[m.id]||d._loadingNodes.has(m.id)||(h.set(m.id,d.entryPriority(m)),d._prefetch.push(q({},m,{baseUrl:l.baseUrl})))}!l.failed&&l.featureData&&0!==l.featureData.length&&(d._isLoaded(l)?(f.known+=l.memory,++f.knownNodes,d._isSelected(l)?l.children&&(e=!1):(f.unremoved+=l.memory,
e=!1),d._needsUpdate(l)&&(a=d.entryPriority(l),h.set(l.id,a),d._maxProcessingPrio=Math.max(d._maxProcessingPrio,a),d._updates.update.push(l))):(l.memory&&(f.known+=l.memory,++f.knownNodes),d._isSelected(l)&&(l.children&&(e=!1),l.memory?(f.missing+=l.memory,f.known+=l.memory,++f.knownNodes):++f.missingNodes,0<=b.indexOf(l.id)?(d._maxProcessingPrio=Math.max(d._maxProcessingPrio,d.entryPriority(l)),d._updates.cancel=d._updates.cancel.filter(function(a){return a!==l.id})):!c.done&&d._enable(l)?c.madeProgress():
(a=d.entryPriority(l),h.set(l.id,a),d._maxProcessingPrio=Math.max(d._maxProcessingPrio,a),k.push(l)))))}else++d._indexMissing,m=d.entryPriority(a),d._loadingNodes.has(a.id)||d._failedNodes.has(a.id)||(d._missing.push(q({},a,{baseUrl:n})),h.set(a.id,m)),d._maxProcessingPrio=Math.max(d._maxProcessingPrio,m)});this._unloadedMemoryEstimate=f.missing-f.unremoved;3<f.knownNodes&&0<f.missingNodes&&(this._unloadedMemoryEstimate+=f.known/f.knownNodes*f.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,
this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(g);this._featureEstimate.leafsReached=e;this._missing.sort(function(a,b){return h.get(a.id)-h.get(b.id)});0<this._missing.length?(this._maxUnloadedPrio=h.get(this._missing.back().id),this._prefetch.clear()):this._prefetch.sort(function(a,b){return h.get(a.id)-h.get(b.id)});this._updates.add=k.filter(function(a){return h.get(a.id)>=d._maxUnloadedPrio},this,this._updates.add);this._updates.add.sort(function(a,
b){return h.get(a.id)-h.get(b.id)});this._updates.update.sort(function(a,b){return h.get(a.id)-h.get(b.id)});this._dirty=0<this._indexMissing}};d.prototype.checkFeatureTarget=function(b,c){for(var d=this.viewportQueries.updateScreenSpaceErrorBias(c),e=c,f=c,g=d,h=10;h--;){var k=new a;this._updateFeatureEstimate(e,k);if(this._computeFeatureEstimate(k)<=b){if(e>=c||0<k.missingNodes||0===h)break;g=e;e=.5*(e+f)}else f=e,e=.5*(e+g)}++this._version;this.viewportQueries.updateScreenSpaceErrorBias(d);return Math.min(c,
e)};d.prototype._updateFeatureEstimate=function(a,b){var c=this;++this._version;this.viewportQueries.updateScreenSpaceErrorBias(a);this.traverseVisible(function(a,d){return c._updateNodeFeatureEstimate(d,b)})};d.prototype._updateNodeFeatureEstimate=function(a,b){a&&!a.failed&&null!=a.numFeatures&&(this._isLoaded(a)?(b.known+=a.numFeatures,++b.knownNodes,this._isSelected(a)||(b.unremoved+=a.numFeatures)):this._isSelected(a)&&(a.numFeatures?(b.missing+=a.numFeatures,b.known+=a.numFeatures,++b.knownNodes):
++b.missingNodes))};d.prototype._computeFeatureEstimate=function(a){var b=a.known-a.unremoved;3<a.knownNodes&&0<a.missingNodes&&(b+=a.known/a.knownNodes*a.missingNodes);return Math.max(0,b)};d.prototype.load=function(a){if(0===this._missing.length)return!1;a=Math.min(a,this._missing.length);for(var b=0;b<a;++b)this._loadNode(this._missing.pop());return!0};d.prototype.prefetch=function(a){if(0===this._prefetch.length)return!1;a=Math.min(a,this._prefetch.length);for(var b=0;b<a;++b)this._loadNode(this._prefetch.pop());
return!0};d.prototype.isLoading=function(){return 0<this._indexMissing};d.prototype.getIndexLoading=function(){return this._loadingNodes.size};d.prototype.getIndexMissing=function(){return this._indexMissing};d.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};Object.defineProperty(d.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0});d.prototype.getFeatureEstimate=function(){return this._featureEstimate};d.prototype.nodeTraversalState=
function(a){if(!a)return null;var b=this._nodeTraversalState[a.id];if(b&&b.version===this._version)return b;var c=this.viewportQueries.getLodLevel(a),d=this.viewportQueries.hasLOD(a),e=!0;if(d)if(a.parentNode){e=this.nodeIndex[a.parentNode.id];if(null==e)return null;e=(e=this._nodeTraversalState[e.id])&&c>e.lodLevel}else e=0<c;if(b)return b.lodLevel=c,b.isChosen=e,b.version=this._version,b;this._nodeTraversalState[a.id]={nodeHasLOD:d,lodLevel:c,isChosen:e,version:this._version};return this._nodeTraversalState[a.id]};
d.prototype._loadNode=function(a){var c=this;this._loadingNodes.add(a.id);var d=b.makeAbsolute(a.href,a.baseUrl),h=function(a){c._loadingNodes.delete(a);0===c._missing.length&&0===c._loadingNodes.size&&c.requestUpdate()};this.streamDataSupplier.request(d,"json").then(function(a){var b=a.data,g={id:b.id,mbs:b.mbs,parentNode:b.parentNode,children:b.children,featureData:b.featureData};e.forEach(function(a){g[a]=b.hasOwnProperty(a)?b[a]:null});b.hasOwnProperty("obb")&&!c.ignoreServiceOBB&&(g.obb=f.clone(b.obb),
g.hasServiceOBB=!0,c.viewportQueries.updateNode(g.id));c.nodeIndex[g.id]=g;g.baseUrl=d;g.featureData&&1===g.featureData.length&&g.featureData[0].featureRange&&(g.numFeatures=g.featureData[0].featureRange[1]-g.featureData[0].featureRange[0]+1);c.nodeTraversalState(g);h(g.id)},function(b){b instanceof g||(c.logger.error("Error loading node: "+d),c._failedNodes.add(a.id));h(a.id)})};d.prototype.resetFailedNodes=function(){this._failedNodes.clear();for(var a=0,b=Object.keys(this.nodeIndex);a<b.length;a++)this.nodeIndex[b[a]].failed=
!1};d.prototype.entryPriority=function(a){if(null==a.mbs&&a.id===this.rootId)return Infinity;var b=0,c=this.nodeIndex[a.id];if(null!=c&&null!=c.parentNode){var d=this._nodeTraversalState[c.parentNode.id];null!=d&&(b=d.lodLevel)}for(d=this.progressiveLoadPenalty;c;c=c.parentNode?this.nodeIndex[c.parentNode.id]:null)if(this._isLoaded(c)){d=0;break}a=this.viewportQueries.distToPOI(a);return-a-b*(a+this.progressiveLoadPenalty)+d};d.prototype.traverseVisible=function(a){var b=this.nodeIndex[this.rootId];
b?this._traverse({id:this.rootId,mbs:b.mbs,href:this.rootUrl},b,a,""):a({id:this.rootId,mbs:null,href:this.rootUrl},null,"")};d.prototype._traverse=function(a,b,c,d){if(!b.children||0===b.children.length)this.viewportQueries.isGeometryVisible(b)&&c(a,b,d);else if(this.viewportQueries.isNodeVisible(b)&&(c(a,b,d),a=this.nodeTraversalState(b),!a.nodeHasLOD||a.lodLevel!==this._maxLodLevel))for(a=0,d=b.children;a<d.length;a++){var e=d[a],f=this.nodeIndex[e.id];f?this._traverse(e,f,c,b.baseUrl):this.viewportQueries.isNodeVisible(e)&&
c(e,null,b.baseUrl)}};d.prototype.traverse=function(a,b){if(b(a)&&a.children)for(var c=0;c<a.children.length;++c){var d=this.getNode(a.children[c].id);d&&this.traverse(d,b)}};d.prototype.traverseChildren=function(a,b){if(a.children)for(var c=0;c<a.children.length;++c){var d=this.getNode(a.children[c].id);d&&b(d)&&this.traverseChildren(d,b)}};d.prototype.updateStats=function(a){0<this._updates.add.length&&(a.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)a.index+=
" + "+this._indexMissing||this._prefetch.length;a.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){var b=this._featureEstimate.estimate-a.features;0<b?a.features+=" + "+b:0>b&&(a.features+=" - "+-b)}};d.prototype.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};return d}();d.I3SIndex=t;var k=new l,c=function(){function a(){this.update=new l;this.add=new l;this.cancel=[]}a.prototype.reset=function(a){this.add.clear();this.update.clear();this.cancel=
a};return a}(),a=function(){return function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}()})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require","exports","../../../../core/PooledArray"],function(t,d,q){t=function(){function d(b,d){this.layerView=b;this.lodGlobalDirtyChanged=d}d.prototype.startNodeLoading=function(b,d,e,g,c,a,h){this._lodGlobalDirty=!1;this._maxLodLevel=h.maxLodLevel;this._index=c;this._rootId=a;this._nodeTraversalState=e;this._isNodeVisible=
b;this._isGeometryVisible=d;this._removeNodes=g;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};d.prototype.shouldLoadNode=function(b){var d=this._nodeTraversalState(b);return this.isChosenMaxLOD(d)?!0:d.isChosen?this._childrenRequireLoading(b):!1};d.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};d.prototype.lodSwapBundleLoaded=function(b){this.setLodGlobalDirty()};Object.defineProperty(d.prototype,"requiresLODGlobalHandling",{get:function(){return null!=
this._rootId&&(!0===this._lodGlobalDirty||this.layerView.view&&1.1<this.layerView.view.resourceController.memoryController.usedMemory)},enumerable:!0,configurable:!0});d.prototype.lodGlobalHandling=function(b){if(this.requiresLODGlobalHandling){var d=this._rootId,e=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.memoryController.usedMemory-1)));g.clear();this._lodGlobalHandlingRecursion(d,e);this._removeNodes(g,b);0===g.length&&(this._lodGlobalDirty=!1,this.lodGlobalDirtyChanged(this._lodGlobalDirty));
g.clear()}};d.prototype._lodGlobalHandlingRecursion=function(b,d){b=this._index.getNode(b);if(null==b)return!1;var e=this._nodeTraversalState(b),f=this.isChosenMaxLOD(e);(e=this.layerView.isNodeLoaded(b))&&null!=this.layerView.setPolygonOffset&&this.layerView.setPolygonOffset(b,!f);if(f&&e)return this._removeChildrenRecursive(b),!0;var c=!1;if(null!=b.children&&0!==b.children.length)for(var c=!0,a=0,h=b.children;a<h.length;a++){var l=h[a],n=this._index.getNode(l.id);(n?this._isGeometryVisible(n):
this._isNodeVisible(l))&&!this._lodGlobalHandlingRecursion(l.id,d)&&(c=!1)}e&&!f&&(c||g.length<d)&&(g.push(b),e=!1);d=!b.featureData||0===b.featureData.length;return c||e||d};d.prototype._removeChildrenRecursive=function(b){this._index.traverseChildren(b,function(b){g.push(b);return!0})};d.prototype.childrenEmpty=function(b){var d=this,e=!0;this._index.traverseChildren(b,function(b){return e&&d._isNodeVisible(b)?d.layerView.isNodeLoaded(b)?e=!1:!0:!1});return e};d.prototype._childrenRequireLoading=
function(b){var d=this,e=!1,g=!0;this._index.traverseChildren(b,function(b){if(!g||!d._isNodeVisible(b))return!1;var a=d._nodeTraversalState(b);d.isChosenMaxLOD(a)&&d._isGeometryVisible(b)&&(e=!0);return d.layerView.isNodeLoaded(b)?g=!1:!0});return g&&e};d.prototype.isChosenMaxLOD=function(b){return b.isChosen&&(!b.nodeHasLOD||b.lodLevel===this._maxLodLevel)};return d}();var g=new q;return t})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports dojo/errors/CancelError ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ./I3SBinaryReader ./I3SUtil ../../webgl-engine/lib/Util".split(" "),
function(t,d,q,g,l,b,f,e,k){t=function(){function c(a,d,e,f,g){this.loader=a;this.logger=d;this.defaultGeometrySchema=e;this.requiredAttributes=f;this.options=g;this.cancelled=!1;this.loadShared=function(a){if(null==a.sharedResource)return l.resolve({});var d=b.makeAbsolute(a.sharedResource.href,a.baseUrl);return this.load(d,"json").then(function(a){c.fixTextureEncodings(a);c.addAbsoluteHrefTexture(a,d);return a})}}c.prototype.cancelAll=function(){this.cancelled=!0};c.prototype.load=function(a,b){var c=
this;return l.create(function(d,e){c.loader.request(a,b).then(function(a){return d(a.data)},function(b){return e(b||Error("Failed to load: "+a))})})};c.prototype.loadAttribute=function(a,c,d){a=b.makeAbsolute(d,a);return this.load(a,"binary").then(function(a){return f.readBinaryAttribute(c,a)})};c.prototype.loadAttributes=function(a,b){var c=this,d=b.map(function(b){return null==a.attributeData||null==a.attributeData[b.index]?(c.logger.error("Missing attributeData for '"+b.name+"' on node '"+a.id+
"'"),l.resolve(null)):c.loadAttribute(a.baseUrl,b.attributeStorageInfo,a.attributeData[b.index].href).catch(function(d){c.logger.error("Failed to load attributeData for '"+b.name+"' on node '"+a.id+"'");return null})});return l.all(d).then(function(a){for(var c={},d=0;d<b.length;++d)a[d]&&(c[b[d].name]=a[d]);return c})};c.prototype.prepareBinaryGeometryData=function(a,b,c,d){g.mixin(a.geometries[0].params,c);d||null!=c.vertexAttributes.region||delete c.vertexAttributes.region;if(null!=c.featureAttributes){d=
c.featureAttributes;if(d.faceRange){var h=f.createTypedView(b,d.faceRange);a.componentOffsets=e.convertFlatRangesToOffsets(h,c.header.fields.featureCount,d.faceRange.valuesPerElement)}if(d.id){a.featureIds=[];var h=1,k=f.valueType2TypedArrayClassMap[d.id.valueType];"UInt64"===d.id.valueType&&(k=Uint32Array,h=2);b=new k(b,d.id.byteOffset,d.id.count*d.id.valuesPerElement*h);for(k=0;k<c.header.fields.featureCount;k++)if(a.featureIds[k]=b[k*d.id.valuesPerElement*h],2===h){var l=b[k*d.id.valuesPerElement*
h+1];if(2097150<=l)throw Error("ID exceeded maximum range supported by javascript (max \x3d 53bit-1 \x3d 9007199254740991)");a.featureIds[k]+=4294967296*l}}}};c.prototype.loadBundleData=function(a,c){var d=this,e=null,g=this.loadShared(a),h=null;null!=this.requiredAttributes&&(h=this.loadAttributes(a,this.requiredAttributes));var k=null;if(null!=a.geometryData)var q=b.makeAbsolute(a.geometryData[c].href,a.baseUrl),k=this.load(q,"binary");return g.then(function(b){d.handleCancelled();return(d.options.loadFeatureData?
d.loadFeatureData(a,c):l.resolve(null)).then(function(c){d.handleCancelled();var g=d.options.loadFeatureData?d.collectGeometries(a,c,b):d.meshPyramidGeometryData(a,b);c=null!=k?k.then(function(a){e=a;var c=Object.keys(b.materialDefinitions)[0],c=b.materialDefinitions[c].params.vertexRegions,h=f.createGeometryDataIndex(a,d.defaultGeometrySchema,c);d.prepareBinaryGeometryData(g[0],a,h,c);return g}):l.resolve(g);var m=d.loadTextures(g,b);return l.all([m,c,h])}).then(function(a){var c=a[0],f=a[1];a=a[2];
d.handleCancelled();var g=null;a&&(g={attributeData:a,loadedAttributes:d.requiredAttributes});return{allGeometryData:f,attributeDataInfo:g,geometryBuffer:e,sharedResource:b,textureData:c}})})};c.addAbsoluteHrefTexture=function(a,c){a=a.textureDefinitions;if(null!=a)for(var d=0,e=Object.keys(a);d<e.length;d++)for(var f=0,g=a[e[d]].images;f<g.length;f++){var h=g[f];Array.isArray(h.href)?h.hrefConcat=h.href.map(function(a){return b.makeAbsolute(a,c)}):h.hrefConcat=b.makeAbsolute(h.href,c)}};c.fixTextureEncodings=
function(a){a=a.textureDefinitions;if(null!=a)for(var b in a){var c=a[b];if(Array.isArray(c.encoding))for(var d=0;d<c.encoding.length;d++){var e=c.encoding[d];"data:"===e.substring(0,5)&&(c.encoding[d]=e.substring(5))}else e=c.encoding,"data:"===e.substring(0,5)&&(c.encoding=e.substring(5))}};c.prototype.loadTexture=function(a,b,c,d){var f=this;return d===e.DDS_ENCODING_STRING?this.load(a,"binary").then(function(a){f.handleCancelled();return{i3sTexId:b,data:a,encoding:d}}):this.load(a,"image").then(function(a){var e=
a;f.handleCancelled();if(c&&4096<=a.width*a.height){var e=Math.ceil(a.width/2),g=Math.ceil(a.height/2),h=document.createElement("canvas");h.width=e;h.height=g;h.getContext("2d").drawImage(a,0,0,e,g);e=h}return{i3sTexId:b,data:e,encoding:d}})};c.prototype.loadTextures=function(a,b){for(var d=[],f=0;f<a.length;f++){var g=a[f].geometries;if(null!=g)for(var h=0;h<g.length;h++){var q=g[h].params.textureID||"none";if("none"!==q){null!=b.textureDefinitions&&null!=b.textureDefinitions[q]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+
q);var t=b.textureDefinitions[q];k.assert(void 0!==t,"geometry wants unknown texture "+q);if(0!==t.images.length){var w=t.images[t.images.length-1],m=this.options.textureFormat===c.TextureFormat.Downsampled,x=e.getAppropriateTextureEncoding(t.encoding,this.options.textureFormat===c.TextureFormat.Compressed),t=-1<x?t.encoding[x]:t.encoding,w=-1<x?w.hrefConcat[x]:w.hrefConcat;this.options.loadTextureData?d.push(this.loadTexture(w,q,m,t)):d.push({i3sTexId:q,encoding:t,data:null})}}}}return l.all(d)};
c.prototype.meshPyramidGeometryData=function(a,b){a=b.materialDefinitions?Object.keys(b.materialDefinitions)[0]:null;b=b.textureDefinitions?Object.keys(b.textureDefinitions)[0]:null;return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:a,textureID:b}}],featureDataPosition:[0,0,0]}]};c.prototype.collectGeometries=function(a,b,c){a=[];c=0;for(b=b.featureData;c<b.length;c++){var d=b[c],e=d.geometries;if(null!=e)for(var f=0;f<e.length;f++)a.push({featureIds:[d.id],featureDataPosition:d.position,
geometries:[d.geometries[f]]});else null!=d.position&&a.push({featureIds:[d.id],featureDataPosition:d.position,geometries:null})}return a};c.prototype.loadFeatureData=function(a,c){a=b.makeAbsolute(a.featureData[c].href,a.baseUrl);return this.load(a,"json")};c.prototype.handleCancelled=function(){if(this.cancelled)throw new q;};return c}();(function(b){b=b.TextureFormat||(b.TextureFormat={});b[b.Compressed=0]="Compressed";b[b.Normal=1]="Normal";b[b.Downsampled=2]="Downsampled"})(t||(t={}));return t})},
"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/Point ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ../graphics/Graphics3DSymbolCommonCode ./I3SUtil ../../support/geometryUtils ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),function(t,
d,q,g,l,b,f,e,k,c,a,h,p,n){return function(){function d(a,b,c,d,e,k,l){void 0===l&&(l={});this.indexSR=a;this._renderCoordsHelper=b;this.extent=d;this.elevationProvider=e;this.options=l;this._computedOBBs={};this._computedMBSs={};this._isNodeVisibleCached={};this.fp=h.frustum.create();this._poi=g.vec3f64.create();this._idleCamera=!0;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=g.vec3f64.create();this._tmp2=g.vec3f64.create();this._tmp3=g.vec3f64.create();this._tmp0=g.vec3f64.create();this.supportedMetrics=
["maxScreenThreshold","screenSpaceRelative","removedFeatureDiameter","distanceRangeFromDefaultCamera"];this.screenspaceErrorBias=l.screenspaceErrorBias||1;this.progressiveLoadFactor=l.progressiveLoadFactor||1;this.updateCamera(c);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(k);this.tmpPoint=new f({x:0,y:0,z:0,spatialReference:a})}d.prototype.updateElevationInfo=function(a){this.invalidateCache();null==a?this._elevationContext=null:(this._elevationContext=new e,
this._elevationContext.featureExpressionInfoContext=k.createContext(k.extractExpressionInfo(a,!1)),this._elevationContext.mixinApi(a))};d.prototype.updateCamera=function(a){h.frustum.fromMatrix(a.viewMatrix,a.projectionMatrix,this.fp);this._screenSizeFactor=1/(a.perScreenPixelRatio/2);this._camPos=a.eye;this._isNodeVisibleCached={};this.maxDistance=0};d.prototype.updateNode=function(a){delete this._isNodeVisibleCached[a]};d.prototype.setPointOfInterest=function(a){q.vec3.copy(this._poi,a)};d.prototype.updateScreenSpaceErrorBias=
function(a){var b=this.screenspaceErrorBias;this.screenspaceErrorBias=a;return b};d.prototype.setCameraIdle=function(a){this._idleCamera!==a&&(this._idleCamera=a,this._isNodeVisibleCached={})};d.prototype.updateExtent=function(a){this.extent=a;this._isNodeVisibleCached={}};d.prototype.computeMbs=function(a){var d=this._computedMBSs[a.id];d||(d=b.vec4f64.fromValues(a.mbs[0],a.mbs[1],a.mbs[2],-1),this._computedMBSs[a.id]=d);0>d[3]&&(l.vec4.copy(d,a.mbs),this._elevationContext&&1E5>d[3]&&(this.tmpPoint.x=
d[0],this.tmpPoint.y=d[1],this.tmpPoint.z=d[2],d[2]=c.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),n.mbsToMbs(d,this.indexSR,d,this.engineSR));return d};d.prototype.computeObb=function(a){if(a.obb&&!(0>a.obb.halfSize[0])){var b=this._computedOBBs[a.id];b||(b=p.clone(a.obb),b.halfSize[0]=-1,this._computedOBBs[a.id]=b);0>b.halfSize[0]&&(b.halfSize[0]=a.obb.halfSize[0],q.vec3.copy(b.center,a.obb.center),this._elevationContext&&1E5>a.mbs[3]&&
(this.tmpPoint.x=a.obb.center[0],this.tmpPoint.y=a.obb.center[1],this.tmpPoint.z=a.obb.center[2],b.center[2]=c.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),n.bufferToBuffer(b.center,this.indexSR,0,b.center,this.engineSR,0,1));return b}};d.prototype._isNodeVisible=function(a){var b=this.computeMbs(a);return this.isMBSinExtent(b)?a.hasServiceOBB&&a.obb?(a=this.computeObb(a),p.isVisible(a,this.fp)):this.isMBSVisible(b):!1};d.prototype.isNodeVisible=
function(a){if(!this._idleCamera)return this._isNodeVisible(a);if(null!=this._isNodeVisibleCached[a.id])return this._isNodeVisibleCached[a.id];this._isNodeVisibleCached[a.id]=this._isNodeVisible(a);return this._isNodeVisibleCached[a.id]};d.prototype.isGeometryVisible=function(a){return this.isNodeVisible(a)?a.hasServiceOBB?!0:(a=this.computeObb(a))?p.isVisible(a,this.fp):!0:!1};d.prototype.invalidateCache=function(a){if(null==a){for(var b=0,c=Object.keys(this._computedMBSs);b<c.length;b++)a=c[b],
this._computedMBSs[a][3]=-1;b=0;for(c=Object.keys(this._computedOBBs);b<c.length;b++)a=c[b],this._computedOBBs[a].halfSize[0]=-1}else this._computedMBSs[a]&&(this._computedMBSs[a][3]=-1),this._computedOBBs[a]&&(this._computedOBBs[a].halfSize[0]=-1)};d.prototype.isMBSinExtent=function(b){return this.extent?0!==a.intersectBoundingBoxWithMbs(this.extent,b):!0};d.prototype.isMBSVisible=function(a){return h.frustum.intersectsSphere(this.fp.planes,h.sphere.wrap(a[3],a))};d.prototype.calcScreenSpaceSize=
function(a,b){var c=this.computeMbs(a);a=q.vec3.squaredDistance(c,this._camPos);c=c[3];this.maxDistance=Math.max(this.maxDistance,Math.sqrt(a)-c);a-=c*c;return 0>a?.5*Number.MAX_VALUE:b/Math.sqrt(a)*this._screenSizeFactor};d.prototype.calcCameraDistance=function(a){a=this.computeMbs(a);a=q.vec3.distance(a,this._camPos)-a[3];this.maxDistance=Math.max(this.maxDistance,a);return a};d.prototype.calcAngleDependentLoD=function(a){a=this.computeMbs(a);var b=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*
(a[1]-this._camPos[1])+a[2]*(a[2]-this._camPos[2]))/q.vec3.length(a)+b)/q.vec3.distance(a,this._camPos);return Math.min(1,a)};d.prototype.hasLOD=function(a){return null!=a.lodSelection};d.prototype.hasFeatures=function(a){return null!=a.featureData};d.prototype.getDistancePlanarMode=function(a,b){var c=a[0]-b[0],d=a[1]-b[1];a=a[2]-b[2];c=c*c+d*d;b=b[3];if(c<=b*b)return Math.abs(a);b=Math.sqrt(c)-b;return Math.sqrt(a*a+b*b)};d.prototype.getDistanceGlobeMode=function(a,b){var c=q.vec3.length(b),d=q.vec3.length(a)-
c;q.vec3.scale(this._tmp0,a,q.vec3.dot(a,b)/q.vec3.squaredLength(a));var e=q.vec3.squaredDistance(b,this._tmp0),f=b[3];if(e<=f*f)return Math.abs(d);b=q.vec3.scale(this._tmp0,b,1/c);c=q.vec3.scale(this._tmp1,b,c-f*f/2/c);e=q.vec3.subtract(this._tmp2,a,c);e=q.vec3.subtract(this._tmp2,e,q.vec3.scale(this._tmp3,b,q.vec3.dot(b,e)));c=q.vec3.add(this._tmp2,c,q.vec3.scale(this._tmp2,e,f/q.vec3.length(e)));f=q.vec3.distance(a,c);2E5<=d&&(a=q.vec3.subtract(this._tmp1,a,c),a=q.vec3.dot(a,b)/q.vec3.length(a),
.08>a&&(a=1E-4),f/=a);return f};d.prototype.getDistance=function(a,b){return this.engineSR===n.SphericalECEFSpatialReference?this.getDistanceGlobeMode(a,b):this.getDistancePlanarMode(a,b)};d.prototype._selectErrorMetric=function(a){for(var b=0;b<a.length;b++)if(0<=this.supportedMetrics.indexOf(a[b].metricType))return a[b];return null};d.prototype.getLodLevel=function(a){if(!a.lodSelection||0>=a.lodSelection.length||!1===this.hasFeatures(a))return 0;if(null==a.children||0===a.children.length)return this.maxLodLevel;
var b=this._selectErrorMetric(a.lodSelection);if(null==b)return 0;if(1>this.progressiveLoadFactor){var c=this.screenspaceErrorBias;return this.evaluateLODmetric(a,this.progressiveLoadFactor*this.screenspaceErrorBias,b)?this.evaluateLODmetric(a,c,b)?2:1:0}return this.evaluateLODmetric(a,this.screenspaceErrorBias,b)?this.maxLodLevel:0};d.prototype.evaluateLODmetric=function(a,b,c){switch(c.metricType){case "screenSpaceRelative":a=this.computeMbs(a);a=this.getDistance(this._camPos,a);var d=2*a/this._screenSizeFactor;
this.maxDistance=Math.max(this.maxDistance,a);return c.maxError*b<=d;case "maxScreenThreshold":return b=this.calcScreenSpaceSize(a,a.mbs[3]*b),this.options.angleDependentLoD&&(b*=this.calcAngleDependentLoD(a)),b<c.maxError;case "removedFeatureDiameter":return 10>this.calcScreenSpaceSize(a,c.maxError)*b;case "distanceRangeFromDefaultCamera":return this.calcCameraDistance(a)>c.maxError*b}return!1};d.prototype.distToPOI=function(a){a=this.computeMbs(a);return q.vec3.distance(a,this._poi)-a[3]};d.prototype.distCameraToPOI=
function(){return q.vec3.distance(this._camPos,this._poi)};return d}()})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/SpatialReference ../../../geometry/support/meshUtils/deduplicate ./i3s/I3SGeometryUtil ./i3s/I3SProjectionUtil ../support/orientedBoundingBox ../support/projectionUtils ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r){t=function(){function d(){}d.prototype.process=function(a){var b=[a.geometryBuffer];a=this.transform(a,b);return q.resolve({result:a,transferList:b})};d.prototype.transform=function(b,d){var f=c.fromJSON(b.indexSR),k=c.fromJSON(b.vertexSR),l=c.fromJSON(b.renderSR),q=b.geometryBuffer,t=p.computeGlobalTransformation(b.mbs,b.elevationOffset,f,l);g.mat4.invert(y,t);var x=b.obb?null:n.create([0,0,0],[-1,-1,-1],[0,0,0,1]);e.vec3.copy(w,b.mbs);w[2]+=b.elevationOffset;
e.vec3.copy(m,w);for(var A=!1,C=0,B=[],O=0,U=b.geometryData;O<U.length;O++)for(var N=U[O],V=N.componentOffsets,X=0,N=N.geometries;X<N.length;X++){var J=N[X],R=b.layouts[C];++C;var T=h.interleaveGeometryBuffer(J,q,R,[{name:r.VertexAttrConstants.COLOR,byteValue:255}],[r.VertexAttrConstants.NORMAL,r.VertexAttrConstants.NORMALCOMPRESSED,r.VertexAttrConstants.SYMBOLCOLOR,r.VertexAttrConstants.COMPONENTINDEX]),W=new v(new Float32Array(T),R),Z=W.getAttribute(r.VertexAttrConstants.POSITION);p.reprojectPoints(Z,
b.mbs,y,b.elevationOffset,f,k,l);x&&this._updateObb(x,Z,t);b.needNormals&&(Z={normals:W.getAttribute(r.VertexAttrConstants.NORMALCOMPRESSED),positions:Z,normalInd:W.getIndices(r.VertexAttrConstants.NORMALCOMPRESSED),positionInd:W.getIndices(r.VertexAttrConstants.POSITION)},h.processAndInterleaveNormals(b.normalReferenceFrame,J,q,t,Z));(J=W.getAttribute(r.VertexAttrConstants.COMPONENTINDEX))&&this._createComponentNumbers(J,V);(W=W.getAttribute(r.VertexAttrConstants.COLOR))&&!A&&(A=this._hasColors(W));
W={globalTrafo:t};J=R[0].stride;J=a.default(T,J/4,null,1-.8*J/(J+4));null!=J?(T=65536>J.uniqueCount?new Uint16Array(J.indices):J.indices,Z=h.extractPositionData(J.buffer,R,T),B.push({layout:R,interleavedVertexData:J.buffer,indices:T,corMatrices:W,hasColors:A,positionData:Z}),d&&(d.push(J.buffer),d.push(T.buffer),d.push(Z.data.buffer),d.push(Z.indices.buffer))):(Z=h.extractPositionData(T,R),B.push({layout:R,interleavedVertexData:T,corMatrices:W,hasColors:A,positionData:Z}),d&&(d.push(T),d.push(Z.data.buffer),
d.push(Z.indices.buffer)))}x&&(e.vec3.transformMat4(x.center,x.center,t),u.vectorToVector(x.center,l,x.center,f),x.center[2]-=b.elevationOffset);return{geometryBuffer:q,transformedGeometries:B,obb:x}};d.prototype._hasColors=function(a){var b=a.data,c=a.size,d=a.strideIdx;for(a=a.offsetIdx;a<b.length;a+=d)for(var e=0;e<c;e++)if(255!==b[a+e])return!0;return!1};d.prototype._createComponentNumbers=function(a,b){var c=a.data,d=a.strideIdx,e=c.length/d,f=0;a=a.offsetIdx;for(var g=0;g<e;g++)g>=b[f+1]&&f++,
c[a]=f,a+=d};d.prototype._updateObb=function(a,c,d){if(0<a.halfSize[0]){e.vec3.subtract(w,a.center,a.halfSize);e.vec3.add(m,a.center,a.halfSize);for(d=c.offsetIdx;d<c.data.length;d+=c.strideIdx)w[0]=Math.min(w[0],c.data[d]),w[1]=Math.min(w[1],c.data[d+1]),w[2]=Math.min(w[2],c.data[d+2]),m[0]=Math.max(m[0],c.data[d]),m[1]=Math.max(m[1],c.data[d+1]),m[2]=Math.max(m[2],c.data[d+2]);e.vec3.subtract(a.halfSize,m,w);e.vec3.scale(a.halfSize,a.halfSize,.5);e.vec3.add(a.center,w,m);e.vec3.scale(a.center,a.center,
.5)}else n.compute(c,a),c=2*Math.sqrt(1+d[0]+d[5]+d[10]),x[0]=(d[9]-d[6])/c,x[1]=(d[2]-d[8])/c,x[2]=(d[4]-d[1])/c,x[3]=.25*c,b.quat.conjugate(x,x),b.quat.multiply(a.quaternion,x,a.quaternion)};return d}();var y=l.mat4f64.create(),w=k.vec3f64.create(),m=k.vec3f64.create(),x=f.quatf32.create();return t})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("require exports ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/meshUtils/deduplicate ./I3SBinaryReader ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){function h(a,b,c,d,e,f,g){switch(c){case 1:for(c=0;c<g;c++)d[e]=a[b],b+=1,e+=f;break;case 2:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],b+=2,e+=f;break;case 3:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],b+=3,e+=f;break;case 4:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],d[e+3]=a[b+3],b+=4,e+=f;break;default:throw r("Unhandled stride size "+c);}}function p(a,b,c,d,e,f){switch(b){case 1:for(b=0;b<f;b++)c[d]=a,d+=e;break;case 2:for(b=0;b<f;b++)c[d]=a,c[d+
1]=a,d+=e;break;case 3:for(b=0;b<f;b++)c[d]=a,c[d+1]=a,c[d+2]=a,d+=e;break;case 4:for(b=0;b<f;b++)c[d]=a,c[d+1]=a,c[d+2]=a,c[d+3]=a,d+=e;break;default:throw r("Unhandled stride size "+b);}}function n(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}function u(a){switch(a){case 5120:return"Int8";case 5126:return"Float32";
case 5124:return"Int32";case 5122:return"Int16";case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw Error("Unhandled data type: "+a);}function v(a){return 0<a&&0===a%Uint32Array.BYTES_PER_ELEMENT}function r(a){return Error("I3SGeometryUtil processing failed: "+a)}function y(a,b){switch(b){case 0:switch(a.type){case "intersects":case "contains":case "crosses":case "envelope-intersects":case "overlaps":case "touches":case "within":return 1;case "disjoint":return 0}break;
case 2:switch(a.type){case "intersects":case "contains":case "envelope-intersects":case "within":return 0;case "disjoint":case "crosses":case "overlaps":case "touches":return 1}break;case 1:switch(a.type){case "envelope-intersects":return 0}}return 2}function w(a,b){return x.contains(a.mask,b)?2:x.intersects(a.mask,b)?1:0}Object.defineProperty(d,"__esModule",{value:!0});var m=new Uint8Array(64);d.interleaveGeometryBuffer=function(a,b,c,d,e){void 0===d&&(d=[]);void 0===e&&(e=[]);var f=a.params.vertexAttributes,
g=f.position.count;if(!v(c[0].stride))throw r("Layout stride must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var k=new Uint32Array(c[0].stride/Uint32Array.BYTES_PER_ELEMENT*g);c=c.slice(0).sort(function(a,b){return a.offset-b.offset});a=function(a){if(-1!==e.indexOf(a.name))return"continue";var c=f[a.name],l=n(a.type),q=void 0,t=!1;if(null==c)if(t=d.filter(function(b){return b.name===a.name})[0]){c={valueType:u(a.type),byteOffset:0,count:g,valuesPerElement:a.count};for(q=0;q<m.length;q++)m[q]=
t.byteValue;q=m.buffer;t=!0}else throw r("Geometry definition is missing attribute");else q=b;if(u(a.type)!==c.valueType)throw r("Geometry definition type must match attribute type");if(0!==c.byteOffset%Uint32Array.BYTES_PER_ELEMENT||0!==a.offset%Uint32Array.BYTES_PER_ELEMENT)throw r(a.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!v(c.valuesPerElement*l.BYTES_PER_ELEMENT)||!v(a.count*l.BYTES_PER_ELEMENT))throw r(a.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");
var q=new Uint32Array(q),w=c.byteOffset/Uint32Array.BYTES_PER_ELEMENT,c=c.valuesPerElement*l.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,l=a.offset/Uint32Array.BYTES_PER_ELEMENT,x=a.stride/Uint32Array.BYTES_PER_ELEMENT;t?p(q[0],c,k,l,x,g):h(q,w,c,k,l,x,g)};for(var l=0;l<c.length;l++)a(c[l]);return k.buffer};d.processAndInterleaveNormals=function(c,d,e,f,h){if("none"===c){var m=h.normals,n=h.positions;d=h.normalInd;c=h.positionInd;a.assert(h.normalInd.length===h.positionInd.length);h=b.vec3f32.create();
f=b.vec3f32.create();e=g.vec2f32.create();for(var p=n.data,q=n.offsetIdx,n=n.strideIdx,r=m.data,t=m.offsetIdx,m=m.strideIdx,u=0;u<c.length;u+=3){var v=c[u],v=q+n*v,w=p[v],x=p[v+1],y=p[v+2],v=c[u+1],v=q+n*v;h[0]=p[v]-w;h[1]=p[v+1]-x;h[2]=p[v+2]-y;v=c[u+2];v=q+n*v;f[0]=p[v]-w;f[1]=p[v+1]-x;f[2]=p[v+2]-y;l.vec3.cross(h,h,f);a.encodeNormal(h,e);for(w=0;3>w;w++)x=t+m*d[u+w],r[x]=a.encodeInt16(e[0]),r[x+1]=a.encodeInt16(e[1])}}else if(d=k.createTypedView(e,d.params.vertexAttributes.normal),e=h.normals,
x="earth-centered"===c?f:null,c=d.length/3,h=e.data,f=e.offsetIdx,e=e.strideIdx,null!=x)for(p=x[0],q=x[1],n=x[2],r=x[4],t=x[5],m=x[6],u=x[8],w=x[9],x=x[10],y=0;y<c;y++){var v=d[3*y],A=d[3*y+1],C=d[3*y+2];B[0]=p*v+q*A+n*C;B[1]=r*v+t*A+m*C;B[2]=u*v+w*A+x*C;a.encodeNormal(B,E);h[f+y*e]=a.encodeInt16(E[0]);h[f+y*e+1]=a.encodeInt16(E[1])}else for(y=0;y<c;y++)B[0]=d[3*y],B[1]=d[3*y+1],B[2]=d[3*y+2],a.encodeNormal(B,E),h[f+y*e]=a.encodeInt16(E[0]),h[f+y*e+1]=a.encodeInt16(E[1])};d.extractPositionData=function(a,
b,c){var d=b[0];if(null==d||"position"!==d.name||5126!==d.type)return null;a=new Float32Array(a);b=d.stride/4;for(var d=d.offset/4,f=3*a.length/b,g=new Float32Array(f),h=0;h<f/3;h++)g[3*h]=a[h*b+d],g[3*h+1]=a[h*b+d+1],g[3*h+2]=a[h*b+d+2];c=e.default(g.buffer,3,c);return 65536>c.uniqueCount?{data:new Float32Array(c.buffer),indices:new Uint16Array(c.indices)}:{data:new Float32Array(c.buffer),indices:c.indices}};var x;d.loadGeometryEngine=function(){return null!=x?q.resolve():q.create(function(a,b){return t(["../../../../geometry/geometryEngine"],
a)}).then(function(a){return x=a})};d.acquireMaskFilterContext=function(a,b,c,d){var e=c.spatialReference||b.spatialReference;b=b.renderSpatialReference;var f={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:e};f.rings[0][4]=f.rings[0][0];var g=d.objectTransformation;d=d.getGeometryRecords()[0].geometry;var h={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:e};h.rings[0][3]=h.rings[0][0];var k=x[a];k||(console.error("Spatial relationship",
a,"not supported"),k=function(){return!0});return{type:a,mask:c,maskSR:e,renderSR:b,aabb:f,transform:g,geometry:d,triangle:h,testFunction:k}};d.getIntersectRelation=y;d.intersectMaskWithMbs=function(a,b){b=x.buffer({x:b[0],y:b[1],hasZ:!1,hasM:!1,type:"point",spatialReference:a.maskSR},b[3],1,!0);return w(a,b)};var A=Math.pow(2,-32);d.filterMask=function(b,d){var e=d.type,f=d.mask,g=d.transform,h=d.renderSR,k=d.maskSR,m=d.geometry,n=d.triangle,p=d.testFunction,q=d.aabb;m.getComponentAABB(b,C);var r=
[q.rings[0][0],q.rings[0][1],q.rings[0][2],q.rings[0][3]];l.vec3.set(r[0],C[0],C[1],0);l.vec3.set(r[1],C[0],C[4],0);l.vec3.set(r[2],C[3],C[4],0);l.vec3.set(r[3],C[3],C[1],0);for(var t=0;4>t;++t)l.vec3.transformMat4(r[t],r[t],g),c.vectorToVector(r[t],h,r[t],k);delete q._geVersion;t=w(d,q);switch(y(d,t)){case 1:return!1;case 0:return!0}d=n.rings[0][0];var q=n.rings[0][1],r=n.rings[0][2],u=m.data.getIndices(a.VertexAttrConstants.POSITION),t=m.data.componentOffsets,v=m.data.getAttribute(a.VertexAttrConstants.POSITION),
m=v.data,x=v.offsetIdx,v=v.strideIdx,B=t.length?t[b]:0;b=t.length?t[b+1]:u.length;var E;switch(e){case "intersects":case "crosses":case "envelope-intersects":case "index-intersects":case "overlaps":case "touches":E=function(){return p(f,n)?0:2};break;default:E=function(){return p(f,n)?2:1}}for(t=B;t<b;t+=3){var B=x+v*u[t+0],G=x+v*u[t+1],I=x+v*u[t+2];l.vec3.set(d,m[B+0],m[B+1],m[B+2]);l.vec3.set(q,m[G+0],m[G+1],m[G+2]);l.vec3.set(r,m[I+0],m[I+1],m[I+2]);l.vec3.transformMat4(d,d,g);l.vec3.transformMat4(q,
q,g);l.vec3.transformMat4(r,r,g);c.vectorToVector(d,h,d,k);c.vectorToVector(q,h,q,k);c.vectorToVector(r,h,r,k);if(!(Math.abs((q[0]-d[0])*(r[1]-d[1])-(q[1]-d[1])*(r[0]-d[0]))<A))switch(delete n._geVersion,E()){case 1:return!1;case 0:return!0}}switch(e){case "intersects":case "crosses":case "envelope-intersects":case "index-intersects":case "overlaps":case "touches":return!1;default:return!0}};var C=f.create(),B=b.vec3f32.create(),E=g.vec2f32.create()})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/projectionUtils ../../webgl-engine/lib/localOrigin".split(" "),
function(t,d,q,g,l,b,f,e){function k(a,c,d){var e=l.vec3f64.create(),f=Math.ceil(Math.log(a[3])*Math.LOG2E/p),g=Math.pow(2,f*p+h),k;if(d.isGeographic){k=g/b.earthRadius*180/Math.PI;d=Math.round(a[1]/k);var n=Math.max(-90,Math.min(90,d*k)),q=k/Math.cos((Math.abs(n)-k/2)/180*Math.PI);k=Math.round(a[0]/q);e[0]=k*q;e[1]=n}else k=Math.round(a[0]/g),d=Math.round(a[1]/g),e[0]=k*g,e[1]=d*g;a=Math.round((a[2]+c)/g);e[2]=a*g;return{center:e,id:f+"_"+k+"_"+d+"_"+a}}Object.defineProperty(d,"__esModule",{value:!0});
var c=new Float64Array(3E3),a=l.vec3f64.create();d.computeGlobalTransformation=function(a,b,c,d){a=k(a,b,c).center;b=q.mat4f64.create();f.computeLinearTransformation(c,a,b,d);return b};d.reprojectPoints=function(b,d,e,h,k,l,m){var n=b.data,p=b.offsetIdx;b=b.strideIdx;g.vec3.copy(a,d);a[2]+=h;d=[0,0,0];h=n.length/b;f.vectorToVector(a,k,d,l);for(k=0;k<h;k+=1E3){for(var q=Math.min(1E3,h-k),r=0;r<q;r++){var t=p+b*(k+r);c[3*r+0]=n[t+0]+d[0];c[3*r+1]=n[t+1]+d[1];c[3*r+2]=n[t+2]+d[2]}f.bufferToBuffer(c,
l,0,c,m,0,q);for(r=0;r<q;r++){var t=c[3*r+0],u=c[3*r+1],v=c[3*r+2],w=p+b*(k+r);n[w+0]=e[0]*t+e[4]*u+e[8]*v+e[12];n[w+1]=e[1]*t+e[5]*u+e[9]*v+e[13];n[w+2]=e[2]*t+e[6]*u+e[10]*v+e[14]}}};d.createOrigin=function(a,b,c,d){b=k(a,b,c);a=b.center;b=b.id;f.vectorToVector(a,c,a,d);return e.fromVector(a,b)};var h=1,p=5-h})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(t,d,q){var g=function(){return function(d){this.highlightSet=
new q;this.ids=new Set;this.paused=!1;this.options=d}}();return function(){function d(b){this.highlights=[];this.layerView=b}d.prototype.destroy=function(){this.highlights.forEach(function(b){return b.highlightSet.removeAll()});this.highlights=null};d.prototype.acquireSet=function(b){var d=this,e=new g(b);this.highlights.push(e);return{set:e,handle:{remove:function(){return d.releaseSet(e)},pause:function(){e.highlightSet.removeAll();e.paused=!0},resume:function(){e.paused=!1;d.initializeSet(e)}}}};
d.prototype.releaseSet=function(b){b.highlightSet.removeAll();b=this.highlights?this.highlights.indexOf(b):-1;-1!==b&&this.highlights.splice(b,1)};d.prototype.setFeatureIds=function(b,d){d.forEach(function(d){return b.ids.add(d)});this.initializeSet(b)};d.prototype.initializeSet=function(b){this.layerView._forAllFeatures(function(d,e,g,c){b.ids.has(d)&&(d=g.engineObject.setComponentHighlight(c,e,b.options),b.highlightSet.addObject(g.engineObject,d))},null,!0)};d.prototype.objectCreated=function(b){var d=
this;this.highlights.forEach(function(e){e.paused||d.layerView._forAllFeaturesOfNode(d.layerView._getMetadata(b),function(d,c,a,f){e.ids.has(d)&&(d=b.setComponentHighlight(f,c,e.options),e.highlightSet.addObject(b,d))},!0)})};d.prototype.objectDeleted=function(b){this.highlights.forEach(function(d){d.highlightSet.removeObject(b)})};d.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(b){return b.highlightSet.removeAll()})};return d}()})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../support/Evented ../../webgl-engine/lib/Intersector".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){var n=c.empty(),u={spatialReference:null,extent:n},v=k.vec3f64.create(),r=k.vec3f64.create(),y=k.vec3f64.create(),w=b.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(b){function d(a){return b.call(this)||this}q(d,b);d.prototype.initialize=function(){var a=this.layerView.view;this.view=a;this.renderCoordsHelper=a.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=new p(a.viewingMode);a=this.layerView.layer.fullExtent;
this.zmin=a.zmin;this.zmax=a.zmax};d.prototype.getElevation=function(b){if(a.isPoint(b)){if(!this.renderCoordsHelper.toRenderCoords(b,v))return w.error("could not project point for elevation alignment"),-Infinity}else if(!this.renderCoordsHelper.toRenderCoords(b,this.spatialReference,v))return w.error("could not project point for elevation alignment"),-Infinity;var c=this.layerView.elevationOffset;b=this.zmin+c;c=this.zmax+c;e.vec3.copy(r,v);e.vec3.copy(y,v);this.renderCoordsHelper.setAltitude(c,
r);this.renderCoordsHelper.setAltitude(b,y);this.intersector.intersect(this.intersectLayers,r,y,null,null,1,!1);return this.intersector.results.min.getIntersectionPoint(v)?this.renderCoordsHelper.getAltitude(v):-Infinity};d.prototype.layerChanged=function(){this.spatialReference&&(u.extent=this.computeLayerExtent(this.intersectLayers[0]),u.spatialReference=this.spatialReference,this.emit("elevation-change",u))};d.prototype.objectChanged=function(a){this.spatialReference&&(u.extent=this.computeObjectExtent(a),
u.spatialReference=this.spatialReference,this.emit("elevation-change",u))};d.prototype.computeObjectExtent=function(a){c.empty(n);this.expandExtent(a,n);return n};d.prototype.computeLayerExtent=function(a){c.empty(n);var b=0;for(a=a.getObjects();b<a.length;b++)this.expandExtent(a[b],n);return n};d.prototype.expandExtent=function(a,b){for(var d=a.getBBMin(!0),f=a.getBBMax(!0),g=0;8>g;++g)v[0]=g&1?d[0]:f[0],v[1]=g&2?d[1]:f[1],v[2]=g&4?d[2]:f[2],e.vec3.transformMat4(v,v,a.objectTransformation),this.renderCoordsHelper.fromRenderCoords(v,
v,this.spatialReference),c.expand(b,v);return b};g([f.property({constructOnly:!0})],d.prototype,"layerView",void 0);g([f.property({constructOnly:!0})],d.prototype,"stageLayer",void 0);g([f.property()],d.prototype,"view",void 0);g([f.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],d.prototype,"spatialReference",void 0);return d=g([f.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],d)}(f.declared(l,h.Evented))})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["require",
"exports","../../../../core/Error","../../../../core/promiseUtils"],function(t,d,q,g){function l(b){return g.create(function(d,f){b.oncomplete=function(){return d()};b.onerror=function(){return f(b.error)};b.onabort=function(){return f(b.error)}})}function b(b){return g.create(function(d,f){"done"===b.readyState?null!=b.error?f(b.error):d(b.result):(b.onsuccess=function(){return d(b.result)},b.onerror=function(){return f(b.error)})})}Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(b,
d,c){this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=b;this._storeName=d;this._version=c}d.prototype.init=function(){var d=this;return g.resolve().then(function(){var e=indexedDB.open(d._dbName,d._version);e.onupgradeneeded=function(b){var a=e.result,c=e.transaction,f=a.objectStoreNames.contains(d._storeName)?c.objectStore(d._storeName):a.createObjectStore(d._storeName),
a=a.objectStoreNames.contains("last_access")?c.objectStore("last_access"):a.createObjectStore("last_access");a.indexNames.contains("date")||a.createIndex("date","date",{unique:!1});a.indexNames.contains("byteSize")||a.createIndex("byteSize","byteSize",{unique:!1});b.oldVersion<d._version&&(f.clear(),a.clear())};return b(e)}).then(function(b){d._destroyed?b.close():d._db=b})};d.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};d.prototype.getHitRate=function(){return this._hit/
(this._hit+this._miss)};d.prototype.put=function(b,d){var c=this;return null==this._db?g.reject(new q("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:g.resolve()).then(function(){return c._put(b,d)}).catch(function(a){if(a&&"QuotaExceededError"===a.name)return null==c._quotaReductionPromise&&(c._quotaReductionPromise=c._getCacheSize().then(function(a){return c._removeLeastRecentlyAccessed(d.byteSize+Math.ceil(a*c.quotaReductionFactor))}),
c._quotaReductionPromise.then(function(){return c._quotaReductionPromise=null},function(){return c._quotaReductionPromise=null})),c._quotaReductionPromise.then(function(){return c._put(b,d)});throw a;}).then(function(){c._gcCounter--;0>c._gcCounter&&null!=c._db&&(c._gcCounter=c.gcFrequency,c._getCacheSize().then(function(a){return c._removeLeastRecentlyAccessed(a-c.maxByteSize)}))})};d.prototype.get=function(d){var e=this;return null==this._db?g.resolve(null):g.resolve().then(function(){var c=e._db.transaction(e._storeName,
"readonly").objectStore(e._storeName).get(d);return b(c)}).then(function(b){null==b?++e._miss:e._db&&(++e._hit,e._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:b.byteSize},d));return b}).catch(function(b){++e._miss;return null})};d.prototype.remove=function(d){var e=this;return null==this._db?g.resolve():g.resolve().then(function(){var c=e._db.transaction([e._storeName,"last_access"],"readwrite"),a=c.objectStore(e._storeName),f=c.objectStore("last_access"),
a=a.delete(d),f=f.delete(d);return g.all([b(a),b(f),l(c)])})};d.prototype._put=function(d,f){var c=this._db.transaction([this._storeName,"last_access"],"readwrite"),a=c.objectStore(this._storeName),e=c.objectStore("last_access"),a=a.put(f,d);d=e.put({date:Date.now(),byteSize:f.byteSize},d);return g.all([b(a),b(d),l(c)])};d.prototype._removeLeastRecentlyAccessed=function(b){if(!(0>=b)){var d=this._db.transaction([this._storeName,"last_access"],"readwrite"),c=d.objectStore(this._storeName),a=d.objectStore("last_access"),
e=0,f=a.index("date").openCursor(null,"next");f.onsuccess=function(d){d=f.result;null!=d&&(null!=d.value.byteSize&&(e+=d.value.byteSize),c.delete(d.primaryKey),a.delete(d.primaryKey),e<b&&d.continue())};return l(d)}};d.prototype._getCacheSize=function(){var b=this._db.transaction("last_access"),d=0,c=b.objectStore("last_access").index("byteSize").openKeyCursor();c.onsuccess=function(a){if(a=c.result){var b=a.key;null!=b&&(d+=b);a.continue()}};return l(b).then(function(){return d})};return d}();d.IDBCache=
t;d.whenTransaction=l;d.whenRequest=b})},"esri/views/3d/webgl-engine/materials/component/index":function(){define(["require","exports","./ComponentMaterial","./VertexBufferLayout"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});(function(d){d.create=function(b,d,e){return new q.ComponentMaterial(b,d,e)};d.vertexBufferLayout=g.createVertexBufferLayout})(d.ComponentMaterial||(d.ComponentMaterial={}))})},"esri/views/3d/webgl-engine/materials/component/ComponentMaterial":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/maybe ../../lib/Material ./ComponentGLMaterial ./Parameters ./VertexBufferLayout ../internal/MaterialUtil ../renderers/PreinterleavedRenderer".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function d(a,c,d){d=b.call(this,d)||this;d.supportsEdges=!0;d._parameters=e.fillDefaults(a);d._geometryParameters=c;return d}q(d,b);Object.defineProperty(d.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"geometryParameters",{get:function(){return this._geometryParameters},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"hasTransparency",{get:function(){var a=this._parameters.forceTransparency;if(l.isSome(a))return a;if(1>this._parameters.baseColorOpacity||1>this._parameters.layerOpacity)return!0;a=this._parameters.componentData;return e.isUniformComponentData(a)&&"replace"===a.externalColorMixMode?1>a.externalColor[3]:!0},enumerable:!0,configurable:!0});d.prototype.isVisibleInPass=function(a){if(3!==a)return!0;a=this._parameters.componentData;return e.isUniformComponentData(a)?a.castShadows:!0};d.prototype.isVisible=
function(){var a=this.parameters;if(!b.prototype.isVisible.call(this)||0===a.layerOpacity)return!1;var c=a.componentData;return e.isUniformComponentData(c)?"replace"===c.externalColorMixMode?0<c.externalColor[3]:0<a.baseColorOpacity:!0};d.prototype.updateParameters=function(a){var b=!1,c;for(c in a){var d=a[c];this._parameters[c]!==d&&(b=!0,this._parameters[c]=d)}b&&this.notifyDirty("matChanged");return b};d.prototype.intersect=function(a,b,d,e,f,g,h){c.intersectTriangleGeometry(a,b,d,e,f,g,h)};d.prototype.getGLMaterials=
function(){return{color:f.GLMaterialColor,depthShadowMap:f.GLMaterialDepthShadowMap,normal:f.GLMaterialNormal,depth:f.GLMaterialDepth,highlight:f.GLMaterialHighlight}};d.prototype.createRenderer=function(b,c){return new a(b,c,this)};d.prototype.createBufferWriter=function(){throw Error("Not supported");};d.prototype.createBufferLayout=function(){return k.createVertexBufferLayout(this.geometryParameters)};return d}(b);d.ComponentMaterial=t})},"esri/views/3d/webgl-engine/materials/component/ComponentGLMaterial":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/decorateHelper ../../lib/DefaultTextureUnits ../../lib/GLMaterial ../../lib/ManagingDisposable ./Parameters ../internal/MaterialUtil ../internal/MaterialUtil ../internal/TextureBinding ../../shaders/DefaultPrograms ../../../../webgl/renderState".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){function n(a){if(a.hasTransparency)return p.separateBlendingParams(770,1,771,771)}function u(a){var b;b=a.parameters.slicePlaneEnabled?!1:"none"!==a.parameters.cullFace;if(b)return{face:"front"===a.parameters.cullFace?1028:1029,mode:2305}}Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function d(c,d,e,f){e=b.call(this,d,e)||this;e._passName=c;e.material=d;e._baseColorTexture=new a.TextureBinding(f,d.parameters.baseColorTexture,{textureUniform:"tex",
textureSizeUniform:"texSize",textureUnit:l.DefaultTextureUnits.DIFFUSE});e.createPrograms();e.selectPipeline();e.selectSlot();return e}q(d,b);d.prototype.createPrograms=function(){var a=this;this.programs=k.BindParametersMap.create(this.material.parameters,function(b){return a._createProgram(b)})};d.prototype._createProgram=function(a){var b=this.material.parameters,c=this.material.geometryParameters,d=b.baseColorTexture?c.textureCoordinateRegions?"AtlasTextured":"Textured":"none",f="screen-space"===
b.normals||"none"===c.normals?"screenDerivative":"compressed"===c.normals?"compressed":"default";if("color"===this._passName)return this.programRep.getProgram(h.colorPass,{textureMode:d,vertexColors:c.colors,doubleSided:b.doubleSidedShading,groundNormalShading:"ground"===b.normals,normals:f,componentColor:c.componentData&&!e.isUniformComponentData(b.componentData),textureAlphaMode:"maskBlend",slice:b.slicePlaneEnabled,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO});if("depth"===this._passName||
"depthShadowMap"===this._passName)return this.programRep.getProgram(h.depthPass,{textureMode:d,vertexColors:c.colors,groundNormalShading:"ground"===b.normals,normals:f,componentColor:c.componentData&&!e.isUniformComponentData(b.componentData),textureAlphaMode:"maskBlend",shadowMap:"depthShadowMap"===this._passName,slice:b.slicePlaneEnabled});if("normal"===this._passName)return this.programRep.getProgram(h.normalPass,{textureMode:d,vertexColors:c.colors,groundNormalShading:"ground"===b.normals,normals:f,
componentColor:c.componentData&&!e.isUniformComponentData(b.componentData),textureAlphaMode:"maskBlend",slice:b.slicePlaneEnabled});if("highlight"===this._passName)return this.programRep.getProgram(h.highlightPass,{textureMode:d,vertexColors:c.colors,groundNormalShading:"ground"===b.normals,normals:f,componentColor:c.componentData&&!e.isUniformComponentData(b.componentData),textureAlphaMode:"maskBlend",slice:b.slicePlaneEnabled})};d.prototype.selectPipeline=function(){var a=this.material.parameters;
this.pipelineState="color"===this._passName?p.makePipelineState({blending:n(this.material),culling:u(this.material),polygonOffset:a.polygonOffsetEnabled&&y,stencilTest:a.writeStencil&&{function:{func:519,ref:1,mask:255},operation:{fail:7680,zFail:7680,zPass:7681}},stencilWrite:a.writeStencil&&{mask:255},depthTest:{func:513},depthWrite:p.defaultDepthWriteParams,colorWrite:p.defaultColorWriteParams}):p.makePipelineState({culling:u(this.material),polygonOffset:a.polygonOffsetEnabled&&y,depthTest:{func:513},
depthWrite:p.defaultDepthWriteParams,colorWrite:p.defaultColorWriteParams})};d.prototype.selectSlot=function(){this.slot=this.material.hasTransparency?6:this.material.parameters.writeStencil?2:4};d.prototype.beginSlot=function(a){return a===this.slot};d.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};d.prototype.getPrograms=function(){return k.BindParametersMap.programs(this.programs)};d.prototype.updateParameters=function(){this._baseColorTexture.update(this.material.parameters.baseColorTexture);
this.createPrograms();this.selectPipeline();this.selectSlot()};d.prototype.bind=function(a,b){var d=this.material.parameters,f=this.program=k.BindParametersMap.lookup(this.programs,b);a.bindProgram(f);a.setPipelineState(this.pipelineState);f.setUniform3fv("ambient",d.baseColor);f.setUniform3fv("diffuse",d.baseColor);f.setUniform3fv("specular",r);f.setUniform1f("opacity",d.baseColorOpacity);f.setUniform1f("layerOpacity",d.layerOpacity);e.isUniformComponentData(d.componentData)?(f.setUniform4fv("externalColor",
d.componentData.externalColor),f.setUniform1i("colorMixMode",c.colorMixModes[d.componentData.externalColorMixMode])):(f.setUniform4fv("externalColor",v),f.setUniform1i("colorMixMode",c.colorMixModes.multiply),this.material.geometryParameters.componentData&&(d.componentData.updateTexture(),d.componentData.bind(f,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:l.DefaultTextureUnits.COMPONENT_COLOR})));this._baseColorTexture.bind(a,f);f.setUniform1f("textureAlphaCutoff",.1);
"depth"!==this._passName&&"depthShadowMap"!==this._passName||f.setUniform2fv("nearFar",b.nearFar);"highlight"===this._passName&&c.bindHighlightRendering(a,b,f)};d.prototype.bindView=function(a,b){a=this.material.parameters;var d=this.program=k.BindParametersMap.lookup(this.programs,b),e=b.origin;c.bindView(e,b.view,d);c.bindCamPos(e,b.viewInvTransp,d);a.slicePlaneEnabled&&c.bindSlicePlane(e,b.slicePlane,d);"color"===this._passName&&b.shadowMappingEnabled&&b.shadowMap.bindView(d,e);"normal"===this._passName&&
d.setUniformMatrix4fv("viewNormal",b.viewInvTransp)};d.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};g([f.manageDisposal()],d.prototype,"_baseColorTexture",void 0);return d}(b);b=function(a){function b(b,c,d){c=a.call(this,"color",b,c,d)||this;c.material=b;return c}q(b,a);return b}(t);d.GLMaterialColor=b;b=function(a){function b(b,c,d){c=a.call(this,"depth",b,c,d)||this;c.material=b;
return c}q(b,a);return b}(t);d.GLMaterialDepth=b;b=function(a){function b(b,c,d){c=a.call(this,"depthShadowMap",b,c,d)||this;c.material=b;return c}q(b,a);return b}(t);d.GLMaterialDepthShadowMap=b;b=function(a){function b(b,c,d){c=a.call(this,"normal",b,c,d)||this;c.material=b;return c}q(b,a);return b}(t);d.GLMaterialNormal=b;t=function(a){function b(b,c,d){c=a.call(this,"highlight",b,c,d)||this;c.material=b;return c}q(b,a);return b}(t);d.GLMaterialHighlight=t;var v=[1,1,1,1],r=[0,0,0],y={factor:2,
units:2}})},"esri/views/3d/webgl-engine/materials/component/Parameters":function(){define(["require","exports","../../../../../core/tsSupport/assignHelper","../../lib/TextureBackedBuffer/TextureBackedBuffer"],function(t,d,q,g){Object.defineProperty(d,"__esModule",{value:!0});d.isUniformComponentData=function(b){return!(b instanceof g.TextureBackedBuffer)};d.fillDefaults=function(d){return q({baseColor:l,baseColorOpacity:1,baseColorTexture:null,doubleSidedShading:!1,normals:"screen-space",cullFace:"back",
componentData:b,receiveSSAO:!0,forceTransparency:null,slicePlaneEnabled:!1,polygonOffsetEnabled:!1,writeStencil:!1,layerOpacity:1},d)};var l=[1,1,1],b={externalColor:[1,1,1,1],externalColorMixMode:"multiply",castShadows:!0}})},"esri/views/3d/webgl-engine/materials/internal/TextureBinding":function(){define(["require","exports","../../../../../core/maybe"],function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});t=function(){function d(d,b,f){var e=this;this._textureRep=d;this._textureId=b;
this._options=f;this._textureRef=q.map(this._textureId,function(b){return e._textureRep.aquire(b,!!e._options.initTransparent)})}d.prototype.dispose=function(){var d=this;this._textureRef=q.map(this._textureId,function(b){d._textureRep.release(b)})};d.prototype.bind=function(d,b){q.isSome(this._textureRef)&&(b.setUniform1i(this._options.textureUniform,this._options.textureUnit),d.bindTexture(this._textureRef.getGLTexture(),this._options.textureUnit),this._options.textureSizeUniform&&(d=this._textureRef.getGLTexture(),
b.setUniform2f(this._options.textureSizeUniform,d.descriptor.width,d.descriptor.height)))};d.prototype.update=function(d){var b=this;d!==this._textureId&&(q.map(this._textureId,function(d){b._textureRep.release(d)}),this._textureRef=q.map(d,function(d){return b._textureRep.aquire(d,!!b._options.initTransparent)}))};return d}();d.TextureBinding=t})},"esri/views/3d/webgl-engine/materials/component/VertexBufferLayout":function(){define(["require","exports","../../../support/buffer/InterleavedLayout"],
function(t,d,q){Object.defineProperty(d,"__esModule",{value:!0});d.createVertexBufferLayout=function(d){var g=q.newLayout().vec3f("position");"compressed"===d.normals?g.vec2i16("normalCompressed",{glNormalized:!0}):"default"===d.normals&&g.vec3f("normal");d.textureCoordinates&&g.vec2f("uv0");d.textureCoordinateRegions&&g.vec4u16("region",{glNormalized:!0});d.colors&&g.vec4u8("color");d.componentData&&g.u16("componentIndex");return g.alignTo(4)}})},"esri/views/3d/webgl-engine/materials/renderers/PreinterleavedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ../../lib/Util ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h){t=function(){function d(a,b,c){this._material=c;this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=a;this._materialRep=b;this._glMaterials=k.acquireMaterials(this._material,this._materialRep)}d.prototype.dispose=function(){k.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(d.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasHighlights",{get:function(){return 0<
this._highlightCount},enumerable:!0,configurable:!0});d.prototype.renderPriority=function(){return this._material.renderPriority};d.prototype.modify=function(a){this.updateGeometries(a.toUpdate);this.addAndRemoveGeometries(a.toAdd,a.toRemove);this.updateHighlightCount()};d.prototype.addAndRemoveGeometries=function(a,d){var n=this,t=this._rctx,u=this._dataByOrigin;a.forEach(function(a){var d=a.data;if(d.preinterleaved)if(null==d.vertexData)f.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available.");
else{var m=a.origin.id,r=a.origin.vec3,v=a.uniqueName,w=u.get(m);w||(w={origin:r,highlightCount:0,dataByGeometry:new Map},u.set(m,w));f.setMatrixTranslation3(p,-r[0],-r[1],-r[2]);m=g.mat4f64.create();q.mat4.multiply(m,p,a.transformation);var r=k.generateRenderGeometryVisibleIndexRanges(a),y=k.generateRenderGeometryHighlightRanges(a);y&&(w.highlightCount=null);a=new e(a.name,0,d.indexCount,r,y,m,a.instanceParameters,a.idx,d.id);m=d.indexData?c.createIndex(t,35044,d.indexData):null;r=n._material.createBufferLayout();
m=new h(t,b.Default3D,{geometry:l.glLayout(r)},{geometry:c.createVertex(t,35044)},m);m.vertexBuffers.geometry.setData(d.vertexData);d.indexData=null;d.vertexData=null;w.dataByGeometry.set(v,{instance:a,vao:m})}else f.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")});d.forEach(function(a){var b=a.origin.id;a=a.uniqueName;var c=u.get(b);c.dataByGeometry.get(a).vao.dispose();c.dataByGeometry.delete(a);0===c.dataByGeometry.size&&u.delete(b)})};d.prototype.updateGeometries=function(a){var b=
this;a.forEach(function(a){var c=a.updateType;a=a.renderGeometry;var d=a.uniqueName,e=b._dataByOrigin.get(a.origin.id);if(d=e&&e.dataByGeometry.get(d).instance)c&1&&(d.displayedIndexRange=k.generateRenderGeometryVisibleIndexRanges(a)),c&17&&(d.highlightedIndexRanges=k.generateRenderGeometryHighlightRanges(a),e.highlightCount=null),c&2&&console.error("Updating Preinterleaved geometry not supported"),c&4&&k.calculateTransformRelToOrigin(a,d.transformation,d.transformationNormal)})};d.prototype.updateHighlightCount=
function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(b){if(null==b.highlightCount){var c=0;b.dataByGeometry.forEach(function(a){a.instance.highlightedIndexRanges&&++c});b.highlightCount=c}a._highlightCount+=b.highlightCount})};d.prototype.render=function(a,b,c,d){var e=this,f=this._rctx,g=this._glMaterials.get(b.pass),h=4===b.pass;if(!g||null!=a&&!g.beginSlot(a)||h&&0===this._highlightCount)return!1;g.bind(f,c);var k=!1;this._dataByOrigin.forEach(function(a){h&&0===a.highlightCount||
(c.origin=a.origin,g.bindView(f,c),h?a.dataByGeometry.forEach(function(a){k=e.renderInstanceHighlight(g,a,d)||k}):a.dataByGeometry.forEach(function(a){k=e.renderInstance(g,a,d)||k}))});g.release(f,c);f.bindVAO(null);return k};d.prototype.renderInstance=function(b,c,d){var e=c.instance,f=c.vao,g=e.displayedIndexRange;if(g&&0===g.length)return!1;c=this._rctx;var h=b.getProgram(),l=b.getDrawMode();a.assertCompatibleVertexAttributeLocations(f,h);c.bindVAO(f);b.bindInstance(c,e);b=f.indexBuffer&&f.indexBuffer.indexType;
g?b?k.drawElementsFaceRange(c,g,e.from,l,b,d):k.drawArraysFaceRange(c,g,e.from,l,d):(g=e.to-e.from,b?k.drawElements(c,l,b,e.from,g,d):k.drawArrays(c,l,e.from,g,d));return!0};d.prototype.renderInstanceHighlight=function(b,c,d){var e=c.instance,f=c.vao;c=e.highlightedIndexRanges;if(!c)return!1;var g=this._rctx,h=b.getProgram(),l=b.getDrawMode();a.assertCompatibleVertexAttributeLocations(f,h);g.bindVAO(f);b.bindInstance(g,e);b=f.indexBuffer&&f.indexBuffer.indexType;h=!1;for(f=0;f<c.length;f++){var n=
c[f],h=n.range?n.range[0]+e.from:e.from,n=n.range?n.range[1]-n.range[0]+1:e.to-e.from;b?k.drawElements(g,l,b,h,n,d):k.drawArrays(g,l,h,n,d);h=!0}return h};return d}();var p=g.mat4f64.create();return t})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/FeatureSet".split(" "),function(t,d,q,g,l,b){return function(){function d(b,d,c){this._layer=b;
this._support=d;this._options=c}d.prototype.queryExtent=function(b){var d=this;return this._rejectUnsupported(b).then(function(){var c=0,a=d._support.createExtentBuilder();d._forAllQueried(b,function(b){c++;a.add(b)});return{count:c,extent:0===c?null:a.getExtent()}})};d.prototype.queryFeatureCount=function(b){var d=this;return this._rejectUnsupported(b).then(function(){var c=0;d._forAllQueried(b,function(){return c++});return c})};d.prototype.queryFeatures=function(d){var e=this;return this._rejectUnsupported(d).then(function(){var b=
[],a=d&&d.outFields,f=[];if(0<e._forAllQueried(d,function(a){return f.push(e._support.createGraphic(a))},function(c){a&&(b.push(e._support.requestFields(c,f,a)),f=[])})&&!d.num)return g.reject(new q("Unsupported Query","Large feature query, use Query.num and Query.start to batch"));a||b.push(g.resolve(f));return g.all(b)}).then(function(c){for(var a=[],d=0;d<c.length;++d)for(var f=c[d],g=0;g<f.length;++g)a.push(l.hydrateGraphic(f[g],e._layer));c=new b;c.features=a;return c})};d.prototype.queryObjectIds=
function(b){var d=this;return this._rejectUnsupported(b).then(function(){var c=[];d._forAllQueried(b,function(a){return c.push(a.id)});return c})};d.defaultExtentBuilder=function(b){var d=null;return{add:function(c){(c=b(c))&&(d=null!=d?d.union(c):c.clone())},getExtent:function(){return d}}};d.prototype._forAllQueried=function(b,d,c){var a=[];if(b&&b.objectIds){var e=b.objectIds;a.push(function(a){return 0<=e.indexOf(a.id)})}var f=b&&b.start||0,g=b&&b.num||1E4;a.push(function(){if(0>=g)return--g,
!1;if(0<f)return--f,!1;--g;return!0});this._support.forAll(function(b){for(var c=0;c<a.length;c++)if(!(0,a[c])(b))return;d(b)},c);return Math.max(0,-g)};d.prototype._rejectUnsupported=function(b){if(null==b)return g.resolve();var d=function(b){return g.reject(new q("Unsupported Query","Unsupported property '"+b+"'"))};return null!=b.distance?d("distance"):null!=b.geometryPrecision?d("geometryPrecision"):b.groupByFieldsForStatistics&&b.groupByFieldsForStatistics.length?d("groupByFieldsForStatistics"):
null!=b.maxAllowableOffset?d("maxAllowableOffset"):b.multipatchOption?d("multipatchOption"):b.orderByFields&&b.orderByFields.length?d("orderByFields"):b.outSpatialReference?d("outSpatialReference"):b.outStatistics&&b.outStatistics.length?d("outStatistics"):b.pixelSize?d("pixelSize"):b.quantizationParameters?d("quantizationParameters"):b.relationParameter?d("relationParameter"):b.returnDistinctValues?d("returnDistinctValues"):b.text?d("text"):b.timeExtent?d("timeExtent"):b.where?d("where"):b.geometry?
d("geometry"):!this._options.enableOutFields&&b.outFields&&b.outFields.length?d("outFields"):!this._options.enableObjectId&&b.objectIds&&b.objectIds.length?d("objectIds"):g.resolve()};return d}()})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../core/sql/WhereClause ../../../../layers/support/fieldUtils ../i3s/I3SUtil".split(" "),
function(t,d,q,g,l,b,f,e,k,c){Object.defineProperty(d,"__esModule",{value:!0});var a=b.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");t=function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c._definitionExpressionErrors=0;c._maxDefinitionExpressionErrors=20;c.logError=function(b){c._definitionExpressionErrors<c._maxDefinitionExpressionErrors&&a.error("Error while evaluating definitionExpression: "+b);c._definitionExpressionErrors++;c._definitionExpressionErrors===
c._maxDefinitionExpressionErrors&&a.error("Further errors are ignored")};return c}q(d,b);Object.defineProperty(d.prototype,"parsedDefinitionExpression",{get:function(){if(this.layer.definitionExpression)try{var b=e.create(this.layer.definitionExpression);if(!b.isStandardized())return a.error("definitionExpression is using non standard function"),null;var d=[],f=b.getFields();c.findFieldsCaseInsensitive(f,this.layer.fields,{missingFields:d});if(0<d.length)return a.error("definitionExpression references unknown fields: "+
d.join(", ")),null;this._definitionExpressionErrors=0;return b}catch(r){a.error("Failed to parse definitionExpression: "+r)}return null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"definitionExpressionFields",{get:function(){return this.parsedDefinitionExpression?k.fixFields(this.layer.fields,this.parsedDefinitionExpression.getFields()):null},enumerable:!0,configurable:!0});d.prototype._evaluateClause=function(a,b){try{return a.testFeature(b)}catch(v){return this.logError(v),
!1}};g([f.property()],d.prototype,"layer",void 0);g([f.property({readOnly:!0,dependsOn:["layer.definitionExpression"]})],d.prototype,"parsedDefinitionExpression",null);g([f.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],d.prototype,"definitionExpressionFields",null);return d=g([f.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],d)}(f.declared(l));d.DefinitionExpressionSceneLayerView=t;d.default=t})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/fieldUtils ../LayerView3D ../../../layers/support/popupUtils".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p){Object.defineProperty(d,"__esModule",{value:!0});t=function(d){function h(){return null!==d&&d.apply(this,arguments)||this}q(h,d);h.prototype._validateFetchPopupFeatures=function(a){var b=this.layer;if(!b.popupEnabled)return new f("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:b});if(!p.getFetchPopupTemplate(b,a))return new f("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:b})};h.prototype.fetchPopupFeatures=
function(c,d){return b(this,void 0,void 0,function(){var b,c,f,g,h,n,q,r,t,u;return l(this,function(l){switch(l.label){case 0:if(b=this._validateFetchPopupFeatures(d))return[2,k.reject(b)];c=e.isSome(d)?d.clientGraphics:null;if(!c||0===c.length)return[2,k.resolve([])];f=[];g=[];n=a.unpackFieldNames;q=[this.layer.fields];return[4,p.getRequiredFields(this.layer,p.getFetchPopupTemplate(this.layer,d))];case 1:h=n.apply(void 0,q.concat([l.sent()]));r=0;for(t=c;r<t.length;r++)u=t[r],a.featureHasFields(h,
u)?f.push(u):g.push(u);return 0===g.length?[2,k.resolve(f)]:[2,this.whenGraphicAttributes(g,h).catch(function(){return g}).then(function(a){return f.concat(a)})]}})})};return h=g([c.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],h)}(c.declared(h));d.PopupSceneLayerView=t;d.default=t})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array @dojo/framework/shim/Set ../../../Graphic ../../../core/arrayUtils ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/rbush/PooledRBush ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../renderers/support/renderingInfoUtils ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/Graphics3DVerticalScale ./i3s/I3SQueryEngine ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/GraphicsMap ../support/orientedBoundingBox ../support/projectionUtils ../../layers/support/FeatureFilter".split(" "),
function(t,d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M,Q,P,O,U,N,V){function X(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].graphics;d<e.length;d++){var f=e[d];f.attributes||(f.attributes={});if(b.loadedAttributes)for(var g=0,h=b.loadedAttributes;g<h.length;g++){var k=h[g].name;b.attributeData[k]&&(f.attributes[k]=K.getCachedAttributeValue(b.attributeData[k],c))}}}var J=h.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D");t=function(d){function h(a){a=d.call(this)||this;
a._nodesAddedToStage=new Map;a.overlayUpdating=!1;a.supportsDraping=!0;a._queryEngine=null;a._memCache=null;a.loadedGraphics=new O.GraphicsMap;a.progressiveLoadFactor=1;a.supportsHeightUnitConversion=!0;a._coordinatesOutsideExtentErrors=0;a._maxCoordinatesOutsideExtentErrors=20;return a}q(h,d);h.prototype.initialize=function(){var a=this;K.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);this.handles.add([u.init(this,["layer.renderer","layer.labelingInfo","layer.labelsVisible",
"definitionExpressionFields"],function(){return a._updateRequiredFields()}),u.init(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)}),this.layer.watch("renderer",function(b,c){return a._rendererChange(b,c)}),this.watch(["layer.objectIdFilter","parsedDefinitionExpression"],function(){return a._filterChange()})]);this._set("graphics3d",new G({owner:this,layer:this.layer,asyncGraphicsUpdates:!0,scaleVisibilityEnabled:!1,filterVisibilityEnabled:!0,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,
elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:this.layer.fullExtent,updateClippingExtent:function(b){return a._updateClippingExtent(b)},queryGraphicUIDsInExtent:function(b,c,d){return a._queryGraphicUIDsInExtent(b,c,d)}}));this.supportsHeightUnitConversion&&(this._verticalScale=new L({sourceSpatialReference:this.layer.spatialReference,destSpatialReference:this.view.spatialReference}));this.addResolvingPromise(this.graphics3d.setup());this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);
this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid);this._controller=new C({layerView:this});this.when(function(){a.handles.add([u.init(a,"maximumNumberOfFeatures",function(b){return a._controller.featureTarget=b}),u.whenTrue(a,"suspended",function(){return a._removeAllNodeData()})])})};h.prototype.destroy=function(){this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this._controller&&(this._controller.destroy(),this._controller=null);this._memCache.destroy();
this._nodesAddedToStage=this._elevationUpdateNodes=this._memCache=null};Object.defineProperty(h.prototype,"maximumNumberOfFeatures",{get:function(){var a=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return a?a.maximumNumberOfFeatures:0},set:function(a){null!=a?(this._override("maximumNumberOfFeatures",a),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return this.suspended?!1:!!this._controller&&!this._controller.leafsReached},enumerable:!0,configurable:!0});h.prototype.whenGraphicAttributes=function(a,b){var c=this;return K.whenGraphicAttributes(this.layer,a,this._getObjectIdField(),b,function(a){for(var b=new Map,d=[],e=0;e<a.length;e++){var f=a[e],g=c._findGraphicNodeAndIndex(f),h=b.get(g.node);h||(h={node:g.node,indices:[],graphics:[]},d.push(h));h.indices.push(g.index);
h.graphics.push(f)}return d},{ignoreUnavailableFields:!0,populateObjectId:!0})};h.prototype.getGraphicFromGraphicUid=function(a){if(!this.loadedGraphics)return null;var b=A.hydrateGraphic(this.loadedGraphics.find(function(b){return b.uid===a}),this.layer),c=this._getObjectIdField();if(!b||!b.attributes||!b.attributes[c])return null;b.layer=this.layer;b.sourceLayer=this.layer;return b};h.prototype.whenGraphicBounds=function(a,b){return this.graphics3d.graphicsCore.whenGraphicBounds(a,b)};h.prototype.canResume=
function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};h.prototype.isUpdating=function(){return this.overlayUpdating||this._controller&&this._controller.updating||this.graphics3d&&this.graphics3d.updating};h.prototype.getRenderingInfo=function(a,b){(a=E.getRenderingInfo(a,{renderer:b}))&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};Object.defineProperty(h.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},
enumerable:!0,configurable:!0});h.prototype._findGraphicNodeAndIndex=function(a){a=a.attributes[this.layer.objectIdField];for(var b=0,d=c.keysOfMap(this._nodesAddedToStage);b<d.length;b++){var e=d[b],f=this._nodesAddedToStage.get(e),f=this._findGraphicIndex(f.bundle,a);if(0<=f)return{node:this._controller.getNode(e),index:f}}return null};h.prototype._forAllFeatures=function(a,b){this._nodesAddedToStage.forEach(function(c,d){c=c.bundle;for(var e=0;e<c.length;e++)for(var f=c[e].graphics,g=0;g<f.length;g++){var h=
f[g],k=c[e].featureIds[g];h.visible&&a(k,e,h)}null!=b&&b({nodeId:d})})};h.prototype._getGraphicIndices=function(a,b){a=this._nodesAddedToStage.get(a);for(var c=this._getObjectIdField(),d=[],e=0;e<b.length;e++){var f=this._findGraphicIndex(a.bundle,b[e].attributes[c]);0<=f&&d.push(f)}return d};h.prototype._findGraphicIndex=function(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].featureIds;d<e.length;d++)if(e[d]===b)return c;return-1};h.prototype._queryGraphicUIDsInExtent=function(b,c,d){if(this._controller){var e=
this._controller.crsIndex;N.boundingRectToBoundingRect(b,c,W,e);var f=Z;w.fromRect(f,W);f[2]=-Infinity;f[5]=Infinity;null==this._elevationUpdateNodes&&(this._elevationUpdateNodes=new p);var g=this._elevationUpdateNodes;this._controller.updateElevationChanged(f,e,g);for(e=0;e<g.length;e++){var h=this._nodesAddedToStage.get(g.data[e].id);if(null!=h){if(!h.spatialIndex&&h.bundle.length>=T){for(var k=new y.PooledRBush(9,a("csp-restrictions")?function(a){return{minX:a.extent[0],minY:a.extent[1],maxX:a.extent[2],
maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),l=ja.length=0,n=h.bundle;l<n.length;l++){for(var q=n[l],r=m.empty(),t=0,u=q.graphics;t<u.length;t++)f=u[t],A.expandAABR(f.geometry,r);q.extent=r;ja.push(q)}k.load(ja);h.spatialIndex=k}if(h.spatialIndex)f=W,N.boundingRectToBoundingRect(b,c,W,this.view.spatialReference),fa.minX=f[0],fa.minY=f[1],fa.maxX=f[2],fa.maxY=f[3],h.spatialIndex.search(fa,function(a){var b=0;for(a=a.graphics;b<a.length;b++)d(a[b].uid)});else for(k=0,h=
h.bundle;k<h.length;k++)for(q=h[k],l=0,q=q.graphics;l<q.length;l++)f=q[l],d(f.uid)}}}};h.prototype.highlight=function(a,b){void 0===b&&(b={});return this.graphics3d.highlight(a,b,this.layer.objectIdField)};h.prototype.addNodeData=function(a,b){if(this._nodesAddedToStage.has(a.id))J.error("I3S node "+a.id+" already added");else{var c=b.allGeometryData,d=b.attributeDataInfo,e=this._controller.crsIndex;b=this.view.spatialReference;var f=[0,0,0],g=this._getObjectIdField(),h=[],l;if(l=this.layer.fullExtent)l=
this.layer.fullExtent.clone(),l.xmin-=.5,l.ymin-=.5,l.xmax+=.5,l.ymax+=.5,l.hasZ&&(l.zmin-=.5,l.zmax+=.5),l.hasM&&(l.mmin-=.5,l.mmax+=.5);var m=l;l=[];for(var p=[],q=0;q<c.length;q++){var r=c[q],t=r.featureDataPosition,u=t.length,v=r.geometries||[R[u]],w=r.featureIds;m&&!x.extentContainsCoords3D(m,t)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&J.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&
J.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);for(var y=0;y<v.length;y++){var B=v[y];if("points"===B.params.type){var C=[],E=w[y<w.length?y:0],F={};null!=E&&(F[g]=E);var E=null==E?k.generateUID():E,G=void 0;"Embedded"===B.type&&(G=B.params.vertexAttributes.position);for(B=0;B<G.length;B+=u){for(var I=0;I<u;I++)f[I]=t[I]+G[B+I];N.bufferToBuffer(f,e,0,ga,b,0,1);I=A.makeDehydratedPoint(ga[0],ga[1],ga[2],b);3>u&&(I.z=void 0);C.push({uid:E,
geometry:I,attributes:F,visible:!0});a.obb||p.push(I.x,I.y,I.z?I.z:0)}l.push.apply(l,C);h.push({featureIds:r.featureIds,graphics:C})}}}a.numFeatures=l.length;this._updateNodeMemory(a);c={bundle:h,attributeInfo:d};X(c.bundle,c.attributeInfo);0<p.length&&(d=this.view.renderSpatialReference,e=this._controller.crsVertex,N.bufferToBuffer(p,b,0,p,d,0,p.length/3),a.obb=U.compute({data:p,size:3,offsetIdx:0,strideIdx:3}),N.vectorToVector(a.obb.center,d,a.obb.center,e),this._controller.updateVisibility(a.id));
if(!this._controller.isGeometryVisible(a))return this._cacheNodeData(a.id,c),n.resolve();this._verticalScale&&this._verticalScale.adjust(l);this._nodesAddedToStage.set(a.id,c);this.loadedGraphics.addMany(l);this._filterNode(c);return n.resolve()}};h.prototype.isNodeLoaded=function(a){return this._nodesAddedToStage.has(a.id)};h.prototype._updateNodeMemory=function(a){a.memory=4096+a.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic};h.prototype._cacheNodeData=function(a,b){var c=b.bundle.reduce(function(a,
b){return b.graphics.reduce(function(a,b){return A.estimateSize(b)+a},512+8*b.featureIds.length+a)},1024);this._memCache.put(a,b,c)};h.prototype._removeAllNodeData=function(){var a=this;this._nodesAddedToStage.forEach(function(b,c){if(b){var d=a._controller.getNode(c);a._updateNodeMemory(d);a._cacheNodeData(c,b)}});this._nodesAddedToStage.clear();this.loadedGraphics.clear()};h.prototype.removeNodeData=function(a,b){for(;0<a.length&&!b.done;){var c=a.pop(),d=this._removeNodeStageData(c);d&&(this._updateNodeMemory(c),
this._cacheNodeData(c.id,d));b.madeProgress()}};h.prototype._removeNodeStageData=function(a){var b=this._nodesAddedToStage.get(a.id);if(!b)return null;for(var c=0,d=b.bundle;c<d.length;c++)this.loadedGraphics.removeMany(d[c].graphics);this._nodesAddedToStage.delete(a.id);return b};h.prototype.loadCachedNodeData=function(a,b){return n.resolve(this._memCache.pop(a.id))};h.prototype.addCachedNodeData=function(a,b,c){if(this._nodesAddedToStage.has(a.id))J.error("I3S node "+a.id+" already added");else{for(var d=
0,e=b.bundle;d<e.length;d++)this.loadedGraphics.addMany(e[d].graphics);this._nodesAddedToStage.set(a.id,b);this._updateNodeMemory(a);this.setAttributeData(a,c);this._filterNode(b);return n.resolve()}};h.prototype.getLoadedNodeIDs=function(){return c.keysOfMap(this._nodesAddedToStage)};h.prototype.getLoadedAttributes=function(a){if(a=this._nodesAddedToStage.get(a.id))return a.attributeInfo.loadedAttributes};h.prototype.getAttributeData=function(a){if(a=this._nodesAddedToStage.get(a.id))return a.attributeInfo.attributeData};
h.prototype.setAttributeData=function(a,b){if(a=this._nodesAddedToStage.get(a.id))a.attributeInfo=b,X(a.bundle,b),this._filterNode(a),this.graphics3d.graphicsCore.labelsEnabled&&(b=a.bundle.map(function(a){return a.graphics.length&&a.graphics[0].uid}),this.graphics3d.graphicsCore.updateLabelingInfo(b))};h.prototype._updateClippingExtent=function(a){this._controller&&this._controller.updateClippingArea(a);return!1};h.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};
h.prototype._rendererChange=function(a,c){return b(this,void 0,void 0,function(){var b,d,g,h;return l(this,function(k){switch(k.label){case 0:return b=this.layer.fields,d=new e.default,a?[4,a.collectRequiredFields(d,b)]:[3,2];case 1:return k.sent(),g=f.from(d).sort(),[3,3];case 2:g=[],k.label=3;case 3:return d.clear(),c?[4,c.collectRequiredFields(d,b)]:[3,5];case 4:return k.sent(),h=f.from(d).sort(),[3,6];case 5:h=[],k.label=6;case 6:if(g.length===h.length&&g.every(function(a,b){return g[b]===h[b]}))return[2];
this._reloadAllNodes();return[2]}})})};h.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&J.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};h.prototype._filterChange=function(){var a=this;this._nodesAddedToStage.forEach(function(b){return a._filterNode(b)})};h.prototype._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};h.prototype._filterNode=function(a){var b=
this._getObjectIdField(),c=null;if(this.layer.objectIdFilter)var d=this.layer.objectIdFilter.ids,e="include"===this.layer.objectIdFilter.method,c=function(a){return 0<=d.indexOf(a)===e};var f=this.parsedDefinitionExpression,g=0;for(a=a.bundle;g<a.length;g++)for(var h=0,k=a[g].graphics;h<k.length;h++){var l=k[h],m=l.visible;c&&!c(l.attributes[b])?l.visible=!1:l.visible=f?this._evaluateClause(f,l):!0;m!==l.visible&&(ia.graphic=l,ia.property="visible",ia.oldValue=m,ia.newValue=l.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(ia))}};
h.prototype._updateRequiredFields=function(){return b(this,void 0,void 0,function(){var a,b,c,d,g,h,k,m;return l(this,function(l){switch(l.label){case 0:return a=this,c=b=a.layer,d=c.fields,g=c.renderer,h=c.labelsVisible,k=a.definitionExpressionFields,m=new e.default,g?[4,g.collectRequiredFields(m,d)]:[3,2];case 1:l.sent(),l.label=2;case 2:return h?[4,B.collectLabelingFields(m,b)]:[3,4];case 3:l.sent(),l.label=4;case 4:return B.collectFields(m,d,k),this._set("requiredFields",f.from(m).sort()),[2]}})})};
h.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)};h.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)};h.prototype.queryFeatures=function(a){return this._ensureQueryEngine().queryFeatures(a)};h.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().queryObjectIds(a)};h.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};h.prototype._createQueryEngine=
function(){var a=this,b={id:0,index:0,graphic:null},c=this;return new F(this.layer,{forAll:function(c,d){a._forAllFeatures(function(a,d,e){b.id=a;b.index=d;b.graphic=e;c(b)},d)},createGraphic:function(a){return A.hydrateGraphic(a.graphic,c.layer)},requestFields:function(b,c,d){return K.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),d,function(c){var d=a._getGraphicIndices(b.nodeId,c);return[{node:a._controller.getNode(b.nodeId),indices:d,graphics:c}]},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){var b=
w.empty(),c=a.layer.spatialReference;return{add:function(a){return A.expandAABB(a.graphic.geometry,b)},getExtent:function(){return w.toExtent(b,c)}}}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})};h.prototype.getUsedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return a?a.usedMemory:0};h.prototype.getUnloadedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(a?a.unprocessedMemoryEstimate:
0))};h.prototype.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};h.prototype.getNumberOfNodes=function(){return this._nodesAddedToStage.size};h.prototype.getNumberOfFeatures=function(){return this.loadedGraphics.length};h.prototype.getStats=function(){var a=this.graphics3d.graphicsCore.getStats();a.nodes=this.getNumberOfNodes();a.features=this.loadedGraphics.length;this._controller&&this._controller.updateStats(a);return a};g([v.property()],h.prototype,
"graphics3d",void 0);g([v.property()],h.prototype,"drawingOrder",void 0);g([v.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],h.prototype,"hasDraped",void 0);g([v.property({type:Boolean})],h.prototype,"overlayUpdating",void 0);g([v.property({type:Boolean})],h.prototype,"supportsDraping",void 0);g([v.property({type:V})],h.prototype,"filter",void 0);g([v.property()],h.prototype,"loadedGraphics",void 0);g([v.property()],h.prototype,"layer",void 0);g([v.property()],h.prototype,"_controller",
void 0);g([v.property({dependsOn:["_controller.updating","graphics3d.updating","overlayUpdating"]})],h.prototype,"updating",void 0);g([v.property({dependsOn:["_controller.rootNodeVisible"]})],h.prototype,"suspended",void 0);g([v.property(Q.updatingPercentage)],h.prototype,"updatingPercentage",void 0);g([v.property({aliasOf:"_controller.updatingPercentage"})],h.prototype,"updatingPercentageValue",void 0);g([v.property({readOnly:!0})],h.prototype,"requiredFields",void 0);g([v.property({type:Number,
dependsOn:["graphics3d.graphicsCore.displayFeatureLimit"]})],h.prototype,"maximumNumberOfFeatures",null);g([v.property({readOnly:!0,dependsOn:["suspended","_controller.leafsReached"]})],h.prototype,"maximumNumberOfFeaturesExceeded",null);g([v.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],h.prototype,"lodFactor",void 0);return h=g([v.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],h)}(v.declared(I,P.PopupSceneLayerView,M.DefinitionExpressionSceneLayerView));
var R={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},T=100,W=m.create(),Z=w.create(w.POSITIVE_INFINITY),fa={minX:0,minY:0,maxX:0,maxY:0},ga=r.vec3f64.create(),ja=[],ia={graphic:null,property:null,oldValue:null,newValue:null};return t})},"esri/views/3d/support/GraphicsMap":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","@dojo/framework/shim/Map","./Evented"],
function(t,d,q,g,l){Object.defineProperty(d,"__esModule",{value:!0});t=function(b){function d(){var d=null!==b&&b.apply(this,arguments)||this;d._map=new g.default;return d}q(d,b);d.prototype.clear=function(){if(0<this._map.size){var b=this.toArray();this._map.clear();this.emit("change",{added:[],removed:b})}};Object.defineProperty(d.prototype,"length",{get:function(){return this._map.size},enumerable:!0,configurable:!0});d.prototype.addMany=function(b){if(0!==b.length){for(var d=new Set,c=0;c<b.length;c++){var a=
b[c],e=a.uid;this._map.has(e)?(d.add(e),++this._map.get(e).refCount):(a.refCount=1,this._map.set(e,a))}b=0<d.size?b.filter(function(a){return!d.has(a.uid)}):b;this.emit("change",{added:b,removed:[]})}};d.prototype.removeMany=function(b){for(var d=[],c=0;c<b.length;c++){var a=b[c],e=a.uid,f=this._map.get(e);null!=f&&0>=--f.refCount&&this._map.delete(e)&&d.push(a)}0<d.length&&this.emit("change",{added:[],removed:d})};d.prototype.toArray=function(){var b=Array(this._map.size),d=0;this._map.forEach(function(c){return b[d++]=
c});return b};d.prototype.find=function(b){for(var d=this._map.entries(),c=d.next();!c.done;c=d.next())if(b(c.value[1]))return c.value[1]};d.prototype.forEach=function(b){this._map.forEach(function(d){return b(d)})};return d}(l.Evented);d.GraphicsMap=t})},"*now":function(t){t(['dojo/i18n!*preload*esri/views/nls/SceneView*["ar","bs","ca","cs","da","de","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/assignHelper dojo/dom ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/asyncUtils ../core/Collection ../core/Error ../core/Handles ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/scheduling ../core/watchUtils ./../core/screenUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3f64 ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/Deconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/layers/support/FeatureTileTree3DDebugger ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/geometryUtils ./3d/support/HighlightOptions ./3d/support/index ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/SharedSymbolResources ./3d/support/geometryUtils/boundedPlane ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/intersectorUtils ./support/screenshotUtils ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment".split(" "),function(t,
d,q,g,l,b,f,e,k,c,a,h,p,n,u,v,r,y,w,m,x,A,C,B,E,I,G,L,F,K,M,Q,P,O,U,N,V,X,J,R,T,W,Z,fa,ga,ja,ia,ka,da,Y,ha,ea,ma,aa,qa,na,sa,z,la,oa,ta,Ba,ya,Sa,Pa,Wa,fb,Ga,kb,vb,Qa){function gb(a,b){a.layerUids||(a.layerUids=new Set);a.layerUids.add(b)}function ua(a,b){a.graphicUids||(a.graphicUids=new Set);a.graphicUids.add(b)}var Ia=w.getLogger("esri.views.SceneView");d=function(d){function f(a){var b=d.call(this)||this;b._clippingArea=null;b._internallyReady=!1;b._userClippingArea=null;b._initialDefaultSpatialReference=
null;b._defaults={};b._externallySet={environment:!1};b._handles=new r;b._createGraphicsViewPromise=null;b._updateDrawingOrderHandle=null;b._stageFrameTask=null;b.onViewExtentUpdateHandle=null;b._resolveWhenReady=[];b.propertiesPool=new sa.default({slicePlane:ta.BoundedPlaneClass},b);b._resourceController=aa.newResourceController(b);b._defaultToMapOptions={include:new Set};b._defaultHitTestOptions={exclude:new Set};b.deconflictor=new W.Deconflictor(b);b.labeler=new Z.Labeler({view:b});b.renderSpatialReference=
null;b.sharedSymbolResources=null;b.basemapTerrain=null;b.elevationProvider=null;b.camera=null;b.canvas=null;b.center=null;b.constraints=new X.default;b.extent=null;b.fullOpacity=1;b.graphicsView=null;b.groundView=null;b.map=null;b.screenSizePerspectiveEnabled=!0;b.state=null;b.scale=null;b.spatialReference=null;b.isHeightModelInfoRequired=!0;b.alphaCompositingEnabled=!1;b.type="3d";b.ui=new vb;b.updating=!1;b.updatingPercentage=0;b.viewpoint=null;b.zoom=null;b.highlightOptions=new ma;a&&a.environment||
(b._defaults.environment=new J,b.environment=b._defaults.environment);a=function(){return b.notifyChange("dataExtent")};b._handles.add([C.when(b,"ready",function(a,c){return b._viewReadyHandler(c)}),C.on(b,"allLayers","change",a,a,a,!0),b.allLayerViews.on("change",function(a){return b._updateUpdatingMonitors(a)}),b.watch("map",function(a){a&&a.load&&a.load()})]);b.inputManager=new T({view:b});b.stateManager=new ia.ViewStateManager({view:b,updateDevicePixelRatio:function(){return b.notifyChange("pixelRatio")}});
return b}q(f,d);f.prototype.initialize=function(){var a=this;this.groundView=new O({view:this});this.environmentManager=new R.default({view:this});this._updateUpdatingMonitors({added:this.allLayerViews.toArray(),removed:[]});this._handles.add([this.resourceController.memoryController.events.on("updating-changed",function(){return a._evaluateUpdating()}),C.whenNot(this,"ready",function(b,c){return a._viewUnreadyHandler(c)}),C.init(this.qualitySettings,"memoryLimit",function(b){a.resourceController&&
(a.resourceController.memoryController.maxMemory=b)}),C.init(this.qualitySettings,"additionalCacheMemory",function(b){a.resourceController&&(a.resourceController.memoryController.additionalCacheMemory=b)}),C.init(this.qualitySettings,"frameRate",function(a){return A.setFrameDuration(0<a?1E3/Math.ceil(a):0)}),C.init(Y,"SCENEVIEW_LOCKING_LOG",function(b){return a.defaultsFromMap.logDebugInformation=b}),C.on(this,"map.allLayers","after-changes",function(){return a._updateDefaultToMapOptions()},function(){return a._updateDefaultToMapOptions()},
function(){return a._updateDefaultToMapOptions()}),C.init(this,"map.ground",function(){return a._updateDefaultToMapOptions()},!0),C.init(this,"map.ground.opacity",function(){return a._updateDefaultHitTestOptions()},!0)])};f.prototype.destroy=function(){this.activeTool=null;this.layerViewManager.clear();this.stateManager.deinit();this.groundView.destroy();this.groundView=null;this.destroyViewData();this._disposeSurface();this._disposeGraphicsView();this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),
this.sharedSymbolResources=null);this._stage&&(this._stage.dispose(),this._stage=null,this._handles.remove("stage"));this._set("canvas",null);this.labeler.destroy();this.labeler=null;this.deconflictor.destroy();this.deconflictor=null;this._resourceController.destroy();this._resourceController=null;this.environmentManager.destroy();this._set("environmentManager",null);this.stateManager.destroy();this._set("stateManager",null);this.inputManager.destroy();this._set("inputManager",null);this._handles.destroy();
this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(f.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;var a=this.get("map.clippingEnabled"),b=this.get("map.clippingArea");if(!a||!b)return this._clippingArea=null;if(!(b instanceof c.Extent))return Ia.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(!M.canProject(b.spatialReference,
this.spatialReference))return Ia.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;b=M.project(b,this.spatialReference);return this._clippingArea&&b&&this._clippingArea.equals(b)?this._clippingArea:this._clippingArea=b},set:function(a){this.ready&&"global"===this.viewingMode&&a?Ia.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"dataExtent",{get:function(){var a=[],b=this.spatialReference||c.SpatialReference.WGS84,d=this.clippingArea;d&&(d=M.project(d,b));var e=function(c){c&&(c=M.project(c,b))&&(d&&(c=c.intersection(d)),c&&a.push(c))},f=this._get("basemapTerrain");f&&f.spatialReference&&e(new c.Extent({xmin:f.extent[0],ymin:f.extent[1],zmin:0,xmax:f.extent[2],ymax:f.extent[3],zmax:0,spatialReference:f.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){e(a.fullExtent)});
return 0<a.length?(f=a.reduce(function(a,b){return a.union(b)}),f.hasZ?(f.zmin=Math.min(0,f.zmin),f.zmax=Math.max(0,f.zmax)):(f.zmin=0,f.zmax=0),f):new c.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b})},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",a)},enumerable:!0,configurable:!0});f.prototype.castEnvironment=function(a){return a?
a instanceof J?a:a instanceof Qa?J.fromWebsceneEnvironment(a):I.ensureType(J,a):new J};Object.defineProperty(f.prototype,"pixelRatio",{get:function(){return Math.min(window.devicePixelRatio,this.maximumPixelRatio)},set:function(a){m.isSome(a)?this._override("pixelRatio",a):this._clearOverride("pixelRatio")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maximumPixelRatio",{get:function(){var a=Infinity,b=this.qualitySettings,c=b.maximumPixelRatio,b=b.maximumRenderResolution;null!=
c&&(a=Math.min(a,c));null!=b&&(a=Math.min(a,b/Math.max(this.width,this.height)));return a},set:function(a){m.isSome(a)?this._override("maximumPixelRatio",a):this._clearOverride("maximumPixelRatio")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"groundExtent",{get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var b=a.extent;return new c.Extent({xmin:b[0],ymin:b[1],xmax:b[2],ymax:b[3],spatialReference:a.spatialReference})}return new c.Extent({spatialReference:this.spatialReference||
c.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"initialExtentRequired",{get:function(){return this.stateManager&&!this.stateManager.hasInitialView},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"interacting",{get:function(){return!!this.state&&this.state.interacting},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||ha.getDefaultProfile()},set:function(a){ha.isValidProfile(a)&&
(ha.apply(a,this.qualitySettings),this._set("qualityProfile",a))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"slicePlane",{set:function(a){this._stage.setRenderParams({slicePlane:a});if(a){var b=this.propertiesPool.get("slicePlane");ea.boundedPlane.copy(a,b);this._set("slicePlane",b)}else this._set("slicePlane",null)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"resolution",{get:function(){return null!=this.spatialReference?K.getResolutionForScale(this.scale,
this.spatialReference):0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();return null!=a?L.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"supersampleScreenhotsEnabled",{get:function(){return this._get("supersampleScreenhotsEnabled")},set:function(a){this._set("supersampleScreenhotsEnabled",a);this._stage&&this._stage.setViewParams({supersampleScreenshots:a})},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewingMode",{get:function(){var a=this.get("map.initialViewProperties.viewingMode"),b=this.spatialReference;a||(a=!b||b.isWebMercator||b.isWGS84?"global":"local");return a},set:function(a){this._internallyReady?Ia.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"resourceController",{get:function(){return this._resourceController},enumerable:!0,configurable:!0});f.prototype.on=function(a,b,c){var d=this.inputManager.viewEvents.register(a,b,c);return d?d:this.inherited(arguments)};f.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.inputManager&&this.inputManager.viewEvents.hasHandler(a)};f.prototype.toMap=function(a,b){if(!this.ready)return Ia.error("#toMap()","Scene view cannot be used before it is ready"),null;b=b?this._externalToInternalIntersectOptions(b):
this._defaultToMapOptions;var c=m.isSome(b.graphics)&&(m.isSome(b.graphics.include)||m.isSome(b.graphics.exclude));b.allEnabled=c;a=B.isSupportedScreenPointEvent(a)?B.createScreenPointFromSupportedEvent(this,a):a;a=B.screenPointObjectToArray(a);var d=b.include&&!b.include.has(fb.TERRAIN_ID)||b.exclude&&b.exclude.has(fb.TERRAIN_ID);a=this.sceneIntersectionHelper.intersectIntersectorScreen(a,null,b,!0,d).results;if(c){c=0;for(a=a.all;c<a.length;c++){var d=a[c],e=d.toGraphic(this);if(m.isNone(e)||this._testGraphicUidFilter(b.graphics,
e))return this._intersectResultToMapPoint(d)}return null}return this._intersectResultToMapPoint(a.min)};f.prototype.toScreen=function(a){if(!this.ready)return Ia.error("#toScreen()","Scene view cannot be used before it is ready"),null;var b=null==a.z&&this.basemapTerrain.getElevation(a)||0;na.pointToVector(a,wa,this.renderSpatialReference,b);return this.engineToScreen(wa)};f.prototype.pixelSizeAt=function(a,b){if(!this.ready)return Ia.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),
null;if("number"===typeof a){if(a=this.sceneIntersectionHelper.intersectIntersectorScreen(B.createScreenPointArray(a,b)).results.min,!a.getIntersectionPoint(wa))return 0}else if(a instanceof c.Point)na.pointToVector(a,wa,this.renderSpatialReference);else if(a=this.sceneIntersectionHelper.intersectIntersectorScreen(B.createScreenPointArray(a.x,a.y)).results.min,!a.getIntersectionPoint(wa))return 0;return this.state.camera.computeScreenPixelSizeAt(wa)};f.prototype.hitTest=function(a,b){if(!this.ready)return Ia.error("#hitTest()",
"Scene view cannot be used before it is ready"),null;a=B.isSupportedScreenPointEvent(a)?B.createScreenPointFromSupportedEvent(this,a):a;var c=B.createScreenPointArray(a.x,a.y),d=b?this._externalToInternalIntersectOptions(b):this._defaultHitTestOptions;d.allEnabled=!0;d.terrainLocationFeedbackEnabled=!0;b=this.sceneIntersectionHelper.intersectIntersectorScreen(c,null,d,!0,!0);c=this._intersectResultsToHits(b.results.all,d.graphics);d=b.results.terrain;a={screenPoint:a,results:c,ground:{mapPoint:this._intersectResultToMapPoint(d),
distance:d.hasIntersectionPoint?d.distanceInRenderSpace:0}};Y.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(a.intersector=b);return x.resolve(a)};f.prototype.popupHitTest=function(a){return this.hitTest(a).then(function(b){for(var c=[],d=b.results.length?b.results[0].distance:0,e=0,f=b.results;e<f.length;e++){var g=f[e];if(g.distance!==d)break;c.push(g)}e=null;if(0===c.length||1E-5>Math.abs(d-b.ground.distance))e=b.ground.mapPoint;return{results:c,screenPoint:a,mapPoint:e}})};f.prototype.goTo=function(a,
b){return this.stateManager.goTo(a,b)};f.prototype.takeScreenshot=function(a){var b=this;return this.whenReady().then(function(){var c=Ga.toRenderSettings(a,b);c.pixelRatio/=b.pixelRatio;return b._stage.takeScreenshot(c)})};f.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()};f.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&
this._initialDefaultSpatialReference||null};f.prototype.validate=function(){var a=kb.check();y("safari")&&9>y("safari")&&(a=new v("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:y("safari")}));return a?(Ia.warn("#validate()",a.message),x.reject(a)):x.resolve()};f.prototype.isSpatialReferenceSupported=function(a,b,c){var d=a.isGeographic,e=a.isWebMercator,f=a.isWGS84,g="local"===this.viewingMode,h=!(!this._isOverridden("viewingMode")&&
!this.get("map.initialViewProperties.viewingMode"));if(h){if(g&&d)return c&&c("Layer "+b.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!g&&!e&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(d&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is geographic but not WGS84"),!1;if(b)if(Sa.isTiledLayer(b)){if(d=void 0,h?h=Sa.getTiledLayerInfo(b,a,this.viewingMode):(h=Sa.getTiledLayerInfo(b,
a,"global"),null==h.tileInfo&&(h=Sa.getTiledLayerInfo(b,a,"local"))),d=null!=h.tileInfo,!d)return c&&c("Layer "+b.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((f||e)&&!g)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),h||this._internallyReady||(this.viewingMode="global",c&&c("Viewing mode locked to global due to reprojectable layer "+b.id)),c&&c("Layer "+b.id+" is ignored because it supports server-side reprojection"),
!1;return!0};f.prototype.whenReady=function(){var a=this;return x.create(function(b){a._internallyReady?b(a):a._resolveWhenReady.push(b)})};f.prototype.computeMapPointFromVec3d=function(a,b){var d=this.spatialReference||c.SpatialReference.WGS84;na.vectorToVector(a,this.renderSpatialReference,a,d)||(d=c.SpatialReference.WGS84,na.vectorToVector(a,this.renderSpatialReference,a,d));b?(b.x=a[0],b.y=a[1],b.z=a[2],b.spatialReference=d):b=new c.Point(a,d);return b};f.prototype.engineToScreen=function(a,b){var c=
B.createRenderScreenPointArray3();this.state.camera.projectPoint(a,c);a=B.screenPointArrayToObject(c);return B.renderToScreen(this,a,b)};f.prototype.flushDisplayModifications=function(){this._stage.processDirty()};f.prototype.getDrawingOrder=function(a){return this.allLayerViews.findIndex(function(b){return b.layer&&b.layer.uid===a})};f.prototype.getViewForGraphic=function(a){return a.layer===this.graphics?this.graphicsView:a.layer?this.allLayerViews.find(function(b){return b.layer===a.layer}):null};
f.prototype.graphicChanged=function(a){m.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(a)};f.prototype.whenViewForGraphic=function(a){var b=this;return a.layer===this?C.whenOnce(this,"graphicsView").then(function(){return b.graphicsView}):a.layer?this.whenLayerView(a.layer):x.reject()};f.prototype._intersectResultToMapPoint=function(a,b){if(a.getIntersectionPoint(wa)){b=this.computeMapPointFromVec3d(wa,b);var c=this.basemapTerrain;"TerrainRenderer"===a.intersector&&c&&(b.z=c.getElevation(b)||
0);return b}return null};f.prototype._intersectResultsToHits=function(a,b){for(var c=[],d=null,e=0;e<a.length;e++){var f=a[e],g=f.toOwner(this);if(m.isSome(g)&&(g===this.map.ground||"type"in g&&"integrated-mesh"===g.type))break;g=f.toGraphic(this);if(m.isSome(g)){m.isNone(d)&&e!==a.length-1&&(d=new Set);if(m.isSome(d)){var h=this._getGraphicFilterUid(g);if(d.has(h))continue;d.add(h)}this._testGraphicUidFilter(b,g)&&(h=this._intersectResultToMapPoint(f),c.push({graphic:g,mapPoint:h,distance:f.distanceInRenderSpace}))}}return c};
f.prototype._getGraphicFilterUid=function(a){if(a.layer&&"objectIdField"in a.layer){var b=a.attributes[a.layer.objectIdField];if(b)return"o-"+a.layer.id+"-"+b}return"u-"+a.uid};f.prototype._testGraphicUidFilter=function(a,b){b=this._getGraphicFilterUid(b);return m.isNone(a)||(m.isNone(a.include)||a.include.has(b))&&(m.isNone(a.exclude)||!a.exclude.has(b))};f.prototype._externalToInternalRenderItems=function(b,c,d){var e=this;void 0===d&&(d={layerUids:null,graphicUids:null});if(!b)return d;b instanceof
a?(ua(d,this._getGraphicFilterUid(b)),0===c&&(m.isSome(this.graphicsView)&&b.layer===this.graphicsView?gb(d,this.graphicsView.mockLayerId):b.layer&&gb(d,b.layer.uid))):"forEach"in b?b.forEach(function(a){Array.isArray(a)?e._externalToInternalRenderItems(a,c,d):u.isCollection(a)?a===e.graphics&&m.isSome(e.graphicsView)?gb(d,e.graphicsView.mockLayerId):e._externalToInternalRenderItems(a,c,d):a instanceof h?a===e.map.ground&&gb(d,fb.TERRAIN_ID):e._externalToInternalRenderItems(a,c,d)}):gb(d,b.uid);return d};
f.prototype._externalToInternalIntersectOptions=function(a){var b=this._externalToInternalRenderItems(a.include,0);a=this._externalToInternalRenderItems(a.exclude,1);return{include:b.layerUids,exclude:a.layerUids,graphics:{include:b.graphicUids,exclude:a.graphicUids}}};f.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";case "local":return"planar"}};f.prototype._initBasemapTerrain=function(a){var b=this;this._disposeBasemapTerrain();this._set("basemapTerrain",
new ya(this,this._viewingModeToManifold(a)));this._set("elevationProvider",new da({view:this}));this.elevationProvider.register("ground",this.basemapTerrain);this._handles.add([C.init(this,"map.ground.opacity",function(a){return b.basemapTerrain.baseOpacity=null==a?1:a},!0),C.init(this,"map.ground.surfaceColor",function(a){b.basemapTerrain.backgroundColor=a})],"basemapTerrain")};f.prototype._initGlobe=function(a){var b=this;this._initCoordinateSystem();this._initState();this._stage.setViewParams({backgroundColor:[0,
0,0,0]});this._initBasemapTerrain(a);this._set("pointsOfInterest",new Ba.default({view:this}));this._set("featureTiles",new fa.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler}));this._handles.add(this.featureTiles.watch("updating",function(){return b._evaluateUpdating()}));this._handles.add(C.init(Y,"FEATURE_TILE_TREE_SHOW_TILES",
function(a){a&&b.featureTiles&&!b.featureTilesDebugger?b.featureTilesDebugger=new ga.FeatureTileTree3DDebugger(b):!a&&b.featureTilesDebugger&&(b.featureTilesDebugger.destroy(),b.featureTilesDebugger=null)}),"feature-tiles");this._handles.add(C.init(this,["clippingArea","basemapTerrain.extent"],function(){var a=b.basemapTerrain&&b.basemapTerrain.extent;b.clippingArea||a?a&&b.basemapTerrain.spatialReference?(a=F.toExtent(b.basemapTerrain.extent,b.basemapTerrain.spatialReference),b.featureTiles.filterExtent=
b.clippingArea?a.intersection(b.clippingArea):a):b.featureTiles.filterExtent=b.clippingArea:b.featureTiles.filterExtent=null},!0),"feature-tiles");this.stateManager.init()};f.prototype._initCoordinateSystem=function(){var a=this;if(this.spatialReference){var b=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(b)||this._set("mapCoordsHelper",new qa.default(this.map,b));var c="global"===this.viewingMode,b=c?na.SphericalECEFSpatialReference:b;b!==this.renderSpatialReference&&
(this.renderSpatialReference=b,this._set("renderCoordsHelper",la.RenderCoordsHelper.createMode(this.viewingMode,b)),c||this._handles.add(this.watch("basemapTerrain.extent",function(b){if(0!==b[0]||0!==b[1]||0!==b[2]||0!==b[3])a.renderCoordsHelper.extent=b},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Wa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null),this.renderSpatialReference=
null};f.prototype._evaluateUpdating=function(){var a=0,b=0,c=!1;this.allLayerViews.forEach(function(d){d.updating&&(c=!0,d="updatingPercentage"in d?d.updatingPercentage:null,null!=d&&(++b,a+=d))});c=!!(c||this._createGraphicsViewPromise||m.isSome(this.graphicsView)&&this.graphicsView.updating||this._resourceController&&this._resourceController.updating||this.featureTiles&&this.featureTiles.updating||this.labeler&&this.labeler.updating);c!==this.updating&&this._set("updating",c);a=0!==b?a/b:c?100:
0;this.updatingPercentage!==a&&this._set("updatingPercentage",a)};f.prototype._updateUpdatingMonitors=function(a){for(var b=this,c=0,d=a.removed;c<d.length;c++){var e=d[c];this._handles.remove(e.uid)}c=0;for(a=a.added;c<a.length;c++)e=a[c],e.destroyed||this._handles.add([e.watch(["updating","updatingPercentage"],function(){return b._evaluateUpdating()})],e.uid);this._evaluateUpdating()};f.prototype._disposeSurface=function(){var a=function(a){a&&a.remove();return null};this._stageFrameTask=a(this._stageFrameTask);
this._updateDrawingOrderHandle=a(this._updateDrawingOrderHandle);this.onViewExtentUpdateHandle=a(this.onViewExtentUpdateHandle);this.pointsOfInterest&&(this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null));this.featureTiles&&(this.featureTiles.destroy(),this._set("featureTiles",null));this._handles.remove("feature-tiles");this._handles.remove("render-coords-helper");this._disposeBasemapTerrain();this.environmentManager&&this.environmentManager.disposeRendering()};f.prototype._disposeBasemapTerrain=
function(){var a=this._get("basemapTerrain");a&&(this._handles.remove("basemapTerrain"),a.destroy(),this._set("basemapTerrain",null))};f.prototype._renderScreenshotOverlay=function(a,b){if(this.overlay&&this.overlay.hasVisibleItems){var c=a.getContext("2d");c.putImageData(b,0,0);this.overlay.renderCanvas(a);a=c.getImageData(0,0,b.width,b.height);for(c=0;c<a.data.length;c++)b.data[c]=a.data[c]}};f.prototype._initStage=function(){var a=this,b={};b.renderContext=this.renderContext;b.deactivatedWebGLExtensions=
this.deactivatedWebGLExtensions;b.viewingMode=this.viewingMode;b.alpha=this.alphaCompositingEnabled;b.supersampleScreenshots=this.supersampleScreenhotsEnabled;b.renderScreenshotOverlay=function(b,c){return a._renderScreenshotOverlay(b,c)};this.renderCanvas&&(b.canvas=this.renderCanvas);var c=new ka.SceneIntersectionHelper(this.viewingMode,{forEachLayer:function(b){var c=a._stage.getLayers();Object.keys(c).forEach(function(a){b(c[a])})}},this);this._set("sceneIntersectionHelper",c);this._stage=new Pa(this.viewingMode,
e.byId(this.surface),b,c);this._handles.add(C.init(this.qualitySettings,"antialiasingEnabled",function(){a._stage.setRenderParams({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})}),"stage");b=function(){a._stage.setRenderParams({defaultHighlightOptions:ma.toEngineOptions(a.highlightOptions)})};this._handles.add(this.watch(["highlightOptions","highlightOptions.color","highlightOptions.haloOpacity","highlightOptions.fillOpacity"],b),"stage");b();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Wa.DEFAULT_TOLERANCE/
this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.getCanvas());this._stageFrameTask=A.addFrameTask(this._stage.getFrameTask())};f.prototype._initSurface=function(){this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new oa.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})};f.prototype._createGraphicsViewIfNeeded=function(){this.graphicsView||
this._createGraphicsViewPromise||0===this.graphics.length||(this._handles.remove("graphics-view"),this._createGraphicsViewPromise=n.safeCast(this._createGraphicsViewAsync()),this._createGraphicsViewPromise.isFulfilled()&&(this._createGraphicsViewPromise=null),this._evaluateUpdating())};f.prototype._createGraphicsViewAsync=function(){return b(this,void 0,void 0,function(){var a,b,c=this;return l(this,function(d){switch(d.label){case 0:return[4,x.create(function(a){return t(["./3d/layers/GraphicsView3D"],
a)})];case 1:return a=d.sent(),[4,C.whenTrueOnce(this.basemapTerrain,"ready")];case 2:return d.sent(),b=new a({view:this}),this._set("graphicsView",b),this._handles.add([C.init(b,"updating",function(){return c._evaluateUpdating()})],b.mockLayerId),this._createGraphicsViewPromise=null,this._evaluateUpdating(),[2]}})})};f.prototype._disposeGraphicsView=function(){this._createGraphicsViewPromise&&(this._createGraphicsViewPromise.cancel(),this._createGraphicsViewPromise=null);this._handles.remove("graphics-view");
m.isSome(this.graphicsView)&&(this._handles.remove(this.graphicsView.mockLayerId),this.graphicsView.destroy(),this._set("graphicsView",null))};f.prototype._initState=function(){this._set("state",new ja.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}))};f.prototype._viewReadyHandler=function(a){var b=this;a||("global"===this.viewingMode&&(this._clippingArea=null),this._internallyReady=!0,this._initSurface(),this._handles.add(C.on(this,"graphics","change",function(){return b._createGraphicsViewIfNeeded()},
function(){return b._createGraphicsViewIfNeeded()}),"graphics-view"),this._createGraphicsViewPromise&&this._handles.remove("graphics-view"),this._evaluateUpdating(),!this._externallySet.environment&&(a=this.get("map.initialViewProperties.environment"))&&(this.environment=a),this._updateDrawingOrderHandle=this.allLayerViews.on("change",function(){return b._updateDrawingOrder()}),this._updateDrawingOrder(),this.labeler.setup(),this.environmentManager.updateReadyChange(!0),this.inputManager.connect(),
a=this._resolveWhenReady,this._resolveWhenReady=[],a.forEach(function(a){return a(b)}))};f.prototype._viewUnreadyHandler=function(a){a&&(m.isSome(this.activeTool)&&(this.activeTool.deactivate&&this.activeTool.deactivate(),this._set("activeTool",null)),this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),this._internallyReady=!1,this.stateManager.deinit(),this._disposeSurface(),this.state.destroy(),this._set("state",
null),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler&&this.labeler.dispose(),this._stage&&(this._stage.dispose(),this._stage=null),this._handles.remove("stage"),this._set("canvas",null))};f.prototype._updateDrawingOrder=function(){var a=this.allLayerViews.length-1;this.allLayerViews.forEach(function(b,c){"drawingOrder"in b&&(b.drawingOrder=a-c)})};f.prototype._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();
if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(fb.TERRAIN_ID);for(var a=0,b=this.map.allLayers.items;a<b.length;a++){var c=b[a];"integrated-mesh"===c.type&&this._defaultToMapOptions.include.add(c.uid)}}};f.prototype._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(fb.TERRAIN_ID);for(var a=0,b=this.map.allLayers.items;a<b.length;a++){var c=b[a];"integrated-mesh"===
c.type&&1>c.opacity&&this._defaultToMapOptions.exclude.add(c.uid)}}};g([E.property({type:V,readOnly:!0,aliasOf:"state.animation"})],f.prototype,"animation",void 0);g([E.property({readOnly:!0})],f.prototype,"basemapTerrain",void 0);g([E.property({readOnly:!0})],f.prototype,"elevationProvider",void 0);g([E.property({type:k,aliasOf:"stateManager.camera"})],f.prototype,"camera",void 0);g([E.property({readOnly:!0})],f.prototype,"canvas",void 0);g([E.property({type:c.Point,aliasOf:"stateManager.center"})],
f.prototype,"center",void 0);g([E.property({type:c.Extent,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],f.prototype,"clippingArea",null);g([E.property({type:X.default})],f.prototype,"constraints",void 0);g([E.property({type:c.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],f.prototype,"dataExtent",null);g([E.property({value:null,type:J})],f.prototype,"environment",null);g([E.cast("environment")],f.prototype,"castEnvironment",null);g([E.property()],
f.prototype,"environmentManager",void 0);g([E.property({type:c.Extent,aliasOf:"stateManager.extent"})],f.prototype,"extent",void 0);g([E.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],f.prototype,"screenCenter",void 0);g([E.property({type:Number,dependsOn:["maximumPixelRatio"]})],f.prototype,"pixelRatio",null);g([E.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],f.prototype,"maximumPixelRatio",null);g([E.property({aliasOf:"stateManager.frustum"})],
f.prototype,"frustum",void 0);g([E.property({type:Number,readOnly:!0})],f.prototype,"fullOpacity",void 0);g([E.property({readOnly:!0})],f.prototype,"graphicsView",void 0);g([E.property({type:c.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],f.prototype,"groundExtent",null);g([E.property()],f.prototype,"groundView",void 0);g([E.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],f.prototype,"initialExtentRequired",null);g([E.property({type:Boolean,dependsOn:["state.interacting"],
readOnly:!0})],f.prototype,"interacting",null);g([E.property()],f.prototype,"map",void 0);g([E.property({readOnly:!0})],f.prototype,"mapCoordsHelper",void 0);g([E.property({aliasOf:"stateManager.padding"})],f.prototype,"padding",void 0);g([E.property({type:Ba.default,readOnly:!0})],f.prototype,"pointsOfInterest",void 0);g([E.property({type:fa.default,readOnly:!0})],f.prototype,"featureTiles",void 0);g([E.property({type:ga.FeatureTileTree3DDebugger})],f.prototype,"featureTilesDebugger",void 0);g([E.property({type:Boolean})],
f.prototype,"screenSizePerspectiveEnabled",void 0);g([E.property({constructOnly:!0})],f.prototype,"deactivatedWebGLExtensions",void 0);g([E.property({constructOnly:!0})],f.prototype,"renderCanvas",void 0);g([E.property({readOnly:!0})],f.prototype,"state",void 0);g([E.property({readOnly:!0})],f.prototype,"inputManager",void 0);g([E.property({readOnly:!0})],f.prototype,"stateManager",void 0);g([E.property({type:["low","medium","high"]})],f.prototype,"qualityProfile",null);g([E.property({type:z,get:function(){var a=
this._get("qualitySettings");a||(a=new z,ha.apply(this.qualityProfile,a));return a}})],f.prototype,"qualitySettings",void 0);g([E.property()],f.prototype,"slicePlane",null);g([E.property({dependsOn:["viewingMode"]})],f.prototype,"ready",void 0);g([E.property({readOnly:!0})],f.prototype,"renderCoordsHelper",void 0);g([E.property({readOnly:!0})],f.prototype,"sceneIntersectionHelper",void 0);g([E.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],f.prototype,"resolution",null);
g([E.property({type:Number,aliasOf:"stateManager.scale"})],f.prototype,"scale",void 0);g([E.property()],f.prototype,"heightModelInfo",null);g([E.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],f.prototype,"spatialReference",void 0);g([E.property({type:Boolean,constructOnly:!0})],f.prototype,"alphaCompositingEnabled",void 0);g([E.property({type:Boolean,value:!0})],f.prototype,"supersampleScreenhotsEnabled",null);g([E.property({readOnly:!0})],
f.prototype,"type",void 0);g([E.property({type:vb})],f.prototype,"ui",void 0);g([E.property({type:Boolean,readOnly:!0})],f.prototype,"updating",void 0);g([E.property({type:Number,readOnly:!0})],f.prototype,"updatingPercentage",void 0);g([E.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],f.prototype,"viewingMode",null);g([E.property({type:p,aliasOf:"stateManager.viewpoint"})],f.prototype,"viewpoint",void 0);g([E.property({type:Number,aliasOf:"stateManager.zoom"})],
f.prototype,"zoom",void 0);g([E.property({type:ma})],f.prototype,"highlightOptions",void 0);return f=g([E.subclass("esri.views.SceneView")],f)}(E.declared(P,N,Q,U));var wa=G.vec3f64.create();return d});