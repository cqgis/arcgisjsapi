// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/maybe ../../../../core/screenUtils ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../renderers/support/utils ./definitions ./Utils".split(" "),function(w,x,k,h,t,q,u,l,m){function p(d,b){var a=b.length;if(d<b[0].value||1===a)return b[0].size;for(var c=1;c<a;c++)if(d<b[c].value)return b[c-1].size+(d-b[c-1].value)/(b[c].value-b[c-1].value)*(b[c].size-b[c-1].size);return b[a-1].size}function r(d,b,a){void 0===a&&(a=0);var c=b.g,
n=b.b,e=b.a;d[a+0]=b.r*e/255;d[a+1]=c*e/255;d[a+2]=n*e/255;d[a+3]=e}var f=function(d,b,a){for(var c=a*=16,n=0;c<Math.min(a+16,d.length);c++,n++)d[c]=b[n]},g=q.mat4f32.create(),v=q.mat4f32.fromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return function(){function d(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.vvSizeFieldStopsValues=
new Float32Array(6);this.vvSizeFieldStopsSizes=new Float32Array(6);this.ddColors=new Float32Array(32);this.ddBackgroundColor=new Float32Array(4);this.insideEffect=new Float32Array(16*l.MAX_FILTERS);this.outsideEffect=new Float32Array(16*l.MAX_FILTERS);this.effectCount=0;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this.symbolLevels.push(0);f(this.insideEffect,g,0);f(this.outsideEffect,v,0);for(var b=1;b<l.MAX_FILTERS;b++)f(this.insideEffect,
g,b),f(this.outsideEffect,g,b)}Object.defineProperty(d.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});d.prototype.update=function(b,a,c,d){var e=this;k.isSome(d)?(d.forEach(function(a,b){return e._updateEffects(b,a)}),this.effectCount=d.length):this.effectCount=0;c&&this._updateVisualVariables(c,b);switch(a.type){case "dot-density":this._updateDotDensityInfo(a.attributes),this.ddDotValue=a.referenceDotValue,this.ddDotScale=a.referenceScale,
this.ddDotSize=a.dotSize,this.ddDotBlending=a.blendDots,this.ddSeed=a.seed,r(this.ddBackgroundColor,a.backgroundColor)}};d.prototype.getVariation=function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,effectCount:this.effectCount}};d.prototype.getVariationHash=function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1|this.effectCount<<2};d.prototype._updateEffects=function(b,a){b+=1;if(k.isSome(a)&&a.filter&&a.filter.enabled){this.outsideLabelsVisible=
a.excludedLabelsVisible;var c=a.parsedIncludedEffect;a=a.parsedExcludedEffect;k.isSome(c)?f(this.insideEffect,c.getColorMatrix(),b):f(this.insideEffect,g,b);k.isSome(a)?f(this.outsideEffect,a.getColorMatrix(),b):f(this.outsideEffect,g,b)}else f(this.insideEffect,g,b),f(this.outsideEffect,g,b)};d.prototype._updateVisualVariables=function(b,a){var c=this._vvMaterialParameters;c.vvOpacityEnabled=!1;c.vvSizeEnabled=!1;c.vvColorEnabled=!1;c.vvRotationEnabled=!1;if(b){var d=b.size;if(d){c.vvSizeEnabled=
!0;if(d.minMaxValue){var e=d.minMaxValue,f=void 0,g=void 0;m.isDefined(e.minSize)&&m.isDefined(e.maxSize)&&(m.isNumber(e.minSize)&&m.isNumber(e.maxSize)?(f=h.pt2px(e.minSize),g=h.pt2px(e.maxSize)):(g=a.scale,f=h.pt2px(p(g,e.minSize.stops)),g=h.pt2px(p(g,e.maxSize.stops))));this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,f,g])}d.scaleStops&&(this.vvSizeScaleStopsValue=h.pt2px(p(a.scale,d.scaleStops.stops)));d.unitValue&&(this.vvSizeUnitValueToPixelsRatio=t.getMetersPerUnitForSR(a.spatialReference)/
u.meterIn[d.unitValue.unit]/a.resolution);d.fieldStops&&(this.vvSizeFieldStopsValues.set(d.fieldStops.values),this.vvSizeFieldStopsSizes.set(d.fieldStops.sizes))}if(a=b.color)c.vvColorEnabled=!0,this.vvColorValues.set(a.values),this.vvColors.set(a.colors);if(a=b.opacity)c.vvOpacityEnabled=!0,this.vvOpacityValues.set(a.values),this.vvOpacities.set(a.opacities);if(b=b.rotation)c.vvRotationEnabled=!0,c.vvRotationType=b.type}};d.prototype._updateDotDensityInfo=function(b){for(var a=this.ddColors,c=0;c<
Math.min(l.DOT_DENSITY_MAX_FIELDS,b.length);c++)r(a,b[c].color,4*c)};return d}()});