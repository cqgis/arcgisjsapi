// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
/*

 Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
 Copyright 2015, Google Inc. All Rights Reserved.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to
 deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 sell copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice including the dates of first publication and
 either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
 shall be included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

 Original Code. The Original Code is: OpenGL Sample Implementation,
 Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
 Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
 Copyright in any portions created by third parties is as indicated
 elsewhere herein. All Rights Reserved.
*/
require({cache:{"esri/views/2d/engine/Stage":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../core/promiseUtils ../../../core/scheduling ../../../core/libs/gl-matrix-2/common ../../../core/libs/gl-matrix-2/mat2d ../../../core/libs/gl-matrix-2/mat2df64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ./Container ./webgl/BitBlitRenderer ./webgl/enums ./webgl/Painter ./webgl/shaders/StencilPrograms ../../support/screenshotUtils ../../webgl/BufferObject ../../webgl/context-util ../../webgl/FramebufferObject ../../webgl/programUtils ../../webgl/RenderingContext ../../webgl/VertexArrayObject".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p,B,F,q,x,u,A){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function l(c,l){void 0===l&&(l={});var g=a.call(this)||this;g._renderParameters={drawPhase:0,state:g.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1};g._renderRequested=!1;g._clipData=new Float32Array(8);g._upperLeft=b.vec2f64.create();g._upperRight=b.vec2f64.create();g._lowerLeft=b.vec2f64.create();g._lowerRight=b.vec2f64.create();g._mat2=e.mat2df64.create();
g._clipRendererInitialized=!1;g._supersampleScreenshots=!0;g.stage=g;g._stationary=!0;g.attached=!0;var d=l.canvas,d=void 0===d?document.createElement("canvas"):d,v=l.alpha,v=void 0===v?!0:v,y=l.stencil,y=void 0===y?!0:y,n=l.renderContext,n=void 0===n?"webgl":n;l=l.supersampleScreenshots;l=void 0===l?!0:l;g._canvas=d;d.setAttribute("style","width: 100%; height:100%; display:block;");c.appendChild(d);c=F.createContextOrErrorHTML(d,{alpha:v,antialias:!1,depth:!0,stencil:y},n);g.context=new u(c);g.painter=
new z.default(g.context);g._taskHandle=k.addFrameTask({render:function(){return g.renderFrame()}});g._taskHandle.pause();g._supersampleScreenshots=l;return g}f(l,a);l.prototype.destroy=function(){this.removeAllChildren();this.renderFrame();this._taskHandle.remove();this._boundFBO=this._taskHandle=null;this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null);this._labelsFBO1&&(this._labelsFBO1.dispose(),this._labelsFBO1=null);this._labelsFBO2&&(this._labelsFBO2.dispose(),this._labelsFBO2=null);
this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._clipVAO&&(this._clipVAO.dispose(),this._clipVBO=this._clipVAO=null);this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null);this.painter.dispose();this.context.dispose();this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas);this._canvas=null};Object.defineProperty(l.prototype,"background",{get:function(){return this._background},set:function(c){this._background=
c;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"state",{get:function(){return this._state},set:function(c){this._state=c;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"stationary",{get:function(){return this._stationary},set:function(c){this._stationary!==c&&(this._stationary=c,this.requestRender())},enumerable:!0,configurable:!0});l.prototype.requestRender=function(){this._renderRequested=!0;this._taskHandle&&this._taskHandle.resume()};
l.prototype.renderFrame=function(){this._renderRequested&&(this._renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this.processRender(this._renderParameters));this._renderRequested||this._taskHandle.pause()};l.prototype.setHighlightOptions=function(c){this.painter.setHighlightOptions(c)};l.prototype.renderChildren=function(c){var a=this.context,
b=this.children;this.beforeRenderChildren(c);c.drawPhase=v.WGLDrawPhase.MAP;for(var b=c.children?c.children:b,l=b.length,e=0;e<l;e++){var g=b[e];g.attached&&g.processRender(c)}var k=a.getBoundFramebufferObject();a.bindFramebuffer(this._labelsFBO2);e=c.stationary;a.setClearColor(0,0,0,e?0:1);a.clear(a.gl.COLOR_BUFFER_BIT);if(e)for(c.drawPhase=v.WGLDrawPhase.LABEL_ALPHA,c.labelFBO=this._labelsFBO1,e=0;e<l;e++)g=b[e],g.attached&&g.processRender(c);a.bindFramebuffer(k);c.labelFBO=this._labelsFBO2;c.drawPhase=
v.WGLDrawPhase.LABEL;for(e=0;e<l;e++)g=b[e],g.attached&&g.processRender(c);c=this._labelsFBO2;this._labelsFBO2=this._labelsFBO1;this._labelsFBO1=c;this.afterRenderChildren()};l.prototype.beforeRenderChildren=function(a){var b=this.context,l=a.state,e=a.pixelRatio;if(this.painter){b.enforceState();var k=l.size;a=l.rotation;var d=Math.round(k[0]*e),k=Math.round(k[1]*e);this._boundFBO=b.getBoundFramebufferObject();this._labelsFBO1&&this._labelsFBO1.width===d&&this._labelsFBO1.height===k||(this._labelsFBO1&&
(this._labelsFBO1.dispose(),this._labelsFBO2.dispose()),this._labelsFBO1=q.createWithAttachments(b,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:d,height:k},{colorTarget:0,depthStencilTarget:0}),b.bindFramebuffer(this._labelsFBO1),b.setDepthWriteEnabled(!0),b.setStencilWriteMask(255),b.setClearColor(0,0,0,0),b.setClearDepth(1),b.setClearStencil(0),b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT|b.gl.STENCIL_BUFFER_BIT),b.setDepthWriteEnabled(!1),
b.bindFramebuffer(this._boundFBO),this._labelsFBO2=q.createWithAttachments(b,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:d,height:k},{colorTarget:0,depthStencilTarget:0}));if(l.spatialReference&&(l.spatialReference._isWrappable?l.spatialReference._isWrappable():l.spatialReference.isWrappable)){var v=n.common.toRadian(a),y=Math.abs(Math.cos(v)),z=Math.abs(Math.sin(v)),p=Math.round(l.worldScreenWidth);if(Math.round(d*y+k*z)<=p)this._clipFrame=
!1;else{this._clipFBO&&this._clipFBO.width===d&&this._clipFBO.height===k||(this._clipFBO=new q(b,{colorTarget:0,depthStencilTarget:3,width:d,height:k}));var f=.5*d,w=.5*k,l=1/d,m=1/k,e=.5*p*e,x=.5*(d*z+k*y),d=this._upperLeft,y=this._upperRight,z=this._lowerLeft,p=this._lowerRight;c.vec2.set(d,-e,-x);c.vec2.set(y,e,-x);c.vec2.set(z,-e,x);c.vec2.set(p,e,x);g.mat2d.identity(this._mat2);g.mat2d.translate(this._mat2,this._mat2,[f,w]);0!==a&&g.mat2d.rotate(this._mat2,this._mat2,v);c.vec2.transformMat2d(d,
d,this._mat2);c.vec2.transformMat2d(y,y,this._mat2);c.vec2.transformMat2d(z,z,this._mat2);c.vec2.transformMat2d(p,p,this._mat2);a=this._clipData;a.set([2*z[0]*l-1,2*(k-z[1])*m-1,2*p[0]*l-1,2*(k-p[1])*m-1,2*d[0]*l-1,2*(k-d[1])*m-1,2*y[0]*l-1,2*(k-y[1])*m-1]);this._clipRendererInitialized||this._initializeClipRenderer(b);this._clipVBO.setData(a);this._boundFBO=b.getBoundFramebufferObject();b.bindFramebuffer(this._clipFBO);b.setDepthWriteEnabled(!0);b.setStencilWriteMask(255);b.setClearColor(0,0,0,0);
b.setClearDepth(1);b.setClearStencil(0);b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT|b.gl.STENCIL_BUFFER_BIT);b.setDepthWriteEnabled(!1);this._clipFrame=!0}}else this._clipFrame=!1}};l.prototype.afterRenderChildren=function(){var c=this.context;c.logIno();this._clipFrame&&this._clipRendererInitialized&&(c.bindFramebuffer(this._boundFBO),this._boundFBO=null,c.bindVAO(this._clipVAO),c.bindProgram(this._clipStencilProgram),c.setDepthWriteEnabled(!1),c.setDepthTestEnabled(!1),c.setStencilTestEnabled(!0),
c.setBlendingEnabled(!1),c.setColorMask(!1,!1,!1,!1),c.setStencilOp(7680,7680,7681),c.setStencilWriteMask(255),c.setStencilFunction(519,1,255),c.drawElements(4,6,5123,0),c.bindVAO(),c.setColorMask(!0,!0,!0,!0),c.setBlendingEnabled(!0),c.setStencilFunction(514,1,255),this._blitRenderer.render(c,this._clipFBO.colorTexture,9728,1),c.setStencilTestEnabled(!1))};l.prototype.doRender=function(c){var b=this.context,l=c.state,e=c.pixelRatio;this._resizeCanvas(c);this.context.enforceState();b.setViewport(0,
0,e*l.size[0],e*l.size[1]);b.setDepthWriteEnabled(!0);b.setStencilWriteMask(255);this.background&&this.background.color?(l=this.background.color,b.setClearColor(l.r/255,l.g/255,l.b/255,l.a)):b.setClearColor(0,0,0,0);b.setClearDepth(1);b.setClearStencil(0);b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT|b.gl.STENCIL_BUFFER_BIT);b.setDepthWriteEnabled(!1);a.prototype.doRender.call(this,c)};l.prototype.takeScreenshot=function(c,a){var b=p.screenshotSuperSampleSettings(c,this._supersampleScreenshots),
l=b.framebufferWidth,e=b.framebufferHeight,g=this.context,k=c.layers,y={drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),pixelRatio:b.pixelRatio};if(null!=c.rotation){var v=y.state.viewpoint;v.rotation=c.rotation;y.state.viewpoint=v}0<k.length&&(y.children=[],k.forEach(function(c){var b=a.find(function(a){return a.layer.id===c.id});b&&b.container&&b.attached&&y.children.push(b.container)}));var n=q.create(g,{colorTarget:0,depthStencilTarget:3,width:l,height:e}),
k=g.getBoundFramebufferObject(),v=g.getViewport();g.bindFramebuffer(n);g.setViewport(0,0,l,e);l=g.gl;g.setClearColor(0,0,0,0);g.setClearDepth(1);g.setClearStencil(0);g.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT|l.STENCIL_BUFFER_BIT);this.renderChildren(y);b=this._readbackScreenshot(b);g.bindFramebuffer(k);g.setViewport(v.x,v.y,v.width,v.height);this.requestRender();g=this._ensureScreenshotEncodeCanvas();c=p.encodeResult(b,c,g,{flipY:!0,premultipliedAlpha:!0});return d.resolve(c)};l.prototype._ensureScreenshotEncodeCanvas=
function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};l.prototype._readbackScreenshot=function(c){var a=c.framebufferWidth,b=c.framebufferHeight,l=c.region;c=c.resample;var e=this.context.gl;if(c){var g=p.createEmptyImageData(a,b,this._ensureScreenshotEncodeCanvas());e.readPixels(0,0,a,b,6408,5121,new Uint8Array(g.data.buffer));a=p.createEmptyImageData(l.width,l.height,this._ensureScreenshotEncodeCanvas());return p.resampleHermite(g,
a,!0,c.region.x,b-(c.region.y+c.region.height),c.region.width,c.region.height)}g=p.createEmptyImageData(l.width,l.height,this._ensureScreenshotEncodeCanvas());e.readPixels(l.x,b-(l.y+l.height),l.width,l.height,6408,5121,new Uint8Array(g.data.buffer));return g};l.prototype._resizeCanvas=function(c){var a=this._canvas,b=a.style,l=c.state.size,e=c.pixelRatio;c=l[0];var l=l[1],g=Math.round(c*e),e=Math.round(l*e);if(a.width!==g||a.height!==e)a.width=g,a.height=e;b.width=c+"px";b.height=l+"px"};l.prototype._initializeClipRenderer=
function(c){if(this._clipRendererInitialized)return!0;this._blitRenderer=new y;var a=w.stencil.attributes,b=x.createProgram(c,w.stencil);if(!b)return!1;var l=B.createVertex(c,35040,32),e=new Uint16Array([0,1,2,2,1,3]),e=B.createIndex(c,35044,e);c=new A(c,a,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:l},e);this._clipStencilProgram=b;this._clipVBO=l;this._clipVAO=c;return this._clipRendererInitialized=!0};return l}(l.Container);a.Stage=h})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define("require exports ./shaders/BitBlitPrograms ../../../webgl/BufferObject ../../../webgl/programUtils ../../../webgl/VertexArrayObject".split(" "),
function(h,a,f,m,d,k){return function(){function a(){this._initialized=!1}a.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};a.prototype.render=function(a,e,c,b){a&&(this._initialized||this._initialize(a),a.setBlendFunctionSeparate(1,771,1,771),a.bindVAO(this._vertexArrayObject),a.bindProgram(this._program),e.setSamplingMode(c),a.bindTexture(e,0),this._program.setUniform1i("u_tex",
0),this._program.setUniform1f("u_opacity",b),a.drawArrays(5,0,4),a.bindVAO())};a.prototype._initialize=function(a){if(this._initialized)return!0;var e=f.bitBlit.attributes,c=d.createProgram(a,f.bitBlit);if(!c)return!1;var b=new Int8Array(16);b[0]=-1;b[1]=-1;b[2]=0;b[3]=0;b[4]=1;b[5]=-1;b[6]=1;b[7]=0;b[8]=-1;b[9]=1;b[10]=0;b[11]=1;b[12]=1;b[13]=1;b[14]=1;b[15]=1;a=new k(a,e,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,
stride:4,normalized:!1,divisor:0}]},{geometry:m.createVertex(a,35044,b)});this._program=c;this._vertexArrayObject=a;return this._initialized=!0};return a}()})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["require","exports","./sources/resolver"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.bitBlit={name:"bitBlit",shaders:{vertexShader:f.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:f.resolveIncludes("bitBlit/bitBlit.frag")},attributes:{a_pos:0,
a_tex:1}}})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["require","exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(h,a,f,m){Object.defineProperty(a,"__esModule",{value:!0});var d=new m(function(a){var k=f;a.split("/").forEach(function(a){k&&(k=k[a])});return k});a.resolveIncludes=function(a){return d.resolveIncludes(a)}})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(["require","exports"],function(h,a){return{background:{"background.frag":"uniform lowp vec4 u_color;\r\nvoid main() {\r\n  gl_FragColor \x3d u_color;\r\n}\r\n",
"background.vert":"attribute vec2 a_pos;\r\n\r\nuniform highp mat3 u_dvsMat3;\r\nuniform mediump float u_coord_range;\r\nuniform mediump float u_depth;\r\n\r\nvoid main() {\r\n  vec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\r\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\r\n}\r\n"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\r\nuniform lowp float u_opacity;\r\n\r\nvarying mediump vec2 v_uv;\r\n\r\nvoid main() {\r\n  lowp vec4 color \x3d texture2D(u_tex, v_uv);\r\n\r\n  // Note: output in pre-multiplied alpha for correct alpha compositing\r\n  gl_FragColor \x3d color *  u_opacity;\r\n}\r\n",
"bitBlit.vert":"attribute vec2 a_pos;\r\nattribute vec2 a_tex;\r\n\r\nvarying mediump vec2 v_uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\r\n  v_uv \x3d a_tex;\r\n}\r\n"},highlight:{"blur.frag":"// A gaussian blur shader. It blurs the alpha channel of its input\r\n// according to 4 different sigma and stores the results into the\r\n// four channel of the target framebuffer.\r\n\r\n// It is intended to be called twice; the first time to perform an\r\n// horizontal blur, and a second time to perform a vertical blur.\r\n\r\n// This shader is used to turn the highlight mask into a highlight\r\n// map. The highlight map is an approximation of the signed distance\r\n// field of the mask.\r\n\r\n\r\n// Interpolated texture coordinates.\r\nvarying mediump vec2 v_texcoord;\r\n\r\n// Blur direction information. There are two possible\r\n// configurations that the host code can use.\r\n//  - [1, 0, 1/WIDTH, 0] Used when blurring horizontally. In this\r\n//    case u_direction[0] \x3d 1 is expressed in pixel and is fed to\r\n//    the gauss function to produce the value of the gaussian weight\r\n//    for that pixel, while u_direction[2] \x3d 1/WIDTH is in texel units\r\n//    and is used to sample the right texel from the texture map.\r\n//  - [0, 1, 0, 1/HEIGHT] Used when blurring vertically. In this\r\n//    case u_direction[1] \x3d 1 is expressed in pixel and is fed to\r\n//    the gauss function to produce the value of the gaussian weight\r\n//    for that pixel, while u_direction[3] \x3d 1/HEIGHT is in texel units\r\n//    and is used to sample the right texel from the texture map.\r\nuniform mediump vec4 u_direction;\r\n\r\n// Source to destination channel selection matrix.\r\nuniform mediump mat4 u_channelSelector;\r\n\r\n// The highlight map is obtained by blurring the alpha channel of the highlight\r\n// mask accroding to these 4 values of the gaussian's sigma parameter.\r\nuniform mediump vec4 u_sigmas;\r\n\r\n// This is the highlight mask if we have not blurred horizontally yet, otherwise\r\n// it is the horizontally blurred highlight map and blurring it one more time\r\n// vertically will complete the process.\r\nuniform sampler2D u_texture;\r\n\r\n// The gaussian kernel. Note that it lacks the normalization constant, because\r\n// we want to store it unnormalized in the highlight map (i.e. having a peak\r\n// value of 1). Note also that we are using the SIMD (single instruction, multiple\r\n// data) capabilities of the GPU to compute four different gaussian kernels, one\r\n// for each sigma.\r\nmediump vec4 gauss4(mediump vec2 dir) {\r\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas * u_sigmas));\r\n}\r\n\r\n// Same as above but uses only channel 3, aka `w`, aka `q`, aka `a`.\r\nmediump float gauss1(mediump vec2 dir) {\r\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas[3] * u_sigmas[3]));\r\n}\r\n\r\nmediump vec4 selectChannel(mediump vec4 sample) {\r\n  return u_channelSelector * sample;\r\n}\r\n\r\n// Sample the input texture and accumulated its gaussian weighted value and the\r\n// total weight; operates on all four channels.\r\nvoid accumGauss4(mediump float i, inout mediump vec4 tot, inout mediump vec4 weight) {\r\n  // Computes the gaussian weights, one for each sigma.\r\n  // Note that u_direction.xy is [1, 0] when blurring horizontally and [0, 1] when blurring vertically.\r\n  mediump vec4 w \x3d gauss4(i * u_direction.xy);\r\n\r\n  // Accumumates the values.\r\n  // Note that u_direction.xy is [1/WIDTH, 0] when blurring horizontally and [0, 1/HEIGHT] when blurring vertically.\r\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw)) * w;\r\n\r\n  // Accumulates the weights.\r\n  weight +\x3d w;\r\n}\r\n\r\n// Sample the input texture and accumulated its gaussian weighted value and the\r\n// total weight; operates on a single channel.\r\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\r\n  // Computes the gaussian weights, using only the last sigma.\r\n  // Note that u_direction.xy is [1, 0] when blurring horizontally and [0, 1] when blurring vertically.\r\n  mediump float w \x3d gauss1(i * u_direction.xy);\r\n\r\n  // Accumumates the values.\r\n  // Note that u_direction.xy is [1/WIDTH, 0] when blurring horizontally and [0, 1/HEIGHT] when blurring vertically.\r\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\r\n\r\n  // Accumulates the weights.\r\n  weight +\x3d w;\r\n}\r\n\r\nvoid main(void) {\r\n  // Initialize accumulated values and weights to zero.\r\n  mediump float tot \x3d 0.0;\r\n  mediump float weight \x3d 0.0;\r\n\r\n  // Accumulates enough samples. These will be taken\r\n  // horizontally or vertically depending on the value\r\n  // of u_direction.\r\n  accumGauss1(-4.0, tot, weight);\r\n  accumGauss1(-3.0, tot, weight);\r\n  accumGauss1(-2.0, tot, weight);\r\n  accumGauss1(-1.0, tot, weight);\r\n  accumGauss1(0.0, tot, weight);\r\n  accumGauss1(1.0, tot, weight);\r\n  accumGauss1(2.0, tot, weight);\r\n  accumGauss1(3.0, tot, weight);\r\n  accumGauss1(4.0, tot, weight);\r\n\r\n  // Originally we were performing 4 blurs in parallel;\r\n  // Now we store the only result in the alpha component.\r\n  // dari8942: In theory we could disable writing to rgb\r\n  // using a color mask but I don't really feel like messing\r\n  // with that now.\r\n  gl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\r\n}\r\n",
"highlight.frag":"// Takes as input the highlight map, estimated the signed distance field,\r\n// and shades the fragments according to their estimated distance from the\r\n// edge of the highlighted feature.\r\n\r\n// A shade texture is used to turn distance values into colors; the shade\r\n// texture is basically a color gradient and is recomputed on the host\r\n// every time that the user alters the highlight options.\r\n\r\n// Interpolated texture coordinates.\r\nvarying mediump vec2 v_texcoord;\r\n\r\n// The highlight map. Each channel is a blurred\r\n// version of the alpha channel of the highlight mask.\r\n//  - Channel 0 (red) corresponds to a gaussian blur with sigma \x3d u_sigmas[0];\r\n//  - Channel 1 (green) corresponds to a gaussian blur with sigma \x3d u_sigmas[1];\r\n//  - Channel 2 (blue) corresponds to a gaussian blur with sigma \x3d u_sigmas[2];\r\n//  - Channel 3 (alpha) corresponds to a gaussian blur with sigma \x3d u_sigmas[3];\r\n// As of today, only channel 3 is used for distance estimation.\r\n// But the availability of different amounts of blur leaves the\r\n// door open to multi-scale approaches.\r\nuniform sampler2D u_texture;\r\n\r\n// The highlight map was obtained by blurring the alpha channel of the highlight\r\n// mask accroding to these 4 values of the gaussian's sigma parameter.\r\nuniform mediump vec4 u_sigmas;\r\n\r\n// A 1-D texture used to shade the highlight.\r\nuniform sampler2D u_shade;\r\n\r\n// The 1-D shade texture is spreaded between u_minMaxDistance[0] and u_minMaxDistance[1].\r\nuniform mediump vec2 u_minMaxDistance;\r\n\r\n// Signed distance estimation.\r\nmediump float estimateDistance() {\r\n  // Use the largest sigma and the corresponding distance value stored in the\r\n  // last channel of the highlight map.\r\n  mediump float sigma \x3d u_sigmas[3];\r\n  mediump float y \x3d texture2D(u_texture, v_texcoord)[3];\r\n\r\n  // Estimates the distance by linearization and local inversion around\r\n  // the inflection point. The inflection point is in x \x3d 0.\r\n  const mediump float y0 \x3d 0.5;                           // Value of the convolution at the inflection point.\r\n  mediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * sigma);  // Slope of the convolution at the inflection point.\r\n  mediump float d \x3d (y - y0) / m0;                        // Inversion of a local linearization.\r\n\r\n  // Return the estimated distance.\r\n  return d;\r\n}\r\n\r\n// Shading based on estimated distance.\r\nmediump vec4 shade(mediump float d) {\r\n  // Maps the sampled distance from the [A, D] range (see HighlightRenderer::setHighlightOptions) to [0, 1].\r\n  mediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\r\n\r\n  // Force to [0, 1]; it should not be necessary because the shade texture uses the CLAMP address mode, so\r\n  // this should happen anyway internally to the sampler, but in practice it is needed to avoid weird\r\n  // banding artifacts.\r\n  // We don't really know if we need this or not.\r\n  mappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\r\n\r\n  // Sample the 1-D shade texture on its center line (i.e. on t\x3d0.5).\r\n  return texture2D(u_shade, vec2(mappedDistance, 0.5));\r\n}\r\n\r\nvoid main(void) {\r\n  // Estimate the distance.\r\n  mediump float d \x3d estimateDistance();\r\n\r\n  // Shade the distance.\r\n  gl_FragColor \x3d shade(d);\r\n}\r\n",
"textured.vert":"// Identity vertex shader that outputs an untransformed 2-D vertex\r\n// and passes its texture coordinates unchanged to the interpolator.\r\n\r\n// Vertex position.\r\nattribute mediump vec2 a_position;\r\n\r\n// Texture coordinates.\r\nattribute mediump vec2 a_texcoord;\r\n\r\n// Texture coordinates to be interpolated.\r\nvarying mediump vec2 v_texcoord;\r\n\r\nvoid main(void) {\r\n  // Pass the position unchanged.\r\n  gl_Position \x3d vec4(a_position, 0.0, 1.0);\r\n\r\n  // Pass the texture coordinates unchanged.\r\n  v_texcoord \x3d a_texcoord;\r\n}\r\n"},
magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\r\nuniform mediump sampler2D u_readbackTexture;\r\nuniform mediump sampler2D u_maskTexture;\r\nuniform mediump sampler2D u_overlyTexture;\r\n\r\nvarying mediump vec2 v_texCoord;\r\n\r\nvoid main(void)\r\n{\r\n  lowp vec4 color \x3d texture2D(u_readbackTexture, v_texCoord);\r\n  color \x3d color + (1.0 - color.a) * u_background;\r\n\r\n  // calculate the grayscale value of the mask:\r\n  lowp vec4 mask_color \x3d texture2D(u_maskTexture, v_texCoord);\r\n  lowp float gray \x3d 1.0 - dot(mask_color, vec4(0.3, 0.59, 0.11, 0));\r\n  // make all the map color outside the mask black\r\n  color *\x3d gray;\r\n\r\n  lowp vec4 overley_color \x3d texture2D(u_overlyTexture, v_texCoord);\r\n\r\n  // premultiply the overlay color\r\n  overley_color.rgb *\x3d overley_color.a;\r\n  gl_FragColor \x3d overley_color + (1.0 - overley_color.a) * color;\r\n}\r\n",
"magnifier.vert":"precision mediump float;\r\n\r\nattribute mediump vec2 a_pos; // encoded values are 0 and 1\r\n\r\nuniform mediump vec2 u_drawPos; // the center position of the magnifier\r\nuniform mediump float u_width; // the width of the magnifier in normalized display coords\r\nuniform mediump float u_height; // the height of the magnifier in normalized display coords\r\n\r\nvarying mediump vec2 v_texCoord;\r\n\r\n\r\nvoid main(void)\r\n{\r\n  v_texCoord \x3d a_pos;\r\n  vec2 coord \x3d u_drawPos + vec2(a_pos - 0.5) * vec2(u_width, u_height);\r\n  gl_Position \x3d vec4(coord, 0.0, 1.0);\r\n}\r\n"},
materials:{"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\r\nconst float SIGNED_BYTE_TO_UNSIGNED \x3d 128.0;\r\n\r\n// markers\r\nconst float SOFT_EDGE_RATIO \x3d 1.0; // use blur here if needed\r\n\r\n// lines\r\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\r\n\r\n// meaning that a 2 pixels line width is considered a thin line\r\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\r\n\r\n// labels \r\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\r\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\r\nconst float SDF_FONT_SIZE \x3d 24.0;\r\n\r\n// maximum SDF distance of 8 pixels represent the distance values that range from -2 inside the\r\n// geometry to 6 on the outside. 6 is actually the maximum distance outside the glyph, therefore\r\n// it is the limitation of the halo which is 1/4 of the geometry size.\r\nconst float MAX_SDF_DISTANCE \x3d 8.0;\r\n\r\nconst float PLACEMENT_PADDING \x3d 8.0;\r\n\r\n\r\nconst float EPSILON \x3d 0.0000001; \r\n\r\nconst int MAX_FILTER_COUNT \x3d 2;\r\n",
"effects.glsl":"\r\nuniform mat4 u_insideEffectMat4[ MAX_FILTER_COUNT ];\r\nuniform mat4 u_outsideEffectMat4[ MAX_FILTER_COUNT ];\r\n\r\nvec4 getEffectColor(in vec4 color, in float filterFlags) {\r\n  vec4 outColor \x3d vec4(color);\r\n\r\n  // default visibility filter is index 0, index 1+ are effects\r\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\r\n    float bit \x3d getBit(filterFlags, i);\r\n    \r\n    outColor \x3d u_insideEffectMat4[ i ] * (bit  * outColor) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * outColor);\r\n  }\r\n  \r\n  return outColor; \r\n}\r\n\r\nvoid applyFilter(inout vec4 color, inout vec3 pos, in float filterFlags) {\r\n\r\n  // default visibility filter is index 0, index 1+ are effects\r\n  for (int i \x3d 0; i \x3c EFFECT_COUNT + 1; i++) {\r\n    float bit \x3d getBit(filterFlags, i); \r\n\r\n    color \x3d u_insideEffectMat4[ i ] * (bit  * color) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * color);\r\n  }\r\n\r\n  // If we are not visible, clip the vertex if we are doing a hit-test\r\n  pos.z +\x3d 2.0 * (1.0 - getBit(filterFlags, 0)); \r\n}\r\n\r\nvoid applyFilterLabels(inout vec4 color, inout vec3 pos, in float filterFlags) {\r\n  float bit \x3d getBit(filterFlags, 0); \r\n\r\n  pos.z +\x3d 2.0 * (1.0 - bit);\r\n\r\n  // When outsideLabelsVisible is false, we also clip labels if they fail any effect filter\r\n#ifndef OUTSIDE_LABELS_VISIBLE\r\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\r\n    float bit \x3d getBit(filterFlags, i); \r\n\r\n    pos.z +\x3d 2.0 * (1.0 - bit);\r\n  }\r\n#endif\r\n}\r\n",
fill:{"fill.frag":"precision highp float;\r\n\r\n#include \x3cmaterials/constants.glsl\x3e\r\n\r\n#ifdef ID\r\n\r\nvarying highp vec4 v_id;\r\n\r\n#endif // ID\r\n\r\n#ifdef PATTERN\r\n\r\nuniform lowp sampler2D u_texture;\r\n\r\nvarying mediump vec4 v_tlbr;\r\nvarying mediump vec2 v_tileTextureCoord;\r\n\r\n#endif // PATTERN\r\n\r\n#ifdef DOT_DENSITY\r\n\r\nuniform mediump mat4 u_dotColors[ 2 ];\r\nuniform sampler2D u_dotTextures[ 2 ];\r\nuniform vec4 u_dotBackgroundColor;\r\n\r\nvarying highp vec4 v_dotThresholds[ 2 ];\r\nvarying vec2 v_dotTextureCoords;\r\n\r\n#endif\r\n\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_opacity;\r\n\r\nfloat max4(vec4 target) {\r\n  return max(max(max(target.x, target.y), target.z), target.w);\r\n}\r\n\r\nvoid main() {\r\n\r\n#ifdef ID\r\n\r\n  gl_FragColor \x3d v_id;\r\n\r\n#elif defined(PATTERN)\r\n\r\n  // normalize the calculated texture coordinate such that it fits in the range of 0 to 1.\r\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\r\n  // interpolate the image coordinate between the top-left and the bottom right to get the actual position to sample.\r\n  // after normalizing the position, we get a value ranging between 0 and 1 which refers to the entire texture, however\r\n  // we need to only sample from area that has our sprite in the mosaic.\r\n  mediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\r\n  // sample the sprite mosaic\r\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\r\n  gl_FragColor \x3d v_opacity * v_color * color;\r\n\r\n#elif defined(DOT_DENSITY) \x26\x26 !defined(HIGHLIGHT)\r\n\r\n  vec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\r\n  vec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\r\n\r\n  vec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\r\n  vec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\r\n\r\n#ifdef DD_DOT_BLENDING\r\n\r\n  vec4 isPositive0 \x3d step(0.0, difference0);\r\n  vec4 isPositive1 \x3d step(0.0, difference1);\r\n\r\n  float weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\r\n  float lessThanEqZero \x3d step(weightSum, 0.0);\r\n  float greaterThanZero \x3d 1.0 - lessThanEqZero ;\r\n  float divisor \x3d (weightSum + lessThanEqZero); // Guard against divide by zero\r\n\r\n  vec4 weights0 \x3d difference0 * isPositive0 / divisor;\r\n  vec4 weights1 \x3d difference1 * isPositive1 / divisor;\r\n\r\n  vec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\r\n\r\n  gl_FragColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\r\n\r\n#else\r\n\r\n  float diffMax \x3d max(max4(difference0), max4(difference1));\r\n  float lessThanZero \x3d step(diffMax, 0.0);\r\n  float greaterOrEqZero \x3d 1.0 - lessThanZero;\r\n\r\n  vec4 isMax0 \x3d step(diffMax, difference0);\r\n  vec4 isMax1 \x3d step(diffMax, difference1);\r\n\r\n  vec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\r\n\r\n  gl_FragColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\r\n\r\n#endif\r\n\r\n#else\r\n\r\n  gl_FragColor \x3d v_opacity * v_color;\r\n\r\n#endif // PATTERN\r\n\r\n#ifdef HIGHLIGHT\r\n\r\n  gl_FragColor.a \x3d 1.0;\r\n\r\n#endif // HIGHLIGHT\r\n}\r\n",
"fill.vert":"precision mediump float;\r\n\r\n#include \x3cmaterials/constants.glsl\x3e\r\n#include \x3cmaterials/utils.glsl\x3e\r\n#include \x3cmaterials/vv.glsl\x3e\r\n#include \x3cmaterials/effects.glsl\x3e\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_id;                // objectId in RGBA components\r\nattribute float  a_visible;         // one byte controlling the visibility of the vertex (separate buffer),\r\n\r\n#ifndef DOT_DENSITY\r\nattribute vec4 a_color;\r\nattribute vec4 a_tlbr;\r\nattribute vec4 a_aux1;\r\nattribute vec2 a_aux2;\r\nattribute vec4 a_aux3;              // encodes a bitset (CIM) detailing vv locking\r\n#endif\r\n\r\n#if defined(VV_COLOR) || defined(VV_OPACITY)\r\nattribute highp vec4 a_vv;\r\n#endif\r\n\r\nuniform highp mat3 u_dvsMat3;      // premultiplies DisplayMat3 * ViewMat3 * ScreenMat3\r\nuniform highp float u_pixelRatio;\r\n\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_opacity;\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif\r\n\r\n#ifdef PATTERN\r\nuniform mediump float u_zoomFactor;\r\nuniform mediump vec2 u_mosaicSize;\r\n\r\nvarying mediump vec4 v_tlbr;\r\nvarying mediump vec2 v_tileTextureCoord;\r\n#endif\r\n\r\n#ifdef DOT_DENSITY\r\nattribute highp vec4 a_dd1;\r\nattribute highp vec4 a_dd2;\r\n\r\nuniform float u_dotValue;\r\nuniform float u_tileDotsOverArea; \r\n\r\nuniform float u_dotTextureDotCount;\r\nuniform float u_tileZoomFactor; \r\n\r\nvarying vec4 v_dotThresholds[ 2 ]; \r\nvarying vec2 v_dotTextureCoords;\r\n\r\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\r\n  return featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\r\n}\r\n#endif\r\n\r\nvoid main()\r\n{\r\n// Arguably DotDensity should be extracted to its own shader. This gets a bit\r\n// fungly because DD uses a signifcantly different stride\r\n#ifndef DOT_DENSITY \r\n  float a_bitset \x3d a_aux3.w; \r\n  float isColorLocked \x3d getBit(a_bitset, 0);\r\n  \r\n  v_color \x3d a_color;\r\n#else\r\n  v_color \x3d vec4(0.0, 0.0, 0.0, 1.0);    // for highlight\r\n#endif\r\n  v_opacity \x3d 1.0;\r\n  \r\n#ifdef ID\r\n  v_id \x3d a_id;\r\n#endif\r\n  \r\n#ifdef VV_OPACITY\r\n  v_opacity \x3d getVVOpacity(a_vv.y);\r\n#endif\r\n  \r\n#ifdef VV_COLOR\r\n  v_color \x3d getVVColor(a_vv.x, v_color, isColorLocked);\r\n#endif\r\n  \r\n#ifdef PATTERN\r\n  vec2 aux2 \x3d (1.0 / SIGNED_BYTE_TO_UNSIGNED) * a_aux2;\r\n  vec2 symbolOffset \x3d u_zoomFactor * (a_aux1.zw - SIGNED_BYTE_TO_UNSIGNED);\r\n  mat3 patternMatrix \x3d mat3(1.0);\r\n\r\n  // calculate the pattern matrix\r\n  patternMatrix[0][0] \x3d 1.0 / (u_zoomFactor * a_aux1.x * aux2.x);\r\n  patternMatrix[1][1] \x3d 1.0 / (u_zoomFactor * a_aux1.y * aux2.y);\r\n\r\n  // calculate the texture coordinates of the current vertex. It will of course get interpolated.\r\n  // The pattern matrix is a 3x3 scale matrix which 'tiles' the texture inside the tile, translating from\r\n  // tile coordinates to texture coordinates.\r\n  v_tileTextureCoord \x3d (patternMatrix * vec3(a_pos + symbolOffset, 1.0)).xy;\r\n  v_tlbr \x3d a_tlbr / u_mosaicSize.xyxy;\r\n\r\n#elif defined(DOT_DENSITY)\r\n  float size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\r\n\r\n  v_dotThresholds[0] \x3d dotThreshold(a_dd1, u_dotValue, u_tileDotsOverArea);\r\n  v_dotThresholds[1] \x3d dotThreshold(a_dd2, u_dotValue, u_tileDotsOverArea);\r\n  v_dotTextureCoords \x3d (a_pos + 0.5) / size;\r\n\r\n#endif\r\n  vec3 v_pos \x3d u_dvsMat3 * vec3(a_pos, 1.);\r\n\r\n  applyFilter(v_color, v_pos, a_visible);\r\n  \r\n  gl_Position \x3d vec4(v_pos, 1.0);\r\n}\r\n"},
icon:{"icon.frag":"precision mediump float;\r\n\r\n#include \x3cmaterials/constants.glsl\x3e\r\n#include \x3cmaterials/utils.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cmaterials/effects.glsl\x3e\r\n#include \x3cmaterials/constants.glsl\x3e\r\n\r\nuniform lowp sampler2D u_texture;\r\n\r\nvarying lowp vec2 v_tex;\r\nvarying lowp float v_transparency;\r\nvarying mediump vec2 v_size;\r\nvarying lowp vec4 v_color;\r\nvarying float v_visible;\r\n\r\n#ifdef SDF\r\nvarying lowp vec4 v_outlineColor;\r\nvarying mediump float v_outlineWidth;\r\nvarying float v_overridingOutlineColor;\r\n#endif // SDF\r\n\r\n#ifdef HIGHLIGHT\r\nvarying float v_isThinGeometry;\r\n#endif // HIGHLIGHT\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\nvoid main()\r\n{\r\n#ifdef SDF\r\n  lowp vec4 fillPixelColor \x3d v_color;\r\n\r\n  // calculate the distance from the edge [-0.5, 0.5]\r\n  float d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\r\n\r\n  // the soft edge ratio is about 1.5 pixels allocated for the soft edge.\r\n  float size \x3d max(v_size.x, v_size.y);\r\n  float dist \x3d d * size * SOFT_EDGE_RATIO;\r\n\r\n  // set the fragment's transparency according to the distance from the edge\r\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n  float outlineWidth \x3d v_outlineWidth;\r\n\r\n  #ifdef HIGHLIGHT\r\n    outlineWidth \x3d max(outlineWidth, 4.0 * v_isThinGeometry);\r\n  #endif\r\n\r\n  // count for the outline\r\n  // therefore tint the entire icon area.\r\n  if (outlineWidth \x3e 0.25) {\r\n    lowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\r\n\r\n    // outlines can't be larger than the size of the symbol\r\n    float clampedOutlineSize \x3d min(outlineWidth, size);\r\n\r\n    outlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\r\n\r\n    // finally combine the outline and the fill colors (outline draws on top of fill)\r\n    gl_FragColor \x3d v_transparency * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d v_transparency * fillPixelColor;\r\n  }\r\n#else // not an SDF\r\n   lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\r\n   gl_FragColor \x3d v_transparency * getEffectColor(texColor, v_visible);\r\n#endif // SDF\r\n\r\n#ifdef HIGHLIGHT\r\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\r\n#endif // HIGHLIGHT\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"icon.vert":"precision mediump float;\r\n\r\n#include \x3cmaterials/constants.glsl\x3e\r\n#include \x3cmaterials/utils.glsl\x3e\r\n#include \x3cmaterials/vv.glsl\x3e\r\n#include \x3cmaterials/effects.glsl\x3e\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_vertexOffsetAndTex;\r\nattribute vec4 a_id;                   // objectId in RGBA components\r\nattribute vec4 a_color;\r\nattribute vec4 a_outlineColor;\r\nattribute vec4 a_sizeAndOutlineWidth;\r\nattribute float a_visible;             // one byte controlling the vertex visibility (separate buffer)\r\n\r\n#ifdef VV\r\nattribute highp vec4 a_vv;\r\n#endif\r\n\r\nuniform highp mat3 u_dvsMat3;\r\nuniform highp mat3 u_displayMat3;\r\nuniform highp mat3 u_displayViewMat3;\r\nuniform vec2 u_mosaicSize;            // mosaic size in pixels\r\n\r\nvarying lowp vec4 v_color;\r\nvarying mediump vec2 v_tex;           // texture coordinates used to sample the sprite atlas\r\nvarying lowp float v_transparency;    // the calculated transparency to be applied by the fragment shader.\r\nvarying mediump vec2 v_size;          // icon size in px\r\nvarying float v_visible;\r\n\r\n#ifdef SDF\r\nvarying lowp vec4 v_outlineColor;\r\nvarying mediump float v_outlineWidth;\r\nvarying float v_overridingOutlineColor;\r\n#endif\r\n\r\n#ifdef HIGHLIGHT\r\nvarying float v_isThinGeometry;\r\n#endif // HIGHLIGHT\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif\r\n\r\nvec2 getMarkerSize(inout vec2 offset, in vec2 baseSize, in float vvSize) {\r\n  float f \x3d getVVSize(baseSize.y, vvSize);\r\n  vec2 size \x3d vec2(f * baseSize.x / baseSize.y, f);\r\n\r\n  offset *\x3d (size / baseSize);\r\n  return size;\r\n}\r\n\r\nvoid main()\r\n{\r\n  vec2 offset \x3d a_vertexOffsetAndTex.xy;\r\n  vec2 a_tex \x3d a_vertexOffsetAndTex.zw + SIGNED_BYTE_TO_UNSIGNED;\r\n  vec2 a_size \x3d a_sizeAndOutlineWidth.xy;\r\n  float a_bitset \x3d a_sizeAndOutlineWidth.w;\r\n\r\n  float isMapAligned \x3d getBit(a_bitset, 0);\r\n  float isColorLocked \x3d getBit(a_bitset, 1);\r\n  float isThinGeometry \x3d getBit(a_bitset, 2);\r\n  mat3 offsetMat3 \x3d isMapAligned * u_displayViewMat3 + (1.0 - isMapAligned) * u_displayMat3;\r\n\r\n  v_transparency \x3d 1.0;\r\n  v_color \x3d a_color;\r\n  v_size \x3d a_size;\r\n  v_tex \x3d a_tex / u_mosaicSize; // texture coords and transparency\r\n  v_visible \x3d a_visible;\r\n\r\n#ifdef ID\r\n  v_id \x3d a_id;\r\n#endif\r\n\r\n#ifdef VV_OPACITY\r\n  v_transparency \x3d getVVOpacity(a_vv.z);\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  v_color \x3d getVVColor(a_vv.y, a_color, isColorLocked);\r\n#endif // VV_COLOR\r\n\r\n#ifdef VV_SIZE\r\n  v_size \x3d getMarkerSize(offset, a_size, a_vv.x);\r\n#endif\r\n\r\n#ifdef VV_ROTATION\r\n  offset \x3d (getVVRotationMat3(a_vv.w) * vec3(offset, 0.0)).xy;\r\n#endif\r\n\r\n#ifdef SDF\r\n  #ifdef VV_COLOR\r\n    // this is true only if we have SDF and color VV\r\n    v_overridingOutlineColor \x3d isThinGeometry;\r\n  #else\r\n    v_overridingOutlineColor \x3d 0.0;\r\n  #endif\r\n\r\n  offset *\x3d 2.0;\r\n  v_outlineColor \x3d getEffectColor(a_outlineColor, a_visible);\r\n  // YF: in practice v_size.x and v_size.y are identical since we're mostly dealing with sms\r\n  v_outlineWidth \x3d min(a_sizeAndOutlineWidth.z, max(v_size.x - 0.99, 0.0));\r\n#endif\r\n\r\n#ifdef HIGHLIGHT\r\n  v_isThinGeometry \x3d isThinGeometry;\r\n#endif\r\n\r\n  vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + offsetMat3 * vec3(offset, 0.0);\r\n\r\n  applyFilter(v_color, pos, a_visible);\r\n\r\n  gl_Position \x3d vec4(pos, 1.0);\r\n}\r\n"},
label:{"label.frag":"precision lowp float;\r\n\r\nuniform mediump sampler2D u_referenceTex;\r\nuniform mediump vec2 u_screenSize;\r\nuniform mediump float u_pixelRatio;\r\n\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\nvarying mediump vec2 v_tex;\r\n\r\n#ifdef ID\r\nvarying mediump float v_fadeStep;\r\n#else\r\nuniform lowp sampler2D u_texture;\r\nvarying mediump vec4 v_color;\r\n#endif // ID\r\n\r\nconst vec3 epsilon \x3d vec3(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\r\n\r\nvoid main()\r\n{\r\n  mediump vec2 refTextPos \x3d gl_FragCoord.xy / (u_pixelRatio * u_screenSize.xy);\r\n  mediump vec4 referenceFragment \x3d texture2D(u_referenceTex, refTextPos);\r\n#ifdef ID\r\n  mediump float alpha \x3d clamp(referenceFragment.a + v_fadeStep, 0.0, 1.0);\r\n  // fill the whole quad\r\n  gl_FragColor \x3d vec4(alpha);\r\n#else\r\n  // read the fade alpha\r\n  lowp float fadeAlpha \x3d referenceFragment.a;\r\n\r\n  // read the distance from the SDF texture\r\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\r\n\r\n  // the edge distance if a factor of the outline width\r\n  // We cap this to 0.25 to prevent this from becomming negative / running into the glyph boundaries\r\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\r\n\r\n  // use a smooth-step in order to calculate the geometry of the shape given by the distance field\r\n  lowp float sdfAlpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist);\r\n\r\n  gl_FragColor \x3d fadeAlpha * sdfAlpha * v_color;\r\n#endif\r\n}\r\n",
"label.vert":"precision mediump float;\r\n\r\n#include \x3cmaterials/constants.glsl\x3e\r\n#include \x3cmaterials/utils.glsl\x3e\r\n#include \x3cmaterials/vv.glsl\x3e\r\n#include \x3cmaterials/effects.glsl\x3e\r\n\r\nattribute vec2 a_pos;                         // (2 x i16)\r\nattribute vec4 a_color;                       // (4 x u8)\r\nattribute vec2 a_vertexOffset;                // (2 x i16) offset from the anchor point of the string\r\nattribute vec4 a_texAndSize;                  // (4 x u8) texture coordinatesm and font size. w is for the halo size\r\nattribute vec4 a_refSymbolAndPlacementOffset; // (4 x u8) reference symbol offset (px) and the placement offset (px)\r\nattribute float a_vvSize;                     // size visual variable\r\nattribute lowp float  a_visible;              // a one byte controlling the visibility of the vertex (separate buffer)\r\nattribute mediump vec2 a_visibilityRange;     // (2 x u8);\r\n\r\nuniform mediump float u_zoomLevel;            // the current zoom level X 10\r\nuniform highp mat3 u_dvsMat3;                 // premultiplies displayMat3 * viewMat3 * screenMat3\r\nuniform highp mat3 u_displayMat3;\r\nuniform float u_mapRotation;\r\nuniform float u_mapAligned;\r\nuniform vec2 u_mosaicSize;\r\nuniform float u_pixelRatio;\r\n\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\nvarying mediump vec2 v_tex;                   // texture coordinates used to sample the glyph atlas\r\nvarying mediump vec4 v_color;\r\n\r\n#ifdef ID                                     // somewhat of a misnomer - id is used here for the label alpha phase\r\nuniform mediump float u_fadeStep; \r\nvarying mediump float v_fadeStep;\r\n#endif\r\n\r\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\r\n  float glyphAngle \x3d angle * 360.0 / 254.0;\r\n  float mapAngle \x3d u_mapRotation * 360.0 / 254.0;\r\n  float diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\r\n  float z \x3d 0.0;\r\n\r\n  // make sure range is inclusive\r\n  z +\x3d 2.0 * (1.0 - step(minZoom, u_zoomLevel));\r\n  z +\x3d 2.0 * (1.0 - step(u_zoomLevel, maxZoom));\r\n  z +\x3d 2.0 * u_mapAligned * step(90.0, diffAngle);\r\n  return z;\r\n}\r\n\r\nvoid main()\r\n{\r\n  float isHalo \x3d mod(a_pos, 2.0).x; // lsb of a_pos denotes whether a vertex is part of the halo or not\r\n  vec3 pos \x3d vec3(floor(a_pos * 0.5), 1.0);\r\n  vec2 placementDir \x3d a_refSymbolAndPlacementOffset.zw - 1.0;  // encoded as dir + 1.0\r\n  vec2 vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\r\n  float refSymbolSize \x3d a_refSymbolAndPlacementOffset.y;\r\n  float fontSize \x3d a_texAndSize.z;\r\n  float z \x3d getZ(a_visibilityRange.x, a_visibilityRange.y, a_refSymbolAndPlacementOffset.x);\r\n\r\n  float fontScale \x3d fontSize / SDF_FONT_SIZE;\r\n  float halfSize \x3d refSymbolSize / 2.0;\r\n\r\n  v_color \x3d a_color;\r\n  v_tex \x3d a_texAndSize.xy / u_mosaicSize;\r\n\r\n#ifdef ID\r\n  v_fadeStep \x3d u_fadeStep;\r\n#endif\r\n  \r\n#ifdef VV_SIZE // unlike with text, this is the VV_SIZE of the reference symbol, not the label itself\r\n  halfSize \x3d getVVSize(refSymbolSize, a_vvSize) / 2.0;\r\n#endif\r\n  // if halo.x is zero (not a halo) v_edgeDistanceOffset will end up being zero as well.\r\n  v_edgeDistanceOffset \x3d isHalo * OUTLINE_SCALE * a_texAndSize.w / fontScale / MAX_SDF_DISTANCE;\r\n  v_antialiasingWidth \x3d 0.106 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\r\n\r\n  vec2 placementOffset \x3d placementDir * (halfSize + PLACEMENT_PADDING);\r\n  vec3 glyphOffset \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\r\n  vec3 v_pos \x3d u_dvsMat3 * pos + glyphOffset;\r\n  \r\n  applyFilterLabels(v_color, v_pos, a_visible);\r\n\r\n#ifdef DEBUG\r\n  v_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);  // visualize hidden glyphs\r\n#endif\r\n  \r\n  gl_Position \x3d vec4(v_pos.xy, v_pos.z + z, 1.0);\r\n}\r\n"},
line:{"line.frag":"precision lowp float;\r\n\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cmaterials/constants.glsl\x3e\r\n\r\nuniform lowp float u_blur;\r\nuniform mediump float u_antialiasing;\r\n\r\nvarying mediump vec2 v_normal;\r\nvarying mediump float v_lineHalfWidth;\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_transparency;\r\n\r\n#if defined(PATTERN) || defined(SDF)\r\nuniform sampler2D u_texture;\r\nuniform mediump float u_zoomFactor;\r\n\r\nvarying mediump vec4 v_tlbr; // normalized pattern coordinates [0, 1]\r\nvarying mediump vec2 v_patternSize;\r\nvarying highp float v_accumulatedDistance;\r\n#endif // PATTERN SDF\r\n\r\n#ifdef SDF\r\nconst float sdfPatternHalfWidth \x3d 15.5; // YF: assumed that the width will be set to 31\r\nconst float widthFactor \x3d 2.0;\r\n#endif // SDF\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\n\r\nvoid main()\r\n{\r\n  // for now assume that a thin line is a line which is under 2 pixels (1 pixels on either sides of the centerline)\r\n  mediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(v_lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\r\n\r\n  // dist represent the distance of the fragment from the line. 1.0 or -1.0 will be the values on the edge of the line,\r\n  // and any value in between will be inside the line (the sign represent the direction - right or left).\r\n  // since u_linewidth.s (half line width) is represented in pixels, dist is also given in pixels\r\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\r\n\r\n  // calculate the alpha given the difference between the line-width and the distance of the fragment from the center-line.\r\n  // when it is a thin line then use a slightly shallower slope in order to add more feathering\r\n  lowp float alpha \x3d clamp(thinLineFactor * (v_lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\r\n\r\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT) // When we render the highlight, we want to treat the line as if it was solid\r\n  mediump float lineHalfWidth \x3d widthFactor * v_lineHalfWidth;\r\n  mediump float lineWidthRatio \x3d lineHalfWidth / sdfPatternHalfWidth;\r\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / (lineWidthRatio * v_patternSize.x), 1.0);\r\n  mediump float relativeTexY \x3d 0.5 + 0.5 * v_normal.y;\r\n\r\n  // claculate the actual texture coordinates by interpolating between the TL/BR pattern coordinates\r\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\r\n\r\n  // calculate the distance from the edge [-0.5, 0.5]\r\n  mediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\r\n\r\n  // the distance is a proportional to the line width\r\n  float dist \x3d d * lineHalfWidth;\r\n\r\n  lowp vec4 fillPixelColor \x3d v_transparency * alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\r\n  gl_FragColor \x3d fillPixelColor;\r\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT)  // When we render the highlight, we want to treat the line as if it was solid\r\n  // we need to calculate the relative portion of the line texture along the line given the accumulated distance along the line\r\n  // The computed value should is anumber btween 0 and 1 which will later be used to interpolate btween the BR and TL values\r\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * v_lineHalfWidth) / v_patternSize.x, 1.0);\r\n\r\n  // in order to calculate the texture coordinates prependicular to the line (Y axis), we use the interpolated normal values\r\n  // which range from -1.0 to 1.0. On the line's centerline, the value of the interpolated normal is 0.0, however the relative\r\n  // texture value shpould be 0.5 (given that at the bottom of the line, the texture coordinate must be equal to 0.0)\r\n  // (TL) ---------------------------      --\x3e left edge of line. Interpolatedf normal is 1.0\r\n  //              | -\x3e line-width / 2\r\n  //      - - - - - - - - - - - - - -\r\n  //              | -\x3e line-width / 2\r\n  //      ---------------------------- (BR)--\x3e right edge of line. Interpolatedf normal is -1.0\r\n\r\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / v_patternSize.y);\r\n\r\n  // claculate the actual texture coordinates by interpolating between the TL/BR pattern coordinates\r\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\r\n\r\n  // get the color from the texture\r\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\r\n\r\n  gl_FragColor \x3d v_transparency * alpha * v_color * color;\r\n#else // solid line (no texture, no pattern)\r\n  // output the fragment color\r\n  gl_FragColor \x3d v_transparency * alpha * v_color;\r\n#endif // SDF\r\n\r\n#ifdef HIGHLIGHT\r\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\r\n#endif // HIGHLIGHT\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"line.vert":"precision mediump float;\r\n\r\n#include \x3cmaterials/constants.glsl\x3e\r\n#include \x3cmaterials/utils.glsl\x3e\r\n#include \x3cmaterials/vv.glsl\x3e\r\n#include \x3cmaterials/effects.glsl\x3e\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_id;\r\nattribute vec4 a_color;\r\nattribute vec4 a_offsetAndNormal;\r\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\r\nattribute vec4 a_tlbr;\r\nattribute vec4 a_segmentDirection;\r\nattribute float  a_visible;                // a one byte controlling the visibility of the vertex (separate buffer)\r\n\r\n#ifdef VV\r\nattribute highp vec3 a_vv;\r\n#endif\r\n\r\nuniform highp mat3 u_dvsMat3;              // premultiplies DisplayMat3 * ViewMat3 * ScreenMat3\r\nuniform highp mat3 u_displayViewMat3;     // premultiplies DisplayMat3 * ViewMat3\r\nuniform mediump float u_zoomFactor;\r\nuniform mediump float u_antialiasing;\r\n\r\nvarying mediump vec2 v_normal;             // interpolated normal to the line. packed into the two LSBs of the vertex coordinate\r\nvarying mediump float v_lineHalfWidth;\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_transparency;\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif\r\n\r\n#ifdef PATTERN\r\nuniform mediump vec2 u_mosaicSize;\r\n\r\nvarying mediump vec4 v_tlbr;               // normalized pattern coordinates [0, 1]\r\nvarying mediump vec2 v_patternSize;\r\n#endif\r\n\r\n#if defined(PATTERN) || defined(SDF)\r\nvarying highp float v_accumulatedDistance; // we need to accumulated distance only if it is a pattern or an SDF line\r\n#endif\r\n\r\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT) // When we render the highlight, we want to treat the line as if it was solid\r\nconst float widthFactor \x3d 2.0;\r\n#else\r\nconst float widthFactor \x3d 1.0;\r\n#endif\r\n\r\nconst float scale \x3d 1.0 / 31.0;\r\n\r\nvoid main()\r\n{\r\n  float a_bitset \x3d a_segmentDirection.w;\r\n\r\n  float isColorLocked \x3d getBit(a_bitset, 0);\r\n  float lineHalfWidth \x3d a_accumulatedDistanceAndHalfWidth.y * scale;\r\n\r\n  v_transparency \x3d 1.0;\r\n  v_color \x3d a_color;\r\n  v_normal \x3d a_offsetAndNormal.zw * scale;\r\n\r\n#ifdef ID\r\n  v_id \x3d a_id;\r\n#endif\r\n\r\n#ifdef VV_OPACITY\r\n  v_transparency \x3d getVVOpacity(a_vv.z);\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  v_color \x3d getVVColor(a_vv.y, v_color, isColorLocked);\r\n#endif\r\n\r\n#ifdef VV_SIZE\r\n  lineHalfWidth \x3d 0.5 * getVVSize(2.0 * lineHalfWidth, a_vv.x);\r\n#endif\r\n\r\n#ifdef PATTERN\r\n  v_tlbr \x3d a_tlbr / u_mosaicSize.xyxy;\r\n  v_patternSize \x3d vec2(a_tlbr.z - a_tlbr.x, a_tlbr.w - a_tlbr.y);\r\n#endif\r\n\r\n  // make sure to clip the vertices in case that the width of the line is 0 (or negative)\r\n  float z \x3d 2.0 * step(lineHalfWidth, 0.0);\r\n\r\n  // add an antialiasing distance. We use 0.2 rather than 0.5 in order to match the SVG renderer\r\n  // also limit the total line width to 1.3 pixels. Below this value lines don't look good compared\r\n  // to the SVG renderer\r\n  v_lineHalfWidth \x3d max(lineHalfWidth, 0.45) + 0.2 * u_antialiasing;\r\n\r\n\r\n#ifdef HIGHLIGHT\r\n  v_lineHalfWidth \x3d max(v_lineHalfWidth, 2.0);\r\n#endif\r\n\r\n  // for now assume that a thin line is a line which is under 2 pixels (1 pixels on either sides\r\n  // of the centerline) in practice, a thin line is a line who's half width vary from 0.45px to\r\n  // the value of thinLineHalfWidth, as the value is claped in line 221 above\r\n  mediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(v_lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\r\n\r\n  // calculate the relative distance from the centerline to the edge of the line. Since offset is\r\n  // given in integers (for the sake of using less attribute memory, we need to scale it back to\r\n  // the original range of ~ [0, 1]) in a case of a thin line we move each vertex twice as far\r\n  mediump vec2 dist \x3d thinLineFactor * widthFactor * v_lineHalfWidth * a_offsetAndNormal.xy * scale;\r\n\r\n#if defined(PATTERN) || defined(SDF)\r\n  v_accumulatedDistance \x3d a_accumulatedDistanceAndHalfWidth.x + dot(scale * a_segmentDirection.xy, dist / u_zoomFactor);\r\n#endif\r\n\r\n  vec3 offset \x3d u_displayViewMat3 * vec3(dist, 0.0);\r\n  vec3 v_pos \x3d u_dvsMat3 * vec3(a_pos.xy, 1.0) + offset;\r\n  vec3 pos \x3d vec3(v_pos.xy, z);\r\n\r\n  applyFilter(v_color, pos, a_visible);\r\n\r\n  gl_Position \x3d vec4(pos, 1.0);\r\n}\r\n"},
text:{"text.frag":"precision lowp float;\r\n\r\nuniform lowp sampler2D u_texture;\r\n\r\nvarying mediump vec4 v_color;\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\nvarying mediump vec2 v_tex;\r\nvarying lowp float v_transparency;\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\nvoid main()\r\n{\r\n  // read the distance from the SDF texture\r\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\r\n\r\n  // the edge distance if a factor of the outline width\r\n  // We cap this to 0.25 to prevent this from becomming negative / running into the glyph boundaries\r\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\r\n\r\n  #ifdef HIGHLIGHT\r\n    glyphEdgeDistance /\x3d 2.0;\r\n  #endif\r\n\r\n  // use a smooth-step in order to calculate the geometry of the shape given by the distance field\r\n  lowp float alpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist) * v_transparency;\r\n\r\n  gl_FragColor \x3d alpha * v_color;\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"text.vert":"precision mediump float;\r\n\r\n#include \x3cmaterials/constants.glsl\x3e\r\n#include \x3cmaterials/utils.glsl\x3e\r\n#include \x3cmaterials/vv.glsl\x3e\r\n#include \x3cmaterials/effects.glsl\x3e\r\n\r\nattribute vec2 a_pos;          // 2 * 2 (2 x signed 16)\r\nattribute vec4 a_id;           // 4 (4 x unsigned byte)\r\nattribute vec4 a_color;        // 4 (4 x unsigned byte)\r\nattribute vec2 a_vertexOffset; // 2 * 2 // (2 x signed 16) offset from the anchor point of the string\r\nattribute vec4 a_texFontSize;  // 4 (4 x unsigned byte) texture coordinatesm and font size\r\nattribute vec4 a_aux;          // hold onto additional information such as a bitset on the last byte (a_aux.w)\r\nattribute float a_visible;     // a one byte controlling the visibility of the vertex (a separate visibility buffer)\r\n\r\n#ifdef VV\r\nattribute highp vec4 a_vv;\r\n#endif\r\n\r\nuniform vec2 u_mosaicSize;\r\nuniform float u_pixelRatio;\r\nuniform highp mat3 u_dvsMat3;\r\nuniform highp mat3 u_displayMat3; // Premultiplies DisplayMat3 * ViewMat3 * ScreenMat3\r\n\r\nvarying mediump vec4 v_color;\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\nvarying mediump vec2 v_tex;        // texture coordinates used to sample the glyph atlas\r\nvarying lowp float v_transparency; // the calculated transparency to be applied by the fragment shader. \r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\nvoid main()\r\n{\r\n  float a_bitset \x3d a_aux.w;\r\n\r\n  float isColorLocked \x3d getBit(a_bitset, 0);\r\n  float isHalo \x3d getBit(a_pos.x, 0);   // The lsb of pos denotes whether a vertex is part of the halo or not\r\n  float fontSize \x3d a_texFontSize.z;\r\n  vec3 pos \x3d vec3(floor(a_pos * 0.5), 1.0);\r\n  vec3 offset \x3d vec3(a_vertexOffset * OFFSET_PRECISION, 0.0);\r\n  float scale \x3d 1.0;\r\n\r\n  v_transparency \x3d 1.0;\r\n  v_color \x3d a_color;\r\n  v_tex \x3d a_texFontSize.xy / u_mosaicSize;\r\n\r\n#ifdef ID\r\n  v_id \x3d a_id;\r\n#endif\r\n\r\n#ifdef VV_OPACITY\r\n  v_transparency \x3d getVVOpacity(a_vv.z);\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  // we don't want to override the halo color\r\n  v_color \x3d isHalo * a_color + (1.0 - isHalo) * getVVColor(a_vv.y, a_color, isColorLocked);\r\n#endif\r\n\r\n#ifdef VV_SIZE\r\n  float f \x3d getVVSize(a_texFontSize.z, a_vv.x);\r\n  scale \x3d f / fontSize; \r\n  fontSize \x3d f;\r\n  offset.xy *\x3d scale; \r\n#endif\r\n  \r\n#ifdef VV_ROTATION\r\n  offset \x3d getVVRotationMat3(a_vv.w) * offset;\r\n#endif\r\n\r\n  vec3 v_pos \x3d u_dvsMat3 * pos + u_displayMat3 * offset;\r\n  float fontScale \x3d fontSize / SDF_FONT_SIZE;\r\n\r\n  // if isHalo is zero (not a halo) v_edgeDistanceOffset will end up being zero as well.\r\n  v_edgeDistanceOffset \x3d isHalo * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\r\n  v_antialiasingWidth \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\r\n\r\n  applyFilter(v_color, v_pos, a_visible);\r\n  \r\n  gl_Position \x3d vec4(v_pos, 1.0);\r\n}\r\n"},
"utils.glsl":"\r\nfloat getBit(in float bitset, in int bitIndex) {\r\n  float offset \x3d pow(2.0, float(bitIndex));\r\n\r\n  return mod(floor(bitset / offset), 2.0);\r\n}\r\n","vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n  #define VV_SIZE\r\n#endif\r\n\r\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\r\n  #define VV\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\nuniform highp float u_vvColorValues[8];\r\nuniform vec4 u_vvColors[8];\r\n#endif // VV_COLOR\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nuniform highp vec4 u_vvSizeMinMaxValue;\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\nuniform highp float u_vvSizeScaleStopsValue;\r\n#endif // VV_SIZE_SCALE_STOPS\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nuniform highp float u_vvSizeFieldStopsValues[6];\r\nuniform float u_vvSizeFieldStopsSizes[6];\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nuniform highp float u_vvSizeUnitValueWorldToPixelsRatio;\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nuniform highp float u_vvOpacityValues[8];\r\nuniform float u_vvOpacities[8];\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_ROTATION\r\nuniform lowp float u_vvRotationType;\r\n#endif // VV_ROTATION\r\n\r\nconst highp float nanValue \x3d 1e-30;\r\n\r\nbool isNan(float val) {\r\n  return (val \x3d\x3d nanValue);\r\n  //return !( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 );\r\n}\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  // we need to multiply by 8 in order to translate to tile coordinates\r\n  float interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\r\n  interpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\r\n  return u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\r\n}\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nconst int VV_SIZE_N \x3d 6;\r\nfloat getVVStopsSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\r\n    return u_vvSizeFieldStopsSizes[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\r\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\r\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\r\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\r\n}\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nfloat getVVUnitValue(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\r\n}\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nconst int VV_OPACITY_N \x3d 8;\r\nfloat getVVOpacity(float opacityValue) {\r\n  if (isNan(opacityValue)) {\r\n    return 1.0;\r\n  }\r\n\r\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\r\n    return u_vvOpacities[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\r\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\r\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\r\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvOpacities[VV_OPACITY_N - 1];\r\n}\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_ROTATION\r\nmat4 getVVRotation(float rotationValue) {\r\n  // YF TODO: if the symbol has rotation we need to combine the symbo's rotation with the VV one\r\n  if (isNan(rotationValue)) {\r\n    return mat4(1, 0, 0, 0,\r\n                0, 1, 0, 0,\r\n                0, 0, 1, 0,\r\n                0, 0, 0, 1);\r\n  }\r\n\r\n  float rotation \x3d rotationValue;\r\n  if (u_vvRotationType \x3d\x3d 1.0) {\r\n    rotation \x3d 90.0 - rotation;\r\n  }\r\n\r\n  float angle \x3d C_DEG_TO_RAD * rotation;\r\n\r\n  float sinA \x3d sin(angle);\r\n  float cosA \x3d cos(angle);\r\n\r\n  return mat4(cosA, sinA, 0, 0,\r\n              -sinA,  cosA, 0, 0,\r\n              0,     0, 1, 0,\r\n              0,     0, 0, 1);\r\n}\r\n\r\nmat3 getVVRotationMat3(float rotationValue) {\r\n  // YF TODO: if the symbol has rotation we need to combine the symbo's rotation with the VV one\r\n  if (isNan(rotationValue)) {\r\n    return mat3(1, 0, 0,\r\n                0, 1, 0,\r\n                0, 0, 1);\r\n  }\r\n\r\n  float rotation \x3d rotationValue;\r\n  if (u_vvRotationType \x3d\x3d 1.0) {\r\n    rotation \x3d 90.0 - rotation;\r\n  }\r\n\r\n  float angle \x3d C_DEG_TO_RAD * -rotation;\r\n\r\n  float sinA \x3d sin(angle);\r\n  float cosA \x3d cos(angle);\r\n\r\n  return mat3(cosA, -sinA, 0,\r\n             sinA, cosA, 0,\r\n              0,    0,    1);\r\n}\r\n#endif // VV_ROTATION\r\n\r\n#ifdef VV_COLOR\r\nconst int VV_COLOR_N \x3d 8;\r\n\r\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\r\n  if (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\r\n    return fallback;\r\n  }\r\n\r\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\r\n    return u_vvColors[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\r\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\r\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvColors[VV_COLOR_N - 1];\r\n}\r\n#endif // VV_COLOR\r\n\r\nfloat getVVSize(in float size, in float vvSize)  {\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\n  return getVVMinMaxSize(vvSize, size);\r\n\r\n#elif defined(VV_SIZE_SCALE_STOPS)\r\n  return u_vvSizeScaleStopsValue;\r\n\r\n#elif defined(VV_SIZE_FIELD_STOPS)\r\n  return getVVStopsSize(vvSize, size);\r\n\r\n#elif defined(VV_SIZE_UNIT_VALUE)\r\n  return getVVUnitValue(vvSize, size);\r\n\r\n#else\r\n  return size;\r\n\r\n#endif\r\n}\r\n"},
raster:{"solid.frag":"precision mediump float;\r\n\r\nvoid main(void) {\r\n  gl_FragColor \x3d vec4(1.0, 0.0, 0.0, 1.0);\r\n}\r\n","texture.frag":"precision mediump float;\r\n\r\n// Texture coordinates.\r\nvarying vec2 v_texcoord;\r\n\r\n// Texture sampler.\r\nuniform sampler2D u_texture;\r\n\r\n// Opacity.\r\nuniform float u_opacity;\r\n\r\nvoid main(void) {\r\n  vec4 color \x3d texture2D(u_texture, v_texcoord);\r\n  color.a *\x3d u_opacity;\r\n  gl_FragColor \x3d vec4(color.rgb * color.a, color.a);\r\n}\r\n",
"transform.vert":"precision mediump float;\r\n\r\n// Vertex position. Assumed normalized in the [0, 1] range.\r\nattribute vec2 a_position;\r\n\r\n// Transform matrix.\r\nuniform mat4 u_transform;\r\n\r\n// Output texture coordinates, for interpolation.\r\nvarying vec2 v_texcoord;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d u_transform * vec4((2.0 * a_position - 1.0), 0.0, 1.0);\r\n  v_texcoord \x3d a_position;\r\n}\r\n"},stencil:{"stencil.frag":"void main() {\r\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n}\r\n",
"stencil.vert":"attribute vec2 a_pos;\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\r\n}\r\n"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\r\nvarying mediump vec2 v_tex;\r\n\r\nvoid main(void) {\r\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\r\n  gl_FragColor \x3d 0.75 * color;\r\n}\r\n","tileInfo.vert":"attribute vec2 a_pos;\r\n\r\nuniform highp mat3 u_dvsMat3;\r\n\r\nuniform mediump float u_depth;\r\nuniform mediump float u_coord_ratio;\r\nuniform mediump vec2 u_delta; // in tile coordinates\r\nuniform mediump vec2 u_dimensions; // in tile coordinates\r\n\r\nvarying mediump vec2 v_tex;\r\n\r\nvoid main() {\r\n  mediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\r\n  vec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\r\n  \r\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\r\n\r\n  v_tex \x3d a_pos;\r\n}\r\n"},
util:{"encoding.glsl":"// Factors to convert rgba back to float\r\nconst vec4 rgba2float_factors \x3d vec4(\r\n    255.0 / (256.0),\r\n    255.0 / (256.0 * 256.0),\r\n    255.0 / (256.0 * 256.0 * 256.0),\r\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\r\n  );\r\n\r\nfloat rgba2float(vec4 rgba) {\r\n  // Convert components from 0-\x3e1 back to 0-\x3e255 and then\r\n  // add the components together with their corresponding\r\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\r\n  return dot(rgba, rgba2float_factors);\r\n}\r\n"}}})},
"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(h,a){return function(){function a(a){this.readFile=a}a.prototype.resolveIncludes=function(a){return this.resolve(a)};a.prototype.resolve=function(a,d){var k=this;void 0===d&&(d=new Map);if(d.has(a))return d.get(a);var n=this.read(a);if(!n)throw Error("cannot find shader file "+a);for(var g=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm,e=g.exec(n),c=[];null!=e;)c.push({path:e[1],start:e.index,length:e[0].length}),e=g.exec(n);
var b=0,l="";c.forEach(function(c){l+=n.slice(b,c.start);l+=d.has(c.path)?"":k.resolve(c.path,d);b=c.start+c.length});l+=n.slice(b);d.set(a,l);return l};a.prototype.read=function(a){return this.readFile(a)};return a}()})},"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../../core/typedArrayUtil"],function(h,a,f,m){return function(){function a(k,d,g,e,c){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=
void 0;this._context=k;this._bufferType=d;this._usage=g;this._id=a._nextId++;this._glName=this._context.gl.createBuffer();e&&this.setData(e,c)}a.createIndex=function(k,d,g,e){return new a(k,34963,d,g,e)};a.createVertex=function(k,d,g){return new a(k,34962,d,g)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"byteSize",{get:function(){return 34962===this._bufferType?
this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context=null)};a.prototype.setData=function(a,d){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&d)switch(this._indexType=d,this._size=a,d){case 5123:a*=2;break;case 5125:a*=4}}else d=a.byteLength,m.isUint16Array(a)&&
(d/=2,this._indexType=5123),m.isUint32Array(a)&&(d/=4,this._indexType=5125),this._size=d;d=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,a,this._usage);this._context.bindVAO(d)}};a.prototype.setSubData=function(a,d,g,e){void 0===d&&(d=0);void 0===g&&(g=0);if(a){(0>d||d>=this._size)&&console.error("offset is out of range!");var c=d,b=g,l=e,k=a.byteLength;m.isUint16Array(a)&&(k/=2,c*=2,b*=2,l*=2);m.isUint32Array(a)&&
(k/=4,c*=4,b*=4,l*=4);void 0===e&&(e=k-1);g>=e&&console.error("end must be bigger than start!");d+g-e>this._size&&console.error("An attempt to write beyond the end of the buffer!");d=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);g=this._context.gl;a=ArrayBuffer.isView(a)?a.buffer:a;g.bufferSubData(this._bufferType,c,a.slice(b,l));this._context.bindVAO(d)}};a._nextId=0;return a}()})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],
function(h,a,f){function m(a,k,n,g){n=n||{};g=g||"";n="function"===typeof k.shaders?k.shaders(n):k.shaders;return new f(a,g+n.vertexShader,g+n.fragmentShader,k.attributes)}Object.defineProperty(a,"__esModule",{value:!0});a.glslifyDefineMap=function(a){var d="",n;for(n in a){var g=a[n];if("boolean"===typeof g)g&&(d+="#define "+n+"\n");else if("number"===typeof g)d+="#define "+n+" "+g.toFixed()+"\n";else if("object"===typeof g){var e=g.options,c=0,b;for(b in e)d+="#define "+e[b]+" "+(c++).toFixed()+
"\n";d+="#define "+n+" "+e[g.value]+"\n"}}return d};h=function(){function a(a){this._programCacheByTemplate=new Map;this._rctx=a}a.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._programCacheByTemplate=null};a.prototype.getProgram=function(a,d){var g=this;this._programCacheByTemplate.has(a)||this.addProgramTemplate(a,function(e){return m(g._rctx,a,e)});return this.getProgramTemplateInstance(a,d)};a.prototype.addProgramTemplate=
function(a,d){this._programCacheByTemplate.set(a,{constructor:d,programs:new Map})};a.prototype.getProgramTemplateInstance=function(a,d){if(a=this._programCacheByTemplate.get(a)){var g=d?JSON.stringify(d):"default";a.programs.has(g)||(d=a.constructor(d),a.programs.set(g,d));return a.programs.get(g)}return null};return a}();a.ProgramCache=h;a.createProgram=m})},"esri/views/webgl/Program":function(){define(["require","exports","../../core/has","./ShaderTranspiler"],function(h,a,f,m){return function(){function a(k,
d,g,e,c){void 0===c&&(c={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};k||console.error("RenderingContext isn't initialized!");0===d.length&&console.error("Shaders source should not be empty!");
this._context=k;this._vertexShaderSource=d;this._fragmentShaderSource=g;if(Array.isArray(c))for(k=0;k<c.length;k++)this._defines[c[k]]="1";else this._defines=c;this._id=a._nextId++;this._locations=e}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},
enumerable:!0,configurable:!0});a.prototype.getDefine=function(a){return this._defines[a]};a.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};a.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);
this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,d=a.createProgram();a.attachShader(d,this._vShader);a.attachShader(d,this._fShader);for(var g in this._locations)a.bindAttribLocation(d,this._locations[g],g);a.linkProgram(d);a.getProgramParameter(d,a.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(d,a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(d));this._glName=d;this._initialized=
!0}};a.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};a.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};a.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};
a.prototype.setUniform1i=function(a,d){var g=this._nameToUniform1[a];if(void 0===g||d!==g)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),d),this._nameToUniform1[a]=d};a.prototype.setUniform1iv=function(d,n){var g=this._nameToUniform1v[d];void 0!==g&&a._arraysEqual(n,g)||(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(d),n),void 0===g?this._nameToUniform1v[d]=a._arrayCopy(n):a._arrayAssign(n,g))};a.prototype.setUniform1f=function(a,
d){var g=this._nameToUniform1[a];if(void 0===g||d!==g)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),d),this._nameToUniform1[a]=d};a.prototype.setUniform1fv=function(d,n){var g=this._nameToUniform1v[d];void 0!==g&&a._arraysEqual(n,g)||(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(d),n),void 0===g?this._nameToUniform1v[d]=a._arrayCopy(n):a._arrayAssign(n,g))};a.prototype.setUniform2f=function(a,d,g){var e=this._nameToUniform2[a];
if(void 0===e||d!==e[0]||g!==e[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),d,g),void 0===e?this._nameToUniform2[a]=[d,g]:(e[0]=d,e[1]=g)};a.prototype.setUniform2fv=function(d,n){var g=this._nameToUniform2[d];void 0!==g&&a._arraysEqual(n,g)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(d),n),void 0===g?this._nameToUniform2[d]=a._arrayCopy(n):a._arrayAssign(n,g))};a.prototype.setUniform3f=function(a,d,g,e){var c=this._nameToUniform3[a];
if(void 0===c||d!==c[0]||g!==c[1]||e!==c[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),d,g,e),void 0===c?this._nameToUniform3[a]=[d,g,e]:(c[0]=d,c[1]=g,c[2]=e)};a.prototype.setUniform3fv=function(d,n){var g=this._nameToUniform3[d];void 0!==g&&a._arraysEqual(n,g)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(d),n),void 0===g?this._nameToUniform3[d]=a._arrayCopy(n):a._arrayAssign(n,g))};a.prototype.setUniform4f=function(a,
d,g,e,c){var b=this._nameToUniform4[a];if(void 0===b||d!==b[0]||g!==b[1]||e!==b[2]||c!==b[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(a),d,g,e,c),void 0===b?this._nameToUniform4[a]=[d,g,e,c]:(b[0]=d,b[1]=g,b[2]=e,b[3]=c)};a.prototype.setUniform4fv=function(d,n){var g=this._nameToUniform4[d];void 0!==g&&a._arraysEqual(n,g)||(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(d),n),void 0===g?this._nameToUniform4[d]=a._arrayCopy(n):
a._arrayAssign(n,g))};a.prototype.setUniformMatrix3fv=function(d,n,g){void 0===g&&(g=!1);var e=this._nameToUniformMatrix3[d];void 0!==e&&(9===e.length?a._matrix3Equal(e,n):a._arraysEqual(n,e))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(d),g,n),void 0===e?this._nameToUniformMatrix3[d]=a._arrayCopy(n):a._arrayAssign(n,e))};a.prototype.setUniformMatrix4fv=function(d,n,g){void 0===g&&(g=!1);var e=this._nameToUniformMatrix4[d];void 0!==e&&(16===e.length?
a._matrix4Equal(e,n):a._arraysEqual(n,e))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(d),g,n),void 0===e?this._nameToUniformMatrix4[d]=a._arrayCopy(n):a._arrayAssign(n,e))};a._padToThree=function(a){var d=a.toString();1E3>a&&(d=("  "+a).slice(-3));return d};a.prototype._addLineNumbers=function(d){var k=2;return d.replace(/\n/g,function(){return"\n"+a._padToThree(k++)+":"})};a.prototype._loadShader=function(a){var d=35633===a,g=d?this._vertexShaderSource:
this._fragmentShaderSource,e;e="";for(var c in this._defines)e+="#define "+c+" "+this._defines[c]+"\n";e+=g;"webgl2"===this._context.contextVersion&&(e=m.transpileShader(e,d?"vertex":"fragment"));d=this._context.gl;a=d.createShader(a);d.shaderSource(a,e);d.compileShader(a);d.getShaderParameter(a,d.COMPILE_STATUS)||(console.error(d.getShaderInfoLog(a)),console.error(this._addLineNumbers(e)),"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),console.log(g)));
return a};a._matrix4Equal=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]&&a[4]===d[4]&&a[5]===d[5]&&a[6]===d[6]&&a[7]===d[7]&&a[8]===d[8]&&a[9]===d[9]&&a[10]===d[10]&&a[11]===d[11]&&a[12]===d[12]&&a[13]===d[13]&&a[14]===d[14]&&a[15]===d[15]};a._matrix3Equal=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]&&a[4]===d[4]&&a[5]===d[5]&&a[6]===d[6]&&a[7]===d[7]&&a[8]===d[8]};a._arraysEqual=function(a,d){if(a.length!==d.length)return!1;for(var g=0;g<a.length;++g)if(a[g]!==
d[g])return!1;return!0};a._arrayCopy=function(a){for(var d=[],g=0;g<a.length;++g)d.push(a[g]);return d};a._arrayAssign=function(a,d){for(var g=0;g<a.length;++g)d[g]=a[g]};a._nextId=0;return a}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(h,a,f,m){function d(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}function k(a,c,b,l){l=l||b;for(var e=0;e<a.length;e++){var d=a[e];if("ident"===
d.type&&d.data===b)return l in c?c[l]++:c[l]=0,k(a,c,l+"_"+c[l],l)}return b}function n(a,c,b){void 0===b&&(b="afterVersion");var l={data:"\n",type:"whitespace"},e=function(c){return c<a.length?/[^\r\n]$/.test(a[c].data):!1},d=function(a){for(var c=-1,l=0,e=-1,d=0;d<a.length;d++){var g=a[d];"preprocessor"===g.type&&(g.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++l:g.data.match(/\#endif\s*.*/)&&--l);("afterVersion"===b||"afterPrecision"===b)&&"preprocessor"===g.type&&/^#version/.test(g.data)&&(e=Math.max(e,
d));if("afterPrecision"===b&&"keyword"===g.type&&"precision"===g.data){a:{for(g=d;g<a.length;g++){var v=a[g];if("operator"===v.type&&";"===v.data)break a}g=null}if(null===g)throw Error("precision statement not followed by any semicolons!");e=Math.max(e,g)}c<e&&0===l&&(c=d)}return c+1}(a);e(d-1)&&a.splice(d++,0,l);for(var g=0;g<c.length;g++){var k=c[g];a.splice(d++,0,k)}e(d-1)&&e(d)&&a.splice(d,0,l)}Object.defineProperty(a,"__esModule",{value:!0});var g=["GL_OES_standard_derivatives","GL_EXT_frag_depth",
"GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];a.transpileShader=function(a,c){a=m(a);var b;a:{b="100";var l="300 es";void 0===b&&(b="100");void 0===l&&(l="300 es");for(var e=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,v=0;v<a.length;v++){var z=a[v];if("preprocessor"===z.type){var w=e.exec(z.data);if(w){e=w[1].replace(/\s\s+/g," ");if(e===l){b=e;break a}if(e===b){z.data="#version "+l;break a}throw Error("unknown glsl version: "+e);}}}a.splice(0,0,{type:"preprocessor",data:"#version "+l},{type:"whitespace",
data:"\n"});b=null}if("300 es"===b)throw Error("shader is already glsl 300 es");e=z=null;v={};w={};for(b=0;b<a.length;++b)switch(l=a[b],l.type){case "keyword":"vertex"===c&&"attribute"===l.data?l.data="in":"varying"===l.data&&(l.data="vertex"===c?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===c&&"gl_FragColor"===l.data){if(!z){var z=k(a,v,"fragColor"),p=void 0;void 0===p&&(p="lowp");n(a,
[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:p},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:z},{type:"operator",data:";"}],"afterPrecision")}l.data=z}else"fragment"===c&&"gl_FragDepthEXT"===l.data&&(e||(e=k(a,v,"gl_FragDepth")),l.data=e);break;case "ident":if(0<=f.indexOf(l.data)){if(p="vertex"===c)a:{for(p=b-1;0<=p;p--){var B=a[p];if("whitespace"!==B.type&&"block-comment"!==B.type)if("keyword"===B.type){if("attribute"===
B.data||"in"===B.data){p=!0;break a}}else break}p=!1}if(p)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in w||(w[l.data]=k(a,v,l.data));l.data=w[l.data]}}for(b=a.length-1;0<=b;--b)l=a[b],"preprocessor"===l.type&&((c=l.data.match(/\#extension\s+(.*)\:/))&&c[1]&&0<=g.indexOf(c[1].trim())&&(c=a[b+1],a.splice(b,c&&"whitespace"===c.type?2:1)),(c=l.data.match(/\#ifdef\s+(.*)/))&&c[1]&&0<=g.indexOf(c[1].trim())&&(l.data="#if 1"),(c=l.data.match(/\#ifndef\s+(.*)/))&&
c[1]&&0<=g.indexOf(c[1].trim())&&(l.data="#if 0"));return d(a)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(h,a){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(h){"use strict;";return function(a){var f=h(),m=[],m=m.concat(f(a));return m=m.concat(f(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(h,a,f){"use strict;";var m="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function d(a){a.length&&B.push({type:m[v],
data:a,position:x,line:F,column:q})}function k(){p=p.length?[]:p;if("/"===w&&"*"===z)return x=y+l-1,v=0,w=z,l+1;if("/"===w&&"/"===z)return x=y+l-1,v=1,w=z,l+1;if("#"===z)return v=2,x=y+l,l;if(/\s/.test(z))return v=9,x=y+l,l;u=/\d/.test(z);A=/[^\w_]/.test(z);x=y+l;v=u?4:A?3:9999;return l}function n(){if(("\r"===z||"\n"===z)&&"\\"!==w)return d(p.join("")),v=999,l;p.push(z);w=z;return l+1}function g(){if("."===w&&/\d/.test(z))return v=5,l;if("/"===w&&"*"===z)return v=0,l;if("/"===w&&"/"===z)return v=
1,l;if("."===z&&p.length){for(;e(p););v=5;return l}if(";"===z||")"===z||"("===z){if(p.length)for(;e(p););d(z);v=999;return l+1}var a=2===p.length&&"\x3d"!==z;if(/[\w_\d\s]/.test(z)||a){for(;e(p););v=999;return l}p.push(z);w=z;return l+1}function e(c){var b=0,l,e;do{l=a.indexOf(c.slice(0,c.length+b).join(""));e=a[l];if(-1===l){if(0<b--+c.length)continue;e=c.slice(0,1).join("")}d(e);x+=e.length;p=p.slice(e.length);return p.length}while(1)}function c(){if("."===z||/[eE]/.test(z))return p.push(z),v=5,
w=z,l+1;if("x"===z&&1===p.length&&"0"===p[0])return v=11,p.push(z),w=z,l+1;if(/[^\d]/.test(z))return d(p.join("")),v=999,l;p.push(z);w=z;return l+1}function b(){"f"===z&&(p.push(z),w=z,l+=1);if(/[eE]/.test(z)||"-"===z&&/[eE]/.test(w))return p.push(z),w=z,l+1;if(/[^\d]/.test(z))return d(p.join("")),v=999,l;p.push(z);w=z;return l+1}var l=0,y=0,v=999,z,w,p=[],B=[],F=1,q=0,x=0,u=!1,A=!1,C="",D;return function(a){B=[];if(null!==a){a=a.replace?a.replace(/\r\n/g,"\n"):a;l=0;C+=a;for(D=C.length;z=C[l],l<
D;){a=l;switch(v){case 0:"/"===z&&"*"===w?(p.push(z),d(p.join("")),v=999):(p.push(z),w=z);l+=1;break;case 1:l=n();break;case 2:l=n();break;case 3:l=g();break;case 4:l=c();break;case 11:/[^a-fA-F0-9]/.test(z)?(d(p.join("")),v=999):(p.push(z),w=z,l+=1);break;case 5:l=b();break;case 9999:if(/[^\d\w_]/.test(z)){var e=p.join("");v=-1<h.indexOf(e)?8:-1<f.indexOf(e)?7:6;d(p.join(""));v=999}else p.push(z),w=z,l+=1;break;case 9:/[^\s]/g.test(z)?(d(p.join("")),v=999):(p.push(z),w=z,l+=1);break;case 999:l=k()}if(a!==
l)switch(C[a]){case "\n":q=0;++F;break;default:++q}}y+=l;C=C.slice(l);return B}p.length&&d(p.join(""));v=10;d("(eof)");return B}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/has","./Util"],function(h,a,f,m){return function(){function a(d,f,g,e,c){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=d;this._layout=g;this._buffers=e;this._locations=f;c&&(this._indexBuffer=c);this._id=a._nextId++}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(d,g){return d+a._buffers[g].size},this._indexBuffer?this._indexBuffer.size:
0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});a.prototype.dispose=function(a){void 0===a&&(a=!0);if(this._context){var d=this._context.capabilities.vao;d&&this._glName&&(d.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);
if(a){for(var g in this._buffers)this._buffers[g].dispose(),delete this._buffers[g];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};a.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var d=a.createVertexArray();a.bindVertexArray(d);this._bindLayout();a.bindVertexArray(null);this._glName=d}this._initialized=!0}};a.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):
(this._context.bindVAO(null),this._bindLayout())};a.prototype._bindLayout=function(){var a=this._buffers,d=!!this._context.capabilities.vao,g=this._layout,e=this._indexBuffer;a||console.error("Vertex buffer dictionary is empty!");var c=this._context.gl,b;for(b in a){var l=a[b];l||console.error("Vertex buffer is uninitialized!");var y=g[b];y||console.error("Vertex element descriptor is empty!");m.bindVertexBufferLayout(this._context,this._locations,l,y)}e&&(d?c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.glName):
this._context.bindBuffer(e))};a.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};a.prototype._unbindLayout=function(){var a=this._buffers,d=this._layout;a||console.error("Vertex buffer dictionary is empty!");for(var g in a){var e=a[g];e||console.error("Vertex buffer is uninitialized!");m.unbindVertexBufferLayout(this._context,this._locations,e,d[g])}(a=this._indexBuffer)&&this._context.unbindBuffer(a.bufferType)};a._nextId=
0;return a}()})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils","../../core/Error"],function(h,a,f,m,d){function k(a){return a[0].stride}function n(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}function g(a){switch(a){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;
case 6408:return 4;case 34041:return 4;case 33325:return 2;case 33326:return 4;case 35898:return 4;case 33327:return 4;case 33328:return 8;case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1;default:m.neverReached(a)}return 0}function e(a){if(!a)return 0;if("colorAttachment"in a)return a.glName?e(a.colorAttachment)+e(a.depthStencilAttachment):0;if("descriptor"in a)return a.glName?e(a.descriptor):0;var c=a.internalFormat||"pixelFormat"in
a&&a.pixelFormat;if(!c)return 0;var l="hasMipmap"in a&&a.hasMipmap?1.3:1;a=a.width*a.height;return g(c)*a*l}Object.defineProperty(a,"__esModule",{value:!0});a.vertexCount=function(a,b){return a.vertexBuffers[b].size/k(a.layout[b])};a.getStride=k;a.getBytesPerElement=n;a.addDescriptor=function(a,b,l,e,d,g){var c=n(e);if(0<a.length){var v=a[0].stride,y=v+c*l;a.forEach(function(a){return a.stride=y});a.push({name:b,count:l,type:e,offset:v,stride:y,normalized:d,divisor:g})}else a.push({name:b,count:l,
type:e,offset:0,stride:c*l,normalized:d,divisor:g})};a.assertCompatibleVertexAttributeLocations=function(a,b){(a=a.locations===b.locations)||console.error("VertexAttributeLocations are incompatible");return a};a.hasAttribute=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return!0;return!1};a.findAttribute=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return a[c];return null};a.copyFramebufferToTexture=function(a,b,l,e,d){void 0===d&&(d=0);var c=a.getBoundFramebufferObject(),
g=a.getBoundTexture(0);a.bindFramebuffer(b);a.bindTexture(l,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,d,l.descriptor.pixelFormat,e[0],e[1],e[2],e[3],0);a.gl.flush();a.bindFramebuffer(c);a.bindTexture(g,0)};a.assert=function(a,b){if(!a)throw new d(b);};a.setBaseInstanceOffset=function(a,b){var c={},e;for(e in a)c[e]=a[e].map(function(a){return a.divisor?f({},a,{baseInstance:b}):a});return c};a.bindVertexBufferLayout=function(a,b,l,e,d){var c=a.gl,g=a.capabilities.instancing;a.bindBuffer(l);for(a=0;a<
e.length;a++){l=e[a];var v=b[l.name],y=(d?d:0+l.baseInstance?l.baseInstance:0)*l.stride;void 0===v&&console.error("There is no location for vertex attribute '"+l.name+"' defined.");l.baseInstance&&!l.divisor&&console.error("Vertex attribute '"+l.name+"' uses baseInstanceOffset without divisor.");if(4>=l.count)c.vertexAttribPointer(v,l.count,l.type,l.normalized,l.stride,l.offset+y),c.enableVertexAttribArray(v),l.divisor&&0<l.divisor&&g&&g.vertexAttribDivisor(v,l.divisor);else if(9===l.count)for(var k=
0;3>k;k++)c.vertexAttribPointer(v+k,3,l.type,l.normalized,l.stride,l.offset+12*k+y),c.enableVertexAttribArray(v+k),l.divisor&&0<l.divisor&&g&&g.vertexAttribDivisor(v+k,l.divisor);else if(16===l.count)for(k=0;4>k;k++)c.vertexAttribPointer(v+k,4,l.type,l.normalized,l.stride,l.offset+16*k+y),c.enableVertexAttribArray(v+k),l.divisor&&0<l.divisor&&g&&g.vertexAttribDivisor(v+k,l.divisor);else console.error("Unsupported vertex attribute element count: "+l.count)}};a.unbindVertexBufferLayout=function(a,b,
l,e){var c=a.gl,d=a.capabilities.instancing;a.bindBuffer(l);for(l=0;l<e.length;l++){var g=e[l],y=b[g.name];if(4>=g.count)c.disableVertexAttribArray(y),g.divisor&&0<g.divisor&&d&&d.vertexAttribDivisor(y,0);else if(9===g.count)for(var k=0;3>k;k++)c.disableVertexAttribArray(y+k),g.divisor&&0<g.divisor&&d&&d.vertexAttribDivisor(y+k,0);else if(16===g.count)for(k=0;4>k;k++)c.disableVertexAttribArray(y+k),g.divisor&&0<g.divisor&&d&&d.vertexAttribDivisor(y+k,0);else console.error("Unsupported vertex attribute element count: "+
g.count)}a.unbindBuffer(34962)};a.getBytesPerElementFormat=g;a.getGpuMemoryUsage=e})},"esri/views/2d/engine/webgl/Painter":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ./BitBlitRenderer ./enums ./MaterialManager ./TextureManager ./Utils ./VertexStream ./brushes/WGLBrushInfo ./brushes/WGLBrushStencil ./brushes/WGLGeometryBrushFill ./brushes/WGLGeometryBrushLabel ./brushes/WGLGeometryBrushLine ./brushes/WGLGeometryBrushMarker ./brushes/WGLGeometryBrushText ./painter/WGLHighlightPainter ./shaders/RasterPrograms ../../../webgl/FramebufferObject ../../../webgl/programUtils".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p,B,F,q,x,u,A,C,D){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._initialized=!1}a.prototype.registerPass=function(a,b){this._initialize();for(var l=0;l<c.WGLDrawPhase.NUM_DRAW_PHASES-2;l++){var e=1<<l;e&b&&this._passMap.set(e,a)}return this};a.prototype.getPaintPassTs=function(a){this._initialize();return this._passMap.has(a)?[this._passMap.get(a)]:[]};a.prototype._initialize=function(){this._initialized||(this._passMap=new Map,
this._initialized=!0)};return a}();a.PainterOptions=h;var G=new Uint8Array(4*y.C_HITTEST_SEARCH_SIZE*y.C_HITTEST_SEARCH_SIZE),H=new Uint32Array(G.buffer),I=g.vec3f32.create(),L=[0,0];g=function(){function a(a){this.context=a;this._hlPainter=new u.default;this._blitRenderer=new e;this._boundFBO=this._globalOpacityFBO=null;this.textureManager=new l;this.stencilRef=-1;this.materialManager=new b(a);this._quadVertexStream=new v(a,[0,0,1,0,0,1,1,1]);this._transformTextureProgram=D.createProgram(a,A.transformTexture);
this._transformSolidProgram=D.createProgram(a,A.transformSolid);this._transform=k.mat4f32.create()}a.prototype.dispose=function(){this.materialManager.dispose();this.textureManager.dispose();this._hlPainter&&(this._hlPainter.dispose(),this._hlPainter=null);this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._globalOpacityFBO&&(this._globalOpacityFBO.dispose(),this._globalOpacityFBO=null);this._boundFBO=null;this._hittestFBO&&(this._hittestFBO.dispose(),this._hittestFBO=
null);this._passes&&(this._passes.forEach(function(a){return a.dispose()}),this._passes.clear());this._brushes&&(this._brushes.forEach(function(a){return a.forEach(function(a){return a.dispose()})}),this._brushes.clear());this._geometryBrushes&&(this._geometryBrushes.forEach(function(a){return a.dispose()}),this._geometryBrushes.clear());this._quadVertexStream.dispose()};a.prototype.getBrushes=function(a){if(a===c.WGLDrawPhase.MAP)throw Error("Painter: Tried to get brush for the MAP phase; use a specific geometry type and call getMapBrush() instead.");
if(!this._brushes){var b=[this.getGeometryBrush(c.WGLGeometryType.FILL),this.getGeometryBrush(c.WGLGeometryType.LINE),this.getGeometryBrush(c.WGLGeometryType.MARKER),this.getGeometryBrush(c.WGLGeometryType.TEXT)],l=new B.default,e=new z.default,g=new w.default;this._brushes=new Map;this._brushes.set(c.WGLDrawPhase.LABEL,[l]);this._brushes.set(c.WGLDrawPhase.LABEL_ALPHA,[l]);this._brushes.set(c.WGLDrawPhase.HITTEST,b);this._brushes.set(c.WGLDrawPhase.HIGHLIGHT,b);this._brushes.set(c.WGLDrawPhase.CLIP,
[g]);this._brushes.set(c.WGLDrawPhase.DEBUG,[e])}if(!this._brushes.has(a))throw Error("Painter: Tried to get brush for unknown phase: "+a);return this._brushes.get(a)};a.prototype.getGeometryBrush=function(a){if(!this._geometryBrushes){var b=new p.default,l=new F.default,e=new q.default,g=new x.default,d=new B.default;this._geometryBrushes=new Map;this._geometryBrushes.set(c.WGLGeometryType.FILL,b);this._geometryBrushes.set(c.WGLGeometryType.LINE,l);this._geometryBrushes.set(c.WGLGeometryType.MARKER,
e);this._geometryBrushes.set(c.WGLGeometryType.TEXT,g);this._geometryBrushes.set(c.WGLGeometryType.LABEL,d)}return this._geometryBrushes.get(a)};a.prototype.draw=function(a,b,l,e){this._setGlobalOpacity(a,l);0===(l&(c.WGLDrawPhase.LABEL_ALPHA|c.WGLDrawPhase.LABEL))&&this._drawClippingRects(a,b);var g=this.context;g.setBlendingEnabled(!0);g.setStencilWriteMask(0);g.setBlendFunctionSeparate(1,771,1,771);this._drawPhases(a,b,l,e);this._applyGlobalOpacity(a,l);this._debugTiles(a,b)};a.prototype.highlight=
function(a,b){var l=this.context,e=l.getViewport();this._hlPainter.setup(l,e.width,e.height);this._hlPainter.startMaskDraw(l);this._drawClippingRects(a,b);l.setBlendingEnabled(!0);l.setStencilWriteMask(0);l.setBlendFunctionSeparate(1,771,1,771);this._drawPhases(a,b,c.WGLDrawPhase.HIGHLIGHT);this._hlPainter.draw(l)};a.prototype.setHighlightOptions=function(a){this._hlPainter.setHighlightOptions(a)};a.prototype.hitTest=function(a,b){var l=this.context,e=y.C_HITTEST_SEARCH_SIZE,g=[0,0],d=[0,0],v=a.state;
v.toMap(g,[0,0]);v.toMap(d,[e,e]);if(0===b.filter(function(a){return!(g[0]>a.bounds[2]||d[0]<a.bounds[0]||g[1]<a.bounds[1]||d[1]>a.bounds[3])}).length)return[];this._hittestFBO||(this._hittestFBO=C.create(l,{colorTarget:0,depthStencilTarget:3,width:e,height:e}));var v=l.getViewport(),z=l.getBoundFramebufferObject();l.bindFramebuffer(this._hittestFBO);l.setViewport(0,0,e,e);this._drawClippingRects(a,b);var p=l.gl;l.setClearColor(1,1,1,1);l.clear(p.COLOR_BUFFER_BIT);l.setBlendingEnabled(!1);l.setStencilWriteMask(0);
this._drawPhases(a,b,c.WGLDrawPhase.HITTEST);l.setBlendingEnabled(!0);this._hittestFBO.readPixels(0,0,e,e,6408,5121,G);a=e*e;b=new Set;for(e=0;e<a;e++)p=H[e],4294967295!==p&&b.add(p);l.bindFramebuffer(z);l.setViewport(v.x,v.y,v.width,v.height);var k=[];b.forEach(function(a){k.push(a)});return k};a.prototype.startStencilBurn=function(){this.context.setStencilTestEnabled(!0);this.context.setStencilWriteMask(255);this.context.setClearStencil(0);this.context.clear(this.context.gl.STENCIL_BUFFER_BIT);
this.context.setStencilOp(7680,7680,7681);this.context.setColorMask(!1,!1,!1,!1);this.context.setBlendingEnabled(!1);this._quadVertexStream.bind();this.context.bindProgram(this._transformSolidProgram)};a.prototype.startStencilDraw=function(){this.context.setStencilWriteMask(0);this.context.setStencilOp(7680,7680,7680);this.context.setColorMask(!0,!0,!0,!0);this.context.setBlendingEnabled(!0);this.context.setBlendFunction(1,771);this._quadVertexStream.bind();this.context.bindProgram(this._transformTextureProgram)};
a.prototype.endStencilDraw=function(){this.context.setStencilTestEnabled(!1);this._quadVertexStream.unbind();this.context.bindProgram()};a.prototype.drawBitmap=function(a,b,l){var e=this.context,g=a.state,v=-Math.PI*g.rotation/180,y=-Math.PI*b.rotation/180;!(v+b.rotation)&&1.05>l&&.95<l?b.setSamplingMode(9728):b.setSamplingMode(9729);var z=g.toScreen(L,b.x,b.y),g=z[0],z=z[1],p=a.state.size[0],k=a.state.size[1],q=l*b.width;l*=b.height;var f=a.globalOpacity*b.opacity,m=this._transform,w=this._quadVertexStream;
a=a.drawPhase;a===c.WGLDrawPhase.CLIP?(e.setStencilFunction(519,this.stencilRef,255),e=this._transformSolidProgram):(e.setStencilFunction(514,this.stencilRef,255),e=this._transformTextureProgram);d.mat4.identity(m);d.mat4.scale(m,m,n.vec3.set(I,2/p,2/k,1));d.mat4.translate(m,m,n.vec3.set(I,g-p/2,-z+k/2,0));d.mat4.rotateZ(m,m,v);d.mat4.translate(m,m,n.vec3.set(I,q/2,-l/2,0));d.mat4.rotateZ(m,m,-y);d.mat4.scale(m,m,n.vec3.set(I,q/2,l/2,1));e.setUniformMatrix4fv("u_transform",m);a!==c.WGLDrawPhase.CLIP&&
(b.bind(0),e.setUniform1i("u_texture",0));e.setUniform1f("u_opacity",f);w.draw()};a.prototype._getPaintPass=function(a){this._passes||(this._passes=new Map);if(!this._passes.has(a))try{this._passes.set(a,new a)}catch(M){throw Error("Tried to instantiate WGLPaintPass with unknown constructor: "+a+",\n"+M);}return this._passes.get(a)};a.prototype._getPaintPasses=function(a,c){var b=this;return c.getPaintPassTs(a).map(function(a){return b._getPaintPass(a)})};a.prototype._drawPhases=function(a,b,l,e){var g=
this.context;g.setStencilTestEnabled(!0);for(var d=0;d<c.WGLDrawPhase.NUM_DRAW_PHASES-2;d++){var v=1<<d;if(v&l){var y=e?this._getPaintPasses(v,e):[],v=f({},a,{drawPhase:v});y.forEach(function(c){return c.preRender(a,a.rendererInfo)});for(var z=0,p=b;z<p.length;z++)p[z].doRender(v);y.reverse().forEach(function(c){return c.postRender(a,a.rendererInfo)})}}g.setStencilTestEnabled(!1)};a.prototype._debugTiles=function(a,c){};a.prototype._drawClippingRects=function(a,b){if(0!==b.length){var l=this.context;
l.setDepthWriteEnabled(!1);l.setDepthTestEnabled(!1);l.setStencilTestEnabled(!0);l.setBlendingEnabled(!1);l.setColorMask(!1,!1,!1,!1);l.setStencilOp(7680,7680,7681);l.setClearStencil(0);l.clear(l.gl.STENCIL_BUFFER_BIT);l.setStencilWriteMask(255);for(var e=0,g=b.length;e<b.length;e++,g--){var d=b[e];d.attached&&(d.stencilRef=g)}this._drawPhases(a,b,c.WGLDrawPhase.CLIP);l.setColorMask(!0,!0,!0,!0)}};a.prototype._setGlobalOpacity=function(a,b){if(b===c.WGLDrawPhase.MAP&&1!==a.globalOpacity){b=a.context;
var l=a.pixelRatio,e=a.state.size;a=Math.round(e[0]*l);l=Math.round(e[1]*l);if(null===this._globalOpacityFBO||this._globalOpacityFBO.width!==a||this._globalOpacityFBO.height!==l)null!==this._globalOpacityFBO&&this._globalOpacityFBO.dispose(),this._globalOpacityFBO=C.create(b,{colorTarget:0,depthStencilTarget:3,width:a,height:l});this._boundFBO=b.getBoundFramebufferObject();b.bindFramebuffer(this._globalOpacityFBO);b.setDepthWriteEnabled(!0);b.setStencilWriteMask(255);b.setClearColor(0,0,0,0);b.setClearDepth(1);
b.setClearStencil(0);b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT|b.gl.STENCIL_BUFFER_BIT);b.setDepthWriteEnabled(!1)}};a.prototype._applyGlobalOpacity=function(a,b){b===c.WGLDrawPhase.MAP&&1!==a.globalOpacity&&(b=a.context,b.bindFramebuffer(this._boundFBO),this._blitRenderer.render(b,this._globalOpacityFBO.colorTexture,9728,a.globalOpacity),this._boundFBO=null)};return a}();a.default=g})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require","exports","./math/mat4"],function(h,a,
f){Object.defineProperty(a,"__esModule",{value:!0});a.mat4=f})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(h,a,f,m){function d(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function k(a,b,l){var c=b[0],e=b[1],g=b[2],d=b[3],p=b[4],k=b[5],f=b[6],q=b[7],n=b[8],m=b[9],h=b[10],C=b[11],D=b[12],G=b[13],H=b[14];b=b[15];var I=l[0],L=l[1],J=l[2],
K=l[3];a[0]=I*c+L*p+J*n+K*D;a[1]=I*e+L*k+J*m+K*G;a[2]=I*g+L*f+J*h+K*H;a[3]=I*d+L*q+J*C+K*b;I=l[4];L=l[5];J=l[6];K=l[7];a[4]=I*c+L*p+J*n+K*D;a[5]=I*e+L*k+J*m+K*G;a[6]=I*g+L*f+J*h+K*H;a[7]=I*d+L*q+J*C+K*b;I=l[8];L=l[9];J=l[10];K=l[11];a[8]=I*c+L*p+J*n+K*D;a[9]=I*e+L*k+J*m+K*G;a[10]=I*g+L*f+J*h+K*H;a[11]=I*d+L*q+J*C+K*b;I=l[12];L=l[13];J=l[14];K=l[15];a[12]=I*c+L*p+J*n+K*D;a[13]=I*e+L*k+J*m+K*G;a[14]=I*g+L*f+J*h+K*H;a[15]=I*d+L*q+J*C+K*b;return a}function n(a,b,l){var c=b[0],e=b[1],g=b[2],d=b[3],p=c+
c,k=e+e,f=g+g;b=c*p;var q=c*k,c=c*f,n=e*k,e=e*f,g=g*f,p=d*p,k=d*k,d=d*f;a[0]=1-(n+g);a[1]=q+d;a[2]=c-k;a[3]=0;a[4]=q-d;a[5]=1-(b+g);a[6]=e+p;a[7]=0;a[8]=c+k;a[9]=e-p;a[10]=1-(b+n);a[11]=0;a[12]=l[0];a[13]=l[1];a[14]=l[2];a[15]=1;return a}function g(a,b,l){a[0]=b[0]-l[0];a[1]=b[1]-l[1];a[2]=b[2]-l[2];a[3]=b[3]-l[3];a[4]=b[4]-l[4];a[5]=b[5]-l[5];a[6]=b[6]-l[6];a[7]=b[7]-l[7];a[8]=b[8]-l[8];a[9]=b[9]-l[9];a[10]=b[10]-l[10];a[11]=b[11]-l[11];a[12]=b[12]-l[12];a[13]=b[13]-l[13];a[14]=b[14]-l[14];a[15]=
b[15]-l[15];return a}Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};a.set=function(a,b,l,e,g,d,k,p,f,n,q,m,u,h,C,D,G){a[0]=b;a[1]=l;a[2]=e;a[3]=g;a[4]=d;a[5]=k;a[6]=p;a[7]=f;a[8]=n;a[9]=q;a[10]=m;a[11]=u;a[12]=h;a[13]=C;a[14]=D;a[15]=G;return a};a.identity=d;a.transpose=function(a,b){if(a===b){var c=
b[1],e=b[2],g=b[3],d=b[6],k=b[7],p=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=e;a[9]=d;a[11]=b[14];a[12]=g;a[13]=k;a[14]=p}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};a.invert=function(a,b){var c=b[0],e=b[1],g=b[2],d=b[3],k=b[4],p=b[5],f=b[6],n=b[7],q=b[8],m=b[9],u=b[10],h=b[11],C=b[12],D=b[13],G=b[14];b=b[15];var H=c*p-e*k,I=c*f-
g*k,L=c*n-d*k,J=e*f-g*p,K=e*n-d*p,M=g*n-d*f,P=q*D-m*C,N=q*G-u*C,T=q*b-h*C,U=m*G-u*D,S=m*b-h*D,V=u*b-h*G,R=H*V-I*S+L*U+J*T-K*N+M*P;if(!R)return null;R=1/R;a[0]=(p*V-f*S+n*U)*R;a[1]=(g*S-e*V-d*U)*R;a[2]=(D*M-G*K+b*J)*R;a[3]=(u*K-m*M-h*J)*R;a[4]=(f*T-k*V-n*N)*R;a[5]=(c*V-g*T+d*N)*R;a[6]=(G*L-C*M-b*I)*R;a[7]=(q*M-u*L+h*I)*R;a[8]=(k*S-p*T+n*P)*R;a[9]=(e*T-c*S-d*P)*R;a[10]=(C*K-D*L+b*H)*R;a[11]=(m*L-q*K-h*H)*R;a[12]=(p*N-k*U-f*P)*R;a[13]=(c*U-e*N+g*P)*R;a[14]=(D*I-C*J-G*H)*R;a[15]=(q*J-m*I+u*H)*R;return a};
a.adjoint=function(a,b){var c=b[0],e=b[1],g=b[2],d=b[3],k=b[4],p=b[5],f=b[6],n=b[7],q=b[8],m=b[9],u=b[10],h=b[11],C=b[12],D=b[13],G=b[14];b=b[15];a[0]=p*(u*b-h*G)-m*(f*b-n*G)+D*(f*h-n*u);a[1]=-(e*(u*b-h*G)-m*(g*b-d*G)+D*(g*h-d*u));a[2]=e*(f*b-n*G)-p*(g*b-d*G)+D*(g*n-d*f);a[3]=-(e*(f*h-n*u)-p*(g*h-d*u)+m*(g*n-d*f));a[4]=-(k*(u*b-h*G)-q*(f*b-n*G)+C*(f*h-n*u));a[5]=c*(u*b-h*G)-q*(g*b-d*G)+C*(g*h-d*u);a[6]=-(c*(f*b-n*G)-k*(g*b-d*G)+C*(g*n-d*f));a[7]=c*(f*h-n*u)-k*(g*h-d*u)+q*(g*n-d*f);a[8]=k*(m*b-h*D)-
q*(p*b-n*D)+C*(p*h-n*m);a[9]=-(c*(m*b-h*D)-q*(e*b-d*D)+C*(e*h-d*m));a[10]=c*(p*b-n*D)-k*(e*b-d*D)+C*(e*n-d*p);a[11]=-(c*(p*h-n*m)-k*(e*h-d*m)+q*(e*n-d*p));a[12]=-(k*(m*G-u*D)-q*(p*G-f*D)+C*(p*u-f*m));a[13]=c*(m*G-u*D)-q*(e*G-g*D)+C*(e*u-g*m);a[14]=-(c*(p*G-f*D)-k*(e*G-g*D)+C*(e*f-g*p));a[15]=c*(p*u-f*m)-k*(e*u-g*m)+q*(e*f-g*p);return a};a.determinant=function(a){var c=a[0],l=a[1],e=a[2],g=a[3],d=a[4],k=a[5],p=a[6],f=a[7],n=a[8],q=a[9],m=a[10],u=a[11],h=a[12],C=a[13],D=a[14];a=a[15];return(c*k-l*d)*
(m*a-u*D)-(c*p-e*d)*(q*a-u*C)+(c*f-g*d)*(q*D-m*C)+(l*p-e*k)*(n*a-u*h)-(l*f-g*k)*(n*D-m*h)+(e*f-g*p)*(n*C-q*h)};a.multiply=k;a.translate=function(a,b,l){var c=l[0],e=l[1];l=l[2];var g=void 0,d=void 0,k=void 0,f=void 0,n=void 0,q=void 0,m=void 0,u=void 0,h=void 0,C=void 0,D=void 0,G=void 0;b===a?(a[12]=b[0]*c+b[4]*e+b[8]*l+b[12],a[13]=b[1]*c+b[5]*e+b[9]*l+b[13],a[14]=b[2]*c+b[6]*e+b[10]*l+b[14],a[15]=b[3]*c+b[7]*e+b[11]*l+b[15]):(g=b[0],d=b[1],k=b[2],f=b[3],n=b[4],q=b[5],m=b[6],u=b[7],h=b[8],C=b[9],
D=b[10],G=b[11],a[0]=g,a[1]=d,a[2]=k,a[3]=f,a[4]=n,a[5]=q,a[6]=m,a[7]=u,a[8]=h,a[9]=C,a[10]=D,a[11]=G,a[12]=g*c+n*e+h*l+b[12],a[13]=d*c+q*e+C*l+b[13],a[14]=k*c+m*e+D*l+b[14],a[15]=f*c+u*e+G*l+b[15]);return a};a.scale=function(a,b,l){var c=l[0],e=l[1];l=l[2];a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*l;a[9]=b[9]*l;a[10]=b[10]*l;a[11]=b[11]*l;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};a.rotate=function(a,b,l,e){var c=e[0],
g=e[1];e=e[2];var d=Math.sqrt(c*c+g*g+e*e),k=void 0,y=void 0,f=void 0,q=void 0,n=void 0,h=void 0,A=void 0,C=void 0,D=void 0,G=void 0,H=void 0,I=void 0,L=void 0,J=void 0,K=void 0,M=void 0,P=void 0,N=void 0,T=void 0,U=void 0,S=void 0,V=void 0,y=k=void 0;if(d<m.EPSILON)return null;d=1/d;c*=d;g*=d;e*=d;k=Math.sin(l);y=Math.cos(l);f=1-y;q=b[0];n=b[1];h=b[2];A=b[3];C=b[4];D=b[5];G=b[6];H=b[7];I=b[8];L=b[9];J=b[10];K=b[11];M=c*c*f+y;P=g*c*f+e*k;N=e*c*f-g*k;T=c*g*f-e*k;U=g*g*f+y;S=e*g*f+c*k;V=c*e*f+g*k;k=
g*e*f-c*k;y=e*e*f+y;a[0]=q*M+C*P+I*N;a[1]=n*M+D*P+L*N;a[2]=h*M+G*P+J*N;a[3]=A*M+H*P+K*N;a[4]=q*T+C*U+I*S;a[5]=n*T+D*U+L*S;a[6]=h*T+G*U+J*S;a[7]=A*T+H*U+K*S;a[8]=q*V+C*k+I*y;a[9]=n*V+D*k+L*y;a[10]=h*V+G*k+J*y;a[11]=A*V+H*k+K*y;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};a.rotateX=function(a,b,l){var c=Math.sin(l);l=Math.cos(l);var e=b[4],g=b[5],d=b[6],k=b[7],f=b[8],n=b[9],q=b[10],m=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=
b[15]);a[4]=e*l+f*c;a[5]=g*l+n*c;a[6]=d*l+q*c;a[7]=k*l+m*c;a[8]=f*l-e*c;a[9]=n*l-g*c;a[10]=q*l-d*c;a[11]=m*l-k*c;return a};a.rotateY=function(a,b,l){var c=Math.sin(l);l=Math.cos(l);var e=b[0],g=b[1],d=b[2],k=b[3],f=b[8],n=b[9],q=b[10],m=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*l-f*c;a[1]=g*l-n*c;a[2]=d*l-q*c;a[3]=k*l-m*c;a[8]=e*c+f*l;a[9]=g*c+n*l;a[10]=d*c+q*l;a[11]=k*c+m*l;return a};a.rotateZ=function(a,b,l){var c=Math.sin(l);l=
Math.cos(l);var e=b[0],g=b[1],d=b[2],k=b[3],f=b[4],n=b[5],q=b[6],m=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*l+f*c;a[1]=g*l+n*c;a[2]=d*l+q*c;a[3]=k*l+m*c;a[4]=f*l-e*c;a[5]=n*l-g*c;a[6]=q*l-d*c;a[7]=m*l-k*c;return a};a.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};a.fromScaling=function(a,b){a[0]=b[0];a[1]=0;
a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromRotation=function(a,b,l){var c=l[0],e=l[1];l=l[2];var g=Math.sqrt(c*c+e*e+l*l),d=void 0,k=void 0,f=void 0;if(g<m.EPSILON)return null;g=1/g;c*=g;e*=g;l*=g;d=Math.sin(b);k=Math.cos(b);f=1-k;a[0]=c*c*f+k;a[1]=e*c*f+l*d;a[2]=l*c*f-e*d;a[3]=0;a[4]=c*e*f-l*d;a[5]=e*e*f+k;a[6]=l*e*f+c*d;a[7]=0;a[8]=c*l*f+e*d;a[9]=e*l*f-c*d;a[10]=l*l*f+k;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};
a.fromXRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=c;a[7]=0;a[8]=0;a[9]=-c;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-c;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=c;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=0;a[4]=-c;a[5]=b;a[6]=0;a[7]=0;
a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromRotationTranslation=n;a.fromQuat2=function(a,b){var c=e,g=-b[0],d=-b[1],k=-b[2],f=b[3],p=b[4],m=b[5],h=b[6],q=b[7],x=g*g+d*d+k*k+f*f;0<x?(c[0]=2*(p*f+q*g+m*k-h*d)/x,c[1]=2*(m*f+q*d+h*g-p*k)/x,c[2]=2*(h*f+q*k+p*d-m*g)/x):(c[0]=2*(p*f+q*g+m*k-h*d),c[1]=2*(m*f+q*d+h*g-p*k),c[2]=2*(h*f+q*k+p*d-m*g));n(a,b,c);return a};var e=f.create();a.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};a.getScaling=function(a,
b){var c=b[0],e=b[1],g=b[2],d=b[4],k=b[5],f=b[6],n=b[8],m=b[9];b=b[10];a[0]=Math.sqrt(c*c+e*e+g*g);a[1]=Math.sqrt(d*d+k*k+f*f);a[2]=Math.sqrt(n*n+m*m+b*b);return a};a.getRotation=function(a,b){var c=b[0]+b[5]+b[10],e=0;0<c?(e=2*Math.sqrt(c+1),a[3]=.25*e,a[0]=(b[6]-b[9])/e,a[1]=(b[8]-b[2])/e,a[2]=(b[1]-b[4])/e):b[0]>b[5]&&b[0]>b[10]?(e=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/e,a[0]=.25*e,a[1]=(b[1]+b[4])/e,a[2]=(b[8]+b[2])/e):b[5]>b[10]?(e=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/e,
a[0]=(b[1]+b[4])/e,a[1]=.25*e,a[2]=(b[6]+b[9])/e):(e=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/e,a[0]=(b[8]+b[2])/e,a[1]=(b[6]+b[9])/e,a[2]=.25*e);return a};a.fromRotationTranslationScale=function(a,b,e,g){var c=b[0],l=b[1],d=b[2],k=b[3],f=c+c,n=l+l,q=d+d;b=c*f;var y=c*n,c=c*q,m=l*n,l=l*q,d=d*q,f=k*f,n=k*n,k=k*q,q=g[0],h=g[1];g=g[2];a[0]=(1-(m+d))*q;a[1]=(y+k)*q;a[2]=(c-n)*q;a[3]=0;a[4]=(y-k)*h;a[5]=(1-(b+d))*h;a[6]=(l+f)*h;a[7]=0;a[8]=(c+n)*g;a[9]=(l-f)*g;a[10]=(1-(b+m))*g;a[11]=0;a[12]=e[0];
a[13]=e[1];a[14]=e[2];a[15]=1;return a};a.fromRotationTranslationScaleOrigin=function(a,b,e,g,d){var c=b[0],l=b[1],k=b[2],f=b[3],v=c+c,q=l+l,n=k+k;b=c*v;var m=c*q,y=c*n,c=l*q,l=l*n,h=k*n,k=f*v,q=f*q,D=f*n,G=g[0],H=g[1],n=g[2];g=d[0];f=d[1];d=d[2];var v=(1-(c+h))*G,I=(m+D)*G,G=(y-q)*G,m=(m-D)*H,h=(1-(b+h))*H,H=(l+k)*H,y=(y+q)*n,l=(l-k)*n;b=(1-(b+c))*n;a[0]=v;a[1]=I;a[2]=G;a[3]=0;a[4]=m;a[5]=h;a[6]=H;a[7]=0;a[8]=y;a[9]=l;a[10]=b;a[11]=0;a[12]=e[0]+g-(v*g+m*f+y*d);a[13]=e[1]+f-(I*g+h*f+l*d);a[14]=e[2]+
d-(G*g+H*f+b*d);a[15]=1;return a};a.fromQuat=function(a,b){var c=b[0],e=b[1],g=b[2];b=b[3];var d=c+c,k=e+e,f=g+g,c=c*d,n=e*d,e=e*k,m=g*d,q=g*k,g=g*f,d=b*d,k=b*k;b*=f;a[0]=1-e-g;a[1]=n+b;a[2]=m-k;a[3]=0;a[4]=n-b;a[5]=1-c-g;a[6]=q+d;a[7]=0;a[8]=m+k;a[9]=q-d;a[10]=1-c-e;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.frustum=function(a,b,e,g,d,k,f){var c=1/(e-b),l=1/(d-g),v=1/(k-f);a[0]=2*k*c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*k*l;a[6]=0;a[7]=0;a[8]=(e+b)*c;a[9]=(d+g)*l;a[10]=(f+k)*v;a[11]=-1;a[12]=
0;a[13]=0;a[14]=f*k*2*v;a[15]=0;return a};a.perspective=function(a,b,e,g,d){b=1/Math.tan(b/2);var c=void 0;a[0]=b/e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=d&&Infinity!==d?(c=1/(g-d),a[10]=(d+g)*c,a[14]=2*d*g*c):(a[10]=-1,a[14]=-2*g);return a};a.perspectiveFromFieldOfView=function(a,b,e,g){var c=Math.tan(b.upDegrees*Math.PI/180),l=Math.tan(b.downDegrees*Math.PI/180),d=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/
180);var k=2/(d+b),f=2/(c+l);a[0]=k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=f;a[6]=0;a[7]=0;a[8]=-((d-b)*k*.5);a[9]=(c-l)*f*.5;a[10]=g/(e-g);a[11]=-1;a[12]=0;a[13]=0;a[14]=g*e/(e-g);a[15]=0;return a};a.ortho=function(a,b,e,g,d,k,f){var c=1/(b-e),l=1/(g-d),v=1/(k-f);a[0]=-2*c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*l;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*v;a[11]=0;a[12]=(b+e)*c;a[13]=(d+g)*l;a[14]=(f+k)*v;a[15]=1;return a};a.lookAt=function(a,b,e,g){var c=void 0,l=void 0,k=void 0,f=void 0,n=void 0,y=void 0,q=void 0,
h=void 0,u=void 0,A=void 0,C=b[0],D=b[1];b=b[2];k=g[0];f=g[1];g=g[2];q=e[0];h=e[1];e=e[2];if(Math.abs(C-q)<m.EPSILON&&Math.abs(D-h)<m.EPSILON&&Math.abs(b-e)<m.EPSILON)return d(a);q=C-q;h=D-h;u=b-e;A=1/Math.sqrt(q*q+h*h+u*u);q*=A;h*=A;u*=A;c=f*u-g*h;l=g*q-k*u;k=k*h-f*q;(A=Math.sqrt(c*c+l*l+k*k))?(A=1/A,c*=A,l*=A,k*=A):k=l=c=0;f=h*k-u*l;n=u*c-q*k;y=q*l-h*c;(A=Math.sqrt(f*f+n*n+y*y))?(A=1/A,f*=A,n*=A,y*=A):y=n=f=0;a[0]=c;a[1]=f;a[2]=q;a[3]=0;a[4]=l;a[5]=n;a[6]=h;a[7]=0;a[8]=k;a[9]=y;a[10]=u;a[11]=0;
a[12]=-(c*C+l*D+k*b);a[13]=-(f*C+n*D+y*b);a[14]=-(q*C+h*D+u*b);a[15]=1;return a};a.targetTo=function(a,b,e,g){var c=b[0],l=b[1];b=b[2];var d=g[0],k=g[1],f=g[2];g=c-e[0];var n=l-e[1];e=b-e[2];var q=g*g+n*n+e*e;0<q&&(q=1/Math.sqrt(q),g*=q,n*=q,e*=q);var m=k*e-f*n,f=f*g-d*e,d=d*n-k*g,q=m*m+f*f+d*d;0<q&&(q=1/Math.sqrt(q),m*=q,f*=q,d*=q);a[0]=m;a[1]=f;a[2]=d;a[3]=0;a[4]=n*d-e*f;a[5]=e*m-g*d;a[6]=g*f-n*m;a[7]=0;a[8]=g;a[9]=n;a[10]=e;a[11]=0;a[12]=c;a[13]=l;a[14]=b;a[15]=1;return a};a.str=function(a){return"mat4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};a.add=function(a,b,
e){a[0]=b[0]+e[0];a[1]=b[1]+e[1];a[2]=b[2]+e[2];a[3]=b[3]+e[3];a[4]=b[4]+e[4];a[5]=b[5]+e[5];a[6]=b[6]+e[6];a[7]=b[7]+e[7];a[8]=b[8]+e[8];a[9]=b[9]+e[9];a[10]=b[10]+e[10];a[11]=b[11]+e[11];a[12]=b[12]+e[12];a[13]=b[13]+e[13];a[14]=b[14]+e[14];a[15]=b[15]+e[15];return a};a.subtract=g;a.multiplyScalar=function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*e;a[9]=b[9]*e;a[10]=b[10]*e;a[11]=b[11]*e;a[12]=b[12]*e;a[13]=b[13]*e;a[14]=b[14]*
e;a[15]=b[15]*e;return a};a.multiplyScalarAndAdd=function(a,b,e,g){a[0]=b[0]+e[0]*g;a[1]=b[1]+e[1]*g;a[2]=b[2]+e[2]*g;a[3]=b[3]+e[3]*g;a[4]=b[4]+e[4]*g;a[5]=b[5]+e[5]*g;a[6]=b[6]+e[6]*g;a[7]=b[7]+e[7]*g;a[8]=b[8]+e[8]*g;a[9]=b[9]+e[9]*g;a[10]=b[10]+e[10]*g;a[11]=b[11]+e[11]*g;a[12]=b[12]+e[12]*g;a[13]=b[13]+e[13]*g;a[14]=b[14]+e[14]*g;a[15]=b[15]+e[15]*g;return a};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&
a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};a.equals=function(a,b){var e=a[0],c=a[1],g=a[2],d=a[3],k=a[4],f=a[5],n=a[6],h=a[7],q=a[8],x=a[9],u=a[10],A=a[11],C=a[12],D=a[13],G=a[14];a=a[15];var H=b[0],I=b[1],L=b[2],J=b[3],K=b[4],M=b[5],P=b[6],N=b[7],T=b[8],U=b[9],S=b[10],V=b[11],R=b[12],ea=b[13],da=b[14];b=b[15];return Math.abs(e-H)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(H))&&Math.abs(c-I)<=m.EPSILON*Math.max(1,Math.abs(c),
Math.abs(I))&&Math.abs(g-L)<=m.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(d-J)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(J))&&Math.abs(k-K)<=m.EPSILON*Math.max(1,Math.abs(k),Math.abs(K))&&Math.abs(f-M)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(n-P)<=m.EPSILON*Math.max(1,Math.abs(n),Math.abs(P))&&Math.abs(h-N)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(q-T)<=m.EPSILON*Math.max(1,Math.abs(q),Math.abs(T))&&Math.abs(x-U)<=m.EPSILON*Math.max(1,Math.abs(x),Math.abs(U))&&
Math.abs(u-S)<=m.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(A-V)<=m.EPSILON*Math.max(1,Math.abs(A),Math.abs(V))&&Math.abs(C-R)<=m.EPSILON*Math.max(1,Math.abs(C),Math.abs(R))&&Math.abs(D-ea)<=m.EPSILON*Math.max(1,Math.abs(D),Math.abs(ea))&&Math.abs(G-da)<=m.EPSILON*Math.max(1,Math.abs(G),Math.abs(da))&&Math.abs(a-b)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.mul=k;a.sub=g})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["require","exports","./factories/mat4f32"],function(h,
a,f){Object.defineProperty(a,"__esModule",{value:!0});a.mat4f32=f})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new Float32Array(16);a[0]=1;a[5]=1;a[10]=1;a[15]=1;return a};a.clone=function(a){var f=new Float32Array(16);f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];f[4]=a[4];f[5]=a[5];f[6]=a[6];f[7]=a[7];f[8]=a[8];f[9]=a[9];f[10]=a[10];f[11]=a[11];f[12]=a[12];f[13]=a[13];
f[14]=a[14];f[15]=a[15];return f};a.fromValues=function(a,m,d,k,n,g,e,c,b,l,y,v,z,w,p,h){var f=new Float32Array(16);f[0]=a;f[1]=m;f[2]=d;f[3]=k;f[4]=n;f[5]=g;f[6]=e;f[7]=c;f[8]=b;f[9]=l;f[10]=y;f[11]=v;f[12]=z;f[13]=w;f[14]=p;f[15]=h;return f};a.createView=function(a,m){return new Float32Array(a,m,16)}})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["require","exports","./factories/vec3f32"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.vec3f32=f})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["require",
"exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return new Float32Array(3)};a.clone=function(a){var f=new Float32Array(3);f[0]=a[0];f[1]=a[1];f[2]=a[2];return f};a.fromValues=function(a,m,d){var k=new Float32Array(3);k[0]=a;k[1]=m;k[2]=d;return k};a.createView=function(a,m){return new Float32Array(a,m,3)}})},"esri/views/2d/engine/webgl/MaterialManager":function(){define("require exports ../../../../core/tsSupport/assignHelper @dojo/framework/shim/Map ./enums ./shaders/MaterialPrograms ../../../webgl/programUtils".split(" "),
function(h,a,f,m,d,k,n){return function(){function a(a){this._programByKey=new m.default;this._programCache=new n.ProgramCache(a)}a.prototype.dispose=function(){this._programCache&&this._programCache.dispose()};a.prototype.getProgram=function(a,c,b,g,n){var e;e=a.getVariationHash()+"-"+((c===d.WGLDrawPhase.HITTEST||c===d.WGLDrawPhase.LABEL_ALPHA?1:0)|(c===d.WGLDrawPhase.HIGHLIGHT?2:0))+"-"+b.getVariationHash();if(this._programByKey.has(e))return this._programByKey.get(e);a=f({},a.getVariation(),b.getVariation(),
{highlight:c===d.WGLDrawPhase.HIGHLIGHT,id:c===d.WGLDrawPhase.HITTEST||c===d.WGLDrawPhase.LABEL_ALPHA});g=this._programCache.getProgram(k.createProgramTemplate(g,n),a);if(!g)throw Error("Unable to get program for key: ${key}");this._programByKey.set(e,g);return g};return a}()})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["require","exports","./sources/resolver","../../../../webgl/programUtils"],function(h,a,f,m){Object.defineProperty(a,"__esModule",{value:!0});var d=
function(a){var d={},g;for(g in a){for(var e=g,c=void 0,c=""+e[0].toUpperCase(),b=1;b<e.length;b++){var l=e[b];l===l.toUpperCase()?(c+="_",c+=l):c+=l.toUpperCase()}d[c]=a[g]}return m.glslifyDefineMap(d)};a.createProgramTemplate=function(a,n){return{name:a,attributes:n,shaders:function(g){return{vertexShader:d(g)+f.resolveIncludes("materials/"+a+"/"+a+".vert"),fragmentShader:d(g)+f.resolveIncludes("materials/"+a+"/"+a+".frag")}}}}})},"esri/views/2d/engine/webgl/TextureManager":function(){define("require exports ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../config ../../../../core/asyncUtils ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ./CIMSymbolHelper ./definitions ./enums ./fontUtils ./GlyphMosaic ./GlyphSource ./SDFConverter ./SDFHelper ./SpriteMosaic ./Utils ./util/Result ../../../3d/support/imageUtils".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p,B,F,q,x,u,A){function C(a){if(a.type){switch(x.normalizeSymbolType(a.type)){case "simple-marker":return a.path?"simple-marker"+a.style+a.path:"simple-marker"+a.style;case "simple-line":return"simple-line"+a.style+a.cap;case "simple-fill":return"simple-fill"+a.style}if(x.isPictureSymbol(a))return a.imageData?a.imageData:a.url+(""+a.width+a.height)}return JSON.stringify(a)}var D=b.vec2f32.create(),G=g.getLogger("esri.views.2d.engine.webgl.TextureManager"),
H=function(){function a(a,b,c){this.mosaicType=a;this.page=b;this.sdf=c}a.fromMosaic=function(b,c){return new a(b,c.page,c.sdf)};return a}();return function(){function a(){this._invalidFontsMap=new Map;this._sdfConverter=new B.default(126);this._bindingInfos=[];this._hashToBindingIndex=new Map;this._spriteMosaic=new q(1024,1024,300);this._glyphSource=new p(d.fontsUrl+"/{fontstack}/{range}.pbf");this._glyphMosaic=new w(1024,1024,this._glyphSource)}Object.defineProperty(a.prototype,"sprites",{get:function(){return this._spriteMosaic},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glyphs",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();this._rasterizationCanvas=this._glyphMosaic=this._spriteMosaic=null};a.prototype._hashMosaic=function(a,b){return 1|a<<1|(b.sdf?1:0)<<2|b.page<<3};a.prototype._setTextureBinding=function(a,b){var c=this._hashMosaic(a,b);this._hashToBindingIndex.has(c)||(a=H.fromMosaic(a,
b),this._hashToBindingIndex.set(c,this._bindingInfos.length+1),this._bindingInfos.push(a));b.textureBinding=this._hashToBindingIndex.get(c)};a.prototype.rasterizeItem=function(a,b){var c=this;void 0===b&&(b=null);return a?a.type&&-1!==a.type.toLowerCase().indexOf("3d")?(G.error(new n("mapview-invalid-type","MapView does not support 3d symbol type: "+a.type,a)),e.resolve({glyphMosaicItems:[],spriteMosaicItem:null})):!a.type||"text"!==a.type&&"esriTS"!==a.type?k.safeCast(this._rasterizeSpriteSymbol(a)).then(function(a){u.ok(a)&&
a&&c._setTextureBinding(v.MosaicType.SPRITE,a);return{spriteMosaicItem:a}}):this._rasterizeTextSymbol(a,b).then(function(a){a.forEach(function(a){return c._setTextureBinding(v.MosaicType.GLYPH,a)});return{glyphMosaicItems:a}}):(G.error(new n("mapview-null-resource","Unable to rasterize null resource")),e.resolve(null))};a.prototype.bindTextures=function(a,b,e,g){void 0===g&&(g=1);if(0!==e.textureBinding){var d=this._bindingInfos[e.textureBinding-1];e=d.page;switch(d.mosaicType){case v.MosaicType.SPRITE:d=
this.sprites.getWidth(e)/g;g=this.sprites.getHeight(e)/g;g=c.vec2.set(D,d,g);this._bindSpritePage(a,e,y.TEXTURE_BINDING_SPRITE_ATLAS,9729);b.setUniform1i("u_texture",y.TEXTURE_BINDING_SPRITE_ATLAS);b.setUniform2fv("u_mosaicSize",g);break;case v.MosaicType.GLYPH:d=this.glyphs.width/g;g=this.glyphs.height/g;g=c.vec2.set(D,d,g);this._bindGlyphsPage(a,e,y.TEXTURE_BINDING_GLYPH_ATLAS);b.setUniform1i("u_texture",y.TEXTURE_BINDING_GLYPH_ATLAS);b.setUniform2fv("u_mosaicSize",g);break;default:G.error("mapview-texture-manager",
"Cannot handle unknown type "+d.mosaicType)}}};a.prototype._bindSpritePage=function(a,b,c,e){e||(e=9729);this._spriteMosaic.bind(a,e,b,c)};a.prototype._bindGlyphsPage=function(a,b,c){this._glyphMosaic.bind(a,9729,b,c)};a.prototype._rasterizeTextSymbol=function(a,b){var c=this,e=z.getFullyQualifiedFontName(a.font);a=this._invalidFontsMap.has(e);return this._glyphMosaic.getGlyphItems(a?"arial-unicode-ms-regular":e,b).catch(function(a){G.error(new n("mapview-invalid-resource","Couldn't find font "+e+
". Falling back to Arial Unicode MS Regular"));c._invalidFontsMap.set(e,!0);return c._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",b)})};a.prototype._rasterizeSpriteSymbol=function(a){return f(this,void 0,void 0,function(){var b,c,e,g,d,l,k;return m(this,function(f){if(a&&(x.isFillSymbol(a)||x.isLineSymbol(a))&&"style"in a&&("solid"===a.style||"esriSFSSolid"===a.style||"esriSLSSolid"===a.style||"none"===a.style||"esriSFSNull"===a.style||"esriSLSNull"===a.style))return[2,null];b=C(a);if(this._spriteMosaic.has(b))return[2,
this._spriteMosaic.getSpriteItem(b)];if(("simple-marker"===a.type||"esriSMS"===a.type)&&a.path)return[2,this._handleSVG(a,b)];if(a.url||a.imageData)return[2,this._handleImage(a,b)];c=this._rasterizeResource(a);e=c.size;g=c.anchor;d=c.image;l=c.sdf;k=c.simplePattern;return[2,this._addItemToMosaic(b,e,g,d,!x.isMarkerSymbol(a),l,k)]})})};a.prototype._handleSVG=function(a,b){return f(this,void 0,void 0,function(){var c,e;return m(this,function(g){switch(g.label){case 0:return c=[126,126],[4,this._sdfConverter.draw(a.path)];
case 1:return e=g.sent(),[2,this._addItemToMosaic(b,c,[0,0],new Uint32Array(e.buffer),!1,!0,!0)]}})})};a.prototype._handleImage=function(a,b){return f(this,void 0,void 0,function(){var c,e,g,d,l,k,f;return m(this,function(v){switch(v.label){case 0:c=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url,v.label=1;case 1:return v.trys.push([1,3,,4]),[4,A.requestImage(c)];case 2:return e=v.sent(),g=this._rasterizeResource(e),d=g.size,l=g.anchor,k=g.sdf,f=g.image,[2,this._addItemToMosaic(b,d,
l,f,!x.isMarkerSymbol(a),k,!1)];case 3:return v.sent(),[2,new n("mapview-invalid-resoure","Could not fetch requested resource at "+c)];case 4:return[2]}})})};a.prototype._rasterizeResource=function(a){if(a instanceof HTMLImageElement){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=a.width;this._rasterizationCanvas.height=a.height;var b=this._rasterizationCanvas.getContext("2d");b.drawImage(a,0,0,a.width,a.height);for(var b=b.getImageData(0,
0,a.width,a.height),b=new Uint8Array(b.data),c=void 0,e=0;e<b.length;e+=4)c=b[e+3]/255,b[e]*=c,b[e+1]*=c,b[e+2]*=c;var c=a.width,e=a.height,g=b;if(256<=c||256<=e)g=a.width/a.height,1<g?(c=256,e=Math.round(256/g)):(e=256,c=Math.round(256*g)),g=new Uint8Array(4*c*e),x.resampleHermite(b,a.width,a.height,new Uint8ClampedArray(g.buffer),c,e,!1);return{size:[c,e],anchor:[0,0],image:new Uint32Array(g.buffer),sdf:!1,simplePattern:!1}}return this._rasterizeJSON(a)};a.prototype._addItemToMosaic=function(a,
b,c,e,g,d,l){return this._spriteMosaic.addSpriteItem(a,b,c,e,g,d,l)};a.prototype._rasterizeJSON=function(a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===a.type||"esriSFS"===a.type)return a=l.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,a.style),{size:[a[1],a[2]],anchor:[0,0],image:new Uint32Array(a[0].buffer),sdf:!1,simplePattern:!0};if("simple-line"===a.type||"esriSLS"===a.type)return a=l.SymbolHelper.rasterizeSimpleLine(this._rasterizationCanvas,
a.style,a.cap),{size:[a[1],a[2]],anchor:[0,0],image:new Uint32Array(a[0].buffer),sdf:!0,simplePattern:!0};var b;"simple-marker"===a.type||"esriSMS"===a.type?(a=l.CIMSymbolHelper.fromSimpleMarker(a),b=!0):b=F.checkSDF(a);if(b)return a=F.buildSDF(a),{size:[a[1],a[2]],anchor:[0,0],image:new Uint32Array(a[0].buffer),sdf:!0,simplePattern:!0};a=l.CIMSymbolHelper.rasterize(this._rasterizationCanvas,a);return{size:[a[1],a[2]],anchor:[a[3],a[4]],image:new Uint32Array(a[0].buffer),sdf:!1,simplePattern:!1}};
return a}()})},"esri/views/2d/engine/webgl/CIMSymbolHelper":function(){define("require exports ../../../../Color ../../../../core/Logger ../../../../geometry/support/jsonUtils ../cim/CIMCursor ../cim/CIMEffects ../cim/CIMOperators ./CIMSymbolDrawHelper ./SDFHelper ../../../vectorTiles/GeometryUtils".split(" "),function(h,a,f,m,d,k,n,g,e,c,b){Object.defineProperty(a,"__esModule",{value:!0});var l=m.getLogger("esri/views/2d/engine/webgl/CIMSymbolHelper");h=function(){function a(){}a.getEnvelope=function(a){if("CIMPointSymbol"!==
a.type)return null;var b=new e.EnvDrawHelper;b.drawSymbol(a,{type:"point",x:0,y:0});return b.envelope()};a.rasterize=function(a,b){var c=this.getEnvelope(b);if(!c||0>=c.width||0>=c.height)return[null,0,0,0,0];var g=96/72,d=(c.x+.5*c.width)*g,l=-(c.y+.5*c.height)*g;a.width=c.width*g+2;a.height=c.height*g+2;c=a.getContext("2d");g=e.Transformation.createScale(g,-g);g.translate(.5*a.width-d,.5*a.height-l);(new e.CanvasDrawHelper(c,g)).drawSymbol(b,{type:"point",x:0,y:0});b=c.getImageData(0,0,a.width,
a.height);b=new Uint8Array(b.data);for(c=0;c<b.length;c+=4)g=b[c+3]/255,b[c]*=g,b[c+1]*=g,b[c+2]*=g;return[b,a.width,a.height,d/a.width,l/a.height]};a.fromSimpleMarker=function(a){var c,e,g=a.style;if("circle"===g||"esriSMSCircle"===g){c=Math.acos(.995);e=Math.ceil(b.C_PI/c/4);0===e&&(e=1);c=b.C_PI_BY_2/e;e*=4;g=[];g.push([50,0]);for(var d=1;d<e;d++)g.push([50*Math.cos(d*c),-50*Math.sin(d*c)]);g.push([50,0]);c={rings:[g]};e={xmin:-50,ymin:-50,xmax:50,ymax:50}}else if("cross"===g||"esriSMSCross"===
g)c=0,c={rings:[[[c,50],[c,c],[50,c],[50,-c],[c,-c],[c,-50],[-c,-50],[-c,-c],[-50,-c],[-50,c],[-c,c],[-c,50],[c,50]]]},e={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("diamond"===g||"esriSMSDiamond"===g)c={rings:[[[-50,0],[0,50],[50,0],[0,-50],[-50,0]]]},e={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("square"===g||"esriSMSSquare"===g)c={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],[-50,-50]]]},e={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("x"===g||"esriSMSX"===g)c=0,c={rings:[[[0,c],[50-c,50],[50,50-
c],[c,0],[50,c-50],[50-c,-50],[0,-c],[c-50,-50],[-50,c-50],[-c,0],[-50,50-c],[c-50,50],[0,c]]]},e={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("triangle"===g||"esriSMSTriangle"===g)e=2/3*100,g=e-100,c={rings:[[[-57.735026918962575,g],[0,e],[57.735026918962575,g],[-57.735026918962575,g]]]},e={xmin:-57.735026918962575,ymin:g,xmax:57.735026918962575,ymax:e};var l;c&&e&&(l=[{type:"CIMSolidFill",enable:!0,color:a.color}],a.outline&&l.push({type:"CIMSolidStroke",enable:!0,width:a.outline.width,color:a.outline.color}),
l={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:a.angle,size:a.size,offsetX:a.xoffset,offsetY:a.yoffset,frame:e,markerGraphics:[{type:"CIMMarkerGraphic",geometry:c,symbol:{type:"CIMPolygonSymbol",symbolLayers:l}}]}]});return l};a.getFillColor=function(b){if(!b)return null;switch(b.type){case "CIMPolygonSymbol":if(b.symbolLayers){var c=0;for(b=b.symbolLayers;c<b.length;c++){var e=a.getFillColor(b[c]);if(null!=e)return e}}break;case "CIMSolidFill":return b.color}};
a.getStrokeColor=function(b){if(b)switch(b.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(b.symbolLayers){var c=0;for(b=b.symbolLayers;c<b.length;c++){var e=a.getStrokeColor(b[c]);if(void 0!==e)return e}}break;case "CIMSolidStroke":return b.color}};a.getStrokeWidth=function(b){if(b)switch(b.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(b.symbolLayers){var c=0;for(b=b.symbolLayers;c<b.length;c++){var e=a.getStrokeWidth(b[c]);if(void 0!==e)return e}}break;case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return b.width}};
a.getSize=function(b){if(b)switch(b.type){case "CIMPointSymbol":var c=0;if(b.symbolLayers){var e=0;for(b=b.symbolLayers;e<b.length;e++){var g=a.getSize(b[e]);g>c&&(c=g)}}return c;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":return b.width;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":return b.size}};a.getMarkerScaleRatio=function(a){if(a)switch(a.type){case "CIMVectorMarker":if(!1!==a.scaleSymbolsProportionally&&a.frame)return a.size/(a.frame.ymax-
a.frame.ymin)}return 1};a.executeEffects=function(a,b,c){void 0===c&&(c=!1);var e=96/72,d=a?a.length:0;d&&c&&--d;for(c=0;c<d;++c){var l=a[c];if(l){var k=g.getEffectOperator(l);k&&(b=k.execute(b,l,e))}}return b};a.processEffects=function(b,c,e){var g;b.effects&&0<b.effects.length&&(g=k.deltaEncodeGeometry(e),g=new n.SimpleGeometryCursor(g),g=a.executeEffects(b.effects,g));b=b.symbolLayers[c];b.effects&&0<b.effects.length&&(c=!1,"CIMGeometricEffectDashes"===b.effects[b.effects.length-1].type&&(c=!0),
g||(g=k.deltaEncodeGeometry(e),g=new n.SimpleGeometryCursor(g)),g=a.executeEffects(b.effects,g,c));if(!g)return e;e=[];for(b=g.next();b;)e.push(b),b=g.next();g=e.length;switch(g){case 0:return null;case 1:return k.deltaEncodeGeometry(e[0]);default:b=e[0];for(c=1;c<g;++c){var l=e[c];d.isPolygon(b)&&d.isPolygon(l)&&Array.prototype.push.apply(b.rings,l.rings);d.isPolyline(b)&&d.isPolyline(l)&&Array.prototype.push.apply(b.paths,l.paths)}return k.deltaEncodeGeometry(b)}};return a}();a.CIMSymbolHelper=
h;h=function(){function a(){}a.rasterizeSimpleFill=function(a,b){"solid"!==b&&"none"!==b&&"esriSFSSolid"!==b&&"esriSFSNull"!==b||console.error("Unexpected: style does not require rasterization");a.width=8;a.height=8;var c=a.getContext("2d");c.strokeStyle="#FFFFFF";c.lineWidth=1;c.beginPath();if("vertical"===b||"cross"===b||"esriSFSCross"===b||"esriSFSVertical"===b)c.moveTo(0,0),c.lineTo(0,8);if("horizontal"===b||"cross"===b||"esriSFSCross"===b||"esriSFSHorizontal"===b)c.moveTo(0,0),c.lineTo(8,0);
if("forward-diagonal"===b||"diagonal-cross"===b||"esriSFSDiagonalCross"===b||"esriSFSForwardDiagonal"===b)c.moveTo(0,0),c.lineTo(8,8);if("backward-diagonal"===b||"diagonal-cross"===b||"esriSFSBackwardDiagonal"===b||"esriSFSDiagonalCross"===b)c.moveTo(8,0),c.lineTo(0,8);c.stroke();b=c.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);for(var e=0;e<b.length;e+=4)c=b[e+3]/255,b[e]*=c,b[e+1]*=c,b[e+2]*=c;return[b,a.width,a.height]};a.rasterizeSimpleLine=function(a,b,c){switch(c){case "butt":c=
"Butt";break;case "square":c="Square";break;default:c="Round"}var e="Butt"===c;switch(b){case "dash":case "esriSLSDash":b=e?[4,3]:[3,4];break;case "dash-dot":case "esriSLSDashDot":b=e?[4,3,1,3]:[3,4,0,4];break;case "dot":case "esriSLSDot":b=e?[1,3]:[0,4];break;case "long-dash":case "esriSLSLongDash":b=e?[8,3]:[7,4];break;case "long-dash-dot":case "esriSLSLongDashDot":b=e?[8,3,1,3]:[7,4,0,4];break;case "long-dash-dot-dot":case "esriSLSDashDotDot":b=e?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case "short-dash":case "esriSLSShortDash":b=
e?[4,1]:[3,2];break;case "short-dash-dot":case "esriSLSShortDashDot":b=e?[4,1,1,1]:[3,2,0,2];break;case "short-dash-dot-dot":case "esriSLSShortDashDotDot":b=e?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case "short-dot":case "esriSLSShortDot":b=e?[1,1]:[0,2];break;case "solid":case "esriSLSSolid":case "none":l.error("Unexpected: style does not require rasterization");b=[0,0];break;default:l.error("Tried to rasterize SLS, but found an unexpected style: "+b+"!"),b=[0,0]}return this.rasterizeDash(a,b,c)};a.rasterizeDash=
function(a,b,e){a="Butt"===e;var g="Square"===e;e=!a&&!g;for(var d=0,l=0;l<b.length;l++)var k=b[l],d=d+k;for(var d=15*d,f=31*d,l=new Float32Array(f),n=e?225:15,k=0;k<f;++k)l[k]=n;for(var n=f=0,m=!0,y=0;y<b.length;y++){for(var k=b[y],f=n,n=n+15*k,v=f;v<n;){for(var z=0;31>z;){var k=z*d+v,h=e?(z-15)*(z-15):Math.abs(z-15);l[k]=m?a?Math.max(Math.max(f+7.5-v,h),Math.max(v-n+7.5,h)):h:e?Math.min((v-f)*(v-f)+h,(v-n)*(v-n)+h):g?Math.min(Math.max(v-f,h),Math.max(n-v,h)):Math.min(Math.max(v-f+7.5,h),Math.max(n+
7.5-v,h));z++}v++}m=!m}b=l.length;a=new Uint8Array(4*b);for(k=0;k<b;++k)c.packFloat((e?Math.sqrt(l[k]):l[k])/15,a,4*k);return[a,d,31]};return a}();a.SymbolHelper=h;h=function(){function a(){}a.findApplicableOverrides=function(b,c,e){if(c){if(b.primitiveName)for(var g=0;g<c.length;g++){var d=c[g];if(d.primitiveName===b.primitiveName){for(var l=!1,k=0,f=e;k<f.length;k++)f[k].primitiveName===b.primitiveName&&(l=!0);l||e.push(d)}}switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(b.effects)for(d=
0,l=b.effects;d<l.length;d++)g=l[d],a.findApplicableOverrides(g,c,e);if(b.symbolLayers)for(g=0,b=b.symbolLayers;g<b.length;g++)a.findApplicableOverrides(b[g],c,e);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(b.effects)for(d=0,l=b.effects;d<l.length;d++)g=l[d],a.findApplicableOverrides(g,c,e);if("CIMVectorMarker"===b.type&&b.markerGraphics)for(g=0,b=b.markerGraphics;g<b.length;g++)d=b[g],a.findApplicableOverrides(d,c,e),a.findApplicableOverrides(d.symbol,c,e)}}};a.applyOverrides=
function(b,c,e,g){if(c){if(b.primitiveName)for(var d=0;d<c.length;d++){var l=c[d];if(l.primitiveName===b.primitiveName){g&&g.push({cim:b,propertyName:l.propertyName,value:b[l.propertyName]});l.expression&&(l.value=a.toValue(l.propertyName,l.expression));if(e){for(var k=!1,f=0,n=e;f<n.length;f++)n[f].primitiveName===b.primitiveName&&(k=!0);k||e.push(l)}b[l.propertyName]=l.value}}switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(b.effects)for(l=0,k=b.effects;l<k.length;l++)d=
k[l],a.applyOverrides(d,c,e,g);if(b.symbolLayers)for(d=0,b=b.symbolLayers;d<b.length;d++)a.applyOverrides(b[d],c,e,g);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(b.effects)for(l=0,k=b.effects;l<k.length;l++)d=k[l],a.applyOverrides(d,c,e,g);if("CIMVectorMarker"===b.type&&b.markerGraphics)for(d=0,b=b.markerGraphics;d<b.length;d++)l=b[d],a.applyOverrides(l,c,e,g),a.applyOverrides(l.symbol,c,e,g)}}};a.restoreOverrides=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.cim[c.propertyName]=
c.value}};a.getOverride=function(b,c,e){if(c&&0!==c.length)for(var g=0;g<b.length;g++){var d=b[g];if(d.primitiveName===c&&d.propertyName===e)return a.toValue(e,d.value)}};a.buildOverrideKey=function(a){return JSON.stringify(a.map(function(a){return{P:a.primitiveName,F:a.propertyName,V:a.value}}))};a.toValue=function(a,b){return"dashTemplate"===a?b.split(" ").map(function(a){return Number(a)}):"color"===a?(a=(new f(b)).toRgba(),a[3]*=255,a):b};return a}();a.OverrideHelper=h})},"esri/views/2d/engine/cim/CIMCursor":function(){define(["require",
"exports","../../../../geometry/support/jsonUtils","./CIMPlacements"],function(h,a,f,m){function d(a){if(a)for(var b=a.length-1;0<b;--b)a[b][0]-=a[b-1][0],a[b][1]-=a[b-1][1]}function k(a){if(a)for(var b=0;b<a.length;b++)d(a[b])}function n(a){if(a)for(var b=a.length,c=1;c<b;++c)a[c][0]+=a[c-1][0],a[c][1]+=a[c-1][1]}function g(a){if(a)for(var b=0;b<a.length;b++)n(a[b])}function e(a){a&&a.reverse()}function c(a){return{rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]}}
Object.defineProperty(a,"__esModule",{value:!0});a.deltaEncodePath=d;a.deltaEncodeMultipath=k;a.deltaDecodeGeometry=function(a){f.isPolygon(a)?g(a.rings):f.isPolyline(a)?g(a.paths):f.isMultipoint(a)&&n(a.points);return a};a.deltaEncodeGeometry=function(a){f.isPolygon(a)?k(a.rings):f.isPolyline(a)?k(a.paths):f.isMultipoint(a)&&d(a.points);return a};a.reverseMultipath=function(a){if(a)for(var b=0;b<a.length;b++)e(a[b])};a.reversePath=e;a.getCoord2D=function(a,c,e){return[a[0]+(c[0]-a[0])*e,a[1]+(c[1]-
a[1])*e]};a.isClosedPath=function(a){return a&&0!==a.length?a[0][0]===a[a.length-1][0]&&a[0][1]===a[a.length-1][1]:!1};a.getId=function(a){return a[4]};a.setId=function(a,c){a[4]=c};h=function(){function a(a,b,e,g){this.acceptPolygon=b;this.acceptPolyline=e;this.geomUnitsPerPoint=g;this.pathIndex=this.pathCount=-1;this.iteratePath=!1;a&&(f.isPolygon(a)?b&&(this.multiPath=a.rings,this.isClosed=!0):f.isPolyline(a)?e&&(this.multiPath=a.paths,this.isClosed=!1):f.isExtent(a)&&b&&(this.multiPath=c(a).rings,
this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length));this.internalPlacement=new m.Placement}a.prototype.next=function(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var a=this.processPath(this.multiPath[this.pathIndex]);if(a)return a}this.pathIndex=this.pathCount=-1;return this.multiPath=null};a.prototype.processPath=function(a){return null};return a}();a.PathTransformationCursor=h;h=function(){function a(a,
b,c,e){this.inputGeometries=a;this.acceptPolygon=b;this.acceptPolyline=c;this.geomUnitsPerPoint=e;this.pathIndex=this.pathCount=-1;this.iteratePath=!1}a.prototype.next=function(){for(;;){if(!this.multiPath){for(var a=this.inputGeometries.next();a;)if(f.isPolygon(a)?this.acceptPolygon&&(this.multiPath=a.rings,this.isClosed=!0):f.isPolyline(a)?this.acceptPolyline&&(this.multiPath=a.paths,this.isClosed=!1):f.isExtent(a)&&this.acceptPolygon&&(this.multiPath=c(a).rings,this.isClosed=!0),this.multiPath){this.pathCount=
this.multiPath.length;this.pathIndex=-1;break}else a=this.inputGeometries.next();if(!this.multiPath)return null}for(;this.iteratePath||this.pathIndex<this.pathCount-1;)if(this.iteratePath||this.pathIndex++,a=this.processPath(this.multiPath[this.pathIndex]))return a;this.pathIndex=this.pathCount=-1;this.multiPath=null}};a.prototype.processPath=function(a){return null};return a}();a.PathGeometryCursor=h})},"esri/views/2d/engine/cim/CIMPlacements":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,
"__esModule",{value:!0});h=function(){function a(){this.setIdentity()}a.prototype.setIdentity=function(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rz_c=1;this.rz_s=0};a.prototype.setTranslate=function(a,d){this.tx=a;this.ty=d};a.prototype.setTranslateZ=function(a){this.tz=a};a.prototype.setRotateCS=function(a,d){this.rz=void 0;this.rz_c=a;this.rz_s=d};a.prototype.setRotate=function(a){this.rz=a;this.rz_s=this.rz_c=void 0};a.prototype.setRotateY=function(a){this.ry=a};a.prototype.setScale=
function(a){this.s=a};a.prototype.setMeasure=function(a){this.m=a};return a}();a.Placement=h;h=function(){function a(a){}a.prototype.next=function(){return null};return a}();a.EmptyPlacementCursor=h})},"esri/views/2d/engine/cim/CIMEffects":function(){define(["require","exports","../../../../core/lang"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a){this._geometry=a}a.prototype.next=function(){var a=this._geometry;this._geometry=null;return a};return a}();
a.SimpleGeometryCursor=h;a.clone=function(a){return f.clone(a)}})},"esri/views/2d/engine/cim/CIMOperators":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.getEffectOperator=function(a){return null};a.getPlacementOperator=function(a){return null}})},"esri/views/2d/engine/webgl/CIMSymbolDrawHelper":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry/support/jsonUtils ../cim/CIMEffects ../cim/CIMOperators ../cim/CIMPlacements ./GeometryUtils ./Rect".split(" "),
function(h,a,f,m,d,k,n,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});var b=function(){function a(a){this._t=a}a.createIdentity=function(){return new a([1,0,0,0,1,0])};a.prototype.clone=function(){return new a(this._t.slice())};a.prototype.transform=function(a){var b=this._t;return[b[0]*a[0]+b[1]*a[1]+b[2],b[3]*a[0]+b[4]*a[1]+b[5]]};a.createScale=function(b,c){return new a([b,0,0,0,c,0])};a.prototype.scale=function(a,b){var c=this._t;c[0]*=a;c[1]*=a;c[2]*=a;c[3]*=b;c[4]*=b;c[5]*=b;return this};
a.prototype.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};a.createTranslate=function(b,c){return new a([0,0,b,0,0,c])};a.prototype.translate=function(a,b){var c=this._t;c[2]+=a;c[5]+=b;return this};a.createRotate=function(b){var c=Math.cos(b);b=Math.sin(b);return new a([c,-b,0,b,c,0])};a.prototype.rotate=function(b){return this.multiply(a.createRotate(b))};a.prototype.multiply=function(a){var b=this._t;a=a._t;var c=b[1]*a[0]+b[4]*a[1],e=b[2]*a[0]+b[5]*a[1]+a[2],
g=b[0]*a[3]+b[3]*a[4],d=b[1]*a[3]+b[4]*a[4],l=b[2]*a[3]+b[5]*a[4]+a[5];b[0]=b[0]*a[0]+b[3]*a[1];b[1]=c;b[2]=e;b[3]=g;b[4]=d;b[5]=l;return this};return a}();a.Transformation=b;h=function(){function a(a){this._transfos=[];this._sizeTransfos=[];this._transfos.push(a||b.createIdentity());this._sizeTransfos.push(a?a.scaleRatio():1)}a.prototype.transformPt=function(a){return this._transfos[this._transfos.length-1].transform(a)};a.prototype.transformSize=function(a){return a*this._sizeTransfos[this._sizeTransfos.length-
1]};a.prototype.back=function(){return this._transfos[this._transfos.length-1]};a.prototype.push=function(a){var b=a.scaleRatio();a.multiply(this.back());this._transfos.push(a);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*b)};a.prototype.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)};a.prototype.drawSymbol=function(a,b){if(a)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(a,b)}};a.prototype.drawMultiLayerSymbol=
function(a,b){if(a){var c=a.symbolLayers;if(c)if(a=a.effects){if(b=this.executeEffects(a,b))for(a=b.next();a;)this.drawSymbolLayers(c,a),a=b.next()}else this.drawSymbolLayers(c,b)}};a.prototype.executeEffects=function(a,b){var c=96/72;b=new k.SimpleGeometryCursor(b);for(var e=a?a.length:0,g=0;g<e;++g){var d=a[g];if(d){var l=n.getEffectOperator(d);l&&(b=l.execute(b,d,c))}}return b};a.prototype.drawSymbolLayers=function(a,b){for(var c=a.length;c--;){var e=a[c];if(e&&!1!==e.enable){var g=e.effects;if(g){if(g=
this.executeEffects(g,b))for(var d=g.next();d;)this.drawSymbolLayer(e,d),d=g.next()}else this.drawSymbolLayer(e,b)}}};a.prototype.drawSymbolLayer=function(a,b){switch(a.type){case "CIMSolidFill":this.drawSolidFill(b,a.color);break;case "CIMSolidStroke":this.drawSolidStroke(b,a.color,a.width);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(a,b)}};a.prototype.drawMarkerLayer=function(a,b){var c=a.markerPlacement;if(c){var e=96/72,d=n.getPlacementOperator(c);
if(d&&(b=d.execute(b,c,e)))for(c=b.next();c;)this.drawMarker(a,c),c=b.next()}else c=new g.Placement,c.tx=b.x,c.ty=b.y,this.drawMarker(a,c)};a.prototype.drawMarker=function(a,b){switch(a.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawVectorMarker(a,b)}};a.prototype.drawVectorMarker=function(a,c){if(a){var g=a.markerGraphics;if(g){var d=a.size,l=a.frame,k=l?l.ymax-l.ymin:0,d=d&&k?d/k:1,k=b.createIdentity();l&&k.translate(.5*-(l.xmax+l.xmin),.5*-(l.ymax+l.ymin));
var f=a.anchorPoint;if(f){var n=f.x,f=f.y;"Absolute"!==a.anchorPointUnits&&l&&(n*=l.xmax-l.xmin,f*=l.ymax-l.ymin);k.translate(-n,-f)}1!==d&&k.scale(d,d);a.rotation&&k.rotate(a.rotation*e.C_DEG_TO_RAD);k.translate(a.offsetX||0,a.offsetY||0);k.translate(c.tx,c.ty);this.push(k);for(a=0;a<g.length;a++)(c=g[a])&&this.drawSymbol(c.symbol,c.geometry);this.pop()}}};a.prototype.drawSolidFill=function(a,b){};a.prototype.drawSolidStroke=function(a,b,c){};return a}();a.CIMSymbolDrawHelper=h;m=function(a){function b(){var b=
a.call(this)||this;b._xmin=b._ymin=Infinity;b._xmax=b._ymax=-Infinity;return b}f(b,a);b.prototype.envelope=function(){return new c(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};b.prototype._merge=function(a,b){a[0]-b<this._xmin&&(this._xmin=a[0]-b);a[0]+b>this._xmax&&(this._xmax=a[0]+b);a[1]-b<this._ymin&&(this._ymin=a[1]-b);a[1]+b>this._ymax&&(this._ymax=a[1]+b)};b.prototype.drawSolidFill=function(a,b){b=0;for(a=a.rings;b<a.length;b++){var c=a[b],e=c?c.length:0;if(2<e){this._merge(this.transformPt(c[0]),
0);for(var g=1;g<e;++g)this._merge(this.transformPt(c[g]),0)}}};b.prototype.drawSolidStroke=function(a,b,c){b=.5*this.transformSize(c);c=0;for(a=d.isPolygon(a)?a.rings:a.paths;c<a.length;c++){var e=a[c],g=e?e.length:0;if(1<g){this._merge(this.transformPt(e[0]),b);for(var l=1;l<g;++l)this._merge(this.transformPt(e[l]),b)}}};return b}(h);a.EnvDrawHelper=m;h=function(a){function b(b,c){c=a.call(this,c)||this;c._ctx=b;return c}f(b,a);b.prototype.drawSolidFill=function(a,b){var c=this._ctx;c.fillStyle=
"string"===typeof b?b:"rgba("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+","+b[3]/255+")";c.beginPath();b=0;for(a=a.rings;b<a.length;b++){var e=a[b],g=e?e.length:0;if(2<g){var d=this.transformPt(e[0]);c.moveTo(d[0],d[1]);for(var l=1;l<g;++l)d=this.transformPt(e[l]),c.lineTo(d[0],d[1]);c.closePath()}}c.fill("evenodd")};b.prototype.drawSolidStroke=function(a,b,c){var e=this._ctx;e.strokeStyle="string"===typeof b?b:"rgba("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+","+
b[3]/255+")";e.lineWidth=this.transformSize(c)+.5;e.beginPath();b=!1;d.isPolygon(a)?(c=a.rings,b=!0):c=a.paths;for(a=0;a<c.length;a++){var g=c[a],l=g?g.length:0;if(1<l){var k=this.transformPt(g[0]);e.moveTo(k[0],k[1]);for(var f=1;f<l;++f)k=this.transformPt(g[f]),e.lineTo(k[0],k[1]);b&&e.closePath()}}e.stroke()};return b}(h);a.CanvasDrawHelper=h})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["require","exports"],function(h,a){function f(a,k){a%=k;return 0<=a?a:a+k}Object.defineProperty(a,
"__esModule",{value:!0});a.C_INFINITY=Number.POSITIVE_INFINITY;a.C_PI=Math.PI;a.C_2PI=2*a.C_PI;a.C_PI_BY_2=a.C_PI/2;a.C_RAD_TO_256=128/a.C_PI;a.C_256_TO_RAD=a.C_PI/128;a.C_DEG_TO_256=256/360;a.C_DEG_TO_RAD=a.C_PI/180;a.C_SQRT2=1.414213562;a.C_SQRT2_INV=1/a.C_SQRT2;var m=1/Math.LN2;a.positiveMod=f;a.radToByte=function(d){return f(d*a.C_RAD_TO_256,256)};a.degToByte=function(d){return f(d*a.C_DEG_TO_256,256)};a.log2=function(a){return Math.log(a)*m};a.sqr=function(a){return a*a};a.clamp=function(a,k,
f){return Math.min(Math.max(a,k),f)};a.interpolate=function(a,k,f){return a*(1-f)+k*f};a.between=function(a,k,f){return a>=k&&a<=f||a>=f&&a<=k}})},"esri/views/2d/engine/webgl/Rect":function(){define(["require","exports"],function(h,a){return function(){function a(a,d,k,f){void 0===a&&(a=0);void 0===d&&(d=0);void 0===k&&(k=0);void 0===f&&(f=0);this.x=a;this.y=d;this.width=k;this.height=f}Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,
configurable:!0});return a}()})},"esri/views/2d/engine/webgl/SDFHelper":function(){define(["require","exports","./Geometry","./Rect","../../../3d/webgl-engine/lib/Util"],function(h,a,f,m,d){function k(a,e,c){d.packFloatRGBA(a,e,c)}function n(a){if(!a)return null;switch(a.type){case "CIMPointSymbol":a=a.symbolLayers;if(!a||1!==a.length)break;return n(a[0]);case "CIMVectorMarker":var e=a.markerGraphics;if(e&&1===e.length){var c=e[0];if(c&&(e=c.geometry)&&(e.rings||e.paths)&&(e.paths&&(e={rings:e.paths.map(function(a){for(var b=
a.slice(),c=a.length-2;0<=c;c--)b.push(a[c]);return b})}),(c=c.symbol)&&("CIMPolygonSymbol"===c.type||"CIMLineSymbol"===c.type)))return{marker:a,polygon:e,symbol:c}}}return null}Object.defineProperty(a,"__esModule",{value:!0});a.packFloat=k;a.checkSDF=function(a){return null!==n(a)};a.getSDFSymbol=function(a){a=a.markerGraphics;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;a=a.symbol;return!a||"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type?null:a};a.buildSDF=function(a){var e=n(a);
if(!e)return null;var c;if(a=e.polygon)if(a=a.rings){for(var b=[],g=0;g<a.length;g++){var d=[],v=0;for(c=a[g];v<c.length;v++){var h=c[v];d.push(new f.Point(h[0],h[1]))}b.push(d)}c=b}else c=null;else c=null;if(!c)return null;a=Infinity;b=-Infinity;g=Infinity;d=-Infinity;v=0;for(h=c;v<h.length;v++)for(var w=0,p=h[v];w<p.length;w++){var B=p[w];B.x<a&&(a=B.x);B.x>b&&(b=B.x);B.y<g&&(g=B.y);B.y>d&&(d=B.y)}h=new m(a,g,b-a,d-g);d=Math.floor(31.5);w=(128-2*(d+0+1))/Math.max(h.width,h.height);v=Math.round(h.height*
w);a=Math.round(h.width*w)+2*d;b=v+2*d;g=1;(p=e.marker.frame)&&(g=h.height/(p.ymax-p.ymin));h.width>h.height&&(g*=b/v/2);B=e.marker.anchorPoint;v=e=0;B&&(e=.5*(p.xmax+p.xmin)+B.x*(p.xmax-p.xmin),v=.5*(p.ymax+p.ymin)+B.y*(p.ymax-p.ymin),e-=h.x,v-=h.y,e=(e*w+(d-.5))/a-.5,v=(v*w+(d-.5))/b-.5);p=0;for(B=c;p<B.length;p++)for(var F=0,q=B[p];F<q.length;F++){var x=q[F];x.x-=h.x;x.y-=h.y;x.x*=w;x.y*=w;x.x+=d-.5;x.y+=d-.5}w=c;p=a*b;h=new Float32Array(p);F=d*d+1;for(B=0;B<p;++B)h[B]=F;for(F=0;F<w.length;F++)for(q=
w[F],x=q.length,B=1;B<x;++B){var u=q[B-1],A=q[B],C=void 0,D=void 0;u.x<A.x?(C=u.x,D=A.x):(C=A.x,D=u.x);var G=void 0,H=void 0;u.y<A.y?(G=u.y,H=A.y):(G=A.y,H=u.y);var I=Math.floor(C)-d,D=Math.floor(D)+d,G=Math.floor(G)-d,H=Math.floor(H)+d;0>I&&(I=0);D>a&&(D=a);0>G&&(G=0);H>b&&(H=b);for(var C=A.x-u.x,L=A.y-u.y,J=C*C+L*L;I<D;I++)for(var K=G;K<H;K++){var M=(I-u.x)*C+(K-u.y)*L,P=void 0,N=void 0;0>M?(P=u.x,N=u.y):M>J?(P=A.x,N=A.y):(M/=J,P=u.x+M*C,N=u.y+M*L);M=(I-P)*(I-P)+(K-N)*(K-N);P=(b-K-1)*a+I;M<h[P]&&
(h[P]=M)}}for(B=0;B<p;++B)h[B]=Math.sqrt(h[B]);for(w=0;w<c.length;w++)for(p=c[w],B=p.length,F=1;F<B;++F)for(q=p[F-1],x=p[F],A=u=void 0,q.x<x.x?(u=q.x,A=x.x):(u=x.x,A=q.x),D=G=void 0,q.y<x.y?(G=q.y,D=x.y):(G=x.y,D=q.y),u=Math.floor(u),A=Math.floor(A)+1,G=Math.floor(G),D=Math.floor(D)+1,u<d&&(u=d),A>a-d&&(A=a-d),G<d&&(G=d),D>b-d&&(D=b-d);G<D;++G)if(q.y>G!==x.y>G){H=(b-G-1)*a;for(C=u;C<A;++C)C<(x.x-q.x)*(G-q.y)/(x.y-q.y)+q.x&&(h[H+C]=-h[H+C]);for(C=d;C<u;++C)h[H+C]=-h[H+C]}d*=2;c=h.length;w=new Uint8Array(4*
c);for(p=0;p<c;++p)k(.5-h[p]/d,w,4*p);return[w,a,b,g,e,v]}})},"esri/views/2d/engine/webgl/Geometry":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,d){this.x=a;this.y=d}a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.equals=function(a,d){return a===this.x&&d===this.y};a.prototype.isEqual=function(a){return a.x===this.x&&a.y===this.y};a.prototype.setCoords=function(a,d){this.x=a;this.y=d};a.prototype.normalize=
function(){var a=this.x,d=this.y,a=Math.sqrt(a*a+d*d);this.x/=a;this.y/=a};a.prototype.rightPerpendicular=function(){var a=this.x;this.x=this.y;this.y=-a};a.prototype.move=function(a,d){this.x+=a;this.y+=d};a.prototype.assign=function(a){this.x=a.x;this.y=a.y};a.prototype.assignAdd=function(a,d){this.x=a.x+d.x;this.y=a.y+d.y};a.prototype.assignSub=function(a,d){this.x=a.x-d.x;this.y=a.y-d.y};a.prototype.rotate=function(a,d){var k=this.x,f=this.y;this.x=k*a-f*d;this.y=k*d+f*a};a.prototype.scale=function(a){this.x*=
a;this.y*=a};a.prototype.length=function(){var a=this.x,d=this.y;return Math.sqrt(a*a+d*d)};a.distance=function(a,d){var k=d.x-a.x;a=d.y-a.y;return Math.sqrt(k*k+a*a)};a.add=function(f,d){return new a(f.x+d.x,f.y+d.y)};a.sub=function(f,d){return new a(f.x-d.x,f.y-d.y)};return a}();a.Point=h})},"esri/views/3d/webgl-engine/lib/Util":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/mathUtils".split(" "),
function(h,a,f,m,d,k,n,g,e){function c(a,b){if(!a)throw a=Error(b||"assert"),a.stack&&console.log(a.stack),new w(b);}function b(a){for(var b in a)return b}function l(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}function y(a,b){void 0===b&&(b=0);for(var c=0,e=0;4>e;e++)c+=a[b+e]*B[e];return c}function v(a){return a-Math.floor(a)}Object.defineProperty(a,"__esModule",{value:!0});var z=g.vec4f64.create(),w=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};
return a}();a.AssertException=w;a.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex",TANGENT:"aTangent"};a.assert=c;a.verify=function(a,b){a||console.warn("Verify failed: "+(b||"")+"\n"+Error("verify").stack)};a.encodeInt16=function(a){return e.clamp(Math.round(32767*a),-32767,32767)};a.encodeNormal=function(a,b){var c=
Math.abs(a[0]),e=Math.abs(a[1]),g=1/(c+e+Math.abs(a[2])),d=Math.min(a[2]*g,0);b[0]=(0>a[0]?-1:1)*(c*g-d);b[1]=(0>a[1]?-1:1)*(e*g-d)};a.fallbackIfUndefined=function(a,b){return void 0===a?b:a};a.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};a.rgb2hex=function(a){var b=e.clamp(Math.round(255*a[0]),0,255),c=e.clamp(Math.round(255*a[1]),0,255);a=e.clamp(Math.round(255*a[2]),0,255);return"0x"+((b<<16)+(c<<8)+a).toString(16)};a.dec2hex=function(a){a=a.toString(16);
return"00000000".substr(0,8-a.length)+a};a.rayTriangle3D=function(a,b,c,e,g,d,l,f,n){void 0===n&&(n=k.vec3f64.create());var m=e[l]-c[d],q=e[l+1]-c[d+1],p=e[l+2]-c[d+2];e=g[f]-c[d];l=g[f+1]-c[d+1];g=g[f+2]-c[d+2];var h=b[1]*g-l*b[2],v=b[2]*e-g*b[0],y=b[0]*l-e*b[1];f=m*h+q*v+p*y;if(-1E-5<f&&1E-5>f)return!1;f=1/f;var z=a[0]-c[d],u=a[1]-c[d+1];a=a[2]-c[d+2];n[1]=f*(z*h+u*v+a*y);if(0>n[1]||1<n[1])return!1;c=u*p-q*a;a=a*m-p*z;m=z*q-m*u;n[2]=f*(b[0]*c+b[1]*a+b[2]*m);if(0>n[2]||1<n[1]+n[2])return!1;n[0]=
f*(e*c+l*a+g*m);return!0};a.rayBoxTest=function(a,b,c,e){var g,d=(c[0]-a[0])/b[0],l=(e[0]-a[0])/b[0];d>l&&(g=d,d=l,l=g);var k=(c[1]-a[1])/b[1],f=(e[1]-a[1])/b[1];k>f&&(g=k,k=f,f=g);if(d>f||k>l)return!1;k>d&&(d=k);f<l&&(l=f);c=(c[2]-a[2])/b[2];a=(e[2]-a[2])/b[2];c>a&&(g=c,c=a,a=g);if(d>a||c>l)return!1;a<l&&(l=a);return 0>l?!1:!0};a.rayRay2D=function(a,b,c,e,g,l){void 0===l&&(l=d.vec2f64.create());var k=(e[g]-c[g])*(b[0]-a[0])-(e[0]-c[0])*(b[g]-a[g]);if(0===k)return!1;c=((e[0]-c[0])*(a[g]-c[g])-(e[g]-
c[g])*(a[0]-c[0]))/k;l[0]=a[0]+c*(b[0]-a[0]);l[1]=a[g]+c*(b[g]-a[g]);return!0};a.project=function(a,b,e,g,d){d||(d=a);z[0]=a[0];z[1]=a[1];z[2]=a[2];z[3]=1;n.vec4.transformMat4(z,z,b);2<d.length&&(d[2]=-z[2]);n.vec4.transformMat4(z,z,e);c(0!==z[3]);d[0]=z[0]/z[3];d[1]=z[1]/z[3];d[2]=z[2]/z[3];d[0]=(.5*d[0]+.5)*g[2]+g[0];d[1]=(.5*d[1]+.5)*g[3]+g[1]};a.getFirstObjectKey=b;a.getFirstObjectValue=function(a){return a[b(a)]};a.objectEmpty=function(a){for(var b in a)return!1;return!0};a.logWithBase=function(a,
b){return Math.log(a)/Math.log(b)};a.setMatrixTranslation=l;a.setMatrixTranslation3=function(a,b,c,e){a[12]=b;a[13]=c;a[14]=e};a.getMatrixTranslation=function(a,b){void 0===b&&(b=k.vec3f64.create());b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.createTranslationMatrix=function(a,b){a=f.mat4.identity(a);l(a,b);return a};a.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};a.fovx2fovy=
function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/b)};a.fovy2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/c)};a.fovx2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/b)};a.fovy2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/c)};a.fovd2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};a.fovd2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};a.packFloatRGBA=function(a,b,c){void 0===
c&&(c=0);a=e.clamp(a,0,F);for(var g=0;4>g;g++)b[c+g]=Math.floor(256*v(a*p[g]))};a.unpackFloatRGBA=y;var p=[1,256,65536,16777216],B=[1/256,1/65536,1/16777216,1/4294967296],F=y(new Uint8ClampedArray([255,255,255,255]));a.inverseProjectionInfo=function(a,b,c,e,g){0===a[11]?(e[0]=2/(b*a[0]),e[1]=2/(c*a[5]),e[2]=(1+a[12])/a[0],e[3]=(1+a[13])/a[5],m.vec2.set(g,0,1)):(e[0]=-2/(b*a[0]),e[1]=-2/(c*a[5]),e[2]=(1-a[8])/a[0],e[3]=(1-a[9])/a[5],m.vec2.set(g,1,0))}})},"esri/core/libs/gl-matrix-2/vec4":function(){define(["require",
"exports","./math/vec4"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.vec4=f})},"esri/core/libs/gl-matrix-2/math/vec4":function(){define(["require","exports","./common"],function(h,a,f){function m(a,c,e){a[0]=c[0]-e[0];a[1]=c[1]-e[1];a[2]=c[2]-e[2];a[3]=c[3]-e[3];return a}function d(a,c,e){a[0]=c[0]*e[0];a[1]=c[1]*e[1];a[2]=c[2]*e[2];a[3]=c[3]*e[3];return a}function k(a,c,e){a[0]=c[0]/e[0];a[1]=c[1]/e[1];a[2]=c[2]/e[2];a[3]=c[3]/e[3];return a}function n(a,c){var b=c[0]-a[0],
e=c[1]-a[1],g=c[2]-a[2];a=c[3]-a[3];return Math.sqrt(b*b+e*e+g*g+a*a)}function g(a,c){var b=c[0]-a[0],e=c[1]-a[1],g=c[2]-a[2];a=c[3]-a[3];return b*b+e*e+g*g+a*a}function e(a){var b=a[0],c=a[1],e=a[2];a=a[3];return Math.sqrt(b*b+c*c+e*e+a*a)}function c(a){var b=a[0],c=a[1],e=a[2];a=a[3];return b*b+c*c+e*e+a*a}Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];return a};a.set=function(a,c,e,g,d){a[0]=c;a[1]=e;a[2]=g;a[3]=d;return a};a.add=function(a,
c,e){a[0]=c[0]+e[0];a[1]=c[1]+e[1];a[2]=c[2]+e[2];a[3]=c[3]+e[3];return a};a.subtract=m;a.multiply=d;a.divide=k;a.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);a[2]=Math.ceil(c[2]);a[3]=Math.ceil(c[3]);return a};a.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);a[2]=Math.floor(c[2]);a[3]=Math.floor(c[3]);return a};a.min=function(a,c,e){a[0]=Math.min(c[0],e[0]);a[1]=Math.min(c[1],e[1]);a[2]=Math.min(c[2],e[2]);a[3]=Math.min(c[3],e[3]);return a};a.max=function(a,c,e){a[0]=
Math.max(c[0],e[0]);a[1]=Math.max(c[1],e[1]);a[2]=Math.max(c[2],e[2]);a[3]=Math.max(c[3],e[3]);return a};a.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);a[2]=Math.round(c[2]);a[3]=Math.round(c[3]);return a};a.scale=function(a,c,e){a[0]=c[0]*e;a[1]=c[1]*e;a[2]=c[2]*e;a[3]=c[3]*e;return a};a.scaleAndAdd=function(a,c,e,g){a[0]=c[0]+e[0]*g;a[1]=c[1]+e[1]*g;a[2]=c[2]+e[2]*g;a[3]=c[3]+e[3]*g;return a};a.distance=n;a.squaredDistance=g;a.length=e;a.squaredLength=c;a.negate=function(a,c){a[0]=
-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=-c[3];return a};a.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];a[3]=1/c[3];return a};a.normalize=function(a,c){var b=c[0],e=c[1],g=c[2];c=c[3];var d=b*b+e*e+g*g+c*c;0<d&&(d=1/Math.sqrt(d),a[0]=b*d,a[1]=e*d,a[2]=g*d,a[3]=c*d);return a};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,e,g){var b=c[0],d=c[1],l=c[2];c=c[3];a[0]=b+g*(e[0]-b);a[1]=d+g*(e[1]-d);a[2]=l+g*(e[2]-l);a[3]=c+g*(e[3]-c);return a};a.random=function(a,
c){c=c||1;var b,e,g,d,l,k;do b=2*f.RANDOM()-1,e=2*f.RANDOM()-1,l=b*b+e*e;while(1<=l);do g=2*f.RANDOM()-1,d=2*f.RANDOM()-1,k=g*g+d*d;while(1<=k);l=Math.sqrt((1-l)/k);a[0]=c*b;a[1]=c*e;a[2]=c*g*l;a[3]=c*d*l;return a};a.transformMat4=function(a,c,e){var b=c[0],g=c[1],d=c[2];c=c[3];a[0]=e[0]*b+e[4]*g+e[8]*d+e[12]*c;a[1]=e[1]*b+e[5]*g+e[9]*d+e[13]*c;a[2]=e[2]*b+e[6]*g+e[10]*d+e[14]*c;a[3]=e[3]*b+e[7]*g+e[11]*d+e[15]*c;return a};a.transformQuat=function(a,c,e){var b=c[0],g=c[1],d=c[2],l=e[0],k=e[1],f=e[2];
e=e[3];var n=e*b+k*d-f*g,m=e*g+f*b-l*d,h=e*d+l*g-k*b,b=-l*b-k*g-f*d;a[0]=n*e+b*-l+m*-f-h*-k;a[1]=m*e+b*-k+h*-l-n*-f;a[2]=h*e+b*-f+n*-k-m*-l;a[3]=c[3];return a};a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};a.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]};a.equals=function(a,c){var b=a[0],e=a[1],g=a[2];a=a[3];var d=c[0],l=c[1],k=c[2];c=c[3];return Math.abs(b-d)<=f.EPSILON*Math.max(1,Math.abs(b),Math.abs(d))&&Math.abs(e-l)<=f.EPSILON*Math.max(1,
Math.abs(e),Math.abs(l))&&Math.abs(g-k)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(a-c)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};a.sub=m;a.mul=d;a.div=k;a.dist=n;a.sqrDist=g;a.len=e;a.sqrLen=c})},"esri/core/libs/gl-matrix-2/vec4f64":function(){define(["require","exports","./factories/vec4f64"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.vec4f64=f})},"esri/core/libs/gl-matrix-2/factories/vec4f64":function(){define(["require","exports"],function(h,a){function f(){return[0,
0,0,0]}Object.defineProperty(a,"__esModule",{value:!0});a.create=f;a.clone=function(a){return[a[0],a[1],a[2],a[3]]};a.fromValues=function(a,d,k,f){return[a,d,k,f]};a.fromArray=function(a){for(var d=f(),k=Math.min(4,a.length),n=0;n<k;++n)d[n]=a[n];return d};a.createView=function(a,d){return new Float64Array(a,d,4)}})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(h,a){function f(a,k){a%=k;return 0<=a?a:a+k}Object.defineProperty(a,"__esModule",{value:!0});a.C_INFINITY=
Number.POSITIVE_INFINITY;a.C_PI=Math.PI;a.C_2PI=2*a.C_PI;a.C_PI_BY_2=a.C_PI/2;a.C_RAD_TO_256=128/a.C_PI;a.C_256_TO_RAD=a.C_PI/128;a.C_DEG_TO_256=256/360;a.C_DEG_TO_RAD=a.C_PI/180;a.C_SQRT2=1.414213562;a.C_SQRT2_INV=1/a.C_SQRT2;var m=1/Math.LN2;a.positiveMod=f;a.radToByte=function(d){return f(d*a.C_RAD_TO_256,256)};a.degToByte=function(d){return f(d*a.C_DEG_TO_256,256)};a.log2=function(a){return Math.log(a)*m};a.sqr=function(a){return a*a};a.clamp=function(a,k,f){return Math.min(Math.max(a,k),f)};
a.interpolate=function(a,k,f){return a*(1-f)+k*f};a.between=function(a,k,f){return a>=k&&a<=f||a>=f&&a<=k}})},"esri/views/2d/engine/webgl/definitions":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.EXTRUDE_SCALE=64;a.PICTURE_FILL_COLOR=4294967295;a.TILE_SIZE=512;a.ANGLE_FACTOR_256=256/360;a.DEBUG_LABELS=!1;a.COLLISION_BUCKET_SIZE=128;a.DOT_DENSITY_MAX_FIELDS=8;a.COLLISION_MAX_ZOOM_DELTA=3;a.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;a.COLLISION_BOX_PADDING=
8;a.COLLISION_TILE_BOX_SIZE=a.TILE_SIZE/a.COLLISION_BUCKET_SIZE;a.COLLISION_PLACEMENT_PADDING=8;a.HEURISTIC_GLYPHS_PER_LINE=50;a.HEURISTIC_GLYPHS_PER_FEATURE=10;a.GLYPH_SIZE=24;a.TEXT_LINE_HEIGHT=1.2*a.GLYPH_SIZE;a.TEXT_MAX_WIDTH=10*a.GLYPH_SIZE;a.TEXT_SPACING=0;a.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};a.TEXTURE_BINDING_SPRITE_ATLAS=0;a.TEXTURE_BINDING_GLYPH_ATLAS=1;a.TEXTURE_BINDING_HIGHLIGHT_0=2;a.TEXTURE_BINDING_HIGHLIGHT_1=3;a.TEXTURE_BINDING_RENDERER_0=
4;a.TEXTURE_BINDING_RENDERER_1=5;a.MAX_FILTERS=2;a.FILTER_FLAG_0=1;a.EFFECT_FLAG_0=2})},"esri/views/2d/engine/webgl/fontUtils":function(){define(["require","exports"],function(h,a){function f(a){a=a.toLowerCase().split(" ").join("-");switch(a){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return a}}Object.defineProperty(a,"__esModule",{value:!0});a.getFullyQualifiedFontName=
function(a){var d;a:{if(a.weight)switch(a.weight.toLowerCase()){case "bold":case "bolder":d="-bold";break a}d=""}var k;a:{if(a.style)switch(a.style.toLowerCase()){case "italic":case "oblic":k="-italic";break a}k=""}d+=k;return f(a.family)+(0<d.length?d:"-regular")};a.getFontDecorationTop=function(a){switch(a.decoration.toLowerCase()){case "underline":return-26;case "line-through":return-18}return NaN}})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("require exports ../../../../core/has ../../../../core/promiseUtils ./Rect ./RectangleBinPack ../../../webgl/Texture".split(" "),
function(h,a,f,m,d,k,n){return function(){function a(a,c,b){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=a;this.height=c;this._glyphSource=b;this._binPack=new k(a-4,c-4);this._glyphData.push(new Uint8Array(a*c));this._dirties.push(!0);this._textures.push(void 0);this._addDecorationGlyph()}a.prototype.getGlyphItems=function(a,c){for(var b=this,e=[],g=this._glyphSource,d=new Set,k=1/256,
f=0;f<c.length;f++)d.add(Math.floor(c[f]*k));var n=[];d.forEach(function(c){if(256>=c){var e=a+c;b._rangePromises.has(e)?n.push(b._rangePromises.get(e)):(c=g.getRange(a,c).then(function(){b._rangePromises["delete"](e)}).catch(function(){b._rangePromises["delete"](e);throw Error("Unable to query resource");}),b._rangePromises.set(e,c),n.push(c))}});return m.all(n).then(function(d){var l=b._glyphIndex[a];l||(l={},b._glyphIndex[a]=l);for(var k=0;k<c.length;k++){d=c[k];var f=l[d];if(f)e[d]={sdf:!0,rect:f.rect,
metrics:f.metrics,page:f.page};else if((f=g.getGlyph(a,d))&&f.metrics){var n=b._recordGlyph(f,d);l[d]={rect:n,metrics:f.metrics,tileIDs:null,page:b._currentPage};e[d]={sdf:!0,rect:n,metrics:f.metrics,page:b._currentPage};b._dirties[b._currentPage]=!0}}return e})};a.prototype._recordGlyph=function(a,c){var b=a.metrics;if(0===b.width)b=new d(0,0,0,0);else{c=b.width+6;var e=b.height+6,g=c%4?4-c%4:4,f=e%4?4-e%4:4;1===g&&(g=5);1===f&&(f=5);b=this._binPack.allocate(c+g,e+f);b.isEmpty&&(this._dirties[this._currentPage]||
(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new k(this.width-4,this.height-4),b=this._binPack.allocate(c+g,e+f));g=this._glyphData[this._currentPage];a=a.bitmap;var n=f=void 0;if(a)for(var m=0;m<e;m++)for(var f=c*m,n=this.width*(b.y+m+1)+b.x,p=0;p<c;p++)g[n+p+1]=a[f+p]}return b};a.prototype._addDecorationGlyph=function(){for(var a=[117,
149,181,207,207,181,149,117],c=[],b=0;b<a.length;b++)for(var g=a[b],d=0;11>d;d++)c.push(g);a={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(c)};this._recordGlyph(a,0)};a.prototype.bind=function(a,c,b,g){this._textures[b]||(this._textures[b]=new n(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var e=this._textures[b];e.setSamplingMode(c);this._dirties[b]&&e.setData(this._glyphData[b]);a.bindTexture(e,g);this._dirties[b]=
!1};a.prototype.dispose=function(){this._binPack=null;for(var a=0,c=this._textures;a<c.length;a++){var b=c[a];b&&b.dispose()}this._textures.length=0;this._glyphData.length=0};return a}()})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["require","exports","./Rect"],function(h,a,f){return function(){function a(a,k){this._height=this._width=0;this._free=[];this._width=a;this._height=k;this._free.push(new f(0,0,a,k))}Object.defineProperty(a.prototype,"width",{get:function(){return this._width},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});a.prototype.allocate=function(a,k){if(a>this._width||k>this._height)return new f;for(var d=null,g=-1,e=0;e<this._free.length;++e){var c=this._free[e];a<=c.width&&k<=c.height&&(null===d||c.y<=d.y&&c.x<=d.x)&&(d=c,g=e)}if(null===d)return new f;this._free.splice(g,1);d.width<d.height?(d.width>a&&this._free.push(new f(d.x+a,d.y,d.width-a,k)),d.height>k&&this._free.push(new f(d.x,
d.y+k,d.width,d.height-k))):(d.width>a&&this._free.push(new f(d.x+a,d.y,d.width-a,d.height)),d.height>k&&this._free.push(new f(d.x,d.y+k,a,d.height-k)));return new f(d.x,d.y,a,k)};a.prototype.release=function(a){for(var d=0;d<this._free.length;++d){var f=this._free[d];if(f.y===a.y&&f.height===a.height&&f.x+f.width===a.x)f.width+=a.width;else if(f.x===a.x&&f.width===a.width&&f.y+f.height===a.y)f.height+=a.height;else if(a.y===f.y&&a.height===f.height&&a.x+a.width===f.x)f.x=a.x,f.width+=a.width;else if(a.x===
f.x&&a.width===f.width&&a.y+a.height===f.y)f.y=a.y,f.height+=a.height;else continue;this._free.splice(d,1);this.release(a)}this._free.push(a)};return a}()})},"esri/views/2d/engine/webgl/GlyphSource":function(){define(["require","exports","../../../../request","../../../../core/pbf","../../../../core/promiseUtils"],function(h,a,f,m,d){var k=function(){function a(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:for(var c=a.getMessage();c.next();)switch(c.tag()){case 3:for(var b=
c.getMessage(),e=void 0,g=void 0,d=void 0,k=void 0,f=void 0,n=void 0,m=void 0;b.next();)switch(b.tag()){case 1:e=b.getUInt32();break;case 2:g=b.getBytes();break;case 3:d=b.getUInt32();break;case 4:k=b.getUInt32();break;case 5:f=b.getSInt32();break;case 6:n=b.getSInt32();break;case 7:m=b.getUInt32();break;default:b.skip()}e&&(this._metrics[e]={width:d,height:k,left:f,top:n,advance:m},this._bitmaps[e]=g);break;default:c.skip()}break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};
a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),n=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,c){this._ranges[a]=c};return a}();return function(){function a(a){this._glyphInfo={};this._baseURL=a}a.prototype.getRange=function(a,c){var b=this._getFontStack(a);if(b.getRange(c))return d.resolve();var e=256*c,g=e+255;a=this._baseURL.replace("{fontstack}",a).replace("{range}",e+"-"+g);return f(a,
{responseType:"array-buffer"}).then(function(a){b.addRange(c,new k(new m(new Uint8Array(a.data),new DataView(a.data))))})};a.prototype.getGlyph=function(a,c){if(a=this._getFontStack(a)){var b=Math.floor(c/256);if(!(256<b)&&(a=a.getRange(b)))return{metrics:a.getMetrics(c),bitmap:a.getBitmap(c)}}};a.prototype._getFontStack=function(a){var c=this._glyphInfo[a];c||(c=this._glyphInfo[a]=new n);return c};return a}()})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["require","exports","../../../../core/promiseUtils",
"./SDFHelper"],function(h,a,f,m){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a){this.size=a;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=a;this.context=this.canvas.getContext("2d");this._gridOuter=new Float64Array(a*a);this._gridInner=new Float64Array(a*a);this._f=new Float64Array(a);this._d=new Float64Array(a);this._z=new Float64Array(a+1);this._v=new Int16Array(a);a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("style",
"position: absolute;");a.setAttribute("width","0");a.setAttribute("height","0");document.body.appendChild(a);this._svg=a}a.prototype.draw=function(a,d){var g=this;void 0===d&&(d=31);var e=this._createSVGString(a);return f.create(function(a){var c=new Image;c.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(e);c.onload=function(){g.context.clearRect(0,0,g.size,g.size);g.context.drawImage(c,0,0,g.size,g.size);for(var b=g.context.getImageData(0,0,g.size,g.size),e=new Uint8Array(g.size*
g.size*4),f=0;f<g.size*g.size;f++){var k=b.data[4*f+3]/255;g._gridOuter[f]=1===k?0:0===k?1E20:Math.pow(Math.max(0,.5-k),2);g._gridInner[f]=1===k?1E20:0===k?0:Math.pow(Math.max(0,k-.5),2)}g._edt(g._gridOuter,g.size,g.size);g._edt(g._gridInner,g.size,g.size);for(f=0;f<g.size*g.size;f++)m.packFloat(.5-(g._gridOuter[f]-g._gridInner[f])/(2*d),e,4*f);a(e)}})};a.prototype._createSVGString=function(a){var d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",a);this._svg.appendChild(d);
a=d.getBBox();var g=a.width/a.height,e=this.size/2,c,b,l;1<g?(b=c=e/a.width,l=this.size/4,g=e-1/g*e/2):(c=b=e/a.height,l=e-e*g/2,g=this.size/4);d.setAttribute("style","transform: matrix("+c+", 0, 0, "+b+", "+(-a.x*c+l)+", "+(-a.y*b+g)+")");a='\x3csvg style\x3d"fill:red;" height\x3d"'+this.size+'" width\x3d"'+this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(d);return a};a.prototype._edt=function(a,d,g){for(var e=this._f,c=this._d,b=this._v,
l=this._z,f=0;f<d;f++){for(var k=0;k<g;k++)e[k]=a[k*d+f];this._edt1d(e,c,b,l,g);for(k=0;k<g;k++)a[k*d+f]=c[k]}for(k=0;k<g;k++){for(f=0;f<d;f++)e[f]=a[k*d+f];this._edt1d(e,c,b,l,d);for(f=0;f<d;f++)a[k*d+f]=Math.sqrt(c[f])}};a.prototype._edt1d=function(a,d,g,e,c){g[0]=0;e[0]=-1E20;e[1]=1E20;for(var b=1,l=0;b<c;b++){for(var f=(a[b]+b*b-(a[g[l]]+g[l]*g[l]))/(2*b-2*g[l]);f<=e[l];)l--,f=(a[b]+b*b-(a[g[l]]+g[l]*g[l]))/(2*b-2*g[l]);l++;g[l]=b;e[l]=f;e[l+1]=1E20}for(l=b=0;b<c;b++){for(;e[l+1]<b;)l++;d[b]=
(b-g[l])*(b-g[l])+a[g[l]]}};return a}();a.default=h})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("require exports ./GeometryUtils ./Rect ./RectangleBinPack ../../../webgl/Texture".split(" "),function(h,a,f,m,d,k){return function(){function a(a,e,c){void 0===c&&(c=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=a||
0>=e)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=e;0<c&&(this._maxItemSize=c);this.pixelRatio=window.devicePixelRatio||1;this._binPack=new d(this._pageWidth,this._pageHeight);this._mosaicsData[0]=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}a.prototype.getWidth=function(a){return a>=this._size.length?
-1:this._size[a][0]};a.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};a.prototype.getPage=function(a){return a<this._textures.length?this._textures[a]:null};a.prototype.has=function(a){return this._mosaicRects.has(a)};Object.defineProperty(a.prototype,"itemCount",{get:function(){return this._mosaicRects.size},enumerable:!0,configurable:!0});a.prototype.getSpriteItem=function(a){return this._mosaicRects.get(a)};a.prototype.addSpriteItem=function(a,e,c,b,d,f,k){if(this._mosaicRects.has(a))return this._mosaicRects.get(a);
var g=this._allocateImage(e[0],e[1]),l=g[0],n=g[1],g=g[2];if(0>=l.width||0>=l.height)return null;c={rect:l,width:e[0],height:e[1],anchorX:c[0],anchorY:c[1],sdf:f,simplePattern:k,pixelRatio:1,page:n};this._mosaicRects.set(a,c);this._copy({rect:l,spriteSize:e,spriteData:b,page:n,pageSize:g,repeat:d,sdf:f});return c};a.prototype.hasItemsToProcess=function(){return 0!==this._spriteCopyQueue.length};a.prototype.processNextItem=function(){var a=this._spriteCopyQueue.pop();a&&this._copy(a)};a.prototype.getSpriteItems=
function(a){for(var e={},c=0;c<a.length;c++){var b=a[c];e[b]=this.getSpriteItem(b)}return e};a.prototype.getMosaicItemPosition=function(a,e){e=(a=this.getSpriteItem(a))&&a.rect;if(!e)return null;e.width=a.width;e.height=a.height;return{size:[a.width,a.height],tl:[(e.x+1)/this._size[a.page][0],(e.y+1)/this._size[a.page][1]],br:[(e.x+1+a.width)/this._size[a.page][0],(e.y+1+a.height)/this._size[a.page][1]],page:a.page}};a.prototype.bind=function(a,e,c,b){void 0===c&&(c=0);void 0===b&&(b=0);this._textures[c]||
(this._textures[c]=new k(a,{pixelFormat:6408,dataType:5121,width:this._size[c][0],height:this._size[c][1]},new Uint8Array(this._mosaicsData[c].buffer)));var g=this._textures[c];g.setSamplingMode(e);this._dirties[c]&&(g.setData(new Uint8Array(this._mosaicsData[c].buffer)),g.generateMipmap());a.bindTexture(g,b);this._dirties[c]=!1};a._copyBits=function(a,e,c,b,d,f,k,n,m,p,h){var g=b*e+c;k=n*f+k;if(h)for(k-=f,h=-1;h<=p;h++,g=((h+p)%p+b)*e+c,k+=f)for(n=-1;n<=m;n++)d[k+n]=a[g+(n+m)%m];else for(h=0;h<p;h++){for(n=
0;n<m;n++)d[k+n]=a[g+n];g+=e;k+=f}};a.prototype._copy=function(g){if(!(g.page>=this._mosaicsData.length)){var e=g.spriteData,c=this._mosaicsData[g.page];c&&e||console.error("Source or target images are uninitialized!");a._copyBits(e,g.spriteSize[0],0,0,c,g.pageSize[0],g.rect.x+1,g.rect.y+1,g.spriteSize[0],g.spriteSize[1],g.repeat);this._dirties[g.page]=!0}};a.prototype._allocateImage=function(a,e){a+=2;e+=2;var c=Math.max(a,e);if(this._maxItemSize&&this._maxItemSize<c){var c=Math.pow(2,Math.ceil(f.log2(a))),
b=Math.pow(2,Math.ceil(f.log2(e)));a=new m(0,0,a,e);this._mosaicsData.push(new Uint32Array(c*b));this._dirties.push(!0);this._size.push([c,b]);this._textures.push(void 0);return[a,this._mosaicsData.length-1,[c,b]]}c=this._binPack.allocate(a+(a%4?4-a%4:0),e+(e%4?4-e%4:0));return 0>=c.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),
this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new d(this._pageWidth,this._pageHeight),this._allocateImage(a,e)):[c,this._currentPage,[this._pageWidth,this._pageHeight]]};a.prototype.dispose=function(){this._binPack=null;for(var a=0,e=this._textures;a<e.length;a++){var c=e[a];c&&c.dispose()}this._textures.length=0;this._mosaicsData.length=0;this._mosaicRects.clear()};return a}()})},"esri/views/2d/engine/webgl/Utils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../arcade/Dictionary ../../../../arcade/Feature ../../../../core/Error ../../../../core/Logger ../../../../core/screenUtils ../../../../geometry/support/quantizationUtils ../../../../support/arcadeUtils ./color ./enums ./SymbolProperties ../../../3d/support/mathUtils ../../../webgl/Texture".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z){function w(a){for(var c={},b=0;b<a.length;b++){var e=a[b];c[e.name]=e.strideInBytes}return c}function p(a){switch(a){case l.WGLGeometryType.MARKER:return D;case l.WGLGeometryType.FILL:return G;case l.WGLGeometryType.LINE:return H;case l.WGLGeometryType.TEXT:return I;case l.WGLGeometryType.LABEL:return L}return null}function B(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function F(a){switch(a){case "esriSMS":return"simple-marker";case "esriPMS":return"picture-marker";
case "esriSLS":return"simple-line";case "esriPLS":return"picture-line";case "esriSFS":return"simple-fill";case "esriPFS":return"picture-fill";case "esriTS":return"text"}return a}function q(a){return"string"===typeof a}function x(a){var c={};switch(a){case "esriGeometryPoint":return function(a,b,g,d){return e.hydratePoint(b,c,a,g,d)};case "esriGeometryPolygon":return function(a,b,g,d){return e.hydratePolygon(b,c,a,g,d)};case "esriGeometryPolyline":return function(a,b,g,d){return e.hydratePolyline(b,
c,a,g,d)};case "esriGeometryMultipoint":return function(a,b,g,d){return e.hydrateMultipoint(b,c,a,g,d)};default:return C.error(new k("mapview-arcade","Unable to handle geometryType: "+a)),function(a,c,b,e){return a}}}function u(a){var c={},b=function(b){var e=0;c[b]=a[b].map(function(a){var c=f({},a,{normalized:a.normalized||!1,divisor:a.divisor||0,offset:e,stride:0}),b=e,g=a.count;a:{switch(a.type){case 5120:case 5121:a=1;break a;case 5122:case 5123:a=2;break a;case 5126:case 5124:case 5125:a=4;
break a}a=void 0}e=b+g*a;return c});c[b].forEach(function(a){return a.stride=e})},e;for(e in a)b(e);return c}Object.defineProperty(a,"__esModule",{value:!0});var A,C=n.getLogger("esri.views.2d.engine.webgl.Utils");a.C_HITTEST_SEARCH_SIZE=4;a.C_VBO_GEOMETRY="geometry";a.C_VBO_PERINSTANCE="per_instance";a.C_VBO_PERINSTANCE_VV="per_instance_vv";a.C_VBO_VISIBILITY="visibility";a.C_VBO_VISIBILITY_RANGE="visibilityRange";a.C_ICON_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:a.C_VBO_VISIBILITY,
strideInBytes:1,divisor:0}];a.C_ICON_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_FILL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_FILL_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_FILL_VERTEX_DEF_DD=[{name:a.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:a.C_VBO_VISIBILITY,
strideInBytes:1,divisor:0}];a.C_LINE_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_LINE_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:44,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_TEXT_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_TEXT_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:a.C_VBO_VISIBILITY,
strideInBytes:1,divisor:0}];a.C_LABEL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0},{name:a.C_VBO_VISIBILITY_RANGE,strideInBytes:2,divisor:0}];a.C_ICON_STRIDE_SPEC=w(a.C_ICON_VERTEX_DEF);a.C_ICON_STRIDE_SPEC_VV=w(a.C_ICON_VERTEX_DEF_VV);a.C_FILL_STRIDE_SPEC=w(a.C_FILL_VERTEX_DEF);a.C_FILL_STRIDE_SPEC_VV=w(a.C_FILL_VERTEX_DEF_VV);a.C_FILL_STRIDE_SPEC_DD=w(a.C_FILL_VERTEX_DEF_DD);a.C_LINE_STRIDE_SPEC=w(a.C_LINE_VERTEX_DEF);a.C_LINE_STRIDE_SPEC_VV=
w(a.C_LINE_VERTEX_DEF_VV);a.C_TEXT_STRIDE_SPEC=w(a.C_TEXT_VERTEX_DEF);a.C_TEXT_STRIDE_SPEC_VV=w(a.C_TEXT_VERTEX_DEF_VV);a.C_LABEL_STRIDE_SPEC=w(a.C_LABEL_VERTEX_DEF);a.getStrides=function(c,b,e){switch(c){case l.WGLGeometryType.MARKER:return b?a.C_ICON_STRIDE_SPEC_VV:a.C_ICON_STRIDE_SPEC;case l.WGLGeometryType.FILL:return e?a.C_FILL_STRIDE_SPEC_DD:b?a.C_FILL_STRIDE_SPEC_VV:a.C_FILL_STRIDE_SPEC;case l.WGLGeometryType.LINE:return b?a.C_LINE_STRIDE_SPEC_VV:a.C_LINE_STRIDE_SPEC;case l.WGLGeometryType.TEXT:return b?
a.C_TEXT_STRIDE_SPEC_VV:a.C_TEXT_STRIDE_SPEC;case l.WGLGeometryType.LABEL:return a.C_LABEL_STRIDE_SPEC}return null};var D=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY],G=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY],H=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY],I=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY],L=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY,a.C_VBO_VISIBILITY_RANGE];a.getNamedBuffers=p;a.strideToPackingFactor=B;a.allocateTypedArrayBuffer=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(Math.floor(a*c/4));case 1:case 3:return new Uint8Array(a*
c)}};a.allocateTypedArrayBufferwithData=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(a);case 1:case 3:return new Uint8Array(a)}};a.normalizeSymbolType=F;a.isMarkerSymbol=function(a){if(a=F(a.type)){switch(a){case "simple-marker":case "picture-marker":return!0;case "CIMPointSymbol":return!0}return!1}};a.isFillSymbol=function(a){if(a=F(a.type)){switch(a){case "simple-fill":case "picture-fill":return!0;case "CIMPolygonSymbol":return!0}return!1}};a.isLineSymbol=function(a){if(a=F(a.type)){switch(a){case "simple-line":case "picture-line":return!0;
case "CIMLineSymbol":return!0}return!1}};a.isPictureSymbol=function(a){if(a=F(a.type))switch(a){case "picture-marker":case "picture-line":case "picture-fill":return!0}return!1};a.isTextSymbol=function(a){if(a=F(a.type)){switch(a){case "text":return!0;case "CIMTextSymbol":return!0}return!1}};a.getTextProperties=function(a){return y.TextProperties.pool.acquire(a.color?b.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?b.copyAndPremultiply(a.haloColor):[255,255,255,255],g.pt2px(a.haloSize),
g.pt2px(a.font.size),a.angle*Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};a.isDefined=function(a){return null!==a&&void 0!==a};a.isNumber=function(a){return"number"===typeof a};a.isString=q;a.isStringOrNull=function(a){return null==a||q(a)};a.lerp=function(a,c,b){return a+(c-a)*b};h=function(){function a(){this._arr=[];this._push=this._push.bind(this)}
a.prototype._push=function(a,c){this._arr.push(c)};a.prototype.getKeys=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();a.KeysGetter=h;h=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,c){this._arr.push(a)};a.prototype.getValues=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();a.ValuesGetter=h;a.getCapType=function(a,c){switch(a){case "butt":return l.CapType.BUTT;case "round":return c?
l.CapType.SQUARE:l.CapType.ROUND;case "square":return l.CapType.SQUARE;default:return C.error(new k("mapview-invalid-type","Cap type "+a+" is not a valid option. Defaulting to round")),l.CapType.ROUND}};a.getJoinType=function(a){switch(a){case "miter":return l.JoinType.MITER;case "bevel":return l.JoinType.BEVEL;case "round":return l.JoinType.ROUND;default:return C.error(new k("mapview-invalid-type","Join type "+a+" is not a valid option. Defaulting to round")),l.JoinType.ROUND}};a.getVVType=function(a){switch(a){case "opacity":return l.VVType.OPACITY;
case "color":return l.VVType.COLOR;case "rotation":return l.VVType.ROTATION;case "size":return l.VVType.SIZE;default:return C.error("Cannot interpret unknown vv: "+a),null}};a.createHydrateFactory=x;a.getTransformParams=function(a){return{transform:a.transform,hasZ:a.hasZ,hasM:a.hasM}};a.createArcadeFunction=function(a,b,e){var g=b.fields,l=b.spatialReference,f=b.hasGeometryExpr;b=b.geometryType;var k=c.createFunction(a),n=new d,q=new m({viewingMode:null,scale:null}),p={},h={vars:{$feature:n,$view:null},
spatialReference:l},v={fields:g},J=x(b);return function(a,b,g){f?(b=J(a.geometry,b.transform,b.hasZ,b.hasM),b.spatialReference=l,n.repurposeFromGraphicLikeObject(b,a.attributes,v)):n.repurposeFromGraphicLikeObject(a.geometry,a.attributes,v);g?(h.vars.$view=q,q.attributes.viewingMode=g.viewingMode,q.attributes.scale=g.scale):h.vars.$view=p;a=c.executeFunction(k,h);return e?e(a):a}};a.copyMeshData=function(a,c,b,e,g,d,l){for(var f in d)for(var k=d[f].stride,n=B(k),m=d[f].data,q=b[f].data,p=k*g.vertexCount/
n,h=k*a/n,n=k*g.vertexFrom/n,k=0;k<p;++k)q[k+h]=m[k+n];b=g.indexCount;for(k=0;k<b;++k)e[k+c]=l[k+g.indexFrom]-g.vertexFrom+a};a.C_VBO_INFO=(A={},A[a.C_VBO_GEOMETRY]=35044,A[a.C_VBO_VISIBILITY]=35044,A[a.C_VBO_VISIBILITY_RANGE]=35048,A);a.createGeometryData=function(a,c){for(var b=[],e=0;5>e;++e){for(var g={},d=0,l=p(e);d<l.length;d++){var f=l[d];g[f]={data:c(e,f)}}b.push({data:a(e),buffers:g})}return b};a.resampleHermite=function(a,c,b,e,g,d,l){void 0===l&&(l=!0);var f=c/g;b/=d;for(var k=Math.ceil(f/
2),n=Math.ceil(b/2),m=0;m<d;m++)for(var q=0;q<g;q++){for(var p=4*(q+(l?d-m-1:m)*g),h=0,v=0,J=0,y=0,u=0,z=0,w=0,x=(m+.5)*b,M=Math.floor(m*b);M<(m+1)*b;M++)for(var P=Math.abs(x-(M+.5))/n,B=(q+.5)*f,P=P*P,K=Math.floor(q*f);K<(q+1)*f;K++){var H=Math.abs(B-(K+.5))/k,h=Math.sqrt(P+H*H);-1<=h&&1>=h&&(h=2*h*h*h-3*h*h+1,0<h&&(H=4*(K+M*c),w+=h*a[H+3],J+=h,255>a[H+3]&&(h=h*a[H+3]/250),y+=h*a[H],u+=h*a[H+1],z+=h*a[H+2],v+=h))}e[p]=y/v;e[p+1]=u/v;e[p+2]=z/v;e[p+3]=w/J}};a.createTextureFromTexelData=function(a,
c){var b,e;v.isPowerOfTwo(c.width)&&v.isPowerOfTwo(c.height)?(b=!0,e=9987):(b=!1,e=9729);return new z(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:b,samplingMode:e,wrapMode:33071,flipped:!0},c)};a.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,vertexTo:void 0,geometry:a}};var J=new Map;a.createProgramDescriptor=function(a,c){if(!J.has(a)){var b=u(c),e={},g;for(g in b){var d=b[g];e[g]=d.length?d[0].stride:0}g={};for(var l in c)for(var d=0,f=c[l];d<f.length;d++){var k=
f[d];g[k.name]=k.location}J.set(a,{strides:e,bufferLayouts:b,attributes:g})}return J.get(a)}})},"esri/geometry/support/quantizationUtils":function(){define(["require","exports","./jsonUtils"],function(h,a,f){function m(a,c){return Math.round((c-a.translate[0])/a.scale[0])}function d(a,c){return Math.round((a.translate[1]-c)/a.scale[1])}function k(a,c,b){for(var e=[],g,l,f,k,n=0;n<b.length;n++){var q=b[n];if(0<n){if(f=m(a,q[0]),k=d(a,q[1]),f!==g||k!==l)e.push(c(q,f-g,k-l)),g=f,l=k}else g=m(a,q[0]),
l=d(a,q[1]),e.push(c(q,g,l))}return 0<e.length?e:null}function n(a,c,b,e){return k(a,b?e?G:D:e?D:C,c)}function g(a,c,b,e){var g=[];b=b?e?G:D:e?D:C;for(e=0;e<c.length;e++){var d=k(a,b,c[e]);d&&3<=d.length&&g.push(d)}return g.length?g:null}function e(a,c,b,e){var g=[];b=b?e?G:D:e?D:C;for(e=0;e<c.length;e++){var d=k(a,b,c[e]);d&&2<=d.length&&g.push(d)}return g.length?g:null}function c(a,c){return c*a.scale[0]+a.translate[0]}function b(a,c){return a.translate[1]-c*a.scale[1]}function l(a,e,g){var d=Array(g.length);
if(!g.length)return d;var l=a.scale,f=l[0],l=l[1],k=c(a,g[0][0]);a=b(a,g[0][1]);d[0]=e(g[0],k,a);for(var n=1;n<g.length;n++){var m=g[n],k=k+m[0]*f;a-=m[1]*l;d[n]=e(m,k,a)}return d}function y(a,c,b){for(var e=Array(b.length),g=0;g<b.length;g++)e[g]=l(a,c,b[g]);return e}function v(a,c,b,e){return l(a,b?e?G:D:e?D:C,c)}function z(a,c,b,e){return y(a,b?e?G:D:e?D:C,c)}function w(a,c,b,e){return y(a,b?e?G:D:e?D:C,c)}function p(a,c,b){var e=b[0],g=e[0],e=e[1],d=Math.min(g,c[0]),l=Math.min(e,c[1]),f=Math.max(g,
c[2]);c=Math.max(e,c[3]);for(var k=1;k<b.length;k++){var n=b[k],m=n[0],n=n[1],g=g+m,e=e+n;0>m&&(d=Math.min(d,g));0<m&&(f=Math.max(f,g));0>n?l=Math.min(l,e):0<n&&(c=Math.max(c,e))}a[0]=d;a[1]=l;a[2]=f;a[3]=c;return a}function B(a,c){if(!c.length)return null;a[0]=a[1]=Number.POSITIVE_INFINITY;a[2]=a[3]=Number.NEGATIVE_INFINITY;for(var b=0;b<c.length;b++)p(a,a,c[b]);return a}function F(a,c,b,e,g){c.xmin=m(a,b.xmin);c.ymin=d(a,b.ymin);c.xmax=m(a,b.xmax);c.ymax=d(a,b.ymax);c!==b&&(e&&(c.zmin=b.zmin,c.zmax=
b.zmax),g&&(c.mmin=b.mmin,c.mmax=b.mmax));return c}function q(a,c,b,e,g){c.points=n(a,b.points,e,g);return c}function x(a,c,b,e,g){c.x=m(a,b.x);c.y=d(a,b.y);c!==b&&(e&&(c.z=b.z),g&&(c.m=b.m));return c}function u(a,c,b,e,d){a=g(a,b.rings,e,d);if(!a)return null;c.rings=a;return c}function A(a,c,b,g,d){a=e(a,b.paths,g,d);if(!a)return null;c.paths=a;return c}Object.defineProperty(a,"__esModule",{value:!0});var C=function(a,c,b){return[c,b]},D=function(a,c,b){return[c,b,a[2]]},G=function(a,c,b){return[c,
b,a[2],a[3]]};a.toQuantizationTransform=function(a){return a?{originPosition:"upperLeft",scale:[a.tolerance,a.tolerance],translate:[a.extent.xmin,a.extent.ymax]}:null};a.equals=function(a,c){if(a===c||null==a&&null==c)return!0;if(null==a||null==c)return!1;var b,e,g,d;a&&"upperLeft"===a.originPosition?(b=a.translate[0],e=a.translate[1],a=a.scale[0]):(b=a.extent.xmin,e=a.extent.ymax,a=a.tolerance);c&&"upperLeft"===c.originPosition?(g=c.translate[0],d=c.translate[1],c=c.scale[0]):(g=c.extent.xmin,d=
c.extent.ymax,c=c.tolerance);return b===g&&e===d&&a===c};a.quantizeX=m;a.quantizeY=d;a.quantizeBounds=function(a,c,b){c[0]=m(a,b[0]);c[3]=d(a,b[1]);c[2]=m(a,b[2]);c[1]=d(a,b[3]);return c};a.quantizePoints=n;a.quantizeRings=g;a.quantizePaths=e;a.hydrateX=c;a.hydrateY=b;a.hydrateCoordsArray=l;a.hydrateCoordsArrayArray=y;a.hydrateBounds=function(a,e,g){return g?(e[0]=c(a,g[0]),e[1]=b(a,g[3]),e[2]=c(a,g[2]),e[3]=b(a,g[1]),e):[c(a,e[0]),b(a,e[3]),c(a,e[2]),b(a,e[1])]};a.hydratePoints=v;a.hydratePaths=
z;a.hydrateRings=w;a.getQuantizedBoundsCoordsArray=p;a.getQuantizedBoundsCoordsArrayArray=B;a.getQuantizedBoundsPoints=function(a){var c=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return p(c,c,a)};a.getQuantizedBoundsPaths=function(a){return B([0,0,0,0],a)};a.getQuantizedBoundsRings=function(a){return B([0,0,0,0],a)};a.quantizeExtent=F;a.quantizeMultipoint=q;a.quantizePoint=x;a.quantizePolygon=u;a.quantizePolyline=A;a.quantizeGeometry=function(a,
c){return a&&c?f.isPoint(c)?x(a,{},c,!1,!1):f.isPolyline(c)?A(a,{},c,!1,!1):f.isPolygon(c)?u(a,{},c,!1,!1):f.isMultipoint(c)?q(a,{},c,!1,!1):f.isExtent(c)?F(a,{},c,!1,!1):null:null};a.hydrateExtent=function(a,e,g,d,l){e.xmin=c(a,g.xmin);e.ymin=b(a,g.ymin);e.xmax=c(a,g.xmax);e.ymax=b(a,g.ymax);e!==g&&(d&&(e.zmin=g.zmin,e.zmax=g.zmax),l&&(e.mmin=g.mmin,e.mmax=g.mmax));return e};a.hydrateMultipoint=function(a,c,b,e,g){c.points=v(a,b.points,e,g);return c};a.hydratePoint=function(a,e,g,d,l){e.x=c(a,g.x);
e.y=b(a,g.y);e!==g&&(d&&(e.z=g.z),l&&(e.m=g.m));return e};a.hydratePolygon=function(a,c,b,e,g){c.rings=w(a,b.rings,e,g);return c};a.hydratePolyline=function(a,c,b,e,g){c.paths=z(a,b.paths,e,g);return c}})},"esri/views/2d/engine/webgl/color":function(){define(["require","exports","./number"],function(h,a,f){function m(a,g){Array.isArray(g)?(a[0]=g[0],a[1]=g[1],a[2]=g[2],a[3]=g[3]):(a[0]=g.r,a[1]=g.g,a[2]=g.b,a[3]=g.a);return a}function d(a,g,e){void 0===g&&(g=0);void 0===e&&(e=!1);var c=a[g+3];a[g+
0]*=c;a[g+1]*=c;a[g+2]*=c;e||(a[g+3]*=255);return a}Object.defineProperty(a,"__esModule",{value:!0});a.white=[255,255,255,1];var k=[0,0,0,0];a.premultiplyAlpha=d;a.copyAndPremultiply=function(a){return d(m([],a))};a.premultiplyAlphaUint32=function(a){d(m(k,a));return f.i8888to32(k[0],k[1],k[2],k[3])};a.premultiplyAlphaRGBA=function(a){var g=a.a;return f.i8888to32(a.r*g,a.g*g,a.b*g,255*g)}})},"esri/views/2d/engine/webgl/number":function(){define(["require","exports","../../../../core/Logger"],function(h,
a,f){function m(a,e,c){e=Math.max(Math.min(a,c),e);e!==a&&n.warn("Value of "+a+" exceeded rendering limitations and was clamped to "+e);return e}Object.defineProperty(a,"__esModule",{value:!0});var d=new Float32Array(1),k=new Uint32Array(d.buffer),n=f.getLogger("esri.views.2d.engine.webgl.number");a.i8=function(a){return m(a,-128,127)};a.i16=function(a){return m(a,-32768,32767)};a.i32=function(a){return m(a,-2147483648,2147483647)};a.u8=function(a){return m(a,0,255)};a.u16=function(a){return m(a,
0,65535)};a.u32=function(a){return m(a,0,4294967295)};a.nextHighestPowerOfTwo=function(a){var e=a;e--;e|=e>>1;e|=e>>2;e|=e>>4;e|=e>>8;e|=e>>16;e++;var c=e>>1;return e-a>a-c?c:e};a.toUint32=function(a){d[0]=a;return k[0]};a.toFloat32=function(a){k[0]=a;return d[0]};a.i1616to32=function(a,e){return 65535&a|e<<16};a.i8888to32=function(a,e,c,b){return a&255|(e&255)<<8|(c&255)<<16|b<<24};a.i8816to32=function(a,e,c){return a&255|(e&255)<<8|c<<16};a.numTo32=function(a){return a|0}})},"esri/views/2d/engine/webgl/SymbolProperties":function(){define(["require",
"exports","../../../../core/ObjectPool"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this.color=[0,0,0,0];this.haloColor=[0,0,0,0];this.haloSize=0;this.size=12;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=0}a.prototype.acquire=function(a,f,n,g,e,c,b,l,m){this.color=a;this.haloColor=f;this.haloSize=n;this.size=g;this.angle=e;this.offsetX=c;this.offsetY=b;this.hAnchor=l;this.vAnchor=m};a.prototype.release=function(){this.color[0]=this.color[1]=
this.color[2]=this.color[3]=0;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=this.size=this.haloSize=this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0};a.pool=new f(a);return a}();a.TextProperties=h})},"esri/views/2d/engine/webgl/util/Result":function(){define(["require","exports","../../../../../core/Error"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.ok=function(a,d){return a&&"name"in a?(d&&d.error(new f(a.name,a.message,a.details)),
!1):!0}})},"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../request"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.dataURItoBlob=function(a){var d=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var f=new ArrayBuffer(d.length),n=new Uint8Array(f),g=0;g<d.length;g++)n[g]=d.charCodeAt(g);return new Blob([f],{type:a})};a.requestImage=function(a){return f(a,{responseType:"image"}).then(function(a){return a.data})}})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["require",
"exports","../../../../core/tsSupport/declareExtendsHelper","../../../webgl/BufferObject","../../../webgl/VertexArrayObject"],function(h,a,f,m,d){return function(){function a(a,g){this.rctx=a;this._vertexBuffer=m.createVertex(a,35044,new Uint16Array(g));this._vao=new d(a,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:this._vertexBuffer})}a.prototype.bind=function(){this._vao.bind()};a.prototype.unbind=function(){this._vao.unbind()};
a.prototype.dispose=function(){this._vao.dispose(!1);this._vertexBuffer.dispose()};a.prototype.draw=function(){this.rctx.drawArrays(5,0,4)};return a}()})},"esri/views/2d/engine/webgl/brushes/WGLBrushInfo":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../definitions ../GeometryUtils ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms ../../../../webgl/BufferObject ../../../../webgl/programUtils ../../../../webgl/Texture ../../../../webgl/VertexArrayObject".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function n(){var c=a.call(this)||this;c._initialized=!1;c._color=m.vec4f32.fromValues(1,0,0,1);c._maxWidth=0;return c}f(n,a);n.prototype.dispose=function(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=
null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null);this._canvas=null};n.prototype.draw=function(a,c){a=a.context;if(c.isReady){this._initialized||this._initialize(a);a.bindVAO(this._outlineVertexArrayObject);a.bindProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3);this._outlineProgram.setUniform1f("u_coord_range",d.TILE_SIZE);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",
this._color);a.drawArrays(3,0,4);a.bindVAO();var b=this._getTexture(a,c);b&&(a.bindVAO(this._tileInfoVertexArrayObject),a.bindProgram(this._tileInfoProgram),a.bindTexture(b,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform1f("u_coord_ratio",1),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",b.descriptor.width,b.descriptor.height),a.drawArrays(5,0,4),
a.bindVAO())}};n.prototype._initialize=function(a){if(this._initialized)return!0;var d=b.createProgram(a,g.background),l=b.createProgram(a,e.tileInfo),f={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},k=new Int8Array([0,0,1,0,1,1,0,1]),k=c.createVertex(a,35044,k),k=new y(a,g.background.attributes,f,{geometry:k}),n=new Int8Array([0,0,1,0,0,1,1,1]),n=c.createVertex(a,35044,n);a=new y(a,e.tileInfo.attributes,f,{geometry:n});this._outlineProgram=d;this._tileInfoProgram=
l;this._outlineVertexArrayObject=k;this._tileInfoVertexArrayObject=a;return this._initialized=!0};n.prototype._getTexture=function(a,c){if(c.texture)return c.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","256"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var b=c.key.id,e=this._canvas.getContext("2d");e.font="24px sans-serif";e.textAlign="left";e.textBaseline=
"middle";var g=e.measureText(b),g=Math.pow(2,Math.ceil(k.log2(g.width+2)));g>this._maxWidth&&(this._maxWidth=g);e.clearRect(0,0,this._maxWidth,32);e.fillStyle="blue";e.fillText(b,0,16);c.texture=new l(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas);return c.texture};return n}(n.default);a.default=h})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["require","exports","./factories/vec4f32"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.vec4f32=
f})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return new Float32Array(4)};a.clone=function(a){var f=new Float32Array(4);f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];return f};a.fromValues=function(a,m,d,k){var f=new Float32Array(4);f[0]=a;f[1]=m;f[2]=d;f[3]=k;return f};a.createView=function(a,m){return new Float32Array(a,m,4)}})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(["require",
"exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){return function(){}}();a.default=h})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["require","exports","./sources/resolver"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.background={name:"background",shaders:{vertexShader:f.resolveIncludes("background/background.vert"),fragmentShader:f.resolveIncludes("background/background.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["require",
"exports","./sources/resolver"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.tileInfo={name:"tileInfo",shaders:{vertexShader:f.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:f.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../definitions ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/BufferObject ../../../../webgl/programUtils ../../../../webgl/VertexArrayObject".split(" "),
function(h,a,f,m,d,k,n,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function b(){var c=a.call(this)||this;c._color=m.vec4f32.fromValues(1,0,0,1);c._initialized=!1;return c}f(b,a);b.prototype.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)};b.prototype.draw=function(a,c){a=a.context;this._initialized||this._initialize(a);a.setStencilFunctionSeparate(1032,
519,c.stencilRef,255);a.bindVAO(this._solidVertexArrayObject);a.bindProgram(this._solidProgram);this._solidProgram.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3);this._solidProgram.setUniform1f("u_coord_range",d.TILE_SIZE);this._solidProgram.setUniform1f("u_depth",0);this._solidProgram.setUniform4fv("u_color",this._color);a.drawArrays(5,0,4);a.bindVAO()};b.prototype._initialize=function(a){if(this._initialized)return!0;var b=e.createProgram(a,n.background);if(!b)return!1;var d=new Int8Array([0,0,1,0,
0,1,1,1]),d=g.createVertex(a,35044,d);a=new c(a,n.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:d});this._solidProgram=b;this._solidVertexArrayObject=a;return this._initialized=!0};return b}(k.default);a.default=h})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushFill":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/RandomLCG ../definitions ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey ../../../../webgl/Texture".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function e(){var c=null!==a&&a.apply(this,arguments)||this;c._dotTextureSize=0;c._dotTextures=null;c._dotSamplers=new Int32Array([k.TEXTURE_BINDING_RENDERER_0,k.TEXTURE_BINDING_RENDERER_1]);return c}f(e,a);e.prototype.dispose=function(){this._disposeTextures()};e.prototype.getGeometryType=function(){return n.WGLGeometryType.FILL};e.prototype.drawGeometry=function(a,b,e,d){var f=a.context,l=a.painter,n=a.rendererInfo,
m=a.requiredLevel,h=a.drawPhase,p=e.indexCount,v=e.indexFrom;e=c.FillMaterialKey.load(e.materialKey);var y;y=g.createProgramDescriptor(e.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121,normalized:!0}].concat(e.dotDensity?[]:[{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_tlbr",count:4,type:5123},{location:4,name:"a_aux1",count:4,type:5121,normalized:!1},{location:5,name:"a_aux2",count:2,type:5123},{location:6,name:"a_aux3",
count:4,type:5121}],e.hasVV()?[{location:7,name:"a_vv",count:2,type:5126}]:[],e.dotDensity?[{location:2,name:"a_dd1",count:4,type:5126},{location:3,name:"a_dd2",count:4,type:5126}]:[]),visibility:[{location:8,name:"a_visible",count:1,type:5121}]});h=l.materialManager.getProgram(e,h,n,"fill",y.attributes);f.bindProgram(h);d=this._getVAO(f,y.bufferLayouts,y.attributes,d);f.bindVAO(d);this._setSharedUniforms(h,a,b);e.textureBinding&&(l.textureManager.bindTextures(f,h,e),l=1/Math.pow(2,m-b.key.level)/
a.pixelRatio,h.setUniform1f("u_zoomFactor",l));e.vvColor&&(h.setUniform1fv("u_vvColorValues",n.vvColorValues),h.setUniform4fv("u_vvColors",n.vvColors));e.vvOpacity&&(h.setUniform1fv("u_vvOpacityValues",n.vvOpacityValues),h.setUniform1fv("u_vvOpacities",n.vvOpacities));e.dotDensity&&(e=k.TILE_SIZE/n.ddDotSize,d=e*window.devicePixelRatio*e*window.devicePixelRatio,l=1/Math.pow(2,m-b.key.level),b=1/l*(1/l),a=n.ddDotScale?a.state.scale/n.ddDotScale:1,h.setUniform1f("u_tileZoomFactor",l),h.setUniform1f("u_tileDotsOverArea",
d/(k.TILE_SIZE*window.devicePixelRatio*k.TILE_SIZE*window.devicePixelRatio)),h.setUniformMatrix4fv("u_dotColors",n.ddColors),h.setUniform4fv("u_dotBackgroundColor",n.ddBackgroundColor),h.setUniform1f("u_dotValue",Math.max(1,n.ddDotValue*a*b)),this._bindDotDensityTextures(f,h,n,e));f.drawElements(4,p,5125,4*v);f.bindVAO(null)};e.prototype._disposeTextures=function(){if(this._dotTextures){for(var a=0;a<this._dotTextures.length;a++)this._dotTextures[a].dispose();this._dotTextures=null}};e.prototype._bindDotDensityTextures=
function(a,c,b,e){b=this._createDotDensityTextures(a,e,b.ddSeed);c.setUniform1iv("u_dotTextures",this._dotSamplers);for(c=0;c<b.length;c++)a.bindTexture(b[c],this._dotSamplers[c])};e.prototype._createDotDensityTextures=function(a,c,b){this._dotTextureSize!==c&&(this._disposeTextures(),this._dotTextureSize=c);null===this._dotTextures&&(this._dotTextures=[this._allocDotDensityTexture(a,c,b),this._allocDotDensityTexture(a,c,b)]);return this._dotTextures};e.prototype._allocDotDensityTexture=function(a,
c,e){e=new d(e);for(var g=new Float32Array(c*c*4),f=0;f<g.length;f++)g[f]=e.getFloat();return new b(a,{wrapMode:10497,pixelFormat:6408,dataType:5126,samplingMode:9728,width:c,height:c},g)};return e}(e.default);a.default=h})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrush":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","./WGLBrush","../../../../webgl/VertexArrayObject"],function(h,a,f,m,d){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function k(){return null!==
a&&a.apply(this,arguments)||this}f(k,a);k.prototype.draw=function(a,e){var c=this;if(e.canDisplay){var b=this.getGeometryType(),g=e.getDisplayList(a.drawPhase),d=e.getGeometry(b);d&&g.byType(b,function(b){c.drawGeometry(a,e,b,d)})}};k.prototype._getVAO=function(a,e,c,b){b.vao||(b.vao=new d(a,c,e,b.vertexBufferMap,b.indexBuffer));return b.vao};k.prototype._setSharedUniforms=function(a,e,c){a.setUniform1f("u_pixelRatio",e.pixelRatio);a.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3);a.setUniformMatrix3fv("u_displayViewMat3",
e.state.displayViewMat3);a.setUniformMatrix4fv("u_insideEffectMat4",e.rendererInfo.insideEffect);a.setUniformMatrix4fv("u_outsideEffectMat4",e.rendererInfo.outsideEffect)};return k}(m.default);a.default=h})},"esri/views/2d/engine/webgl/materialKey/MaterialKey":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../renderers ../../../../../core/Error ../../../../../core/maybe ../enums ../mesh/templates/WGLLabelTemplate ../util/vvFlagUtils".split(" "),
function(h,a,f,m,d,k,n,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});a.createMaterialKey=function(a,c,b,e){if(n.isSome(c)){a:{if("heatmap"===c.type)throw Error("Symbol processor does not support heatmap renderer");switch(a){case g.WGLGeometryType.FILL:a=v.from(c);break a;case g.WGLGeometryType.LINE:a=w.from(c,b);break a;case g.WGLGeometryType.MARKER:if("dot-density"===c.type)throw Error("Dot Density renderer does not support Marker GeometryTypes");a=z.from(c);break a;case g.WGLGeometryType.TEXT:if("dot-density"===
c.type)throw Error("Dot Density renderer does not support Text GeometryTypes");a=p.from(c);break a;case g.WGLGeometryType.LABEL:if("dot-density"===c.type)throw Error("Dot Density renderer does not support Label GeometryTypes");a=B.from(c,e);break a;default:throw Error("Unable to createMaterialKey for unknown geometryType "+a);}}return a}switch(a){case g.WGLGeometryType.FILL:return v.from(null);case g.WGLGeometryType.LINE:return w.from(null,b);case g.WGLGeometryType.MARKER:return z.from(null);case g.WGLGeometryType.TEXT:return p.from(null);
case g.WGLGeometryType.LABEL:return B.from(null,e);default:throw Error("Unable to createMaterialKey for unknown geometryType "+a);}};h=function(){function a(a){this._data=0;this._data=a}a.load=function(a){var c=this.shared;c.data=a;return c};Object.defineProperty(a.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"geometryType",{get:function(){return this.bits(5,8)},set:function(a){this.setBits(a,5,
8)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mapAligned",{get:function(){return!!this.bit(17)},set:function(a){this.setBit(17,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sdf",{get:function(){return!!this.bit(8)},set:function(a){this.setBit(8,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pattern",{get:function(){return!!this.bit(9)},set:function(a){this.setBit(9,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"textureBinding",{get:function(){return this.bits(0,5)},set:function(a){this.setBits(a,0,5)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"geometryTypeString",{get:function(){switch(this.geometryType){case g.WGLGeometryType.FILL:return"fill";case g.WGLGeometryType.MARKER:return"marker";case g.WGLGeometryType.LINE:return"line";case g.WGLGeometryType.TEXT:return"text";case g.WGLGeometryType.LABEL:return"label";default:throw new k("Unable to handle unknown geometryType: "+this.geometryType);
}},enumerable:!0,configurable:!0});a.prototype.setBit=function(a,c){a=1<<a;this._data=c?this._data|a:this._data&~a};a.prototype.bit=function(a){return(this._data&1<<a)>>a};a.prototype.setBits=function(a,c,b){for(var e=0;c<b;c++,e++)this.setBit(c,0!==(a&1<<e))};a.prototype.bits=function(a,c){for(var b=0,e=0;a<c;a++,e++)b|=this.bit(a)<<e;return b};a.prototype.hasVV=function(){return!1};a.prototype.setVV=function(a,c){};a.prototype.getVariation=function(){var a={},c;for(c in this)"boolean"===typeof this[c]&&
(a[c]=this[c]);return a};a.prototype.getVariationHash=function(){return this._data&~(4&this.textureBinding)};a.shared=new a(0);return a}();a.MaterialKeyBase=h;m=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);Object.defineProperty(b.prototype,"vvSizeMinMaxValue",{get:function(){return 0!==this.bit(13)},set:function(a){this.setBit(13,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeScaleStops",{get:function(){return 0!==
this.bit(14)},set:function(a){this.setBit(14,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeFieldStops",{get:function(){return 0!==this.bit(15)},set:function(a){this.setBit(15,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeUnitValue",{get:function(){return 0!==this.bit(16)},set:function(a){this.setBit(16,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvSizeMinMaxValue||this.vvSizeScaleStops||
this.vvSizeFieldStops||this.vvSizeUnitValue};b.prototype.setVV=function(b,e){a.prototype.setVV.call(this,b,e);b&=c.getSizeFlagsMask(b,e);this.vvSizeMinMaxValue=!!(b&g.WGLVVFlag.SIZE_MINMAX_VALUE);this.vvSizeFieldStops=!!(b&g.WGLVVFlag.SIZE_FIELD_STOPS);this.vvSizeUnitValue=!!(b&g.WGLVVFlag.SIZE_UNIT_VALUE);this.vvSizeScaleStops=!!(b&g.WGLVVFlag.SIZE_SCALE_STOPS)};return b}(a)};var b=function(a){return function(a){function c(){return null!==a&&a.apply(this,arguments)||this}f(c,a);Object.defineProperty(c.prototype,
"vvRotation",{get:function(){return 0!==this.bit(12)},set:function(a){this.setBit(12,a)},enumerable:!0,configurable:!0});c.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvRotation};c.prototype.setVV=function(c,b){a.prototype.setVV.call(this,c,b);this.vvRotation=!b&&!!(c&g.WGLVVFlag.ROTATION)};return c}(a)},l=function(a){return function(a){function c(){return null!==a&&a.apply(this,arguments)||this}f(c,a);Object.defineProperty(c.prototype,"vvColor",{get:function(){return 0!==
this.bit(10)},set:function(a){this.setBit(10,a)},enumerable:!0,configurable:!0});c.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvColor};c.prototype.setVV=function(c,b){a.prototype.setVV.call(this,c,b);this.vvColor=!b&&!!(c&g.WGLVVFlag.COLOR)};return c}(a)},y=function(a){return function(a){function c(){return null!==a&&a.apply(this,arguments)||this}f(c,a);Object.defineProperty(c.prototype,"vvOpacity",{get:function(){return 0!==this.bit(11)},set:function(a){this.setBit(11,a)},
enumerable:!0,configurable:!0});c.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvOpacity};c.prototype.setVV=function(c,b){a.prototype.setVV.call(this,c,b);this.vvOpacity=!b&&!!(c&g.WGLVVFlag.OPACITY)};return c}(a)},v=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.load=function(a){var c=this.shared;c.data=a;return c};b.from=function(a){var b=this.load(0);b.geometryType=g.WGLGeometryType.FILL;n.isSome(a)&&(a instanceof d.DotDensityRenderer?b.dotDensity=
!0:(a=c.getVVFlags(a.visualVariables),b.setVV(a,!1)));return b.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};Object.defineProperty(b.prototype,"dotDensity",{get:function(){return!!this.bit(12)},set:function(a){this.setBit(12,a)},enumerable:!0,configurable:!0});b.shared=new b(0);return b}(l(y(h)));a.FillMaterialKey=v;var z=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.load=function(a){var c=this.shared;c.data=a;return c};b.from=
function(a){var b=this.load(0);b.geometryType=g.WGLGeometryType.MARKER;n.isSome(a)&&(a=c.getVVFlags(a.visualVariables),b.setVV(a,!1));return b.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(l(y(b(m(h)))));a.MarkerMaterialKey=z;var w=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.load=function(a){var c=this.shared;c.data=a;return c};b.from=function(a,b){var e=this.load(0);e.geometryType=g.WGLGeometryType.LINE;
n.isSome(a)&&(a=c.getVVFlags(a.visualVariables),e.setVV(a,b));return e.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(l(y(m(h))));a.LineMaterialKey=w;var p=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.load=function(a){var c=this.shared;c.data=a;return c};b.from=function(a){var b=this.load(0);b.geometryType=g.WGLGeometryType.TEXT;n.isSome(a)&&(a=c.getVVFlags(a.visualVariables),b.setVV(a,!1));return b.data};
b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(l(y(b(m(h)))));a.TextMaterialKey=p;var B=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.load=function(a){var c=this.shared;c.data=a;return c};b.from=function(a,b){var d=this.load(0);d.geometryType=g.WGLGeometryType.LABEL;n.isSome(a)&&(a=c.getVVFlags(a.visualVariables),d.setVV(a,!1));d.mapAligned=!!e.isMapAligned(b.labelPlacement);return d.data};b.prototype.getVariation=
function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(m(h));a.LabelMaterialKey=B})},"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../definitions ../../enums ../../number ../../TextShaping ../../collisions/Metric ../../materialKey/MaterialKey ./GlyphGroup ./util ./WGLTextTemplate ../../../../../3d/support/mathUtils ../../../../../vectorTiles/GeometryUtils".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p,B,F,q){function x(a){switch(a){case "above-left":return[-1,-1];case "above-center":case "above-along":return[0,-1];case "above-right":return[1,-1];case "center-left":return[-1,0];case "center-center":case "center-along":return[0,0];case "center-right":return[1,0];case "below-left":return[-1,1];case "below-center":case "below-along":return[0,1];case "below-right":return[1,1];case "always-horizontal":return[0,0];default:H("Found invalid placement type "+a)}}
Object.defineProperty(a,"__esModule",{value:!0});var u=d.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),A=l.i8888to32(255,255,255,255),C=e.vec2f32.create(),D=n.mat2df32.create(),G={xOffset:0,yOffset:0,width:0,height:0},H=function(a,c){void 0===c&&(c="mapview-labeling");return u.error(new m(c,a))};a.isMapAligned=function(a){switch(a){case "above-along":case "below-along":case "center-along":return 1;default:return 0}};h=function(a){function e(c,e,g){var d=a.call(this,c,e.symbol)||this;d.geometryType=
b.WGLGeometryType.LABEL;d._refTemplate=G;var f=e.symbol,l;l=!!e.minScale&&g.scaleToZoom(e.minScale)||0;l=F.clamp(l,0,25.5);g=!!e.maxScale&&g.scaleToZoom(e.maxScale)||255;g=F.clamp(g,0,25.5);var k=x(e.labelPlacement),n=k[0],k=k[1];d._justify=(-1*n+1)/2;d._xAlignD=n;d._yAlignD=k;d._xPlacementD=n;d._yPlacementD=k;d._minZoom=l;d._maxZoom=g;c=z.LabelMaterialKey.load(z.createMaterialKey(d.geometryType,c,!1,e));c.sdf=!0;d._materialKey=c.data;f=f.font.decoration.toLowerCase();"underline"===f?d._decorationTop=
6:"line-through"===f&&(d._decorationTop=-5);return d}f(e,a);e.fromLabelClass=function(a,c,b){return new e(a,c,b)};e.prototype.bindTextInfo=function(a,c,b){a=this._computeShaping(a,this._justify).getShaping(c,b);isNaN(this._decorationTop)||y.addDecoration(a,this._decorationTop);this._shapedGlyphs=a;this._shapedBox=y.getBox(a)};e.prototype._computeShaping=function(a,b){return new y([a],c.TEXT_MAX_WIDTH,c.TEXT_LINE_HEIGHT,c.TEXT_SPACING,[0,0],.5,.5,b)};Object.defineProperty(e.prototype,"bounds",{get:function(){return this._bounds},
enumerable:!0,configurable:!0});e.prototype.bindReferenceTemplate=function(a){this._refTemplate=a||G};e.prototype._placeGlyphs=function(a,c,b,e){var g=this._size,d=this._haloSize,f=this._shapedBox,l=this._shapedGlyphs,k=this._computeGlyphTransform(f);if("esriGeometryPolyline"!==a)for(var n=0;n<b.length;n++)for(var m=b[n],h=0,p=l;h<p.length;h++){var q=p[h];m.place(q,a,c,k,this._materialKey,g,d,f,e,this._minZoom,this._maxZoom)}else for(n=0;n<b.length;n++)for(var m=b[n],h=q=m.order,p=h-(h-1)/2-1,v=p-
(p-1)/2-1,y=v-(v-1)/2-1,q=-1===q?0:h%2?p%2?v%2?y%2?0:e-3.1:e-2.1:e-1.1:e-.1,h=Math.max(e+F.log2((this._shapedBox.width*this._scale+48)/m.pathLen),Math.max(q,this._minZoom)),p=0,v=l;p<v.length;p++)q=v[p],m.place(q,a,c,k,this._materialKey,g,d,f,e,h,this._maxZoom)};e.prototype.writeMesh=function(a,e,g,d,f,k,n,m,h,p){var q=this,y=this._computeAnchors(g,f),J=l.i8888to32(0,0,0,this._bitset);if(y.length&&this._shapedGlyphs.length){this._placeGlyphs(g,f,y,h);var w=z.LabelMaterialKey.load(this._materialKey);
if("esriGeometryPolyline"!==g){g=y[0];f=this._computeGlyphTransform(this._shapedBox);f=this._createBounds(this._shapedBox,f);k=g.glyphs.get(0);var u=k[0];h=u.anchorX;var x=u.anchorY,M=Math.floor(10*u.minZoom),u=Math.floor(10*u.maxZoom),B=a.length;k.forEach(function(a){a.minZoom=25.5;a.maxZoom=25.5});this._writeVertices(a,e,d,n,k,m,w,J,M,u);k=new v.default(d,{from:B,count:a.length-B},h,x,M);h=Math.max(this._refTemplate.height,this._refTemplate.width);w.vvSizeFieldStops||w.vvSizeMinMaxValue||w.vvSizeScaleStops||
w.vvSizeUnitValue?k.setVV(l.toFloat32(n[b.VVType.SIZE]),h,this._xPlacementD,this._yPlacementD):(k.offsetX=(h/2+c.COLLISION_PLACEMENT_PADDING)*this._xPlacementD,k.offsetY=(h/2+c.COLLISION_PLACEMENT_PADDING)*this._yPlacementD);k.bounds=f;p.push(k);g.clear()}else{g=function(c){var b=y[c],g=b.x,f=b.y;c=a.length;var l=new v.default(d,{from:c,count:-1},g,f,25.5);b.glyphs.forEach(function(c){for(var k=0;k<c.length;k++){var h=c[k];h.minZoom=Math.max(b.minZoom,h.minZoom);if(h.bounds){var p=h.anchorY-f;h.bounds.center[0]+=
h.anchorX-g;h.bounds.center[1]+=p;l.add(h.bounds)}}l.bounds&&q._writeHalos(a,e,d,n,c,m,w,J)});b.glyphs.forEach(function(c){l.bounds&&q._writeText(a,e,d,n,c,m,w,J)});l.range.count=a.length-c;l.bounds&&p.push(l);b.clear()};for(f=0;f<y.length;f++)g(f);this._computedGlyphs=[]}}};e.prototype._outsideTile=function(a,c){return 0>a||512<=a||0>c||512<=c};e.prototype._smoothVertices=function(a,c){if(!(0>=c)){var b=a.length;if(!(3>b)){var e=[],g=0;e.push(0);for(var d=1;d<b;d++)g+=p.dist(a[d],a[d-1]),e.push(g);
c=Math.min(c,.2*g);g=[];g.push(a[0][0]);g.push(a[0][1]);var f=a[b-1][0],l=a[b-1][1],d=p.sub([0,0],a[0],a[1]);p.normalize(d);a[0][0]+=c*d[0];a[0][1]+=c*d[1];p.sub(d,a[b-1],a[b-2]);p.normalize(d);a[b-1][0]+=c*d[0];a[b-1][1]+=c*d[1];for(d=1;d<b;d++)e[d]+=c;e[b-1]+=c;for(var k=.5*c,d=1;d<b-1;d++){for(var n=0,m=0,h=0,q=d-1;0<=q&&!(e[q+1]<e[d]-k);q--){var v=k+e[q+1]-e[d],y=e[q+1]-e[q],z=e[d]-e[q]<k?1:v/y;if(1E-6>Math.abs(z))break;var w=z*z,J=z*v-.5*w*y,u=z*y/c,x=a[q+1],B=a[q][0]-x[0],K=a[q][1]-x[1],n=n+
u/J*(x[0]*z*v+.5*w*(v*B-y*x[0])-w*z*y*B/3),m=m+u/J*(x[1]*z*v+.5*w*(v*K-y*x[1])-w*z*y*K/3),h=h+u}for(q=d+1;q<b&&!(e[q-1]>e[d]+k);q++){v=k-e[q-1]+e[d];y=e[q]-e[q-1];z=e[q]-e[d]<k?1:v/y;if(1E-6>Math.abs(z))break;w=z*z;J=z*v-.5*w*y;u=z*y/c;x=a[q-1];B=a[q][0]-x[0];K=a[q][1]-x[1];n+=u/J*(x[0]*z*v+.5*w*(v*B-y*x[0])-w*z*y*B/3);m+=u/J*(x[1]*z*v+.5*w*(v*K-y*x[1])-w*z*y*K/3);h+=u}g.push(n/h);g.push(m/h)}g.push(f);g.push(l);for(q=d=0;d<b;d++)a[d][0]=g[q++],a[d][1]=g[q++]}}};e.prototype._computeLineAnchors=function(a,
c,b){c=c.paths;var e=this._scale*this._shapedBox.width;b=e/2+b;for(var e=e/2+16,g=this._shapedBox.width*this._scale,d=0;d<c.length;d++){var f=c[d],l=[];l.push(f[0]);for(var k=1;k<f.length;k++){var n=l[k-1],m=n[0],n=n[1],m=m+f[k][0],n=n+f[k][1];l.push([m,n])}this._smoothVertices(l,g);f=[];f.push(l[0]);for(k=1;k<l.length;k++){var n=l[k-1],h=l[k],m=Math.round(h[0]-n[0]),n=Math.round(h[1]-n[1]);f.push([m,n])}c[d]=f;l=this._getPathLength(f);if(!(l<2*e))for(var k=l/2,p=0,h=f[0][0],q=f[0][1],v=1;v<f.length;v++){var m=
f[v][0],n=f[v][1],y=Math.sqrt(m*m+n*n),p=p+y;if(0<=p-k){var z=p-k,u=y-z,J=u/y,x=h+m*J,B=q+n*J;this._outsideTile(x,B)||(p=new w.default(x,B,J,d,v,h,q,y,l,-1),a.push(p));for(var M=-1,B=0,B=u-b;0<=B;B-=b){var J=B/y,x=h+m*J,K=q+n*J;M++;this._outsideTile(x,K)||(p=new w.default(x,K,J,d,v,h,q,y,l,M),a.push(p))}p=B+b;B=y-z;J=h;x=q;for(K=v-1;0!==K;K--){var G=f[K][0],A=f[K][1],D=Math.sqrt(G*G+A*A);if(p+D>=b){for(var H=p=b-p;H<D;H+=b){var C=H/D,r=J-G*C,F=x-A*C;M++;(p=H+B+e<k)&&!this._outsideTile(r,F)&&(p=new w.default(r,
F,1-C,d,K,J-G,x-A,D,l,M),a.push(p))}p=D-(H-b)}else p+=D;B+=D;J-=G;x-=A}M=-1;for(B=u+b;B<=y;B+=b)J=B/y,x=h+m*J,u=q+n*J,M++,this._outsideTile(x,u)||(p=new w.default(x,u,J,d,v,h,q,y,l,M),a.push(p));J=h+m;x=q+n;p=y-(B-b);B=z;for(K=v+1;K<f.length;K++){m=f[K][0];n=f[K][1];h=Math.sqrt(m*m+n*n);if(p+h>=b){for(q=p=b-p;q<h;q+=b)v=q/h,y=J+m*v,z=x+n*v,M++,(p=q+B+e<k)&&!this._outsideTile(y,z)&&(p=new w.default(y,z,v,d,K,J,x,h,l,M),a.push(p));p=h-(q-b)}else p+=h;B+=h;J+=m;x+=n}break}h+=m;q+=n}}return a};e.prototype._computeAnchors=
function(a,c){var b=[];switch(a){case "esriGeometryPoint":return c=c.geometry,a=c.x,c=c.y,a=new w.default(a,c),b.push(a),b;case "esriGeometryPolygon":if(c.centroid)return c=c.centroid,a=c.x,c=c.y,a=new w.default(a,c),b.push(a),b;H("Non-centroid polygon anchor placement not supported");break;case "esriGeometryPolyline":return this._computeLineAnchors(b,c.geometry,376);default:return H("Unable to handle geometryType: "+a),b}};e.prototype._getPathLength=function(a){for(var c=0,b=1;b<a.length;b++)var e=
a[b][0],d=a[b][1],c=c+Math.sqrt(e*e+d*d);return c};e.prototype._computeGlyphTransform=function(a){var c=this._scale,b=this._angle*q.C_DEG_TO_RAD,e=a.width/2,d=a.height/2,e=this._xAlignD*e*c+(this._xOffset+this._refTemplate.xOffset)+(a.x+e);a=this._yAlignD*d*c-(this._yOffset+this._refTemplate.yOffset)-(a.y+d);d=k.mat2d.identity(D);k.mat2d.translate(d,d,g.vec2.set(C,e,a));k.mat2d.scale(d,d,g.vec2.set(C,c,c));k.mat2d.rotate(d,d,b);return d};e.prototype._writeVertex=function(a,c,e,d,g,f,k,n,m,h){e=c.get("geometry");
k=c.get("visibility");c=c.get("visibilityRange");n=n&&n[b.VVType.SIZE]||1;this._refSymbolAndPlacementOffset=l.i8888to32(f.angle,Math.min(Math.floor(Math.max(this._refTemplate.width,this._refTemplate.height)),255),this._xPlacementD+1,this._yPlacementD+1);e.push(d);e.push(g);e.push(f.vertexOffsetUpperLeft);e.push(f.texFontSizeUpperLeft);e.push(this._refSymbolAndPlacementOffset);e.push(n);k.push(m);e.push(d);e.push(g);e.push(f.vertexOffsetUpperRight);e.push(f.texFontSizeUpperRight);e.push(this._refSymbolAndPlacementOffset);
e.push(n);k.push(m);e.push(d);e.push(g);e.push(f.vertexOffsetLowerLeft);e.push(f.texFontSizeLowerLeft);e.push(this._refSymbolAndPlacementOffset);e.push(n);k.push(m);e.push(d);e.push(g);e.push(f.vertexOffsetLowerRight);e.push(f.texFontSizeLowerRight);e.push(this._refSymbolAndPlacementOffset);e.push(n);k.push(m);c.push(A);c.push(A);a.vertexCount+=4};return e}(B.default);a.default=h})},"esri/views/2d/engine/webgl/TextShaping":function(){define(["require","exports","./Rect"],function(h,a,f){return function(){function a(a,
f,n,g,e,c,b,l){this._glyphItems=a;this._maxWidth=f;this._lineHeight=n;this._letterSpacing=g;this._offset=e;this._hAnchor=c;this._vAnchor=b;this._justify=l}a.prototype.getShaping=function(a,f){for(var d=this._letterSpacing,g=this._lineHeight,e=this._justify,c=this._maxWidth,b=[],l=0,k=0,m=0,h=0,w=-1,p=0,B=-1,F=a.length,q=0;q<F;q++){var x=a.charCodeAt(q);if(10===x){if(q!==F-1){if(w>=h){var l=b[w],u=l.x+l.glyphMosaicItem.metrics.advance,p=Math.max(u,p);e&&this._applyJustification(b,h,w);h=b.length}k=
f?k-g:k+g;l=0;++m}}else{for(var u=void 0,A=0,C=this._glyphItems;A<C.length&&!(u=C[A][x]);A++);if(u){b.push({codePoint:x,x:l,y:k,glyphMosaicItem:u});l+=u.metrics.advance+d;if(0<c&&l>c&&0<=B){A=B+1;u=b[A].x;p=Math.max(u,p);for(C=A;C<b.length;C++)b[C].y=f?b[C].y-g:b[C].y+g,b[C].x-=u;e&&this._applyJustification(b,h,B);k=f?k-g:k+g;l-=u;++m;h=A;B=-1}++w;32===x&&(B=b.length-1)}}}w>=h&&(l=b[w],p=Math.max(p,l.x+l.glyphMosaicItem.metrics.advance),e&&this._applyJustification(b,h,w));if(0<b.length)for(a=(e-this._hAnchor)*
p,d=(-this._vAnchor*(m+1)+.5)*g,f&&m&&(d+=m*g),a+=this._offset[0],d+=this._offset[1],f=0;f<b.length;f++)g=b[f],g.x+=a,g.y+=d;return b};a.getBox=function(a){if(!a.length)return null;for(var d=Infinity,f=Infinity,g=0,e=0,c=0;c<a.length;c++)var b=a[c],l=b.glyphMosaicItem.metrics,m=l.height,h=b.x,b=b.y-(m-Math.abs(l.top)),l=h+l.width+l.left,m=b+m,d=Math.min(d,h),g=Math.max(g,l),f=Math.min(f,b),e=Math.max(e,m);return{x:d,y:f,width:g-d,height:e-f}};a.addDecoration=function(a,k){var d=a.length;if(0!==d){for(var g=
a[0].x+a[0].glyphMosaicItem.metrics.left,e=a[0].y,c=1;c<d;c++){var b=a[c];if(b.y!==e){var l=a[c-1].x+a[c-1].glyphMosaicItem.metrics.left+a[c-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:g,y:e+k-3,glyphMosaicItem:{sdf:!0,rect:new f(4,0,4,8),metrics:{width:l-g,height:8,left:0,top:0,advance:0},page:0}});e=b.y;g=b.x+b.glyphMosaicItem.metrics.left}}d=a[d-1].x+a[d-1].glyphMosaicItem.metrics.left+a[d-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:g,y:e+k-3,glyphMosaicItem:{sdf:!0,rect:new f(4,
0,4,8),metrics:{width:d-g,height:8,left:0,top:0,advance:0},page:0}})}};a.prototype._applyJustification=function(a,f,n){for(var d=a[n],d=(d.x+d.glyphMosaicItem.metrics.advance)*this._justify;f<=n;f++)a[f].x-=d};return a}()})},"esri/views/2d/engine/webgl/collisions/Metric":function(){define("require exports ../../../../../core/Logger ../../../../../core/libs/gl-matrix-2/vec2f32 ../definitions ./BoundingBox ../util/serializationUtils".split(" "),function(h,a,f,m,d,k,n){Object.defineProperty(a,"__esModule",
{value:!0});var g=f.getLogger("esri/views/2d/engine/webgl/collisions/Metric");h=function(){function a(a,b,e,d,g){this.id=a;this.range=b;this.boxes=null;this.minZoom=-1;this.offsetY=this.offsetX=this.directionY=this.directionX=this.size=this.vv=0;this.anchor=m.vec2f32.fromValues(e,d);this.baseZoom=g}a.prototype.add=function(a){this.bounds?(this.boxes?this.boxes.push(a):(this.boxes=[this.bounds,a],this.bounds=this.bounds.clone()),this.bounds.extend(a)):this.bounds=a};a.prototype.computeIndex=function(){var a=
this.bounds,b=this.anchor[0],e=this.anchor[1],g=Math.floor(b/d.COLLISION_BUCKET_SIZE),f=Math.floor(e/d.COLLISION_BUCKET_SIZE),k=0;if(g>d.COLLISION_TILE_BOX_SIZE||f>d.COLLISION_TILE_BOX_SIZE)f=g=d.COLLISION_TILE_BOX_SIZE,k=1;if(0>g||0>f)f=g=0,k=1;a=2*Math.max(a.halfWidth+Math.abs(a.center[0]),a.halfHeight+Math.abs(a.center[1]));b%=d.COLLISION_BUCKET_SIZE;e%=d.COLLISION_BUCKET_SIZE;this.xBucket=g;this.yBucket=f;this.xOverflow=Math.ceil(Math.abs((a-b)/d.COLLISION_BUCKET_SIZE))+k;this.yOverflow=Math.ceil(Math.abs((a-
e)/d.COLLISION_BUCKET_SIZE))+k};a.prototype.findCollisionDelta=function(a){var c=this.bounds.findCollisionDelta(a.bounds),e=this.boxes&&this.boxes.length,g=a.boxes&&a.boxes.length;return Math.abs(c)>d.COLLISION_MAX_ZOOM_DELTA||!e&&!g?c:e&&g?this._boxesToBoxes(a):e?this._boxesToBox(a):this._boxToBoxes(a)};a.prototype.computeOffset=function(a){a||g.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found "+a);a=a(this.vv);a=isNaN(this.vv)||isNaN(a)?this.size:
a;this.offsetX=this.directionX*(a/2+d.COLLISION_PLACEMENT_PADDING);this.offsetY=this.directionY*(a/2+d.COLLISION_PLACEMENT_PADDING)};a.prototype.setVV=function(a,b,e,d){this.vv=a;this.size=b;this.directionX=e;this.directionY=d};a.prototype.clone=function(){var c=new a(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);c.minZoom=this.minZoom;this.bounds&&(c.bounds=this.bounds.clone());this.boxes&&(c.boxes=this.boxes.map(function(a){return a.clone()}));c.xBucket=this.xBucket;c.yBucket=
this.yBucket;c.xOverflow=this.xOverflow;c.yOverflow=this.yOverflow;c.vv=this.vv;c.size=this.size;c.directionX=this.directionX;c.directionY=this.directionY;c.offsetX=this.offsetX;c.offsetY=this.offsetY;return c};a.prototype._boxToBoxes=function(a){var c=-Infinity,e=0;for(a=a.boxes;e<a.length;e++)var d=this.bounds.findCollisionDelta(a[e]),c=Math.max(d,c);return c};a.prototype._boxesToBox=function(a){for(var c=this.boxes[0].findCollisionDelta(a.bounds),e=1;e<this.boxes.length;e++)var d=this.boxes[e].findCollisionDelta(a.bounds),
c=Math.max(d,c);return c};a.prototype._boxesToBoxes=function(a){for(var c=-Infinity,e=0;e<this.boxes.length;e++)for(var d=this.boxes[e],g=0,f=a.boxes;g<f.length;g++)var k=d.findCollisionDelta(f[g]),c=Math.max(k,c);return c};a.prototype.serialize=function(a){a.push(this.id);this.bounds.serialize(a);a.push(this.range.from);a.push(this.range.count);a.push(this.anchor[0]);a.push(this.anchor[1]);a.push(this.baseZoom);a.writeF32(this.vv);a.push(this.size);a.push(this.directionX);a.push(this.directionY);
a.push(this.offsetX);a.push(this.offsetY);n.serializeList(a,this.boxes);return a};a.deserialize=function(c){var b=c.readInt32(),e=k.default.deserialize(c),d=c.readInt32(),g=c.readInt32(),f={from:d,count:g},m=c.readInt32(),h=c.readInt32(),B=c.readInt32(),d=c.readF32(),g=c.readInt32(),F=c.readInt32(),q=c.readInt32(),x=c.readInt32(),u=c.readInt32();c=n.deserializeList(c,k.default);b=new a(b,f,m,h,B);b.bounds=e;b.boxes=c;b.computeIndex();b.setVV(d,g,F,q);b.offsetX=x;b.offsetY=u;return b};return a}();
a.default=h})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2f32","../../../../3d/support/mathUtils"],function(h,a,f,m){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,d,g,e){this.center=f.vec2f32.fromValues(a,d);this.centerT=f.vec2f32.create();this.halfWidth=g/2;this.halfHeight=e/2;this.width=g;this.height=e}Object.defineProperty(a.prototype,"x",{get:function(){return this.center[0]},
set:function(a){this.center[0]=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this.center[1]},set:function(a){this.center[1]=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blX",{get:function(){return this.center[0]-this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blY",{get:function(){return this.center[1]-this.halfHeight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"trX",
{get:function(){return this.center[0]+this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"trY",{get:function(){return this.center[1]+this.halfHeight},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)};a.prototype.serialize=function(a){a.writeF32(this.center[0]);a.writeF32(this.center[1]);a.push(this.width);a.push(this.height);return a};a.prototype.findCollisionDelta=function(a){return m.log2(Math.min((a.halfWidth+
this.halfWidth)/Math.abs(a.centerT[0]-this.centerT[0]),(a.halfHeight+this.halfHeight)/Math.abs(a.centerT[1]-this.centerT[1])))};a.prototype.extend=function(a){var d=Math.min(this.blX,a.blX),g=Math.min(this.blY,a.blY),e=Math.max(this.trY,a.trY);this.width=Math.max(this.trX,a.trX)-d;this.height=e-g;this.halfWidth=this.width/2;this.halfHeight=this.height/2;this.x=d+this.halfWidth;this.y=g+this.halfHeight};a.deserialize=function(d){var f=d.readF32(),g=d.readF32(),e=d.readInt32();d=d.readInt32();return new a(f,
g,e,d)};return a}();a.default=h})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.serializeList=function(a,m){if(null===m)a.push(0);else{a.push(m.length);for(var d=0;d<m.length;d++)m[d].serialize(a);return a}};a.deserializeList=function(a,m,d){for(var f=a.readInt32(),f=Array(f),n=0;n<f.length;n++)f[n]=m.deserialize(a,d);return f}})},"esri/views/2d/engine/webgl/mesh/templates/GlyphGroup":function(){define("require exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../definitions ../../materialKey/MaterialKey ./ComputedGlyph ./util ../../../../../3d/support/mathUtils".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b){Object.defineProperty(a,"__esModule",{value:!0});var l=m.getLogger("esri.views.2d.engine.webgl.GlyphGroup");h=function(){function a(a,c,b,e,d,g,f,l,k,n){void 0===b&&(b=0);void 0===e&&(e=-1);void 0===d&&(d=-1);void 0===g&&(g=-1);void 0===f&&(f=-1);void 0===l&&(l=-1);void 0===k&&(k=0);void 0===n&&(n=-1);this.x=a;this.y=c;this.t=b;this.i=e;this.j=d;this.segmentPosX=g;this.segmentPosY=f;this.segmentLen=l;this.pathLen=k;this.order=n;this._glyphs=new Map;this.minZoom=0}Object.defineProperty(a.prototype,
"glyphs",{get:function(){return this._glyphs},enumerable:!0,configurable:!0});a.prototype.add=function(a,c){var b=this._glyphs.get(c);b?b.push(a):this._glyphs.set(c,[a])};a.prototype.clear=function(){this._glyphs.clear()};a.prototype.place=function(a,c,b,d,k,n,m,h,y,A,C){var p=a.x,q=a.y,v=a.codePoint,z=a.glyphMosaicItem;k=g.MaterialKeyBase.load(k);k.textureBinding=a.glyphMosaicItem.textureBinding;switch(c){case "esriGeometryPoint":case "esriGeometryPolygon":a=e.default.from(p,q,this.x,this.y,-1,A,
C,z,v,k.data,d,n,m);this.add(a,0);break;case "esriGeometryPolyline":c=b.geometry;this._placeGlyphAlongLine(a,k.data,c,d,h,n,m,y,A,C,-1);this._placeGlyphAlongLine(a,k.data,c,d,h,n,m,y,A,C,1);break;case "esriGeometryMultipoint":case "esriGeometryEnvelope":a=void 0,void 0===a&&(a="mapview-labeling"),l.error(new f(a,"Cannot place for unsupported geometryType: "+c))}};a.prototype._findLabelTheta=function(a,c,b,e){c*=e;a=Math.acos((0*c+-1*e*-a)/(1*b));0<c&&(a=2*Math.PI-a);return a};a.prototype._placeGlyphAlongLine=
function(a,g,f,l,m,h,q,y,u,A,C){f=f.paths[this.i];var p=f[this.j],v=p[0],z=p[1],p=a.x,w=a.y,x=a.glyphMosaicItem,J=a.codePoint,B=a.glyphMosaicItem.metrics,B=(a.x+B.left+B.width/2)*h/24;a=C*b.sign(B)||1;var B=Math.abs(B),M=c.len(v,z),P=this._findLabelTheta(v,z,M,C),N=(a+1)/2,M=-a*(-1*N+this.t)*M,F=d.mat2d.rotate(k.mat2df32.create(),l,-P),U=48<m.height;m=0===M?A:Math.max(Math.max(y+b.log2(Math.abs(B/M)),0),u);U&&(m=u);A=e.default.from(p,w,this.x,this.y,P,m,A,x,J,g,F,h,q,U||m<=y&&A>=y&&1===C);this.add(A,
this.j);if(!U)for(A=this.segmentPosX+N*v,v=this.segmentPosY+N*z,F=m,z=this.j+a;0<z&&z<f.length;z+=a){var S=A,V=v,N=f[z];m=N[0];var N=N[1],R=c.len(m,N),U=this._findLabelTheta(m,N,R,C),U=d.mat2d.rotate(k.mat2df32.create(),l,-U),S=S+-a*m/R*M,V=V+-a*N/R*M,M=M+R,R=F-.1,F=0===M?R:Math.max(Math.max(y+b.log2(Math.abs(B/M)),0),u),U=e.default.from(p,w,S,V,P,F,R,x,J,g,U,h,q,F<=y&&R>=y&&1===C);this.add(U,z);if(F<y-n.COLLISION_MAX_ZOOM_DELTA){this.minZoom=Math.max(F,this.minZoom);break}A+=a*m;v+=a*N}};return a}();
a.default=h})},"esri/views/2d/engine/webgl/mesh/templates/ComputedGlyph":function(){define("require exports ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../definitions ../../number ../../collisions/BoundingBox".split(" "),function(h,a,f,m,d,k,n){Object.defineProperty(a,"__esModule",{value:!0});var g=m.vec2f32.create();h=function(){function a(a,b,e,d,g,f,k,n,m,h,q,x,u,A,C){this.anchorX=a;this.anchorY=b;this.angle=e;this.bounds=d;this.minZoom=g;this.maxZoom=
f;this.materialKey=k;this.vertexOffsetUpperLeft=n;this.vertexOffsetUpperRight=m;this.vertexOffsetLowerLeft=h;this.vertexOffsetLowerRight=q;this.texFontSizeUpperLeft=x;this.texFontSizeUpperRight=u;this.texFontSizeLowerLeft=A;this.texFontSizeLowerRight=C}a.from=function(c,b,e,m,h,z,w,p,B,F,q,x,u,A,C){void 0===A&&(A=!1);void 0===C&&(C=!1);var l=p.rect,v=p.metrics;h=-1===h?255:Math.floor(180*h/Math.PI/360*254);var y=Math.round(l.x/4),I=Math.round(l.y/4);p=y+Math.round(l.width/4);var L=I+Math.round(l.height/
4),J=-24-v.top,K=v.left,M=-v.top,P=l.width,l=l.height;B||(C||(J=0),K=4,P=v.width);c+=K;B=C?b+M:b+J;P=c+P;J=B;b=c;M=B+l;l=P;C=M;var K=b+v.width,N=M-v.height,T=v.width*x/24,v=v.height*x/24;q&&(f.vec2.transformMat2d(g,f.vec2.set(g,c,B),q),c=g[0],B=g[1],f.vec2.transformMat2d(g,f.vec2.set(g,P,J),q),P=g[0],J=g[1],f.vec2.transformMat2d(g,f.vec2.set(g,b,M),q),b=g[0],M=g[1],f.vec2.transformMat2d(g,f.vec2.set(g,l,C),q),l=g[0],C=g[1],f.vec2.transformMat2d(g,f.vec2.set(g,K,N),q),K=g[0],N=g[1]);q=A?new n.default(K,
N,T+d.COLLISION_BOX_PADDING,v+d.COLLISION_BOX_PADDING):null;A=k.i1616to32(8*c,8*B);v=k.i1616to32(8*P,8*J);c=k.i1616to32(8*b,8*M);b=k.i1616to32(8*l,8*C);l=k.i8888to32(y,I,x,u);I=k.i8888to32(p,I,x,u);y=k.i8888to32(y,L,x,u);x=k.i8888to32(p,L,x,u);return new a(e|0,m|0,h,q,z,w,F,A,v,c,b,l,I,y,x)};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/templates/util":function(){define(["require","exports"],function(h,a){function f(a,d){return Math.sqrt(a*a+d*d)}Object.defineProperty(a,"__esModule",
{value:!0});a.sub=function(a,d,f){a[0]=d[0]-f[0];a[1]=d[1]-f[1];return a};a.len=f;a.normalize=function(a){var d=f(a[0],a[1]);a[0]/=d;a[1]/=d};a.dist=function(a,d){return f(a[0]-d[0],a[1]-d[1])};a.isFunction=function(a){return"function"===typeof a}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../color ../../definitions ../../enums ../../fontUtils ../../number ../../TextShapingNew ../../WGLDisplayRecord ../../collisions/BoundingBox ../../materialKey/MaterialKey ./ComputedGlyph ./WGLMeshTemplate ../../util/BidiText ../../../../layers/graphics/graphicsUtils ../../../../../vectorTiles/GeometryUtils".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p,B,F,q,x,u,A,C){Object.defineProperty(a,"__esModule",{value:!0});var D=d.getLogger("esri.views.2d.engine.webgl.WGLTextTemplate"),G=g.mat2df32.create(),H=c.vec2f32.create();h=function(a){function d(c,e){var d=a.call(this)||this;d.geometryType=y.WGLGeometryType.TEXT;d._xOffset=k.pt2px(e.xoffset);d._yOffset=k.pt2px(e.yoffset);d._decorationTop=v.getFontDecorationTop(e.font);d._color=(e.color&&b.premultiplyAlphaRGBA(e.color))|0;d._haloColor=(e.haloColor&&b.premultiplyAlphaRGBA(e.haloColor))|
0;d._haloSize=Math.min(Math.floor(5*k.pt2px(k.toPt(e.haloSize||0))),127);d._size=Math.min(Math.round(k.pt2px(e.font.size)),127);d._scale=d._size/24;d._angle=e.angle||0;d._justify=A.getJustification(e.horizontalAlignment||"center");d._xAlignD=A.getXAnchorDirection(e.horizontalAlignment||"center");d._yAlignD=-A.getYAnchorDirection(e.verticalAlignment||"baseline");d._baseline="baseline"===(e.verticalAlignment||"baseline");d._bitset=0;c=F.MaterialKeyBase.load(F.createMaterialKey(d.geometryType,c,!1));
c.sdf=!0;d._materialKey=c.data;d.symbolId=e.id;return d}f(d,a);d.fromText=function(a,c,b){a=new d(a,c);c=u.bidiText(c.text);a.bindTextInfo(b,c[0],c[1]);a._computeGlyphs(a._shapedGlyphs,a._shapedBox);return a};d.prototype.bindTextInfo=function(a,c,b){a=this._computeShaping(a,this._justify).getShaping(c,b);isNaN(this._decorationTop)||w.addDecoration(a,this._decorationTop);this._shapedGlyphs=a;this._shapedBox=w.getBox(a)};d.prototype.writeMesh=function(a,c,b,e,d,g,f,l){g=this._computedGlyphs;var k=F.TextMaterialKey.load(this._materialKey),
n=z.i8888to32(0,0,0,this._bitset);switch(b){case "esriGeometryPoint":d=d.geometry;b=d.x;d=d.y;for(var h=0;h<g.length;h++){var p=g[h];p.anchorX=b;p.anchorY=d}this._writeVertices(a,c,e,f,g,l,k,n,0,0);break;case "esriGeometryPolygon":if(d.centroid){d=d.centroid;b=d.x;d=d.y;for(h=0;h<g.length;h++)p=g[h],p.anchorX=b,p.anchorY=d;this._writeVertices(a,c,e,f,g,l,k,n,0,0);break}case "esriGeometryMultipoint":for(var h=d.geometry.points,q=d=b=0;q<h.length;q++){p=h[q];b+=p[0];d+=p[1];for(var v=0,y=g;v<y.length;v++)p=
y[v],p.anchorX=b,p.anchorY=d;this._writeVertices(a,c,e,f,g,l,k,n,0,0)}break;default:a=void 0,void 0===a&&(a="mapview-processing"),D.error(new m(a,"Unable to handle geometryType: "+b))}};d.prototype._computeGlyphs=function(a,c){var b=Array(a.length);c=this._computeGlyphTransform(c);for(var e=F.MaterialKeyBase.load(this._materialKey),d=0;d<a.length;d++){var g=a[d],f=g.x,l=g.y,k=g.codePoint,g=g.glyphMosaicItem;e.textureBinding=g.textureBinding;b[d]=q.default.from(f,l,0,0,-1,0,25,g,k,e.data,c,this._size,
this._haloSize,!1,!0)}this._computedGlyphs=b};d.prototype._createBounds=function(a,b){var d=a.width/2,g=a.height/2,f=b[4],k=b[5],n;if(this._angle){a=c.vec2f32.fromValues(-d,-g);n=c.vec2f32.fromValues(d,-g);var m=c.vec2f32.fromValues(-d,g),h=c.vec2f32.fromValues(d,g);e.vec2.transformMat2d(a,a,b);e.vec2.transformMat2d(n,n,b);e.vec2.transformMat2d(m,m,b);e.vec2.transformMat2d(h,h,b);b=g=Infinity;var p=0,q=d=0;for(a=[a,n,m,h];q<a.length;q++)n=a[q],g=Math.min(n[0],g),p=Math.max(n[0],p),b=Math.min(n[1],
b),d=Math.max(n[1],d);n=p-g;a=d-b}else n=a.width*this._scale,a=a.height*this._scale;return new B.default(f,k,n+l.COLLISION_BOX_PADDING,a+l.COLLISION_BOX_PADDING)};d.prototype._computeShaping=function(a,c){return new w([a],512,l.TEXT_LINE_HEIGHT,l.TEXT_SPACING,[0,.5*-l.TEXT_LINE_HEIGHT],.5*(1-this._xAlignD),0,c)};d.prototype._computeGlyphTransform=function(a){var c=this._scale,b=this._angle*C.C_DEG_TO_RAD,d=n.mat2d.identity(G);n.mat2d.rotate(d,d,b);n.mat2d.translate(d,d,e.vec2.set(H,this._xOffset,
-this._yOffset));n.mat2d.scale(d,d,e.vec2.set(H,c,c));n.mat2d.translate(d,d,e.vec2.set(H,-4,-4-(this._baseline?25:a.y+(1-this._yAlignD)*a.height*.5)));return d};d.prototype._writeVertices=function(a,c,b,e,d,g,f,l,k,n){this._writeHalos(a,c,b,e,d,g,f,l,k,n);this._writeText(a,c,b,e,d,g,f,l,k,n)};d.prototype._writeHalos=function(a,c,b,e,d,g,f,l,k,n){var m=c.indexVector;f=f.hasVV();var h=c.getVector("geometry").vertexCount,q=0;if(this._haloSize)for(var v=0;v<d.length;v++,q+=4){var y=d[v],w=z.i1616to32(2*
y.anchorX+1,2*y.anchorY),u=new p(b,this.geometryType,y.materialKey,null==k?Math.floor(10*y.minZoom):k,null==n?Math.floor(10*y.maxZoom):n);u.vertexFrom=h+q;u.indexFrom=m.length;this._writeVertex(u,c,b,w,this._haloColor,y,f,e,g,l);this._writeIndices(u,m,h+q);a.push(u)}};d.prototype._writeText=function(a,c,b,e,d,g,f,l,k,n){var m=c.indexVector;f=f.hasVV();for(var h=c.getVector("geometry").vertexCount,q=0,v=0;v<d.length;v++,q+=4){var y=d[v],u=z.i1616to32(2*y.anchorX,2*y.anchorY),w=new p(b,this.geometryType,
y.materialKey,null==k?Math.floor(10*y.minZoom):k,null==n?Math.floor(10*y.maxZoom):n);w.vertexFrom=h+q;w.indexFrom=m.length;this._writeVertex(w,c,b,u,this._color,y,f,e,g,l);this._writeIndices(w,m,h+q);a.push(w)}};d.prototype._writeVertex=function(a,c,b,e,d,g,f,l,k,n){var m=c.get("geometry");c=c.get("visibility");m.push(e);m.push(b);m.push(d);m.push(g.vertexOffsetUpperLeft);m.push(g.texFontSizeUpperLeft);m.push(n);this._writeVV(m,l,f);c.push(k);m.push(e);m.push(b);m.push(d);m.push(g.vertexOffsetUpperRight);
m.push(g.texFontSizeUpperRight);m.push(n);this._writeVV(m,l,f);c.push(k);m.push(e);m.push(b);m.push(d);m.push(g.vertexOffsetLowerLeft);m.push(g.texFontSizeLowerLeft);m.push(n);this._writeVV(m,l,f);c.push(k);m.push(e);m.push(b);m.push(d);m.push(g.vertexOffsetLowerRight);m.push(g.texFontSizeLowerRight);m.push(n);this._writeVV(m,l,f);c.push(k);a.vertexCount+=4};d.prototype._writeVV=function(a,c,b){b&&(a.push(c[y.VVType.SIZE]),a.push(c[y.VVType.COLOR]),a.push(c[y.VVType.OPACITY]),a.push(c[y.VVType.ROTATION]))};
d.prototype._writeIndices=function(a,c,b){c.push(b+0);c.push(b+1);c.push(b+2);c.push(b+1);c.push(b+3);c.push(b+2);a.indexCount+=6};return d}(x.default);a.default=h})},"esri/views/2d/engine/webgl/TextShapingNew":function(){define(["require","exports","./Rect"],function(h,a,f){return function(){function a(a,f,n,g,e,c,b,l){this._glyphItems=a;this._maxWidth=f;this._lineHeight=n;this._letterSpacing=g;this._offset=e;this._hAnchor=c;this._vAnchor=b;this._justify=l}a.prototype.getShaping=function(a,f){for(var d=
this._letterSpacing,g=this._lineHeight,e=this._justify,c=this._maxWidth,b=[],l=0,k=0,m=0,h=0,w=-1,p=0,B=-1,F=a.length,q=0;q<F;q++){var x=a.charCodeAt(q);if(10===x){if(q!==F-1){if(w>=h){var l=b[w],u=l.x+l.glyphMosaicItem.metrics.advance,p=Math.max(u,p);e&&this._applyJustification(b,h,w);h=b.length}k=f?k-g:k+g;l=0;++m}}else{for(var u=void 0,A=0,C=this._glyphItems;A<C.length&&!(u=C[A][x]);A++);if(u){b.push({codePoint:x,x:l,y:k,glyphMosaicItem:u});l+=u.metrics.advance+d;if(0<c&&l>c&&0<=B){A=B+1;u=b[A].x;
p=Math.max(u,p);for(C=A;C<b.length;C++)b[C].y=f?b[C].y-g:b[C].y+g,b[C].x-=u;e&&this._applyJustification(b,h,B);k=f?k-g:k+g;l-=u;++m;h=A;B=-1}++w;32===x&&(B=b.length-1)}}}w>=h&&(l=b[w],p=Math.max(p,l.x+l.glyphMosaicItem.metrics.advance),e&&this._applyJustification(b,h,w));if(0<b.length)for(a=(e-this._hAnchor)*p,d=(-this._vAnchor*(m+1)+.5)*g,f&&m&&(d+=m*g),a+=this._offset[0],d+=this._offset[1],f=0;f<b.length;f++)g=b[f],g.x+=a,g.y+=d;return b};a.prototype.getEstimatedShaping=function(a,f,n){for(var d=
this._letterSpacing,e=this._lineHeight,c=this._justify,b=this._maxWidth,l=[],k=0,m=0,h=0,w=0,p=-1,B=0,F=-1,q=a.length,x=0;x<q;x++){var u=a.charCodeAt(x);if(10===u){if(x!==q-1){if(p>=w){var k=l[p],A=k.x+k.glyphMosaicItem.metrics.advance,B=Math.max(A,B);c&&this._applyJustification(l,w,p);w=l.length}m=f?m-e:m+e;k=0;++h}}else{A=n;l.push({codePoint:u,x:k,y:m,glyphMosaicItem:A});k+=A.metrics.advance+d;if(0<b&&k>b&&0<=F){for(var C=F+1,A=l[C].x,B=Math.max(A,B),D=C;D<l.length;D++)l[D].y=f?l[D].y-e:l[D].y+
e,l[D].x-=A;c&&this._applyJustification(l,w,F);m=f?m-e:m+e;k-=A;++h;w=C;F=-1}++p;32===u&&(F=l.length-1)}}p>=w&&(k=l[p],B=Math.max(B,k.x+k.glyphMosaicItem.metrics.advance),c&&this._applyJustification(l,w,p));if(0<l.length)for(a=(c-this._hAnchor)*B,n=(-this._vAnchor*(h+1)+.5)*e,f&&h&&(n+=h*e),a+=this._offset[0],n+=this._offset[1],f=0;f<l.length;f++)e=l[f],e.x+=a,e.y+=n;return l};a.getBox=function(a){if(!a.length)return null;for(var d=Infinity,f=Infinity,g=-Infinity,e=-Infinity,c=0;c<a.length;c++)var b=
a[c],l=b.glyphMosaicItem.metrics,m=b.x+l.left,b=b.y-l.top,h=m+l.width,l=b+l.height,d=Math.min(d,m),g=Math.max(g,h),f=Math.min(f,b),e=Math.max(e,l);return{x:d,y:f,width:g-d,height:e-f}};a.addDecoration=function(a,k){var d=a.length;if(0!==d){for(var g=a[0].x+a[0].glyphMosaicItem.metrics.left,e=a[0].y,c=1;c<d;c++){var b=a[c];if(b.y!==e){var l=a[c-1].x+a[c-1].glyphMosaicItem.metrics.left+a[c-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:g,y:e,glyphMosaicItem:{sdf:!0,rect:new f(4,0,4,8),metrics:{width:l-
g,height:2,left:0,top:k,advance:0},page:0}});e=b.y;g=b.x+b.glyphMosaicItem.metrics.left}}d=a[d-1].x+a[d-1].glyphMosaicItem.metrics.left+a[d-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:g,y:e,glyphMosaicItem:{sdf:!0,rect:new f(4,0,4,8),metrics:{width:d-g,height:2,left:0,top:k,advance:0},page:0}})}};a.prototype._applyJustification=function(a,f,n){for(var d=a[n],d=(d.x+d.glyphMosaicItem.metrics.advance)*this._justify;f<=n;f++)a[f].x-=d};return a}()})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define(["require",
"exports","./MeshData","./Utils"],function(h,a,f,m){return function(){function a(a,d,g,e,c){void 0===e&&(e=0);void 0===c&&(c=0);this.id=a;this.geometryType=d;this.materialKey=g;this.minZoom=e;this.maxZoom=c;this.meshData=null;this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0}Object.defineProperty(a.prototype,"sortKey",{get:function(){void 0===this._sortKey&&this._computeSortKey();return this._sortKey},enumerable:!0,configurable:!0});a.prototype.clone=function(){return this.copy()};
a.prototype.copy=function(){var d=new a(this.id,this.geometryType,this.materialKey);d.vertexFrom=this.vertexFrom;d.vertexCount=this.vertexCount;d.indexFrom=this.indexFrom;d.indexCount=this.indexCount;d.zOrder=this.zOrder;d.symbolLevel=this.symbolLevel;d.meshData=this.meshData;d.minZoom=this.minZoom;d.maxZoom=this.maxZoom;return d};a.prototype.setMeshDataFromBuffers=function(a,d,g){var e=new f,c;for(c in d){for(var b=d[c].stride,l=d[c].data,k=[],n=m.strideToPackingFactor(b),h=0;h<b*a.vertexCount/n;++h)k[h]=
l[h+b*a.vertexFrom/n];e.vertexData.set(c,k)}for(h=e.indexData.length=0;h<a.indexCount;++h)e.indexData[h]=g[h+a.indexFrom]-a.vertexFrom;e.vertexCount=a.vertexCount;this.meshData=e};a.prototype.readMeshDataFromBuffers=function(a,d){this.meshData?this.meshData.clear():this.meshData=new f;for(var g in a){for(var e=a[g].stride,c=a[g].data,b=[],l=m.strideToPackingFactor(e),k=0;k<e*this.vertexCount/l;++k)b[k]=c[k+e*this.vertexFrom/l];this.meshData.vertexData.set(g,b)}for(k=this.meshData.indexData.length=
0;k<this.indexCount;++k)this.meshData.indexData[k]=d[k+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount};a.prototype.writeMeshDataToBuffers=function(a,d,g,e){for(var c in d)for(var b=d[c].stride,f=this.meshData.vertexData.get(c),k=d[c].data,n=m.strideToPackingFactor(b),h=0;h<b*this.meshData.vertexCount/n;++h)k[h+b*a/n]=f[h];for(h=0;h<this.meshData.indexData.length;++h)e[h+g]=this.meshData.indexData[h]+a;this.vertexFrom=a;this.vertexCount=this.meshData.vertexCount;this.indexFrom=
g;this.indexCount=this.meshData.indexData.length};a.writeAllMeshDataToBuffers=function(a,d,g){for(var e=0,c=0,b=0;b<a.length;b++){var f=a[b];f.writeMeshDataToBuffers(e,d,c,g);e+=f.vertexCount;c+=f.indexCount}};a.prototype._computeSortKey=function(){this._sortKey=(this.symbolLevel&31)<<12|(this.zOrder&127)<<4|this.geometryType&7};a.prototype.serialize=function(a){a.push(this.geometryType);a.push(this.materialKey);a.push(this.symbolLevel);a.push(this.zOrder);a.push(this.vertexFrom);a.push(this.vertexCount);
a.push(this.indexFrom);a.push(this.indexCount);a.push(this.minZoom);a.push(this.maxZoom);return a};a.deserialize=function(d,f){var g=d.readInt32(),e=d.readInt32();f=new a(f.id,g,e);f.symbolLevel=d.readInt32();f.zOrder=d.readInt32();f.vertexFrom=d.readInt32();f.vertexCount=d.readInt32();f.indexFrom=d.readInt32();f.indexCount=d.readInt32();f.minZoom=d.readInt32();f.maxZoom=d.readInt32();return f};return a}()})},"esri/views/2d/engine/webgl/MeshData":function(){define(["require","exports"],function(h,
a){return function(){function a(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}a.prototype.clear=function(){this.vertexData.clear();this.vertexCount=0;this.indexData=[]};a.prototype.update=function(a,d,f){for(var k in a)this.vertexData.set(k,a[k]);for(k in this.vertexData)null===a[k]&&this.vertexData.delete(k);this.vertexCount=d;this.indexData=f};return a}()})},"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":function(){define(["require","exports","../../../../../../core/tsSupport/extendsHelper"],
function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){}a.prototype.bindFeature=function(a,f,n){};return a}();a.default=h})},"esri/views/2d/engine/webgl/util/BidiText":function(){define(["require","exports","dojox/string/BidiEngine"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});var m=new f;a.bidiText=function(a){if(!m.hasBidiChar(a))return[a,!1];var d;d="rtl"===m.checkContextual(a)?"IDNNN":"ICNNN";return[m.bidiTransform(a,d,"VLYSN"),!0]}})},
"dojox/string/BidiEngine":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/Stateful"],function(h,a,f){function m(a,c,b,e,f){var l=a;void 0===c&&(c=f.defInFormat);void 0===b&&(b=f.defOutFormat);void 0===e&&(e=f.defSwap);if(c!==b){var n,h=c.substring(0,1);n=c.substring(1,4);var p=b.substring(0,1),q=b.substring(1,4);"C"===n.charAt(0)&&(n=d(l),n="ltr"===n||"rtl"===n?n.toUpperCase():"L"===c.charAt(2)?"LTR":"RTL",c=h+n);"C"===q.charAt(0)&&(n=d(l),"rtl"===n?q="RTL":"ltr"===n?(l=l.split(""),
l.reverse(),n=d(l.join("")),q=n.toUpperCase()):q="L"===b.charAt(2)?"LTR":"RTL",b=p+q)}if(c===b)return a;p=c.substring(0,1);l=c.substring(1,4);h=b.substring(0,1);q=b.substring(1,4);f.inFormat=c;f.outFormat=b;f.swap=e;if("L"===p&&"VLTR"===b){if("LTR"===l)return f.dir=C,k(a,f);if("RTL"===l)return f.dir=D,k(a,f)}if("V"===p&&"V"===h)return f.dir="RTL"===l?D:C,g(a,f);if("L"===p&&"VRTL"===b)return f.dir="LTR"===l?C:D,a=k(a,f),g(a);if("VLTR"===c&&"LLTR"===b)return f.dir=C,k(a,f);if("V"===p&&"L"===h&&l!==
q)return a=g(a),"RTL"===l?m(a,"LLTR","VLTR",e,f):m(a,"LRTL","VRTL",e,f);if("VRTL"===c&&"LRTL"===b)return m(a,"LRTL","VRTL",e,f);if("L"===p&&"L"===h)return c=f.swap,f.swap=c.substr(0,1)+"N","RTL"===l?(f.dir=D,a=k(a,f),f.swap="N"+c.substr(1,2),f.dir=C,a=k(a,f)):(f.dir=C,a=k(a,f),f.swap="N"+c.substr(1,2),a=m(a,"VLTR","LRTL",f.swap,f)),a}function d(a){return(a=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(a))?"z">=a[0]?"ltr":"rtl":""}function k(a,c){a=a.split("");var e=
[];n(a,e,c);if(0!==c.hiLevel&&c.swap.substr(0,1)!==c.swap.substr(1,2))for(var d=0;d<a.length;d++)if(1===e[d]){var g=d,f;b:{f=a[d];for(var l=void 0,k=0,m=I.length-1;k<=m;)if(l=Math.floor((k+m)/2),f<I[l][0])m=l-1;else if(f>I[l][0])k=l+1;else{f=I[l][1];break b}}a[g]=f}b(2,a,e,c);b(1,a,e,c);q=e;return a.join("")}function n(a,c,b){var e=a.length,d=b.dir?fa:da,g=null,f=null,k=null,g=0,f=f=null,n=-1,m=f=null,h=[],p=[];b.hiLevel=b.dir;b.lastArabic=!1;b.hasUbatAl=!1;b.hasUbatB=!1;b.hasUbatS=!1;for(f=0;f<e;f++){var m=
f,k=a[f].charCodeAt(0),q=qa[k>>8];h[m]=q<aa?q:ra[q-aa][k&255]}for(m=0;m<e;m++){p[m]=f=l(a,h,p,m,b);g=d[g][f];f=g&240;g&=15;c[m]=k=d[g][u];if(0<f){if(16===f)for(f=n;f<m;f++)c[f]=1;n=-1}if(f=d[g][A])-1===n&&(n=m);else if(-1<n){for(f=n;f<m;f++)c[f]=k;n=-1}h[m]===ia&&(c[m]=0);b.hiLevel|=k}if(b.hasUbatS)for(a=0;a<e;a++)if(h[a]===ka)for(c[a]=b.dir,d=a-1;0<=d;d--)if(h[d]===ma)c[d]=b.dir;else break}function g(a,c){a=a.split("");if(c){var b=[];n(a,b,c);q=b}a.reverse();B.reverse();return a.join("")}function e(a){for(var c=
0;c<R.length;c++)if(a>=R[c]&&a<=ea[c])return!0;return!1}function c(a,c,b,d){for(;c*b<d&&v(a[c]);)c+=b;return c*b<d&&e(a[c])?!0:!1}function b(a,c,b,e){if(!(e.hiLevel<a))if(1!==a||e.dir!==D||e.hasUbatB){e=c.length;for(var d=0,g,f,l;d<e;){if(b[d]>=a){for(g=d+1;g<e&&b[g]>=a;)g++;for(f=g-1;d<f;d++,f--)l=c[d],c[d]=c[f],c[f]=l,l=B[d],B[d]=B[f],B[f]=l;d=g}d++}}else c.reverse(),B.reverse()}function l(a,c,b,e,d){return{UBAT_L:function(){d.lastArabic=!1;return ha},UBAT_R:function(){d.lastArabic=!1;return ca},
UBAT_ON:function(){return W},UBAT_AN:function(){return ba},UBAT_EN:function(){return d.lastArabic?ba:Y},UBAT_AL:function(){d.lastArabic=!0;d.hasUbatAl=!0;return ca},UBAT_WS:function(){return W},UBAT_CS:function(){var a,g;if(1>e||e+1>=c.length||(a=b[e-1])!==Y&&a!==ba||(g=c[e+1])!==Y&&g!==ba)return W;d.lastArabic&&(g=ba);return g===a?g:W},UBAT_ES:function(){return(0<e?b[e-1]:ia)===Y&&e+1<c.length&&c[e+1]===Y?Y:W},UBAT_ET:function(){if(0<e&&b[e-1]===Y)return Y;if(d.lastArabic)return W;for(var a=e+1,
g=c.length;a<g&&c[a]===na;)a++;return a<g&&c[a]===Y?Y:W},UBAT_NSM:function(){if("VLTR"===d.inFormat){for(var g=c.length,f=e+1;f<g&&c[f]===oa;)f++;if(f<g&&(g=a[e],f=c[f],(1425<=g&&2303>=g||64286===g)&&(f===ca||f===la)))return ca}return 1>e||c[e-1]===ia?W:b[e-1]},UBAT_B:function(){d.lastArabic=!0;d.hasUbatB=!0;return d.dir},UBAT_S:function(){d.hasUbatS=!0;return W},UBAT_LRE:function(){d.lastArabic=!1;return W},UBAT_RLE:function(){d.lastArabic=!1;return W},UBAT_LRO:function(){d.lastArabic=!1;return W},
UBAT_RLO:function(){d.lastArabic=!1;return W},UBAT_PDF:function(){d.lastArabic=!1;return W},UBAT_BN:function(){return W}}[pa[c[e]]]()}function y(a,c){for(var b=0;b<M.length;b++)if(a===M[b])return c[b];return a}function v(a){return"\u064b"<=a&&"\u0655">=a?!0:!1}function z(a){if("L"===a)return"LTR";if("R"===a)return"RTL";if("C"===a)return"CLR";if("D"===a)return"CRL"}function w(a,c){for(var b=0;b<L.length;b++)if(a===L[b])return c[b];return a}function p(a,c,b,e){for(var d=0;d<a.length;d++)if(a[d]>c||
!b&&a[d]===c)a[d]+=e}h.getObject("string",!0,dojox);h=a("dojox.string.BidiEngine",f,{inputFormat:"ILYNN",outputFormat:"VLNNN",sourceToTarget:[],targetToSource:[],levels:[],bidiTransform:function(a,b,d){this.sourceToTarget=[];this.targetToSource=[];if(!a)return"";var g=this.sourceToTarget,f=this.targetToSource,l=a.length;B=[];q=[];for(var k=0;k<l;k++)g[k]=k,f[k]=k,B[k]=k;if(!this.checkParameters(b,d))return a;b=this.inputFormat;d=this.outputFormat;var g=a,g=x,k=z(b.charAt(1)),f=z(d.charAt(1)),n="I"===
b.charAt(0)?"L":b.charAt(0),l="I"===d.charAt(0)?"L":d.charAt(0),k=n+k,f=l+f,l=b.charAt(2)+d.charAt(2);g.defInFormat=k;g.defOutFormat=f;g.defSwap=l;a=m(a,k,f,l,g);g=!1;if("R"===d.charAt(1))g=!0;else if("C"===d.charAt(1)||"D"===d.charAt(1))g=this.checkContextual(a);f=this.sourceToTarget=B;l=Array(f.length);for(k=0;k<f.length;k++)l[f[k]]=k;F=this.targetToSource=l;if(b.charAt(3)===d.charAt(3))g=a;else if("S"===d.charAt(3))if(b=g,d=!0,0===a.length)g=void 0;else{void 0===b&&(b=!0);void 0===d&&(d=!0);a=
String(a);a=a.split("");var h=0,f=1,g=a.length;b||(h=a.length-1,f=-1,g=1);for(var l=g,k=d,u=0,g=[],n=0;h*f<l;h+=f)if(e(a[h])||v(a[h])){var A;if(A="\u0644"===a[h])b:{for(var G=a,r=h+f,D=f,C=l;r*D<C&&v(G[r]);)r+=D;A=" ";if(r*D<C)for(A=G[r],G=0;G<L.length;G++)if(L[G]===A){A=!0;break b}A=!1}if(A){a[h]=0===u?w(a[h+f],J):w(a[h+f],K);h+=f;u=a;A=h;G=f;for(r=l;A*G<r&&v(u[A]);)A+=G;A*G<r&&(u[A]=" ");k&&(g[n]=h,n++);u=0}else{A=a[h];if(1===u){G=h;if(c(a,h+f,f,l))b:for(r=a[h],D=0;D<M.length;D++){if(r===M[D]){r=
T[D];break b}}else r=y(a[h],N);a[G]=r}else!0===c(a,h+f,f,l)?a[h]=y(a[h],U):a[h]=y(a[h],P);v(A)||(u=1);b:{for(G=0;G<S.length;G++)if(S[G]===A){A=!0;break b}A=!1}!0===A&&(u=0)}}else u=0;f="";for(l=0;l<a.length;l++){if(k=d){b:{for(k=0;k<g.length;k++)if(g[k]===l)break b;k=-1}k=-1<k}k?(p(F,l,!b,-1),B.splice(l,1)):f+=a[l]}g=f}else if(b=a,d=g,a=!0,0===b.length)g=void 0;else for(void 0===a&&(a=!0),void 0===d&&(d=!0),b=String(b),g="",f=[],f=b.split(""),l=0;l<b.length;l++)k=!1,"\ufe70"<=f[l]&&"\ufeff">f[l]?
(n=b.charCodeAt(l),"\ufef5"<=f[l]&&"\ufefc">=f[l]?(d?(0<l&&a&&" "===f[l-1]?g=g.substring(0,g.length-1)+"\u0644":(g+="\u0644",k=!0),g+=L[(n-65269)/2]):(g+=L[(n-65269)/2],g+="\u0644",l+1<b.length&&a&&" "===f[l+1]?l++:k=!0),k&&(p(F,l,!0,1),B.splice(l,0,B[l]))):g+=V[n-65136]):g+=f[l];this.sourceToTarget=B;this.targetToSource=F;this.levels=q;return g},_inputFormatSetter:function(a){if(!G.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=a},_outputFormatSetter:function(a){if(!G.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");
this.outputFormat=a},checkParameters:function(a,c){a?this.set("inputFormat",a):a=this.inputFormat;c?this.set("outputFormat",c):c=this.outputFormat;return a===c?!1:!0},checkContextual:function(a){a=d(a);if("ltr"!==a&&"rtl"!==a){try{a=document.dir.toLowerCase()}catch(sa){}"ltr"!==a&&"rtl"!==a&&(a="ltr")}return a},hasBidiChar:function(a){return H.test(a)}});var B=[],F=[],q=[],x={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,
hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1},u=5,A=6,C=0,D=1,G=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,H=/[\u0591-\u06ff\ufb1d-\ufefc]/,I=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],
["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]],L=["\u0622","\u0623","\u0625","\u0627"],J=["\ufef5","\ufef7","\ufef9","\ufefb"],K=["\ufef6","\ufef8","\ufefa","\ufefc"],M="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split(""),
P="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split(""),N="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split(""),
T="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split(""),U="\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split(""),
S="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split(""),V="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split(""),
R=["\u0621","\u0641"],ea=["\u063a","\u064a"],da=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],fa=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],ha=0,ca=1,Y=2,ba=3,W=4,ia=5,ka=6,la=7,ma=8,na=11,oa=12,pa="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" "),aa=100;a=ha;f=ca;var Q=Y,X=ba,r=W,ga=ia,ja=ka,t=la,Z=ma,O=
na,E=oa,qa=[aa+0,a,a,a,a,aa+1,aa+2,aa+3,f,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,aa+4,r,r,r,a,r,a,r,a,r,r,r,a,a,r,r,a,a,a,a,a,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,a,a,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,a,a,r,r,a,a,r,r,a,a,r,r,r,r,r,r,r,r,r,r,r,r,
r,r,r,r,r,r,r,r,r,r,r,a,a,a,aa+5,t,t,aa+6,aa+7],ra=[[18,18,18,18,18,18,18,18,18,ja,ga,ja,Z,ga,18,18,18,18,18,18,18,18,18,18,18,18,18,18,ga,ga,ga,ja,Z,r,r,O,O,O,r,r,r,r,r,10,9,10,9,9,Q,Q,Q,Q,Q,Q,Q,Q,Q,Q,9,r,r,r,r,r,r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,r,r,r,r,r,r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,r,r,r,r,18,18,18,18,18,18,ga,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,r,O,O,O,O,r,r,r,r,a,r,r,18,r,r,O,O,Q,Q,r,a,r,r,r,Q,a,r,r,r,r,
r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,r,a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,r,r,r,r,r,r,r,r,r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,r,r,a,a,a,a,a,a,a,r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,r,a,r,r,r,r,r,r,r,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,
E,E,E,E,E,f,E,f,E,E,f,E,E,f,E,r,r,r,r,r,r,r,r,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,r,r,r,r,r,f,f,f,f,f,r,r,r,r,r,r,r,r,r,r,r],[X,X,X,X,r,r,r,r,t,O,O,t,9,t,r,r,E,E,E,E,E,E,E,E,E,E,E,t,r,r,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,X,X,X,X,X,X,X,X,X,X,O,X,X,t,t,t,E,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,
t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,E,E,E,E,E,E,E,X,r,E,E,E,E,E,E,t,t,E,E,r,E,E,E,E,t,t,Q,Q,Q,Q,Q,Q,Q,Q,Q,Q,t,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t,r,t,t,E,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,r,r,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,E,E,E,E,E,E,E,
E,E,E,E,t,r,r,r,r,r,r,r,r,r,r,r,r,r,r,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,E,E,E,E,E,E,E,E,E,f,f,r,r,r,r,f,r,r,r,r,r],[Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,18,18,18,a,f,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,Z,ga,13,14,15,16,17,9,O,O,O,O,O,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,9,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,Z,18,18,18,18,18,r,r,r,r,r,18,18,18,18,18,18,Q,a,r,r,Q,Q,Q,Q,Q,Q,10,10,r,r,r,a,Q,Q,Q,Q,Q,Q,Q,Q,Q,Q,10,10,r,r,r,r,a,a,a,a,a,a,a,a,a,a,a,
a,a,r,r,r,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r],[a,a,a,a,a,a,a,r,r,r,r,r,r,r,r,r,r,r,r,a,a,a,a,a,r,r,r,r,r,f,E,f,f,f,f,f,f,f,f,f,f,10,f,f,f,f,f,f,f,f,f,f,f,f,f,r,f,f,f,f,f,r,f,r,f,f,r,f,f,r,f,f,f,f,f,f,f,f,f,f,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,
t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t],[E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,E,E,E,E,E,E,E,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,9,r,9,r,r,9,r,r,r,r,r,r,r,r,r,O,r,r,10,10,r,r,r,r,r,O,O,r,r,r,r,r,t,t,t,t,t,r,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,
t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,r,r,18],[r,r,r,O,O,O,r,r,r,r,r,10,9,10,9,9,Q,Q,Q,Q,Q,Q,Q,Q,Q,Q,9,r,r,r,r,r,r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,r,r,r,r,r,r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,r,r,r,r,r,r,r,r,r,r,r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,r,r,r,a,a,a,a,a,a,r,r,a,a,a,a,a,a,r,r,a,a,a,a,a,a,r,r,a,a,a,r,r,r,O,O,r,r,r,O,O,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r]];return h})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(h,a,f,m){return h("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(a){var d=this._attrPairNames;return d[a]?d[a]:d[a]={s:"_"+
a+"Setter",g:"_"+a+"Getter"}},postscript:function(a){a&&this.set(a)},_get:function(a,f){return"function"===typeof this[f.g]?this[f.g]():this[a]},get:function(a){return this._get(a,this._getAttrNames(a))},set:function(a,f){if("object"===typeof a){for(var d in a)a.hasOwnProperty(d)&&"_watchCallbacks"!=d&&this.set(d,a[d]);return this}d=this._getAttrNames(a);var g=this._get(a,d);d=this[d.s];var e;"function"===typeof d?e=d.apply(this,Array.prototype.slice.call(arguments,1)):this[a]=f;if(this._watchCallbacks){var c=
this;m(e,function(){c._watchCallbacks(a,g,f)})}return this},_changeAttrValue:function(a,f){var d=this.get(a);this[a]=f;this._watchCallbacks&&this._watchCallbacks(a,d,f);return this},watch:function(a,k){var d=this._watchCallbacks;if(!d)var g=this,d=this._watchCallbacks=function(a,b,e,f){var c=function(c){if(c){c=c.slice();for(var d=0,f=c.length;d<f;d++)c[d].call(g,a,b,e)}};c(d["_"+a]);f||c(d["*"])};k||"function"!==typeof a?a="_"+a:(k=a,a="*");var e=d[a];"object"!==typeof e&&(e=d[a]=[]);e.push(k);a=
{};a.unwatch=a.remove=function(){var a=f.indexOf(e,k);-1<a&&e.splice(a,1)};return a}})})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat2d ../../../../core/libs/gl-matrix-2/mat2df32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/boundsUtils ../../../../geometry/support/intersects ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/support/spatialReferenceUtils ../../engine/webgl/definitions ../../engine/webgl/fontUtils ../../engine/webgl/GeometryUtils ../../engine/webgl/TextShapingNew ../../engine/webgl/TileClipper ../../engine/webgl/util/BidiText".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p,B,F,q,x){function u(a){switch(a){case "left":return 1;case "right":return-1;case "center":case "justify":return 0}}function A(a){switch(a){case "top":return-1;case "middle":return 0;case "baseline":case "bottom":return 1}}function C(a){switch(a){case "left":return 0;case "right":return 1;case "center":case "justify":return.5}}function D(a,c,b,e,d){var g,l,n=f.pt2px(b.xoffset),h=f.pt2px(b.yoffset),p=B.C_DEG_TO_RAD*b.angle;d*=B.C_DEG_TO_RAD;switch(b.type){case "simple-marker":g=
l=f.pt2px(b.size);break;case "picture-marker":g=f.pt2px(b.width),l=f.pt2px(b.height)}b=m.mat2d.identity(U);m.mat2d.translate(b,b,k.vec2.set(S,a,c));m.mat2d.rotate(b,b,d-p);m.mat2d.scale(b,b,k.vec2.set(S,e,-e));m.mat2d.translate(b,b,k.vec2.set(S,n,-h));a=[0,0];k.vec2.transformMat2d(a,k.vec2.set(S,-.5*g,-.5*l),b);c=[0,0];k.vec2.transformMat2d(c,k.vec2.set(S,-.5*g,.5*l),b);e=[0,0];k.vec2.transformMat2d(e,k.vec2.set(S,.5*g,-.5*l),b);n=[0,0];k.vec2.transformMat2d(n,k.vec2.set(S,.5*g,.5*l),b);return{rings:[[a,
e,n,c,a]]}}function G(a,c,b,e,d,g){var l=A(b.verticalAlignment||"baseline"),n="baseline"===(b.verticalAlignment||"baseline"),h=f.pt2px(b.xoffset),p=f.pt2px(b.yoffset),q=f.pt2px(b.font.size)/24,v=4*q,l=n?25*q:e[1]+(1+l)*e[3]*.5;b=B.C_DEG_TO_RAD*b.angle;n=B.C_DEG_TO_RAD*g;g=m.mat2d.identity(U);m.mat2d.translate(g,g,k.vec2.set(S,a,c));m.mat2d.rotate(g,g,n-b);m.mat2d.scale(g,g,k.vec2.set(S,d,-d));m.mat2d.translate(g,g,k.vec2.set(S,h,-p));m.mat2d.translate(g,g,k.vec2.set(S,-v,-v-l));a=[0,0];k.vec2.transformMat2d(a,
k.vec2.set(S,e[0],e[1]),g);c=[0,0];k.vec2.transformMat2d(c,k.vec2.set(S,e[0],e[1]+e[3]),g);d=[0,0];k.vec2.transformMat2d(d,k.vec2.set(S,e[0]+e[2],e[1]),g);h=[0,0];k.vec2.transformMat2d(h,k.vec2.set(S,e[0]+e[2],e[1]+e[3]),g);return{rings:[[a,d,h,c,a]]}}function H(a,c,b){if(!b||0===b.glyphMosaicItems.length)return a;var e=x.bidiText(c.text),d=e[0],e=e[1],g=C(c.horizontalAlignment||"center"),l=u(c.horizontalAlignment||"center");b=(new F([b.glyphMosaicItems],w.TEXT_MAX_WIDTH,w.TEXT_LINE_HEIGHT,w.TEXT_SPACING,
[0,.5*-w.TEXT_LINE_HEIGHT],.5*(1-l),0,g)).getShaping(d,e);d=p.getFontDecorationTop(c.font);isNaN(d)||F.addDecoration(b,d);b=F.getBox(b);c=f.pt2px(c.font.size)/ba;a[0]=c*b.x;a[1]=c*b.y;a[2]=c*b.width;a[3]=c*b.height;return a}function I(a,c){return Math.ceil((a-c)/(2*c))}function L(a,c){var b;b=l.isPolygon(a)?a.rings:a.paths;for(var e=0;e<b.length;e++)for(var d=0,g=b[e];d<g.length;d++)g[d][0]+=c;return a}function J(a,c){if(!c)return a;var b=K(a,c).map(function(a){return a.extent});return 2>b.length?
b[0]||a:2<b.length?(a.xmin=c.valid[0],a.xmax=c.valid[1],a):{rings:b.map(function(a){return[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]})}}function K(a,c){var b=[],e=a.ymin,d=a.ymax,g=a.xmax-a.xmin,f=a.xmin,l=a.xmax,k,n=c.valid,m=n[0],h=n[1];k=M(a.xmin,c);var p=k.x,n=k.frameId;k=M(a.xmax,c);c=k.x;a=k.frameId;k=p===c&&0<g;if(g>2*h){g={xmin:f<l?p:c,ymin:e,xmax:h,ymax:d};f={xmin:m,ymin:e,xmax:f<l?c:p,ymax:d};l={xmin:0,ymin:e,xmax:h,ymax:d};e={xmin:m,ymin:e,xmax:0,
ymax:d};d=[];m=[];P(g,l)&&d.push(n);P(g,e)&&m.push(n);P(f,l)&&d.push(a);P(f,e)&&m.push(a);for(h=n+1;h<a;h++)d.push(h),m.push(h);b.push({extent:g,frameIds:[n]},{extent:f,frameIds:[a]},{extent:l,frameIds:d},{extent:e,frameIds:m})}else p>c||k?b.push({extent:{xmin:p,ymin:e,xmax:h,ymax:d},frameIds:[n]},{extent:{xmin:m,ymin:e,xmax:c,ymax:d},frameIds:[a]}):b.push({extent:{xmin:p,ymin:e,xmax:c,ymax:d},frameIds:[n]});return b}function M(a,c){var b=c.valid;c=b[0];var e=b[1],b=2*e,d=0;a>e?(c=Math.ceil(Math.abs(a-
e)/b),a-=c*b,d=c):a<c&&(c=Math.ceil(Math.abs(a-c)/b),a+=c*b,d=-c);return{x:a,frameId:d}}function P(a,c){var b=c.xmin,e=c.ymin,d=c.xmax;c=c.ymax;return N(a,b,e)&&N(a,b,c)&&N(a,d,c)&&N(a,d,e)}function N(a,c,b){return c>=a.xmin&&c<=a.xmax&&b>=a.ymin&&b<=a.ymax?!0:!1}function T(a,c,b){if(Array.isArray(a)){var e=a[0];if(e>c){var d=I(e,c);a[0]=e+-2*d*c}else e<b&&(d=I(e,b),a[0]=e+-2*d*b)}else e=a.x,e>c?(d=I(e,c),a.x+=-2*d*c):e<b&&(d=I(e,b),a.x+=-2*d*b);return a}Object.defineProperty(a,"__esModule",{value:!0});
var U=d.mat2df32.create(),S=n.vec2f32.create(),V=e.create();a.ensureClosedRings=function(a){if(l.isPolygon(a)){var c=0;for(a=a.rings;c<a.length;c++){var b=a[c];3>b.length||b[0][0]===b[b.length-1][0]&&b[0][1]===b[b.length-1][1]||b.push(b[0])}}};a.getBounds=function(a,b,e,d,g,f,k,n,m){if(!d)return a[0]=a[1]=a[2]=a[3]=0,b[0]=b[1]=b[2]=b[3]=0,a;var h=e.symbol;!h&&f&&(h=f.getSymbol(e,{scale:n}));if(!h)return a;if(l.isPoint(d))switch(e=d.x,d=d.y,h.type){case "simple-marker":case "picture-marker":k=D(e,
d,h,k,0);for(g=b=0;g<k.rings[0].length-1;g++)h=k.rings[0][g],h=(e-h[0])*(e-h[0])+(d-h[1])*(d-h[1]),b=Math.max(b,h);b=Math.sqrt(b);k=y.normalizeMapX(e-b,m);e=y.normalizeMapX(e+b,m);k>e&&(m=z.getInfo(m))&&(e=m.valid,m=e[1],k=e[0],e=m);a[0]=k;a[1]=d-b;a[2]=e;a[3]=d+b;break;case "text":0===b[2]&&0===b[3]&&H(b,h,g);k=G(e,d,h,b,k,0);for(g=b=0;g<k.rings[0].length-1;g++)h=k.rings[0][g],h=(e-h[0])*(e-h[0])+(d-h[1])*(d-h[1]),b=Math.max(b,h);b=Math.sqrt(b);k=y.normalizeMapX(e-b,m);e=y.normalizeMapX(e+b,m);k>
e&&(m=z.getInfo(m))&&(e=m.valid,m=e[1],k=e[0],e=m);a[0]=k;a[1]=d-b;a[2]=e;a[3]=d+b}else{c.getBoundsXY(a,d);d=b[0];if(0===d){a:switch(d=0,h.type){case "simple-fill":case "picture-fill":d=h.outline;if(!d){d=0;break a}d=d.width;break;case "simple-line":d=h.width;break;case "simple-marker":d=h.size;break;case "picture-marker":d=Math.max(h.width,h.height);break;case "text":d=[0,0,0,0],H(d,h,g),d=Math.max(d[0],d[1])}b[0]=d}d=k*d/2;a[0]-=d;a[1]-=d;a[2]+=d;a[3]+=d}return a};a.isMarkerSymbol=function(a){return"simple-marker"===
a||"picture-marker"===a||"text"===a};a.graphicGeometryToNumber=function(a){switch(a.geometry.type){case "polyline":return 1;case "polygon":case "extent":return 2}return 0};a.getXAnchorDirection=u;a.getYAnchorDirection=A;a.getJustification=C;var R=n.vec2f32.create(),ea=n.vec2f32.create(),da=n.vec2f32.create(),fa=n.vec2f32.create(),ha=n.vec2f32.create(),ca=n.vec2f32.create(),Y=n.vec2f32.create();a.isPointOnPolyline=function(a,c,b,e){k.vec2.set(da,c,b);a=a.paths;for(var d,g,f,l,n,m,h,p,q=Infinity,v=
0;v<a.length;v++){var y=a[v];if(!(2>y.length))for(var u=1;u<y.length;u++)d=y[u-1][0],f=y[u-1][1],g=y[u][0],l=y[u][1],n=Math.min(d,g)-e,m=Math.min(f,l)-e,h=Math.max(d,g)+e,p=Math.max(f,l)+e,c<n||c>h||b<m||b>p||(k.vec2.set(R,d,f),k.vec2.set(ea,g,l),k.vec2.subtract(fa,ea,R),k.vec2.subtract(ha,R,da),k.vec2.scale(ca,fa,k.vec2.dot(fa,ha)/k.vec2.dot(fa,fa)),k.vec2.subtract(Y,ha,ca),d=k.vec2.dot(Y,Y),q>d&&(q=d))}return Math.sqrt(q)<=e};a.getMarkerSymbolBounds=D;a.getTextSymbolBounds=G;a.normalizeCentralMeridian=
function(a){var e,d,g,f,k,n=null;if(!a)return null;e=a.spatialReference;d=v.getInfo(e);k=e.isWebMercator?102100:4326;g=W[k].maxX;f=W[k].minX;e=W[k].plus180Line;k=W[k].minus180Line;var m,h=a.toJSON();if(!d)return h;"mesh"===a.type?m=h:l.isPoint(h)?m=T(h,g,f):l.isMultipoint(h)?(h.points=h.points.map(function(a){return T(a,g,f)}),m=h):l.isExtent(h)?m=J(h,d):l.isPolygon(h)||l.isPolyline(h)?(c.getBoundsXY(V,h),a={xmin:V[0],ymin:V[1],xmax:V[2],ymax:V[3]},d=2*I(a.xmin,f)*g,h=0===d?h:L(h,d),a.xmin+=d,a.xmax+=
d,b.extentIntersectsPolyline(a,e)&&a.xmax!==g?n=h:b.extentIntersectsPolyline(a,k)&&a.xmin!==f?n=h:m=h):m=a.clone();return null!==n?(new q.CutVertical).cut(n,g):m};var ba=24;a.getTextSymbolSize=H;a.getTextSymbolEstimatedSize=function(a,c,b){var e=x.bidiText(c.text),d=e[0],e=e[1],g=C(c.horizontalAlignment||"center"),l=u(c.horizontalAlignment||"center");b=(new F([],w.TEXT_MAX_WIDTH,w.TEXT_LINE_HEIGHT,w.TEXT_SPACING,[0,.5*-w.TEXT_LINE_HEIGHT],.5*(1-l),0,g)).getEstimatedShaping(d,e,b);b=F.getBox(b);c=
f.pt2px(c.font.size)/ba;a[0]=c*b.x;a[1]=c*b.y;a[2]=c*b.width;a[3]=c*b.height;return a};var W={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:{paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:g.WebMercator},minus180Line:{paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:g.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],
[180,180]]],spatialReference:g.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:g.WGS84}}}})},"esri/views/2d/engine/webgl/TileClipper":function(){define(["require","exports","./definitions","./Geometry","./GeometryUtils"],function(h,a,f,m,d){Object.defineProperty(a,"__esModule",{value:!0});var k=function(){return function(a,e,c){this.ratio=a;this.x=e;this.y=c}}();h=function(){function a(a,c,b,d,g){void 0===d&&(d=8);void 0===g&&(g=8);this.lines=[];this.starts=[];this.pixelRatio=
d;this.pixelMargin=g;this.tileSize=f.TILE_SIZE*d;this.dz=a;this.yPos=c;this.xPos=b}a.prototype.setExtent=function(a){this.finalRatio=this.tileSize/a*(1<<this.dz);var c=this.pixelRatio*this.pixelMargin,c=c/this.finalRatio;a>>=this.dz;c>a&&(c=a);this.margin=c;this.xmin=a*this.xPos-c;this.ymin=a*this.yPos-c;this.xmax=this.xmin+a+2*c;this.ymax=this.ymin+a+2*c};a.prototype.reset=function(a){this.type=a;this.lines=[];this.starts=[];this.line=null;this.start=0};a.prototype.moveTo=function(a,c){this._pushLine();
this._prevIsIn=this._isIn(a,c);this._moveTo(a,c,this._prevIsIn);this._prevPt=new m.Point(a,c);this._firstPt=new m.Point(a,c);this._dist=0};a.prototype.lineTo=function(a,c){var b=this._isIn(a,c),e=new m.Point(a,c),d=m.Point.distance(this._prevPt,e),g,f,n;if(b)this._prevIsIn?this._lineTo(a,c,!0):(g=this._prevPt,f=e,a=this._intersect(f,g),this.start=this._dist+d*(1-this._r),this._lineTo(a.x,a.y,!0),this._lineTo(f.x,f.y,!0));else if(this._prevIsIn)f=this._prevPt,g=e,a=this._intersect(f,g),this._lineTo(a.x,
a.y,!0),this._lineTo(g.x,g.y,!1);else{var h=this._prevPt;if(!(h.x<=this.xmin&&e.x<=this.xmin||h.x>=this.xmax&&e.x>=this.xmax||h.y<=this.ymin&&e.y<=this.ymin||h.y>=this.ymax&&e.y>=this.ymax)){a=[];if(h.x<this.xmin&&e.x>this.xmin||h.x>this.xmin&&e.x<this.xmin)c=(this.xmin-h.x)/(e.x-h.x),n=h.y+c*(e.y-h.y),n<=this.ymin?f=!1:n>=this.ymax?f=!0:a.push(new k(c,this.xmin,n));if(h.x<this.xmax&&e.x>this.xmax||h.x>this.xmax&&e.x<this.xmax)c=(this.xmax-h.x)/(e.x-h.x),n=h.y+c*(e.y-h.y),n<=this.ymin?f=!1:n>=this.ymax?
f=!0:a.push(new k(c,this.xmax,n));if(h.y<this.ymin&&e.y>this.ymin||h.y>this.ymin&&e.y<this.ymin)c=(this.ymin-h.y)/(e.y-h.y),n=h.x+c*(e.x-h.x),n<=this.xmin?g=!1:n>=this.xmax?g=!0:a.push(new k(c,n,this.ymin));if(h.y<this.ymax&&e.y>this.ymax||h.y>this.ymax&&e.y<this.ymax)c=(this.ymax-h.y)/(e.y-h.y),n=h.x+c*(e.x-h.x),n<=this.xmin?g=!1:n>=this.xmax?g=!0:a.push(new k(c,n,this.ymax));if(0===a.length)g?f?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):f?this._lineTo(this.xmin,this.ymax,
!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this.start=this._dist+d*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this.start=this._dist+d*a[0].ratio,g=0;g<a.length;g++)this._lineTo(a[g].x,a[g].y,!0)}this._lineTo(e.x,e.y,!1)}this._dist+=d;this._prevIsIn=b;this._prevPt=e};a.prototype.close=function(){if(2<this.line.length){var a=this._firstPt,c=this._prevPt;a.x===c.x&&a.y===c.y||this.lineTo(a.x,a.y);a=this.line;for(c=a.length;4<=
c;)if(a[0].x===a[1].x&&a[0].x===a[c-2].x||a[0].y===a[1].y&&a[0].y===a[c-2].y)a.pop(),a[0].x=a[c-2].x,a[0].y=a[c-2].y,--c;else break}};a.prototype.result=function(a){void 0===a&&(a=!0);this._pushLine();if(0===this.lines.length)return null;3===this.type&&a&&n.simplify(this.tileSize,this.margin*this.finalRatio,this.lines);return this.lines};a.prototype.resultWithStarts=function(){if(2!==this.type)throw Error("Only valid for lines");this._pushLine();var a=this.lines,c=a.length;if(0===c)return null;for(var b=
[],d=0;d<c;d++)b.push({line:a[d],start:this.starts[d]||0});return b};a.prototype._isIn=function(a,c){return a>=this.xmin&&a<=this.xmax&&c>=this.ymin&&c<=this.ymax};a.prototype._intersect=function(a,c){var b,e,d;if(c.x>=this.xmin&&c.x<=this.xmax)e=c.y<=this.ymin?this.ymin:this.ymax,d=(e-a.y)/(c.y-a.y),b=a.x+d*(c.x-a.x);else if(c.y>=this.ymin&&c.y<=this.ymax)b=c.x<=this.xmin?this.xmin:this.xmax,d=(b-a.x)/(c.x-a.x),e=a.y+d*(c.y-a.y);else{e=c.y<=this.ymin?this.ymin:this.ymax;b=c.x<=this.xmin?this.xmin:
this.xmax;var g=(b-a.x)/(c.x-a.x),f=(e-a.y)/(c.y-a.y);g<f?(d=g,e=a.y+g*(c.y-a.y)):(d=f,b=a.x+f*(c.x-a.x))}this._r=d;return new m.Point(b,e)};a.prototype._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?1<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&3<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)));this.line=[];this.start=0};a.prototype._moveTo=
function(a,c,b){3!==this.type?b&&(a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),c=Math.round((c-(this.ymin+this.margin))*this.finalRatio),this.line.push(new m.Point(a,c))):(b||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),c<this.ymin&&(c=this.ymin),c>this.ymax&&(c=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),c=Math.round((c-(this.ymin+this.margin))*this.finalRatio),this.line.push(new m.Point(a,c)),this._is_v=this._is_h=!1)};a.prototype._lineTo=function(a,
c,b){if(3!==this.type)if(b){a=Math.round((a-(this.xmin+this.margin))*this.finalRatio);c=Math.round((c-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(b=this.line[this.line.length-1],b.equals(a,c)))return;this.line.push(new m.Point(a,c))}else this.line&&0<this.line.length&&this._pushLine();else if(b||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),c<this.ymin&&(c=this.ymin),c>this.ymax&&(c=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),c=Math.round((c-
(this.ymin+this.margin))*this.finalRatio),this.line&&0<this.line.length){b=this.line[this.line.length-1];var e=b.x===a,d=b.y===c;e&&d||(this._is_h&&e?(b.x=a,b.y=c,b=this.line[this.line.length-2],b.x===a&&b.y===c?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(b=this.line[this.line.length-2],this._is_h=b.x===a,this._is_v=b.y===c)):(this._is_h=b.x===a,this._is_v=b.y===c)):this._is_v&&d?(b.x=a,b.y=c,b=this.line[this.line.length-2],b.x===a&&b.y===c?(this.line.pop(),1>=this.line.length?
this._is_v=this._is_h=!1:(b=this.line[this.line.length-2],this._is_h=b.x===a,this._is_v=b.y===c)):(this._is_h=b.x===a,this._is_v=b.y===c)):(this.line.push(new m.Point(a,c)),this._is_h=e,this._is_v=d))}else this.line.push(new m.Point(a,c))};return a}();a.TileClipper=h;h=function(){function a(){}a.prototype.setExtent=function(a){this._ratio=4096===a?1:4096/a};a.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};a.prototype.moveTo=function(a,c){this.line&&this.lines.push(this.line);
this.line=[];var b=this._ratio;this.line.push(new m.Point(Math.round(a*b),Math.round(c*b)))};a.prototype.lineTo=function(a,c){var b=this._ratio;this.line.push(new m.Point(Math.round(a*b),Math.round(c*b)))};a.prototype.close=function(){var a=this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};a.prototype.result=function(){this.line&&this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&n.simplify(4096,64,this.lines);return this.lines};return a}();a.SimpleBuilder=
h;var n=function(){function a(){}a.simplify=function(e,c,b){if(b){var d=-c,g=e+c,f=-c,k=e+c;e=[];c=[];for(var h=b.length,n=0;n<h;++n){var m=b[n];if(m&&!(2>m.length))for(var F=m[0],q=void 0,x=m.length,u=1;u<x;++u)q=m[u],F.x===q.x&&(F.x<=d&&(F.y>q.y?(e.push(n),e.push(u),e.push(0),e.push(-1)):(c.push(n),c.push(u),c.push(0),c.push(-1))),F.x>=g&&(F.y<q.y?(e.push(n),e.push(u),e.push(1),e.push(-1)):(c.push(n),c.push(u),c.push(1),c.push(-1)))),F.y===q.y&&(F.y<=f&&(F.x<q.x?(e.push(n),e.push(u),e.push(2),e.push(-1)):
(c.push(n),c.push(u),c.push(2),c.push(-1))),F.y>=k&&(F.x>q.x?(e.push(n),e.push(u),e.push(3),e.push(-1)):(c.push(n),c.push(u),c.push(3),c.push(-1)))),F=q}0!==e.length&&0!==c.length&&(a.fillParent(b,c,e),a.fillParent(b,e,c),d=[],a.calcDeltas(d,c,e),a.calcDeltas(d,e,c),a.addDeltas(d,b))}};a.fillParent=function(a,c,b){for(var e=b.length,g=c.length,f=0;f<g;f+=4){for(var k=c[f],n=c[f+1],h=c[f+2],m=a[k][n-1],k=a[k][n],n=8092,F=-1,q=0;q<e;q+=4)if(b[q+2]===h){var x=b[q],u=b[q+1],A=a[x][u-1],x=a[x][u];switch(h){case 0:case 1:d.between(m.y,
A.y,x.y)&&d.between(k.y,A.y,x.y)&&(A=Math.abs(x.y-A.y),A<n&&(n=A,F=q));break;case 2:case 3:d.between(m.x,A.x,x.x)&&d.between(k.x,A.x,x.x)&&(A=Math.abs(x.x-A.x),A<n&&(n=A,F=q))}}c[f+3]=F}};a.calcDeltas=function(e,c,b){for(var d=c.length,g=0;g<d;g+=4){var f=a.calcDelta(g,c,b,[]);e.push(c[g]);e.push(c[g+1]);e.push(c[g+2]);e.push(f)}};a.calcDelta=function(e,c,b,d){e=c[e+3];if(-1===e)return 0;var g=d.length;if(1<g&&d[g-2]===e)return 0;d.push(e);return a.calcDelta(e,b,c,d)+1};a.addDeltas=function(a,c){for(var b=
a.length,e=0,d=0;d<b;d+=4){var g=a[d+3];g>e&&(e=g)}for(d=0;d<b;d+=4){var f=c[a[d]],k=a[d+1],g=e-a[d+3];switch(a[d+2]){case 0:f[k-1].x-=g;f[k].x-=g;1===k&&(f[f.length-1].x-=g);k===f.length-1&&(f[0].x-=g);break;case 1:f[k-1].x+=g;f[k].x+=g;1===k&&(f[f.length-1].x+=g);k===f.length-1&&(f[0].x+=g);break;case 2:f[k-1].y-=g;f[k].y-=g;1===k&&(f[f.length-1].y-=g);k===f.length-1&&(f[0].y-=g);break;case 3:f[k-1].y+=g,f[k].y+=g,1===k&&(f[f.length-1].y+=g),k===f.length-1&&(f[0].y+=g)}}};return a}();h=function(){function a(){this.linesIn=
[];this.linesOut=[]}a.prototype.cut=function(a,c){this.xCut=c;var b;if(a.rings)this.closed=!0,b=a.rings,this.minPts=4;else if(a.paths)this.closed=!1,b=a.paths,this.minPts=2;else return null;for(var e=0;e<b.length;e++)if((c=b[e])&&!(c.length<this.minPts)){for(var d=!0,g=0;g<c.length;g++){var f=c[g];d?(this.moveTo(f),d=!1):this.lineTo(f)}this.closed&&this.close()}this._pushLineIn();this._pushLineOut();b=[];f=0;for(e=this.linesIn;f<e.length;f++)(c=e[f])&&c.length>=this.minPts&&b.push(c);e=-2*this.xCut;
d=0;for(g=this.linesOut;d<g.length;d++)if((c=g[d])&&c.length>=this.minPts){for(var k=0,n=c;k<n.length;k++)f=n[k],f[0]+=e;b.push(c)}this.closed?a.rings=b:a.paths=b;return a};a.prototype.moveTo=function(a){this._pushLineIn();this._pushLineOut();this._prevSide=this._side(a[0]);this._moveTo(a[0],a[1],this._prevSide);this._firstPt=this._prevPt=a};a.prototype.lineTo=function(a){var c=this._side(a[0]);if(-1===c*this._prevSide){var b=this._intersect(this._prevPt,a);this._lineTo(this.xCut,b,0);this._prevSide=
0}this._lineTo(a[0],a[1],c);this._prevSide=c;this._prevPt=a};a.prototype.close=function(){var a=this._firstPt,c=this._prevPt;a[0]===c[0]&&a[1]===c[1]||this.lineTo(a);this._checkClosingPt(this.lineIn);this._checkClosingPt(this.lineOut)};a.prototype._moveTo=function(a,c,b){this.closed?(this.lineIn.push([0>=b?a:this.xCut,c]),this.lineOut.push([0<=b?a:this.xCut,c])):(0>=b&&this.lineIn.push([a,c]),0<=b&&this.lineOut.push([a,c]))};a.prototype._lineTo=function(a,c,b){this.closed?(this._addPolyVertex(this.lineIn,
0>=b?a:this.xCut,c),this._addPolyVertex(this.lineOut,0<=b?a:this.xCut,c)):0>b?(0===this._prevSide&&this._pushLineOut(),this.lineIn.push([a,c])):0<b?(0===this._prevSide&&this._pushLineIn(),this.lineOut.push([a,c])):0>this._prevSide?(this.lineIn.push([a,c]),this.lineOut.push([a,c])):0<this._prevSide&&(this.lineOut.push([a,c]),this.lineIn.push([a,c]))};a.prototype._addPolyVertex=function(a,c,b){var e=a.length;1<e&&a[e-1][0]===c&&a[e-2][0]===c?a[e-1][1]=b:a.push([c,b])};a.prototype._checkClosingPt=function(a){var c=
a.length;3<c&&a[0][0]===this.xCut&&a[c-2][0]===this.xCut&&a[1][0]===this.xCut&&(a[0][1]=a[c-2][1],a.pop())};a.prototype._side=function(a){return a<this.xCut?-1:a>this.xCut?1:0};a.prototype._intersect=function(a,c){return a[1]+(this.xCut-a[0])/(c[0]-a[0])*(c[1]-a[1])};a.prototype._pushLineIn=function(){this.lineIn&&this.lineIn.length>=this.minPts&&this.linesIn.push(this.lineIn);this.lineIn=[]};a.prototype._pushLineOut=function(){this.lineOut&&this.lineOut.length>=this.minPts&&this.linesOut.push(this.lineOut);
this.lineOut=[]};return a}();a.CutVertical=h})},"esri/views/2d/engine/webgl/util/vvFlagUtils":function(){define(["require","exports","../enums","../visualVariablesUtils"],function(h,a,f,m){function d(a,d){void 0===d&&(d=!1);var e=f.WGLVVFlag.SIZE_FIELD_STOPS|f.WGLVVFlag.SIZE_MINMAX_VALUE|f.WGLVVFlag.SIZE_SCALE_STOPS|f.WGLVVFlag.SIZE_UNIT_VALUE;a=(a&(f.WGLVVTarget.FIELD_TARGETS_OUTLINE|f.WGLVVTarget.MINMAX_TARGETS_OUTLINE|f.WGLVVTarget.SCALE_TARGETS_OUTLINE|f.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;
return d?e&a:e&~a}function k(a){var g=d(a,!1);return a&(f.WGLVVFlag.COLOR|f.WGLVVFlag.OPACITY|f.WGLVVFlag.ROTATION|g)}Object.defineProperty(a,"__esModule",{value:!0});a.getVVFlags=function(a){if(!a)return f.WGLVVFlag.NONE;for(var d=0,e=0;e<a.length;e++){var c=a[e];if("size"===c.type){var b=m.getTypeOfSizeVisualVariable(c),d=d|b;"outline"===c.target&&(d|=b<<4)}else"color"===c.type?d|=f.WGLVVFlag.COLOR:"opacity"===c.type?d|=f.WGLVVFlag.OPACITY:"rotation"===c.type&&(d|=f.WGLVVFlag.ROTATION)}return d};
a.getSizeFlagsMask=d;a.getMarkerVVFlags=k;a.getFillVVFlags=function(a){return a&(f.WGLVVFlag.COLOR|f.WGLVVFlag.OPACITY)};a.getLineVVFlags=function(a,g){if(g)return g=d(a,!0),a&g;g=d(a,!1);return a&(f.WGLVVFlag.COLOR|f.WGLVVFlag.OPACITY|g)};a.getTextVVFlags=function(a){return k(a)};a.getLabelVVFlags=function(a){var g=d(a,!1);return a&g}})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define("require exports ../../../../core/screenUtils ./color ./enums ./Utils ../../../3d/layers/support/FastSymbolUpdates".split(" "),
function(h,a,f,m,d,k,n){function g(a){return k.isNumber(a.minDataValue)&&k.isNumber(a.maxDataValue)&&null!=a.minSize&&null!=a.maxSize?d.WGLVVFlag.SIZE_MINMAX_VALUE:(a.expression&&"view.scale"===a.expression||a.valueExpression&&"$view.scale"===a.valueExpression)&&Array.isArray(a.stops)?d.WGLVVFlag.SIZE_SCALE_STOPS:(null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&Array.isArray(a.stops)?d.WGLVVFlag.SIZE_FIELD_STOPS:(null!=a.field||a.expression&&
"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&null!=a.valueUnit?d.WGLVVFlag.SIZE_UNIT_VALUE:d.WGLVVFlag.NONE}function e(a){return{value:a.value,size:f.toPt(a.size)}}function c(a){return a.map(function(a){return e(a)})}function b(a){return"string"===typeof a||"number"===typeof a?f.toPt(a):{type:"size",expression:a.expression,stops:c(a.stops)}}function l(a){var c={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(k.isString(a.field))if(a.stops){if(8<a.stops.length)return null;
var b=a.stops;for(a=0;8>a;++a){var e=b[Math.min(a,b.length-1)];c.values[a]=e.value;c.opacities[a]=e.opacity}}else return null;else if(a.stops&&0<=a.stops.length)for(b=a.stops&&0<=a.stops.length&&a.stops[0].opacity,a=0;8>a;a++)c.values[a]=Infinity,c.opacities[a]=b;else return null;return c}Object.defineProperty(a,"__esModule",{value:!0});a.getTypeOfSizeVisualVariable=g;a.getVisualVariableSizeValueRepresentationRatio=function(a,c){if(!a||!c)return a;switch(c){case "radius":case "distance":return 2*
a;case "area":return Math.sqrt(a)}return a};a.stopToSizeStop=e;a.normalizeSizeStops=c;a.normalizeSizeElement=b;a.getVisualVariablesFields=function(a){var c=a&&0<a.length?{}:null;c&&a.forEach(function(a){var b=a.type;a.field&&(c[b]=a.field)});return c};a.convertVisualVariables=function(a){var e=a&&0<a.length?{}:null,k=e?{}:null;if(!e)return{vvFields:e,vvRanges:k};for(var h=0;h<a.length;h++){var p=a[h],B=p.type;p.field&&(e[B]=p.field);if("size"===B){k.size||(k.size={});var y=p;switch(g(y)){case d.WGLVVFlag.SIZE_MINMAX_VALUE:k.size.minMaxValue=
{minDataValue:y.minDataValue,maxDataValue:y.maxDataValue,minSize:b(y.minSize),maxSize:b(y.maxSize)};break;case d.WGLVVFlag.SIZE_SCALE_STOPS:k.size.scaleStops={stops:c(y.stops)};break;case d.WGLVVFlag.SIZE_FIELD_STOPS:for(var p=[],B=[],y=c(y.stops),q=y.length,x=0;6>x;x++){var u=y[Math.min(x,q-1)];p.push(u.value);B.push(f.pt2px(u.size))}k.size.fieldStops={values:p,sizes:B};break;case d.WGLVVFlag.SIZE_UNIT_VALUE:k.size.unitValue={unit:y.valueUnit,valueRepresentation:y.valueRepresentation}}}else if("color"===
B)for(p=n.convertVisualVariables([p],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null}),k.color=p.color,x=0;32>x;x+=4)m.premultiplyAlpha(k.color.colors,x,!0);else"opacity"===B?k.opacity=l(p):"rotation"===B&&(k.rotation={type:p.rotationType})}return{vvFields:e,vvRanges:k}}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b){function l(a){return null!==a&&void 0!==a}function y(a){return"number"===typeof a}function v(a){return"string"===typeof a}function z(a,c){a&&a.push(c)}function w(a,b,e,d,g){var f=a.minSize,k=a.maxSize;if(a.expression)return z(g,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=d.symbolSize[e],b.minSize[e]=a,b.maxSize[e]=a,b.offset[e]=b.minSize[e],b.factor[e]=0,b.type[e]=1,!0;if(l(a.field)){if(l(a.stops)){if(2===a.stops.length&&
y(a.stops[0].size)&&y(a.stops[1].size))return p(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,b,e),b.type[e]=1,!0;z(g,"Could not convert size info: stops only supported with 2 elements");return!1}if(y(f)&&y(k)&&l(a.minDataValue)&&l(a.maxDataValue))return p(f,k,a.minDataValue,a.maxDataValue,b,e),b.type[e]=1,!0;if(null!=c.meterIn[a.valueUnit])return b.minSize[e]=-Infinity,b.maxSize[e]=Infinity,b.offset[e]=0,b.factor[e]=1/c.meterIn[a.valueUnit],b.type[e]=1,!0;if("unknown"===a.valueUnit)return z(g,
"Could not convert size info: proportional size not supported"),!1;z(g,"Could not convert size info: scale-dependent size not supported");return!1}if(!l(a.field)){if(a.stops&&a.stops[0]&&y(a.stops[0].size))return b.minSize[e]=a.stops[0].size,b.maxSize[e]=a.stops[0].size,b.offset[e]=b.minSize[e],b.factor[e]=0,b.type[e]=1,!0;if(y(f))return b.minSize[e]=f,b.maxSize[e]=f,b.offset[e]=f,b.factor[e]=0,b.type[e]=1,!0}z(g,"Could not convert size info: unsupported variant of sizeInfo");return!1}function p(a,
c,b,e,d,g){e=0<Math.abs(e-b)?(c-a)/(e-b):0;d.minSize[g]=0<e?a:c;d.maxSize[g]=0<e?c:a;d.offset[g]=a-b*e;d.factor[g]=e}function B(a,c,b,e){if(a.normalizationField||a.valueRepresentation)return z(e,"Could not convert size info: unsupported property"),null;var d=a.field;if(null!=d&&!v(d))return z(e,"Could not convert size info: field is not a string"),null;if(!c.size)c.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!c.size.field)c.size.field=
a.field;else if(a.field!==c.size.field)return z(e,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(d=w(a,c.size,0,b,e))?c:null;case "height":return(d=w(a,c.size,2,b,e))?c:null;case "depth":return(d=w(a,c.size,1,b,e))?c:null;case "width-and-depth":return(d=w(a,c.size,0,b,e))&&w(a,c.size,1,b,e),d?c:null;case null:case void 0:case "all":return(d=(d=(d=w(a,c.size,0,b,e))&&w(a,c.size,1,b,e))&&w(a,c.size,2,b,e))?c:null;default:return z(e,'Could not convert size info: unknown axis "'+
a.axis+'""'),null}}function F(a,c,b){for(var e=0;3>e;++e){var d=c.unitInMeters;1===a.type[e]&&(d*=c.modelSize[e],a.type[e]=2);a.minSize[e]/=d;a.maxSize[e]/=d;a.offset[e]/=d;a.factor[e]/=d}if(0!==a.type[0])c=0;else if(0!==a.type[1])c=1;else if(0!==a.type[2])c=2;else return z(b,"No size axis contains a valid size or scale"),!1;for(e=0;3>e;++e)0===a.type[e]&&(a.minSize[e]=a.minSize[c],a.maxSize[e]=a.maxSize[c],a.offset[e]=a.offset[c],a.factor[e]=a.factor[c],a.type[e]=a.type[c]);return!0}function q(a,
c,b){a[4*c+0]=b.r/255;a[4*c+1]=b.g/255;a[4*c+2]=b.b/255;a[4*c+3]=b.a}function x(a,c,b){if(a.normalizationField)return z(b,"Could not convert color info: unsupported property"),null;if(v(a.field))if(a.stops){if(8<a.stops.length)return z(b,"Could not convert color info: too many color stops"),null;c.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};b=a.stops;for(a=0;8>a;++a){var e=b[Math.min(a,b.length-1)];c.color.values[a]=e.value;
q(c.color.colors,a,e.color)}}else return z(b,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length)for(b=a.stops&&0<=a.stops.length&&a.stops[0].color,c.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=0;8>a;a++)c.color.values[a]=Infinity,q(c.color.colors,a,b);else return z(b,"Could not convert color info: no field and no colors/stops"),null;return c}function u(a,c,b){if(a.normalizationField)return z(b,
"Could not convert opacity info: unsupported property"),null;if(v(a.field))if(a.stops){if(8<a.stops.length)return z(b,"Could not convert opacity info: too many opacity stops"),null;c.opacity={field:a.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};b=a.stops;for(a=0;8>a;++a){var e=b[Math.min(a,b.length-1)];c.opacity.values[a]=e.value;c.opacity.opacityValues[a]=e.opacity}}else return z(b,"Could not convert opacity info: missing stops or opacities"),null;else if(a.stops&&0<=a.stops.length)for(b=
a.stops&&0<=a.stops.length&&a.stops[0].opacity,c.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},a=0;8>a;a++)c.opacity.values[a]=Infinity,c.opacity.opacityValues[a]=b;else return z(b,"Could not convert opacity info: no field and no opacities/stops"),null;return c}function A(a,c,b,e){a=2===b&&"arithmetic"===a.rotationType;c.offset[b]=a?90:0;c.factor[b]=a?-1:1;c.type[b]=1}function C(a,c,b){if(!v(a.field))return z(b,"Could not convert rotation info: field is not a string"),
null;if(!c.rotation)c.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!c.rotation.field)c.rotation.field=a.field;else if(a.field!==c.rotation.field)return z(b,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return A(a,c.rotation,0,b),c;case "roll":return A(a,c.rotation,1,b),c;case null:case void 0:case "heading":return A(a,c.rotation,2,b),c;default:return z(b,'Could not convert rotation info: unknown axis "'+a.axis+
'""'),null}}function D(a,c,b){if(!a)return null;var e=!c.supportedTypes||!!c.supportedTypes.size,d=!c.supportedTypes||!!c.supportedTypes.color,g=!c.supportedTypes||!!c.supportedTypes.rotation,k=!!c.supportedTypes&&!!c.supportedTypes.opacity,l=a.reduce(function(a,l){if(!a)return a;if(l.valueExpression)return z(b,"Could not convert visual variables: arcade expressions not supported"),null;switch(l.type){case "size":return e?B(l,a,c,b):a;case "color":return d?x(l,a,b):a;case "opacity":return k?u(l,a,
b):a;case "rotation":return g?C(l,a,b):a;default:return f.neverReached(l),null}},{size:null,color:null,opacity:null,rotation:null});return 0<a.length&&l&&!l.size&&!l.color&&!l.opacity&&!l.rotation||l&&l.size&&!F(l.size,c,b)?null:l}function G(a,c,b){if(!!a!==!!c||a&&a.field!==c.field)return!1;if(a&&"rotation"===b)for(b=0;3>b;b++)if(a.type[b]!==c.type[b]||a.offset[b]!==c.offset[b]||a.factor[b]!==c.factor[b])return!1;return!0}function H(a,c){var b={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,
vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},e=a&&null!=a.size;a&&a.size?(b.vvSizeEnabled=!0,b.vvSizeMinSize=a.size.minSize,b.vvSizeMaxSize=a.size.maxSize,b.vvSizeOffset=a.size.offset,b.vvSizeFactor=a.size.factor):a&&e&&(b.vvSizeValue=c.transformation.scale);if(a&&e){b.vvSymbolAnchor=c.transformation.anchor;b.vvSymbolRotationMatrix=
d.mat3f64.create();k.mat4.identity(L);var g=c.transformation.rotation[2],e=c.transformation.rotation[0],f=c.transformation.rotation[1];c=L;void 0===c&&(c=n.mat4f64.create());g=g||0;e=e||0;f=f||0;0!==g&&k.mat4.rotateZ(c,c,-g/180*Math.PI);0!==e&&k.mat4.rotateX(c,c,e/180*Math.PI);0!==f&&k.mat4.rotateY(c,c,f/180*Math.PI);m.mat3.fromMat4(b.vvSymbolRotationMatrix,L)}a&&a.color&&(b.vvColorEnabled=!0,b.vvColorValues=a.color.values,b.vvColorColors=a.color.colors);a&&a.opacity&&(b.vvOpacityEnabled=!0,b.vvOpacityValues=
a.opacity.values,b.vvOpacityOpacities=a.opacity.opacityValues);return b}Object.defineProperty(a,"__esModule",{value:!0});a.convertVisualVariables=D;a.initFastSymbolUpdatesState=function(a,c){return!a||b.DISABLE_FAST_UPDATES?{enabled:!1}:(a=D(a.visualVariables,c))?{enabled:!0,visualVariables:a,materialParameters:H(a,c),requiresShaderTransformation:a&&null!=a.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(a,c,b){if(!c||!a.enabled)return!1;var e=a.visualVariables;c=D(c.visualVariables,b);
if(!(c&&G(e.size,c.size,"size")&&G(e.color,c.color,"color")&&G(e.rotation,c.rotation,"rotation")))return!1;a.visualVariables=c;a.materialParameters=H(c,b);a.requiresShaderTransformation=c&&null!=c.size;return!0};a.getMaterialParams=H;var I;(function(a){var c=n.mat4f64.create(),b=e.vec3f64.create();a.evaluateModelTransform=function(a,e,d){if(!a.vvSizeEnabled)return d;k.mat4.copy(c,d);d=a.vvSymbolRotationMatrix;k.mat4.set(L,d[0],d[1],d[2],0,d[3],d[4],d[5],0,d[6],d[7],d[8],0,0,0,0,1);k.mat4.multiply(c,
c,L);for(d=0;3>d;++d){var g=a.vvSizeOffset[d]+e[0]*a.vvSizeFactor[d],f=a.vvSizeMinSize[d],l=a.vvSizeMaxSize[d];b[d]=g<f?f:g>l?l:g}k.mat4.scale(c,c,b);k.mat4.translate(c,c,a.vvSymbolAnchor);return c};a.evaluateModelTransformScale=function(a,c,b){if(!c.vvSizeEnabled)return g.vec3.set(a,1,1,1);for(var e=0;3>e;++e){var d=c.vvSizeOffset[e]+b[0]*c.vvSizeFactor[e],f=c.vvSizeMinSize[e],k=c.vvSizeMaxSize[e];a[e]=d<f?f:d>k?k:d}return a}})(I||(I={}));var L=n.mat4f64.create();a.evaluateModelTransform=I.evaluateModelTransform;
a.evaluateModelTransformScale=I.evaluateModelTransformScale})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.mat3f64=f})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return[1,0,0,0,1,0,0,0,1]};a.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],
a[7],a[8]]};a.fromValues=function(a,h,d,k,n,g,e,c,b){return[a,h,d,k,n,g,e,c,b]};a.createView=function(a,h){return new Float64Array(a,h,9)}})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.mat4f64=f})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return[1,0,
0,0,0,1,0,0,0,0,1,0,0,0,0,1]};a.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]};a.fromValues=function(a,h,d,k,n,g,e,c,b,l,y,v,z,w,p,B){return[a,h,d,k,n,g,e,c,b,l,y,v,z,w,p,B]};a.createView=function(a,h){return new Float64Array(a,h,16)}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(h,a,f,m,d,k){return new (function(a){function d(){var e=null!==a&&a.apply(this,arguments)||this;e.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;e.SCENEVIEW_LOCKING_LOG=!1;e.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;e.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;e.DECONFLICTOR_SHOW_OUTLINES=!1;e.DECONFLICTOR_SHOW_GRID=!1;e.LABELS_SHOW_BORDER=!1;e.OVERLAY_DRAW_TEST_TEXTURE=!1;e.OVERLAY_SHOW_CENTER=!1;e.TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING=!1;e.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=
!1;e.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1;e.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1;e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;e.DRAW_MESH_GEOMETRY_NORMALS=!1;e.FEATURE_TILE_FETCH_SHOW_TILES=!1;e.FEATURE_TILE_TREE_SHOW_TILES=!1;e.ENABLE_PROFILE_DEPTH_RANGE=!1;e.DISABLE_FAST_UPDATES=!1;e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;return e}f(d,a);m([k.property()],d.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);m([k.property()],
d.prototype,"SCENEVIEW_LOCKING_LOG",void 0);m([k.property()],d.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);m([k.property()],d.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);m([k.property()],d.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);m([k.property()],d.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);m([k.property()],d.prototype,"DECONFLICTOR_SHOW_GRID",void 0);m([k.property()],d.prototype,"LABELS_SHOW_BORDER",void 0);m([k.property()],d.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);
m([k.property()],d.prototype,"OVERLAY_SHOW_CENTER",void 0);m([k.property()],d.prototype,"TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING",void 0);m([k.property()],d.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0);m([k.property()],d.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);m([k.property()],d.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0);m([k.property()],d.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);m([k.property()],d.prototype,"DRAW_MESH_GEOMETRY_NORMALS",
void 0);m([k.property()],d.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);m([k.property()],d.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);m([k.property()],d.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);m([k.property()],d.prototype,"DISABLE_FAST_UPDATES",void 0);m([k.property()],d.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);m([k.property()],d.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);return d=m([k.subclass()],d)}(k.declared(d)))})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(h,a,f,m,d,k,n){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}f(e,a);e.prototype.dispose=function(){};e.prototype.getGeometryType=function(){return m.WGLGeometryType.LABEL};e.prototype.drawGeometry=function(a,b,e,g){var c=a.context,f=a.painter,k=a.drawPhase,l=a.state,h=a.rendererInfo,y=e.indexCount,q=e.indexFrom;e=n.LabelMaterialKey.load(e.materialKey);var x=e.mapAligned?1:0;if(a.requiredLevel===b.key.level||x){var u=
d.createProgramDescriptor(e.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_color",count:4,type:5121,normalized:!0},{location:2,name:"a_vertexOffset",count:2,type:5122},{location:3,name:"a_texAndSize",count:4,type:5121},{location:4,name:"a_refSymbolAndPlacementOffset",count:4,type:5121},{location:5,name:"a_vvSize",count:1,type:5126}],visibility:[{location:6,name:"a_visible",count:1,type:5121}],visibilityRange:[{location:7,name:"a_visibilityRange",count:2,type:5121}]}),
A=f.materialManager.getProgram(e,k,h,"label",u.attributes);g=this._getVAO(c,u.bufferLayouts,u.attributes,g);c.setStencilTestEnabled(!1);c.bindProgram(A);c.bindVAO(g);this._setSharedUniforms(A,a,b);k===m.WGLDrawPhase.LABEL_ALPHA?(c.setBlendingEnabled(!1),A.setUniform1f("u_fadeStep",b.fader.value)):f.textureManager.bindTextures(c,A,e,4);b=1===x?l.displayViewMat3:l.displayMat3;e.vvSizeMinMaxValue&&A.setUniform4fv("u_vvSizeMinMaxValue",h.vvSizeMinMaxValue);e.vvSizeScaleStops&&A.setUniform1f("u_vvSizeScaleStopsValue",
h.vvSizeScaleStopsValue);e.vvSizeFieldStops&&(A.setUniform1fv("u_vvSizeFieldStopsValues",h.vvSizeFieldStopsValues),A.setUniform1fv("u_vvSizeFieldStopsSizes",h.vvSizeFieldStopsSizes));e.vvSizeUnitValue&&A.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",h.vvSizeUnitValueToPixelsRatio);c.bindTexture(a.labelFBO.colorTexture,3);A.setUniform1i("u_referenceTex",3);A.setUniform1f("u_mapRotation",Math.floor(l.rotation/360*254));A.setUniform1f("u_mapAligned",x);A.setUniformMatrix3fv("u_displayMat3",b);A.setUniform1f("u_opacity",
1);A.setUniform1f("u_zoomLevel",Math.round(10*a.displayLevel));A.setUniform2fv("u_screenSize",a.state.size);c.drawElements(4,y,5125,4*q);c.bindVAO(null);c.setStencilTestEnabled(!0);c.setBlendingEnabled(!0)}};return e}(k.default);a.default=h})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLine":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(h,a,f,m,d,k,n){Object.defineProperty(a,
"__esModule",{value:!0});h=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}f(e,a);e.prototype.dispose=function(){};e.prototype.getGeometryType=function(){return m.WGLGeometryType.LINE};e.prototype.drawGeometry=function(a,b,e,g){var c=a.context,f=a.painter,k=a.rendererInfo,l=a.requiredLevel,h=a.drawPhase,m=e.indexFrom,q=e.indexCount;e=n.LineMaterialKey.load(e.materialKey);var x=d.createProgramDescriptor(e.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,
name:"a_id",count:4,type:5121,normalized:!0},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_offsetAndNormal",count:4,type:5120},{location:4,name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123},{location:5,name:"a_tlbr",count:4,type:5123},{location:6,name:"a_segmentDirection",count:4,type:5120}].concat(e.hasVV()?[{location:7,name:"a_vv",count:3,type:5126}]:[]),visibility:[{location:8,name:"a_visible",count:1,type:5121}]}),h=f.materialManager.getProgram(e,h,k,
"line",x.attributes);g=this._getVAO(c,x.bufferLayouts,x.attributes,g);x=1/a.pixelRatio;c.bindProgram(h);c.bindVAO(g);this._setSharedUniforms(h,a,b);e.textureBinding&&f.textureManager.bindTextures(c,h,e);h.setUniform1f("u_zoomFactor",Math.pow(2,l-b.key.level)/a.pixelRatio);h.setUniform1f("u_blur",0+x);h.setUniform1f("u_antialiasing",x);e.vvSizeMinMaxValue&&h.setUniform4fv("u_vvSizeMinMaxValue",k.vvSizeMinMaxValue);e.vvSizeScaleStops&&h.setUniform1f("u_vvSizeScaleStopsValue",k.vvSizeScaleStopsValue);
e.vvSizeFieldStops&&(h.setUniform1fv("u_vvSizeFieldStopsValues",k.vvSizeFieldStopsValues),h.setUniform1fv("u_vvSizeFieldStopsSizes",k.vvSizeFieldStopsSizes));e.vvSizeUnitValue&&h.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",k.vvSizeUnitValueToPixelsRatio);e.vvColor&&(h.setUniform1fv("u_vvColorValues",k.vvColorValues),h.setUniform4fv("u_vvColors",k.vvColors));e.vvOpacity&&(h.setUniform1fv("u_vvOpacityValues",k.vvOpacityValues),h.setUniform1fv("u_vvOpacities",k.vvOpacities));c.setFaceCullingEnabled(!0);
c.setFrontFace(2305);c.setCullFace(1029);c.drawElements(4,q,5125,4*m);c.setFaceCullingEnabled(!1);c.bindVAO(null)};return e}(k.default);a.default=h})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(h,a,f,m,d,k,n,g){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function c(){return null!==
a&&a.apply(this,arguments)||this}f(c,a);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return d.WGLGeometryType.MARKER};c.prototype.drawGeometry=function(a,c,e,d){var b=a.context,f=a.painter,l=a.rendererInfo,h=a.drawPhase,n=a.state,m=e.indexCount,v=e.indexFrom;e=g.MarkerMaterialKey.load(e.materialKey);var u=k.createProgramDescriptor(e.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_vertexOffsetAndTex",count:4,type:5120},{location:2,name:"a_id",
count:4,type:5121,normalized:!0},{location:3,name:"a_color",count:4,type:5121,normalized:!0},{location:4,name:"a_outlineColor",count:4,type:5121,normalized:!0},{location:5,name:"a_sizeAndOutlineWidth",count:4,type:5121}].concat(e.hasVV()?[{location:6,name:"a_vv",count:4,type:5126}]:[]),visibility:[{location:8,name:"a_visible",count:1,type:5121}]}),h=f.materialManager.getProgram(e,h,l,"icon",u.attributes);d=this._getVAO(b,u.bufferLayouts,u.attributes,d);b.bindProgram(h);b.bindVAO(d);e.textureBinding&&
f.textureManager.bindTextures(b,h,e,4);this._setSharedUniforms(h,a,c);h.setUniformMatrix3fv("u_displayMat3",e.vvRotation?n.displayViewMat3:n.displayMat3);e.vvSizeMinMaxValue&&h.setUniform4fv("u_vvSizeMinMaxValue",l.vvSizeMinMaxValue);e.vvSizeScaleStops&&h.setUniform1f("u_vvSizeScaleStopsValue",l.vvSizeScaleStopsValue);e.vvSizeFieldStops&&(h.setUniform1fv("u_vvSizeFieldStopsValues",l.vvSizeFieldStopsValues),h.setUniform1fv("u_vvSizeFieldStopsSizes",l.vvSizeFieldStopsSizes));e.vvSizeUnitValue&&h.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",
l.vvSizeUnitValueToPixelsRatio);e.vvColor&&(h.setUniform1fv("u_vvColorValues",l.vvColorValues),h.setUniform4fv("u_vvColors",l.vvColors));e.vvOpacity&&(h.setUniform1fv("u_vvOpacityValues",l.vvOpacityValues),h.setUniform1fv("u_vvOpacities",l.vvOpacities));e.vvRotation&&h.setUniform1f("u_vvRotationType","geographic"===l.vvMaterialParameters.vvRotationType?0:1);b.drawElements(4,m,5125,4*v);b.bindVAO(null)};return c}(n.default);a.default=h})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushText":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(h,a,f,m,d,k,n){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}f(e,a);e.prototype.dispose=function(){};e.prototype.getGeometryType=function(){return m.WGLGeometryType.TEXT};e.prototype.drawGeometry=function(a,b,e,g){var c=a.context,f=a.painter,k=a.rendererInfo,l=a.drawPhase,h=a.state,m=e.indexCount,q=e.indexFrom;e=n.TextMaterialKey.load(e.materialKey);var x=d.createProgramDescriptor(e.data,{geometry:[{location:0,name:"a_pos",
count:2,type:5122},{location:1,name:"a_id",count:4,type:5121,normalized:!0},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_vertexOffset",count:2,type:5122},{location:4,name:"a_texFontSize",count:4,type:5120},{location:5,name:"a_aux",count:4,type:5120}].concat(e.hasVV()?[{location:6,name:"a_vv",count:4,type:5126}]:[]),visibility:[{location:7,name:"a_visible",count:1,type:5121}]}),l=f.materialManager.getProgram(e,l,k,"text",x.attributes);g=this._getVAO(c,x.bufferLayouts,
x.attributes,g);c.bindProgram(l);c.bindVAO(g);this._setSharedUniforms(l,a,b);f.textureManager.bindTextures(c,l,e,4);l.setUniformMatrix3fv("u_displayMat3",h.displayMat3);e.vvSizeMinMaxValue&&l.setUniform4fv("u_vvSizeMinMaxValue",k.vvSizeMinMaxValue);e.vvSizeScaleStops&&l.setUniform1f("u_vvSizeScaleStopsValue",k.vvSizeScaleStopsValue);e.vvSizeFieldStops&&(l.setUniform1fv("u_vvSizeFieldStopsValues",k.vvSizeFieldStopsValues),l.setUniform1fv("u_vvSizeFieldStopsSizes",k.vvSizeFieldStopsSizes));e.vvSizeUnitValue&&
l.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",k.vvSizeUnitValueToPixelsRatio);e.vvColor&&(l.setUniform1fv("u_vvColorValues",k.vvColorValues),l.setUniform4fv("u_vvColors",k.vvColors));e.vvOpacity&&(l.setUniform1fv("u_vvOpacityValues",k.vvOpacityValues),l.setUniform1fv("u_vvOpacities",k.vvOpacities));e.vvRotation&&l.setUniform1f("u_vvRotationType","geographic"===k.vvMaterialParameters.vvRotationType?0:1);c.drawElements(4,m,5125,4*q);c.bindVAO(null)};return e}(k.default);a.default=h})},"esri/views/2d/engine/webgl/painter/WGLHighlightPainter":function(){define("require exports ../../../../../core/has ./highlight/HighlightGradient ./highlight/HighlightRenderer ./highlight/HighlightSurfaces".split(" "),
function(h,a,f,m,d,k){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._hlRenderer=new d.default;this._hlSurfaces=new k.default;this._hlGradient=new m.default;this._adjustedHeight=this._adjustedWidth=this._height=this._width=void 0}a.prototype.dispose=function(){this._hlSurfaces&&this._hlSurfaces.dispose();this._hlRenderer&&this._hlRenderer.dispose();this._hlGradient&&this._hlGradient.destroy();this._boundFBO=null};a.prototype.setup=function(a,e,c){this._width=e;this._height=
c;var b=e%4,d=c%4;e+=2>b?-b:4-b;c+=2>d?-d:4-d;this._adjustedWidth=e;this._adjustedHeight=c;this._boundFBO=a.getBoundFramebufferObject();e=Math.round(.75*e);c=Math.round(.75*c);this._hlRenderer.setup(a,e,c);this._hlSurfaces.setup(a,e,c)};a.prototype.startMaskDraw=function(a){a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setClearColor(0,0,0,0);a.setClearStencil(0);a.clear(a.gl.COLOR_BUFFER_BIT|a.gl.STENCIL_BUFFER_BIT);a.setViewport(0,0,.75*this._adjustedWidth,.75*this._adjustedHeight)};a.prototype.draw=
function(a){a.setStencilTestEnabled(!1);a.setBlendingEnabled(!1);a.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.preBlur(a,this._hlSurfaces.sharedBlur1Tex);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex);a.bindFramebuffer(this._boundFBO);a.setBlendingEnabled(!0);a.setViewport(0,0,this._width,this._height);
this._hlRenderer.renderHighlight(a,this._hlSurfaces.sharedBlur1Tex,this._hlGradient);this._boundFBO=null};a.prototype.setHighlightOptions=function(a){this._hlGradient.setHighlightOptions(a)};return a}();a.default=h})},"esri/views/2d/engine/webgl/painter/highlight/HighlightGradient":function(){define("require exports ../../../../../../core/Logger ../../definitions ./parameters ../../../../../webgl/Texture".split(" "),function(h,a,f,m,d,k){function n(a,b){b.outlineColor[0]=b.fillColor[0]=a.color.r/
255;b.outlineColor[1]=b.fillColor[1]=a.color.g/255;b.outlineColor[2]=b.fillColor[2]=a.color.b/255;b.outlineColor[3]=b.fillColor[3]=a.color.a;b.fillColor[3]*=a.fillOpacity;b.outlineColor[3]*=a.haloOpacity;b.fillColor[0]*=b.fillColor[3];b.fillColor[1]*=b.fillColor[3];b.fillColor[2]*=b.fillColor[3];b.outlineColor[0]*=b.outlineColor[3];b.outlineColor[1]*=b.outlineColor[3];b.outlineColor[2]*=b.outlineColor[3];b.outlineWidth=d.HIGHLIGHT_SIZING.outlineWidth;b.outerHaloWidth=d.HIGHLIGHT_SIZING.outerHaloWidth;
b.innerHaloWidth=d.HIGHLIGHT_SIZING.innerHaloWidth;b.outlinePosition=d.HIGHLIGHT_SIZING.outlinePosition}Object.defineProperty(a,"__esModule",{value:!0});var g=f.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),e=[0,0,0,0];h=function(){function a(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:d.HIGHLIGHT_SIZING.outlinePosition,outlineWidth:d.HIGHLIGHT_SIZING.outlineWidth,innerHaloWidth:d.HIGHLIGHT_SIZING.innerHaloWidth,
outerHaloWidth:d.HIGHLIGHT_SIZING.outerHaloWidth};this.shadeTexChanged=!0;this.texelData=new Uint8Array(4*d.SHADE_TEXTURE_SIZE);this.minMaxDistance=[0,0]}a.prototype.setHighlightOptions=function(a){function c(a,c,b){F[0]=(1-b)*a[0]+b*c[0];F[1]=(1-b)*a[1]+b*c[1];F[2]=(1-b)*a[2]+b*c[2];F[3]=(1-b)*a[3]+b*c[3]}var b;n(a,this._convertedHighlightOptions);a=this._convertedHighlightOptions.outlinePosition-this._convertedHighlightOptions.outlineWidth/2-this._convertedHighlightOptions.outerHaloWidth;var f=
this._convertedHighlightOptions.outlinePosition-this._convertedHighlightOptions.outlineWidth/2,k=this._convertedHighlightOptions.outlinePosition+this._convertedHighlightOptions.outlineWidth/2,h=this._convertedHighlightOptions.outlinePosition+this._convertedHighlightOptions.outlineWidth/2+this._convertedHighlightOptions.innerHaloWidth,m=Math.sqrt(Math.PI/2)*d.SIGMAS[3],B=Math.abs(a)>m?Math.round(10*(Math.abs(a)-m))/10:0,m=Math.abs(h)>m?Math.round(10*(Math.abs(h)-m))/10:0;B&&!m?g.error("The outer rim of the highlight is "+
B+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!B&&m?g.error("The inner rim of the highlight is "+m+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):B&&m&&g.error("The highlight is "+Math.max(B,m)+"px away from the edge of the feature; consider reducing some width values.");for(var F=[void 0,void 0,void 0,
void 0],B=this.texelData,m=0;m<d.SHADE_TEXTURE_SIZE;++m)b=a+m/(d.SHADE_TEXTURE_SIZE-1)*(h-a),b<a?(F[4*m+0]=0,F[4*m+1]=0,F[4*m+2]=0,F[4*m+3]=0):b<f?c(e,this._convertedHighlightOptions.outlineColor,(b-a)/(f-a)):b<k?(b=this._convertedHighlightOptions.outlineColor,F[0]=b[0],F[1]=b[1],F[2]=b[2],F[3]=b[3]):b<h?c(this._convertedHighlightOptions.outlineColor,this._convertedHighlightOptions.fillColor,(b-k)/(h-k)):(b=this._convertedHighlightOptions.fillColor,F[4*m+0]=b[0],F[4*m+1]=b[1],F[4*m+2]=b[2],F[4*m+
3]=b[3]),B[4*m+0]=255*F[0],B[4*m+1]=255*F[1],B[4*m+2]=255*F[2],B[4*m+3]=255*F[3];this.minMaxDistance[0]=a;this.minMaxDistance[1]=h;this.shadeTexChanged=!0};a.prototype.applyHighlightOptions=function(a,c){this.shadeTex||(this.shadeTex=new k(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:d.SHADE_TEXTURE_SIZE,height:1,samplingMode:9729}));this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,d.SHADE_TEXTURE_SIZE,1,this.texelData),this.shadeTexChanged=!1);a.bindTexture(this.shadeTex,
m.TEXTURE_BINDING_HIGHLIGHT_1);c.setUniform2fv("u_minMaxDistance",this.minMaxDistance)};a.prototype.destroy=function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)};return a}();a.default=h})},"esri/views/2d/engine/webgl/painter/highlight/parameters":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.SIGMAS=[void 0,void 0,void 0,1];a.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1];a.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=
[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];a.SHADE_TEXTURE_SIZE=256;a.HIGHLIGHT_SIZING={outlineWidth:.7,outerHaloWidth:.7,innerHaloWidth:.7,outlinePosition:0}})},"esri/views/2d/engine/webgl/painter/highlight/HighlightRenderer":function(){define("require exports ../../definitions ./parameters ../../shaders/HighlightPrograms ../../../../../webgl/BufferObject ../../../../../webgl/programUtils ../../../../../webgl/VertexArrayObject".split(" "),function(h,a,f,m,d,k,n,g){Object.defineProperty(a,"__esModule",{value:!0});
h=function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)};a.prototype.preBlur=function(a,b){a.bindTexture(b,f.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,
0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",m.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};a.prototype.finalBlur=function(a,b){a.bindTexture(b,f.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",m.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);a.bindVAO(this._resources.quadVAO);
a.drawArrays(5,0,4);a.bindVAO()};a.prototype.renderHighlight=function(a,b,e){a.bindTexture(b,f.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.highlightProgram);e.applyHighlightOptions(a,this._resources.highlightProgram);a.bindVAO(this._resources.quadVAO);a.setBlendingEnabled(!0);a.setBlendFunction(1,771);a.drawArrays(5,0,4);a.bindVAO()};a.prototype._initialize=function(a,b,e){this._width=b;this._height=e;b=new k(a,34962,35044,(new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);
e=new g(a,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:b});var c=n.createProgram(a,d.highlight);a=n.createProgram(a,d.blur);c.setUniform1i("u_texture",f.TEXTURE_BINDING_HIGHLIGHT_0);c.setUniform1i("u_shade",f.TEXTURE_BINDING_HIGHLIGHT_1);c.setUniform4fv("u_sigmas",m.SIGMAS);a.setUniform1i("u_texture",f.TEXTURE_BINDING_HIGHLIGHT_0);a.setUniform4fv("u_sigmas",
m.SIGMAS);this._resources={quadGeometry:b,quadVAO:e,highlightProgram:c,blurProgram:a}};a.prototype.setup=function(a,b,e){this._resources?(this._width=b,this._height=e):this._initialize(a,b,e)};return a}();a.default=h})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["require","exports","./sources/resolver"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.highlight={name:"highlight",shaders:{vertexShader:f.resolveIncludes("highlight/textured.vert"),fragmentShader:f.resolveIncludes("highlight/highlight.frag")},
attributes:{a_position:0,a_texcoord:1}};a.blur={name:"blur",shaders:{vertexShader:f.resolveIncludes("highlight/textured.vert"),fragmentShader:f.resolveIncludes("highlight/blur.frag")},attributes:{a_position:0,a_texcoord:1}}})},"esri/views/2d/engine/webgl/painter/highlight/HighlightSurfaces":function(){define(["require","exports","../../../../../webgl/FramebufferObject","../../../../../webgl/Texture"],function(h,a,f,m){function d(a,d,g){d=new m(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,
width:d,height:g,samplingMode:9729});a=f.createWithAttachments(a,d,{colorTarget:0,depthStencilTarget:2});return[d,a]}Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)};a.prototype._initialize=
function(a,g,e){this._width=g;this._height=e;var c=d(a,g,e),b=c[0],c=c[1];a=d(a,g,e);this._resources={sharedBlur1Tex:b,sharedBlur1Fbo:c,sharedBlur2Tex:a[0],sharedBlur2Fbo:a[1]}};a.prototype.setup=function(a,d,e){!this._resources||this._width===d&&this._height===e||this.dispose();this._resources||this._initialize(a,d,e)};Object.defineProperty(a.prototype,"sharedBlur1Tex",{get:function(){return this._resources.sharedBlur1Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur1Fbo",
{get:function(){return this._resources.sharedBlur1Fbo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Tex",{get:function(){return this._resources.sharedBlur2Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Fbo",{get:function(){return this._resources.sharedBlur2Fbo},enumerable:!0,configurable:!0});return a}();a.default=h})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","../../core/has","./Renderbuffer","./Texture"],
function(h,a,f,m,d){return function(){function a(f,g,e,c){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=f;this._desc={colorTarget:g.colorTarget,depthStencilTarget:g.depthStencilTarget,width:g.width,height:g.height,multisampled:g.multisampled};this._id=a._nextId++;e&&(f=void 0,e instanceof d?(this._colorAttachment=e,f=e.descriptor):(f=e,this._colorAttachment=new d(this._context,f)),0!==this._desc.colorTarget&&
console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),a._validateTextureDimensions(f,this._desc));c instanceof m?(2===g.depthStencilTarget?this._stencilAttachment=c:1===g.depthStencilTarget||3===g.depthStencilTarget?this._depthAttachment=c:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),a._validateBufferDimensions(c.descriptor,
this._desc)):c&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),g=void 0,c instanceof d?(this._depthStencilTexture=c,g=this._depthStencilTexture.descriptor):(g=c,this._depthStencilTexture=new d(this._context,g)),a._validateTextureDimensions(g,this._desc))}a.create=function(d,g){return new a(d,g)};a.createWithAttachments=function(d,g,e,c){return new a(d,e,g,c)};Object.defineProperty(a.prototype,
"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof d?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorAttachment",
{get:function(){return this._colorAttachment},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilAttachment",{get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});a.prototype.dispose=function(){if(this._context){var a=this._context,d=a.getBoundFramebufferObject();this._disposeColorAttachment();this._disposeDepthStencilAttachments();this._glName&&(a.gl.deleteFramebuffer(this._glName),this._glName=null);a.bindFramebuffer(d);this._context=null}};a.prototype.attachColorTexture=function(d){if(d){a._validateTextureDimensions(d.descriptor,
this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var g=this._context.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,d.glName,0)}this._colorAttachment=d}};a.prototype.detachColorTexture=function(){var a=void 0;if(this._colorAttachment instanceof d){a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var g=this._context.gl;this._context.gl.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,
g.TEXTURE_2D,null,0)}this._colorAttachment=null}return a};a.prototype.attachDepthStencilTexture=function(d){if(d){var g=d.descriptor;34041!==g.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==g.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
a._validateTextureDimensions(g,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),g=this._context.gl,g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.TEXTURE_2D,d.glName,0));this._depthStencilTexture=d}};a.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var d=this._context.gl;
this._context.gl.framebufferTexture2D(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};a.prototype.attachDepthStencilBuffer=function(d){if(d){var g=d.descriptor;34041!==g.internalFormat&&33189!==g.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");a._validateBufferDimensions(g,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===g.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),
g=this._context.gl,g.framebufferRenderbuffer(g.FRAMEBUFFER,1===this._desc.depthStencilTarget?g.DEPTH_ATTACHMENT:g.DEPTH_STENCIL_ATTACHMENT,g.RENDERBUFFER,d.glName));this._depthAttachment=d}};a.prototype.detachDepthStencilBuffer=function(){var a=this._context.gl,d=this._depthAttachment;d&&this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null));this._depthAttachment=
null;return d};a.prototype.copyToTexture=function(a,d,e,c,b,f,k){(0>a||0>d||0>b||0>f)&&console.error("Offsets cannot be negative!");(0>=e||0>=c)&&console.error("Copy width and height must be greater than zero!");var g=this._desc,l=k.descriptor;3553!==k.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+e>g.width||d+c>g.height||b+e>l.width||f+c>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");g=this._context;g.bindTexture(k);
g.bindFramebuffer(this);g.gl.copyTexSubImage2D(3553,0,b,f,a,d,e,c)};a.prototype.readPixels=function(a,d,e,c,b,f,k){(0>=e||0>=c)&&console.error("Copy width and height must be greater than zero!");k||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,d,e,c,b,f,k)};a.prototype.resize=function(f,g){var e=this._desc;if(e.width!==f||e.height!==g)if(this._initialized)e.width=f,e.height=g,this._colorAttachment instanceof d?(c=this._colorAttachment,
e=c.descriptor,e.width=f,e.height=g,this._colorAttachment.dispose(),this._colorAttachment=new d(this._context,e),a._validateTextureDimensions(c.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(e=this._depthStencilTexture.descriptor,e.width=f,e.height=g,this._depthStencilTexture.dispose(),this._depthStencilTexture=new d(this._context,e)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===
this&&this._context.bindFramebuffer(null),this._initialized=!1;else{e.width=f;e.height=g;if(this._colorAttachment instanceof d){var c=this._colorAttachment;c.resize(f,g)}this._depthStencilTexture&&this._depthStencilTexture.resize(f,g)}};a.prototype.initialize=function(){if(this._initialized)return!1;var a=this._context.gl;this._glName&&a.deleteFramebuffer(this._glName);var g=a.createFramebuffer(),e=this._desc;a.bindFramebuffer(a.FRAMEBUFFER,g);if(!this._colorAttachment)if(0===e.colorTarget)this._colorAttachment=
new d(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e.width,height:e.height});else{var c=new m(this._context,{internalFormat:32854,width:e.width,height:e.height});a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,c.glName);this._colorAttachment=c}this._colorAttachment instanceof d&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._colorAttachment.glName,0);switch(e.depthStencilTarget){case 1:case 3:this._depthAttachment||
(this._depthAttachment=new m(this._context,{internalFormat:1===e.depthStencilTarget?33189:34041,width:e.width,height:e.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,1===e.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new m(this._context,{internalFormat:36168,width:e.width,height:e.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._stencilAttachment.glName);
break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new d(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:e.width,height:e.height})),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,this._depthStencilTexture.glName,0)}a.checkFramebufferStatus(a.FRAMEBUFFER)!==
a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=g;return this._initialized=!0};a.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof d){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var g=this._context.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,g=this._context.gl,this._initialized&&
(this._context.bindFramebuffer(this),g.framebufferRenderbuffer(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};a.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._depthAttachment.dispose(),
this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};a._validateBufferDimensions=
function(a,d){console.assert(0<=a.width&&0<=a.height);void 0!==d.width&&0<=d.width&&void 0!==d.height&&0<=d.height?d.width===a.width&&d.height===a.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(d.width=a.width,d.height=a.height)};a._validateTextureDimensions=function(a,d){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==d.width&&0<=d.width&&void 0!==d.height&&0<=d.height?d.width===a.width&&d.height===
a.height||console.error("Color attachment texture must match the framebuffer's!"):(d.width=a.width,d.height=a.height)};a._nextId=0;return a}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/has"],function(h,a,f){return function(){function a(d,f){this._context=d;this._desc=f;this._glName=null;this._id=-1;d=this._context.gl;this._id=++a._nextId;this._glName=d.createRenderbuffer();this._context.bindRenderbuffer(this);d.renderbufferStorage(d.RENDERBUFFER,f.internalFormat,
f.width,f.height)}Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});a.prototype.resize=function(a,f){var d=this._context.gl,g=this._desc;if(g.width!==a||g.height!==f)g.width=a,g.height=f,this._context.bindRenderbuffer(this),
d.renderbufferStorage(d.RENDERBUFFER,g.internalFormat,g.width,g.height)};a.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context=null};a._nextId=0;return a}()})},"esri/views/2d/engine/webgl/shaders/RasterPrograms":function(){define(["require","exports","./sources/resolver"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.transformTexture={name:"transform-texture",shaders:{vertexShader:f.resolveIncludes("raster/transform.vert"),
fragmentShader:f.resolveIncludes("raster/texture.frag")},attributes:{a_position:0,a_texcoord:1}};a.transformSolid={name:"transform-solid",shaders:{vertexShader:f.resolveIncludes("raster/transform.vert"),fragmentShader:f.resolveIncludes("raster/solid.frag")},attributes:{a_position:0}}})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["require","exports","./sources/resolver"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.stencil={name:"stencil",shaders:{vertexShader:f.resolveIncludes("stencil/stencil.vert"),
fragmentShader:f.resolveIncludes("stencil/stencil.frag")},attributes:{a_pos:0}}})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ./enums ./InstanceCounter ./renderState ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(h,a,f,m,d,k,n,g){return function(){function a(a,b){var c=this;this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState=
{mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};
this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=n.default(a)?"webgl2":"webgl";this.gl=a;a instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");
this._capabilities=g.loadCapabilities(a,b);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)};
this._stateTracker=new k.StateTracker({setBlending:function(a){a?(c.setBlendingEnabled(!0),c.setBlendEquationSeparate(a.opRgb,a.opAlpha),c.setBlendFunctionSeparate(a.srcRgb,a.dstRgb,a.srcAlpha,a.dstAlpha),a=a.color,c.setBlendColor(a.r,a.g,a.b,a.a)):c.setBlendingEnabled(!1)},setCulling:function(a){a?(c.setFaceCullingEnabled(!0),c.setCullFace(a.face),c.setFrontFace(a.mode)):c.setFaceCullingEnabled(!1)},setPolygonOffset:function(a){a?(c.setPolygonOffsetFillEnabled(!0),c.setPolygonOffset(a.factor,a.units)):
c.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(a){a?(c.setDepthTestEnabled(!0),c.setDepthFunction(a.func)):c.setDepthTestEnabled(!1)},setStencilTest:function(a){if(a){c.setStencilTestEnabled(!0);var b=a.function;c.setStencilFunction(b.func,b.ref,b.mask);a=a.operation;c.setStencilOp(a.fail,a.zFail,a.zPass)}else c.setStencilTestEnabled(!1)},setDepthWrite:function(a){a?(c.setDepthWriteEnabled(!0),c.setDepthRange(a.zNear,a.zFar)):c.setDepthWriteEnabled(!1)},setColorWrite:function(a){a?c.setColorMask(a.r,
a.g,a.b,a.a):c.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(a){a?c.setStencilWriteMask(a.mask):c.setStencilWriteMask(0)}});this.enforceState()}Object.defineProperty(a.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);
this._textureUnitMap={};this.gl=null};a.prototype.setPipelineState=function(a){this._stateTracker.setPipeline(a)};a.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a,this._stateTracker.invalidateBlending())};a.prototype.setBlendColor=function(a,b,e,d){if(a!==this._blendColorState.r||b!==this._blendColorState.g||e!==this._blendColorState.b||d!==this._blendColorState.a)this.gl.blendColor(a,b,e,d),
this._blendColorState.r=a,this._blendColorState.g=b,this._blendColorState.b=e,this._blendColorState.a=d,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunction=function(a,b){if(a!==this._blendFunctionState.srcRGB||b!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,b),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=b,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunctionSeparate=
function(a,b,e,d){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==e||this._blendFunctionState.dstRGB!==b||this._blendFunctionState.dstAlpha!==d)this.gl.blendFuncSeparate(a,b,e,d),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=d,this._stateTracker.invalidateBlending()};a.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=
a,this._blendEquationState.modeAlpha=a,this._stateTracker.invalidateBlending())};a.prototype.setBlendEquationSeparate=function(a,b){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==b)this.gl.blendEquationSeparate(a,b),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=b,this._stateTracker.invalidateBlending()};a.prototype.setColorMask=function(a,b,e,d){if(this._colorMaskState.r!==a||this._colorMaskState.g!==b||this._colorMaskState.b!==e||this._colorMaskState.a!==
d)this.gl.colorMask(a,b,e,d),this._colorMaskState.r=a,this._colorMaskState.g=b,this._colorMaskState.b=e,this._colorMaskState.a=d,this._stateTracker.invalidateColorWrite()};a.prototype.setClearColor=function(a,b,e,d){if(this._clearColor.r!==a||this._clearColor.g!==b||this._clearColor.b!==e||this._clearColor.a!==d)this.gl.clearColor(a,b,e,d),this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=e,this._clearColor.a=d};a.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==
a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a,this._stateTracker.invalidateCulling())};a.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=a,this._stateTracker.invalidatePolygonOffset())};a.prototype.setPolygonOffset=function(a,b){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==
b)this._polygonOffset[0]=a,this._polygonOffset[1]=b,this.gl.polygonOffset(a,b),this._stateTracker.invalidatePolygonOffset()};a.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a,this._stateTracker.invalidateCulling())};a.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a,this._stateTracker.invalidateCulling())};a.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):
this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};a.prototype.setScissorRect=function(a,b,e,d){if(this._scissorRect.x!==a||this._scissorRect.y!==b||this._scissorRect.width!==e||this._scissorRect.height!==d)this.gl.scissor(a,b,e,d),this._scissorRect.x=a,this._scissorRect.y=b,this._scissorRect.width=e,this._scissorRect.height=d};a.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=
a,this._stateTracker.invalidateDepthTest())};a.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};a.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a,this._stateTracker.invalidateDepthTest())};a.prototype.setDepthWriteEnabled=function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a,this._stateTracker.invalidateDepthWrite())};a.prototype.setDepthRange=function(a,
b){if(this._depthRange.zNear!==a||this._depthRange.zFar!==b)this.gl.depthRange(a,b),this._depthRange.zNear=a,this._depthRange.zFar=b,this._stateTracker.invalidateDepthWrite()};a.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a,this._stateTracker.invalidateStencilTest())};a.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=
a)};a.prototype.setStencilFunction=function(a,b,e){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==b||this._stencilFunction.mask!==e)this.gl.stencilFunc(a,b,e),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=b,this._stencilFunction.mask=e,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilFunctionSeparate=function(a,b,e,d){if(this._stencilFunction.face!==a||this._stencilFunction.func!==b||this._stencilFunction.ref!==e||this._stencilFunction.mask!==
d)this.gl.stencilFuncSeparate(a,b,e,d),this._stencilFunction.face=a,this._stencilFunction.func=b,this._stencilFunction.ref=e,this._stencilFunction.mask=d,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=a,this._stateTracker.invalidateStencilWrite())};a.prototype.setStencilOp=function(a,b,e){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==
e)this.gl.stencilOp(a,b,e),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=b,this._stencilOperation.zPass=e,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilOpSeparate=function(a,b,e,d){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==b||this._stencilOperation.zFail!==e||this._stencilOperation.zPass!==d)this.gl.stencilOpSeparate(a,b,e,d),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=
b,this._stencilOperation.zFail=e,this._stencilOperation.zPass=d,this._stateTracker.invalidateStencilTest()};a.prototype.setActiveTexture=function(a){var b=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(m.BASE_TEXTURE_UNIT+a),this._activeTextureUnit=a);return b};a.prototype.clear=function(a){a&&this.gl.clear(a)};a.prototype.clearSafe=function(a){a&&(a&16384&&this.setColorMask(!0,!0,!0,!0),a&256&&this.setDepthWriteEnabled(!0),a&1024&&this.setStencilWriteMask(255),
this.gl.clear(a))};a.prototype.drawArrays=function(a,b,e){this.gl.drawArrays(a,b,e)};a.prototype.drawElements=function(a,b,e,d){5123===e?this.gl.drawElements(a,b,e,d):5125===e&&this.gl.drawElements(a,b,e,d)};a.prototype.logIno=function(){};Object.defineProperty(a.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});a.prototype.setViewport=function(a,b,e,d){var c=this._viewport;if(c.x!==a||c.y!==b||c.width!==e||c.height!==d)c.x=a,c.y=b,c.width=e,c.height=
d,this.gl.viewport(a,b,e,d)};a.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};a.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};a.prototype.bindTexture=function(c,b){void 0===b&&(b=0);-1===a._MAX_TEXTURE_IMAGE_UNITS&&(a._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));
(b>=a._MAX_TEXTURE_IMAGE_UNITS||0>b)&&console.error("Input texture unit is out of range of available units!");var e=this._textureUnitMap[b];this.setActiveTexture(b);null==c||null==c.glName?(null!=e&&(this.gl.bindTexture(e.descriptor.target,null),e.setBoundToUnit(b,!1)),this._textureUnitMap[b]=null):e&&e.id===c.id?c.applyChanges():(this.gl.bindTexture(c.descriptor.target,c.glName),c.setBoundToUnit(b,!0),c.applyChanges(),this._textureUnitMap[b]=c)};a.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==
a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};a.prototype.bindBuffer=function(c){c&&(34962===c.bufferType?this._activeVertexBuffer=a._bindBuffer(this.gl,c,c.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,c,c.bufferType,this._activeIndexBuffer))};a.prototype.bindRenderbuffer=function(a){var b=this.gl;a||(b.bindRenderbuffer(b.RENDERBUFFER,
null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(b.bindRenderbuffer(b.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};a.prototype.unbindBuffer=function(c){34962===c?this._activeVertexBuffer=a._bindBuffer(this.gl,null,c,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,null,c,this._activeIndexBuffer)};a.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&
(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};a.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};a.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};a.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};a.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,
a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,
7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};a.prototype.enforceState=function(){var a=this.gl,b=this._capabilities.vao;b&&b.bindVertexArray(null);for(var e=0;e<this.parameters.maxVertexAttributes;e++)a.disableVertexAttribArray(e);this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,
this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(b&&this._activeVertexArrayObject){if(b=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(b)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:
null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);a.bindRenderbuffer(a.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);
a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);
a.lineWidth(1);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?a.enable(a.SCISSOR_TEST):a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,
this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(b=0;b<this.parameters.maxTextureImageUnits;b++)a.activeTexture(m.BASE_TEXTURE_UNIT+b),a.bindTexture(3553,null),(e=this._textureUnitMap[b])&&a.bindTexture(e.descriptor.target,e.glName);a.activeTexture(m.BASE_TEXTURE_UNIT+
this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};a._bindBuffer=function(a,b,e,d){if(!b)return a.bindBuffer(e,null),null;if(d===b)return d;a.bindBuffer(e,b.glName);return b};a._MAX_TEXTURE_IMAGE_UNITS=-1;return a}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/InstanceCounter":function(){define(["require",
"exports"],function(h,a){return function(){function a(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}a.prototype.incrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}};
a.prototype.decrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}};a.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._instanceCount.textureCount);console.log("Buffers: "+this._instanceCount.bufferCount);
console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+this._instanceCount.programCount);console.log("Framebuffers: "+this._instanceCount.framebufferCount);console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)};return a}()})},"esri/views/webgl/renderState":function(){define(["require","exports","../../core/tsSupport/assignHelper"],function(h,a,f){function m(a){return x.intern(a)}function d(a){return u.intern(a)}function k(a){return A.intern(a)}function n(a){return C.intern(a)}
function g(a){return D.intern(a)}function e(a){return G.intern(a)}function c(a){return H.intern(a)}function b(a){return I.intern(a)}function l(a){return"["+a.join(",")+"]"}function y(a){return a?l([a.srcRgb,a.srcAlpha,a.dstRgb,a.dstAlpha,a.opRgb,a.opAlpha,a.color.r,a.color.g,a.color.b,a.color.a]):null}function v(a){return a?l([a.face,a.mode]):null}function z(a){return a?l([a.factor,a.units]):null}function w(a){return a?l([a.func]):null}function p(a){return a?l([a.function.func,a.function.ref,a.function.mask,
a.operation.fail,a.operation.zFail,a.operation.zPass]):null}function B(a){return a?l([a.zNear,a.zFar]):null}function F(a){return a?l([a.r,a.g,a.b,a.a]):null}function q(a){return a?l([a.mask]):null}Object.defineProperty(a,"__esModule",{value:!0});a.simpleBlendingParams=function(a,b,c,e){void 0===c&&(c=32774);void 0===e&&(e=[0,0,0,0]);return{srcRgb:a,srcAlpha:a,dstRgb:b,dstAlpha:b,opRgb:c,opAlpha:c,color:{r:e[0],g:e[1],b:e[2],a:e[3]}}};a.separateBlendingParams=function(a,b,c,e,d,g,f){void 0===d&&(d=
32774);void 0===g&&(g=32774);void 0===f&&(f=[0,0,0,0]);return{srcRgb:a,srcAlpha:b,dstRgb:c,dstAlpha:e,opRgb:d,opAlpha:g,color:{r:f[0],g:f[1],b:f[2],a:f[3]}}};a.backFaceCullingParams={face:1029,mode:2305};a.defaultDepthWriteParams={zNear:0,zFar:1};a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.makeBlending=m;a.makeCulling=d;a.makePolygonOffset=k;a.makeDepthTest=n;a.makeStencilTest=g;a.makeDepthWrite=e;a.makeColorWrite=c;a.makeStencilWrite=b;a.makePipelineState=function(a){return L.intern(a)};h=
function(){function a(a,b){this.makeKey=a;this.makeRef=b;this.interns=new Map}a.prototype.intern=function(a){if(!a)return null;var b=this.makeKey(a),c=this.interns;c.has(b)||c.set(b,this.makeRef(a));return c.get(b)};return a}();var x=new h(y,function(a){return f({__tag:"Blending"},a)}),u=new h(v,function(a){return f({__tag:"Culling"},a)}),A=new h(z,function(a){return f({__tag:"PolygonOffset"},a)}),C=new h(w,function(a){return f({__tag:"DepthTest"},a)}),D=new h(p,function(a){return f({__tag:"StencilTest"},
a)}),G=new h(B,function(a){return f({__tag:"DepthWrite"},a)}),H=new h(F,function(a){return f({__tag:"ColorWrite"},a)}),I=new h(q,function(a){return f({__tag:"StencilWrite"},a)}),L=new h(function(a){return a?l([y(a.blending),v(a.culling),z(a.polygonOffset),w(a.depthTest),p(a.stencilTest),B(a.depthWrite),F(a.colorWrite),q(a.stencilWrite)]):null},function(a){return{blending:m(a.blending),culling:d(a.culling),polygonOffset:k(a.polygonOffset),depthTest:n(a.depthTest),stencilTest:g(a.stencilTest),depthWrite:e(a.depthWrite),
colorWrite:c(a.colorWrite),stencilWrite:b(a.stencilWrite)}});h=function(){function a(a){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=a}a.prototype.setPipeline=function(a){if(this._pipelineInvalid||a!==this._pipeline)this.setBlending(a.blending),this.setCulling(a.culling),this.setPolygonOffset(a.polygonOffset),
this.setDepthTest(a.depthTest),this.setStencilTest(a.stencilTest),this.setDepthWrite(a.depthWrite),this.setColorWrite(a.colorWrite),this.setStencilWrite(a.stencilWrite),this._pipeline=a;this._pipelineInvalid=!1};a.prototype.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};a.prototype.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};a.prototype.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};a.prototype.invalidateDepthTest=
function(){this._pipelineInvalid=this._depthTestInvalid=!0};a.prototype.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};a.prototype.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};a.prototype.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.setBlending=function(a){this._blending=this.setSubState(a,
this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};a.prototype.setCulling=function(a){this._culling=this.setSubState(a,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};a.prototype.setPolygonOffset=function(a){this._polygonOffset=this.setSubState(a,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};a.prototype.setDepthTest=function(a){this._depthTest=
this.setSubState(a,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};a.prototype.setStencilTest=function(a){this._stencilTest=this.setSubState(a,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};a.prototype.setDepthWrite=function(a){this._depthWrite=this.setSubState(a,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};a.prototype.setColorWrite=
function(a){this._colorWrite=this.setSubState(a,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};a.prototype.setStencilWrite=function(a){this._stencilWrite=this.setSubState(a,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};a.prototype.setSubState=function(a,b,c,e){if(c||a!==b)e(a),this._pipelineInvalid=!0;return a};return a}();a.StateTracker=h})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require",
"exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.default=function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./VertexArrayObjects".split(" "),function(h,a,f,m,d,k){function n(a,e,c,b,f){if(b&&d.default(a))return!0;if(e[c])return!1;for(e=0;e<f.length;e++)if(a.getExtension(f[e]))return!0;return!1}Object.defineProperty(a,
"__esModule",{value:!0});a.loadCapabilities=function(a,e){e=e&&e.disabledExtensions||{};n(a,e,"standardDerivatives",!0,["OES_standard_derivatives"]);var c=m.load(a),b=k.load(a,e),g;g=e.compressedTextureS3TC?null:(g=a.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:g.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:g.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:g.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:g.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null;
var h;h=e.textureFilterAnisotropic?null:(h=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:h.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:h.TEXTURE_MAX_ANISOTROPY_EXT}:null;var v=f.load(a,e),z;d.default(a)?z={textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!a.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!e.textureHalfFloatLinear&&
!!a.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:a.HALF_FLOAT}:a instanceof WebGLRenderingContext?(z=!e.textureHalfFloat&&a.getExtension("OES_texture_half_float"),z={textureFloat:!e.textureFloat&&!!a.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!a.getExtension("OES_texture_float_linear"),textureHalfFloat:!!z,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!a.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:z?z.HALF_FLOAT_OES:void 0}):z=void 0;
var w;if(d.default(a)){w=!e.colorBufferFloat&&a.getExtension("EXT_color_buffer_half_float");var p=!e.colorBufferFloat&&a.getExtension("EXT_color_buffer_float");w=w||p?{textureFloat:!!p,textureHalfFloat:!!w,R16F:a.R16F,RG16F:a.RG16F,RGBA16F:a.RGBA16F,R32F:a.R32F,RG32F:a.RG32F,RGBA32F:a.RGBA32F,R11F_G11F_B10F:a.R11F_G11F_B10F,RGB16F:a.RGB16F}:null}else a instanceof WebGLRenderingContext?(w=!e.colorBufferFloat&&a.getExtension("EXT_color_buffer_half_float"),p=!e.colorBufferFloat&&a.getExtension("WEBGL_color_buffer_float"),
w=w||p?{textureFloat:!!p,textureHalfFloat:!!w,RGBA16F:w?w.RGBA16F_EXT:void 0,RGB16F:w?w.RGB16F_EXT:void 0,RGBA32F:p?p.RGBA32F_EXT:void 0}:null):w=void 0;p=d.default(a)?{MIN:a.MIN,MAX:a.MAX}:e.blendMinMax?null:(p=a.getExtension("EXT_blend_minmax"))?{MIN:p.MIN_EXT,MAX:p.MAX_EXT}:null;return{instancing:c,vao:b,compressedTextureS3TC:g,textureFilterAnisotropic:h,disjointTimerQuery:v,textureFloat:z,colorBufferFloat:w,blendMinMax:p,depthTexture:n(a,e,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture",
"WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:n(a,e,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),fragDepth:n(a,e,"fragDepth",!0,["EXT_frag_depth"])}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.load=function(a,d){if(d.disjointTimerQuery)return null;var k=a.getExtension("EXT_disjoint_timer_query")||a.getExtension("EXT_disjoint_timer_query_webgl2");
return k?f.default(a)?{createQuery:function(){return a.createQuery()},resultAvailable:function(d){return a.getQueryParameter(d,a.QUERY_RESULT_AVAILABLE)},getResult:function(d){return a.getQueryParameter(d,a.QUERY_RESULT)},disjoint:function(){return a.getParameter(k.GPU_DISJOINT_EXT)},beginTimeElapsed:function(d){return a.beginQuery(k.TIME_ELAPSED_EXT,d)},endTimeElapsed:function(){return a.endQuery(k.TIME_ELAPSED_EXT)},createTimestamp:function(a){return k.queryCounterEXT(a,k.TIMESTAMP_EXT)},timestampBits:function(){return a.getQuery(k.TIMESTAMP_EXT,
k.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return k.createQueryEXT()},resultAvailable:function(a){return k.getQueryObjectEXT(a,k.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(a){return k.getQueryObjectEXT(a,k.QUERY_RESULT_EXT)},disjoint:function(){return a.getParameter(k.GPU_DISJOINT_EXT)},beginTimeElapsed:function(a){return k.beginQueryEXT(k.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return k.endQueryEXT(k.TIME_ELAPSED_EXT)},createTimestamp:function(a){return k.queryCounterEXT(a,k.TIMESTAMP_EXT)},
timestampBits:function(){return k.getQueryEXT(k.TIMESTAMP_EXT,k.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.load=function(a){return f.default(a)?{drawArraysInstanced:a.drawArraysInstanced.bind(a),drawElementsInstanced:a.drawElementsInstanced.bind(a),vertexAttribDivisor:a.vertexAttribDivisor.bind(a)}:(a=a.getExtension("ANGLE_instanced_arrays"))?
{drawArraysInstanced:a.drawArraysInstancedANGLE.bind(a),drawElementsInstanced:a.drawElementsInstancedANGLE.bind(a),vertexAttribDivisor:a.vertexAttribDivisorANGLE.bind(a)}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.load=function(a,d){return f.default(a)?{createVertexArray:a.createVertexArray.bind(a),deleteVertexArray:a.deleteVertexArray.bind(a),bindVertexArray:a.bindVertexArray.bind(a)}:
d.vao?null:(a=a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||a.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:a.createVertexArrayOES.bind(a),deleteVertexArray:a.deleteVertexArrayOES.bind(a),bindVertexArray:a.bindVertexArrayOES.bind(a)}:null}})},"esri/views/2d/LabelManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/HandleOwner ../../core/throttle ../../core/accessorSupport/decorators ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter".split(" "),
function(h,a,f,m,d,k,n,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function b(b){b=a.call(this)||this;b._applyVisivilityPassThrottled=n.throttle(b._applyVisivilityPass,64,b);b._previousResolution=Number.POSITIVE_INFINITY;b.lastUpdateId=-1;b.updateRequested=!1;b.view=null;return b}f(b,a);b.prototype.initialize=function(){var a=this;this.collisionEngine=new e.default(this.view.featuresTilingScheme);this._layerViewSorter=new c.default(function(b,c){a.collisionEngine.registerLayer(b.layer,
b,c);(c=b.tileRenderer)&&c.forEachTile(function(c){c.isDirty=!0;a.addTile(b.layer.uid,c)});a.requestUpdate()},function(b){a.collisionEngine.unregisterLayer(b.layer);a.requestUpdate()});this.handles.add(this.view.allLayerViews.on("change",function(b){a._layerViewSorter.update(b)}))};b.prototype.destroy=function(){this._layerViewSorter.destroy();this.collisionEngine=this._layerViewSorter=null;this._applyVisivilityPassThrottled.remove()};Object.defineProperty(b.prototype,"updating",{get:function(){return this.updateRequested},
enumerable:!0,configurable:!0});b.prototype.update=function(a){var b=this._previousResolution,c=a.state.resolution;this._previousResolution=c;c===b&&this._applyVisivilityPassThrottled(a)};b.prototype.viewChange=function(){this.requestUpdate()};b.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))};b.prototype.processUpdate=function(a){this._set("updateParameters",a);this.updateRequested&&(this.update(a),this.updateRequested=!1)};b.prototype.addTile=
function(a,b){this.collisionEngine.addTile(a,b)};b.prototype.removeTile=function(a,b){this.collisionEngine.removeTile(a,b)};b.prototype._applyVisivilityPass=function(a){var b=this.view.featuresTilingScheme.getClosestInfoForScale(a.state.scale).level;this.collisionEngine.run(a.state,b)};m([g.property()],b.prototype,"updateRequested",void 0);m([g.property({readOnly:!0})],b.prototype,"updateParameters",void 0);m([g.property({dependsOn:["updateRequested"]})],b.prototype,"updating",null);m([g.property()],
b.prototype,"view",void 0);return b=m([g.subclass("esri.views.2d.layers.labels.LabelManager")],b)}(g.declared(d,k));a.default=h})},"esri/core/throttle":function(){define(["require","exports"],function(h,a){function f(a,d,f,h){var g=null,e=1E3;"number"===typeof d?(e=d,h=f):(g=d,e=f);var c=0,b,k=function(){c=0;a.apply(h,b)};d=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];g&&g.apply(h,a);b=a;e?c||(c=setTimeout(k,e)):k()};d.remove=function(){c&&(clearTimeout(c),c=0)};d.forceUpdate=
function(){c&&(clearTimeout(c),k())};d.hasPendingUpdates=function(){return!!c};return d}Object.defineProperty(a,"__esModule",{value:!0});a.throttle=f;a.default=f})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define("require exports @dojo/framework/shim/array @dojo/framework/shim/Map ../definitions ./CollisionBucket ./LayerCollisionInfo ../util/iterator ../../../../3d/support/mathUtils".split(" "),function(h,a,f,m,d,k,n,g,e){Object.defineProperty(a,"__esModule",{value:!0});
var c=d.TILE_SIZE/d.COLLISION_BUCKET_SIZE;h=function(){function a(a){this._layers=new m.default;this._collisionBuckets=new m.default;this._tilingScheme=a}Object.defineProperty(a.prototype,"collisionInfos",{get:function(){var a=[];g.forEachIter(this._layers.values(),function(b){return a.push(b)});return a},enumerable:!0,configurable:!0});a.prototype.registerLayer=function(a,b,c){if(a&&!this._layers.has(a.uid)){var e=n.default.create(a,b,c,this.collisionInfos,this._tilingScheme);this._layers.set(a.uid,
e);this._collisionBuckets.forEach(function(a){return a.onRegisterLayer(e.index)})}};a.prototype.unregisterLayer=function(a){var b=this;if(a&&this._layers.has(a.uid)){var c=this._layers.get(a.uid);n.default.delete(c.index,this.collisionInfos);this._layers.delete(a.uid);this._collisionBuckets.forEach(function(a,e){var d=a.getTile(c.index);d&&(a.onUnregisterLayer(c.index),a.canDelete()&&b._collisionBuckets.delete(e),d.reference&&(d.reference.isDirty=!1))})}};a.prototype.addTile=function(a,b){var c=b.key.id;
this._layers.has(a)&&(this._collisionBuckets.has(c)||this._collisionBuckets.set(c,new k.default(b.key,this._layers.size)),this._collisionBuckets.get(c).getTile(this._getIndex(a)).reference=b)};a.prototype.removeTile=function(a,b){this._layers.has(a)&&this._collisionBuckets.has(b)&&(a=this._collisionBuckets.get(b).getTile(this._getIndex(a)),a.dirty=!1,a.reference=null)};a.prototype.run=function(a,b){for(var c=f.from(this._collisionBuckets.values()).filter(function(a){return a.key.level===b}).sort(function(a,
b){return a.key.compareRowMajor(b.key)}),e=this._checkRotation(a.rotation),d=0;d<c.length;d++)for(var g=c[d],e=e||g.isDirty,k=0;k<this._layers.size;k++){var l=n.default.find(k,this.collisionInfos);g.computeNeighbors(this._collisionBuckets);g.reset(a,e,l)}for(a=0;a<this._layers.size;a++)for(l=n.default.find(a,this.collisionInfos),e=0,d=c;e<d.length;e++)g=d[e],this._run(g,l,b);for(l=0;l<c.length;l++)g=c[l],g.ready()};a.prototype._run=function(a,b,c){var e=a.getReference(b.index);e&&e.isDirty&&e.hasData&&
this._runVisibility(a,e,b,c)};a.prototype._runVisibility=function(a,b,c,e){for(var d=0,g=b.displayObjects;d<g.length;d++){for(var f=g[d],k=0,l=0;l<f.metrics.length;l++)var h=f.metrics[l],h=f.getLabelVisibility(c.layerView)?this._computeLabelVisibility(f,h,c.index,a,b,h.baseZoom,e):255,k=Math.max(h,k);for(var l=0,m=f.metrics;l<m.length;l++)h=m[l],b.setVisibilityRange(f.id,h.range.from,h.range.count,k),h.minZoom=k}};a.prototype._computeLabelVisibility=function(a,b,e,d,g,f,k){for(var l=b.xBucket,h=b.yBucket,
m=b.xOverflow,n=b.yOverflow,p=l-m,l=l+m+1,m=h+n+1,h=h-n;h<m;h++)for(n=p;n<l;n++)if(!(n<-c||h<-c||n>c||h>c))for(var v=0;v<=e;v++){var w=this._getRelativeSubBucket(v,d,g,n,h);if(w)for(var B=0;B<w.length;B++){var z=w[B];z.id!==a.id&&(z=this._compareLabels(b,z,f,k),f=Math.max(z,f))}}return f};a.prototype._compareLabels=function(a,b,c,g){var f=10*(g+d.COLLISION_MAX_ZOOM_DELTA);if(-1===b.minZoom||b.minZoom>f||b.minZoom>Math.floor(10*g))return c;a=a.findCollisionDelta(b);g=e.clamp(Math.floor(10*(a+g)),0,
255);return b.minZoom>=g?c:Math.max(c,g)};a.prototype._getNeighboringTile=function(a,b,c,e,d){return(b=b.neighbors[3*(1+d)+(1+e)])&&b.getTile(a)};a.prototype._getRelativeSubBucket=function(a,b,c,d,g){var f=e.sign(Math.floor(d/4)),k=e.sign(Math.floor(g/4));return(a=this._getNeighboringTile(a,b,c,f,k))&&a.reference&&a.index&&a.reference.hasData?a.index[g-4*k][d-4*f]:null};a.prototype._checkRotation=function(a){if(!this._lastRotation)return this._lastRotation=a,!1;var b=a!==this._lastRotation;this._lastRotation=
a;return b};a.prototype._getIndex=function(a){return this._layers.get(a).index};return a}();a.default=h})},"esri/views/2d/engine/webgl/collisions/CollisionBucket":function(){define(["require","exports","../../../tiling","./CollisionBucketEntry"],function(h,a,f,m){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,d){this.neighbors=Array(9);this._tiles=Array(d);for(var g=0;g<d;g++)this._tiles[g]=new m.default;this.key=a}Object.defineProperty(a.prototype,"isDirty",{get:function(){for(var a=
0,d=this._tiles;a<d.length;a++)if(d[a].dirty)return!0;return!1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._tiles.length},enumerable:!0,configurable:!0});a.prototype.getTile=function(a){return this._tiles[a]};a.prototype.getReference=function(a){return(a=this._tiles[a])&&a.reference};a.prototype.onRegisterLayer=function(a){this.invalidateRange(a);this._add(a)};a.prototype.onUnregisterLayer=function(a){this.invalidateRange(a);this._remove(a)};
a.prototype.onLabelsRendered=function(){};a.prototype.invalidateRange=function(a){for(;a<this._tiles.length;a++)this._tiles[a].dirty=!0};a.prototype.add=function(a){this._add(a)};a.prototype.remove=function(a){this._remove(a)};a.prototype.canDelete=function(){return 0===this._tiles.length};a.prototype.ready=function(){for(var a=0,d=this._tiles;a<d.length;a++)d[a].dirty=!1};a.prototype.computeNeighbors=function(a){this.neighbors[0]=this._getNeighbor(a,-1,-1);this.neighbors[1]=this._getNeighbor(a,0,
-1);this.neighbors[2]=this._getNeighbor(a,1,-1);this.neighbors[3]=this._getNeighbor(a,-1,0);this.neighbors[4]=this;this.neighbors[5]=this._getNeighbor(a,1,0);this.neighbors[6]=this._getNeighbor(a,-1,1);this.neighbors[7]=this._getNeighbor(a,0,1);this.neighbors[8]=this._getNeighbor(a,1,1)};a.prototype.reset=function(a,d,g){for(var e=0,c=this._tiles;e<c.length;e++){var b=c[e];b&&b.reset(a,d,g)}};a.prototype._add=function(a){var d=[];if(a>=this._tiles.length)this._tiles.push(new m.default);else{for(var g=
0;g<this._tiles.length;g++)g===a&&d.push(new m.default),d.push(this._tiles[g]);this._tiles=d}};a.prototype._remove=function(a){for(var d=[],g=0;g<this._tiles.length;g++)g!==a&&d.push(this._tiles[g]);this._tiles=d};a.prototype._getNeighbor=function(a,d,g){var e=this.key;d=f.TileKey.getId(e.level,e.row+g,e.col+d,e.world);return a.has(d)?a.get(d):null};return a}();a.default=h})},"esri/views/2d/engine/webgl/collisions/CollisionBucketEntry":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],
function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._reference=null}Object.defineProperty(a.prototype,"dirty",{get:function(){return this.reference&&this.reference.isDirty},set:function(a){this.reference&&this.reference.hasData&&(this.reference.isDirty=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"index",{get:function(){return this._reference&&this._reference.labelIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"reference",{get:function(){return this._reference},set:function(a){this._reference=a},enumerable:!0,configurable:!0});a.prototype.reset=function(a,k,h){var d=this.reference;if(!d||!d.hasData)return!1;k&&(d.isDirty=!0);k=d.labelMat2d;for(var e=d.labelMat2d[4],c=d.labelMat2d[5],b=0,l=d.displayObjects;b<l.length;b++)for(var m=0,n=l[b].metrics;m<n.length;m++){var z=n[m];h.hasVV()&&z.computeOffset(h.vvEval);var w=z.bounds.center,p=z.bounds.centerT;d.isDirty&&(z.minZoom=-1);var B=f.vec2.copy(p,z.anchor);
a.rotation?f.vec2.transformMat2d(B,B,k):(p[0]=B[0]+e,p[1]=B[1]+c);f.vec2.add(p,B,w);p[0]+=z.offsetX;p[1]+=z.offsetY;if(z.boxes)for(w=0,p=z.boxes;w<p.length;w++){var B=p[w],F=B.centerT;f.vec2.add(F,z.anchor,B.center);a.rotation?f.vec2.transformMat2d(F,F,k):(F[0]+=e,F[1]+=c)}}return!0};return a}();a.default=h})},"esri/views/2d/engine/webgl/collisions/LayerCollisionInfo":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/screenUtils","../../../../3d/support/mathUtils"],
function(h,a,f,m,d){function k(a){return function(b){return m.pt2px(a.getSize(b))}}function n(a){if(!a)return null;for(var b=0;b<a.length;b++){var c=a[b];if("size"===c.type)return k(c)}return null}Object.defineProperty(a,"__esModule",{value:!0});var g=function(a,c){return a.order-c.order},e=function(a,c){return a.index-c.index},c=f.getLogger("esri/views/2d/engine/webgl/collisions/CollisionEngine");a.createLabelVVEvaluator=n;h=function(){function a(a,b,c,e,g){var f=this;this._vvHandle=null;var k=a.geometryType,
h=a.labelingInfo,l=a.renderer;this.vvEval=n("visualVariables"in l&&l.visualVariables);this._vvHandle=a.watch("visualVariables",function(a){f.vvEval=n(a)});a=h.map(function(a){var b=!!a.maxScale,c=!!a.minScale&&g.scaleToZoom(a.minScale)||0;a=b&&g.scaleToZoom(a.maxScale)||255;return{minZoom:d.clamp(Math.floor(10*c),0,255),maxZoom:d.clamp(Math.floor(10*a),0,255)}});this.geometryType=k;this.index=c;this.order=e;this.zoomRanges=a;this.layerView=b}a.prototype.hasVV=function(){return!!this.vvEval};a.prototype.allOrNothing=
function(){return"polyline"!==this.geometryType};a.prototype.destroy=function(){this._vvHandle.remove()};a.create=function(b,c,e,d,f){d=d.sort(g);for(var k=!1,h=-1,l=0;l<d.length;l++){var m=d[l];!k&&m.order>e&&(h=m.index,k=!0);k&&m.index++}k||(h=d.length);return new a(b,c,h,e,f)};a.delete=function(a,b){for(var c=b.sort(e),d=a+1;d<c.length;d++)b[d].index--;b[a].destroy();b.splice(a,1)};a.find=function(a,b){for(var e=0;e<b.length;e++){var d=b[e];if(d.index===a)return d}c.error("Tried to get a LayerCollisionInfo for an index that doesn't exist!");
return null};return a}();a.default=h})},"esri/views/2d/engine/webgl/util/iterator":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.forEachIter=function(a,h){for(;;){var d=a.next();if(d.done)break;h(d.value)}}})},"esri/views/2d/engine/webgl/collisions/LayerViewSorter":function(){define(["require","exports","@dojo/framework/shim/Map"],function(h,a,f){function m(a){return"esri.views.2d.layers.FeatureLayerView2D"===a.declaredClass||"esri.views.2d.layers.StreamLayerView2D"===
a.declaredClass}Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,d){this.registerLayer=a;this.unregisterLayer=d;this._layerViewState=new f.default}a.prototype.findIndex=function(a){return a.view.allLayerViews.findIndex(function(d){return d.uid===a.uid})};a.prototype.update=function(a){for(var d=a.added,g=0,e=a.removed;g<e.length;g++)a=e[g],m(a)&&this._layerViewState.has(a)&&this._deleteState(a);for(g=0;g<d.length;g++){a=d[g];if(e=m(a))a:switch(a.get("layer.renderer.type")){case "class-breaks":case "simple":case "unique-value":e=
!0;break a;default:e=!1}e&&!this._layerViewState.has(a)&&this._createState(a)}this._recomputeOrder()};a.prototype.destroy=function(){var a=this;this._layerViewState.forEach(function(d,g){return a._deleteState(g)})};a.prototype._createState=function(a){var d={priority:-1,handle:null};d.handle=a.watch("labelsVisible",this._recomputeOrder.bind(this));this._layerViewState.set(a,d);return d};a.prototype._deleteState=function(a){if(this._layerViewState.has(a)){var d=this._layerViewState.get(a);d.handle.remove();
-1!==d.priority&&this.unregisterLayer(a);this._layerViewState.delete(a)}};a.prototype._recomputeOrder=function(){var a=this;this._layerViewState.forEach(function(d,g){var e=g.view.map.allLayers.findIndex(function(a){return a.uid===g.layer.uid}),c=g.layer,e=c.visible&&c.labelsVisible&&c.labelingInfo?4294967295-e:-1;e!==d.priority&&(d.priority=e,a.unregisterLayer(g),-1!==e&&a.registerLayer(g,e))})};return a}();a.default=h})},"esri/views/2d/layers/support/GraphicsView2D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/HandleOwner ../../../../core/Identifiable ../../../../core/MapPool ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/jsonUtils ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/data/projectionSupport ../../engine/webgl/GraphicContainer ../../engine/webgl/TileData ../../engine/webgl/WGLTile ../../engine/webgl/mesh/factories/matcherUtils ../../engine/webgl/mesh/factories/WGLMeshFactory ../../engine/webgl/mesh/templates/WGLTemplateStore ../features/support/TileStore ../graphics/GraphicProcessingQueue ../graphics/GraphicStore ../graphics/graphicsUtils ../../../layers/GraphicsView".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p,B,F,q,x,u,A,C,D,G,H){function I(a,b,c){if(c.has(a))return c.get(a);b={tile:b,addedOrModified:[],removed:[]};c.set(a,b);return b}Object.defineProperty(a,"__esModule",{value:!0});var L=new Set;h=function(a){function d(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b._hiddenGraphics=[];b._tiles=new Map;b._graphicStoreUpdate=!1;b._highlightIDs=new Set;b._graphicsSet=new Set;b._matcher=null;b._tileUpdateSet=new Set;b._tilesToUpdate=
new Map;b._pendingUpdates=0;b._attached=!1;b.lastUpdateId=-1;b.updateRequested=!1;b.graphicUpdateHandler=b.graphicUpdateHandler.bind(b);b._addOrUpdateGraphic=b._addOrUpdateGraphic.bind(b);b._processAnalyzedGraphics=b._processAnalyzedGraphics.bind(b);b._graphicsChangeHandler=b._graphicsChangeHandler.bind(b);return b}f(d,a);d.prototype.initialize=function(){var a=this;this._tileStore=new A.default(this.view.featuresTilingScheme);this.container=new p.default({tileInfoView:this.view.featuresTilingScheme,
highlightIDs:this._highlightIDs});this._graphicStore=new D.default(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.renderer,this.graphics);this._graphicProcessingQueue=new C.default({process:this._addOrUpdateGraphic});var b=new u.default(this.container.getMaterialItems);this.renderer&&(this._matcher=q.createMatcher(this.renderer,b,null));this._meshFactory=new x.default(null,this.uid,null,null,window.devicePixelRatio,this.view.spatialReference,b,null,this._tileStore.tileScheme.tileInfo);
this.watch("renderer",function(c){if(a._graphicStore.renderer=c)a._matcher=q.createMatcher(a.renderer,b,null)});this._tileStore.on("update",this._onTileUpdate.bind(this));this.container.on("attach",function(){0<a.graphics.items.length&&a._graphicsChangeHandler({target:a.graphics,added:a.graphics.items,removed:[],moved:[]});a.handles.add(a.graphics.on("change",a._graphicsChangeHandler),"graphics");a._attached=!0;a.notifyChange("updating")})};d.prototype.destroy=function(){this._set("graphics",null);
this._graphicStore.clear();this._tileStore.destroy()};Object.defineProperty(d.prototype,"updating",{get:function(){return!this._attached||0!==this._pendingUpdates||this._graphicProcessingQueue.updating||0<this._tileUpdateSet.size||0<this._tilesToUpdate.size},enumerable:!0,configurable:!0});d.prototype.install=function(a){a.addChild(this.container)};d.prototype.uninstall=function(a){a.removeChild(this.container)};d.prototype.addHighlight=function(a){for(var b=0;b<a.length;b++)this._highlightIDs.add(a[b]);
this._buildHLList()};d.prototype.highlight=function(a){var b=this;b.addHighlight(a);return{remove:function(){b.removeHighlight(a)}}};d.prototype.hitTest=function(a,b){if(!this.view||!this.view.position)return e.resolve();a=this.view.toMap(c.createScreenPoint(a,b));return this.searchFeatures(a).then(function(a){return a&&a.length?a[0]:null})};d.prototype.searchFeatures=function(a,b){var c=this;void 0===b&&(b=2);return e.create(function(e){e(c._graphicStore.hitTest(a.x,a.y,b,c.view.state.resolution,
c.view.state.rotation))})};d.prototype.removeHighlight=function(a){for(var b=0;b<a.length;b++)this._highlightIDs.delete(a[b]);this._buildHLList()};d.prototype.setHighlight=function(a){this._highlightIDs.clear();this.addHighlight(a)};d.prototype.update=function(a){a=a.state;var b=this.view.featuresTilingScheme.getClosestInfoForScale(a.scale).level;this._graphicStore.updateLevel(b);this._tileStore.setViewState(a);this._graphicStoreUpdate=!0;this.updateRequested=!1};d.prototype.viewChange=function(){this.requestUpdate()};
d.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))};d.prototype.processUpdate=function(a){this.updateRequested&&(this.updateRequested=!1,this.update(a))};d.prototype.graphicUpdateHandler=function(a){var b=a.graphic,c=a.newValue;switch(a.property){case "geometry":case "symbol":this._graphicProcessingQueue.push(b,"update");break;case "visible":this._setVisible(b.uid,c)}};d.prototype._getIntersectingTiles=function(a){return(a=this._graphicStore.getBounds(a))&&
0!==y.width(a)&&0!==y.height(a)?this._tileStore.boundsIntersections(a):[]};d.prototype._updateTile=function(a){var b=this,c=a.tile,e=this._getGraphicsData(c,a.addedOrModified);return this._processGraphics(c.key,e).then(function(e){b._patchTile(c.key,{addOrUpdate:e,remove:a.removed});return e})};d.prototype._graphicsChangeHandler=function(a){var b=this;this._pendingUpdates++;this.notifyChange("updating");if(!this._graphicStoreUpdate){var c=this.view.state,d=this.view.featuresTilingScheme.getClosestInfoForScale(c.scale).level;
this._graphicStore.updateLevel(d);this._tileStore.setViewState(c)}var g=a.added,d=a.removed;a=a.moved;for(var f=this._tilesToUpdate,k,c=[],h=Array(g.length),l=0;l<g.length;l++){var m=g[l];h[l]=m;this._graphicsSet.add(m);c.push(this._addOrUpdateGraphic(m,"add"))}for(l=0;l<d.length;l++){for(var m=d[l],g=this._getIntersectingTiles(m),n=0,q=g;n<q.length;n++)g=q[n],k=g.key.id,g=I(k,g,f),g.removed.push(m.uid);this._graphicsSet.delete(m);this._graphicStore.remove(m)}for(d=0;d<a.length;d++)for(l=a[d],g=this._getIntersectingTiles(l),
m=0,n=g;m<n.length;m++)g=n[m],k=g.key.id,g=I(k,g,f),g.addedOrModified.push(l);e.all(c).then(function(){for(var a,c=0;c<h.length;c++){a=h[c];for(var d=0,g=b._getIntersectingTiles(a);d<g.length;d++){var l=g[d];k=l.key.id;I(k,l,f).addedOrModified.push(a)}}b._graphicStore.updateZ();var m=[];f.forEach(function(a){return m.push(b._updateTile(a))});return e.all(m).then(function(){f.clear();b._pendingUpdates--;b.notifyChange("updating")})}).catch(function(){b._pendingUpdates--})};d.prototype._buildHLList=
function(){for(var a=0,b=this.container.children;a<b.length;a++)b[a].buildHLList(this._highlightIDs);this.container.requestRender()};d.prototype._getSymbolResources=function(a){var b=a.symbol;!b&&this.renderer&&(b=this.renderer.getSymbol(a,{scale:this.view.scale}));if(!b||b&&"text"!==b.type)return e.resolve(null);L.clear();a=b;for(var b=a.text,c=0;c<b.length;c++)L.add(b.charCodeAt(c));var d=[];L.forEach(function(a){return d.push(a)});b=[];b.push({symbol:a.toJSON(),id:0,glyphIds:d});return this.container.getMaterialItems(b).then(function(a){return 0<
a.length?a[0].mosaicItem:null})};d.prototype._projectAndNormalizeGeometry=function(a){var b=this;if(!a.geometry)return e.resolve(null);var c=a.geometry;v.isPolygon(c)?c.rings=c.rings:v.isPolyline(c)?c.paths=c.paths:v.isExtent(c)&&(c=l.fromExtent(c));return w.checkProjectionSupport(c.spatialReference,this.view.spatialReference).then(function(){var a=G.normalizeCentralMeridian(c),a=w.project(a,c.spatialReference,b.view.spatialReference);G.ensureClosedRings(a);return a})};d.prototype._onTileUpdate=function(a){var b=
this,c=z.getInfo(this.view.spatialReference);if(a.added&&0<a.added.length)for(var e=function(a){var e=d._graphicStore.queryTileData(a);if(c)for(var g=Math.round((c.valid[1]-c.valid[0])/a.resolution),f=0;f<e.length;f++){var k=e[f];k.geometry&&v.isPoint(k.geometry)&&d._wrapPoints(k,g)}d._tileUpdateSet.add(a.key);d.notifyChange("updating");d._processGraphics(a.key,e).then(function(c){b._addTile(a.key,c);b._tileUpdateSet.delete(a.key);b.notifyChange("updating")}).catch(function(){b._tileUpdateSet.delete(a.key);
b.notifyChange("updating")})},d=this,g=0,f=a.added;g<f.length;g++)e(f[g]);if(a.removed&&0<a.removed.length)for(e=0,a=a.removed;e<a.length;e++)this._removeTile(a[e].key)};d.prototype._addOrUpdateGraphic=function(a,b){var c=this,d=this._projectAndNormalizeGeometry(a),g=this._getSymbolResources(a);return e.all([d,g]).then(function(e){var d=e[0];e=e[1];return"add"===b?c._addProjectedGraphic(a,e,d):c._updateGraphic(a,e,d)})};d.prototype._addProjectedGraphic=function(a,b,c){if(!this._graphicsSet.has(a))return null;
a.visible||this._hiddenGraphics.push(a.uid);a=this._graphicStore.add(a,b,c);return!a||0===y.width(a)&&0===y.height(a)?null:a};d.prototype._updateGraphic=function(a,b,c){var d=this;if(!this._graphicStore.has(a))return e.resolve();c=this._graphicStore.update(a,b,c);b=c.oldBounds;var f=c.newBounds,k=0===y.width(b)&&0===y.height(b);c=0===y.width(f)&&0===y.height(f);var h=k?[]:this._tileStore.boundsIntersections(b);b=c?[]:this._tileStore.boundsIntersections(f);c=g.acquire();for(var l=0;l<h.length;l++)k=
h[l],c.set(k.key,{addOrUpdate:null,remove:[a.uid]});for(h=0;h<b.length;h++)k=b[h],l=this._getGraphicData(k,a),c.has(k.key)?(k=c.get(k.key),k.remove.length=0,k.addOrUpdate=l):c.set(k.key,{addOrUpdate:l,remove:null});var m=[];c.forEach(function(a,b){var c=d._processGraphics(b,a.addOrUpdate).then(function(c){d._patchTile(b,{addOrUpdate:c,remove:a.remove})});m.push(c)});g.release(c);return e.all(m).then(function(){return f})};d.prototype._addTile=function(a,b){var c=y.create();this.view.featuresTilingScheme.getTileBounds(c,
a);c=new F(a,c,!0);c.setData({clear:!0,addOrUpdate:b,remove:[]},!1,!1);c.buildHLList(this._highlightIDs);0<this._hiddenGraphics.length&&c.setFilterFlag(0,[],this._hiddenGraphics);this._tiles.set(a,c);this.container.addChild(c)};d.prototype._removeTile=function(a){this._tiles.has(a)&&(a=this._tiles.get(a),this.container.removeChild(a))};d.prototype._patchTile=function(a,b){this._tiles.has(a)&&(a=this._tiles.get(a),a.setData(b,!1,!1),a.buildHLList(this._highlightIDs),0<this._hiddenGraphics.length&&
a.setFilterFlag(0,[],this._hiddenGraphics),this.container.requestRender())};d.prototype._setVisible=function(a,b){var c=[],e=[],d=this._hiddenGraphics.indexOf(a);if(b){if(-1!==d)this._hiddenGraphics.splice(d,1);else return;c.push(a)}else{if(-1===d)this._hiddenGraphics.push(a);else return;e.push(a)}a=0;for(b=this.container.children;a<b.length;a++)d=b[a],d.data&&d.setFilterFlag(0,c,e)};d.prototype._getGraphicsData=function(a,b){var c=z.getInfo(this.view.spatialReference);b=this._graphicStore.getGraphicsData(a,
b);if(c)for(a=Math.round((c.valid[1]-c.valid[0])/a.resolution),c=0;c<b.length;c++){var e=b[c];e.geometry&&v.isPoint(e.geometry)&&this._wrapPoints(e,a)}b.sort(function(a,b){return a.insertAfter-b.insertAfter});return b};d.prototype._getGraphicData=function(a,b){b=this._graphicStore.getGraphicData(a,b);var c=[b],e=z.getInfo(this.view.spatialReference);e&&(a=Math.round((e.valid[1]-e.valid[0])/a.resolution),b.geometry&&v.isPoint(b.geometry)&&this._wrapPoints(b,a));return c};d.prototype._wrapPoints=function(a,
b){var c=a.geometry;512===b?20>c.x?a.geometry={points:[[c.x,c.y],[b,0]]}:492<c.x&&(a.geometry={points:[[c.x,c.y],[-b,0]]}):-20>c.x?a.geometry={points:[[c.x,c.y],[b,0]]}:532<c.x&&(a.geometry={points:[[c.x,c.y],[-b,0]]})};d.prototype._processGraphics=function(a,b){var c=this;return b&&b.length&&this._meshFactory?this._meshFactory.analyze(b,this._matcher).then(function(b){return c._processAnalyzedGraphics(a,b)}):e.resolve(null)};d.prototype._processAnalyzedGraphics=function(a,b){for(var c=this._meshFactory,
e=c.createMeshData(b.length),d=0;d<b.length;d++)c.write(e,b[d],null,null,a.level);return B.fromMeshData(e)};m([b.property()],d.prototype,"_graphicProcessingQueue",void 0);m([b.property({constructOnly:!0})],d.prototype,"graphics",void 0);m([b.property({dependsOn:["_graphicProcessingQueue.updating"]})],d.prototype,"updating",null);m([b.property()],d.prototype,"view",void 0);m([b.property()],d.prototype,"updateRequested",void 0);return d=m([b.subclass("esri.views.2d.layers.support.GraphicsView2D")],
d)}(b.declared(H,k,n.Identifiable));a.default=h})},"esri/core/MapPool":function(){define(["require","exports","./ObjectPool"],function(h,a,f){h=function(){function a(a,d){void 0===a&&(a=50);void 0===d&&(d=50);this._pool=new f(Map,!1,function(a){return a.clear()},d,a)}a.prototype.acquire=function(){return this._pool.acquire()};a.prototype.release=function(a){this._pool.release(a)};a.acquire=function(){return m.acquire()};a.release=function(a){return m.release(a)};return a}();var m=new h(100);return h})},
"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(h,a,f,m,d,k,n){function g(a,b){var d;if(!b)return null;if("x"in b){var g={x:0,y:0};a=a(b.x,b.y,l);g.x=a[0];g.y=a[1];null!=b.z&&(g.z=b.z);null!=b.m&&(g.m=b.m);return g}if("xmin"in b)return g={xmin:0,ymin:0,xmax:0,ymax:0},d=a(b.xmin,b.ymin,
l),g.xmin=d[0],g.ymin=d[1],a=a(b.xmax,b.ymax,l),g.xmax=a[0],g.ymax=a[1],b.hasZ&&(g.zmin=b.zmin,g.zmax=b.zmax,g.hasZ=!0),b.hasM&&(g.mmin=b.mmin,g.mmax=b.mmax,g.hasM=!0),g;if("rings"in b)return{rings:e(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:e(b.paths,a),hasM:b.hasM,hasZ:b.hasZ};if("points"in b)return{points:c(b.points,a),hasM:b.hasM,hasZ:b.hasZ}}function e(a,b){for(var e=[],d=0;d<a.length;d++)e.push(c(a[d],b));return e}function c(a,b){for(var c=[],e=0;e<a.length;e++){var d=
a[e],g=b(d[0],d[1],[0,0]);c.push(g);2<d.length&&g.push(d[2]);3<d.length&&g.push(d[3])}return c}function b(a,b){return!k.isValid(a)||!k.isValid(b)||k.equals(a,b)||n.canProject(a,b)?!1:!0}Object.defineProperty(a,"__esModule",{value:!0});var l=[0,0];a.checkProjectionSupport=function(a,c){if(!c)return m.resolve();if(Array.isArray(a)){for(var e=0;e<a.length;e++){var g=a[e];if(b(g.geometry&&g.geometry.spatialReference,c))return d.isSupported()?d.load():m.reject(new f("feature-store:unsupported-query","projection not supported",
{inSpatialReference:a,outSpatialReference:c}))}return m.resolve()}return b(a,c)?d.isSupported()?d.load():m.reject(new f("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:c})):m.resolve()};var y=g.bind(null,n.lngLatToXY),v=g.bind(null,n.xyToLngLat);a.project=function(a,b,c){c||(c=b,b=a.spatialReference);return k.isValid(b)&&k.isValid(c)&&!k.equals(b,c)?n.canProject(b,c)?k.isWebMercator(c)?y(a):v(a):d.projectMany([a],b,c,null,!0)[0]:a};var z=new (function(){function a(){this._jobs=
[];this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a,b,c){var e=this;a&&a.length&&b&&c&&!k.equals(b,c)||m.resolve(a);var d={geometries:a,inSpatialReference:b,outSpatialReference:c,resolve:null};this._jobs.push(d);return m.create(function(a){d.resolve=a;null===e._timer&&(e._timer=setTimeout(e._process,10))},function(){var a=e._jobs.indexOf(d);-1<a&&e._jobs.splice(a,1)})};a.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var b=a.geometries,
c=a.inSpatialReference,e=a.outSpatialReference,a=a.resolve;n.canProject(c,e)?k.isWebMercator(e)?a(b.map(y)):a(b.map(v)):a(d.projectMany(b,c,e,null,!0));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return a}());a.projectMany=function(a,b,c){return z.push(a,b,c)}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),function(h,a,f,m,d,k){function n(a,c,f,h,m){void 0===h&&(h=null);
void 0===m&&(m=!1);if(null===h){var l=k.cacheKey(c,f);void 0!==b[l]?h=b[l]:(h=g(c,f,null),null===h&&(h=new k),b[l]=h)}return e._project(a,c,f instanceof d||!1===m?f:new d(f),h,m)}function g(a,b,c){void 0===c&&(c=null);a=e._getTransformation(a,b,c);return null!==a?k.fromGE(a):null}Object.defineProperty(a,"__esModule",{value:!0});var e=null;a.isLoaded=function(){return!!e&&m.isLoaded()};a.isSupported=function(){return m.isSupported()};var c=null;a.load=function(){return c?c:c=f.create(function(a,b){var c=
m.load();h(["./geometryEngine"],function(d){e=d;c.then(function(){e._enableProjection(m);a()},function(a){b(a)})})})};a.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:n(a,a[0].spatialReference,b,c):n([a],a.spatialReference,b,c)[0]};var b={};a.projectMany=n;a.getTransformation=g;a.getTransformations=function(a,b,c){void 0===c&&(c=null);a=e._getTransformationBySuitability(a,b,c);if(null!==a){b=[];for(c=0;c<a.length;c++)b.push(k.fromGE(a[c]));return b}return[]}})},
"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(h,a,f,m,d){function k(b){function e(a,b,c){a[b]=c(a[b])}a._pe=b;l.init();y.init();v.init();z.init();w.init();a.PeGCSExtent=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}f(c,b);c.prototype.destroy=function(){a._pe.destroy(this)};return c}(a._pe.PeGCSExtent);for(var d=0,g=[a._pe.PeDatum,a._pe.PeGeogcs,a._pe.PeGeogtran,a._pe.PeObject,a._pe.PeParameter,
a._pe.PePrimem,a._pe.PeProjcs,a._pe.PeSpheroid,a._pe.PeUnit];d<g.length;d++)b=g[d],e(b.prototype,"getName",function(a){return function(){return a.call(this,Array(l.PE_NAME_MAX))}});d=0;for(g=[a._pe.PeGeogtran,a._pe.PeProjcs];d<g.length;d++)b=g[d],e(b.prototype,"getParameters",function(b){return function(){for(var c=Array(l.PE_PARM_MAX),e=b.call(this),d=0;d<c.length;d++){var g=a._pe.getValue(e,"*");c[d]=g?a._pe.wrapPointer(g,a._pe.PeParameter):null;e+=Int32Array.BYTES_PER_ELEMENT}return c}});e(a._pe.PeHorizon.prototype,
"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var e=[],d=a.call(this);c(e,b,d);return e}});e(a._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(b){var c=a._pe._pe_getPeGTlistExtendedGTsSize();return function(){var e=null,d=b.call(this);if(!a._pe.compare(d,a._pe.NULL)){var e=[d],g=this.getSteps();if(1<g)for(var d=a._pe.getPointer(d),f=1;f<g;f++)e.push(a._pe.wrapPointer(d+c*f,a._pe.PeGTlistExtendedGTs))}return e}});var k=a._pe._pe_getPeHorizonSize();b=function(b){return function(){var c=
this._cache;c||(this._cache=c=new Map);if(c.has(b))return c.get(b);var e=null,d=b.call(this);if(!a._pe.compare(d,a._pe.NULL)){var e=[d],g=d.getNump();if(1<g)for(var d=a._pe.getPointer(d),f=1;f<g;f++)e.push(a._pe.wrapPointer(d+k*f,a._pe.PeHorizon))}c.set(b,e);return e}};e(a._pe.PeProjcs.prototype,"horizonGcsGenerate",b);e(a._pe.PeProjcs.prototype,"horizonPcsGenerate",b);a._pe.PeObject.prototype.toString=function(b){void 0===b&&(b=l.PE_STR_OPTS_NONE);a._pe.ensureCache.prepare();var c=a._pe.getPointer(this),
e=a._pe.ensureInt8(Array(l.PE_BUFFER_MAX));return a._pe.Pointer_stringify(a._pe._pe_object_to_string_ext(c,b,e))}}function n(b){if(b){var c=a._pe.getClass(b);c&&(c=a._pe.getCache(c))&&(b=a._pe.getPointer(b))&&delete c[b]}}function g(b,c){var e=[];c=Array(c);for(var d=0;d<b;d++)e.push(a._pe.ensureInt8(c));return e}function e(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):b=a;return b}function c(b,c,e,d){void 0===d&&(d=!1);if(d)for(d=0;d<2*c;d++)b[d]=a._pe.getValue(e+
d*Float64Array.BYTES_PER_ELEMENT,"double");else{var g=0===b.length;for(d=0;d<c;d++)g&&(b[d]=Array(2)),b[d][0]=a._pe.getValue(e,"double"),b[d][1]=a._pe.getValue(e+Float64Array.BYTES_PER_ELEMENT,"double"),e+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(a,"__esModule",{value:!0});var b;a._pe=null;a.isLoaded=function(){return!!a._pe};a.isSupported=function(){return!!m("esri-wasm")};a.load=function(){return b?b:b=d.create(function(a,b){h(["./support/pe-wasm"],function(c){c({locateFile:function(a){return h.toUrl("./support/"+
a)},onAbort:function(a){b(Error(a))}}).then(function(b){k(b);a()})})})};(function(b){function d(b,d,g){a._pe.ensureCache.prepare();var f=e(g),k=g===f,f=a._pe.ensureFloat64(f);(b=a._pe._pe_geog_to_proj(a._pe.getPointer(b),d,f))&&c(g,d,f,k);return b}function g(a,b,c){return f(a,b,c,0)}function f(b,d,g,f){a._pe.ensureCache.prepare();var k=e(g),h=g===k,k=a._pe.ensureFloat64(k);(b=a._pe._pe_proj_to_geog_center(a._pe.getPointer(b),d,k,f))&&c(g,d,k,h);return b}b.geogToProj=d;b.projGeog=function(a,b,c,e){switch(e){case l.PE_TRANSFORM_P_TO_G:return g(a,
b,c);case l.PE_TRANSFORM_G_TO_P:return d(a,b,c)}return 0};b.projToGeog=g;b.projToGeogCenter=f})(a.PeCSTransformations||(a.PeCSTransformations={}));var l;(function(b){b.init=function(){b.PE_BUFFER_MAX=a._pe.PeDefs.prototype.PE_BUFFER_MAX;b.PE_NAME_MAX=a._pe.PeDefs.prototype.PE_NAME_MAX;b.PE_MGRS_MAX=a._pe.PeDefs.prototype.PE_MGRS_MAX;b.PE_USNG_MAX=a._pe.PeDefs.prototype.PE_USNG_MAX;b.PE_DD_MAX=a._pe.PeDefs.prototype.PE_DD_MAX;b.PE_DDM_MAX=a._pe.PeDefs.prototype.PE_DDM_MAX;b.PE_DMS_MAX=a._pe.PeDefs.prototype.PE_DMS_MAX;
b.PE_UTM_MAX=a._pe.PeDefs.prototype.PE_UTM_MAX;b.PE_PARM_MAX=a._pe.PeDefs.prototype.PE_PARM_MAX;b.PE_TYPE_NONE=a._pe.PeDefs.prototype.PE_TYPE_NONE;b.PE_TYPE_GEOGCS=a._pe.PeDefs.prototype.PE_TYPE_GEOGCS;b.PE_TYPE_PROJCS=a._pe.PeDefs.prototype.PE_TYPE_PROJCS;b.PE_TYPE_GEOGTRAN=a._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;b.PE_TYPE_COORDSYS=a._pe.PeDefs.prototype.PE_TYPE_COORDSYS;b.PE_TYPE_UNIT=a._pe.PeDefs.prototype.PE_TYPE_UNIT;b.PE_STR_OPTS_NONE=a._pe.PeDefs.prototype.PE_STR_OPTS_NONE;b.PE_STR_AUTH_NONE=
a._pe.PeDefs.prototype.PE_STR_AUTH_NONE;b.PE_STR_AUTH_TOP=a._pe.PeDefs.prototype.PE_STR_AUTH_TOP;b.PE_STR_NAME_CANON=a._pe.PeDefs.prototype.PE_STR_NAME_CANON;b.PE_PARM_X0=a._pe.PeDefs.prototype.PE_PARM_X0;b.PE_PARM_ND=a._pe.PeDefs.prototype.PE_PARM_ND;b.PE_TRANSFORM_1_TO_2=a._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;b.PE_TRANSFORM_2_TO_1=a._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;b.PE_TRANSFORM_P_TO_G=a._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;b.PE_TRANSFORM_G_TO_P=a._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;
b.PE_HORIZON_RECT=a._pe.PeDefs.prototype.PE_HORIZON_RECT;b.PE_HORIZON_POLY=a._pe.PeDefs.prototype.PE_HORIZON_POLY;b.PE_HORIZON_LINE=a._pe.PeDefs.prototype.PE_HORIZON_LINE;b.PE_HORIZON_DELTA=a._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(l=a.PeDefs||(a.PeDefs={}));(function(b){function c(b,c){var g=null,f=e[b];f||(f={},e[b]=f);f.hasOwnProperty(String(c))?g=f[c]:(b=a._pe.PeFactory.prototype.factoryByType(b,c),a._pe.compare(b,a._pe.NULL)||(g=b,f[c]=g));return g=d(g)}function d(b){if(b){var c=b.getType();
switch(c){case l.PE_TYPE_GEOGCS:b=a._pe.castObject(b,a._pe.PeGeogcs);break;case l.PE_TYPE_PROJCS:b=a._pe.castObject(b,a._pe.PeProjcs);break;case l.PE_TYPE_GEOGTRAN:b=a._pe.castObject(b,a._pe.PeGeogtran);break;default:c&l.PE_TYPE_UNIT&&(b=a._pe.castObject(b,a._pe.PeUnit))}}return b}var e={},g={};b.initialize=function(){a._pe.PeFactory.prototype.initialize(null)};b.coordsys=function(a){return c(l.PE_TYPE_COORDSYS,a)};b.factoryByType=c;b.fromString=function(b,c){var e=null,f=g[b];f||(f={},g[b]=f);f.hasOwnProperty(c)?
e=f[c]:(b=a._pe.PeFactory.prototype.fromString(b,c),a._pe.compare(b,a._pe.NULL)||(e=b,f[c]=e));return e=d(e)};b.geogcs=function(a){return c(l.PE_TYPE_GEOGCS,a)};b.geogtran=function(a){return c(l.PE_TYPE_GEOGTRAN,a)};b.getCode=function(b){return a._pe.PeFactory.prototype.getCode(b)};b.projcs=function(a){return c(l.PE_TYPE_PROJCS,a)};b.unit=function(a){return c(l.PE_TYPE_UNIT,a)}})(a.PeFactory||(a.PeFactory={}));a.PeGCSExtent=null;var y;(function(b){var c;b.init=function(){b.PE_GTLIST_OPTS_COMMON=a._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;
c=a._pe._pe_getPeGTlistExtendedEntrySize()};b.getGTlist=function(b,e,d,g,f,k){var h=null,l=new a._pe.PeInteger(k);try{var m=a._pe.PeGTlistExtended.prototype.getGTlist(b,e,d,g,f,l);if(k=l.val)if(h=[m],1<k){var n=a._pe.getPointer(m);for(b=1;b<k;b++)h.push(a._pe.wrapPointer(n+c*b,a._pe.PeGTlistExtendedEntry))}}finally{a._pe.destroy(l)}return h}})(y=a.PeGTlistExtended||(a.PeGTlistExtended={}));(function(b){b.destroy=function(b){if(b&&b.length){for(var c=0;c<b.length;c++){var e=b[c];n(e);e.getEntries().forEach(function(a){n(a);
a=a.getGeogtran();n(a);a.getParameters().forEach(n);[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){n(a);var b=a.getDatum();n(b);n(b.getSpheroid());n(a.getPrimem());n(a.getUnit())})})}a._pe.PeGTlistExtendedEntry.prototype.Delete(b[0])}}})(a.PeGTlistExtendedEntry||(a.PeGTlistExtendedEntry={}));(function(b){b.geogToGeog=function(b,d,g,f,k){a._pe.ensureCache.prepare();var h=e(g),l=g===h,h=a._pe.ensureFloat64(h),m=0;f&&(m=a._pe.ensureFloat64(f));(b=a._pe._pe_geog_to_geog(a._pe.getPointer(b),d,h,m,
k))&&c(g,d,h,l);return b}})(a.PeGTTransformations||(a.PeGTTransformations={}));(function(b){function d(b,c,d,f,k,h){a._pe.ensureCache.prepare();var m,n;switch(b){case "dd":m=a._pe._pe_geog_to_dd;n=l.PE_DD_MAX;break;case "ddm":m=a._pe._pe_geog_to_ddm;n=l.PE_DDM_MAX;break;case "dms":m=a._pe._pe_geog_to_dms,n=l.PE_DMS_MAX}b=0;c&&(b=a._pe.getPointer(c));c=e(f);c=a._pe.ensureFloat64(c);n=g(d,n);f=a._pe.ensureInt32(n);if(k=m(b,d,c,k,f))for(m=0;m<d;m++)h[m]=a._pe.Pointer_stringify(n[m]);return k}function f(b,
d,e,g,f){a._pe.ensureCache.prepare();var k;switch(b){case "dd":k=a._pe._pe_dd_to_geog;break;case "ddm":k=a._pe._pe_ddm_to_geog;break;case "dms":k=a._pe._pe_dms_to_geog}b=0;d&&(b=a._pe.getPointer(d));d=g.map(function(b){return a._pe.ensureString(b)});g=a._pe.ensureInt32(d);d=a._pe.ensureFloat64(Array(2*e));(k=k(b,e,g,d))&&c(f,e,d);return k}b.geog_to_dms=function(a,b,c,e,g){return d("dms",a,b,c,e,g)};b.dms_to_geog=function(a,b,c,d){return f("dms",a,b,c,d)};b.geog_to_ddm=function(a,b,c,e,g){return d("ddm",
a,b,c,e,g)};b.ddm_to_geog=function(a,b,c,d){return f("ddm",a,b,c,d)};b.geog_to_dd=function(a,b,c,e,g){return d("dd",a,b,c,e,g)};b.dd_to_geog=function(a,b,c,d){return f("dd",a,b,c,d)}})(a.PeNotationDms||(a.PeNotationDms={}));var v;(function(b){b.init=function(){b.PE_MGRS_STYLE_NEW=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;b.PE_MGRS_STYLE_OLD=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;b.PE_MGRS_STYLE_AUTO=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;b.PE_MGRS_180_ZONE_1_PLUS=a._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;
b.PE_MGRS_ADD_SPACES=a._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};b.geog_to_mgrs_extended=function(b,c,d,f,k,h,m){a._pe.ensureCache.prepare();var n=0;b&&(n=a._pe.getPointer(b));b=e(d);d=a._pe.ensureFloat64(b);b=g(c,l.PE_MGRS_MAX);var q=a._pe.ensureInt32(b);if(f=a._pe._pe_geog_to_mgrs_extended(n,c,d,f,k,h,q))for(k=0;k<c;k++)m[k]=a._pe.Pointer_stringify(b[k]);return f};b.mgrs_to_geog_extended=function(b,d,e,g,f){a._pe.ensureCache.prepare();var k=0;b&&(k=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});
e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*d));(g=a._pe._pe_mgrs_to_geog_extended(k,d,e,g,b))&&c(f,d,b);return g}})(v=a.PeNotationMgrs||(a.PeNotationMgrs={}));(function(b){b.geog_to_usng=function(b,c,d,f,k,h,m){a._pe.ensureCache.prepare();var n=0;b&&(n=a._pe.getPointer(b));b=e(d);d=a._pe.ensureFloat64(b);b=g(c,l.PE_MGRS_MAX);var q=a._pe.ensureInt32(b);if(f=a._pe._pe_geog_to_usng(n,c,d,f,k,h,q))for(k=0;k<c;k++)m[k]=a._pe.Pointer_stringify(b[k]);return f};b.usng_to_geog=function(b,d,e,g){a._pe.ensureCache.prepare();
var f=0;b&&(f=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*d));(f=a._pe._pe_usng_to_geog(f,d,e,b))&&c(g,d,b);return f}})(a.PeNotationUsng||(a.PeNotationUsng={}));var z;(function(b){b.init=function(){b.PE_UTM_OPTS_NONE=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;b.PE_UTM_OPTS_ADD_SPACES=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;b.PE_UTM_OPTS_NS=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};b.geog_to_utm=function(b,
c,d,f,k){a._pe.ensureCache.prepare();var h=0;b&&(h=a._pe.getPointer(b));b=e(d);d=a._pe.ensureFloat64(b);b=g(c,l.PE_UTM_MAX);var m=a._pe.ensureInt32(b);if(f=a._pe._pe_geog_to_utm(h,c,d,f,m))for(h=0;h<c;h++)k[h]=a._pe.Pointer_stringify(b[h]);return f};b.utm_to_geog=function(b,d,e,g,f){a._pe.ensureCache.prepare();var k=0;b&&(k=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*d));(g=a._pe._pe_utm_to_geog(k,d,e,g,b))&&c(f,d,b);
return g}})(z=a.PeNotationUtm||(a.PeNotationUtm={}));var w;(function(b){var c=new Map;b.init=function(){b.PE_PCSINFO_OPTION_NONE=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;b.PE_PCSINFO_OPTION_DOMAIN=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;b.PE_POLE_OUTSIDE_BOUNDARY=a._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;b.PE_POLE_POINT=a._pe.PePCSInfo.prototype.PE_POLE_POINT};b.generate=function(d,e){void 0===e&&(e=b.PE_PCSINFO_OPTION_DOMAIN);var g,f;c.has(d)&&(f=c.get(d),f[e]&&(g=f[e]));
g||(g=a._pe.PePCSInfo.prototype.generate(d,e),f||(f=[],c.set(d,f)),f[e]=g);return g}})(w=a.PePCSInfo||(a.PePCSInfo={}));(function(b){b.version_string=function(){return a._pe.PeVersion.prototype.version_string()}})(a.PeVersion||(a.PeVersion={}));a._init=k})},"esri/geometry/support/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(h,a,f){return function(){function a(a){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=
null;if(a&&a.steps){var d=0;for(a=a.steps;d<a.length;d++){var h=a[d];h instanceof f?this.steps.push(h):this.steps.push(new f({wkid:h.wkid,wkt:h.wkt,isInverse:h.isInverse}))}}}a.cacheKey=function(a,f){return[void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():"",void 0!==f.wkid&&null!==f.wkid?f.wkid.toString():"-1",void 0!==f.wkt&&null!==f.wkt?f.wkt.toString():""].join()};a.fromGE=function(d){var k=new a,h="",g=0;for(d=d.steps;g<d.length;g++){var e=f.fromGE(d[g]);
k.steps.push(e);h+=e.uid.toString()+","}k._cached_projection={};k._gtlistentry=null;k._chain=h;return k};a.prototype.getInverse=function(){var d=new a;d.steps=[];for(var f=this.steps.length-1;0<=f;f--)d.steps.push(this.steps[f].getInverse());return d};a.prototype.getGTListEntry=function(){for(var a="",f=0,h=this.steps;f<h.length;f++)a+=h[f].uid.toString()+",";a!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=a);return this._gtlistentry};a.prototype.assignCachedGe=function(d,
f,h){this._cached_projection[a.cacheKey(d,f)]=h};a.prototype.getCachedGeTransformation=function(d,f){for(var k="",g=0,e=this.steps;g<e.length;g++)k+=e[g].uid.toString()+",";k!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=k);d=this._cached_projection[a.cacheKey(d,f)];return void 0===d?null:d};return a}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(h,a){var f=0;return function(){function a(a){void 0===a&&(a=
null);this.uid=f++;a?(this._wkt=void 0!==a.wkt?a.wkt:null,this._wkid=void 0!==a.wkid?a.wkid:-1,this._isInverse=void 0!==a.isInverse?!0===a.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}a.fromGE=function(d){var f=new a;f._wkt=d.wkt;f._wkid=d.wkid;f._isInverse=d.isInverse;return f};Object.defineProperty(a.prototype,"wkt",{get:function(){return this._wkt},set:function(a){this._wkt=a;this.uid=f++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wkid",{get:function(){return this._wkid},
set:function(a){this._wkid=a;this.uid=f++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isInverse",{get:function(){return this._isInverse},set:function(a){this._isInverse=a;this.uid=f++},enumerable:!0,configurable:!0});a.prototype.getInverse=function(){var d=new a;d._wkt=this.wkt;d._wkid=this._wkid;d._isInverse=!this.isInverse;return d};return a}()})},"esri/views/2d/engine/webgl/GraphicContainer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/promiseUtils ../Container ./enums ./WGLRendererInfo".split(" "),
function(h,a,f,m,d,k,n,g){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function c(b){var c=a.call(this)||this;c._displayHeight=0;c._displayWidth=0;c._rendererInfo=new g;c.tileInfoView=b.tileInfoView;c.highlightIDs=b.highlightIDs;c.getMaterialItems=c.getMaterialItems.bind(c);return c}m(c,a);c.prototype.dispose=function(){this.removeAllChildren();for(var a=0,c=this.children;a<c.length;a++)c[a].dispose()};c.prototype.disposeWebGLResources=function(){for(var a=0,c=this.children;a<c.length;a++)c[a].clear()};
c.prototype.displayWidth=function(){return this._displayWidth};Object.defineProperty(c.prototype,"displayHeight",{get:function(){return this._displayHeight},enumerable:!0,configurable:!0});c.prototype.setVisibility=function(a,c){};c.prototype.getMaterialItems=function(a){if(a&&0!==a.length){for(var b=[],c=this.stage.painter.textureManager,e=0;e<a.length;e++){var g=a[e];b.push(c.rasterizeItem(g.symbol,g.glyphIds))}return d.all(b).then(function(b){return b.map(function(b,c){return{id:a[c].id,mosaicItem:b}})})}};
c.prototype.renderChildren=function(a){var b=this.stage.painter;this._updateTilesTransform(a.state,this.tileInfoView.getClosestInfoForScale(a.state.scale).level);if(a.drawPhase===n.WGLDrawPhase.MAP){var c=this.tileInfoView.getClosestInfoForScale(a.state.scale).level,e=this.tileInfoView.tileInfo.scaleToZoom(a.state.scale);a=f({},a,{rendererInfo:this._rendererInfo,requiredLevel:c,displayLevel:e,context:this.stage.context,painter:b});this.sortChildren(function(a,b){return 0!==a.key.level-b.key.level?
a.key.level-b.key.level:0!==a.key.row-b.key.row?a.key.row-b.key.row:a.key.col-b.key.col});b.draw(a,this.children,a.drawPhase,null);0<this.highlightIDs.size&&b.highlight(a,this.children)}};c.prototype._updateTilesTransform=function(a,c){c=0;for(var b=this.children;c<b.length;c++){var e=b[c];e.setTransform(a,this.tileInfoView.tileInfo.lods[e.key.level].resolution/(a.resolution*a.pixelRatio))}};return c}(k.Container);a.default=h})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("require exports ../../../../core/maybe ../../../../core/screenUtils ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../renderers/support/utils ./definitions ./Utils".split(" "),
function(h,a,f,m,d,k,n,g,e){function c(a,b){var c=b.length;if(a<b[0].value||1===c)return b[0].size;for(var e=1;e<c;e++)if(a<b[e].value)return b[e-1].size+(a-b[e-1].value)/(b[e].value-b[e-1].value)*(b[e].size-b[e-1].size);return b[c-1].size}function b(a,b,c){void 0===c&&(c=0);var e=b.g,d=b.b,g=b.a;a[c+0]=b.r*g/255;a[c+1]=e*g/255;a[c+2]=d*g/255;a[c+3]=g}var l=function(a,b,c){for(var e=c*=16,d=0;e<Math.min(c+16,a.length);e++,d++)a[e]=b[d]},y=k.mat4f32.create(),v=k.mat4f32.fromValues(0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0);return function(){function a(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.vvSizeFieldStopsValues=new Float32Array(6);this.vvSizeFieldStopsSizes=new Float32Array(6);this.ddColors=new Float32Array(32);this.ddBackgroundColor=new Float32Array(4);this.insideEffect=new Float32Array(16*g.MAX_FILTERS);this.outsideEffect=
new Float32Array(16*g.MAX_FILTERS);this.effectCount=0;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this.symbolLevels.push(0);l(this.insideEffect,y,0);l(this.outsideEffect,v,0);for(var a=1;a<g.MAX_FILTERS;a++)l(this.insideEffect,y,a),l(this.outsideEffect,y,a)}Object.defineProperty(a.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});a.prototype.update=
function(a,c,e,d){var g=this;f.isSome(d)?(d.forEach(function(a,b){return g._updateEffects(b,a)}),this.effectCount=d.length):this.effectCount=0;e&&this._updateVisualVariables(e,a);switch(c.type){case "dot-density":this._updateDotDensityInfo(c.attributes),this.ddDotValue=c.referenceDotValue,this.ddDotScale=c.referenceScale,this.ddDotSize=c.dotSize,this.ddDotBlending=c.blendDots,this.ddSeed=c.seed,b(this.ddBackgroundColor,c.backgroundColor)}};a.prototype.getVariation=function(){return{ddDotBlending:this.ddDotBlending,
outsideLabelsVisible:this.outsideLabelsVisible,effectCount:this.effectCount}};a.prototype.getVariationHash=function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1|this.effectCount<<2};a.prototype._updateEffects=function(a,b){a+=1;if(f.isSome(b)&&b.filter&&b.filter.enabled){this.outsideLabelsVisible=b.excludedLabelsVisible;var c=b.parsedIncludedEffect;b=b.parsedExcludedEffect;f.isSome(c)?l(this.insideEffect,c.getColorMatrix(),a):l(this.insideEffect,y,a);f.isSome(b)?l(this.outsideEffect,
b.getColorMatrix(),a):l(this.outsideEffect,y,a)}else l(this.insideEffect,y,a),l(this.outsideEffect,y,a)};a.prototype._updateVisualVariables=function(a,b){var g=this._vvMaterialParameters;g.vvOpacityEnabled=!1;g.vvSizeEnabled=!1;g.vvColorEnabled=!1;g.vvRotationEnabled=!1;if(a){var f=a.size;if(f){g.vvSizeEnabled=!0;if(f.minMaxValue){var k=f.minMaxValue,h=void 0,l=void 0;e.isDefined(k.minSize)&&e.isDefined(k.maxSize)&&(e.isNumber(k.minSize)&&e.isNumber(k.maxSize)?(h=m.pt2px(k.minSize),l=m.pt2px(k.maxSize)):
(l=b.scale,h=m.pt2px(c(l,k.minSize.stops)),l=m.pt2px(c(l,k.maxSize.stops))));this.vvSizeMinMaxValue.set([k.minDataValue,k.maxDataValue,h,l])}f.scaleStops&&(this.vvSizeScaleStopsValue=m.pt2px(c(b.scale,f.scaleStops.stops)));f.unitValue&&(this.vvSizeUnitValueToPixelsRatio=d.getMetersPerUnitForSR(b.spatialReference)/n.meterIn[f.unitValue.unit]/b.resolution);f.fieldStops&&(this.vvSizeFieldStopsValues.set(f.fieldStops.values),this.vvSizeFieldStopsSizes.set(f.fieldStops.sizes))}if(b=a.color)g.vvColorEnabled=
!0,this.vvColorValues.set(b.values),this.vvColors.set(b.colors);if(b=a.opacity)g.vvOpacityEnabled=!0,this.vvOpacityValues.set(b.values),this.vvOpacities.set(b.opacities);if(a=a.rotation)g.vvRotationEnabled=!0,g.vvRotationType=a.type}};a.prototype._updateDotDensityInfo=function(a){for(var c=this.ddColors,e=0;e<Math.min(g.DOT_DENSITY_MAX_FIELDS,a.length);e++)b(c,a[e].color,4*e)};return a}()})},"esri/views/2d/engine/webgl/TileData":function(){define("require exports ./MemoryRequirements ./TileBufferData ./TileDisplayData ./Utils ./Utils ./WGLDisplayObject ./WGLDisplayRecord ./mesh/VertexBuffer ./util/Reader ./util/serializationUtils ./util/Writer".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y){var v=new f.default,z=new f.default;return function(){function a(){this.tileBufferData=this.tileDisplayData=null}a.prototype.reshuffle=function(){v.reset();for(var b=d.groupRecordsByGeometryType(this.tileDisplayData.displayObjects),c=0;c<b.length;c++)for(var e=b[c],g=0,f=e;g<f.length;g++){var h=f[g];h&&v.needMore(h.geometryType,h.meshData?h.meshData.vertexCount:h.vertexCount,h.meshData?h.meshData.indexData.length:h.indexCount)}g=b.length;c=new m;for(f=0;f<g;++f){c.geometries[f].indexBuffer=
new Uint32Array(Math.round(1.15*v.indicesFor(f)));var h=[],l;for(l in this.tileBufferData.geometries[f].vertexBuffer)h.push(this.tileBufferData.geometries[f].vertexBuffer[l].stride);var h=a._computeVertexAlignment(h),e=Math.round(1.15*v.verticesFor(f)),h=a._align(e,h),w;for(w in this.tileBufferData.geometries[f].vertexBuffer)e=this.tileBufferData.geometries[f].vertexBuffer[w].stride,c.geometries[f].vertexBuffer[w]={stride:e,data:n.allocateTypedArrayBuffer(h,e)}}z.reset();this.tileDisplayData.displayList.clear();
for(f=0;f<g;++f){e=b[f];l=0;for(w=e;l<w.length;l++){h=w[l];if(h.meshData)h.writeMeshDataToBuffers(z.verticesFor(f),c.geometries[f].vertexBuffer,z.indicesFor(f),c.geometries[f].indexBuffer),h.meshData=null;else{var D=this.tileBufferData.geometries[f].vertexBuffer,G=this.tileBufferData.geometries[f].indexBuffer,H=c.geometries[f].vertexBuffer,I=c.geometries[f].indexBuffer,y=z.verticesFor(f),J=z.indicesFor(f);k.copyMeshData(y,J,H,I,h,D,G);h.vertexFrom=y;h.indexFrom=J}z.needMore(f,h.vertexCount,h.indexCount)}this.tileDisplayData.displayList.unified||
this.tileDisplayData.displayList.addToList(e)}if(this.tileDisplayData.displayList.unified)for(b=0,g=this.tileDisplayData.displayObjects;b<g.length;b++)this.tileDisplayData.displayList.addToList(g[b].displayRecords);this.tileBufferData=c};a.prototype.getStrides=function(){for(var a=[],b=0;b<this.tileBufferData.geometries.length;++b){var c=this.tileBufferData.geometries[b];a[b]={};for(var e in c.vertexBuffer)a[b][e]=c.vertexBuffer[e].stride}return a};a.prototype.clone=function(){var b=new a;b.tileBufferData=
this.tileBufferData.clone();b.tileDisplayData=this.tileDisplayData.clone();return b};a.prototype._guessSize=function(){for(var a=this.tileDisplayData.displayObjects,b=Math.min(a.length,4),c=0,e=0;e<b;e++)c=Math.max(c,a[e].displayRecords.length);return 2*(12*a.length+a.length*c*40)};a.prototype.serialize=function(){var a=this.tileBufferData.serialize(),b=this.tileBufferData.getBuffers(),c=this.tileDisplayData.serialize(new y.default(Int32Array,this._guessSize())).buffer();b.push(c);return{result:{displayData:c,
bufferData:a},transferList:b}};a.decode=function(e){var d=l.deserializeList(new b.default(e.displayObjects),g),f={},k;for(k in e.vertexBuffersMap)f[k]=c.VertexBuffers.decode(e.vertexBuffersMap[k]);return a.fromMeshData({displayObjects:d,vertexBuffersMap:f})};a.fromMeshData=function(b){var c=new a,e=new d.default,g=new m;e.displayObjects=b.displayObjects;for(var f in b.vertexBuffersMap){var k=b.vertexBuffersMap[f];g.geometries[f].indexBuffer=k.indexBuffer;g.geometries[f].vertexBuffer=k.namedBuffers}c.tileDisplayData=
e;c.tileBufferData=g;return c};a.bind=function(b,c){var e=new a;e.tileDisplayData=b;e.tileBufferData=c;return e};a.create=function(b,c){var g=new a;g.tileDisplayData=new d.default;g.tileDisplayData.displayObjects=b;for(var f=[0,0,0,0,0],k=[0,0,0,0,0],h=[[],[],[],[],[]],l=0;l<b.length;l++)for(var p=0,v=b[l].displayRecords;p<v.length;p++){var z=v[p];h[z.geometryType].push(z);f[z.geometryType]+=z.meshData.vertexCount;k[z.geometryType]+=z.meshData.indexData.length}b=new m;c=[c.fill||{},c.line||{},c.icon||
{},c.text||{},c.label||{}];for(l=0;5>l;l++){var p=new Uint32Array(k[l]),v=c[l],z=f[l],w={},I=void 0;for(I in v){var y={data:n.allocateTypedArrayBuffer(z,v[I]),stride:v[I]};w[I]=y}v=w;e.writeAllMeshDataToBuffers(h[l],v,p);b.geometries[l]={indexBuffer:p,vertexBuffer:v}}g.tileBufferData=b;return g};a._align=function(a,b){var c=a%b;return 0===c?a:a+(b-c)};a._computeVertexAlignment=function(a){for(var b=!1,c=!1,e=0;e<a.length;e++){var d=a[e];2===d%4?b=!0:0!==d%4&&(c=!0)}return c?4:b?2:1};return a}()})},
"esri/views/2d/engine/webgl/MemoryRequirements":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._byGeometryType=null}Object.defineProperty(a.prototype,"satisfied",{get:function(){return!this._byGeometryType},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._byGeometryType=null};a.prototype.verticesFor=function(a){return this._byGeometryType?this._byGeometryType[a].vertices:0};a.prototype.indicesFor=
function(a){return this._byGeometryType?this._byGeometryType[a].indices:0};a.prototype.needMore=function(a,d,f){if(d||f)this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]),a=this._byGeometryType[a],a.vertices+=d,a.indices+=f};return a}();a.default=h})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["require","exports","./Utils"],function(h,a,f){return function(){function a(){this.geometries=
[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}a.prototype.clone=function(){for(var d=new a,f=0;f<this.geometries.length;f++){var h=this.geometries[f],g=d.geometries[f];g.indexBuffer=h.indexBuffer.slice();g.vertexBuffer={};for(var e in h.vertexBuffer){var c=h.vertexBuffer[e],b=c.stride;g.vertexBuffer[e]={data:c.data.slice(),stride:b}}}return d};a.deserialize=
function(d){for(var k=new a,h=0;5>h;++h){k.geometries[h].indexBuffer=new Uint32Array(d.geometries[h].indexBuffer);k.geometries[h].vertexBuffer={};for(var g in d.geometries[h].vertexBuffer)k.geometries[h].vertexBuffer[g]={data:f.allocateTypedArrayBufferwithData(d.geometries[h].vertexBuffer[g].data,d.geometries[h].vertexBuffer[g].stride),stride:d.geometries[h].vertexBuffer[g].stride}}return k};a.prototype.serialize=function(){for(var a={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,
vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},f=0;5>f;++f)for(var h in this.geometries[f].vertexBuffer)a.geometries[f].vertexBuffer[h]={data:this.geometries[f].vertexBuffer[h].data.buffer,stride:this.geometries[f].vertexBuffer[h].stride};return a};a.prototype.getBuffers=
function(){for(var a=[],f=0;5>f;++f){a.push(this.geometries[f].indexBuffer.buffer);for(var h in this.geometries[f].vertexBuffer)a.push(this.geometries[f].vertexBuffer[h].data.buffer)}return a};return a}()})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define(["require","exports","./WGLDisplayList","./WGLDisplayObject","./util/serializationUtils"],function(h,a,f,m,d){function k(a){for(var d=[[],[],[],[],[]],e=0;e<a.length;e++)for(var c=0,b=a[e].displayRecords;c<b.length;c++){var f=b[c];
d[f.geometryType].push(f)}return d}Object.defineProperty(a,"__esModule",{value:!0});a.groupRecordsByGeometryType=k;h=function(){function a(){}Object.defineProperty(a.prototype,"displayObjectRegistry",{get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(var a=0,e=this.displayObjects;a<e.length;a++){var c=e[a];this._displayObjectRegistry.set(c.id,c)}}return this._displayObjectRegistry},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"displayList",
{get:function(){return this._displayList},enumerable:!0,configurable:!0});a.prototype.computeDisplayList=function(a){this._displayList=new f(a);if(a){a=0;for(var e=this.displayObjects;a<e.length;a++)for(var c=0,b=e[a].displayRecords;c<b.length;c++)this._displayList.addToList(b[c])}else for(a=k(this.displayObjects),e=a.length,c=0;c<e;++c)this._displayList.addToList(a[c])};a.prototype.clone=function(){var d=new a;this.displayObjects&&(d.displayObjects=this.displayObjects.map(function(a){return a.clone()}));
return d};a.prototype.serialize=function(a){d.serializeList(a,this.displayObjects);return a};a.prototype._deserializeObjects=function(a){for(var e=a.readInt32(),e=Array(e),c=new Map,b=0;b<e.length;++b){var d=m.deserialize(a);e[b]=d;c.set(d.id,d)}this.displayObjects=e;this._displayList=null;this._displayObjectRegistry=c};a.deserialize=function(d){var e=new a;e._deserializeObjects(d);return e};return a}();a.default=h})},"esri/views/2d/engine/webgl/WGLDisplayList":function(){define(["require","exports",
"../../../../core/tsSupport/generatorHelper","../../../../core/Logger","./enums"],function(h,a,f,m,d){function k(a,b,c){for(var e=[],d=3;d<arguments.length;d++)e[d-3]=arguments[d];b<a.length?a.splice.apply(a,[b,c].concat(e)):a.push.apply(a,e)}var n=m.getLogger("esri.views.2d.engine.webgl.WGLDisplayList"),g=new Map;g.set(d.WGLDrawPhase.MAP,[d.WGLGeometryType.FILL,d.WGLGeometryType.LINE,d.WGLGeometryType.MARKER,d.WGLGeometryType.TEXT]);g.set(d.WGLDrawPhase.LABEL,[d.WGLGeometryType.LABEL]);g.set(d.WGLDrawPhase.LABEL_ALPHA,
[d.WGLGeometryType.LABEL]);h=function(){function a(a){void 0===a&&(a=!1);this.symbolLevels=[];this.unified=a}a.prototype.replay=function(a,b){if(this.unified)for(var c=0,e=this.symbolLevels;c<e.length;c++)for(var d=0,f=e[c].zLevels;d<f.length;d++){var k=f[d].geometryDPInfo,h;for(h in k)if(k[h])for(var l=0,m=k[h];l<m.length;l++){var n=m[l],v=a.painter.getGeometryBrush(n.geometryType),z=b.getGeometry(n.geometryType);v.drawGeometry(a,b,n,z)}}else for(var c=function(c){var e=a.painter.getGeometryBrush(c),
d=b.getGeometry(c);H.byType(c,function(c){e.drawGeometry(a,b,c,d)})},H=this,e=0,d=g.get(a.drawPhase);e<d.length;e++)c(d[e])};Object.defineProperty(a.prototype,"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.symbolLevels.length=0};a.prototype.addToList=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)this._addToList(a[c],b);else this._addToList(a,b)};a.prototype.removeFromList=function(a){Array.isArray(a)||
(a=[a]);for(var b=null,c=0;c<a.length;c++)b=this._removeFromList(a[c]);return b};a.prototype.byType=function(a,b){for(var c=0,e=this.symbolLevels;c<e.length;c++)for(var d=0,g=e[c].zLevels;d<g.length;d++){var f=g[d].geometryDPInfo,k=this.getDPInfoType(a);if(f[k])for(var h=0,f=f[k];h<f.length;h++)b(f[h])}};a.prototype.clone=function(){for(var b=new a(this.unified),c=0,e=this.symbolLevels;c<e.length;c++)b.symbolLevels.push(e[c].clone());return b};a.prototype.splitAfter=function(a){for(var b=this._getDisplayList(a.symbolLevel,
a.zOrder,a.geometryType),c=b.length,d=a.indexFrom+a.indexCount,g=0;g<c;++g){var f=b[g];if(f.geometryType===a.geometryType&&d>f.indexFrom&&d<=f.indexFrom+f.indexCount)return d<f.indexFrom+f.indexCount&&(a=new e,a.geometryType=f.geometryType,a.materialKey=f.materialKey,a.indexFrom=d,a.indexCount=f.indexFrom+f.indexCount-d,b.splice(g+1,0,a),f.indexCount=d-f.indexFrom),g}};a.prototype._addToList=function(a,b){var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType);b=null!=b?b:c.length-1;var d=
0<=b&&b<c.length?c[b]:null;null===d||d.materialKey!==a.materialKey||d.indexFrom+d.indexCount!==a.indexFrom||this.unified&&d.geometryType!==a.geometryType?(d=new e,d.indexFrom=a.indexFrom,d.indexCount=a.indexCount,d.materialKey=a.materialKey,d.geometryType=a.geometryType,k(c,b+1,0,d)):d.indexCount+=a.indexCount};a.prototype._removeFromList=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),c=b.length,d=void 0,g=0;g<c;++g){var f=b[g];if(a.indexFrom+a.indexCount>f.indexFrom&&
a.indexFrom<f.indexFrom+f.indexCount&&(!this.unified||f.geometryType===a.geometryType)){d=g;break}}if(void 0!==d){f=b[d];if(a.indexFrom===f.indexFrom)return f.indexCount-=a.indexCount,f.indexFrom+=a.indexCount,0===f.indexCount&&k(b,d,1),d-1;if(a.indexFrom+a.indexCount===f.indexFrom+f.indexCount)return f.indexCount-=a.indexCount,0===f.indexCount?(k(b,d,1),d-1):d;var c=f.indexFrom,g=a.indexFrom-f.indexFrom,h=a.indexCount;a=f.indexFrom+f.indexCount-(a.indexFrom+a.indexCount);f.indexCount=g;var l=new e;
l.geometryType=f.geometryType;l.materialKey=f.materialKey;l.indexFrom=c+g+h;l.indexCount=a;k(b,d+1,0,l);return d}return null};a.prototype._getDisplayList=function(a,e,g){for(var f,k=this.symbolLevels.length,h=0;h<k;h++)if(this.symbolLevels[h].symbolLevel===a){f=this.symbolLevels[h];break}f||(f=new l,f.symbolLevel=a,this.symbolLevels.push(f));var m;a=f.zLevels.length;for(k=0;k<a;k++)if(f.zLevels[k].zLevel===e){m=f.zLevels[k];break}m||(m=new b,m.geometryDPInfo=new c,m.zLevel=e,f.zLevels.push(m));var n;
if(this.unified)m.geometryDPInfo.unified||(m.geometryDPInfo.unified=[]),n=m.geometryDPInfo.unified;else switch(g){case d.WGLGeometryType.FILL:m.geometryDPInfo.fill||(m.geometryDPInfo.fill=[]);n=m.geometryDPInfo.fill;break;case d.WGLGeometryType.LINE:m.geometryDPInfo.line||(m.geometryDPInfo.line=[]);n=m.geometryDPInfo.line;break;case d.WGLGeometryType.MARKER:m.geometryDPInfo.marker||(m.geometryDPInfo.marker=[]);n=m.geometryDPInfo.marker;break;case d.WGLGeometryType.TEXT:m.geometryDPInfo.text||(m.geometryDPInfo.text=
[]);n=m.geometryDPInfo.text;break;case d.WGLGeometryType.LABEL:m.geometryDPInfo.label||(m.geometryDPInfo.label=[]);n=m.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+g+"'.")}return n};a.prototype.getDPInfoType=function(a){if(this.unified)return"unified";switch(a){case d.WGLGeometryType.FILL:return"fill";case d.WGLGeometryType.LINE:return"line";case d.WGLGeometryType.MARKER:return"marker";case d.WGLGeometryType.TEXT:return"text";case d.WGLGeometryType.LABEL:return"label";
default:n.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return a}();var e=function(){function a(){this.materialKey=null;this.indexCount=this.indexFrom=0}a.prototype.clone=function(){var b=new a;b.geometryType=this.geometryType;b.materialKey=this.materialKey;b.indexFrom=this.indexFrom;b.indexCount=this.indexCount;return b};return a}(),c=function(){function a(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}a.prototype.clone=function(){var b=new a;b.fill=
this.fill&&this.fill.map(function(a){return a.clone()});b.line=this.line&&this.line.map(function(a){return a.clone()});b.marker=this.marker&&this.marker.map(function(a){return a.clone()});b.text=this.text&&this.text.map(function(a){return a.clone()});b.label=this.label&&this.label.map(function(a){return a.clone()});b.unified=this.unified&&this.unified.map(function(a){return a.clone()});return b};return a}(),b=function(){function a(){this.geometryDPInfo=new c}a.prototype.clone=function(){var b=new a;
b.zLevel=this.zLevel;b.geometryDPInfo=this.geometryDPInfo.clone();return b};return a}(),l=function(){function a(){this.zLevels=[]}a.prototype.clone=function(){var b=new a;b.symbolLevel=this.symbolLevel;for(var c=0,e=this.zLevels;c<e.length;c++)b.zLevels.push(e[c].clone());return b};return a}();return h})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define("require exports ./definitions ./WGLDisplayRecord ./collisions/Metric ./util/serializationUtils".split(" "),function(h,a,f,m,d,k){return function(){function a(a){this.insertAfter=
null;this.filterFlags=0;this.id=a;this.displayRecords=[];this.metrics=[]}a.prototype.copy=function(){var d=new a(this.id);d.set(this);return d};a.prototype.clone=function(){var d=new a(this.id);d.displayRecords=this.displayRecords.map(function(a){return a.clone()});d.metrics=this.metrics.map(function(a){return a.clone()});d.insertAfter=this.insertAfter;d.filterFlags=this.filterFlags;return d};a.prototype.set=function(a){this.id=a.id;this.displayRecords=a.displayRecords;this.metrics=a.metrics;this.insertAfter=
a.insertAfter;this.filterFlags=a.filterFlags};a.prototype.getLabelVisibility=function(a){var e=!a.effect||a.effect.excludedLabelsVisible||!!(this.filterFlags&f.EFFECT_FLAG_0);return(!a.filter||!!(this.filterFlags&f.FILTER_FLAG_0))&&e};a.prototype.setFilterFlag=function(a,e){a=1<<a;this.filterFlags=e?this.filterFlags|a:this.filterFlags&~a};a.prototype.serialize=function(a){a.push(this.id);a.push(this.filterFlags);k.serializeList(a,this.metrics);k.serializeList(a,this.displayRecords);return a};a.deserialize=
function(f){var e=f.readInt32(),c=new a(e);c.filterFlags=f.readInt32();var e={id:e},b=k.deserializeList(f,d.default);b.length&&(c.metrics=b);c.displayRecords=k.deserializeList(f,m,e);return c};return a}()})},"esri/views/2d/engine/webgl/mesh/VertexBuffer":function(){define(["require","exports","../Utils"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});var m=function(){function a(a,d,f){this.data=a;this.stride=d;this.vertexCount=f}a.decode=function(d){var k=f.allocateTypedArrayBufferwithData(d.data,
d.stride);return new a(k,d.stride,d.vertexCount)};a.fromVertexVector=function(d){var k=f.allocateTypedArrayBufferwithData(d.data.buffer(),d.stride);return new a(k,d.stride,d.vertexCount)};return a}();a.default=m;h=function(){function a(a,d,f){this.geometryType=a;this.indexBuffer=new Uint32Array(d);this.namedBuffers=f}a.decode=function(d){var f=d.geometryType,g=d.indexBuffer,e={},c;for(c in d.namedBuffers)e[c]=m.decode(d.namedBuffers[c]);return new a(f,g,e)};a.fromVertexVectors=function(d){var f=d.geometryType,
g=d.indexVector.buffer(),e={},c;for(c in d.namedVectors)e[c]=m.fromVertexVector(d.namedVectors[c]);return new a(f,g,e)};return a}();a.VertexBuffers=h})},"esri/views/2d/engine/webgl/util/Reader":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a){this._pos=0;this._buffer=a;this._i32View=new Int32Array(this._buffer);this._f32View=new Float32Array(this._buffer)}a.prototype.readInt32=function(){return this._i32View[this._pos++]};
a.prototype.readF32=function(){return this._f32View[this._pos++]};return a}();a.default=h})},"esri/views/2d/engine/webgl/util/Writer":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,d){this._pos=0;d=d?this._roundToNearest(d,a.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(d);this._buffer=new a(this._array);this._ctor=a}Object.defineProperty(a.prototype,"length",{get:function(){return this._pos},enumerable:!0,configurable:!0});
a.prototype._roundToNearest=function(a,d){a=Math.round(a);return a+(d-a%d)};a.prototype._ensureSize=function(a){if(this._pos+a>=this._buffer.length){a=this._roundToNearest(1.5*(this._array.byteLength+a*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);a=new ArrayBuffer(a);var d=new this._ctor(a);d.set(this._buffer,0);this._array=a;this._buffer=d}};a.prototype.writeF32=function(a){this._ensureSize(1);var d=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=a;this._pos++;return d};
a.prototype.push=function(a){this._ensureSize(1);var d=this._pos;this._buffer[this._pos++]=a;return d};a.prototype.writeRegion=function(a){this._ensureSize(a.length);var d=this._pos;this._buffer.set(a,this._pos);this._pos+=a.length;return d};a.prototype.buffer=function(){var a=this._array.slice(0,4*this._pos);this.destroy();return a};a.prototype.destroy=function(){this._buffer=this._array=null};return a}();a.default=h})},"esri/views/2d/engine/webgl/WGLTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat2d ../../../../core/libs/gl-matrix-2/mat2df32 ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../DisplayObject ./definitions ./DirtyMap ./DisplayRecordStore ./enums ./Fader ./number ./Utils ./WGLBuffers ./WGLDisplayList ../../tiling/TileKey".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p,B,F,q){function x(a,b){return a.sortKey-b.sortKey}var u=new Set;return function(a){function c(b,c,e){void 0===e&&(e=!1);var f=a.call(this)||this;f._data=null;f.hlDisplayList=null;f._displayList=null;f._wglBuffers=null;f._dirtyMap=new l.default;f.coords=[0,0];f.bounds=[0,0,0,0];f.dvsMat3=n.mat3f32.create();f.tileMat3=n.mat3f32.create();f.labelMat2d=d.mat2df32.create();f._labelIndex=null;f._dirty=!0;f.fader=new z.default;f.key=q.pool.acquire(b);f.coords[0]=
c[0];f.coords[1]=c[3];f.bounds=c;f._ensureCorrectZOrder=e;return f}f(c,a);Object.defineProperty(c.prototype,"displayObjects",{get:function(){return this._data.tileDisplayData.displayObjects},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"canDisplay",{get:function(){return!!this.attached},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isDirty",{get:function(){return this._dirty},set:function(a){(this._dirty=a)||this.isReady||this.ready();this.requestRender()},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasData",{get:function(){return!!this._data},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"labelIndex",{get:function(){return this._labelIndex},enumerable:!0,configurable:!0});c.prototype.getGeometry=function(a){return this._wglBuffers&&this._wglBuffers.has(a)?this._wglBuffers.get(a):null};c.prototype.getDisplayList=function(a){switch(a){case v.WGLDrawPhase.HIGHLIGHT:return this.hlDisplayList;default:return this._data&&
this._displayList}};Object.defineProperty(c.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});c.prototype.setData=function(a,b,c){var e=a.addOrUpdate,d=a.remove;this.fader.reset();!a.clear&&this.hasData||a.addOrUpdate?!a.clear&&this.hasData||!a.addOrUpdate?this.hasData&&this._doPatchData({addOrUpdate:e,remove:d},b,c):(e.tileDisplayData.computeDisplayList(this._ensureCorrectZOrder),this._dirtyMap=new l.default,this._dispRecStore=y.default.fromTileData(e,this._dirtyMap),
this._data=e,this._readyTileIfNoLabels(b,c),this._dirtyMap.markAllDirty(),this._displayList||(this._displayList=e.tileDisplayData.displayList.clone())):(this.clear(),this.ready())};c.prototype.commitChanges=function(a){this.isDirty&&this._wglBuffers||(this._wglBuffers||(this._wglBuffers=new B.default(this.stage.context)),this._displayList=this._data.tileDisplayData.displayList.clone(),this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._dirtyMap.markAllClean())};c.prototype.resetVisibility=
function(a){var b=this,c=[],e=Array(1);a.forEach(function(a){e[0]=a;b.setFilterFlag(0,c,e)})};c.prototype.setFilterFlag=function(a,b,c){if(this.hasData){for(var e=1<<a,d=this._data.tileBufferData.geometries.map(p.geometryToMappedGeometry),f=0;f<b.length;f++){var g=this._data.tileDisplayData.displayObjectRegistry.get(b[f]);if(g){g.setFilterFlag(a,!0);for(var k=0,h=g.displayRecords;k<h.length;k++){var l=h[k],m=d[l.geometryType];if(g=m.geometry.vertexBuffer[p.C_VBO_VISIBILITY]){m.vertexFrom=null==m.vertexFrom?
l.vertexFrom:Math.min(m.vertexFrom,l.vertexFrom);m.vertexTo=null==m.vertexTo?l.vertexFrom+l.vertexCount:Math.max(m.vertexTo,l.vertexFrom+l.vertexCount);for(var m=l.vertexFrom,l=l.vertexCount,n=0;n<l;++n)g.data[m+n]|=e}}}}for(b=0;b<c.length;b++)if(g=this._data.tileDisplayData.displayObjectRegistry.get(c[b]))for(g.setFilterFlag(a,!1),f=0,k=g.displayRecords;f<k.length;f++)if(l=k[f],m=d[l.geometryType],g=m.geometry.vertexBuffer[p.C_VBO_VISIBILITY])for(m.vertexFrom=null==m.vertexFrom?l.vertexFrom:Math.min(m.vertexFrom,
l.vertexFrom),m.vertexTo=null==m.vertexTo?l.vertexFrom+l.vertexCount:Math.max(m.vertexTo,l.vertexFrom+l.vertexCount),m=l.vertexFrom,l=l.vertexCount,n=0;n<l;++n)g.data[m+n]&=~e;a=!1;for(c=0;c<d.length;++c)m=d[c],null!=m.vertexFrom&&null!=m.vertexTo&&(this._dirtyMap.markDirtyVertices(c,p.C_VBO_VISIBILITY,m.vertexFrom,m.vertexTo?m.vertexTo-m.vertexFrom:0),a=!0);a&&this.requestRender()}};c.prototype.setVisibilityRange=function(a,b,c,e){a=this._data.tileDisplayData.displayObjectRegistry.get(a);for(var d=
this._data.tileBufferData.geometries[v.WGLGeometryType.LABEL].vertexBuffer[p.C_VBO_VISIBILITY_RANGE],f=Infinity,g=0,k=b;k<b+c;++k){for(var h=a.displayRecords[k],l=Math.max(h.minZoom,e),m=h.maxZoom,l=w.i8888to32(l,m,l,m),m=h.vertexFrom*d.stride/4,n=h.vertexCount*d.stride/4,q=m;q<m+n;++q)d.data[q]=l;f=Math.min(f,h.vertexFrom);g=Math.max(g,h.vertexFrom+h.vertexCount)}this._dirtyMap.markDirtyVertices(v.WGLGeometryType.LABEL,p.C_VBO_VISIBILITY_RANGE,f,g-f)};c.prototype.setTransform=function(a,b){var c=
this.tileMat3,e=a.toScreenNoRotation([0,0],this.coords);k.mat3.set(this.tileMat3,b,0,0,0,b,0,e[0],e[1],1);k.mat3.multiply(this.dvsMat3,a.displayViewMat3,c)};c.prototype.setLabelTransform=function(a,b){var c=this.labelMat2d;b=a.getScreenTransform(c,b);var d=e.vec2f32.create();g.vec2.transformMat2d(d,this.coords,b);m.mat2d.identity(c);m.mat2d.translate(c,c,d);m.mat2d.multiply(c,a.viewMat2d,c)};c.prototype.clear=function(){this._dispRecStore=this._displayList=this._data=null;this._wglBuffers&&(this._wglBuffers.dispose(),
this._wglBuffers=null);this.hlDisplayList&&(this.hlDisplayList=null)};c.prototype.attach=function(){return!0};c.prototype.dispose=function(){this.clear()};c.prototype.doRender=function(a){if(this.isReady&&this.hasData){this.commitChanges(a);this.stage.context.setStencilFunction(514,this.stencilRef,255);if(a.drawPhase===v.WGLDrawPhase.MAP||a.drawPhase===v.WGLDrawPhase.LABEL||a.drawPhase===v.WGLDrawPhase.LABEL_ALPHA)this._displayList.replay(a,this);else for(var b=0,c=this.stage.painter.getBrushes(a.drawPhase);b<
c.length;b++)c[b].draw(a,this);this.fader.step()||this.requestRender()}};c.prototype.buildHLList=function(a){var b=this;this.hlDisplayList=new F;a.forEach(function(a){b._addToHLDisplayList(b.hlDisplayList,a)})};c.prototype._addToHLDisplayList=function(a,b){if(this._data){var c=this._data.tileDisplayData.displayObjectRegistry.get(b);if(c){b=[];for(var e=0,c=c.displayRecords;e<c.length;e++){var d=c[e].copy();d.meshData=null;d.symbolLevel=0;d.zOrder=0;b.push(d)}b.sort(x);a.addToList(b)}}};c.prototype._readyTileIfNoLabels=
function(a,b){a&&b?(this._rebuildLabelIndex(),this.isDirty=!0):this.isDirty=!1};c.prototype._doPatchData=function(a,b,c){this._patchData(a)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=y.default.fromTileData(this._data,this._dirtyMap));this._readyTileIfNoLabels(b,c);this.requestRender()};c.prototype._rebuildLabelIndex=function(){this._labelIndex=this._initLabelIndex();for(var a=0,b=this.displayObjects;a<b.length;a++)for(var c=0,e=b[a].metrics;c<e.length;c++)this._insertIntoLabelIndex(e[c])};
c.prototype._insertIntoLabelIndex=function(a){-1!==a.xBucket&&this.labelIndex[a.yBucket][a.xBucket].push(a)};c.prototype._initLabelIndex=function(){for(var a=[],c=0;c<b.TILE_SIZE/b.COLLISION_BUCKET_SIZE;c++){a.push([]);for(var e=0;e<b.TILE_SIZE/b.COLLISION_BUCKET_SIZE;e++)a[c].push([])}return a};c.prototype._patchData=function(a){for(var b=!0,c=a.addOrUpdate&&a.addOrUpdate.tileDisplayData&&a.addOrUpdate.tileDisplayData.displayObjects||[],e=(a.remove||[]).slice(),d=0;d<c.length;d++){var f=c[d];null!=
f.insertAfter&&e.push(f.id)}for(f=0;f<e.length;f++){var g=e[f];if(d=this._data.tileDisplayData.displayObjectRegistry.get(g)){this._data.tileDisplayData.displayList.removeFromList(d.displayRecords);for(var k=0,h=d.displayRecords;k<h.length;k++)this._dispRecStore.delete(h[k]);this._data.tileDisplayData.displayObjectRegistry.delete(g);d=this._data.tileDisplayData.displayObjects.indexOf(d);this._data.tileDisplayData.displayObjects.splice(d,1)}}for(e=0;e<c.length;e++){f=c[e];d=this._data.tileDisplayData.displayObjectRegistry.get(f.id);
g=void 0;if(d){k=d.displayRecords;d.set(f);d.displayRecords=k;k=d.displayRecords.length;for(h=0;h<k;++h){var l=d.displayRecords[h],m=f.displayRecords[h];if(h>=f.displayRecords.length||l.geometryType!==m.geometryType||l.symbolLevel!==m.symbolLevel||l.zOrder!==m.zOrder||l.materialKey!==m.materialKey)this._dispRecStore.delete(d.displayRecords[h]),h<f.displayRecords.length&&(d.displayRecords[h]=void 0)}d.displayRecords.length=f.displayRecords.length;d.metrics=f.metrics}else if(d=f.copy(),d.displayRecords=
[],this._data.tileDisplayData.displayObjectRegistry.set(f.id,d),h=void 0,l=this._data.tileDisplayData.displayObjects,null!=d.insertAfter?(g={},0<=d.insertAfter?(k=this._data.tileDisplayData.displayObjectRegistry.get(d.insertAfter))?(h=l.indexOf(k)+1,h<l.length?l.splice(h,0,d):(l.push(d),h=l.length)):(l.push(d),h=l.length):(l.unshift(d),h=0)):(l.push(d),h=l.length),g){m=void 0;if(this._data.tileDisplayData.displayList.unified)m=0<f.displayRecords.length?1:0;else{u.clear();for(var m=0,n=f.displayRecords;m<
n.length;m++)k=this._data.tileDisplayData.displayList.getDPInfoType(n[m].geometryType),u.add(k);m=u.size}n=0;for(--h;0<=h&&n<m;--h)for(var q=l[h].displayRecords.length-1;0<=q&&n<m;--q){var p=l[h].displayRecords[q],k=this._data.tileDisplayData.displayList.getDPInfoType(p.geometryType);g[k]||(g[k]=p,++n)}}n=f.displayRecords.length;for(h=0;h<n;++h){m=f.displayRecords[h];(l=d.displayRecords[h])?(l.meshData=m.meshData,l.materialKey=m.materialKey):(l=m.copy(),l.vertexFrom=void 0,l.indexFrom=void 0,d.displayRecords[h]=
l);var q=m.geometryType,k=this._data.tileDisplayData.displayList.getDPInfoType(q),p=a.addOrUpdate.tileBufferData.geometries[q],q=p.vertexBuffer,p=p.indexBuffer,x=void 0;g&&(x=g[k]?this._data.tileDisplayData.displayList.splitAfter(g[k]):-1);b=this._dispRecStore.setMeshData(l,m,q,p,x)&&b;g&&null!=l.indexFrom&&null!=l.indexFrom&&(g[k]=l)}}return b};return c}(c.DisplayObject)})},"esri/views/2d/engine/webgl/DirtyMap":function(){define(["require","exports","./Utils"],function(h,a,f){function m(a,f,h){if(!a.allDirty)if(null!=
a.from&&null!=a.count){var d=Math.min(a.from,f);f=Math.max(a.from+a.count,f+h)-d;a.from=d;a.count=f}else a.from=f,a.count=h}Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._dirties=f.createGeometryData(function(a){return{indices:{from:null,count:null,allDirty:!1}}},function(a,d){return{vertices:{from:null,count:null,allDirty:!1}}})}a.prototype.markAllClean=function(){for(var a=0,d=this._dirties;a<d.length;a++){var f=d[a];f.data.indices.from=null;f.data.indices.count=
null;f.data.indices.allDirty=!1;for(var e in f.buffers)f.buffers[e].data.vertices.from=null,f.buffers[e].data.vertices.count=null,f.buffers[e].data.vertices.allDirty=!1}};a.prototype.markAllDirty=function(){for(var a=0,d=this._dirties;a<d.length;a++){var f=d[a];f.data.indices.allDirty=!0;for(var e in f.buffers)f.buffers[e].data.vertices.allDirty=!0}};a.prototype.forEach=function(a){for(var d=0;d<this._dirties.length;++d){var f=this._dirties[d],e={},c;for(c in f.buffers){var b=f.buffers[c].data.vertices;
if(b.allDirty||null!=b.from&&null!=b.count&&0<b.count)e[c]=b}f=f.data.indices;b=void 0;b=f.allDirty||null!=f.from&&null!=f.count&&0<f.count?{indices:f,vertices:e}:{indices:null,vertices:e};(b.indices||0<Object.keys(b).length)&&a(b,d)}};a.prototype.markDirtyIndices=function(a,d,f){m(this._dirties[a].data.indices,d,f)};a.prototype.markDirtyVertices=function(a,d,f,e){m(this._dirties[a].buffers[d].data.vertices,f,e)};return a}();a.default=h})},"esri/views/2d/engine/webgl/DisplayRecordStore":function(){define(["require",
"exports","../../../../core/has","./FreeList","./Utils"],function(h,a,f,m,d){function k(a){a=a.getStrides();var d={},c;for(c in a)d[n[c]]=a[c];return d}Object.defineProperty(a,"__esModule",{value:!0});var n=["FILL","LINE","MARKER","TEXT","LABEL"];h=function(){function a(a,c,b,f){this._strides=a;this._displayList=c;this._freeListsAndStorage={};this._dirtyMap=null;this._dirtyMap=b;for(var e in a){this._freeListsAndStorage[e]={vtxFreeList:f?new m.FreeList(f):null,idxFreeList:f?new m.FreeList(f):null,
vertexBuffers:{},indexBuffer:f?new Uint32Array(f):null};for(var g in a[e])this._freeListsAndStorage[e].vertexBuffers[g]={data:f?d.allocateTypedArrayBuffer(f,a[e][g]):null,stride:a[e][g]}}}a.fromTileData=function(e,c){var b=k(e),f=[0,0,0,0,0],g=[0,0,0,0,0],h=[];e.tileDisplayData.displayObjectRegistry.forEach(function(a){h.push(a)});for(var z=0;z<h.length;z++)for(var w=0,p=h[z].displayRecords;w<p.length;w++){var B=p[w];f[B.geometryType]=Math.max(f[B.geometryType],B.vertexFrom+B.vertexCount);g[B.geometryType]=
Math.max(g[B.geometryType],B.indexFrom+B.indexCount)}c=new a(b,e.tileDisplayData.displayList,c,null);for(b=0;b<e.tileBufferData.geometries.length;++b){var z=f[b],p=g[b],B=e.tileBufferData.geometries[b],w=c._storageFor(n[b]),F=e.tileBufferData.geometries[b].indexBuffer;w.indexBuffer=F;w.idxFreeList=new m.FreeList(F.length);w.idxFreeList.allocate(p);var p=void 0,q;for(q in B.vertexBuffer)B=e.tileBufferData.geometries[b].vertexBuffer[q],w.vertexBuffers[q].data=B.data,w.vertexBuffers[q].stride=B.stride,
F=d.strideToPackingFactor(B.stride),B=B.data.length*F/B.stride,p||(p=B);w.vtxFreeList=new m.FreeList(p);w.vtxFreeList.allocate(z)}return c};a.prototype.delete=function(a){var c=n[a.geometryType];this._freeVertices(c,a.vertexFrom,a.vertexCount);this._freeIndices(c,a.indexFrom,a.indexCount);this._displayList.removeFromList(a);a.vertexFrom=void 0;a.indexFrom=void 0};a.prototype.setMeshData=function(a,c,b,f,g){var e=n[a.geometryType];a.meshData=null;var h=void 0,k=void 0;void 0===a.vertexFrom?(k=c.vertexCount,
h=this._allocateVertices(e,k)):c.vertexCount>a.vertexCount?(this._freeVertices(e,a.vertexFrom,a.vertexCount),k=c.vertexCount,h=this._allocateVertices(e,k)):c.vertexCount===a.vertexCount?(h=a.vertexFrom,k=a.vertexCount):(this._freeVertices(e,a.vertexFrom+c.vertexCount,a.vertexCount-c.vertexCount),h=a.vertexFrom,k=c.vertexCount);var l=!0,m=void 0,y=void 0,q=void 0;void 0===a.indexFrom?(m=g,q=c.indexCount,y=this._allocateIndices(e,q)):c.indexCount>a.indexCount?(m=this._displayList.removeFromList(a),
this._freeIndices(e,a.indexFrom,a.indexCount),q=c.indexCount,y=this._allocateIndices(e,q)):c.indexCount===a.indexCount?(l=!1,y=a.indexFrom,q=a.indexCount):(m=this._displayList.removeFromList(a),this._freeIndices(e,a.indexFrom+c.indexCount,a.indexCount-c.indexCount),y=a.indexFrom,q=c.indexCount);if(-1!==h&&-1!==y){g=this._storageFor(e);d.copyMeshData(h,y,g.vertexBuffers,g.indexBuffer,c,b,f);a.vertexFrom=h;a.indexFrom=y;a.vertexCount=c.vertexCount;a.indexCount=c.indexCount;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(a.geometryType,
a.indexFrom,a.indexCount);for(var x in b)this._dirtyMap.markDirtyVertices(a.geometryType,x,a.vertexFrom,a.vertexCount)}l&&this._displayList.addToList(a,m);return!0}-1!==h&&this._freeVertices(e,h,k);-1!==y&&this._freeIndices(e,y,q);a.setMeshDataFromBuffers(c,b,f);a.vertexFrom=void 0;a.vertexCount=0;a.indexFrom=void 0;a.indexCount=0;return!1};a.prototype._allocateVertices=function(a,c){a=this._storageFor(a);c=a.vtxFreeList.allocate(c);return-1===c||.5<a.vtxFreeList.fragmentation?-1:c};a.prototype._freeVertices=
function(a,c,b){this._storageFor(a).vtxFreeList.free(c,b)};a.prototype._freeIndices=function(a,c,b){this._storageFor(a).idxFreeList.free(c,b)};a.prototype._allocateIndices=function(a,c){a=this._storageFor(a);c=a.idxFreeList.allocate(c);return-1===c||.5<a.idxFreeList.fragmentation?-1:c};a.prototype._storageFor=function(a){return this._freeListsAndStorage[a]};a.prototype._stridesFor=function(a,c){return this._strides[a][c]};return a}();a.default=h})},"esri/views/2d/engine/webgl/FreeList":function(){define(["require",
"exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});var f=function(){function a(a){this._largestRange=null;this._parent=a;this._updateLargestRange()}Object.defineProperty(a.prototype,"largestRange",{get:function(){return this._largestRange},enumerable:!0,configurable:!0});a.prototype.rangeCreated=function(a){if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.rangeResized=function(a,f,h){if(a===this._largestRange)a.count<h&&this._updateLargestRange();
else if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.findBestRange=function(a){for(var d=this._parent._freeHead,f=null;null!==d;)d.count>=a&&(!f||d.count-a<f.count-a)&&(f=d),d=d.next;return f};a.prototype.findAdjacentRanges=function(a,f){for(var d=!0,g=!1,e=null,c=this._parent._freeHead;d&&!g;){var b=null!==c?c.from:this._parent._size;a>=(null!==e?e.from+e.count:0)&&a+f<=b?(d=!1,g=!0):null!==c?(e=c,c=c.next):d=!1}return[e,c]};a.prototype._updateLargestRange=
function(){for(var a=null,f=this._parent._freeHead;null!==f;){if(!a||f.count>a.count)a=f;f=f.next}this._largestRange=a};return a}();h=function(){function a(a,h){this._allocated=0;this._size=a;this._freeHead=0<a?{from:0,count:a,prev:null,next:null}:null;this._bookKeeper=h||new f(this);this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}a.prototype.allocate=function(d){var f=this._bookKeeper.findBestRange(d);if(null===f)return-1;var h=f.from,g=f.count;f.from+=d;f.count-=d;this._bookKeeper.rangeResized(f,
h,g);this._allocated+=d;0===f.count&&(d=null!==f.prev?this._freeHead:f.next,a._removeRange(f),this._freeHead=d);return h};a.prototype.free=function(d,f){var h=this._bookKeeper.findAdjacentRanges(d,f),g=h[0],h=h[1];d={from:d,count:f,prev:g,next:h};null!==g&&(g.next=d);null!==h&&(h.prev=d);this._bookKeeper.rangeCreated(d);this._allocated-=f;if(null!==h&&d.from+d.count===h.from){f=d.from;var e=d.count;a._fuse(d,h);a._removeRange(h);this._bookKeeper.rangeResized(d,f,e);this._bookKeeper.rangeResized(h,
void 0,0)}null!==g&&g.from+g.count===d.from&&(f=g.from,e=g.count,a._fuse(g,d),a._removeRange(d),this._bookKeeper.rangeResized(g,f,e),this._bookKeeper.rangeResized(d,void 0,0));this._freeHead=null!==d.prev?this._freeHead:d};Object.defineProperty(a.prototype,"fragmentation",{get:function(){var a=this._size-this._allocated;return 0===a?0:1-this._bookKeeper.largestRange.count/a},enumerable:!0,configurable:!0});a._removeRange=function(a){null!==a.prev?null!==a.next?(a.prev.next=a.next,a.next.prev=a.prev):
a.prev.next=null:null!==a.next&&(a.next.prev=null)};a._fuse=function(a,f){a.count+=f.count;a.next=f.next;f.from+=f.count;f.count=0;null!==f.next&&(f.next.prev=a)};return a}();a.FreeList=h})},"esri/views/2d/engine/webgl/Fader":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a){void 0===a&&(a=400);this.duration=a;this._value=this._elapsed=this._lastTime=0;this._finished=!1}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},
enumerable:!0,configurable:!0});a.prototype.reset=function(){this._value=this._elapsed=this._lastTime=0};a.prototype.step=function(){var a=performance.now();if(0===this._lastTime)return this._lastTime=a,this._value=0,!0;if(this._elapsed>=this.duration)return!0;this._elapsed+=a-this._lastTime;this._lastTime=a;this._value=Math.min(this._elapsed/this.duration,1);return!1};return a}();a.default=h})},"esri/views/2d/engine/webgl/WGLBuffers":function(){define(["require","exports","./Utils","../../../webgl/BufferObject"],
function(h,a,f,m){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a){this.geometryMap=f.createGeometryData(function(d){return{indexBuffer:m.createIndex(a,35044),vao:null}},function(d,g){return{vertexBuffer:m.createVertex(a,f.C_VBO_INFO[g])}})}a.prototype.dispose=function(){for(var a in this.geometryMap){var d=this.geometryMap[a];d.data.vao&&d.data.vao.dispose(!1);d.data.indexBuffer&&d.data.indexBuffer.dispose();for(var f in d.buffers)d.buffers[f]&&d.buffers[f].data.vertexBuffer.dispose()}};
a.prototype.get=function(a){var d=this.geometryMap[a];a={};for(var f in d.buffers)a[f]=d.buffers[f].data.vertexBuffer;return{indexBuffer:d.data.indexBuffer,get vao(){return d.data.vao},set vao(a){d.data.vao=a},vertexBufferMap:a}};a.prototype.has=function(a){return null!=this.geometryMap[a]};a.prototype.upload=function(a,d){var f=this;d.forEach(function(d,c){f._upload(d,c,a)})};a.prototype._upload=function(a,d,f){a.indices&&(a.indices.allDirty?this._uploadIndices(f,d):null!=a.indices.from&&null!=a.indices.count&&
this._uploadIndices(f,d,a.indices.from,a.indices.count));if(a.vertices){a=a.vertices;for(var e in a){var c=a[e];c.allDirty?this._uploadVertices(f,d,e):null!=c.from&&null!=c.count&&this._uploadVertices(f,d,e,c.from,c.count)}}};a.prototype._uploadVertices=function(a,d,f,e,c){var b=this.geometryMap[d];b&&(d=a.geometries[d].vertexBuffer[f])&&(a=d.stride,d=d.data.buffer,b.buffers[f]&&0<d.byteLength&&(null!=e&&null!=c?b.buffers[f].data.vertexBuffer.setSubData(d,e*a,e*a,(e+c)*a):b.buffers[f].data.vertexBuffer.setData(d)))};
a.prototype._uploadIndices=function(a,d,f,e){var c=this.geometryMap[d];c&&(a=a.geometries[d].indexBuffer.buffer,c.data.indexBuffer&&0<a.byteLength&&(null!=f&&null!=e?c.data.indexBuffer.setSubData(a,4*f,4*f,4*(f+e)):c.data.indexBuffer.setData(a)))};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/factories/matcherUtils":function(){define(["require","exports","../../../../../../core/Error","../../../../../../core/Logger","../../util/Matcher"],function(h,a,f,m,d){Object.defineProperty(a,"__esModule",
{value:!0});var k=m.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");a.createMatcher=function(a,g,e){switch(a.type){case "simple":case "dot-density":case "dotDensity":return d.default.fromBasicRenderer(a,g,e);case "unique-value":case "uniqueValue":return d.MapMatcher.fromUVRenderer(a,g,e);case "class-breaks":case "classBreaks":return d.IntervalMatcher.fromCBRenderer(a,g,e);default:return k.error(new f("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),null}}})},
"esri/views/2d/engine/webgl/util/Matcher":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../../../core/Logger","../Utils"],function(h,a,f,m,d){Object.defineProperty(a,"__esModule",{value:!0});var k=m.getLogger("esri/views/2d/engine/webgl/util/Matcher");h=function(){function a(){this._defaultResult=null}a.fromBasicRenderer=function(d,e,c){var b=d.getSymbols(),f=new a;b.length&&(d=e.createTemplateGroup(b[0],null,d,c),f.setDefault(d));return f};a.prototype.size=
function(){return 1};a.prototype.getDefault=function(){return this._defaultResult};a.prototype.setDefault=function(a){this._defaultResult=a};a.prototype.match=function(a,d,c){return this.getDefault()};return a}();a.default=h;m=function(a){function g(e,c,b,f,g){var h=a.call(this)||this;h._intervals=[];h._isMaxInclusive=c;f?h._getValue=d.createArcadeFunction(f,g):e&&e.length?"function"===typeof e?(h._field=null,h._getValue=e):(h._field=e,h._normalizationInfo=b,h._getValue=h._getValueFromField.bind(h)):
h._field=null;return h}f(g,a);g.fromCBRenderer=function(a,c,b){for(var d=new g(a.field,a.isMaxInclusive,{normalizationField:a.normalizationField,normalizationTotal:a.normalizationTotal,normalizationType:a.normalizationType},a.valueExpression,b),e=a.backgroundFillSymbol,f=0,h=a.classBreakInfos;f<h.length;f++){var k=h[f],m=c.createTemplateGroup(k.symbol,e,a,b);d.add({min:k.minValue,max:k.maxValue},m)}if(f=a.defaultSymbol)a=c.createTemplateGroup(f,e,a,b),d.setDefault(a);return d};g.prototype.add=function(a,
c){this._intervals.push({interval:a,result:c});this._intervals.sort(function(a,c){return a.interval.min-c.interval.min})};g.prototype.size=function(){return a.prototype.size.call(this)+this._intervals.length};g.prototype.match=function(a,c,b){if(!this._getValue)return this.getDefault();a=this._getValue(a,c,b);if(!a&&(null===a||void 0===a||isNaN(a)))return this.getDefault();for(c=0;c<this._intervals.length;c++){var d=this._intervals[c];b=d.interval;var d=d.result,e=this._isMaxInclusive?a<=b.max:a<
b.max;if(a>=b.min&&e)return d}return this.getDefault()};g.prototype._needsNormalization=function(){var a=this._normalizationInfo;return a&&(a.normalizationField||a.normalizationTotal||a.normalizationType)};g.prototype._getValueFromField=function(a){var c=a.attributes[this._field];if(!this._needsNormalization())return c;var b=this._normalizationInfo,d=b.normalizationField,e=b.normalizationTotal,b=b.normalizationType;a=!!d&&a.attributes[d];if(b)switch(b){case "field":return(a||void 0)&&c/a;case "log":return Math.log(c)*
Math.LOG10E;case "percent-of-total":return c/e*100;default:k.error("Found unknown normalization type: "+b)}else k.error("Normalization is required, but no type was set!")};return g}(h);a.IntervalMatcher=m;h=function(a){function g(e,c,b,f){var g=a.call(this)||this;g._resultsMap=new Map;b?g._getValue=d.createArcadeFunction(b,f):e&&e.length?"function"===typeof e[0]?(g._fields=null,g._getValue=e[0]):(g._fields=e,g._seperator=c||"",g._getValue=g._getValueFromFields.bind(g)):g._fields=null;return g}f(g,
a);g.fromUVRenderer=function(a,c,b){var d=a.uniqueValueInfos,e=a.fieldDelimiter,f=a.valueExpression,h=[a.field];a.field2&&h.push(a.field2);a.field3&&h.push(a.field3);for(var k=a.backgroundFillSymbol,e=new g(h,e,f,b),f=0;f<d.length;f++){var h=d[f],m=c.createTemplateGroup(h.symbol,k,a,h);e.add(h.value,m)}a.defaultSymbol&&(a=c.createTemplateGroup(a.defaultSymbol,k,a,b),e.setDefault(a));return e};g.prototype.add=function(a,c){this._resultsMap.set(a.toString(),c)};g.prototype.size=function(){return a.prototype.size.call(this)+
this._resultsMap.size};g.prototype.match=function(a,c,b){if(!this._getValue)return this.getDefault();a=this._getValue(a,c,b);if(!a&&(null===a||void 0===a))return this.getDefault();a=a.toString();return this._resultsMap.has(a)?this._resultsMap.get(a):this.getDefault()};g.prototype._getValueFromFields=function(a){for(var c=[],b=0,d=this._fields;b<d.length;b++)c.push(a.attributes[d[b]]);return c.join(this._seperator)};return g}(h);a.MapMatcher=h})},"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../geometry/support/jsonUtils ../../../../../../symbols/SimpleLineSymbol ../../definitions ../../enums ../../WGLDisplayObject ../../collisions/LayerCollisionInfo ../MeshData ../VertexVector ./VVFactory ../templates/WGLLabelTemplate ../templates/WGLLineTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore ../../util/vvFlagUtils".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p,B,F,q){Object.defineProperty(a,"__esModule",{value:!0});var x=d.getLogger("esri.views.2d.engine.webgl.WGLMeshFactory"),u={esriGeometryPoint:"above-right above-center above-left center-center center-left center-right below-center below-left below-right".split(" "),esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};h=function(){function a(a,b,c,d,f,g,h,m,n){this._isDD=!1;this._labelsDebugVVEval=
this._labelsDebugTemplate=null;g=k.isSome(c)&&"visualVariables"in c&&c.visualVariables;this._isDD=k.isSome(c)&&"dot-density"===c.type;this._geometryType=a;this._idField=b;this._pixelRatio=f;this._vvFlags=g?q.getVVFlags(g):0;this._vvFactory=k.isSome(c)&&z.default.fromRenderer(c,d);this._vvBuf=new ArrayBuffer(32);this._vvBufU32=new Uint32Array(this._vvBuf);this._vvBufF32=new Float32Array(this._vvBuf);this._templateStore=h;m&&(e.DEBUG_LABELS&&(this._labelsDebugVVEval=g&&l.createLabelVVEvaluator(g)),
this._validateLabelingInfo(m)&&(this._labelTemplates=m.map(function(a){return w.default.fromLabelClass(c,a,n)})))}Object.defineProperty(a.prototype,"templates",{get:function(){return this._templateStore},enumerable:!0,configurable:!0});a.prototype.createMeshData=function(a){var b=Array(5),d=!!q.getMarkerVVFlags(this._vvFlags),f=!!q.getFillVVFlags(this._vvFlags),g=!!q.getLineVVFlags(this._vvFlags,"esriGeometryPolyline"!==this._geometryType),h=!!q.getTextVVFlags(this._vvFlags),k="esriGeometryPolyline"===
this._geometryType?e.HEURISTIC_GLYPHS_PER_LINE:e.HEURISTIC_GLYPHS_PER_FEATURE;b[c.WGLGeometryType.MARKER]=new v.VertexVectors(c.WGLGeometryType.MARKER,d,a);b[c.WGLGeometryType.FILL]=new v.VertexVectors(c.WGLGeometryType.FILL,f,a,this._isDD);b[c.WGLGeometryType.LINE]=new v.VertexVectors(c.WGLGeometryType.LINE,g,a);b[c.WGLGeometryType.TEXT]=new v.VertexVectors(c.WGLGeometryType.TEXT,h,a);b[c.WGLGeometryType.LABEL]=new v.VertexVectors(c.WGLGeometryType.LABEL,!1,this._labelTemplates&&0<this._labelTemplates.length?
k:0);return new y.default([],b)};a.prototype.analyze=function(a,b,c,d){for(var e=0;e<a.length;e++){var f=a[e],g=-1;if("symbol"in f)f.filterFlags=1,null!=f.symbol?g=this._templateStore.createTemplateGroup(f.symbol,null,null,null):b&&(g=b.match(f,c,d));else if(b&&(g=b.match(f,c,d),F.isDynamicId(g)))for(var h=0,k=this._templateStore.getDynamicTemplateGroup(g);h<k.length;h++){var l=k[h];l&&l.analyze&&l.analyze(f,this._templateStore)}f.groupId=g}return this._templateStore.finalize().then(function(){return a})};
a.prototype.write=function(a,c,d,e,f,g,h){var k=this._templateStore.getTemplateGroup(c.groupId),l=c.attributes[this._idField],m=new b(l),q=!!g&&!!this._labelTemplates&&g.has(l);if(F.isDynamicId(c.groupId))for(var p=0;p<k.length;p++){var u=k[p];u.bindFeature(c,d,e)}if(k&&(c.geometry||c.centroid)){this._vvFactory&&this._vvFactory.computeVV(this._vvBufF32,c,d,e);p=m.displayRecords;u=c.insertAfter;void 0!==u&&(m.insertAfter=u);(d=this._geometryType)||(d=null!=c.centroid?"esriGeometryPolygon":n.getJsonType(c.geometry));
e=c.filterFlags;m.filterFlags=e;for(var x=0;x<k.length;x++){var u=k[x],v=a.get(u.geometryType);u.writeMesh(p,v,d,l,c,this._pixelRatio,this._vvBufU32,e)}q&&(k=this._getLabelReference(k),g=g.get(l),this._writeLabelMesh(m,a,l,c,h,g,k,f,d,e));a.pushDisplayObject(m)}};a.prototype._hasBadLabelClass=function(a,b){var c=a.labelPlacement,d=u[b];if(!a.symbol)return x.error(new m("mapview-labeling:missing-required-parameter","Unable to create labels for Feature Layer, LabelClass missing symbol",a)),!0;if(!d)return x.error(new m("mapview-labeling:unsupported-geometry-type",
"Unable to create labels for Feature Layer, "+b+" is not supported")),!0;d.some(function(a){return a===c})||(d=d[0],c&&x.warn("Found invalid label placement type "+c+" for "+b+". Defaulting to "+d),a.labelPlacement=d);return!1};a.prototype._validateLabelingInfo=function(a){var b=this;return!a.some(function(a){return b._hasBadLabelClass(a,b._geometryType)})};a.prototype._getLabelReference=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c instanceof B.default)return c}return null};a.prototype._writeLabelMesh=
function(a,b,c,d,f,g,h,k,l,m){for(var n=a.displayRecords,q=[],p=this._pixelRatio,u=this._vvBufU32,x=0;x<g.length;x++){var v=g[x],z=v.text,w=v.rtl,v=this._labelTemplates[v.id],A=b.get(v.geometryType),G=f.get(v.symbolId).glyphMosaicItems;v.bindReferenceTemplate(h);v.bindTextInfo(G,z,w);v.writeMesh(n,A,l,c,d,p,u,m,k,q)}a.metrics=q;e.DEBUG_LABELS&&this._debugLabels(a,b,m)};a.prototype._debugLabels=function(a,b,c){var d=a.displayRecords,e=a.id,f=0;for(a=a.metrics;f<a.length;f++){var g=a[f],h=g.boxes?g.boxes.concat([g.bounds]):
[g.bounds];this._labelsDebugVVEval&&g.computeOffset(this._labelsDebugVVEval);for(var k=0;k<h.length;k++){var l=h[k],l={geometry:{paths:[[[g.anchor[0]+g.offsetX+l.center[0]-l.width/2,g.anchor[1]+g.offsetY+l.center[1]+l.height/2],[0,-l.height],[l.width,0],[0,l.height],[-l.width,0]]]},attributes:{}},m=this._getLabelDebugTemplate(),n=b.get(m.geometryType);m.writeMesh(d,n,"esriGeometryPolyline",e,l,this._pixelRatio,null,c)}}};a.prototype._getLabelDebugTemplate=function(){this._labelsDebugTemplate||(this._labelsDebugTemplate=
this._createLabelsDebugTemplate());return this._labelsDebugTemplate};a.prototype._createLabelsDebugTemplate=function(){var a=new g({style:"solid",width:1,color:[255,0,0,1]});return p.default.fromSimpleLine(null,!1,a,null)};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["require","exports","../util/serializationUtils","../util/Writer"],function(h,a,f,m){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,d){this.displayObjects=a;this.vertexVectorsMap=
d}Object.defineProperty(a.prototype,"vertexBuffersMap",{get:function(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(var a=0;a<this.vertexVectorsMap.length;a++)this._vertexBuffersMap[a]=this.vertexVectorsMap[a].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap},enumerable:!0,configurable:!0});a.prototype.get=function(a){return this.vertexVectorsMap[a]};a.prototype.pushDisplayObject=function(a){this.displayObjects.push(a)};a.prototype.encode=function(a,d){var g=f.serializeList(new m.default(Uint32Array,
this._guessSize()),this.displayObjects).buffer(),e={};d.push(g);for(var c=0;c<this.vertexVectorsMap.length;c++){var b=this.vertexVectorsMap[c];e[c]={};b.transfer(e[c],d)}a.displayObjects=g;a.vertexBuffersMap=e;this.destroy()};a.prototype.destroy=function(){this.displayObjects=this.vertexVectorsMap=null};a.prototype._guessSize=function(){for(var a=this.displayObjects,d=Math.min(a.length,4),f=0,e=0;e<d;e++)f=Math.max(f,a[e].displayRecords.length);return 2*(12*a.length+a.length*f*40)};return a}();a.default=
h})},"esri/views/2d/engine/webgl/mesh/VertexVector":function(){define(["require","exports","../Utils","./VertexBuffer","../util/Writer"],function(h,a,f,m,d){Object.defineProperty(a,"__esModule",{value:!0});var k=function(){function a(a,d){this.data=a;this.stride=d}Object.defineProperty(a.prototype,"vertexCount",{get:function(){return this.data.length/(this.stride/4)},enumerable:!0,configurable:!0});a.prototype.transfer=function(a,d){var c=this.data.buffer();a.vertexCount=this.vertexCount;a.data=c;
a.stride=this.stride;d.push(c)};return a}();a.default=k;h=function(){function a(a,e,c,b){void 0===b&&(b=!1);this.geometryType=a;this.indexVector=new d.default(Uint32Array,c);this.namedVectors={};a=f.getStrides(a,e,b);for(var g in a){e=a[g];b=void 0;switch(e%4){case 0:case 2:b=new d.default(Uint32Array,e/4*c);break;case 1:case 3:b=new d.default(Uint8Array,e*c)}this.namedVectors[g]=new k(b,e)}}a.prototype.get=function(a){return this.namedVectors[a].data};a.prototype.getVector=function(a){return this.namedVectors[a]};
a.prototype.transfer=function(a,d){var c=this.indexVector.buffer(),b={};d.push(c);for(var e in this.namedVectors){var f=this.namedVectors[e];b[e]={};f.transfer(b[e],d)}a.geometryType=this.geometryType;a.indexBuffer=c;a.namedBuffers=b;this.destroy()};a.prototype.intoBuffers=function(){var a=m.VertexBuffers.fromVertexVectors(this);this.destroy();return a};a.prototype.destroy=function(){this.namedVectors=this.indexVector=null};return a}();a.VertexVectors=h})},"esri/views/2d/engine/webgl/mesh/factories/VVFactory":function(){define("require exports ../../../../../../core/Error ../../../../../../core/Logger ../../definitions ../../enums ../../Utils ../../visualVariablesUtils".split(" "),
function(h,a,f,m,d,k,n,g){Object.defineProperty(a,"__esModule",{value:!0});var e=m.getLogger("esri.views.2d.engine.webgl.mesh.VVFactory"),c;(function(a){a[a.NONE=0]="NONE";a[a.MISSING_DATA=1]="MISSING_DATA"})(c=a.VVError||(a.VVError={}));var b=function(){function a(){this._vvMap=new Map}a.prototype.set=function(a,b){this._vvMap.set(a,b)};Object.defineProperty(a.prototype,"map",{get:function(){return this._vvMap},enumerable:!0,configurable:!0});a.prototype.getValue=function(a,b,c,d){return this._vvMap.has(a)?
this._vvMap.get(a)(b,c,d):0};return a}();h=function(){function a(){}a.fromRenderer=function(b,c){var d=new a;switch(b.type){case "dot-density":d._createDDFunctionMap(b.attributes,c);break;case "simple":case "unique-value":case "class-breaks":d._createVVFunctionMap(b.visualVariables,c);break;default:return e.error("Cannot create factory for renderer type "+b.type),null}return d};a.prototype.computeVV=function(a,b,d,e){var f=this;if(!this._vvMap)return c.NONE;this._vvMap.map.forEach(function(c,g){c=
c(b,d,e);a[g]=f._isErrorVV(c)?1E-30:c});return c.NONE};a.prototype._isErrorVV=function(a){return null===a||isNaN(a)||Infinity===a};a.prototype._createVVFunctionMap=function(a,c){if(a&&a.length)for(var d=0;d<a.length;d++){var e=a[d],f=n.getVVType(e.type);if(e=this._createGetValueFunction(e,c))this._vvMap||(this._vvMap=new b),this._vvMap.set(f,e)}};a.prototype._createDDFunctionMap=function(a,c){this._vvMap||(this._vvMap=new b);a.length>d.DOT_DENSITY_MAX_FIELDS&&e.warn("mapview-invalid-value","DotDensityRenderer supports a maximium of "+
d.DOT_DENSITY_MAX_FIELDS+" attribtues, but found "+a.length);for(var f=0;f<Math.min(d.DOT_DENSITY_MAX_FIELDS,a.length);f++){var g=this._createNormalizedFunction(a[f],c);this._vvMap.set(f,g)}};a.prototype._createGetValueFunction=function(a,b){if(n.getVVType(a.type)===k.VVType.SIZE){var c=g.getTypeOfSizeVisualVariable(a);return c===k.WGLVVFlag.SIZE_SCALE_STOPS?null:this._createNormalizedFunction(a,b,c===k.WGLVVFlag.SIZE_UNIT_VALUE&&function(b){return g.getVisualVariableSizeValueRepresentationRatio(b,
a.valueRepresentation)})}return this._createNormalizedFunction(a,b)};a.prototype._createNormalizedFunction=function(a,b,c){var d=a.field;if(d){if("string"===typeof d){var g=a.normalizationField;return g?function(a){if(a.attributes[d]&&a.attributes[g])return a=a.attributes[d]/a.attributes[g],c?c(a):a}:c?function(a){return c(a.attributes[d])}:function(a){return a.attributes[d]}}if("function"===typeof d)return e.error(new f("mapview-rendering:unsupported-feature","Function field types are not currently supported. Please use a valueExpression instead")),
function(a){};e.error(new f("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof d));return function(a){}}if(a.valueExpression)return n.createArcadeFunction(a.valueExpression,b,c);e.error("Unable to create a normalized function for visual variable: "+a);return function(a){}};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../color ../../definitions ../../enums ../../LineTess ../../number ../../TileClipper ../../Utils ../../WGLDisplayRecord ../../materialKey/MaterialKey ./WGLMeshTemplate".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z){Object.defineProperty(a,"__esModule",{value:!0});var w=m.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate"),p=e.allocTriangles(20),B=e.allocTriangles(20),F=[e.allocExtrudeVectors(),e.allocExtrudeVectors()],q=e.allocExtrudeVectors(),x=n.TILE_SIZE+8,u=new e.Tessellator({distanceAlongCorrection:!0}),A=new b.TileClipper(0,0,0,1,8);A.setExtent(n.TILE_SIZE);h=function(a){function b(b,c,d,e,f,h,k,l,m,n,q,p){var u=a.call(this)||this;u.width=d;u.capType=e;u.joinType=
f;u.fillColor=h;u.tl=k;u.br=l;u.hasPattern=m;u.isDashed=n;u.isColorLocked=q;u.isOutline=p;u.geometryType=g.WGLGeometryType.LINE;b=v.LineMaterialKey.load(v.createMaterialKey(u.geometryType,b,p));c&&(b.sdf=c.sdf,b.pattern=!0,b.textureBinding=c.textureBinding);u._materialKey=b.data;u._bitset=q?1:0;return u}f(b,a);b.fromCIMLine=function(a,e,f,h){var l=e.color,m=e.isDashed,n=e.cap;m&&n===g.CapType.ROUND&&(n=g.CapType.SQUARE);var q=e.join,p=d.pt2px(e.width),l=l&&k.premultiplyAlphaRGBA(l)||0;if(!f)return new b(a,
f,p,n,q,l,0,0,!1,m,e.colorLocked,h);var u=f.rect,x=u.x+1+f.width,v=u.y+1+f.height,u=c.i1616to32(u.x+1,u.y+1),x=c.i1616to32(x,v);return new b(a,f,p,n,q,l,u,x,!0,m,e.colorLocked,h)};b.fromSimpleLine=function(a,e,f,g){var h=f.color,m="solid"!==f.style&&"none"!==f.style,n=l.getCapType(f.cap||"round",m),q=l.getJoinType(f.join||"round"),h=h&&"none"!==f.style&&k.premultiplyAlphaRGBA(h)||0;"none"===f.style&&(h=0);if(!g)return new b(a,g,d.pt2px(f.width),n,q,h,0,0,!1,m,!1,e);var p=g.rect,u=p.x+1+g.width,x=
p.y+1+g.height,p=c.i1616to32(p.x+1,p.y+1),u=c.i1616to32(u,x);return new b(a,g,d.pt2px(f.width),n,q,h,p,u,!0,m,!1,e)};b.fromPictureLineSymbol=function(a,b,c,d){w.error("PictureLineSymbol support does not exist!");return null};b.prototype.writeMesh=function(a,b,c,d,e,f,g,h){this.halfWidth=0<this.width?.5*(this.width+1/f):0;f=b.indexVector;var k=b.get("geometry"),l=b.get("visibility"),m=this.halfWidth,n=new y(d,this.geometryType,this._materialKey),q=v.LineMaterialKey.load(this._materialKey);b=b.getVector("geometry").vertexCount;
n.vertexFrom=b;n.indexFrom=f.length;switch(c){case "esriGeometryPolyline":c=this._clipLines(e.geometry.paths);if(0===c.length)break;this._write(n,f,k,l,b,d,m,c,q,g,h);a.push(n);break;case "esriGeometryPolygon":c=this._clipLines(e.geometry.rings);if(0===c.length)break;this._write(n,f,k,l,b,d,m,c,q,g,h);a.push(n);break;default:w.error("Unable to handle geometryType: "+c)}};b.prototype._clipLines=function(a){for(var b=[],c=!1,d=0;d<a.length;){var e=[],f=a[d];A.reset(2);var g=f[0],h=g[0],g=g[1];if(c)A.moveTo(h,
g);else{if(-8>h||h>x||-8>g||g>x){c=!0;continue}e.push({x:h,y:g})}for(var k=!1,l=f.length,m=1;m<l;++m)if(h+=f[m][0],g+=f[m][1],c)A.lineTo(h,g);else{if(-8>h||h>x||-8>g||g>x){k=!0;break}e.push({x:h,y:g})}if(k)c=!0;else{if(c){if(e=A.resultWithStarts())for(c=0;c<e.length;c++)b.push(e[c])}else b.push({line:e,start:0});d++;c=!1}}return b};b.prototype._write=function(a,b,c,d,f,g,h,k,l,m,n){for(var x=0,v=0;v<k.length;v++){var w=k[v],z=w.line;if(!(2>z.length))for(var A=z[0],G=z[z.length-1],H=G.x-A.x,A=G.y-
A.y,H=1E-6>H*H+A*A,B=w.start%65535,w=F[1],A=0;A<z.length;A++){var C=z[A],G=w===F[A%2]?F[(A+1)%2]:F[A%2],I=0===A,y=A===z.length-1;y&&H&&!this.hasPattern?e.copyExtrudeVectors(G,q):(this._computeExtrudeVectors(G,A,z,H),x+=this._writeVertices(c,d,g,h,C.x,C.y,G,B,x,l,m,n),null==G.capCenter||H&&y||this._writePieIndices(a,b,f,G),H&&I&&!this.hasPattern&&e.copyExtrudeVectors(q,G));I||this._writeBridgeIndices(a,b,f,w,G);if(!y){var y=z[A+1],I=[y.x-C.x,y.y-C.y],D=e.length(I),I=[I[0]/D,I[1]/D],D=B+D;if(65535<
D){var P=(65535-B)/(D-B),B=C.x+(y.x-C.x)*P,C=C.y+(y.y-C.y)*P,y=w;u.buttCap(y,I,I);x+=this._writeVertices(c,d,g,h,B,C,y,65535,x,l,m,n);u.bridge(p,G,y);this._writeBridgeIndices(a,b,f,G,y);u.buttCap(y,I,I);B=D-65535}else B=D,w=G}}}a.vertexCount=x};b.prototype._writeVertices=function(a,b,d,e,f,g,h,k,l,m,n,q){var p=0,u=c.i1616to32(f,g),x=h.vectors;h=x.items;for(x=x.count;p<x;++p){var v=h[p].vector,z=v[0],v=v[1],w=h[p].texCoords,A=w[0],G=w[1],H=h[p].direction,w=H[0],C=H[1],H=c.i1616to32(k,31*e),z=c.i8888to32(Math.round(31*
z),Math.round(31*v),Math.round(31*A),Math.round(31*G)),v=c.i8888to32(Math.round(31*w),Math.round(31*C),0,this._bitset);a.push(u);a.push(d);a.push(this.fillColor);a.push(z);a.push(H);a.push(this.tl);a.push(this.br);a.push(v);this._writeVV(a,n,m);b.push(q);h[p].base={index:l+p,point:[f,g]}}return p};b.prototype._writeVV=function(a,b,c){c.hasVV()&&(a.push(b[g.VVType.SIZE]),a.push(b[g.VVType.COLOR]),a.push(b[g.VVType.OPACITY]))};b.prototype._writeBridgeIndices=function(a,b,c,d,e){u.bridge(p,d,e);for(d=
0;d<p.count;++d)e=p.items[d],b.push(c+e.v1.base.index),b.push(c+e.v2.base.index),b.push(c+e.v3.base.index),a.indexCount+=3};b.prototype._writePieIndices=function(a,b,c,d){u.pie(B,d);for(d=0;d<B.count;++d){var e=B.items[d];b.push(c+e.v1.base.index);b.push(c+e.v2.base.index);b.push(c+e.v3.base.index);a.indexCount+=3}};b.prototype._computeExtrudeVectors=function(a,b,c,d){var f=c[b],g=[void 0,void 0],h=[void 0,void 0];if(0<b&&b<c.length-1){var k=c[(b+c.length-1)%c.length],l=c[(b+1)%c.length];e.normalize(g,
[f.x-k.x,f.y-k.y]);e.normalize(h,[l.x-f.x,l.y-f.y])}else if(0===b)l=c[(b+1)%c.length],e.normalize(h,[l.x-f.x,l.y-f.y]),d?(k=c[c.length-2],e.normalize(g,[f.x-k.x,f.y-k.y])):g=h;else if(b===c.length-1)k=c[(b+c.length-1)%c.length],e.normalize(g,[f.x-k.x,f.y-k.y]),d?(k=c[1],e.normalize(h,[k.x-f.x,k.y-f.y])):h=g;else{console.error("Vertex index 'i' out of range.");return}d||0!==b?d||b!==c.length-1?this._computeJoinExtrudeVectors(a,g,h):this._computeCapExtrudeVectors(a,g,h,e.CapPosition.END):this._computeCapExtrudeVectors(a,
g,h,e.CapPosition.START)};b.prototype._computeCapExtrudeVectors=function(a,b,c,d){switch(this.capType){case g.CapType.BUTT:u.buttCap(a,b,c);break;case g.CapType.ROUND:var f=e.getNumberOfSlices(Math.PI);u.roundCap(a,b,c,d,f,d===e.CapPosition.START?-1:1);break;case g.CapType.SQUARE:this.isDashed?u.squareCapForDashedLines(a,b,c,d):u.squareCap(a,b,c,d);break;default:w.error("Encountered unknown cap type: "+this.capType+", defaulting to BUTT"),u.buttCap(a,b,c)}};b.prototype._computeJoinExtrudeVectors=
function(a,b,c){var d=e.getRads(b,c);if(d>Math.PI-.05)u.rectJoin(a,b,c);else if(this.joinType===g.JoinType.MITER||.1>d).05>d?u.fastMiterJoin(a,b,c):d<e.MITER_SAFE_RADS?u.miterJoin(a,b,c):u.bevelJoin(a,b,c,e.SYSTEM_MAG_LIMIT);else if(this.joinType===g.JoinType.BEVEL)u.bevelJoin(a,b,c,1);else if(this.joinType===g.JoinType.ROUND){var f=e.getNumberOfSlices(d);2.3>d?2>f||.5>d?u.bevelJoin(a,b,c,1):u.roundJoin(a,b,c,f):u.unitRoundJoin(a,b,c,f)}};return b}(z.default);a.default=h})},"esri/views/2d/engine/webgl/LineTess":function(){define(["require",
"exports"],function(h,a){function f(a){var b={items:[],count:0},c;for(c=0;c<a;++c)b.items.push(void 0);return b}function m(a,b){q.vector[0]=a.vector[0];q.vector[1]=a.vector[1];q.texCoords[0]=a.texCoords[0];q.texCoords[1]=a.texCoords[1];q.direction[0]=a.direction[0];q.direction[1]=a.direction[1];q.base=a.base;a.vector[0]=b.vector[0];a.vector[1]=b.vector[1];a.texCoords[0]=b.texCoords[0];a.texCoords[1]=b.texCoords[1];a.direction[0]=b.direction[0];a.direction[1]=b.direction[1];a.base=b.base;b.vector[0]=
q.vector[0];b.vector[1]=q.vector[1];b.texCoords[0]=q.texCoords[0];b.texCoords[1]=q.texCoords[1];b.direction[0]=q.direction[0];b.direction[1]=q.direction[1];b.base=q.base}function d(a,b){return a[0]*b[0]+a[1]*b[1]}function k(a){return Math.sqrt(d(a,a))}function n(a,b){var c=k(b);a[0]=b[0]/c;a[1]=b[1]/c;return a}function g(a,b){a[0]=-b[1];a[1]=b[0];return a}function e(a,b){return a[0]*b[1]-a[1]*b[0]}function c(a,b){a[0]=-b[0];a[1]=-b[1];return a}function b(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;return a}function l(a,
b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a}function y(a,b){a=d(a,b);return.999<a?0:-.999>a?Math.PI:Math.acos(a)}function v(a,c,d,e,f){if(0===e)a.count=0;else{var g=k(c),h=b(x[0],c,1/g);d=b(x[1],d,1/g);h=y(h,d);h=(f?-1:1)*h/e;f=Math.cos(h);h=Math.sin(h);d=c[0];var l=c[1];for(c=0;c<e-1;++c)g=d,d=f*g-h*l,l=h*g+f*l,a.items[c][0]=d,a.items[c][1]=l;a.count=e-1}}function z(a){var b=a.count,c=Math.floor(b/2),d;for(d=0;d<c;++d){var e=a.items[d];a.items[d]=a.items[b-d-1];a.items[b-d-1]=e}}Object.defineProperty(a,
"__esModule",{value:!0});var w;(function(a){a[a.ENTRY=1]="ENTRY";a[a.EXIT=2]="EXIT";a[a.CAP=3]="CAP"})(w=a.VectorRole||(a.VectorRole={}));var p;(function(a){a[a.START=1]="START";a[a.END=2]="END"})(p=a.CapPosition||(a.CapPosition={}));a.SYSTEM_MAG_LIMIT=3.8;a.MITER_SAFE_RADS=2*Math.acos(1/a.SYSTEM_MAG_LIMIT);var B=a.SYSTEM_MAG_LIMIT*a.SYSTEM_MAG_LIMIT,F=8/(2*Math.PI);a.allocTriangles=function(a){var b={items:[],count:0},c;for(c=0;c<a;++c)b.items.push({v1:{vector:[void 0,void 0],texCoords:[void 0,void 0],
direction:[void 0,void 0]},v2:{vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0]},v3:{vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0]}});return b};a.allocExtrudeVectors=function(){var a={items:[],count:0},b;for(b=0;30>b;++b)a.items.push({vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0]});b={};b[w.ENTRY]=f(20);b[w.EXIT]=f(20);b[w.CAP]=f(20);return{vectors:a,lists:b}};a.copyExtrudeVectors=function(a,b){var c;for(c=0;c<b.vectors.count;++c)a.vectors.items[c].vector[0]=
b.vectors.items[c].vector[0],a.vectors.items[c].vector[1]=b.vectors.items[c].vector[1],a.vectors.items[c].texCoords[0]=b.vectors.items[c].texCoords[0],a.vectors.items[c].texCoords[1]=b.vectors.items[c].texCoords[1],a.vectors.items[c].direction[0]=b.vectors.items[c].direction[0],a.vectors.items[c].direction[1]=b.vectors.items[c].direction[1],a.vectors.items[c].base=b.vectors.items[c].base;a.vectors.count=b.vectors.count;var d=b.lists[w.ENTRY],e=a.lists[w.ENTRY],f=b.lists[w.EXIT],g=a.lists[w.EXIT],
h=b.lists[w.CAP],k=a.lists[w.CAP];for(c=0;c<d.count;++c)e.items[c]=d.items[c];e.count=d.count;for(c=0;c<f.count;++c)g.items[c]=f.items[c];g.count=f.count;for(c=0;c<h.count;++c)k.items[c]=h.items[c];k.count=h.count;a.capCenter=b.capCenter};var q={vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0],base:void 0};a.swapExtrudeVectors=m;var x=[];for(h=0;32>h;++h)x.push([void 0,void 0]);var u=function(a){var b={items:[],count:0},c;for(c=0;c<a;++c)b.items.push([void 0,void 0]);return b}(8);
a.length=k;a.normalize=n;a.getNumberOfSlices=function(a){return Math.max(Math.round(a*F),1)};a.getRads=y;a.reverse=z;var A=[void 0,void 0],C=[void 0,void 0],D=[0,0],G=[0,0],H=[0,0],I=[0,0],L=Math.cos(Math.PI/4),J=Math.sin(Math.PI/4),K=Math.sqrt(2);h=function(){function a(a){this._distanceAlongCorrection=a.distanceAlongCorrection}a.prototype.bridge=function(a,b,c){var d=b.vectors;b=b.lists[w.EXIT];var e=c.vectors,f=c.lists[w.ENTRY],g,h;if(b.count===f.count+1)c=b.items,g=d.items,h=f.items,e=e.items;
else if(f.count===b.count+1)c=f.items,g=e.items,h=b.items,e=d.items;else if(b.count===f.count)c=f.items,g=e.items,h=b.items,e=d.items;else{console.error("Cannot bridge "+b.count+" to "+f.count+".");a.count=0;return}d=b.count+f.count-2;a.count=d;A[0]=c;A[1]=h;C[0]=g;C[1]=e;for(b=0;b<d;++b)c=a.items[b],g=(b+0)%2,g=C[g][A[g][Math.floor((b+0)/2)]],c.v1.vector[0]=g.vector[0],c.v1.vector[1]=g.vector[1],c.v1.texCoords[0]=g.texCoords[0],c.v1.texCoords[1]=g.texCoords[1],c.v1.direction[0]=g.direction[0],c.v1.direction[1]=
g.direction[1],c.v1.base=g.base,g=(b+1)%2,g=C[g][A[g][Math.floor((b+1)/2)]],c.v2.vector[0]=g.vector[0],c.v2.vector[1]=g.vector[1],c.v2.texCoords[0]=g.texCoords[0],c.v2.texCoords[1]=g.texCoords[1],c.v2.direction[0]=g.direction[0],c.v2.direction[1]=g.direction[1],c.v2.base=g.base,g=(b+2)%2,g=C[g][A[g][Math.floor((b+2)/2)]],c.v3.vector[0]=g.vector[0],c.v3.vector[1]=g.vector[1],c.v3.texCoords[0]=g.texCoords[0],c.v3.texCoords[1]=g.texCoords[1],c.v3.direction[0]=g.direction[0],c.v3.direction[1]=g.direction[1],
c.v3.base=g.base,g=c.v1.base&&c.v1.base.point||D,h=c.v2.base&&c.v2.base.point||D,e=c.v3.base&&c.v3.base.point||D,G[0]=g[0]+c.v1.vector[0],G[1]=g[1]+c.v1.vector[1],H[0]=h[0]+c.v2.vector[0],H[1]=h[1]+c.v2.vector[1],I[0]=e[0]+c.v3.vector[0],I[1]=e[1]+c.v3.vector[1],0>(H[0]-G[0])*(I[1]-G[1])-(I[0]-G[0])*(H[1]-G[1])||m(c.v2,c.v3)};a.prototype.pie=function(a,b){if(0===b.lists[w.CAP].count)a.count=0;else if(1===b.lists[w.CAP].count)console.error("A single vector is not enough to define a pie."),a.count=
0;else{a.count=b.lists[w.CAP].count-1;var c;for(c=0;c<a.count;++c){var d=a.items[c],e=b.vectors.items[b.lists[w.CAP].items[c]];d.v1.vector[0]=e.vector[0];d.v1.vector[1]=e.vector[1];d.v1.texCoords[0]=e.texCoords[0];d.v1.texCoords[1]=e.texCoords[1];d.v1.direction[0]=e.direction[0];d.v1.direction[1]=e.direction[1];d.v1.base=e.base;e=b.vectors.items[b.lists[w.CAP].items[c+1]];d.v2.vector[0]=e.vector[0];d.v2.vector[1]=e.vector[1];d.v2.texCoords[0]=e.texCoords[0];d.v2.texCoords[1]=e.texCoords[1];d.v2.direction[0]=
e.direction[0];d.v2.direction[1]=e.direction[1];d.v2.base=e.base;e=b.vectors.items[b.capCenter];d.v3.vector[0]=e.vector[0];d.v3.vector[1]=e.vector[1];d.v3.texCoords[0]=e.texCoords[0];d.v3.texCoords[1]=e.texCoords[1];d.v3.direction[0]=e.direction[0];d.v3.direction[1]=e.direction[1];d.v3.base=e.base;var e=d.v1.base&&d.v1.base.point||D,f=d.v2.base&&d.v2.base.point||D,g=d.v3.base&&d.v3.base.point||D;G[0]=e[0]+d.v1.vector[0];G[1]=e[1]+d.v1.vector[1];H[0]=f[0]+d.v2.vector[0];H[1]=f[1]+d.v2.vector[1];I[0]=
g[0]+d.v3.vector[0];I[1]=g[1]+d.v3.vector[1];0>(H[0]-G[0])*(I[1]-G[1])-(I[0]-G[0])*(H[1]-G[1])||m(d.v2,d.v3)}}};a.prototype.buttCap=function(a,b,c){this.fastMiterJoin(a,b,c)};a.prototype.roundCap=function(a,b,c,d,e,f){void 0===f&&(f=0);this.fastMiterJoin(a,b,c);c=d===p.START?0:1;d=d===p.START?1:0;a.capCenter=a.vectors.count;b=a.vectors.items[a.capCenter];b.vector[0]=0;b.vector[1]=0;b.texCoords[0]=0;b.texCoords[1]=0;b.direction[0]=0;b.direction[1]=0;++a.vectors.count;v(u,a.vectors.items[c].vector,
a.vectors.items[d].vector,e,!1);e=a.vectors.count;b=a.lists[w.CAP];b.items[0]=c;c=a.vectors.items[c].texCoords[1];var g=a.vectors.items[d].texCoords[1],h;for(h=0;h<u.count;++h){var k=f*(1-Math.abs(u.count/2-h)/(u.count/2)),l=c+h/(u.count-1)*(g-c),m=u.items[h],n=a.vectors.items[e+h];n.vector[0]=m[0];n.vector[1]=m[1];n.texCoords[0]=k;n.texCoords[1]=l;n.direction[0]=0;n.direction[1]=0;b.items[h+1]=e+h}b.items[u.count+1]=d;b.count=u.count+2;a.vectors.count=e+u.count};a.prototype.squareCap=function(a,
c,d,e){this.fastMiterJoin(a,c,d);c=e===p.START?0:1;d=e===p.START?1:0;var f=x[0],g=x[1],h=x[2],k=x[3];e=x[4];var l=a.vectors.items[c].vector;f[0]=L*l[0]-J*l[1];f[1]=J*l[0]+L*l[1];b(k,f,K);g[0]=L*f[0]-J*f[1];g[1]=J*f[0]+L*f[1];h[0]=L*g[0]-J*g[1];h[1]=J*g[0]+L*g[1];b(e,h,K);c=a.vectors.items[c];c.vector[0]=k[0];c.vector[1]=k[1];a=a.vectors.items[d];a.vector[0]=e[0];a.vector[1]=e[1]};a.prototype.squareCapForDashedLines=function(a,b,d,e){if(e===p.START){b=g(x[0],d);d=c(x[4],b);e=x[1];var f=x[2],h=x[3];
e[0]=L*b[0]-J*b[1];e[1]=J*b[0]+L*b[1];f[0]=L*e[0]-J*e[1];f[1]=J*e[0]+L*e[1];h[0]=L*f[0]-J*f[1];h[1]=J*f[0]+L*f[1];f=x[5];f[0]=0;f[1]=0;a.capCenter=0;var k=a.vectors.items;k[0].vector[0]=f[0];k[0].vector[1]=f[1];k[0].direction[0]=0;k[0].direction[1]=0;k[0].texCoords[0]=0;k[0].texCoords[1]=0;k[1].vector[0]=b[0];k[1].vector[1]=b[1];k[1].direction[0]=0;k[1].direction[1]=0;k[1].texCoords[0]=0;k[1].texCoords[1]=-1;k[2].vector[0]=e[0]*K;k[2].vector[1]=e[1]*K;k[2].direction[0]=0;k[2].direction[1]=0;k[2].texCoords[0]=
-1;k[2].texCoords[1]=-1;k[3].vector[0]=h[0]*K;k[3].vector[1]=h[1]*K;k[3].direction[0]=0;k[3].direction[1]=0;k[3].texCoords[0]=-1;k[3].texCoords[1]=1;k[4].vector[0]=d[0];k[4].vector[1]=d[1];k[4].direction[0]=0;k[4].direction[1]=0;k[4].texCoords[0]=0;k[4].texCoords[1]=1;a.vectors.count=5;a.lists[w.CAP].count=4;a.lists[w.CAP].items[0]=1;a.lists[w.CAP].items[1]=2;a.lists[w.CAP].items[2]=3;a.lists[w.CAP].items[3]=4;a.lists[w.ENTRY].count=0;a.lists[w.EXIT].count=3;a.lists[w.EXIT].items[0]=1;a.lists[w.EXIT].items[1]=
0;a.lists[w.EXIT].items[2]=4}else b=g(x[0],d),d=c(x[4],b),e=x[1],f=x[2],h=x[3],e[0]=L*d[0]-J*d[1],e[1]=J*d[0]+L*d[1],f[0]=L*e[0]-J*e[1],f[1]=J*e[0]+L*e[1],h[0]=L*f[0]-J*f[1],h[1]=J*f[0]+L*f[1],f=x[5],f[0]=0,f[1]=0,a.capCenter=0,k=a.vectors.items,k[0].vector[0]=f[0],k[0].vector[1]=f[1],k[0].direction[0]=0,k[0].direction[1]=0,k[0].texCoords[0]=0,k[0].texCoords[1]=0,k[1].vector[0]=d[0],k[1].vector[1]=d[1],k[1].direction[0]=0,k[1].direction[1]=0,k[1].texCoords[0]=0,k[1].texCoords[1]=1,k[2].vector[0]=
e[0]*K,k[2].vector[1]=e[1]*K,k[2].direction[0]=0,k[2].direction[1]=0,k[2].texCoords[0]=1,k[2].texCoords[1]=1,k[3].vector[0]=h[0]*K,k[3].vector[1]=h[1]*K,k[3].direction[0]=0,k[3].direction[1]=0,k[3].texCoords[0]=1,k[3].texCoords[1]=-1,k[4].vector[0]=b[0],k[4].vector[1]=b[1],k[4].direction[0]=0,k[4].direction[1]=0,k[4].texCoords[0]=0,k[4].texCoords[1]=-1,a.vectors.count=5,a.lists[w.CAP].count=4,a.lists[w.CAP].items[0]=1,a.lists[w.CAP].items[1]=2,a.lists[w.CAP].items[2]=3,a.lists[w.CAP].items[3]=4,a.lists[w.ENTRY].count=
3,a.lists[w.ENTRY].items[0]=4,a.lists[w.ENTRY].items[1]=0,a.lists[w.ENTRY].items[2]=1,a.lists[w.EXIT].count=0};a.prototype.fastMiterJoin=function(a,b,d){d=g(x[0],d);b=c(x[1],d);var e=a.vectors.items[0];e.vector[0]=d[0];e.vector[1]=d[1];e.texCoords[0]=0;e.texCoords[1]=-1;e.direction[0]=0;e.direction[1]=0;d=a.vectors.items[1];d.vector[0]=b[0];d.vector[1]=b[1];d.texCoords[0]=0;d.texCoords[1]=1;d.direction[0]=0;d.direction[1]=0;a.vectors.count=2;b=a.lists[w.ENTRY];b.items[0]=0;b.items[1]=1;b.count=2;
b=a.lists[w.EXIT];b.items[0]=0;b.items[1]=1;b.count=2;a.lists[w.CAP].count=0;a.capCenter=void 0};a.prototype.miterJoin=function(a,e,f){var h=g(x[0],e),k=g(x[1],f),l=x[2];l[0]=h[0]+k[0];l[1]=h[1]+k[1];k=n(x[3],l);h=d(k,h);k=b(x[4],k,1/h);h=c(x[5],k);this._distanceAlongCorrection?(l=a.vectors.items[0],l.vector[0]=k[0],l.vector[1]=k[1],l.texCoords[0]=0,l.texCoords[1]=-1,l.direction[0]=e[0],l.direction[1]=e[1],l=a.vectors.items[1],l.vector[0]=h[0],l.vector[1]=h[1],l.texCoords[0]=0,l.texCoords[1]=1,l.direction[0]=
e[0],l.direction[1]=e[1],e=a.vectors.items[2],e.vector[0]=k[0],e.vector[1]=k[1],e.texCoords[0]=0,e.texCoords[1]=-1,e.direction[0]=f[0],e.direction[1]=f[1],e=a.vectors.items[3],e.vector[0]=h[0],e.vector[1]=h[1],e.texCoords[0]=0,e.texCoords[1]=1,e.direction[0]=f[0],e.direction[1]=f[1],a.vectors.count=4,f=a.lists[w.ENTRY],f.items[0]=0,f.items[1]=1,f.count=2,f=a.lists[w.EXIT],f.items[0]=2,f.items[1]=3):(l=a.vectors.items[0],l.vector[0]=k[0],l.vector[1]=k[1],l.texCoords[0]=0,l.texCoords[1]=-1,l.direction[0]=
0,l.direction[1]=0,l=a.vectors.items[1],l.vector[0]=h[0],l.vector[1]=h[1],l.texCoords[0]=0,l.texCoords[1]=1,l.direction[0]=0,l.direction[1]=0,a.vectors.count=2,f=a.lists[w.ENTRY],f.items[0]=0,f.items[1]=1,f.count=2,f=a.lists[w.EXIT],f.items[0]=0,f.items[1]=1);f.count=2;a.lists[w.CAP].count=0;a.capCenter=void 0};a.prototype.bevelJoin=function(a,f,h,k){var m=k*k;k=e(f,h);var q=0<k?[-1,1]:[1,-1],p=q[0],q=q[1],u=0<k?c(x[0],g(x[1],f)):g(x[2],f),v=0<k?c(x[3],g(x[4],h)):g(x[5],h),A=x[6];A[0]=u[0]+v[0];A[1]=
u[1]+v[1];var G=n(x[7],A),C=c(x[8],G),H=d(G,u),A=e(G,u),y=Math.abs(A/H),A=1+y*y,D=A<B?[y,this._distanceAlongCorrection]:[Math.sqrt(B-1),!0],I=D[0],D=D[1],F=A<m?[y,this._distanceAlongCorrection]:[Math.sqrt(m-1),!0],y=F[0];(F=F[1])&&D?(D=a.vectors.items[0],l(D.vector,c(x[9],u),b(x[10],c(x[11],f),I)),D.texCoords[0]=0,D.texCoords[1]=p,D.direction[0]=this._distanceAlongCorrection?f[0]:0,D.direction[1]=this._distanceAlongCorrection?f[1]:0,C=a.vectors.items[1],l(C.vector,c(x[12],v),b(x[13],h,I)),C.texCoords[0]=
0,C.texCoords[1]=p,C.direction[0]=this._distanceAlongCorrection?h[0]:0,C.direction[1]=this._distanceAlongCorrection?h[1]:0,p=a.vectors.items[2],p.vector[0]=0,p.vector[1]=0,p.texCoords[0]=0,p.texCoords[1]=0,p.direction[0]=0,p.direction[1]=0,p=a.vectors.items[3],l(p.vector,u,b(x[14],f,y)),p.texCoords[0]=0,p.texCoords[1]=q,p.direction[0]=this._distanceAlongCorrection?f[0]:0,p.direction[1]=this._distanceAlongCorrection?f[1]:0,f=a.vectors.items[4],l(f.vector,v,b(x[15],c(x[16],h),y)),f.texCoords[0]=0,f.texCoords[1]=
q,f.direction[0]=this._distanceAlongCorrection?h[0]:0,f.direction[1]=this._distanceAlongCorrection?h[1]:0,a.vectors.count=5,h=a.lists[w.ENTRY],h.items[0]=0,h.items[1]=2,h.items[2]=3,h.count=3,h=a.lists[w.EXIT],h.items[0]=1,h.items[1]=2,h.items[2]=4,h.count=3,A<m?(m=a.lists[w.CAP],m.count=0,a.capCenter=void 0):(m=a.lists[w.CAP],m.items[0]=3,m.items[1]=4,m.count=2,a.capCenter=2)):!F&&D?(D=a.vectors.items[0],l(D.vector,c(x[9],u),b(x[10],c(x[11],f),I)),D.texCoords[0]=0,D.texCoords[1]=p,D.direction[0]=
this._distanceAlongCorrection?f[0]:0,D.direction[1]=this._distanceAlongCorrection?f[1]:0,C=a.vectors.items[1],l(C.vector,c(x[12],v),b(x[13],h,I)),C.texCoords[0]=0,C.texCoords[1]=p,C.direction[0]=this._distanceAlongCorrection?h[0]:0,C.direction[1]=this._distanceAlongCorrection?h[1]:0,p=a.vectors.items[2],p.vector[0]=0,p.vector[1]=0,p.texCoords[0]=0,p.texCoords[1]=0,p.direction[0]=0,p.direction[1]=0,p=a.vectors.items[3],b(p.vector,G,1/H),p.texCoords[0]=0,p.texCoords[1]=q,p.direction[0]=0,p.direction[1]=
0,a.vectors.count=4,h=a.lists[w.ENTRY],h.items[0]=0,h.items[1]=2,h.items[2]=3,h.count=3,h=a.lists[w.EXIT],h.items[0]=1,h.items[1]=2,h.items[2]=3,h.count=3,a.lists[w.CAP].count=0,a.capCenter=void 0):F&&!D?(D=a.vectors.items[0],b(D.vector,C,1/H),D.texCoords[0]=0,D.texCoords[1]=p,D.direction[0]=0,D.direction[1]=0,C=a.vectors.items[1],C.vector[0]=0,C.vector[1]=0,C.texCoords[0]=0,C.texCoords[1]=0,C.direction[0]=0,C.direction[1]=0,p=a.vectors.items[2],l(p.vector,u,b(x[9],f,y)),p.texCoords[0]=0,p.texCoords[1]=
q,p.direction[0]=this._distanceAlongCorrection?f[0]:0,p.direction[1]=this._distanceAlongCorrection?f[1]:0,p=a.vectors.items[3],l(p.vector,v,b(x[10],c(x[11],h),y)),p.texCoords[0]=0,p.texCoords[1]=q,p.direction[0]=this._distanceAlongCorrection?h[0]:0,p.direction[1]=this._distanceAlongCorrection?h[1]:0,a.vectors.count=4,h=a.lists[w.ENTRY],h.items[0]=0,h.items[1]=1,h.items[2]=2,h.count=3,h=a.lists[w.EXIT],h.items[0]=0,h.items[1]=1,h.items[2]=3,h.count=3,A<m?(m=a.lists[w.CAP],m.count=0,a.capCenter=void 0):
(m=a.lists[w.CAP],m.items[0]=2,m.items[1]=3,m.count=2,a.capCenter=1)):F||D||(D=a.vectors.items[0],b(D.vector,C,1/H),D.texCoords[0]=0,D.texCoords[1]=p,D.direction[0]=0,D.direction[1]=0,C=a.vectors.items[1],b(C.vector,G,1/H),C.texCoords[0]=0,C.texCoords[1]=q,C.direction[0]=0,C.direction[1]=0,a.vectors.count=2,h=a.lists[w.ENTRY],h.items[0]=0,h.items[1]=1,h.count=2,h=a.lists[w.EXIT],h.items[0]=0,h.items[1]=1,h.count=2,a.lists[w.CAP].count=0,a.capCenter=void 0);0>k&&(z(a.lists[w.ENTRY]),z(a.lists[w.EXIT]))};
a.prototype.roundJoin=function(a,f,h,k){var m=e(f,h),q=0<m?[-1,1]:[1,-1],p=q[0],q=q[1],A=0<m?c(x[0],g(x[1],f)):g(x[2],f),C=0<m?c(x[3],g(x[4],h)):g(x[5],h),G=x[6];G[0]=A[0]+C[0];G[1]=A[1]+C[1];var D=n(x[7],G),G=c(x[8],D),y=d(D,A),D=e(D,A),D=Math.abs(D/y),H=1+D*D<B?[D,this._distanceAlongCorrection]:[Math.sqrt(B-1),!0],D=H[0];H[1]?(H=a.vectors.items[0],H.vector[0]=A[0],H.vector[1]=A[1],H.texCoords[0]=0,H.texCoords[1]=q,H.direction[0]=0,H.direction[1]=0,H=a.vectors.items[1],H.vector[0]=C[0],H.vector[1]=
C[1],H.texCoords[0]=0,H.texCoords[1]=q,H.direction[0]=0,H.direction[1]=0,H=a.vectors.items[2],l(H.vector,c(x[9],A),b(x[10],c(x[11],f),D)),H.texCoords[0]=0,H.texCoords[1]=p,H.direction[0]=this._distanceAlongCorrection?f[0]:0,H.direction[1]=this._distanceAlongCorrection?f[1]:0,f=a.vectors.items[3],l(f.vector,c(x[12],C),b(x[13],h,D)),f.texCoords[0]=0,f.texCoords[1]=p,f.direction[0]=this._distanceAlongCorrection?h[0]:0,f.direction[1]=this._distanceAlongCorrection?h[1]:0,h=a.vectors.items[4],h.vector[0]=
0,h.vector[1]=0,h.texCoords[0]=0,h.texCoords[1]=0,h.direction[0]=0,h.direction[1]=0,a.vectors.count=5,h=a.lists[w.ENTRY],h.items[0]=2,h.items[1]=4,h.items[2]=0,h.count=3,h=a.lists[w.EXIT],h.items[0]=3,h.items[1]=4,h.items[2]=1,h.count=3,a.capCenter=4):(H=a.vectors.items[0],H.vector[0]=A[0],H.vector[1]=A[1],H.texCoords[0]=0,H.texCoords[1]=q,H.direction[0]=0,H.direction[1]=0,H=a.vectors.items[1],H.vector[0]=C[0],H.vector[1]=C[1],H.texCoords[0]=0,H.texCoords[1]=q,H.direction[0]=0,H.direction[1]=0,H=
a.vectors.items[2],b(H.vector,G,1/y),H.texCoords[0]=0,H.texCoords[1]=p,H.direction[0]=0,H.direction[1]=0,f=a.vectors.items[3],f.vector[0]=0,f.vector[1]=0,f.texCoords[0]=0,f.texCoords[1]=0,f.direction[0]=0,f.direction[1]=0,a.vectors.count=4,h=a.lists[w.ENTRY],h.items[0]=2,h.items[1]=3,h.items[2]=0,h.count=3,h=a.lists[w.EXIT],h.items[0]=2,h.items[1]=3,h.items[2]=1,h.count=3,a.capCenter=3);v(u,A,C,k,0>m);k=a.vectors.count;A=a.lists[w.CAP];for(C=A.items[0]=0;C<u.count;++C)h=u.items[C],p=a.vectors.items[k+
C],p.vector[0]=h[0],p.vector[1]=h[1],p.texCoords[0]=0,p.texCoords[1]=q,p.direction[0]=0,p.direction[1]=0,A.items[C+1]=k+C;A.items[u.count+1]=1;A.count=u.count+2;a.vectors.count=k+u.count;0>m&&(z(a.lists[w.ENTRY]),z(a.lists[w.EXIT]))};a.prototype.unitRoundJoin=function(a,b,d,f){var h=e(b,d),k=0<h?[-1,1]:[1,-1],l=k[0],k=k[1];b=0<h?c(x[0],g(x[1],b)):g(x[2],b);d=0<h?c(x[3],g(x[4],d)):g(x[5],d);var m=a.vectors.items[0];m.vector[0]=b[0];m.vector[1]=b[1];m.texCoords[0]=0;m.texCoords[1]=k;m.direction[0]=
0;m.direction[1]=0;m=a.vectors.items[1];m.vector[0]=d[0];m.vector[1]=d[1];m.texCoords[0]=0;m.texCoords[1]=k;m.direction[0]=0;m.direction[1]=0;m=a.vectors.items[2];c(m.vector,b);m.texCoords[0]=0;m.texCoords[1]=l;m.direction[0]=0;m.direction[1]=0;m=a.vectors.items[3];c(m.vector,d);m.texCoords[0]=0;m.texCoords[1]=l;m.direction[0]=0;m.direction[1]=0;l=a.vectors.items[4];l.vector[0]=0;l.vector[1]=0;l.texCoords[0]=0;l.texCoords[1]=0;l.direction[0]=0;l.direction[1]=0;a.vectors.count=5;l=a.lists[w.ENTRY];
l.items[0]=2;l.items[1]=0;l.count=2;l=a.lists[w.EXIT];l.items[0]=3;l.items[1]=1;l.count=2;a.capCenter=4;v(u,b,d,f,0>h);f=a.vectors.count;b=a.lists[w.CAP];for(l=b.items[0]=0;l<u.count;++l)d=u.items[l],m=a.vectors.items[f+l],m.vector[0]=d[0],m.vector[1]=d[1],m.texCoords[0]=0,m.texCoords[1]=k,m.direction[0]=0,m.direction[1]=0,b.items[l+1]=f+l;b.items[u.count+1]=1;b.count=u.count+2;a.vectors.count=f+u.count;0>h&&(z(a.lists[w.ENTRY]),z(a.lists[w.EXIT]))};a.prototype.rectJoin=function(a,b,d){b=g(x[0],b);
d=g(x[1],d);var e=a.vectors.items[0];e.vector[0]=b[0];e.vector[1]=b[1];e.texCoords[0]=0;e.texCoords[1]=-1;e.direction[0]=0;e.direction[1]=0;e=a.vectors.items[1];e.vector[0]=d[0];e.vector[1]=d[1];e.texCoords[0]=0;e.texCoords[1]=-1;e.direction[0]=0;e.direction[1]=0;e=a.vectors.items[2];c(e.vector,b);e.texCoords[0]=0;e.texCoords[1]=1;e.direction[0]=0;e.direction[1]=0;b=a.vectors.items[3];c(b.vector,d);b.texCoords[0]=0;b.texCoords[1]=1;b.direction[0]=0;b.direction[1]=0;a.vectors.count=4;b=a.lists[w.ENTRY];
b.items[0]=0;b.items[1]=2;b.count=2;b=a.lists[w.EXIT];b.items[0]=1;b.items[1]=3;b.count=2;a.capCenter=void 0};return a}();a.Tessellator=h})},"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../color ../../definitions ../../enums ../../enums ../../number ../../WGLDisplayRecord ../../materialKey/MaterialKey ./WGLMeshTemplate".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p,B){Object.defineProperty(a,"__esModule",{value:!0});var F=d.getLogger("esri.views.2d.engine.webgl.WGLMeshTemplate");h=function(a){function d(b,d,f,h,k,l,q,x,w,B,M,P,N){var u=a.call(this)||this;u.geometryType=y.WGLGeometryType.MARKER;if(200<l||200<q)F.error(new m("mapview-oversized-resource","Marker size was clamped to the maximum allowed value of 200x200 pixels")),l>q?(q*=200/l,l=200):(l*=200/q,q=200);var A=c.vec2f32.create(),C=g.mat2df32.create();l=0===
l?0:Math.max(l,2);q=0===q?0:Math.max(q,2);B=(P===v.Alignment.MAP?1:0)|(B?1:0)<<1|(M?1:0)<<2;M=N.sdf?.5:1;n.mat2d.translate(C,C,c.vec2f32.fromValues(M*d,M*-f));h&&n.mat2d.rotate(C,C,3.14159265359/180*h);b=p.MarkerMaterialKey.load(p.createMaterialKey(u.geometryType,b,!1));N&&(b.sdf=N.sdf,b.pattern=!0,b.textureBinding=N.textureBinding);u._materialKey=b.data;u._fillColor=k;u._outlineColor=x;u._sizeOutlineWidth=z.i8888to32(l,q,w,B);k=Math.round(N.rect.x/4)-128;x=Math.round(N.rect.y/4)-128;w=k+Math.round(N.rect.width/
4);N=x+Math.round(N.rect.height/4);e.vec2.set(A,-.5*l,-.5*q);e.vec2.transformMat2d(A,A,C);u._offsetAndTexUpperLeft=z.i8888to32(z.i8(A[0]),z.i8(A[1]),k,x);e.vec2.set(A,.5*l,-.5*q);e.vec2.transformMat2d(A,A,C);u._offsetAndTexUpperRight=z.i8888to32(z.i8(A[0]),z.i8(A[1]),w,x);e.vec2.set(A,-.5*l,.5*q);e.vec2.transformMat2d(A,A,C);u._offsetAndTexBottomLeft=z.i8888to32(z.i8(A[0]),z.i8(A[1]),k,N);e.vec2.set(A,.5*l,.5*q);e.vec2.transformMat2d(A,A,C);u._offsetAndTexBottomRight=z.i8888to32(z.i8(A[0]),z.i8(A[1]),
w,N);u.height=q;u.width=l;u.xOffset=d;u.yOffset=f;return u}f(d,a);d.fromCIMMarker=function(a,c,e){var f=b.premultiplyAlphaRGBA(c.color),g=b.premultiplyAlphaRGBA(c.outlineColor),h=Math.round(k.pt2px(c.size)),l=Math.round(k.pt2px(c.size/e.height*e.width)),m=Math.round(k.pt2px(c.offsetX||0)),n=Math.round(k.pt2px(c.offsetY||0)),q=Math.round(k.pt2px(c.outlineWidth||0));return new d(a,m,n,c.rotation||0,f,l,h,g,q,c.colorLocked,!1,c.alignment||v.Alignment.SCREEN,e)};d.fromPictureMarker=function(a,b,c){var e=
Math.round(k.pt2px(b.width)),f=Math.round(k.pt2px(b.height)),g=l.PICTURE_FILL_COLOR,h=Math.round(k.pt2px(b.xoffset||0)),m=Math.round(k.pt2px(b.yoffset||0));return new d(a,h,m,b.angle,g,e,f,0,0,!1,!1,v.Alignment.SCREEN,c)};d.fromSimpleMarker=function(a,c,e){var f=b.premultiplyAlphaRGBA(c.color),g=Math.round(k.pt2px(c.size)),h=Math.round(k.pt2px(c.xoffset||0)),l=Math.round(k.pt2px(c.yoffset||0)),m=c.style,n=c.outline,q=(n&&n.color&&b.premultiplyAlphaRGBA(n.color))|0,n=(n&&n.width&&Math.round(k.pt2px(n.width)))|
0;return new d(a,h,l,c.angle,f,g,g,q,n,!1,"cross"===m||"x"===m,v.Alignment.SCREEN,e)};d.prototype.writeMesh=function(a,b,c,d,e,f,g,h){f=p.MarkerMaterialKey.load(this._materialKey);var k=b.indexVector,l=b.get("geometry"),m=b.get("visibility"),n=new w(d,this.geometryType,this._materialKey);b=b.getVector("geometry").vertexCount;a.push(n);n.vertexFrom=b;n.indexFrom=k.length;switch(c){case "esriGeometryPoint":c=e.geometry;a=c.x;c=c.y;this._writeVertices(n,l,m,d,this._getPos(a,c),f,g,h);this._writeIndices(n,
k,b);break;case "esriGeometryPolyline":this._writeMany(n,k,l,m,b,d,e.geometry.paths[0],f,g,h);break;case "esriGeometryPolygon":(c=e.centroid)?(a=c.x,c=c.y,this._writeVertices(n,l,m,d,this._getPos(a,c),f,g,h),this._writeIndices(n,k,b)):F.error("Tried to render polygon geometries as markers, but found no centroid!");break;case "esriGeometryMultipoint":this._writeMany(n,k,l,m,b,d,e.geometry.points,f,g,h);break;default:F.error("Unable to handle geometryType: "+c)}};d.prototype._getPos=function(a,b){return z.i1616to32(a,
b)};d.prototype._writeMany=function(a,b,c,d,e,f,g,h,k,l){for(var m=0,n=0,q=0,p=0;p<g.length;p++){var u=g[p],x=u[0],u=u[1],v=this._getPos(x+m,u+n);this._writeVertices(a,c,d,f,v,h,k,l);this._writeIndices(a,b,e+q);m+=x;n+=u;q+=4}};d.prototype._writeVertices=function(a,b,c,d,e,f,g,h){b.push(e);b.push(this._offsetAndTexUpperLeft);b.push(d);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);this._writeVV(b,g,f);c.push(h);b.push(e);b.push(this._offsetAndTexUpperRight);b.push(d);
b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);this._writeVV(b,g,f);c.push(h);b.push(e);b.push(this._offsetAndTexBottomLeft);b.push(d);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);this._writeVV(b,g,f);c.push(h);b.push(e);b.push(this._offsetAndTexBottomRight);b.push(d);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);this._writeVV(b,g,f);c.push(h);a.vertexCount+=4};d.prototype._writeVV=function(a,
b,c){c.hasVV()&&(a.push(b[y.VVType.SIZE]),a.push(b[y.VVType.COLOR]),a.push(b[y.VVType.OPACITY]),a.push(b[y.VVType.ROTATION]))};d.prototype._writeIndices=function(a,b,c){b.push(c+0);b.push(c+1);b.push(c+2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return d}(B.default);a.default=h})},"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":function(){define("require exports ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../symbols ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../cim/cimAnalyzer ./WGLDynamicMarkerTemplate ./WGLFillTemplate ./WGLLineTemplate ./WGLMarkerTemplate ./WGLTextTemplate ../../util/BidiText ../../util/Lock ../../util/Result".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p){function B(a,b){var c=a.length;a.push(null);b.then(function(b){return a[c]=b});return a}function F(a){return!!(a&1)}Object.defineProperty(a,"__esModule",{value:!0});var q=n.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),x=[],u=new d.SimpleFillSymbol({color:"black",outline:null}),A=new d.SimpleMarkerSymbol({size:"14px",color:"black",outline:null}),C=new d.SimpleLineSymbol({color:"black",width:"2px"});a.isDynamicId=F;h=function(){function a(a){this._templateIdCounter=
this._idCounter=0;this._idToTemplateGroup=new Map;this._symbolToTemplate=new Map;this._fetchQueue=[];this._idToResolver=new Map;this._lock=new w.default;this._fetchResource=a}Object.defineProperty(a.prototype,"_markerError",{get:function(){return this._errorTemplates.marker[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_fillError",{get:function(){return this._errorTemplates.fill[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_lineError",{get:function(){return this._errorTemplates.line[0]},
enumerable:!0,configurable:!0});a.prototype.createTemplateGroup=function(a,b,c,d){this._initErrorTemplates();var e=this._hashSymbol(a);if(!this._symbolToTemplate.has(e)){var f=[];b&&this._createMeshTemplates(f,b,c,d,!0);this._createMeshTemplates(f,a,c,d,!1);a=this._createGroupId("cim"===a.type);this._idToTemplateGroup.set(a,f);this._symbolToTemplate.set(e,a)}return this._symbolToTemplate.get(e)};a.prototype.getMosaicItem=function(a){var b=this,c=this._createTemplateId(),d;if("text"===a.type){var e=
z.bidiText(a.text)[0];d=[];for(var f=0;f<e.length;f++)d.push(e.charCodeAt(f))}e=g.create(function(a){return b._idToResolver.set(c,a)});this._fetchQueue.push({symbol:a,id:c,glyphIds:d});return e};a.prototype.getTemplateGroup=function(a){return this._idToTemplateGroup.has(a)?this._idToTemplateGroup.get(a):x};a.prototype.getDynamicTemplateGroup=function(a){if(!this._idToTemplateGroup.has(a))return x;F(a)||q.error("mapview-template-store","Id "+a+" does not refer to a dynamic template");return this._idToTemplateGroup.get(a)};
a.prototype.finalize=function(){return this._fetchQueue.length||this._lock.isHeld()?w.withLock(this._lock,this._fetchAllQueuedResources.bind(this)):g.resolve()};a.prototype._initErrorTemplates=function(){if(!this._errorTemplates){var a=this._createMeshTemplates([],u,null,null,!1),b=this._createMeshTemplates([],A,null,null,!1),c=this._createMeshTemplates([],C,null,null,!1);this._errorTemplates={fill:a,marker:b,line:c}}};a.prototype._fetchAllQueuedResources=function(){var a=this;if(!this._fetchQueue.length)return g.resolve();
var b=this._fetchQueue;this._fetchQueue=[];return this._fetchResource(b).then(function(b){for(var c=0;c<b.length;c++){var d=b[c],e=d.id,d=d.mosaicItem;a._idToResolver.get(e)(d);a._idToResolver.delete(e)}}).catch(function(c){"cancel"===c.dojoType?a._fetchQueue=a._fetchQueue.concat(b):q.error(new k("mapview-template-store","Unable to fetch requested texture resources",c))})};a.prototype._createGroupId=function(a){return this._idCounter++<<1|(a?1:0)};a.prototype._createTemplateId=function(){return this._templateIdCounter++};
a.prototype._getCodepoints=function(a){a=z.bidiText(a.text)[0];for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c));return b};a.prototype._getMosaicItem=function(a){var b=this,c=this._createTemplateId(),d="text"===a.type&&this._getCodepoints(a),e=g.create(function(a){return b._idToResolver.set(c,a)});this._fetchQueue.push({symbol:a.toJSON(),id:c,glyphIds:d});return e};a.prototype._hashSymbol=function(a){return a.id?a.id:JSON.stringify(a)};a.prototype._createSMS=function(a,b){return f(this,void 0,
void 0,function(){var c;return m(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().spriteMosaicItem,p.ok(c,q)?[2,y.default.fromSimpleMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createPMS=function(a,b){return f(this,void 0,void 0,function(){var c;return m(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().spriteMosaicItem,p.ok(c,q)?[2,y.default.fromPictureMarker(b,a,c)]:[2,this._markerError]}})})};
a.prototype._createSFS=function(a,c,d){return f(this,void 0,void 0,function(){var e,f;return m(this,function(g){switch(g.label){case 0:return[4,this._getMosaicItem(a)];case 1:return e=g.sent().spriteMosaicItem,f=a,p.ok(e,q)?[2,b.default.fromSimpleFill(c,f,e,d)]:[2,this._fillError]}})})};a.prototype._createPFS=function(a,c,d){return f(this,void 0,void 0,function(){var e,f;return m(this,function(g){switch(g.label){case 0:return[4,this._getMosaicItem(a)];case 1:return e=g.sent().spriteMosaicItem,f=a,
p.ok(e,q)?[2,b.default.fromPictureFill(c,f,e,d)]:[2,this._fillError]}})})};a.prototype._createSLS=function(a,b,c){return f(this,void 0,void 0,function(){var d,e;return m(this,function(f){switch(f.label){case 0:return[4,this._getMosaicItem(a)];case 1:return d=f.sent().spriteMosaicItem,e=a,p.ok(d,q)?[2,l.default.fromSimpleLine(b,c,e,d)]:[2,this._lineError]}})})};a.prototype._createTS=function(a,b){return f(this,void 0,void 0,function(){var c;return m(this,function(d){switch(d.label){case 0:return[4,
this._getMosaicItem(a)];case 1:return c=d.sent().glyphMosaicItems,[2,v.default.fromText(b,a,c)]}})})};a.prototype._createCIMText=function(a,b){return f(this,void 0,void 0,function(){return m(this,function(a){return[2,g.resolve(null)]})})};a.prototype._createCIMFill=function(a,c){return f(this,void 0,void 0,function(){var d;return m(this,function(e){switch(e.label){case 0:return[4,this.getMosaicItem(a.cim)];case 1:return d=e.sent().spriteMosaicItem,p.ok(d,q)?[2,b.default.fromCIMFill(c,a,d,!1)]:[2,
this._fillError]}})})};a.prototype._createCIMLine=function(a,b){return f(this,void 0,void 0,function(){var c;return m(this,function(d){switch(d.label){case 0:return[4,this.getMosaicItem(a.cim)];case 1:return c=d.sent().spriteMosaicItem,p.ok(c,q)?[2,l.default.fromCIMLine(b,a,c,!1)]:[2,this._lineError]}})})};a.prototype._createCIMMarker=function(a,b){return f(this,void 0,void 0,function(){var d;return m(this,function(e){switch(e.label){case 0:return a.materialHash?[2,g.resolve(c.default.fromCIMMarker(b,
a))]:[4,this.getMosaicItem(a.cim)];case 1:return d=e.sent().spriteMosaicItem,p.ok(d,q)?[2,y.default.fromCIMMarker(b,a,d)]:[2,this._markerError]}})})};a.prototype._createCIM=function(a,b){switch(a.type){case "marker":return this._createCIMMarker(a,b);case "line":return this._createCIMLine(a,b);case "fill":return this._createCIMFill(a,b);case "text":return this._createCIMText(a,b)}};a.prototype._createCIMMeshTemplates=function(a,b,c,d){var f=0;for(b=e.analyzeCIMSymbol(b,d);f<b.length;f++)B(a,this._createCIM(b[f],
c))};a.prototype._createMeshTemplates=function(a,b,c,d,e){if(-1!==b.type.indexOf("3d"))return q.error("3D symbols are not supported with MapView"),a;switch(b.type){case "cim":return this._createCIMMeshTemplates(a,b,c,d),a;case "simple-marker":return B(a,this._createSMS(b,c));case "picture-marker":return B(a,this._createPMS(b,c));case "simple-fill":return B(a,this._createSFS(b,c,e)),b.outline&&B(a,this._createSLS(b.outline,c,!0)),a;case "picture-fill":return B(a,this._createPFS(b,c,e)),b.outline&&
B(a,this._createSLS(b.outline,c,!0)),a;case "simple-line":return B(a,this._createSLS(b,c,!1));case "text":return B(a,this._createTS(b,c));default:return q.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),a}};return a}();a.default=h})},"esri/views/2d/engine/cim/cimAnalyzer":function(){define("require exports ../webgl/CIMSymbolHelper ../webgl/enums ../webgl/SDFHelper ../webgl/Utils".split(" "),function(h,a,f,m,d,k){function n(a){return a?{r:a[0],g:a[1],b:a[2],a:a[3]/
255}:{r:0,g:0,b:0,a:0}}function g(a){switch(a){case "Butt":return m.CapType.BUTT;case "Square":return m.CapType.SQUARE;default:return m.CapType.ROUND}}function e(a){switch(a){case "Bevel":return m.JoinType.BEVEL;case "Miter":return m.JoinType.MITER;default:return m.JoinType.ROUND}}function c(a,c,e,g,h,k){var l=a.markerGraphics;if(l){var m=0;if(a.scaleSymbolsProportionally){var q=a.frame;q&&(m=q.ymax-q.ymin)}for(q=0;q<l.length;q++)if(l[q]){var p=d.getSDFSymbol(a),u=p&&"CIMLineSymbol"===p.type?.5:1;
k.push({type:"marker",materialHash:e?function(a){return"0"}:null,cim:a,colorLocked:a.colorLocked,alignment:h,anchorPoint:a.anchorPoint,size:b(a.primitiveName,"Size",e,c)||a.size,scaleX:1,rotation:b(a.primitiveName,"Rotation",e,c)||a.rotation,offsetX:b(a.primitiveName,"OffsetX",e,c)||a.offsetX,offsetY:b(a.primitiveName,"OffsetY",e,c)||a.offsetY,color:n(f.CIMSymbolHelper.getFillColor(p)),outlineColor:n(f.CIMSymbolHelper.getStrokeColor(p)),outlineWidth:f.CIMSymbolHelper.getStrokeWidth(p)*u,frameHeight:m,
rotateClockwise:a.rotateClockwise,sizeRatio:g?a.size/g:1})}}}function b(a,b,c,d){if(!a)return null;for(var e=0;e<c.length;e++){var f=c[e];if(f.primitiveName===a&&f.propertyName===b&&(f=f.valueExpressionInfo))return k.createArcadeFunction(f.expression,d)}return null}Object.defineProperty(a,"__esModule",{value:!0});a.analyzeCIMSymbol=function(a,d){var h=[],k=a.data.symbol;a=a.data.primitiveOverrides;switch(k.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(k){var l=k.symbolLayers;
if(l){var p,B=f.CIMSymbolHelper.getSize(k);"CIMPointSymbol"===k.type&&"Map"===k.angleAlignment&&(p=m.Alignment.MAP);for(var y=l.length;y--;){var q=l[y];if(q&&!1!==q.enable)switch(q.type){case "CIMSolidFill":h.push({type:"fill",materialHash:null,cim:q,colorLocked:q.colorLocked,color:b(q.primitiveName,"Color",a,d)||n(q.color),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1});break;case "CIMPictureFill":h.push({type:"fill",materialHash:null,cim:q,colorLocked:q.colorLocked,color:b(q.primitiveName,"TintColor",
a,d)||n(q.tintColor),height:b(q.primitiveName,"Height",a,d)||q.height,scaleX:b(q.primitiveName,"ScaleX",a,d)||q.scaleX,angle:b(q.primitiveName,"Rotation",a,d)||q.rotation,offsetX:b(q.primitiveName,"OffsetX",a,d)||q.offsetY,offsetY:b(q.primitiveName,"OffsetY",a,d)||q.offsetY});break;case "CIMSolidStroke":var x=void 0!==q.width?q.width:4;h.push({type:"line",materialHash:null,cim:q,isOutline:"CIMPolygonSymbol"===k.type,colorLocked:q.colorLocked,color:b(q.primitiveName,"Color",a,d)||n(q.color),width:b(q.primitiveName,
"Width",a,d)||x,cap:b(q.primitiveName,"CapStyle",a,d)||g(q.capStyle),join:b(q.primitiveName,"JoinStyle",a,d)||e(q.joinStyle),miterLimit:b(q.primitiveName,"MiterLimit",a,d)||q.miterLimit,sizeRatio:B?x/B:1,isDashed:!1});break;case "CIMPictureStroke":x=void 0!==q.width?q.width:4;h.push({type:"line",materialHash:null,cim:q,isOutline:"CIMPolygonSymbol"===k.type,colorLocked:q.colorLocked,color:b(q.primitiveName,"TintColor",a,d)||n(q.tintColor),width:b(q.primitiveName,"Width",a,d)||x,cap:b(q.primitiveName,
"CapStyle",a,d)||g(q.capStyle),join:b(q.primitiveName,"JoinStyle",a,d)||e(q.joinStyle),miterLimit:b(q.primitiveName,"MiterLimit",a,d)||q.miterLimit,sizeRatio:B?x/B:1,isDashed:!1});break;case "CIMGradientStroke":x=void 0!==q.width?q.width:4;h.push({type:"line",materialHash:null,cim:q,isOutline:"CIMPolygonSymbol"===k.type,colorLocked:q.colorLocked,color:{r:0,g:0,b:0,a:1},width:b(q.primitiveName,"Width",a,d)||x,cap:b(q.primitiveName,"CapStyle",a,d)||g(q.capStyle),join:b(q.primitiveName,"JoinStyle",a,
d)||e(q.joinStyle),miterLimit:b(q.primitiveName,"MiterLimit",a,d)||q.miterLimit,sizeRatio:B?x/B:1,isDashed:!1});break;case "CIMPictureMarker":h.push({type:"marker",materialHash:null,cim:q,colorLocked:q.colorLocked,alignment:p,anchorPoint:q.anchorPoint,size:b(q.primitiveName,"Size",a,d)||q.size,scaleX:b(q.primitiveName,"ScaleX",a,d)||q.scaleX,rotation:b(q.primitiveName,"Rotation",a,d)||q.rotation,offsetX:b(q.primitiveName,"OffsetX",a,d)||q.offsetX,offsetY:b(q.primitiveName,"OffsetY",a,d)||q.offsetY,
color:b(q.primitiveName,"TintColor",a,d)||n(q.tintColor),outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:q.rotateClockwise,sizeRatio:B?q.size/B:1});break;case "CIMVectorMarker":c(q,d,a,B,p,h)}}}}}return h};a.analyzeCIMResource=function(a,b){return b}})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../cim/cimAnalyzer ../../color ../../enums ../../number ../../WGLDisplayRecord ../../materialKey/MaterialKey ./util ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v,z,w,p,B,F){Object.defineProperty(a,"__esModule",{value:!0});var q=3.14159265359/180,x=c.vec2f32.create(),u=g.mat2df32.create(),A=m.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");h=function(a){function g(b,c){var d=a.call(this)||this;d.geometryType=y.WGLGeometryType.MARKER;d.xOffset=0;d.yOffset=0;d.width=0;d.height=0;d._dynamicPropertyMap=new Map;d._cimMarkerLayer=c;var e=0;p.isFunction(c.color)||(e=l.premultiplyAlphaRGBA(c.color));d._dynamicPropertyMap.set("_fillColor",
function(a,b,d){return p.isFunction(c.color)?l.premultiplyAlphaRGBA(c.color(a,b,d)):e});var f=0;p.isFunction(c.outlineColor)||(f=l.premultiplyAlphaRGBA(c.outlineColor));d._dynamicPropertyMap.set("_outlineColor",function(a,b,d){return p.isFunction(c.outlineColor)?l.premultiplyAlphaRGBA(c.outlineColor(a,b,d)):f});var g;p.isFunction(c.size)||(g=k.pt2px(c.size));d._dynamicPropertyMap.set("_size",function(a,b,d){return p.isFunction(c.size)?k.pt2px(c.size(a,b,d)):g});var h;p.isFunction(c.scaleX)||(h=c.scaleX);
d._dynamicPropertyMap.set("_scaleX",function(a,b,d){return p.isFunction(c.scaleX)?c.scaleX(a,b,d):h});var m;p.isFunction(c.offsetX)||(m=k.pt2px(c.offsetX));d._dynamicPropertyMap.set("xOffset",function(a,b,d){return p.isFunction(c.offsetX)?k.pt2px(c.offsetX(a,b,d)):m});var n;p.isFunction(c.offsetY)||(n=k.pt2px(c.offsetY));d._dynamicPropertyMap.set("yOffset",function(a,b,d){return p.isFunction(c.offsetY)?k.pt2px(c.offsetY(a,b,d)):n});var q;p.isFunction(c.outlineWidth)||(q=k.pt2px(c.outlineWidth));d._dynamicPropertyMap.set("_outlineWidth",
function(a,b,d){return p.isFunction(c.outlineWidth)?k.pt2px(c.outlineWidth(a,b,d)):q});var u;p.isFunction(c.rotation)||(u=c.rotation);d._dynamicPropertyMap.set("_angle",function(a,b,d){return p.isFunction(c.rotation)?c.rotation(a,b,d):u});d._colorLockedAndAlignment=(c.alignment===y.Alignment.MAP?1:0)|(c.colorLocked?1:0)<<1;d._materialKey=w.createMaterialKey(d.geometryType,b,!1);return d}f(g,a);g.fromCIMMarker=function(a,b){return new g(a,b)};g.prototype.analyze=function(a,c){var e=this._materialCache,
f=this._cimMarkerLayer.materialHash(a);return e.has(f)?(a=e.get(f),d.resolve(a)):c.getMosaicItem(b.analyzeCIMResource(a,this._cimMarkerLayer.cim)).then(function(a){e.set(f,a);return a})};g.prototype.bindFeature=function(a,b,d){var f=this,g=this._dynamicPropertyMap;g&&g.forEach(function(c,e){f[e]=c(a,b,d)});var h=this._cimMarkerLayer.rotateClockwise?-this._angle:this._angle,g=this._size*this._scaleX,k=this._size,l=this.xOffset,m=this.yOffset,p=this._outlineWidth*(this._cimMarkerLayer.frameHeight?k/
this._cimMarkerLayer.frameHeight:1),z=this._materialCache,A=this._cimMarkerLayer.materialHash(a);if(z=z.get(A))A=1,z&&F.ok(z.spriteMosaicItem)&&(z=z.spriteMosaicItem,this._sizeOutlineWidth=v.i8888to32(g,k,p,this._colorLockedAndAlignment),A=z.sdf?.5:1,n.mat2d.identity(u),n.mat2d.translate(u,u,c.vec2f32.fromValues(A*l,A*-m)),h&&n.mat2d.rotate(u,u,q*h),h=Math.round(z.rect.x/4)-128,l=Math.round(z.rect.y/4)-128,m=h+Math.round(z.rect.width/4),p=l+Math.round(z.rect.height/4),e.vec2.set(x,-.5*g,-.5*k),e.vec2.transformMat2d(x,
x,u),this._offsetAndTexUpperLeft=v.i8888to32(x[0],x[1],h,l),e.vec2.set(x,.5*g,-.5*k),e.vec2.transformMat2d(x,x,u),this._offsetAndTexUpperRight=v.i8888to32(x[0],x[1],m,l),e.vec2.set(x,-.5*g,.5*k),e.vec2.transformMat2d(x,x,u),this._offsetAndTexBottomLeft=v.i8888to32(x[0],x[1],h,p),e.vec2.set(x,.5*g,.5*k),e.vec2.transformMat2d(x,x,u),this._offsetAndTexBottomRight=v.i8888to32(x[0],x[1],m,p),g=w.MarkerMaterialKey.load(this._materialKey),z&&(g.sdf=z.sdf,g.pattern=!0,g.textureBinding=z.textureBinding),this._materialKey=
g.data)};g.prototype.writeMesh=function(a,b,c,d,e,f,g,h){f=w.MarkerMaterialKey.load(this._materialKey);var k=b.indexVector,l=b.get("geometry"),m=b.get("visibility"),n=new z(d,this.geometryType,this._materialKey);b=b.getVector("geometry").vertexCount;a.push(n);n.vertexFrom=b;n.indexFrom=k.length;switch(c){case "esriGeometryPoint":c=e.geometry;a=c.x;c=c.y;this._writeVertices(n,l,m,d,this._getPos(a,c),f,g,h);this._writeIndices(n,k,b);break;case "esriGeometryPolyline":this._writeMany(n,k,l,m,b,d,e.geometry.paths[0],
f,g,h);break;case "esriGeometryPolygon":(c=e.centroid)?(a=c.x,c=c.y,this._writeVertices(n,l,m,d,this._getPos(a,c),f,g,h),this._writeIndices(n,k,b)):A.error("Tried to render polygon geometries as markers, but found no centroid!");break;case "esriGeometryMultipoint":this._writeMany(n,k,l,m,b,d,e.geometry.points,f,g,h);break;default:A.error("Unable to handle geometryType: "+c)}};g.prototype._getPos=function(a,b){return v.i1616to32(a,b)};g.prototype._writeMany=function(a,b,c,d,e,f,g,h,k,l){for(var m=
0,n=0,q=0,p=0;p<g.length;p++){var u=g[p],x=u[0],u=u[1],v=this._getPos(x+m,u+n);this._writeVertices(a,c,d,f,v,h,k,l);this._writeIndices(a,b,e+q);m+=x;n+=u;q+=4}};g.prototype._writeVertices=function(a,b,c,d,e,f,g,h){b.push(e);b.push(this._offsetAndTexUpperLeft);b.push(d);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);this._writeVV(b,g,f);c.push(h);b.push(e);b.push(this._offsetAndTexUpperRight);b.push(d);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);
this._writeVV(b,g,f);c.push(h);b.push(e);b.push(this._offsetAndTexBottomLeft);b.push(d);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);this._writeVV(b,g,f);c.push(h);b.push(e);b.push(this._offsetAndTexBottomRight);b.push(d);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);this._writeVV(b,g,f);c.push(h);a.vertexCount+=4};g.prototype._writeVV=function(a,b,c){c.hasVV()&&(a.push(b[y.VVType.SIZE]),a.push(b[y.VVType.COLOR]),a.push(b[y.VVType.OPACITY]),
a.push(b[y.VVType.ROTATION]))};g.prototype._writeIndices=function(a,b,c){b.push(c+0);b.push(c+1);b.push(c+2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return g}(B.default);a.default=h})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate":function(){define(["require","exports","../../../../../../core/tsSupport/extendsHelper","./WGLMeshTemplate"],function(h,a,f,m){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function d(){var d=a.call(this)||this;d._materialCache=
new Map;return d}f(d,a);return d}(m.default);a.default=h})},"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/earcut/earcut ../../color ../../definitions ../../enums ../../number ../../TileClipper ../../WGLDisplayRecord ../../materialKey/MaterialKey ../Tesselator ./WGLMeshTemplate".split(" "),function(h,a,f,m,d,k,n,
g,e,c,b,l,y,v,z){Object.defineProperty(a,"__esModule",{value:!0});var w=m.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLFillTemplate"),p=[],B=[];h=function(a){function h(c,d,f,h,k,l,m,n,q){var p=a.call(this)||this;p.fillColor=f;p.tl=h;p.br=k;p.aux1=l;p.aux2=m;p.aux3=n;p.isBFS=q;p.geometryType=e.WGLGeometryType.FILL;p.useLibtess=!0;c=y.FillMaterialKey.load(y.createMaterialKey(p.geometryType,c,!1));d&&(c.sdf=d.sdf,c.pattern=!0,c.textureBinding=d.textureBinding);p._materialKey=c.data;p._tesselator=
new v.default;p._tileClipper=new b.TileClipper(0,0,0,1,8);p._tileClipper.setExtent(g.TILE_SIZE);return p}f(h,a);h.fromCIMFill=function(a,b,e,f){void 0===f&&(f=!1);var g=b.color,g=g&&n.premultiplyAlphaRGBA(g)||0,k=c.i8888to32(0,0,0,b.colorLocked?1:0);if(!e)return new h(a,null,g,0,0,0,0,k,f);var k=e.rect,l=e.width,m=e.height,q=k.x+1,p=k.y+1,u=q+l,x=p+m,k=c.nextHighestPowerOfTwo(d.pt2px(b.height||0));255<k?k=255:0>=k&&(k=c.nextHighestPowerOfTwo(x-p));l=c.nextHighestPowerOfTwo(d.pt2px(b.height/m*l||0));
255<l?l=255:0>=l&&(l=c.nextHighestPowerOfTwo(u-q));m=d.pt2px(b.offsetX||0)+128;255<m&&(m=255);var v=d.pt2px(-b.offsetY||0)+128;255<v&&(v=255);b=b.scaleX||1;q=c.i1616to32(q,p);u=c.i1616to32(u,x);k=c.i8888to32(l,k,m,v);b=c.i1616to32(128*b,128);return new h(a,e,g,q,u,k,b,0,f)};h.fromSimpleFill=function(a,b,d,e){void 0===e&&(e=!1);var f=b.color;b=f&&"none"!==b.style&&n.premultiplyAlphaRGBA(f)||0;if(!d)return new h(a,null,b,0,0,0,0,0,e);var f=d.rect,g=f.x+1,k=f.y+1,l=f.x+1+d.width,m=f.y+1+d.height,f=c.i1616to32(g,
k),q=c.i1616to32(l,m),g=c.i8888to32(c.nextHighestPowerOfTwo(l-g),c.nextHighestPowerOfTwo(m-k),0,0),k=c.i1616to32(128,128);return new h(a,d,b,f,q,g,k,0,e)};h.fromPictureFill=function(a,b,e,f){void 0===f&&(f=!1);var k=g.PICTURE_FILL_COLOR,l=e.rect,m=l.x+1,n=l.y+1,l=m+e.width,q=n+e.height,m=c.i1616to32(m,n),l=c.i1616to32(l,q),q=c.nextHighestPowerOfTwo(d.pt2px(b.width));255<q&&(q=255);n=c.nextHighestPowerOfTwo(d.pt2px(b.height));255<n&&(n=255);var p=d.pt2px(b.xoffset)+128;255<p&&(p=255);var u=d.pt2px(-b.yoffset)+
128;255<u&&(u=255);q=c.i8888to32(q,n,p,u);b=c.i1616to32(128*b.xscale,128*b.yscale);return new h(a,e,k,m,l,q,b,0,f)};h.prototype.writeMesh=function(a,b,c,d,e,f,g,h){p.length=0;if("esriGeometryPolygon"!==c)w.error("Unable to handle geometryType: "+c);else{var k=e.geometry;e=this._isClippingRequired(k);var l;l=k.rings;for(var m=0,n=0;n<l.length;n++)for(var q=l[n],u=q[0],x=u[0],u=u[1],v=1;v<q.length;v++)var z=q[v],A=x+z[0],z=u+z[1],m=m-(A-x)*(z+u)/2,x=A,u=z;l=m;k=e?this._clip(k,!this.useLibtess):k.rings;
return this.useLibtess?this._writeMeshLibtess(a,b,c,d,k,e,f,l,g,h):this._writeMeshEarcut(a,b,c,d,k,e,f,g,h)}};h.prototype._isClippingRequired=function(a){var b=g.TILE_SIZE+8,c=0;for(a=a.rings;c<a.length;c++){var d=a[c],e=d.length;if(!(3>e)){var f=d[0][0],h=d[0][1];if(-8>f||f>b||-8>h||h>b)return!0;for(var k=1;k<e;++k)if(f+=d[k][0],h+=d[k][1],-8>f||f>b||-8>h||h>b)return!0}}return!1};h.prototype._clip=function(a,b){var c;this._tileClipper.reset(3);for(var d=0,e=a.rings;d<e.length;d++){var f=e[d],g=f.length;
if(!(3>g)){a=f[0][0];c=f[0][1];this._tileClipper.moveTo(a,c);for(var h=1;h<g;++h)a+=f[h][0],c+=f[h][1],this._tileClipper.lineTo(a,c);this._tileClipper.close()}}return this._tileClipper.result(b)};h.prototype._writeMeshLibtess=function(a,b,c,d,e,f,g,h,k,m){if(e&&e.length){c=[];g=b.indexVector;var n=b.getVector("geometry");b=b.getVector("visibility");var q=new l(d,this.geometryType,this._materialKey),u=y.FillMaterialKey.load(this._materialKey),x=n.vertexCount;q.vertexFrom=x;q.indexFrom=g.length;this._tesselator.beginPolygon(p,
c);for(var v=0;v<e.length;v++){var z=e[v];if(!(3>z.length)){this._tesselator.beginContour();var w=void 0,A=void 0;f?(w=z[0].x,A=z[0].y):(w=z[0][0],A=z[0][1]);var B=[w,A,0];this._tesselator.addVertex(B,B);for(B=1;B<z.length-1;B++){var C=void 0,D=void 0;f?(w=z[B].x,A=z[B].y):(C=z[B][0],D=z[B][1],w+=C,A+=D);C=[w,A,0];this._tesselator.addVertex(C,C)}this._tesselator.endContour()}}this._tesselator.endPolygon();this._writeVerticesLibTess(q,n,b,d,p,u,h,k,m);this._writeIndicesLibTess(q,g,x,c);0<q.indexCount&&
a.push(q)}};h.prototype._writeMeshEarcut=function(a,b,c,d,e,f,g,h,k){if(e&&e.length){c=b.indexVector;g=b.getVector("geometry");b=b.getVector("visibility");var m=new l(d,this.geometryType,this._materialKey),n=y.FillMaterialKey.load(this._materialKey),q=g.vertexCount;m.vertexFrom=q;m.indexFrom=c.length;a.push(m);for(var u=a=0,x=0;x<e.length;x++){var v=e[x],z=u,w=void 0,A=void 0;f?(w=v[0].x,A=v[0].y):(w=v[0][0],A=v[0][1]);p[u++]=w;p[u++]=A;for(var C=0,D=1;D<v.length;++D){var F=void 0,G=void 0;f?(F=w,
G=A,w=v[D].x,A=v[D].y,F=w-F,G=A-G):(F=v[D][0],G=v[D][1],w+=F,A+=G);C-=F*(A+A+G);p[u++]=w;p[u++]=A}0<C?(0<z-a&&(this._write(m,c,g,b,q,d,p,B,a,z,n,h,k),a=z),B.length=0):0>C?0<z-a?B.push(.5*(z-a)):u=z:u=z}0<u-a&&this._write(m,c,g,b,q,d,p,B,a,u,n,h,k);p.length=B.length=0}};h.prototype._write=function(a,b,c,d,e,f,g,h,l,m,n,q,p){e=k(g.slice(l,m),h,2);e.length&&(l=c.vertexCount,this._writeVertices(a,c,d,f,g,h,n,q,p),this._writeIndices(a,b,l,e))};h.prototype._writeVertices=function(a,b,d,e,f,g,h,k,l){for(g=
0;g<f.length;g+=2){var m=c.i1616to32(f[g],f[g+1]);b.data.push(m);b.data.push(e);b.data.push(this.fillColor);b.data.push(this.tl);b.data.push(this.br);b.data.push(this.aux1);b.data.push(this.aux2);b.data.push(this.aux3);this._writeVV(b.data,k,h);d.data.push(l);a.vertexCount++}};h.prototype._writeIndices=function(a,b,c,d){for(var e=0;e<d.length;e+=3)b.push(c+d[e]),b.push(c+d[e+1]),b.push(c+d[e+2]),a.indexCount+=3};h.prototype._writeVerticesLibTess=function(a,b,d,e,f,g,h,k,l){for(var m=0;m<f.length;m+=
2){var n=c.i1616to32(f[m],f[m+1]);b.data.push(n);b.data.push(e);g.dotDensity||(b.data.push(this.fillColor),b.data.push(this.tl),b.data.push(this.br),b.data.push(this.aux1),b.data.push(this.aux2),b.data.push(this.aux3));this._writeVV(b.data,k,g);this._writeDD(b.data,g,k,h);d.data.push(l);a.vertexCount++}};h.prototype._writeIndicesLibTess=function(a,b,c,d){for(var e=0;e<d.length;e++)b.push(c+d[e]),a.indexCount++};h.prototype._writeVV=function(a,b,c){c.hasVV()&&(this.isBFS?(a.writeF32(1E-30),a.writeF32(1E-30)):
(a.push(b[e.VVType.COLOR]),a.push(b[e.VVType.OPACITY])))};h.prototype._writeDD=function(a,b,c,d){c=new Float32Array(c.buffer);d=1/d;b.dotDensity&&(a.writeF32(Math.max(0,c[0]*d)),a.writeF32(Math.max(0,c[1]*d)),a.writeF32(Math.max(0,c[2]*d)),a.writeF32(Math.max(0,c[3]*d)),a.writeF32(Math.max(0,c[4]*d)),a.writeF32(Math.max(0,c[5]*d)),a.writeF32(Math.max(0,c[6]*d)),a.writeF32(Math.max(0,c[7]*d)))};return h}(z.default);a.default=h})},"esri/core/libs/earcut/earcut":function(){define([],function(){function h(b,
c,d){d=d||2;var g=c&&c.length,h=g?c[0]*d:b.length,l=a(b,0,h,d,!0),q=[];if(!l||l.next===l.prev)return q;var p,u,v,x;if(g){var w=d,g=[],B,y,F;x=0;for(B=c.length;x<B;x++)y=c[x]*w,F=x<B-1?c[x+1]*w:b.length,y=a(b,y,F,w,!1),y===y.next&&(y.steiner=!0),g.push(e(y));g.sort(k);for(x=0;x<g.length;x++){c=g[x];w=l;if(w=n(c,w))c=z(w,c),f(c,c.next);l=f(l,l.next)}}if(b.length>80*d){p=v=b[0];u=g=b[1];for(w=d;w<h;w+=d)x=b[w],c=b[w+1],x<p&&(p=x),c<u&&(u=c),x>v&&(v=x),c>g&&(g=c);v=Math.max(v-p,g-u);v=0!==v?1/v:0}m(l,
q,d,p,u,v);return q}function a(a,b,c,d,e){var f;if(e===0<F(a,b,c,d))for(e=b;e<c;e+=d)f=w(e,a[e],a[e+1],f);else for(e=c-d;e>=b;e-=d)f=w(e,a[e],a[e+1],f);f&&l(f,f.next)&&(p(f),f=f.next);return f}function f(a,c){if(!a)return a;c||(c=a);var d;do if(d=!1,a.steiner||!l(a,a.next)&&0!==b(a.prev,a,a.next))a=a.next;else{p(a);a=c=a.prev;if(a===a.next)break;d=!0}while(d||a!==c);return c}function m(a,e,h,k,n,w,B){if(a){if(!B&&w){var q=a,u=q;do null===u.z&&(u.z=g(u.x,u.y,k,n,w)),u.prevZ=u.prev,u=u.nextZ=u.next;
while(u!==q);u.prevZ.nextZ=null;u.prevZ=null;var q=u,x,A,C,F,D,G,T=1;do{u=q;C=q=null;for(F=0;u;){F++;A=u;for(x=D=0;x<T&&(D++,A=A.nextZ,A);x++);for(G=T;0<D||0<G&&A;)0!==D&&(0===G||!A||u.z<=A.z)?(x=u,u=u.nextZ,D--):(x=A,A=A.nextZ,G--),C?C.nextZ=x:q=x,x.prevZ=C,C=x;u=A}C.nextZ=null;T*=2}while(1<F)}for(q=a;a.prev!==a.next;){u=a.prev;A=a.next;if(w)C=d(a,k,n,w);else a:if(C=a,F=C.prev,D=C,T=C.next,0<=b(F,D,T))C=!1;else{for(x=C.next.next;x!==C.prev;){if(c(F.x,F.y,D.x,D.y,T.x,T.y,x.x,x.y)&&0<=b(x.prev,x,x.next)){C=
!1;break a}x=x.next}C=!0}if(C)e.push(u.i/h),e.push(a.i/h),e.push(A.i/h),p(a),q=a=A.next;else if(a=A,a===q){if(!B)m(f(a),e,h,k,n,w,1);else if(1===B){B=e;q=h;u=a;do A=u.prev,C=u.next.next,!l(A,C)&&y(A,u,u.next,C)&&v(A,C)&&v(C,A)&&(B.push(A.i/q),B.push(u.i/q),B.push(C.i/q),p(u),p(u.next),u=a=C),u=u.next;while(u!==a);a=u;m(a,e,h,k,n,w,2)}else if(2===B)a:{B=a;do{for(q=B.next.next;q!==B.prev;){if(u=B.i!==q.i){u=B;A=q;C=void 0;if(C=u.next.i!==A.i&&u.prev.i!==A.i){C=void 0;b:{C=u;do{if(C.i!==u.i&&C.next.i!==
u.i&&C.i!==A.i&&C.next.i!==A.i&&y(C,C.next,u,A)){C=!0;break b}C=C.next}while(C!==u);C=!1}C=!C}F=void 0;if(F=C&&v(u,A)&&v(A,u)){C=u;F=!1;D=(u.x+A.x)/2;A=(u.y+A.y)/2;do C.y>A!==C.next.y>A&&C.next.y!==C.y&&D<(C.next.x-C.x)*(A-C.y)/(C.next.y-C.y)+C.x&&(F=!F),C=C.next;while(C!==u)}u=F}if(u){a=z(B,q);B=f(B,B.next);a=f(a,a.next);m(B,e,h,k,n,w);m(a,e,h,k,n,w);break a}q=q.next}B=B.next}while(B!==a)}break}}}}function d(a,d,e,f){var h=a.prev,k=a.next;if(0<=b(h,a,k))return!1;var l=h.x>a.x?h.x>k.x?h.x:k.x:a.x>
k.x?a.x:k.x,m=h.y>a.y?h.y>k.y?h.y:k.y:a.y>k.y?a.y:k.y,n=g(h.x<a.x?h.x<k.x?h.x:k.x:a.x<k.x?a.x:k.x,h.y<a.y?h.y<k.y?h.y:k.y:a.y<k.y?a.y:k.y,d,e,f);d=g(l,m,d,e,f);e=a.prevZ;for(f=a.nextZ;e&&e.z>=n&&f&&f.z<=d;){if(e!==a.prev&&e!==a.next&&c(h.x,h.y,a.x,a.y,k.x,k.y,e.x,e.y)&&0<=b(e.prev,e,e.next))return!1;e=e.prevZ;if(f!==a.prev&&f!==a.next&&c(h.x,h.y,a.x,a.y,k.x,k.y,f.x,f.y)&&0<=b(f.prev,f,f.next))return!1;f=f.nextZ}for(;e&&e.z>=n;){if(e!==a.prev&&e!==a.next&&c(h.x,h.y,a.x,a.y,k.x,k.y,e.x,e.y)&&0<=b(e.prev,
e,e.next))return!1;e=e.prevZ}for(;f&&f.z<=d;){if(f!==a.prev&&f!==a.next&&c(h.x,h.y,a.x,a.y,k.x,k.y,f.x,f.y)&&0<=b(f.prev,f,f.next))return!1;f=f.nextZ}return!0}function k(a,b){return a.x-b.x}function n(a,b){var d=b,e=a.x,f=a.y,g=-Infinity,h;do{if(f<=d.y&&f>=d.next.y&&d.next.y!==d.y){var k=d.x+(f-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(k<=e&&k>g){g=k;if(k===e){if(f===d.y)return d;if(f===d.next.y)return d.next}h=d.x<d.next.x?d:d.next}}d=d.next}while(d!==b);if(!h)return null;if(e===g)return h.prev;b=h;
for(var k=h.x,l=h.y,m=Infinity,n,d=h.next;d!==b;)e>=d.x&&d.x>=k&&e!==d.x&&c(f<l?e:g,f,k,l,f<l?g:e,f,d.x,d.y)&&(n=Math.abs(f-d.y)/(e-d.x),(n<m||n===m&&d.x>h.x)&&v(d,a)&&(h=d,m=n)),d=d.next;return h}function g(a,b,c,d,e){a=32767*(a-c)*e;b=32767*(b-d)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function e(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}
function c(a,b,c,d,e,f,g,h){return 0<=(e-g)*(b-h)-(a-g)*(f-h)&&0<=(a-g)*(d-h)-(c-g)*(b-h)&&0<=(c-g)*(f-h)-(e-g)*(d-h)}function b(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function l(a,b){return a.x===b.x&&a.y===b.y}function y(a,c,d,e){return l(a,c)&&l(d,e)||l(a,e)&&l(d,c)?!0:0<b(a,c,d)!==0<b(a,c,e)&&0<b(d,e,a)!==0<b(d,e,c)}function v(a,c){return 0>b(a.prev,a,a.next)?0<=b(a,c,a.next)&&0<=b(a,a.prev,c):0>b(a,c,a.prev)||0>b(a,a.next,c)}function z(a,b){var c=new B(a.i,a.x,a.y),d=new B(b.i,
b.x,b.y),e=a.next,f=b.prev;a.next=b;b.prev=a;c.next=e;e.prev=c;d.next=c;c.prev=d;f.next=d;d.prev=f;return d}function w(a,b,c,d){a=new B(a,b,c);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):(a.prev=a,a.next=a);return a}function p(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function B(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function F(a,b,c,d){for(var e=0,f=c-d;b<c;b+=d)e+=
(a[f]-a[b])*(a[b+1]+a[f+1]),f=b;return e}h.deviation=function(a,b,c,d){var e=b&&b.length,f=Math.abs(F(a,0,e?b[0]*c:a.length,c));if(e)for(var e=0,g=b.length;e<g;e++)f-=Math.abs(F(a,b[e]*c,e<g-1?b[e+1]*c:a.length,c));for(e=b=0;e<d.length;e+=3){var g=d[e]*c,h=d[e+1]*c,k=d[e+2]*c;b+=Math.abs((a[g]-a[k])*(a[h+1]-a[g+1])-(a[g]-a[h])*(a[k+1]-a[g+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)};h.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,e=0;e<a.length;e++){for(var f=
0;f<a[e].length;f++)for(var g=0;g<b;g++)c.vertices.push(a[e][f][g]);0<e&&(d+=a[e-1].length,c.holes.push(d))}return c};return h})},"esri/views/2d/engine/webgl/mesh/Tesselator":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/libs/libtess/libtess"],function(h,a,f,m){Object.defineProperty(a,"__esModule",{value:!0});var d=f.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");h=function(){function a(){this._indexCounter=this._currentVertexIndex=0;this._triangleIndices=
[-1,-1,-1];this.glu=new m.GluTesselator;this.glu.gluTessCallback(m.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this));this.glu.gluTessCallback(m.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this));this.glu.gluTessCallback(m.gluEnum.GLU_TESS_END,this._endcallback.bind(this));this.glu.gluTessCallback(m.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this));this.glu.gluTessCallback(m.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this));this.glu.gluTessCallback(m.gluEnum.GLU_TESS_EDGE_FLAG,
this._edgeCallback.bind(this));this.glu.gluTessProperty(m.gluEnum.GLU_TESS_WINDING_RULE,m.windingRule.GLU_TESS_WINDING_ODD)}a.prototype.beginPolygon=function(a,d){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._indexCounter=this._currentVertexIndex=0;this.glu.gluTessBeginPolygon(a);this._indices=d};a.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()};a.prototype.beginContour=function(){this.glu.gluTessBeginContour()};a.prototype.endContour=function(){this.glu.gluTessEndContour()};
a.prototype.addVertex=function(a,d){this.glu.gluTessVertex(a,d)};a.prototype._vertexCallback=function(a,d){d[d.length]=a[0];d[d.length]=a[1];this._triangleIndices[this._currentVertexIndex]=-1;if(2<=this._currentVertexIndex){for(a=0;3>a;a++)-1===this._triangleIndices[a]&&(this._triangleIndices[a]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[a];this._currentVertexIndex=0}else this._currentVertexIndex++};a.prototype._begincallback=function(a){this._triangleIndices[0]=
-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._currentVertexIndex=0};a.prototype._endcallback=function(){this._currentVertexIndex=0};a.prototype._errorcallback=function(a){d.error("Encountered error during tesselation: "+a)};a.prototype._combinecallback=function(a,d,e){return[a[0],a[1],a[2]]};a.prototype._edgeCallback=function(a){};return a}();a.default=h})},"esri/core/libs/libtess/libtess":function(){define([],function(){var h={DEBUG:!1,assert:function(a,f){if(h.DEBUG&&!a)throw Error("Assertion failed"+
(f?": "+f:""));},GLU_TESS_MAX_COORD:1E150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,
GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,
GLU_INVALID_VALUE:100901},geom:{}};h.geom.vertEq=function(a,f){return a.s===f.s&&a.t===f.t};h.geom.vertLeq=function(a,f){return a.s<f.s||a.s===f.s&&a.t<=f.t};h.geom.edgeEval=function(a,f,m){h.assert(h.geom.vertLeq(a,f)&&h.geom.vertLeq(f,m));var d=f.s-a.s,k=m.s-f.s;return 0<d+k?d<k?f.t-a.t+d/(d+k)*(a.t-m.t):f.t-m.t+k/(d+k)*(m.t-a.t):0};h.geom.edgeSign=function(a,f,m){h.assert(h.geom.vertLeq(a,f)&&h.geom.vertLeq(f,m));var d=f.s-a.s,k=m.s-f.s;return 0<d+k?(f.t-m.t)*d+(f.t-a.t)*k:0};h.geom.transLeq=function(a,
f){return a.t<f.t||a.t===f.t&&a.s<=f.s};h.geom.transEval=function(a,f,m){h.assert(h.geom.transLeq(a,f)&&h.geom.transLeq(f,m));var d=f.t-a.t,k=m.t-f.t;return 0<d+k?d<k?f.s-a.s+d/(d+k)*(a.s-m.s):f.s-m.s+k/(d+k)*(m.s-a.s):0};h.geom.transSign=function(a,f,m){h.assert(h.geom.transLeq(a,f)&&h.geom.transLeq(f,m));var d=f.t-a.t,k=m.t-f.t;return 0<d+k?(f.s-m.s)*d+(f.s-a.s)*k:0};h.geom.edgeGoesLeft=function(a){return h.geom.vertLeq(a.dst(),a.org)};h.geom.edgeGoesRight=function(a){return h.geom.vertLeq(a.org,
a.dst())};h.geom.vertL1dist=function(a,f){return Math.abs(a.s-f.s)+Math.abs(a.t-f.t)};h.geom.vertCCW=function(a,f,h){return 0<=a.s*(f.t-h.t)+f.s*(h.t-a.t)+h.s*(a.t-f.t)};h.geom.interpolate_=function(a,f,h,d){a=0>a?0:a;h=0>h?0:h;return a<=h?0===h?(f+d)/2:f+a/(a+h)*(d-f):d+h/(a+h)*(f-d)};h.geom.edgeIntersect=function(a,f,m,d,k){var n,g;h.geom.vertLeq(a,f)||(n=a,a=f,f=n);h.geom.vertLeq(m,d)||(n=m,m=d,d=n);h.geom.vertLeq(a,m)||(n=a,a=m,m=n,n=f,f=d,d=n);h.geom.vertLeq(m,f)?h.geom.vertLeq(f,d)?(n=h.geom.edgeEval(a,
m,f),g=h.geom.edgeEval(m,f,d),0>n+g&&(n=-n,g=-g),k.s=h.geom.interpolate_(n,m.s,g,f.s)):(n=h.geom.edgeSign(a,m,f),g=-h.geom.edgeSign(a,d,f),0>n+g&&(n=-n,g=-g),k.s=h.geom.interpolate_(n,m.s,g,d.s)):k.s=(m.s+f.s)/2;h.geom.transLeq(a,f)||(n=a,a=f,f=n);h.geom.transLeq(m,d)||(n=m,m=d,d=n);h.geom.transLeq(a,m)||(n=a,a=m,m=n,n=f,f=d,d=n);h.geom.transLeq(m,f)?h.geom.transLeq(f,d)?(n=h.geom.transEval(a,m,f),g=h.geom.transEval(m,f,d),0>n+g&&(n=-n,g=-g),k.t=h.geom.interpolate_(n,m.t,g,f.t)):(n=h.geom.transSign(a,
m,f),g=-h.geom.transSign(a,d,f),0>n+g&&(n=-n,g=-g),k.t=h.geom.interpolate_(n,m.t,g,d.t)):k.t=(m.t+f.t)/2};h.mesh={};h.mesh.makeEdge=function(a){var f=h.mesh.makeEdgePair_(a.eHead);h.mesh.makeVertex_(f,a.vHead);h.mesh.makeVertex_(f.sym,a.vHead);h.mesh.makeFace_(f,a.fHead);return f};h.mesh.meshSplice=function(a,f){var m=!1,d=!1;a!==f&&(f.org!==a.org&&(d=!0,h.mesh.killVertex_(f.org,a.org)),f.lFace!==a.lFace&&(m=!0,h.mesh.killFace_(f.lFace,a.lFace)),h.mesh.splice_(f,a),d||(h.mesh.makeVertex_(f,a.org),
a.org.anEdge=a),m||(h.mesh.makeFace_(f,a.lFace),a.lFace.anEdge=a))};h.mesh.deleteEdge=function(a){var f=a.sym,m=!1;a.lFace!==a.rFace()&&(m=!0,h.mesh.killFace_(a.lFace,a.rFace()));a.oNext===a?h.mesh.killVertex_(a.org,null):(a.rFace().anEdge=a.oPrev(),a.org.anEdge=a.oNext,h.mesh.splice_(a,a.oPrev()),m||h.mesh.makeFace_(a,a.lFace));f.oNext===f?(h.mesh.killVertex_(f.org,null),h.mesh.killFace_(f.lFace,null)):(a.lFace.anEdge=f.oPrev(),f.org.anEdge=f.oNext,h.mesh.splice_(f,f.oPrev()));h.mesh.killEdge_(a)};
h.mesh.addEdgeVertex=function(a){var f=h.mesh.makeEdgePair_(a),m=f.sym;h.mesh.splice_(f,a.lNext);f.org=a.dst();h.mesh.makeVertex_(m,f.org);f.lFace=m.lFace=a.lFace;return f};h.mesh.splitEdge=function(a){var f=h.mesh.addEdgeVertex(a).sym;h.mesh.splice_(a.sym,a.sym.oPrev());h.mesh.splice_(a.sym,f);a.sym.org=f.org;f.dst().anEdge=f.sym;f.sym.lFace=a.rFace();f.winding=a.winding;f.sym.winding=a.sym.winding;return f};h.mesh.connect=function(a,f){var m=!1,d=h.mesh.makeEdgePair_(a),k=d.sym;f.lFace!==a.lFace&&
(m=!0,h.mesh.killFace_(f.lFace,a.lFace));h.mesh.splice_(d,a.lNext);h.mesh.splice_(k,f);d.org=a.dst();k.org=f.org;d.lFace=k.lFace=a.lFace;a.lFace.anEdge=k;m||h.mesh.makeFace_(d,a.lFace);return d};h.mesh.zapFace=function(a){var f=a.anEdge,m=f.lNext,d;do if(d=m,m=d.lNext,d.lFace=null,null===d.rFace()){d.oNext===d?h.mesh.killVertex_(d.org,null):(d.org.anEdge=d.oNext,h.mesh.splice_(d,d.oPrev()));var k=d.sym;k.oNext===k?h.mesh.killVertex_(k.org,null):(k.org.anEdge=k.oNext,h.mesh.splice_(k,k.oPrev()));h.mesh.killEdge_(d)}while(d!==
f);f=a.prev;a=a.next;a.prev=f;f.next=a};h.mesh.meshUnion=function(a,f){var h=a.fHead,d=a.vHead,k=a.eHead,n=f.fHead,g=f.vHead;f=f.eHead;n.next!==n&&(h.prev.next=n.next,n.next.prev=h.prev,n.prev.next=h,h.prev=n.prev);g.next!==g&&(d.prev.next=g.next,g.next.prev=d.prev,g.prev.next=d,d.prev=g.prev);f.next!==f&&(k.sym.next.sym.next=f.next,f.next.sym.next=k.sym.next,f.sym.next.sym.next=k,k.sym.next=f.sym.next);return a};h.mesh.deleteMesh=function(a){};h.mesh.makeEdgePair_=function(a){var f=new h.GluHalfEdge,
m=new h.GluHalfEdge,d=a.sym.next;m.next=d;d.sym.next=f;f.next=a;a.sym.next=m;f.sym=m;f.oNext=f;f.lNext=m;m.sym=f;m.oNext=m;return m.lNext=f};h.mesh.splice_=function(a,f){var h=a.oNext,d=f.oNext;h.sym.lNext=f;d.sym.lNext=a;a.oNext=d;f.oNext=h};h.mesh.makeVertex_=function(a,f){var m=f.prev,d=new h.GluVertex(f,m);m.next=d;f.prev=d;f=d.anEdge=a;do f.org=d,f=f.oNext;while(f!==a)};h.mesh.makeFace_=function(a,f){var m=f.prev,d=new h.GluFace(f,m);m.next=d;f.prev=d;d.anEdge=a;d.inside=f.inside;f=a;do f.lFace=
d,f=f.lNext;while(f!==a)};h.mesh.killEdge_=function(a){var f=a.next;a=a.sym.next;f.sym.next=a;a.sym.next=f};h.mesh.killVertex_=function(a,f){var h=a.anEdge,d=h;do d.org=f,d=d.oNext;while(d!==h);f=a.prev;a=a.next;a.prev=f;f.next=a};h.mesh.killFace_=function(a,f){var h=a.anEdge,d=h;do d.lFace=f,d=d.lNext;while(d!==h);f=a.prev;a=a.next;a.prev=f;f.next=a};h.normal={};h.normal.S_UNIT_X_=1;h.normal.S_UNIT_Y_=0;h.normal.projectPolygon=function(a,f,m,d){var k=!1,n=[f,m,d];0===f&&0===m&&0===d&&(h.normal.computeNormal_(a,
n),k=!0);m=h.normal.longAxis_(n);f=a.mesh.vHead;if(h.TRUE_PROJECT){h.normal.normalize_(n);d=[0,0,0];var g=[0,0,0];d[m]=0;d[(m+1)%3]=h.normal.S_UNIT_X_;d[(m+2)%3]=h.normal.S_UNIT_Y_;m=h.normal.dot_(d,n);d[0]-=m*n[0];d[1]-=m*n[1];d[2]-=m*n[2];h.normal.normalize_(d);g[0]=n[1]*d[2]-n[2]*d[1];g[1]=n[2]*d[0]-n[0]*d[2];g[2]=n[0]*d[1]-n[1]*d[0];h.normal.normalize_(g);for(n=f.next;n!==f;n=n.next)n.s=h.normal.dot_(n.coords,d),n.t=h.normal.dot_(n.coords,g)}else for(d=(m+1)%3,g=(m+2)%3,m=0<n[m]?1:-1,n=f.next;n!==
f;n=n.next)n.s=n.coords[d],n.t=m*n.coords[g];k&&h.normal.checkOrientation_(a)};h.normal.dot_=function(a,f){return a[0]*f[0]+a[1]*f[1]+a[2]*f[2]};h.normal.normalize_=function(a){var f=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];h.assert(0<f);f=Math.sqrt(f);a[0]/=f;a[1]/=f;a[2]/=f};h.normal.longAxis_=function(a){var f=0;Math.abs(a[1])>Math.abs(a[0])&&(f=1);Math.abs(a[2])>Math.abs(a[f])&&(f=2);return f};h.normal.computeNormal_=function(a,f){var m=[-2*h.GLU_TESS_MAX_COORD,-2*h.GLU_TESS_MAX_COORD,-2*h.GLU_TESS_MAX_COORD],
d=[2*h.GLU_TESS_MAX_COORD,2*h.GLU_TESS_MAX_COORD,2*h.GLU_TESS_MAX_COORD],k=[],n=[],g;a=a.mesh.vHead;for(g=a.next;g!==a;g=g.next)for(var e=0;3>e;++e){var c=g.coords[e];c<d[e]&&(d[e]=c,n[e]=g);c>m[e]&&(m[e]=c,k[e]=g)}g=0;m[1]-d[1]>m[0]-d[0]&&(g=1);m[2]-d[2]>m[g]-d[g]&&(g=2);if(d[g]>=m[g])f[0]=0,f[1]=0,f[2]=1;else{m=0;d=n[g];k=k[g];n=[0,0,0];d=[d.coords[0]-k.coords[0],d.coords[1]-k.coords[1],d.coords[2]-k.coords[2]];e=[0,0,0];for(g=a.next;g!==a;g=g.next)e[0]=g.coords[0]-k.coords[0],e[1]=g.coords[1]-
k.coords[1],e[2]=g.coords[2]-k.coords[2],n[0]=d[1]*e[2]-d[2]*e[1],n[1]=d[2]*e[0]-d[0]*e[2],n[2]=d[0]*e[1]-d[1]*e[0],c=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],c>m&&(m=c,f[0]=n[0],f[1]=n[1],f[2]=n[2]);0>=m&&(f[0]=f[1]=f[2]=0,f[h.normal.longAxis_(d)]=1)}};h.normal.checkOrientation_=function(a){for(var f=0,h=a.mesh.fHead,d=h.next;d!==h;d=d.next){var k=d.anEdge;if(!(0>=k.winding)){do f+=(k.org.s-k.dst().s)*(k.org.t+k.dst().t),k=k.lNext;while(k!==d.anEdge)}}if(0>f)for(a=a.mesh.vHead,f=a.next;f!==a;f=f.next)f.t=-f.t};
h.render={};h.render.renderMesh=function(a,f,m){for(var d=!1,k=-1,n=f.fHead.prev;n!==f.fHead;n=n.prev)if(n.inside){d||(a.callBeginCallback(h.primitiveType.GL_TRIANGLES),d=!0);var g=n.anEdge;h.assert(g.lNext.lNext.lNext===g,"renderMesh called with non-triangulated mesh");do{if(m){var e=g.rFace().inside?0:1;k!==e&&(k=e,a.callEdgeFlagCallback(!!k))}a.callVertexCallback(g.org.data);g=g.lNext}while(g!==n.anEdge)}d&&a.callEndCallback()};h.render.renderBoundary=function(a,f){for(var m=f.fHead.next;m!==f.fHead;m=
m.next)if(m.inside){a.callBeginCallback(h.primitiveType.GL_LINE_LOOP);var d=m.anEdge;do a.callVertexCallback(d.org.data),d=d.lNext;while(d!==m.anEdge);a.callEndCallback()}};h.sweep={};h.sweep.SENTINEL_COORD_=4*h.GLU_TESS_MAX_COORD;h.sweep.TOLERANCE_NONZERO_=!1;h.sweep.computeInterior=function(a){a.fatalError=!1;h.sweep.removeDegenerateEdges_(a);h.sweep.initPriorityQ_(a);h.sweep.initEdgeDict_(a);for(var f;null!==(f=a.pq.extractMin());){for(;;){var m=a.pq.minimum();if(null===m||!h.geom.vertEq(m,f))break;
m=a.pq.extractMin();h.sweep.spliceMergeVertices_(a,f.anEdge,m.anEdge)}h.sweep.sweepEvent_(a,f)}f=a.dict.getMin().getKey();a.event=f.eUp.org;h.sweep.doneEdgeDict_(a);h.sweep.donePriorityQ_(a);h.sweep.removeDegenerateFaces_(a.mesh);a.mesh.checkMesh()};h.sweep.addWinding_=function(a,f){a.winding+=f.winding;a.sym.winding+=f.sym.winding};h.sweep.edgeLeq_=function(a,f,m){a=a.event;f=f.eUp;m=m.eUp;if(f.dst()===a)return m.dst()===a?h.geom.vertLeq(f.org,m.org)?0>=h.geom.edgeSign(m.dst(),f.org,m.org):0<=h.geom.edgeSign(f.dst(),
m.org,f.org):0>=h.geom.edgeSign(m.dst(),a,m.org);if(m.dst()===a)return 0<=h.geom.edgeSign(f.dst(),a,f.org);f=h.geom.edgeEval(f.dst(),a,f.org);a=h.geom.edgeEval(m.dst(),a,m.org);return f>=a};h.sweep.deleteRegion_=function(a,f){f.fixUpperEdge&&h.assert(0===f.eUp.winding);f.eUp.activeRegion=null;a.dict.deleteNode(f.nodeUp);f.nodeUp=null};h.sweep.fixUpperEdge_=function(a,f){h.assert(a.fixUpperEdge);h.mesh.deleteEdge(a.eUp);a.fixUpperEdge=!1;a.eUp=f;f.activeRegion=a};h.sweep.topLeftRegion_=function(a){var f=
a.eUp.org;do a=a.regionAbove();while(a.eUp.org===f);a.fixUpperEdge&&(f=h.mesh.connect(a.regionBelow().eUp.sym,a.eUp.lNext),h.sweep.fixUpperEdge_(a,f),a=a.regionAbove());return a};h.sweep.topRightRegion_=function(a){var f=a.eUp.dst();do a=a.regionAbove();while(a.eUp.dst()===f);return a};h.sweep.addRegionBelow_=function(a,f,m){var d=new h.ActiveRegion;d.eUp=m;d.nodeUp=a.dict.insertBefore(f.nodeUp,d);return m.activeRegion=d};h.sweep.isWindingInside_=function(a,f){switch(a.windingRule){case h.windingRule.GLU_TESS_WINDING_ODD:return 0!==
(f&1);case h.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==f;case h.windingRule.GLU_TESS_WINDING_POSITIVE:return 0<f;case h.windingRule.GLU_TESS_WINDING_NEGATIVE:return 0>f;case h.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return 2<=f||-2>=f}h.assert(!1);return!1};h.sweep.computeWinding_=function(a,f){f.windingNumber=f.regionAbove().windingNumber+f.eUp.winding;f.inside=h.sweep.isWindingInside_(a,f.windingNumber)};h.sweep.finishRegion_=function(a,f){var m=f.eUp,d=m.lFace;d.inside=f.inside;d.anEdge=
m;h.sweep.deleteRegion_(a,f)};h.sweep.finishLeftRegions_=function(a,f,m){var d=f;for(f=f.eUp;d!==m;){d.fixUpperEdge=!1;var k=d.regionBelow(),n=k.eUp;if(n.org!==f.org){if(!k.fixUpperEdge){h.sweep.finishRegion_(a,d);break}n=h.mesh.connect(f.lPrev(),n.sym);h.sweep.fixUpperEdge_(k,n)}f.oNext!==n&&(h.mesh.meshSplice(n.oPrev(),n),h.mesh.meshSplice(f,n));h.sweep.finishRegion_(a,d);f=k.eUp;d=k}return f};h.sweep.addRightEdges_=function(a,f,m,d,k,n){var g=!0;do h.assert(h.geom.vertLeq(m.org,m.dst())),h.sweep.addRegionBelow_(a,
f,m.sym),m=m.oNext;while(m!==d);for(null===k&&(k=f.regionBelow().eUp.rPrev());;){d=f.regionBelow();m=d.eUp.sym;if(m.org!==k.org)break;m.oNext!==k&&(h.mesh.meshSplice(m.oPrev(),m),h.mesh.meshSplice(k.oPrev(),m));d.windingNumber=f.windingNumber-m.winding;d.inside=h.sweep.isWindingInside_(a,d.windingNumber);f.dirty=!0;!g&&h.sweep.checkForRightSplice_(a,f)&&(h.sweep.addWinding_(m,k),h.sweep.deleteRegion_(a,f),h.mesh.deleteEdge(k));g=!1;f=d;k=m}f.dirty=!0;h.assert(f.windingNumber-m.winding===d.windingNumber);
n&&h.sweep.walkDirtyRegions_(a,f)};h.sweep.callCombine_=function(a,f,m,d,k){var n=[f.coords[0],f.coords[1],f.coords[2]];f.data=null;f.data=a.callCombineCallback(n,m,d);null===f.data&&(k?a.fatalError||(a.callErrorCallback(h.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),a.fatalError=!0):f.data=m[0])};h.sweep.spliceMergeVertices_=function(a,f,m){var d=[null,null,null,null];d[0]=f.org.data;d[1]=m.org.data;h.sweep.callCombine_(a,f.org,d,[.5,.5,0,0],!1);h.mesh.meshSplice(f,m)};h.sweep.vertexWeights_=function(a,
f,m,d,k){var n=h.geom.vertL1dist(f,a),g=h.geom.vertL1dist(m,a),e=k+1;d[k]=.5*g/(n+g);d[e]=.5*n/(n+g);a.coords[0]+=d[k]*f.coords[0]+d[e]*m.coords[0];a.coords[1]+=d[k]*f.coords[1]+d[e]*m.coords[1];a.coords[2]+=d[k]*f.coords[2]+d[e]*m.coords[2]};h.sweep.getIntersectData_=function(a,f,m,d,k,n){var g=[0,0,0,0],e=[m.data,d.data,k.data,n.data];f.coords[0]=f.coords[1]=f.coords[2]=0;h.sweep.vertexWeights_(f,m,d,g,0);h.sweep.vertexWeights_(f,k,n,g,2);h.sweep.callCombine_(a,f,e,g,!0)};h.sweep.checkForRightSplice_=
function(a,f){var m=f.regionBelow(),d=f.eUp,k=m.eUp;if(h.geom.vertLeq(d.org,k.org)){if(0<h.geom.edgeSign(k.dst(),d.org,k.org))return!1;h.geom.vertEq(d.org,k.org)?d.org!==k.org&&(a.pq.remove(d.org.pqHandle),h.sweep.spliceMergeVertices_(a,k.oPrev(),d)):(h.mesh.splitEdge(k.sym),h.mesh.meshSplice(d,k.oPrev()),f.dirty=m.dirty=!0)}else{if(0>h.geom.edgeSign(d.dst(),k.org,d.org))return!1;f.regionAbove().dirty=f.dirty=!0;h.mesh.splitEdge(d.sym);h.mesh.meshSplice(k.oPrev(),d)}return!0};h.sweep.checkForLeftSplice_=
function(a,f){var m=f.regionBelow();a=f.eUp;var d=m.eUp;h.assert(!h.geom.vertEq(a.dst(),d.dst()));if(h.geom.vertLeq(a.dst(),d.dst())){if(0>h.geom.edgeSign(a.dst(),d.dst(),a.org))return!1;f.regionAbove().dirty=f.dirty=!0;m=h.mesh.splitEdge(a);h.mesh.meshSplice(d.sym,m);m.lFace.inside=f.inside}else{if(0<h.geom.edgeSign(d.dst(),a.dst(),d.org))return!1;f.dirty=m.dirty=!0;m=h.mesh.splitEdge(d);h.mesh.meshSplice(a.lNext,d.sym);m.rFace().inside=f.inside}return!0};h.sweep.checkForIntersect_=function(a,f){var m=
f.regionBelow(),d=f.eUp,k=m.eUp,n=d.org,g=k.org,e=d.dst(),c=k.dst(),b=new h.GluVertex;h.assert(!h.geom.vertEq(c,e));h.assert(0>=h.geom.edgeSign(e,a.event,n));h.assert(0<=h.geom.edgeSign(c,a.event,g));h.assert(n!==a.event&&g!==a.event);h.assert(!f.fixUpperEdge&&!m.fixUpperEdge);if(n===g||Math.min(n.t,e.t)>Math.max(g.t,c.t))return!1;if(h.geom.vertLeq(n,g)){if(0<h.geom.edgeSign(c,n,g))return!1}else if(0>h.geom.edgeSign(e,g,n))return!1;h.geom.edgeIntersect(e,n,c,g,b);h.assert(Math.min(n.t,e.t)<=b.t);
h.assert(b.t<=Math.max(g.t,c.t));h.assert(Math.min(c.s,e.s)<=b.s);h.assert(b.s<=Math.max(g.s,n.s));h.geom.vertLeq(b,a.event)&&(b.s=a.event.s,b.t=a.event.t);var l=h.geom.vertLeq(n,g)?n:g;h.geom.vertLeq(l,b)&&(b.s=l.s,b.t=l.t);if(h.geom.vertEq(b,n)||h.geom.vertEq(b,g))return h.sweep.checkForRightSplice_(a,f),!1;if(!h.geom.vertEq(e,a.event)&&0<=h.geom.edgeSign(e,a.event,b)||!h.geom.vertEq(c,a.event)&&0>=h.geom.edgeSign(c,a.event,b)){if(c===a.event)return h.mesh.splitEdge(d.sym),h.mesh.meshSplice(k.sym,
d),f=h.sweep.topLeftRegion_(f),d=f.regionBelow().eUp,h.sweep.finishLeftRegions_(a,f.regionBelow(),m),h.sweep.addRightEdges_(a,f,d.oPrev(),d,d,!0),!0;if(e===a.event)return h.mesh.splitEdge(k.sym),h.mesh.meshSplice(d.lNext,k.oPrev()),m=f,f=h.sweep.topRightRegion_(f),n=f.regionBelow().eUp.rPrev(),m.eUp=k.oPrev(),k=h.sweep.finishLeftRegions_(a,m,null),h.sweep.addRightEdges_(a,f,k.oNext,d.rPrev(),n,!0),!0;0<=h.geom.edgeSign(e,a.event,b)&&(f.regionAbove().dirty=f.dirty=!0,h.mesh.splitEdge(d.sym),d.org.s=
a.event.s,d.org.t=a.event.t);0>=h.geom.edgeSign(c,a.event,b)&&(f.dirty=m.dirty=!0,h.mesh.splitEdge(k.sym),k.org.s=a.event.s,k.org.t=a.event.t);return!1}h.mesh.splitEdge(d.sym);h.mesh.splitEdge(k.sym);h.mesh.meshSplice(k.oPrev(),d);d.org.s=b.s;d.org.t=b.t;d.org.pqHandle=a.pq.insert(d.org);h.sweep.getIntersectData_(a,d.org,n,e,g,c);f.regionAbove().dirty=f.dirty=m.dirty=!0;return!1};h.sweep.walkDirtyRegions_=function(a,f){for(var m=f.regionBelow();;){for(;m.dirty;)f=m,m=m.regionBelow();if(!f.dirty&&
(m=f,f=f.regionAbove(),null===f||!f.dirty))break;f.dirty=!1;var d=f.eUp,k=m.eUp;d.dst()!==k.dst()&&h.sweep.checkForLeftSplice_(a,f)&&(m.fixUpperEdge?(h.sweep.deleteRegion_(a,m),h.mesh.deleteEdge(k),m=f.regionBelow(),k=m.eUp):f.fixUpperEdge&&(h.sweep.deleteRegion_(a,f),h.mesh.deleteEdge(d),f=m.regionAbove(),d=f.eUp));if(d.org!==k.org)if(d.dst()===k.dst()||f.fixUpperEdge||m.fixUpperEdge||d.dst()!==a.event&&k.dst()!==a.event)h.sweep.checkForRightSplice_(a,f);else if(h.sweep.checkForIntersect_(a,f))break;
d.org===k.org&&d.dst()===k.dst()&&(h.sweep.addWinding_(k,d),h.sweep.deleteRegion_(a,f),h.mesh.deleteEdge(d),f=m.regionAbove())}};h.sweep.connectRightVertex_=function(a,f,m){var d=m.oNext,k=f.regionBelow(),n=f.eUp,g=k.eUp,e=!1;n.dst()!==g.dst()&&h.sweep.checkForIntersect_(a,f);h.geom.vertEq(n.org,a.event)&&(h.mesh.meshSplice(d.oPrev(),n),f=h.sweep.topLeftRegion_(f),d=f.regionBelow().eUp,h.sweep.finishLeftRegions_(a,f.regionBelow(),k),e=!0);h.geom.vertEq(g.org,a.event)&&(h.mesh.meshSplice(m,g.oPrev()),
m=h.sweep.finishLeftRegions_(a,k,null),e=!0);e?h.sweep.addRightEdges_(a,f,m.oNext,d,d,!0):(d=h.geom.vertLeq(g.org,n.org)?g.oPrev():n,d=h.mesh.connect(m.lPrev(),d),h.sweep.addRightEdges_(a,f,d,d.oNext,d.oNext,!1),d.sym.activeRegion.fixUpperEdge=!0,h.sweep.walkDirtyRegions_(a,f))};h.sweep.connectLeftDegenerate_=function(a,f,m){var d=f.eUp;if(h.geom.vertEq(d.org,m))h.assert(h.sweep.TOLERANCE_NONZERO_),h.sweep.TOLERANCE_NONZERO_&&h.sweep.spliceMergeVertices_(a,d,m.anEdge);else if(h.geom.vertEq(d.dst(),
m)){if(h.assert(h.sweep.TOLERANCE_NONZERO_),h.sweep.TOLERANCE_NONZERO_){f=h.sweep.topRightRegion_(f);var d=f.regionBelow(),k=d.eUp.sym,n=k.oNext,g=n;d.fixUpperEdge&&(h.assert(n!==k),h.sweep.deleteRegion_(a,d),h.mesh.deleteEdge(k),k=n.oPrev());h.mesh.meshSplice(m.anEdge,k);h.geom.edgeGoesLeft(n)||(n=null);h.sweep.addRightEdges_(a,f,k.oNext,g,n,!0)}}else h.mesh.splitEdge(d.sym),f.fixUpperEdge&&(h.mesh.deleteEdge(d.oNext),f.fixUpperEdge=!1),h.mesh.meshSplice(m.anEdge,d),h.sweep.sweepEvent_(a,m)};h.sweep.connectLeftVertex_=
function(a,f){var m=new h.ActiveRegion;m.eUp=f.anEdge.sym;var m=a.dict.search(m).getKey(),d=m.regionBelow(),k=m.eUp,n=d.eUp;0===h.geom.edgeSign(k.dst(),f,k.org)?h.sweep.connectLeftDegenerate_(a,m,f):(d=h.geom.vertLeq(n.dst(),k.dst())?m:d,m.inside||d.fixUpperEdge?(k=d===m?h.mesh.connect(f.anEdge.sym,k.lNext):h.mesh.connect(n.dNext(),f.anEdge).sym,d.fixUpperEdge?h.sweep.fixUpperEdge_(d,k):h.sweep.computeWinding_(a,h.sweep.addRegionBelow_(a,m,k)),h.sweep.sweepEvent_(a,f)):h.sweep.addRightEdges_(a,m,
f.anEdge,f.anEdge,null,!0))};h.sweep.sweepEvent_=function(a,f){a.event=f;for(var m=f.anEdge;null===m.activeRegion;)if(m=m.oNext,m===f.anEdge){h.sweep.connectLeftVertex_(a,f);return}f=h.sweep.topLeftRegion_(m.activeRegion);var d=f.regionBelow(),m=d.eUp,d=h.sweep.finishLeftRegions_(a,d,null);d.oNext===m?h.sweep.connectRightVertex_(a,f,d):h.sweep.addRightEdges_(a,f,d.oNext,m,m,!0)};h.sweep.addSentinel_=function(a,f){var m=new h.ActiveRegion,d=h.mesh.makeEdge(a.mesh);d.org.s=h.sweep.SENTINEL_COORD_;d.org.t=
f;d.dst().s=-h.sweep.SENTINEL_COORD_;d.dst().t=f;a.event=d.dst();m.eUp=d;m.windingNumber=0;m.inside=!1;m.fixUpperEdge=!1;m.sentinel=!0;m.dirty=!1;m.nodeUp=a.dict.insert(m)};h.sweep.initEdgeDict_=function(a){a.dict=new h.Dict(a,h.sweep.edgeLeq_);h.sweep.addSentinel_(a,-h.sweep.SENTINEL_COORD_);h.sweep.addSentinel_(a,h.sweep.SENTINEL_COORD_)};h.sweep.doneEdgeDict_=function(a){for(var f=0,m;null!==(m=a.dict.getMin().getKey());)m.sentinel||(h.assert(m.fixUpperEdge),h.assert(1===++f)),h.assert(0===m.windingNumber),
h.sweep.deleteRegion_(a,m);a.dict=null};h.sweep.removeDegenerateEdges_=function(a){for(var f=a.mesh.eHead,m,d=f.next;d!==f;d=m){m=d.next;var k=d.lNext;h.geom.vertEq(d.org,d.dst())&&d.lNext.lNext!==d&&(h.sweep.spliceMergeVertices_(a,k,d),h.mesh.deleteEdge(d),d=k,k=d.lNext);if(k.lNext===d){if(k!==d){if(k===m||k===m.sym)m=m.next;h.mesh.deleteEdge(k)}if(d===m||d===m.sym)m=m.next;h.mesh.deleteEdge(d)}}};h.sweep.initPriorityQ_=function(a){var f=new h.PriorityQ;a.pq=f;a=a.mesh.vHead;var m;for(m=a.next;m!==
a;m=m.next)m.pqHandle=f.insert(m);f.init()};h.sweep.donePriorityQ_=function(a){a.pq.deleteQ();a.pq=null};h.sweep.removeDegenerateFaces_=function(a){for(var f,m=a.fHead.next;m!==a.fHead;m=f)f=m.next,m=m.anEdge,h.assert(m.lNext!==m),m.lNext.lNext===m&&(h.sweep.addWinding_(m.oNext,m),h.mesh.deleteEdge(m))};h.tessmono={};h.tessmono.tessellateMonoRegion_=function(a){a=a.anEdge;for(h.assert(a.lNext!==a&&a.lNext.lNext!==a);h.geom.vertLeq(a.dst(),a.org);a=a.lPrev());for(;h.geom.vertLeq(a.org,a.dst());a=a.lNext);
for(var f=a.lPrev(),m;a.lNext!==f;)if(h.geom.vertLeq(a.dst(),f.org)){for(;f.lNext!==a&&(h.geom.edgeGoesLeft(f.lNext)||0>=h.geom.edgeSign(f.org,f.dst(),f.lNext.dst()));)m=h.mesh.connect(f.lNext,f),f=m.sym;f=f.lPrev()}else{for(;f.lNext!==a&&(h.geom.edgeGoesRight(a.lPrev())||0<=h.geom.edgeSign(a.dst(),a.org,a.lPrev().org));)m=h.mesh.connect(a,a.lPrev()),a=m.sym;a=a.lNext}for(h.assert(f.lNext!==a);f.lNext.lNext!==a;)m=h.mesh.connect(f.lNext,f),f=m.sym};h.tessmono.tessellateInterior=function(a){for(var f,
m=a.fHead.next;m!==a.fHead;m=f)f=m.next,m.inside&&h.tessmono.tessellateMonoRegion_(m)};h.tessmono.discardExterior=function(a){for(var f,m=a.fHead.next;m!==a.fHead;m=f)f=m.next,m.inside||h.mesh.zapFace(m)};h.tessmono.setWindingNumber=function(a,f,m){for(var d,k=a.eHead.next;k!==a.eHead;k=d)d=k.next,k.rFace().inside!==k.lFace.inside?k.winding=k.lFace.inside?f:-f:m?h.mesh.deleteEdge(k):k.winding=0};h.Dict=function(a,f){this.head_=new h.DictNode;this.frame_=a;this.leq_=f};h.Dict.prototype.deleteDict_=
function(){};h.Dict.prototype.insertBefore=function(a,f){do a=a.prev;while(null!==a.key&&!this.leq_(this.frame_,a.key,f));f=new h.DictNode(f,a.next,a);a.next.prev=f;return a.next=f};h.Dict.prototype.insert=function(a){return this.insertBefore(this.head_,a)};h.Dict.prototype.deleteNode=function(a){a.next.prev=a.prev;a.prev.next=a.next};h.Dict.prototype.search=function(a){var f=this.head_;do f=f.next;while(null!==f.key&&!this.leq_(this.frame_,a,f.key));return f};h.Dict.prototype.getMin=function(){return this.head_.next};
h.Dict.prototype.getMax=function(){return this.head_.prev};h.DictNode=function(a,f,h){this.key=a||null;this.next=f||this;this.prev=h||this};h.DictNode.prototype.getKey=function(){return this.key};h.DictNode.prototype.getSuccessor=function(){return this.next};h.DictNode.prototype.getPredecessor=function(){return this.prev};h.GluTesselator=function(){this.state_=h.GluTesselator.tessState_.T_DORMANT;this.errorCallback_=this.mesh=this.lastEdge_=null;this.normal_=[0,0,0];this.windingRule=h.windingRule.GLU_TESS_WINDING_ODD;
this.fatalError=!1;this.combineCallback_=this.event=this.pq=this.dict=null;this.boundaryOnly_=!1;this.polygonData_=this.meshCallback_=this.endCallback_=this.vertexCallback_=this.edgeFlagCallback_=this.beginCallback_=null};h.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2};h.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(h.GluTesselator.tessState_.T_DORMANT)};h.GluTesselator.prototype.gluTessProperty=function(a,f){switch(a){case h.gluEnum.GLU_TESS_TOLERANCE:return;
case h.gluEnum.GLU_TESS_WINDING_RULE:switch(f){case h.windingRule.GLU_TESS_WINDING_ODD:case h.windingRule.GLU_TESS_WINDING_NONZERO:case h.windingRule.GLU_TESS_WINDING_POSITIVE:case h.windingRule.GLU_TESS_WINDING_NEGATIVE:case h.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:this.windingRule=f;return}break;case h.gluEnum.GLU_TESS_BOUNDARY_ONLY:this.boundaryOnly_=!!f;return;default:this.callErrorCallback(h.gluEnum.GLU_INVALID_ENUM);return}this.callErrorCallback(h.gluEnum.GLU_INVALID_VALUE)};h.GluTesselator.prototype.gluGetTessProperty=
function(a){switch(a){case h.gluEnum.GLU_TESS_TOLERANCE:return 0;case h.gluEnum.GLU_TESS_WINDING_RULE:return a=this.windingRule,h.assert(a===h.windingRule.GLU_TESS_WINDING_ODD||a===h.windingRule.GLU_TESS_WINDING_NONZERO||a===h.windingRule.GLU_TESS_WINDING_POSITIVE||a===h.windingRule.GLU_TESS_WINDING_NEGATIVE||a===h.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),a;case h.gluEnum.GLU_TESS_BOUNDARY_ONLY:return h.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(h.gluEnum.GLU_INVALID_ENUM)}return!1};
h.GluTesselator.prototype.gluTessNormal=function(a,f,h){this.normal_[0]=a;this.normal_[1]=f;this.normal_[2]=h};h.GluTesselator.prototype.gluTessCallback=function(a,f){f=f?f:null;switch(a){case h.gluEnum.GLU_TESS_BEGIN:case h.gluEnum.GLU_TESS_BEGIN_DATA:this.beginCallback_=f;break;case h.gluEnum.GLU_TESS_EDGE_FLAG:case h.gluEnum.GLU_TESS_EDGE_FLAG_DATA:this.edgeFlagCallback_=f;break;case h.gluEnum.GLU_TESS_VERTEX:case h.gluEnum.GLU_TESS_VERTEX_DATA:this.vertexCallback_=f;break;case h.gluEnum.GLU_TESS_END:case h.gluEnum.GLU_TESS_END_DATA:this.endCallback_=
f;break;case h.gluEnum.GLU_TESS_ERROR:case h.gluEnum.GLU_TESS_ERROR_DATA:this.errorCallback_=f;break;case h.gluEnum.GLU_TESS_COMBINE:case h.gluEnum.GLU_TESS_COMBINE_DATA:this.combineCallback_=f;break;case h.gluEnum.GLU_TESS_MESH:this.meshCallback_=f;break;default:this.callErrorCallback(h.gluEnum.GLU_INVALID_ENUM)}};h.GluTesselator.prototype.gluTessVertex=function(a,f){var m=!1,d=[0,0,0];this.requireState_(h.GluTesselator.tessState_.T_IN_CONTOUR);for(var k=0;3>k;++k){var n=a[k];n<-h.GLU_TESS_MAX_COORD&&
(n=-h.GLU_TESS_MAX_COORD,m=!0);n>h.GLU_TESS_MAX_COORD&&(n=h.GLU_TESS_MAX_COORD,m=!0);d[k]=n}m&&this.callErrorCallback(h.errorType.GLU_TESS_COORD_TOO_LARGE);this.addVertex_(d,f)};h.GluTesselator.prototype.gluTessBeginPolygon=function(a){this.requireState_(h.GluTesselator.tessState_.T_DORMANT);this.state_=h.GluTesselator.tessState_.T_IN_POLYGON;this.mesh=new h.GluMesh;this.polygonData_=a};h.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(h.GluTesselator.tessState_.T_IN_POLYGON);
this.state_=h.GluTesselator.tessState_.T_IN_CONTOUR;this.lastEdge_=null};h.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(h.GluTesselator.tessState_.T_IN_CONTOUR);this.state_=h.GluTesselator.tessState_.T_IN_POLYGON};h.GluTesselator.prototype.gluTessEndPolygon=function(){this.requireState_(h.GluTesselator.tessState_.T_IN_POLYGON);this.state_=h.GluTesselator.tessState_.T_DORMANT;h.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]);h.sweep.computeInterior(this);
if(!this.fatalError){var a=this.mesh;this.boundaryOnly_?h.tessmono.setWindingNumber(a,1,!0):h.tessmono.tessellateInterior(a);this.mesh.checkMesh();if(this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)this.boundaryOnly_?h.render.renderBoundary(this,this.mesh):h.render.renderMesh(this,this.mesh,!!this.edgeFlagCallback_);if(this.meshCallback_){h.tessmono.discardExterior(this.mesh);this.meshCallback_(this.mesh);this.polygonData_=this.mesh=null;return}}h.mesh.deleteMesh(this.mesh);
this.mesh=this.polygonData_=null};h.GluTesselator.prototype.requireState_=function(a){this.state_!==a&&this.gotoState_(a)};h.GluTesselator.prototype.gotoState_=function(a){for(;this.state_!==a;)if(this.state_<a)switch(this.state_){case h.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(h.errorType.GLU_TESS_MISSING_BEGIN_POLYGON);this.gluTessBeginPolygon(null);break;case h.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(h.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case h.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(h.errorType.GLU_TESS_MISSING_END_CONTOUR);
this.gluTessEndContour();break;case h.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(h.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}};h.GluTesselator.prototype.addVertex_=function(a,f){var m=this.lastEdge_;null===m?(m=h.mesh.makeEdge(this.mesh),h.mesh.meshSplice(m,m.sym)):(h.mesh.splitEdge(m),m=m.lNext);m.org.data=f;m.org.coords[0]=a[0];m.org.coords[1]=a[1];m.org.coords[2]=a[2];m.winding=1;m.sym.winding=-1;this.lastEdge_=m};h.GluTesselator.prototype.callBeginCallback=
function(a){this.beginCallback_&&this.beginCallback_(a,this.polygonData_)};h.GluTesselator.prototype.callVertexCallback=function(a){this.vertexCallback_&&this.vertexCallback_(a,this.polygonData_)};h.GluTesselator.prototype.callEdgeFlagCallback=function(a){this.edgeFlagCallback_&&this.edgeFlagCallback_(a,this.polygonData_)};h.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)};h.GluTesselator.prototype.callCombineCallback=function(a,f,h){return this.combineCallback_?
this.combineCallback_(a,f,h,this.polygonData_)||null:null};h.GluTesselator.prototype.callErrorCallback=function(a){this.errorCallback_&&this.errorCallback_(a,this.polygonData_)};h.GluFace=function(a,f){this.next=a||this;this.prev=f||this;this.anEdge=null;this.inside=!1};h.GluHalfEdge=function(a){this.next=a||this;this.activeRegion=this.lFace=this.org=this.lNext=this.oNext=this.sym=null;this.winding=0};h.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace};h.GluHalfEdge.prototype.dst=function(){return this.sym.org};
h.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext};h.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym};h.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym};h.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext};h.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym};h.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym};h.GluMesh=function(){this.vHead=new h.GluVertex;this.fHead=new h.GluFace;this.eHead=new h.GluHalfEdge;this.eHeadSym=
new h.GluHalfEdge;this.eHead.sym=this.eHeadSym;this.eHeadSym.sym=this.eHead};h.GluMesh.prototype.checkMesh=function(){if(h.DEBUG){var a=this.fHead,f=this.vHead,m=this.eHead,d,k;for(d=d=a;(k=d.next)!==a;d=k){h.assert(k.prev===d);d=k.anEdge;do h.assert(d.sym!==d),h.assert(d.sym.sym===d),h.assert(d.lNext.oNext.sym===d),h.assert(d.oNext.sym.lNext===d),h.assert(d.lFace===k),d=d.lNext;while(d!==k.anEdge)}h.assert(k.prev===d&&null===k.anEdge);for(d=d=f;(a=d.next)!==f;d=a){h.assert(a.prev===d);d=a.anEdge;
do h.assert(d.sym!==d),h.assert(d.sym.sym===d),h.assert(d.lNext.oNext.sym===d),h.assert(d.oNext.sym.lNext===d),h.assert(d.org===a),d=d.oNext;while(d!==a.anEdge)}h.assert(a.prev===d&&null===a.anEdge&&null===a.data);for(f=f=m;(d=f.next)!==m;f=d)h.assert(d.sym.next===f.sym),h.assert(d.sym!==d),h.assert(d.sym.sym===d),h.assert(null!==d.org),h.assert(null!==d.dst()),h.assert(d.lNext.oNext.sym===d),h.assert(d.oNext.sym.lNext===d);h.assert(d.sym.next===f.sym&&d.sym===this.eHeadSym&&d.sym.sym===d&&null===
d.org&&null===d.dst()&&null===d.lFace&&null===d.rFace())}};h.GluVertex=function(a,f){this.next=a||this;this.prev=f||this;this.data=this.anEdge=null;this.coords=[0,0,0];this.pqHandle=this.t=this.s=0};h.PriorityQ=function(){this.verts_=[];this.order_=null;this.size_=0;this.initialized_=!1;this.heap_=new h.PriorityQHeap};h.PriorityQ.prototype.deleteQ=function(){this.verts_=this.order_=this.heap_=null};h.PriorityQ.prototype.init=function(){this.order_=[];for(var a=0;a<this.size_;a++)this.order_[a]=a;
a=function(a){return function(d,f){return h.geom.vertLeq(a[d],a[f])?1:-1}}(this.verts_);this.order_.sort(a);this.initialized_=!0;this.heap_.init();if(h.DEBUG)for(var f=0+this.size_-1,a=0;a<f;++a)h.assert(h.geom.vertLeq(this.verts_[this.order_[a+1]],this.verts_[this.order_[a]]))};h.PriorityQ.prototype.insert=function(a){if(this.initialized_)return this.heap_.insert(a);var f=this.size_++;this.verts_[f]=a;return-(f+1)};h.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();
var a=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var f=this.heap_.minimum();if(h.geom.vertLeq(f,a))return this.heap_.extractMin()}do--this.size_;while(0<this.size_&&null===this.verts_[this.order_[this.size_-1]]);return a};h.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var a=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var f=this.heap_.minimum();if(h.geom.vertLeq(f,a))return f}return a};h.PriorityQ.prototype.remove=function(a){if(0<=
a)this.heap_.remove(a);else for(a=-(a+1),h.assert(a<this.verts_.length&&null!==this.verts_[a]),this.verts_[a]=null;0<this.size_&&null===this.verts_[this.order_[this.size_-1]];)--this.size_};h.PriorityQHeap=function(){this.heap_=h.PriorityQHeap.reallocNumeric_([0],h.PriorityQHeap.INIT_SIZE_+1);this.verts_=[null,null];this.handles_=[0,0];this.size_=0;this.max_=h.PriorityQHeap.INIT_SIZE_;this.freeList_=0;this.initialized_=!1;this.heap_[1]=1};h.PriorityQHeap.INIT_SIZE_=32;h.PriorityQHeap.reallocNumeric_=
function(a,f){for(var h=Array(f),d=0;d<a.length;d++)h[d]=a[d];for(;d<f;d++)h[d]=0;return h};h.PriorityQHeap.prototype.init=function(){for(var a=this.size_;1<=a;--a)this.floatDown_(a);this.initialized_=!0};h.PriorityQHeap.prototype.insert=function(a){var f=++this.size_;2*f>this.max_&&(this.max_*=2,this.handles_=h.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1));var m;0===this.freeList_?m=f:(m=this.freeList_,this.freeList_=this.handles_[this.freeList_]);this.verts_[m]=a;this.handles_[m]=f;
this.heap_[f]=m;this.initialized_&&this.floatUp_(f);return m};h.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_};h.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]};h.PriorityQHeap.prototype.extractMin=function(){var a=this.heap_,f=this.verts_,h=this.handles_,d=a[1],k=f[d];0<this.size_&&(a[1]=a[this.size_],h[a[1]]=1,f[d]=null,h[d]=this.freeList_,this.freeList_=d,0<--this.size_&&this.floatDown_(1));return k};h.PriorityQHeap.prototype.remove=function(a){var f=
this.heap_,m=this.verts_,d=this.handles_;h.assert(1<=a&&a<=this.max_&&null!==m[a]);var k=d[a];f[k]=f[this.size_];d[f[k]]=k;k<=--this.size_&&(1>=k?this.floatDown_(k):h.geom.vertLeq(m[f[k>>1]],m[f[k]])?this.floatDown_(k):this.floatUp_(k));m[a]=null;d[a]=this.freeList_;this.freeList_=a};h.PriorityQHeap.prototype.floatDown_=function(a){for(var f=this.heap_,m=this.verts_,d=this.handles_,k=f[a];;){var n=a<<1;n<this.size_&&h.geom.vertLeq(m[f[n+1]],m[f[n]])&&(n+=1);h.assert(n<=this.max_);var g=f[n];if(n>
this.size_||h.geom.vertLeq(m[k],m[g])){f[a]=k;d[k]=a;break}f[a]=g;d[g]=a;a=n}};h.PriorityQHeap.prototype.floatUp_=function(a){for(var f=this.heap_,m=this.verts_,d=this.handles_,k=f[a];;){var n=a>>1,g=f[n];if(0===n||h.geom.vertLeq(m[g],m[k])){f[a]=k;d[k]=a;break}f[a]=g;d[g]=a;a=n}};h.ActiveRegion=function(){this.nodeUp=this.eUp=null;this.windingNumber=0;this.fixUpperEdge=this.dirty=this.sentinel=this.inside=!1};h.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()};
h.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()};return h})},"esri/views/2d/engine/webgl/util/Lock":function(){define(["require","exports","../../../../../core/promiseUtils"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._resolver=null}a.prototype.isHeld=function(){return!!this._resolver};a.prototype.acquire=function(){var a=this;return this._resolver?this._resolver.promise.then(function(){return a.acquire()}):
(this._resolver=f.createResolver(),f.resolve())};a.prototype.release=function(){var a=this._resolver;this._resolver=null;a.resolve()};return a}();a.default=h;a.withLock=function(a,d){return a.acquire().then(function(){return d()}).then(function(){return a.release()}).catch(function(d){a.release();throw d;})}})},"esri/views/2d/layers/features/support/TileStore":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/decorateHelper @dojo/framework/shim/Set ../../../../../core/Evented ../../../../../core/has ../../../../../core/libs/rbush/rbush ./Tile ../../../tiling/TileKey".split(" "),
function(h,a,f,m,d,k,n,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});var b={added:[],removed:[]},l=new d.default,y=new c(0,0,0,0);h=function(a){function c(b){var c=a.call(this)||this;c._tiles=new Map;c._index=g(9,n("csp-restrictions")?function(a){return{minX:a.bounds[0],minY:a.bounds[1],maxX:a.bounds[2],maxY:a.bounds[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]);c.tiles=[];c.tileScheme=b;return c}f(c,a);c.prototype.destroy=function(){this._tiles.clear()};c.prototype.has=function(a){return this._tiles.has(a)};
c.prototype.get=function(a){return this._tiles.get(a)};c.prototype.findByKey=function(a){return this._tiles.get(a.id)};c.prototype.intersections=function(a,b){var c="string"===typeof a?this.get(a):a;if(!c)return[];var d=b*c.resolution;b=c.bounds[0]-d;a=c.bounds[1]-d;for(var e=c.bounds[2]+d,c=c.bounds[3]+d,d=[],f=0,g=this._index.search({minX:b,minY:a,maxX:e,maxY:c});f<g.length;f++){var h=g[f],k=h.bounds.slice();k[0]=Math.max(k[0],b);k[1]=Math.max(k[1],a);k[2]=Math.min(k[2],e);k[3]=Math.min(k[3],c);
0<k[2]-k[0]&&0<k[3]-k[1]&&d.push({bounds:k,tile:h})}return d};c.prototype.boundsIntersections=function(a){return this._index.search({minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]})};c.prototype.setViewState=function(a){var c=this.tileScheme.getTileCoverage(a,0);if(c){a=c.spans;var c=c.lodInfo,d=c.level;if(0<a.length)for(var f=0;f<a.length;f++)for(var g=a[f],h=g.row,k=g.colTo,m=g.colFrom;m<=k;m++){var n=y.set(d,h,c.normalizeCol(m),c.getWorldForColumn(m)).id;l.add(n);this.has(n)||(g=new e.default(this.tileScheme,
n),this._tiles.set(n,g),this._index.insert(g),this.tiles.push(g),b.added.push(g))}for(a=this.tiles.length-1;0<=a;a--)g=this.tiles[a],l.has(g.id)||(this._tiles.delete(g.id),this.tiles.splice(a,1),this._index.remove(g),b.removed.push(g));(b.added.length||b.removed.length)&&this.emit("update",b);l.clear();b.added.length=0;b.removed.length=0}};return c}(k);a.default=h})},"esri/core/libs/rbush/rbush":function(){define(["../quickselect/quickselect"],function(h){function a(b,c){if(!(this instanceof a))return new a(b,
c);this._maxEntries=Math.max(4,b||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));c&&("function"===typeof c?this.toBBox=c:this._initFormat(c));this.clear()}function f(a,b){m(a,0,a.children.length,b,a)}function m(a,b,c,e,f){f||(f=l(null));f.minX=Infinity;f.minY=Infinity;f.maxX=-Infinity;f.maxY=-Infinity;for(var g;b<c;b++)g=a.children[b],d(f,a.leaf?e(g):g);return f}function d(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,
b.maxY);return a}function k(a,b){return a.minX-b.minX}function n(a,b){return a.minY-b.minY}function g(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function e(a){return a.maxX-a.minX+(a.maxY-a.minY)}function c(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function b(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function l(a){return{children:a,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function y(a,b,c,d,e){for(var f=
[b,c],g;f.length;)c=f.pop(),b=f.pop(),c-b<=d||(g=b+Math.ceil((c-b)/d/2)*d,h(a,g,b,c,e),f.push(b,g,g,c))}a.prototype={all:function(){return this._all(this.data,[])},search:function(a){var d=this.data,e=[],f=this.toBBox;if(!b(a,d))return e;for(var g=[],h,k,l,m;d;){h=0;for(k=d.children.length;h<k;h++)l=d.children[h],m=d.leaf?f(l):l,b(a,m)&&(d.leaf?e.push(l):c(a,m)?this._all(l,e):g.push(l));d=g.pop()}return e},collides:function(a){var d=this.data,e=this.toBBox;if(!b(a,d))return!1;for(var f=[],g,h,k,l;d;){g=
0;for(h=d.children.length;g<h;g++)if(k=d.children[g],l=d.leaf?e(k):k,b(a,l)){if(d.leaf||c(a,l))return!0;f.push(k)}d=f.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,c=a.length;b<c;b++)this.insert(a[b]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(b=this.data,this.data=a,a=b),this._insert(a,this.data.height-a.height-1,!0)):this.data=
a;return this},insert:function(a){a&&this._insert(a,this.data.height-1);return this},clear:function(){this.data=l([]);return this},remove:function(a,b){if(!a)return this;for(var d=this.data,e=this.toBBox(a),f=[],g=[],h,k,l,m;d||f.length;){d||(d=f.pop(),k=f[f.length-1],h=g.pop(),m=!0);if(d.leaf){a:{l=a;var n=d.children,v=b;if(v){for(var z=0;z<n.length;z++)if(v(l,n[z])){l=z;break a}l=-1}else l=n.indexOf(l)}if(-1!==l){d.children.splice(l,1);f.push(d);this._condense(f);break}}m||d.leaf||!c(d,e)?k?(h++,
d=k.children[h],m=!1):d=null:(f.push(d),g.push(h),h=0,k=d,d=d.children[0])}return this},toBBox:function(a){return a},compareMinX:k,compareMinY:n,toJSON:function(){return this.data},fromJSON:function(a){this.data=a;return this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,d){var e=c-b+1,g=this._maxEntries,h;if(e<=g)return h=l(a.slice(b,c+1)),f(h,this.toBBox),h;d||(d=Math.ceil(Math.log(e)/Math.log(g)),g=Math.ceil(e/
Math.pow(g,d-1)));h=l([]);h.leaf=!1;h.height=d;var e=Math.ceil(e/g),g=e*Math.ceil(Math.sqrt(g)),k,m,n;for(y(a,b,c,g,this.compareMinX);b<=c;b+=g)for(m=Math.min(b+g-1,c),y(a,b,m,e,this.compareMinY),k=b;k<=m;k+=e)n=Math.min(k+e-1,m),h.children.push(this._build(a,k,n,d-1));f(h,this.toBBox);return h},_chooseSubtree:function(a,b,c,d){for(var e,f,h,k,l,m,n,p;;){d.push(b);if(b.leaf||d.length-1===c)break;n=p=Infinity;e=0;for(f=b.children.length;e<f;e++)h=b.children[e],l=g(h),m=(Math.max(h.maxX,a.maxX)-Math.min(h.minX,
a.minX))*(Math.max(h.maxY,a.maxY)-Math.min(h.minY,a.minY))-l,m<p?(p=m,n=l<n?l:n,k=h):m===p&&l<n&&(n=l,k=h);b=k||b.children[0]}return b},_insert:function(a,b,c){var e=this.toBBox;c=c?a:e(a);var e=[],f=this._chooseSubtree(c,this.data,b,e);f.children.push(a);for(d(f,c);0<=b;)if(e[b].children.length>this._maxEntries)this._split(e,b),b--;else break;this._adjustParentBBoxes(c,e,b)},_split:function(a,b){var c=a[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);d=this._chooseSplitIndex(c,
e,d);d=l(c.children.splice(d,c.children.length-d));d.height=c.height;d.leaf=c.leaf;f(c,this.toBBox);f(d,this.toBBox);b?a[b-1].children.push(d):this._splitRoot(c,d)},_splitRoot:function(a,b){this.data=l([a,b]);this.data.height=a.height+1;this.data.leaf=!1;f(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var d,e,f,h,k,l,n;k=l=Infinity;for(d=b;d<=c-b;d++)e=m(a,0,d,this.toBBox),f=m(a,d,c,this.toBBox),h=Math.max(0,Math.min(e.maxX,f.maxX)-Math.max(e.minX,f.minX))*Math.max(0,Math.min(e.maxY,f.maxY)-
Math.max(e.minY,f.minY)),e=g(e)+g(f),h<k?(k=h,n=d,l=e<l?e:l):h===k&&e<l&&(l=e,n=d);return n},_chooseSplitAxis:function(a,b,c){var d=a.leaf?this.compareMinX:k,e=a.leaf?this.compareMinY:n,f=this._allDistMargin(a,b,c,d);b=this._allDistMargin(a,b,c,e);f<b&&a.children.sort(d)},_allDistMargin:function(a,b,c,f){a.children.sort(f);f=this.toBBox;var g=m(a,0,b,f),h=m(a,c-b,c,f),k=e(g)+e(h),l,n;for(l=b;l<c-b;l++)n=a.children[l],d(g,a.leaf?f(n):n),k+=e(g);for(l=c-b-1;l>=b;l--)n=a.children[l],d(h,a.leaf?f(n):
n),k+=e(h);return k},_adjustParentBBoxes:function(a,b,c){for(;0<=c;c--)d(b[c],a)},_condense:function(a){for(var b=a.length-1,c;0<=b;b--)0===a[b].children.length?0<b?(c=a[b-1].children,c.splice(c.indexOf(a[b]),1)):this.clear():f(a[b],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+
a[3]+"};")}};return a})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function h(f,d,k,n,g){for(;n>k;){if(600<n-k){var e=n-k+1,c=d-k+1,b=Math.log(e),l=.5*Math.exp(2*b/3),b=.5*Math.sqrt(b*l*(e-l)/e)*(0>c-e/2?-1:1);h(f,d,Math.max(k,Math.floor(d-c*l/e+b)),Math.min(n,Math.floor(d+(e-c)*l/e+b)),g)}e=f[d];c=k;l=n;a(f,k,d);for(0<g(f[n],e)&&a(f,k,n);c<l;){a(f,c,l);c++;for(l--;0>g(f[c],e);)c++;for(;0<g(f[l],e);)l--}0===g(f[k],e)?a(f,k,l):(l++,a(f,l,n));l<=d&&(k=l+1);d<=l&&(n=l-
1)}}function a(a,d,f){var h=a[d];a[d]=a[f];a[f]=h}function f(a,d){return a<d?-1:a>d?1:0}return function(a,d,k,n,g){h(a,d,k||0,n||a.length-1,g||f)}})},"esri/views/2d/layers/features/support/Tile":function(){define("require exports @dojo/framework/shim/Set ../../../../../core/ArrayPool ../../../../../geometry/support/aaBoundingRect ../../../../../tasks/support/QuantizationParameters ../../../tiling/TileKey".split(" "),function(h,a,f,m,d,k,n){function g(a,c){var b=a.bounds,d=c.bounds;return a.key.id!==
c.key.id&&a.key.world===c.key.world&&b[0]<=d[0]&&b[1]<=d[1]&&b[2]>=d[2]&&b[3]>=d[3]}Object.defineProperty(a,"__esModule",{value:!0});a.isParentOf=g;a.isChildOf=function(a,c){return g(c,a)};h=function(){function a(a,b){this.bounds=d.create();this.key=new n(0,0,0,0);this.objectIds=new f.default;this.key.set(b);b=a.getLODInfoAt(this.key);this.tileInfoView=a;this.tileInfoView.getTileBounds(this.bounds,this.key,!0);this.resolution=b.resolution;this.scale=b.scale;this.level=b.level;this.needsClear=!0}Object.defineProperty(a.prototype,
"id",{get:function(){return this.key.id},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new a(this.tileInfoView,this.id)};a.prototype.createChildTiles=function(){for(var c=this.key.getChildKeys(),b=m.acquire(),d=0;d<c.length;d++)b[d]=new a(this.tileInfoView,c[d]);return b};a.prototype.getQuantizationParameters=function(){return k.default.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],
ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})};return a}();a.Tile=h;a.default=h})},"esri/views/2d/layers/graphics/GraphicProcessingQueue":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/scheduling ../../../../core/accessorSupport/decorators".split(" "),function(h,a,f,m,d,k,n){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function d(c){c=
a.call(this,c)||this;c._queue=new Map;c._queueArray=[];c._onGoingGraphic=null;c._onGoingPromise=null;c._scheduledNextHandle=null;c._timestamp=Date.now();c._next=c._next.bind(c);c._finalize=c._finalize.bind(c);return c}f(d,a);Object.defineProperty(d.prototype,"length",{get:function(){return this._queueArray.length},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return 0<this._queueArray.length||null!==this._onGoingPromise},enumerable:!0,configurable:!0});
d.prototype.cancel=function(a){this._onGoingGraphic&&this._onGoingGraphic.graphic===a&&(this._onGoingPromise.cancel(),this._onGoingGraphic=this._onGoingPromise=null);if(this._queue.has(a)){var b=this._queue.get(a);this._queue.delete(a);a=this._queueArray.indexOf(b);this._queueArray.slice(a,1)}this._scheduleNext();this.notifyChange("updating")};d.prototype.clear=function(){this._queue.clear();this._queueArray.length=0;this._onGoingPromise&&(this._onGoingPromise.cancel(),this._onGoingGraphic=this._onGoingPromise=
null);this._cancelNext();this.notifyChange("updating")};d.prototype.has=function(a){return this._queue.has(a)};d.prototype.isOngoing=function(a){return this._onGoingGraphic&&this._onGoingGraphic.graphic===a};d.prototype.push=function(a,b,d){this._queue.has(a)||(b={graphic:a,addOrUpdate:b,timestamp:d||this._timestamp},this._queueArray.push(b),this._queue.set(a,b),this._scheduleNext(),this.notifyChange("updating"))};d.prototype.refresh=function(){this._timestamp=Date.now();this.reset()};d.prototype.reset=
function(){var a=this._onGoingGraphic;a&&this.push(a.graphic,a.addOrUpdate,this._timestamp)};d.prototype._finalize=function(){this._onGoingPromise=this._onGoingGraphic=null;this.notifyChange("updating");this._scheduleNext()};d.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)};d.prototype._scheduleNext=function(){this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingGraphic||(this._scheduledNextHandle=k.schedule(this._next))};
d.prototype._next=function(){if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingGraphic)this._scheduledNextHandle=null;else{this._scheduledNextHandle=null;var a=this._peek(),b=a.graphic,d=a.addOrUpdate;this._queue.delete(b);this._onGoingGraphic=a;this._onGoingPromise=this.process(b,d,this._timestamp);this._onGoingPromise.then(this._finalize,this._finalize);this.notifyChange("updating")}};d.prototype._peek=function(){return 0===this._queueArray.length?null:this._queueArray.pop()};
m([n.property({readOnly:!0})],d.prototype,"length",null);m([n.property({readOnly:!0})],d.prototype,"updating",null);m([n.property({constructOnly:!0})],d.prototype,"process",void 0);return d=m([n.subclass()],d)}(n.declared(d));a.default=h})},"esri/views/2d/layers/graphics/GraphicStore":function(){define("require exports ../../../../core/tsSupport/assignHelper @dojo/framework/shim/Map ../../../../core/has ../../../../core/screenUtils ../../../../core/libs/rbush/rbush ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/contains ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtils ../../engine/webgl/util/iterator ./GraphicStoreItem ./graphicsUtils".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v){function z(a,b,c,d,e){w.minX=b;w.minY=c;w.maxX=d;w.maxY=e;return a.search(w)}Object.defineProperty(a,"__esModule",{value:!0});var w={minX:0,minY:0,maxX:0,maxY:0},p=g.create(),B=[];h=function(){function a(a,b,c,e,f){this.renderer=e;this._graphics=f;this._index=n(9,d("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]);this._itemByGraphic=new m.default;this._currentLevel=-Infinity;
this._tileInfoView=a;this._uidFieldName=c;if(a=a.getClosestInfoForScale(b))this._currentLevel=a.level,this._resolution=this._tileInfoView.getTileResolution(a.level)}a.prototype.hitTest=function(a,d,f,h,l){a=b.normalizeMapX(a,this._tileInfoView.spatialReference);var m=.5*h*f;p[0]=a-m;p[1]=d-m;p[2]=a+m;p[3]=d+m;f=.5*h*(f+50);f=z(this._index,a-f,d-f,a+f,d+f);if(!f||0===f.length)return[];for(var m={x:a,y:d},n=[],q,u=0;u<f.length;u++){var w=f[u];if(w.graphic.visible)switch(c.getJsonType(w.geometry)){case "esriGeometryPoint":q=
this._getSymbol(w.graphic);if(!q)continue;var x=w.geometry,y=void 0,y="text"===q.type?v.getTextSymbolBounds(x.x,x.y,q,w.size,this._resolution,l):v.getMarkerSymbolBounds(x.x,x.y,q,this._resolution,l);e.polygonContainsPoint(y,m)&&n.push(w);break;case "esriGeometryPolyline":q=this._getSymbol(w.graphic);if(!q)continue;q=1.5*h*window.devicePixelRatio*k.pt2px(q.width);v.isPointOnPolyline(w.geometry,a,d,q)&&n.push(w);break;case "esriGeometryEnvelope":q=w.geometry;q=g.fromValues(q.xmin,q.ymin,q.xmax,q.ymax);
g.intersects(q,p)&&n.push(w);break;case "esriGeometryPolygon":e.polygonContainsPoint(w.geometry,m)&&n.push(w);break;case "esriGeometryMultipoint":if(x=this._getSymbol(w.graphic)){y=w.geometry.points;q=void 0;for(var B=0;B<y.length;B++)if("text"===x.type?(q=x,q=v.getTextSymbolBounds(y[B][0],y[B][1],q,w.size,this._resolution,l)):q=v.getMarkerSymbolBounds(y[B][0],y[B][1],x,this._resolution,l),e.polygonContainsPoint(q,m)){n.push(w);break}}}}n.sort(function(a,b){var c=v.graphicGeometryToNumber(a.graphic),
d=v.graphicGeometryToNumber(b.graphic);return c===d?b.zorder-a.zorder:c-d});return n.map(function(a){return a.graphic})};a.prototype.getGraphicsData=function(a,b){var c=z(this._index,a.bounds[0],a.bounds[1],a.bounds[2],a.bounds[3]);if(0===c.length||0===b.length)return[];c.sort(function(a,b){return a.zorder-b.zorder});c[0].insertAfter=-1;for(var d=1;d<c.length;d++)c[d].insertAfter=c[d-1].graphic.uid;c.sort(function(a,b){return a.graphic.uid-b.graphic.uid});b.sort(function(a,b){return a.uid-b.uid});
var e=d=0,g,h=[];a={originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]};for(var k=0;k<b.length;k++){for(var l=b[k],e=-2;d<c.length;)if(g=c[d],d++,l.uid===g.graphic.uid){e=g.insertAfter;break}if(g.geometry&&-2!==e){var m=g.getGeometryQuantized(a),n=f({},g.graphic.attributes);n[this._uidFieldName]=l.uid;h.push({centroid:y.default.getCentroidQuantized(g,a,this.renderer,this._scale),geometry:m,attributes:n,symbol:l.symbol,insertAfter:e})}}return h};a.prototype.getGraphicData=
function(a,b){var c=this._itemByGraphic.get(b);if(!c)return null;var d=z(this._index,a.bounds[0],a.bounds[1],a.bounds[2],a.bounds[3]);d.sort(function(a,b){return a.zorder-b.zorder});var e=d.indexOf(c),d=0===e||-1===e?-1:d[e-1].graphic.uid;a={originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]};var e=c.getGeometryQuantized(a),g=f({},c.graphic.attributes);g[this._uidFieldName]=b.uid;return{centroid:y.default.getCentroidQuantized(c,a,this.renderer,this._scale),
geometry:e,attributes:g,symbol:b.symbol,insertAfter:d}};a.prototype.queryTileData=function(a){var b=g.pad(a.bounds,50*a.resolution,g.create()),b=z(this._index,b[0],b[1],b[2],b[3]),c=[];this._createTileGraphics(c,b,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]});return c};a.prototype.has=function(a){return this._itemByGraphic.has(a)};a.prototype.getBounds=function(a){return this._itemByGraphic.has(a)?this._itemByGraphic.get(a).bounds:null};a.prototype.add=
function(a,b,c){if(a)return b=y.default.acquire(a,c,b,this.renderer,this._resolution,this._scale,this._tileInfoView.spatialReference),this._itemByGraphic.set(a,b),c&&this._index.insert(b),b.bounds};a.prototype.remove=function(a){if(this._itemByGraphic.has(a)){var b=this._itemByGraphic.get(a);this._index.remove(b);this._itemByGraphic.delete(a)}};a.prototype.updateZ=function(){for(var a=this._graphics.items,b,c=0;c<a.length;c++)if(b=a[c],b=this._itemByGraphic.get(b))b.zorder=c};a.prototype.update=function(a,
b,c){var d=this._itemByGraphic.get(a),e=g.clone(d.bounds);d.size[0]=d.size[1]=0;this._index.remove(d);d.set(a,c,b,this.renderer,this._resolution,this._scale,this._tileInfoView.spatialReference);c&&this._index.insert(d);return{oldBounds:e,newBounds:d.bounds}};a.prototype.updateLevel=function(a){var b=this;this._currentLevel!==a&&(this._currentLevel=a,this._resolution=this._tileInfoView.getTileResolution(a),this._scale=this._tileInfoView.getTileScale({level:a,row:0,col:0,world:0}),this._index.clear(),
a=this._itemByGraphic.values(),B.length=0,l.forEachIter(a,function(a){a.updateBounds(b.renderer,b._resolution,b._scale,b._tileInfoView.spatialReference);a.geometry&&B.push(a)}),this._index.load(B))};a.prototype.clear=function(){this._itemByGraphic.clear();this._index.clear()};a.prototype._createTileGraphics=function(a,b,c){var d=this._uidFieldName;b.sort(function(a,b){return a.zorder-b.zorder});for(var e,g,h,k,l=0;l<b.length;l++){h=b[l];e=h.graphic;g=h.getGeometryQuantized(c);k=0===l?-1:b[l-1].graphic.uid;
var m=f({},h.graphic.attributes);m[d]=e.uid;a.push({centroid:y.default.getCentroidQuantized(h,c,this.renderer,this._scale),geometry:g,attributes:m,symbol:e.symbol,insertAfter:k})}};a.prototype._getSymbol=function(a){return a.symbol?a.symbol:this.renderer?this.renderer.getSymbol(a,{scale:this._scale}):null};return a}();a.default=h})},"esri/views/2d/layers/graphics/GraphicStoreItem":function(){define("require exports ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/jsonUtils ../../../../geometry/support/quantizationUtils ./graphicsUtils".split(" "),
function(h,a,f,m,d,k,n){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this.bounds=f.create();this.graphic=null;this.size=[0,0,0,0]}a.acquire=function(d,c,b,f,g,h,k){void 0===d&&(d=null);var e;0===a._pool.length?e=new a:(e=a._pool.pop(),this._set.delete(e));e.acquire(d,c,b,f,g,h,k);return e};a.release=function(a){a&&!this._set.has(a)&&(a.release(),this._pool.push(a),this._set.add(a))};a.getCentroidQuantized=function(a,c,b,f){if(d.isPolygon(a.geometry)){var e=a.graphic.symbol;
!e&&b&&(e=b.getSymbol(a.graphic,{scale:f}));if(!e)return null;if(n.isMarkerSymbol(e.type))return a=m.polygonCentroid(a.geometry),k.quantizePoint(c,{},{x:a[0],y:a[1]},!1,!1)}return null};a.prototype.acquire=function(a,c,b,d,f,g,h){void 0===a&&(a=null);a&&this.set(a,c,b,d,f,g,h)};a.prototype.release=function(){this.geometry=this.graphic=null};a.prototype.set=function(a,c,b,d,f,g,h){this.graphic=a;this.geometry=c;n.getBounds(this.bounds,this.size,a,c,b,d,f,g,h)};a.prototype.updateBounds=function(a,c,
b,d){n.getBounds(this.bounds,this.size,this.graphic,this.geometry,null,a,c,b,d)};a.prototype.getGeometryQuantized=function(a){if(d.isPolygon(this.geometry)){var c=this.geometry.rings;if(1===c.length&&2===c[0].length)return k.quantizeGeometry(a,{paths:[[c[0][0],c[0][1]]]})}return k.quantizeGeometry(a,this.geometry)};a._pool=[];a._set=new Set;return a}();a.default=h})},"esri/views/layers/GraphicsView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(h,a,f,m,d,k){return function(a){function d(){var d=null!==a&&a.apply(this,arguments)||this;d.graphics=null;d.renderer=null;d.view=null;return d}f(d,a);m([k.property()],d.prototype,"graphics",void 0);m([k.property()],d.prototype,"renderer",void 0);m([k.property()],d.prototype,"view",void 0);return d=m([k.subclass("esri.views.layers.GraphicsView")],d)}(k.declared(d))})},"esri/views/2d/navigation/MapViewNavigation":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Viewpoint ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../geometry/Point ../viewpointUtils ./ZoomBox ./actions/Pan ./actions/Pinch ./actions/Rotate".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y){Object.defineProperty(a,"__esModule",{value:!0});var v=new d({targetGeometry:new g}),z=[0,0];h=function(a){function d(b){b=a.call(this)||this;b._endTimer=null;b.animationManager=null;return b}f(d,a);d.prototype.initialize=function(){this.pan=new b({navigation:this});this.rotate=new y({navigation:this});this.pinch=new l({navigation:this});this.zoomBox=new c({view:this.view,navigation:this})};d.prototype.destroy=function(){this.zoomBox.destroy();this.animationManager=
this.zoomBox=null};d.prototype.begin=function(){this._set("interacting",!0)};d.prototype.end=function(){var a=this;this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=0);this._endTimer=setTimeout(function(){a._set("interacting",!1)},0)};d.prototype.zoom=function(a,b){void 0===b&&(b=this._getDefaultAnchor());this.stop();this.begin();if(this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return 1>a?this.zoomIn(b):this.zoomOut(b);this.setViewpoint(b,a,0,[0,0])};d.prototype.zoomIn=
function(a){void 0===a&&(a=this._getDefaultAnchor());var b=this.view,c=b.scale,d=b.constraints.snapToNextScale(c);return b.goTo(this._scaleAndRotateViewpoint(v,a,d/c,0))};d.prototype.zoomOut=function(a){void 0===a&&(a=this._getDefaultAnchor());var b=this.view,c=b.scale,d=b.constraints.snapToPreviousScale(c);return b.goTo(this._scaleAndRotateViewpoint(v,a,d/c,0))};d.prototype.setViewpoint=function(a,b,c,d){this.begin();this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,
a,b,c,d);this.end()};d.prototype.animateViewpoint=function(a,b,c){return this.view.goTo(this._scaleAndRotateViewpoint(v,a,b,c))};d.prototype.continousRotateClockwise=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){e.rotateBy(a,a,-1)})};d.prototype.continousRotateCounterclockwise=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){e.rotateBy(a,a,1)})};d.prototype.resetRotation=function(){this.view.rotation=
0};d.prototype.continousPanLeft=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){e.translateBy(a,a,[-10,0])})};d.prototype.continousPanRight=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){e.translateBy(a,a,[10,0])})};d.prototype.continousPanUp=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){e.translateBy(a,a,[0,10])})};d.prototype.continousPanDown=function(){var a=
this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){e.translateBy(a,a,[0,-10])})};d.prototype.stop=function(){this.pan.stopMomentumNavigation();this.animationManager.stop();this.end();this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=0)};d.prototype._getDefaultAnchor=function(){var a=this.view.size;z[0]=.5*a[0];z[1]=.5*a[1];return z};d.prototype._scaleAndRotateViewpoint=function(a,b,c,d){var f=this.view,g=f.size,h=f.padding,k=f.constraints,l=f.viewpoint,m=f.scale*
c,f=k.canZoomInTo(m),k=k.canZoomOutTo(m);return 1>c&&!f||1<c&&!k?l:e.padAndScaleAndRotateBy(a,l,c,d,b,g,h)};d.prototype._scaleRotateTranslateViewpoint=function(a,b,c,d,f){var g=this.view,h=g.size,k=g.padding,l=g.constraints,m=g.viewpoint,n=g.scale*c,g=l.canZoomInTo(n),l=l.canZoomOutTo(n);if(1>c&&!g||1<c&&!l)c=1;e.translateBy(m,m,f);return e.padAndScaleAndRotateBy(a,m,c,d,b,h,k)};m([n.property()],d.prototype,"animationManager",void 0);m([n.property({type:Boolean,readOnly:!0})],d.prototype,"interacting",
void 0);m([n.property()],d.prototype,"pan",void 0);m([n.property()],d.prototype,"pinch",void 0);m([n.property()],d.prototype,"rotate",void 0);m([n.property()],d.prototype,"view",void 0);m([n.property()],d.prototype,"zoomBox",void 0);return d=m([n.subclass("esri.views.2d.navigation.MapViewNavigation")],d)}(n.declared(k));a.default=h})},"esri/views/2d/navigation/ZoomBox":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/screenUtils ../../../core/accessorSupport/decorators".split(" "),
function(h,a,f,m,d,k,n){return function(a){function d(c){c=a.call(this,c)||this;c._container=null;c._overlay=null;c._backgroundShape=null;c._boxShape=null;c._box={x:0,y:0,width:0,height:0};c._redraw=c._redraw.bind(c);return c}f(d,a);d.prototype.destroy=function(){this.view=null};Object.defineProperty(d.prototype,"view",{set:function(a){var b=this;this._handles&&this._handles.forEach(function(a){a.remove()});this._handles=null;this._destroyOverlay();this._set("view",a);a&&(a.on("drag",["Shift"],function(a){return b._handleDrag(a,
1)}),a.on("drag",["Shift","Ctrl"],function(a){return b._handleDrag(a,-1)}))},enumerable:!0,configurable:!0});d.prototype._start=function(a,b,d,e){this._createContainer();this._createOverlay();this.navigation.begin()};d.prototype._update=function(a,b,d,e){this._box.x=a;this._box.y=b;this._box.width=d;this._box.height=e;this._rafId||(this._rafId=requestAnimationFrame(this._redraw))};d.prototype._end=function(a,b,d,e,f){var c=this.view;a=c.toMap(k.createScreenPoint(a+.5*d,b+.5*e));d=Math.max(d/c.width,
e/c.height);-1===f&&(d=1/d);this._destroyOverlay();this.navigation.end();c.goTo({center:a,scale:c.scale*d})};d.prototype._updateBox=function(a,b,d,e){var c=this._boxShape;c.setAttributeNS(null,"x",""+a);c.setAttributeNS(null,"y",""+b);c.setAttributeNS(null,"width",""+d);c.setAttributeNS(null,"height",""+e);c.setAttributeNS(null,"class","esri-zoom-box__outline")};d.prototype._updateBackground=function(a,b,d,e){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(a,b,d,e,this.view.width,this.view.height))};
d.prototype._createContainer=function(){var a=document.createElement("div");a.className="esri-zoom-box__container";this.view.root.appendChild(a);this._container=a};d.prototype._createOverlay=function(){var a=this.view.width,b=this.view.height,d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M 0 0 L "+a+" 0 L "+a+" "+b+" L 0 "+b+" Z");d.setAttributeNS(null,"class","esri-zoom-box__overlay-background");a=document.createElementNS("http://www.w3.org/2000/svg",
"rect");b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");b.setAttributeNS(null,"class","esri-zoom-box__overlay");b.appendChild(d);b.appendChild(a);this._container.appendChild(b);this._backgroundShape=d;this._boxShape=a;this._overlay=b};d.prototype._destroyOverlay=function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container=
this._backgroundShape=this._boxShape=this._overlay=null};d.prototype._toSVGPath=function(a,b,d,e,f,g){d=a+d;e=b+e;return"M 0 0 L "+f+" 0 L "+f+" "+g+" L 0 "+g+" ZM "+a+" "+b+" L "+a+" "+e+" L "+d+" "+e+" L "+d+" "+b+" Z"};d.prototype._handleDrag=function(a,b){var c=a.x,d=a.y,e=a.origin.x,f=a.origin.y,g;c>e?(g=e,e=c-e):(g=c,e-=c);d>f?(c=f,d-=f):(c=d,d=f-d);switch(a.action){case "start":this._start(g,c,e,d);break;case "update":this._update(g,c,e,d);break;case "end":this._end(g,c,e,d,b)}a.stopPropagation()};
d.prototype._redraw=function(){if(this._rafId&&(this._rafId=null,this._overlay)){var a=this._box,b=a.x,d=a.y,e=a.width,a=a.height;this._updateBox(b,d,e,a);this._updateBackground(b,d,e,a);this._rafId=requestAnimationFrame(this._redraw)}};m([n.property()],d.prototype,"navigation",void 0);m([n.property()],d.prototype,"view",null);return d=m([n.subclass("esri.views.2d.navigation.ZoomBox")],d)}(n.declared(d))})},"esri/views/2d/navigation/actions/Pan":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../viewpointUtils ../../../navigation/PanPlanarMomentumEstimator".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y){return function(a){function h(c){var e=a.call(this)||this;e.animationTime=0;e.momentumEstimator=new y.PanPlanarMomentumEstimator(500,6,.92);e.momentum=null;e.tmpMomentum=b.vec3f64.create();e.momentumFinished=!1;e.viewpoint=new k({targetGeometry:new d.Point,scale:0,rotation:0});e.watch("momentumFinished",function(a){a&&e.navigation.stop()});return e}f(h,a);h.prototype.begin=function(a,b){this.navigation.begin();this.momentumEstimator.reset();this.addToEstimator(b);
this.previousDrag=b};h.prototype.update=function(a,b){this.addToEstimator(b);var c=b.center.x,d=b.center.y,e=this.previousDrag,c=e?e.center.x-c:-c,d=e?d-e.center.y:d;a.viewpoint=l.translateBy(this.viewpoint,a.viewpoint,[c||0,d||0]);this.previousDrag=b};h.prototype.end=function(a,b){this.addToEstimator(b);this.momentum=this.momentumEstimator.evaluateMomentum();this.animationTime=0;if(this.momentum)this.onAnimationUpdate(a);this.previousDrag=null;this.navigation.end()};h.prototype.addToEstimator=function(a){var c=
a.center.x,d=a.center.y,e=g.createScreenPointArray(-c,d),c=b.vec3f64.fromValues(-c,d,0);this.momentumEstimator.add(e,c,.001*a.timestamp)};h.prototype.onAnimationUpdate=function(a){var b=this;this.navigation.animationManager.animateContinous(a.viewpoint,function(d,e){b.momentumFinished=!b.momentum||b.momentum.isFinished(b.animationTime);e*=.001;if(!b.momentumFinished){var f=b.momentum.valueDelta(b.animationTime,e);c.vec3.scale(b.tmpMomentum,b.momentum.direction,f);a.viewpoint=l.translateBy(d,d,b.tmpMomentum)}b.animationTime+=
e})};h.prototype.stopMomentumNavigation=function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())};m([e.property()],h.prototype,"momentumFinished",void 0);m([e.property()],h.prototype,"viewpoint",void 0);m([e.property()],h.prototype,"navigation",void 0);return h=m([e.subclass("esri.views.2d.navigation.actions.Pan")],h)}(e.declared(n))})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),
function(h,a,f,m,d,k,n){Object.defineProperty(a,"__esModule",{value:!0});var g=function(a){function c(b,c,d,e,f){b=a.call(this,b,c,d)||this;b.sceneVelocity=e;b.direction=f;return b}f(c,a);c.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,b)};return c}(n.Momentum);a.PanPlanarMomentum=g;h=function(){function a(a,b,e){void 0===a&&(a=300);void 0===b&&(b=12);void 0===e&&(e=.84);this.minimumInitialVelocity=a;this.stopVelocity=b;this.friction=e;this.time=
new k.FilteredFiniteDifference(.6);this.screen=[new k.FilteredFiniteDifference(.4),new k.FilteredFiniteDifference(.4)];this.scene=[new k.FilteredFiniteDifference(.6),new k.FilteredFiniteDifference(.6),new k.FilteredFiniteDifference(.6)];this.tmpDirection=d.vec3f64.create()}a.prototype.add=function(a,b,d){this.time.hasLastValue&&.015>this.time.computeDelta(d)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(b[0]),this.scene[1].update(b[1]),this.scene[2].update(b[2]),this.time.update(d))};
a.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,
b,d){m.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var c=m.vec3.length(this.tmpDirection);0<c&&m.vec3.scale(this.tmpDirection,this.tmpDirection,1/c);return new g(a,b,d,c/this.time.filteredDelta,this.tmpDirection)};return a}();a.PanPlanarMomentumEstimator=h})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a){this.gain=
a}a.prototype.update=function(a){if(this.hasLastValue){var d=this.computeDelta(a);this.updateDelta(d)}this.lastValue=a};a.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(a.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});a.prototype.computeDelta=function(a){return a-
this.lastValue};a.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*a:a};return a}();a.FilteredFiniteDifference=h})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,f,h){this._initialVelocity=a;this._stopVelocity=f;this._friction=h;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,f){var d=this.value(a);return this.value(a+
f)-d};a.prototype.valueFromInitialVelocity=function(a,f){f=Math.min(f,this.duration);var d=1-this.friction;return a*(Math.pow(d,f)-1)/Math.log(d)};return a}();a.Momentum=h})},"esri/views/2d/navigation/actions/Pinch":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../viewpointUtils ../../../navigation/RotationMomentumEstimator ../../../navigation/ZoomMomentumEstimator".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y){return function(a){function h(b){var c=a.call(this,b)||this;c._animationTime=0;c._momentumFinished=!1;c._rotationMomentumEstimator=new l.RotationMomentumEstimator(.6,.15,.95);c._rotationDirection=1;c._zoomDirection=1;c._zoomMomentumEstimator=new y.ZoomMomentumEstimator;c._zoomOnly=null;c.zoomMomentum=null;c.rotateMomentum=null;c.viewpoint=new k({targetGeometry:new d.Point,scale:0,rotation:0});c.watch("_momentumFinished",function(a){a&&c.navigation.stop()});return c}
f(h,a);h.prototype.begin=function(a,b){this.navigation.begin();this._rotationMomentumEstimator.reset();this._zoomMomentumEstimator.reset();this._zoomOnly=null;this._previousAngle=this._startAngle=b.angle;this._previousRadius=this._startRadius=b.radius;this._previousCenter=b.center;this._updateTimestamp=null;a.constraints.rotationEnabled&&this.addToRotateEstimator(0,b.timestamp);this.addToZoomEstimator(b,1)};h.prototype.update=function(a,b){null===this._updateTimestamp&&(this._updateTimestamp=b.timestamp);
var c=b.angle,d=b.radius,e=b.center,f=Math.abs(180*(c-this._startAngle)/Math.PI),g=Math.abs(d-this._startRadius),h=this._startRadius/d;if(this._previousRadius){var k=d/this._previousRadius,l=180*(c-this._previousAngle)/Math.PI;this._rotationDirection=0<=l?1:-1;this._zoomDirection=1<=k?1:-1;a.constraints.rotationEnabled?(null===this._zoomOnly&&200<b.timestamp-this._updateTimestamp&&(this._zoomOnly=0<g-f),null===this._zoomOnly||this._zoomOnly?l=0:this.addToRotateEstimator(c-this._startAngle,b.timestamp)):
l=0;this.addToZoomEstimator(b,h);this.navigation.setViewpoint([e.x,e.y],1/k,l,[this._previousCenter.x-e.x,e.y-this._previousCenter.y])}this._previousAngle=c;this._previousRadius=d;this._previousCenter=e};h.prototype.end=function(a,b){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum();this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum();this._animationTime=0;if(this.rotateMomentum||this.zoomMomentum)this.onAnimationUpdate(a);this.navigation.end()};h.prototype.addToRotateEstimator=
function(a,b){this._rotationMomentumEstimator.add(a,.001*b)};h.prototype.addToZoomEstimator=function(a,b){this._zoomMomentumEstimator.add(b,.001*a.timestamp)};h.prototype.canZoomIn=function(a){var b=a.scale;a=a.constraints.effectiveMaxScale;return 0===a||b>a};h.prototype.canZoomOut=function(a){var b=a.scale;a=a.constraints.effectiveMinScale;return 0===a||b<a};h.prototype.onAnimationUpdate=function(a){var d=this;this.navigation.animationManager.animateContinous(a.viewpoint,function(f,g){var h=!d.canZoomIn(a)&&
1<d._zoomDirection||!d.canZoomOut(a)&&1>d._zoomDirection,k=!d.rotateMomentum||d.rotateMomentum.isFinished(d._animationTime),h=h||!d.zoomMomentum||d.zoomMomentum.isFinished(d._animationTime);g*=.001;d._momentumFinished=k&&h;if(!d._momentumFinished){var k=d.rotateMomentum?Math.abs(d.rotateMomentum.valueDelta(d._animationTime,g))*d._rotationDirection*180/Math.PI:0,h=d.zoomMomentum?Math.abs(d.zoomMomentum.valueDelta(d._animationTime,g)):1,l=c.vec2f64.create(),m=c.vec2f64.create();if(d._previousCenter){e.vec2.set(l,
d._previousCenter.x,d._previousCenter.y);b.getPaddingScreenTranslation(m,a.size,a.padding);e.vec2.add(l,l,m);var m=a.constraints,n=a.scale,p=n*h;1>h&&!m.canZoomInTo(p)?(h=n/m.effectiveMaxScale,d.zoomMomentum=null,d.rotateMomentum=null):1<h&&!m.canZoomOutTo(p)&&(h=n/m.effectiveMinScale,d.zoomMomentum=null,d.rotateMomentum=null);b.scaleAndRotateBy(f,a.viewpoint,h,k,l,a.size)}}d._animationTime+=g})};h.prototype.stopMomentumNavigation=function(){if(this.rotateMomentum||this.zoomMomentum)this.rotateMomentum&&
(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop()};m([g.property()],h.prototype,"_momentumFinished",void 0);m([g.property()],h.prototype,"viewpoint",void 0);m([g.property()],h.prototype,"navigation",void 0);return h=m([g.subclass("esri.views.2d.navigation.actions.Pinch")],h)}(g.declared(n))})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports",
"../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(h,a,f,m){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function d(d,f,e,c){void 0===d&&(d=3);void 0===f&&(f=.01);void 0===e&&(e=.95);void 0===c&&(c=12);return a.call(this,d,f,e,c)||this}f(d,a);d.prototype.add=function(d,f){if(this.value.hasLastValue){var e=this.value.lastValue;for(d-=e;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=e+d}a.prototype.add.call(this,d,f)};return d}(m.MomentumEstimator);a.RotationMomentumEstimator=
h})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/support/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),function(h,a,f,m,d,k){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,e,c,b){void 0===a&&(a=2.5);void 0===e&&(e=.01);void 0===c&&(c=.95);void 0===b&&(b=12);this.minimumInitialVelocity=a;this.stopVelocity=e;this.friction=c;this.maxVelocity=b;this.value=new d.FilteredFiniteDifference(.8);
this.time=new d.FilteredFiniteDifference(.3)}a.prototype.add=function(a,d){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;if(this.value.hasFilteredDelta){var c=this.value.computeDelta(a);0>this.value.filteredDelta*c&&this.value.reset()}}this.time.update(d);this.value.update(a)};a.prototype.reset=function(){this.value.reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var a=this.value.filteredDelta/this.time.filteredDelta,
a=m.clamp(a,-this.maxVelocity,this.maxVelocity);return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,d,c){return new k.Momentum(a,d,c)};return a}();a.MomentumEstimator=h})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(h,a,f,m,d){Object.defineProperty(a,"__esModule",{value:!0});var k=function(a){function d(d,
c,b){return a.call(this,d,c,b)||this}f(d,a);d.prototype.value=function(d){d=a.prototype.value.call(this,d);return Math.exp(d)};d.prototype.valueDelta=function(d,c){var b=a.prototype.value.call(this,d);d=a.prototype.value.call(this,d+c);return Math.exp(d-b)};return d}(m.Momentum);a.ZoomMomentum=k;h=function(a){function d(d,c,b,f){void 0===d&&(d=2.5);void 0===c&&(c=.01);void 0===b&&(b=.95);void 0===f&&(f=12);return a.call(this,d,c,b,f)||this}f(d,a);d.prototype.add=function(d,c){a.prototype.add.call(this,
Math.log(d),c)};d.prototype.createMomentum=function(a,c,b){return new k(a,c,b)};return d}(d.MomentumEstimator);a.ZoomMomentumEstimator=h})},"esri/views/2d/navigation/actions/Rotate":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../viewpointUtils".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b){var l=c.vec2f64.create(),y=c.vec2f64.create();return function(a){function h(b){b=a.call(this,b)||this;b._previousCenter=c.vec2f64.create();b.viewpoint=new k({targetGeometry:new d.Point,scale:0,rotation:0});return b}f(h,a);h.prototype.begin=function(a,b){this.navigation.begin();e.vec2.set(this._previousCenter,b.center.x,b.center.y)};h.prototype.update=function(a,c){var d=a.state,f=d.size,d=d.padding;e.vec2.set(l,c.center.x,c.center.y);b.getAnchor(y,f,d);a.viewpoint=
b.rotateBy(this.viewpoint,a.content.viewpoint,b.angleBetween(y,this._previousCenter,l));e.vec2.copy(this._previousCenter,l)};h.prototype.end=function(a,b){this.navigation.end()};m([g.property()],h.prototype,"viewpoint",void 0);m([g.property()],h.prototype,"navigation",void 0);return h=m([g.subclass("esri.views.2d.actions.Rotate")],h)}(g.declared(n))})},"esri/views/2d/engine/magnifier/MagnifierView2D":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/screenUtils ../DisplayObject ../webgl/enums ../webgl/shaders/MagnifierPrograms ../../../3d/support/imageUtils ../../../webgl/BufferObject ../../../webgl/programUtils ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(h,a,f,m,d,k,n,g,e,c,b,l,y,v){Object.defineProperty(a,"__esModule",{value:!0});var z=m.getLogger("esri.views.2d.engine.webgl.magnifier.Magnifier");m=function(a){function m(){var b=null!==a&&a.apply(this,arguments)||this;b._maskPath=h.toUrl("../../../../images/magnifier/mask.png");b._overlayPath=h.toUrl("../../../../images/magnifier/overlay.png");b.visible=!1;return b}f(m,a);m.prototype.destroy=function(){this._readbackTexture&&(this._readbackTexture.dispose(),this._readbackTexture=null,this._maskTexture.dispose(),
this._maskTexture=null,this._overlayTexture.dispose(),this._overlayTexture=null,this._vertexArrayObject.dispose(),this._vertexArrayObject=null,this._program.dispose(),this._program=null)};Object.defineProperty(m.prototype,"magnifier",{get:function(){return this._magnifier},set:function(a){var b=this;this._magnifier=a;this._handle&&this._handle.remove();this._handle=a.watch("version",function(){b.visible=a.visible;b.requestRender()});this.visible=a.visible;this.requestRender()},enumerable:!0,configurable:!0});
m.prototype.doRender=function(a){var b=this.stage.context;if(a.drawPhase===g.WGLDrawPhase.MAP&&this._updateRessources(b)){var c=this._magnifier,d=1/c.factor,e=Math.ceil(d*this.overlay.width),f=Math.ceil(d*this.overlay.height),h=a.state.size,l=a.pixelRatio,d=l*h[0];a=l*h[1];var m=c.position||{x:.5*h[0],y:.5*h[1]},h=l*m.x,l=a-l*m.y,m=.5*e,n=.5*f;m>h?h=m:h>=d-m&&(h=d-m-1);n>l?l=n:l>=a-n&&(l=a-n-1);var m=h-m,n=l-n,p=this._readbackTexture;b.bindTexture(p,0);b.gl.copyTexImage2D(p.descriptor.target,0,p.descriptor.pixelFormat,
m,n,e,f,0);e=(e=this.stage.background&&this.stage.background.color)?[e.a*e.r/255,e.a*e.g/255,e.a*e.b/255,e.a]:[1,1,1,1];f=-1+2*((h+k.pt2px(c.offsetX))/d);c=-1+2*((l-k.pt2px(c.offsetY))/a);d=this.overlay.width/d*2;a=this.overlay.height/a*2;h=this._program;b.bindVAO(this._vertexArrayObject);b.bindTexture(this._overlayTexture,6);b.bindTexture(this._maskTexture,7);b.bindProgram(h);h.setUniform4fv("u_background",e);h.setUniform1i("u_readbackTexture",0);h.setUniform1i("u_overlyTexture",6);h.setUniform1i("u_maskTexture",
7);h.setUniform2f("u_drawPos",f,c);h.setUniform1f("u_width",d);h.setUniform1f("u_height",a);b.drawArrays(5,0,4);b.bindVAO()}};m.prototype._updateRessources=function(a){var f=this;if(!this._resourcePromise){a=void 0;a=this.mask?d.resolve():c.requestImage(this._maskPath).then(function(a){return f.mask=a});var g=void 0,g=this.overlay?d.resolve():c.requestImage(this._overlayPath).then(function(a){return f.overlay=a});this._resourcePromise=d.all([a,g]).then(function(){f.requestRender()});this.requestRender();
return!1}if(!this._resourcePromise.isResolved())return this.requestRender(),!1;var h=1/this._magnifier.factor,g=Math.ceil(h*this.overlay.width),h=Math.ceil(h*this.overlay.height);if(this._readbackTexture&&this._readbackTexture.descriptor.width===g&&this._readbackTexture.descriptor.height===h)return!0;if(this.overlay.width!==this.mask.width||this.overlay.height!==this.mask.height)return z.error("Overlay and mask images must have the same size"),!1;if(!this._program){var k=l.createProgram(a,e.magnifier);
if(!k)return!1;this._program=k}this._vertexArrayObject||(k=new Uint16Array([0,1,0,0,1,1,1,0]),this._vertexArrayObject=new v(a,e.magnifier.attributes,{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:b.createVertex(a,35044,k)}));this._overlayTexture||(this._overlayTexture=new y(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.overlay));this._maskTexture||(this._maskTexture=new y(a,{target:3553,
pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.mask));this._readbackTexture=new y(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:g,height:h});return!0};return m}(n.DisplayObject);a.default=m})},"esri/views/2d/engine/webgl/shaders/MagnifierPrograms":function(){define(["require","exports","./sources/resolver"],function(h,a,f){Object.defineProperty(a,"__esModule",{value:!0});a.magnifier=
{name:"magnifier",shaders:{vertexShader:f.resolveIncludes("magnifier/magnifier.vert"),fragmentShader:f.resolveIncludes("magnifier/magnifier.frag")},attributes:{a_pos:0}}})},"*noref":1}});
define("require exports ./engine/Stage ./LabelManager ./layers/support/GraphicsView2D ./navigation/MapViewNavigation ./engine/magnifier/MagnifierView2D".split(" "),function(h,a,f,m,d,k,n){Object.defineProperty(a,"__esModule",{value:!0});a.Stage=f.Stage;a.LabelManager=m.default;a.GraphicsView2D=d.default;a.MapViewNavigation=k.default;a.MagnifierView2D=n.default});