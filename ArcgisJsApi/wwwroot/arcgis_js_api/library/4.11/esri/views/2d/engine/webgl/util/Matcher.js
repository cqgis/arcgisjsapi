// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../../../core/Logger","../Utils"],function(g,l,n,m,p){Object.defineProperty(l,"__esModule",{value:!0});var q=m.getLogger("esri/views/2d/engine/webgl/util/Matcher");g=function(){function e(){this._defaultResult=null}e.fromBasicRenderer=function(b,a,f){var d=b.getSymbols(),h=new e;d.length&&(b=a.createTemplateGroup(d[0],null,b,f),h.setDefault(b));return h};e.prototype.size=function(){return 1};e.prototype.getDefault=function(){return this._defaultResult};
e.prototype.setDefault=function(b){this._defaultResult=b};e.prototype.match=function(b,a,f){return this.getDefault()};return e}();l.default=g;m=function(e){function b(a,f,d,h,b){var c=e.call(this)||this;c._intervals=[];c._isMaxInclusive=f;h?c._getValue=p.createArcadeFunction(h,b):a&&a.length?"function"===typeof a?(c._field=null,c._getValue=a):(c._field=a,c._normalizationInfo=d,c._getValue=c._getValueFromField.bind(c)):c._field=null;return c}n(b,e);b.fromCBRenderer=function(a,f,d){for(var h=new b(a.field,
a.isMaxInclusive,{normalizationField:a.normalizationField,normalizationTotal:a.normalizationTotal,normalizationType:a.normalizationType},a.valueExpression,d),c=a.backgroundFillSymbol,e=0,k=a.classBreakInfos;e<k.length;e++){var g=k[e],l=f.createTemplateGroup(g.symbol,c,a,d);h.add({min:g.minValue,max:g.maxValue},l)}if(e=a.defaultSymbol)a=f.createTemplateGroup(e,c,a,d),h.setDefault(a);return h};b.prototype.add=function(a,f){this._intervals.push({interval:a,result:f});this._intervals.sort(function(a,
f){return a.interval.min-f.interval.min})};b.prototype.size=function(){return e.prototype.size.call(this)+this._intervals.length};b.prototype.match=function(a,f,d){if(!this._getValue)return this.getDefault();a=this._getValue(a,f,d);if(!a&&(null===a||void 0===a||isNaN(a)))return this.getDefault();for(f=0;f<this._intervals.length;f++){var b=this._intervals[f];d=b.interval;var b=b.result,c=this._isMaxInclusive?a<=d.max:a<d.max;if(a>=d.min&&c)return b}return this.getDefault()};b.prototype._needsNormalization=
function(){var a=this._normalizationInfo;return a&&(a.normalizationField||a.normalizationTotal||a.normalizationType)};b.prototype._getValueFromField=function(a){var f=a.attributes[this._field];if(!this._needsNormalization())return f;var d=this._normalizationInfo,b=d.normalizationField,c=d.normalizationTotal,d=d.normalizationType;a=!!b&&a.attributes[b];if(d)switch(d){case "field":return(a||void 0)&&f/a;case "log":return Math.log(f)*Math.LOG10E;case "percent-of-total":return f/c*100;default:q.error("Found unknown normalization type: "+
d)}else q.error("Normalization is required, but no type was set!")};return b}(g);l.IntervalMatcher=m;g=function(e){function b(a,b,d,h){var c=e.call(this)||this;c._resultsMap=new Map;d?c._getValue=p.createArcadeFunction(d,h):a&&a.length?"function"===typeof a[0]?(c._fields=null,c._getValue=a[0]):(c._fields=a,c._seperator=b||"",c._getValue=c._getValueFromFields.bind(c)):c._fields=null;return c}n(b,e);b.fromUVRenderer=function(a,f,d){var e=a.uniqueValueInfos,c=a.fieldDelimiter,g=a.valueExpression,k=[a.field];
a.field2&&k.push(a.field2);a.field3&&k.push(a.field3);for(var l=a.backgroundFillSymbol,c=new b(k,c,g,d),g=0;g<e.length;g++){var k=e[g],m=f.createTemplateGroup(k.symbol,l,a,k);c.add(k.value,m)}a.defaultSymbol&&(a=f.createTemplateGroup(a.defaultSymbol,l,a,d),c.setDefault(a));return c};b.prototype.add=function(a,b){this._resultsMap.set(a.toString(),b)};b.prototype.size=function(){return e.prototype.size.call(this)+this._resultsMap.size};b.prototype.match=function(a,b,d){if(!this._getValue)return this.getDefault();
a=this._getValue(a,b,d);if(!a&&(null===a||void 0===a))return this.getDefault();a=a.toString();return this._resultsMap.has(a)?this._resultsMap.get(a):this.getDefault()};b.prototype._getValueFromFields=function(a){for(var b=[],d=0,e=this._fields;d<e.length;d++)b.push(a.attributes[e[d]]);return b.join(this._seperator)};return b}(g);l.MapMatcher=g});