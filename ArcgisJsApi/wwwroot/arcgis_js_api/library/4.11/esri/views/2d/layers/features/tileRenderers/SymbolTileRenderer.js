// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/webgl/rendererInfoUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../Graphic ../../../../arcade/Feature ../../../../support/arcadeUtils ./enums ./visualVariablesUtils".split(" "),function(v,l,w,t,x,k,r,y){function h(c,g,h){if(!c)return null;var u=0,f={};c=c.clone();var a=c.visualVariables,b=null;if("simple"!==c.type&&"dot-density"!==c.type){var z=c.valueExpression;if(!c.field&&z){var d="$$fake"+u++,A=k.createFunction(z);
f[d]=function(a,b){e.repurposeFromGraphicLikeObject(a.geometry,a.attributes,h);return k.executeFunction(A,{vars:{$feature:e,$view:k.getViewInfo(b)},spatialReference:g})};c.field=d;c.valueExpression=null;b=function(a,b){b.attributes[d]=f[d](b);return a.valueExpression?a.getSymbol(t.fromJSON(b)):a.getSymbol(b)}}}a&&(c.visualVariables=a.map(function(a){var b="size"===a.type&&a.valueExpression&&"$view.scale"===a.valueExpression;if(a.normalizationField){var c=a.field,d=a.normalizationField,b="$$fake"+
u++;f[b]=function(a,m){return a.attributes[c]/a.attributes[d]};a=a.clone();a.field=b;a.normalizationField=null;return a}if(a.valueExpression&&!b){var z=a.valueExpression,b="$$fake"+u++,m=k.createFunction(z);f[b]=function(a,b){e.repurposeFromGraphicLikeObject(a.geometry,a.attributes,h);return k.executeFunction(m,{vars:{$feature:e,$view:k.getViewInfo(b)},spatialReference:g})};a=a.clone();a.field=b;a.valueExpression=null}return a}));return{renderer:c,normalizingFunctions:f,getSymbolFunction:b}}Object.defineProperty(l,
"__esModule",{value:!0});var e=new x;l.createRendererInfo=function(c,g,e){var u=(g=h(c,g,e)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null},g.normalizingFunctions),f=g&&g.getSymbolFunction;c=g&&g.renderer||c;g=y.convertVisualVariables(c.visualVariables);return{renderer:c,vvFields:g.vvFields,vvRanges:g.vvRanges,getValue:function(a,b){var c=u[b];return c?c(a):a.attributes[b]},getSymbol:function(a){return f?f(this.renderer,a):this.renderer.getSymbol?this.renderer.getSymbol.call(this.renderer,
a):null}}};l.getNormalizedRenderer=function(c,g,e){return(g=h(c,g,e)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null},g.renderer)||c};l.getSymbol=function(c,g){return c.getSymbol(g)};l.isRendererWebGLCompatible=function(c){if(!c||-1===["simple","class-breaks","unique-value","heatmap"].indexOf(c.type))return!1;if("visualVariables"in c&&c.visualVariables){var g=0;for(c=c.visualVariables;g<c.length;g++){var e=c[g];switch(e.type){case "color":case "opacity":if(e.stops&&8<e.stops.length)return!1;
break;case "size":if(y.getTypeOfSizeVisualVariable(e)===r.WGLVVFlag.SIZE_FIELD_STOPS&&e.stops&&6<e.stops.length)return!1}}}return!0}})},"esri/views/2d/engine/webgl/WGLFeatureView":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/promiseUtils ../../../../geometry/Point ../Container ../../engine/webgl/TileData ./enums ./Utils ./WGLRendererInfo".split(" "),function(v,
l,w,t,x,k,r,y,h,e,c,g,u){Object.defineProperty(l,"__esModule",{value:!0});v=function(h){function f(a){var b=h.call(this)||this;b._rendererInfo=new u;b._pointToCallbacks=new Map;b._invisibleFeatures=new Set;b._displayWidth=0;b._displayHeight=0;b.layer=null;b.tileInfoView=a.tileInfoView;b.layer=a.layer;b._layerView=a.layerView;return b}t(f,h);f.prototype.dispose=function(){this.removeAllChildren();for(var a=0,b=this.children;a<b.length;a++)b[a].dispose()};f.prototype.disposeWebGLResources=function(){for(var a=
0,b=this.children;a<b.length;a++)b[a].clear()};f.prototype.displayWidth=function(){return this._displayWidth};Object.defineProperty(f.prototype,"displayHeight",{get:function(){return this._displayHeight},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"visualVariablesInfo",{get:function(){return this._visualVariablesInfo},set:function(a){this._visualVariablesInfo=a;this.requestRender()},enumerable:!0,configurable:!0});f.prototype.hitTest=function(a,b){var c=this,d=[a,b];return k.create(function(a,
b){c._pointToCallbacks.set(d,{resolve:a,reject:b});c.requestRender()},function(){c._pointToCallbacks.has(d)&&c._pointToCallbacks.delete(d)})};f.prototype.setFilterFlag=function(a,b,c,d){void 0===d&&(d=!0);if(d){b||(b=[]);c||(c=[]);d=this._invisibleFeatures;a=0;for(var e=b;a<e.length;a++){var g=e[a];d.has(g)&&d.delete(g)}a=0;for(e=c;a<e.length;a++)d.add(e[a]);a=0;for(e=this.children;a<e.length;a++)d=e[a],d.data&&d.setFilterFlag(0,b,c)}else for(e=0,g=this.children;e<g.length;e++)d=g[e],d.data&&d.setFilterFlag(a,
b,c)};f.prototype.whenAttached=function(){var a=this;return this.attached?k.resolve():k.create(function(b){return a.once("attached",function(){return b()})})};f.prototype.getMaterialItems=function(a){var b=this;return this.whenAttached().then(function(){if(b.stage&&a&&0!==a.length){for(var c=[],e=b.stage.painter.textureManager,g=0;g<a.length;g++){var f=a[g];c.push(e.rasterizeItem(f.symbol,f.glyphIds))}return r.all(c).then(function(b){return b.map(function(b,c){return{id:a[c].id,mosaicItem:b}})})}})};
f.prototype.onTileData=function(a,b){var c=!(!this.layer.labelingInfo||!this.layer.labelingInfo.length),d=b.addOrUpdate&&e.decode(b.addOrUpdate);b=w({},b,{addOrUpdate:d});a.setData(b,c,this.layer.labelsVisible);a.resetVisibility(this._invisibleFeatures);a.buildHLList(this._layerView.highlightIDs);this.contains(a)||this.addChild(a);this.requestRender();this._layerView&&this._layerView.view.labelManager.requestUpdate()};f.prototype.onTileError=function(a){a.clear();a.buildHLList(this._layerView.highlightIDs);
this.contains(a)||this.addChild(a);this.requestRender()};f.prototype.addChild=function(a){var b=h.prototype.addChild.call(this,a);this.layer.labelingInfo&&this._layerView&&this._layerView.view.labelManager.addTile(this.layer.uid,a);this._buildHLList();return b};f.prototype.removeChild=function(a){var b=h.prototype.removeChild.call(this,a);this.layer.labelingInfo&&this._layerView&&this._layerView.view.labelManager.removeTile(this.layer.uid,a.key.id);this._buildHLList();return b};f.prototype.renderChildren=
function(a){var b=this,e=this.stage.painter;this._updateTilesTransform(a.state,this.tileInfoView.getClosestInfoForScale(a.state.scale).level);this._rendererInfo.update(a.state,this.layer.renderer,this._visualVariablesInfo.vvRanges,this._layerView.effects);var d=this.tileInfoView.getClosestInfoForScale(a.state.scale).level,g=this.tileInfoView.tileInfo.scaleToZoom(a.state.scale),f=w({},a,{rendererInfo:this._rendererInfo,requiredLevel:d,displayLevel:g,context:this.stage.context,painter:this.stage.painter});
this.sortChildren(function(a,b){return 0!==a.key.level-b.key.level?a.key.level-b.key.level:0!==a.key.row-b.key.row?a.key.row-b.key.row:a.key.col-b.key.col});a=f.drawPhase;if(a&(c.WGLDrawPhase.LABEL|c.WGLDrawPhase.LABEL_ALPHA)){d=this.layer;if(!(d.labelsVisible&&d.labelingInfo&&0<d.labelingInfo.length))return;this._updateTilesTransform(f.state,f.requiredLevel)}e.draw(f,this.children,a,this._painterOptions);0<this._layerView.highlightIDs.size&&e.highlight(f,this.children);this._pointToCallbacks.forEach(function(a,
c){a.resolve(b._hitTest(f,c[0],c[1]))});this._pointToCallbacks.clear();this._layerView.effects&&this._layerView.effects.some(function(a){return x.isSome(a)&&!a.done})&&this.requestRender()};f.prototype.updateHighlight=function(){this._buildHLList()};f.prototype._hitTest=function(a,b,e){var d=this.stage,f=d.painter,d=d.context,h=a.requiredLevel,k=[0,0];a.state.toMap(k,[b,e]);b=a.state.clone();e=b.viewpoint.clone();e.targetGeometry=new y(k[0],k[1],a.state.spatialReference);b.viewpoint=e;b.size=[g.C_HITTEST_SEARCH_SIZE,
g.C_HITTEST_SEARCH_SIZE];this._updateTilesTransform(b,h);return f.hitTest({globalOpacity:1,painter:f,context:d,drawPhase:c.WGLDrawPhase.HITTEST,pixelRatio:a.pixelRatio,displayLevel:a.displayLevel,rendererInfo:this._rendererInfo,requiredLevel:h,state:b,stationary:a.stationary},this.children)};f.prototype._updateTilesTransform=function(a,b){b=0;for(var c=this.children;b<c.length;b++){var e=c[b],f=this.tileInfoView.tileInfo.lods[e.key.level].resolution;e.setTransform(a,f/(a.resolution*a.pixelRatio));
e.setLabelTransform(a,f)}};f.prototype._buildHLList=function(){for(var a=0,b=this.children;a<b.length;a++)b[a].buildHLList(this._layerView.highlightIDs);this.requestRender()};return f}(h.Container);l.default=v})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Accessor ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators".split(" "),
function(v,l,w,t,x,k,r){Object.defineProperty(l,"__esModule",{value:!0});v=function(k){function h(e){e=k.call(this)||this;e.tiles=new Map;e.layer=null;return e}w(h,k);h.prototype.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.configuration=this.tiles=null};Object.defineProperty(h.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!0,configurable:!0});h.prototype.acquireTile=function(e){var c=this,g=this.createTile(e);g.once("isReady",
function(){return c.notifyChange("updating")});this.tiles.set(e.id,g);return g};h.prototype.forEachTile=function(e){this.tiles.forEach(e)};h.prototype.releaseTile=function(e){this.tiles.delete(e.key.id);this.disposeTile(e)};h.prototype.isUpdating=function(){var e=!0;this.tiles.forEach(function(c){e=e&&c.isReady});return!e};h.prototype.requestUpdate=function(){this.layerView.requestUpdate()};t([r.property()],h.prototype,"configuration",void 0);t([r.property()],h.prototype,"layer",void 0);t([r.property()],
h.prototype,"layerView",void 0);t([r.property()],h.prototype,"tileInfoView",void 0);t([r.property()],h.prototype,"updating",null);return h=t([r.subclass()],h)}(r.declared(x,k));l.default=v})},"*noref":1}});
define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/assignHelper ../../../../../renderers ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../geometry/support/aaBoundingRect ../../../../../renderers/support/diffUtils ../../../../../support/arcadeUtils ../../../engine/webgl/rendererInfoUtils ../../../engine/webgl/visualVariablesUtils ../../../engine/webgl/WGLFeatureView ../../../engine/webgl/WGLTile ./BaseTileRenderer".split(" "),function(v,
l,w,t,x,k,r,y,h,e,c,g,u,C,f,a,b,z,d){function A(a){for(var b in a.diff){var m=a.diff[b];if("partial"===m.type&&A(m)||"complete"===m.type&&"valueExpression"===b)return!0}return!1}function D(a){for(var b in a.diff){var m=a.diff[b];if("collection"===m.type){if(0!==m.changed.length||0!==m.added.length||0!==m.removed.length)return!0}else if("visualVariables"!==b&&"authoringInfo"!==b||"visualVariables"===b&&("complete"===m.type||A(m)))return!0}return!1}function E(a){if(!("visualVariables"in a&&a.visualVariables&&
a.visualVariables.length))return a;a=a.clone();var b=a.visualVariables.map(function(a){if(("size"===a.type||"color"===a.type||"opacity"===a.type)&&null!=a.stops){var b;var m=a.type;b=a.stops;if(!(8>=b.length))if(F.warn("Found "+b.length+" Visual Variable stops, but MapView only supports 8. Displayed stops will be simplified."),16<b.length){for(var c=b[0],f=b.slice(1),g=f.pop(),d=f[0].value,h=f[f.length-1].value,k=(h-d)/6,B=[];d<h;d+=k){for(var n=0;d>=f[n].value;)n++;var p=f[n],l=b[n-1],q=d-l.value,
p=p.value===l.value?1:q/(p.value-l.value);"color"===m?(l=f[n],n=b[n-1],q=l.color.clone(),q.r=(1-p)*n.color.r+p*q.r,q.g=(1-p)*n.color.g+p*q.g,q.b=(1-p)*n.color.b+p*q.b,q.a=(1-p)*n.color.a+p*q.a,B.push({value:d,color:q,label:l.label})):"size"===m?(l=f[n],q=b[n-1],n=e.toPt(l.size),q=e.toPt(q.size),B.push({value:d,size:(1-p)*q+p*n,label:l.label})):(l=f[n],B.push({value:d,opacity:(1-p)*b[n-1].opacity+p*l.opacity,label:l.label}))}b=[c].concat(B,[g])}else{m=b[0];b=b.slice(1);for(c=b.pop();6<b.length;){g=
f=0;for(h=1;h<b.length;h++)k=Math.abs(b[h].value-b[h-1].value),k>g&&(g=k,f=h);b.splice(f,1)}b=[m].concat(b,[c])}a.stops=b}return a});a.visualVariables=b;return a}Object.defineProperty(l,"__esModule",{value:!0});var F=y.getLogger("esri.views.2d.layers.features.tileRenderer.SymbolTileRenderer");v=function(e){function d(a){return e.call(this)||this}w(d,e);d.prototype.createTile=function(a){var b=g.create();this.tileInfoView.getTileBounds(b,a);return new z(a,b)};d.prototype.disposeTile=function(a){this.featuresView.removeChild(a)};
d.prototype.updateHighlight=function(){this.featuresView.updateHighlight()};d.prototype.hitTest=function(a,b){return this.featuresView.hitTest(a,b)};d.prototype.supportsRenderer=function(a){return null!=a&&-1!==["simple","class-breaks","unique-value","dot-density"].indexOf(a.type)};d.prototype.getProcessorConfiguration=function(){var a=this.layer,b=a.definitionExpression,c=a.gdbVersion,d=a.historicMoment,a=a.labelingInfo,e=this.layerView.availableFields,f=E(this.layer.renderer);return{type:"symbol",
renderer:f.toJSON(),devicePixelRatio:window.devicePixelRatio||1,definitionExpression:b,availableFields:e,gdbVersion:c,historicMoment:d&&d.getTime(),labelingInfo:a&&a.map(function(a){return a.toJSON()}),hasGeometryExpr:C.hasGeometryOperations(f)||a&&a.some(function(a){return C.hasGeometryOperations(a)})}};d.prototype.needsProcessorReconfiguration=function(a){var b=this.wouldClear(a),c=this.configuration;this.configuration=a;return b||c.definitionExpression!==a.definitionExpression};d.prototype.wouldClear=
function(b){var c=this.configuration;if(!c||c.availableFields.join()!==b.availableFields.join()||u.diff(c.labelingInfo,b.labelingInfo))return!0;c=this.configuration&&k.fromJSON(this.configuration.renderer)||null;if((b=b&&k.fromJSON(b.renderer)||null)&&"dot-density"===b.type)return c=c&&c.getControllerHash(),b=b&&b.getControllerHash(),c!==b;c=u.diff(c,b);if(h.isNone(c))return!1;switch(c.type){case "complete":return!0;case "partial":if(D(c))return!0;if(c.diff.visualVariables){var c=this.featuresView.visualVariablesInfo,
d=this.tileInfoView.tileInfo.spatialReference,e={fields:this.layer.fields.map(function(a){return a.toJSON()})};b=f.getNormalizedRenderer(b,d,e);b=a.convertVisualVariables(b.visualVariables).vvFields;return u.diff(c.vvFields,b)?!0:!1}}};d.prototype.clear=function(){this.featuresView.disposeWebGLResources()};d.prototype.applyConfiguration=function(b){var c=k.fromJSON(b.renderer),d={fields:this.layer.fields.map(function(a){return a.toJSON()})},c=f.getNormalizedRenderer(c,this.tileInfoView.tileInfo.spatialReference,
d);this.configuration=b;this.featuresView.visualVariablesInfo=a.convertVisualVariables(c.visualVariables)};d.prototype.install=function(a){var c=new b.default({tileInfoView:this.tileInfoView,layer:this.layer,layerView:this.layerView});this.featuresView=c;a.addChild(c)};d.prototype.uninstall=function(a){a.removeChild(this.featuresView);this.featuresView=null};d.prototype.onTileData=function(a){var b=this.tiles.get(a.tileKey);if(b)this.featuresView.onTileData(b,a.data)};d.prototype.onTileError=function(a){if(a=
this.tiles.get(a.tileKey))this.featuresView.onTileError(a)};d.prototype.getMaterialItems=function(a){return this.featuresView.getMaterialItems(a)};d.prototype.setFilterFlag=function(a,b,c,d){this.featuresView.setFilterFlag(a,b,c,d)};return d=t([c.subclass()],d)}(c.declared(r,d.default));l.default=v});