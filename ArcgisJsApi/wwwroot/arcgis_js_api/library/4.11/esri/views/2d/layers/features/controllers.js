// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/promiseUtils".split(" "),function(e,f,l,m,n,k,c){function p(a){switch(a){case "on-demand":return c.create(function(a){return e(["./controllers/OnDemandController"],a)});case "memory":return c.create(function(a){return e(["./controllers/MemoryController"],a)});case "stream":return c.create(function(a){return e(["./controllers/StreamController"],
a)});default:return c.reject(new k("mapview-controller:bad-type","Unable to create controller for unknown type: "+a))}}Object.defineProperty(f,"__esModule",{value:!0});f.getControllerConfiguration=function(a,b){var d=a.source;b=b&&b.toJSON();if("stream"===a.type){d=a.purgeOptions;if(a=a.filter){var g={};a.geometry&&(g.geometry=a.geometry.toJSON());a.where&&(g.where=a.where);a=g}else a=null;return c.resolve({type:"stream",purgeOptions:d,filter:b,serviceFilter:a,processing:null})}if(!a.capabilities.operations.supportsQuery)return c.reject(new k("graphicscontroller:query-capability-required",
"Service requires query capabilities to be used as a feature layer",{layer:a}));if(d&&"openPorts"in d)return b={type:"memory",filter:b,processing:"processing"in a&&a.processing&&a.processing.toWorker()||null},c.resolve(b);b={type:"on-demand",gdbVersion:"gdbVersion"in a?a.gdbVersion:null,historicMoment:"historicMoment"in a&&a.historicMoment?a.historicMoment.getTime():null,processing:"processing"in a&&a.processing?a.processing.toWorker():null,filter:b};return c.resolve(b)};f.createController=function(a,
b){return n(this,void 0,void 0,function(){var c,g,e,f,h;return m(this,function(d){switch(d.label){case 0:return[4,p(a.type)];case 1:return c=d.sent().default,g=b.serviceAndViewInfo,e=b.remoteClient,f=b.tileStore,h=new c(l({},g,{configuration:a,tileStore:f,remoteClient:e})),[4,h.setFilter({index:0,filter:a.filter})];case 2:return d.sent(),[2,h]}})})}});