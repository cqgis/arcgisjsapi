// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../color ../../definitions ../../enums ../../enums ../../number ../../WGLDisplayRecord ../../materialKey/MaterialKey ./WGLMeshTemplate".split(" "),
function(v,B,E,F,G,f,C,H,u,D,x,I,w,y,g,J,z,K){Object.defineProperty(B,"__esModule",{value:!0});var A=G.getLogger("esri.views.2d.engine.webgl.WGLMeshTemplate");v=function(v){function b(h,a,c,q,m,d,e,n,l,b,f,L,r){var p=v.call(this)||this;p.geometryType=w.WGLGeometryType.MARKER;if(200<d||200<e)A.error(new F("mapview-oversized-resource","Marker size was clamped to the maximum allowed value of 200x200 pixels")),d>e?(e*=200/d,d=200):(d*=200/e,e=200);var k=D.vec2f32.create(),t=H.mat2df32.create();d=0===
d?0:Math.max(d,2);e=0===e?0:Math.max(e,2);b=(L===y.Alignment.MAP?1:0)|(b?1:0)<<1|(f?1:0)<<2;f=r.sdf?.5:1;C.mat2d.translate(t,t,D.vec2f32.fromValues(f*a,f*-c));q&&C.mat2d.rotate(t,t,3.14159265359/180*q);h=z.MarkerMaterialKey.load(z.createMaterialKey(p.geometryType,h,!1));r&&(h.sdf=r.sdf,h.pattern=!0,h.textureBinding=r.textureBinding);p._materialKey=h.data;p._fillColor=m;p._outlineColor=n;p._sizeOutlineWidth=g.i8888to32(d,e,l,b);m=Math.round(r.rect.x/4)-128;n=Math.round(r.rect.y/4)-128;l=m+Math.round(r.rect.width/
4);r=n+Math.round(r.rect.height/4);u.vec2.set(k,-.5*d,-.5*e);u.vec2.transformMat2d(k,k,t);p._offsetAndTexUpperLeft=g.i8888to32(g.i8(k[0]),g.i8(k[1]),m,n);u.vec2.set(k,.5*d,-.5*e);u.vec2.transformMat2d(k,k,t);p._offsetAndTexUpperRight=g.i8888to32(g.i8(k[0]),g.i8(k[1]),l,n);u.vec2.set(k,-.5*d,.5*e);u.vec2.transformMat2d(k,k,t);p._offsetAndTexBottomLeft=g.i8888to32(g.i8(k[0]),g.i8(k[1]),m,r);u.vec2.set(k,.5*d,.5*e);u.vec2.transformMat2d(k,k,t);p._offsetAndTexBottomRight=g.i8888to32(g.i8(k[0]),g.i8(k[1]),
l,r);p.height=e;p.width=d;p.xOffset=a;p.yOffset=c;return p}E(b,v);b.fromCIMMarker=function(h,a,c){var q=x.premultiplyAlphaRGBA(a.color),m=x.premultiplyAlphaRGBA(a.outlineColor),d=Math.round(f.pt2px(a.size)),e=Math.round(f.pt2px(a.size/c.height*c.width)),n=Math.round(f.pt2px(a.offsetX||0)),l=Math.round(f.pt2px(a.offsetY||0)),g=Math.round(f.pt2px(a.outlineWidth||0));return new b(h,n,l,a.rotation||0,q,e,d,m,g,a.colorLocked,!1,a.alignment||y.Alignment.SCREEN,c)};b.fromPictureMarker=function(h,a,c){var q=
Math.round(f.pt2px(a.width)),m=Math.round(f.pt2px(a.height)),d=I.PICTURE_FILL_COLOR,e=Math.round(f.pt2px(a.xoffset||0)),n=Math.round(f.pt2px(a.yoffset||0));return new b(h,e,n,a.angle,d,q,m,0,0,!1,!1,y.Alignment.SCREEN,c)};b.fromSimpleMarker=function(h,a,c){var q=x.premultiplyAlphaRGBA(a.color),m=Math.round(f.pt2px(a.size)),d=Math.round(f.pt2px(a.xoffset||0)),e=Math.round(f.pt2px(a.yoffset||0)),n=a.style,l=a.outline,g=(l&&l.color&&x.premultiplyAlphaRGBA(l.color))|0,l=(l&&l.width&&Math.round(f.pt2px(l.width)))|
0;return new b(h,d,e,a.angle,q,m,m,g,l,!1,"cross"===n||"x"===n,y.Alignment.SCREEN,c)};b.prototype.writeMesh=function(h,a,c,q,m,d,e,n){d=z.MarkerMaterialKey.load(this._materialKey);var l=a.indexVector,f=a.get("geometry"),g=a.get("visibility"),b=new J(q,this.geometryType,this._materialKey);a=a.getVector("geometry").vertexCount;h.push(b);b.vertexFrom=a;b.indexFrom=l.length;switch(c){case "esriGeometryPoint":c=m.geometry;h=c.x;c=c.y;this._writeVertices(b,f,g,q,this._getPos(h,c),d,e,n);this._writeIndices(b,
l,a);break;case "esriGeometryPolyline":this._writeMany(b,l,f,g,a,q,m.geometry.paths[0],d,e,n);break;case "esriGeometryPolygon":(c=m.centroid)?(h=c.x,c=c.y,this._writeVertices(b,f,g,q,this._getPos(h,c),d,e,n),this._writeIndices(b,l,a)):A.error("Tried to render polygon geometries as markers, but found no centroid!");break;case "esriGeometryMultipoint":this._writeMany(b,l,f,g,a,q,m.geometry.points,d,e,n);break;default:A.error("Unable to handle geometryType: "+c)}};b.prototype._getPos=function(h,a){return g.i1616to32(h,
a)};b.prototype._writeMany=function(h,a,c,b,m,d,e,n,f,g){for(var l=0,q=0,r=0,p=0;p<e.length;p++){var k=e[p],t=k[0],k=k[1],u=this._getPos(t+l,k+q);this._writeVertices(h,c,b,d,u,n,f,g);this._writeIndices(h,a,m+r);l+=t;q+=k;r+=4}};b.prototype._writeVertices=function(h,a,c,b,f,d,e,g){a.push(f);a.push(this._offsetAndTexUpperLeft);a.push(b);a.push(this._fillColor);a.push(this._outlineColor);a.push(this._sizeOutlineWidth);this._writeVV(a,e,d);c.push(g);a.push(f);a.push(this._offsetAndTexUpperRight);a.push(b);
a.push(this._fillColor);a.push(this._outlineColor);a.push(this._sizeOutlineWidth);this._writeVV(a,e,d);c.push(g);a.push(f);a.push(this._offsetAndTexBottomLeft);a.push(b);a.push(this._fillColor);a.push(this._outlineColor);a.push(this._sizeOutlineWidth);this._writeVV(a,e,d);c.push(g);a.push(f);a.push(this._offsetAndTexBottomRight);a.push(b);a.push(this._fillColor);a.push(this._outlineColor);a.push(this._sizeOutlineWidth);this._writeVV(a,e,d);c.push(g);h.vertexCount+=4};b.prototype._writeVV=function(b,
a,c){c.hasVV()&&(b.push(a[w.VVType.SIZE]),b.push(a[w.VVType.COLOR]),b.push(a[w.VVType.OPACITY]),b.push(a[w.VVType.ROTATION]))};b.prototype._writeIndices=function(b,a,c){a.push(c+0);a.push(c+1);a.push(c+2);a.push(c+1);a.push(c+3);a.push(c+2);b.indexCount+=6};return b}(K.default);B.default=v});