// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../geometry/Extent ../../../layers/support/ExportWMSImageParameters ./DynamicLayerView3D ../../layers/WMSLayerView".split(" "),function(q,r,g,f,h,k,d,l,m,n,p){return function(e){function a(){return null!==e&&e.apply(this,arguments)||this}g(a,e);a.prototype.initialize=function(){var a=this;this.layer.supportsSpatialReference(this.view.spatialReference)||
this.addResolvingPromise(k.reject(new h("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view")));this._exportWMSImageParameters=new m({layer:this.layer});this.handles.add(this._exportWMSImageParameters.watch("version",function(b){a._imageVersion!==b&&(a._imageVersion=b,a.refetch())}))};a.prototype.destroy=function(){this._exportWMSImageParameters&&(this._exportWMSImageParameters.layer=null,this._exportWMSImageParameters.destroy(),
this._exportWMSImageParameters=null)};a.prototype.createFetchPopupFeaturesQuery=function(a){var b=this.findExtentInfoAt(a),c=b.extent,c=new l(c[0],c[1],c[2],c[3],b.spatialReference),b=b.imageSize,d=b.width,e=c.width/d;return{extent:c,width:d,height:b.height,x:Math.round((a.x-c.xmin)/e),y:Math.round((c.ymax-a.y)/e)}};a.prototype.beforeFetch=function(){this._imageVersion=this._exportWMSImageParameters.version};f([d.property({dependsOn:["view.spatialReference","layer.spatialReferences"]})],a.prototype,
"suspended",void 0);return a=f([d.subclass("esri.views.3d.layers.WMSLayerView3D")],a)}(d.declared(n,p))});