// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/has ../../../../core/now ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./intersectorUtils".split(" "),function(t,u,v,w,l,p,k,q,n){var r=l.mat4f64.create();return function(){function d(c){this.enable=new n.EnableIntersectorOptions;this.results=new n.IntersectorResults;this.transform=new n.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};
this._ray={origin:k.vec3f64.create(),direction:k.vec3f64.create()};this._rayEndPoint=k.vec3f64.create();this._rayStartPointTransformed=k.vec3f64.create();this._rayEndPointTransformed=k.vec3f64.create();this.viewingMode=c||"global"}Object.defineProperty(d.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"rayEndPoint",
{get:function(){return this._rayEndPoint},enumerable:!0,configurable:!0});d.prototype.intersect=function(c,a,f,g,d,m,k,b,h){var e=this;if(void 0===h||!0===h)this._numObjectsTested=0,q.ray.fromPoints(a,f,this._ray),this.results.init(this._ray);this.point=g;this.camera=d;this.enable.selectionMode=k;this.filterPredicate=b;this.tolerance=null==m?1E-5:m;p.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction);if(c&&0<c.length)for(a=0;a<c.length;a++)if(f=c[a],g=f.getSpatialQueryAccelerator?f.getSpatialQueryAccelerator():
void 0)f=function(a){e.intersectObject(a)},g.forEachAlongRay(this._ray.origin,this._ray.direction,f),k&&g.forEachDegenerateObject(f);else for(g=0,f=f.getObjects();g<f.length;g++)this.intersectObject(f[g]);this.sortResults()};d.prototype.intersectObject=function(c){var a=this;this._numObjectsTested++;for(var f=c.id,g=c.getGeometryRecords(),d=c.objectTransformation,k,l=function(e){e=g[e];var h=e.geometry,l=e.material,m=e.instanceParameters;if(m.hidden)return"continue";k=h.id;b.transform.setAndInvalidateLazyTransforms(d,
e.getShaderTransformation());p.vec3.transformMat4(b._rayStartPointTransformed,b._ray.origin,b.transform.inverse);p.vec3.transformMat4(b._rayEndPointTransformed,b._rayEndPoint,b.transform.inverse);var q=b.transform.transform;l.intersect(h,m,b.transform.transform,b,b._rayStartPointTransformed,b._rayEndPointTransformed,function(b,d,g,h,e,l){0<=b&&(null==a.filterPredicate||a.filterPredicate(a._ray.origin,a._rayEndPoint,b))&&(e?(null==a.results.hud.dist||b<a.results.hud.dist)&&a.results.hud.set(c,f,b,
d,r,h,l,k,g):(e=function(a){return a.set(c,f,b,d,q,h,null,k,g)},(null==a.results.min.drapedLayerOrder||h>=a.results.min.drapedLayerOrder)&&(null==a.results.min.dist||b<a.results.min.dist)&&e(a.results.min),(null==a.results.max.drapedLayerOrder||h<a.results.max.drapedLayerOrder)&&(null==a.results.max.dist||b>a.results.max.dist)&&e(a.results.max),a.enable.storeAll&&(l=new n.IntersectorResult(a._ray),e(l),a.results.all.push(l))))},e.shaderTransformation)},b=this,h=0;h<g.length;h++)l(h)};d.prototype.sortResults=
function(){this.results.all.sort(function(c,a){return c.dist!==a.dist?c.dist-a.dist:c.drapedLayerOrder!==a.drapedLayerOrder?(void 0!==c.drapedLayerOrder?c.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==a.drapedLayerOrder?a.drapedLayerOrder:Number.MAX_VALUE):(void 0!==a.drapedLayerGraphicOrder?a.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==c.drapedLayerGraphicOrder?c.drapedLayerGraphicOrder:Number.MIN_VALUE)})};d.DEFAULT_TOLERANCE=1E-5;return d}()});