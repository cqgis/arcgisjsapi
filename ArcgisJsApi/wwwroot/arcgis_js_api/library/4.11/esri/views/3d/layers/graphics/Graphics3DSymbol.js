// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./symbolComplexity ../../support/PromiseLightweight".split(" "),function(x,y,p,q,r,t,u,v){return function(m){function e(a,d,c){var b=m.call(this)||this;b._symbol=a;b.referenced=0;a=a.symbolLayers;c&&(a=c.concat(a));c=a.length;b.childGraphics3DSymbols=Array(a.length);b.childGraphics3DSymbolPromises=Array(a.length);for(var f=d.layerOrder,g=0,e=0,k=function(a,
c){c&&(b.childGraphics3DSymbols[a]=c,e++);g--;!b.isRejected()&&1>g&&(0<e?b.resolve():b.reject())},h=0;h<c;h++){var l=a.getItemAt(h);!1!==l.enabled&&(d.layerOrder=f+(1-(1+h)/c),d.layerOrderDelta=1/c,l=t.make(b.symbol,l,d,l._ignoreDrivers))&&(g++,b.childGraphics3DSymbolPromises[h]=l)}d.layerOrder=f;if(0===g)b.resolve();else{d=function(a){var b=w.childGraphics3DSymbolPromises[a];b&&b.then(function(){return k(a,b)},function(){return k(a,null)})};for(var w=this,h=0;h<c;h++)d(h)}return b}p(e,m);e.prototype.getSymbolLayerSize=
function(a,d){var c=this;this.then(function(){var b=c.childGraphics3DSymbols[a];d(b?b.getCachedSize():null)},function(){return d(null)})};Object.defineProperty(e.prototype,"symbol",{get:function(){return this._symbol},set:function(a){this._symbol=a;if(this.childGraphics3DSymbols)for(var d=0;d<a.symbolLayers.length;d++){var c=this.childGraphics3DSymbols[d];c&&(c.symbol=a,c.symbolLayer=a.symbolLayers.items[d])}},enumerable:!0,configurable:!0});e.prototype.createGraphics3DGraphic=function(a,d){for(var c=
a.graphic,b=Array(this.childGraphics3DSymbols.length),f=0;f<this.childGraphics3DSymbols.length;f++){var e=this.childGraphics3DSymbols[f];e&&(b[f]=e.createGraphics3DGraphic(a))}return new q(c,d||this,b,a.layer)};Object.defineProperty(e.prototype,"complexity",{get:function(){return u.totalSymbolComplexities(this.childGraphics3DSymbols.map(function(a){return a&&a.complexity}))},enumerable:!0,configurable:!0});e.prototype.globalPropertyChanged=function(a,d){for(var c=this.childGraphics3DSymbols.length,
b=function(b){var c=e.childGraphics3DSymbols[b],f=function(a){a=a._graphics[b];return a instanceof r?a:null};if(c&&!c.globalPropertyChanged(a,d,f))return{value:!1}},e=this,g=0;g<c;g++){var n=b(g);if("object"===typeof n)return n.value}return!0};e.prototype.applyRendererDiff=function(a,d){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(c,b,e){return c&&(!b||b.applyRendererDiff(a,d))},!0):!1};e.prototype.prepareSymbolPatch=function(a){if(!this.isRejected()&&"partial"===a.diff.type){var d=
a.diff.diff;if(d.symbolLayers&&"partial"===d.symbolLayers.type){var c=d.symbolLayers.diff;(this.isResolved()?this.childGraphics3DSymbols:this.childGraphics3DSymbolPromises).forEach(function(b,d){var e;if(b){var f=c[d];if(f){var k={diff:f,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};b.prepareSymbolLayerPatch(k);(e=a.symbolStatePatches).push.apply(e,k.symbolLayerStatePatches);k.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push(function(a,b){var c=a._graphics[d];k.graphics3DGraphicPatches.forEach(function(a){return a(c,
b)})})}}})}}};e.prototype.updateGeometry=function(a,d){for(var c=0;c<this.childGraphics3DSymbols.length;c++){var b=this.childGraphics3DSymbols[c];if(b&&!b.updateGeometry(a._graphics[c],d))return!1}return!0};e.prototype.getFastUpdateStatus=function(){var a=0,d=0,c=0;this.childGraphics3DSymbolPromises.forEach(function(b){b&&!b.isFulfilled()?a++:b&&b.isFastUpdatesEnabled()?c++:b&&d++});return{loading:a,slow:d,fast:c}};e.prototype.setDrawOrder=function(a,d){for(var c=this.childGraphics3DSymbols.length,
b=1/c,e=0;e<c;e++){var g=this.childGraphics3DSymbols[e];g&&g.setDrawOrder(a+(1-(1+e)/c),b,d)}};e.prototype.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.isFulfilled()||this.reject();for(var a=0;a<this.childGraphics3DSymbolPromises.length;a++)this.childGraphics3DSymbolPromises[a]&&this.childGraphics3DSymbolPromises[a].destroy();this.childGraphics3DSymbols=this.childGraphics3DSymbolPromises=null}};Object.defineProperty(e.prototype,
"destroyed",{get:function(){return null==this.childGraphics3DSymbols},enumerable:!0,configurable:!0});return e}(v.default)});