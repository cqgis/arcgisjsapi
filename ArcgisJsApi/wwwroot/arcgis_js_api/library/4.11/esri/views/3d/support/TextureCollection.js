// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/promiseUtils ../../../core/scheduling ../../../core/urlUtils ../webgl-engine/Stage ../webgl-engine/lib/Texture".split(" "),function(e,g,k,l,m,n,h,p){Object.defineProperty(g,"__esModule",{value:!0});e=function(){function d(a,b,c){this._streamDataSupplier=a;this._stage=b;this._textureOptions=c;this._textureRequests=new Map}d.prototype.destroy=function(){var a=this;this._textureRequests.forEach(function(b,c){return a.releaseNow(c)});
this._textureRequests=null};d.prototype.fromUrl=function(a,b){var c=this,d=this.makeUid(a,b),f=this._textureRequests.get(d);if(f)return f.referenceCount++,f.textureAsync;var e=this._streamDataSupplier.request(a,"image",d),f={referenceCount:1,texture:null,textureAsync:null};this._textureRequests.set(d,f);f.textureAsync=l.create(function(a,g){e.then(function(e){e=c.createTexture(e.url,e.data,b);f.texture=e;c.addToStage(e);a({uid:d,texture:e})},function(){return g()})},function(){e.cancel()});return f.textureAsync};
d.prototype.fromData=function(a,b){a=this.makeUid(a);var c=this._textureRequests.get(a);c||(c={referenceCount:0,texture:b(),textureAsync:null},this.addToStage(c.texture),this._textureRequests.set(a,c));c.referenceCount++;return{uid:a,texture:c.texture}};d.prototype.release=function(a){var b=this._textureRequests.get(a);b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&this.scheduleRelease(a)):console.warn("TextureCollection: texture doesn't exist: '"+
a+"'")};d.prototype.scheduleRelease=function(a){var b=this;m.schedule(function(){return b.releaseNow(a)})};d.prototype.releaseNow=function(a){if(this._textureRequests){var b=this._textureRequests.get(a);!b||0<b.referenceCount||(b.texture?this.removeFromStage(b.texture):b.textureAsync.cancel(),this._textureRequests.delete(a))}};d.prototype.createTexture=function(a,b,c){n.isSVG(a)&&(c||0===b.width&&0===b.height)&&(a=b.width?b.height/b.width:1,c=c||64,1<a?(b.width=Math.round(c/a),b.height=c):(b.width=
c,b.height=Math.round(c*a)));c=k({},this._textureOptions,{width:b.width,height:b.height,powerOfTwoResizeMode:2});return new p(b,"symbol",c)};d.prototype.addToStage=function(a){this._stage.add(h.ModelContentType.TEXTURE,a)};d.prototype.removeFromStage=function(a){this._stage.remove(h.ModelContentType.TEXTURE,a.id)};d.prototype.makeUid=function(a,b){return null!=b?a+"."+b+"px":a};return d}();g.TextureCollection=e;g.default=e});