// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),function(M,k,u,I,g,v,J,C,K,D,E,m){function F(d,a,c,f){void 0===f&&(f=D.createDirectionUp());g.vec3.cross(q,d,G);0===g.vec3.dot(q,q)&&g.vec3.cross(q,d,H);u.mat4.identity(n);
u.mat4.rotate(n,n,-m.deg2rad(a),d);u.mat4.rotate(n,n,-m.deg2rad(c),q);a=f.up;c=f.direction;g.vec3.cross(a,q,d);g.vec3.normalize(a,a);g.vec3.transformMat4(a,a,n);g.vec3.normalize(c,d);g.vec3.negate(c,c);g.vec3.transformMat4(c,c,n);return f}function A(d){var a=d[1];d[1]=-d[2];d[2]=a}function B(d,a){a=F(a,d.heading,d.tilt);d.up=a.up;return d}Object.defineProperty(k,"__esModule",{value:!0});var G=v.vec3f64.fromValues(0,0,1),H=g.vec3.normalize(v.vec3f64.create(),v.vec3f64.fromValues(1,1,1)),L=new m.Cyclical(-180,
180),n=I.mat4f64.create(),q=v.vec3f64.create(),p=v.vec3f64.create();k.headingTiltToDirectionUp=F;k.directionToHeadingTilt=function(d,a,c,f){var b=q;g.vec3.normalize(b,d);g.vec3.cross(p,b,G);0===g.vec3.dot(p,p)&&g.vec3.cross(p,b,H);g.vec3.cross(p,p,b);return D.directionToHeadingTilt(a,c,f,b,p)};k.eyeForCenterWithHeadingTilt=function(d,a,c,f){var b={eye:v.vec3f64.create(),up:null,tilt:f,heading:c},l=q;l[0]=d[0];l[1]=d[2];l[2]=-d[1];c=m.deg2rad(c);var e=m.deg2rad(f);f=Math.sin(c);c=Math.cos(c);var h=
Math.sin(e),y=Math.cos(e),w=g.vec3.length(l);if(1E-8>Math.abs(e))e=a+w;else var x=w/h,k=m.asin(a/x),e=x*Math.sin(Math.PI-e-k);var x=h*a,y=y*a,k=c*x,n=e-y,p=n*n,z=a*a*h*h,h=c*c*z,z=f*f*z,r=l[1]*n,t=h*(h+p-l[1]*l[1]);if(0>t)return g.vec3.scale(b.eye,l,e/w),b.tilt=0,b;var u=Math.sqrt(t),t=h+p,r=0<c?-u+r:u+r;if(1E-8>Math.abs(t))return 1E-8>w?(b.eye[0]=0,b.eye[1]=0,b.eye[2]=a):g.vec3.scale(b.eye,l,e/w),b.tilt=0,A(b.eye),B(b,d);b.eye[1]=r/t;t=b.eye[1]*b.eye[1];a=1-t;r=Math.sqrt(a);k=h*t+z-2*k*b.eye[1]*
r*n+a*p;if(1E-8>Math.abs(k))return g.vec3.scale(b.eye,l,e/w),b.tilt=0,A(b.eye),B(b,d);b.eye[0]=(a*(e*l[0]-y*l[0])-x*r*(l[0]*b.eye[1]*c+l[2]*f))/k;b.eye[2]=(a*(e*l[2]-y*l[2])-x*r*(l[2]*b.eye[1]*c-l[0]*f))/k;g.vec3.scale(b.eye,b.eye,e);A(b.eye);return B(b,d)};k.lookAtTiltToEyeTilt=function(d,a,c){d=g.vec3.length(d);a=m.asin(a/(Math.sqrt(a*a+d*d-2*a*d*Math.cos(Math.PI-c))/Math.sin(c)));return m.rad2deg(c-a)};k.eyeTiltToLookAtTilt=function(d,a,c){c=m.deg2rad(c);d=g.vec3.length(d);return m.asin(a/(d/Math.sin(c)))+
c};k.toExtent=function(d,a,c,f,b){function g(a){var b=Math.PI/2;a=m.cyclical2PI.normalize(a,-b);a>b&&(a=Math.PI-a);return a}var e;e=a.latitude;a=a.longitude;var h=E.getLonDeltaForDistance(a,e,c)/2;c=a-h;a+=h;e=m.deg2rad(e);h=E.earthRadius;e=(1+Math.sin(e))/(1-Math.sin(e));var k=(e+1)*Math.tan(f/h/2);e=1.5*Math.PI-2*Math.atan(.5*(k+Math.sqrt(4*e+k*k)));f=e+f/h;e=g(e);f=g(f);f<e&&(h=f,f=e,e=h);e=Math.max(m.rad2deg(e),-90);f=Math.min(m.rad2deg(f),90);a=L.monotonic(c,a);180<a-c&&(h=(a-c-180)/2,c+=h,a-=
h);b?(b.xmin=c,b.ymin=e,b.xmax=a,b.ymax=f,b.spatialReference=C.WGS84):b=new J(c,e,a,f,C.WGS84);d.spatialReference&&d.spatialReference.isWebMercator&&K.geographicToWebMercator(b,!1,b);return b}});