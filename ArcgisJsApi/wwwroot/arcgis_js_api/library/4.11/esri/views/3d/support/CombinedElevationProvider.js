// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery ./Evented".split(" "),function(t,u,l,g,v,w,m,n,f,p,q,r){return function(h){function c(a){a=h.call(this)||this;a.providers={im:[],ground:[],scene:[]};
a.handles=new Map;return a}l(c,h);c.prototype.getElevation=function(a,b){var d=-Infinity,e=!0;"scene"===b&&(d=this._updateElevation(d,this.providers.im,a,b),isFinite(d)&&(e=!1));e&&(d=this._updateElevation(d,this.providers.ground,a,b));"scene"===b&&(d=this._updateElevation(d,this.providers.scene,a,b));return isFinite(d)?d:null};c.prototype._updateElevation=function(a,b,d,e){for(var c=0;c<b.length;c++){var k=b[c].getElevation(d,e);null!=k&&(a=Math.max(k,a))}return a};c.prototype.queryElevation=function(a,
b,d){var e=this;void 0===b&&(b=0);this._elevationService||(this._elevationService=new q.ElevationQuery(this.view.spatialReference,function(){return e.view.map&&e.view.map.ground},{maximumAutoTileRequests:4}));var c=n.createResolver();(p.isPoint(a)?this._elevationService.queryElevation(a.x,a.y,b):this._elevationService.queryElevation(a[0],a[1],b)).then(function(b){"scene"===d&&(b=e._updateElevation(b,e.providers.scene,a,d));c.resolve(isFinite(b)?b:null)}).catch(function(){return c.resolve(e.getElevation(a))});
return c.promise};c.prototype.register=function(a,b){var d=this;this.handles.set(b,b.on("elevation-change",function(a){return d.emit("elevation-change",a)}));this.providers[a].push(b)};c.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,d=Object.keys(this.providers);b<d.length;b++){var c=d[b],f=this.providers[c].indexOf(a);-1<f&&this.providers[c].splice(f,1)}};g([f.property({constructOnly:!0})],c.prototype,"view",void 0);g([f.property({readOnly:!0,
aliasOf:"view.basemapTerrain.spatialReference"})],c.prototype,"spatialReference",void 0);return c=g([f.subclass("esri.views.3d.support.CombinedElevationProvider")],c)}(f.declared(m,r.Evented))});