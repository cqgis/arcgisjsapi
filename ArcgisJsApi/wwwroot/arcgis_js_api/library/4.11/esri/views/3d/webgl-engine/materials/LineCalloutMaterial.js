// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/LineCalloutPrograms ../../../webgl/renderState".split(" "),function(m,C,n,h,t,u,v,f,l,g,w,p,k){function q(c,a,b){3===b.length?c.setUniform4f(a,b[0],b[1],b[2],1):c.setUniform4fv(a,b)}m=function(c){function a(b,d){d=c.call(this,
d)||this;d.params=g.copyParameters(b,x);d._uniqueMaterialIdentifier=a.uniqueMaterialIdentifier(d.params);return d}n(a,c);Object.defineProperty(a.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});a.prototype.dispose=function(){};a.prototype.getGLMaterials=function(){return{color:y,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};a.prototype.getAllTextureIds=function(){return[]};a.prototype.intersect=function(b,
a,z,e,c,f,g,h){};a.prototype.createBufferWriter=function(){return new A};a.prototype.createRenderer=function(b,a){return new w(b,a,this)};a.prototype.setParameterValues=function(b){g.updateParameters(this.params,b)&&(this._uniqueMaterialIdentifier=a.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};a.prototype.getParameters=function(){return this.params};a.uniqueMaterialIdentifier=function(b){return JSON.stringify({screenOffset:b.screenOffset||[0,0],centerOffsetUnits:b.centerOffsetUnits||
"world"})};return a}(v);var y=function(c){function a(b,a,z){b=c.call(this,b,a)||this;b.isRenderSlot=!0;b.updateParameters();return b}n(a,c);a.prototype.updateParameters=function(){this.params=g.copyParameters(this.material.getParameters());this.selectProgram()};a.prototype.selectProgram=function(){var b=this.params;this.renderProgram=this.programRep.getProgram(p.program,{occlTest:!!b.occlusionTest,verticalOffset:!!b.verticalOffset,screenSizePerspective:!!b.screenSizePerspective,depthHud:!1,depthHudAlignStart:!!b.depthHUDAlignStart,
centerOffsetUnitsScreen:"screen"===b.centerOffsetUnits,slice:b.slicePlaneEnabled});this.depthProgram=this.programRep.getProgram(p.program,{occlTest:!!b.occlusionTest,verticalOffset:!!b.verticalOffset,screenSizePerspective:!!b.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!b.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===b.centerOffsetUnits,slice:b.slicePlaneEnabled});this.renderPipelineState=k.makePipelineState({blending:k.separateBlendingParams(1,770,771,771),depthTest:{func:513},
colorWrite:k.defaultColorWriteParams});this.depthPipelineState=k.makePipelineState({depthTest:{func:513},depthWrite:k.defaultDepthWriteParams})};a.prototype.beginSlot=function(b){switch(b){case 17:return this.isRenderSlot=!0;case 18:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(a.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0});a.prototype.getProgram=function(){return this.program};a.prototype.getPrograms=
function(){return[this.renderProgram,this.depthProgram]};a.prototype.getDrawMode=function(){return 4};a.prototype.bind=function(b,a){var d=a.cameraAboveGround?1:-1,e=this.program,c=this.params;b.bindProgram(e);e.setUniform1f("cameraGroundRelative",d);e.setUniform1f("polygonOffset",c.shaderPolygonOffset);e.setUniform4fv("viewport",a.viewport);e.setUniform1f("perDistancePixelRatio",Math.tan(a.fovY/2)/(a.viewport[2]/2));e.setUniformMatrix4fv("viewNormal",a.viewInvTransp);e.setUniform1i("hudVisibilityTexture",
0);b.bindTexture(a.hudVisibilityTexture,0);q(e,"color",c.color);d=a.pixelRatio||1;e.setUniform1f("pixelRatio",d);e.setUniform2f("screenOffset",c.screenOffset[0]*d,c.screenOffset[1]*d);this.bindBorder(b,a);g.bindVerticalOffset(c.verticalOffset,a,e);this.bindSizing(b,a);g.bindScreenSizePerspective(c.screenSizePerspective,e);this.isRenderSlot?b.setPipelineState(this.renderPipelineState):b.setPipelineState(this.depthPipelineState)};a.prototype.bindView=function(b,a){b=this.program;var d=this.params;g.bindView(a.origin,
a.view,b);g.bindCamPos(a.origin,a.viewInvTransp,b);d.slicePlaneEnabled&&g.bindSlicePlane(a.origin,a.slicePlane,b)};a.prototype.bindInstance=function(b,a){b=this.program;b.setUniformMatrix4fv("model",a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};a.prototype.release=function(a,d){};a.prototype.bindSizing=function(a,d){a=this.program;var b=this.params;a.setUniform2f("pixelToNDC",2/d.viewport[2],2/d.viewport[3]);a.setUniform1f("lineSize",Math.ceil(b.size)*(d.pixelRatio||
1))};a.prototype.bindBorder=function(a,d){a=this.program;var b=this.params;d=d.pixelRatio||1;null!==b.borderColor?(q(a,"borderColor",b.borderColor),a.setUniform1f("borderSize",d)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return a}(u),x={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},B=t.newLayout().vec3f(f.VertexAttrConstants.POSITION).vec3f(f.VertexAttrConstants.NORMAL).vec2f(f.VertexAttrConstants.UV0).vec4f(f.VertexAttrConstants.AUXPOS1),
r=[h.vec2f32.fromValues(0,0),h.vec2f32.fromValues(1,0),h.vec2f32.fromValues(0,1),h.vec2f32.fromValues(1,0),h.vec2f32.fromValues(1,1),h.vec2f32.fromValues(0,1)],A=function(){function c(){this.vertexBufferLayout=B}c.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};c.prototype.elementCount=function(a){return 6*a.indices[f.VertexAttrConstants.POSITION].length};c.prototype.write=function(a,b,d,c,e){l.writePosition(b.indices[f.VertexAttrConstants.POSITION],b.vertexAttr[f.VertexAttrConstants.POSITION].data,
a.transformation,c.position,e,6);l.writeNormal(b.indices[f.VertexAttrConstants.NORMAL],b.vertexAttr[f.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,c.normal,e,6);l.writeBufferVec4(b.indices[f.VertexAttrConstants.AUXPOS1],b.vertexAttr[f.VertexAttrConstants.AUXPOS1].data,c.auxpos1,e,6);for(a=0;a<r.length;++a)c.uv0.setVec(e+a,r[a])};return c}();return m});