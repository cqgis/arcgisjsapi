// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../Graphic ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Collection ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DHighlights ./Graphics3DScaleVisibility ./Graphics3DSpatialIndex ./graphicUtils".split(" "),
function(E,F,m,d,g,h,n,p,q,r,f,t,c,u,v,w,x,y,z,A,B,C,D){var k={remove:function(){},pause:function(){},resume:function(){}};return function(l){function a(b){b=l.call(this)||this;b.graphicsCore=null;b.elevationAlignment=new z;b.highlights=new A;b.handles=new r;b.suspendResumeExtent=null;return b}m(a,l);a.prototype.normalizeCtorArgs=function(b){var a=null;b.scaleVisibilityEnabled&&(b=g({},b),delete b.scaleVisibilityEnabled,a=new B);var e=new y({owner:b.owner,layer:b.layer,asyncUpdates:!1,graphicSymbolSupported:!0});
return g({},b,{graphicsCore:e,scaleVisibility:a})};a.prototype.initialize=function(){var b=this;this._set("spatialIndex",new C({spatialReference:this.owner.view.spatialReference}));this.scaleVisibility&&"minScale"in this.layer&&this.handles.add(this.layer.watch(["minScale","maxScale"],function(){return b.scaleVisibility.layerMinMaxScaleChangeHandler()}))};a.prototype.setup=function(){var b=this;this.elevationAlignment.setup(this.owner,function(a,e,c){return b.spatialIndex.queryGraphicUIDsInExtent(a,
e,c)},this.graphicsCore,this.view.elevationProvider);this.scaleVisibility&&"minScale"in this.layer&&this.scaleVisibility.setup(this.owner,this.layer,function(a,e,c){return b.spatialIndex.queryGraphicUIDsInExtent(a,e,c)},this.graphicsCore,this.owner.view.basemapTerrain);this.highlights&&this.highlights.setup(this.graphicsCore);this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,spatialIndex:this.spatialIndex,scaleVisibility:this.scaleVisibility,highlights:this.highlights});this.handles.add(this.view.watch("clippingArea",
function(){return b.updateClippingExtent()}));this.updateClippingExtent();this.setupSuspendResumeExtent();this.graphicsCore.startCreateGraphics()};a.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null));this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",null));this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",null));
this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null));this.highlights&&(this.highlights.destroy(),this._set("highlights",null))};Object.defineProperty(a.prototype,"suspended",{get:function(){return!(!this.scaleVisibility||!this.scaleVisibility.suspended)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0});
a.prototype.getGraphicFromGraphicUid=function(b){if(this.owner.loadedGraphics){var a=this.owner.loadedGraphics.find(function(a){return a.uid===b});if(a)return v.hydrateGraphic(a,this.layer instanceof u?this.layer:null)}};a.prototype.whenGraphicBounds=function(b,a){return this.spatialIndex?this.graphicsCore?this.graphicsCore.whenGraphicBounds(b,a):f.reject():f.reject()};a.prototype.whenSymbolLayerSize=function(b,a){return this.spatialIndex?this.graphicsCore?p.safeCast(this.graphicsCore.whenSymbolLayerSize(b,
a)):f.reject():f.reject()};a.prototype.highlight=function(b,a){void 0===a&&(a={});if(b instanceof w)return k;if("number"===typeof b||b instanceof h)return this.highlight([b],a);b instanceof q&&(b=b.toArray());if(Array.isArray(b)&&0<b.length){if(b[0]instanceof h){b=b.map(function(a){return a.uid});var c=this.highlights.acquireSet(a,null);a=c.set;c=c.handle;this.highlights.setUids(a,b);return c}if("number"===typeof b[0])return c=this.highlights.acquireSet(a,null),a=c.set,c=c.handle,this.highlights.setObjectIds(a,
b),c}return k};a.prototype.updateClippingExtent=function(){this.graphicsCore.setClippingExtent(this.view.clippingArea,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()};a.prototype.setupSuspendResumeExtent=function(){var a=this;this.scaleVisibility&&t.init(this.graphicsCore,"computedExtent",function(b){a.suspendResumeExtent=D.enlargeExtent(b,a.suspendResumeExtent,x.SUSPEND_RESUME_EXTENT_OPTIMISM);a.scaleVisibility.setExtent(a.suspendResumeExtent)},!0)};d([c.property({constructOnly:!0})],
a.prototype,"owner",void 0);d([c.property({constructOnly:!0})],a.prototype,"layer",void 0);d([c.property({readOnly:!0,aliasOf:"owner.view"})],a.prototype,"view",void 0);d([c.property({constructOnly:!0})],a.prototype,"graphicsCore",void 0);d([c.property({readOnly:!0})],a.prototype,"spatialIndex",void 0);d([c.property({constructOnly:!0})],a.prototype,"scaleVisibility",void 0);d([c.property({readOnly:!0})],a.prototype,"elevationAlignment",void 0);d([c.property({readOnly:!0})],a.prototype,"highlights",
void 0);d([c.property({readOnly:!0,dependsOn:["scaleVisibility.suspended"]})],a.prototype,"suspended",null);d([c.property({readOnly:!0,dependsOn:["graphicsCore.updating","scaleVisibility.updating"]})],a.prototype,"updating",null);return a=d([c.subclass("esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView")],a)}(c.declared(n))});