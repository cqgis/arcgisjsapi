// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define(["require","exports","./Util","../../../webgl/programUtils"],function(g,h,e,f){return function(){function c(a,b){void 0===b&&(b="");this._rctx=a;this._shaderPrefix=b;this._programCacheByTemplate=new Map;this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}c.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._rctx=
this._commonUniforms=this._programRefCount=this._programCacheByTemplate=null};c.prototype.getProgram=function(a,b){var d=this;this._programCacheByTemplate.has(a)||this.addProgramTemplate(a,function(b){return f.createProgram(d._rctx,a,b,d._shaderPrefix)});return this.getProgramTemplateInstance(a,b)};c.prototype.addProgramTemplate=function(a,b){this._programCacheByTemplate.set(a,{constructor:b,programs:new Map})};c.prototype.getProgramTemplateInstance=function(a,b){if(a=this._programCacheByTemplate.get(a)){var d=
b?JSON.stringify(b):"default";a.programs.has(d)||(b=a.constructor(b),a.programs.set(d,b));return a.programs.get(d)}return null};c.prototype.getProgramsUsingUniform=function(a){return this._commonUniforms[a]||[]};c.prototype.increaseRefCount=function(a){var b=a.id;this._programRefCount[b]?this._programRefCount[b]++:(this._programRefCount[b]=1,this._findCommonUniforms(a))};c.prototype.decreaseRefCount=function(a){var b=a.id;1<this._programRefCount[b]?this._programRefCount[b]--:(this._forgetCommonUniforms(a),
this._programRefCount[b]=0)};c.prototype._findCommonUniforms=function(a){for(var b in this._commonUniforms)a.hasUniform(b)&&(e.assert(-1===this._commonUniforms[b].indexOf(a),"common uniforms of program have already been determined"),this._commonUniforms[b].push(a))};c.prototype._forgetCommonUniforms=function(a){for(var b in this._commonUniforms){var d=this._commonUniforms[b],c=d.indexOf(a);-1<c&&(d[c]=d[d.length-1],d.pop())}};return c}()});