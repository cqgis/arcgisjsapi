// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Util".split(" "),function(m,A,y,r,q,p){m=function(){function f(d,g,k,c){p.assert(1<=d.length);p.assert(0===k.length%g);p.assert(k.length>=d.length*g);p.assert(3===c.size||4===c.size);this.primitiveIndices=d;this.indices=k;this._position=c;this._numIndexPerPrimitive=g;var a=c.data,e=c.offsetIdx,n=c.strideIdx;c=0;var m=d.length,b=e+n*k[g*d[c]];f.tmpIndices.clear();
f.tmpIndices.push(b);this.bbMin=q.vec3f64.fromValues(a[b],a[b+1],a[b+2]);for(this.bbMax=q.vec3f64.clone(this.bbMin);c<m;++c)for(var z=g*d[c],h=0;h<g;++h){b=e+n*k[z+h];f.tmpIndices.push(b);var l=a[b];this.bbMin[0]=Math.min(l,this.bbMin[0]);this.bbMax[0]=Math.max(l,this.bbMax[0]);l=a[b+1];this.bbMin[1]=Math.min(l,this.bbMin[1]);this.bbMax[1]=Math.max(l,this.bbMax[1]);l=a[b+2];this.bbMin[2]=Math.min(l,this.bbMin[2]);this.bbMax[2]=Math.max(l,this.bbMax[2])}this.center=q.vec3f64.create();r.vec3.lerp(this.center,
this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);d=this.bsRadius*this.bsRadius;for(c=0;c<f.tmpIndices.length;++c)b=f.tmpIndices.data[c],g=a[b]-this.center[0],k=a[b+1]-this.center[1],b=a[b+2]-this.center[2],e=g*g+k*k+b*b,e<=d||(e=Math.sqrt(e),n=.5*(e-this.bsRadius),this.bsRadius+=n,d=this.bsRadius*this.bsRadius,e=n/e,this.center[0]+=g*e,this.center[1]+=k*e,this.center[2]+=b*e);f.tmpIndices.clear()}f.prototype.getCenter=
function(){return this.center};f.prototype.getBSRadius=function(){return this.bsRadius};f.prototype.getBBMin=function(){return this.bbMin};f.prototype.getBBMax=function(){return this.bbMax};f.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};f.prototype.getIndices=function(){return this.indices};f.prototype.getPosition=function(){return this._position};f.prototype.getChildren=function(){if(this.children)return this.children;if(1<r.vec3.squaredDistance(this.bbMin,this.bbMax)){for(var d=
r.vec3.lerp(q.vec3f64.create(),this.bbMin,this.bbMax,.5),g=this.primitiveIndices.length,k=new Uint8Array(g),c=Array(8),a=0;8>a;++a)c[a]=0;for(var a=this._position,e=a.data,n=a.offsetIdx,m=a.strideIdx,a=0;a<g;++a){for(var b=0,p=this._numIndexPerPrimitive*this.primitiveIndices[a],h=n+m*this.indices[p],l=e[h],t=e[h+1],u=e[h+2],v=1;v<this._numIndexPerPrimitive;++v){var h=n+m*this.indices[p+v],w=e[h],x=e[h+1],h=e[h+2];w<l&&(l=w);x<t&&(t=x);h<u&&(u=h)}l<d[0]&&(b|=1);t<d[1]&&(b|=2);u<d[2]&&(b|=4);k[a]=b;
++c[b]}for(a=d=0;8>a;++a)0<c[a]&&++d;if(2>d)return;d=Array(8);for(a=0;8>a;++a)d[a]=0<c[a]?new Uint32Array(c[a]):void 0;for(a=0;8>a;++a)c[a]=0;for(a=0;a<g;++a)b=k[a],d[b][c[b]++]=this.primitiveIndices[a];this.children=Array(8);for(a=0;8>a;++a)void 0!==d[a]&&(this.children[a]=new f(d[a],this._numIndexPerPrimitive,this.indices,this._position))}return this.children};return f}();(m||(m={})).tmpIndices=new y({deallocator:null});return m});