// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/scheduling ../../../../../core/screenUtils ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/math/common ../../../../../geometry/Point ../../../../../layers/graphics/dehydratedFeatures ./graphicTransform3DToolConfig ./isSupportedGraphic ../../../support/geometryUtils ../../../support/mathUtils ../../../support/projectionUtils ../../../support/stack ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/materials/ColorMaterial ../../../../interactive/InteractiveToolBase ../../../../interactive/Manipulator3D ../../../../interactive/manipulatorUtils".split(" "),
function(S,q,A,ba,ca,da,ea,fa,ga,f,ha,T,D,B,z,t,J,l,x,K,L,E,e,ia,u,F,ja,h,G,C,ka,la,M,U){function ma(b){var c=new G(C.createCylinderGeometry(e.DISC_HEIGHT,1,e.GEOMETRY_SEGMENTS,x.vec3f64.fromValues(0,0,1),x.vec3f64.fromValues(0,0,0)),"graphic-transform-disc"),a=y(),d=y(.5),g=t.mat4.fromScaling(J.mat4f64.create(),x.vec3f64.fromValues(e.DISC_RADIUS,e.DISC_RADIUS,e.DISC_RADIUS));b=new M.Manipulator3D({view:b,renderObjects:[{geometry:c,material:a,stateMask:k.RingUnfocused|k.ArrowUnfocused,transform:g},
{geometry:c,material:d,transform:g}],autoScaleRenderObjects:!1,radius:e.DISC_COLLISION_RADIUS,focusMultiplier:1,allowOverlap:!0,snapToPointer:!1,alignment:"on-the-ground",collisionType:{type:"disc",direction:x.vec3f64.fromValues(0,0,1)}});b.visible=!1;return b}function na(b){for(var c=function(a,d,g){for(var b=[],c=Math.ceil(e.GEOMETRY_SEGMENTS*(d-a)/(2*Math.PI)),p=0;p<c+1;p++){var f=a+p*(d-a)/c;b.push(x.vec3f64.fromValues(g*Math.cos(f),g*Math.sin(f),0))}return b},a=function(a){return c(0,2*Math.PI,
a)},d=function(a,d){return new G(C.createPathExtrusionGeometry([[-d/2,0],[d/2,0],[d/2,e.RING_HEIGHT/2],[-d/2,e.RING_HEIGHT/2]],a,[],[],!1),"graphic-transform-ring")},g=a(e.RING_RADIUS),p=d(g,e.RING_THICKNESS),H=[],m=[],n=[],f=0;2>f;f++){var v=f*Math.PI-Math.PI/4,r=Math.PI/2-e.ROTATE_INDICATOR_ARC_LENGTH,h=v+r,v=v+Math.PI/2-r,r=c(h,v,e.INNER_INDICATOR_RADIUS),l=d(r,e.INDICATOR_THICKNESS);n.push(r);H.push(l);m.push(l);for(l=0;2>l;l++){var q=0===l,w=J.mat4f64.create();if(q){t.mat4.scale(w,w,[1,-1,1]);
t.mat4.rotate(w,w,-h,[0,0,1]);var u=Math.round(e.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE*(r.length-1))}else t.mat4.rotate(w,w,v,[0,0,1]),u=Math.round((1-e.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE)*(r.length-1));w[12]=r[u][0];w[13]=r[u][1];w[14]=r[u][2];u=C.createExtrudedTriangle(e.ROTATE_INDICATOR_ARROW_TIP_LENGTH,0,e.ROTATE_INDICATOR_ARROW_TIP_RADIUS,e.RING_HEIGHT);C.transformInPlace(u,w);w=new G(u,"graphic-transform-ring-rotate");(q?H:m).push(w)}}l=[];for(f=0;2>f;f++)v=f*Math.PI-Math.PI/
4,r=Math.PI/2-e.SCALE_INDICATOR_ARC_LENGTH,h=v+r,v=v+Math.PI/2-r,r=c(h,v,e.OUTER_INDICATOR_RADIUS),l.push(d(r,e.INDICATOR_THICKNESS));f=a(e.RING_RADIUS+e.SCALE_INDICATOR_OFFSET1);h=a(e.RING_RADIUS+e.SCALE_INDICATOR_OFFSET2);f=d(f,e.INDICATOR_THICKNESS);h=d(h,e.INDICATOR_THICKNESS);v=a(e.RING_RADIUS-e.SCALE_INDICATOR_OFFSET1);r=a(e.RING_RADIUS-e.SCALE_INDICATOR_OFFSET2);a=d(v,e.INDICATOR_THICKNESS);d=d(r,e.INDICATOR_THICKNESS);v=y();r=y(.66);q=y(.5);w=y(.33);p=[{geometry:p,material:v,stateMask:k.DiscUnfocused|
k.ArrowUnfocused},{geometry:p,material:q},{geometry:l,material:v,stateMask:k.Unlocked|k.RingFocused},{geometry:f,material:r,stateMask:k.ScaleIn|2},{geometry:h,material:w,stateMask:k.ScaleIn|2},{geometry:a,material:r,stateMask:k.ScaleOut|2},{geometry:d,material:w,stateMask:k.ScaleOut|2},{geometry:H,material:v,stateMask:k.Unlocked|k.RingFocused},{geometry:H,material:v,stateMask:k.RotateLeft|2},{geometry:m,material:v,stateMask:k.RotateRight|2}];g=[g].concat(n);return new M.Manipulator3D({view:b,renderObjects:p,
autoScaleRenderObjects:!1,radius:e.RING_THICKNESS,focusMultiplier:1,moveOnDrag:!1,allowOverlap:!0,alignment:"on-the-ground",collisionType:{type:"ribbon",paths:g,direction:x.vec3f64.fromValues(0,0,1)}})}function oa(b){var c=Math.sqrt(e.DISC_TRANSLATE_ARROW_SIZE*e.DISC_TRANSLATE_ARROW_SIZE*3/4),a=C.createExtrudedTriangle(c,e.DISC_TRANSLATE_ARROW_SIZE/2,e.DISC_TRANSLATE_ARROW_SIZE/2,e.DISC_HEIGHT);C.transformInPlace(a,t.mat4.fromTranslation(h.sm4d.get(),l.vec3.set(h.sv3d.get(),0,-c/3,0)));var a=new G(a,
"graphic-transform-disc-arrow"),d=y(),g=y(.5);b=new M.Manipulator3D({view:b,renderObjects:[{geometry:a,material:g,stateMask:k.DiscFocused|1},{geometry:a,material:g,stateMask:k.ArrowFocused|1},{geometry:a,material:d,stateMask:2}],autoScaleRenderObjects:!1,radius:c,focusMultiplier:1,allowOverlap:!0,snapToPointer:!1,alignment:"on-the-ground",collisionType:{type:"disc",direction:x.vec3f64.fromValues(0,0,1)}});b.visible=!1;return b}function pa(b,c){var a=this,d=b.allLayerViews.find(function(a){return a.layer===
c.layer}),g=c.symbol;return ha.all(g.symbolLayers.map(function(b){return da(a,void 0,void 0,function(){var a,c;return ca(this,function(p){switch(p.label){case 0:c=a=null,"object"===b.type&&(a=b.heading),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,d.whenSymbolLayerSize(g,b)];case 2:return c=p.sent(),[3,4];case 3:return p.sent(),c=null,[3,4];case 4:return[2,{heading:a,size:c}]}})})}).toArray()).then(function(a){return{symbolLayers:a}})}function qa(b){return(b=b.symbol.symbolLayers.find(function(b){return"object"===
b.type}))&&b.heading||0}function ra(b,c,a,d){b.symbolLayers.forEach(function(g,b){var p=c.symbolLayers[b];b=p.heading;p=p.size;"object"===g.type&&(g.heading=(f.isSome(b)?b:0)-K.toDegree(a),f.isSome(p)&&"width"in p&&(g.width=p.width*d,g.depth=p.depth*d,g.height=p.height*d))})}function V(b){var c=l.vec3.subtract(h.sv3d.get(),b.startPoint,b.origin);b=l.vec3.subtract(h.sv3d.get(),b.endPoint,b.origin);c=l.vec3.length(c);b=l.vec3.length(b);return 0===c?0:b/c}function sa(b,c){var a=b.origin,d=b.startPoint,
g=b.endPoint,p=b.plane;b=I(d,c,h.sv3d.get());g=I(g,c,h.sv3d.get());if(l.vec3.squaredDistance(b,g)<e.DRAG_THRESHOLD_PX*e.DRAG_THRESHOLD_PX)return null;var f=l.vec3.subtract(h.sv3d.get(),d,a),p=l.vec3.cross(h.sv3d.get(),f,p),d=l.vec3.add(h.sv3d.get(),d,p),a=I(a,c,h.sv3d.get());c=I(d,c,h.sv3d.get());d=l.vec3.subtract(h.sv3d.get(),c,b);c=l.vec3.subtract(h.sv3d.get(),b,a);b=u.ray.wrap(b,d);c=u.ray.wrap(a,c);return u.ray.distance2(b,g)<u.ray.distance2(c,g)?"rotate":"scale"}function y(b){void 0===b&&(b=
1);var c=e.HANDLE_COLOR.concat([b]);b=new ka({color:c,transparent:1!==b,cullFace:"back"},"graphic-transform");b.renderOccluded=2;return b}function I(b,c,a){b=c.projectPoint(b,D.castRenderScreenPointArray(ta));c=c.renderToScreen(b,ua);return l.vec3.set(a,c[0],c[1],0)}function W(b){var c=b.spatialReference;return"local"===b.viewingMode?!0:(c.isWGS84||c.isWebMercator)&&b.scale<e.ALIGN_ARROWS_SCALE_THRESHOLD}Object.defineProperty(q,"__esModule",{value:!0});var va=ga.getLogger("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransform3DTool"),
N=function(){return function(b){this.graphic=b}}();q.GraphicTranslateStartEvent=N;var O=function(){return function(b){this.graphic=b}}();q.GraphicTranslateStopEvent=O;var P=function(){return function(b){this.graphic=b}}();q.GraphicRotateStartEvent=P;var X=function(){return function(b){this.graphic=b}}();q.GraphicRotateStopEvent=X;var Q=function(){return function(b){this.graphic=b}}();q.GraphicScaleStartEvent=Q;var Y=function(){return function(b){this.graphic=b}}();q.GraphicScaleStopEvent=Y;var R=
function(){return function(b,c,a){this.graphic=b;this.dx=c;this.dy=a;this.type="translate"}}();q.GraphicTranslateEvent=R;var Z=function(){return function(b,c){this.graphic=b;this.angle=c;this.type="rotate"}}();q.GraphicRotateEvent=Z;var aa=function(){return function(b,c){this.graphic=b;this.scale=c;this.type="scale"}}();q.GraphicScaleEvent=aa;S=function(b){function c(a){a=b.call(this,a)||this;a.enableRotation=!0;a.enableScaling=!0;a.discManipulator=null;a.ringManipulator=null;a.arrowManipulators=
null;a.type="transform-3d";a._handles=new fa;a._arrowDragData=null;a._ringDragData=null;a._startSymbolDataPromise=null;a._startSymbolData=null;a._ringDelayedFocusFrameTask=null;a._ringManipulatorHasDelayedFocused=!1;a._scaleAnimationFrameTask=null;return a}ba(c,b);c.prototype.destroy=function(){this._removeFrameTasks();this.graphic=null;this._handles.destroy();this._handles=null;this._set("view",null)};Object.defineProperty(c.prototype,"graphic",{set:function(a){f.isSome(a)&&!ia.isSupportedGraphic(a)?
va.error("Only graphics from a graphics layer with point geometries and object symbology are supported"):this._set("graphic",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_ringMode",{get:function(){return f.isSome(this._ringDragData)&&this._ringDragData.mode||this._ringModeFromOptions},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_ringModeFromOptions",{get:function(){var a=this._shouldAllowModeType("scale"),d=this._shouldAllowModeType("rotate");return a||
d?d?a?null:{type:"rotate",startAngle:0}:{type:"scale"}:{type:"disabled"}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_manipulatorState",{get:function(){var a=this._ringMode,d=0,d=f.isNone(a)?k.Unlocked:"rotate"===a.type?f.isSome(this._ringDragData)&&0>this._ringDragData.angleDir?k.RotateLeft:k.RotateRight:f.isSome(this._ringDragData)&&0>this._ringDragData.scaleDir?k.ScaleIn:k.ScaleOut,d=d|(this.discManipulator.focused?k.DiscFocused:k.DiscUnfocused),d=d|(this._ringManipulatorHasDelayedFocused?
k.RingFocused:k.RingUnfocused);return d|=this.arrowManipulators.some(function(a){return a.manipulator.focused})?k.ArrowFocused:k.ArrowUnfocused},enumerable:!0,configurable:!0});c.prototype.hide=function(){this._removeFrameTasks()};c.prototype.reset=function(){this.graphic=null};c.prototype.onAttach=function(a){for(var d=this,g=ma(this.view),b=na(this.view),c=[],e=0;4>e;e++){var h=oa(this.view),l=J.mat4f64.create();this._calculateArrowManipulatorTransform(e,l);c.push({manipulator:h,transform:l})}this.discManipulator=
g;this.ringManipulator=b;this.arrowManipulators=c;this._handles.add([g.watch("grabbing",function(a){d._setSingleManipulatorInteractive(g,a)},!0),g.watch("dragging",function(a){f.isSome(d.graphic)&&(a?d.emit("graphic-translate-start",new N(d.graphic)):d.emit("graphic-translate-stop",new O(d.graphic)))},!0),B.watch(g,"focused",function(){f.isNone(d._scaleAnimationFrameTask)&&d._updateManipulators()}),B.init(this,"graphic.geometry",function(){f.isSome(d.graphic)&&d.graphic.geometry&&"point"===d.graphic.geometry.type&&
(g.mapPoint=E.clonePoint(d.graphic.geometry,wa));d._updateManipulators()},!0)]);c.forEach(function(a,b){var g=a.manipulator;g.on("drag",function(a){d._handleArrowDrag(b)});d._handles.add([B.watch(g,"focused",function(){d._updateManipulators()}),B.watch(g,"grabbing",function(a){d._setSingleManipulatorInteractive(g,a)}),B.watch(g,"dragging",function(a){f.isNone(d.graphic)||(a?d.emit("graphic-translate-start",new N(d.graphic)):(d._arrowDragData=null,d.emit("graphic-translate-stop",new O(d.graphic))))})])});
g.on("drag",function(a){if(!f.isNone(d.graphic)&&d.graphic.geometry&&"point"===d.graphic.geometry.type){a=d.graphic.geometry.z;var b=d.graphic.geometry,c=E.clonePoint(g.mapPoint,new L);c.z=a;d.graphic.geometry=c;d.emit("graphic-translate",new R(d.graphic,c.x-b.x,c.y-b.y))}});this._handles.add([b.watch("grabbing",function(a){d._setSingleManipulatorInteractive(b,a)},!0),b.watch("dragging",function(a){if(!1===a){if(a=d._ringDragData,d._ringDragData=null,d._startSymbolDataPromise=null,d._startSymbolData=
null,f.isSome(a)){var b=a.mode;f.isNone(b)||f.isSome(b)&&"scale"===b.type?(b=V(a),d._startScaleResetAnimation(b)):d._updateManipulators();if(f.isSome(d.graphic)&&f.isSome(a.mode))switch(a.mode.type){case "rotate":d.emit("graphic-rotate-stop",new X(d.graphic));break;case "scale":d.emit("graphic-scale-stop",new Y(d.graphic))}}}else if(f.isSome(d.graphic)&&f.isSome(d._ringMode)&&"disabled"!==d._ringMode.type)switch(d._ringMode.type){case "rotate":d.emit("graphic-rotate-start",new P(d.graphic));break;
case "scale":d.emit("graphic-scale-start",new Q(d.graphic))}},!0),B.watch(b,"focused",function(){f.isNone(d._scaleAnimationFrameTask)&&d._startRingFocusFrameTask()})]);b.on("drag",function(a){d._handleRingDrag(a.screenPoint)});a.addManipulator(g);a.addManipulator(b);c.forEach(function(d){return a.addManipulator(d.manipulator)})};c.prototype.onDetach=function(){this._handles.removeAll();this.ringManipulator=this.discManipulator=null;this.arrowManipulators=[]};c.prototype._handleArrowDrag=function(a){if(!f.isNone(this.graphic)&&
this.graphic.geometry&&"point"===this.graphic.geometry.type){var d=this.arrowManipulators[a].manipulator,b=this.graphic.geometry,c=this.graphic.geometry.spatialReference,e=new L,m=W(this.view);if(m){var n=this._calculateArrowManipulatorDirection(a,h.sv3d.get()),d=l.vec3.subtract(h.sv3d.get(),d.position,this.discManipulator.position);u.vector.projectPoint(n,d,d);n=l.vec3.add(d,d,this.discManipulator.position);if(!this.view.renderCoordsHelper.fromRenderCoords(n,e,c))return}else n=d.mapPoint,ja.vectorToPoint(l.vec3.set(h.sv3d.get(),
n.x,n.y,n.z),n.spatialReference,e,c);c=b.longitude;n=e.longitude;null==c||null==n?c=!1:(c=F.cyclicalDeg.shortestSignedDiff(c,n),c=90>Math.abs(c));if(c=!c)e.x=b.x,e.y=b.y;m||c||(0===a||2===a?e.x=b.x:e.y=b.y);if(f.isNone(this._arrowDragData)){if(a=E.clonePoint(b,new L),m=e.x-b.x,c=e.y-b.y,1E-5<Math.abs(m)||1E-5<Math.abs(c))this._arrowDragData={startPoint:a,dxMapConstrained:m,dyMapConstrained:c}}else m&&!c&&(a=this._arrowDragData,m=a.dxMapConstrained,c=a.dyMapConstrained,a=a.startPoint,1E-5>Math.abs(m)?
e.x=a.x:e.y=1E-5>Math.abs(c)?a.y:a.y+(e.x-a.x)*c/m);a=e.x-b.x;m=e.y-b.y;e.z=b.z;this.graphic.geometry=e;this.emit("graphic-translate",new R(this.graphic,a,m))}};c.prototype._handleRingDrag=function(a){var d=this;if(!f.isNone(this.graphic)&&!f.isSome(this._startSymbolDataPromise)){var b=this._ringDragData,c=this._startSymbolData,k=this.graphic;a=D.screenPointObjectToArray(a,D.castScreenPointArray(h.sv2d.get()));a=u.ray.fromScreen(this.view.state.camera,a,xa);var m=this.discManipulator.modelTransform;
if(f.isNone(b)||f.isNone(c))b=x.vec3f64.fromValues(0,0,1),l.vec3.transformMat4(b,b,m),c=x.vec3f64.clone(this.ringManipulator.position),m=u.plane.fromPositionAndNormal(c,b),b=x.vec3f64.create(),u.plane.intersectRay(m,a,b)&&(this._ringDragData={origin:c,plane:m,angle:0,angleDir:0,scale:1,scaleDir:0,startPoint:b,endPoint:x.vec3f64.clone(b),mode:null},this._startSymbolDataPromise=pa(this.view,k),this._startSymbolDataPromise.then(function(a){d._startSymbolData=a;d._startSymbolDataPromise=null},function(){d._startSymbolDataPromise=
null}));else if(m=b.plane,u.plane.intersectRay(m,a,b.endPoint)){a=V(b);var m=U.calculateInputRotationTransform(b.startPoint,b.endPoint,b.origin,m),n=F.cyclicalPI.shortestSignedDiff(b.angle,m);b.angleDir=F.clamp(b.angleDir+n,-e.ROTATE_INDICATOR_DIRECTION_BUFFER,e.ROTATE_INDICATOR_DIRECTION_BUFFER);b.angle=m;b.scaleDir=F.clamp(b.scaleDir+(a-b.scale),-e.SCALE_INDICATOR_DIRECTION_BUFFER,e.SCALE_INDICATOR_DIRECTION_BUFFER);b.scale=a;var n=null,q=this._ringMode;if(f.isSome(q))n=q;else if(q=sa(b,this.view.state.camera),
f.isSome(q)){switch(q){case "rotate":this.emit("graphic-rotate-start",new P(this.graphic));break;case "scale":this.emit("graphic-scale-start",new Q(this.graphic))}n="scale"===q?{type:"scale"}:{type:"rotate",startAngle:m}}b.mode=n;f.isSome(n)&&("rotate"===n.type?a=1:"scale"===n.type&&(m=0));b=t.mat4.fromScaling(h.sm4d.get(),l.vec3.set(h.sv3d.get(),a,a,1));this._updateManipulators(b);if(f.isSome(n)&&"disabled"!==n.type)switch("rotate"===n.type&&(m-=n.startAngle),k=k.symbol.clone(),ra(k,c,m,a),this.graphic.symbol=
k,n.type){case "rotate":this.emit("graphic-rotate",new Z(this.graphic,K.toDegree(m)));break;case "scale":this.emit("graphic-scale",new aa(this.graphic,a))}}}};c.prototype._shouldAllowModeType=function(a){return"scale"===a?this.enableScaling:f.isNone(this.graphic)||!this.enableRotation?!1:this.graphic.symbol.symbolLayers.some(function(a){return"object"===a.type})};c.prototype._updateManipulators=function(a){var b=this._manipulatorState,c=this._getManipulatorRotationAngle(),e=t.mat4.identity(h.sm4d.get());
0!==c&&t.mat4.rotate(e,e,c,x.vec3f64.fromValues(0,0,1));var k=this.discManipulator.position,c=this.view.renderCoordsHelper.basisMatrixAtPosition(k,h.sm4d.get());a=a?t.mat4.multiply(h.sm4d.get(),c,a):c;var m=f.isSome(this.graphic)&&null!=this.graphic.geometry,l=W(this.view)?t.mat4.multiply(h.sm4d.get(),a,e):a;this.discManipulator.state=b;this.discManipulator.modelTransform=l;this.discManipulator.visible=m;this.arrowManipulators.forEach(function(a){var d=a.manipulator;a=a.transform;a=t.mat4.multiply(h.sm4d.get(),
l,a);d.state=b;d.position=k;d.modelTransform=a;d.visible=m});e=t.mat4.multiply(h.sm4d.get(),a,e);this.ringManipulator.state=b;this.ringManipulator.position=this.discManipulator.position;this.ringManipulator.modelTransform=e;e=this._ringMode;e=f.isSome(e)&&"disabled"===e.type;this.ringManipulator.visible=m&&!e};c.prototype._setSingleManipulatorInteractive=function(a,b){b?(this.discManipulator.interactive=this.discManipulator===a,this.ringManipulator.interactive=this.ringManipulator===a,this.arrowManipulators.forEach(function(b){b=
b.manipulator;b.interactive=b===a})):(this.discManipulator.interactive=!0,this.ringManipulator.interactive=!0,this.arrowManipulators.forEach(function(a){a.manipulator.interactive=!0}))};c.prototype._startRingFocusFrameTask=function(){var a=this;this._removeFrameTasks();var b=0;this._ringDelayedFocusFrameTask=T.addFrameTask({update:function(d){b+=d.deltaTime;a.ringManipulator.focused?b>e.RING_INDICATOR_DELAY_MS&&(a._ringManipulatorHasDelayedFocused=!0,a._updateManipulators(),a._removeFrameTasks()):
(a._ringManipulatorHasDelayedFocused=!1,a._updateManipulators(),a._removeFrameTasks())}})};c.prototype._startScaleResetAnimation=function(a){var b=this;this._removeFrameTasks();var c=a;this._scaleAnimationFrameTask=T.addFrameTask({update:function(a){c+=((c+1)/2-c)*Math.min(a.deltaTime*e.RING_RESET_ANIMATION_SPEED_FACTOR,1);.01>Math.abs(c-1)?(b._updateManipulators(),b._removeFrameTasks()):(a=t.mat4.fromScaling(h.sm4d.get(),l.vec3.set(h.sv3d.get(),c,c,1)),b._updateManipulators(a))}})};c.prototype._getManipulatorRotationAngle=
function(){var a=f.isSome(this.graphic)?qa(this.graphic):0,a=K.toRadian(-a);if(f.isNone(this._ringDragData)||f.isSome(this._ringDragData.mode))return a;var b=this._ringDragData;return a+U.calculateInputRotationTransform(b.startPoint,b.endPoint,b.origin,b.plane)};c.prototype._calculateArrowManipulatorTransform=function(a,b){var c=t.mat4.identity(h.sm4d.get());t.mat4.fromZRotation(c,a*Math.PI/2);a=t.mat4.identity(h.sm4d.get());t.mat4.fromTranslation(a,l.vec3.set(h.sv3d.get(),0,e.DISC_TRANSLATE_ARROW_OFFSET,
0));return t.mat4.multiply(b,c,a)};c.prototype._calculateArrowManipulatorDirection=function(a,b){var c=this.discManipulator.modelTransform;return 0===a||2===a?l.vec3.set(b,c[4],c[5],c[6]):l.vec3.set(b,c[0],c[1],c[2])};c.prototype._removeFrameTasks=function(){this.ringManipulator&&(this._ringManipulatorHasDelayedFocused=this.ringManipulator.focused);f.isSome(this._ringDelayedFocusFrameTask)&&(this._ringDelayedFocusFrameTask.remove(),this._ringDelayedFocusFrameTask=null);f.isSome(this._scaleAnimationFrameTask)&&
(this._scaleAnimationFrameTask.remove(),this._scaleAnimationFrameTask=null)};A([z.property({constructOnly:!0,nonNullable:!0})],c.prototype,"view",void 0);A([z.property({value:null})],c.prototype,"graphic",null);A([z.property()],c.prototype,"enableRotation",void 0);A([z.property()],c.prototype,"enableScaling",void 0);A([z.property({readOnly:!0})],c.prototype,"type",void 0);return c=A([z.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransform3DTool")],c)}(z.declared(la,
ea));q.GraphicTransform3DTool=S;var ta=x.vec3f64.create(),ua=D.createScreenPointArray(),k;(function(b){b.Unlocked=16;b.ScaleIn=32;b.ScaleOut=64;b.RotateLeft=128;b.RotateRight=256;b.DiscFocused=512;b.DiscUnfocused=1024;b.RingFocused=2048;b.RingUnfocused=4096;b.ArrowFocused=8192;b.ArrowUnfocused=16384})(k||(k={}));var xa=u.ray.create(),wa=E.makeDehydratedPoint(0,0,0,null)});