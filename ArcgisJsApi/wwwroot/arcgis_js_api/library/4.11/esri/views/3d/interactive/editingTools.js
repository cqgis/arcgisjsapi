// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/3d/interactive/editingTools/graphicMove3D/GraphicMove3DTool":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/Collection ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/accessorSupport/decorators ../../../../draw/support/drawUtils ../../../../interactive/GraphicManipulator ../../../../interactive/InteractiveToolBase".split(" "),function(w,b,
e,r,n,x,c,f,u,a,h){Object.defineProperty(b,"__esModule",{value:!0});var g=function(){return function(a){this.allGraphics=a;this.type="graphic-move-start"}}();b.GraphicMoveStartEvent=g;var t=function(){return function(a,k,d){this.dx=a;this.dy=k;this.allGraphics=d;this.type="graphic-move"}}();b.GraphicMoveEvent=t;var m=function(){return function(a){this.allGraphics=a;this.type="graphic-move-stop"}}();b.GraphicMoveStopEvent=m;w=function(l){function k(a){a=l.call(this,a)||this;a.graphics=new n;a.type=
"move-3d";a._handles=new c;return a}r(k,l);k.prototype.initialize=function(){};k.prototype.destroy=function(){this._handles.destroy();this._handles=null;this.graphics.removeAll();this._set("view",null)};k.prototype.reset=function(){this.graphics.removeAll()};k.prototype.onAttach=function(a){var k=this;this._handles.add(this.graphics.on("change",function(){k._refreshGraphicManipulators(a)}));this._refreshGraphicManipulators(a)};k.prototype.onDetach=function(){this._handles.removeAll()};k.prototype._refreshGraphicManipulators=
function(k){var d=this;this._handles.remove("graphics");k.removeManipulators();var c=this.graphics.toArray().map(function(c){c=new a.GraphicManipulator({graphic:c,view:d.view,selectable:!0});k.addManipulator(c);return c}),l=0;c.forEach(function(a){a.on("drag",function(k){c.forEach(function(d){if("mesh"===d.graphic.geometry.type)return!1;d!==a&&(d.graphic.geometry=u.move(d.graphic.geometry.clone(),k.dxMap,k.dyMap))});d.emit("graphic-move",new t(k.dx,k.dy,d.graphics.toArray()))});a.on("click",function(){return d.emit("click")});
var k=a.watch("dragging",function(k){k?(l++,1===l&&(d.emit("graphic-move-start",new g(d.graphics.toArray())),c.forEach(function(k){k!==a&&(k.interactive=!1)}))):(l--,0===l&&(d.emit("graphic-move-stop",new m(d.graphics.toArray())),c.forEach(function(a){a.interactive=!0})))},!0),q=a.watch("hovering",function(a){d.cursor=a?"move":null},!0);d._handles.add(k,"graphics");d._handles.add(q,"graphics")})};e([f.property({constructOnly:!0,nonNullable:!0})],k.prototype,"view",void 0);e([f.property({readOnly:!0})],
k.prototype,"graphics",void 0);e([f.property({value:null})],k.prototype,"cursor",void 0);e([f.property({readOnly:!0})],k.prototype,"type",void 0);return k=e([f.subclass("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMove3DTool")],k)}(f.declared(h,x));b.GraphicMove3DTool=w})},"esri/views/draw/support/drawUtils":function(){define(["require","exports","../../../geometry/support/aaBoundingRect","../../../geometry/support/boundsUtils","../../../geometry/support/coordsUtils"],function(w,b,
e,r,n){function x(c,f,b){if("point"===c.type)return c.x+=f,c.y+=b,c;if("multipoint"===c.type){var a=c.points,h;for(h in a){var g=a[h],e=g[0],g=g[1];a[h]=[e+f,g+b]}return c}if("extent"===c.type)return c.xmin+=f,c.xmax+=f,c.ymin+=b,c.ymax+=b,c;var a=n.geometryToCoordinates(c),m="polyline"===c.type?c.paths:c.rings,l;for(l in a){var k=a[l];for(h in k)g=k[h],e=g[0],g=g[1],m[l][h]=[e+f,g+b]}"paths"in c?c.paths=m:c.rings=m;return c}Object.defineProperty(b,"__esModule",{value:!0});b.move=x;b.cloneMove=function(c,
f,b,a,h){c=c.clone();var g=a.resolution;if("point"===c.type){if(h)x(c,f*g,-b*g);else{h=a.state.transform;a=a.state.inverseTransform;var e=h[0]*c.x+h[2]*c.y+h[4],m=h[1]*c.x+h[3]*c.y+h[5];c.x=a[0]*(e+f)+a[2]*(m+b)+a[4];c.y=a[1]*(e+f)+a[3]*(m+b)+a[5]}return c}if("multipoint"===c.type){if(h)x(c,f*g,-b*g);else{g=c.points;h=a.state.transform;a=a.state.inverseTransform;for(var l in g){var e=g[l],m=h[0]*e[0]+h[2]*e[1]+h[4],k=h[1]*e[0]+h[3]*e[1]+h[5],e=a[0]*(m+f)+a[2]*(k+b)+a[4],m=a[1]*(m+f)+a[3]*(k+b)+a[5];
g[l]=[e,m]}}return c}if("extent"===c.type){if(h)x(c,f*g,-b*g);else{h=a.state.transform;a=a.state.inverseTransform;l=h[0]*c.xmin+h[2]*c.ymin+h[4];var d=h[1]*c.xmin+h[3]*c.ymin+h[5],g=h[0]*c.xmax+h[2]*c.ymax+h[4];h=h[1]*c.xmax+h[3]*c.ymax+h[5];c.xmin=a[0]*(l+f)+a[2]*(d+b)+a[4];c.ymin=a[1]*(l+f)+a[3]*(d+b)+a[5];c.xmax=a[0]*(g+f)+a[2]*(h+b)+a[4];c.ymax=a[1]*(g+f)+a[3]*(h+b)+a[5]}return c}if(h)x(c,f*g,-b*g);else{var q=n.geometryToCoordinates(c),g="polyline"===c.type?c.paths:c.rings;h=a.state.transform;
a=a.state.inverseTransform;for(d in q){var z=q[d];for(l in z)e=z[l],m=h[0]*e[0]+h[2]*e[1]+h[4],k=h[1]*e[0]+h[3]*e[1]+h[5],e=a[0]*(m+f)+a[2]*(k+b)+a[4],m=a[1]*(m+f)+a[3]*(k+b)+a[5],g[d][l]=[e,m]}"paths"in c?c.paths=g:c.rings=g}return c};b.scale=function(c,b,u,a,h){if("point"===c.type){a=c.x;var f=c.y,t=h?h[0]:a;h=h?h[1]:f;c=c.clone();c.x=(a-t)*b+t;c.y=(f-h)*u+h;return c}if("multipoint"===c.type){var m=n.geometryToCoordinates(c);a=e.create();f=r.getRingsOrPathsBounds(a,[m]);m=f[0];a=f[1];var l=f[2],
f=f[3],m=h?h[0]:(m+l)/2,l=h?h[1]:(f+a)/2,k=c.clone(),d=k.points;for(t in d)c=d[t],a=c[0],f=c[1],c=(a-m)*b+m,h=(f-l)*u+l,d[t]=[c,h];return k}if("extent"===c.type)return t=c.xmin,m=c.xmax,a=c.ymin,l=c.ymax,f=h?h[0]:(t+m)/2,h=h?h[1]:(l+a)/2,c=c.clone(),c.xmin=(t-f)*b+f,c.ymax=(l-h)*u+h,c.xmax=(m-f)*b+f,c.ymin=(a-h)*u+h,c.xmin>c.xmax&&(b=c.xmin,c.xmin=c.xmax,c.xmax=b),c.ymin>c.ymax&&(b=c.ymin,c.ymin=c.ymax,c.ymax=b),c;l=n.geometryToCoordinates(c);a=e.create();d=r.getRingsOrPathsBounds(a,l);f=d[0];a=d[1];
var k=d[2],d=d[3],k=h?h[0]:(f+k)/2,d=h?h[1]:(d+a)/2,q=c.clone(),z="polyline"===q.type?q.paths:q.rings;for(m in l){var C=l[m];for(t in C)c=C[t],a=c[0],f=c[1],c=(a-k)*b+k,h=(f-d)*u+d,z[m][t]=[c,h]}"paths"in q?q.paths=z:q.rings=z;return q};b.getScaleRatio=function(c,b,e,a,h,g){return Math.sqrt((h-c)*(h-c)+(g-b)*(g-b))/Math.sqrt((e-c)*(e-c)+(a-b)*(a-b))};b.getRotationAngle=function(c,b,e,a,h,g){return 180*Math.atan2(b-g,c-h)/Math.PI-180*Math.atan2(b-a,c-e)/Math.PI}})},"esri/views/interactive/GraphicManipulator":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/Accessor ../../core/Collection ../../core/Logger ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/vec3 ../../views/3d/support/projectionUtils ../3d/support/stack ../draw/support/drawUtils".split(" "),
function(w,b,e,r,n,x,c,f,u,a,h,g){Object.defineProperty(b,"__esModule",{value:!0});var t=c.getLogger("esri.views.interactive.GraphicManipulator");w=function(c){function b(a){a=c.call(this)||this;a.interactive=!0;a.selectable=!1;a.allowOverlap=!0;a.grabbing=!1;a.dragging=!1;a.hovering=!1;a.selected=!1;a.active=!0;a._handlers=new x;return a}r(b,c);Object.defineProperty(b.prototype,"graphic",{get:function(){return this._get("graphic")},set:function(a){a.geometry&&"mesh"===a.geometry.type?t.error("Mesh geometries are not supported"):
this._set("graphic",a)},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this._handlers.removeAll();this._handlers=null;this._set("view",null)};b.prototype.intersectionDistance=function(a){if(!this.active)return null;a=this.view.toMap(a,{include:[this.graphic]});if(!a)return null;var d=h.sv3d.get();return this.view.renderCoordsHelper.toRenderCoords(a,d)?u.vec3.distance(d,this.view.state.camera.eye):null};b.prototype.attemptDragTo=function(k,d){if(null==this.graphic.geometry||"mesh"===
this.graphic.geometry.type)return!1;var b=this.view.toMap(d.previous),c=this.view.toMap(k.screenPoint),e=k.screenPoint.x-d.previous.x;d=k.screenPoint.y-d.previous.y;var f=0,h=0;if(!b||!c)return!1;h=[0,0,0,0,0,0];a.bufferToBuffer([b.x,b.y,0,c.x,c.y,0],b.spatialReference,0,h,this.graphic.geometry.spatialReference,0,2);f=h[3]-h[0];h=h[4]-h[1];if(0===f&&0===h)return!0;this.graphic.geometry=g.move(this.graphic.geometry.clone(),f,h);var l={screenPoint:k.screenPoint,dxMap:f,dyMap:h,dx:e,dy:d};this._handlers.forEach(function(a){var d=
a.handler;"drag"===a.type&&d(l)});return!0};b.prototype.click=function(a){this._handlers.forEach(function(d){"click"===d.type&&d.handler(a)})};b.prototype.on=function(a,d){this._handlers.push({type:a,handler:d})};e([f.property({constructOnly:!0,nonNullable:!0})],b.prototype,"graphic",null);e([f.property({constructOnly:!0,nonNullable:!0})],b.prototype,"view",void 0);e([f.property()],b.prototype,"interactive",void 0);e([f.property()],b.prototype,"selectable",void 0);e([f.property()],b.prototype,"allowOverlap",
void 0);e([f.property()],b.prototype,"grabbing",void 0);e([f.property()],b.prototype,"dragging",void 0);e([f.property()],b.prototype,"hovering",void 0);e([f.property()],b.prototype,"selected",void 0);e([f.property()],b.prototype,"active",void 0);return b=e([f.subclass("esri.views.interactive.GraphicManipulator")],b)}(f.declared(n));b.GraphicManipulator=w})},"esri/views/interactive/InteractiveToolBase":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./interactiveToolUtils".split(" "),
function(w,b,e,r,n,x,c){return function(b){function f(a){a=b.call(this)||this;a._attached=!1;return a}e(f,b);Object.defineProperty(f.prototype,"active",{get:function(){return this.view.activeTool===this},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isSupported",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"visible",{set:function(a){this._attached&&(a?this.show():(this.hide(),c.setActive(this,!1)));this._set("visible",a)},enumerable:!0,
configurable:!0});f.prototype.attach=function(a){!this._attached&&this.isSupported&&(this._set("toolViewManager",a),this.onAttach(a),this.visible&&this.show(),this._attached=!0)};f.prototype.detach=function(){this._attached&&(this.hide(),this.onDetach(),this._set("toolViewManager",null),this._attached=!1)};f.prototype.handleInputEvent=function(a){if(this._attached)this.onInputEvent(a,this.toolViewManager)};f.prototype.show=function(){};f.prototype.hide=function(){};f.prototype.onAttach=function(a){};
f.prototype.onDetach=function(){};f.prototype.onInputEvent=function(a,b){};r([x.property({constructOnly:!0})],f.prototype,"view",void 0);r([x.property({dependsOn:["view.activeTool"],readOnly:!0})],f.prototype,"active",null);r([x.property({value:!0})],f.prototype,"visible",null);r([x.property({readOnly:!0})],f.prototype,"toolViewManager",void 0);return f=r([x.subclass("esri.views.interactive.InteractiveToolBase")],f)}(x.declared(n))})},"esri/views/3d/interactive/editingTools/graphicReshape3D/GraphicReshape3DTool":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ./isSupportedGraphic ./ReshapeOperation ./reshapeUtils ../../../../interactive/InteractiveToolBase".split(" "),
function(w,b,e,r,n,x,c,f,u,a,h,g,t,m){Object.defineProperty(b,"__esModule",{value:!0});var l=c.getLogger("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshape3DTool");w=function(b){function d(a){a=b.call(this,a)||this;a._handles=new x;a._reshapeOperation=null;a._internalGeometryUpdate=!1;a.type="reshape-3d";return a}r(d,b);d.prototype.destroy=function(){this._handles.removeAll();this._set("view",null);this._set("graphic",null)};Object.defineProperty(d.prototype,"graphic",{set:function(a){f.isSome(a)&&
!h.isSupportedGraphic(a)?l.error("Only polyline and polygon geometries are supported"):this._set("graphic",a)},enumerable:!0,configurable:!0});d.prototype._updateGeometry=function(){f.isSome(this.graphic)&&t.isReshapeGeometry(this.graphic.geometry)?this._reshapeOperation.inputGeometry=this.graphic.geometry.clone():this._reshapeOperation.inputGeometry=null};d.prototype._updateGraphic=function(a){var d=this;this._handles.remove("onGraphicGeometryChange");this._updateGeometry();a=this.watch("graphic.geometry",
function(){!1===d._internalGeometryUpdate&&d._updateGeometry()},!0);this._handles.add(a,"onGraphicGeometryChange")};d.prototype._onReshapeGeometryChanged=function(){f.isNone(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)};d.prototype.onAttach=function(a){var d=this;this._reshapeOperation=new g.ReshapeOperation({toolViewManager:a,view:this.view});this._handles.add([this._reshapeOperation.watch("cursor",
function(){d.cursor=d._reshapeOperation.cursor}),this._reshapeOperation.on("reshape-operation-start",function(a){f.isNone(d.graphic)||(a.graphic=d.graphic,d.emit("reshape-start",a))}),this._reshapeOperation.on("vertex-move",function(a){d._onReshapeGeometryChanged();f.isSome(d.graphic)&&(a.graphic=d.graphic,d.emit("vertex-move",a))}),this._reshapeOperation.on("translate",function(a){d._onReshapeGeometryChanged();f.isSome(d.graphic)&&(a.graphic=d.graphic,d.emit("translate",a))}),this._reshapeOperation.on("vertex-add",
function(a){d._onReshapeGeometryChanged();f.isSome(d.graphic)&&(a.graphic=d.graphic,d.emit("vertex-add",a))}),this._reshapeOperation.on("vertex-remove",function(a){d._onReshapeGeometryChanged();f.isSome(d.graphic)&&(a.graphic=d.graphic,d.emit("vertex-remove",a))}),this._reshapeOperation.on("reshape-operation-stop",function(a){f.isNone(d.graphic)||(a.graphic=d.graphic,d.emit("reshape-stop",a))}),this._reshapeOperation.on("click",function(){return d.emit("click")}),u.init(this,"graphic",function(){d._updateGraphic(a)},
!0)])};d.prototype.onDetach=function(){this._handles.removeAll();this._reshapeOperation.destroy()};d.prototype.handleInputEvent=function(a){"key-down"!==a.type||"Delete"!==a.key&&"Backspace"!==a.key||this._reshapeOperation.removeSelectedVertices()};d.prototype.show=function(){};d.prototype.hide=function(){};d.prototype.reset=function(){this.graphic=null};e([a.property({constructOnly:!0,nonNullable:!0})],d.prototype,"view",void 0);e([a.property({value:null})],d.prototype,"graphic",null);e([a.property({readOnly:!0})],
d.prototype,"type",void 0);e([a.property({value:null})],d.prototype,"cursor",void 0);return d=e([a.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshape3DTool")],d)}(a.declared(m,n));b.GraphicReshape3DTool=w})},"esri/views/3d/interactive/editingTools/graphicReshape3D/isSupportedGraphic":function(){define(["require","exports","../../../../../core/maybe"],function(w,b,e){function r(b){return e.isSome(b)&&("polygon"===b.type||"polyline"===b.type)}Object.defineProperty(b,"__esModule",
{value:!0});b.isSupportedGeometry=r;b.isSupportedGraphic=function(b){return r(b.geometry)}})},"esri/views/3d/interactive/editingTools/graphicReshape3D/ReshapeOperation":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/Accessor ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/accessorSupport/decorators ../../../../../layers/graphics/dehydratedFeatures ./ReshapeMoveManipulator ./reshapeUtils ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil ../../../../interactive/Manipulator3D ../../../../interactive/manipulatorUtils".split(" "),
function(w,b,e,r,n,x,c,f,u,a,h,g,t,m,l){Object.defineProperty(b,"__esModule",{value:!0});var k=function(){return function(a,d){void 0===a&&(a=!1);void 0===d&&(d=!1);this.isDragging=a;this.fromTranslation=d;this.graphic=null;this.type="reshape-start"}}();b.ReshapeStartEvent=k;var d=function(){return function(a){this.coords=a;this.graphic=null;this.type="vertex-move"}}();b.VertexMoveEvent=d;var q=function(){return function(a,d){this.dxScreen=a;this.dyScreen=d;this.graphic=null;this.type="translate"}}();
b.TranslateEvent=q;var z=function(){return function(a){this.coords=a;this.graphic=null;this.type="vertex-add"}}();b.VertexAddEvent=z;var C=function(){return function(a){this.coords=a;this.graphic=null;this.type="vertex-remove"}}();b.VertexRemoveEvent=C;var A=function(){return function(a,d){void 0===a&&(a=!1);void 0===d&&(d=!1);this.isDragging=a;this.fromTranslation=d;this.graphic=null;this.type="reshape-stop"}}();b.ReshapeStopEvent=A;w=function(b){function n(a){a=b.call(this,a)||this;a._vertexManipulatorMaterial=
l.createManipulatorMaterial([1,.5,0],1);a._edgeManipulatorMaterial=l.createManipulatorMaterial([.5,.5,.5],1);a._selectedManipulatorMaterial=l.createManipulatorMaterial([1,1,1],1);a._manipulatorGeometry=new g(t.createSphereGeometry(1,16,16),"reshape-manipulator");a._handles=new c;a._manipulators=[];a._reshapeHelper=null;a._moveManipulator=null;a._numDragging=0;return a}r(n,b);n.prototype.destroy=function(){this._clear(null)};Object.defineProperty(n.prototype,"inputGeometry",{get:function(){return this._reshapeHelper?
this._reshapeHelper.geometry:null},set:function(a){this._recreateManipulators(this.toolViewManager,a)},enumerable:!0,configurable:!0});n.prototype.removeSelectedVertices=function(){var a=this._manipulators.filter(function(a){return a.manipulator.selected&&"vertex"===a.handle.type});this._removeVertices(a)};n.prototype._clear=function(a){this._handles.removeAll();a&&(this._manipulators.forEach(function(d){a.removeManipulator(d.manipulator)}),a.removeManipulator(this._moveManipulator));this._manipulators=
[];this._reshapeHelper=this._moveManipulator=null;this._numDragging=0};n.prototype._recreateManipulators=function(d,b){var c=this;this._clear(this.toolViewManager);this._reshapeHelper=h.createReshapeHelper(b,"global"===this.view.viewingMode);if(!this._reshapeHelper)return null;this._reshapeHelper.components.forEach(function(a){a.vertices.forEach(function(a){return c._createManipulator(a)});a.edges.forEach(function(a){return c._createManipulator(a)})});this._moveManipulator=new a.ReshapeMoveManipulator({view:this.view,
reshapeHelper:this._reshapeHelper,selectable:!1});this._handles.add(this._moveManipulator.watch("grabbing",function(a){c._manipulators.forEach(function(d){d.manipulator.interactive=!a})},!0),this._moveManipulator);this._handles.add(this._moveManipulator.watch("dragging",function(a){!0===a?(++c._numDragging,1===c._numDragging&&c.emit("reshape-operation-start",new k(!0,!0))):(--c._numDragging,0===c._numDragging&&c.emit("reshape-operation-stop",new A(!0,!0)))},!0),this._moveManipulator);this._handles.add(this._moveManipulator.watch("hovering",
function(a){c.cursor=a?"move":null},!0),this._moveManipulator);this._moveManipulator.on("drag",function(a){return c._moveManipulatorDragCallback(a)});this._moveManipulator.on("click",function(){return c.emit("click")});this.toolViewManager.addManipulator(this._moveManipulator)};n.prototype._clearManipulatorSelection=function(){this._manipulators.forEach(function(a){return a.manipulator.selected=!1})};n.prototype._createManipulator=function(a){var d=this,b=new m.Manipulator3D({view:this.view,renderObjects:[{geometry:this._manipulatorGeometry,
material:this._vertexManipulatorMaterial,stateMask:p.Vertex|4},{geometry:this._manipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:p.Edge|4},{geometry:this._manipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8}],radius:5});b.alignment="on-the-ground";b.allowOverlap=!0;"vertex"===a.type?(b.state=p.Vertex,b.selectable=!0):(b.state=p.Edge,b.selectable=!1);var c={manipulator:b,handle:a};this._manipulators.push(c);this.toolViewManager.addManipulator(b);this._setManipulatorPosition(c);
this._handles.add(b.watch("grabbing",function(a){d._moveManipulator.interactive=!a},!0),b);this._handles.add(b.watch("dragging",function(a){!0===a?(++d._numDragging,1===d._numDragging&&d.emit("reshape-operation-start",new k(!0))):(--d._numDragging,0===d._numDragging&&d.emit("reshape-operation-stop",new A(!0)))},!0),b);this._handles.add(b.watch("hovering",function(a){d.cursor=a?"vertex"===c.handle.type?"move":"copy":null},!0),b);b.on("drag",function(){return d._manipulatorMoveCallback(c)});b.on("click",
function(a){return d._manipulatorClickCallback(a,c)});return b};n.prototype._removeManipulator=function(a){a&&(this._handles.remove(a.manipulator),this._manipulators.splice(this._manipulators.indexOf(a),1),this.toolViewManager.removeManipulator(a.manipulator))};n.prototype._getManipulatorInfoFromHandle=function(a){if(a)for(var d=0,b=this._manipulators;d<b.length;d++){var c=b[d];if(a===c.handle)return c}return null};n.prototype._setManipulatorPosition=function(a){a&&("vertex"===a.handle.type?a.manipulator.mapPoint=
this._reshapeHelper.getVertexPositionAsPoint(a.handle,B):"edge"===a.handle.type&&(a.manipulator.mapPoint=this._reshapeHelper.getEdgePositionAsPoint(a.handle,.5,B)))};n.prototype._splitEdgeManipulator=function(a){if("edge"===a.handle.type){var d=this._reshapeHelper.splitEdge(a.handle,.5);a.handle=d;a.manipulator.state=p.Vertex;a.manipulator.selectable=!0;d.left&&this.toolViewManager&&this._createManipulator(d.left);d.right&&this.toolViewManager&&this._createManipulator(d.right);return d}return null};
n.prototype._manipulatorMoveCallback=function(a){var b=this;"edge"===a.handle.type&&this._splitEdgeManipulator(a);if(a.handle&&"vertex"===a.handle.type){!1===a.manipulator.selected&&(this._clearManipulatorSelection(),a.manipulator.selected=!0);var c=a.handle.pos,k=a.manipulator.mapPoint.x-c[0],f=a.manipulator.mapPoint.y-c[1],c=this._manipulators.filter(function(a){return a.manipulator.selected&&"vertex"===a.handle.type});c.forEach(function(d){var c=d.handle;c.pos[0]+=k;c.pos[1]+=f;a!==d&&(B.x=c.pos[0],
B.y=c.pos[1],B.spatialReference=b._reshapeHelper.geometry.spatialReference,d.manipulator.mapPoint=B)});this.outputGeometry=this._reshapeHelper.commit();c.forEach(function(a){a=a.handle;b._setManipulatorPosition(b._getManipulatorInfoFromHandle(a.left));b._setManipulatorPosition(b._getManipulatorInfoFromHandle(a.right))});c=c.map(function(a){return a.handle.unnormalizedPos});c=new d(c);this.emit("vertex-move",c)}};n.prototype._removeVertices=function(a){var d=this,b=[];a.forEach(function(a){"vertex"===
a.handle.type&&d._reshapeHelper.canRemoveVertex(a.handle)&&(0===b.length&&d.emit("reshape-operation-start",new k),b.push(a.handle.unnormalizedPos),d._removeManipulator(a),d._removeManipulator(d._getManipulatorInfoFromHandle(a.handle.left)),d._removeManipulator(d._getManipulatorInfoFromHandle(a.handle.right)),(a=d._reshapeHelper.removeVertex(a.handle))&&d._createManipulator(a))});0<b.length&&(this.outputGeometry=this._reshapeHelper.commit(),a=new C(b),this.emit("vertex-remove",a),this.emit("reshape-operation-stop",
new A))};n.prototype._manipulatorClickCallback=function(a,d){"vertex"===d.handle.type&&2===a.button&&this._removeVertices([d]);"edge"===d.handle.type&&0===a.button&&(this.emit("reshape-operation-start",new k),a=this._splitEdgeManipulator(d),this.outputGeometry=this._reshapeHelper.commit(),a=new z([a.unnormalizedPos]),this.emit("vertex-add",a),this.emit("reshape-operation-stop",new A))};n.prototype._moveManipulatorDragCallback=function(a){var b=this,c=[],k=!0;this._manipulators.forEach(function(d){"vertex"===
d.handle.type&&(d.manipulator.grabbing?k=!1:"vertex"===d.handle.type&&(d.handle.pos[0]+=a.dxGeometry,d.handle.pos[1]+=a.dyGeometry,c.push(d.handle.pos),b._setManipulatorPosition(d)))});this._manipulators.forEach(function(a){"vertex"!==a.handle.type&&b._setManipulatorPosition(a)});this.outputGeometry=this._reshapeHelper.commit();if(k)this.emit("translate",new q(a.dxScreen,a.dyScreen));else{var f=new d(c);this.emit("vertex-move",f)}};e([f.property({value:null})],n.prototype,"toolViewManager",void 0);
e([f.property({value:null,nonNullable:!0})],n.prototype,"view",void 0);e([f.property({value:null})],n.prototype,"inputGeometry",null);e([f.property({value:null})],n.prototype,"cursor",void 0);e([f.property({value:null})],n.prototype,"outputGeometry",void 0);return n=e([f.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.ReshapeOperation")],n)}(f.declared(n,x));b.ReshapeOperation=w;var B=u.makeDehydratedPoint(0,0,null,null),p;(function(a){a.Vertex=16;a.Edge=32})(p||(p={}))})},"esri/views/3d/interactive/editingTools/graphicReshape3D/ReshapeMoveManipulator":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/Accessor ../../../../../core/Collection ../../../../../core/maybe ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../views/3d/layers/support/popupUtils3D ../../../../../views/3d/support/projectionUtils ../../../../../views/3d/support/stack".split(" "),
function(w,b,e,r,n,x,c,f,u,a,h,g,t){Object.defineProperty(b,"__esModule",{value:!0});w=function(a){function b(d){d=a.call(this)||this;d._handlers=new x;d.interactive=!0;d.selectable=!1;d.allowOverlap=!0;d.grabbing=!1;d.dragging=!1;d.hovering=!1;d.selected=!1;d.active=!0;return d}r(b,a);b.prototype.initialize=function(){};b.prototype.destroy=function(){this._handlers.removeAll();this._handlers=null;this._set("view",null)};b.prototype.intersectionDistance=function(a){if(!this.active||!this.reshapeHelper.geometry)return null;
a=h.intersectsDrapedGeometry(a,this.reshapeHelper.geometry,this.view);if(c.isNone(a))return null;var d=t.sv3d.get();return this.view.renderCoordsHelper.toRenderCoords(a,d)?u.vec3.distance(m,this.view.state.camera.eye):null};b.prototype.attemptDragTo=function(a,b){if(null==this.reshapeHelper.geometry)return!1;var d=this.view.toMap(b.previous),c=this.view.toMap(a.screenPoint),k=0,f=0,e=0,h=0,l=0,q=0;d&&c&&(k=[0,0,0,0,0,0],g.bufferToBuffer([d.x,d.y,0,c.x,c.y,0],d.spatialReference,0,k,this.reshapeHelper.geometry.spatialReference,
0,2),e=k[3]-k[0],h=k[4]-k[1],k=c.x-d.x,f=c.y-d.y,l=a.screenPoint.x-b.previous.x,q=a.screenPoint.y-b.previous.y);var m={screenPoint:a.screenPoint,dxMap:k,dyMap:f,dxGeometry:e,dyGeometry:h,dxScreen:l,dyScreen:q,toMS:c};this._handlers.forEach(function(a){"drag"===a.type&&a.handler(m)});return!0};b.prototype.click=function(a){this._handlers.forEach(function(d){"click"===d.type&&d.handler(a)})};b.prototype.on=function(a,b){this._handlers.push({type:a,handler:b})};e([f.property()],b.prototype,"reshapeHelper",
void 0);e([f.property({constructOnly:!0,nonNullable:!0})],b.prototype,"view",void 0);e([f.property()],b.prototype,"interactive",void 0);e([f.property()],b.prototype,"selectable",void 0);e([f.property()],b.prototype,"allowOverlap",void 0);e([f.property()],b.prototype,"grabbing",void 0);e([f.property()],b.prototype,"dragging",void 0);e([f.property()],b.prototype,"hovering",void 0);e([f.property()],b.prototype,"selected",void 0);e([f.property()],b.prototype,"active",void 0);return b=e([f.subclass("esri.views.interactive.GeometryManipulator")],
b)}(f.declared(n));b.ReshapeMoveManipulator=w;var m=a.vec3f64.create()})},"esri/views/3d/layers/support/popupUtils3D":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../core/maybe ../../../../core/unitUtils ../../../../renderers/support/clickToleranceUtils".split(" "),function(w,b,e,r,n,x,c,f){function u(a,b,f){var e=f.get("basemapTerrain"),h=f.get("basemapTerrain.overlayManager"),h=h?h.overlayPixelSizeInMapUnits(a):
1,l=e&&!e.spatialReference.equals(f.spatialReference)?c.getMetersPerUnitForSR(e.spatialReference)/c.getMetersPerUnitForSR(f.spatialReference):b*h;b=a.x-l;e=a.y-l;h=a.x+l;a=a.y+l;return new n.Extent({xmin:Math.min(b,h),ymin:Math.min(e,a),xmax:Math.max(b,h),ymax:Math.max(e,a),spatialReference:f.spatialReference})}Object.defineProperty(b,"__esModule",{value:!0});b.createQueryGeometry=u;b.intersectsDrapedGeometry=function(a,b,c){a=c.toMap(a);if(x.isNone(a))return null;var e=f.calculateTolerance();return u(a,
e,c).intersects(b)?a:null}})},"esri/renderers/support/clickToleranceUtils":function(){define(["require","exports"],function(w,b){function e(b,e){return e&&e.xoffset?Math.max(b,Math.abs(e.xoffset)):e&&e.yoffset?Math.max(b,Math.abs(e.yoffset)):b}Object.defineProperty(b,"__esModule",{value:!0});b.calculateTolerance=function(b){if(!b)return 6;if("simple"===b.type)return e(6,b.symbol);if("unique-value"===b.type){var n=6;b.uniqueValueInfos.forEach(function(b){n=e(n,b.symbol)});return n}if("class-breaks"===
b.type){var r=6;b.classBreakInfos.forEach(function(b){r=e(r,b.symbol)});return r}return 6}})},"esri/views/3d/interactive/editingTools/graphicReshape3D/reshapeUtils":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../geometry/support/coordsUtils ../../../../../geometry/support/spatialReferenceUtils".split(" "),
function(w,b,e,r,n,x,c,f,u){function a(a,b,d){void 0===d&&(d=c.vec2f64.create());return x.vec2.set(d,a,b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(){this.vertices=[];this.edges=[]}a.prototype.makeVertex=function(a,d,b){void 0===d&&(d=null);void 0===b&&(b=null);a={pos:a,unnormalizedPos:a,left:d,right:b,type:"vertex",component:this};this.vertices.push(a);return a};a.prototype.makeEdge=function(a,b){var d={v0:a,v1:b,type:"edge",component:this};a.right=d;b.left=d;this.edges.push(d);
return d};a.prototype.removeVertex=function(a){this.vertices.splice(this.vertices.indexOf(a),1);a.left&&this.removeEdge(a.left);a.right&&this.removeEdge(a.right)};a.prototype.removeEdge=function(a){this.edges.splice(this.edges.indexOf(a),1);a.v0.right=null;a.v1.left=null};return a}();b.Component=h;b.makeMapPoint=a;w=function(){function b(a,b){this.geometry=a;this.doUnnormalization=b;this.components=[];(a=u.getInfo(this.geometry.spatialReference))?(this._spanMin=a.valid[0],this._spanMax=a.valid[1],
this._span=this._spanMax-this._spanMin):this.doUnnormalization=!1}b.prototype.getVertexPositionAsPoint=function(a,b){b.x=a.pos[0];b.y=a.pos[1];b.z=null;b.spatialReference=this.geometry.spatialReference;return b};b.prototype.getEdgePosition=function(b,d,f){void 0===f&&(f=c.vec2f64.create());return a((b.v1.unnormalizedPos[0]-b.v0.unnormalizedPos[0])*d+b.v0.unnormalizedPos[0],(b.v1.unnormalizedPos[1]-b.v0.unnormalizedPos[1])*d+b.v0.unnormalizedPos[1],f)};b.prototype.getEdgePositionAsPoint=function(a,
b,c){a=this.getEdgePosition(a,b,m);c.x=a[0];c.y=a[1];c.z=null;c.spatialReference=this.geometry.spatialReference;return c};b.prototype.canRemoveVertex=function(a){return!0};b.prototype.removeVertex=function(a){var b=a.component,c=a.left,f=a.right;b.removeVertex(a);return c&&f?b.makeEdge(c.v0,f.v1):null};b.prototype.splitEdge=function(a,b){var d=a.component;b=d.makeVertex(this.getEdgePosition(a,b));var c=a.v0,f=a.v1;d.removeEdge(a);d.makeEdge(c,b);d.makeEdge(b,f);return b};return b}();b.ReshapeHelper=
w;var g=function(b){function c(d,c){c=b.call(this,d,c)||this;c.geometry=d;d=c.geometry.rings;for(var e=0;e<d.length;++e){for(var k=d[e],l=new h,g=k.length-1,p=0;p<g;++p){var m=a(k[p][0],k[p][1]);l.makeVertex(m)}k=l.vertices.length-1;for(g=0;g<k;++g)l.makeEdge(l.vertices[g],l.vertices[g+1]);l.makeEdge(l.vertices[l.vertices.length-1],l.vertices[0]);c.doUnnormalization&&f.computeUnnormalizedVertexPositionsOnDateLineCrossing(l.vertices,c._spanMin,c._spanMax,c._span);c.components.push(l)}return c}r(c,
b);c.prototype.canRemoveVertex=function(a){return 3<a.component.vertices.length};c.prototype.commit=function(){var a=this,b=[];this.components.forEach(function(d){var c=[];a.doUnnormalization&&f.computeUnnormalizedVertexPositionsOnDateLineCrossing(d.vertices,a._spanMin,a._spanMax,a._span);var e=d.vertices[0],h=e;do c.push(e.unnormalizedPos),e=e.right.v1;while(e&&e!==h);c.push(d.vertices[0].unnormalizedPos);b.push(c)});this.geometry.rings=b;return this.geometry};return c}(w),t=function(b){function c(d,
c){c=b.call(this,d,c)||this;c.geometry=d;d=c.geometry.paths;for(var e=0;e<d.length;++e){for(var k=d[e],l=new h,g=k.length,m=0;m<g;++m){var n=a(k[m][0],k[m][1]);l.makeVertex(n)}k=l.vertices.length-1;for(g=0;g<k;++g)l.makeEdge(l.vertices[g],l.vertices[g+1]);c.doUnnormalization&&f.computeUnnormalizedVertexPositionsOnDateLineCrossing(l.vertices,c._spanMin,c._spanMax,c._span);c.components.push(l)}return c}r(c,b);c.prototype.canRemoveVertex=function(a){return 2<a.component.vertices.length};c.prototype.commit=
function(){var a=this,b=[];this.components.forEach(function(c){var d=[];a.doUnnormalization&&f.computeUnnormalizedVertexPositionsOnDateLineCrossing(c.vertices,a._spanMin,a._spanMax,a._span);var e=c=c.vertices[0];do d.push(c.unnormalizedPos),c=c.right?c.right.v1:null;while(c&&c!==e);b.push(d)});this.geometry.paths=b;return this.geometry};return c}(w);b.isReshapeGeometry=function(a){return n.isSome(a)&&("polygon"===a.type||"polyline"===a.type)};b.createReshapeHelper=function(a,b){return a?"polygon"===
a.type?new g(a,b):new t(a,b):null};var m=c.vec2f64.create()})},"esri/views/interactive/Manipulator3D":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/Accessor ../../core/Collection ../../core/compilerUtils ../../core/maybe ../../core/screenUtils ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f64 ../../core/libs/gl-matrix-2/mat4 ../../core/libs/gl-matrix-2/mat4f64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../../geometry/support/aaBoundingRect ../../layers/graphics/dehydratedFeatures ../3d/support/geometryUtils ../3d/support/stack ../3d/webgl-engine/lib/Intersector ../3d/webgl-engine/lib/intersectorUtils ../3d/webgl-engine/lib/Layer ../3d/webgl-engine/lib/Object3D ../3d/webgl-engine/parts/Model".split(" "),
function(w,b,e,r,n,x,c,f,u,a,h,g,t,m,l,k,d,q,z,C,A,B,p,W,D,L,H){function v(a){return 0!==a[12]||0!==a[13]||0!==a[14]}Object.defineProperty(b,"__esModule",{value:!0});w=function(b){function g(a){a=b.call(this)||this;a.hideOnGrab=!1;a.moveOnDrag=!0;a.snapToPointer=!0;a.allowOverlap=!1;a.collisionType={type:"point"};a.renderObjects=[];a.autoScaleRenderObjects=!0;a._radius=10;a._focusMultiplier=2;a._touchMultiplier=2.5;a.interactive=!0;a.selectable=!1;a.dragging=!1;a._position=q.vec3f64.create();a._modelTransform=
m.mat4f64.create();a._dragOffset=null;a._dirtyScreenPoint=u.createScreenPoint();a._dirtyScreenPointArray=u.createScreenPointArray();a._dirtyRenderScreenPointArray=u.createRenderScreenPointArray3();a._dirtyOriginScreenPointArray=u.createScreenPointArray();a._screenPositionDirty=!0;a._engineResourcesAddedToStage=!1;a._engineResources=null;a._engineLayerId=null;a._materialIdReferences=null;a._hitResult={onSurface:!1,surfaceType:"ground"};a._handlers=new x;return a}r(g,b);n=g;g.prototype.initialize=function(){this._intersector=
new p(this.view.viewingMode);this._mapPoint=C.makeDehydratedPoint(0,0,0,this.view.spatialReference)};g.prototype.destroy=function(){this._handlers.removeAll();this._handlers=null;this._removeResourcesFromStage();this._engineResources=null;this._set("view",null);this._camera=null};Object.defineProperty(g.prototype,"alignment",{get:function(){return this._get("alignment")},set:function(a){this._set("alignment",a);this.constructed&&this._refreshMapPoint()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"visible",{set:function(a){a!==this._get("visible")&&(this._set("visible",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"radius",{get:function(){return this._radius},set:function(a){a!==this._radius&&(this._radius=a,this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"focusMultiplier",{get:function(){return this._focusMultiplier},set:function(a){this._focusMultiplier=a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"touchMultiplier",{get:function(){return this._touchMultiplier},set:function(a){this._touchMultiplier=a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"modelTransform",{get:function(){return this._modelTransform},set:function(a){v(a)&&(this._screenPositionDirty=!0);t.mat4.copy(this._modelTransform,a);this._updateEngineObject()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"position",{get:function(){return this._position},set:function(a){this.view.renderCoordsHelper.fromRenderCoords(a,
this._mapPoint,this._mapPoint.spatialReference);this._refreshMapPoint()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"mapPoint",{get:function(){return this._mapPoint},set:function(a){C.clonePoint(a,this._mapPoint);this._refreshMapPoint()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"grabbing",{set:function(a){a!==this._get("grabbing")&&(this._set("grabbing",a),this._updateEngineObject());a||(this._dragOffset=null)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"hovering",{set:function(a){a!==this._get("hovering")&&(this._set("hovering",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"selected",{set:function(a){a!==this._get("selected")&&(this._set("selected",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"active",{set:function(a){a!==this._get("active")&&(this._set("active",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"state",{set:function(a){a!==this._get("state")&&(this._set("state",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"surfaceType",{get:function(){return this._hitResult.onSurface?this._hitResult.surfaceType:null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"screenPoint",{get:function(){this._updateScreenPositions();return this._dirtyScreenPoint},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_screenPointArray",{get:function(){this._updateScreenPositions();return this._dirtyScreenPointArray},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_renderScreenPointArray",{get:function(){this._updateScreenPositions();return this._dirtyRenderScreenPointArray},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_originScreenPointArray",{get:function(){this._updateScreenPositions();return this._dirtyOriginScreenPointArray},enumerable:!0,configurable:!0});g.prototype._updateScreenPositions=function(a){void 0===a&&(a=!1);if(this._screenPositionDirty){a=v(this._modelTransform);var b;a?(b=this._calculateModelTransformOffset(E),b=d.vec3.add(b,b,this._position)):b=this._position;this._screenPositionDirty=!1;this._camera.projectPoint(b,this._dirtyRenderScreenPointArray);
this._camera.renderToScreen(this._dirtyRenderScreenPointArray,this._dirtyScreenPointArray);u.screenPointArrayToObject(this._dirtyScreenPointArray,this._dirtyScreenPoint);a?(this._camera.projectPoint(this._position,R),this._camera.renderToScreen(R,this._dirtyOriginScreenPointArray)):l.vec2.copy(this._dirtyOriginScreenPointArray,this._dirtyScreenPointArray)}};g.prototype.intersectionDistance=function(a,b){if(!this._get("visible")||!this._get("active"))return null;var f=u.screenPointObjectToArray(a,
F);a=this._getCollisionRadius(b);switch(this.collisionType.type){case "point":if(l.vec2.squaredDistance(this._screenPointArray,f)<a*a)return this._renderScreenPointArray[2];break;case "line":var e=this.collisionType.paths;b=this._camera.computeScreenPixelSizeAt(this._position);b=this._calculateObjectTransform(b,M);a*=this._camera.computeScreenPixelSizeAt(this._position);for(var f=A.ray.fromScreen(this._camera,f,J),g=0,k=e;g<k.length;g++)if(e=k[g],0!==e.length)for(var m=d.vec3.transformMat4(T,e[0],
b),n=1;n<e.length;n++){var p=d.vec3.transformMat4(U,e[n],b),G=A.lineSegment.closestRayDistance2(A.lineSegment.fromPoints(m,p,S),f);if(null!=G&&G<a*a)return b=d.vec3.add(B.sv3d.get(),m,p),d.vec3.scale(b,b,.5),a=u.castRenderScreenPointArray(B.sv3d.get()),this._camera.projectPoint(b,a),a[2];d.vec3.copy(m,p)}break;case "disc":m=this.collisionType.direction;b=this._camera.computeScreenPixelSizeAt(this._position);b=this._calculateObjectTransform(b,M);a*=this._camera.computeScreenPixelSizeAt(this._position);
f=A.ray.fromScreen(this._camera,f,J);n=h.mat3.fromMat4(O,b);n=d.vec3.transformMat3(P,m,n);m=this._calculateModelTransformPosition(V);A.plane.fromPositionAndNormal(m,n,N);g=Q;if(A.plane.intersectRay(N,f,g)&&d.vec3.squaredDistance(g,m)<a*a)return this._renderScreenPointArray[2];break;case "ribbon":b=this.collisionType;e=b.paths;m=b.direction;b=this._camera.computeScreenPixelSizeAt(this._position);b=this._calculateObjectTransform(b,M);a*=this._camera.computeScreenPixelSizeAt(this._position);f=A.ray.fromScreen(this._camera,
f,J);n=h.mat3.fromMat4(O,b);n=d.vec3.transformMat3(P,m,n);m=this._calculateModelTransformPosition(V);A.plane.fromPositionAndNormal(m,n,N);g=Q;if(!A.plane.intersectRay(N,f,g))break;f=0;for(k=e;f<k.length;f++)if(e=k[f],0!==e.length)for(m=d.vec3.transformMat4(T,e[0],b),n=1;n<e.length;n++){p=d.vec3.transformMat4(U,e[n],b);G=A.lineSegment.distance2(A.lineSegment.fromPoints(m,p,S),g);if(null!=G&&G<a*a)return b=d.vec3.add(B.sv3d.get(),m,p),d.vec3.scale(b,b,.5),a=u.castRenderScreenPointArray(B.sv3d.get()),
this._camera.projectPoint(b,a),a[2];d.vec3.copy(m,p)}break;default:c.neverReached(this.collisionType)}return null};g.prototype.attemptDragTo=function(a){if(!this.moveOnDrag)return this._handlers.forEach(function(b){var c=b.handler;"drag"===b.type&&c(a)}),!1;var b=u.screenPointObjectToArray(a.screenPoint,F);f.isNone(this._dragOffset)&&this.grabbing&&!this.snapToPointer&&(this._dragOffset=l.vec2.subtract(k.vec2f32.create(),b,this._originScreenPointArray));f.isSome(this._dragOffset)&&l.vec2.subtract(b,
b,this._dragOffset);var b=this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(b,this._intersector,"on-the-ground"===this.alignment?I:null).results.min,c=Q;b.getIntersectionPoint(c)?(this.position=c,this._hitResult.onSurface=!0,this._hitResult.surfaceType="TerrainRenderer"===b.intersector?"ground":"feature",this._handlers.forEach(function(b){var c=b.handler;"drag"===b.type&&c(a)})):this._hitResult.onSurface=!1;return this._hitResult.onSurface};g.prototype.click=function(a){this._handlers.forEach(function(b){var c=
b.handler;"click"===b.type&&c(a)})};g.prototype.on=function(a,b){this._handlers.push({type:a,handler:b})};g.prototype.addToEngineLayer=function(a,b){f.isSome(this._engineLayerId)||(f.isSome(a)?this._engineLayerId=a:(a=new D("manipulator-3d",{isPickable:!1}),this.view._stage.add(H.ContentType.LAYER,a),this.view._stage.addToViewContent([a.id]),this._engineLayerId=a.id),f.isSome(b)?this._materialIdReferences=b:this._materialIdReferences=new Map,this._updateEngineObject())};g.prototype.installRenderHandles=
function(a,b){var c=null,d=null;b(function(a){return a instanceof n?(c=a._engineLayerId,d=a._materialIdReferences,!1):!0});this.addToEngineLayer(c,d);this._camera=this.view.state.camera;if(!a.has("render-manipulator-3d")){var f=function(a){b(function(b){b instanceof n&&b.view.renderCoordsHelper.fromRenderCoords(b.position,K,a.spatialReference)&&z.containsPoint(a.extent,K)&&b._refreshMapPoint(!0)})};a.add([this.view.state.watch("camera",function(a){b(function(b){b instanceof n&&(b._camera=a,b._screenPositionDirty=
!0,b._updateEngineObject())})}),this.view.elevationProvider.on("elevation-change",function(a){return f(a)})],"render-manipulator-3d")}};g.prototype._refreshMapPoint=function(a){void 0===a&&(a=!1);switch(this.alignment){case "none":break;case "on-the-ground":var b=this.view.elevationProvider.getElevation(this.mapPoint,"ground");if(b===this._mapPoint.z&&a)return;this._mapPoint.z=b;break;default:c.neverReached(this.alignment)}this._screenPositionDirty=!0;this._hitResult.onSurface=!1;this.view.renderCoordsHelper.toRenderCoords(this._mapPoint,
this._position);this._updateEngineObject()};g.prototype._updateEngineObject=function(){if(!f.isNone(this._engineLayerId))if(!1===this._get("visible")||!1===this._get("active"))this._removeResourcesFromStage();else{var a=this._get("view").state.camera.computeScreenPixelSizeAt(this._position),b=M;!0===this._get("autoScaleRenderObjects")&&(a*=this._getFocusedSize(this._radius,this._focused));this._calculateObjectTransform(a,b);for(var a=this._ensureEngineResources().objectsByState,c=(this._focused?2:
1)|(this._get("selected")?8:4),d=this._get("hideOnGrab")&&this._get("grabbing"),e=0;e<a.length;e++){var g=a[e],h=g.stateMask,g=g.objects;if(d)for(var h=0,k=g;h<k.length;h++)g=k[h],g.object3D.hideAllComponents(),g.startTimeMs=0;else if(k=0===(h&15)||(c&h)===(h&15),h=0===(h&32752)||(this._get("state")&h)===(h&32752),k&&h)for(h=0,k=g;h<k.length;h++)g=k[h],g.object3D.unhideAllComponents(),g.object3D.objectTransformation=b;else for(h=0,k=g;h<k.length;h++)g=k[h],g.object3D.hideAllComponents(),g.startTimeMs=
0}}};g.prototype._ensureEngineResources=function(){if(f.isNone(this._engineResources)){var a=this.view._stage.get(H.ContentType.LAYER,f.expect(this._engineLayerId)),b=[],c=new Set;this.renderObjects.forEach(function(a){a=a.material;c.has(a)||(b.push(a),c.add(a))});var d=function(a,b){var c=b.geometry,d=b.material,e=b.transform;Array.isArray(c)?c.forEach(function(b){return a.addGeometry(b,d,e)}):a.addGeometry(c,d,e)},e=new Map;this.renderObjects.forEach(function(a){var b=new L({idHint:"manipulator"});
d(b,a);var c=a.stateMask||0,g=e.get(c)||[];g.push({object3D:b,startTimeMs:0,delayMs:a.delayMs});e.set(c,g)});var g=[];e.forEach(function(a,b){g.push({stateMask:b,objects:a})});this._engineResources={objectsByState:g,layer:a,materials:b}}this._addResourcesToStage();return this._engineResources};g.prototype._addResourcesToStage=function(){var a=this;if(!this._engineResourcesAddedToStage&&!f.isNone(this._engineResources)){var b=this._engineResources,c=b.objectsByState,d=b.layer;b.materials.forEach(function(b){var c=
f.expect(a._materialIdReferences),d=c.get(b.id)||0;0===d&&a.view._stage.add(H.ContentType.MATERIAL,b);c.set(b.id,d+1)});c.forEach(function(b){b.objects.forEach(function(b){b=b.object3D;d.addObject(b);a.view._stage.add(H.ContentType.OBJECT,b)})});this._engineResourcesAddedToStage=!0}};g.prototype._removeResourcesFromStage=function(){var a=this;if(this._engineResourcesAddedToStage&&!f.isNone(this._engineResources)){var b=this._engineResources,c=b.layer,d=b.materials;b.objectsByState.forEach(function(b){b.objects.forEach(function(b){b=
b.object3D;c.removeObject(b);a.view._stage.remove(H.ContentType.OBJECT,b.id)})});d.forEach(function(b){var c=f.expect(a._materialIdReferences),d=c.get(b.id);1===d?(a.view._stage.remove(H.ContentType.MATERIAL,b.id),c.delete(b.id)):c.set(b.id,d-1)});this._engineResourcesAddedToStage=!1}};g.prototype._getCollisionRadius=function(a){return this._getFocusedSize(this._radius,!0)*("touch"===a?this._touchMultiplier:1)};g.prototype._getFocusedSize=function(a,b){return a*(b?this._focusMultiplier:1)};g.prototype._calculateModelTransformPosition=
function(a){var b=this._camera.computeScreenPixelSizeAt(this._position),b=this._calculateObjectTransform(b,ba);return d.vec3.set(a,b[12],b[13],b[14])};g.prototype._calculateModelTransformOffset=function(a){var b=this._calculateModelTransformPosition(a);return d.vec3.subtract(a,b,this._position)};g.prototype._calculateObjectTransform=function(a,b){t.mat4.set(b,a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1);t.mat4.multiply(b,b,this._modelTransform);b[12]+=this._position[0];b[13]+=this._position[1];b[14]+=this._position[2];
b[15]=1;return b};var n;e([a.property({constructOnly:!0,nonNullable:!0})],g.prototype,"view",void 0);e([a.property({value:"none",nonNullable:!0})],g.prototype,"alignment",null);e([a.property()],g.prototype,"hideOnGrab",void 0);e([a.property()],g.prototype,"moveOnDrag",void 0);e([a.property()],g.prototype,"snapToPointer",void 0);e([a.property()],g.prototype,"allowOverlap",void 0);e([a.property()],g.prototype,"collisionType",void 0);e([a.property({constructOnly:!0})],g.prototype,"renderObjects",void 0);
e([a.property()],g.prototype,"autoScaleRenderObjects",void 0);e([a.property({value:!0})],g.prototype,"visible",null);e([a.property()],g.prototype,"radius",null);e([a.property()],g.prototype,"focusMultiplier",null);e([a.property()],g.prototype,"touchMultiplier",null);e([a.property()],g.prototype,"interactive",void 0);e([a.property()],g.prototype,"selectable",void 0);e([a.property({value:!1})],g.prototype,"grabbing",null);e([a.property()],g.prototype,"dragging",void 0);e([a.property({value:!1})],g.prototype,
"hovering",null);e([a.property({value:!1})],g.prototype,"selected",null);e([a.property({value:!0})],g.prototype,"active",null);e([a.property({value:0})],g.prototype,"state",null);e([a.property({dependsOn:["hovering","grabbing"]})],g.prototype,"focused",null);return g=n=e([a.subclass("esri.views.interactive.Manipulator3D")],g)}(a.declared(n));b.Manipulator3D=w;var I={include:new Set};I.include.add(W.TERRAIN_ID);var F=u.createScreenPointArray(),R=u.createRenderScreenPointArray3(),S=A.lineSegment.create(),
J=A.ray.create(),O=g.mat3f64.create(),ba=m.mat4f64.create(),M=m.mat4f64.create(),N=A.plane.create(),T=q.vec3f64.create(),U=q.vec3f64.create(),Q=q.vec3f64.create(),P=q.vec3f64.create(),V=q.vec3f64.create(),E=q.vec3f64.create(),K=q.vec3f64.create()})},"esri/views/interactive/manipulatorUtils":function(){define("require exports ../../core/libs/gl-matrix-2/mat4 ../../core/libs/gl-matrix-2/vec3 ../3d/support/stack ../3d/webgl-engine/lib/Geometry ../3d/webgl-engine/lib/GeometryUtil ../3d/webgl-engine/materials/DefaultMaterial ./Manipulator3D".split(" "),
function(w,b,e,r,n,x,c,f,u){function a(a,b){var c=1!==b;a=new f({diffuse:a,transparent:c,writeDepth:!c,cullFace:"back",opacity:b,castShadows:!1,instanced:["transformation"]},"manipulator");a.renderOccluded=4;return a}function h(a,b,c,e){a=r.vec3.normalize(n.sv3d.get(),a);b=r.vec3.normalize(n.sv3d.get(),b);var f=r.vec3.cross(n.sv3d.get(),a,b);e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=0;e[4]=b[0];e[5]=b[1];e[6]=b[2];e[7]=0;e[8]=f[0];e[9]=f[1];e[10]=f[2];e[11]=0;e[12]=c[0];e[13]=c[1];e[14]=c[2];e[15]=1;return e}
Object.defineProperty(b,"__esModule",{value:!0});b.createManipulatorMaterial=a;b.createSphereManipulator=function(b,e,f){return new u.Manipulator3D({view:b,renderObjects:[{geometry:new x(c.createSphereGeometry(1,32,32),"manipulator"),material:a(e,f)}]})};b.calculateInputRotationTransform=function(a,b,c,f){a=r.vec3.subtract(n.sv3d.get(),a,c);f=r.vec3.cross(n.sv3d.get(),f,a);c=h(a,f,c,n.sm4d.get());e.mat4.invert(c,c);b=r.vec3.transformMat4(n.sv3d.get(),b,c);return Math.atan2(b[1],b[0])};b.calculateTranslateRotateFromBases=
h})},"esri/views/3d/interactive/editingTools/graphicTransform3D/GraphicTransform3DTool":function(){define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/scheduling ../../../../../core/screenUtils ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/math/common ../../../../../geometry/Point ../../../../../layers/graphics/dehydratedFeatures ./graphicTransform3DToolConfig ./isSupportedGraphic ../../../support/geometryUtils ../../../support/mathUtils ../../../support/projectionUtils ../../../support/stack ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/materials/ColorMaterial ../../../../interactive/InteractiveToolBase ../../../../interactive/Manipulator3D ../../../../interactive/manipulatorUtils".split(" "),
function(w,b,e,r,n,x,c,f,u,a,h,g,t,m,l,k,d,q,z,C,A,B,p,W,D,L,H,v,I,F,R,S,J,O){function ba(a){var b=new I(F.createCylinderGeometry(p.DISC_HEIGHT,1,p.GEOMETRY_SEGMENTS,z.vec3f64.fromValues(0,0,1),z.vec3f64.fromValues(0,0,0)),"graphic-transform-disc"),c=E(),e=E(.5),f=k.mat4.fromScaling(d.mat4f64.create(),z.vec3f64.fromValues(p.DISC_RADIUS,p.DISC_RADIUS,p.DISC_RADIUS));a=new J.Manipulator3D({view:a,renderObjects:[{geometry:b,material:c,stateMask:y.RingUnfocused|y.ArrowUnfocused,transform:f},{geometry:b,
material:e,transform:f}],autoScaleRenderObjects:!1,radius:p.DISC_COLLISION_RADIUS,focusMultiplier:1,allowOverlap:!0,snapToPointer:!1,alignment:"on-the-ground",collisionType:{type:"disc",direction:z.vec3f64.fromValues(0,0,1)}});a.visible=!1;return a}function M(a){for(var b=function(a,b,c){for(var d=[],e=Math.ceil(p.GEOMETRY_SEGMENTS*(b-a)/(2*Math.PI)),f=0;f<e+1;f++){var g=a+f*(b-a)/e;d.push(z.vec3f64.fromValues(c*Math.cos(g),c*Math.sin(g),0))}return d},c=function(a){return b(0,2*Math.PI,a)},e=function(a,
b){return new I(F.createPathExtrusionGeometry([[-b/2,0],[b/2,0],[b/2,p.RING_HEIGHT/2],[-b/2,p.RING_HEIGHT/2]],a,[],[],!1),"graphic-transform-ring")},f=c(p.RING_RADIUS),g=e(f,p.RING_THICKNESS),h=[],n=[],ha=[],l=0;2>l;l++){var m=l*Math.PI-Math.PI/4,q=Math.PI/2-p.ROTATE_INDICATOR_ARC_LENGTH,r=m+q,m=m+Math.PI/2-q,q=b(r,m,p.INNER_INDICATOR_RADIUS),u=e(q,p.INDICATOR_THICKNESS);ha.push(q);h.push(u);n.push(u);for(u=0;2>u;u++){var w=0===u,t=d.mat4f64.create();if(w){k.mat4.scale(t,t,[1,-1,1]);k.mat4.rotate(t,
t,-r,[0,0,1]);var v=Math.round(p.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE*(q.length-1))}else k.mat4.rotate(t,t,m,[0,0,1]),v=Math.round((1-p.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE)*(q.length-1));t[12]=q[v][0];t[13]=q[v][1];t[14]=q[v][2];v=F.createExtrudedTriangle(p.ROTATE_INDICATOR_ARROW_TIP_LENGTH,0,p.ROTATE_INDICATOR_ARROW_TIP_RADIUS,p.RING_HEIGHT);F.transformInPlace(v,t);t=new I(v,"graphic-transform-ring-rotate");(w?h:n).push(t)}}u=[];for(l=0;2>l;l++)m=l*Math.PI-Math.PI/4,q=Math.PI/2-p.SCALE_INDICATOR_ARC_LENGTH,
r=m+q,m=m+Math.PI/2-q,q=b(r,m,p.OUTER_INDICATOR_RADIUS),u.push(e(q,p.INDICATOR_THICKNESS));l=c(p.RING_RADIUS+p.SCALE_INDICATOR_OFFSET1);r=c(p.RING_RADIUS+p.SCALE_INDICATOR_OFFSET2);l=e(l,p.INDICATOR_THICKNESS);r=e(r,p.INDICATOR_THICKNESS);m=c(p.RING_RADIUS-p.SCALE_INDICATOR_OFFSET1);q=c(p.RING_RADIUS-p.SCALE_INDICATOR_OFFSET2);c=e(m,p.INDICATOR_THICKNESS);e=e(q,p.INDICATOR_THICKNESS);m=E();q=E(.66);w=E(.5);t=E(.33);g=[{geometry:g,material:m,stateMask:y.DiscUnfocused|y.ArrowUnfocused},{geometry:g,
material:w},{geometry:u,material:m,stateMask:y.Unlocked|y.RingFocused},{geometry:l,material:q,stateMask:y.ScaleIn|2},{geometry:r,material:t,stateMask:y.ScaleIn|2},{geometry:c,material:q,stateMask:y.ScaleOut|2},{geometry:e,material:t,stateMask:y.ScaleOut|2},{geometry:h,material:m,stateMask:y.Unlocked|y.RingFocused},{geometry:h,material:m,stateMask:y.RotateLeft|2},{geometry:n,material:m,stateMask:y.RotateRight|2}];f=[f].concat(ha);return new J.Manipulator3D({view:a,renderObjects:g,autoScaleRenderObjects:!1,
radius:p.RING_THICKNESS,focusMultiplier:1,moveOnDrag:!1,allowOverlap:!0,alignment:"on-the-ground",collisionType:{type:"ribbon",paths:f,direction:z.vec3f64.fromValues(0,0,1)}})}function N(a){var b=Math.sqrt(p.DISC_TRANSLATE_ARROW_SIZE*p.DISC_TRANSLATE_ARROW_SIZE*3/4),c=F.createExtrudedTriangle(b,p.DISC_TRANSLATE_ARROW_SIZE/2,p.DISC_TRANSLATE_ARROW_SIZE/2,p.DISC_HEIGHT);F.transformInPlace(c,k.mat4.fromTranslation(v.sm4d.get(),q.vec3.set(v.sv3d.get(),0,-b/3,0)));var c=new I(c,"graphic-transform-disc-arrow"),
d=E(),e=E(.5);a=new J.Manipulator3D({view:a,renderObjects:[{geometry:c,material:e,stateMask:y.DiscFocused|1},{geometry:c,material:e,stateMask:y.ArrowFocused|1},{geometry:c,material:d,stateMask:2}],autoScaleRenderObjects:!1,radius:b,focusMultiplier:1,allowOverlap:!0,snapToPointer:!1,alignment:"on-the-ground",collisionType:{type:"disc",direction:z.vec3f64.fromValues(0,0,1)}});a.visible=!1;return a}function T(a,b){var c=this,d=a.allLayerViews.find(function(a){return a.layer===b.layer}),e=b.symbol;return h.all(e.symbolLayers.map(function(a){return x(c,
void 0,void 0,function(){var b,c;return n(this,function(f){switch(f.label){case 0:c=b=null,"object"===a.type&&(b=a.heading),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,d.whenSymbolLayerSize(e,a)];case 2:return c=f.sent(),[3,4];case 3:return f.sent(),c=null,[3,4];case 4:return[2,{heading:b,size:c}]}})})}).toArray()).then(function(a){return{symbolLayers:a}})}function U(a){return(a=a.symbol.symbolLayers.find(function(a){return"object"===a.type}))&&a.heading||0}function Q(b,c,d,e){b.symbolLayers.forEach(function(b,
f){var g=c.symbolLayers[f];f=g.heading;g=g.size;"object"===b.type&&(b.heading=(a.isSome(f)?f:0)-C.toDegree(d),a.isSome(g)&&"width"in g&&(b.width=g.width*e,b.depth=g.depth*e,b.height=g.height*e))})}function P(a){var b=q.vec3.subtract(v.sv3d.get(),a.startPoint,a.origin);a=q.vec3.subtract(v.sv3d.get(),a.endPoint,a.origin);b=q.vec3.length(b);a=q.vec3.length(a);return 0===b?0:a/b}function V(a,b){var c=a.origin,d=a.startPoint,e=a.endPoint,f=a.plane;a=K(d,b,v.sv3d.get());e=K(e,b,v.sv3d.get());if(q.vec3.squaredDistance(a,
e)<p.DRAG_THRESHOLD_PX*p.DRAG_THRESHOLD_PX)return null;var g=q.vec3.subtract(v.sv3d.get(),d,c),f=q.vec3.cross(v.sv3d.get(),g,f),d=q.vec3.add(v.sv3d.get(),d,f),c=K(c,b,v.sv3d.get());b=K(d,b,v.sv3d.get());d=q.vec3.subtract(v.sv3d.get(),b,a);b=q.vec3.subtract(v.sv3d.get(),a,c);a=D.ray.wrap(a,d);b=D.ray.wrap(c,b);return D.ray.distance2(a,e)<D.ray.distance2(b,e)?"rotate":"scale"}function E(a){void 0===a&&(a=1);var b=p.HANDLE_COLOR.concat([a]);a=new R({color:b,transparent:1!==a,cullFace:"back"},"graphic-transform");
a.renderOccluded=2;return a}function K(a,b,c){a=b.projectPoint(a,t.castRenderScreenPointArray(ja));b=b.renderToScreen(a,ka);return q.vec3.set(c,b[0],b[1],0)}function ca(a){var b=a.spatialReference;return"local"===a.viewingMode?!0:(b.isWGS84||b.isWebMercator)&&a.scale<p.ALIGN_ARROWS_SCALE_THRESHOLD}Object.defineProperty(b,"__esModule",{value:!0});var ia=u.getLogger("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransform3DTool"),Y=function(){return function(a){this.graphic=a}}();
b.GraphicTranslateStartEvent=Y;var X=function(){return function(a){this.graphic=a}}();b.GraphicTranslateStopEvent=X;var G=function(){return function(a){this.graphic=a}}();b.GraphicRotateStartEvent=G;var da=function(){return function(a){this.graphic=a}}();b.GraphicRotateStopEvent=da;var Z=function(){return function(a){this.graphic=a}}();b.GraphicScaleStartEvent=Z;var ea=function(){return function(a){this.graphic=a}}();b.GraphicScaleStopEvent=ea;var aa=function(){return function(a,b,c){this.graphic=
a;this.dx=b;this.dy=c;this.type="translate"}}();b.GraphicTranslateEvent=aa;var fa=function(){return function(a,b){this.graphic=a;this.angle=b;this.type="rotate"}}();b.GraphicRotateEvent=fa;var ga=function(){return function(a,b){this.graphic=a;this.scale=b;this.type="scale"}}();b.GraphicScaleEvent=ga;w=function(b){function c(a){a=b.call(this,a)||this;a.enableRotation=!0;a.enableScaling=!0;a.discManipulator=null;a.ringManipulator=null;a.arrowManipulators=null;a.type="transform-3d";a._handles=new f;
a._arrowDragData=null;a._ringDragData=null;a._startSymbolDataPromise=null;a._startSymbolData=null;a._ringDelayedFocusFrameTask=null;a._ringManipulatorHasDelayedFocused=!1;a._scaleAnimationFrameTask=null;return a}r(c,b);c.prototype.destroy=function(){this._removeFrameTasks();this.graphic=null;this._handles.destroy();this._handles=null;this._set("view",null)};Object.defineProperty(c.prototype,"graphic",{set:function(b){a.isSome(b)&&!W.isSupportedGraphic(b)?ia.error("Only graphics from a graphics layer with point geometries and object symbology are supported"):
this._set("graphic",b)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_ringMode",{get:function(){return a.isSome(this._ringDragData)&&this._ringDragData.mode||this._ringModeFromOptions},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_ringModeFromOptions",{get:function(){var a=this._shouldAllowModeType("scale"),b=this._shouldAllowModeType("rotate");return a||b?b?a?null:{type:"rotate",startAngle:0}:{type:"scale"}:{type:"disabled"}},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"_manipulatorState",{get:function(){var b=this._ringMode,c=0,c=a.isNone(b)?y.Unlocked:"rotate"===b.type?a.isSome(this._ringDragData)&&0>this._ringDragData.angleDir?y.RotateLeft:y.RotateRight:a.isSome(this._ringDragData)&&0>this._ringDragData.scaleDir?y.ScaleIn:y.ScaleOut,c=c|(this.discManipulator.focused?y.DiscFocused:y.DiscUnfocused),c=c|(this._ringManipulatorHasDelayedFocused?y.RingFocused:y.RingUnfocused);return c|=this.arrowManipulators.some(function(a){return a.manipulator.focused})?
y.ArrowFocused:y.ArrowUnfocused},enumerable:!0,configurable:!0});c.prototype.hide=function(){this._removeFrameTasks()};c.prototype.reset=function(){this.graphic=null};c.prototype.onAttach=function(b){for(var c=this,e=ba(this.view),f=M(this.view),g=[],h=0;4>h;h++){var k=N(this.view),l=d.mat4f64.create();this._calculateArrowManipulatorTransform(h,l);g.push({manipulator:k,transform:l})}this.discManipulator=e;this.ringManipulator=f;this.arrowManipulators=g;this._handles.add([e.watch("grabbing",function(a){c._setSingleManipulatorInteractive(e,
a)},!0),e.watch("dragging",function(b){a.isSome(c.graphic)&&(b?c.emit("graphic-translate-start",new Y(c.graphic)):c.emit("graphic-translate-stop",new X(c.graphic)))},!0),m.watch(e,"focused",function(){a.isNone(c._scaleAnimationFrameTask)&&c._updateManipulators()}),m.init(this,"graphic.geometry",function(){a.isSome(c.graphic)&&c.graphic.geometry&&"point"===c.graphic.geometry.type&&(e.mapPoint=B.clonePoint(c.graphic.geometry,ma));c._updateManipulators()},!0)]);g.forEach(function(b,d){var e=b.manipulator;
e.on("drag",function(a){c._handleArrowDrag(d)});c._handles.add([m.watch(e,"focused",function(){c._updateManipulators()}),m.watch(e,"grabbing",function(a){c._setSingleManipulatorInteractive(e,a)}),m.watch(e,"dragging",function(b){a.isNone(c.graphic)||(b?c.emit("graphic-translate-start",new Y(c.graphic)):(c._arrowDragData=null,c.emit("graphic-translate-stop",new X(c.graphic))))})])});e.on("drag",function(b){if(!a.isNone(c.graphic)&&c.graphic.geometry&&"point"===c.graphic.geometry.type){b=c.graphic.geometry.z;
var d=c.graphic.geometry,f=B.clonePoint(e.mapPoint,new A);f.z=b;c.graphic.geometry=f;c.emit("graphic-translate",new aa(c.graphic,f.x-d.x,f.y-d.y))}});this._handles.add([f.watch("grabbing",function(a){c._setSingleManipulatorInteractive(f,a)},!0),f.watch("dragging",function(b){if(!1===b){if(b=c._ringDragData,c._ringDragData=null,c._startSymbolDataPromise=null,c._startSymbolData=null,a.isSome(b)){var d=b.mode;a.isNone(d)||a.isSome(d)&&"scale"===d.type?(d=P(b),c._startScaleResetAnimation(d)):c._updateManipulators();
if(a.isSome(c.graphic)&&a.isSome(b.mode))switch(b.mode.type){case "rotate":c.emit("graphic-rotate-stop",new da(c.graphic));break;case "scale":c.emit("graphic-scale-stop",new ea(c.graphic))}}}else if(a.isSome(c.graphic)&&a.isSome(c._ringMode)&&"disabled"!==c._ringMode.type)switch(c._ringMode.type){case "rotate":c.emit("graphic-rotate-start",new G(c.graphic));break;case "scale":c.emit("graphic-scale-start",new Z(c.graphic))}},!0),m.watch(f,"focused",function(){a.isNone(c._scaleAnimationFrameTask)&&
c._startRingFocusFrameTask()})]);f.on("drag",function(a){c._handleRingDrag(a.screenPoint)});b.addManipulator(e);b.addManipulator(f);g.forEach(function(a){return b.addManipulator(a.manipulator)})};c.prototype.onDetach=function(){this._handles.removeAll();this.ringManipulator=this.discManipulator=null;this.arrowManipulators=[]};c.prototype._handleArrowDrag=function(b){if(!a.isNone(this.graphic)&&this.graphic.geometry&&"point"===this.graphic.geometry.type){var c=this.arrowManipulators[b].manipulator,
d=this.graphic.geometry,e=this.graphic.geometry.spatialReference,f=new A,g=ca(this.view);if(g){var h=this._calculateArrowManipulatorDirection(b,v.sv3d.get()),c=q.vec3.subtract(v.sv3d.get(),c.position,this.discManipulator.position);D.vector.projectPoint(h,c,c);h=q.vec3.add(c,c,this.discManipulator.position);if(!this.view.renderCoordsHelper.fromRenderCoords(h,f,e))return}else h=c.mapPoint,H.vectorToPoint(q.vec3.set(v.sv3d.get(),h.x,h.y,h.z),h.spatialReference,f,e);e=d.longitude;h=f.longitude;null==
e||null==h?e=!1:(e=L.cyclicalDeg.shortestSignedDiff(e,h),e=90>Math.abs(e));if(e=!e)f.x=d.x,f.y=d.y;g||e||(0===b||2===b?f.x=d.x:f.y=d.y);if(a.isNone(this._arrowDragData)){if(b=B.clonePoint(d,new A),g=f.x-d.x,e=f.y-d.y,1E-5<Math.abs(g)||1E-5<Math.abs(e))this._arrowDragData={startPoint:b,dxMapConstrained:g,dyMapConstrained:e}}else g&&!e&&(b=this._arrowDragData,g=b.dxMapConstrained,e=b.dyMapConstrained,b=b.startPoint,1E-5>Math.abs(g)?f.x=b.x:f.y=1E-5>Math.abs(e)?b.y:b.y+(f.x-b.x)*e/g);b=f.x-d.x;g=f.y-
d.y;f.z=d.z;this.graphic.geometry=f;this.emit("graphic-translate",new aa(this.graphic,b,g))}};c.prototype._handleRingDrag=function(b){var c=this;if(!a.isNone(this.graphic)&&!a.isSome(this._startSymbolDataPromise)){var d=this._ringDragData,e=this._startSymbolData,f=this.graphic;b=t.screenPointObjectToArray(b,t.castScreenPointArray(v.sv2d.get()));b=D.ray.fromScreen(this.view.state.camera,b,la);var g=this.discManipulator.modelTransform;if(a.isNone(d)||a.isNone(e))d=z.vec3f64.fromValues(0,0,1),q.vec3.transformMat4(d,
d,g),e=z.vec3f64.clone(this.ringManipulator.position),g=D.plane.fromPositionAndNormal(e,d),d=z.vec3f64.create(),D.plane.intersectRay(g,b,d)&&(this._ringDragData={origin:e,plane:g,angle:0,angleDir:0,scale:1,scaleDir:0,startPoint:d,endPoint:z.vec3f64.clone(d),mode:null},this._startSymbolDataPromise=T(this.view,f),this._startSymbolDataPromise.then(function(a){c._startSymbolData=a;c._startSymbolDataPromise=null},function(){c._startSymbolDataPromise=null}));else if(g=d.plane,D.plane.intersectRay(g,b,d.endPoint)){b=
P(d);var g=O.calculateInputRotationTransform(d.startPoint,d.endPoint,d.origin,g),h=L.cyclicalPI.shortestSignedDiff(d.angle,g);d.angleDir=L.clamp(d.angleDir+h,-p.ROTATE_INDICATOR_DIRECTION_BUFFER,p.ROTATE_INDICATOR_DIRECTION_BUFFER);d.angle=g;d.scaleDir=L.clamp(d.scaleDir+(b-d.scale),-p.SCALE_INDICATOR_DIRECTION_BUFFER,p.SCALE_INDICATOR_DIRECTION_BUFFER);d.scale=b;var h=null,l=this._ringMode;if(a.isSome(l))h=l;else if(l=V(d,this.view.state.camera),a.isSome(l)){switch(l){case "rotate":this.emit("graphic-rotate-start",
new G(this.graphic));break;case "scale":this.emit("graphic-scale-start",new Z(this.graphic))}h="scale"===l?{type:"scale"}:{type:"rotate",startAngle:g}}d.mode=h;a.isSome(h)&&("rotate"===h.type?b=1:"scale"===h.type&&(g=0));d=k.mat4.fromScaling(v.sm4d.get(),q.vec3.set(v.sv3d.get(),b,b,1));this._updateManipulators(d);if(a.isSome(h)&&"disabled"!==h.type)switch("rotate"===h.type&&(g-=h.startAngle),f=f.symbol.clone(),Q(f,e,g,b),this.graphic.symbol=f,h.type){case "rotate":this.emit("graphic-rotate",new fa(this.graphic,
C.toDegree(g)));break;case "scale":this.emit("graphic-scale",new ga(this.graphic,b))}}}};c.prototype._shouldAllowModeType=function(b){return"scale"===b?this.enableScaling:a.isNone(this.graphic)||!this.enableRotation?!1:this.graphic.symbol.symbolLayers.some(function(a){return"object"===a.type})};c.prototype._updateManipulators=function(b){var c=this._manipulatorState,d=this._getManipulatorRotationAngle(),e=k.mat4.identity(v.sm4d.get());0!==d&&k.mat4.rotate(e,e,d,z.vec3f64.fromValues(0,0,1));var f=
this.discManipulator.position,d=this.view.renderCoordsHelper.basisMatrixAtPosition(f,v.sm4d.get());b=b?k.mat4.multiply(v.sm4d.get(),d,b):d;var g=a.isSome(this.graphic)&&null!=this.graphic.geometry,h=ca(this.view)?k.mat4.multiply(v.sm4d.get(),b,e):b;this.discManipulator.state=c;this.discManipulator.modelTransform=h;this.discManipulator.visible=g;this.arrowManipulators.forEach(function(a){var b=a.manipulator;a=a.transform;a=k.mat4.multiply(v.sm4d.get(),h,a);b.state=c;b.position=f;b.modelTransform=a;
b.visible=g});e=k.mat4.multiply(v.sm4d.get(),b,e);this.ringManipulator.state=c;this.ringManipulator.position=this.discManipulator.position;this.ringManipulator.modelTransform=e;e=this._ringMode;e=a.isSome(e)&&"disabled"===e.type;this.ringManipulator.visible=g&&!e};c.prototype._setSingleManipulatorInteractive=function(a,b){b?(this.discManipulator.interactive=this.discManipulator===a,this.ringManipulator.interactive=this.ringManipulator===a,this.arrowManipulators.forEach(function(b){b=b.manipulator;
b.interactive=b===a})):(this.discManipulator.interactive=!0,this.ringManipulator.interactive=!0,this.arrowManipulators.forEach(function(a){a.manipulator.interactive=!0}))};c.prototype._startRingFocusFrameTask=function(){var a=this;this._removeFrameTasks();var b=0;this._ringDelayedFocusFrameTask=g.addFrameTask({update:function(c){b+=c.deltaTime;a.ringManipulator.focused?b>p.RING_INDICATOR_DELAY_MS&&(a._ringManipulatorHasDelayedFocused=!0,a._updateManipulators(),a._removeFrameTasks()):(a._ringManipulatorHasDelayedFocused=
!1,a._updateManipulators(),a._removeFrameTasks())}})};c.prototype._startScaleResetAnimation=function(a){var b=this;this._removeFrameTasks();var c=a;this._scaleAnimationFrameTask=g.addFrameTask({update:function(a){c+=((c+1)/2-c)*Math.min(a.deltaTime*p.RING_RESET_ANIMATION_SPEED_FACTOR,1);.01>Math.abs(c-1)?(b._updateManipulators(),b._removeFrameTasks()):(a=k.mat4.fromScaling(v.sm4d.get(),q.vec3.set(v.sv3d.get(),c,c,1)),b._updateManipulators(a))}})};c.prototype._getManipulatorRotationAngle=function(){var b=
a.isSome(this.graphic)?U(this.graphic):0,b=C.toRadian(-b);if(a.isNone(this._ringDragData)||a.isSome(this._ringDragData.mode))return b;var c=this._ringDragData;return b+O.calculateInputRotationTransform(c.startPoint,c.endPoint,c.origin,c.plane)};c.prototype._calculateArrowManipulatorTransform=function(a,b){var c=k.mat4.identity(v.sm4d.get());k.mat4.fromZRotation(c,a*Math.PI/2);a=k.mat4.identity(v.sm4d.get());k.mat4.fromTranslation(a,q.vec3.set(v.sv3d.get(),0,p.DISC_TRANSLATE_ARROW_OFFSET,0));return k.mat4.multiply(b,
c,a)};c.prototype._calculateArrowManipulatorDirection=function(a,b){var c=this.discManipulator.modelTransform;return 0===a||2===a?q.vec3.set(b,c[4],c[5],c[6]):q.vec3.set(b,c[0],c[1],c[2])};c.prototype._removeFrameTasks=function(){this.ringManipulator&&(this._ringManipulatorHasDelayedFocused=this.ringManipulator.focused);a.isSome(this._ringDelayedFocusFrameTask)&&(this._ringDelayedFocusFrameTask.remove(),this._ringDelayedFocusFrameTask=null);a.isSome(this._scaleAnimationFrameTask)&&(this._scaleAnimationFrameTask.remove(),
this._scaleAnimationFrameTask=null)};e([l.property({constructOnly:!0,nonNullable:!0})],c.prototype,"view",void 0);e([l.property({value:null})],c.prototype,"graphic",null);e([l.property()],c.prototype,"enableRotation",void 0);e([l.property()],c.prototype,"enableScaling",void 0);e([l.property({readOnly:!0})],c.prototype,"type",void 0);return c=e([l.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransform3DTool")],c)}(l.declared(S,c));b.GraphicTransform3DTool=w;var ja=z.vec3f64.create(),
ka=t.createScreenPointArray(),y;(function(a){a.Unlocked=16;a.ScaleIn=32;a.ScaleOut=64;a.RotateLeft=128;a.RotateRight=256;a.DiscFocused=512;a.DiscUnfocused=1024;a.RingFocused=2048;a.RingUnfocused=4096;a.ArrowFocused=8192;a.ArrowUnfocused=16384})(y||(y={}));var la=D.ray.create(),ma=B.makeDehydratedPoint(0,0,0,null)})},"esri/views/3d/interactive/editingTools/graphicTransform3D/graphicTransform3DToolConfig":function(){define(["require","exports"],function(w,b){Object.defineProperty(b,"__esModule",{value:!0});
b.HANDLE_COLOR=[1,.5,0];b.GEOMETRY_SEGMENTS=128;b.DISC_RADIUS=70;b.DISC_COLLISION_RADIUS=80;b.DISC_HEIGHT=.02;b.DISC_TRANSLATE_ARROW_SIZE=54;b.DISC_TRANSLATE_ARROW_OFFSET=100;b.RING_RADIUS=160;b.RING_HEIGHT=.5;b.RING_THICKNESS=24;b.INDICATOR_THICKNESS=9;b.INNER_INDICATOR_RADIUS=b.RING_RADIUS+30;b.OUTER_INDICATOR_RADIUS=b.RING_RADIUS+53;b.ROTATE_INDICATOR_ARROW_TIP_LENGTH=60;b.ROTATE_INDICATOR_ARROW_TIP_RADIUS=23;b.ROTATE_INDICATOR_ARC_LENGTH=5*Math.PI/12;b.SCALE_INDICATOR_ARC_LENGTH=1*Math.PI/3;b.DRAG_THRESHOLD_PX=
10;b.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE=.2;b.SCALE_INDICATOR_OFFSET1=30;b.SCALE_INDICATOR_OFFSET2=53;b.SCALE_INDICATOR_DIRECTION_BUFFER=.2;b.ROTATE_INDICATOR_DIRECTION_BUFFER=.3;b.RING_INDICATOR_DELAY_MS=200;b.RING_RESET_ANIMATION_SPEED_FACTOR=3;b.ALIGN_ARROWS_SCALE_THRESHOLD=1E6})},"esri/views/3d/interactive/editingTools/graphicTransform3D/isSupportedGraphic":function(){define(["require","exports"],function(w,b){Object.defineProperty(b,"__esModule",{value:!0});b.isSupportedGraphic=function(b){var e=
b.symbol&&"point-3d"===b.symbol.type&&b.symbol.symbolLayers;return e&&0<e.length&&e.some(function(b){return"object"===b.type})&&"point"===b.geometry.type&&"graphics"===b.layer.type}})},"*noref":1}});
define(["require","exports","./editingTools/graphicMove3D/GraphicMove3DTool","./editingTools/graphicReshape3D/GraphicReshape3DTool","./editingTools/graphicTransform3D/GraphicTransform3DTool"],function(w,b,e,r,n){Object.defineProperty(b,"__esModule",{value:!0});b.GraphicMove3DTool=e.GraphicMove3DTool;b.GraphicReshape3DTool=r.GraphicReshape3DTool;b.GraphicTransform3DTool=n.GraphicTransform3DTool});