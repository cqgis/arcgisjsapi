// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ./mathUtils ../webgl-engine/lib/BufferVectorMath".split(" "),function(T,h,x,y,z,H,I,N,O,P,A,Q){function E(a,c,b,e){2===a.length?(d[0]=a[0],d[1]=a[1],d[2]=0,a=d):a===b&&(y.vec3.copy(d,a),a=d);return m(a,c,0,b,e,
0,1)}function m(a,c,b,e,f,d,g){void 0===g&&(g=1);J!==c&&(r=t(c),J=c);K!==f&&(B=t(f),K=f);g=b+3*g;if(r!==B||0===r&&!c.equals(f))if(0<r&&0<B)if(2!==B)if(c=S[B],2!==r)for(f=u[r];b<g;b+=3,d+=3)f(a,b,k,0),c(k,0,e,d);else for(;b<g;b+=3,d+=3)c(a,b,e,d);else for(f=u[r];b<g;b+=3,d+=3)f(a,b,e,d);else return!1;else if(e!==a||b!==d)for(;b<g;b++,d++)e[d]=a[b];return!0}function t(a){return a.wkt===h.SphericalECEFSpatialReference.wkt?1:a.isWGS84?2:a.isWebMercator?3:a.wkt===h.WGS84ECEFSpatialReference.wkt?4:0}function L(a,
c,b,e){b[e++]=a[c++];b[e++]=a[c++];b[e]=a[c]}function F(a,c,b,e){var f=.4999999*Math.PI,f=A.clamp(p*a[c+1],-f,f),f=Math.sin(f);b[e++]=p*a[c]*l;b[e++]=l/2*Math.log((1+f)/(1-f));b[e]=a[c+2]}function G(a,c,b,e){var f=l+a[c+2],d=p*a[c+1];a=p*a[c];c=Math.cos(d);b[e++]=Math.cos(a)*c*f;b[e++]=Math.sin(a)*c*f;b[e]=Math.sin(d)*f}Object.defineProperty(h,"__esModule",{value:!0});h.SphericalECEFSpatialReference=new I({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
h.WGS84ECEFSpatialReference=new I({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});var J,r,K,B;h.vectorToVector=E;h.pointToVector=function(a,c,b,e){void 0===e&&(e=
0);d[0]=a.x;d[1]=a.y;var f=a.z;d[2]=void 0!==f?f:e;return m(d,a.spatialReference,0,c,b,0,1)};h.vectorToPoint=function(a,c,b,e){b instanceof H?e=e||b.spatialReference:O.isPoint(b)?(b.hasZ=!0,e=e||b.spatialReference):(e=b,b=new H({spatialReference:e}));return m(a,c,0,d,e,0,1)?(b.x=d[0],b.y=d[1],b.z=d[2],b.spatialReference=e,b):null};h.xyzToVector=function(a,c,b,e,f,R){d[0]=a;d[1]=c;d[2]=b;return m(d,e,0,f,R,0,1)};h.bufferToBuffer=m;h.computeLinearTransformation=function(a,c,b,e){var f=t(a),d=t(e);if(f===
d&&1!==d&&(0!==f||a.equals(e)))return x.mat4.identity(b),x.mat4.translate(b,b,c),!0;if(1===d){if(a=u[f])return a(c,0,k,0),G(k,0,v,0),e=p*k[0],a=p*k[1],c=Math.sin(e),e=Math.cos(e),f=Math.sin(a),a=Math.cos(a),b[0]=-c,b[4]=-f*e,b[8]=a*e,b[12]=v[0],b[1]=e,b[5]=-f*c,b[9]=a*c,b[13]=v[1],b[2]=0,b[6]=a,b[10]=f,b[14]=v[2],b[3]=0,b[7]=0,b[11]=0,b[15]=1,!0}else if(3===d&&(2===f||1===f))return u[f](c,0,k,0),c=p*k[1],F(k,0,v,0),x.mat4.identity(b),x.mat4.translate(b,b,v),c=1/Math.cos(c),x.mat4.scale(b,b,[c,c,1]),
!0;return!1};h.transformDirection=function(a,c,b,e,f){y.vec3.copy(C,a);y.vec3.add(D,a,c);E(C,b,C,f);E(D,b,D,f);y.vec3.subtract(e,D,C);y.vec3.normalize(e,e)};h.mbsToMbs=function(a,c,b,e){var f=t(c),d=t(e);if(f===d&&(0!==f||c.equals(e)))return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],!0;if(1===d){if(c=u[f])return c(a,0,k,0),G(k,0,b,0),b[3]=a[3],!0}else if(3===d&&(2===f||1===f))return u[f](a,0,k,0),c=Math.abs(p*k[1])+Math.asin(a[3]/(l+a[2])),F(k,0,b,0),b[3]=c>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(c)*
a[3],!0;return!1};h.extentToBoundingBox=function(a,c,b){if(null==a)return!1;var e;d[0]=null!=a.xmin?a.xmin:0;d[1]=null!=a.ymin?a.ymin:0;d[2]=null!=a.zmin?a.zmin:0;e=m(d,a.spatialReference,0,c,b,0,1);d[0]=null!=a.xmax?a.xmax:0;d[1]=null!=a.ymax?a.ymax:0;d[2]=null!=a.zmax?a.zmax:0;e=e&&m(d,a.spatialReference,0,c,b,3,1);null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.zmin&&(c[2]=-Infinity);null==a.xmax&&(c[3]=Infinity);null==a.ymax&&(c[4]=Infinity);null==a.zmax&&(c[5]=Infinity);
return e};h.extentToBoundingRect=function(a,c,b){if(null==a)return!1;var e;d[0]=null!=a.xmin?a.xmin:0;d[1]=null!=a.ymin?a.ymin:0;d[2]=null!=a.zmin?a.zmin:0;e=m(d,a.spatialReference,0,d,b,0,1);c[0]=d[0];c[1]=d[1];d[0]=null!=a.xmax?a.xmax:0;d[1]=null!=a.ymax?a.ymax:0;d[2]=null!=a.zmax?a.zmax:0;e=e&&m(d,a.spatialReference,0,d,b,0,1);c[2]=d[0];c[3]=d[1];null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.xmax&&(c[2]=Infinity);null==a.ymax&&(c[3]=Infinity);return e};h.boundingRectToBoundingRect=
function(a,c,b,e){if(null==a)return!1;if(c.equals(e))return N.set(b,a),!0;var f;d[0]=a[0];d[1]=a[1];d[2]=0;f=m(d,c,0,d,e,0,1);b[0]=d[0];b[1]=d[1];d[0]=a[2];d[1]=a[3];d[2]=0;f=f&&m(d,c,0,d,e,0,1);b[2]=d[0];b[3]=d[1];return f};(function(a){a.x2lon=function(a){return a/l};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/l))};a.lon2x=function(a){return a*l};a.lat2y=function(a){a=Math.sin(a);return l/2*Math.log((1+a)/(1-a))}})(h.webMercator||(h.webMercator={}));var S=[void 0,G,L,F,function(a,
c,b,e){var d=M,h=p*a[c],g=p*a[c+1];a=a[c+2];c=Math.sin(g);var g=Math.cos(g),k=d.a/Math.sqrt(1-d.e2*c*c);b[e++]=(k+a)*g*Math.cos(h);b[e++]=(k+a)*g*Math.sin(h);b[e++]=(k*(1-d.e2)+a)*c}],u=[void 0,function(a,c,b,e){var d=Q.Vec3Compact.length(a,c),h=A.asin(a[c+2]/(0===d?1:d)),g=Math.cos(h)*d;a=(0<a[c+1]?1:-1)*A.acos(a[c]/(0===g?1:g));b[e++]=w*a;b[e++]=w*h;b[e]=d-l},L,function(a,c,b,d){b[d++]=w*(a[c++]/l);b[d++]=w*(Math.PI/2-2*Math.atan(Math.exp(-1*a[c++]/l)));b[d]=a[c]},function(a,c,b,d){var e=M,h=a[c],
g=a[c+1];a=a[c+2];var k,m,n,q,l,p;c=Math.abs(a);k=h*h+g*g;m=Math.sqrt(k);n=k+a*a;q=Math.sqrt(n);h=Math.atan2(g,h);l=a*a/n;n=k/n;g=e.a2/q;k=e.a3-e.a4/q;.3<n?(l=c/q*(1+n*(e.a1+g+l*k)/q),q=Math.asin(l),g=l*l,n=Math.sqrt(1-g)):(n=m/q*(1-l*(e.a5-g-n*k)/q),q=Math.acos(n),g=1-n*n,l=Math.sqrt(g));p=1-e.e2*g;g=e.a/Math.sqrt(p);e=e.a6*g;g=m-g*n;k=c-e*l;c=n*g+l*k;m=n*k-l*g;e=m/(e/p+c);q+=e;0>a&&(q=-q);b[d++]=w*h;b[d++]=w*q;b[d]=c+m*e/2}],p=A.deg2rad(1),w=A.rad2deg(1),l=P.earthRadius,M={a:6378137,e2:.006694379990137799,
a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},d=z.vec3f64.create(),k=z.vec3f64.create(),v=z.vec3f64.create(),C=z.vec3f64.create(),D=z.vec3f64.create()});