// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/io-query dojo/_base/kernel ../request ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/HeightModelInfo ./Layer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./support/commonProperties ./support/LercWorker".split(" "),function(h,z,f,q,d,r,k,l,m,e,c,t,u,v,w,x,y,n){return function(p){function b(a){a=p.call(this)||
this;a.copyright=null;a.heightModelInfo=null;a.path=null;a.opacity=1;a.operationalLayerType="ArcGISTiledElevationServiceLayer";a.type="elevation";a.url=null;a.version=null;a._lercWorker=n.acquireInstance();return a}q(b,p);b.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?f({url:a},b):a};b.prototype.destroy=function(){n.releaseInstance(this._lercWorker);this._lercWorker=null};Object.defineProperty(b.prototype,"minScale",{get:function(){},set:function(a){this.constructed&&k.deprecated(this.declaredClass+
".minScale support has been removed.","","4.5")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxScale",{get:function(){},set:function(a){this.constructed&&k.deprecated(this.declaredClass+".maxScale support has been removed.","","4.5")},enumerable:!0,configurable:!0});b.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=9.3);return a};b.prototype.load=function(){var a=this;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,
validateItem:function(a){for(var b=0;b<a.typeKeywords.length;b++)if("elevation 3d layer"===a.typeKeywords[b].toLowerCase())return!0;throw new m("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});}}).then(function(){return a._fetchImageService()},function(){return a._fetchImageService()}));return this.when()};b.prototype.fetchTile=function(a,b,c,d){var g=this;void 0===d&&(d=0);return this.load().then(function(){return g._fetchTileAvailability(a,
b,c)}).then(function(){return l(g.getTileUrl(a,b,c),{responseType:"array-buffer"})}).then(function(a){return g._lercWorker.decode(a.data,{noDataValue:d,returnFileInfo:!0})}).then(function(a){return{values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}})};b.prototype.getTileUrl=function(a,b,d){var c=r.objectToQuery(f({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null}));return this.parsedUrl.path+
"/tile/"+a+"/"+b+"/"+d+(c?"?"+c:"")};b.prototype.queryElevation=function(a,b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).query(c,a,b)})};b.prototype.createElevationSampler=function(a,b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).createSampler(c,a,b)})};b.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return e.reject(new m("elevation-layer:view-not-supported","ElevationLayer is only supported in 3D"));
case "3d":return e.create(function(a){return h(["../views/3d/layers/ElevationLayerView3D"],a)})}};b.prototype._fetchTileAvailability=function(a,b,c){return this.tilemapCache?this.tilemapCache.fetchAvailability(a,b,c):e.resolve("unknown")};b.prototype._fetchImageService=function(){var a=this;return e.resolve().then(function(){if(a.resourceInfo)return a.resourceInfo;var b={query:f({f:"json"},a.parsedUrl.query),responseType:"json"};return l(a.parsedUrl.path,b)}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,
"https:"));a.read(b.data,{origin:"service",url:a.parsedUrl})})};b.prototype._importElevationQuery=function(){return e.create(function(a){h(["./support/ElevationQuery"],a)})};d([c.property({json:{read:{source:"copyrightText"}}})],b.prototype,"copyright",void 0);d([c.property({readOnly:!0,type:t})],b.prototype,"heightModelInfo",void 0);d([c.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],b.prototype,"path",void 0);d([c.property({type:["show","hide"]})],b.prototype,"listMode",
void 0);d([c.property({json:{read:!1,write:!1}})],b.prototype,"minScale",null);d([c.property({json:{read:!1,write:!1}})],b.prototype,"maxScale",null);d([c.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],b.prototype,"opacity",void 0);d([c.property({type:["ArcGISTiledElevationServiceLayer"]})],b.prototype,"operationalLayerType",void 0);d([c.property()],b.prototype,"resourceInfo",void 0);d([c.property({json:{read:!1},value:"elevation",readOnly:!0})],b.prototype,"type",
void 0);d([c.property(y.url)],b.prototype,"url",void 0);d([c.property()],b.prototype,"version",void 0);d([c.reader("version",["currentVersion"])],b.prototype,"readVersion",null);return b=d([c.subclass("esri.layers.ElevationLayer")],b)}(c.declared(u,v,w,x))});