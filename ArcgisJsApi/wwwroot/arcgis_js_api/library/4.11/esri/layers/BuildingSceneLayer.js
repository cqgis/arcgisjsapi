// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/asyncUtils ../core/Collection ../core/CollectionFlattener ../core/Error ../core/lang ../core/loadAll ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./buildingSublayers/BuildingGroupSublayer ./mixins/SceneService ./support/BuildingFilter ./support/commonProperties".split(" "),function(p,
E,F,q,c,r,t,u,g,v,w,x,k,d,y,z,A,f,B,C,h){var l=x.getLogger("esri.layers.BuildingSceneLayer"),m=t.ofType(C);return function(n){function b(a){a=n.call(this)||this;a.operationalLayerType="BuildingSceneLayer";a.allSublayers=new u({root:a,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return"building-group"===a.type?a.sublayers:null}});a.sublayers=null;a.sublayerOverrides=null;a.filters=new m;a.activeFilterId=null;a.type="building-scene";return a}q(b,n);b.prototype.normalizeCtorArgs=
function(a){return"string"===typeof a?{url:a}:a};b.prototype.readSublayers=function(a,b,D){var e=this;a=f.readSublayers(a,b,D);f.forEachSublayer(a,function(a){return a.layer=e});this.sublayerOverrides&&(this.applySublayerOverrides(a,this.sublayerOverrides),this.sublayerOverrides=null);return a};b.prototype.applySublayerOverrides=function(a,b){var e=b.overrides,d=b.context;f.forEachSublayer(a,function(a){return a.read(e.get(a.id),d)})};b.prototype.readSublayerOverrides=function(a,b){for(var e=new Map,
d=0;d<a.length;d++){var c=a[d];null==c||"object"!==typeof c||"number"!==typeof c.id?b.messages.push(new g("building-scene-layer:invalid-sublayer-override","Invalid value for sublayer override. Not an object or no id specified.",{value:c})):e.set(c.id,c)}return{overrides:e,context:b}};b.prototype.writeSublayerOverrides=function(a,b,c){var e=[];f.forEachSublayer(this.sublayers,function(a){a=a.write({},c);1<Object.keys(a).length&&e.push(a)});0<e.length&&(b.sublayers=e)};b.prototype.writeUnappliedOverrides=
function(a,b){b.sublayers=[];a.overrides.forEach(function(a){b.sublayers.push(v.clone(a))})};b.prototype.write=function(a,b){a=this.inherited(arguments);b&&"web-scene"===b.origin&&(this.sublayers?this.writeSublayerOverrides(this.sublayers,a,b):this.sublayerOverrides&&this.writeUnappliedOverrides(this.sublayerOverrides,a));return a};b.prototype.read=function(a,b){this.inherited(arguments);if(b&&"web-scene"===b.origin&&null!=a&&Array.isArray(a.sublayers)){var c=this.readSublayerOverrides(a.sublayers,
b);this.sublayers?this.applySublayerOverrides(this.sublayers,c):this.sublayerOverrides=c}};Object.defineProperty(b.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this._validateElevationInfo()},enumerable:!0,configurable:!0});b.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).then(function(){return a._fetchService()},function(){return a._fetchService()});this.addResolvingPromise(b);return this.when()};b.prototype.loadAll=function(){var a=
this;return r.safeCast(w.loadAll(this,function(b){return f.forEachSublayer(a.sublayers,function(a){"building-group"!==a.type&&b(a)})}))};b.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return k.reject(new g("building-scene-layer:view-not-supported","BuildingSceneLayer is only supported in 3D"));case "3d":return k.create(function(a){return p(["../views/3d/layers/BuildingSceneLayerView3D"],a)})}};b.prototype._validateLayer=function(a){if(!a.layerType||"Building"!==a.layerType)throw new g("buildingscenelayer:layer-type-not-supported",
"BuildingSceneLayer does not support this layer type",{layerType:a.layerType});};b.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("absolute-height"!==a.mode&&l.warn(".elevationInfo\x3d","Building scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&l.warn(".elevationInfo\x3d","Building scene layers do not support featureExpressionInfo"))};c([d.property({type:["BuildingSceneLayer"]})],b.prototype,"operationalLayerType",
void 0);c([d.property({readOnly:!0})],b.prototype,"allSublayers",void 0);c([d.property(f.sublayersProperty)],b.prototype,"sublayers",void 0);c([d.reader("service","sublayers")],b.prototype,"readSublayers",null);c([d.property({type:m,nonNullable:!0})],b.prototype,"filters",void 0);c([d.property({type:String})],b.prototype,"activeFilterId",void 0);c([d.property(h.readOnlyService(y))],b.prototype,"fullExtent",void 0);c([d.property({type:["show","hide","hide-children"]})],b.prototype,"listMode",void 0);
c([d.property(h.readOnlyService(z))],b.prototype,"spatialReference",void 0);c([d.property(h.elevationInfo)],b.prototype,"elevationInfo",null);c([d.property({json:{read:!1},readOnly:!0})],b.prototype,"type",void 0);return b=c([d.subclass("esri.layers.BuildingSceneLayer")],b)}(d.declared(A,B))});