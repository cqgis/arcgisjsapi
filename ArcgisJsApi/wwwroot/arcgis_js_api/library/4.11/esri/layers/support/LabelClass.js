// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../symbols ../../core/JSONSupport ../../core/kebabDictionary ../../core/lang ../../core/accessorSupport/decorators ./LabelExpressionInfo ./labelUtils ./types ../../support/arcadeUtils ../../symbols/support/jsonUtils".split(" "),function(A,B,e,t,C,D,m,u,v,n,d,p,w,x,y,g){function k(b){return b?"service"===b.origin?!1:!b.layer||
!x.isOfType(b.layer,"map-image"):!0}function q(b){b=(b=y.createSyntaxTree(b))&&b.body&&b.body[0]&&b.body[0].body&&b.body[0].body.body;if(!b||1!==b.length)return null;b="ExpressionStatement"===b[0].type&&b[0].expression;if(!b||"MemberExpression"!==b.type)return null;var c=b.object;if(!c||"Identifier"!==c.type||"$feature"!==c.name)return null;b=b.property;if(!b)return null;switch(b.type){case "Literal":return b.value;case "Identifier":return b.name}return null}var h=new v.default({esriServerPointLabelPlacementAboveCenter:"above-center",
esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",
esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",
esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0}),z=/^\s*\{([^}]+)\}\s*$/i;return function(b){function c(a){a=b.call(this,a)||this;a.name=null;a.labelExpression=null;a.labelExpressionInfo=null;a.labelPlacement=null;a.maxScale=0;a.minScale=0;a.symbol=null;a.useCodedValues=void 0;a.where=null;return a}t(c,b);l=c;c.evaluateWhere=function(a,c){var b=function(a,c,b){switch(c){case "\x3d":return a==
b?!0:!1;case "\x3c\x3e":return a!=b?!0:!1;case "\x3e":return a>b?!0:!1;case "\x3e\x3d":return a>=b?!0:!1;case "\x3c":return a<b?!0:!1;case "\x3c\x3d":return a<=b?!0:!1}return!1};try{if(null==a)return!0;var f=a.split(" ");if(3===f.length)return b(c[f[0]],f[1],f[2]);if(7===f.length){var d=b(c[f[0]],f[1],f[2]),e=f[3],r=b(c[f[4]],f[5],f[6]);switch(e){case "AND":return d&&r;case "OR":return d||r}}return!1}catch(E){console.log("Error.: can't parse \x3d "+a)}};c.prototype.readLabelExpression=function(a,
b){b=b.labelExpressionInfo;if(!b||!b.value&&!b.expression)return a};c.prototype.writeLabelExpression=function(a,b,c,d){this.labelExpressionInfo&&k(d)&&(null!=this.labelExpressionInfo.value?a=this.labelExpressionInfo.value.replace(/\{/g,"[").replace(/\}/g,"]"):null!=this.labelExpressionInfo.expression&&(d=q(this.labelExpressionInfo.expression))&&(a="["+d+"]"));null!=a&&(b[c]=a)};c.prototype.writeLabelExpressionInfo=function(a,b,c,d){if(null==a&&null!=this.labelExpression&&k(d))a=new p({expression:this.getLabelExpressionArcade()});
else if(!a)return;a=a.toJSON(d);a.expression&&(b[c]=a)};c.prototype.writeMaxScale=function(a,b){if(a||this.minScale)b.maxScale=a};c.prototype.writeMinScale=function(a,b){if(a||this.maxScale)b.minScale=a};c.prototype.getLabelExpression=function(){var a={expression:"",type:"none"};this.labelExpressionInfo?this.labelExpressionInfo.value?(a.expression=this.labelExpressionInfo.value,a.type="conventional"):this.labelExpressionInfo.expression&&(a.expression=this.labelExpressionInfo.expression,a.type="arcade"):
null!=this.labelExpression&&(a.expression=this.labelExpression.replace(/\[/g,"{").replace(/\]/g,"}"),a.type="conventional");return a};c.prototype.getLabelExpressionArcade=function(){var a=this.getLabelExpression();if(!a)return null;switch(a.type){case "conventional":return w.convertTemplatedStringToArcade(a.expression);case "arcade":return a.expression}return null};c.prototype.getLabelExpressionSingleField=function(){var a=this.getLabelExpression();if(!a)return null;switch(a.type){case "conventional":return(a=
a.expression.match(z))&&a[1].trim()||null;case "arcade":return q(a.expression)}return null};c.prototype.clone=function(){return new l({labelExpression:this.labelExpression,labelExpressionInfo:n.clone(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:n.clone(this.symbol),where:this.where,useCodedValues:this.useCodedValues})};var l;e([d.property({type:String,json:{write:!0}})],c.prototype,"name",void 0);e([d.property({type:String,
json:{write:{allowNull:!0}}})],c.prototype,"labelExpression",void 0);e([d.reader("labelExpression")],c.prototype,"readLabelExpression",null);e([d.writer("labelExpression")],c.prototype,"writeLabelExpression",null);e([d.property({type:p,json:{write:{overridePolicy:function(a,b,c){return k(c)?{allowNull:!0}:{enabled:!1}}}}})],c.prototype,"labelExpressionInfo",void 0);e([d.writer("labelExpressionInfo")],c.prototype,"writeLabelExpressionInfo",null);e([d.property({type:h.apiValues,json:{type:h.jsonValues,
read:h.read,write:h.write}})],c.prototype,"labelPlacement",void 0);e([d.property({type:Number})],c.prototype,"maxScale",void 0);e([d.writer("maxScale")],c.prototype,"writeMaxScale",null);e([d.property({type:Number})],c.prototype,"minScale",void 0);e([d.writer("minScale")],c.prototype,"writeMinScale",null);e([d.property({types:m.symbolTypesLabel,json:{origins:{"web-scene":{read:g.read,write:{target:{symbol:{types:m.symbolTypesLabel3D}},writer:g.writeTarget}}},read:g.read,write:g.writeTarget}})],c.prototype,
"symbol",void 0);e([d.property({type:Boolean,json:{write:!0}})],c.prototype,"useCodedValues",void 0);e([d.property({type:String,json:{write:!0}})],c.prototype,"where",void 0);return c=l=e([d.subclass("esri.layers.support.LabelClass")],c)}(d.declared(u))});