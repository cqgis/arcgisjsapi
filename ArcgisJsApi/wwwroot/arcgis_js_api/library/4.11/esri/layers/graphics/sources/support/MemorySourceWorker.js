// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/graphics/data/FeatureStore":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/Map ../../../core/Error ../../../core/has ../../../core/Logger ../../../core/libs/rbush/rbush ../../../geometry/support/aaBoundingRect ../featureConversionUtils".split(" "),function(u,a,w,m,b,c,e,f,x,t,l){Object.defineProperty(a,"__esModule",{value:!0});var p=[],D=f.getLogger("esri.layers.graphics.data.FeatureStore"),
A={minX:0,minY:0,maxX:0,maxY:0};u=function(){function a(a){this._featuresById=new b.default;this._boundsByFeature=new b.default;this._featuresByBounds=new b.default;this._index=x(9,e("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:["[0]","[1]","[2]","[3]"]);this._geometryInfo=a}Object.defineProperty(a.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var a=t.create(t.NEGATIVE_INFINITY);this._boundsByFeature.forEach(function(h){h&&(a[0]=Math.min(h[0],a[0]),a[1]=Math.min(h[1],
a[1]),a[2]=Math.max(h[2],a[2]),a[3]=Math.max(h[3],a[3]))});return a},enumerable:!0,configurable:!0});a.prototype.setEngine=function(a){this._engine=a};a.prototype.add=function(a){this._add(a,p);this._index.load(p);this._clearCache();p.length=0};a.prototype.addMany=function(a){for(var h=0;h<a.length;h++)this._add(a[h],p);this._index.load(p);this._clearCache();p.length=0};a.prototype.clear=function(){this._featuresById.clear();this._boundsByFeature.clear();this._featuresByBounds.clear();this._index.clear();
this._clearCache()};a.prototype.removeManyById=function(a){for(var h=0;h<a.length;h++){var k=a[h],n=this._featuresById.get(k);if(n){var z=this._boundsByFeature.get(n);z&&(this._index.remove(z),this._featuresByBounds.delete(z));this._boundsByFeature.delete(n)}this._featuresById.delete(k)}this._clearCache()};a.prototype.forEachBounds=function(a,h){for(var k=0;k<a.length;k++){var n=a[k],z=this._boundsByFeature.get(n);z&&h(z,n)}};a.prototype.getFeature=function(a){return this._featuresById.get(a)};a.prototype.has=
function(a){return this._featuresById.has(a)};a.prototype.forEach=function(a){this._featuresById.forEach(function(h){return a(h)})};a.prototype.forEachInBounds=function(a,h){var k=0,n=this._index;A.minX=a[0];A.minY=a[1];A.maxX=a[2];A.maxY=a[3];for(a=n.search(A);k<a.length;k++)h(this._featuresByBounds.get(a[k]))};a.prototype.transferIds=function(a,h){for(var k=[],n=0;n<h.length;n++){var H=this._featuresById.get(h[n]);H&&(this._remove(H),k.push(H))}a.addMany(k);this._clearCache()};a.prototype.transferIdRange=
function(a,h,k){for(var n=[];h<k;h++){var H=this._featuresById.get(h);H&&(this._remove(H),n.push(H))}a.addMany(n);this._clearCache()};a.prototype.transferIf=function(a,h){var k=this,n=[];this._featuresById.forEach(function(a,b){h(a)&&(k._remove(a),n.push(a))});a.addMany(n);this._clearCache()};a.prototype.transferAll=function(a){var h=this,k=[];this._featuresById.forEach(function(a,b){h._remove(a);k.push(a)});a.addMany(k);this._clearCache()};a.prototype._clearCache=function(){this._engine&&this._engine.clearCache()};
a.prototype._add=function(a,h){if(a){var k=a.objectId;if(null==k)D.error(new c("featurestore:invalid-feature","feature id is missing",{feature:a}));else{var n=this._featuresById.get(k),b;n&&(b=this._boundsByFeature.get(n))&&(this._index.remove(b),this._boundsByFeature.delete(n),this._featuresByBounds.delete(b));a.geometry?(b=l.getBoundsOptimizedGeometry(b||t.create(),a.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(a,b),this._featuresByBounds.set(b,a),this._featuresById.set(k,
a),h.push(b)):(this._boundsByFeature.set(a,null),this._featuresById.set(k,a))}}};a.prototype._remove=function(a){var h;if(a){if(h=this._boundsByFeature.get(a))this._index.remove(h),this._boundsByFeature.delete(a),this._featuresByBounds.delete(h);this._featuresById.delete(a.objectId)}};return a}();a.default=u})},"esri/core/libs/rbush/rbush":function(){define(["../quickselect/quickselect"],function(u){function a(b,l){if(!(this instanceof a))return new a(b,l);this._maxEntries=Math.max(4,b||9);this._minEntries=
Math.max(2,Math.ceil(.4*this._maxEntries));l&&("function"===typeof l?this.toBBox=l:this._initFormat(l));this.clear()}function w(a,b){m(a,0,a.children.length,b,a)}function m(a,l,c,h,k){k||(k=p(null));k.minX=Infinity;k.minY=Infinity;k.maxX=-Infinity;k.maxY=-Infinity;for(var n;l<c;l++)n=a.children[l],b(k,a.leaf?h(n):n);return k}function b(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function c(a,b){return a.minX-
b.minX}function e(a,b){return a.minY-b.minY}function f(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function x(a){return a.maxX-a.minX+(a.maxY-a.minY)}function t(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function l(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function p(a){return{children:a,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function D(a,b,l,h,k){for(var n=[b,l],c;n.length;)l=n.pop(),b=n.pop(),l-b<=
h||(c=b+Math.ceil((l-b)/h/2)*h,u(a,c,b,l,k),n.push(b,c,c,l))}a.prototype={all:function(){return this._all(this.data,[])},search:function(a){var b=this.data,c=[],h=this.toBBox;if(!l(a,b))return c;for(var k=[],n,p,E,B;b;){n=0;for(p=b.children.length;n<p;n++)E=b.children[n],B=b.leaf?h(E):E,l(a,B)&&(b.leaf?c.push(E):t(a,B)?this._all(E,c):k.push(E));b=k.pop()}return c},collides:function(a){var b=this.data,c=this.toBBox;if(!l(a,b))return!1;for(var h=[],k,n,p,E;b;){k=0;for(n=b.children.length;k<n;k++)if(p=
b.children[k],E=b.leaf?c(p):p,l(a,E)){if(b.leaf||t(a,E))return!0;h.push(p)}b=h.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,l=a.length;b<l;b++)this.insert(a[b]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(b=this.data,this.data=a,a=b),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this},insert:function(a){a&&
this._insert(a,this.data.height-1);return this},clear:function(){this.data=p([]);return this},remove:function(a,b){if(!a)return this;for(var l=this.data,h=this.toBBox(a),k=[],n=[],c,p,B,f;l||k.length;){l||(l=k.pop(),p=k[k.length-1],c=n.pop(),f=!0);if(l.leaf){a:{B=a;var e=l.children,r=b;if(r){for(var m=0;m<e.length;m++)if(r(B,e[m])){B=m;break a}B=-1}else B=e.indexOf(B)}if(-1!==B){l.children.splice(B,1);k.push(l);this._condense(k);break}}f||l.leaf||!t(l,h)?p?(c++,l=p.children[c],f=!1):l=null:(k.push(l),
n.push(c),c=0,p=l,l=l.children[0])}return this},toBBox:function(a){return a},compareMinX:c,compareMinY:e,toJSON:function(){return this.data},fromJSON:function(a){this.data=a;return this},_all:function(a,b){for(var l=[];a;)a.leaf?b.push.apply(b,a.children):l.push.apply(l,a.children),a=l.pop();return b},_build:function(a,b,l,h){var k=l-b+1,n=this._maxEntries,c;if(k<=n)return c=p(a.slice(b,l+1)),w(c,this.toBBox),c;h||(h=Math.ceil(Math.log(k)/Math.log(n)),n=Math.ceil(k/Math.pow(n,h-1)));c=p([]);c.leaf=
!1;c.height=h;var k=Math.ceil(k/n),n=k*Math.ceil(Math.sqrt(n)),f,B,z;for(D(a,b,l,n,this.compareMinX);b<=l;b+=n)for(B=Math.min(b+n-1,l),D(a,b,B,k,this.compareMinY),f=b;f<=B;f+=k)z=Math.min(f+k-1,B),c.children.push(this._build(a,f,z,h-1));w(c,this.toBBox);return c},_chooseSubtree:function(a,b,l,h){for(var k,n,c,p,B,z,e,r;;){h.push(b);if(b.leaf||h.length-1===l)break;e=r=Infinity;k=0;for(n=b.children.length;k<n;k++)c=b.children[k],B=f(c),z=(Math.max(c.maxX,a.maxX)-Math.min(c.minX,a.minX))*(Math.max(c.maxY,
a.maxY)-Math.min(c.minY,a.minY))-B,z<r?(r=z,e=B<e?B:e,p=c):z===r&&B<e&&(e=B,p=c);b=p||b.children[0]}return b},_insert:function(a,l,c){var h=this.toBBox;c=c?a:h(a);var h=[],k=this._chooseSubtree(c,this.data,l,h);k.children.push(a);for(b(k,c);0<=l;)if(h[l].children.length>this._maxEntries)this._split(h,l),l--;else break;this._adjustParentBBoxes(c,h,l)},_split:function(a,b){var l=a[b],h=l.children.length,k=this._minEntries;this._chooseSplitAxis(l,k,h);h=this._chooseSplitIndex(l,k,h);h=p(l.children.splice(h,
l.children.length-h));h.height=l.height;h.leaf=l.leaf;w(l,this.toBBox);w(h,this.toBBox);b?a[b-1].children.push(h):this._splitRoot(l,h)},_splitRoot:function(a,b){this.data=p([a,b]);this.data.height=a.height+1;this.data.leaf=!1;w(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,l){var h,k,c,p,e,B,z;e=B=Infinity;for(h=b;h<=l-b;h++)k=m(a,0,h,this.toBBox),c=m(a,h,l,this.toBBox),p=Math.max(0,Math.min(k.maxX,c.maxX)-Math.max(k.minX,c.minX))*Math.max(0,Math.min(k.maxY,c.maxY)-Math.max(k.minY,c.minY)),
k=f(k)+f(c),p<e?(e=p,z=h,B=k<B?k:B):p===e&&k<B&&(B=k,z=h);return z},_chooseSplitAxis:function(a,b,l){var h=a.leaf?this.compareMinX:c,k=a.leaf?this.compareMinY:e,n=this._allDistMargin(a,b,l,h);b=this._allDistMargin(a,b,l,k);n<b&&a.children.sort(h)},_allDistMargin:function(a,l,c,h){a.children.sort(h);h=this.toBBox;var k=m(a,0,l,h),n=m(a,c-l,c,h),p=x(k)+x(n),f,B;for(f=l;f<c-l;f++)B=a.children[f],b(k,a.leaf?h(B):B),p+=x(k);for(f=c-l-1;f>=l;f--)B=a.children[f],b(n,a.leaf?h(B):B),p+=x(n);return p},_adjustParentBBoxes:function(a,
l,c){for(;0<=c;c--)b(l[c],a)},_condense:function(a){for(var b=a.length-1,l;0<=b;b--)0===a[b].children.length?0<b?(l=a[b-1].children,l.splice(l.indexOf(a[b]),1)):this.clear():w(a[b],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")}};return a})},"esri/core/libs/quickselect/quickselect":function(){define([],
function(){function u(m,b,c,e,f){for(;e>c;){if(600<e-c){var x=e-c+1,t=b-c+1,l=Math.log(x),p=.5*Math.exp(2*l/3),l=.5*Math.sqrt(l*p*(x-p)/x)*(0>t-x/2?-1:1);u(m,b,Math.max(c,Math.floor(b-t*p/x+l)),Math.min(e,Math.floor(b+(x-t)*p/x+l)),f)}x=m[b];t=c;p=e;a(m,c,b);for(0<f(m[e],x)&&a(m,c,e);t<p;){a(m,t,p);t++;for(p--;0>f(m[t],x);)t++;for(;0<f(m[p],x);)p--}0===f(m[c],x)?a(m,c,p):(p++,a(m,p,e));p<=b&&(c=p+1);b<=p&&(e=p-1)}}function a(a,b,c){var e=a[b];a[b]=a[c];a[c]=e}function w(a,b){return a<b?-1:a>b?1:0}
return function(a,b,c,e,f){u(a,b,c||0,e||a.length-1,f||w)}})},"esri/geometry/support/aaBoundingRect":function(){define(["require","exports","../../core/compilerUtils","../Extent"],function(u,a,w,m){function b(b){void 0===b&&(b=a.ZERO);return[b[0],b[1],b[2],b[3]]}function c(a){return a[0]>=a[2]?0:a[2]-a[0]}function e(a){return a[1]>=a[3]?0:a[3]-a[1]}function f(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a}function x(a){return 4===a.length}function t(a,b,c){return a<b?b:a>c?c:a}Object.defineProperty(a,
"__esModule",{value:!0});a.create=b;a.clone=function(a){return[a[0],a[1],a[2],a[3]]};a.fromValues=function(a,c,f,e,m){void 0===m&&(m=b());m[0]=a;m[1]=c;m[2]=f;m[3]=e;return m};a.fromExtent=function(a,c){void 0===c&&(c=b());c[0]=a.xmin;c[1]=a.ymin;c[2]=a.xmax;c[3]=a.ymax;return c};a.toExtent=function(a,b){return new m({xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:b})};a.expandPointInPlace=function(a,b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[2]&&(a[2]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[3]&&(a[3]=
b[1])};a.expand=function(a,b,c){void 0===c&&(c=a);if("length"in b)if(x(b))c[0]=Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[2]=Math.max(a[2],b[2]),c[3]=Math.max(a[3],b[3]);else{if(2===b.length||3===b.length)c[0]=Math.min(a[0],b[0]),c[1]=Math.min(a[1],b[1]),c[2]=Math.max(a[2],b[0]),c[3]=Math.max(a[3],b[1])}else switch(b.type){case "extent":c[0]=Math.min(a[0],b.xmin);c[1]=Math.min(a[1],b.ymin);c[2]=Math.max(a[2],b.xmax);c[3]=Math.max(a[3],b.ymax);break;case "point":c[0]=Math.min(a[0],b.x);c[1]=Math.min(a[1],
b.y);c[2]=Math.max(a[2],b.x);c[3]=Math.max(a[3],b.y);break;default:w.neverReached(b)}return c};a.expandWithNestedArray=function(a,b,c){void 0===c&&(c=a);var l=b.length,p=a[0],f=a[1],h=a[2];a=a[3];for(var k=0;k<l;k++){var n=b[k],p=Math.min(p,n[0]),f=Math.min(f,n[1]),h=Math.max(h,n[0]);a=Math.max(a,n[1])}c[0]=p;c[1]=f;c[2]=h;c[3]=a;return c};a.allFinite=function(a){for(var b=0;4>b;b++)if(!isFinite(a[b]))return!1;return!0};a.width=c;a.height=e;a.diameter=function(a){var b=c(a);a=e(a);return Math.sqrt(b*
b+a*a)};a.area=function(a){return c(a)*e(a)};a.center=function(a,b){void 0===b&&(b=[0,0]);b[0]=a[0]+c(a)/2;b[1]=a[1]+e(a)/2;return b};a.containsPoint=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[0]<=a[2]&&b[1]<=a[3]};a.containsPointWithMargin=function(a,b,c){return b[0]>=a[0]-c&&b[1]>=a[1]-c&&b[0]<=a[2]+c&&b[1]<=a[3]+c};a.intersects=function(a,b){return Math.max(b[0],a[0])<=Math.min(b[2],a[2])&&Math.max(b[1],a[1])<=Math.min(b[3],a[3])};a.contains=function(a,b){return b[0]>=a[0]&&b[2]<=a[2]&&b[1]>=
a[1]&&b[3]<=a[3]};a.intersection=function(a,b,c){void 0===c&&(c=a);var f=b[0],l=b[1],e=b[2];b=b[3];c[0]=t(a[0],f,e);c[1]=t(a[1],l,b);c[2]=t(a[2],f,e);c[3]=t(a[3],l,b);return c};a.distance=function(a,b){var f=(a[1]+a[3])/2,l=Math.max(Math.abs(b[0]-(a[0]+a[2])/2)-c(a)/2,0);a=Math.max(Math.abs(b[1]-f)-e(a)/2,0);return Math.sqrt(l*l+a*a)};a.offset=function(a,b,c,f){void 0===f&&(f=a);f[0]=a[0]+b;f[1]=a[1]+c;f[2]=a[2]+b;f[3]=a[3]+c;return f};a.pad=function(a,b,c){void 0===c&&(c=a);c[0]=a[0]-b;c[1]=a[1]-
b;c[2]=a[2]+b;c[3]=a[3]+b;return c};a.setMin=function(a,b,c){void 0===c&&(c=a);c[0]=b[0];c[1]=b[1];c!==a&&(c[2]=a[2],c[3]=a[3]);return c};a.setMax=function(a,b,c){void 0===c&&(c=a);c[2]=b[0];c[3]=b[1];c!==a&&(c[0]=a[0],c[1]=a[1]);return a};a.set=f;a.empty=function(c){return c?f(c,a.NEGATIVE_INFINITY):b(a.NEGATIVE_INFINITY)};a.is=x;a.isPoint=function(a){return(0===c(a)||!isFinite(a[0]))&&(0===e(a)||!isFinite(a[1]))};a.equals=function(a,b,c){if(null==a||null==b)return a===b;if(!x(a)||!x(b))return!1;
if(c)for(var f=0;f<a.length;f++){if(!c(a[f],b[f]))return!1}else for(f=0;f<a.length;f++)if(a[f]!==b[f])return!1;return!0};a.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];a.NEGATIVE_INFINITY=[Infinity,Infinity,-Infinity,-Infinity];a.ZERO=[0,0,0,0]})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(u,a,w,m,b,c,e){function f(a,b){var h;if(!b)return null;if("x"in b){var c={x:0,y:0};a=a(b.x,b.y,p);c.x=a[0];c.y=a[1];null!=b.z&&(c.z=b.z);null!=b.m&&(c.m=b.m);return c}if("xmin"in b)return c={xmin:0,ymin:0,xmax:0,ymax:0},h=a(b.xmin,b.ymin,p),c.xmin=h[0],c.ymin=h[1],a=a(b.xmax,b.ymax,p),c.xmax=a[0],c.ymax=a[1],b.hasZ&&(c.zmin=b.zmin,c.zmax=b.zmax,c.hasZ=!0),b.hasM&&(c.mmin=b.mmin,c.mmax=b.mmax,c.hasM=!0),c;if("rings"in b)return{rings:x(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:x(b.paths,
a),hasM:b.hasM,hasZ:b.hasZ};if("points"in b)return{points:t(b.points,a),hasM:b.hasM,hasZ:b.hasZ}}function x(a,b){for(var h=[],c=0;c<a.length;c++)h.push(t(a[c],b));return h}function t(a,b){for(var h=[],c=0;c<a.length;c++){var f=a[c],e=b(f[0],f[1],[0,0]);h.push(e);2<f.length&&e.push(f[2]);3<f.length&&e.push(f[3])}return h}function l(a,b){return!c.isValid(a)||!c.isValid(b)||c.equals(a,b)||e.canProject(a,b)?!1:!0}Object.defineProperty(a,"__esModule",{value:!0});var p=[0,0];a.checkProjectionSupport=function(a,
h){if(!h)return m.resolve();if(Array.isArray(a)){for(var c=0;c<a.length;c++){var n=a[c];if(l(n.geometry&&n.geometry.spatialReference,h))return b.isSupported()?b.load():m.reject(new w("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:h}))}return m.resolve()}return l(a,h)?b.isSupported()?b.load():m.reject(new w("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:h})):m.resolve()};var D=f.bind(null,
e.lngLatToXY),A=f.bind(null,e.xyToLngLat);a.project=function(a,h,k){k||(k=h,h=a.spatialReference);return c.isValid(h)&&c.isValid(k)&&!c.equals(h,k)?e.canProject(h,k)?c.isWebMercator(k)?D(a):A(a):b.projectMany([a],h,k,null,!0)[0]:a};var J=new (function(){function a(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a,b,n){var h=this;a&&a.length&&b&&n&&!c.equals(b,n)||m.resolve(a);var k={geometries:a,inSpatialReference:b,outSpatialReference:n,resolve:null};
this._jobs.push(k);return m.create(function(a){k.resolve=a;null===h._timer&&(h._timer=setTimeout(h._process,10))},function(){var a=h._jobs.indexOf(k);-1<a&&h._jobs.splice(a,1)})};a.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var k=a.geometries,n=a.inSpatialReference,f=a.outSpatialReference,a=a.resolve;e.canProject(n,f)?c.isWebMercator(f)?a(k.map(D)):a(k.map(A)):a(b.projectMany(k,n,f,null,!0));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return a}());
a.projectMany=function(a,b,c){return J.push(a,b,c)}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),function(u,a,w,m,b,c){function e(a,e,m,t,z){void 0===t&&(t=null);void 0===z&&(z=!1);if(null===t){var h=c.cacheKey(e,m);void 0!==l[h]?t=l[h]:(t=f(e,m,null),null===t&&(t=new c),l[h]=t)}return x._project(a,e,m instanceof b||!1===z?m:new b(m),t,z)}function f(a,b,f){void 0===f&&(f=null);a=x._getTransformation(a,
b,f);return null!==a?c.fromGE(a):null}Object.defineProperty(a,"__esModule",{value:!0});var x=null;a.isLoaded=function(){return!!x&&m.isLoaded()};a.isSupported=function(){return m.isSupported()};var t=null;a.load=function(){return t?t:t=w.create(function(a,b){var c=m.load();u(["./geometryEngine"],function(f){x=f;c.then(function(){x._enableProjection(m);a()},function(a){b(a)})})})};a.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:e(a,a[0].spatialReference,b,c):
e([a],a.spatialReference,b,c)[0]};var l={};a.projectMany=e;a.getTransformation=f;a.getTransformations=function(a,b,f){void 0===f&&(f=null);a=x._getTransformationBySuitability(a,b,f);if(null!==a){b=[];for(f=0;f<a.length;f++)b.push(c.fromGE(a[f]));return b}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(u,a,w,m,b){function c(b){function c(a,b,c){a[b]=c(a[b])}a._pe=b;p.init();D.init();A.init();J.init();
z.init();a.PeGCSExtent=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}w(c,b);c.prototype.destroy=function(){a._pe.destroy(this)};return c}(a._pe.PeGCSExtent);for(var h=0,f=[a._pe.PeDatum,a._pe.PeGeogcs,a._pe.PeGeogtran,a._pe.PeObject,a._pe.PeParameter,a._pe.PePrimem,a._pe.PeProjcs,a._pe.PeSpheroid,a._pe.PeUnit];h<f.length;h++)b=f[h],c(b.prototype,"getName",function(a){return function(){return a.call(this,Array(p.PE_NAME_MAX))}});h=0;for(f=[a._pe.PeGeogtran,a._pe.PeProjcs];h<
f.length;h++)b=f[h],c(b.prototype,"getParameters",function(b){return function(){for(var c=Array(p.PE_PARM_MAX),h=b.call(this),k=0;k<c.length;k++){var f=a._pe.getValue(h,"*");c[k]=f?a._pe.wrapPointer(f,a._pe.PeParameter):null;h+=Int32Array.BYTES_PER_ELEMENT}return c}});c(a._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var c=[],h=a.call(this);t(c,b,h);return c}});c(a._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(b){var c=a._pe._pe_getPeGTlistExtendedGTsSize();
return function(){var h=null,k=b.call(this);if(!a._pe.compare(k,a._pe.NULL)){var h=[k],f=this.getSteps();if(1<f)for(var k=a._pe.getPointer(k),n=1;n<f;n++)h.push(a._pe.wrapPointer(k+c*n,a._pe.PeGTlistExtendedGTs))}return h}});var e=a._pe._pe_getPeHorizonSize();b=function(b){return function(){var c=this._cache;c||(this._cache=c=new Map);if(c.has(b))return c.get(b);var h=null,k=b.call(this);if(!a._pe.compare(k,a._pe.NULL)){var h=[k],f=k.getNump();if(1<f)for(var k=a._pe.getPointer(k),n=1;n<f;n++)h.push(a._pe.wrapPointer(k+
e*n,a._pe.PeHorizon))}c.set(b,h);return h}};c(a._pe.PeProjcs.prototype,"horizonGcsGenerate",b);c(a._pe.PeProjcs.prototype,"horizonPcsGenerate",b);a._pe.PeObject.prototype.toString=function(b){void 0===b&&(b=p.PE_STR_OPTS_NONE);a._pe.ensureCache.prepare();var c=a._pe.getPointer(this),h=a._pe.ensureInt8(Array(p.PE_BUFFER_MAX));return a._pe.Pointer_stringify(a._pe._pe_object_to_string_ext(c,b,h))}}function e(b){if(b){var c=a._pe.getClass(b);c&&(c=a._pe.getCache(c))&&(b=a._pe.getPointer(b))&&delete c[b]}}
function f(b,c){var h=[];c=Array(c);for(var k=0;k<b;k++)h.push(a._pe.ensureInt8(c));return h}function x(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):b=a;return b}function t(b,c,f,e){void 0===e&&(e=!1);if(e)for(e=0;e<2*c;e++)b[e]=a._pe.getValue(f+e*Float64Array.BYTES_PER_ELEMENT,"double");else{var h=0===b.length;for(e=0;e<c;e++)h&&(b[e]=Array(2)),b[e][0]=a._pe.getValue(f,"double"),b[e][1]=a._pe.getValue(f+Float64Array.BYTES_PER_ELEMENT,"double"),f+=2*Float64Array.BYTES_PER_ELEMENT}}
Object.defineProperty(a,"__esModule",{value:!0});var l;a._pe=null;a.isLoaded=function(){return!!a._pe};a.isSupported=function(){return!!m("esri-wasm")};a.load=function(){return l?l:l=b.create(function(a,b){u(["./support/pe-wasm"],function(h){h({locateFile:function(a){return u.toUrl("./support/"+a)},onAbort:function(a){b(Error(a))}}).then(function(b){c(b);a()})})})};(function(b){function c(b,c,h){a._pe.ensureCache.prepare();var k=x(h),f=h===k,k=a._pe.ensureFloat64(k);(b=a._pe._pe_geog_to_proj(a._pe.getPointer(b),
c,k))&&t(h,c,k,f);return b}function h(a,b,c){return f(a,b,c,0)}function f(b,c,h,k){a._pe.ensureCache.prepare();var f=x(h),n=h===f,f=a._pe.ensureFloat64(f);(b=a._pe._pe_proj_to_geog_center(a._pe.getPointer(b),c,f,k))&&t(h,c,f,n);return b}b.geogToProj=c;b.projGeog=function(a,b,k,f){switch(f){case p.PE_TRANSFORM_P_TO_G:return h(a,b,k);case p.PE_TRANSFORM_G_TO_P:return c(a,b,k)}return 0};b.projToGeog=h;b.projToGeogCenter=f})(a.PeCSTransformations||(a.PeCSTransformations={}));var p;(function(b){b.init=
function(){b.PE_BUFFER_MAX=a._pe.PeDefs.prototype.PE_BUFFER_MAX;b.PE_NAME_MAX=a._pe.PeDefs.prototype.PE_NAME_MAX;b.PE_MGRS_MAX=a._pe.PeDefs.prototype.PE_MGRS_MAX;b.PE_USNG_MAX=a._pe.PeDefs.prototype.PE_USNG_MAX;b.PE_DD_MAX=a._pe.PeDefs.prototype.PE_DD_MAX;b.PE_DDM_MAX=a._pe.PeDefs.prototype.PE_DDM_MAX;b.PE_DMS_MAX=a._pe.PeDefs.prototype.PE_DMS_MAX;b.PE_UTM_MAX=a._pe.PeDefs.prototype.PE_UTM_MAX;b.PE_PARM_MAX=a._pe.PeDefs.prototype.PE_PARM_MAX;b.PE_TYPE_NONE=a._pe.PeDefs.prototype.PE_TYPE_NONE;b.PE_TYPE_GEOGCS=
a._pe.PeDefs.prototype.PE_TYPE_GEOGCS;b.PE_TYPE_PROJCS=a._pe.PeDefs.prototype.PE_TYPE_PROJCS;b.PE_TYPE_GEOGTRAN=a._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;b.PE_TYPE_COORDSYS=a._pe.PeDefs.prototype.PE_TYPE_COORDSYS;b.PE_TYPE_UNIT=a._pe.PeDefs.prototype.PE_TYPE_UNIT;b.PE_STR_OPTS_NONE=a._pe.PeDefs.prototype.PE_STR_OPTS_NONE;b.PE_STR_AUTH_NONE=a._pe.PeDefs.prototype.PE_STR_AUTH_NONE;b.PE_STR_AUTH_TOP=a._pe.PeDefs.prototype.PE_STR_AUTH_TOP;b.PE_STR_NAME_CANON=a._pe.PeDefs.prototype.PE_STR_NAME_CANON;b.PE_PARM_X0=
a._pe.PeDefs.prototype.PE_PARM_X0;b.PE_PARM_ND=a._pe.PeDefs.prototype.PE_PARM_ND;b.PE_TRANSFORM_1_TO_2=a._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;b.PE_TRANSFORM_2_TO_1=a._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;b.PE_TRANSFORM_P_TO_G=a._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;b.PE_TRANSFORM_G_TO_P=a._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;b.PE_HORIZON_RECT=a._pe.PeDefs.prototype.PE_HORIZON_RECT;b.PE_HORIZON_POLY=a._pe.PeDefs.prototype.PE_HORIZON_POLY;b.PE_HORIZON_LINE=a._pe.PeDefs.prototype.PE_HORIZON_LINE;
b.PE_HORIZON_DELTA=a._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(p=a.PeDefs||(a.PeDefs={}));(function(b){function c(b,c){var k=null,n=f[b];n||(n={},f[b]=n);n.hasOwnProperty(String(c))?k=n[c]:(b=a._pe.PeFactory.prototype.factoryByType(b,c),a._pe.compare(b,a._pe.NULL)||(k=b,n[c]=k));return k=h(k)}function h(b){if(b){var c=b.getType();switch(c){case p.PE_TYPE_GEOGCS:b=a._pe.castObject(b,a._pe.PeGeogcs);break;case p.PE_TYPE_PROJCS:b=a._pe.castObject(b,a._pe.PeProjcs);break;case p.PE_TYPE_GEOGTRAN:b=a._pe.castObject(b,
a._pe.PeGeogtran);break;default:c&p.PE_TYPE_UNIT&&(b=a._pe.castObject(b,a._pe.PeUnit))}}return b}var f={},e={};b.initialize=function(){a._pe.PeFactory.prototype.initialize(null)};b.coordsys=function(a){return c(p.PE_TYPE_COORDSYS,a)};b.factoryByType=c;b.fromString=function(b,c){var k=null,f=e[b];f||(f={},e[b]=f);f.hasOwnProperty(c)?k=f[c]:(b=a._pe.PeFactory.prototype.fromString(b,c),a._pe.compare(b,a._pe.NULL)||(k=b,f[c]=k));return k=h(k)};b.geogcs=function(a){return c(p.PE_TYPE_GEOGCS,a)};b.geogtran=
function(a){return c(p.PE_TYPE_GEOGTRAN,a)};b.getCode=function(b){return a._pe.PeFactory.prototype.getCode(b)};b.projcs=function(a){return c(p.PE_TYPE_PROJCS,a)};b.unit=function(a){return c(p.PE_TYPE_UNIT,a)}})(a.PeFactory||(a.PeFactory={}));a.PeGCSExtent=null;var D;(function(b){var c;b.init=function(){b.PE_GTLIST_OPTS_COMMON=a._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;c=a._pe._pe_getPeGTlistExtendedEntrySize()};b.getGTlist=function(b,h,k,f,e,l){var n=null,H=new a._pe.PeInteger(l);try{var q=
a._pe.PeGTlistExtended.prototype.getGTlist(b,h,k,f,e,H);if(l=H.val)if(n=[q],1<l){var G=a._pe.getPointer(q);for(b=1;b<l;b++)n.push(a._pe.wrapPointer(G+c*b,a._pe.PeGTlistExtendedEntry))}}finally{a._pe.destroy(H)}return n}})(D=a.PeGTlistExtended||(a.PeGTlistExtended={}));(function(b){b.destroy=function(b){if(b&&b.length){for(var c=0;c<b.length;c++){var h=b[c];e(h);h.getEntries().forEach(function(a){e(a);a=a.getGeogtran();e(a);a.getParameters().forEach(e);[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){e(a);
var b=a.getDatum();e(b);e(b.getSpheroid());e(a.getPrimem());e(a.getUnit())})})}a._pe.PeGTlistExtendedEntry.prototype.Delete(b[0])}}})(a.PeGTlistExtendedEntry||(a.PeGTlistExtendedEntry={}));(function(b){b.geogToGeog=function(b,c,h,f,e){a._pe.ensureCache.prepare();var k=x(h),n=h===k,k=a._pe.ensureFloat64(k),r=0;f&&(r=a._pe.ensureFloat64(f));(b=a._pe._pe_geog_to_geog(a._pe.getPointer(b),c,k,r,e))&&t(h,c,k,n);return b}})(a.PeGTTransformations||(a.PeGTTransformations={}));(function(b){function c(b,c,h,
k,e,n){a._pe.ensureCache.prepare();var r,q;switch(b){case "dd":r=a._pe._pe_geog_to_dd;q=p.PE_DD_MAX;break;case "ddm":r=a._pe._pe_geog_to_ddm;q=p.PE_DDM_MAX;break;case "dms":r=a._pe._pe_geog_to_dms,q=p.PE_DMS_MAX}b=0;c&&(b=a._pe.getPointer(c));c=x(k);c=a._pe.ensureFloat64(c);q=f(h,q);k=a._pe.ensureInt32(q);if(e=r(b,h,c,e,k))for(r=0;r<h;r++)n[r]=a._pe.Pointer_stringify(q[r]);return e}function h(b,c,h,k,f){a._pe.ensureCache.prepare();var e;switch(b){case "dd":e=a._pe._pe_dd_to_geog;break;case "ddm":e=
a._pe._pe_ddm_to_geog;break;case "dms":e=a._pe._pe_dms_to_geog}b=0;c&&(b=a._pe.getPointer(c));c=k.map(function(b){return a._pe.ensureString(b)});k=a._pe.ensureInt32(c);c=a._pe.ensureFloat64(Array(2*h));(e=e(b,h,k,c))&&t(f,h,c);return e}b.geog_to_dms=function(a,b,h,k,f){return c("dms",a,b,h,k,f)};b.dms_to_geog=function(a,b,c,k){return h("dms",a,b,c,k)};b.geog_to_ddm=function(a,b,h,k,f){return c("ddm",a,b,h,k,f)};b.ddm_to_geog=function(a,b,c,k){return h("ddm",a,b,c,k)};b.geog_to_dd=function(a,b,h,k,
f){return c("dd",a,b,h,k,f)};b.dd_to_geog=function(a,b,c,k){return h("dd",a,b,c,k)}})(a.PeNotationDms||(a.PeNotationDms={}));var A;(function(b){b.init=function(){b.PE_MGRS_STYLE_NEW=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;b.PE_MGRS_STYLE_OLD=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;b.PE_MGRS_STYLE_AUTO=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;b.PE_MGRS_180_ZONE_1_PLUS=a._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;b.PE_MGRS_ADD_SPACES=a._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};
b.geog_to_mgrs_extended=function(b,c,h,e,l,m,z){a._pe.ensureCache.prepare();var k=0;b&&(k=a._pe.getPointer(b));b=x(h);h=a._pe.ensureFloat64(b);b=f(c,p.PE_MGRS_MAX);var n=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_mgrs_extended(k,c,h,e,l,m,n))for(l=0;l<c;l++)z[l]=a._pe.Pointer_stringify(b[l]);return e};b.mgrs_to_geog_extended=function(b,c,h,f,e){a._pe.ensureCache.prepare();var k=0;b&&(k=a._pe.getPointer(b));b=h.map(function(b){return a._pe.ensureString(b)});h=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*
c));(f=a._pe._pe_mgrs_to_geog_extended(k,c,h,f,b))&&t(e,c,b);return f}})(A=a.PeNotationMgrs||(a.PeNotationMgrs={}));(function(b){b.geog_to_usng=function(b,c,h,e,l,m,z){a._pe.ensureCache.prepare();var k=0;b&&(k=a._pe.getPointer(b));b=x(h);h=a._pe.ensureFloat64(b);b=f(c,p.PE_MGRS_MAX);var n=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_usng(k,c,h,e,l,m,n))for(l=0;l<c;l++)z[l]=a._pe.Pointer_stringify(b[l]);return e};b.usng_to_geog=function(b,c,h,f){a._pe.ensureCache.prepare();var k=0;b&&(k=a._pe.getPointer(b));
b=h.map(function(b){return a._pe.ensureString(b)});h=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(k=a._pe._pe_usng_to_geog(k,c,h,b))&&t(f,c,b);return k}})(a.PeNotationUsng||(a.PeNotationUsng={}));var J;(function(b){b.init=function(){b.PE_UTM_OPTS_NONE=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;b.PE_UTM_OPTS_ADD_SPACES=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;b.PE_UTM_OPTS_NS=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};b.geog_to_utm=function(b,c,h,e,l){a._pe.ensureCache.prepare();
var k=0;b&&(k=a._pe.getPointer(b));b=x(h);h=a._pe.ensureFloat64(b);b=f(c,p.PE_UTM_MAX);var n=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_utm(k,c,h,e,n))for(k=0;k<c;k++)l[k]=a._pe.Pointer_stringify(b[k]);return e};b.utm_to_geog=function(b,c,h,f,e){a._pe.ensureCache.prepare();var k=0;b&&(k=a._pe.getPointer(b));b=h.map(function(b){return a._pe.ensureString(b)});h=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(f=a._pe._pe_utm_to_geog(k,c,h,f,b))&&t(e,c,b);return f}})(J=a.PeNotationUtm||(a.PeNotationUtm=
{}));var z;(function(b){var c=new Map;b.init=function(){b.PE_PCSINFO_OPTION_NONE=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;b.PE_PCSINFO_OPTION_DOMAIN=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;b.PE_POLE_OUTSIDE_BOUNDARY=a._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;b.PE_POLE_POINT=a._pe.PePCSInfo.prototype.PE_POLE_POINT};b.generate=function(h,k){void 0===k&&(k=b.PE_PCSINFO_OPTION_DOMAIN);var f,e;c.has(h)&&(e=c.get(h),e[k]&&(f=e[k]));f||(f=a._pe.PePCSInfo.prototype.generate(h,k),
e||(e=[],c.set(h,e)),e[k]=f);return f}})(z=a.PePCSInfo||(a.PePCSInfo={}));(function(b){b.version_string=function(){return a._pe.PeVersion.prototype.version_string()}})(a.PeVersion||(a.PeVersion={}));a._init=c})},"esri/geometry/support/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(u,a,w){return function(){function a(a){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(a&&a.steps){var b=0;for(a=a.steps;b<a.length;b++){var e=
a[b];e instanceof w?this.steps.push(e):this.steps.push(new w({wkid:e.wkid,wkt:e.wkt,isInverse:e.isInverse}))}}}a.cacheKey=function(a,c){return[void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():"",void 0!==c.wkid&&null!==c.wkid?c.wkid.toString():"-1",void 0!==c.wkt&&null!==c.wkt?c.wkt.toString():""].join()};a.fromGE=function(b){var c=new a,e="",f=0;for(b=b.steps;f<b.length;f++){var m=w.fromGE(b[f]);c.steps.push(m);e+=m.uid.toString()+","}c._cached_projection=
{};c._gtlistentry=null;c._chain=e;return c};a.prototype.getInverse=function(){var b=new a;b.steps=[];for(var c=this.steps.length-1;0<=c;c--)b.steps.push(this.steps[c].getInverse());return b};a.prototype.getGTListEntry=function(){for(var a="",c=0,e=this.steps;c<e.length;c++)a+=e[c].uid.toString()+",";a!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=a);return this._gtlistentry};a.prototype.assignCachedGe=function(b,c,e){this._cached_projection[a.cacheKey(b,c)]=e};a.prototype.getCachedGeTransformation=
function(b,c){for(var e="",f=0,m=this.steps;f<m.length;f++)e+=m[f].uid.toString()+",";e!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=e);b=this._cached_projection[a.cacheKey(b,c)];return void 0===b?null:b};return a}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(u,a){var w=0;return function(){function a(a){void 0===a&&(a=null);this.uid=w++;a?(this._wkt=void 0!==a.wkt?a.wkt:null,this._wkid=void 0!==a.wkid?a.wkid:
-1,this._isInverse=void 0!==a.isInverse?!0===a.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}a.fromGE=function(b){var c=new a;c._wkt=b.wkt;c._wkid=b.wkid;c._isInverse=b.isInverse;return c};Object.defineProperty(a.prototype,"wkt",{get:function(){return this._wkt},set:function(a){this._wkt=a;this.uid=w++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wkid",{get:function(){return this._wkid},set:function(a){this._wkid=a;this.uid=w++},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"isInverse",{get:function(){return this._isInverse},set:function(a){this._isInverse=a;this.uid=w++},enumerable:!0,configurable:!0});a.prototype.getInverse=function(){var b=new a;b._wkt=this.wkt;b._wkid=this._wkid;b._isInverse=!this.isInverse;return b};return a}()})},"esri/layers/graphics/data/QueryEngine":function(){define("require exports ../../../core/tsSupport/assignHelper @dojo/framework/shim/array @dojo/framework/shim/Map @dojo/framework/shim/Set ../../../core/asyncUtils ../../../core/Error ../../../core/lang ../../../core/Logger ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/PromiseQueue".split(" "),
function(u,a,w,m,b,c,e,f,x,t,l,p,D,A,J,z,h,k,n,H,E,B,L,C,r){function R(a,b,c,h,k,f,e,n,l){l||(l=q);e&&!f?h.forEachInBounds(k,function(h){if(!b.has(h.objectId)){var k=C.getCentroid(c,h,n),f=h.attributes;k&&(b.add(h.objectId),a.push(new T(f,null,k,l(h))))}}):f&&!e?h.forEachInBounds(k,function(h){if(!b.has(h.objectId)){var k=h.attributes,f=C.getGeometry(c,h,0,n);f&&(b.add(h.objectId),a.push(new T(k,f,null,l(h))))}}):h.forEachInBounds(k,function(h){if(!b.has(h.objectId)){var k=h.attributes,f=C.getGeometry(c,
h,0,n),e=C.getCentroid(c,h,n);f&&e&&(b.add(h.objectId),a.push(new T(k,f,e,l(h))))}})}Object.defineProperty(a,"__esModule",{value:!0});var q=function(a){return 1},G=t.getLogger("esri.layers.graphics.data.QueryEngine"),T=function(){return function(a,b,c,h){this.attributes=a;this.geometry=b;this.centroid=c;this.filterFlags=h}}(),V=new c.default,S=new l.Storage(2E6),Gb=0;u=function(){function a(a){var c=this;this.capabilities={query:H.queryCapabilities};this.fieldsMap=new b.default;this.geometryType=
a.geometryType;this.hasM=a.hasM;this.hasZ=a.hasZ;this.objectIdField=a.objectIdField;this.spatialReference=a.spatialReference;this.definitionExpression=a.definitionExpression;this.cacheSpatialQueries=a.cacheSpatialQueries||!1;this.gdbVersion=a.gdbVersion;this.historicMoment=a.historicMoment;this.featureStore=a.featureStore;this.featureStore.setEngine(this);this.timeInfo=a.timeInfo;this.cacheSpatialQueries&&(this._geometryQueryCache=new l(Gb++ +"$$",S));a.fields.forEach(function(a){c.fieldsMap.set(a.name.trim(),
a);c.fieldsMap.set(a.name.trim().toLowerCase(),a)});a.scheduler&&a.priority&&(this._frameQueue=new r.PromiseQueue,this._frameTask=a.scheduler.registerTask(a.priority,function(a){return c._update(a)},function(){return 0<c._frameQueue.length}))}a.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this.fieldsMap.clear()};Object.defineProperty(a.prototype,
"fullExtent",{get:function(){var a=this.featureStore.fullBounds;return a?{xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:C.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"timeExtent",{get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:this._timeExtent=L.getTimeExtent(this.timeInfo,this.featureStore):null},enumerable:!0,configurable:!0});a.prototype.clearCache=function(){this._geometryQueryCache&&
this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};a.prototype.executeQuery=function(a){var b=this;void 0===a&&(a={});var c=x.clone(a);return e.safeCast(C.normalizeQuery(c,this.definitionExpression,this.spatialReference)).then(function(a){return b._schedule(a)}).then(function(a){return b._checkQuerySupport(a)}).then(function(a){return b._reschedule(a)}).then(function(a){return b._executeGeometryQuery(a)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeObjectIdsQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeTimeQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeAttributesQuery(c)}).catch(function(a){if(a===
C.QUERY_ENGINE_EMPTY_RESULT)return new E.default([],null,b);throw a;}).then(function(a){return a.createQueryResponse(c)})};a.prototype.executeQueryForCount=function(a){var b=this;void 0===a&&(a={});var c=x.clone(a);c.returnGeometry=!1;c.returnCentroid=!1;c.outSR=null;return e.safeCast(C.normalizeQuery(c,this.definitionExpression,this.spatialReference)).then(function(a){return b._schedule(a)}).then(function(a){return b._checkQuerySupport(a)}).then(function(a){return b._reschedule(a)}).then(function(a){return b._executeGeometryQuery(a)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeObjectIdsQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeTimeQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeAttributesQuery(c)}).then(function(a){return a.size}).catch(function(a){if(a===
C.QUERY_ENGINE_EMPTY_RESULT)return 0;throw a;})};a.prototype.executeQueryForExtent=function(a){var b=this;void 0===a&&(a={});var c=x.clone(a),h=c.outSR;return e.safeCast(C.normalizeQuery(c,this.definitionExpression,this.spatialReference)).then(function(a){return b._schedule(a)}).then(function(a){return b._checkQuerySupport(a)}).then(function(){c.returnGeometry=!0;c.returnCentroid=!1;c.outSR=null;return c}).then(function(a){return b._reschedule(a)}).then(function(a){return b._executeGeometryQuery(a)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeObjectIdsQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeTimeQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeAttributesQuery(c)}).then(function(a){return b._reschedule(a)}).then(function(a){var c=
a.size;if(!c)return{count:c,extent:null};var k={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:C.cleanFromGeometryEngine(b.spatialReference)};b.featureStore.forEachBounds(a.items,function(a){k.xmin=Math.min(a[0],k.xmin);k.ymin=Math.min(a[1],k.ymin);k.xmax=Math.max(a[2],k.xmax);k.ymax=Math.max(a[3],k.ymax)});a=n.project(k,a.spatialReference,h);a.spatialReference=C.cleanFromGeometryEngine(h||b.spatialReference);
if(0===a.xmax-a.xmin){var f=D.getMetersPerUnitForSR(a.spatialReference);a.xmin-=f;a.xmax+=f}0===a.ymax-a.ymin&&(f=D.getMetersPerUnitForSR(a.spatialReference),a.ymin-=f,a.ymax+=f);return{count:c,extent:a}}).catch(function(a){if(a===C.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw a;})};a.prototype.executeQueryForIds=function(a){void 0===a&&(a={});return this.executeQueryForIdSet(a).then(function(a){return m.from(a)})};a.prototype.executeQueryForIdSet=function(a){var b=this;void 0===a&&
(a={});var h=x.clone(a);h.returnGeometry=!1;h.returnCentroid=!1;h.outSR=null;return e.safeCast(C.normalizeQuery(h,this.definitionExpression,this.spatialReference)).then(function(a){return b._schedule(a)}).then(function(a){return b._executeGeometryQuery(a)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeObjectIdsQuery(h)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeTimeQuery(h)}).then(function(a){return b._reschedule(a)}).then(function(a){return a.executeAttributesQuery(h)}).then(function(a){return b._reschedule(a)}).then(function(a){a=
a.items;for(var b=new c.default,h=0;h<a.length;h++)b.add(a[h].objectId);return b}).catch(function(a){if(a===C.QUERY_ENGINE_EMPTY_RESULT)return new c.default;throw a;})};a.prototype.executeTileQuery=function(a,b,k){var f=this;void 0===k&&(k=null);var e=b.returnGeometry,n=b.returnCentroid,q=b.pixelBuffer;b=new c.default;var l=[],q=q*a.resolution,G=A.pad(a.bounds,q,A.create());R(l,b,this,this.featureStore,G,e,n,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]},
k);if("esriGeometryPoint"===this.geometryType||n){var r=h.getInfo(this.spatialReference);if(r){var p=r.valid,r=p[0],p=p[1];if(G[0]<r){var m=A.fromValues(p-q,G[1],p,G[3]);R(l,b,this,this.featureStore,m,e,n,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[p,a.bounds[3]]},k)}G[2]>p&&(q=A.fromValues(r,G[1],r+q,G[3]),R(l,b,this,this.featureStore,q,e,n,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[r-p+a.bounds[0],a.bounds[3]]},k))}}l.sort(function(a,b){return a.attributes[f.objectIdField]-
b.attributes[f.objectIdField]});return{features:l,objectIds:b}};a.prototype.executeTileQueryForIds=function(a,b){a=A.pad(a.bounds,b.pixelBuffer*a.resolution,A.create());var c=[];this.featureStore.forEachInBounds(a,function(a){return c.push(a.objectId)});return c};a.prototype.executeQueryForLatestObservations=function(a){var b=this;if(this.timeInfo)return this.executeQuery(a).then(function(a){return b._filterLatest(a,b.timeInfo)});G.error(new f("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))};
a.prototype._schedule=function(a){return this._frameQueue?this._frameQueue.push(a).then(function(a){return a}):p.resolve(a)};a.prototype._reschedule=function(a){return this._frameQueue?this._frameQueue.push(a).then(function(a){return a}):p.resolve(a)};a.prototype._update=function(a){for(this._budget=a;!a.done&&this._frameQueue.process();)a.madeProgress();this._budget=null};a.prototype._filterLatest=function(a,c){var h=c.trackIdField,k=c.startTimeField;c=c.endTimeField||k;for(var k=new b.default,f=
[],e=0,n=a.features;e<n.length;e++){var q=n[e],l=q.attributes[h],G=q.attributes[c];(!k.has(l)||k.get(l).attributes[c]<G)&&k.set(l,q)}k.forEach(function(a){return f.push(a)});return w({},a,{features:f})};a.prototype._getAll=function(){if(!this._allItems){var a=[];this.featureStore.forEach(function(b){return a.push(b)});this._allItems=new E.default(a,null,this)}return this._allItems};a.prototype._executeGeometryQuery=function(a){var b=this,k=a.geometry,f=a.outSR,e=a.spatialRel,n=h.isValid(f)&&!h.equals(this.spatialReference,
f),q=this.cacheSpatialQueries?n?JSON.stringify({geometry:k,spatialRelationship:e,outSpatialReference:f}):JSON.stringify({geometry:k,spatialRelationship:e}):null;if(q){var l=this._geometryQueryCache.get(q);if(void 0!==l)return p.resolve(l)}var G=function(c){if(n&&(a.returnGeometry||a.returnCentroid))return c.project(f).then(function(a){q&&b._geometryQueryCache.put(q,a,a.size||1);return a});q&&b._geometryQueryCache.put(q,c,c.size||1);return c};if(!k)return p.resolve(this._getAll()).then(function(a){return G(a)});
if("esriSpatialRelDisjoint"===e){l=this._searchFeatures(this._getQueryBBoxes(k));if(!l.length)return p.resolve(this._getAll()).then(function(a){return G(a)});var r,m;return this._reschedule(l).then(function(a){return new c.default(a)}).then(function(a){return b._reschedule(a)}).then(function(a){var c=0;r=Array(a.size);b.featureStore.forEach(function(a){return r[c++]=a});m=a}).then(function(){return b._reschedule()}).then(function(){return B.getSpatialQueryOperator(e,k,b)}).then(function(a){return b._runSpatialFilter(r,
function(b){return!m.has(b)||a(b.geometry)}).then(function(a){return new E.default(a,k,b)}).then(function(a){return G(a)})})}var z=this._searchFeatures(this._getQueryBBoxes(k));return z.length?this._canExecuteSoloPass(k,a)?p.resolve(new E.default(z,k,this)).then(function(a){return G(a)}):B.getSpatialQueryOperator(e,k,this).then(function(a){return b._runSpatialFilter(z,function(b){return a(b.geometry)})}).then(function(a){return new E.default(a,k,b)}).then(function(a){return G(a)}):(l=new E.default([],
k,this),q&&this._geometryQueryCache.put(q,l,l.size||1),p.resolve(l))};a.prototype._runSpatialFilter=function(a,b){var c=this;if(!b)return p.resolve(a);if(!this._budget)return p.resolve(a.filter(function(a){return b(a)}));var h=0,k=[],f=function(){for(;h<a.length;){var e=a[h];b(e)&&k.push(e);if(c._budget.done)return c._reschedule().then(function(){return f()});++h}return p.resolve()};return this._reschedule().then(function(){return f()}).then(function(){return k})};a.prototype._canExecuteSoloPass=
function(a,b){var c=this.geometryType;b=b.spatialRel;return B.canQueryWithRBush(a)&&("esriSpatialRelEnvelopeIntersects"===b||"esriGeometryPoint"===c&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b||"esriSpatialRelWithin"===b))};a.prototype._getQueryBBoxes=function(a){if(B.canQueryWithRBush(a)){if(z.isExtent(a))return[A.fromValues(a.xmin,a.ymin,a.xmax,a.ymax)];if(z.isPolygon(a))return a.rings.map(function(a){return A.fromValues(a[0][0],a[0][1],a[2][0],a[2][1])})}return[J.getBoundsXY(A.create(),
a)]};a.prototype._searchFeatures=function(a){for(var b=0;b<a.length;b++)this.featureStore.forEachInBounds(a[b],function(a){V.add(a)});var c=Array(V.size),h=0;V.forEach(function(a){return c[h++]=a});V.clear();return c};a.prototype._checkQuerySupport=function(a){return 0>a.distance||null!=a.geometryPrecision||a.multipatchOption||a.pixelSize||a.relationParam||a.text?p.reject(new f("feature-store:unsupported-query","Unsupported query options",{query:a})):p.all([this._checkAttributesQuerySupport(a),this._checkStatisticsQuerySupport(a),
B.checkSpatialQuerySupport(a,this.geometryType,this.spatialReference),n.checkProjectionSupport(this.spatialReference,a.outSR)]).then(function(){return a})};a.prototype._checkAttributesQuerySupport=function(a){var b=a.outFields,c=a.orderByFields,h=a.returnDistinctValues;c&&0<c.length&&(c=c.map(function(a){return-1<a.indexOf(" ASC")?a.split(" ASC")[0]:-1<a.indexOf(" DESC")?a.split(" DESC")[0]:a}),k.validateFields(this.fieldsMap,c,"orderByFields contains missing fields"));if(b&&0<b.length)k.validateFields(this.fieldsMap,
b,"outFields contains missing fields");else if(h)throw new f("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:a});k.validateWhere(this.fieldsMap,a.where)};a.prototype._checkStatisticsQuerySupport=function(a){var b=a.outStatistics,c=a.groupByFieldsForStatistics,h=a.having,e=c&&c.length,n=b&&b.length;if(h){if(!e||!n)return p.reject(new f("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:a}));
k.validateHaving(this.fieldsMap,h,b)}if(n&&!b.some(function(a){return"exceedslimit"===a.statisticType}))for(h=b.map(function(a){return a.onStatisticField}),k.validateFields(this.fieldsMap,h,"onStatisticFields contains missing fields"),e&&k.validateFields(this.fieldsMap,c,"groupByFieldsForStatistics contains missing fields"),c=0;c<b.length;c++){var h=b[c],n=h.onStatisticField,q=h.statisticType;if("exceedslimit"===q)return p.reject(new f("feature-store:unsupported-query","statistic type exceedslimit is not supported",
{definition:h,query:a}));if((!e||"count"!==q)&&n&&k.hasInvalidFieldType(n,this.fieldsMap))return p.reject(new f("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:h,query:a}))}};return a}();a.default=u})},"esri/layers/graphics/data/attributeSupport":function(){define("require exports @dojo/framework/shim/Set ../../../core/Error ../../../core/ItemCache ../../../core/sql/WhereClause".split(" "),function(u,a,w,m,b,c){function e(b){if(!b)return null;var f=a.invalidClauseCache.get(b);
if(void 0!==f)return f;f=a.whereClausesCache.get(b);if(void 0!==f)return f;f=c.create(b);a.whereClausesCache.put(b,f);return f}function f(a,b,c,t){void 0===t&&(t=!0);for(var l=[],p=0;p<b.length;p++){var h=b[p];if("*"!==h&&!a.has(h))if(t){var k=x(h);try{var n=e(k);if(!n.isStandardized())throw new m("feature-store:unsupported-query","expression is not standard",{clause:n});f(a,n.getFields(),"expression contains missing fields")}catch(H){if((k=H&&H.details)&&k.clause)throw H;k&&k.missingFields?Array.prototype.push.apply(l,
k.missingFields):l.push(h)}}else l.push(h)}if(l.length)throw new m("feature-store:unsupported-query",c,{missingFields:l});}function x(a){return a.split(" as ")[0]}Object.defineProperty(a,"__esModule",{value:!0});a.invalidClauseCache=new b(500);a.whereClausesCache=new b(50);var t=new w.default("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));a.validateWhere=function(b,e){if(!e)return!0;var l;try{l=
c.create(e),a.whereClausesCache.put(e,l)}catch(A){throw a.invalidClauseCache.put(e,null),new m("feature-store:unsupported-query","invalid SQL expression",{where:e});}if(!l.isStandardized())throw new m("feature-store:unsupported-query","where clause is not standard",{where:e});e=l.getFields();f(b,e,"where clause contains missing fields");return!0};a.validateHaving=function(b,e,x){if(!e)return!0;var l;try{l=c.create(e),a.whereClausesCache.put(e,l)}catch(z){throw a.invalidClauseCache.put(e,null),new m("feature-store:unsupported-query",
"invalid SQL expression",{having:e});}if(!l.isAggregate())throw new m("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:e});var p=l.getFields();f(b,p,"having contains missing fields");if(!l.getExpressions().every(function(a){var c=a.aggregateType;a=a.field;var k=b.has(a)&&b.get(a).name;return x.some(function(a){var h=a.statisticType;a=a.onStatisticField.toLowerCase().trim();return(b.has(a)&&b.get(a).name)===k&&h.toLowerCase().trim()===c})}))throw new m("feature-store:unsupported-query",
"expressions in having should also exist in outStatistics",{having:e});return!0};a.getWhereClause=e;a.validateFields=f;a.getExpressionFromFieldName=x;a.getAliasFromFieldName=function(a){return a.split(" as ")[1]};a.hasInvalidFieldType=function(a,b){var c=!1;-1!==e(a).getFields().indexOf(a)&&(a=b.get(a),c=!t.has(a.type));return c}})},"esri/core/sql/WhereClause":function(){define("require exports @dojo/framework/shim/array @dojo/framework/shim/Map ../../moment ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),
function(u,a,w,m,b,c,e,f){function x(a){return Array.isArray(a)?a:[a]}function t(a){return null!==a?!0!==a:null}function l(a,b){if(null==a)return null;for(var c=!1,h=0;h<b.length;h++){var f=b[h];if(null==f)c=null;else if(a===f){c=!0;break}}return c}function p(a,b,c){if(null==a)return null;for(var h="",k=0,f=0;f<b.length;f++){var e=b.charAt(f);switch(k){case 0:e===c?k=1:h=0<="-[]/{}()*+?.\\^$|".indexOf(e)?h+("\\"+e):"%"===e?h+".*":"_"===e?h+".":h+e;break;case 1:h=0<="-[]/{}()*+?.\\^$|".indexOf(e)?
h+("\\"+e):h+e,k=0}}return(new RegExp("^"+h+"$")).test(a)}function D(a){return a instanceof Date?a.valueOf():a}function A(a,b,c){if(null==b||null==c)return null;b=D(b);c=D(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function J(a){for(var b=[],c={},f=0;f<a.length;f++){var e=a[f],l=e.toLowerCase();void 0===c[l]&&(b.push(e),c[l]=1)}return b}return function(){function a(){this._hasAggregateFunctions=
this._hasStandardizedFunctions=this.parameters=this.parseTree=null}a.create=function(b){var h=new a;h.parseTree=f.WhereGrammar.parse(b);var n=!0,l=!0;h.visitAll(h.parseTree,function(a){if("function"===a.type){var b=a.name;a=a.args.value.length;n&&(n=e.isStandardized(b,a));l&&(l=c.isAggregate(b,a))}});h._hasStandardizedFunctions=n;h._hasAggregateFunctions=l;return h};a.prototype.isStandardized=function(){return this._hasStandardizedFunctions};a.prototype.isAggregate=function(){return this._hasAggregateFunctions};
a.prototype.setVariablesDictionary=function(a){this.parameters=a};a.prototype.testFeature=function(a){return!!this.evaluateNode(this.parseTree,a)};a.prototype.testSet=function(a){var b=this,c=new m.default;this.visitAll(this.parseTree,function(a){"column_ref"!==a.type||c.has(a.column)||c.set(a.column,a)});for(var h={},f=function(a){c.forEach(function(c,f){c=b.featureValue(a,f,c);h[f]?h[f].push(c):h[f]=[c]})},e=0;e<a.length;e++)f(a[e]);return!!this.evaluateNode(this.parseTree,{attributes:h})};a.prototype.calculateValue=
function(a){return this.evaluateNode(this.parseTree,a)};a.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&a.push(b.name.toLowerCase())});return J(a)};a.prototype.getExpressions=function(){var a=new m.default;this.visitAll(this.parseTree,function(b){if("function"===b.type){var c=b.name.toLowerCase();b=b.args.value[0];if("column_ref"===b.type){b=b.column;var h=c+"-"+b;a.has(h)||a.set(h,{aggregateType:c,field:b})}}});return w.from(a.values())};
a.prototype.getFields=function(){var a=[];this.visitAll(this.parseTree,function(b){"column_ref"===b.type&&a.push(b.column)});return J(a)};a.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return J(a)};a.prototype.featureValue=function(a,b,c){a=a&&"object"===typeof a.attributes?a.attributes:a;var h=a[b];if(void 0!==h)return h;for(var f in a)if(b.toLowerCase()===f.toLowerCase())return c.column=f,a[f];return null};
a.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,h=a.clauses;c<h.length;c++){var f=h[c];this.visitAll(f,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)f=a[c],this.visitAll(f,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);
this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};a.prototype.evaluateNode=function(a,f){switch(a.type){case "case_expression":if("simple"===a.format)for(var h=D(this.evaluateNode(a.operand,f)),k=0;k<a.clauses.length;k++){if(h===D(this.evaluateNode(a.clauses[k].operand,f)))return this.evaluateNode(a.clauses[k].value,f)}else for(k=0;k<a.clauses.length;k++)if(!0===this.evaluateNode(a.clauses[k].operand,f))return this.evaluateNode(a.clauses[k].value,f);return null!==a.else?this.evaluateNode(a.else,
f):null;case "param":return this.parameters[a.value.toLowerCase()];case "expr_list":h=[];k=0;for(a=a.value;k<a.length;k++){var m=a[k];h.push(this.evaluateNode(m,f))}return h;case "unary_expr":return t(this.evaluateNode(a.expr,f));case "binary_expr":switch(a.operator){case "AND":return h=this.evaluateNode(a.left,f),f=this.evaluateNode(a.right,f),null!=h&&null!=f?!0===h&&!0===f:!1===h||!1===f?!1:null;case "OR":return h=this.evaluateNode(a.left,f),f=this.evaluateNode(a.right,f),null!=h&&null!=f?!0===
h||!0===f:!0===h||!0===f?!0:null;case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(a.left,f);case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(a.left,f);case "IN":return h=x(this.evaluateNode(a.right,f)),l(this.evaluateNode(a.left,f),h);case "NOT IN":return h=x(this.evaluateNode(a.right,f)),t(l(this.evaluateNode(a.left,f),h));case "BETWEEN":return h=this.evaluateNode(a.left,f),f=this.evaluateNode(a.right,
f),null==h||null==f[0]||null==f[1]?null:h>=f[0]&&h<=f[1];case "NOTBETWEEN":return h=this.evaluateNode(a.left,f),f=this.evaluateNode(a.right,f),null==h||null==f[0]||null==f[1]?null:h<f[0]||h>f[1];case "LIKE":return p(this.evaluateNode(a.left,f),this.evaluateNode(a.right,f),a.escape);case "NOT LIKE":return t(p(this.evaluateNode(a.left,f),this.evaluateNode(a.right,f),a.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return A(a.operator,this.evaluateNode(a.left,
f),this.evaluateNode(a.right,f));case "*":return this.evaluateNode(a.left,f)*this.evaluateNode(a.right,f);case "-":return this.evaluateNode(a.left,f)-this.evaluateNode(a.right,f);case "+":return this.evaluateNode(a.left,f)+this.evaluateNode(a.right,f);case "/":return this.evaluateNode(a.left,f)/this.evaluateNode(a.right,f)}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return a.value;case "date":return b(a.value,["YYYY-M-D"]).toDate();case "timestamp":return b(a.value,
["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate();case "column_ref":return"CURRENT_DATE"===a.column.toUpperCase()?(m=new Date,m.setHours(0,0,0,0),m):"CURRENT_TIMESTAMP"===a.column.toUpperCase()?new Date:this.featureValue(f,a.column,a);case "function":return f=this.evaluateNode(a.args,f),this.isAggregate()?c.aggregateFunction(a.name,f):e.evaluateFunction(a.name,f)}throw Error("Unsupported sql syntax "+a.type);};return a}()})},"esri/core/sql/AggregateFunctions":function(){define(["require",
"exports"],function(u,a){function w(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b/a.length}function m(a){for(var b=w(a),c=a.length,m=0,t=0;t<a.length;t++)m+=Math.pow(a[t]-b,2);return 1<c?m/(c-1):0}Object.defineProperty(a,"__esModule",{value:!0});a.aggregateFunction=function(a,e){var c=b[a.toLowerCase()];if(null==c)throw Error("Function Not Recognised");if(e.length<c.minParams||e.length>c.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return c.evaluate(e)};a.isAggregate=
function(a,e){a=b[a.toLowerCase()];return null!=a&&e>=a.minParams&&e<=a.maxParams};var b={min:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.min.apply(Math,a[0])}},max:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.max.apply(Math,a[0])}},avg:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:w(a[0])}},sum:{minParams:1,maxParams:1,evaluate:function(a){if(null==a[0])a=null;else{a=a[0];for(var b=0,c=0;c<a.length;c++)b+=a[c];a=b}return a}},
stddev:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sqrt(m(a[0]))}},count:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].length}},var:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:m(a[0])}}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","dojo/regexp"],function(u,a,w){Object.defineProperty(a,"__esModule",{value:!0});a.evaluateFunction=function(a,c){var b=m[a.toLowerCase()];if(null==b)throw Error("Function Not Recognised");
if(c.length<b.minParams||c.length>b.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return b.evaluate(c)};a.isStandardized=function(a,c){a=m[a.toLowerCase()];return null!=a&&c>=a.minParams&&c<=a.maxParams};var m={extract:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];if(null==a)return null;if(a instanceof Date)switch(b.toUpperCase()){case "SECOND":return a.getSeconds();case "MINUTE":return a.getMinutes();case "HOUR":return a.getHours();case "DAY":return a.getDate();
case "MONTH":return a.getMonth()+1;case "YEAR":return a.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var b=a[0],e=a[1];return null==b||null==e?null:b.toString().substring(e-1)}if(3===a.length)return b=a[0],e=a[1],a=a[2],null==b||null==e||null==a?null:0>=a?"":b.toString().substring(e-1,e+a-1)}},position:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];return null==b||null==a?null:a.indexOf(b)+
1}},trim:{minParams:2,maxParams:3,evaluate:function(a){var b=3===a.length,e=b?a[1]:" ",b=b?a[2]:a[1];if(null==e||null==b)return null;e="("+w.escapeString(e)+")";switch(a[0]){case "BOTH":return b.replace(new RegExp("^"+e+"*|"+e+"*$","g"),"");case "LEADING":return b.replace(new RegExp("^"+e+"*","g"),"");case "TRAILING":return b.replace(new RegExp(e+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},
ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])}},log10:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,
evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.asin(a[0])}},acos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:
0<a[0]?1:0>a[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var b=a[0];a=2===a.length?Math.pow(10,a[1]):1;return null==b?null:Math.round(b*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},
char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"===typeof a[0]||a[0]instanceof String?a[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(a){for(var b="",e=0;e<a.length;e++){if(null==a[e])return null;b+=a[e].toString()}return b}},lower:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require",
"exports","./sql92grammar"],function(u,a,w){Object.defineProperty(a,"__esModule",{value:!0});u=function(){function a(){}a.parse=function(a){return w.parse(a)};return a}();a.WhereGrammar=u})},"esri/core/sql/sql92grammar":function(){define([],function(){function u(a,w,m,b){this.message=a;this.expected=w;this.found=m;this.location=b;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,u)}(function(a,w){function m(){this.constructor=a}m.prototype=w.prototype;
a.prototype=new m})(u,Error);u.buildMessage=function(a,w){function m(a){return a.charCodeAt(0).toString(16).toUpperCase()}function b(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+m(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+m(a)})}function c(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,
"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+m(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+m(a)})}var e={literal:function(a){return'"'+b(a.text)+'"'},"class":function(a){var b="",f;for(f=0;f<a.parts.length;f++)b+=a.parts[f]instanceof Array?c(a.parts[f][0])+"-"+c(a.parts[f][1]):c(a.parts[f]);return"["+(a.inverted?"^":"")+b+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};
return"Expected "+function(a){var b=Array(a.length),c;for(c=0;c<a.length;c++){var f=c,m;m=a[c];m=e[m.type](m);b[f]=m}b.sort();if(0<b.length){for(a=c=1;c<b.length;c++)b[c-1]!==b[c]&&(b[a]=b[c],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(a)+" but "+(w?'"'+b(w)+'"':"end of input")+" found."};return{SyntaxError:u,parse:function(a,w){function m(a,b){return{type:"literal",text:a,ignoreCase:b}}function b(a,
b,d){return{type:"class",parts:a,inverted:b,ignoreCase:d}}function c(b){var d=ra[b],c;if(!d){for(c=b-1;!ra[c];)c--;d=ra[c];for(d={line:d.line,column:d.column};c<b;)10===a.charCodeAt(c)?(d.line++,d.column=1):d.column++,c++;ra[b]=d}return d}function e(a,b){var d=c(a),g=c(b);return{start:{offset:a,line:d.line,column:d.column},end:{offset:b,line:g.line,column:g.column}}}function f(a){g<U||(g>U&&(U=g,sa=[]),sa.push(a))}function x(){var a,b,c;a=g;b=y();b!==d?(b=l(),b!==d?(c=y(),c!==d?a=b:(g=a,a=d)):(g=
a,a=d)):(g=a,a=d);return a}function t(){var a,b,c,f,h,e,k,q;a=g;b=l();if(b!==d){c=[];f=g;h=y();h!==d?(e=Sa(),e!==d?(k=y(),k!==d?(q=l(),q!==d?f=h=[h,e,k,q]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);for(;f!==d;)c.push(f),f=g,h=y(),h!==d?(e=Sa(),e!==d?(k=y(),k!==d?(q=l(),q!==d?f=h=[h,e,k,q]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);if(c!==d){a={type:"expr_list"};b=[b];for(f=0;f<c.length;f++)b.push(c[f][3]);a.value=b}else g=a,a=d}else g=a,a=d;return a}function l(){var a,b,c,f,h,e,k,q;a=g;b=p();if(b!==
d){c=[];f=g;h=y();h!==d?(e=Qa(),e!==d?(k=y(),k!==d?(q=p(),q!==d?f=h=[h,e,k,q]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);for(;f!==d;)c.push(f),f=g,h=y(),h!==d?(e=Qa(),e!==d?(k=y(),k!==d?(q=p(),q!==d?f=h=[h,e,k,q]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);c!==d?a=b=ga(b,c):(g=a,a=d)}else g=a,a=d;return a}function p(){var a,b,c,f,h,e,k,q;a=g;b=D();if(b!==d){c=[];f=g;h=y();h!==d?(e=fa(),e!==d?(k=y(),k!==d?(q=D(),q!==d?f=h=[h,e,k,q]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);for(;f!==d;)c.push(f),f=
g,h=y(),h!==d?(e=fa(),e!==d?(k=y(),k!==d?(q=D(),q!==d?f=h=[h,e,k,q]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);c!==d?a=b=ga(b,c):(g=a,a=d)}else g=a,a=d;return a}function D(){var b,c,e,k,q;b=g;c=Y();c===d&&(c=g,33===a.charCodeAt(g)?(e=dd,g++):(e=d,0===v&&f(ed)),e!==d?(k=g,v++,61===a.charCodeAt(g)?(q=Ta,g++):(q=d,0===v&&f(Ua)),v--,q===d?k=void 0:(g=k,k=d),k!==d?c=e=[e,k]:(g=c,c=d)):(g=c,c=d));c!==d?(e=y(),e!==d?(k=D(),k!==d?b=c={type:"unary_expr",operator:"NOT",expr:k}:(g=b,b=d)):(g=b,b=d)):(g=b,b=
d);if(b===d)if(b=g,c=h(),c!==d)if(e=y(),e!==d){var l,r,n;e=[];k=g;q=y();q!==d?(l=A(),l!==d?(r=y(),r!==d?(n=h(),n!==d?k=q=[q,l,r,n]:(g=k,k=d)):(g=k,k=d)):(g=k,k=d)):(g=k,k=d);if(k!==d)for(;k!==d;)e.push(k),k=g,q=y(),q!==d?(l=A(),l!==d?(r=y(),r!==d?(n=h(),n!==d?k=q=[q,l,r,n]:(g=k,k=d)):(g=k,k=d)):(g=k,k=d)):(g=k,k=d);else e=d;e!==d&&(e={type:"arithmetic",tail:e});e===d&&(e=g,k=z(),k!==d?(q=y(),q!==d?(q=ja(),q!==d?(q=y(),q!==d?(q=t(),q!==d?(l=y(),l!==d?(l=ka(),l!==d?e=k={op:k,right:q}:(g=e,e=d)):(g=
e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===d&&(e=g,k=z(),k!==d?(q=y(),q!==d?(q=ja(),q!==d?(q=y(),q!==d?(q=ka(),q!==d?e=k={op:k,right:{type:"expr_list",value:[]}}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===d&&(e=g,k=z(),k!==d?(q=y(),q!==d?(q=R(),q!==d?e=k={op:k,right:q}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d))),e===d&&(e=g,q=Y(),q!==d?(k=y(),k!==d?(k=Ra(),k!==d?(l=y(),l!==d?(l=h(),l!==d?(r=y(),r!==d?(r=fa(),r!==d?(q=y(),q!==d?(q=h(),q!==d?e=q={op:"NOT"+k,right:{type:"expr_list",
value:[l,q]}}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===d&&(e=g,q=Ra(),q!==d?(k=y(),k!==d?(k=h(),k!==d?(l=y(),l!==d?(l=fa(),l!==d?(r=y(),r!==d?(r=h(),r!==d?e=q={op:q,right:{type:"expr_list",value:[k,r]}}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)),e===d&&(e=g,k=Z(),k!==d?(q=y(),q!==d?(q=Y(),q!==d?(q=y(),q!==d?(q=h(),q!==d?e=k={op:k+"NOT",right:q}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===d&&
(e=g,k=Z(),k!==d?(q=y(),q!==d?(q=h(),q!==d?e=k={op:k,right:q}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)),e===d&&(e=g,k=J(),k!==d?(q=y(),q!==d?(q=G(),q!==d?(l=y(),l!==d?(l=g,a.substr(g,6).toLowerCase()===fd?(r=a.substr(g,6),g+=6):(r=d,0===v&&f(gd)),r!==d?(r=g,v++,n=C(),v--,n===d?r=void 0:(g=r,r=d),r!==d?l="ESCAPE":(g=l,l=d)):(g=l,l=d),l!==d?(l=y(),l!==d?(l=T(),l!==d?e=k={op:k,right:q,escape:l.value}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d)):(g=e,e=d),e===d&&(e=g,k=J(),k!==d?(q=y(),q!==
d?(q=G(),q!==d?e=k={op:k,right:q,escape:""}:(g=e,e=d)):(g=e,e=d)):(g=e,e=d))))));e===d&&(e=null);e!==d?(b=c,c=e,""==c||void 0==c||null==c?c=b:(e=null,c=e="arithmetic"==c.type?ga(b,c.tail):Va(c.op,b,c.right,c.escape)),b=c):(g=b,b=d)}else g=b,b=d;else g=b,b=d;return b}function A(){var b;a.substr(g,2)===Wa?(b=Wa,g+=2):(b=d,0===v&&f(hd));b===d&&(62===a.charCodeAt(g)?(b=id,g++):(b=d,0===v&&f(jd)),b===d&&(a.substr(g,2)===Xa?(b=Xa,g+=2):(b=d,0===v&&f(kd)),b===d&&(a.substr(g,2)===Ya?(b=Ya,g+=2):(b=d,0===
v&&f(ld)),b===d&&(60===a.charCodeAt(g)?(b=md,g++):(b=d,0===v&&f(nd)),b===d&&(61===a.charCodeAt(g)?(b=Ta,g++):(b=d,0===v&&f(Ua)),b===d&&(a.substr(g,2)===Za?(b=Za,g+=2):(b=d,0===v&&f(od))))))));return b}function J(){var a,b,c,f;a=a=g;b=Y();b!==d?(c=y(),c!==d?(f=na(),f!==d?a=b=[b,c,f]:(g=a,a=d)):(g=a,a=d)):(g=a,a=d);a!==d&&(a=a[0]+" "+a[2]);a===d&&(a=na());return a}function z(){var a,b,c,f;a=a=g;b=Y();b!==d?(c=y(),c!==d?(f=jc(),f!==d?a=b=[b,c,f]:(g=a,a=d)):(g=a,a=d)):(g=a,a=d);a!==d&&(a=a[0]+" "+a[2]);
a===d&&(a=jc());return a}function h(){var a,b,c,f,e,h,q,l;a=g;b=n();if(b!==d){c=[];f=g;e=y();e!==d?(h=k(),h!==d?(q=y(),q!==d?(l=n(),l!==d?f=e=[e,h,q,l]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);for(;f!==d;)c.push(f),f=g,e=y(),e!==d?(h=k(),h!==d?(q=y(),q!==d?(l=n(),l!==d?f=e=[e,h,q,l]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);c!==d?a=b=ga(b,c):(g=a,a=d)}else g=a,a=d;return a}function k(){var b;43===a.charCodeAt(g)?(b=$a,g++):(b=d,0===v&&f(ab));b===d&&(45===a.charCodeAt(g)?(b=bb,g++):(b=d,0===v&&
f(cb)));return b}function n(){var a,b,c,f,e,h,k,q;a=g;b=E();if(b!==d){c=[];f=g;e=y();e!==d?(h=H(),h!==d?(k=y(),k!==d?(q=E(),q!==d?f=e=[e,h,k,q]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);for(;f!==d;)c.push(f),f=g,e=y(),e!==d?(h=H(),h!==d?(k=y(),k!==d?(q=E(),q!==d?f=e=[e,h,k,q]:(g=f,f=d)):(g=f,f=d)):(g=f,f=d)):(g=f,f=d);c!==d?a=b=ga(b,c):(g=a,a=d)}else g=a,a=d;return a}function H(){var b;42===a.charCodeAt(g)?(b=pd,g++):(b=d,0===v&&f(qd));b===d&&(47===a.charCodeAt(g)?(b=rd,g++):(b=d,0===v&&f(sd)));
return b}function E(){var b,c,e,h,k,n,m;m=T();if(m===d){var p,x,z,H;p=g;var E,w,D,A;E=g;w=ia();w!==d?(D=zc(),D!==d?(A=Ac(),A!==d?E=w=parseFloat(w+D+A):(g=E,E=d)):(g=E,E=d)):(g=E,E=d);E===d&&(E=g,w=ia(),w!==d?(D=zc(),D!==d?E=w=parseFloat(w+D):(g=E,E=d)):(g=E,E=d),E===d&&(E=g,w=ia(),w!==d?(D=Ac(),D!==d?E=w=parseFloat(w+D):(g=E,E=d)):(g=E,E=d),E===d&&(E=g,w=ia(),w!==d&&(w=parseFloat(w)),E=w)));x=E;x!==d?(z=g,v++,H=L(),v--,H===d?z=void 0:(g=z,z=d),z!==d?p=x={type:"number",value:x}:(g=p,p=d)):(g=p,p=d);
m=p;if(m===d){var J,P;J=g;var u,Q,fa,Qa;u=g;a.substr(g,4).toLowerCase()===td?(Q=a.substr(g,4),g+=4):(Q=d,0===v&&f(ud));Q!==d?(fa=g,v++,Qa=C(),v--,Qa===d?fa=void 0:(g=fa,fa=d),fa!==d?u=Q=[Q,fa]:(g=u,u=d)):(g=u,u=d);P=u;P!==d&&(P={type:"bool",value:!0});J=P;if(J===d){J=g;var U,Y,Z,na;U=g;a.substr(g,5).toLowerCase()===vd?(Y=a.substr(g,5),g+=5):(Y=d,0===v&&f(wd));Y!==d?(Z=g,v++,na=C(),v--,na===d?Z=void 0:(g=Z,Z=d),Z!==d?U=Y=[Y,Z]:(g=U,U=d)):(g=U,U=d);P=U;P!==d&&(P={type:"bool",value:!1});J=P}m=J;if(m===
d){var ga,ta,db,Ia,ra;ta=g;a.substr(g,4).toLowerCase()===xd?(db=a.substr(g,4),g+=4):(db=d,0===v&&f(yd));db!==d?(Ia=g,v++,ra=C(),v--,ra===d?Ia=void 0:(g=Ia,Ia=d),Ia!==d?ta=db=[db,Ia]:(g=ta,ta=d)):(g=ta,ta=d);ga=ta;ga!==d&&(ga={type:"null",value:null});m=ga;if(m===d){var la,qa,Ha,sa;la=g;var ua,Jb,eb,Ra;ua=g;a.substr(g,4).toLowerCase()===zd?(Jb=a.substr(g,4),g+=4):(Jb=d,0===v&&f(Ad));Jb!==d?(eb=g,v++,Ra=C(),v--,Ra===d?eb=void 0:(g=eb,eb=d),eb!==d?ua=Jb="DATE":(g=ua,ua=d)):(g=ua,ua=d);qa=ua;qa!==d?(Ha=
y(),Ha!==d?(sa=G(),sa!==d?la=qa={type:"date",value:sa.value}:(g=la,la=d)):(g=la,la=d)):(g=la,la=d);m=la;if(m===d){var ma,lc,Sa,mc;ma=g;var va,Kb,fb,Ta;va=g;a.substr(g,9).toLowerCase()===Bd?(Kb=a.substr(g,9),g+=9):(Kb=d,0===v&&f(Cd));Kb!==d?(fb=g,v++,Ta=C(),v--,Ta===d?fb=void 0:(g=fb,fb=d),fb!==d?va=Kb="TIMESTAMP":(g=va,va=d)):(g=va,va=d);lc=va;lc!==d?(Sa=y(),Sa!==d?(mc=G(),mc!==d?ma=lc={type:"timestamp",value:mc.value}:(g=ma,ma=d)):(g=ma,ma=d)):(g=ma,ma=d);m=ma}}}}}b=m;if(b===d){var N,nc,Ua,Va,Wa,
oc,Xa,Ya,Za,pc,$a,ab;N=g;var wa,Lb,gb,bb;wa=g;a.substr(g,7).toLowerCase()===Dd?(Lb=a.substr(g,7),g+=7):(Lb=d,0===v&&f(Ed));Lb!==d?(gb=g,v++,bb=C(),v--,bb===d?gb=void 0:(g=gb,gb=d),gb!==d?wa=Lb="EXTRACT":(g=wa,wa=d)):(g=wa,wa=d);nc=wa;if(nc!==d)if(Ua=y(),Ua!==d)if(Va=ja(),Va!==d)if(Wa=y(),Wa!==d){var aa,xa,Mb,hb,cb;xa=g;a.substr(g,4).toLowerCase()===Fd?(Mb=a.substr(g,4),g+=4):(Mb=d,0===v&&f(Gd));Mb!==d?(hb=g,v++,cb=C(),v--,cb===d?hb=void 0:(g=hb,hb=d),hb!==d?xa=Mb="YEAR":(g=xa,xa=d)):(g=xa,xa=d);aa=
xa;if(aa===d){var ya,Nb,ib,vb;ya=g;a.substr(g,5).toLowerCase()===Hd?(Nb=a.substr(g,5),g+=5):(Nb=d,0===v&&f(Id));Nb!==d?(ib=g,v++,vb=C(),v--,vb===d?ib=void 0:(g=ib,ib=d),ib!==d?ya=Nb="MONTH":(g=ya,ya=d)):(g=ya,ya=d);aa=ya;if(aa===d){var za,Ob,jb,wb;za=g;a.substr(g,3).toLowerCase()===Jd?(Ob=a.substr(g,3),g+=3):(Ob=d,0===v&&f(Kd));Ob!==d?(jb=g,v++,wb=C(),v--,wb===d?jb=void 0:(g=jb,jb=d),jb!==d?za=Ob="DAY":(g=za,za=d)):(g=za,za=d);aa=za;if(aa===d){var Aa,Pb,kb,xb;Aa=g;a.substr(g,4).toLowerCase()===Ld?
(Pb=a.substr(g,4),g+=4):(Pb=d,0===v&&f(Md));Pb!==d?(kb=g,v++,xb=C(),v--,xb===d?kb=void 0:(g=kb,kb=d),kb!==d?Aa=Pb="HOUR":(g=Aa,Aa=d)):(g=Aa,Aa=d);aa=Aa;if(aa===d){var Ba,Qb,lb,yb;Ba=g;a.substr(g,6).toLowerCase()===Nd?(Qb=a.substr(g,6),g+=6):(Qb=d,0===v&&f(Od));Qb!==d?(lb=g,v++,yb=C(),v--,yb===d?lb=void 0:(g=lb,lb=d),lb!==d?Ba=Qb="MINUTE":(g=Ba,Ba=d)):(g=Ba,Ba=d);aa=Ba;if(aa===d){var Ca,Rb,mb,zb;Ca=g;a.substr(g,6).toLowerCase()===Pd?(Rb=a.substr(g,6),g+=6):(Rb=d,0===v&&f(Qd));Rb!==d?(mb=g,v++,zb=C(),
v--,zb===d?mb=void 0:(g=mb,mb=d),mb!==d?Ca=Rb="SECOND":(g=Ca,Ca=d)):(g=Ca,Ca=d);aa=Ca}}}}}oc=aa;oc!==d?(Xa=y(),Xa!==d?(Ya=kc(),Ya!==d?(Za=y(),Za!==d?(pc=l(),pc!==d?($a=y(),$a!==d?(ab=ka(),ab!==d?N=nc={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:oc},pc]}}:(g=N,N=d)):(g=N,N=d)):(g=N,N=d)):(g=N,N=d)):(g=N,N=d)):(g=N,N=d)):(g=N,N=d)}else g=N,N=d;else g=N,N=d;else g=N,N=d;else g=N,N=d;b=N;if(b===d){var M,qc,Ab,Bb,Cb,Sb,Db,Eb,Fb,Tb,Cc,X,Ja,rc,sc,tc;M=g;var Da,Ub,nb,
Dc;Da=g;a.substr(g,9).toLowerCase()===Rd?(Ub=a.substr(g,9),g+=9):(Ub=d,0===v&&f(Sd));Ub!==d?(nb=g,v++,Dc=C(),v--,Dc===d?nb=void 0:(g=nb,nb=d),nb!==d?Da=Ub="SUBSTRING":(g=Da,Da=d)):(g=Da,Da=d);qc=Da;if(qc!==d)if(Ab=y(),Ab!==d)if(Bb=ja(),Bb!==d)if(Cb=y(),Cb!==d)if(Sb=l(),Sb!==d)if(Db=y(),Db!==d)if(Eb=kc(),Eb!==d)if(Fb=y(),Fb!==d)if(Tb=l(),Tb!==d)if(Cc=y(),Cc!==d){X=g;var Ea,Vb,ob,Ec;Ea=g;a.substr(g,3).toLowerCase()===Td?(Vb=a.substr(g,3),g+=3):(Vb=d,0===v&&f(Ud));Vb!==d?(ob=g,v++,Ec=C(),v--,Ec===d?
ob=void 0:(g=ob,ob=d),ob!==d?Ea=Vb="FOR":(g=Ea,Ea=d)):(g=Ea,Ea=d);Ja=Ea;Ja!==d?(rc=y(),rc!==d?(sc=l(),sc!==d?(tc=y(),tc!==d?X=Ja=[Ja,rc,sc,tc]:(g=X,X=d)):(g=X,X=d)):(g=X,X=d)):(g=X,X=d);X===d&&(X=null);X!==d?(Ja=ka(),Ja!==d?M=qc={type:"function",name:"substring",args:{type:"expr_list",value:X?[Sb,Tb,X[2]]:[Sb,Tb]}}:(g=M,M=d)):(g=M,M=d)}else g=M,M=d;else g=M,M=d;else g=M,M=d;else g=M,M=d;else g=M,M=d;else g=M,M=d;else g=M,M=d;else g=M,M=d;else g=M,M=d;else g=M,M=d;b=M;if(b===d){var F,Ka,Wb,Xb,Yb,ba,
Zb,La,$b,ac,Fc,uc,Gc,Hc;F=g;Ka=Bc();Ka!==d?(Wb=y(),Wb!==d?(Xb=ja(),Xb!==d?(Yb=y(),Yb!==d?(ba=q(),ba===d&&(ba=null),ba!==d?(Zb=y(),Zb!==d?(La=l(),La!==d?($b=y(),$b!==d?(ac=kc(),ac!==d?(Fc=y(),Fc!==d?(uc=l(),uc!==d?(Gc=y(),Gc!==d?(Hc=ka(),Hc!==d?F=Ka={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==ba?"BOTH":ba},La,uc]}}:(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d);F===
d&&(F=g,Ka=Bc(),Ka!==d?(Wb=y(),Wb!==d?(Xb=ja(),Xb!==d?(Yb=y(),Yb!==d?(ba=q(),ba===d&&(ba=null),ba!==d?(Zb=y(),Zb!==d?(La=l(),La!==d?($b=y(),$b!==d?(ac=ka(),ac!==d?F=Ka={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==ba?"BOTH":ba},La]}}:(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d)):(g=F,F=d));b=F;if(b===d){var O,vc,Ic,Jc,Kc,wc,Lc,Mc,Nc,xc,Oc,Pc;O=g;var Fa,bc,pb,Qc;Fa=g;a.substr(g,8).toLowerCase()===Vd?(bc=a.substr(g,8),
g+=8):(bc=d,0===v&&f(Wd));bc!==d?(pb=g,v++,Qc=C(),v--,Qc===d?pb=void 0:(g=pb,pb=d),pb!==d?Fa=bc="POSITION":(g=Fa,Fa=d)):(g=Fa,Fa=d);vc=Fa;vc!==d?(Ic=y(),Ic!==d?(Jc=ja(),Jc!==d?(Kc=y(),Kc!==d?(wc=l(),wc!==d?(Lc=y(),Lc!==d?(Mc=jc(),Mc!==d?(Nc=y(),Nc!==d?(xc=l(),xc!==d?(Oc=y(),Oc!==d?(Pc=ka(),Pc!==d?O=vc={type:"function",name:"position",args:{type:"expr_list",value:[wc,xc]}}:(g=O,O=d)):(g=O,O=d)):(g=O,O=d)):(g=O,O=d)):(g=O,O=d)):(g=O,O=d)):(g=O,O=d)):(g=O,O=d)):(g=O,O=d)):(g=O,O=d)):(g=O,O=d);b=O;if(b===
d){var W,cc,Rc,Sc,Tc,Ma,Uc,Vc;W=g;var ca,qb,rb,ha;ca=g;ca=qb=B();if(ca===d)if(ca=g,96===a.charCodeAt(g)?(qb=Wc,g++):(qb=d,0===v&&f(Xc)),qb!==d){rb=[];Yc.test(a.charAt(g))?(ha=a.charAt(g),g++):(ha=d,0===v&&f(Zc));if(ha!==d)for(;ha!==d;)rb.push(ha),Yc.test(a.charAt(g))?(ha=a.charAt(g),g++):(ha=d,0===v&&f(Zc));else rb=d;rb!==d?(96===a.charCodeAt(g)?(ha=Wc,g++):(ha=d,0===v&&f(Xc)),ha!==d?ca=qb=rb.join(""):(g=ca,ca=d)):(g=ca,ca=d)}else g=ca,ca=d;cc=ca;cc!==d?(Rc=y(),Rc!==d?(Sc=ja(),Sc!==d?(Tc=y(),Tc!==
d?(Ma=t(),Ma===d&&(Ma=null),Ma!==d?(Uc=y(),Uc!==d?(Vc=ka(),Vc!==d?W=cc={type:"function",name:cc,args:Ma?Ma:{type:"expr_list",value:[]}}:(g=W,W=d)):(g=W,W=d)):(g=W,W=d)):(g=W,W=d)):(g=W,W=d)):(g=W,W=d)):(g=W,W=d);b=W;if(b===d){var dc,I,Na,ec,Oa,fc,oa,da,sb,$c,ad;I=g;Na=Hb();if(Na!==d)if(ec=y(),ec!==d)if(Oa=l(),Oa!==d)if(fc=y(),fc!==d){oa=[];for(da=S();da!==d;)oa.push(da),da=S();oa!==d?(da=y(),da!==d?(sb=Ib(),sb!==d?I=Na={type:"case_expression",format:"simple",operand:Oa,clauses:oa,else:null}:(g=I,
I=d)):(g=I,I=d)):(g=I,I=d)}else g=I,I=d;else g=I,I=d;else g=I,I=d;else g=I,I=d;if(I===d)if(I=g,Na=Hb(),Na!==d)if(ec=y(),ec!==d)if(Oa=l(),Oa!==d)if(fc=y(),fc!==d){oa=[];for(da=S();da!==d;)oa.push(da),da=S();oa!==d?(da=y(),da!==d?(sb=Gb(),sb!==d?($c=y(),$c!==d?(ad=Ib(),ad!==d?I=Na={type:"case_expression",format:"simple",operand:Oa,clauses:oa,else:sb.value}:(g=I,I=d)):(g=I,I=d)):(g=I,I=d)):(g=I,I=d)):(g=I,I=d)}else g=I,I=d;else g=I,I=d;else g=I,I=d;else g=I,I=d;dc=I;if(dc===d){var K,Pa,gc,pa,ea,tb,bd,
cd;K=g;Pa=Hb();if(Pa!==d)if(gc=y(),gc!==d){pa=[];for(ea=V();ea!==d;)pa.push(ea),ea=V();pa!==d?(ea=y(),ea!==d?(tb=Ib(),tb!==d?K=Pa={type:"case_expression",format:"searched",clauses:pa,else:null}:(g=K,K=d)):(g=K,K=d)):(g=K,K=d)}else g=K,K=d;else g=K,K=d;if(K===d)if(K=g,Pa=Hb(),Pa!==d)if(gc=y(),gc!==d){pa=[];for(ea=V();ea!==d;)pa.push(ea),ea=V();pa!==d?(ea=y(),ea!==d?(tb=Gb(),tb!==d?(bd=y(),bd!==d?(cd=Ib(),cd!==d?K=Pa={type:"case_expression",format:"searched",clauses:pa,else:tb.value}:(g=K,K=d)):(g=
K,K=d)):(g=K,K=d)):(g=K,K=d)):(g=K,K=d)}else g=K,K=d;else g=K,K=d;dc=K}b=dc;if(b===d){var ub,Ga,yc,hc,ic;Ga=g;yc=L();if(yc!==d){hc=[];for(ic=r();ic!==d;)hc.push(ic),ic=r();hc!==d?Ga=yc+=hc.join(""):(g=Ga,Ga=d)}else g=Ga,Ga=d;ub=Ga;ub!==d&&(ub={type:"column_ref",table:"",column:ub});b=ub;b===d&&(b=R(),b===d&&(b=g,c=ja(),c!==d?(e=y(),e!==d?(h=l(),h!==d?(k=y(),k!==d?(n=ka(),n!==d?(h.paren=!0,b=c=h):(g=b,b=d)):(g=b,b=d)):(g=b,b=d)):(g=b,b=d)):(g=b,b=d)))}}}}}}}return b}function B(){var a,b,c,f;a=g;b=
L();if(b!==d){c=[];for(f=C();f!==d;)c.push(f),f=C();c!==d?a=b+=c.join(""):(g=a,a=d)}else g=a,a=d;return a}function L(){var b;Xd.test(a.charAt(g))?(b=a.charAt(g),g++):(b=d,0===v&&f(Yd));return b}function C(){var b;Zd.test(a.charAt(g))?(b=a.charAt(g),g++):(b=d,0===v&&f($d));return b}function r(){var b;ae.test(a.charAt(g))?(b=a.charAt(g),g++):(b=d,0===v&&f(be));return b}function R(){var b,c,e;b=g;64===a.charCodeAt(g)?(c=ce,g++):(c=d,0===v&&f(de));c!==d?(e=B(),e!==d?b=c=[c,e]:(g=b,b=d)):(g=b,b=d);b!==
d&&(b={type:"param",value:b[1]});return b}function q(){var b,c,e;b=g;a.substr(g,7).toLowerCase()===ee?(c=a.substr(g,7),g+=7):(c=d,0===v&&f(fe));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="LEADING":(g=b,b=d)):(g=b,b=d);b===d&&(b=g,a.substr(g,8).toLowerCase()===ge?(c=a.substr(g,8),g+=8):(c=d,0===v&&f(he)),c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="TRAILING":(g=b,b=d)):(g=b,b=d),b===d&&(b=g,a.substr(g,4).toLowerCase()===ie?(c=a.substr(g,4),g+=4):(c=d,0===v&&f(je)),c!==
d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="BOTH":(g=b,b=d)):(g=b,b=d)));return b}function G(){var a;a=T();a===d&&(a=R());return a}function T(){var b,c,e;b=g;39===a.charCodeAt(g)?(c=vb,g++):(c=d,0===v&&f(wb));c===d&&(a.substr(g,2)===xb?(c=xb,g+=2):(c=d,0===v&&f(ke)));if(c!==d){c=[];e=g;a.substr(g,2)===qa?(e=qa,g+=2):(e=d,0===v&&f(yb));e!==d&&(e="'");e===d&&(zb.test(a.charAt(g))?(e=a.charAt(g),g++):(e=d,0===v&&f(Ab)));for(;e!==d;)c.push(e),e=g,a.substr(g,2)===qa?(e=qa,g+=2):(e=d,0===v&&
f(yb)),e!==d&&(e="'"),e===d&&(zb.test(a.charAt(g))?(e=a.charAt(g),g++):(e=d,0===v&&f(Ab)));c!==d?(39===a.charCodeAt(g)?(e=vb,g++):(e=d,0===v&&f(wb)),e!==d?b=c={type:"string",value:c.join("")}:(g=b,b=d)):(g=b,b=d)}else g=b,b=d;return b}function V(){var a,b,c;a=g;b=Bb();b!==d?(b=y(),b!==d?(b=l(),b!==d?(c=y(),c!==d?(c=Cb(),c!==d?(c=y(),c!==d?(c=l(),c!==d?a=b={type:"when_clause",operand:b,value:c}:(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d);return a}function S(){var a,
b,c;a=g;b=Bb();b!==d?(b=y(),b!==d?(b=l(),b!==d?(c=y(),c!==d?(c=Cb(),c!==d?(c=y(),c!==d?(c=l(),c!==d?a=b={type:"when_clause",operand:b,value:c}:(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d)):(g=a,a=d);return a}function Gb(){var b,c;b=g;var e,h;c=g;a.substr(g,4).toLowerCase()===le?(e=a.substr(g,4),g+=4):(e=d,0===v&&f(me));e!==d?(e=g,v++,h=C(),v--,h===d?e=void 0:(g=e,e=d),e!==d?c="ELSE":(g=c,c=d)):(g=c,c=d);c!==d?(c=y(),c!==d?(c=l(),c!==d?b={type:"else_clause",value:c}:(g=b,b=d)):
(g=b,b=d)):(g=b,b=d);return b}function ia(){var b,c,e;b=P();b===d&&(b=g,45===a.charCodeAt(g)?(c=bb,g++):(c=d,0===v&&f(cb)),c===d&&(43===a.charCodeAt(g)?(c=$a,g++):(c=d,0===v&&f(ab))),c!==d?(e=P(),e!==d?b=c=c[0]+e:(g=b,b=d)):(g=b,b=d));return b}function zc(){var b,c;b=g;46===a.charCodeAt(g)?(c=ne,g++):(c=d,0===v&&f(oe));c!==d?(c=P(),c===d&&(c=null),c!==d?b="."+(null!=c?c:""):(g=b,b=d)):(g=b,b=d);return b}function Ac(){var b,c,e;c=b=g;pe.test(a.charAt(g))?(e=a.charAt(g),g++):(e=d,0===v&&f(qe));e!==
d?(re.test(a.charAt(g))?(e=a.charAt(g),g++):(e=d,0===v&&f(se)),e===d&&(e=null),e!==d?c="e"+(null===e?"":e):(g=c,c=d)):(g=c,c=d);c!==d?(e=P(),e!==d?b=c+e:(g=b,b=d)):(g=b,b=d);return b}function P(){var a,b;a=[];b=Q();if(b!==d)for(;b!==d;)a.push(b),b=Q();else a=d;a!==d&&(a=a.join(""));return a}function Q(){var b;te.test(a.charAt(g))?(b=a.charAt(g),g++):(b=d,0===v&&f(ue));return b}function jc(){var b,c,e;b=g;a.substr(g,2).toLowerCase()===ve?(c=a.substr(g,2),g+=2):(c=d,0===v&&f(we));c!==d?(c=g,v++,e=C(),
v--,e===d?c=void 0:(g=c,c=d),c!==d?b="IN":(g=b,b=d)):(g=b,b=d);return b}function Z(){var b,c,e;b=g;a.substr(g,2).toLowerCase()===xe?(c=a.substr(g,2),g+=2):(c=d,0===v&&f(ye));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="IS":(g=b,b=d)):(g=b,b=d);return b}function na(){var b,c,e;b=g;a.substr(g,4).toLowerCase()===ze?(c=a.substr(g,4),g+=4):(c=d,0===v&&f(Ae));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="LIKE":(g=b,b=d)):(g=b,b=d);return b}function Y(){var b,c,e;b=g;a.substr(g,
3).toLowerCase()===Be?(c=a.substr(g,3),g+=3):(c=d,0===v&&f(Ce));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="NOT":(g=b,b=d)):(g=b,b=d);return b}function fa(){var b,c,e;b=g;a.substr(g,3).toLowerCase()===De?(c=a.substr(g,3),g+=3):(c=d,0===v&&f(Ee));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="AND":(g=b,b=d)):(g=b,b=d);return b}function Qa(){var b,c,e;b=g;a.substr(g,2).toLowerCase()===Fe?(c=a.substr(g,2),g+=2):(c=d,0===v&&f(Ge));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=
c,c=d),c!==d?b="OR":(g=b,b=d)):(g=b,b=d);return b}function Ra(){var b,c,e;b=g;a.substr(g,7).toLowerCase()===He?(c=a.substr(g,7),g+=7):(c=d,0===v&&f(Ie));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="BETWEEN":(g=b,b=d)):(g=b,b=d);return b}function kc(){var b,c,e;b=g;a.substr(g,4).toLowerCase()===Je?(c=a.substr(g,4),g+=4):(c=d,0===v&&f(Ke));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="FROM":(g=b,b=d)):(g=b,b=d);return b}function Bc(){var b,c,e;b=g;a.substr(g,4).toLowerCase()===
Le?(c=a.substr(g,4),g+=4):(c=d,0===v&&f(Me));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="TRIM":(g=b,b=d)):(g=b,b=d);return b}function Hb(){var b,c,e;b=g;a.substr(g,4).toLowerCase()===Ne?(c=a.substr(g,4),g+=4):(c=d,0===v&&f(Oe));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="CASE":(g=b,b=d)):(g=b,b=d);return b}function Ib(){var b,c,e;b=g;a.substr(g,3).toLowerCase()===Pe?(c=a.substr(g,3),g+=3):(c=d,0===v&&f(Qe));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="END":
(g=b,b=d)):(g=b,b=d);return b}function Bb(){var b,c,e;b=g;a.substr(g,4).toLowerCase()===Re?(c=a.substr(g,4),g+=4):(c=d,0===v&&f(Se));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="WHEN":(g=b,b=d)):(g=b,b=d);return b}function Cb(){var b,c,e;b=g;a.substr(g,4).toLowerCase()===Te?(c=a.substr(g,4),g+=4):(c=d,0===v&&f(Ue));c!==d?(c=g,v++,e=C(),v--,e===d?c=void 0:(g=c,c=d),c!==d?b="THEN":(g=b,b=d)):(g=b,b=d);return b}function Sa(){var b;44===a.charCodeAt(g)?(b=Ve,g++):(b=d,0===v&&f(We));return b}
function ja(){var b;40===a.charCodeAt(g)?(b=Xe,g++):(b=d,0===v&&f(Ye));return b}function ka(){var b;41===a.charCodeAt(g)?(b=Ze,g++):(b=d,0===v&&f($e));return b}function y(){var a,b;a=[];for(b=Db();b!==d;)a.push(b),b=Db();return a}function Db(){var b;af.test(a.charAt(g))?(b=a.charAt(g),g++):(b=d,0===v&&f(bf));return b}function Va(a,b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function ga(a,b){for(var c=0;c<b.length;c++)a=Va(b[c][1],a,b[c][3]);return a}w=
void 0!==w?w:{};var d={},Eb={start:x},Fb=x,dd="!",ed=m("!",!1),Ta="\x3d",Ua=m("\x3d",!1),Wa="\x3e\x3d",hd=m("\x3e\x3d",!1),id="\x3e",jd=m("\x3e",!1),Xa="\x3c\x3d",kd=m("\x3c\x3d",!1),Ya="\x3c\x3e",ld=m("\x3c\x3e",!1),md="\x3c",nd=m("\x3c",!1),Za="!\x3d",od=m("!\x3d",!1),$a="+",ab=m("+",!1),bb="-",cb=m("-",!1),pd="*",qd=m("*",!1),rd="/",sd=m("/",!1),Xd=/^[A-Za-z_\x80-\uFFFF]/,Yd=b([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Zd=/^[A-Za-z0-9_]/,$d=b([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),
ae=/^[A-Za-z0-9_.\x80-\uFFFF]/,be=b([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),ce="@",de=m("@",!1),vb="'",wb=m("'",!1),xb="N'",ke=m("N'",!1),qa="''",yb=m("''",!1),zb=/^[^']/,Ab=b(["'"],!0,!1),ne=".",oe=m(".",!1),te=/^[0-9]/,ue=b([["0","9"]],!1,!1),pe=/^[eE]/,qe=b(["e","E"],!1,!1),re=/^[+\-]/,se=b(["+","-"],!1,!1),xd="null",yd=m("NULL",!0),td="true",ud=m("TRUE",!0),vd="false",wd=m("FALSE",!0),ve="in",we=m("IN",!0),xe="is",ye=m("IS",!0),ze="like",Ae=m("LIKE",!0),fd="escape",
gd=m("ESCAPE",!0),Be="not",Ce=m("NOT",!0),De="and",Ee=m("AND",!0),Fe="or",Ge=m("OR",!0),He="between",Ie=m("BETWEEN",!0),Je="from",Ke=m("FROM",!0),Td="for",Ud=m("FOR",!0),Rd="substring",Sd=m("SUBSTRING",!0),Dd="extract",Ed=m("EXTRACT",!0),Le="trim",Me=m("TRIM",!0),Vd="position",Wd=m("POSITION",!0),Bd="timestamp",Cd=m("TIMESTAMP",!0),zd="date",Ad=m("DATE",!0),ee="leading",fe=m("LEADING",!0),ge="trailing",he=m("TRAILING",!0),ie="both",je=m("BOTH",!0),Fd="year",Gd=m("YEAR",!0),Hd="month",Id=m("MONTH",
!0),Jd="day",Kd=m("DAY",!0),Ld="hour",Md=m("HOUR",!0),Nd="minute",Od=m("MINUTE",!0),Pd="second",Qd=m("SECOND",!0),Ne="case",Oe=m("CASE",!0),Pe="end",Qe=m("END",!0),Re="when",Se=m("WHEN",!0),Te="then",Ue=m("THEN",!0),le="else",me=m("ELSE",!0),Ve=",",We=m(",",!1),Xe="(",Ye=m("(",!1),Ze=")",$e=m(")",!1),af=/^[ \t\n\r]/,bf=b([" ","\t","\n","\r"],!1,!1),Wc="`",Xc=m("`",!1),Yc=/^[^`]/,Zc=b(["`"],!0,!1),g=0,ra=[{line:1,column:1}],U=0,sa=[],v=0,Ha;if("startRule"in w){if(!(w.startRule in Eb))throw Error("Can't start parsing from rule \""+
w.startRule+'".');Fb=Eb[w.startRule]}Ha=Fb();if(Ha!==d&&g===a.length)return Ha;Ha!==d&&g<a.length&&f({type:"end"});throw function(a,b,c){return new u(u.buildMessage(a,b),a,b,c)}(sa,U<a.length?a.charAt(U):null,U<a.length?e(U,U+1):e(U,U));}}})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require","exports"],function(u,a){Object.defineProperty(a,"__esModule",{value:!0});a.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsDistance:!0,supportsDistinct:!0,
supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/tsSupport/assignHelper @dojo/framework/shim/Set ../../../core/maybe ../../../core/promiseUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils".split(" "),
function(u,a,w,m,b,c,e,f,x,t,l,p,D,A){Object.defineProperty(a,"__esModule",{value:!0});u=function(){function a(a,b,c){this.items=a;this.queryGeometry=b;this.definitionExpression=c.definitionExpression;this.geometryType=c.geometryType;this.hasM=c.hasM;this.hasZ=c.hasZ;this.objectIdField=c.objectIdField;this.spatialReference=c.spatialReference;this.fieldsMap=c.fieldsMap;this.timeInfo=c.timeInfo}Object.defineProperty(a.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0});
a.prototype.createQueryResponse=function(a){var b;b=a.outStatistics?a.outStatistics.some(function(a){return"exceedslimit"===a.statisticType})?this._createExceedsLimitQueryResponse(a):this._createStatisticsQueryResponse(a):this._createFeatureQueryResponse(a);a.returnQueryGeometry&&(f.isValid(a.outSR)&&!f.equals(this.queryGeometry.spatialReference,a.outSR)?b.queryGeometry=A.cleanFromGeometryEngine(w({spatialReference:a.outSR},p.project(this.queryGeometry,this.queryGeometry.spatialReference,a.outSR))):
b.queryGeometry=A.cleanFromGeometryEngine(w({spatialReference:a.outSR},this.queryGeometry)));return b};a.prototype.executeAttributesQuery=function(b){var e=l.getWhereClause(b.where);if(!e)return c.resolve(this);if(e.isStandardized()){for(var f=0,n=[],m=0,p=this.items;m<p.length;m++){var x=p[m];e.testFeature(x.attributes)&&(n[f++]=x)}e=new a(n,this.queryGeometry,this);e.definitionExpression=b.where;return c.resolve(e)}return c.reject(new TypeError("Where clause is not standardized"))};a.prototype.executeObjectIdsQuery=
function(b){if(!b.objectIds||!b.objectIds.length)return c.resolve(this);var e=new m.default(b.objectIds);return c.resolve(new a(this.items.filter(function(a){return e.has(a.objectId)}),this.queryGeometry,this))};a.prototype.executeTimeQuery=function(e){e=D.getTimeOperator(this.timeInfo,e.timeExtent);if(!b.isSome(e))return c.resolve(this);e=this.items.filter(e);return c.resolve(new a(e,this.queryGeometry,this))};a.prototype.project=function(b){var e=this;return!b||f.equals(this.spatialReference,b)?
c.resolve(this):p.projectMany(this.items.map(function(a){return A.getGeometry(e,a)}),this.spatialReference,b).then(function(c){for(var f=[],h=0;h<e.items.length;h++)f[h]={attributes:e.items[h].attributes,geometry:c[h]};c=[];x.convertFromFeatures(c,f,e.geometryType,e.hasZ,e.hasM,e.objectIdField);return new a(c,e.queryGeometry,{definitionExpression:e.definitionExpression,geometryType:e.geometryType,hasM:e.hasM,hasZ:e.hasZ,objectIdField:e.objectIdField,spatialReference:b,fieldsMap:e.fieldsMap,timeInfo:e.timeInfo})})};
a.prototype._createFeatureQueryResponse=function(a){var b=this,c=this.items,f=this.geometryType,l=this.hasM,m=this.hasZ,p=this.objectIdField,x=this.spatialReference,t=a.outFields,r=a.outSR,z=a.quantizationParameters,q=a.resultRecordCount,G=a.resultOffset,T=!1;null!=q&&null!=G&&(q=G+q,T=c.length>q,c=c.slice(G,Math.min(c.length,q)));return{exceededTransferLimit:T,features:this._createFeatures(a,c),fields:t&&t.map(function(a){return b.fieldsMap.get(a)}),geometryType:f,hasM:l,hasZ:m,objectIdFieldName:p,
spatialReference:A.cleanFromGeometryEngine(r?r:x),transform:z&&e.toQuantizationTransform(z)||null}};a.prototype._createFeatures=function(a,b){var c=new t.default(a,this.fieldsMap),f=a.quantizationParameters,h=a.returnGeometry,l=a.returnCentroid,m=a.maxAllowableOffset,p=a.orderByFields;a=[];var x=0;if(b.length&&p&&p.length){var p=p[0].split(" "),r=p[0],w="DESC"===p[1];b.sort(function(a,b){a=c.getFieldValue(a,r);b=c.getFieldValue(b,r);if("number"===typeof a&&"number"===typeof b)return w?b-a:a-b;if("string"===
typeof a&&"string"===typeof b)return a=a.toUpperCase(),b=b.toUpperCase(),(w?a>b:a<b)?-1:(w?a<b:a>b)?1:0})}if(h||l)if(f=e.toQuantizationTransform(f),h&&!l)for(l=0;l<b.length;l++)h=b[l],a[x++]={attributes:c.getAttributes(h),geometry:A.getGeometry(this,h,m,f)};else if(!h&&l)for(m=0;m<b.length;m++)h=b[m],a[x++]={attributes:c.getAttributes(h),centroid:A.getCentroid(this,h,f)};else for(l=0;l<b.length;l++)h=b[l],a[x++]={attributes:c.getAttributes(h),centroid:A.getCentroid(this,h,f),geometry:A.getGeometry(this,
h,m,f)};else for(m=0;m<b.length;m++)h=b[m],(h=c.getAttributes(h))&&(a[x++]={attributes:h});return a};a.prototype._createExceedsLimitQueryResponse=function(a){var b=!1,c=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,f=0;for(a=a.outStatistics;f<a.length;f++){var l=a[f];if("exceedslimit"===l.statisticType){c=null!=l.maxPointCount?l.maxPointCount:Number.POSITIVE_INFINITY;e=null!=l.maxRecordCount?l.maxRecordCount:Number.POSITIVE_INFINITY;b=null!=l.maxVertexCount?l.maxVertexCount:
Number.POSITIVE_INFINITY;break}}"esriGeometryPoint"===this.geometryType?b=this.items.length>c:this.items.length>e?b=!0:(c=this.hasZ?this.hasM?4:3:this.hasM?3:2,b=this.items.reduce(function(a,b){return a+(b.geometry&&b.geometry.coords.length||0)},0)/c>b);return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(b)}}]}};a.prototype._createStatisticsQueryResponse=function(a){var b=
new t.default(a,this.fieldsMap),c=[],e=[],f=a.groupByFieldsForStatistics,l=a.having,m=f&&f.length,f=m&&f[0],p={},x={},r={},w={attributes:{}},q=0;for(a=a.outStatistics;q<a.length;q++){var G=a[q],T=G.outStatisticFieldName,V=G.statisticType,S="exceedslimit"!==G.statisticType?G.onStatisticField:void 0,D="1"===S;if(m&&(S===f||D)&&"count"===G.statisticType){p[S]||(p[S]=this._calculateUniqueValues(b,D?f:S));var V=p[S],ia;for(ia in V){var z=V[ia],A=z.count,G=z.data,P=z.items,z=x[G]||{attributes:{}};if(!l||
b.validateItems(P,l))z.attributes[T]=A,z.attributes[D?"EXPR_1":S]=G,x[G]=z}e.push({name:T,alias:T,type:"esriFieldTypeString"})}else{if(m)for(ia in D=this._calculateUniqueValues(b,f),D){if(z=D[ia],G=z.data,P=z.items,!l||b.validateItems(P,l))z=x[G]||{attributes:{}},P=this._calculateStatistics(P,b,S),A="var"===V?"variance":V,z.attributes[T]=P[A],z.attributes[f]=G,x[G]=z}else r[S]||(r[S]=this._calculateStatistics(this.items,b,S)),P=r[S],A="var"===V?"variance":V,w.attributes[T]=P[A];e.push({name:T,alias:T,
type:"esriFieldTypeDouble"})}}if(m)for(var u in x)c.push(x[u]);else c.push(w);return{fields:e,features:c}};a.prototype._calculateStatistics=function(a,b,c){for(var e=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,h=null,k=null,l=null,m=null,r=[],p=0;p<a.length;p++){var q=b.getFieldValue(a[p],c);null==q||isNaN(q)||(h+=q,e=Math.min(e,q),f=Math.max(f,q),r.push(q))}if(a=r.length){k=h/a;for(m=l=0;m<r.length;m++)q=r[m],l+=Math.pow(q-k,2);m=1<a?l/(a-1):0;l=Math.sqrt(m)}else f=e=null;return{avg:k,count:a,
max:f,min:e,stddev:l,sum:h,variance:m}};a.prototype._calculateUniqueValues=function(a,b){for(var c={},e=0,f=this.items;e<f.length;e++){var h=f[e],l=a.getFieldValue(h,b);if(null==l||"string"===typeof l&&""===l.trim())l=null;null==c[l]?c[l]={count:1,data:l,items:[h]}:(c[l].count++,c[l].items.push(h))}return c};return a}();a.default=u})},"esri/geometry/support/quantizationUtils":function(){define(["require","exports","./jsonUtils"],function(u,a,w){function m(a,b){return Math.round((b-a.translate[0])/
a.scale[0])}function b(a,b){return Math.round((a.translate[1]-b)/a.scale[1])}function c(a,c,e){for(var f=[],h,k,q,l,r=0;r<e.length;r++){var G=e[r];if(0<r){if(q=m(a,G[0]),l=b(a,G[1]),q!==h||l!==k)f.push(c(G,q-h,l-k)),h=q,k=l}else h=m(a,G[0]),k=b(a,G[1]),f.push(c(G,h,k))}return 0<f.length?f:null}function e(a,b,e,f){return c(a,e?f?R:r:f?r:C,b)}function f(a,b,e,f){var h=[];e=e?f?R:r:f?r:C;for(f=0;f<b.length;f++){var k=c(a,e,b[f]);k&&3<=k.length&&h.push(k)}return h.length?h:null}function x(a,b,e,f){var h=
[];e=e?f?R:r:f?r:C;for(f=0;f<b.length;f++){var k=c(a,e,b[f]);k&&2<=k.length&&h.push(k)}return h.length?h:null}function t(a,b){return b*a.scale[0]+a.translate[0]}function l(a,b){return a.translate[1]-b*a.scale[1]}function p(a,b,c){var e=Array(c.length);if(!c.length)return e;var f=a.scale,h=f[0],f=f[1],k=t(a,c[0][0]);a=l(a,c[0][1]);e[0]=b(c[0],k,a);for(var q=1;q<c.length;q++){var r=c[q],k=k+r[0]*h;a-=r[1]*f;e[q]=b(r,k,a)}return e}function D(a,b,c){for(var e=Array(c.length),f=0;f<c.length;f++)e[f]=p(a,
b,c[f]);return e}function A(a,b,c,e){return p(a,c?e?R:r:e?r:C,b)}function J(a,b,c,e){return D(a,c?e?R:r:e?r:C,b)}function z(a,b,c,e){return D(a,c?e?R:r:e?r:C,b)}function h(a,b,c){var e=c[0],f=e[0],e=e[1],h=Math.min(f,b[0]),k=Math.min(e,b[1]),l=Math.max(f,b[2]);b=Math.max(e,b[3]);for(var q=1;q<c.length;q++){var r=c[q],m=r[0],r=r[1],f=f+m,e=e+r;0>m&&(h=Math.min(h,f));0<m&&(l=Math.max(l,f));0>r?k=Math.min(k,e):0<r&&(b=Math.max(b,e))}a[0]=h;a[1]=k;a[2]=l;a[3]=b;return a}function k(a,b){if(!b.length)return null;
a[0]=a[1]=Number.POSITIVE_INFINITY;a[2]=a[3]=Number.NEGATIVE_INFINITY;for(var c=0;c<b.length;c++)h(a,a,b[c]);return a}function n(a,c,e,f,h){c.xmin=m(a,e.xmin);c.ymin=b(a,e.ymin);c.xmax=m(a,e.xmax);c.ymax=b(a,e.ymax);c!==e&&(f&&(c.zmin=e.zmin,c.zmax=e.zmax),h&&(c.mmin=e.mmin,c.mmax=e.mmax));return c}function H(a,b,c,f,h){b.points=e(a,c.points,f,h);return b}function E(a,c,e,f,h){c.x=m(a,e.x);c.y=b(a,e.y);c!==e&&(f&&(c.z=e.z),h&&(c.m=e.m));return c}function B(a,b,c,e,h){a=f(a,c.rings,e,h);if(!a)return null;
b.rings=a;return b}function L(a,b,c,e,f){a=x(a,c.paths,e,f);if(!a)return null;b.paths=a;return b}Object.defineProperty(a,"__esModule",{value:!0});var C=function(a,b,c){return[b,c]},r=function(a,b,c){return[b,c,a[2]]},R=function(a,b,c){return[b,c,a[2],a[3]]};a.toQuantizationTransform=function(a){return a?{originPosition:"upperLeft",scale:[a.tolerance,a.tolerance],translate:[a.extent.xmin,a.extent.ymax]}:null};a.equals=function(a,b){if(a===b||null==a&&null==b)return!0;if(null==a||null==b)return!1;var c,
e,f,h;a&&"upperLeft"===a.originPosition?(c=a.translate[0],e=a.translate[1],a=a.scale[0]):(c=a.extent.xmin,e=a.extent.ymax,a=a.tolerance);b&&"upperLeft"===b.originPosition?(f=b.translate[0],h=b.translate[1],b=b.scale[0]):(f=b.extent.xmin,h=b.extent.ymax,b=b.tolerance);return c===f&&e===h&&a===b};a.quantizeX=m;a.quantizeY=b;a.quantizeBounds=function(a,c,e){c[0]=m(a,e[0]);c[3]=b(a,e[1]);c[2]=m(a,e[2]);c[1]=b(a,e[3]);return c};a.quantizePoints=e;a.quantizeRings=f;a.quantizePaths=x;a.hydrateX=t;a.hydrateY=
l;a.hydrateCoordsArray=p;a.hydrateCoordsArrayArray=D;a.hydrateBounds=function(a,b,c){return c?(b[0]=t(a,c[0]),b[1]=l(a,c[3]),b[2]=t(a,c[2]),b[3]=l(a,c[1]),b):[t(a,b[0]),l(a,b[3]),t(a,b[2]),l(a,b[1])]};a.hydratePoints=A;a.hydratePaths=J;a.hydrateRings=z;a.getQuantizedBoundsCoordsArray=h;a.getQuantizedBoundsCoordsArrayArray=k;a.getQuantizedBoundsPoints=function(a){var b=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return h(b,b,a)};a.getQuantizedBoundsPaths=
function(a){return k([0,0,0,0],a)};a.getQuantizedBoundsRings=function(a){return k([0,0,0,0],a)};a.quantizeExtent=n;a.quantizeMultipoint=H;a.quantizePoint=E;a.quantizePolygon=B;a.quantizePolyline=L;a.quantizeGeometry=function(a,b){return a&&b?w.isPoint(b)?E(a,{},b,!1,!1):w.isPolyline(b)?L(a,{},b,!1,!1):w.isPolygon(b)?B(a,{},b,!1,!1):w.isMultipoint(b)?H(a,{},b,!1,!1):w.isExtent(b)?n(a,{},b,!1,!1):null:null};a.hydrateExtent=function(a,b,c,e,f){b.xmin=t(a,c.xmin);b.ymin=l(a,c.ymin);b.xmax=t(a,c.xmax);
b.ymax=l(a,c.ymax);b!==c&&(e&&(b.zmin=c.zmin,b.zmax=c.zmax),f&&(b.mmin=c.mmin,b.mmax=c.mmax));return b};a.hydrateMultipoint=function(a,b,c,e,f){b.points=A(a,c.points,e,f);return b};a.hydratePoint=function(a,b,c,e,f){b.x=t(a,c.x);b.y=l(a,c.y);b!==c&&(e&&(b.z=c.z),f&&(b.m=c.m));return b};a.hydratePolygon=function(a,b,c,e,f){b.rings=z(a,c.rings,e,f);return b};a.hydratePolyline=function(a,b,c,e,f){b.paths=J(a,c.paths,e,f);return b}})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["require",
"exports","@dojo/framework/shim/Map","./attributeSupport"],function(u,a,w,m){Object.defineProperty(a,"__esModule",{value:!0});u=function(){function a(a,b){this._fieldDataCache=new w.default;this._returnDistinctMap=new w.default;this.returnDistinctValues=a.returnDistinctValues;this.fieldsMap=b;if((a=a.outFields)&&-1===a.indexOf("*")){this.outFields=a;for(var c=b=0;c<a.length;c++){var e=a[c],t=m.getExpressionFromFieldName(e),l=this.fieldsMap.has(t),t=l?null:m.getWhereClause(t),l=l?this.fieldsMap.get(e).name:
m.getAliasFromFieldName(e)||"FIELD_EXP_"+b++;this._fieldDataCache.set(e,{alias:l,clause:t})}}}a.prototype.getAttributes=function(a){a=a.attributes;a=this._processAttributesForOutFields(a);return a=this._processAttributesForDistinctValues(a)};a.prototype.getFieldValue=function(a,b){a=a.attributes;var c=this.fieldsMap.has(b),e=c?this.fieldsMap.get(b).name:b,t=null;this._fieldDataCache.has(e)?t=this._fieldDataCache.get(e).clause:c||(t=m.getWhereClause(b),this._fieldDataCache.set(e,{alias:e,clause:t}));
return c?a[e]:t.calculateValue(a)};a.prototype.validateItem=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:m.getWhereClause(b)});return this._fieldDataCache.get(b).clause.testFeature(a.attributes)};a.prototype.validateItems=function(a,b){var c=this;this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:m.getWhereClause(b)});a=a.map(function(a){return c.getAttributes(a)});return this._fieldDataCache.get(b).clause.testSet(a)};a.prototype._processAttributesForOutFields=
function(a){var b=this.outFields;if(!a||!b||!b.length)return a;for(var c={},m=0;m<b.length;m++){var t=this._fieldDataCache.get(b[m]),l=t.alias,t=t.clause;c[l]=t?t.calculateValue(a):a[l]}return c};a.prototype._processAttributesForDistinctValues=function(a){if(!a||!this.returnDistinctValues)return a;var b=this.outFields,c=[];if(b)for(var m=0;m<b.length;m++){var t=this._fieldDataCache.get(b[m]).alias;c.push(a[t])}else for(t in a)c.push(a[t]);b=(b||["*"]).join(",")+"\x3d"+c.join(",");c=this._returnDistinctMap.get(b)||
0;this._returnDistinctMap.set(b,++c);return 1<c?null:a};return a}();a.default=u})},"esri/layers/graphics/data/timeSupport":function(){define(["require","exports"],function(u,a){function w(a,c,e,f){if(null!=e&&null!=f&&e===f)return function(b){return e>=b.attributes[a]&&e<=b.attributes[c]};if(null!=e&&null!=f)return function(b){return!(b.attributes[a]>f||b.attributes[c]<e)};if(null!=e)return function(a){return!(a.attributes[c]<e)};if(null!=f)return function(b){return!(b.attributes[a]>f)}}function m(a,
c,e){if(null!=c&&null!=e&&c===e)return function(b){return b.attributes[a]===c};if(null!=c&&null!=e)return function(b){return b.attributes[a]>=c&&b.attributes[a]<=e};if(null!=c)return function(b){return b.attributes[a]>=c};if(null!=e)return function(b){return b.attributes[a]<=e}}Object.defineProperty(a,"__esModule",{value:!0});a.getTimeExtent=function(a,c){if(!a)return null;var b=a.startTimeField,f=a.endTimeField,m=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY;if(b&&f)c.forEach(function(a){var c=
a.attributes;a=c[b];c=c[f];null==a||isNaN(a)||(m=Math.min(m,a));null==c||isNaN(c)||(t=Math.max(t,c))});else{var l=b||f;c.forEach(function(a){a=a.attributes[l];null==a||isNaN(a)||(m=Math.min(m,a),t=Math.max(t,a))})}return{start:m,end:t}};a.getTimeOperator=function(a,c){if(!c||!a)return null;var b=a.startTimeField;a=a.endTimeField;if(!b&&!a)return null;var f=c.start;c=c.end;return null==f&&null==c?null:b&&a?w(b,a,f,c):m(b||a,f,c)}})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/kebabDictionary ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),
function(u,a,w,m,b,c,e,f,x,t,l,p,D,A,J,z){function h(b,c,e){return m(this,void 0,void 0,function(){var h,l,r,m,q;return w(this,function(n){switch(n.label){case 0:if(!b)return[2,null];h=b.where;b.where=h=h&&h.trim();if(!h||/^1 *= *1$/.test(h)||c&&c===h)b.where=null;return b.geometry?[4,k(b)]:[2,b];case 1:return l=n.sent(),b.distance=0,b.units=null,"esriSpatialRelEnvelopeIntersects"===b.spatialRel&&(r=b.geometry.spatialReference,l=f.getGeometryExtent(l),l.spatialReference=r),b.geometry=l,[4,J.checkProjectionSupport(l.spatialReference,
e)];case 2:return n.sent(),[4,t.normalizeCentralMeridian(x.fromJSON(l))];case 3:return m=n.sent(),[4,J.project(m[0].toJSON(),m[0].spatialReference,e)];case 4:q=n.sent();if(!q)throw a.QUERY_ENGINE_EMPTY_RESULT;q.spatialReference=e;b.geometry=q;return[2,b]}})})}function k(a){var b=a.geometry,f=a.distance,h=a.units;if(null==f)return c.resolve(b);a=b.spatialReference;var k=h&&n.fromJSON(h)||e.getUnitString(a),h=null,h=a&&(l.isGeographic(a)||l.isWebMercator(a))?c.resolve(b):J.checkProjectionSupport(a,
l.WGS84).then(function(){return J.project(b,l.WGS84)});return h.then(function(a){return z.getGeodesicBufferOperator().then(function(b){return b(a,f,k).toJSON()})})}Object.defineProperty(a,"__esModule",{value:!0});var n=new b.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});a.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var H=new A.default,
E=new A.default,B={esriGeometryPoint:D.convertToPoint,esriGeometryPolyline:D.convertToPolyline,esriGeometryPolygon:D.convertToPolygon,esriGeometryMultipoint:D.convertToMultipoint};a.getCentroid=function(a,b,c){if("esriGeometryPolygon"!==a.geometryType||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=p.getCentroidOptimizedGeometry(new A.default,b.geometry,a.hasZ,a.hasM));return c?(b=D.quantizeOptimizedGeometry(E,b.centroid,a.hasZ,a.hasM,"esriGeometryPoint",c),D.convertToPoint(b,a.hasZ,
a.hasM)):D.convertToPoint(b.centroid,a.hasZ,a.hasM)};a.getGeometry=function(a,b,c,e){b="coords"in b?b:b.geometry;return b?c?(c=D.generalizeOptimizedGeometry(H,b,a.hasZ,a.hasM,a.geometryType,c),e&&(c=D.quantizeOptimizedGeometry(E,c,a.hasZ,a.hasM,a.geometryType,e)),B[a.geometryType](c,a.hasZ,a.hasM)):e?(c=D.quantizeOptimizedGeometry(E,b,a.hasZ,a.hasM,a.geometryType,e),B[a.geometryType](c,a.hasZ,a.hasM)):B[a.geometryType](b,a.hasZ,a.hasM):null};a.normalizeQuery=function(a,b,c){return m(this,void 0,void 0,
function(){var e,f,k,l,m;return w(this,function(q){e=a.outFields;f=a.orderByFields;k=a.groupByFieldsForStatistics;l=a.outStatistics;if(e)for(m=0;m<e.length;m++)e[m]=e[m].trim();if(f)for(m=0;m<f.length;m++)f[m]=f[m].trim();if(k)for(m=0;m<k.length;m++)k[m]=k[m].trim();if(l)for(m=0;m<l.length;m++)l[m].onStatisticField&&(l[m].onStatisticField=l[m].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,h(a,b,c)]})})};a.normalizeFilter=function(a,b,c){return m(this,
void 0,void 0,function(){return w(this,function(e){return[2,h(a,b,c)]})})};a.cleanFromGeometryEngine=function(a){return a&&L in a?JSON.parse(JSON.stringify(a,C)):a};var L="_geVersion",C=function(a,b){return a!==L?b:void 0}})},"esri/layers/graphics/centroid":function(){define(["require","exports","./utils"],function(u,a,w){function m(a,b,f,m,t,l){l=w.getStride(t,l);var c=f,e=f+l,x=0,u=0,z=f=0,h=0,k=0;for(--m;k<m;k++,c+=l,e+=l){var n=b[c],H=b[c+1],E=b[c+2],B=b[e],L=b[e+1],C=b[e+2],r=n*L-B*H,z=z+r,x=
x+(n+B)*r,u=u+(H+L)*r;t&&(r=n*C-B*E,f+=(E+C)*r,h+=r);n<a[0]&&(a[0]=n);n>a[1]&&(a[1]=n);H<a[2]&&(a[2]=H);H>a[3]&&(a[3]=H);t&&(E<a[4]&&(a[4]=E),E>a[5]&&(a[5]=E))}0<z&&(z*=-1);0<h&&(h*=-1);if(!z)return null;a=[x,u,.5*z];t&&(a[3]=f,a[4]=.5*h);return a}function b(a,b,f,m,t){t=w.getStride(m,t);for(var c=b,e=b+t,x=0,A=0,u=0,z=0,h=0,k=f-1;h<k;h++,c+=t,e+=t){var n=a[c],H=a[c+1],E=a[c+2],B=a[e],L=a[e+1],C=a[e+2],r;if(m){r=B-n;var R=L-H,q=C-E;r=Math.sqrt(r*r+R*R+q*q)}else r=B-n,R=L-H,r=Math.sqrt(r*r+R*R);r&&
(x+=r,m?(n=[n+.5*(B-n),H+.5*(L-H),E+.5*(C-E)],A+=r*n[0],u+=r*n[1],z+=r*n[2]):(n=[n+.5*(B-n),H+.5*(L-H)],A+=r*n[0],u+=r*n[1]))}return 0<x?m?[A/x,u/x,z/x]:[A/x,u/x]:0<f?m?[a[b],a[b+1],a[b+2]]:[a[b],a[b+1]]:null}Object.defineProperty(a,"__esModule",{value:!0});a.getCentroidOptimizedGeometry=function(a,e,f,x){if(!e||!e.lengths.length)return null;a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);for(var c=a.coords,l=[],p=f?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,
Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],D=e.lengths,A=e.coords,u=w.getStride(f,x),z=0,h=0;h<D.length;h++){var k=D[h],n=m(p,A,z,k,f,x);n&&l.push(n);z+=k*u}l.sort(function(a,b){var c=a[2]-b[2];0===c&&f&&(c=a[4]-b[4]);return c});l.length&&(u=6*l[0][2],c[0]=l[0][0]/u,c[1]=l[0][1]/u,f&&(u=6*l[0][4],c[2]=0!==u?l[0][3]/u:0),c[0]<p[0]||c[0]>p[1]||c[1]<p[2]||c[1]>p[3]||
f&&(c[2]<p[4]||c[2]>p[5]))&&(c.length=0);if(!c.length)if(e=e.lengths[0]?b(A,0,D[0],f,x):null)c[0]=e[0],c[1]=e[1],f&&2<e.length&&(c[2]=e[2]);else return null;return a};a.lineCentroid=b})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(u,a,w,m,b,c,e,f,x,t,l,p,D){function A(){return m.create(function(a){return u(["../../../geometry/geometryEngine"],a)})}Object.defineProperty(a,"__esModule",{value:!0});var J={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},
z={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},h={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},k={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};
a.importGeometryEngine=A;a.getGeodesicBufferOperator=function(){return A().then(function(a){return a.geodesicBuffer})};a.getSpatialQueryOperator=function(a,f,h){if(e.isPolygon(f)&&"esriGeometryPoint"===h.geometryType&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a)){var k=t.convertFromPolygon(new l.default,f,!1,!1);return m.resolve(function(a){return x.polygonContainsPoint(k,!1,!1,a)})}if(e.isPolygon(f)&&"esriGeometryMultipoint"===h.geometryType){var n=t.convertFromPolygon(new l.default,
f,!1,!1);if("esriSpatialRelContains"===a)return m.resolve(function(a){return x.polygonContainsMultipoint(n,!1,!1,a,h.hasZ,h.hasM)})}if(e.isExtent(f)&&"esriGeometryPoint"===h.geometryType&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a))return m.resolve(function(a){return b.extentContainsPoint(f,D.getGeometry(h,a))});if(e.isExtent(f)&&"esriGeometryMultipoint"===h.geometryType&&"esriSpatialRelContains"===a)return m.resolve(function(a){return b.extentContainsMultipoint(f,D.getGeometry(h,
a))});if(e.isExtent(f)&&"esriSpatialRelIntersects"===a){var p=c.getExtentIntersector(h.geometryType);return m.resolve(function(a){return p(f,D.getGeometry(h,a))})}return A().then(function(b){var c=b[J[a]].bind(null,f);return function(a){return c(D.getGeometry(h,a))}})};a.checkSpatialQuerySupport=function(a,b,c){var l=a.spatialRel,n=a.geometry;return n?!0!==z[l]?m.reject(new w("feature-store:unsupported-query","Unsupported query spatial relationship",{query:a})):f.isValid(n.spatialReference)&&f.isValid(c)?
!0!==h[e.getJsonType(n)]?m.reject(new w("feature-store:unsupported-query","Unsupported query geometry type",{query:a})):!0!==k[b]?m.reject(new w("feature-store:unsupported-query","Unsupported layer geometry type",{query:a})):a.outSR?p.checkProjectionSupport(a.geometry&&a.geometry.spatialReference,a.outSR):m.resolve():m.resolve():m.resolve()};a.canQueryWithRBush=function(a){if(e.isExtent(a))return!0;if(e.isPolygon(a)){var b=0;for(a=a.rings;b<a.length;b++){var c=a[b];if(5!==c.length||c[0][0]!==c[1][0]||
c[0][0]!==c[4][0]||c[2][0]!==c[3][0]||c[0][1]!==c[3][1]||c[0][1]!==c[4][1]||c[1][1]!==c[2][1])return!1}return!0}return!1}})},"esri/layers/graphics/contains":function(){define(["require","exports","./utils"],function(u,a,w){function m(a,c,e,f,m){if(!a)return!1;c=w.getStride(c,e);e=a.coords;var b=!1,l=0,p=0;for(a=a.lengths;p<a.length;p++){for(var x=a[p],A=l,u=l,z=l+x*c;u<z;u+=c){A=u+c;A===z&&(A=l);var h=e[u],k=e[u+1],n=e[A],A=e[A+1];(k<m&&A>=m||A<m&&k>=m)&&h+(m-k)/(A-k)*(n-h)<f&&(b=!b)}l+=x*c}return b}
Object.defineProperty(a,"__esModule",{value:!0});a.polygonContainsPoint=function(a,c,e,f){return m(a,c,e,f.coords[0],f.coords[1])};a.polygonContainsMultipoint=function(a,c,e,f,x,t){x=w.getStride(x,t);t=f.coords;f=f.lengths;if(!f)return!1;for(var b=0,p=0;b<f.length;b++,p+=x)if(!m(a,c,e,t[p],t[p+1]))return!1;return!0};a.polygonContainsCoords=m})},"esri/layers/support/PromiseQueue":function(){define(["require","exports","dojo/errors/CancelError","../../core/promiseUtils"],function(u,a,w,m){Object.defineProperty(a,
"__esModule",{value:!0});u=function(){function a(){this._deferreds=[];this._values=[]}a.prototype.push=function(a){var b=this;return m.create(function(c,e){b._deferreds.push({resolve:c,reject:e});b._values.push(a)})};a.prototype.unshift=function(a){var b=this;return m.create(function(c,e){b._deferreds.unshift({resolve:c,reject:e});b._values.unshift(a)})};Object.defineProperty(a.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,configurable:!0});a.prototype.process=function(){if(0===
this.length)return!1;this._deferreds.shift().resolve(this._values.shift());return!0};a.prototype.cancelAll=function(){for(var a=new w,b=0,f=this._deferreds;b<f.length;b++)f[b].reject(a);this._deferreds.length=0;this._values.length=0};return a}();a.PromiseQueue=u})},"esri/layers/graphics/sources/support/clientSideDefaults":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","../../../../core/has","../../../../core/lang"],function(u,a,w,m,b){Object.defineProperty(a,"__esModule",
{value:!0});var c={type:"esriSMS",style:"esriSMSCircle",size:6,color:[252,146,31,255],outline:{width:.75,color:[153,153,153,255]}},e={type:"esriSLS",style:"esriSLSSolid",width:1,color:[252,146,31,255]},f={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{width:.75,color:[255,255,255,191]}};a.createDrawingInfo=function(a){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===a||"esriGeometryMultipoint"===a?c:"esriGeometryPolyline"===a?e:f}}};a.createDefaultAttributesFunction=
function(a,b){if(m("csp-restrictions"))return function(){var c;return w((c={},c[b]=null,c),a)};try{var c="this."+b+" \x3d null;",e;for(e in a)c+="this."+e+" \x3d "+JSON.stringify(a[e])+";";var f=new Function(c);return function(){return new f}}catch(A){return function(){var c;return w((c={},c[b]=null,c),a)}}};a.createDefaultTemplate=function(a){void 0===a&&(a={});return[{name:"New Feature",description:"",prototype:{attributes:b.clone(a)}}]}})},"*noref":1}});
define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/promiseUtils ../../../../geometry/support/jsonUtils ../../../../geometry/support/spatialReferenceUtils ../../featureConversionUtils ../../data/FeatureStore ../../data/projectionSupport ../../data/QueryEngine ./clientSideDefaults ../../../support/fieldType ../../../support/fieldUtils".split(" "),function(u,a,w,m,b,c,e,f,x,t,l,p,D,A,J){function z(a){return e.isPoint(a)?
null!=a.z:!!a.hasZ}function h(a){return e.isPoint(a)?null!=a.m:!!a.hasM}Object.defineProperty(a,"__esModule",{value:!0});var k=f.WGS84,n={xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:f.WGS84},H={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,
supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}},E=function(){return function(){this.description=this.code=null}}(),B=function(){return function(a){this.error=new E;this.objectId=this.globalId=null;this.success=!1;this.uniqueId=null;this.error.description=a}}(),L=function(){return function(a){this.globalId=
null;this.success=!0;this.objectId=this.uniqueId=a}}();u=function(){function a(){this._nextObjectId=this._queryEngine=null;this._fieldsMap=new Map}a.prototype.destroy=function(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy();this._queryEngine=this._requiredFieldNames=this._fieldsMap=this._createDefaultAttributes=null};a.prototype.load=function(a){var e=this,f=[],h=a.features,r=this._inferLayerProperties(h,a.fields),x=a.fields||[],w=null!=a.hasM?a.hasM:r.hasM,z=null!=a.hasZ?a.hasZ:
r.hasZ,u=!a.spatialReference&&!r.spatialReference,B=u?k:a.spatialReference||r.spatialReference,E=u?n:null,C=a.geometryType||r.geometryType,Q=a.objectIdField||r.objectIdField;a=a.timeInfo;u&&f.push({type:"feature-layer:spatial-reference-not-found",message:"Spatial reference not provided or found in features. Defaults to WGS84"});if(!C)return c.reject(new b("feature-layer:missing-property","geometryType not set and couldn't be inferred from the provided features"));if(!Q)return c.reject(new b("feature-layer:missing-property",
"objectIdField not set and couldn't be found in the provided fields"));r.objectIdField&&Q!==r.objectIdField&&(f.push({type:"feature-layer:duplicated-oid-field",message:'Provided objectIdField "'+Q+'" doesn\'t match the field name "'+r.objectIdField+'", found in the provided fields'}),Q=r.objectIdField);if(Q&&!r.objectIdField){var L=null;x.some(function(a){return a.name===Q?(L=a,!0):!1})?(L.type="esriFieldTypeOID",L.editable=!1,L.nullable=!1):x.unshift({alias:Q,name:Q,type:"esriFieldTypeOID",editable:!1,
nullable:!1})}for(r=0;r<x.length;r++){u=x[r];null==u.name&&(u.name=u.alias);null==u.alias&&(u.alias=u.name);if(!u.name)return c.reject(new b("feature-layer:invalid-field-name","field name is missing",{field:u}));u.name===Q&&(u.type="esriFieldTypeOID");if(-1===A.kebabDict.jsonValues.indexOf(u.type))return c.reject(new b("feature-layer:invalid-field-type",'invalid type for field "'+u.name+'"',{field:u}))}r={};this._requiredFieldNames=[];for(var Z=0;Z<x.length;Z++){u=x[Z];if("esriFieldTypeOID"!==u.type&&
"esriFieldTypeGlobalID"!==u.type){u.editable=null==u.editable?!0:!!u.editable;u.nullable=null==u.nullable?!0:!!u.nullable;var na=J.getFieldDefaultValue(u);u.nullable||void 0!==na?r[u.name]=na:this._requiredFieldNames.push(u.name)}this._fieldsMap.set(u.name.trim(),u);this._fieldsMap.set(u.name.trim().toLowerCase(),u)}this._createDefaultAttributes=D.createDefaultAttributesFunction(r,Q);a&&(a.startTimeField&&((u=this._fieldsMap.get(a.startTimeField.toLowerCase()))?(a.startTimeField=u.name,u.type="esriFieldTypeDate"):
a.startTimeField=null),a.endTimeField&&((u=this._fieldsMap.get(a.endTimeField.toLowerCase()))?(a.endTimeField=u.name,u.type="esriFieldTypeDate"):a.endTimeField=null),a.trackIdField&&((u=this._fieldsMap.get(a.trackIdField.toLowerCase()))?a.trackIdField=u.name:(a.trackIdField=null,f.push({type:"feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:a}}))),a.startTimeField||a.endTimeField||(f.push({type:"feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing or invalid",
details:{timeInfo:a}}),a=null));var Y={warnings:f,featureErrors:[],layerDefinition:m({},H,{drawingInfo:D.createDrawingInfo(C),templates:D.createDefaultTemplate(r),extent:E,geometryType:C,objectIdField:Q,fields:x,hasZ:!!z,hasM:!!w,timeInfo:a}),assignedObjectIds:{}};this._queryEngine=new p.default({fields:x,geometryType:C,hasM:w,hasZ:z,objectIdField:Q,spatialReference:B,featureStore:new t.default({geometryType:C,hasM:w,hasZ:z}),timeInfo:a});if(!h||!h.length)return this._nextObjectId=1,c.resolve(Y);
this._nextObjectId=1+h.reduce(function(a,b){b=b.attributes&&b.attributes[Q];return null==b||isNaN(b)||!isFinite(b)?a:Math.max(a,b)},0);return l.checkProjectionSupport(h,B).then(function(){return e._loadInitialFeatures(Y,h)})};a.prototype.applyEdits=function(a){var b=this,c=this._queryEngine.spatialReference;return l.checkProjectionSupport(a.adds,c).then(function(){return l.checkProjectionSupport(a.updates,c)}).then(function(){return b._applyEdits(a)})};a.prototype.queryFeatures=function(a){return this._queryEngine.executeQuery(a)};
a.prototype.queryFeatureCount=function(a){return this._queryEngine.executeQueryForCount(a)};a.prototype.queryObjectIds=function(a){return this._queryEngine.executeQueryForIds(a)};a.prototype.queryExtent=function(a){return this._queryEngine.executeQueryForExtent(a)};a.prototype._inferLayerProperties=function(a,b){for(var c=void 0,f=void 0,k=null,l=null,m=null,n=0;n<a.length;n++){var r=a[n].geometry;if(r&&(k||(k=e.getJsonType(r)),l||(l=r.spatialReference),null==c&&(c=z(r)),null==f&&(f=h(r)),k&&l&&null!=
c&&null!=f))break}if(b&&b.length){var p=null;b.some(function(a){var b="esriFieldTypeOID"===a.type,c=!a.type&&a.name&&"objectid"===a.name.toLowerCase();p=a;return b||c})&&(m=p.name)}return{geometryType:k,spatialReference:l,objectIdField:m,hasM:f,hasZ:c}};a.prototype._loadInitialFeatures=function(a,b){for(var c=this._queryEngine,f=c.geometryType,h=c.hasM,k=c.hasZ,m=c.objectIdField,n=c.spatialReference,c=c.featureStore,p=[],r=0;r<b.length;r++){var t=b[r];null!=t.uid&&(a.assignedObjectIds[t.uid]=-1);
if(t.geometry&&f!==e.getJsonType(t.geometry))a.featureErrors.push(new B("Incorrect geometry type."));else{var u=this._createDefaultAttributes(),w=this._mixAttributes(u,t.attributes,!0);w?a.featureErrors.push(w):(this._assignObjectId(u,t.attributes,!0),t.attributes=u,null!=t.uid&&(a.assignedObjectIds[t.uid]=t.attributes[m]),t.geometry&&(t.geometry=l.project(t.geometry,t.geometry.spatialReference,n)),p.push(t))}}c.addMany(x.convertFromFeatures([],p,f,k,h,m));a.layerDefinition.extent=this._queryEngine.fullExtent;
a.layerDefinition.timeInfo&&(b=this._queryEngine.timeExtent,a.layerDefinition.timeInfo.timeExtent=[b.start,b.end]);return a};a.prototype._applyEdits=function(a){var b=a.adds,c=a.updates;a=a.deletes;var e={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};b&&b.length&&this._applyAddEdits(e,b);c&&c.length&&this._applyUpdateEdits(e,c);if(a&&a.length){for(b=0;b<a.length;b++)e.deleteResults.push(new L(a[b]));this._queryEngine.featureStore.removeManyById(a)}return{fullExtent:this._queryEngine.fullExtent,
featureEditResults:e}};a.prototype._applyAddEdits=function(a,b){for(var c=a.addResults,f=this._queryEngine,h=f.geometryType,k=f.hasM,m=f.hasZ,n=f.objectIdField,p=f.spatialReference,f=f.featureStore,r=[],t=0;t<b.length;t++){var u=b[t];if(u.geometry&&h!==e.getJsonType(u.geometry))c.push(new B("Incorrect geometry type."));else{var w=this._createDefaultAttributes(),z=this._mixAttributes(w,u.attributes);z?c.push(z):(this._assignObjectId(w,u.attributes),u.attributes=w,null!=u.uid&&(a.uidToObjectId[u.uid]=
u.attributes[n]),u.geometry&&(u.geometry=l.project(u.geometry,u.geometry.spatialReference,p)),r.push(u),c.push(new L(u.attributes[n])))}}f.addMany(x.convertFromFeatures([],r,h,m,k,n))};a.prototype._applyUpdateEdits=function(a,b){a=a.updateResults;for(var c=this._queryEngine,f=c.geometryType,h=c.hasM,k=c.hasZ,m=c.objectIdField,n=c.spatialReference,c=c.featureStore,p=0;p<b.length;p++){var r=b[p],t=r.attributes,u=r.geometry,r=t&&t[m];if(null==r)a.push(new B("Identifier field "+m+" missing"));else if(c.has(r)){var w=
x.convertToFeature(c.getFeature(r),f,k,h);if(u){if(f!==e.getJsonType(u)){a.push(new B("Incorrect geometry type."));continue}w.geometry=l.project(u,u.spatialReference,n)}if(t&&(t=this._mixAttributes(w.attributes,t))){a.push(t);continue}c.add(x.convertFromFeature(w,f,k,h,m));a.push(new L(r))}else a.push(new B("Feature with object id "+r+" missing"))}};a.prototype._assignObjectId=function(a,b,c){void 0===c&&(c=!1);var e=this._queryEngine.objectIdField;c?b&&isFinite(b[e])?a[e]=b[e]:a[e]=this._nextObjectId++:
a[e]=this._nextObjectId++};a.prototype._mixAttributes=function(a,b,c){void 0===c&&(c=!1);for(var e in b){var f=J.sanitizeNullFieldValue(b[e]),h=this._fieldsMap.get(e)||this._fieldsMap.get(e.toLowerCase());if(h&&(c||h.editable)){var k=J.validateFieldValue(h,f);if(k)return new B(J.validationErrorToString(k,h,f));a[h.name]=f}}b=0;for(c=this._requiredFieldNames;b<c.length;b++)if(e=c[b],void 0===a[e])return new B('missing required field "'+e+'"');return null};return a}();a.default=u});