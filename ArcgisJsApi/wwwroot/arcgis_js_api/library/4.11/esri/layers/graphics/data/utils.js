// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/kebabDictionary ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),function(J,k,p,q,y,v,z,A,B,C,m,D,f,r,n,E){function w(a,
b,e){return q(this,void 0,void 0,function(){var d,g,f,h,c;return p(this,function(l){switch(l.label){case 0:if(!a)return[2,null];d=a.where;a.where=d=d&&d.trim();if(!d||/^1 *= *1$/.test(d)||b&&b===d)a.where=null;return a.geometry?[4,F(a)]:[2,a];case 1:return g=l.sent(),a.distance=0,a.units=null,"esriSpatialRelEnvelopeIntersects"===a.spatialRel&&(f=a.geometry.spatialReference,g=A.getGeometryExtent(g),g.spatialReference=f),a.geometry=g,[4,n.checkProjectionSupport(g.spatialReference,e)];case 2:return l.sent(),
[4,C.normalizeCentralMeridian(B.fromJSON(g))];case 3:return h=l.sent(),[4,n.project(h[0].toJSON(),h[0].spatialReference,e)];case 4:c=l.sent();if(!c)throw k.QUERY_ENGINE_EMPTY_RESULT;c.spatialReference=e;a.geometry=c;return[2,a]}})})}function F(a){var b=a.geometry,e=a.distance,d=a.units;if(null==e)return v.resolve(b);a=b.spatialReference;var g=d&&G.fromJSON(d)||z.getUnitString(a),d=null,d=a&&(m.isGeographic(a)||m.isWebMercator(a))?v.resolve(b):n.checkProjectionSupport(a,m.WGS84).then(function(){return n.project(b,
m.WGS84)});return d.then(function(a){return E.getGeodesicBufferOperator().then(function(b){return b(a,e,g).toJSON()})})}Object.defineProperty(k,"__esModule",{value:!0});var G=new y.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});k.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var H=new r.default,t=new r.default,u={esriGeometryPoint:f.convertToPoint,
esriGeometryPolyline:f.convertToPolyline,esriGeometryPolygon:f.convertToPolygon,esriGeometryMultipoint:f.convertToMultipoint};k.getCentroid=function(a,b,e){if("esriGeometryPolygon"!==a.geometryType||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=D.getCentroidOptimizedGeometry(new r.default,b.geometry,a.hasZ,a.hasM));return e?(b=f.quantizeOptimizedGeometry(t,b.centroid,a.hasZ,a.hasM,"esriGeometryPoint",e),f.convertToPoint(b,a.hasZ,a.hasM)):f.convertToPoint(b.centroid,a.hasZ,a.hasM)};
k.getGeometry=function(a,b,e,d){b="coords"in b?b:b.geometry;return b?e?(e=f.generalizeOptimizedGeometry(H,b,a.hasZ,a.hasM,a.geometryType,e),d&&(e=f.quantizeOptimizedGeometry(t,e,a.hasZ,a.hasM,a.geometryType,d)),u[a.geometryType](e,a.hasZ,a.hasM)):d?(e=f.quantizeOptimizedGeometry(t,b,a.hasZ,a.hasM,a.geometryType,d),u[a.geometryType](e,a.hasZ,a.hasM)):u[a.geometryType](b,a.hasZ,a.hasM):null};k.normalizeQuery=function(a,b,e){return q(this,void 0,void 0,function(){var d,g,f,h,c;return p(this,function(k){d=
a.outFields;g=a.orderByFields;f=a.groupByFieldsForStatistics;h=a.outStatistics;if(d)for(c=0;c<d.length;c++)d[c]=d[c].trim();if(g)for(c=0;c<g.length;c++)g[c]=g[c].trim();if(f)for(c=0;c<f.length;c++)f[c]=f[c].trim();if(h)for(c=0;c<h.length;c++)h[c].onStatisticField&&(h[c].onStatisticField=h[c].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,w(a,b,e)]})})};k.normalizeFilter=function(a,b,e){return q(this,void 0,void 0,function(){return p(this,function(d){return[2,
w(a,b,e)]})})};k.cleanFromGeometryEngine=function(a){return a&&x in a?JSON.parse(JSON.stringify(a,I)):a};var x="_geVersion",I=function(a,b){return a!==x?b:void 0}});