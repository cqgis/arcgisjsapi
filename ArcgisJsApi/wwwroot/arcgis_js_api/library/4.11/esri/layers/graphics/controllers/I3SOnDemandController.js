// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/errors/CancelError ../../../core/Accessor ../../../core/arrayUtils ../../../core/Evented ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../support/PromiseQueue ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/support/index ../../../views/3d/support/projectionUtils".split(" "),
function(l,Q,z,e,m,A,B,C,D,E,F,G,H,n,I,d,t,p,J,K,L,M,N,q,u,O,P,w){function r(d,b){return d.length===b.length&&d.every(function(a){return 0<=v(b,a.name)})}function v(d,b){b=b.toLowerCase();for(var a=0;a<d.length;a++)if(d[a].name.toLowerCase()===b)return a;return-1}function x(d){return null!=d&&null!=d.loadedAttributes&&null!=d.attributeData}var h=F.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");l=function(l){function b(a){a=l.call(this)||this;a.screenSizeFactor=0;a.featureTarget=
5E4;a.fixedFeatureTarget=!1;a.updating=!0;a.updatingPercentage=0;a.leafsReached=!1;a.uncompressedTextureDownsamplingEnabled=!1;a._featureLOD=1;a._stableFeatureLOD=!1;a._isIdle=!1;a._cameraDirty=!0;a._invisibleDirty=!1;a._downloadingNodes=new Set;a._loadingNodes=new Set;a._updatingNodes=new Map;a._progressMaxNumNodes=1;a._poi=p.vec3f64.create();a._requiredAttributesDirty=!0;a._updatesDisabled=!1;a.disableIDBCache=!1;a.disableMemCache=!1;a._restartNodeLoading=!1;a._fields=null;a._attributeStorageInfo=
null;a._handles=new D;a._idleQueue=new K.PromiseQueue;a._errorCount=0;return a}z(b,l);Object.defineProperty(b.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isGraphics3D",{get:function(){return"points"===this.layer.profile},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.getStreamDataSupplier(P.ClientType.SCENE,
{trackRequests:!0})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"crsVertex",{get:function(){return u.getVertexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"crsIndex",{get:function(){return u.getIndexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rootNodeVisible",{get:function(){var a=this._rootNodeId&&this.getNode(this._rootNodeId);return a&&this._viewportQueries?(this._updateViewData(),this._viewportQueries.isNodeVisible(a)):
!0},enumerable:!0,configurable:!0});b.prototype.initialize=function(){var a=this;this._lodHandling=new N(this.layerView,function(){return a.updatingChanged()});var c=this.layerView.layer;this.layer=c;this._defaultGeometrySchema=c.store.defaultGeometrySchema;this._rootNodeUrl=c.store.rootNode;var b=this._rootNodeUrl.split("/");this._rootNodeId=b[b.length-1];this.disableIDBCache=E("disable-feature:idb-cache");"fields"in c&&(this._fields=c.fields,this._attributeStorageInfo=c.attributeStorageInfo);c=
n.all([this.layer.when(),this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){var c=a.layerView.view;a.setClippingArea(c.clippingArea);a._centerOnSurface=c.pointsOfInterest.centerOnSurfaceFrequent;var b=a.layerView.view.resourceController;a._handles.add([a._centerOnSurface.watch("renderLocation",function(){return a._pointOfInterestChanged()}),b.memoryController.events.on("quality-changed",function(){return a._setCameraDirty()}),I.init(a.layerView,"suspended",
function(c){var f=c?function(){return a._updateViewData()}:function(){return a._updateIdleState(!0)};c=c?function(){}:function(){return a._updateIdleState(!1)};a._idleStateCallbacks?(a.restartNodeLoading(),a._idleStateCallbacks.idleBegin=f,a._idleStateCallbacks.idleEnd=c):a._idleStateCallbacks=b.scheduler.registerIdleStateCallbacks(f,c)}),L.addTask(a.layerView.view.resourceController.scheduler,function(c,b){a._frame(c,b);return a._index?a._index.getPriority():-Infinity}),a.watch("uncompressedTextureDownsamplingEnabled",
function(){return a.restartNodeLoading()}),a.watch(["featureTarget","fixedFeatureTarget"],function(){a._setCameraDirty();a._stableFeatureLOD=!1}),c.state.watch("camera",function(){return a._setCameraDirty()}),a.layer.watch("elevationInfo",function(){return a._elevationInfoChanged()}),a.layerView.watch("lodFactor",function(){return a._setCameraDirty()}),a.layerView.watch("requiredFields",function(){return a._requiredFieldsChange()})]);a._viewportQueries=new O(a.crsIndex,c.renderCoordsHelper,c.state.camera,
a._clippingArea,c.elevationProvider,a.layer.elevationInfo,{progressiveLoadFactor:a._getProgressiveLoadFactor(a.layer),screenspaceErrorBias:a.lod,angleDependentLoD:.5>a.lod});a._index=new M.I3SIndex(a.getBaseUrl(),a._rootNodeUrl,a._rootNodeId,a.streamDataSupplier,a._viewportQueries,h,function(c){return a.layerView.isNodeLoaded(c)},function(c){return a._shouldLoadNode(c)},function(c){return a._enableFromGPUCache(c)},function(c){return a._needsUpdate(c)})}});this.addResolvingPromise(c);this.when(function(){return a._startNodeLoading()})};
b.prototype.destroy=function(){this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;k.prune()};b.prototype._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.requiredFields)return[];var a=this._attributeStorageInfo,c=this._fields,b=this.layer.objectIdField;return this.layerView.requiredFields.map(function(b){var f=v(a,b);b=v(c,b);return 0<=f&&0<=b?
{index:f,name:c[b].name,field:c[b],attributeStorageInfo:a[f]}:null}).filter(function(a){return null!=a&&a.name!==b})};b.prototype._requiredFieldsChange=function(){r(this._requiredAttributes,this._getRequiredAttributes())||this.requestUpdate()};b.prototype.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};b.prototype.setClippingArea=function(a){var c=J.create();w.extentToBoundingBox(a,c,this.layerView.view.renderSpatialReference)?this._clippingArea=c:this._clippingArea=
null};b.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.setPointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=y.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate())))};b.prototype._calculatePointOfInterest=function(a){var c=this._centerOnSurface.renderLocation,b=p.vec3f64.create();t.vec3.subtract(b,c,this.camPos);var g=this.layerView.view.renderCoordsHelper,
d=p.vec3f64.create();g.worldUpAtPosition(c,d);b=t.vec3.angle(d,b)-.5*Math.PI;t.vec3.lerp(a,this.camPos,c,Math.max(0,Math.min(1,b/(.5*Math.PI))));return a};b.prototype.updateClippingArea=function(a){this.setClippingArea(a);this._cameraDirty=!0;this._viewportQueries&&this._viewportQueries.updateExtent(this._clippingArea)};b.prototype._setCameraDirty=function(){this._cameraDirty=!0;this.notifyChange("rootNodeVisible");this.updatingChanged()};b.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path};
b.prototype.getNode=function(a){return this._index?this._index.getNode(a):null};b.prototype.updateElevationChanged=function(a,c,b){b.clear();var f=this.getNode(this._rootNodeId);null!=f&&u.findIntersectingNodes(a,c,f,this.crsIndex,this._index,function(a){return b.push(a)});for(a=0;a<b.length;a++)c=b.data[a],this._viewportQueries.invalidateCache(c.id),c.id===this._rootNodeId&&this.notifyChange("rootNodeVisible");b.length&&this.restartNodeLoading()};b.prototype._elevationInfoChanged=function(){this._viewportQueries.updateElevationInfo(this.layer.elevationInfo);
this._setCameraDirty()};b.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this.updatingChanged()};b.prototype.schedule=function(a,c){var b=this;return this._idleQueue.push(c).then(function(c){if(!b._loadingNodes.has(a)&&!b._updatingNodes.has(a))throw new m;return c})};b.prototype.reschedule=function(a,c){var b=this;return this._idleQueue.unshift(c).then(function(c){if(!b._loadingNodes.has(a)&&!b._updatingNodes.has(a))throw new m;return c})};Object.defineProperty(b.prototype,"unloadedMemoryEstimate",
{get:function(){return!this._index||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor},enumerable:!0,configurable:!0});b.prototype._frame=function(a,c){this.layerView.suspended?this._updateView(a):(this._viewportQueries&&this._viewportQueries.setCameraIdle(!this._cameraDirty),this.layerView.visible&&this._processLogError(a,c))};b.prototype._processLogError=function(a,c){try{this._process(a,c)}catch(f){50>this._errorCount?h.error("Error during processing: "+f):50===
this._errorCount&&h.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};b.prototype._process=function(a,c){var b=this;this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading());if(null!=this._nodeLoader&&null!=this._index){this._updateView(a);a.run(function(){return b._processIndex(c,a)});this._updateFeatureLOD();for(a.run(function(){return b._processNodes(a,c)});!a.done&&this._idleQueue.process();)a.madeProgress();a.run(function(){return b._prefetchIndex(c)});
c.numIndexLoading+=this._index.getIndexLoading();c.numNodesLoading+=this._downloadingNodes.size;this.updatingChanged();this._lodHandling.lodGlobalHandling(a)}};b.prototype._processIndex=function(a,c){a=Math.min(10-a.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,a));this._index.update(B.keysOfSet(this._loadingNodes),c);c=this._index.getFeatureEstimate().leafsReached;this._index.isLoading()||c===this._get("leafsReached")||this._set("leafsReached",c);return this._index.load(a)};
b.prototype._prefetchIndex=function(a){if(0<this._loadingNodes.size||0<this._index.updates.add.length)return!1;a=Math.min(10-a.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,a));return this._index.prefetch(a)};b.prototype._updateFeatureLOD=function(){if(this.isGraphics3D){var a=!this._index.isLoading(),c=this.featureTarget*this.baseLOD,b=this._index.getFeatureEstimate();b.estimate=b.estimate||c/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;
this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(a&&b.estimate<c){if(b.leafsReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(c/b.estimate,1.001));a=this.lod;c=this._index.checkFeatureTarget(c,a);c!==a&&(this._featureLOD=c/this.baseLOD,this._stableFeatureLOD=!0)}else if(b.estimate>1.2*c||a&&b.estimate>c){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(b.estimate/c-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,
Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.requestUpdate()}};b.prototype._processNodes=function(a,c){var b=(this._isIdle?100:2)-this._loadingNodes.size,g=this._index.updates;g.cancel.forEach(this._cancelNodeIdLoading,this);for(g.cancel=[];0<g.update.length&&!a.done;)this._updateLoadedNode(g.update.pop()),a.madeProgress();for(;0<g.add.length&&!a.done&&0<b;){--b;if(g.add.back().notInCache&&!this._hasNodeLoadToken(c))break;var d=g.add.pop();
this._loadNode(d);a.madeProgress()}return a.hasProgressed};b.prototype._cancelNodeLoading=function(){var a=this;this._loadingNodes.clear();this._downloadingNodes.clear();this._updatingNodes.forEach(function(c,b){return a._updatingNodes.get(b).cancel()});this._updatingNodes.clear()};b.prototype._cancelNodeIdLoading=function(a){this._loadingNodes.delete(a);this._downloadingNodes.delete(a)};b.prototype._getAvailableLoadTokens=function(a,c){var b=c.numIndexLoading+this._index.getIndexLoading();return Math.floor((12-
1*b-2*(c.numNodesLoading+this._loadingNodes.size))/a)};b.prototype._hasNodeLoadToken=function(a){var c=this._isIdle&&!this._index.isLoading()?5:2;return a.numNodesLoading+this._loadingNodes.size>=c?!1:0<this._getAvailableLoadTokens(2,a)};b.prototype.updatingChanged=function(){var a=(this._index?this._index.getIndexMissing():0)+3*(this._index?this._index.updates.add.length:0)+2*this._loadingNodes.size,c=!(!(0<a||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length||
this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&this._isIdle);0===a&&(this._progressMaxNumNodes=1);this._progressMaxNumNodes=Math.max(a,this._progressMaxNumNodes);c!==this._get("updating")&&this._set("updating",c);a=100*a/this._progressMaxNumNodes;a!==this._get("updatingPercentage")&&this._set("updatingPercentage",a)};b.prototype._updateView=function(a){this._updateViewData();this._invisibleDirty&&this._removeInvisibleNodes(a)&&(this._invisibleDirty=!1)};b.prototype._updateViewData=
function(){if(this._cameraDirty&&this._index){var a=this.layerView.view,c=a.state.camera;this.camPos=p.vec3f64.clone(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/(c.perScreenPixelRatio/2);this._poi=this._calculatePointOfInterest(this._poi);this._viewportQueries.updateCamera(c);this._viewportQueries.setPointOfInterest(this._poi);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.progressiveLoadPenalty=y.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();
this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};b.prototype._getProgressiveLoadFactor=function(a){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};Object.defineProperty(b.prototype,"lod",{get:function(){return this._featureLOD*this.baseLOD},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"baseLOD",{get:function(){var a=this.layerView.lodFactor,c=this.layerView.view.resourceController.memoryController.memoryFactor;
return this.fixedFeatureTarget?1:(0<a?a:1)*c},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"lodDropFactor",{get:function(){return this.fixedFeatureTarget?1:2*Math.min(this.layerView.view.resourceController.memoryController.memoryFactor,.5)},enumerable:!0,configurable:!0});b.prototype.isGeometryVisible=function(a){return this._viewportQueries.isGeometryVisible(a)};b.prototype.updateVisibility=function(a){return this._viewportQueries.updateNode(a)};b.prototype._shouldLoadNode=function(a){return!this._lodHandling.shouldLoadNode(a)||
this._shouldDropNode(a)?!1:a.obb?this._viewportQueries.isGeometryVisible(a):!0};b.prototype._shouldDropNode=function(a){var c=this.lodDropFactor;return 1>c&&this._lodHandling.childrenEmpty(a)&&this._viewportQueries.calcCameraDistance(a)>this._viewportQueries.maxDistance*c};b.prototype._startNodeLoading=function(){var a=this;this._restartNodeLoading=!1;if(!this._updatesDisabled&&null!=this.streamDataSupplier){this._updateViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),
this._requiredAttributesDirty=!1);var c=q.TextureFormat.Normal;this.layerView.useCompressedTextures?c=q.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(c=q.TextureFormat.Downsampled);var b=this._defaultGeometrySchema;this._nodeLoader=new q(this.streamDataSupplier,h,b,this._requiredAttributes,{textureFormat:c,loadTextureData:this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==b||null==b.ordering});c=this.layerView.view.renderSpatialReference;c=this.crsIndex.equals(c)||
this.crsIndex.isWGS84&&c.equals(w.SphericalECEFSpatialReference);this._index.ignoreServiceOBB=!c;this._index.requestUpdate();this._lodHandling.startNodeLoading(function(c){return a._viewportQueries.isNodeVisible(c)},function(c){return a._viewportQueries.isGeometryVisible(c)},function(c){return a._index.nodeTraversalState(c)},function(c,b){return a._removeNodes(c,b)},this._index,this._rootNodeId,{maxLodLevel:this._viewportQueries.maxLodLevel});this.updatingChanged()}};b.prototype.isNodeLoading=function(){return null!=
this._nodeLoader&&null!=this._index};b.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this._nodeLoader.cancelAll(),this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._cancelNodeLoading(),this._nodeLoader=null,this.layerView.additionalCancelNodeLoadingHandler&&this.layerView.additionalCancelNodeLoadingHandler(),this.updatingChanged())};b.prototype._removeInvisibleNodes=function(a){var c=this.layerView.getLoadedNodeIDs();k.clear();for(var b=0;b<c.length;b++){var d=this.getNode(c[b]);
if(!this._viewportQueries.isGeometryVisible(d)||this._shouldDropNode(d))this._lodHandling.setLodGlobalDirty(),k.push(d)}this._removeNodes(k,a);if(0===k.length)return!0;k.clear();return!1};b.prototype._removeNodes=function(a,c){0<a.length&&this._index.requestUpdate();this.layerView.removeNodeData(a,c)};b.prototype._needsUpdate=function(a){if(null==a.featureData||0===a.featureData.length||this._updatingNodes.has(a.id))return!1;a=this.layerView.getLoadedAttributes(a);return null!=a&&a!==this._requiredAttributes};
b.prototype._updateLoadedNode=function(a){var c=this,b=this.layerView.getLoadedAttributes(a),b=r(b,this._requiredAttributes)?n.resolve(this.layerView.getAttributeData(a)):this._nodeLoader.loadAttributes(a,this._requiredAttributes);this._updatingNodes.set(a.id,b);b.then(function(b){return c.schedule(a.id).then(function(){return c.layerView.setAttributeData(a,{loadedAttributes:c._requiredAttributes,attributeData:b})})}).catch(function(b){b instanceof m||c.layerView.setAttributeData(a,{loadedAttributes:c._requiredAttributes,
attributeData:{}})}).catch(function(){}).then(function(){c._updatingNodes.delete(a.id);c.updatingChanged()});this.updatingChanged()};b.prototype._loadNode=function(a){var b=this;this._loadingNodes.add(a.id);this.updatingChanged();this._loadAndAddBundle(a).catch(function(a){return a}).then(function(){b._loadingNodes.delete(a.id);b.updatingChanged()})};b.prototype._loadAndAddBundle=function(a){var b=this;1!==a.featureData.length&&h.warn("Node ${node.id} has ${node.featureData.length} bundles. Only the first bundle will be loaded.");
return a.notInCache?this._loadUncached(a):this._loadCached(a).then(function(c){c||(a.notInCache=!0,b._index.updates.add.push(a))}).catch(function(b){b instanceof m||(a.notInCache=!0)})};b.prototype._enableFromGPUCache=function(a){if(this.disableMemCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var b=this.layerView.loadCachedGPUData(a);if(!b||!x(b.attributeInfo)||!r(b.attributeInfo.loadedAttributes,this._requiredAttributes))return!1;this.layerView.addCachedGPUData(a,
b);this._nodeAdded(a);return!0};b.prototype._nodeAdded=function(a){this._index.requestUpdate();this._lodHandling.lodSwapBundleLoaded(a)};b.prototype._loadCached=function(a){var b=this;if(this._enableFromGPUCache(a))return n.resolve(!0);var d=this.layerView;return!this.disableIDBCache&&d.loadCachedNodeData&&d.addCachedNodeData?this.schedule(a.id).then(function(){return d.loadCachedNodeData(a,function(a,c){return b._nodeLoader.loadTextures(a,c)})}).then(function(c){if(null==c)return!1;var f=b._requiredAttributes;
return x(c)&&r(c.loadedAttributes,f)?b.reschedule(a.id).then(function(){return d.addCachedNodeData(a,c,c)}).then(function(){b._nodeAdded(a);return!0}):b.reschedule(a.id).then(function(){return b._nodeLoader.loadAttributes(a,f)}).then(function(c){return b.reschedule(a.id,{loadedAttributes:f,attributeData:c})}).then(function(b){return d.addCachedNodeData(a,c,b)}).then(function(){b._nodeAdded(a);return!0})}):n.resolve(!1)};b.prototype._loadUncached=function(a){var b=this;this._downloadingNodes.add(a.id);
return this._nodeLoader.loadBundleData(a,0).then(function(c){b._downloadingNodes.delete(a.id);return b.schedule(a.id,c)}).then(function(c){return b.layerView.addNodeData(a,c)}).then(function(){b._nodeAdded(a);a.notInCache=!1}).catch(function(c){c instanceof m||(h.error("Failed to load node '"+a.id+"' bundle 0: "+c),a.failed=!0,b._index.requestUpdate())})};b.prototype._updateIdleState=function(a){a!==this._isIdle&&(this._isIdle=a,this._viewportQueries&&this._viewportQueries.setCameraIdle(a),this.updatingChanged(),
a&&this._index&&this._index.resetFailedNodes())};b.prototype.updateStats=function(a){a.index=this._index?this._index.size:0;this.isGraphics3D&&(a.detail=this._featureLOD,a.target=this.featureTarget*this.baseLOD);this._index&&this._index.updateStats(a)};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{set disableIDBCache(b){a.disableIDBCache=b},set ignoreServiceOBB(b){a._index.ignoreServiceOBB=b}}},enumerable:!0,configurable:!0});e([d.property({readOnly:!0})],b.prototype,
"isMeshPyramid",null);e([d.property({readOnly:!0})],b.prototype,"isGraphics3D",null);e([d.property({readOnly:!0})],b.prototype,"streamDataSupplier",null);e([d.property({readOnly:!0})],b.prototype,"crsVertex",null);e([d.property({readOnly:!0})],b.prototype,"crsIndex",null);e([d.property()],b.prototype,"camPos",void 0);e([d.property()],b.prototype,"screenSizeFactor",void 0);e([d.property()],b.prototype,"featureTarget",void 0);e([d.property()],b.prototype,"fixedFeatureTarget",void 0);e([d.property()],
b.prototype,"layerView",void 0);e([d.property()],b.prototype,"layer",void 0);e([d.property({readOnly:!0})],b.prototype,"updating",void 0);e([d.property({readOnly:!0})],b.prototype,"updatingPercentage",void 0);e([d.property({readOnly:!0})],b.prototype,"leafsReached",void 0);e([d.property({readOnly:!0})],b.prototype,"rootNodeVisible",null);e([d.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled?"})],b.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return b=e([d.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],
b)}(d.declared(A,H,C));var k=new G,y={factorIM:.2,factor3dObject:.05,distancePenalty:10};return l});