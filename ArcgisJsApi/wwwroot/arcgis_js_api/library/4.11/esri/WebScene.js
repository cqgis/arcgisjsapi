// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(m,f,h){Object.defineProperty(f,"__esModule",{value:!0});f.updateOrigins=function(a){a&&a.writtenProperties&&a.writtenProperties.forEach(function(a){var d=a.target;a.newOrigin&&a.oldOrigin!==a.newOrigin&&d.isInstanceOf(h)&&d.updateOrigin(a.propName,a.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(m,f,h){Object.defineProperty(f,
"__esModule",{value:!0});f.createCopyError=function(){return new h("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};f.isCopyError=function(a){return a&&"webscene:failed-to-copy-embedded-resources"===a.name};f.createSchemaValidationError=function(a){return new h("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:a})};f.isSchemaValidationError=function(a){return a&&
"webscene:schema-validation"===a.name}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ./applicationProperties/Viewing".split(" "),function(m,f,h,a,b,d,e){return function(c){function b(a){a=c.call(this,a)||this;a.viewing=null;return a}h(b,c);k=b;b.prototype.clone=function(){return new k({viewing:this.viewing?this.viewing.clone():null})};var k;a([d.property({type:e,
json:{write:!0}})],b.prototype,"viewing",void 0);return b=k=a([d.subclass("esri.webscene.ApplicationProperties")],b)}(d.declared(b))})},"esri/webscene/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ./Search".split(" "),function(m,f,h,a,b,d,e){return function(c){function b(a){a=c.call(this,a)||this;a.search=null;return a}h(b,c);k=b;b.prototype.clone=
function(){return new k({search:this.search?this.search.clone():null})};var k;a([d.property({type:e,json:{write:!0}})],b.prototype,"search",void 0);return b=k=a([d.subclass("esri.webscene.applicationProperties.Viewing")],b)}(d.declared(b))})},"esri/webscene/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(m,f,h,a,b,d,e,c){var r=b.ofType(c);return function(d){function c(a){a=d.call(this,a)||this;a.enabled=!0;a.hintText=null;a.layers=new r;return a}h(c,d);b=c;c.prototype.clone=function(){return new b({enabled:this.enabled,hintText:this.hintText,layers:this.layers?this.layers.clone():null})};var b;a([e.property({type:Boolean,json:{write:!0,default:!0}})],c.prototype,"enabled",void 0);a([e.property({type:String,json:{write:!0}})],c.prototype,"hintText",void 0);a([e.property({type:r,json:{write:{enabled:!0,
isRequired:!0}}})],c.prototype,"layers",void 0);return c=b=a([e.subclass("esri.webscene.applicationProperties.Search")],c)}(e.declared(d))})},"esri/webscene/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),function(m,f,h,a,b,d,e,c){return function(b){function k(a){a=b.call(this,
a)||this;a.field=null;a.id=null;a.subLayer=null;return a}h(k,b);v=k;k.prototype.clone=function(){return new v({field:this.field?this.field.clone():null,id:this.id,subLayer:this.subLayer})};var v;a([d.property({type:c,json:{write:{enabled:!0,isRequired:!0}}})],k.prototype,"field",void 0);a([d.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],k.prototype,"id",void 0);a([d.property({type:e.Integer,json:{write:!0}})],k.prototype,"subLayer",void 0);return k=v=a([d.subclass("esri.webscene.applicationProperties.SearchLayer")],
k)}(d.declared(b))})},"esri/webscene/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(m,f,h,a,b,d,e){return function(c){function b(a){a=c.call(this,a)||this;a.exactMatch=!1;a.name=null;a.type=null;return a}h(b,c);k=b;b.prototype.clone=function(){return new k({exactMatch:this.exactMatch,
type:this.type,name:this.name})};var k;a([d.property({type:Boolean,json:{write:!0}})],b.prototype,"exactMatch",void 0);a([d.property({type:String,json:{write:!0}})],b.prototype,"name",void 0);a([d.enumeration.serializable()(e.kebabDict)],b.prototype,"type",void 0);return b=k=a([d.subclass("esri.webscene.applicationProperties.SearchLayerField")],b)}(d.declared(b))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(m,f,h,a,b,d,e,c,r){var k=function(a,b,c){return{enabled:!c||!c.isPresentation}};return function(b){function t(a){a=b.call(this,a)||this;a.lighting=new c;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}h(t,b);v=t;t.prototype.clone=function(){return new v(this.cloneConstructProperties())};t.prototype.cloneConstructProperties=function(){return{lighting:c.prototype.clone.call(this.lighting),background:d.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var v;a([e.property({type:c,json:{write:!0}})],t.prototype,"lighting",void 0);a([e.property(r.backgroundProperty)],t.prototype,"background",void 0);a([e.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:k}}})],t.prototype,"atmosphereEnabled",void 0);a([e.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:k}}})],t.prototype,"starsEnabled",void 0);return t=v=a([e.subclass("esri.webscene.Environment")],t)}(e.declared(b))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(m,f,h,a,b,d){return function(b){function c(a){a=b.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}h(c,b);e=c;c.prototype.readDate=function(a,b){return null!=b.datetime&&new Date(b.datetime)||null};c.prototype.writeDate=function(a,b,c){b[c]=a.getTime()};c.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};c.prototype.writedirectShadowsEnabled=function(a,b,c){a&&(b[c]=a)};c.prototype.writeDisplayUTCOffset=function(a,b){null!=
a&&(b.displayUTCOffset=a)};c.prototype.clone=function(){return new e(this.cloneConstructProperties())};c.prototype.cloneConstructProperties=function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var e;a([d.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],c.prototype,"date",void 0);a([d.reader("date",["datetime"])],c.prototype,"readDate",
null);a([d.writer("date")],c.prototype,"writeDate",null);a([d.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],c.prototype,"directShadowsEnabled",void 0);a([d.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);a([d.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",null);a([d.property({type:Number,json:{write:!0}})],c.prototype,"displayUTCOffset",void 0);a([d.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",
null);return c=e=a([d.subclass("esri.webscene.Lighting")],c)}(d.declared(b))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(m,f,h,a){Object.defineProperty(f,"__esModule",{value:!0});m={base:h,key:"type",typeMap:{color:a}};f.backgroundProperty={types:m,json:{read:function(a){return function(b,e,c){if(!b)return b;for(var d in a.typeMap)if(b.type===d)return e=new a.typeMap[d],e.read(b,c),e}}(m),write:{overridePolicy:function(a,
d,e){return{enabled:!e||!e.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators".split(" "),function(m,f,h,a,b,d,e,c){var r=e.strict()({color:"color"});return function(d){function e(a){return d.call(this)||this}h(e,d);e.prototype.normalizeCtorArgs=function(a){a&&
a.type&&(a=b({},a),delete a.type);return a};e.prototype.clone=function(){};a([c.property({type:r.apiValues,readOnly:!0,json:{type:r.jsonValues,read:!1,write:r.write}})],e.prototype,"type",void 0);return e=a([c.subclass("esri.webscene.background.Background")],e)}(c.declared(d))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(m,f,h,a,b,d,e,c,r){var k=b({},c.colorAndTransparencyProperty,{nonNullable:!0});return function(b){function c(a){a=b.call(this)||this;a.type="color";a.color=new d([0,0,0,1]);return a}h(c,b);f=c;c.prototype.clone=function(){return new f(this.cloneProperties())};c.prototype.cloneProperties=function(){return{color:this.color.clone()}};var f;a([e.enumeration.serializable()({color:"color"})],c.prototype,"type",void 0);a([e.property(k)],c.prototype,"color",void 0);return c=f=a([e.subclass("esri.webscene.background.ColorBackground")],
c)}(e.declared(r))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(m,f,h,a,b,d,e,c,r){return function(d){function k(a){a=d.call(this,a)||this;a.environment=new r;a.spatialReference=null;a.viewpoint=null;return a}h(k,d);f=k;Object.defineProperty(k.prototype,"viewingMode",{set:function(a){this._set("viewingMode",
a)},enumerable:!0,configurable:!0});k.prototype.clone=function(){return new f({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var f;a([e.property({type:r,json:{write:{isRequired:!0}}})],k.prototype,"environment",void 0);a([e.property({type:c})],k.prototype,"spatialReference",void 0);a([e.property({type:["local","global"]})],k.prototype,"viewingMode",
null);a([e.property({type:b,json:{write:{isRequired:!0}}})],k.prototype,"viewpoint",void 0);return k=f=a([e.subclass("esri.webscene.InitialViewProperties")],k)}(e.declared(d))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(m,f,h,a,b,d,e,c,r){var k=b.ofType(r);return function(b){function e(a){a=
b.call(this,a)||this;a.slides=new k;return a}h(e,b);Object.defineProperty(e.prototype,"slides",{set:function(a){a&&(a=a.filter(function(a){return!!a.viewpoint}));this._set("slides",d.referenceSetter(a,this._get("slides"),k))},enumerable:!0,configurable:!0});e.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};a([c.property({type:k,nonNullable:!0,json:{write:!0}}),c.cast(d.castForReferenceSetter)],e.prototype,"slides",null);return e=a([c.subclass("esri.webscene.Presentation")],
e)}(c.declared(e))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Basemap ../Viewpoint ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/lang ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/Title".split(" "),
function(m,f,h,a,b,d,e,c,r,k,v,t,z,n,F,T,C,U,J,V,x,q,A,p,G,B){function K(a){if("building-scene"===a.type||"map-image"===a.type)return a.allSublayers}function L(a){if(a=K(a))return a.filter(function(a){return a.visible}).map(function(a){return a.id}).toArray()}function w(a,b){a=b-a;a>N&&(a-=D);a<-N&&(a+=D);return a}var X=0,P=function(c){function d(a){a=c.call(this)||this;a.id="";a.sublayerIds=null;return a}a(d,c);E=d;d.prototype.clone=function(){return new E({id:this.id,sublayerIds:v.clone(this.sublayerIds)})};
var E;b([n.property({type:String,json:{write:!0}})],d.prototype,"id",void 0);b([n.property({type:[Number],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],d.prototype,"sublayerIds",void 0);return d=E=b([n.subclass("esri.webscene.VisibleLayer")],d)}(n.declared(k)),y=c.ofType(P),Q=t.getLogger("esri.webscene.Slide"),D=86400,N=43200;return function(k){function f(a){a=k.call(this,a)||this;a._currentAnimation=null;a.id=Date.now().toString(16)+"-slide-"+X++;a.title=new B.default;a.description=
new p.default;a.thumbnail=new x.default;a.viewpoint=null;a.basemap=null;a.ground=null;a.environment=new q;a.visibleLayers=new y;return a}a(f,k);f.prototype.castTitle=function(a){return"string"===typeof a?new B.default({text:a}):F.ensureType(B.default,a)};f.prototype.castDescription=function(a){return"string"===typeof a?new p.default({text:a}):F.ensureType(p.default,a)};f.prototype.castThumbnail=function(a){return"string"===typeof a?new x.default({url:a}):F.ensureType(x.default,a)};f.prototype.castBasemap=
function(a){return J.ensureType(a)};Object.defineProperty(f.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",r.referenceSetter(a,this._get("visibleLayers"),y))},enumerable:!0,configurable:!0});f.prototype.castVisibleLayers=function(a){return a&&"function"===typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a instanceof U){var b=L(a);return{id:a.id,sublayerIds:b}}if(a.id)return{id:a.id,sublayerIds:a.sublayerIds};Q.warn('Invalid visible layer, expected { id }, Layer or "id"');
return a}):null};f.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})};f.prototype._updateVisibleLayersFrom=function(a){var b=
this,c=[];return z.eachAlways(this._allLayers(a.map).map(function(b){return a.whenLayerView(b).then(function(a){if(a.visible){var d=L(b);c.push(new P({id:a.layer.id,sublayerIds:d}))}})}).toArray()).then(function(){b.visibleLayers.removeAll();b.visibleLayers.addMany(c)})};f.prototype.updateFrom=function(a,b){var c=this;b={screenshot:h({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},b&&b.screenshot)};return a.when(function(){c.viewpoint=a.viewpoint.clone();c.environment.lighting=A.prototype.clone.apply(a.environment.lighting);
c.basemap=a.map.basemap&&a.map.basemap.clone()||null;c.ground=a.map.ground?G.default.fromGround(a.map.ground):null;return c._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(b.screenshot)}).then(function(a){c.thumbnail=new x.default({url:a.dataUrl});return c})};f.prototype.applyTo=function(a,b){var c=this,d=h({animate:!0},b);return this._applyBasemap(a).then(function(){return z.all([c._applyViewpoint(a,d),c._applyLayerVisibility(a),c._applyGround(a)])}).then(function(){return c})};
f.prototype._applyBasemap=function(a){var b=this;return this.basemap?this.basemap.load().catch(function(a){return a}).then(function(){a.map.basemap=J.clonePreservingTiledLayers(b.basemap,a.map.basemap)}):z.resolve()};f.prototype._applyGround=function(a){this.ground&&(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground));return z.resolve()};f.prototype._allLayers=function(a){var b=new c;this._collectLayers(a,b);this._collectLayers(a.ground,b);return b};f.prototype._collectLayers=function(a,b){var c=
this;a.layers.forEach(function(a){b.add(a);a.layers&&c._collectLayers(a,b)})};f.prototype._applyLayerVisibility=function(a){var b=this;this.visibleLayers&&this._allLayers(a.map).forEach(function(a){var c=b.visibleLayers.find(function(b){return b.id===a.id});a.visible=null!=c;var d=c&&c.sublayerIds,c=K(a);d&&c&&c.forEach(function(a){return a.visible=0<=d.indexOf(a.id)})})};f.prototype._applyViewpoint=function(a,b){if(this.viewpoint&&!b.ignoreViewpoint){this.viewpoint.camera.fov=a.camera.fov;if(b.animate){if(this.get("environment.lighting.date"))return this._animateToLighting(a,
b);a.environment.lighting=this.environment.lighting.clone();return a.goTo(this.viewpoint,b)}a.viewpoint=this.viewpoint}a.environment.lighting=this.environment.lighting.clone();return z.resolve()};f.prototype._animateToLighting=function(a,b){var c=this,d;"global"===a.viewingMode&&(d=this._animateLightingWithCamera(a));this._currentAnimation&&(this._currentAnimation.cancel(),this._currentAnimation=null);a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;
null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);var e=a.goTo(this.viewpoint,b);this._currentAnimation=e;this._currentAnimation.catch(function(a){return a}).then(function(){d&&d.remove();c._currentAnimation===e&&(a.environment.lighting.cameraTrackingEnabled=!0)});this._currentAnimation.then(function(){a.environment.lighting=c.environment.lighting.clone()});return this._currentAnimation};f.prototype._getTime=function(a){var b=
a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[b,a]};f.prototype._setTime=function(a,b,c){a.setTime(b);a.setUTCHours(c/3600);a.setUTCMinutes(c%3600/60);a.setUTCSeconds(c%3600%60);return a};f.prototype._animateLightingWithCamera=function(a){var b=this,c=this._getTime(new Date(a.environment.lighting.date.toString())),d=c[0],e=c[1],c=this._getTime(this.environment.lighting.date),f=c[0],g=w(e,c[1]),l=a.renderCoordsHelper,u=C.vec3f64.create();l.toRenderCoords(a.camera.position,
u);var S=C.vec3f64.create();l.toRenderCoords(this.viewpoint.camera.position,S);var Y=C.vec3f64.create(),k=new Date;return a.watch("camera",function(c){l.toRenderCoords(c.position,Y);var I=T.vec3.squaredDistance(u,Y),h=T.vec3.squaredDistance(S,Y);c=0;0!==I+h&&(c=I/(I+h));I=d+(f-d)*c;c=V.moduloPositive(e+g*c,D);a.environment.lighting.date=b._setTime(k,I,c)})};f.createFrom=function(a,b){return(new this).updateFrom(a,b)};b([n.property({type:String,json:{write:{isRequired:!0}}})],f.prototype,"id",void 0);
b([n.property({type:B.default,json:{default:function(){return new B.default({text:""})},write:{isRequired:!0}}})],f.prototype,"title",void 0);b([n.cast("title")],f.prototype,"castTitle",null);b([n.property({type:p.default,json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],f.prototype,"description",void 0);b([n.cast("description")],f.prototype,"castDescription",null);b([n.property({type:x.default,json:{default:function(){return new x.default({url:""})},write:{isRequired:!0}}})],
f.prototype,"thumbnail",void 0);b([n.cast("thumbnail")],f.prototype,"castThumbnail",null);b([n.property({type:e,nonNullable:!0,json:{write:{isRequired:!0}}})],f.prototype,"viewpoint",void 0);b([n.property({type:d,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],f.prototype,"basemap",void 0);b([n.cast("basemap")],f.prototype,"castBasemap",null);b([n.property({type:G.default,json:{write:!0}})],f.prototype,"ground",void 0);b([n.property({type:y,json:{write:{isRequired:!0}}})],f.prototype,"visibleLayers",
null);b([n.cast("visibleLayers")],f.prototype,"castVisibleLayers",null);b([n.property({type:q,json:{write:!0}})],f.prototype,"environment",void 0);return f=b([n.subclass("esri.webscene.Slide")],f)}(n.declared(k))})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(m,f,h,a,b,d){Object.defineProperty(f,"__esModule",{value:!0});
m=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.url="";return a}h(c,b);e=c;c.prototype.clone=function(){return new e({url:this.url})};var e;a([d.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"url",void 0);return c=e=a([d.subclass("esri.webdoc.support.Thumbnail")],c)}(d.declared(b));f.default=m})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(m,f,h,a,b,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.text="";return a}h(c,b);e=c;c.prototype.clone=function(){return new e({text:this.text})};var e;a([d.property({type:String,json:{write:!0}})],c.prototype,"text",void 0);return c=e=a([d.subclass("esri.webscene.support.Description")],c)}(d.declared(b));f.default=m})},"esri/webscene/support/SlideGround":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../webdoc/support/opacityUtils".split(" "),
function(m,f,h,a,b,d,e,c){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function f(){var a=null!==d&&d.apply(this,arguments)||this;a.opacity=null;return a}h(f,d);m=f;f.prototype.clone=function(){return new m({opacity:this.opacity})};f.prototype.cloneAndApplyTo=function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new b;a.opacity=this.opacity;return a};f.fromGround=function(a){return new m({opacity:a.opacity})};var m;a([e.property({type:Number,json:{read:{reader:c.transparencyToOpacity,
source:"transparency"},write:{writer:function(a,b){b.transparency=c.opacityToTransparency(a)},target:"transparency"}}})],f.prototype,"opacity",void 0);return f=m=a([e.subclass("esri.webscene.support.SlideGround")],f)}(e.declared(d));f.default=m})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(m,f,h,a,b,d){Object.defineProperty(f,
"__esModule",{value:!0});m=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.text="";return a}h(c,b);e=c;c.prototype.clone=function(){return new e({text:this.text})};var e;a([d.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"text",void 0);return c=e=a([d.subclass("esri.webscene.support.Title")],c)}(d.declared(b));f.default=m})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(m,f,
h,a){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function b(b,c){return a.call(this,b,c,"webscene")||this}h(b,a);Object.defineProperty(b.prototype,"supportsGround",{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return b}(a.Version);f.Version=m;f.default=m})},"esri/core/Version":function(){define(["require",
"exports","./Error"],function(m,f,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function a(a,d,e){void 0===e&&(e="");this.major=a;this.minor=d;this._context=e}a.prototype.lessThan=function(a,d){return this.major<a||a===this.major&&this.minor<d};a.prototype.since=function(a,d){return!this.lessThan(a,d)};a.prototype.validate=function(a){if(this.major!==a.major)throw new h((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+
"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:a});};a.prototype.clone=function(){return new a(this.major,this.minor,this._context)};a.parse=function(b,d){void 0===d&&(d="");var e=b.split("."),c=e[0],e=e[1],f=/^\s*\d+\s*$/;if(!c||!c.match||!c.match(f))throw new h((d&&d+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:b});if(!e||!e.match||!e.match(f))throw new h((d&&d+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:b});b=parseInt(c,10);c=parseInt(e,10);return new a(b,c,d)};return a}();f.Version=m})},"*noref":1}});
define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./core/tsSupport/assignHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./kernel ./Map ./Viewpoint ./core/asyncUtils ./core/Collection ./core/Error ./core/Handles ./core/has ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/Version".split(" "),function(m,
f,h,a,b,d,e,c,r,k,v,t,z,n,F,T,C,U,J,V,x,q,A,p,G,B,K,L,w,X,P,y,Q,D,N,W,M,E,O){var H=x.getLogger("esri.WebScene"),R=new O.default(1,15),Z={width:600,height:400};return function(f){function g(a){a=f.call(this)||this;a._handles=new F;a.applicationProperties=null;a.clippingArea=null;a.clippingEnabled=!1;a.heightModelInfo=null;a.sourceVersion=null;a.supportsHeightModelInfo=!0;a.presentation=new E;a.initialViewProperties=new M;a.portalItem=null;a.resourceInfo=null;a.authoringApp=null;a.authoringAppVersion=
null;a._isAuthoringAppSetByUser=!1;a._isAuthoringAppVersionSetByUser=!1;return a}h(g,f);g.prototype.initialize=function(){var a=this;this.when().catch(function(a){H.error("#load()","Failed to load web scene",a)});if(this.resourceInfo){var b=void 0;try{b=this._validateJSON(this.resourceInfo)}catch(S){this.addResolvingPromise(q.reject(S));return}this.read(b);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",
function(){return a._scheduleLayersIdGC()}))};g.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy()};g.prototype.writeClippingArea=function(a,b){b.clippingArea||(b.clippingArea={});b.clippingArea.geometry=a.toJSON()};g.prototype.readClippingEnabled=function(a,b){return b.clippingArea?!!b.clippingArea.clip:!1};g.prototype.writeClippingEnabled=function(a,b){this.clippingArea&&(b.clippingArea||(b.clippingArea={}),b.clippingArea.clip=a)};g.prototype.writeLayers=function(a,
b,c,f){var l=this,u=d({},f,{layerContainerType:"operational-layers"});a=a.map(function(a){return l.verifyWriteLayer(a,f)?a.write(null,u):null}).filter(function(a){return!!a});b[c]=a.toArray()};g.prototype.verifyWriteLayer=function(a,b){return"write"in a?!0:(b&&b.messages&&b.messages.push(new n("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)};g.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];
return new O.default(parseInt(a[0],10),parseInt(b,10))};g.prototype.writeSourceVersion=function(a,b,c){b[c]=R.major+"."+R.minor};Object.defineProperty(g.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):this._clearOverride("thumbnailUrl")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},
enumerable:!0,configurable:!0});g.prototype.writeAuthoringApp=function(a,b){b.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(g.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});g.prototype.writeAuthoringAppVersion=function(a,b){b.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:r.version};g.prototype.writeGround=function(a,b,c,
d){b[c]=a?a.write(null,d):{transparency:0,layers:[]}};g.prototype.readInitialViewProperties=function(a,b){a={};b.initialState&&b.initialState.environment&&(a.environment=W.fromJSON(b.initialState.environment));a.spatialReference=b.spatialReference?w.fromJSON(b.spatialReference):w.WebMercator;a.viewingMode=b.viewingMode||"global";b.initialState&&b.initialState.viewpoint&&(a.viewpoint=v.fromJSON(b.initialState.viewpoint));return new M(a)};g.prototype.writeInitialViewProperties=function(a,b,c,d){a&&
(c={},a.environment&&(c.environment=a.environment.write({},d)),a.viewpoint&&(c.viewpoint=a.viewpoint.write({},d)),0!==Object.keys(c).length&&(b.initialState=c),b.spatialReference=a.spatialReference?a.spatialReference.write({},d):w.WebMercator.toJSON(),b.viewingMode=null!=a.viewingMode?a.viewingMode:"global")};g.prototype.load=function(){this.addResolvingPromise(this._loadFromSource());return this.when()};g.prototype.loadAll=function(){var a=this;return t.safeCast(V.default(this,function(b){var c=
a.presentation&&a.presentation.slides;b(a.ground,a.basemap,a.layers,c&&c.map(function(a){return a.basemap}))}))};g.prototype.read=function(a,b){var c=this;b=d({},b,{origin:"web-scene"});var l=this._isAuthoringAppVersionSetByUser,f=this._isAuthoringAppSetByUser,e=arguments;B.readLoadable(this,a,function(b){return c.inherited(e,[a,b])},b);f||(this._isAuthoringAppSetByUser=!1);l||(this._isAuthoringAppVersionSetByUser=!1);if(a.baseMap&&Array.isArray(a.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var l=
a.baseMap.elevationLayers.map(function(a){return{id:a.id}}),u=this.presentation.slides,g=function(a,b){return a.visibleLayers.some(function(a){return a.id===b})},h=l.filter(function(a){return!u.some(function(b){return g(b,a.id)})});u.forEach(function(a){a.visibleLayers.addMany(h)})}};g.prototype._writeBasemapElevationLayers=function(a){var b=a.ground&&a.ground.layers;!a.baseMap&&b&&b.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=U.clone(b))};g.prototype.write=
function(a,b){if("loaded"!==this.loadStatus){var c=new n("webscene:not-loaded","Web scene must be loaded before it can be serialized");H.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw c;}this._runLayersIdGC();b=d({},b,{origin:"web-scene"});c=this.inherited(arguments,[a,b]);this._writeBasemapElevationLayers(c);return c};g.prototype.save=function(a){return c(this,void 0,void 0,function(){var b,c,d;return e(this,function(l){switch(l.label){case 0:if(this.portalItem)return[3,
2];H.error("save(): requires the .portalItem property to be set");return[4,q.reject(new n("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:l.sent(),l.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,q.reject(new n("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:l.sent(),l.label=4;case 4:return b=this._updateFromPromise,[4,this.load()];case 5:return l.sent(),[4,this._loadObjectsWithLayers()];
case 6:return l.sent(),c=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&A.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||y.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),d=this.write(null,c),[4,this._verifySave(d,c,a)];case 7:return l.sent(),this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:d})];case 8:return l.sent(),G.updateOrigins(c),b?[4,b]:[3,10];case 9:l.sent(),l.label=10;case 10:return[4,
this._saveThumbnail()];case 11:return l.sent(),[2,this.portalItem]}})})};g.prototype.saveAs=function(a,b){return c(this,void 0,void 0,function(){var c,d,l,f,g;return e(this,function(e){switch(e.label){case 0:if(a)return[3,2];H.error("saveAs(portalItem): requires a portal item parameter");return[4,q.reject(new n("webscene:portal-item-required","saveAs requires a portal item to save to"))];case 1:e.sent(),e.label=2;case 2:return a.type&&"Web Scene"!==a.type||a.id?[4,q.reject(new n("webscene:portal-item-already-exists",
"WebScene can only saveAs to a new and empty portal item"))]:[3,4];case 3:e.sent(),e.label=4;case 4:return c=a.portal||y.getDefault(),[4,this.load()];case 5:return e.sent(),[4,this._loadObjectsWithLayers()];case 6:return e.sent(),d=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:c,writtenProperties:[],blockedRelativeUrls:[]}),l=this.write(null,d),[4,this._verifySaveAs(l,d,b)];case 7:return e.sent(),[4,c._signIn()];case 8:return e.sent(),f=this.thumbnailUrl,g=!this._isOverridden("thumbnailUrl"),
a.type="Web Scene",a.portal=c,this._updateTypeKeywords(a),[4,c.user.addItem({item:a,folder:b&&b.folder,data:l})];case 9:return e.sent(),this.portalItem=a,C.prototype.read.call(this,{version:l.version,authoringApp:l.authoringApp,authoringAppVersion:l.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:a.itemUrl&&A.urlToObject(a.itemUrl)}),G.updateOrigins(d),f&&(this.thumbnailUrl=g?A.addQueryParameter(f,"w","8192"):f),[4,this._saveThumbnail()];case 10:return e.sent(),[2,a]}})})};g.prototype._saveThumbnail=
function(){return c(this,void 0,void 0,function(){return e(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),a.label=2;case 2:return[2]}})})};g.prototype._verifySave=function(a,b,c,d){void 0===d&&(d=!1);var l=b.messages.filter(function(a){return"error"===a.type}).map(function(a){return new n(a.name,a.message,a.details)});b.blockedRelativeUrls&&
(l=l.concat(b.blockedRelativeUrls.map(function(a){return new n("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));c&&c.ignoreUnsupported&&(l=l.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name}));c&&c.strictSchemaValidationEnabled||(l=l.filter(function(a){return"web-document-write:property-required"!==a.name}));var e=c&&c.strictSchemaValidationEnabled;
return(e?q.create(function(a){return m(["./webscene/validator"],a)}).then(function(b){b=b.validate(a);if(0<b.length){var c="webscene did not validate:\n"+b.join("\n");H.error((d?"saveAs":"save")+"(): "+c)}return b.map(function(a){return new n("webscene:schema-validation",a)})}).then(function(a){return e&&0<a.length?(a=D.createSchemaValidationError(a.concat(l)),q.reject(a)):l}):q.resolve(l)).then(function(a){if(0<a.length)return q.reject(new n("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:a}))})};g.prototype._verifySaveAs=function(a,b,c){return this.canSaveAs(b)?q.reject(D.createCopyError()):this._verifySave(a,b,c,!0)};g.prototype.verifySaveAs=function(a){var b=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),c=this.write(null,b);return this._verifySaveAs(c,b,a)};g.prototype.canSaveAs=function(a){a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};
g.prototype.updateFrom=function(a,b){void 0===b&&(b={});return c(this,void 0,void 0,function(){var c,d;return e(this,function(l){switch(l.label){case 0:return this._updateFromPromise=c=this._updateFromInternal(a,b),[4,c];case 1:l.sent();if(d=this._updateFromPromise===c)this._updateFromPromise=null;return[2]}})})};g.prototype._updateFromInternal=function(a,b){void 0===b&&(b={});return c(this,void 0,void 0,function(){return e(this,function(c){switch(c.label){case 0:return[4,a.whenReady()];case 1:return c.sent(),
!b.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=W.prototype.clone.apply(a.environment)),!b.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=a.spatialReference.clone(),this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=
a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=a.visible}),!1===b.thumbnailExcluded||null==b.thumbnailExcluded&&!b.viewpointExcluded?[4,this._updateFromThumbnail(a,b.thumbnailSize||void 0)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2]}})})};g.prototype._updateFromThumbnail=function(a,b){void 0===b&&(b=Z);return c(this,void 0,void 0,function(){var c,d,f,l;return e(this,function(e){switch(e.label){case 0:return c=b.width,d=b.height,f=c/d,1.5>f?d=c/1.5:
1.5<f&&(c=1.5*d),c>a.width&&(d*=a.width/c,c=a.width),d>a.height&&(c*=a.height/d,d=a.height),[4,a.takeScreenshot({format:"jpg",width:Math.round(c),height:Math.round(d),disableSlice:!0})];case 1:return l=e.sent(),this.thumbnailUrl=l.dataUrl,[2]}})})};g.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};g.prototype._readAndLoadFromJSON=
function(a,b){a=this._validateJSON(a,b&&b.url&&b.url.path);this.read(a,b);return this._loadFromJSON(a,b)};g.prototype._extractOperationalLayers=function(a){var b=this,c=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var d=0,e=a.baseMap.elevationLayers;d<e.length;d++)c.push(e[d]);var f=[],l=function(a){a.layers&&(a.layers=a.layers.filter(l));return"ArcGISTiledElevationServiceLayer"===a.layerType?(b.sourceVersion.supportsGround||f.push(a),!1):!0};return{operationalLayers:a.operationalLayers?
a.operationalLayers.filter(l):[],operationalElevationLayers:f,basemapElevationLayers:c}};g.prototype._loadFromJSON=function(a,b){var c=this,e=new z;return this._validateSpatialReference().then(function(){return c._validateHeightModelInfo()}).then(function(){return q.create(function(a){return m(["./portal/support/layersCreator"],a)})}).then(function(f){var l=c._extractOperationalLayers(a),g=l.operationalLayers,h=l.operationalElevationLayers,l=l.basemapElevationLayers,k=[],u={context:d({},b,{layerContainerType:"operational-layers"})};
c.portalItem&&(u.context.portal=c.portalItem.portal||y.getDefault());if(0<l.length){var m=d({},u,{context:d({},u.context,{layerContainerType:"ground"})});m.defaultLayerType="ArcGISTiledElevationServiceLayer";k.push(t.safeCast(f.populateOperationalLayers(c.ground.layers,l,m)))}0<h.length&&(m=d({},u,{context:d({},u.context,{layerContainerType:"ground"})}),m.defaultLayerType="ArcGISTiledElevationServiceLayer",k.push(t.safeCast(f.populateOperationalLayers(e,h,m))));g&&0<g.length&&k.push(t.safeCast(f.populateOperationalLayers(c.layers,
g,u)));return q.eachAlways(k).then(function(){})}).then(function(){return c._loadObjectsWithLayers()}).then(function(){c.ground.layers.addMany(e)})};g.prototype._loadObjectsWithLayers=function(){var a=[];this.ground&&a.push(this.ground.load());this.basemap&&a.push(this.basemap.load());this.presentation.slides.forEach(function(b){b.basemap&&a.push(b.basemap.load())});return q.eachAlways(a).then(function(){})};g.prototype._loadFromItem=function(a){var b=this;return a.load().catch(function(a){throw new n("webscene:load-portal-item",
"Failed to load portal item",{error:a});}).then(function(){if("Web Scene"!==a.type)throw new n("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(c){b.resourceInfo=c;return b._readAndLoadFromJSON(c,{origin:"web-scene",url:A.urlToObject(a.itemUrl),portal:a.portal||y.getDefault()})})};g.prototype._validateSpatialReference=function(){var a=this.initialViewProperties,b=this._sceneSpatialReference,
c;if("local"!==a.viewingMode){if(!b.isWGS84&&!b.isWebMercator)return q.reject(new n("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator or WGS84 GCS are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||a.isWGS84||a.isWebMercator}}else{if(b.isGeographic)return q.reject(new n("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",
{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||a.equals(b)}}var d=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},e=d(a.viewpoint);return e&&!c(e)?q.reject(new n("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:e,sceneSpatialReference:b,
viewingMode:a.viewingMode})):(e=this.presentation.slides.find(function(a){return!c(d(a.viewpoint))}))?(e=d(e.viewpoint),q.reject(new n("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode}))):q.resolve()};g.prototype._validateHeightModelInfo=function(){var a=X.validateWebSceneError(this.heightModelInfo,
this._sceneSpatialReference);return a?q.reject(a):q.resolve()};g.prototype._validateJSON=function(a,b){void 0===b&&(b=null);b=O.default.parse(a.version||"","webscene");R.validate(b);a.version=b.major+"."+b.minor;1===b.major&&2>=b.minor&&(a.spatialReference=w.WebMercator.toJSON());return a};g.prototype._updateTypeKeywords=function(a){"local"===this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=
["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}))};Object.defineProperty(g.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||w.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_verifyItemRelativeRootPath",
{get:function(){return this.portalItem&&this.portalItem.itemUrl?A.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});g.prototype._enableVerifyItemRelativeUrls=function(a){var b=this._verifyItemRelativeRootPath;b&&(a.verifyItemRelativeUrls={rootPath:b,writtenUrls:[]});return a};g.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)};g.prototype._scheduleLayersIdGC=function(){var a=this;
this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};g.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var b=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,c=function(b){return!!a.allLayers.find(function(a){return a.id===b})};b&&b.layers&&(b.layers=b.layers.filter(function(a){return c(a.id)}));(b=this.presentation&&this.presentation.slides)&&
b.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return c(a.id)}))})};g.fromJSON=function(a){if(!a)throw new n("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};g.VERSION=R;a([p.property({type:N,json:{write:!0}})],g.prototype,"applicationProperties",void 0);a([p.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],g.prototype,"basemap",void 0);a([p.property({type:K,json:{read:{source:"clippingArea.geometry",
reader:P.fromJSON},write:{target:"clippingArea.geometry"}}})],g.prototype,"clippingArea",void 0);a([p.writer("clippingArea")],g.prototype,"writeClippingArea",null);a([p.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],g.prototype,"clippingEnabled",void 0);a([p.reader("clippingEnabled",["clippingArea"])],g.prototype,"readClippingEnabled",null);a([p.writer("clippingEnabled")],g.prototype,"writeClippingEnabled",null);a([p.property({type:L,json:{write:!0}})],g.prototype,"heightModelInfo",
void 0);a([p.property({json:{write:{target:"operationalLayers"}}})],g.prototype,"layers",void 0);a([p.writer("layers")],g.prototype,"writeLayers",null);a([p.property({readOnly:!0,type:O.default,json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],g.prototype,"sourceVersion",void 0);a([p.reader("sourceVersion",["version"])],g.prototype,"readSourceVersion",null);a([p.writer("sourceVersion")],g.prototype,"writeSourceVersion",null);a([p.property({dependsOn:["portalItem.thumbnailUrl"]})],
g.prototype,"thumbnailUrl",null);a([p.property({type:String,json:{write:{allowNull:!0}}})],g.prototype,"authoringApp",null);a([p.writer("authoringApp")],g.prototype,"writeAuthoringApp",null);a([p.property({type:String,json:{write:{allowNull:!0}}})],g.prototype,"authoringAppVersion",null);a([p.writer("authoringAppVersion")],g.prototype,"writeAuthoringAppVersion",null);a([p.property({json:{write:{isRequired:!0,allowNull:!0,enabled:!0}}})],g.prototype,"ground",void 0);a([p.writer("ground")],g.prototype,
"writeGround",null);a([p.property({type:E,nonNullable:!0,json:{write:function(a,b,c,e){a.slides&&0<a.slides.length&&(c=d({},e,{isPresentation:!0}),b.presentation=a.write(null,c))}}})],g.prototype,"presentation",void 0);a([p.property({type:M,nonNullable:!0,json:{default:function(){return new M({viewingMode:"global",spatialReference:w.WebMercator})}}})],g.prototype,"initialViewProperties",void 0);a([p.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],
g.prototype,"readInitialViewProperties",null);a([p.writer("initialViewProperties",{"initialState.environment":{type:W},spatialReference:{type:w},viewingMode:{type:String},"initialState.viewpoint":{type:v}})],g.prototype,"writeInitialViewProperties",null);a([p.property({type:Q})],g.prototype,"portalItem",void 0);a([p.property()],g.prototype,"resourceInfo",void 0);a([b(0,p.cast(Q))],g.prototype,"saveAs",null);a([p.property()],g.prototype,"_sceneSpatialReference",null);a([p.property()],g.prototype,"_verifyItemRelativeRootPath",
null);return g=a([p.subclass("esri.WebScene")],g)}(p.declared(k,J,C))});