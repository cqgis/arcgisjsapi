// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/arrayUtils ../../core/Evented ../../core/lang ../../core/ReentrantObjectPool ../../core/accessorSupport/decorators ../../core/accessorSupport/decorators/cast ./FieldConfig ./FieldGroupConfig ./InputField ./InputFieldGroup".split(" "),function(A,B,t,d,u,l,v,w,m,e,x,n,p,y,z){return function(q){function b(a){a=q.call(this)||this;a._fieldPool=new m.ReentrantObjectPool(y);
a._fieldGroupPool=new m.ReentrantObjectPool(z);a._featureClone=null;a.fieldConfig=null;a.strict=!1;return a}t(b,q);Object.defineProperty(b.prototype,"_allInputFields",{get:function(){return this.inputFields.reduce(function(a,b){return b.inputFields?a.concat(b.inputFields):a.concat([b])},[])},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"feature",{get:function(){return this._get("feature")},set:function(a){this._featureClone=a?a.clone():null;this._set("feature",a)},enumerable:!0,
configurable:!0});b.prototype.castFieldConfig=function(a){return a?a.map(function(a){return a instanceof n||a instanceof p?a:a.fieldConfig?new p(a):new n(a)}):null};Object.defineProperty(b.prototype,"inputFields",{get:function(){var a=this,b=this._fieldPool,d=this._fieldGroupPool,c=this._featureClone,e=this.layer,k=c&&c.clone();(c=this._get("inputFields"))&&c.forEach(function(b){return a._disposeInputOrGroup(b)});if("ready"!==this.state)return[];var h=this.get("layer.fields")||[],c=this.fieldConfig||
[];return(0!==c.length?c.map(function(c){if(c.fieldConfig){var f=d.acquire(),g=c.fieldConfig.map(function(c){var g=l.find(h,function(a){return a.name===c.name}),d=b.acquire();d.set({field:g,config:c,feature:k,group:f,layer:e,value:a.getValue(g.name)});return d}).filter(function(b){var c=b.visible;c||a._disposeInputOrGroup(b);return c});f.set({config:c,feature:k,inputFields:g});return f}var g=l.find(h,function(a){return a.name===c.name}),r=b.acquire();r.set({field:g,config:c,feature:k,group:null,layer:e,
value:a.getValue(g.name)});return r}):h.map(function(c){var f=b.acquire();f.set({config:null,field:c,feature:k,group:null,layer:e,value:a.getValue(c.name)});return f})).filter(function(b){var c=b.visible;c||a._disposeInputOrGroup(b);return c})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layer",{get:function(){return this.get("feature.layer")},set:function(a){a?this._override("layer",a):this._clearOverride("layer")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"state",{get:function(){return this.get("layer.loaded")&&this.feature?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"valid",{get:function(){var a=this._allInputFields;return 0<a.length&&a.every(function(a){return a.valid})},enumerable:!0,configurable:!0});b.prototype.findField=function(a){return l.find(this._allInputFields,function(b){return b.name===a})};b.prototype.getValue=function(a){var b=this._featureClone;return b&&b.get("attributes."+a)};b.prototype.setValue=
function(a,b){var d=this,c=this._featureClone,e=this.strict;if(c&&c.attributes){var f=this.findField(a);if(f&&c.attributes[a]!==b){f.value=b;if(this.get("layer.typeIdField")===f.name){var h=new Set;this.layer.types.forEach(function(a){return Object.keys(a.domains).forEach(function(a){return h.add(a)})});h.forEach(function(a){(a=d.findField(a))&&a.notifyChange("domain")})}if(!e||f.valid)c.attributes[a]=b,this.notifyChange("inputFields"),this._emitChangeEvent(f)}}};b.prototype.getValues=function(){var a=
this._featureClone;return a&&w.clone(a.attributes)||null};b.prototype.submit=function(){var a=this._allInputFields,b=a.filter(function(a){return a.valid}).map(function(a){return a.name}),a=a.filter(function(a){return!a.valid}).map(function(a){return a.name}),d=this.getValues();this.emit("submit",{valid:b,invalid:a,values:d})};b.prototype._disposeInputOrGroup=function(a){a.inputFields?this._disposeGroup(a):this._disposeInput(a)};b.prototype._disposeGroup=function(a){var b=this;a.inputFields.forEach(function(a){return b._disposeInput(a)});
this._fieldGroupPool.release(a)};b.prototype._disposeInput=function(a){this._fieldPool.release(a)};b.prototype._emitChangeEvent=function(a){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:a.name,value:a.value,valid:a.valid})};d([e.property({readOnly:!0,dependsOn:["inputFields"]})],b.prototype,"_allInputFields",null);d([e.property()],b.prototype,"feature",null);d([e.property()],b.prototype,"fieldConfig",void 0);d([x.cast("fieldConfig")],b.prototype,"castFieldConfig",null);
d([e.property({readOnly:!0,dependsOn:["feature","fieldConfig","layer.fields","layer.loaded"]})],b.prototype,"inputFields",null);d([e.property({dependsOn:["feature.layer"]})],b.prototype,"layer",null);d([e.property({dependsOn:["layer.loaded","feature"]})],b.prototype,"state",null);d([e.property()],b.prototype,"strict",void 0);d([e.property({dependsOn:["_allInputFields"]})],b.prototype,"valid",null);d([e.property()],b.prototype,"getValues",null);d([e.property()],b.prototype,"submit",null);return b=
d([e.subclass("esri.widgets.FeatureForm.FeatureFormViewModel")],b)}(e.declared(u,v))});