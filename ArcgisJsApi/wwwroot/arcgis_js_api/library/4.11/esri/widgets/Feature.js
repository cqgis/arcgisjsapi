// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/exifUtils":function(){define(["require","exports","../../core/arrayUtils"],function(z,k,h){function c(c){var q=c.tagName;return(c=h.find(c.tags,function(c){return c.name===q}))&&c.value||null}Object.defineProperty(k,"__esModule",{value:!0});k.getExifValue=function(k){var q=k.exifInfo,u=k.exifName;k=k.tagName;return q&&u&&k?(q=h.find(q,function(c){return c.name===u}))?c({tagName:k,tags:q.tags}):null:null}})},"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper dojo/i18n!dojo/cldr/nls/number dojo/regexp ../../Graphic ../../core/asyncUtils ../../core/date ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/throttle ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/support/fieldUtils ../../popup/content/TextContent ../../popup/content/support/ChartMediaInfoValueSeries ../../popup/support/FieldInfoFormat ../../tasks/support/AttachmentQuery ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(z,k,h,c,A,q,u,B,t,r,H,C,E,D,w,F,y,g,f,l,v,d,a,b,n,x,I,J){function S(){return u(this,void 0,void 0,function(){return q(this,function(a){return[2,y.create(function(a){z(["../../support/arcadeUtils"],function(e){a(e)})})]})})}function K(a,b){return a&&"feature"===a.type?a.getField(b):null}function L(a){return a.replace(/[\u00A0-\u9999<>\&]/gim,function(a){return"\x26#"+a.charCodeAt(0)+";"})}var T=["$datastore","$map","$layer"],M=F.getLogger("esri.widgets.FeatureViewModel"),N=/^\s*expression\//i,
O=new RegExp(""+t.escapeString(B.group),"g"),P=new E("cancelled-query","cancelled feature query"),Q=C.getFormat("short-date-short-time"),G="DateFormat"+Q;return function(I){function m(a){var e=I.call(this)||this;e._handles=new D;e._featurePromise=void 0;e._layerDateFields=null;e._graphicChangedThrottled=g.throttle(e._graphicChanged,1,e);e._effectivePopupTemplate=null;e._contentResponse=null;e._graphic=null;e.content=null;e.defaultPopupTemplateEnabled=!1;e.formattedAttributes=null;e.graphic=null;e.lastEditInfo=
null;e.spatialReference=null;e.title="";e.map=null;e._handles.add(f.init(e,"graphic graphic.sourceLayer.popupTemplate.title graphic.sourceLayer.popupTemplate.content graphic.sourceLayer.popupTemplate.fieldInfos graphic.sourceLayer.popupTemplate.lastEditInfoEnabled graphic.popupTemplate.title graphic.popupTemplate.content graphic.popupTemplate.fieldInfos graphic.popupTemplate.lastEditInfoEnabled".split(" "),function(){return e._graphicChangedThrottled()}));return e}h(m,I);m.prototype.destroy=function(){this._clear();
this._cancelFeatureQuery();this._handles.destroy();this._layerDateFields=this._graphic=this.graphic=this._handles=null};Object.defineProperty(m.prototype,"waitingForContent",{get:function(){return!!this._featurePromise},enumerable:!0,configurable:!0});m.prototype._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};m.prototype._graphicChanged=function(){var e=this;this._cancelFeatureQuery();this._clear();var a=this.graphic;if(this._graphic=a=a?a.clone():
null){this._layerDateFields=(a=x.getSourceLayer(a))?this._getDateFields(a):[];var R=!1,a=this._queryFeature().catch(function(e){e!==P&&M.error("error","error loading template",e)}).then(function(){R=!0;e._featurePromise=null;e.notifyChange("waitingForContent")});R||(this._featurePromise=a,this.notifyChange("waitingForContent"))}};m.prototype._cancelFeatureQuery=function(){var e=this._featurePromise;e&&"function"===typeof e.cancel&&e.cancel(P);this._featurePromise=null;this.notifyChange("waitingForContent")};
m.prototype._compileContent=function(e,a){var p=this;if(e&&(e.nodeName||e&&J.isWidgetBase(e)||J.isWidget(e)))return e;if("string"===typeof e)return this._compileText(new d({text:e})).text;if(Array.isArray(e))return e.map(function(e,b){b=(b=a&&a[b])&&b.value;if("attachments"===e.type)return p._compileAttachments(e,b);if("fields"===e.type)return p._compileFields(e);if("media"===e.type)return p._compileMedia(e);if("text"===e.type)return p._compileText(e)});e&&M.warn("invalid content type.")};m.prototype._compileFields=
function(e){var a=this,b=this._effectivePopupTemplate;e=w.clone(e);var f=b&&b.expressionInfos,b=e.fieldInfos?void 0:b&&b.fieldInfos,b=e.fieldInfos||w.clone(b),d=[];b&&b.forEach(function(e){var p=e.fieldName.toLowerCase();if(!e.hasOwnProperty("visible")||e.visible)p=a._isExpressionField(p)?a._getExpressionInfo(f,p):null,e.label=p?p.title:e.label,d.push(e)});e.fieldInfos=d;return e};m.prototype._setImageValue=function(e){var a=e.value,b=e.formattedAttributes;e=e.layer;var f=a.linkURL,d=a.sourceURL;
d&&(d=this._fixTokens(d,e),a.sourceURL=this._substituteAttributes(b,d));f&&(e=this._fixTokens(f,e),a.linkURL=this._substituteAttributes(b,e))};m.prototype._compileMedia=function(e){var a=this,b=this._layerDateFields,f=this._graphic;e=w.clone(e);var d=e.mediaInfos,n=f.attributes,c=x.getSourceLayer(f),g=this.formattedAttributes.global,l={dateFormat:{properties:b,formatter:G}};e.mediaInfos=d&&d.map(function(e){if(e=w.clone(e)){var b=e.title?a._processFieldsInLinks(e.title,n):"",p=e.caption?a._processFieldsInLinks(e.caption,
n):"";e.title=b?a._substituteAttributes(g,b,l):"";e.caption=p?a._substituteAttributes(g,p,l):"";if("image"===e.type)return b=e.value,a._setImageValue({value:b,formattedAttributes:g,layer:c}),e.value.sourceURL?e:void 0;if("pie-chart"===e.type||"line-chart"===e.type||"column-chart"===e.type||"bar-chart"===e.type)return b=e.value,a._setChartValue({value:b,attributes:n,formattedAttributes:g,layer:c}),e}}).filter(Boolean);return e};m.prototype._substituteAttributes=function(e,a,b){return(""+this._removeEmptyHref(w.substitute(e,
a,b))).trim()};m.prototype._compileText=function(e){var a=this._layerDateFields,b=this._graphic;if((e=w.clone(e))&&e.text){var f=this.formattedAttributes.global,a={dateFormat:{properties:a,formatter:G}},b=this._processFieldsInLinks(e.text,b.attributes);e.text=this._substituteAttributes(f,b,a)}return e};m.prototype._formatEditInfo=function(e,a){var b=e.creatorField,p=e.creationDateField,f=e.editorField;if(a){e=a[e.editDateField];if("number"===typeof e)return a=a[f],b=w.substitute({myKey:e},"{myKey:"+
G+"}"),{type:"edit",date:b,user:a};p=a[p];if("number"===typeof p)return a=a[b],b=w.substitute({myKey:p},"{myKey:"+G+"}"),{type:"create",date:b,user:a}}};m.prototype._compileLastEditInfo=function(){var e=this._effectivePopupTemplate,a=this._graphic;if(e){var e=e.lastEditInfoEnabled,b=a.get("sourceLayer.editFieldsInfo");if(e&&b)return this._formatEditInfo(b,a.attributes)}};m.prototype._compileTitle=function(){var e=this._effectivePopupTemplate,a=this._graphic,b=e&&e.title,f=a.attributes,e={dateFormat:{properties:this._layerDateFields,
formatter:G}},d=this.formattedAttributes.global;return"function"===typeof b?b.call(null,{graphic:a}):"string"===typeof b&&b?(a=this._processFieldsInLinks(b,f),this._substituteAttributes(d,a,e)):""};m.prototype._getExpressionInfo=function(e,a){if(this._isExpressionField(a)){var b=a.replace(N,"").toLowerCase(),p;e.some(function(a){if(a.name.toLowerCase()===b)return p=a,!0});return p}};m.prototype._fixTokens=function(a,b){return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,e,p){return(a=K(b,p))?"{"+a.name+
"}":e})};m.prototype._encodeAttributes=function(a){var e=a?w.clone(a):{};Object.keys(e).forEach(function(a){var b=e[a];"string"===typeof b&&(b=encodeURIComponent(b).replace(/\'/g,"\x26apos;"),e[a]=b)});return e};m.prototype._formatAttributesToFieldInfos=function(a,b,f){var e=this,p=w.clone(this._layerDateFields);a.forEach(function(d){var n=e._getFixedFieldName(d.fieldName,b);d.fieldName=n;f[n]=e._formatValue(f[n],{fieldInfos:a,fieldName:n,layer:b});p&&d.format&&d.format.dateFormat&&(d=p.indexOf(n),
-1<d&&p.splice(d,1))})};m.prototype._formatAttributes=function(a){var e=this,b=this._graphic,f=x.getSourceLayer(b),d=b.attributes;this.addRelatedFeatureAttributes(d);Object.keys(d).forEach(function(a){var b=d[a];if(null!=b){var p;(p=e._getDomainName(a,b)||e._getTypeName(a))||(p=/(\n)/gi,p="string"===typeof b?b.replace(p,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):b);d[a]=p}});a&&this._formatAttributesToFieldInfos(a,f,d);return d};m.prototype._formatValue=function(a,p){var e={dateFormat:{properties:this._layerDateFields,
formatter:G}},d=p.fieldName,f=this._getFieldInfo(p.fieldInfos,d),n=w.clone(f),f=p.preventPlacesFormatting;(p=K(p.layer,d))&&"date"===p.type&&(p=n.format||new b,p.dateFormat=p.dateFormat||"short-date-short-time",n.format=p);d=n&&n.format;if(null==a||!n||null==d)return a;var c=[];p=(n=!d.dateFormat&&(d.hasOwnProperty("places")||d.hasOwnProperty("digitSeparator")))&&d.hasOwnProperty("digitSeparator")?d.digitSeparator:!0;f=n&&null!=d.places&&(!f||0<d.places);n&&f&&c.push("places: "+Number(d.places));
f=n?f?"NumberFormat("+c.join(",")+")":"NumberFormat":d.dateFormat?"DateFormat"+(C.getFormat(d.dateFormat)||Q):void 0;if(!f)return a;a=w.substitute({myKey:a},"{myKey:"+f+"}",e)||"";return n&&!p&&B.group?a.replace(O,""):a};m.prototype._getDomainName=function(a,b){if(this.isRelatedField(a))return null;var e=this._graphic,d=x.getSourceLayer(e);return d&&"feature"===d.type?(a=d.getFieldDomain(a,{feature:e}))&&"coded-value"===a.type?a.getName(b):null:null};m.prototype._getFieldInfo=function(a,b){if(a&&
a.length&&b){var e=b.toLowerCase(),d=void 0;a.some(function(a){if(a.fieldName&&a.fieldName.toLowerCase()===e)return d=a,!0});return d}};m.prototype._getTypeName=function(a){if(this.isRelatedField(a))return null;var e=this._graphic,b=x.getSourceLayer(e);return b&&"feature"===b.type&&a===b.typeIdField?(a=b.getFeatureType(e))?a.name:null:null};m.prototype._removeEmptyHref=function(a){return a.replace(/href=(""|'')/gi,"")};m.prototype._processFieldsInLinks=function(a,b){var e=this.get("_graphic.layer");
a=this._fixTokens(a,e);var d=this._encodeAttributes(b),e=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;return a?a.replace(e,function(a,e,f){e=(""+(e||f)).trim();return w.substitute(e&&"{"===e[0]?b:d,a)}):a};m.prototype._compileAttachments=function(a,b){a=w.clone(a);if(!b||b&&0===b.length)return a;a.attachmentInfos=b;return a};m.prototype._queryAttachments=function(){var a=this._graphic,b=x.getSourceLayer(a);if(!b)return y.resolve([]);if((b="scene"===b.type&&b.associatedLayer?b.associatedLayer:b)&&
"feature"===b.type){var d=b.objectIdField,f=(a=a.attributes)&&a[d],a=new n({objectIds:[f],returnMetadata:!0});return b.queryAttachments(a).then(function(a){return a[f]||[]})}return y.resolve([])};m.prototype._queryContentElements=function(a){var e=this;if(!Array.isArray(a))return y.resolve();var b={};a.forEach(function(a,d){"attachments"===a.type&&(a=e._queryAttachments())&&(b[d]=a)});return Object.keys(b).length?y.eachAlways(b):y.resolve()};m.prototype._getContent=function(){var a=this._effectivePopupTemplate,
b=this._graphic,a=a&&a.content,b="function"===typeof a?a.call(null,{graphic:b}):a;return y.isThenable(b)?b:y.resolve(b)};m.prototype._querySourceLayer=function(a){var b=a.layer,e=a.outFields;a=a.objectIds;var d=b.createQuery();d.objectIds=a;d.outFields=e;d.returnGeometry=!0;return b.queryFeatures(d).then(function(a){return a.features[0]})};m.prototype._queryRequiredFieldsFeature=function(){var a=this,b=this._graphic,d=this._effectivePopupTemplate,f=b.sourceLayer;return f&&"function"===typeof f.queryFeatures&&
d?("function"===typeof f.load?f.load():y.resolve()).then(function(){var e=b.attributes[f.objectIdField];return H.safeCast(d.getRequiredFields(f.fields)).then(function(d){return v.featureHasFields(d,b)||"number"!==typeof e?null:a._querySourceLayer({layer:f,outFields:d,objectIds:[e]})})}):y.resolve(null)};m.prototype._queryFeature=function(){var a=this,b=this._graphic;this._effectivePopupTemplate=b&&b.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled);return this._getContent().then(function(e){var d=
a._checkForRelatedFeatures(e),f=a._createFormattedExpressions().then(function(a){b.attributes=A({},b.attributes,a)}),n=a._queryContentElements(e).then(function(b){return a._contentResponse=b}),c=a._queryRequiredFieldsFeature().then(function(a){a&&(b.geometry=a.geometry,b.attributes=A({},b.attributes,a.attributes))});return y.eachAlways([d,f,n,c]).then(function(){a._set("formattedAttributes",a._createFormattedAttributes(e));a._set("title",a._compileTitle());var b=a._compileLastEditInfo();a._set("lastEditInfo",
b||null);b=a._compileContent(e,a._contentResponse);a._set("content",b||null);return b})})};m.prototype._isExpressionField=function(a){return N.test(a)};m.prototype._getDateFields=function(a){return(a=a.fields)?a.filter(function(a){return"date"===a.type}).map(function(a){return a.name}):[]};m.prototype._formatArcadeArray=function(a){return'\x3cul class\x3d"esri-widget__list"\x3e'+a.map(function(a){return"\x3cli\x3e"+("string"===typeof a?L(a):a)+"\x3c/li\x3e"}).join("")+"\x3c/ul\x3e"};m.prototype._formatArcadeDictionary=
function(a){return'\x3ctable class\x3d"esri-widget__table"\x3e'+a.keys().map(function(b){var e=a.field(b),e="string"===typeof e?L(e):e;return"\x3ctr\x3e\x3cth\x3e"+b+"\x3c/th\x3e\x3ctd\x3e"+e+"\x3c/td\x3e\x3c/tr\x3e"}).join("")+"\x3c/table\x3e"};m.prototype._createFormattedExpressions=function(){return u(this,void 0,void 0,function(){var a,b,d,f,n,c,g,l,x,v,m,J=this;return q(this,function(e){switch(e.label){case 0:return a=this,b=a._effectivePopupTemplate,d=a._graphic,f=b&&b.expressionInfos,n=[],
c={},f&&f.length?[4,S()]:[2,c];case 1:g=e.sent();l=function(a){var b="expression/"+a.name,e=g.createSyntaxTree(a.expression),f=T.filter(function(a){return g.hasVariable(e,a)});a=g.loadScriptDependencies(e,!0,f).then(function(){return u(J,void 0,void 0,function(){var a,n,l,x,p=this;return q(this,function(v){a=this.spatialReference;n=g.getViewInfo({spatialReference:a});l=g.createExecContext(d,n);l.useAsync=!0;this._addVarsToContext(g,f,l,n);x=g.createFunction(e,l);return[2,g.executeAsyncFunction(x,
l).then(function(a){c[b]="string"===typeof a?L(a):Array.isArray(a)?p._formatArcadeArray(a):a&&"esri.arcade.Dictionary"===a.declaredClass?p._formatArcadeDictionary(a):a},function(a){return M.error("arcade-execution-error",a)})]})})});n.push(a)};x=0;for(v=f;x<v.length;x++)m=v[x],l(m);return[2,y.eachAlways(n).then(function(){return c})]}})})};m.prototype._addVarsToContext=function(a,b,d,f){var e=this.graphic,n=this.map;b.forEach(function(b){b=b.toLowerCase();var c={map:n,spatialReference:f.sr};"$map"===
b&&(d.vars[b]=a.convertMapToFeatureSetCollection(c));"$layer"===b&&(d.vars[b]=a.convertFeatureLayerToFeatureSet(e.sourceLayer,f.sr));"$datastore"===b&&(d.vars[b]=a.convertServiceUrlToWorkspace(e.sourceLayer.url,f.sr))})};m.prototype._createFormattedAttributes=function(a){var b=this,e=this._effectivePopupTemplate,d={global:this._formatAttributes(e&&e.fieldInfos),content:[]};Array.isArray(a)&&a.forEach(function(a,e){"fields"===a.type&&a.fieldInfos&&(d.content[e]=b._formatAttributes(a.fieldInfos))});
return d};m.prototype._getAllFieldInfos=function(a){var b=this._effectivePopupTemplate,e=[];(b=b&&b.fieldInfos)&&e.push.apply(e,b);if(!a||!Array.isArray(a))return e;a.forEach(function(a){"fields"===a.type&&e.push.apply(e,a&&a.fieldInfos)});return e};m.prototype._checkForRelatedFeatures=function(a){var b=this._graphic;a=this._getAllFieldInfos(a);return this.queryRelatedInfos(b,a)};m.prototype._getChartOption=function(b){var e=b.value,d=b.attributes,f=b.formattedAttributes,n=b.fieldName,c=b.relatedFieldName,
g=b.fieldInfos,l=b.index;b=x.getSourceLayer(this._graphic);var v=e.normalizeField,e=e.tooltipField,v=v?this.isRelatedField(v)?d[this.getRelatedFieldInfo(v).fieldName]:d[v]:null,m=c&&void 0!==d[c]?d[c]:void 0!==d[n]?d[n]:f[n],m="string"===typeof m&&B.group?parseFloat(m.replace(O,"")):m,m=void 0===m?null:m&&v?m/v:m,l=new a({x:l,y:m});if(this.isRelatedField(n))return f=this.getRelatedFieldInfo(n),n=(n=this.getRelatedFieldInfo(e))?n.fieldName:null,g=this._formatValue(m,{fieldInfos:g,fieldName:c,layer:b,
preventPlacesFormatting:!!v}),c=f?f.label||f.fieldName:c,l.tooltip=(n&&void 0!==d[n]?d[n]:c)+": "+g,l;d=this._getFieldInfo(g,n);c=this._getFixedFieldName(n,b);d=d?d.label||d.fieldName:n;l.tooltip=(e&&void 0!==f[e]?f[e]:d)+": "+f[c];return l};m.prototype._getFixedFieldName=function(a,b){return(b=K(b,a))?b.name:a};m.prototype._getFixedFieldNames=function(a,b){var e=this;return a&&a.map(function(a){return e._getFixedFieldName(a,b)})};m.prototype._setChartValue=function(a){var b=this,e=a.value,d=a.attributes,
f=a.formattedAttributes;a=a.layer;var n=this._effectivePopupTemplate,c=this.relatedInfoCount,g=e.fields,l=e.normalizeField;e.fields=this._getFixedFieldNames(g,a);l&&(e.normalizeField=this._getFixedFieldName(l,a));if(g.some(function(a){return!!(null!=f[a]||b.isRelatedField(a)&&c)})){var v=n&&n.fieldInfos;g.forEach(function(a,n){b.isRelatedField(a)?e.series=e.series.concat(b._getRelatedChartInfos({fieldInfos:v,fieldName:a,formattedAttributes:f,value:e})):(a=b._getChartOption({value:e,index:n,attributes:d,
formattedAttributes:f,fieldName:a,fieldInfos:v}),e.series.push(a))})}};m.prototype._getRelatedChartInfos=function(a){var b=this,e=a.fieldInfos,d=a.fieldName,f=a.formattedAttributes,n=a.value,c=[];a=this.getRelatedFieldInfo(d);var g=a.fieldName,l=this.getRelatedInfo(a.layerId);if(!l)return c;a=l.relatedFeatures;l=l.relation;if(!l||!a)return c;l=l.cardinality;a.forEach(function(a,l){var v=a.attributes;v&&Object.keys(v).forEach(function(a){a===g&&c.push(b._getChartOption({value:n,index:l,attributes:v,
formattedAttributes:f,fieldName:d,relatedFieldName:a,fieldInfos:e}))})});return"one-to-many"===l||"many-to-many"===l?c:[c[0]]};c([l.property({readOnly:!0})],m.prototype,"content",void 0);c([l.property({type:Boolean})],m.prototype,"defaultPopupTemplateEnabled",void 0);c([l.property({readOnly:!0})],m.prototype,"formattedAttributes",void 0);c([l.property({type:r})],m.prototype,"graphic",void 0);c([l.property({readOnly:!0})],m.prototype,"lastEditInfo",void 0);c([l.property()],m.prototype,"spatialReference",
void 0);c([l.property({readOnly:!0})],m.prototype,"title",void 0);c([l.property()],m.prototype,"map",void 0);c([l.property({readOnly:!0})],m.prototype,"waitingForContent",null);return m=c([l.subclass("esri.widgets.FeatureViewModel")],m)}(l.declared(I))})},"esri/core/throttle":function(){define(["require","exports"],function(z,k){function h(c,h,k,u){var B=null,t=1E3;"number"===typeof h?(t=h,u=k):(B=h,t=k);var r=0,q,C=function(){r=0;c.apply(u,q)};h=function(){for(var c=[],h=0;h<arguments.length;h++)c[h]=
arguments[h];B&&B.apply(u,c);q=c;t?r||(r=setTimeout(C,t)):C()};h.remove=function(){r&&(clearTimeout(r),r=0)};h.forceUpdate=function(){r&&(clearTimeout(r),C())};h.hasPendingUpdates=function(){return!!r};return h}Object.defineProperty(k,"__esModule",{value:!0});k.throttle=h;k.default=h})},"esri/widgets/Feature/support/featureUtils":function(){define(["require","exports"],function(z,k){Object.defineProperty(k,"__esModule",{value:!0});var h={1:{rotate:0,scaleX:1},2:{rotate:0,scaleX:-1},3:{rotate:180,
scaleX:1},4:{rotate:180,scaleX:-1},5:{rotate:90,scaleX:-1},6:{rotate:90,scaleX:1},7:{rotate:-90,scaleX:-1},8:{rotate:-90,scaleX:1}};k.getSourceLayer=function(c){if(c)return c.get("sourceLayer")||c.get("layer")};k.getOrientationStyles=function(c){return(c=h[c])?{transform:"rotate("+c.rotate+"deg) scaleX("+c.scaleX+")"}:{}}})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),
function(z,k,h,c,A,q,u,B,t,r,H,C,E,D){var w=new Map,F=B.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(k){function g(f){f=k.call(this)||this;f.relatedInfoCount=null;f.relatedInfos=new Map;return f}h(g,k);g.prototype.destroy=function(){this.relatedInfos.clear()};g.prototype.addRelatedFeatureAttributes=function(f){var c=this;this.relatedInfos.forEach(function(l){return c._addRelatedFeatureAttribute(f,l)})};g.prototype.getRelatedFieldInfo=function(f){if(-1===f.indexOf("relationships/"))return null;
f=f.split("/").slice(1);return{layerId:f[0],fieldName:f[1]}};g.prototype.getRelatedInfo=function(f){return this.relatedInfos.get(f.toString())};g.prototype.isRelatedField=function(f){void 0===f&&(f="");return f?-1!==f.indexOf("relationships/"):!1};g.prototype.queryRelatedInfos=function(f,c){var l=this;this.relatedInfos.clear();var d=D.getSourceLayer(f);if(!d)return t.resolve();var a=c.filter(function(a){return a&&l.isRelatedField(a.fieldName)});if(!a||!a.length)return t.resolve();this._createRelatedInfos(c,
d);return this._queryLayerInfos(d).then(function(a){l._updateRelatedInfoLayerInfos(a);return l._queryRelatedFeatureMap(f).then(function(a){Object.keys(a).forEach(function(b){l._setRelatedFeatures(a[b],b.toString())});return a})})};g.prototype._addRelatedFeatureAttribute=function(f,c){var g=this;f&&c&&(c.relatedFeatures&&c.relatedFeatures&&c.relatedFeatures.forEach(function(d){return g._addAttributesFromFeature(f,d,c)}),c.relatedStatsFeatures&&c.relatedStatsFeatures&&c.relatedStatsFeatures.forEach(function(d){return g._addAttributesFromFeature(f,
d,c)}))};g.prototype._updateRelatedInfoLayerInfo=function(f,c){if(f=f.value)this.getRelatedInfo(c).layerInfo=f.data};g.prototype._updateRelatedInfoLayerInfos=function(f){var c=this;Object.keys(f).forEach(function(g){return c._updateRelatedInfoLayerInfo(f[g],g.toString())})};g.prototype._addAttributesFromFeature=function(f,c,g){var d=this;f&&c&&g&&Object.keys(c.attributes).forEach(function(a){var b=d._relatedFieldInfoToString({layerId:g.relation.id.toString(),fieldName:a});f[b]=c.attributes[a]})};
g.prototype._relatedFieldInfoToString=function(f){return f?"relationships/"+f.layerId+"/"+f.fieldName:""};g.prototype._createRelatedInfoForFieldInfo=function(f,c){var g=this.getRelatedFieldInfo(f.fieldName);if(g){var d=g.layerId,g=g.fieldName;d&&(c=this.getRelatedInfo(d)||this._createRelatedInfo(d,c))&&(c.relatedFields.push(g),f.statisticType&&(f=new E({statisticType:f.statisticType,onStatisticField:g,outStatisticFieldName:g}),c.outStatistics.push(f)))}};g.prototype._createRelatedInfos=function(f,
c){var g=this;f.forEach(function(d){return g._createRelatedInfoForFieldInfo(d,c)})};g.prototype._queryRelatedFeatureMap=function(f){var c=this,g={};this.relatedInfos.forEach(function(d,a){d.layerInfo&&(g[a]=c._queryRelatedLayerFeatures(f,d))});return t.eachAlways(g)};g.prototype._queryLayerInfos=function(f){var c=this,g={};this.relatedInfos.forEach(function(d,a){d=d.relation;if(!d)return a=new u("relation-required","A relation is required on a layer to retrieve related records."),F.error(a),t.reject(a);
d=d.relatedTableId;if(!d)return a=new u("A related table ID is required on a layer to retrieve related records."),F.error(a),t.reject(a);d=f.url+"/"+d;var b=w.get(d),n=b?b:c._queryLayerInfo(d);b||w.set(d,n);g[a]=n});return t.eachAlways(g)};g.prototype._queryLayerInfo=function(f){return A(f,{query:{f:"json"}})};g.prototype._queryRelatedLayerFeatures=function(f,c){var g=D.getSourceLayer(f).layerId.toString(),d=c.layerInfo,a=c.queryTask,b=c.relation;if(g=this._getDestinationRelation(d,g)){var b=b.keyField,
n=g.keyField,g="string"===this._getDestinationFieldType(d,g)?n+"\x3d'"+f.attributes[b]+"'":n+"\x3d"+f.attributes[b];f=a.execute(new C({where:g,outFields:c.relatedFields}));c=c.outStatistics&&0<c.outStatistics.length&&d.supportsStatistics?a.execute(new C({where:g,outFields:c.relatedFields,outStatistics:c.outStatistics})):null;return t.eachAlways({features:f,statsFeatures:c?c:t.resolve()})}return t.resolve()};g.prototype._setRelatedFeatures=function(c,g){if(g=this.getRelatedInfo(g)){var f=c.value;f&&
(c=f.features,f=f.statsFeatures,c=c&&c.value,g.relatedFeatures=c?c.features:[],c=f&&f.value,g.relatedStatsFeatures=c?c.features:[])}};g.prototype._getRelation=function(c,g){if("feature"!==g.type)return null;var f=null;g.relationships.some(function(d){if(d.id===parseInt(c,10))return f=d,!0});return f};g.prototype._createRelatedInfo=function(c,g){var f=this._getRelation(c,g);if(f){g=g.url+"/"+f.relatedTableId;var d=new H({url:g}),f={url:g,queryTask:d,relation:f,relatedFields:[],outStatistics:[]};this.relatedInfos.set(c,
f);return f}};g.prototype._getDestinationRelation=function(c,g){var f;c&&c.relationships&&c.relationships.some(function(d){if(""+d.relatedTableId===g)return f=d,!0});return f};g.prototype._getDestinationFieldType=function(c,g){var f=void 0;c.fields.some(function(c){if(c.name===g.keyField)return f=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(c.type)?"number":"string",!0});return f};c([r.aliasOf("relatedInfos.size")],g.prototype,"relatedInfoCount",
void 0);c([r.property()],g.prototype,"relatedInfos",void 0);return g=c([r.subclass("esri.widgets.Popup.support.RelatedFeatures")],g)}(r.declared(q))})},"esri/widgets/Feature/support/attachmentUtils":function(){define(["require","exports"],function(z,k){Object.defineProperty(k,"__esModule",{value:!0});var h=z.toUrl("../../../themes/base/images/files/");k.isSupportedImage=function(c){c=c.toLowerCase();return"image/bmp"===c||"image/emf"===c||"image/exif"===c||"image/gif"===c||"image/x-icon"===c||"image/jpeg"===
c||"image/png"===c||"image/tiff"===c||"image/x-wmf"===c};k.getIconPath=function(c){return c?"text/plain"===c?h+"text-32.svg":"application/pdf"===c?h+"pdf-32.svg":"text/csv"===c?h+"csv-32.svg":"application/gpx+xml"===c?h+"gpx-32.svg":"application/x-dwf"===c?h+"cad-32.svg":"application/postscript"===c||"application/json"===c||"text/xml"===c||"model/vrml"===c?h+"code-32.svg":"application/x-zip-compressed"===c||"application/x-7z-compressed"===c||"application/x-gzip"===c||"application/x-tar"===c||"application/x-gtar"===
c||"application/x-bzip2"===c||"application/gzip"===c||"application/x-compress"===c||"application/x-apple-diskimage"===c||"application/x-rar-compressed"===c||"application/zip"===c?h+"zip-32.svg":-1!==c.indexOf("image/")?h+"image-32.svg":-1!==c.indexOf("audio/")?h+"sound-32.svg":-1!==c.indexOf("video/")?h+"video-32.svg":-1!==c.indexOf("msexcel")||-1!==c.indexOf("ms-excel")||-1!==c.indexOf("spreadsheetml")?h+"excel-32.svg":-1!==c.indexOf("msword")||-1!==c.indexOf("ms-word")||-1!==c.indexOf("wordprocessingml")?
h+"word-32.svg":-1!==c.indexOf("powerpoint")||-1!==c.indexOf("presentationml")?h+"report-32.svg":h+"generic-32.svg":h+"generic-32.svg"}})},"esri/widgets/support/chartUtils":function(){define(["require","exports","dojo/_base/kernel","../../core/promiseUtils"],function(z,k,h,c){function A(){var c=h.locale;if(!c)return"en_US";var t;if(!(t=k.locales[c])){c=c.split("-")[0].toLowerCase();t=null;for(var r=0,q=Object.keys(k.locales);r<q.length;r++){var u=q[r];if(-1<u.indexOf(c)){t=k.locales[u];break}}}return t||
"en_US"}Object.defineProperty(k,"__esModule",{value:!0});k.locales={ar:"ar","bs-ba":"bs_BA","ca-es":"ca_ES","cs-cz":"cs_CZ","da-dk":"da_DK","de-ch":"de_CH","de-de":"de_DE","el-gr":"el_GR","en-ca":"en_CA","en-us":"en_US","es-es":"es_ES","et-ee":"et_EE","fi-fi":"fi_FI","fr-fr":"fr_FR","he-il":"he_IL","hi-in":"hi_IN","hr-hr":"hr_HR","hu-hu":"hu_HU","id-id":"id_ID","it-it":"it_IT","ja-jp":"ja_JP","ko-kr":"ko_KR","lt-lt":"lt_LT","lv-lv":"lv_LV","nb-no":"nb_NO","nl-nl":"nl_NL","pl-pl":"pl_PL","pt-br":"pt_BR",
"pt-pt":"pt_PT","ro-ro":"ro_RO","ru-ru":"ru_RU","sl-sl":"sl_SL","sr-rs":"sr_RS","sv-se":"sv_SE","th-th":"th_TH","tr-tr":"tr_TR","uk-ua":"uk_UA","vi-vn":"vi_VN","zh-cn":"zh_Hans","zh-hk":"zh_Hant","zh-tw":"zh_Hant"};k.getChartLocale=A;var q,u=null;k.loadChartsModule=function(h){void 0===h&&(h=A());if(h===q)return u;var k=["../../libs/amcharts4/index","../../libs/amcharts4/lang/"+h];"function"!==typeof Object.assign&&k.push("@dojo/framework/shim/object");q=h;return u=c.create(function(c){return z(k,
function(k,u,t){var r=k.am4core;h===q&&(r.options.defaultLocale=u.default);t&&Object.defineProperty(Object,"assign",{value:t.assign,writable:!0,configurable:!0});c(k)})})}})},"esri/widgets/support/uriUtils":function(){define(["require","exports","dojo/i18n!./nls/uriUtils","../../core/lang"],function(z,k,h,c){function A(c){var h=null;q.some(function(k){k.pattern.test(c)&&(h=k);return!!h});return h}Object.defineProperty(k,"__esModule",{value:!0});var q=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,
target:"_blank",label:h.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:h.openInApp,
appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:h.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,
label:h.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Microsoft Power Bi"}];k.autoLink=function(h){if("string"!==typeof h||!h)return h;var k=A(h);if(!k)return h;var q=h.match(k.pattern),q=c.substitute({appName:k.appName,hierPart:q&&q[2]},k.label);return h.replace(k.pattern,
"\x3ca "+(k.target?'target\x3d"'+k.target+'"':"")+'" href\x3d"$1"\x3e'+q+"\x3c/a\x3e")}})},"*now":function(z){z(['dojo/i18n!*preload*esri/widgets/nls/Feature*["ar","bs","ca","cs","da","de","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/i18n!./Feature/nls/Feature dojo/keys ../core/lang ../core/watchUtils ../core/accessorSupport/decorators ../layers/support/exifUtils ./Widget ./Feature/FeatureViewModel ./Feature/support/attachmentUtils ./Feature/support/featureUtils ./support/chartUtils ./support/uriUtils ./support/widget".split(" "),function(z,k,h,c,A,q,u,B,t,r,H,C,E,D,w,F,y,g){function f(c,d){return void 0===
d?"esri-feature__"+c:"esri-feature__"+c+"-"+d}var l={title:!0,content:!0,lastEditedInfo:!0};return function(k){function d(a){a=k.call(this)||this;a._chartMap=new Map;a._activeMediaMap=new Map;a._refreshTimers=new Map;a._mediaInfo=new Map;a.graphic=null;a.defaultPopupTemplateEnabled=!1;a.spatialReference=null;a.title=null;a.visibleElements=A({},l);a.map=null;a.viewModel=new E;return a}h(d,k);d.prototype.postInitialize=function(){var a=this;this.own(t.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))};
d.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();this._activeMediaMap=null;this._destroyCharts()};d.prototype.castVisibleElements=function(a){return A({},l,a)};d.prototype.render=function(){var a=g.tsx("div",{key:f("loading-container"),class:"esri-feature__loading-container"},g.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})),b=this.visibleElements,c=this.viewModel,d=c.waitingForContent,c=c.title,
c=b.title?g.tsx("h4",{class:"esri-feature__title",innerHTML:c}):null,b=b.content?g.tsx("div",{class:"esri-feature__main-container"},[this._renderContent(),this._renderLastEditInfo()]):null;return g.tsx("div",{class:this.classes("esri-feature","esri-widget")},g.tsx("div",{class:"esri-feature__size-container"},c,d?a:b))};d.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};d.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};d.prototype.previousMedia=function(a){this._pageContentElementMedia(a,
"previous")};d.prototype._destroyCharts=function(){this._chartMap.forEach(function(a){return a.dispose()});this._chartMap.clear()};d.prototype._renderContent=function(){var a=this.viewModel.content;if(!a)return null;if("string"===typeof a)return g.tsx("div",{key:f("content-string"),innerHTML:a});if(g.isWidget(a))return g.tsx("div",{key:f("content-widget")},a.render());if(a instanceof HTMLElement)return g.tsx("div",{key:f("content-html-element"),bind:a,afterCreate:this._attachToNode});if(g.isWidgetBase(a))return g.tsx("div",
{key:f("content-dijit"),bind:a.domNode,afterCreate:this._attachToNode});if(Array.isArray(a))return a.length?g.tsx("div",{key:f("content-content-elements")},a.map(this._renderContentElement,this)):null};d.prototype._renderContentElement=function(a,b){var c=this.visibleElements;if("boolean"!==typeof c.content&&!c.content[a.type])return null;switch(a.type){case "attachments":return this._renderAttachments(a,b);case "fields":return this._renderFields(a,b);case "media":return this._renderMedia(a,b);case "text":return this._renderText(a,
b);default:return null}};d.prototype._renderAttachmentInfo=function(a){var b,c,d=a.attachmentInfo,f=a.supportsResizeAttachments,h=d.contentType;a=d.name;var k=d.url,l=H.getExifValue({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:d.exifInfo}),l=w.getOrientationStyles(l),r=f&&D.isSupportedImage(h),t=-1===k.indexOf("?")?"?":"\x26",h=r?""+k+t+"w\x3d48":D.getIconPath(h),r=(b={},b["esri-feature__attachment-item-mask--icon"]=!r,b);b=(c={},c["esri-feature__attachments-image--resizable"]=f,c);return g.tsx("li",
{class:"esri-feature__attachments-item",key:d},g.tsx("a",{class:"esri-feature__attachments-item-link",href:k,target:"_blank"},g.tsx("div",{class:this.classes(r,"esri-feature__attachment-item-mask")},g.tsx("img",{styles:l,alt:"",class:this.classes(b,"esri-feature__attachments-image"),src:h}),g.tsx("span",{class:"esri-feature__attachments-image-overlay"},g.tsx("span",{"aria-hidden":"true",class:"esri-feature__attachments-link-icon esri-icon-link-external"}))),g.tsx("span",{class:"esri-feature__attachments-filename"},
a||q.noTitle)))};d.prototype._renderAttachments=function(a,b){var c=this,d,h=a.displayType,k=(b=a.attachmentInfos)&&b.length,l=this.get("graphic.layer.capabilities.operations.supportsResizeAttachments"),h=(d={},d["esri-feature__attachments--list"]="preview"!==h,d["esri-feature__attachments--preview"]="preview"===h,d);return k?g.tsx("div",{key:f("attachments-element"),class:this.classes("esri-feature__attachments","esri-feature__content-element",h)},g.tsx("div",{class:"esri-feature__attachments-title"},
q.attach),g.tsx("ul",{class:"esri-feature__attachments-items"},b.map(function(b,d){return c._renderAttachmentInfo({attachmentInfo:b,attachmentInfoIndex:d,supportsResizeAttachments:l,contentElement:a})}))):null};d.prototype._forceLTR=function(a){return"\x26lrm;"+a};d.prototype._renderFieldInfo=function(a,b){var c,d=this.viewModel.formattedAttributes,h=d?d.content[b]||d.global:null,k=a.fieldName,d=a.label||k,h=h?null==h[k]?"":h[k]:"";a=!(!a.format||!a.format.dateFormat);h="number"!==typeof h||a?y.autoLink(h):
this._forceLTR(h);a=(c={},c["esri-feature__field-data--date"]=a,c);return g.tsx("tr",{key:f("fields-element-info-row",b)},g.tsx("th",{key:f("fields-element-info-row-header",b),class:"esri-feature__field-header",innerHTML:d}),g.tsx("td",{key:f("fields-element-info-row-data",b),class:this.classes("esri-feature__field-data",a),innerHTML:h}))};d.prototype._renderFields=function(a,b){var c=this;return(a=a.fieldInfos)?g.tsx("div",{key:f("fields-element",b),class:this.classes("esri-feature__fields","esri-feature__content-element")},
g.tsx("table",{class:"esri-widget__table",summary:q.fieldsSummary,key:f("fields-element-table",b)},g.tsx("tbody",{key:f("fields-element-table-body",b)},a.map(function(a){return c._renderFieldInfo(a,b)})))):null};d.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");if(a)return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};d.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};d.prototype._clearMediaRefreshTimer=
function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};d.prototype._getImageSource=function(a,b){var c=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var d=a[1],d=void 0===d?"":d;return""+a[0]+c+"timestamp\x3d"+b+(d?"#":"")+d};d.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var c=this._activeMediaMap.get(a);isNaN(c)&&(c=0);(b=b.mediaInfos[c])&&"image"===b.type&&b.refreshInterval&&
this._setRefreshTimeout(a,b)}};d.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,c){return a._setupMediaRefreshTimer(c)})};d.prototype._updateMediaInfoTimestamp=function(a,b){var c=Date.now();this._mediaInfo.set(b,{timestamp:c,sourceURL:this._getImageSource(a,c)});this.scheduleRender()};d.prototype._setRefreshTimeout=function(a,b){var c=this,d=b.refreshInterval,f=b.value;d&&(b=6E4*d,
this._updateMediaInfoTimestamp(f.sourceURL,a),b=setInterval(function(){c._updateMediaInfoTimestamp(f.sourceURL,a)},b),this._refreshTimers.set(a,b))};d.prototype._renderMediaInfoType=function(a){var b=a.mediaInfo,c=a.contentElementIndex;a=a.activeMediaIndex;var d=b.title,d=void 0===d?"":d;if("image"===b.type){var h=b.value,k=b.refreshInterval,l=h.sourceURL,b=h.linkURL,h=this._shouldOpenInNewTab(b)?"_blank":"_self",l=(k=k?this._mediaInfo.get(c):null)?k.sourceURL:l,c=g.tsx("img",{alt:d,key:f("media-image-"+
(k?k.timestamp:0)+"-"+c,a),src:l});return(a=b?g.tsx("a",{title:d,href:b,target:h},c):null)?a:c}if(-1!==b.type.indexOf("chart"))return g.tsx("div",{key:f("media-chart-"+c,a),bind:this,"data-media-info":b,"data-content-element-index":c,class:"esri-feature__media-chart",afterCreate:this._getChartDependencies})};d.prototype._getChartDependencies=function(a){var b=this,c=a["data-media-info"],d=a["data-content-element-index"],f=c.value,g=c.type;F.loadChartsModule().then(function(c){b._renderChart({chartDiv:a,
contentElementIndex:d,type:g,value:f,chartsModule:c})})};d.prototype._createPieChart=function(a){var b=a.chartsModule,c=b.am4charts;a=b.am4core.create(a.chartDiv,c.PieChart);c=a.series.push(new c.PieSeries);c.labels.template.disabled=!0;c.ticks.template.disabled=!0;c.dataFields.value="y";c.dataFields.category="x";return a};d.prototype._createXYChart=function(a){var b=a.type,c=a.value,d=a.chartsModule,f=d.am4core,d=d.am4charts;a=f.create(a.chartDiv,d.XYChart);c=15<c.series.length;if("column-chart"===
b){var g=a.xAxes.push(new d.CategoryAxis);g.dataFields.category="x";g.renderer.labels.template.disabled=!0;a.yAxes.push(new d.ValueAxis);g=a.series.push(new d.ColumnSeries);g.dataFields.valueY="y";g.dataFields.categoryX="x";a.cursor=new d.XYCursor;c&&(a.scrollbarX=new f.Scrollbar)}"bar-chart"===b&&(g=a.yAxes.push(new d.CategoryAxis),g.dataFields.category="x",g.renderer.inversed=!0,g.renderer.labels.template.disabled=!0,a.xAxes.push(new d.ValueAxis),g=a.series.push(new d.ColumnSeries),g.dataFields.valueX=
"y",g.dataFields.categoryY="x",a.cursor=new d.XYCursor,c&&(a.scrollbarY=new f.Scrollbar));"line-chart"===b&&(g=a.xAxes.push(new d.CategoryAxis),g.dataFields.category="x",g.renderer.labels.template.disabled=!0,a.yAxes.push(new d.ValueAxis),g=a.series.push(new d.LineSeries),g.dataFields.categoryX="x",g.dataFields.valueY="y",a.cursor=new d.XYCursor,c&&(a.scrollbarX=new f.Scrollbar));return a};d.prototype._renderChart=function(a){var b=a.contentElementIndex,c=a.type,d=a.value,f=a.chartsModule;f.am4core.useTheme(f.am4themes_animated);
a="pie-chart"===c?this._createPieChart(a):this._createXYChart(a);a.data=d.series.map(function(a){return{x:a.tooltip,y:a.y}});this._chartMap.set(b,a)};d.prototype._renderMediaInfo=function(a){var b=a.mediaInfo,c=a.contentElementIndex;a=this._renderMediaInfoType({mediaInfo:b,contentElementIndex:c,activeMediaIndex:a.activeMediaIndex});var d=b.title?g.tsx("div",{key:f("media-title",c),class:"esri-feature__media-item-title",innerHTML:b.title}):null,b=b.caption?g.tsx("div",{key:f("media-caption",c),class:"esri-feature__media-item-caption",
innerHTML:b.caption}):null;return g.tsx("div",{key:f("media-container",c),class:"esri-feature__media-item-container"},g.tsx("div",{key:f("media-item-container",c),class:"esri-feature__media-item"},a),d,b)};d.prototype._renderMediaPageButton=function(a,b){var c=(a="previous"===a)?q.previous:q.next,d=a?this.classes("esri-feature__button","esri-feature__media-previous"):this.classes("esri-feature__button","esri-feature__media-next"),h=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon",
"esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),k=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),l=a?this._previousClick:this._nextClick;return g.tsx("div",{key:f(a?"previous":"next",b),title:c,tabIndex:0,role:"button",class:d,"data-content-element-index":b,
bind:this,onkeydown:l,onclick:l},g.tsx("span",{"aria-hidden":"true",class:h}),g.tsx("span",{"aria-hidden":"true",class:k}),g.tsx("span",{class:"esri-icon-font-fallback-text"},c))};d.prototype._handleMediaKeyup=function(a){var b=a.currentTarget["data-content-element-index"],c=a.keyCode;c===u.LEFT_ARROW&&(a.stopPropagation(),this.previousMedia(b));c===u.RIGHT_ARROW&&(a.stopPropagation(),this.nextMedia(b))};d.prototype._renderMedia=function(a,b){var c,d=(a=a.mediaInfos)&&a.length||0,h=(c={},c["esri-feature--media-pagination-visible"]=
1<d,c);c=this._renderMediaPageButton("previous",b);var k=this._renderMediaPageButton("next",b),l=this._activeMediaMap.get(b);isNaN(l)&&(this._activeMediaMap.set(b,0),l=0);return d?g.tsx("div",{key:f("media-element",b),"data-content-element-index":b,bind:this,onkeyup:this._handleMediaKeyup,class:this.classes("esri-feature__media","esri-feature__content-element",h)},g.tsx("div",{key:f("media-element-container",b),class:"esri-feature__media-container"},c,this._renderMediaInfo({mediaInfo:a[l],contentElementIndex:b,
activeMediaIndex:l}),k)):null};d.prototype._renderLastEditInfo=function(){var a=this.visibleElements,b=this.viewModel.lastEditInfo;if(!b||!a.lastEditedInfo)return null;a=b.user;b=B.substitute({date:b.date,user:a},"edit"===b.type?a?q.lastEditedByUser:q.lastEdited:a?q.lastCreatedByUser:q.lastCreated);return g.tsx("div",{key:f("edit-info-element"),class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},b)};d.prototype._renderText=function(a,b){return a.text?g.tsx("div",
{key:f("text-element",b),innerHTML:a.text,class:this.classes("esri-feature__text","esri-feature__content-element")}):null};d.prototype._attachToNode=function(a){a.appendChild(this)};d.prototype._setContentElementMedia=function(a,b){this._clearMediaRefreshTimer(a);var c=this.viewModel.content;(c=(c=c&&c[a])&&c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};d.prototype._pageContentElementMedia=function(a,b){b="previous"===
b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};d.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};d.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};c([r.aliasOf("viewModel.graphic")],d.prototype,"graphic",void 0);c([r.aliasOf("viewModel.defaultPopupTemplateEnabled")],d.prototype,"defaultPopupTemplateEnabled",void 0);c([r.aliasOf("viewModel.spatialReference")],d.prototype,
"spatialReference",void 0);c([r.aliasOf("viewModel.title")],d.prototype,"title",void 0);c([r.property(),g.renderable()],d.prototype,"visibleElements",void 0);c([r.cast("visibleElements")],d.prototype,"castVisibleElements",null);c([r.aliasOf("viewModel.map")],d.prototype,"map",void 0);c([r.property({type:E}),g.renderable(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo"])],d.prototype,"viewModel",void 0);c([g.accessibleHandler()],d.prototype,"_previousClick",null);c([g.accessibleHandler()],
d.prototype,"_nextClick",null);return d=c([r.subclass("esri.widgets.Feature")],d)}(r.declared(C))});