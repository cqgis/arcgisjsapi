// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Accessor ../../core/accessorSupport/decorators ../../layers/support/fieldUtils ../visualVariables/ColorVariable ../visualVariables/OpacityVariable ../visualVariables/RotationVariable ../visualVariables/SizeVariable ../visualVariables/VisualVariable ../visualVariables/VisualVariableFactory ../../symbols/support/utils".split(" "),
function(D,E,u,k,q,r,v,h,m,w,x,y,z,A,B,p){function t(f){return f&&"opacity"in f?f.opacity*t(f.parent):1}var C={base:A,key:"type",typeMap:{opacity:x,color:w,rotation:y,size:z}};return function(f){function a(){var c=null!==f&&f.apply(this,arguments)||this;c._vvFactory=new B;return c}u(a,f);Object.defineProperty(a.prototype,"visualVariables",{set:function(c){this._vvFactory.visualVariables=c;this._set("visualVariables",this._vvFactory.visualVariables)},enumerable:!0,configurable:!0});a.prototype.readVisualVariables=
function(c,b,d){return this._vvFactory.readVariables(c,b,d)};a.prototype.writeVisualVariables=function(c,b,d,e){b[d]=this._vvFactory.writeVariables(c,e)};a.prototype.getDisplayedSymbol=function(c,b){return r(this,void 0,void 0,function(){var d,e,a,g,n,f,h,k,l;return q(this,function(m){if(!c)return[2];d=t(c.layer||c.sourceLayer);e=this.getSymbol(c);if(!e)return[2];e=e.clone();if(!this.visualVariables)return[2,e];a=this._vvFactory;g=a.colorVariables;n=a.opacityVariables;f=a.sizeVariables;h=a.rotationVariables;
k=!!g.length&&g[g.length-1].getColor(c,b);l=n.length?n[n.length-1].getOpacity(c,b):null;null!=d&&(l=null!=l?l*d:d);p.applyColorToSymbol(e,k,l);f.forEach(function(a){return p.applySizeToSymbol(e,a.getSize(c,b),a.axis)});h.forEach(function(a){return p.applyRotationToSymbol(e,a.getRotationAngle(c,b),a.axis)});return[2,e]})})};a.prototype.getVisualVariableValues=function(c,b){return this._vvFactory.getVisualVariableValues(c,b)};a.prototype.hasVisualVariables=function(c,b){return c?!!this.getVisualVariablesForType(c,
b):!!(this.getVisualVariablesForType("size",b)||this.getVisualVariablesForType("color",b)||this.getVisualVariablesForType("opacity",b)||this.getVisualVariablesForType("rotation",b))};a.prototype.getVisualVariablesForType=function(c,b){var a=this.visualVariables;if(a&&(a=a.filter(function(a){return a.type===c&&("string"===typeof b?a.target===b:!1===b?!a.target:!0)}),!a||0!==a.length))return a};a.prototype.getSize=function(a,b){return this._vvFactory.getSize(a,b)};a.prototype.getSizeRangeAtScale=function(a,
b,d){return a?a.getSizeRangeAtScale(b,d):this._vvFactory.getSizeRangeAtScale(b,d)};a.prototype.getColor=function(a,b){return this._vvFactory.getColor(a,b)};a.prototype.getOpacity=function(a,b){return this._vvFactory.getOpacity(a,b)};a.prototype.getRotationAngle=function(a,b){return this._vvFactory.getRotationAngle(a,b)};a.prototype.collectVVRequiredFields=function(a,b){return r(this,void 0,void 0,function(){var c,e,f,g;return q(this,function(d){switch(d.label){case 0:c=[],this.visualVariables&&(c=
c.concat(this.visualVariables)),e=0,f=c,d.label=1;case 1:if(!(e<f.length))return[3,4];g=f[e];if(!g)return[3,3];g.field&&m.collectField(a,b,g.field);g.normalizationField&&m.collectField(a,b,g.normalizationField);return g.valueExpression?[4,m.collectArcadeFieldNames(a,b,g.valueExpression)]:[3,3];case 2:d.sent(),d.label=3;case 3:return e++,[3,1];case 4:return[2]}})})};k([h.property({types:[C],value:null,json:{write:!0}})],a.prototype,"visualVariables",null);k([h.reader("visualVariables",["visualVariables",
"rotationType","rotationExpression"])],a.prototype,"readVisualVariables",null);k([h.writer("visualVariables")],a.prototype,"writeVisualVariables",null);return a=k([h.subclass("esri.renderers.mixins.VisualVariablesRenderer")],a)}(h.declared(v))});