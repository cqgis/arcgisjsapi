// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper dojo/i18n!../../nls/smartMapping ../.. ../../../pointCloudRenderers ../../../core/lang ../../../core/promiseUtils ./support/utils ../statistics/uniqueValues ../support/utils ../symbology/type ../../support/LegendOptions ../../support/utils".split(" "),function(N,k,t,D,E,F,x,g,e,y,h,u,G,v){function H(b){if(!b||!b.layer||!b.field&&!b.valueExpression)return g.reject(e.createError("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required"));
if(b.valueExpression&&!b.view)return g.reject(e.createError("type-renderer:missing-parameters","View is required when 'valueExpression' is specified"));var a=t({},b);a.symbolType=a.symbolType||"2d";a.numTypes=null==a.numTypes?10:a.numTypes;a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;a.sortBy=null==a.sortBy?"count":a.sortBy;a.sortEnabled=null==a.sortEnabled?!0:a.sortEnabled;a.statistics=x.clone(a.statistics);b=[0,2,1,3];var c=h.createLayerAdapter(a.layer,b);return(a.layer=
c)?c.load().then(function(){var b=c.geometryType,f=-1<a.symbolType.indexOf("3d");if("mesh"===b)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace",a.edgesType=a.edgesType||"none";else{if(f&&("polyline"===b||"polygon"===b))return g.reject(e.createError("type-renderer:not-supported","3d symbols are not supported for polyline and polygon layers"));if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))return g.reject(e.createError("type-renderer:invalid-parameters",
"'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'"))}b=h.getFieldsList({field:a.field,valueExpression:a.valueExpression});return(b=e.verifyBasicFieldValidity(c,b,"type-renderer:invalid-parameters"))?g.reject(b):a}):g.reject(e.createError("type-renderer:invalid-parameters","'layer' must be one of these types: "+h.getLayerTypeLabels(b).join(", ")))}function I(b){if(!(b&&b.layer&&b.field))return g.reject(e.createError("type-point-cloud-class-renderer:missing-parameters",
"'layer' and 'field' parameters are required"));var a=t({},b);a.statistics=x.clone(a.statistics);b=[4];var c=h.createLayerAdapter(a.layer,b);a.layer=c;a.density=a.density||25;a.size=a.size||"100%";return e.isValidPointSize(a.size)?c?c.load().then(function(){var b=h.getFieldsList({field:a.field});return(b=e.verifyBasicFieldValidity(c,b,"type-point-cloud-class-renderer:invalid-parameters"))?g.reject(b):a}):g.reject(e.createError("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+
h.getLayerTypeLabels(b).join(", "))):g.reject(e.createError("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'"))}function z(b){var a=b.typeScheme,c=b.basemap;a?a=u.cloneScheme(a):(a=(b=u.getSchemes({basemap:b.basemap,geometryType:b.geometryType,theme:b.theme,worldScale:b.worldScale,view:b.view}))&&b.primaryScheme,c=b&&b.basemapId);return{scheme:a,basemapId:c}}function A(b,a){return b.label<a.label?-1:b.label>a.label?1:0}function B(b,
a){return b.value<a.value?-1:b.value>a.value?1:0}function J(b,a){var c=a.count-b.count;0===c&&(c=A(b,a));return c}function K(b,a){var c=a.count-b.count;0===c&&(c=B(b,a));return c}function C(b,a,c){var d;"count"===a?(d=K,c&&c.codedValues&&(d=J)):"value"===a&&(d=B,c&&c.codedValues&&(d=A));d&&b.sort(d)}function L(b,a){b=b.uniqueValueInfos;var c=a.layer,d=a.field,f=d?c.getField(d):null,g=f?c.getFieldDomain(f.name):null,h=-1===a.numTypes?b.length:a.numTypes,l=c.geometryType,c=z({basemap:a.basemap,geometryType:l,
typeScheme:a.typeScheme,worldScale:-1<a.symbolType.indexOf("3d-volumetric"),view:a.view}),m=c.scheme,d=new E.UniqueValueRenderer({field:d}),k=-1,n,p={value:null,domain:g,fieldInfo:f};b.forEach(function(a,b){p.value=a.value;a.label=v.createUniqueValueLabel(p);null===a.value&&(k=b)});-1<k&&(n=b.splice(k,1)[0]);!1!==a.sortEnabled&&C(b,a.sortBy,g);f&&"date"===f.type&&(f=b.filter(function(a,b){return b<h}).map(function(a){return a.value}),p.dateFormatInterval=v.calculateDateFormatInterval(f));var w=e.createColors(m.colors,
b.length),q=e.getSymbolSizeFromScheme(m,l),r=e.getSymbolOutlineFromScheme(m,l);b.forEach(function(b,c){p.value=b.value;b.label=v.createUniqueValueLabel(p);b.symbol=e.createSymbol(l,{type:a.symbolType,color:w[c],size:q,outline:r,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}})});a.valueExpression&&(d.valueExpression=a.valueExpression,d.valueExpressionTitle=a.valueExpressionTitle);a.legendOptions&&(d.legendOptions=new G.LegendOptions(a.legendOptions));w=e.createColors(m.colors,h);for(f=
0;f<h;f++)(g=b[f])&&d.addUniqueValueInfo({value:g.value,label:g.label,symbol:e.createSymbol(l,{type:a.symbolType,color:w[f],size:q,outline:r,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}})});a.defaultSymbolEnabled&&(d.defaultSymbol=e.createSymbol(l,{type:a.symbolType,color:m.noDataColor,size:q,outline:r,meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}}),d.defaultLabel=D.other);n&&(n.symbol=e.createSymbol(l,{type:a.symbolType,color:m.noDataColor,size:q,outline:r,meshInfo:{colorMixMode:a.colorMixMode,
edgesType:a.edgesType}}),b.push(n));n=[];f=d.uniqueValueInfos.length===b.length?-1:d.uniqueValueInfos.length;if(-1<f)for(;f<b.length;f++)n.push(t({},b[f]));return{renderer:d,uniqueValueInfos:b,excludedUniqueValueInfos:n,typeScheme:u.cloneScheme(m),basemapId:c.basemapId}}function M(b,a){b=b.uniqueValueInfos;a=(a=z({basemap:"gray",theme:"point-cloud-class",geometryType:"point",typeScheme:a}))&&a.scheme;var c="point-cloud-class"===a.theme,d=c?a.colors:e.createColors(a.colors,b.length);C(b,"value");return b.map(function(a,
b){var e=a.value,f=null;c?(f=d[e])||(f=d[d.length-1]):f=d[b];return{values:[e],color:f,label:a.label}})}Object.defineProperty(k,"__esModule",{value:!0});k.createRenderer=function(b){return H(b).then(function(a){return(null!=a.statistics?g.resolve(a.statistics):y({layer:a.layer,field:a.field,valueExpression:a.valueExpression,returnAllCodedValues:a.returnAllCodedValues,view:a.view})).then(function(b){return L(b,a)})})};k.createPCClassRenderer=function(b){return I(b).then(function(a){return(null!=a.statistics?
g.resolve(a.statistics):y({layer:a.layer,field:a.field})).then(function(b){return{renderer:new F.PointCloudUniqueValueRenderer({field:a.field,pointsPerInch:a.density,pointSizeAlgorithm:e.getPointSizeAlgorithm(a.size),colorUniqueValueInfos:M(b,a.typeScheme)})}})})}});