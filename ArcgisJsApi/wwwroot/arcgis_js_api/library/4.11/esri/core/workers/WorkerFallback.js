// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define(["require","exports","../global","../has","./utils"],function(l,n,e,p,f){var m=function(){return function(){var a=this,b=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(c){a[c]=function(){for(var d=[],a=0;a<arguments.length;a++)d[a]=arguments[a];return b[c].apply(b,d)}})}}(),g=e.MutationObserver||e.WebKitMutationObserver,h=function(){var a;if(e.process&&e.process.nextTick)a=function(b){e.process.nextTick(b)};else if(e.Promise)a=
function(b){e.Promise.resolve().then(b)};else if(g){var b=[],c=document.createElement("div");(new g(function(){for(;0<b.length;)b.shift()()})).observe(c,{attributes:!0});a=function(a){b.push(a);c.setAttribute("queueStatus","1")}}return a}(),k=function(){var a=e.MessageEvent;try{new a("message",{data:null})}catch(b){return function(b,a){void 0===a&&(a={});var c=a.data,d=a.bubbles,d=void 0===d?!1:d;a=a.cancelable;a=void 0===a?!1:a;var e=document.createEvent("Event");e.initEvent(b,d,a);e.data=c;return e}}return function(b,
c){return new a(b,c)}}();return function(){function a(){this._dispatcher=new m;this._isInitialized=!1;this._workerPostMessage({type:f.MessageType.HANDSHAKE})}a.prototype.terminate=function(){};Object.defineProperty(a.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(a){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=a)&&this.addEventListener("message",a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"onerror",{get:function(){return this._onerrorHandler},set:function(a){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=a)&&this.addEventListener("error",a)},enumerable:!0,configurable:!0});a.prototype.postMessage=function(a,c){var b=this;h(function(){b._workerMessageHandler(k("message",{data:a}))})};a.prototype.dispatchEvent=function(a){return this._dispatcher.dispatchEvent(a)};a.prototype.addEventListener=function(a,c,d){this._dispatcher.addEventListener(a,
c,d)};a.prototype.removeEventListener=function(a,c,d){this._dispatcher.removeEventListener(a,c,d)};a.prototype._workerPostMessage=function(a,c){var b=this;h(function(){b.dispatchEvent(k("message",{data:a}))})};a.prototype._workerMessageHandler=function(a){var b=this;if(a=f.receiveMessage(a)){var d=a.jobId;switch(a.type){case f.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:f.MessageType.CONFIGURED});break;case f.MessageType.OPEN:l(["esri/core/workers/RemoteClient",a.modulePath],
function(a,c){a=a.connect(c);b._workerPostMessage({type:f.MessageType.OPENED,jobId:d,data:a})})}}};return a}()});