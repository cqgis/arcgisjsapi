// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define(["require","exports","dojo/Deferred","dojo/promise/all","./Error"],function(r,e,h,n,k){function f(a,b){var d=new h(b);try{a(function(a){return p(a).then(d.resolve)},d.reject)}catch(c){d.reject(c)}return d.promise}function l(a){if(a){if("function"!==typeof a.forEach){var b=Object.keys(a),d=b.map(function(b){return a[b]});return l(d).then(function(a){var d={};b.forEach(function(b,c){return d[b]=a[c]});return d})}var c=null,q=g;return f(function(b,d){var e=[],m=a.length;0===m&&b(e);a.forEach(function(a){var f=
{promise:a||q(a)};e.push(f);f.promise.then(function(a){f.value=a}).catch(function(a){f.error=a}).then(function(){--m;0===m&&(c?d(new k("AbortError",c)):b(e))})})},function(b){c=b||"Invocation cancellation";a.forEach(function(a){return a.cancel(b)})})}}function g(a){void 0===a&&(a=void 0);var b=new h;b.resolve(a);return b.promise}function p(a){return a&&"object"===typeof a&&"then"in a&&"function"===typeof a.then?a:g(a)}Object.defineProperty(e,"__esModule",{value:!0});e.all=function(a){return n(a)};
e.filter=function(a,b){var d=a.slice();return n(a.map(function(a,d){return b(a,d)})).then(function(a){return d.filter(function(b,d){return a[d]})})};e.create=f;e.createDeferred=function(a){var b=null;a=f(function(a,c){b={resolve:a,reject:c}},a);b.promise=a;b.cancel=function(){var a=new k("AbortError","AbortError");a.dojoType="cancel";b.reject(a)};return b};e.eachAlways=l;e.eachAlwaysValues=function(a){return l(a).then(function(a){return a.filter(function(a){return!!a.value}).map(function(a){return a.value})})};
e.first=function(a){return a&&a.length?f(function(b,d){for(var c=0;c<a.length;c++)a[c].then(b,d)}):g()};e.reject=function(a){var b=new h;b.reject(a);return b.promise};e.resolve=g;e.after=function(a,b){void 0===b&&(b=void 0);var d=0;return f(function(c){d=setTimeout(function(){c(b)},a)},function(){d&&(clearTimeout(d),d=0)})};e.timeout=function(a,b,d){var c=0,e=new h(a.cancel);a.then(function(a){e.isFulfilled()||(e.resolve(a),c&&(clearTimeout(c),c=0))});a.catch(function(a){e.isFulfilled()||(e.reject(a),
c&&(clearTimeout(c),c=0))});c=setTimeout(function(){var a=d||new k("promiseUtils:timeout","The wrapped promise did not resolve within "+b+" ms");e.reject(a)},b);return e.promise};e.wrapCallback=function(a){var b=!1;return f(function(){a(function(a){b||g(a)})},function(){return b=!0})};e.isThenable=function(a){return a&&"function"===typeof a.then};e.when=p;e.createResolver=function(a){var b,d;a=f(function(a,c){b=a;d=c},a);var c=function(a){b(a)};c.resolve=function(a){return b(a)};c.reject=function(a){return d(a)};
c.promise=a;return c}});