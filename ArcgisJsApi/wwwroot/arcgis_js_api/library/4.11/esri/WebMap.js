// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
require({cache:{"esri/webmap/Bookmark":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../geometry/Extent ../webdoc/support/Thumbnail".split(" "),function(p,q,n,g,d,e,m,h,l){return function(f){function a(a){a=f.call(this)||this;a.extent=null;a.name=null;a.thumbnail=new l.default;return a}n(a,f);a.prototype.castThumbnail=function(a){return"string"===typeof a?
new l.default({url:a}):m.ensureType(l.default,a)};g([e.property({type:h})],a.prototype,"extent",void 0);g([e.property()],a.prototype,"name",void 0);g([e.property({type:l.default})],a.prototype,"thumbnail",void 0);g([e.cast("thumbnail")],a.prototype,"castThumbnail",null);return a=g([e.subclass("esri.webmap.Bookmark")],a)}(e.declared(d))})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(p,q,n,g,d,e){Object.defineProperty(q,"__esModule",{value:!0});p=function(d){function h(){var f=null!==d&&d.apply(this,arguments)||this;f.url="";return f}n(h,d);l=h;h.prototype.clone=function(){return new l({url:this.url})};var l;g([e.property({type:String,json:{write:{isRequired:!0}}})],h.prototype,"url",void 0);return h=l=g([e.subclass("esri.webdoc.support.Thumbnail")],h)}(e.declared(d));q.default=p})},"esri/webmap/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./background/ColorBackground".split(" "),
function(p,q,n,g,d,e,m,h,l){return function(f){function a(a){a=f.call(this,a)||this;a.background=null;a.spatialReference=null;a.viewpoint=null;return a}n(a,f);e=a;a.prototype.clone=function(){return new e({background:this.background?this.background.clone():null,spatialReference:this.spatialReference?this.spatialReference.clone():null,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var e;g([m.property({type:l})],a.prototype,"background",void 0);g([m.property({type:h})],a.prototype,"spatialReference",
void 0);g([m.property({type:d})],a.prototype,"viewpoint",void 0);return a=e=g([m.subclass("esri.webmap.InitialViewProperties")],a)}(m.declared(e))})},"esri/webmap/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(p,q,n,g,d,e,m,h){return function(d){function f(a){a=d.call(this)||this;
a.type="color";a.color=new e([0,0,0,1]);return a}n(f,d);a=f;f.prototype.clone=function(){return new a({color:this.color&&this.color.clone()||null})};var a;g([h.enumeration.serializable()({color:"color"})],f.prototype,"type",void 0);g([h.property({type:e})],f.prototype,"color",void 0);return f=a=g([h.subclass("esri.webmap.background.ColorBackground")],f)}(h.declared(m))})},"*noref":1}});
define("require exports ./core/tsSupport/assignHelper ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./Map ./Viewpoint ./core/asyncUtils ./core/Collection ./core/Error ./core/JSONSupport ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/accessorSupport/decorators ./geometry/SpatialReference ./geometry/support/webMercatorUtils ./portal/Portal ./portal/PortalItem ./portal/support/geometryServiceUtils ./tasks/support/ProjectParameters ./webmap/Bookmark ./webmap/InitialViewProperties ./webmap/background/ColorBackground".split(" "),function(p,
q,n,g,d,e,m,h,l,f,a,w,x,y,r,k,z,A,u,B,C,D,E,t,F){var v=l.ofType(E),G=y.getLogger("esri.WebMap");return function(a){function c(b){b=a.call(this)||this;b.applicationProperties=null;b.authoringApp=null;b.authoringAppVersion=null;b.bookmarks=new v;b.initialViewProperties=null;b.portalItem=null;b.presentation=null;b.sourceVersion=null;b.tables=null;b.widgets=null;return b}g(c,a);e=c;c.prototype.initialize=function(){this.when().catch(function(b){G.error("#load()","Failed to load web map",b)});if(this.resourceInfo){var b=
void 0;try{b=this._validateJSON(this.resourceInfo)}catch(H){this.addResolvingPromise(r.reject(H));return}this.read(b)}};c.prototype.readInitialViewProperties=function(b,a){b={};a.background&&(b.background=F.fromJSON(a.background));a.spatialReference&&(b.spatialReference=z.fromJSON(a.spatialReference));return new t(b)};c.prototype.readSourceVersion=function(b,a){b=a.version.split(".");a=b[1];return{major:parseInt(b[0],10),minor:parseInt(a,10)}};c.prototype.load=function(){this.addResolvingPromise(this._loadFromSource());
return this.when()};c.prototype.loadAll=function(){var b=this;return h.safeCast(x.loadAll(this,function(a){a(b.ground,b.basemap,b.layers)}))};c.prototype.toJSON=function(){throw new f("internal:not-yet-implemented","WebMap.toJSON is not yet implemented");};c.fromJSON=function(b){if(!b)return null;if(b.declaredClass)throw Error("JSON object is already hydrated");return new e({resourceInfo:b})};c.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-map"}):
this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):r.resolve(null)};c.prototype._loadFromItem=function(b){var a=this;return b.load().catch(function(b){throw new f("webmap:load-portal-item","Failed to load portal item",{error:b});}).then(function(){if("Web Map"!==b.type)throw new f("webmap:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Map'",{type:b.type});}).then(function(){return b.fetchData()}).then(function(c){a.resourceInfo=c;return a._readAndLoadFromJSON(c,
{origin:"web-map",portal:b.portal||u.getDefault()})}).then(function(){return a._getInitialExtent()}).then(function(b){if(b){var c=a.initialViewProperties?a.initialViewProperties.clone():new t;c.viewpoint=new m;c.viewpoint.targetGeometry=b;a.initialViewProperties=c}})};c.prototype._readAndLoadFromJSON=function(b,a){b=this._validateJSON(b);this.read(b,a);return this._loadFromJSON(b,a)};c.prototype._validateJSON=function(b){b=this._sanitizeJSON(b);var a=this._validateVersion(b.version);b.version=a.major+
"."+a.minor;return b};c.prototype._sanitizeJSON=function(b){return{authoringApp:b.authoringApp||"",authoringAppVersion:b.authoringAppVersion||"",applicationProperties:b.applicationProperties,background:b.background,baseMap:b.baseMap,bookmarks:b.bookmarks,operationalLayers:b.operationalLayers,presentation:b.presentation,spatialReference:b.spatialReference,tables:b.tables,version:b.version||"0.0",widgets:b.widgets}};c.prototype._validateVersion=function(b){var a=b.split("."),c=a[0],a=a[1],d=/^\s*\d+\s*$/;
if(!d.test(c))throw new f("webmap:invalid-version","Expected major version to be a number, but got '"+b+"'",{version:b});if(!d.test(a))throw new f("webmap:invalid-version","Expected minor version to be a number, but got '"+b+"'",{version:b});c=parseInt(c,10);a=parseInt(a,10);if(2!==c)throw new f("webmap:unsupported-version","Required major version is '2', but got '"+c+"'",{version:b});return{major:c,minor:a}};c.prototype._loadFromJSON=function(b,a){var c=this,d={context:n({},a,{layerContainerType:"operational-layers"})};
this.portalItem&&(d.context.portal=this.portalItem.portal||u.getDefault());return r.create(function(a){return p(["./portal/support/layersCreator"],a)}).then(function(a){var e=[],f=b.operationalLayers;f&&f.length&&e.push(h.safeCast(a.populateOperationalLayers(c.layers,f,d)));return r.eachAlways(e).then(function(){})})};c.prototype._getInitialExtent=function(){var a=null,c=this.initialViewProperties&&this.initialViewProperties.spatialReference,d=this.portalItem&&this.portalItem.extent;if(c&&d)if(c.isWGS84)a=
d.clone();else if(c.isWebMercator)a=A.geographicToWebMercator(d);else return C.create(this.portalItem).then(function(a){var b=new D;b.geometries=[d];b.outSpatialReference=c;return a.project(b)}).then(function(a){return a[0]}).catch(function(a){console.log("Error projecting item's extent:",a);return null});return r.resolve(a)};var e;d([k.property()],c.prototype,"applicationProperties",void 0);d([k.property()],c.prototype,"authoringApp",void 0);d([k.property()],c.prototype,"authoringAppVersion",void 0);
d([k.property({json:{read:{source:"baseMap"}}})],c.prototype,"basemap",void 0);d([k.property({type:v})],c.prototype,"bookmarks",void 0);d([k.property({type:t})],c.prototype,"initialViewProperties",void 0);d([k.reader("initialViewProperties",["spatialReference","background"])],c.prototype,"readInitialViewProperties",null);d([k.property({type:B})],c.prototype,"portalItem",void 0);d([k.property()],c.prototype,"presentation",void 0);d([k.property()],c.prototype,"resourceInfo",void 0);d([k.property({readOnly:!0})],
c.prototype,"sourceVersion",void 0);d([k.reader("sourceVersion",["version"])],c.prototype,"readSourceVersion",null);d([k.property()],c.prototype,"tables",void 0);d([k.property()],c.prototype,"widgets",void 0);return c=e=d([k.subclass("esri.WebMap")],c)}(k.declared(e,w,a))});