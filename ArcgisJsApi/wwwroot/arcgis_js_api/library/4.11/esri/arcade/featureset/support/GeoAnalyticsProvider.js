// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../request","../../../core/promiseUtils"],function(k,l,h,f){return function(){function g(c){this.url=c}g.prototype.extendScriptWithGlobals=function(c,d){var b={newscript:"",newglobals:[]},e;for(e in d){var a=d[e];"geometry"===a.type?b.newscript+="var "+a.name+"\x3d "+(null===a.params.value?"null;\n":"Geometry("+JSON.stringify(a.params.value.toJSON())+");\n"):"FeatureLayer"===a.type?(a={name:a.name,value:a.params.url,filter:a.params.definitionExpression,type:"FeatureLayer"},
0===a.value.indexOf("//")&&(a.value=document.location.protocol+a.value),b.newglobals.push(a)):"BigDataCatalogShare"===a.type&&(a={name:a.name,value:a.params.url,filter:a.params.definitionExpression,type:"FeatureLayer"},0===a.value.indexOf("//")&&(a.value=document.location.protocol+a.value),b.newglobals.push(a))}b.newscript+=c;return b};g.prototype.executeScript=function(c,d,b){c=this.extendScriptWithGlobals(c,d);b={f:"json",sref:null===b?"":JSON.stringify(b.toJSON()),vars:JSON.stringify(c.newglobals),
script:c.newscript};return h(this.url,{method:"auto",responseType:"json",query:b}).then(function(b){return void 0!==b.data?b.data.error?f.reject(Error(b.data.error)):null:b.error?f.reject(Error(b.error)):null})};g.prototype.executeFeatureSetPageRequest=function(c,d,b,e){c=this.extendScriptWithGlobals(c,d);b={f:"json",sref:null===b?"":JSON.stringify(b.toJSON()),vars:JSON.stringify(c.newglobals),script:c.newscript};return""!==e?f.resolve({moniker:e,records:[]}):h(this.url,{method:"auto",responseType:"json",
query:b}).then(function(a){return a.data.error?f.reject(Error(a.data.error)):null})};return g}()});