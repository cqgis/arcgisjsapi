// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../support/FeatureSet ../support/IdSet ../support/OrderbyClause ../../../core/promiseUtils".split(" "),function(q,r,n,l,h,p,k){var m=function(f){function c(a){var b=f.call(this,a)||this;b._orderbyclause=null;b.declaredClass="esri.arcade.featureset.actions.OrderBy";b._maxProcessing=100;b._orderbyclause=a.orderbyclause;b._parent=a.parentfeatureset;return b}n(c,f);c.prototype._getSet=function(a){var b=this;return null===this._wset?this._ensureLoaded().then(function(){return b._getFilteredSet("",
null,null,b._orderbyclause,a)}).then(function(e){b._checkCancelled(a);b._wset=e;return b._wset}):k.resolve(this._wset)};c.prototype.manualOrderSet=function(a,b){var e=this;return this.getIdColumnDictionary(a,[],-1,b).then(function(a){e._orderbyclause.order(a);for(var b=new h([],[],!0,null),d=0;d<a.length;d++)b._known.push(a[d].id);return b})};c.prototype.getIdColumnDictionary=function(a,b,e,d){var c=this;if(e<a._known.length-1){var g=this._maxQueryRate();return"GETPAGES"===a._known[e+1]?this._parent._expandPagedSet(a,
g,0,0,d).then(function(g){return c.getIdColumnDictionary(a,b,e,d)}):this._parent._getFeature(a,a._known[e+1],d).then(function(g){e+=1;c._checkCancelled(d);b.push({id:a._known[e],feature:g});return c.getIdColumnDictionary(a,b,e,d)})}return 0<a._candidates.length?this._refineSetBlock(a,this._maxProcessingRate(),d).then(function(){c._checkCancelled(d);return c.getIdColumnDictionary(a,b,e,d)}):k.resolve(b)};c.prototype._isInFeatureSet=function(a){return this._parent._isInFeatureSet(a)};c.prototype._getFeatures=
function(a,b,e,c){return this._parent._getFeatures(a,b,e,c)};c.prototype._featureFromCache=function(a){if(void 0===this._featureCache[a]){var b=this._parent._featureFromCache(a);return void 0===b?void 0:null===b?null:this._featureCache[a]=b}return this._featureCache[a]};c.prototype._fetchAndRefineFeatures=function(a,b,e){return k.reject(Error("Fetch and Refine should not be called in this featureset"))};c.prototype._getFilteredSet=function(a,b,e,c,f){var d=this;return this._ensureLoaded().then(function(){return d._parent._getFilteredSet(a,
b,e,null===c?d._orderbyclause:c,f)}).then(function(a){d._checkCancelled(f);var c;c=new h(a._candidates.slice(0),a._known.slice(0),a._ordered,d._clonePageDefinition(a.pagesDefinition));var g=!0;0<a._candidates.length&&(g=!1);return!1===c._ordered?d.manualOrderSet(c,f).then(function(a){!1!==g||null===b&&null===e||(a=new h(a._candidates.slice(0).concat(a._known.slice(0)),[],a._ordered,d._clonePageDefinition(a.pagesDefinition)));return a}):c})};c.prototype.arcadeScriptStep=function(a,b,c){a=this.arcadeAssignNextScriptStepIdentifiers(c);
b=this._orderbyclause.constructClause();return"var "+a.newFeatureSet+" \x3d "+this.bigDataCachePipeline("orderby( "+a.currentFeatureSet+',"'+b+'")')+";"};return c}(l);l._featuresetFunctions.orderBy=function(f){return""===f?this:new m({parentfeatureset:this,orderbyclause:new p(f)})};return m});