// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../Dictionary ../Feature ../featureSetCollection ../featureSetUtils ../languageUtils ../featureset/actions/AttributeFilter ../featureset/actions/OrderBy ../featureset/actions/Top ../featureset/sources/FeatureLayerMemory ../featureset/support/OrderbyClause ../featureset/support/WhereClause ../../core/promiseUtils ../../layers/FeatureLayer".split(" "),function(F,q,r,t,u,v,e,w,z,A,B,C,D,m,E){function c(a,l,c){void 0===c&&(c=null);for(var d in a)if(d.toLowerCase()===l.toLowerCase())return a[d];
return c}function x(a){if(null===a)return null;var l={type:c(a,"type",""),name:c(a,"name","")};if("range"===l.type)l.range=c(a,"range",[]);else{l.codedValues=[];var e=0;for(a=c(a,"codedValues",[]);e<a.length;e++){var d=a[e];l.codedValues.push({name:c(d,"name",""),code:c(d,"code",null)})}}return l}function p(a){if(null===a)return null;var l={},e=c(a,"wkt",null);null!==e&&(l.wkt=e);a=c(a,"wkid",null);null!==a&&(l.wkid=a);return l}function y(a){if(null===a)return null;var e={hasZ:c(a,"hasz",!1),hasM:c(a,
"hasm",!1)},f=c(a,"spatialreference",null);f&&(e.spatialReference=p(f));f=c(a,"x",null);if(null!==f)return e.x=f,e.y=c(a,"y",null),e;f=c(a,"rings",null);if(null!==f)return e.rings=f,e;f=c(a,"paths",null);if(null!==f)return e.paths=f,e;f=c(a,"points",null);if(null!==f)return e.points=f,e;for(var f=0,d="xmin xmax ymin ymax zmin zmax mmin mmax".split(" ");f<d.length;f++){var h=d[f],b=c(a,h,null);null!==b&&(e[h]=b)}return e}Object.defineProperty(q,"__esModule",{value:!0});q.registerFunctions=function(a){"async"===
a.mode&&(a.functions.featuresetbyid=function(c,f){return a.standardFunctionAsync(c,f,function(d,h,b){e.pcCheck(b,2,4);if(b[0]instanceof u){d=e.toString(b[1]);h=e.defaultUndefined(b[2],null);var g=e.toBoolean(e.defaultUndefined(b[3],!0));null===h&&(h=["*"]);if(!1===e.isArray(h))throw Error("Invalid Parameter");return b[0].featureSetById(d,g,h)}throw Error("Invalid Parameter");})},a.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),a.functions.featuresetbyportalitem=function(c,f){return a.standardFunctionAsync(c,
f,function(d,h,b){e.pcCheck(b,2,4);d=e.toString(b[0]);h=e.toString(b[1]);var g=e.defaultUndefined(b[2],null);b=e.toBoolean(e.defaultUndefined(b[3],!0));null===g&&(g=["*"]);if(!1===e.isArray(g))throw Error("Invalid Parameter");if(c.services&&c.services.portal)return v.constructFeatureSetFromPortalItem(d,h,c.spatialReference,g,b,c.services.portal,c.lrucache);throw Error("Portal is required");})},a.signatures.push({name:"featuresetbyportalitem",min:"2",max:"4"}),a.functions.featuresetbyname=function(c,
f){return a.standardFunctionAsync(c,f,function(d,c,b){e.pcCheck(b,2,4);if(b[0]instanceof u){d=e.toString(b[1]);c=e.defaultUndefined(b[2],null);var g=e.toBoolean(e.defaultUndefined(b[3],!0));null===c&&(c=["*"]);if(!1===e.isArray(c))throw Error("Invalid Parameter");return b[0].featureSetByName(d,g,c)}throw Error("Invalid Parameter");})},a.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),a.functions.featureset=function(l,f){return a.standardFunction(l,f,function(d,a,b){e.pcCheck(b,1,1);a=b[0];
d={layerDefinition:{geometryType:"",objectIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(e.isString(a))a=JSON.parse(a),void 0!==a.layerDefinition?(d.layerDefinition=a.layerDefinition,d.featureSet=a.featureSet,a.layerDefinition.spatialReference&&(d.layerDefinition.spatialReference=a.layerDefinition.spatialReference)):(d.featureSet.features=a.features,d.featureSet.geometryType=a.geometryType,d.layerDefinition.geometryType=d.featureSet.geometryType,d.layerDefinition.objectIdField=
a.objectIdFieldName,d.layerDefinition.typeIdField=a.typeIdFieldName,d.layerDefinition.fields=a.fields,a.spatialReference&&(d.layerDefinition.spatialReference=a.spatialReference));else if(b[0]instanceof r){a=JSON.parse(b[0].castToText());var g=c(a,"layerdefinition");if(null!==g){d.layerDefinition.geometryType=c(g,"geometrytype","");d.featureSet.geometryType=d.layerDefinition.geometryType;d.layerDefinition.objectIdField=c(g,"objectidfield","");d.layerDefinition.typeIdField=c(g,"typeidfield","");if(b=
c(g,"spatialreference",null))d.layerDefinition.spatialReference=p(b);b=0;for(var f=c(g,"fields",[]);b<f.length;b++)g=f[b],g={name:c(g,"name",""),alias:c(g,"alias",""),type:c(g,"type",""),nullable:c(g,"nullable",!0),editable:c(g,"editable",!0),length:c(g,"length",null),domain:x(c(g,"domain"))},d.layerDefinition.fields.push(g);if(a=c(a,"featureset",null)){b={};g=0;for(f=d.layerDefinition.fields;g<f.length;g++){var k=f[g];b[k.name.toLowerCase()]=k.name}for(var h=0,n=c(a,"features",[]);h<n.length;h++){a=
n[h];g={};f=c(a,"attributes",{});for(k in f)g[b[k.toLowerCase()]]=f[k];d.featureSet.features.push({attributes:g,geometry:y(c(a,"geometry",null))})}}}else{d.layerDefinition.geometryType=c(a,"geometrytype","");d.featureSet.geometryType=d.layerDefinition.geometryType;d.layerDefinition.objectIdField=c(a,"objectidfieldname","");d.layerDefinition.typeIdField=c(a,"typeidfieldname","");if(b=c(a,"spatialreference",null))d.layerDefinition.spatialReference=p(b);b=0;for(f=c(a,"fields",[]);b<f.length;b++)g=f[b],
g={name:c(g,"name",""),alias:c(g,"alias",""),type:c(g,"type",""),nullable:c(g,"nullable",!0),editable:c(g,"editable",!0),length:c(g,"length",null),domain:x(c(g,"domain"))},d.layerDefinition.fields.push(g);b={};g=0;for(f=d.layerDefinition.fields;g<f.length;g++)k=f[g],b[k.name.toLowerCase()]=k.name;h=0;for(n=c(a,"features",[]);h<n.length;h++){a=n[h];g={};f=c(a,"attributes",{});for(k in f)g[b[k.toLowerCase()]]=f[k];d.featureSet.features.push({attributes:g,geometry:y(c(a,"geometry",null))})}}}else throw Error("Invalid Parameter");
if(d.layerDefinition&&d.featureSet){b:{k=0;for(a=" esriGeometryPoint esriGeometryPolyline esriGeometryPolygon esriGeometryMultipoint esriGeometryEnvelope".split(" ");k<a.length;k++)if(a[k]===d.layerDefinition.geometryType){k=!0;break b}k=!1}k=!1===k||null===d.layerDefinition.objectIdField||""===d.layerDefinition.objectIdField||!1===e.isArray(d.layerDefinition.fields)||!1===e.isArray(d.featureSet.features)?!1:void 0}else k=!1;if(!1===k)throw Error("Invalid Parameter");return B.create(d,l.spatialReference)})},
a.signatures.push({name:"featureset",min:"1",max:"1"}),a.functions.filter=function(c,f){return a.standardFunctionAsync(c,f,function(d,f,b){e.pcCheck(b,2,2);if(e.isFeatureSet(b[0])){var g=D.create(b[1]),l=g.getVariables();if(0<l.length){d=[];for(f=0;f<l.length;f++)d.push(a.evaluateIdentifier(c,{name:l[f]}));return m.all(d).then(function(a){for(var c={},d=0;d<l.length;d++)c[l[d]]=a[d];g.setVariablesDictionary(c);return new w({parentfeatureset:b[0],whereclause:g})})}return m.resolve(new w({parentfeatureset:b[0],
whereclause:g}))}return a.failDefferred("Filter cannot accept this parameter type")})},a.signatures.push({name:"filter",min:"2",max:"2"}),a.functions.orderby=function(c,f){return a.standardFunctionAsync(c,f,function(c,f,b){e.pcCheck(b,2,2);return e.isFeatureSet(b[0])?(c=new C(b[1]),m.resolve(new z({parentfeatureset:b[0],orderbyclause:c}))):a.failDefferred("Order cannot accept this parameter type")})},a.signatures.push({name:"orderby",min:"2",max:"2"}),a.functions.top=function(c,f){return a.standardFunctionAsync(c,
f,function(c,f,b){e.pcCheck(b,2,2);return e.isFeatureSet(b[0])?m.resolve(new A({parentfeatureset:b[0],topnum:b[1]})):e.isArray(b[0])?e.toNumber(b[1])>=b[0].length?b[0].slice(0):b[0].slice(0,e.toNumber(b[1])):e.isImmutableArray(b[0])?e.toNumber(b[1])>=b[0].length()?b[0].slice(0):b[0].slice(0,e.toNumber(b[1])):a.failDefferred("Top cannot accept this parameter type")})},a.signatures.push({name:"top",min:"2",max:"2"}),a.functions.first=function(c,f){return a.standardFunctionAsync(c,f,function(a,c,b){e.pcCheck(b,
1,1);return e.isFeatureSet(b[0])?b[0].first(a.progressTracker).then(function(a){if(null!==a){var c=t.createFromGraphicLikeObject(a.geometry,a.attributes,b[0]);c._underlyingGraphic=a;a=c}return a}):e.isArray(b[0])?0===b[0].length?m.resolve(null):m.resolve(b[0][0]):e.isImmutableArray(b[0])?0===b[0].length()?m.resolve(null):m.resolve(b[0].get(0)):null})},a.signatures.push({name:"first",min:"1",max:"1"}),a.functions.attachments=function(c,f){return a.standardFunctionAsync(c,f,function(a,f,b){e.pcCheck(b,
1,2);var d=-1,l=-1,k=null;if(1<b.length)if(b[1]instanceof r)b[1].hasField("minsize")&&(d=e.toNumber(b[1].field("minsize"))),b[1].hasField("maxsize")&&(l=e.toNumber(b[1].field("maxsize"))),b[1].hasField("types")&&(a=e.toStringArray(b[1].field("types"),!1),0<a.length&&(k=a));else if(null!==b[1])throw Error("Invalid Parameter");if(b[0]instanceof t){var h=b[0]._layer;h instanceof E&&(h=v.constructFeatureSet(h,c.spatialReference,["*"],!0,c.lrucache));return null===h||!1===e.isFeatureSet(h)?[]:h.load().then(function(){return h.queryAttachments(b[0].field(h.objectIdField),
d,l,k)})}if(null===b[0])return[];throw Error("Invalid Parameter");})},a.signatures.push({name:"attachments",min:"1",max:"2"}))}});