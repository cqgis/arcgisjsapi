// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/assignHelper ../../core/compilerUtils ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./styleUtils ./utils".split(" "),function(H,w,I,B,C,J,u,r,K,L,M,t,z,N,D){function x(b){var a=b.outline,c=b.material&&b.material.color,c=c&&c.toRgba().toString();if(!a)return"fill"===b.type&&"255,255,255,1"===c?{color:"#bdc3c7",width:.75}:
null;b=r.pt2px(a.size)||0;return{color:"rgba("+(null!=a.color?a.color.toRgba():"255,255,255,1")+")",width:Math.min(b,80)}}function O(b,a){var c=a&&a.resource,c=c&&c.href;return b.thumbnail&&b.thumbnail.url?u.resolve(b.thumbnail.url):c&&"object"!==a.type?u.resolve(D.getIconHref(b,a)):b.styleOrigin&&(b.styleOrigin.styleName||b.styleOrigin.styleUrl)?N.resolveWebStyleSymbol(b.styleOrigin,{portal:b.styleOrigin.portal}).catch(function(a){return a}).then(function(a){return a&&a.thumbnail&&a.thumbnail.url||
E}):u.resolve(E)}function e(b,a){void 0===a&&(a=0);if(!b.material||!b.material.color)return b=Math.min(Math.max(K.defaultThematicColor.r+191.25*a,0),255),[b,b,b,100];for(var c=b.material.color.toRgb(),d=0;3>d;d++)c[d]=Math.min(Math.max(c[d]+191.25*a,0),255);c.push(b.material.color.a);return c}function F(b){return b.outline?x(b):{color:"rgba(0, 0, 0, 1)",width:1.5}}function G(b,a){if(!b.material)return null;for(var c=b.material.color.toRgb(),d="rgba(",e=0;3>e;e++)d+=Math.min(Math.max(c[e]+191.25*a,
0),255)+",";return d+b.material.color.a+");"}function A(b,a){a=G(b,a);if(!a)return{};b=Math.min(b.size?r.pt2px(b.size):.75,80);return{color:a,width:b}}function y(b,a,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:b,offset:0},{color:a,offset:1}]}}function P(b){var a=b.depth,c=b.height;return(b=b.width)&&a&&c&&b===a&&b<c}function Q(b,a,c){var d=[];if(!b)return d;switch(b.type){case "icon":var g=b.resource&&b.resource.primitive||L.defaultPrimitive;switch(g){case "circle":d.push({shape:{type:"circle",
cx:0,cy:0,r:.5*a},fill:e(b,0),stroke:x(b)});break;case "square":d.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,0]},{command:"L",values:[a,0]},{command:"L",values:[a,a]},{command:"Z",values:[]}]},fill:e(b,0),stroke:x(b)});break;case "triangle":d.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,a]},{command:"Z",values:[]}]},fill:e(b,0),stroke:x(b)});break;case "cross":d.push({shape:{type:"path",path:[{command:"M",
values:[.5*a,0]},{command:"L",values:[.5*a,a]},{command:"M",values:[0,.5*a]},{command:"L",values:[a,.5*a]},{command:"E",values:[]}]},stroke:F(b)});break;case "x":d.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,a]},{command:"M",values:[a,0]},{command:"L",values:[0,a]},{command:"E",values:[]}]},stroke:F(b)});break;case "kite":d.push({shape:{type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,.5*a]},{command:"L",values:[.5*
a,a]},{command:"Z",values:[]}]},fill:e(b,0),stroke:x(b)});break;default:B.neverReached(g)}break;case "object":switch(g=b.resource&&b.resource.primitive||M.defaultPrimitive,g){case "cone":g=e(b,0);b=e(b,-.6);b=y(g,b,c?20:a);a=t.getConeShapes(a,c);d.push({shape:a[0],fill:b});d.push({shape:a[1],fill:b});break;case "inverted-cone":c=e(b,0);b=e(b,-.6);b=y(c,b,a);a=t.getInvertedConeShapes(a);d.push({shape:a[0],fill:b});d.push({shape:a[1],fill:c});break;case "cube":a=t.getCubeShapes(a,c);d.push({shape:a[0],
fill:e(b,0)});d.push({shape:a[1],fill:e(b,-.3)});d.push({shape:a[2],fill:e(b,-.5)});break;case "cylinder":var g=e(b,0),n=e(b,-.6),g=y(g,n,c?20:a);a=t.getCylinderShapes(a,c);d.push({shape:a[0],fill:g});d.push({shape:a[1],fill:g});d.push({shape:a[2],fill:e(b,0)});break;case "diamond":a=t.getDiamondShapes(a);d.push({shape:a[0],fill:e(b,-.3)});d.push({shape:a[1],fill:e(b,0)});d.push({shape:a[2],fill:e(b,-.3)});d.push({shape:a[3],fill:e(b,-.7)});break;case "sphere":c=e(b,0);b=e(b,-.6);b=y(c,b);b.x1=0;
b.y1=0;b.x2=.25*a;b.y2=.25*a;d.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:b});break;case "tetrahedron":a=t.getTetrahedronShapes(a);d.push({shape:a[0],fill:e(b,-.3)});d.push({shape:a[1],fill:e(b,0)});d.push({shape:a[2],fill:e(b,-.6)});break;default:B.neverReached(g)}}return d}function R(b,a){var c=a&&a.size?r.pt2px(a.size):null,d=a&&a.maxSize?r.pt2px(a.maxSize):null,e=a&&a.disableUpsampling,n=b.symbolLayers,m=[],l=0,p=0,q=n.getItemAt(n.length-1),h;q&&"icon"===q.type&&(h=q.size&&r.pt2px(q.size));
n.forEach(function(k,f){if("icon"===k.type||"object"===k.type){f="icon"===k.type?k.size&&r.pt2px(k.size):0;var q=c||f?Math.ceil(Math.min(c||f,d||120)):22,g="icon"===k.type?x(k):null,n=g?g.width:0;k&&k.resource&&k.resource.href?(f=O(b,k).then(function(a){var b=k.get("material.color"),c;c="icon"===k.type?"multiply":"tint";return z.tintImageWithColor(a,q,b,c,e)}).then(function(a){var b=a.width,c=a.height;l=Math.max(l,b+n+1);p=Math.max(p,c+n+1);return[{shape:{type:"image",x:0,y:0,width:b,height:c,src:a.url},
fill:null,stroke:null}]}),m.unshift(f)):(g=q,"icon"===k.type&&h&&c&&(g=f/h*q),f=a&&"tall"===a.symbolConfig||("object"===k.type?P(k):!1),l=Math.max(l,f?20:g+n+1),p=Math.max(p,g+n+1),m.unshift(u.resolve(Q(k,g,f))))}});return u.eachAlways(m).then(function(b){var c=[];b.forEach(function(a){a.value?c.push(a.value):a.error&&S.warn("error while building swatchInfo!",a.error)});return z.renderSymbol(c,[l,p],{node:a&&a.node,scale:!1})})}function T(b,a){var c=b.symbolLayers,d=[];b=D.isVolumetricSymbol(b);var g=
a&&a.size?r.pt2px(a.size):null,n=(a&&a.maxSize?r.pt2px(a.maxSize):null)||80,m=0,l=0,p;c.forEach(function(a,b){if(a&&("line"===a.type||"path"===a.type)){var c=[];switch(a.type){case "line":var f=(a=A(a,0))&&a.width||0;0===b&&(p=f);var h=Math.min(g||f,n);b=0===b?h:g?f/p*h:h;l=Math.max(l,b);m=Math.max(m,22<b?b+1:40);a.width=b;c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[m,.5*l]},{command:"E",values:[]}]},stroke:a});break;case "path":b=Math.min(g||22,n),f=e(a,0),
h=e(a,-.2),a=(a=G(a,-.4))?{color:a,width:1}:{},c.push({shape:t.shapes.pathSymbol3DLayer[0],fill:h,stroke:a}),c.push({shape:t.shapes.pathSymbol3DLayer[1],fill:f,stroke:a}),m=l=Math.max(l,b+(a.width||0)+1)}d.push(c)}});return u.resolve(z.renderSymbol(d,[m,l],{node:a&&a.node,scale:b}))}Object.defineProperty(w,"__esModule",{value:!0});var E=H.toUrl("../../images/Legend/legend3dsymboldefault.png"),S=J.getLogger("esri.symbols.support.previewSymbol3D");w.getSymbolLayerFill=e;w.previewSymbol3D=function(b,
a){if(0===b.symbolLayers.length)return u.reject(new C("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var c=null;switch(b.type){case "point-3d":c=R(b,a);break;case "line-3d":c=T(b,a);break;case "polygon-3d":case "mesh-3d":c="mesh-3d"===b.type;b=b.symbolLayers;for(var d=a&&a.size?r.pt2px(a.size):null,g=a&&a.maxSize?r.pt2px(a.maxSize):null,d=d||22,n=[],m=0,l=0,p=!1,q=0;q<b.length;q++){var h=b.getItemAt(q),k=[];if(!c||"fill"===h.type){var f=t.shapes.fill[0];switch(h.type){case "fill":var v=
x(h),p=v&&v.width||0,m=Math.max(m,d+p),l=Math.max(l,d+p),p=!0;k.push({shape:f,fill:e(h,0),stroke:v});break;case "line":h=(v=A(h,0))&&v.width||0;f={stroke:v,shape:f};m=Math.max(m,22+h);l=Math.max(l,22+h);k.push(f);break;case "extrude":var f=I({join:"round"},A(h,-.4)),v=e(h,0),h=e(h,-.2),y=Math.min(d,g||120),w=t.getExtrudeSymbolShapes(y);f.width=1;k.push({shape:w[0],fill:h,stroke:f});k.push({shape:w[1],fill:h,stroke:f});k.push({shape:w[2],fill:v,stroke:f});h=22*.7+.5*y;m=Math.max(m,22+f.width+1);l=
Math.max(l,h+f.width+1)}n.push(k)}}c=u.resolve(z.renderSymbol(n,[m,l],{node:a&&a.node,scale:p}))}return c?c:u.reject(new C("symbolPreview: swatchInfo3D","symbol not supported."))}});