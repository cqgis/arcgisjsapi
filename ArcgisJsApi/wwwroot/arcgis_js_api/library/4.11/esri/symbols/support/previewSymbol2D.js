// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.11/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils".split(" "),function(E,q,w,u,l,r,x,y){function z(e,b){var a=A.getContext("2d"),d=[];b&&(b.weight&&d.push(b.weight),b.size&&d.push(b.size+"px"),b.family&&d.push(b.family));a.font=d.join(" ");return a.measureText(e).width}function B(e){if(0===e.length)return 0;if(2<e.length){var b=l.px2pt(1),a=parseFloat(e);switch(e.slice(-2)){case "px":return a;case "pt":return a*b;case "in":return 72*
a*b;case "pc":return 12*a*b;case "mm":return a*C*b;case "cm":return a*D*b}}return parseFloat(e)}Object.defineProperty(q,"__esModule",{value:!0});var A=document.createElement("canvas"),C=7.2/2.54,D=72/2.54;q.previewSymbol2D=function(e,b){var a=b&&b.size?l.pt2px(b.size):null,d=b&&b.maxSize?l.pt2px(b.maxSize):null,m=b&&null!=b.opacity?b.opacity:null,q=b&&null!=b.rotation?b.rotation:null,c=r.getStroke(e),h={shape:null,fill:null,stroke:c};c&&c.width&&(c.width=Math.min(c.width,80));var g=0,f=0,k=c&&c.width||
0,t=!1,v=null;switch(e.type){case "simple-marker":m=e.style;f=g=a=Math.min(a||l.pt2px(e.size),d||120);switch(m){case "circle":h.shape={type:"circle",cx:0,cy:0,r:.5*a};break;case "cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*f]},{command:"L",values:[g,.5*f]},{command:"M",values:[.5*g,0]},{command:"L",values:[.5*g,f]},{command:"E",values:[]}]};break;case "diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*f]},{command:"L",values:[.5*g,0]},{command:"L",values:[g,.5*f]},{command:"L",
values:[.5*g,f]},{command:"Z",values:[]}]};break;case "square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[g,0]},{command:"L",values:[g,f]},{command:"L",values:[0,f]},{command:"Z",values:[]}]};break;case "triangle":h.shape={type:"path",path:[{command:"M",values:[.5*g,0]},{command:"L",values:[g,f]},{command:"L",values:[0,f]},{command:"Z",values:[]}]};break;case "x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[g,f]},{command:"M",values:[g,
0]},{command:"L",values:[0,f]},{command:"E",values:[]}]};break;case "path":t=!0,h.shape={type:"path",path:e.path||""}}break;case "simple-line":k=Math.min(a||k,d||80);g=22<k?2*k:40;f=k;c.width=k;k=0;h.shape={type:"path",path:[{command:"M",values:[0,.5*f]},{command:"L",values:[g,.5*f]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":f=g=a=Math.min(a,d||120);t=!0;h.shape=x.shapes.fill[0];break;case "picture-marker":var n=d||120,c=l.pt2px(e.width),d=l.pt2px(e.height),a=Math.min(a||
Math.max(c,d),n),d=c/d,c=1>=d?Math.ceil(a*d):a,d=1>=d?a:Math.ceil(a/d),g=c,f=d,v=m;h.shape={type:"image",x:-Math.round(c/2),y:-Math.round(d/2),width:c,height:d,src:e.url||""};break;case "text":m=e.text||"Aa",c=e.font,a=Math.min(a||l.pt2px(c.size),d||120),n=z(m,{weight:c.weight,size:a,family:c.family}),g=(d=/[\uE600-\uE6FF]/.test(m))?a:n,f=a,n=.25*B((c?a:0).toString()),d&&(n+=5),h.shape={type:"text",text:m,x:0,y:n,align:"middle",decoration:c&&c.decoration,rotated:e.rotated,kerning:e.kerning},h.font=
c&&{size:a,style:c.style,decoration:c.decoration,weight:c.weight,family:c.family}}if(!h.shape)return u.reject(new w("symbolPreview: renderPreviewHTML2D","symbol not supported."));var g=(g||22)+k+1,f=(f||22)+k+1,p=r.getFill(e),k=e.color,a=null;p&&"pattern"===p.type&&k&&"picture-fill"!==e.type?a=r.getPatternUrlWithColor(p.src,k.toCss(!0)).then(function(a){p.src=a;h.fill=p;return h}):(h.fill=p,a=u.resolve(h));return a.then(function(a){return y.renderSymbol([[a]],[g,f],{node:b&&b.node,scale:t,opacity:v,
rotation:q})})}});